<!DOCTYPE html>
<html lang="ru">
<head>
  <script src="version-control.js?t=1"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
  <title>AI Чат</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    /* === СБРОС === */
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

    :root {
      /* === ЦВЕТА (Фиолетово-голубые) === */
      --grad-main: linear-gradient(135deg, #0a84ff 0%, #5e60ce 100%);
      --acc-blue: #0a84ff;
      
      --aiBubble: rgba(255,255,255,.18);
      --aiBorder: rgba(255,255,255,.28);
      --maxw: 560px;
    }

    /* ФОН ЧЕРНЫЙ */
    html, body {
      background-color: #050505;
      margin: 0; padding: 0; width: 100%; height: 100vh;
      overflow: hidden; 
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      position: fixed; top: 0; left: 0;
    }

    /* === СЛОЙ 0: ШАРЫ И ШУМ === */
    .fx-layer { 
      position: fixed; inset: 0; 
      z-index: 0; 
      pointer-events: none; 
    }
    .orb { position: absolute; border-radius: 50%; animation: float 30s infinite linear; filter: blur(50px); }
    
    .orb-1 { 
      width: 90vw; height: 90vw; opacity: 0.5; 
      background: radial-gradient(circle, rgba(94, 96, 206, 0.8) 0%, transparent 70%); 
      top: -20%; right: -20%; 
    }
    .orb-2 { 
      width: 350px; height: 350px; opacity: 0.4; 
      background: radial-gradient(circle, rgba(10, 132, 255, 0.8) 0%, transparent 70%); 
      bottom: -50px; left: -50px; 
      animation-duration: 40s; 
    }
    .noise { 
      position: fixed; inset: 0; z-index: 0; opacity: 0.05; 
      background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); 
      pointer-events: none; 
    }
    @keyframes float { 0% {transform:rotate(0deg)} 100% {transform:rotate(360deg)} }

    /* === СЛОЙ 1: КОНТЕНТ === */
    .container {
      position: relative; z-index: 1; 
      top: 0; left: 0; right: 0;
      height: 100%; 
      max-width: var(--maxw); margin: 0 auto;
      display: flex; flex-direction: column;
      overflow: hidden;
    }

    /* === ШАПКА (СКРЫТА, НО КОД ОСТАВЛЕН) === */
    .header {
      position: absolute; top: 0; left: 0; right: 0;
      height: 56px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(5,5,5,0.7); 
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      z-index: 20;
    }
    .header h4 { font-size: 18px; font-weight: 900; letter-spacing: .3px; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    
    .clear-btn {
      position: absolute; right: 16px; padding: 6px 12px; border: 0; border-radius: 10px;
      background: rgba(239,68,68,.25); border: 1px solid rgba(239,68,68,.4);
      color: #fff; font-weight: 700; font-size: 13px; cursor: pointer;
    }

    /* === ЧАТ === */
    .chat-area {
      flex-grow: 1;
      height: 100%;
      overflow-y: auto; overflow-x: hidden;
      padding: 16px 14px;
      
      /* ОТСТУП СВЕРХУ: Был 70px, теперь 20px (так как шапка скрыта) */
      padding-top: calc(20px + env(safe-area-inset-top)); 
      
      /* ОТСТУП СНИЗУ: Большой, чтобы не перекрывалось инпутом */
      padding-bottom: 120px; 
      display: flex; flex-direction: column; gap: 12px;
      -webkit-overflow-scrolling: touch;
    }
    .chat-area::-webkit-scrollbar { width: 0px; display: none; }

    .message { display: flex; flex-direction: column; max-width: 85%; animation: slideIn .3s ease; position: relative; }
    @keyframes slideIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    .message.user { align-self: flex-end; align-items: flex-end; }
    .message.ai { align-self: flex-start; align-items: flex-start; }

    .message-bubble {
      padding: 12px 16px; border-radius: 18px; 
      backdrop-filter: blur(12px); box-shadow: 0 4px 15px rgba(0,0,0,.1);
      font-size: 16px; line-height: 1.5; word-wrap: break-word;
    }
    
    .message.user .message-bubble {
      background: var(--grad-main); 
      border: 1px solid rgba(255,255,255,0.1); 
      border-bottom-right-radius: 4px;
      color: #fff;
    }
    .message.ai .message-bubble {
      background: rgba(255,255,255,.15); border: 1px solid rgba(255,255,255,.25); border-bottom-left-radius: 4px;
    }
    .message-time { font-size: 11px; opacity: .7; margin-top: 4px; padding: 0 4px; }

    /* === ИНПУТ === */
    .input-area {
      position: absolute; bottom: 0; left: 0; right: 0; 
      background: rgba(5,5,5,0.7);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border-top: 1px solid rgba(255,255,255,0.1);
      padding: 12px 14px; 
      padding-bottom: max(12px, env(safe-area-inset-bottom)); 
      z-index: 30;
      display: flex; gap: 10px; align-items: flex-end;
      transition: transform 0.1s;
    }

    .input-field {
      flex: 1; min-height: 44px; max-height: 120px; padding: 11px 16px;
      border: 1px solid rgba(255,255,255,.2); border-radius: 22px;
      background: rgba(255,255,255,.1); 
      color: #fff; font-size: 16px; font-family: inherit; resize: none; outline: none;
    }
    .input-field::placeholder { color: rgba(255,255,255,0.5); }
    .input-field:focus { border-color: var(--acc-blue); background: rgba(255,255,255,.15); }
    
    .send-btn {
      width: 44px; height: 44px; border: 0; border-radius: 50%; flex-shrink: 0;
      background: var(--grad-main); 
      color: #fff; display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,.2);
    }
    .send-btn:disabled { opacity: .5; box-shadow: none; }

    .empty-state { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 1; text-align: center; margin-top: 10%; padding: 0 20px; }
    
    /* Модалка */
    .delete-btn { position: absolute; top: 50%; transform: translateY(-50%); width: 32px; height: 32px; border-radius: 50%; background: #ef4444; color: #fff; display: none; align-items: center; justify-content: center; z-index: 10; box-shadow:0 4px 10px rgba(0,0,0,.3); }
    .message.user .delete-btn { left: -45px; } .message.ai .delete-btn { right: -45px; }
    .message.show-delete .delete-btn { display: flex; }
    
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,.7); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; backdrop-filter: blur(5px); }
    .modal.show { display: flex; }
    .modal-content { background: rgba(30,30,30,0.9); border: 1px solid rgba(255,255,255,.2); border-radius: 20px; padding: 24px; width: 100%; max-width: 320px; text-align: center; box-shadow:0 20px 50px rgba(0,0,0,.5); }
    .modal-buttons { display: flex; gap: 10px; margin-top: 20px; }
    .modal-btn { flex: 1; padding: 12px; border-radius: 12px; border: 0; font-weight: 700; cursor: pointer; }
    .modal-btn.cancel { background: rgba(255,255,255,.15); color: #fff; }
    .modal-btn.confirm { background: var(--grad-main); color: #fff; }
    
    .typing-indicator { display: flex; gap: 4px; padding: 12px 16px; }
    .typing-dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,.7); animation: typing 1.4s infinite; }
    .typing-dot:nth-child(2){ animation-delay:.2s; } .typing-dot:nth-child(3){ animation-delay:.4s; }
    @keyframes typing{ 0%,60%,100%{transform:translateY(0);opacity:.7} 30%{transform:translateY(-10px);opacity:1} }
  </style>
</head>
<body>

  <div class="fx-layer">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="noise"></div>
  </div>

  <div class="container">
    <div class="header" style="display:none">
      <h4>Ai-Консультант</h4>
      <button class="clear-btn" id="clearBtn" style="display:none">Очистить</button>
    </div>

    <div class="chat-area" id="chatArea">
      <div class="empty-state" id="emptyState">
        <h2 style="font-size: 22px; margin-bottom: 12px; font-weight: 800;">Спросите о главном</h2>
        <p style="max-width: 300px; line-height: 1.5; font-size: 15px; color: rgba(255,255,255,0.7);">
          Задайте любой вопрос в области питания, спорта и восстановления.<br><br>
          При активном использовании приложения, если вы заполняете анкеты и ведете дневники, я буду отвечать с максимальной индивидуализацией. Чем больше я знаю про вас, тем точнее ответы.
        </p>
      </div>
    </div>

    <div class="input-area" id="inputArea">
      <div class="input-wrapper" style="display:flex; width:100%; gap:10px; align-items:flex-end;">
        <textarea class="input-field" id="messageInput" placeholder="Задайте вопрос..." rows="1"></textarea>
        <button class="send-btn" id="sendBtn" disabled>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="modal" id="confirmModal">
    <div class="modal-content">
      <h3 id="modalTitle">Подтверждение</h3>
      <p id="modalText">Вы уверены?</p>
      <div class="modal-buttons">
        <button class="modal-btn cancel" id="modalCancel">Отмена</button>
        <button class="modal-btn confirm" id="modalConfirm">Удалить</button>
      </div>
    </div>
  </div>

<script src="ai.js"></script>

</body>
</html>
