<!DOCTYPE html>
<html lang="ru">
<head>
<script src="version-control.js?t=1"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>–í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤ Ultima</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  /* üî• –°–ë–†–û–° –°–¢–ò–õ–ï–ô –ò –ë–ê–ó–ê */
  *::-webkit-scrollbar { display: none; width: 0; height: 0; }
  * { -ms-overflow-style: none; scrollbar-width: none; box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent !important; }
  html, body, button, .cat-card, .product-row, .btn-save { touch-action: manipulation; }

  :root {
    --bg-core: #050505;
    --text-main: #ffffff;
    --text-muted: rgba(255, 255, 255, 0.55);
    --surface-glass: rgba(255, 255, 255, 0.07);
    --surface-dark: rgba(0, 0, 0, 0.3);
    --surface-border: rgba(255, 255, 255, 0.1);
    --surface-border-light: rgba(255, 255, 255, 0.2);
    --acc-blue: #0a84ff;
    --acc-green: #30d158;
    --okA: #4facfe; 
    --okB: #0a84ff;
    --radius-xl: 28px;
    --radius-l: 24px;
    --radius-m: 16px;
    --pad-x: 16px; 
    --gap: 8px;
  }

  body {
    background-color: var(--bg-core) !important;
    color: var(--text-main);
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', Roboto, Helvetica, Arial, sans-serif;
    height: 100vh;
    overflow: hidden; 
    display: flex; flex-direction: column;
    -webkit-font-smoothing: antialiased;
  }

  /* --- FON (FX LAYER) --- */
  .fx-layer { 
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; height: 100lvh; 
    z-index: 0; pointer-events: none; transform: translate3d(0,0,0); 
  }
  .orb { position: absolute; border-radius: 50%; will-change: transform; animation: float 30s infinite linear; }
  .orb-1 { width: 90vw; height: 90vw; opacity: 0.4; background: radial-gradient(circle, rgba(108, 92, 231, 0.8) 0%, transparent 70%); top: -20%; left: -20%; }
  .orb-2 { width: 400px; height: 400px; opacity: 0.5; background: radial-gradient(circle, rgba(108, 92, 231, 0.8) 0%, transparent 70%); top: 80%; right: -100px; animation: breathe 6s infinite ease-in-out; }
  .noise { position: fixed; inset: 0; z-index: 0; opacity: 0.04; background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); pointer-events: none; }
  @keyframes float { 0% {transform:rotate(0deg)} 100% {transform:rotate(360deg)} }
  @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 0.4; } 50% { transform: scale(1.1); opacity: 0.6; } }

  /* --- LOADER (–í–ò–î–ï–ù –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ) --- */
  .loader-container {
    position: fixed; inset: 0; z-index: 9999;
    background: var(--bg-core);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    transition: opacity 0.5s ease;
    /* üî• –≠–¢–ò –î–í–ï –°–¢–†–û–ö–ò –ì–ê–†–ê–ù–¢–ò–†–£–Æ–¢, –ß–¢–û –≠–ö–†–ê–ù –ù–ï –ë–£–î–ï–¢ –ü–£–°–¢–´–ú */
    opacity: 1; 
    pointer-events: auto;
  }
  /* –ö–ª–∞—Å—Å –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –ª–æ–∞–¥–µ—Ä–∞ */
  .loader-container.hidden { opacity: 0; pointer-events: none; }
  
  .spinner {
    width: 36px; height: 36px;
    border: 3px solid rgba(255, 255, 255, 0.1);
    border-top-color: var(--acc-blue);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-bottom: 12px;
  }
  .loader-text { color: var(--text-muted); font-size: 15px; font-weight: 500; }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* --- HEADER --- */
  .app-header { position: relative; z-index: 10; padding: 12px var(--pad-x) 4px; background: transparent !important; }
  .header-flex { display: flex; align-items: center; width: 100%; gap: 0; }
  
  .search-box { position: relative; flex: 1; transition: margin-right 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); }
  .search-input {
    width: 100%; height: 40px; background: var(--surface-dark);
    border: 1px solid var(--surface-border); border-top: 1px solid var(--surface-border-light);
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    border-radius: 14px; padding: 0 36px 0 40px;
    color: #fff; font-size: 16px; font-weight: 500;
    transition: all 0.2s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    line-height: normal;
  }
  .search-input:focus { background: rgba(0, 0, 0, 0.5); border-color: rgba(255, 255, 255, 0.25); outline: none; }
  .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: rgba(255,255,255,0.4); pointer-events: none; z-index: 10; display: flex; align-items: center; justify-content: center; margin-top: 1px; }
  .search-clear { position: absolute; right: 0; top: 0; bottom: 0; width: 36px; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.4); opacity: 0; pointer-events: auto; transition: opacity 0.2s; }
  .search-input:not(:placeholder-shown) ~ .search-clear { opacity: 1; }
  
  .search-cancel-btn { background: none; border: none; color: var(--acc-blue); font-size: 17px; font-weight: 500; padding: 0; width: 0; opacity: 0; overflow: hidden; white-space: nowrap; cursor: pointer; transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); }
  body.search-active .search-cancel-btn { width: 100px; opacity: 1; padding-left: 10px; }

  /* --- VIEWS --- */
  .views-container { position: relative; flex: 1; overflow: hidden; z-index: 1; }
  .view {
    position: absolute; inset: 0; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch;
    padding: 12px var(--pad-x) 140px;
    transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.3s ease;
    opacity: 0; pointer-events: none; transform: translateX(30px); background: transparent;
  }
  .view.active { opacity: 1; pointer-events: auto; transform: translateX(0); }
  .view.prev { transform: translateX(-10%) scale(0.98); opacity: 0; pointer-events: none; }

  /* --- GRID --- */
  .cat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--gap); }
  .cat-card {
    background: linear-gradient(165deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important; border-radius: var(--radius-l) !important;
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.2) !important; padding: 14px;
    display: flex; flex-direction: column; justify-content: space-between; min-height: 110px;
    cursor: pointer; position: relative; overflow: hidden; transition: background 0.2s; will-change: transform;
  }
  .cat-icon { font-size: 20px; margin-bottom: 10px; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3)); }
  .cat-name { font-size: 14px; font-weight: 500; line-height: 1.3; margin-bottom: 2px; color: #fff; letter-spacing: 0.3px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; min-height: 2.6em; }
  .cat-meta { display: flex; flex-direction: column; align-items: flex-start; justify-content: flex-end; gap: 6px; font-size: 12px; color: rgba(255,255,255,0.55); font-weight: 500; margin-top: auto; width: 100%; }
  .mini-track { width: 40px; height: 4px; background: rgba(255, 255, 255, 0.1); border-radius: 2px; overflow: hidden; }
  .mini-fill { height: 100%; background: var(--acc-blue); border-radius: 2px; transition: width 0.3s ease; }

  /* --- LIST --- */
  .list-header-area { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; padding: 0 4px; }
  .list-title { font-size: 14px; font-weight: 600; letter-spacing: 0.3px; color: #fff; }
  .btn-select-all { font-size: 14px; font-weight: 600; color: var(--acc-blue); background: none; border: none; padding: 6px 0; cursor: pointer; transition: opacity 0.2s; }
  .btn-select-all:active { opacity: 0.7; }

  .product-list-container {
    display: flex; flex-direction: column; gap: 8px;
    background: linear-gradient(165deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important; padding: 14px; border-radius: 20px; backdrop-filter: blur(10px); min-height: 50px;
  }
  .product-row {
    display: flex; align-items: center; justify-content: flex-start; gap: 12px;
    padding: 12px 14px; border-radius: 12px; position: relative; cursor: pointer; background: transparent;
    transition: background 0.15s ease; will-change: transform; opacity: 1;
  }
  .bump { animation: bump 0.15s cubic-bezier(0.34, 1.56, 0.64, 1) !important; }
  @keyframes bump { 0% { transform: scale(1); } 50% { transform: scale(0.95); } 100% { transform: scale(1); } }
  
  .prod-info { flex: 1; z-index: 2; display: flex; flex-direction: column; gap: 3px; }
  .prod-name { font-size: 14px; font-weight: 400; color: #fff; line-height: 1.3; }
  .prod-meta { font-size: 12px; color: rgba(255,255,255,0.5); font-weight: 500; letter-spacing: 0.2px; }
  
  .check-square { width: 22px; height: 22px; border-radius: 6px; border: 2px solid rgba(255,255,255,.65); display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all .2s ease; background: transparent; }
  .check-square::after { content: ""; width: 12px; height: 12px; border-radius: 3px; background: #fff; opacity: 0; transform: scale(.7); transition: all .2s ease; }
  .product-row.selected .check-square { background: linear-gradient(135deg, var(--okA), var(--okB)); border-color: var(--okB); transform: scale(1.05); }
  .product-row.selected .check-square::after { opacity: 1; transform: scale(1); }

  /* --- SAVE BTN --- */
  .save-floater { position: absolute; bottom: 34px; left: 0; right: 0; display: flex; justify-content: center; z-index: 30; pointer-events: none; }
  .btn-save {
    position: relative; z-index: 100; isolation: isolate; pointer-events: auto;
    background: transparent; border: none; height: auto; min-width: 160px; padding: 14px 28px;
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', Roboto, sans-serif;
    font-size: 16px; font-weight: 600; color: #fff; display: flex; align-items: center; justify-content: center;
    gap: 8px; cursor: pointer; transition: transform 0.2s; transform: translateY(100px); opacity: 0;
  }
  .btn-save::before {
    content: ""; position: absolute; z-index: -2; top: -8px; bottom: -8px; left: -8px; right: -8px; border-radius: 24px;
    background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.05); pointer-events: none;
  }
  .btn-save::after {
    content: ""; position: absolute; z-index: -1; inset: 0; border-radius: 16px; 
    background: linear-gradient(135deg, var(--okA), var(--okB)); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); transition: transform 0.1s;
  }
  .btn-save.visible { transform: translateY(0); opacity: 1; }
  .btn-save:active { transform: scale(0.96); }
  body.search-active .btn-save { transform: translateY(150px) !important; opacity: 0 !important; pointer-events: none !important; }

  /* --- EMPTY --- */
  .simple-no-results { width: 100%; height: 30vh; display: flex; align-items: center; justify-content: center; color: rgba(255, 255, 255, 0.4); font-size: 17px; font-weight: 500; }
  #sentinel { height: 20px; width: 100%; opacity: 0; pointer-events: none; }
</style>
</head>
<body>

<div class="fx-layer">
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="noise"></div>
</div>

<div class="loader-container" id="appLoader">
  <div class="spinner"></div>
  <div class="loader-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<div class="app-header">
  <div class="header-flex">
    <div class="search-box">
      <div class="search-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
      <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤" id="searchInput" onfocus="enterSearchMode()">
      <div class="search-clear" id="searchClear"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></div>
    </div>
    <button class="search-cancel-btn" id="btnSearchCancel" onclick="exitSearchMode()">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<div class="views-container">
  <div class="view active" id="view-cats"><div class="cat-grid" id="catGrid"></div></div>
  <div class="view" id="view-list">
    <div class="list-header-area">
      <h2 class="list-title" id="catTitle">–ù–∞–∑–≤–∞–Ω–∏–µ</h2>
      <button class="btn-select-all" id="btnSelectAll">–í—ã–±—Ä–∞—Ç—å –≤—Å—ë</button>
    </div>
    <div class="product-list-container" id="productList"></div>
    <div id="sentinel"></div>
  </div>
  <div class="view" id="view-search"><div class="product-list-container" id="searchResults" style="display:none; background:transparent!important; border:none!important; box-shadow:none!important; backdrop-filter:none!important;"></div></div>
</div>

<div class="save-floater">
  <button class="btn-save" id="btnSave" onclick="saveSelection()">
    <span id="saveBtnText">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
  </button>
</div>

<script src="products.js"></script>
</body>
</html>
