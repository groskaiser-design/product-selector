<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ê–Ω–∫–µ—Ç–∞ ‚Äî —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (–∫–∞–∫ –≤ –º–∞–∫–µ—Ç–µ)</title>

  <!-- === SMART VERSION CONTROL: –∫–∞–∫ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ === -->
  <script>
  // üîî —Ñ–∏–∫—Å–∏—Ä—É–µ–º –º–æ–º–µ–Ω—Ç –∑–∞–ø—É—Å–∫–∞
  window.__pageLoadTime = performance.now();

  const APP_HTML_VERSION = 'm2025-01-24-003'; // ‚Üê –º–µ–Ω—è–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–ª–∏–∑–µ

  (function smartVersionCheck(){
    try{
      const url=new URL(location.href);
      const v=url.searchParams.get('v');
      if(v!==APP_HTML_VERSION){ url.searchParams.set('v',APP_HTML_VERSION); location.replace(url.href); }
    }catch(_){}
  })();

  // –°–±—Ä–æ—Å –∫—ç—à–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞–∑–∞–¥ (bfcache)
  window.addEventListener('pageshow',function(e){
    try{
      if(e.persisted){
        const url=new URL(location.href);
        url.searchParams.set('v',APP_HTML_VERSION);
        location.replace(url.href);
      }
    }catch(_){}
  },{once:true});
  </script>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --cardA: rgba(255,255,255,.18);
      --cardB: rgba(255,255,255,.16);
      --border: rgba(255,255,255,.28);
      --shadow: 0 8px 28px rgba(0,0,0,.18);
      --okA: #fbbf24;
      --okB: #f59e0b;
      --row: 36px;         /* –≤—ã—Å–æ—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–ª—ë—Å–∞—Ö */
      --contentW: 420px;   /* —à–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç–æ—á–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ */
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { min-height: 100vh; background: var(--bg); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: #fff; padding: 18px 14px; }
    .container { max-width: 560px; margin: 0 auto; }

    /* –ö–∞—Ä–∫–∞—Å */
    .section { background: linear-gradient(180deg, var(--cardA), var(--cardB)); border: 1px solid var(--border); border-radius: 18px; box-shadow: var(--shadow); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); overflow: hidden; }
    .section + .section { margin-top: 14px; }
    .section-h { display:flex; align-items:center; gap:10px; padding:14px 16px; cursor:pointer; user-select:none; }
    .section-h h2 { font-size: 16px; font-weight: 800; flex: 1; }
    .toggle { width:22px; height:22px; border-radius:50%; display:flex; align-items:center; justify-content:center; opacity:.9; }
    .toggle svg { transition: transform .18s ease; }
    .section.collapsed .toggle svg { transform: rotate(-90deg); }
    .section-content { padding: 0; }
    .section.collapsed .section-content { display: none; }

    .field { padding: 12px; }
    .field + .field { border-top: 1px solid rgba(255,255,255,.14); }
    .row { display:flex; align-items:center; justify-content:space-between; }
    .label { font-size: 13px; font-weight: 800; }
    .unit { font-size: 12px; opacity: .9; }
    .help { margin-top: 6px; text-align: center; font-size: 12px; opacity: .8; }

    /* –ë–∏–Ω–∞—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (–ø–æ–ª) */
    .binary-choice { display:flex; gap:8px; padding:12px; border-radius:14px; background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.24); max-width: var(--contentW); width:100%; margin:8px auto 0; }
    .binary-btn { flex:1; padding:10px 16px; border:0; border-radius:12px; background: rgba(255,255,255,.15); color:#fff; font-weight:700; font-size:14px; transition: all .2s ease; cursor:pointer; }
    .binary-btn.active { background: linear-gradient(135deg, var(--okA), var(--okB)); box-shadow: 0 4px 12px rgba(251,191,36,.4), inset 0 1px 0 rgba(255,255,255,.3); transform: scale(1.02); }

    /* –ß–∏—Å–ª–æ–≤—ã–µ –∫–æ–ª—ë—Å–∞ */
    .duo { position:relative; display:flex; gap:6px; padding:12px; border-radius:14px; background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.24); max-width: var(--contentW); width:100%; margin:8px auto 0; justify-content:center; }
    .duo::after { content:""; position:absolute; left:4px; right:4px; top:50%; height:var(--row); transform: translateY(-50%); background: rgba(255,255,255,.14); border:1px solid rgba(255,255,255,.35); border-radius:10px; pointer-events:none; }
    .duo.disabled { opacity:.55; pointer-events:none; }
    .col { flex:0 0 92px; height:180px; overflow:auto; overscroll-behavior:contain; scrollbar-width:none; scroll-snap-type:y mandatory; mask-image: linear-gradient(180deg, transparent, #000 18%, #000 82%, transparent); -webkit-mask-image: linear-gradient(180deg, transparent, #000 18%, #000 82%, transparent); }
    .col::-webkit-scrollbar { display:none; }
    .option { height: var(--row); display:flex; align-items:center; justify-content:center; font-weight:900; font-size:18px; color:#eef2ff; opacity:.55; scroll-snap-align:center; }
    .option.active { color:#fff; opacity:1; text-shadow:0 1px 0 rgba(0,0,0,.2); }
    .sep { display:flex; align-items:center; justify-content:center; width:10px; color:#e5e7eb; font-weight:800; }

    .optline { margin-top:8px; display:flex; justify-content:center; gap:8px; align-items:center; opacity:.95; }

    /* –°–ø–∏—Å–∫–∏ –≤—ã–±–æ—Ä–∞ */
    .choice-list{display:grid;grid-template-columns:1fr;gap:8px;padding:14px;border-radius:20px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.28);max-width:var(--contentW);width:100%;margin:8px auto 0;}
    .choice-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:12px;background:transparent;border:0;cursor:pointer;transition:filter .15s ease, background .15s ease}
    .choice-item:hover{background:rgba(255,255,255,.14)}
    .choice-item span.label{font-weight:700;letter-spacing:.2px}

    /* –†–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∞ (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –∫–æ–ª—å—Ü–æ + –±–µ–ª–∞—è —Ç–æ—á–∫–∞) */
    .radio-circle{width:22px;height:22px;border-radius:50%;border:2px solid rgba(255,255,255,.65);display:flex;align-items:center;justify-content:center;flex-shrink:0;background:transparent;transition:all .2s ease}
    .radio-circle::after{content:"";width:10px;height:10px;border-radius:50%;background:#fff;opacity:0;transform:scale(0);transition:all .2s ease}
    .choice-item.selected .radio-circle{background:linear-gradient(135deg,var(--okA),var(--okB));border-color:var(--okB)}
    .choice-item.selected .radio-circle::after{opacity:1;transform:scale(1)}

    /* –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã –¥–ª—è –º—É–ª—å—Ç–∏–≤—ã–±–æ—Ä–∞ */
    .check-square{width:22px;height:22px;border-radius:6px;border:2px solid rgba(255,255,255,.65);display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s ease;background:transparent}
    .check-square::after{content:"";width:12px;height:12px;border-radius:3px;background:#fff;opacity:0;transform:scale(.7);transition:all .2s ease}
    .choice-item.selected .check-square{background:linear-gradient(135deg,var(--okA),var(--okB));border-color:var(--okB)}
    .choice-item.selected .check-square::after{opacity:1;transform:scale(1)}

    /* –û—Ç–¥–µ–ª—å–Ω—ã–π —á–µ–∫–±–æ–∫—Å ¬´–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö¬ª */
    .check{display:inline-flex;align-items:center;gap:10px;cursor:pointer;user-select:none}
    .check .check-square{width:22px;height:22px}
    .check .check-label{font-weight:700;letter-spacing:.2px}
    .check.checked .check-square{background:linear-gradient(135deg,var(--okA),var(--okB));border-color:var(--okB)}
    .check.checked .check-square::after{opacity:1;transform:scale(1)}

    /* –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è */
    .actions{padding:16px;display:flex;justify-content:center}
    .primary-btn{display:inline-flex;align-items:center;gap:10px;padding:12px 18px;border:0;border-radius:12px;font-weight:800;background:linear-gradient(135deg,var(--okA),var(--okB));box-shadow:var(--shadow);cursor:pointer;transition:transform .15s ease,opacity .2s ease,color .2s ease}
    .primary-btn:hover{transform:translateY(-1px)}
    .primary-btn:active{transform:translateY(0)}
    .primary-btn[disabled]{opacity:.7;cursor:default}
    .primary-btn .spinner{width:16px;height:16px;border:2px solid rgba(255,255,255,.6);border-top-color:#fff;border-radius:50%;display:none}
    .primary-btn.loading .spinner{display:inline-block;animation:spin .9s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .bump{animation:bump .08s ease}
    @keyframes bump{0%{transform:scale(1)}50%{transform:scale(0.98)}100%{transform:scale(1)}}
  </style>
</head>
<body>
  <div class="container">
    <div class="section">
      <div class="section-h" onclick="toggleSection(this)">
        <h2>–ê–Ω–∫–µ—Ç–∞</h2>
        <div class="toggle" aria-hidden="true">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M8 10l4 4 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
      </div>
      <div class="section-content">
        <!-- 1) –ü–æ–ª -->
        <div class="field">
          <div class="row"><div class="label">–ü–æ–ª</div></div>
          <div class="binary-choice" role="group" aria-label="–ü–æ–ª">
            <button class="binary-btn" data-field="gender" data-value="male" aria-pressed="false">–ú—É–∂—Å–∫–æ–π</button>
            <button class="binary-btn" data-field="gender" data-value="female" aria-pressed="false">–ñ–µ–Ω—Å–∫–∏–π</button>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 2) –í–æ–∑—Ä–∞—Å—Ç -->
        <div class="field">
          <div class="row"><div class="label">–í–æ–∑—Ä–∞—Å—Ç</div><div class="unit">–ª–µ—Ç</div></div>
          <div class="duo" id="age-wheel" aria-label="–í–æ–∑—Ä–∞—Å—Ç (—Ü–µ–ª—ã–µ)">
            <div class="col col-int"></div>
          </div>
          <div class="help">—Ü–µ–ª—ã–µ —á–∏—Å–ª–∞</div>
        </div>

        <!-- 3) –†–æ—Å—Ç -->
        <div class="field">
          <div class="row"><div class="label">–†–æ—Å—Ç</div><div class="unit">—Å–º</div></div>
          <div class="duo" id="height-wheel" aria-label="–†–æ—Å—Ç (—Å–º: —Ü–µ–ª—ã–µ –∏ –¥–µ—Å—è—Ç—ã–µ)">
            <div class="col col-int"></div>
            <div class="sep">,</div>
            <div class="col col-frac"></div>
          </div>
          <div class="help">—Å–º: —Ü–µ–ª—ã–µ –∏ –¥–µ—Å—è—Ç—ã–µ</div>
        </div>

        <!-- 4) –í–µ—Å -->
        <div class="field">
          <div class="row"><div class="label">–í–µ—Å</div><div class="unit">–∫–≥</div></div>
          <div class="duo" id="weight-wheel" aria-label="–í–µ—Å (–∫–≥: —Ü–µ–ª—ã–µ –∏ –¥–µ—Å—è—Ç—ã–µ)">
            <div class="col col-int"></div>
            <div class="sep">,</div>
            <div class="col col-frac"></div>
          </div>
          <div class="help">–∫–≥: —Ü–µ–ª—ã–µ –∏ –¥–µ—Å—è—Ç—ã–µ</div>
        </div>

        <!-- 5) % –ñ–∏—Ä–∞ + —á–µ–∫–±–æ–∫—Å –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö -->
        <div class="field">
          <div class="row"><div class="label">–ü—Ä–æ—Ü–µ–Ω—Ç –∂–∏—Ä–∞</div><div class="unit">%</div></div>
          <div class="duo" id="fat-wheel" aria-label="–ü—Ä–æ—Ü–µ–Ω—Ç –∂–∏—Ä–∞ (—Ü–µ–ª—ã–µ –∏ –¥–µ—Å—è—Ç—ã–µ)">
            <div class="col col-int"></div>
            <div class="sep">,</div>
            <div class="col col-frac"></div>
          </div>
          <div class="optline">
            <label class="check" id="bf-none-wrap">
              <input type="checkbox" id="bf-none" hidden />
              <span class="check-square" aria-hidden="true"></span>
              <span class="check-label">–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
            </label>
          </div>
        </div>

        <!-- 7) –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ -->
        <div class="field" id="sec-bodycomp" style="display:none">
          <div class="row"><div class="label">–í–∏–∑—É–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Ç–µ–ª–∞</div></div>
          <div class="choice-list" data-type="single" data-field="body_comp" role="radiogroup" aria-label="–í–∏–∑—É–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Ç–µ–ª–∞">
            <div class="choice-item" role="radio" aria-checked="false" data-value="very_low"><div class="radio-circle"></div><span class="label">–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –∂–∏—Ä–∞ (–ø—Ä–µ—Å—Å, –≤–µ–Ω—ã, —Ä–µ–ª—å–µ—Ñ)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="athletic"><div class="radio-circle"></div><span class="label">–ê—Ç–ª–µ—Ç–∏—á–Ω–æ–µ (–ø–ª–æ—Å–∫–∏–π –∂–∏–≤–æ—Ç, –≤–∏–¥–Ω–∞ –º—É—Å–∫—É–ª–∞—Ç—É—Ä–∞)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="average"><div class="radio-circle"></div><span class="label">–°—Ä–µ–¥–Ω–µ–µ (–Ω–µ–±–æ–ª—å—à–æ–π –∂–∏–≤–æ—Ç)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="overweight"><div class="radio-circle"></div><span class="label">–ò–∑–±—ã—Ç–æ—á–Ω—ã–π –≤–µ—Å (–∑–∞–º–µ—Ç–Ω—ã–π –∂–∏–≤–æ—Ç)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="obesity"><div class="radio-circle"></div><span class="label">–û–∂–∏—Ä–µ–Ω–∏–µ</span></div>
          </div>
          <div class="help">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –≤ % –∂–∏—Ä–∞ –≤—ã–±—Ä–∞–Ω–æ ¬´–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö¬ª</div>
        </div>
        
        <!-- 6) –≠—Ç–Ω–∏—á–Ω–æ—Å—Ç—å -->
        <div class="field">
          <div class="row"><div class="label">–≠—Ç–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å</div></div>
          <div class="choice-list" data-type="single" data-field="ethnicity" role="radiogroup" aria-label="–≠—Ç–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å">
            <div class="choice-item" role="radio" aria-checked="false" data-value="european_mixed"><div class="radio-circle"></div><span class="label">–ï–≤—Ä–æ–ø–µ–æ–∏–¥–Ω–∞—è –∏–ª–∏ –°–º–µ—à–∞–Ω–Ω–∞—è</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="asian"><div class="radio-circle"></div><span class="label">–ê–∑–∏–∞—Ç—Å–∫–∞—è (–í–æ—Å—Ç–æ—á–Ω–∞—è –∏–ª–∏ –Æ–≥–æ-–í–æ—Å—Ç–æ—á–Ω–∞—è –ê–∑–∏—è)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="african"><div class="radio-circle"></div><span class="label">–ê—Ñ—Ä–∏–∫–∞–Ω—Å–∫–∞—è</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="prefer_not_to_say"><div class="radio-circle"></div><span class="label">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 8) –¢–∏–ø —Ä–∞–±–æ—Ç—ã/—É—á—ë–±—ã -->
        <div class="field">
          <div class="row"><div class="label">–¢–∏–ø –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏–ª–∏ —É—á—ë–±—ã</div></div>
          <div class="choice-list" data-type="single" data-field="job_type" role="radiogroup" aria-label="–¢–∏–ø –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏–ª–∏ —É—á—ë–±—ã">
            <div class="choice-item" role="radio" aria-checked="false" data-value="sedentary"><div class="radio-circle"></div><span class="label">–°–∏–¥—è—á–∞—è (–æ—Ñ–∏—Å, –≤–æ–¥–∏—Ç–µ–ª—å, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="moderately_active"><div class="radio-circle"></div><span class="label">–£–º–µ—Ä–µ–Ω–Ω–æ –∞–∫—Ç–∏–≤–Ω–∞—è (—É—á–∏—Ç–µ–ª—å, –ø—Ä–æ–¥–∞–≤–µ—Ü, –≤—Ä–∞—á)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="physically_active"><div class="radio-circle"></div><span class="label">–ê–∫—Ç–∏–≤–Ω–∞—è —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è (—Å—Ç—Ä–æ–∏—Ç–µ–ª—å, –∫—É—Ä—å–µ—Ä)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="very_heavy"><div class="radio-circle"></div><span class="label">–û—á–µ–Ω—å —Ç—è–∂—ë–ª–∞—è (—à–∞—Ö—Ç—ë—Ä, –ø—Ä–æ—Ñ. —Å–ø–æ—Ä—Ç)</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 9) –®–∞–≥–∏ -->
        <div class="field">
          <div class="row"><div class="label">–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –≤ –¥–µ–Ω—å</div></div>
          <div class="choice-list" data-type="single" data-field="steps_per_day" role="radiogroup" aria-label="–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –≤ –¥–µ–Ω—å">
            <div class="choice-item" role="radio" aria-checked="false" data-value="lt_3000"><div class="radio-circle"></div><span class="label">–ú–µ–Ω–µ–µ 3000</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="3000_4999"><div class="radio-circle"></div><span class="label">3000 –¥–æ 4999</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="5000_7999"><div class="radio-circle"></div><span class="label">5000 –¥–æ 7999</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="8000_9999"><div class="radio-circle"></div><span class="label">8000 –¥–æ 9999</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="gt_10000"><div class="radio-circle"></div><span class="label">–ë–æ–ª–µ–µ 10000</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 10) –ß–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ -->
        <div class="field">
          <div class="row"><div class="label">–ß–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)</div></div>
          <div class="choice-list" data-type="single" data-field="workouts_per_week" role="radiogroup" aria-label="–ß–∞—Å—Ç–æ—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)">
            <div class="choice-item" role="radio" aria-checked="false" data-value="none"><div class="radio-circle"></div><span class="label">–ù–µ —Ç—Ä–µ–Ω–∏—Ä—É—é—Å—å</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="1_2"><div class="radio-circle"></div><span class="label">1 –¥–æ 2 —Ä–∞–∑–∞</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="3_4"><div class="radio-circle"></div><span class="label">3 –¥–æ 4 —Ä–∞–∑–∞</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="5_6"><div class="radio-circle"></div><span class="label">5 –¥–æ 6 —Ä–∞–∑</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="7_plus"><div class="radio-circle"></div><span class="label">7 —Ä–∞–∑ –∏ –±–æ–ª–µ–µ</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 11) –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
        <div class="field">
          <div class="row"><div class="label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–º–∏–Ω—É—Ç—ã)</div></div>
          <div class="choice-list" data-type="single" data-field="workout_duration" role="radiogroup" aria-label="–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–º–∏–Ω—É—Ç—ã)">
            <div class="choice-item" role="radio" aria-checked="false" data-value="none"><div class="radio-circle"></div><span class="label">–ù–µ —Ç—Ä–µ–Ω–∏—Ä—É—é—Å—å</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="lt_30"><div class="radio-circle"></div><span class="label">–ú–µ–Ω–µ–µ 30 –º–∏–Ω—É—Ç</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="30_45"><div class="radio-circle"></div><span class="label">30 –¥–æ 45 –º–∏–Ω—É—Ç</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="45_60"><div class="radio-circle"></div><span class="label">45 –¥–æ 60 –º–∏–Ω—É—Ç</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="60_90"><div class="radio-circle"></div><span class="label">60 –¥–æ 90 –º–∏–Ω—É—Ç</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="gt_90"><div class="radio-circle"></div><span class="label">–ë–æ–ª–µ–µ 90 –º–∏–Ω—É—Ç</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 12) –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å -->
        <div class="field">
          <div class="row"><div class="label">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div></div>
          <div class="choice-list" data-type="single" data-field="workout_intensity" role="radiogroup" aria-label="–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫">
            <div class="choice-item" role="radio" aria-checked="false" data-value="none"><div class="radio-circle"></div><span class="label">–ù–µ —Ç—Ä–µ–Ω–∏—Ä—É—é—Å—å</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="low"><div class="radio-circle"></div><span class="label">–ù–∏–∑–∫–∞—è (–π–æ–≥–∞, —Ä–∞—Å—Ç—è–∂–∫–∞, —Ö–æ–¥—å–±–∞)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="moderate"><div class="radio-circle"></div><span class="label">–£–º–µ—Ä–µ–Ω–Ω–∞—è (—Å–∏–ª–æ–≤—ã–µ —Å—Ä–µ–¥–Ω–µ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏, –¥–∂–æ–≥–≥–∏–Ω–≥)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="high"><div class="radio-circle"></div><span class="label">–í—ã—Å–æ–∫–∞—è (–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ —Å–∏–ª–æ–≤—ã–µ, –±–µ–≥, –∫—Ä–æ—Å—Å—Ñ–∏—Ç, HIIT)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="pro"><div class="radio-circle"></div><span class="label">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ø–æ—Ä—Ç (2 –∏ –±–æ–ª–µ–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –¥–µ–Ω—å)</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 13) NEAT -->
        <div class="field">
          <div class="row"><div class="label">–£—Ä–æ–≤–µ–Ω—å —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (NEAT)</div></div>
          <div class="choice-list" data-type="single" data-field="neat_level" role="radiogroup" aria-label="–£—Ä–æ–≤–µ–Ω—å —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (NEAT)">
            <div class="choice-item" role="radio" aria-checked="false" data-value="low"><div class="radio-circle"></div><span class="label">–ù–∏–∑–∫–∏–π (—Å–∏–∂—É —Å–ø–æ–∫–æ–π–Ω–æ, –º–∞–ª–æ –¥–≤–∏–≥–∞—é—Å—å –¥–æ–º–∞)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="medium"><div class="radio-circle"></div><span class="label">–°—Ä–µ–¥–Ω–∏–π (–æ–±—ã—á–Ω–∞—è –±—ã—Ç–æ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="high"><div class="radio-circle"></div><span class="label">–í—ã—Å–æ–∫–∏–π (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤ –¥–≤–∏–∂–µ–Ω–∏–∏, —Å—É–µ—Ç–ª–∏–≤, –º–Ω–æ–≥–æ –¥–µ–ª)</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 14) –°–æ–Ω -->
        <div class="field">
          <div class="row"><div class="label">–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–Ω–∞ (—á–∞—Å–æ–≤ –≤ –Ω–æ—á—å)</div></div>
          <div class="choice-list" data-type="single" data-field="sleep_hours" role="radiogroup" aria-label="–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–Ω–∞ (—á–∞—Å–æ–≤ –≤ –Ω–æ—á—å)">
            <div class="choice-item" role="radio" aria-checked="false" data-value="h7_9"><div class="radio-circle"></div><span class="label">7 –¥–æ 9 —á–∞—Å–æ–≤</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="h6_7"><div class="radio-circle"></div><span class="label">6 –¥–æ 7 —á–∞—Å–æ–≤</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="lt_6"><div class="radio-circle"></div><span class="label">–ú–µ–Ω–µ–µ 6 —á–∞—Å–æ–≤</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="gt_9"><div class="radio-circle"></div><span class="label">–ë–æ–ª–µ–µ 9 —á–∞—Å–æ–≤</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 15) –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Å–∞ -->
        <div class="field">
          <div class="row"><div class="label">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ—Å–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤)</div></div>
          <div class="choice-list" data-type="single" data-field="weight_history" role="radiogroup" aria-label="–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ—Å–∞">
            <div class="choice-item" role="radio" aria-checked="false" data-value="stable"><div class="radio-circle"></div><span class="label">–í–µ—Å —Å—Ç–∞–±–∏–ª–µ–Ω (¬±2 –∫–≥)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="loss_3_5_deficit"><div class="radio-circle"></div><span class="label">–ü–æ—Ç–µ—Ä—è –≤–µ—Å–∞ 3 –¥–æ 5 –∫–≥ –Ω–∞ –¥–µ—Ñ–∏—Ü–∏—Ç–µ</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="loss_gt5_deficit"><div class="radio-circle"></div><span class="label">–ü–æ—Ç–µ—Ä—è –≤–µ—Å–∞ –±–æ–ª–µ–µ 5 –∫–≥ –Ω–∞ –¥–µ—Ñ–∏—Ü–∏—Ç–µ</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="long_lowcal"><div class="radio-circle"></div><span class="label">–ü–æ—Å–ª–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∏–∑–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω–æ–π –¥–∏–µ—Ç—ã (–±–æ–ª–µ–µ 3 –º–µ—Å—è—Ü–µ–≤)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="gain_gt5"><div class="radio-circle"></div><span class="label">–ù–∞–±–æ—Ä –≤–µ—Å–∞ –±–æ–ª–µ–µ 5 –∫–≥</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 16) –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å -->
        <div class="field">
          <div class="row"><div class="label">–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å</div></div>
          <div class="choice-list" data-type="single" data-field="main_goal" role="radiogroup" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å">
            <div class="choice-item" role="radio" aria-checked="false" data-value="fat_loss"><div class="radio-circle"></div><span class="label">–°–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞ (–∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ)</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="maintenance"><div class="radio-circle"></div><span class="label">–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤–µ—Å–∞</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="muscle_gain"><div class="radio-circle"></div><span class="label">–ù–∞–±–æ—Ä –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="recomposition"><div class="radio-circle"></div><span class="label">–†–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è (—Å–Ω–∏–∂–µ–Ω–∏–µ –∂–∏—Ä–∞ –∏ —Ä–æ—Å—Ç –º—ã—à—Ü)</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 17) –¢–µ–º–ø -->
        <div class="field">
          <div class="row"><div class="label">–¢–µ–º–ø –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏</div></div>
          <div class="choice-list" data-type="single" data-field="goal_pace" role="radiogroup" aria-label="–¢–µ–º–ø –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏">
            <div class="choice-item" role="radio" aria-checked="false" data-value="slow"><div class="radio-circle"></div><span class="label">–ú–µ–¥–ª–µ–Ω–Ω—ã–π</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="moderate"><div class="radio-circle"></div><span class="label">–£–º–µ—Ä–µ–Ω–Ω—ã–π</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="fast"><div class="radio-circle"></div><span class="label">–ë—ã—Å—Ç—Ä—ã–π</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 19) –ó–∞–±–æ–ª–µ–≤–∞–Ω–∏—è (–º—É–ª—å—Ç–∏–≤—ã–±–æ—Ä) -->
        <div class="field">
          <div class="row"><div class="label">–•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è <span class="unit" style="opacity:.9">(–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</span></div></div>
          <div class="choice-list" data-type="multiple" data-field="chronic_conditions" role="group" aria-label="–•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è">
            <div class="choice-item" role="checkbox" aria-checked="false" data-value="none"><div class="check-square"></div><span class="label">–ù–µ—Ç</span></div>
            <div class="choice-item" role="checkbox" aria-checked="false" data-value="t2d_ir"><div class="check-square"></div><span class="label">–î–∏–∞–±–µ—Ç 2 —Ç–∏–ø–∞ –∏–ª–∏ –∏–Ω—Å—É–ª–∏–Ω–æ—Ä–µ–∑–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</span></div>
            <div class="choice-item" role="checkbox" aria-checked="false" data-value="ckd_3_5"><div class="check-square"></div><span class="label">–•–ë–ü (—Å—Ç–∞–¥–∏–∏ 3 –¥–æ 5)</span></div>
            <div class="choice-item" role="checkbox" aria-checked="false" data-value="cvd_htn"><div class="check-square"></div><span class="label">–°–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—ã–µ –∏–ª–∏ –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏—è</span></div>
            <div class="choice-item" role="checkbox" aria-checked="false" data-value="hypothyroid"><div class="check-square"></div><span class="label">–ì–∏–ø–æ—Ç–∏—Ä–µ–æ–∑</span></div>
          </div>
          <div class="help">–ú–æ–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ</div>
        </div>

        <!-- 20) –ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å/–ª–∞–∫—Ç–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∂–µ–Ω—â–∏–Ω) -->
        <div class="field" id="sec-preg" style="display:none">
          <div class="row"><div class="label">–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å –∏–ª–∏ –ª–∞–∫—Ç–∞—Ü–∏—è</div></div>
          <div class="choice-list" data-type="single" data-field="pregnancy_lactation" role="radiogroup" aria-label="–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å –∏–ª–∏ –ª–∞–∫—Ç–∞—Ü–∏—è">
            <div class="choice-item" role="radio" aria-checked="false" data-value="none"><div class="radio-circle"></div><span class="label">–ù–µ—Ç</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="preg_trim1"><div class="radio-circle"></div><span class="label">–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å 1 —Ç—Ä–∏–º–µ—Å—Ç—Ä</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="preg_trim2"><div class="radio-circle"></div><span class="label">–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å 2 —Ç—Ä–∏–º–µ—Å—Ç—Ä</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="preg_trim3"><div class="radio-circle"></div><span class="label">–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å 3 —Ç—Ä–∏–º–µ—Å—Ç—Ä</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="lact_0_6"><div class="radio-circle"></div><span class="label">–õ–∞–∫—Ç–∞—Ü–∏—è 0 –¥–æ 6 –º–µ—Å—è—Ü–µ–≤</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="lact_6_12"><div class="radio-circle"></div><span class="label">–õ–∞–∫—Ç–∞—Ü–∏—è 6 –¥–æ 12 –º–µ—Å—è—Ü–µ–≤</span></div>
          </div>
          <div class="help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç</div>
        </div>

        <!-- 21) –¶–∏–∫–ª -->
        <div class="field" id="sec-cycle" style="display:none">
          <div class="row"><div class="label">–†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω–æ–≥–æ —Ü–∏–∫–ª–∞</div></div>
          <div class="choice-list" data-type="single" data-field="cycle_regular" role="radiog—Ä—É–ø–ø–∞" aria-label="–†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω–æ–≥–æ —Ü–∏–∫–ª–∞">
            <div class="choice-item" role="radio" aria-checked="false" data-value="regular"><div class="radio-circle"></div><span class="label">–†–µ–≥—É–ª—è—Ä–Ω—ã–π —Ü–∏–∫–ª</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="irregular"><div class="radio-circle"></div><span class="label">–ù–µ—Ä–µ–≥—É–ª—è—Ä–Ω—ã–π –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span></div>
            <div class="choice-item" role="radio" aria-checked="false" data-value="menopause"><div class="radio-circle"></div><span class="label">–ú–µ–Ω–æ–ø–∞—É–∑–∞</span></div>
          </div>
          <div class="help">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∂–µ–Ω—â–∏–Ω –±–µ–∑ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏/–ª–∞–∫—Ç–∞—Ü–∏–∏</div>
        </div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div class="actions">
          <button class="primary-btn" id="submit-btn" type="button" aria-live="polite">
            <span class="spinner" aria-hidden="true"></span>
            <span class="label">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
  'use strict';
  /* ============================================================
   *  TMA boot (–∫–∞–∫ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ)
   * ============================================================ */
  const TMA = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;
  try{ TMA && TMA.ready && TMA.ready(); TMA.expand && TMA.expand(); TMA.setHeaderColor && TMA.setHeaderColor('secondary_bg_color'); }catch(_){}

  const hapticImpact = (type='light') => { try{ TMA?.HapticFeedback?.impactOccurred?.(type); }catch(_){/* no-op */} };
  const hapticSelect = () => { try{ TMA?.HapticFeedback?.selectionChanged?.(); }catch(_){/* no-op */} };
  const hapticNotify = (kind='success') => { try{ TMA?.HapticFeedback?.notificationOccurred?.(kind); }catch(_){/* no-op */} };
  const bump = (el) => { if(!el) return; el.classList.remove('bump'); void el.offsetWidth; el.classList.add('bump'); };

  function toggleSection(h){ h.parentElement.classList.toggle('collapsed'); }

  function showPopup(title, message, haptic){
    if (haptic) hapticNotify(haptic);
    const tg = TMA;
    if (tg?.showPopup) { tg.showPopup({ title, message, buttons:[{type:'ok'}] }); }
    else { alert(title + '\n\n' + message); }
  }

  /* ============================================================
   *  –ö–æ–ª—ë—Å–∞ (–∫–∞–∫ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ; –¥–æ–±–∞–≤–ª–µ–Ω–∞ setValue)
   * ============================================================ */
  const pad=4, rowH=36, clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  function opt(t){ const d=document.createElement('div'); d.className='option'; d.textContent=t; return d; }
  function fill(col, from, to){ const f=document.createDocumentFragment(); for(let i=0;i<pad;i++) f.appendChild(opt('')); for(let i=from;i<=to;i++) f.appendChild(opt(i)); for(let i=0;i<pad;i++) f.appendChild(opt('')); col.innerHTML=''; col.appendChild(f); }
  const idx=(col)=>Math.round((col.scrollTop+col.clientHeight/2-rowH/2)/rowH)-pad;
  function setActive(col, idxWithPad){
    if (col._lastActive === idxWithPad) return;
    const prevEl = col.children[col._lastActive];
    if (prevEl) prevEl.classList.remove('active');
    const nextEl = col.children[idxWithPad];
    if (nextEl) nextEl.classList.add('active');
    col._lastActive = idxWithPad;
    try{ hapticSelect(); }catch(_){}
  }
  function snap(col,i){ col.scrollTop=(i+pad)*rowH-col.clientHeight/2+rowH/2; }

  function buildDualWheel(root,min,max,init){
    if(!root) return {get value(){return null}, setDisabled(){}, setValue(){}};
    const intCol=root.querySelector('.col-int'); const fracCol=root.querySelector('.col-frac'); if(!intCol||!fracCol) return {get value(){return null}, setDisabled(){}, setValue(){}};
    const minI=Math.floor(min), maxI=Math.floor(max);
    intCol.dataset.kind='int'; intCol._minInt=minI; intCol._maxInt=maxI; fill(intCol,minI,maxI); fill(fracCol,0,9);
    intCol._lastActive = -1; fracCol._lastActive = -1;
    let curI=0,curF=0, ti=null, tf=null;

    function lock(iVal){
      if(iVal===maxI){
        curF=0;
        fracCol.style.pointerEvents='none';
        fracCol.style.opacity='0.5';
        snap(fracCol,0); setActive(fracCol, pad);
      } else {
        fracCol.style.pointerEvents='auto';
        fracCol.style.opacity='1';
      }
    }
    function updateMarkers(){
      const iI = clamp(idx(intCol),0,maxI-minI);
      const iF = clamp(idx(fracCol),0,9);
      setActive(intCol, iI+pad);
      setActive(fracCol, iF+pad);
      lock(minI+iI);
    }
    function snapToNearest(){
      curI = clamp(idx(intCol),0,maxI-minI);
      curF = clamp(idx(fracCol),0,9);
      const iVal = minI+curI;
      if (iVal===maxI) curF=0;
      snap(intCol,curI); snap(fracCol,curF);
      setActive(intCol, curI+pad);
      setActive(fracCol, curF+pad);
      lock(iVal);
    }
    function onScroll(col, which){
      if (col._raf) return;
      col._raf = requestAnimationFrame(()=>{ col._raf = 0; updateMarkers(); });
      if (which==='i'){ clearTimeout(ti); ti=setTimeout(snapToNearest,120); }
      else { clearTimeout(tf); tf=setTimeout(snapToNearest,120); }
    }
    intCol.addEventListener('scroll',()=>onScroll(intCol,'i'),{passive:true});
    fracCol.addEventListener('scroll',()=>onScroll(fracCol,'f'),{passive:true});

    function setValue(v){
      const cl = clamp(+v, min, max);
      const iVal = Math.trunc(cl);
      let f = Math.round((cl - iVal)*10);
      if (iVal===maxI) f=0;
      curI = clamp(iVal - minI, 0, maxI-minI);
      curF = clamp(f, 0, 9);
      snap(intCol,curI); snap(fracCol,curF);
      setActive(intCol, curI+pad); setActive(fracCol, curF+pad);
      lock(iVal);
    }

    requestAnimationFrame(()=>{
      const iI=clamp(Math.floor(init)-minI,0,maxI-minI);
      const iF=clamp(Math.round((init-Math.floor(init))*10),0,9);
      setValue(minI+iI + iF/10);
    });

    return {
      get value(){ return +((minI+curI)+(curF/10)).toFixed(1); },
      setDisabled(dis){ root.classList.toggle('disabled',!!dis); },
      setValue
    };
  }

  function buildIntWheel(root,min,max,init){
    if(!root) return {get value(){return null}, setDisabled(){}, setValue(){}};
    const col=root.querySelector('.col-int'); if(!col) return {get value(){return null}, setDisabled(){}, setValue(){}};
    const minI=Math.floor(min),maxI=Math.floor(max);
    col.dataset.kind='int'; col._minInt=minI; col._maxInt=maxI; fill(col,minI,maxI); col._lastActive = -1;
    let cur=0, t=null;

    function updateMarkers(){ const i=clamp(idx(col),0,maxI-minI); setActive(col, i+pad); }
    function snapToNearest(){ cur=clamp(idx(col),0,maxI-minI); snap(col,cur); setActive(col, cur+pad); }
    function setValue(v){
      const cl = clamp(Math.floor(+v), minI, maxI);
      cur = cl - minI; snap(col,cur); setActive(col, cur+pad);
    }

    col.addEventListener('scroll',()=>{
      if (!col._raf) { col._raf = requestAnimationFrame(()=>{ col._raf=0; updateMarkers(); }); }
      clearTimeout(t); t=setTimeout(snapToNearest,120);
    },{passive:true});

    requestAnimationFrame(()=>{ setValue(init); });
    return {
      get value(){return (minI+cur)|0;},
      setDisabled(dis){ root.classList.toggle('disabled',!!dis); },
      setValue
    }
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–ª—ë—Å
  const WHEELS={
    age:    buildIntWheel(document.getElementById('age-wheel'),    14, 90, 25),
    height: buildDualWheel(document.getElementById('height-wheel'), 120, 230, 175.0),
    weight: buildDualWheel(document.getElementById('weight-wheel'), 35, 250, 70.0),
    fat:    buildDualWheel(document.getElementById('fat-wheel'),    0, 60, 18.0)
  };
  window.WHEELS = WHEELS;

  /* ============================================================
   *  –í—ã–±–æ—Ä–∫–∏/–∫–ª–∏–∫–∏
   * ============================================================ */
  document.addEventListener('pointerdown', (e)=>{
    const el = e.target.closest('.binary-btn, .choice-item, #bf-none-wrap, #submit-btn');
    if (!el) return; hapticImpact('light'); bump(el);
  }, {passive:true});

  document.addEventListener('click', (e)=>{
    const bbtn = e.target.closest('.binary-btn');
    if (bbtn){
      const field = bbtn.dataset.field;
      document.querySelectorAll(`[data-field="${field}"]`).forEach(b=>{ b.classList.remove('active'); b.setAttribute('aria-pressed','false'); });
      bbtn.classList.add('active'); bbtn.setAttribute('aria-pressed','true');
      hapticSelect(); updateCycleVisibility(); return;
    }
    const item = e.target.closest('.choice-item');
    if (item){
      const list = item.closest('.choice-list'); if (!list) return;
      if (list.dataset.type === 'single'){
        list.querySelectorAll('.choice-item').forEach(i=>{ i.classList.remove('selected'); i.setAttribute('aria-checked','false'); });
        item.classList.add('selected'); item.setAttribute('aria-checked','true'); hapticSelect();
        if (list.dataset.field === 'pregnancy_lactation') updateCycleVisibility();
        return;
      }
      if (list.dataset.type === 'multiple'){
        const nowSel = item.classList.toggle('selected');
        item.setAttribute('aria-checked', nowSel ? 'true' : 'false'); hapticSelect();
        if (list.dataset.field === 'chronic_conditions'){
          if (item.dataset.value === 'none' && nowSel){
            list.querySelectorAll('.choice-item').forEach(i=>{ if(i!==item){ i.classList.remove('selected'); i.setAttribute('aria-checked','false'); } });
          } else if (item.dataset.value !== 'none' && nowSel){
            const noneItem = list.querySelector('.choice-item[data-value="none"]');
            if (noneItem) { noneItem.classList.remove('selected'); noneItem.setAttribute('aria-checked','false'); }
          }
        }
        return;
      }
    }
    const chk = e.target.closest('#bf-none-wrap');
    if (chk){
      const input = chk.querySelector('input');
      input.checked = !input.checked;
      chk.classList.toggle('checked', input.checked);
      const fw = document.getElementById('fat-wheel');
      if (fw) fw.classList.toggle('disabled', input.checked);
      if (WHEELS.fat && WHEELS.fat.setDisabled) WHEELS.fat.setDisabled(input.checked);
      updateBodyCompVisibility(); hapticSelect();
    }
  }, {passive:true});

  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ¬´–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö¬ª
  (function syncFatNone(){
    const fatNone=document.getElementById('bf-none');
    const wrap=document.getElementById('bf-none-wrap');
    const fatWheel=document.getElementById('fat-wheel');
    if (!fatNone) return;
    if (wrap) wrap.classList.toggle('checked', fatNone.checked);
    if (fatWheel) fatWheel.classList.toggle('disabled', fatNone.checked);
    fatNone.addEventListener('change', ()=>{
      const c=fatNone.checked;
      if (wrap) wrap.classList.toggle('checked',c);
      if (fatWheel) fatWheel.classList.toggle('disabled',c);
      if (WHEELS.fat && WHEELS.fat.setDisabled) WHEELS.fat.setDisabled(c);
      updateBodyCompVisibility(); hapticSelect();
    });
  })();

  /* ============================================================
   *  –°—Ç–∞–Ω–¥–∞—Ä—Ç: BACKEND + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ + –∑–∞–≥—Ä—É–∑–∫–∞
   * ============================================================ */
  const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbzSxu39wWxxqFIjeTCmaPTgZEAXLDfxcYjhrSXFSQ0184yDRcyoV1yLkGtheZmYFr6xPw/exec';
  const APP_VERSION  = 'frontend-2025-10-21';
  const REQUEST_TIMEOUT_MS = 15000;

  function nowIso(){ return new Date().toISOString(); }
  function clientTZ(){ try{ return Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC'; } catch{ return 'UTC'; } }
  function todayLocalISO(tz){
    try{
      const d = new Date();
      const y  = new Intl.DateTimeFormat('en-CA',{timeZone:tz,year:'numeric'}).format(d);
      const m  = new Intl.DateTimeFormat('en-CA',{timeZone:tz,month:'2-digit'}).format(d);
      const da = new Intl.DateTimeFormat('en-CA',{timeZone:tz,day:'2-digit'}).format(d);
      return `${y}-${m}-${da}`;
    }catch{ return new Date().toISOString().slice(0,10); }
  }
  function genSaveId(){ return Date.now() + '_' + Math.random().toString(36).slice(2,10); }

  async function saveMeasurementsToDB(values){
    if (!values || typeof values !== 'object') throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.');
    const tg       = TMA;
    const tz       = clientTZ();
    const dayLocal = todayLocalISO(tz);
    const payload = {
      action: 'save',
      init_data: String(tg?.initData || ''),
      tz, client_day_local: dayLocal,
      locale: tg?.initDataUnsafe?.user?.language_code || '',
      source: 'webapp', app_version: APP_VERSION,
      t_client: nowIso(), save_id: genSaveId(),
      data: values
    };

    const controller = new AbortController();
    const t = setTimeout(() => controller.abort(), REQUEST_TIMEOUT_MS);
    let resp, raw, json = null;
    try {
      resp = await fetch(BACKEND_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=UTF-8' },
        body: JSON.stringify(payload),
        redirect: 'follow', cache: 'no-store', credentials: 'omit', mode: 'cors',
        signal: controller.signal
      });
      raw = await resp.text();
      try { json = raw ? JSON.parse(raw) : null; } catch {}
    } catch (err) {
      if (err && err.name === 'AbortError') { const e = new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –≤–æ–≤—Ä–µ–º—è'); e.code = 408; throw e; }
      throw err;
    } finally { clearTimeout(t); }

    const isRateLimited =
      resp?.status === 429 ||
      (json && (json.code === 429 || json.status === 429)) ||
      /(?:too\s*many\s*requests|rate[-_\s]*limit|429|—Å–ª–∏—à–∫–æ–º\s+—á–∞—Å—Ç–æ)/i.test(
        String(json?.error || raw || resp?.statusText || '')
      );
    if (!resp?.ok || !json || json.ok !== true) {
      const msg = (json && json.error) ? json.error : `HTTP ${resp?.status ?? '0'} ${resp?.statusText ?? ''}`.trim();
      if (isRateLimited) { const e = new Error('Too many requests'); e.code = 429; throw e; }
      if (msg === 'timeout' || /timeout|network/i.test(String(msg))) { const e = new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –≤–æ–≤—Ä–µ–º—è'); e.code = 408; throw e; }
      const e = new Error(msg || 'Save failed'); e.code = resp?.status ?? 0; throw e;
    }
    return {
      ok: true,
      day_local: json.day_local,
      ts_iso:    json.ts_iso,
      row_all:   Number(json.row_all),
      row_calc:  Number(json.row_calc)
    };
  }

  async function apiLastInputs(){
    const payload = { action:'user_last_inputs', init_data: String(TMA?.initData || '') };
    const controller = new AbortController();
    const t = setTimeout(()=>controller.abort(), REQUEST_TIMEOUT_MS);
    let resp, raw, json=null;
    try{
      resp = await fetch(BACKEND_URL, {
        method:'POST',
        headers:{'Content-Type':'text/plain;charset=UTF-8'},
        body:JSON.stringify(payload),
        cache:'no-store', credentials:'omit', mode:'cors',
        signal: controller.signal
      });
      raw = await resp.text();
      try{ json = raw ? JSON.parse(raw) : null; }catch(_){}
    } finally { clearTimeout(t); }
    if (!resp?.ok || !json || json.ok !== true) throw new Error(json?.error || `HTTP ${resp?.status||0}`);
    return json; // { ok:true, found:boolean, inputs:{...} }
  }

  /* ============================================================
   *  –ö—É–ª–¥–∞—É–Ω (–∫–∞–∫ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ)
   * ============================================================ */
  var SAVE_IN_PROGRESS = false;
  var COOLDOWN_MS = 60000;
  var COOLDOWN_KEY = 'questionnaire:save_unlock_time';
  function getUnlockTime(){ try { return Number(localStorage.getItem(COOLDOWN_KEY)) || 0; } catch(_) { return 0; } }
  function setUnlockTime(time){ try { localStorage.setItem(COOLDOWN_KEY, String(time)); } catch(_){} }
  function canSaveNow(){ if (SAVE_IN_PROGRESS) return false; var now = Date.now(); return !(getUnlockTime() > now); }

  /* ============================================================
   *  –°–±–æ—Ä/–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
   * ============================================================ */
  function pickSingle(field){ return document.querySelector(`.choice-list[data-field="${field}"] .choice-item.selected`)?.dataset.value || null; }
  function pickMultiple(field){
    return [...document.querySelectorAll(`.choice-list[data-field="${field}"] .choice-item.selected`)]
      .map(i=>i.dataset.value);
  }
  function collectValues(){
    const genderBtn=document.querySelector('.binary-btn.active');
    const fatNone=document.getElementById('bf-none');
    return {
      gender:genderBtn?genderBtn.dataset.value:null,
      age:WHEELS.age.value,
      height_cm:WHEELS.height.value,
      weight_kg:WHEELS.weight.value,
      bodyfat_pct:(fatNone && fatNone.checked)?null:WHEELS.fat.value,
      ethnicity:pickSingle('ethnicity'),
      body_comp:pickSingle('body_comp'),
      job_type:pickSingle('job_type'),
      steps_per_day:pickSingle('steps_per_day'),
      workouts_per_week:pickSingle('workouts_per_week'),
      workout_duration:pickSingle('workout_duration'),
      workout_intensity:pickSingle('workout_intensity'),
      neat_level:pickSingle('neat_level'),
      sleep_hours:pickSingle('sleep_hours'),
      weight_history:pickSingle('weight_history'),
      main_goal:pickSingle('main_goal'),
      goal_pace:pickSingle('goal_pace'),
      chronic_conditions:pickMultiple('chronic_conditions'),
      pregnancy_lactation:pickSingle('pregnancy_lactation'),
      cycle_regular:(document.getElementById('sec-cycle').style.display==='none') ? null : pickSingle('cycle_regular')
    };
  }

  function setBinary(field, value){
    if (!value) return;
    document.querySelectorAll(`.binary-btn[data-field="${field}"]`).forEach(b=>{
      const is = b.dataset.value===value;
      b.classList.toggle('active', is);
      b.setAttribute('aria-pressed', is ? 'true' : 'false');
    });
  }
  function setSingle(field, value){
    if (typeof value!=='string' || !value) return;
    const list = document.querySelector(`.choice-list[data-field="${field}"]`); if(!list) return;
    list.querySelectorAll('.choice-item').forEach(i=>{
      const is = i.dataset.value===value;
      i.classList.toggle('selected', is);
      i.setAttribute('aria-checked', is ? 'true' : 'false');
    });
  }
  function setMultiple(field, arr){
    if (!Array.isArray(arr)) return;
    const list = document.querySelector(`.choice-list[data-field="${field}"]`); if(!list) return;
    const set = new Set(arr);
    list.querySelectorAll('.choice-item').forEach(i=>{
      const is = set.has(i.dataset.value);
      i.classList.toggle('selected', is);
      i.setAttribute('aria-checked', is ? 'true' : 'false');
    });
    // –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–µ–Ω–∏–µ none
    const none = list.querySelector('.choice-item[data-value="none"]');
    if (none){
      if (set.has('none')){
        list.querySelectorAll('.choice-item').forEach(i=>{ if(i!==none){ i.classList.remove('selected'); i.setAttribute('aria-checked','false'); }});
        none.classList.add('selected'); none.setAttribute('aria-checked','true');
      }
    }
  }

  function applyInputsToUI(inputs){
    if (!inputs || typeof inputs!=='object') return;
    try{
      // –±–∏–Ω–∞—Ä–Ω—ã–µ
      setBinary('gender', inputs.gender || null);

      // —á–∏—Å–ª–∞
      if (typeof inputs.age === 'number')      WHEELS.age.setValue(inputs.age);
      if (typeof inputs.height_cm === 'number')WHEELS.height.setValue(inputs.height_cm);
      if (typeof inputs.weight_kg === 'number')WHEELS.weight.setValue(inputs.weight_kg);

      // % –∂–∏—Ä–∞ / –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
      const fatNone = document.getElementById('bf-none');
      const wrap = document.getElementById('bf-none-wrap');
      const fatWheel = document.getElementById('fat-wheel');
      const bf = inputs.bodyfat_pct;
      const isNone = (bf == null);
      if (fatNone){ fatNone.checked = isNone; }
      if (wrap) wrap.classList.toggle('checked', isNone);
      if (fatWheel) fatWheel.classList.toggle('disabled', isNone);
      if (!isNone && typeof bf === 'number') WHEELS.fat.setValue(bf);
      if (WHEELS.fat && WHEELS.fat.setDisabled) WHEELS.fat.setDisabled(isNone);

      // single –≤—ã–±–æ—Ä–∞
      const singles = ['ethnicity','body_comp','job_type','steps_per_day','workouts_per_week','workout_duration','workout_intensity','neat_level','sleep_hours','weight_history','main_goal','goal_pace','pregnancy_lactation','cycle_regular'];
      singles.forEach(k=> setSingle(k, inputs[k] || null));

      // multi
      setMultiple('chronic_conditions', inputs.chronic_conditions || null);

      // –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ UI
      updateCycleVisibility();
      updateBodyCompVisibility();
    }catch(_){}
  }

  /* ============================================================
   *  –û—Ç–ø—Ä–∞–≤–∫–∞
   * ============================================================ */
  (function bindSubmit(){
    const btn=document.getElementById('submit-btn'); if(!btn) return;
    btn.addEventListener('click', async ()=>{
      if(btn.classList.contains('loading')) return;
      if (!canSaveNow()){ showPopup('Too many requests','–ù–µ –Ω—É–∂–Ω–æ —Ç–∞–∫ —á–∞—Å—Ç–æ –Ω–∞–∂–∏–º–∞—Ç—å —ç—Ç—É –∫–Ω–æ–ø–∫—É','error'); return; }

      hapticImpact('light');
      btn.classList.add('loading'); btn.disabled=true;
      btn.setAttribute('aria-busy','true');
      const values = collectValues();

      // –∫–∞–∫ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ: —Å—Ç–∞–≤–∏–º –∫—É–ª–¥–∞—É–Ω —Å—Ä–∞–∑—É
      setUnlockTime(Date.now() + COOLDOWN_MS);
      SAVE_IN_PROGRESS = true;

      try{
        const res = await saveMeasurementsToDB(values);
        // —É—Å–ø–µ—Ö
        btn.classList.remove('loading'); btn.disabled=false; btn.removeAttribute('aria-busy');
        hapticNotify('success');
        showPopup('–ì–æ—Ç–æ–≤–æ','–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.','success');
      }catch(err){
        const msg = String((err && err.message) || err || '');
        btn.classList.remove('loading'); btn.disabled=false; btn.removeAttribute('aria-busy');
        if ((err && err.code === 429) || /too\s*many\s*requests|rate[-_\s]*limit|—Å–ª–∏—à–∫–æ–º\s+—á–∞—Å—Ç–æ|429/i.test(msg)){
          showPopup('Too many requests','–ù–µ –Ω—É–∂–Ω–æ —Ç–∞–∫ —á–∞—Å—Ç–æ –Ω–∞–∂–∏–º–∞—Ç—å —ç—Ç—É –∫–Ω–æ–ø–∫—É','error');
        } else if ((err && err.code === 408) || /timeout/i.test(msg)) {
          showPopup('–ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ (–≤–æ–∑–º–æ–∂–Ω–æ —É—à–ª–æ)','–°–µ—Ä–≤–µ—Ä –Ω–µ —É—Å–ø–µ–ª –æ—Ç–≤–µ—Ç–∏—Ç—å –≤–æ–≤—Ä–µ–º—è. –í–æ–∑–º–æ–∂–Ω–æ, –¥–∞–Ω–Ω—ã–µ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –û—Ç–∫—Ä–æ–π—Ç–µ –∑–∞–Ω–æ–≤–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.','error');
        } else {
          showPopup('–ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ','–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.','error');
        }
      } finally {
        SAVE_IN_PROGRESS = false;
      }
    });
  })();

  /* ============================================================
   *  –í—ã–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ)
   * ============================================================ */
  async function loadLastInputs(){
    try{
      const r = await apiLastInputs();
      if (r && r.found && r.inputs) applyInputsToUI(r.inputs);
    }catch(_){
      // –º–æ–ª—á–∞: –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö ‚Äî –æ–∫
    }
  }

  // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –∑–∞–≤–∏—Å—è—â–∏—Ö –±–ª–æ–∫–æ–≤
  function updateCycleVisibility(){
    const isFemale=document.querySelector('.binary-btn.active[data-value="female"]');
    const isMale  =document.querySelector('.binary-btn.active[data-value="male"]');
    const secPreg=document.getElementById('sec-preg');
    const secCycle=document.getElementById('sec-cycle');
    if(!secPreg||!secCycle) return;
    if(isMale){
      secPreg.style.display='none'; secCycle.style.display='none';
      secPreg.querySelectorAll('.choice-item').forEach(i=>{ i.classList.remove('selected'); i.setAttribute('aria-checked','false'); });
      secCycle.querySelectorAll('.choice-item').forEach(i=>{ i.classList.remove('selected'); i.setAttribute('aria-checked','false'); });
      return;
    }
    secPreg.style.display = isFemale ? '' : 'none';
    const preg=document.querySelector('.choice-list[data-field="pregnancy_lactation"] .choice-item.selected')?.dataset.value||null;
    const showCycle=!!isFemale && (preg==='none');
    secCycle.style.display=showCycle?'':'none';
    if(!showCycle){ secCycle.querySelectorAll('.choice-item').forEach(i=>{ i.classList.remove('selected'); i.setAttribute('aria-checked','false'); }); }
  }

  function updateBodyCompVisibility(){
    const sec=document.getElementById('sec-bodycomp');
    const none=document.getElementById('bf-none');
    if(!sec||!none) return;
    const show=!!none.checked;
    sec.style.display=show?'':'none';
    if(!show){ sec.querySelectorAll('.choice-item').forEach(i=>{ i.classList.remove('selected'); i.setAttribute('aria-checked','false'); }); }
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  updateCycleVisibility();
  updateBodyCompVisibility();
  loadLastInputs();

  /* ============================================================
   *  –°–∞–º–æ—Ç–µ—Å—Ç—ã (–∫–∞–∫ –±—ã–ª–æ)
   * ============================================================ */
  function runSelfTests(){
    const assert=(c,m)=>{ if(!c) console.error('[TEST FAIL]',m); else console.log('[TEST OK]',m); };
    assert(!!document.getElementById('submit-btn'),'submit –µ—Å—Ç—å');
    assert(!!document.getElementById('bf-none'),'bf-none –µ—Å—Ç—å');
    const eth = document.querySelector('.choice-list[data-field="ethnicity"] .choice-item');
    if(eth){ eth.click(); assert(eth.classList.contains('selected'),'radio –∫–ª–∏–∫–∞–µ—Ç—Å—è'); }
    const cc = document.querySelector('.choice-list[data-field="chronic_conditions"]');
    if(cc){ const none=cc.querySelector('[data-value="none"]'); const other=cc.querySelector('[data-value]:not([data-value="none"])'); if(none&&other){ other.click(); none.click(); assert(none.classList.contains('selected')&&!other.classList.contains('selected'),'¬´–ù–µ—Ç¬ª —Å–Ω–∏–º–∞–µ—Ç –¥—Ä—É–≥–∏–µ'); } }
    const wrap = document.getElementById('bf-none-wrap');
    if (wrap) {
      const sec = document.getElementById('sec-bodycomp');
      wrap.click(); assert(sec && sec.style.display !== 'none', 'Q7 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º ¬´–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö¬ª');
      wrap.click(); assert(sec && sec.style.display === 'none', 'Q7 —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º ¬´–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö¬ª');
    }
    const maleBtn = document.querySelector('.binary-btn[data-value="male"]');
    const femBtn  = document.querySelector('.binary-btn[data-value="female"]');
    const secPreg = document.getElementById('sec-preg');
    const secCycle= document.getElementById('sec-cycle');
    if (maleBtn && femBtn && secPreg && secCycle){
      maleBtn.click(); assert(secPreg.style.display==='none' && secCycle.style.display==='none','–î–ª—è –º—É–∂—á–∏–Ω 20‚Äì21 —Å–∫—Ä—ã—Ç—ã');
      femBtn.click(); assert(secPreg.style.display!=='none','–î–ª—è –∂–µ–Ω—â–∏–Ω 20 –ø–æ–∫–∞–∑–∞–Ω');
      const pregNone = document.querySelector('.choice-list[data-field="pregnancy_lactation"] .choice-item[data-value="none"]');
      if (pregNone){ pregNone.click(); assert(secCycle.style.display!=='none','21 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ ¬´–ù–µ—Ç¬ª –≤ 20'); }
    }
    return true;
  }
  document.addEventListener('keydown',e=>{ if(e.key.toLowerCase()==='t'){ runSelfTests(); }});
  </script>
</body>
</html>
