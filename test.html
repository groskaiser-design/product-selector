<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Dashboard v2</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  /* === –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï (–ò–∑ —Ç–≤–æ–µ–≥–æ –¥–∏–∑–∞–π–Ω-–∫–æ–¥–∞) === */
  :root {
    --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    
    /* –°—Ç–µ–∫–ª–æ –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    --glass-bg: rgba(255, 255, 255, 0.12);
    --glass-border: rgba(255, 255, 255, 0.25);
    --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
    --blur: 14px;
    
    /* –¶–≤–µ—Ç–∞ */
    --text-primary: #ffffff;
    --text-secondary: rgba(255, 255, 255, 0.75);
    --accent-gradient: linear-gradient(135deg, #fbbf24, #f59e0b);
    
    /* –†–∞–∑–º–µ—Ä—ã */
    --page-padding: 16px;
    --tile-gap: 12px;
    --radius-l: 20px;
    --radius-m: 16px;
    --radius-s: 12px;
  }

  /* === –°–ë–†–û–° === */
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body {
    font-family: var(--font-family);
    background: var(--bg);
    color: var(--text-primary);
    min-height: 100vh;
    /* –§–∏–∫—Å –¥–ª—è iOS —Å–∫—Ä–æ–ª–ª–∞ */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  /* –§–æ–Ω –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω (—á—Ç–æ–±—ã –Ω–µ –¥–µ—Ä–≥–∞–ª—Å—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ) */
  body::before {
    content: ""; position: fixed; inset: 0; 
    background: var(--bg); z-index: -1; pointer-events: none;
  }

  /* === –õ–≠–ô–ê–£–¢ === */
  .page {
    max-width: 560px; margin: 0 auto;
    padding: var(--page-padding);
    padding-bottom: calc(40px + env(safe-area-inset-bottom));
    display: flex; flex-direction: column; gap: 20px;
  }

  /* === 1. –ü–†–û–§–ò–õ–¨ (–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π) === */
  .profile-card {
    display: flex; align-items: center; gap: 14px;
    padding: 12px 16px;
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-l);
    backdrop-filter: blur(var(--blur));
    -webkit-backdrop-filter: blur(var(--blur));
    box-shadow: var(--glass-shadow);
  }
  
  .avatar {
    width: 48px; height: 48px; border-radius: 50%;
    background: rgba(255,255,255,0.2);
    display: flex; align-items: center; justify-content: center;
    font-weight: 700; font-size: 20px; color: #fff;
    overflow: hidden; flex-shrink: 0;
    border: 1px solid rgba(255,255,255,0.3);
  }
  .avatar img { width: 100%; height: 100%; object-fit: cover; }
  
  .profile-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
  .profile-name { font-weight: 700; font-size: 17px; line-height: 1.2; }
  .profile-status { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }
  
  .profile-action {
    width: 36px; height: 36px; border-radius: 10px;
    background: rgba(255,255,255,0.1);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: background .2s;
  }
  .profile-action:active { background: rgba(255,255,255,0.25); }

  /* === 2. –°–ï–¢–ö–ê –ú–ï–ù–Æ (Grid) === */
  .grid-section {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3 –∫–æ–ª–æ–Ω–∫–∏ */
    gap: var(--tile-gap);
  }

  .tile {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: 8px;
    aspect-ratio: 1 / 0.95; /* –ß—É—Ç—å –ø—Ä–∏–ø–ª—é—Å–Ω—É—Ç—ã–µ –∫–≤–∞–¥—Ä–∞—Ç—ã */
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-m);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    cursor: pointer;
    transition: transform 0.1s ease, background 0.2s ease;
  }

  /* –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è (–±–µ–∑ –ø–æ–¥–Ω—è—Ç–∏—è, –ø—Ä–æ—Å—Ç–æ scale down) */
  .tile:active {
    transform: scale(0.96);
    background: rgba(255,255,255,0.18);
  }

  .tile-icon {
    width: 32px; height: 32px;
    display: flex; align-items: center; justify-content: center;
  }
  .tile-icon img { width: 100%; height: 100%; object-fit: contain; }
  /* –§–æ–ª–±—ç–∫ –¥–ª—è –∏–∫–æ–Ω–æ–∫ (—ç–º–æ–¥–∑–∏) */
  .tile-emoji { font-size: 28px; line-height: 1; }

  .tile-label {
    font-size: 12px; font-weight: 600; text-align: center;
    color: var(--text-primary);
    line-height: 1.1;
    padding: 0 4px;
  }

  /* === 3. –°–õ–ê–ô–î–ï–† –í–ò–î–ñ–ï–¢–û–í (Widgets) === */
  .widgets-title {
    font-size: 15px; font-weight: 700; 
    margin-bottom: 10px; padding-left: 4px; opacity: 0.9;
  }

  .widgets-slider {
    display: flex;
    gap: 12px;
    overflow-x: auto;
    padding-bottom: 10px; /* –º–µ—Å—Ç–æ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ (—Ö–æ—Ç—è –º—ã –µ–≥–æ —Å–∫—Ä–æ–µ–º) */
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
    scrollbar-width: none; 
  }
  .widgets-slider::-webkit-scrollbar { display: none; }

  .widget-card {
    flex: 0 0 85%; /* –®–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ (85% —ç–∫—Ä–∞–Ω–∞) */
    scroll-snap-align: center;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: var(--radius-l);
    padding: 16px;
    display: flex; flex-direction: column; gap: 8px;
    position: relative; overflow: hidden;
  }

  /* –¢–∏–ø—ã –≤–∏–¥–∂–µ—Ç–æ–≤ */
  .widget-kbju { background: linear-gradient(180deg, rgba(255,255,255,0.15), rgba(255,255,255,0.08)); }
  .widget-tip { background: rgba(251, 191, 36, 0.15); border-color: rgba(251, 191, 36, 0.3); }
  
  .w-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
  .w-title { font-weight: 700; font-size: 14px; opacity: 0.9; display:flex; align-items:center; gap:6px; }
  .w-value { font-weight: 800; font-size: 14px; }
  
  .progress-bar {
    height: 8px; width: 100%; background: rgba(255,255,255,0.15);
    border-radius: 4px; overflow: hidden; margin-top: 6px;
  }
  .progress-fill {
    height: 100%; background: var(--accent-gradient);
    border-radius: 4px; width: 0%; transition: width 0.5s ease;
  }
  
  .w-text { font-size: 13px; line-height: 1.4; opacity: 0.85; }
  .w-link { font-size: 12px; font-weight: 700; margin-top: 8px; color: #fbbf24; text-transform: uppercase; }

  /* === –°–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ (–¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π) === */
  #loader {
    position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px);
    z-index: 1000; display: none; align-items: center; justify-content: center;
  }
  .spinner {
    width: 32px; height: 32px; border: 3px solid rgba(255,255,255,0.3);
    border-top-color: #fff; border-radius: 50%; animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

</style>
</head>
<body>

  <div id="loader"><div class="spinner"></div></div>

  <div class="page">
    
    <div class="profile-card" id="profileCard">
      <div class="avatar" id="userAvatar">U</div>
      <div class="profile-info">
        <div class="profile-name" id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="profile-status" id="userStatus">ID: ...</div>
      </div>
      <div class="profile-action" onclick="haptic('light'); alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </div>
    </div>

    <div class="grid-section" id="menuGrid">
      </div>

    <div class="widgets-section">
      <div class="widgets-title">–°–≤–æ–¥–∫–∞ &amp; –°–æ–≤–µ—Ç—ã</div>
      <div class="widgets-slider" id="widgetsSlider">
        </div>
    </div>

  </div>

<script>
/* ============================================================
   –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–ü–æ—Ç–æ–º —ç—Ç–æ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∏–∑ Google Sheet)
   ============================================================ */
// –í–µ—Ä—Å–∏—è –∫–æ–Ω—Ñ–∏–≥–∞ (–µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç localStorage ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º)
const DATA_VERSION = 1;

// –°–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é
const APP_MENU = [
  { id: 'kbju',     title: '–ö–ë–ñ–£',       icon: 'ü•ó', link: 'kbju.html' },
  { id: 'measure',  title: '–ó–∞–º–µ—Ä—ã',     icon: 'üìè', link: 'measurements.html' },
  { id: 'diary',    title: '–û—Ç—á—ë—Ç',      icon: 'üìù', link: 'scanner.html' }, // –î–Ω–µ–≤–Ω–∏–∫/–°–∫–∞–Ω–µ—Ä
  { id: 'menu',     title: '–†–∞—Ü–∏–æ–Ω',     icon: 'üçé', link: '#' },
  { id: 'ai',       title: 'AI-–ö–æ—É—á',    icon: 'ü§ñ', link: 'ai.html' },
  { id: 'analyt',   title: '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞',  icon: 'üìä', link: '2.html' },
  { id: 'profile',  title: '–ü—Ä–æ—Ñ–∏–ª—å',    icon: 'üë§', link: '#' },
  { id: 'subs',     title: '–ü–æ–¥–ø–∏—Å–∫–∞',   icon: 'üíé', link: '#' },
  { id: 'manual',   title: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è', icon: '‚ùî', link: '#' } // –ü–æ –∫–ª–∏–∫—É –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Å—Ç–æ—Ä–∏–∑
];

// –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∏–¥–∂–µ—Ç–æ–≤
const APP_WIDGETS = [
  {
    type: 'kbju',
    title: '–°–µ–≥–æ–¥–Ω—è',
    valCurrent: 1250,
    valMax: 2100,
    unit: '–∫–∫–∞–ª'
  },
  {
    type: 'tip',
    title: '–°–æ–≤–µ—Ç –¥–Ω—è',
    text: '–í–∑–≤–µ—à–∏–≤–∞–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã –≤ —Å—É—Ö–æ–º –≤–∏–¥–µ. –ü–æ—Å–ª–µ –≤–∞—Ä–∫–∏ –∫—Ä—É–ø—ã –≤–ø–∏—Ç—ã–≤–∞—é—Ç –≤–æ–¥—É –∏ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –≤–µ—Å –≤ 2-3 —Ä–∞–∑–∞.',
    linkText: '–ß–∏—Ç–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π'
  },
  {
    type: 'info',
    title: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ v2.0',
    text: '–ú—ã –æ–±–Ω–æ–≤–∏–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å! –¢–µ–ø–µ—Ä—å –∑–∞–º–µ—Ä—ã –≥—Ä—É–∑—è—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, –∞ AI-–∫–æ—É—á —Å—Ç–∞–ª —É–º–Ω–µ–µ.',
    linkText: '–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?'
  }
];

/* ============================================================
   –õ–û–ì–ò–ö–ê
   ============================================================ */

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
const tg = window.Telegram?.WebApp;
if (tg) {
  tg.ready();
  tg.expand();
  tg.setHeaderColor('#667eea'); // –ü–æ–¥ —Ü–≤–µ—Ç —Ñ–æ–Ω–∞
  // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞
  tg.BackButton?.hide();
}

// –•–∞–ø—Ç–∏–∫–∞ (–±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
function haptic(style = 'light') {
  try { tg?.HapticFeedback?.impactOccurred(style); } catch(e){}
}

// 1. –†–µ–Ω–¥–µ—Ä –ü—Ä–æ—Ñ–∏–ª—è
function renderProfile() {
  const user = tg?.initDataUnsafe?.user || { first_name: '–ì–æ—Å—Ç—å', id: '---' };
  const nameEl = document.getElementById('userName');
  const statusEl = document.getElementById('userStatus');
  const avatarEl = document.getElementById('userAvatar');

  nameEl.textContent = user.first_name + (user.last_name ? ' ' + user.last_name : '');
  statusEl.textContent = `ID: ${user.id}`;
  
  if (user.photo_url) {
    avatarEl.innerHTML = `<img src="${user.photo_url}" alt="ava">`;
  } else {
    avatarEl.textContent = (user.first_name?.[0] || 'U').toUpperCase();
  }
}

// 2. –†–µ–Ω–¥–µ—Ä –ú–µ–Ω—é (Grid)
function renderMenu() {
  const container = document.getElementById('menuGrid');
  container.innerHTML = '';

  APP_MENU.forEach(item => {
    const tile = document.createElement('div');
    tile.className = 'tile';
    tile.onclick = () => handleMenuClick(item);
    
    // HTML –∏–∫–æ–Ω–∫–∏ (—Å–µ–π—á–∞—Å —ç–º–æ–¥–∑–∏, –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ <img src="${item.iconUrl}">)
    // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å SVG —Ñ–∞–π–ª—ã, –∑–∞–º–µ–Ω–∏ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ –Ω–∞ <img>
    const iconHtml = `<div class="tile-emoji">${item.icon}</div>`;

    tile.innerHTML = `
      <div class="tile-icon">${iconHtml}</div>
      <div class="tile-label">${item.title}</div>
    `;
    container.appendChild(tile);
  });
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –º–µ–Ω—é
function handleMenuClick(item) {
  haptic('light');
  
  if (item.link && item.link !== '#') {
    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞–∂–∞—Ç–∏—è
    setTimeout(() => {
      window.location.href = item.link;
    }, 100);
  } else {
    // –ó–∞–≥–ª—É—à–∫–∞
    tg?.showPopup({ 
        title: '–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 
        message: `–†–∞–∑–¥–µ–ª "${item.title}" —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è!` 
    });
  }
}

// 3. –†–µ–Ω–¥–µ—Ä –í–∏–¥–∂–µ—Ç–æ–≤
function renderWidgets() {
  const container = document.getElementById('widgetsSlider');
  container.innerHTML = '';

  APP_WIDGETS.forEach(w => {
    const card = document.createElement('div');
    card.className = `widget-card widget-${w.type}`;
    
    if (w.type === 'kbju') {
      // –í–∏–¥–∂–µ—Ç –ö–ë–ñ–£ (–ü—Ä–æ–≥—Ä–µ—Å—Å)
      const percent = Math.min(100, (w.valCurrent / w.valMax) * 100);
      card.innerHTML = `
        <div class="w-header">
          <div class="w-title">üî• ${w.title}</div>
          <div class="w-value">${w.valCurrent} / ${w.valMax} ${w.unit}</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${percent}%"></div>
        </div>
      `;
    } else {
      // –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–∏–¥–∂–µ—Ç (–°–æ–≤–µ—Ç / –ò–Ω—Ñ–æ)
      const icon = w.type === 'tip' ? 'üí°' : '‚ÑπÔ∏è';
      card.innerHTML = `
        <div class="w-header">
          <div class="w-title">${icon} ${w.title}</div>
        </div>
        <div class="w-text">${w.text}</div>
        ${w.linkText ? `<div class="w-link">${w.linkText} &rarr;</div>` : ''}
      `;
    }
    
    // –ö–ª–∏–∫ –ø–æ –≤–∏–¥–∂–µ—Ç—É
    card.onclick = () => {
      haptic('medium');
      // –¢—É—Ç –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∏–ª–∏ –º–∞–Ω—É–∞–ª
    };

    container.appendChild(card);
  });
}

/* ============================================================
   –°–ò–°–¢–ï–ú–ê –û–ë–ù–û–í–õ–ï–ù–ò–ô (–ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ)
   ============================================================ */
async function checkUpdates() {
  // 1. –ß–∏—Ç–∞–µ–º –≤–µ—Ä—Å–∏—é –∏–∑ localStorage
  const localVer = localStorage.getItem('app_config_version');
  
  // 2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å DATA_VERSION (–≤ —Ä–µ–∞–ª–µ —Ç—É—Ç –±—É–¥–µ—Ç fetch –∫ Google Script)
  if (localVer != DATA_VERSION) {
    console.log('New version found! Updating UI...');
    // –¢—É—Ç –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ –≤ localStorage
    localStorage.setItem('app_config_version', DATA_VERSION);
    // –ò –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ä–µ–Ω–¥–µ—Ä–∞
  }
}

/* ============================================================
   –ó–ê–ü–£–°–ö
   ============================================================ */
document.addEventListener('DOMContentLoaded', () => {
  renderProfile();
  renderMenu();
  renderWidgets();
  checkUpdates();
});

</script>
</body>
</html>
