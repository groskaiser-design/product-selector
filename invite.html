<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Приглашение</title>

<script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  :root {
    /* --- PALETTE --- */
    --bg-core: #050505;
    --text-main: #ffffff;
    --text-muted: rgba(255, 255, 255, 0.55);
    
    /* --- GLASS SURFACES --- */
    --surface-glass: rgba(255, 255, 255, 0.07);
    --surface-border: rgba(255, 255, 255, 0.1);
    --surface-highlight: rgba(255, 255, 255, 0.25);
    
    /* --- ACCENTS --- */
    --acc-blue: #0a84ff;
    --acc-purple: #5e60ce;

    /* --- METRICS --- */
    --radius-xl: 28px;
    --radius-l: 22px;
    --pad: 16px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
   
  body {
    background-color: var(--bg-core);
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', Roboto, sans-serif;
    color: var(--text-main);
    min-height: 100vh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    display: flex; flex-direction: column;
  }

  /* FX LAYER */
  .fx-layer { position: fixed; inset: 0; z-index: -1; pointer-events: none; }
  .orb { position: absolute; border-radius: 50%; animation: float 30s infinite linear; }
  .orb-1 { width: 90vw; height: 90vw; opacity: 0.4; background: radial-gradient(circle, rgba(108, 92, 231, 0.8) 0%, transparent 70%); top: -20%; left: -20%; }
  .orb-2 { width: 400px; height: 400px; opacity: 0.5; background: radial-gradient(circle, rgba(108, 92, 231, 0.8) 0%, transparent 70%); bottom: -150px; right: -100px; animation: breathe 6s infinite ease-in-out; }
  @keyframes float { 0% {transform:rotate(0deg)} 100% {transform:rotate(360deg)} }
  @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 0.4; } 50% { transform: scale(1.1); opacity: 0.6; } }
  .noise { position: fixed; inset: 0; z-index: -1; opacity: 0.04; background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); pointer-events: none; }

  /* LAYOUT */
  .app-shell {
    max-width: 480px; margin: 0 auto;
    width: 100%;
    padding: var(--pad);
    padding-top: calc(20px + env(safe-area-inset-top));
    padding-bottom: calc(40px + env(safe-area-inset-bottom));
    display: flex; flex-direction: column; gap: 32px;
    flex: 1;
  }

  .page-title { 
    font-size: 28px; font-weight: 800; text-align: center; margin-bottom: 10px; 
    background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.7) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }

  /* QR CARD */
  .qr-card {
    background: linear-gradient(165deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.02) 100%);
    border: 1px solid var(--surface-border);
    border-top: 1px solid var(--surface-highlight);
    border-radius: var(--radius-xl);
    padding: 40px 24px;
    display: flex; flex-direction: column; align-items: center; gap: 24px;
    backdrop-filter: blur(30px);
    box-shadow: 0 12px 32px rgba(0,0,0,0.3);
    text-align: center;
    margin-top: auto; margin-bottom: auto;
  }

  .qr-box {
    background: #fff;
    padding: 20px;
    border-radius: 24px;
    box-shadow: 0 0 40px rgba(255,255,255,0.15);
    display: flex; align-items: center; justify-content: center;
  }

  .qr-text h3 { font-size: 20px; font-weight: 700; margin-bottom: 8px; color: #fff; }
  .qr-text p { font-size: 15px; color: var(--text-muted); line-height: 1.4; max-width: 260px; margin: 0 auto; }

  /* ACTIONS */
  .actions { 
    display: flex; flex-direction: column; align-items: center; gap: 16px; 
    margin-top: auto; 
    padding-bottom: 20px;
  }
  
  .btn {
    min-width: 220px;
    height: 50px;
    border-radius: 100px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; font-weight: 600;
    cursor: pointer; transition: transform 0.1s, opacity 0.2s;
    border: none; outline: none;
    -webkit-backdrop-filter: blur(10px);
  }
  .btn:active { transform: scale(0.96); opacity: 0.8; }
  
  .btn-primary {
    background: linear-gradient(135deg, var(--acc-blue) 0%, #5e60ce 100%);
    color: #fff;
    box-shadow: 0 8px 24px rgba(94, 96, 206, 0.3);
  }
  
  .btn-glass {
    background: rgba(255,255,255,0.08);
    border: 1px solid var(--surface-border);
    color: rgba(255,255,255,0.9);
  }

</style>
</head>
<body>

<div class="fx-layer">
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="noise"></div>
</div>

<div class="app-shell">
  
  <div class="page-title">Приглашение</div>

  <div class="qr-card">
    <div class="qr-box" id="qrcode"></div>
    <div class="qr-text">
      <h3>Личный код</h3>
      <p>Отсканируйте для быстрого доступа к приложению</p>
    </div>
  </div>

  <div class="actions">
    <button class="btn btn-primary" onclick="shareRef()">
      Отправить ссылку
    </button>
    <button class="btn btn-glass" onclick="copyRef()">
      Скопировать
    </button>
  </div>

</div>

<script>
  const tg = window.Telegram.WebApp;
  const BOT_USERNAME = "llmacros_bot";
  
  // Инициализация
  if(tg) {
    tg.ready();
    tg.expand();
    tg.setHeaderColor('#050505'); 
    tg.setBackgroundColor('#050505');
    
    // Включаем системную кнопку НАЗАД и ведем на router.html
    if(tg.BackButton) {
        tg.BackButton.show();
        tg.BackButton.onClick(function() {
            haptic('light'); // Легкая вибрация при нажатии
            window.location.href = 'router.html'; // Жесткий редирект на роутер
        });
    }
  }

  // Получаем ID
  const userId = tg.initDataUnsafe?.user?.id || '12345'; 
  const refLink = `https://t.me/${BOT_USERNAME}?start=ref_${userId}`;

  // Рендер МОДНОГО QR (точки вместо квадратов)
  const qrCode = new QRCodeStyling({
    width: 200,
    height: 200,
    type: "svg",
    data: refLink,
    image: "", 
    dotsOptions: {
        color: "#000000",
        type: "rounded"
    },
    backgroundOptions: {
        color: "#ffffff",
    },
    imageOptions: {
        crossOrigin: "anonymous",
        margin: 10
    },
    cornersSquareOptions: {
        type: "extra-rounded"
    },
    cornersDotOptions: {
        type: "dot"
    }
  });

  qrCode.append(document.getElementById("qrcode"));

  // Функции кнопок
  function shareRef() {
    haptic('medium');
    const msg = "Попробуй это приложение: ";
    const url = `https://t.me/share/url?url=${encodeURIComponent(refLink)}&text=${encodeURIComponent(msg)}`;
    tg.openTelegramLink(url);
  }

  function copyRef() {
    haptic('light');
    navigator.clipboard.writeText(refLink).then(() => {
      tg.showPopup({
        title: 'Готово',
        message: 'Ссылка скопирована',
        buttons: [{type: 'ok'}]
      });
    }).catch(err => console.error(err));
  }

  function haptic(style) {
    if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred(style);
  }

</script>
</body>
</html>
