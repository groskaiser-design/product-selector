<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Macros Referral</title>
<!-- === SMART VERSION CONTROL: –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–µ—Ä—Å–∏–∏ === -->
<script>
// üîî –ö–†–ò–¢–ò–ß–ù–û: —Ñ–∏–∫—Å–∏—Ä—É–µ–º –º–æ–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –í –°–ê–ú–û–ú –ù–ê–ß–ê–õ–ï
window.__pageLoadTime = performance.now();
const APP_HTML_VERSION = 'v2025-0001'; // ‚Üë –º–µ–Ω—è–π –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–ª–∏–∑–µ

(function smartVersionCheck(){
  try{
    const url = new URL(location.href);
    const v = url.searchParams.get('v');
    if (v !== APP_HTML_VERSION){ url.searchParams.set('v', APP_HTML_VERSION); location.replace(url.href); }
  }catch(_){}
})();

// –°–±—Ä–æ—Å –∫—ç—à–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞–∑–∞–¥
window.addEventListener('pageshow', (e)=>{
  try{
    if (e.persisted){
      const url = new URL(location.href);
      url.searchParams.set('v', APP_HTML_VERSION);
      location.replace(url.href);
    }
  }catch(_){}
}, { once:true });
</script>
  
<script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  :root {
    /* --- PALETTE --- */
    --bg-core: #050505;
    --text-main: #ffffff;
    --text-muted: rgba(255, 255, 255, 0.55);
    
    /* --- GLASS SURFACES --- */
    --surface-glass: rgba(255, 255, 255, 0.07);
    --surface-border: rgba(255, 255, 255, 0.1);
    --surface-highlight: rgba(255, 255, 255, 0.25);
    
    /* --- ACCENTS --- */
    --acc-blue: #0a84ff;
    --acc-purple: #5e60ce;

    /* --- METRICS --- */
    --radius-xl: 28px;
    --radius-l: 22px;
    --radius-btn: 20px; /* Squircle */
    --pad: 16px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
   
  body {
    background-color: var(--bg-core);
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', Roboto, sans-serif;
    color: var(--text-main);
    min-height: 100vh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    display: flex; flex-direction: column;
  }

  /* FX LAYER */
  .fx-layer { position: fixed; inset: 0; z-index: -1; pointer-events: none; }
  .orb { position: absolute; border-radius: 50%; animation: float 30s infinite linear; }
  .orb-1 { width: 90vw; height: 90vw; opacity: 0.4; background: radial-gradient(circle, rgba(108, 92, 231, 0.8) 0%, transparent 70%); top: -20%; left: -20%; }
  .orb-2 { width: 400px; height: 400px; opacity: 0.5; background: radial-gradient(circle, rgba(108, 92, 231, 0.8) 0%, transparent 70%); bottom: -150px; right: -100px; animation: breathe 6s infinite ease-in-out; }
  @keyframes float { 0% {transform:rotate(0deg)} 100% {transform:rotate(360deg)} }
  @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 0.4; } 50% { transform: scale(1.1); opacity: 0.6; } }
  .noise { position: fixed; inset: 0; z-index: -1; opacity: 0.04; background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); pointer-events: none; }

  /* LAYOUT */
  .app-shell {
    max-width: 480px; margin: 0 auto;
    width: 100%;
    padding: var(--pad);
    padding-top: calc(20px + env(safe-area-inset-top));
    padding-bottom: calc(40px + env(safe-area-inset-bottom));
    display: flex; flex-direction: column; gap: 32px;
    flex: 1;
    justify-content: center;
  }

  /* QR CARD */
  .qr-card {
    background: linear-gradient(165deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.02) 100%);
    border: 1px solid var(--surface-border);
    border-top: 1px solid var(--surface-highlight);
    border-radius: var(--radius-xl);
    padding: 40px 24px;
    display: flex; flex-direction: column; align-items: center; gap: 24px;
    backdrop-filter: blur(30px);
    box-shadow: 0 12px 32px rgba(0,0,0,0.3);
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  
  .qr-card::before {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 60%);
    pointer-events: none;
  }

  .qr-box {
    background: #fff;
    padding: 20px;
    border-radius: 24px;
    box-shadow: 0 0 40px rgba(255,255,255,0.15);
    display: flex; align-items: center; justify-content: center;
    z-index: 2;
  }

  .qr-text { z-index: 2; }
  .qr-text h3 { font-size: 20px; font-weight: 700; margin-bottom: 8px; color: #fff; letter-spacing: 0.3px; }
  .qr-text p { font-size: 15px; color: var(--text-muted); line-height: 1.4; max-width: 280px; margin: 0 auto; font-weight: 500; }

  /* ACTIONS */
  .actions { 
    display: flex; flex-direction: column; align-items: center; gap: 12px; 
    width: 100%;
    padding: 0 12px;
  }
  
  .btn {
    width: 100%;
    height: 56px;
    border-radius: var(--radius-btn);
    display: flex; align-items: center; justify-content: center;
    font-size: 17px; font-weight: 600;
    cursor: pointer; transition: transform 0.1s, opacity 0.2s;
    border: none; outline: none;
    -webkit-backdrop-filter: blur(10px);
    letter-spacing: -0.3px;
  }
  .btn:active { transform: scale(0.98); opacity: 0.9; }
  
  .btn-primary {
    background: linear-gradient(135deg, var(--acc-blue) 0%, #5e60ce 100%);
    color: #fff;
    box-shadow: 0 8px 24px rgba(94, 96, 206, 0.25);
  }
  
  .btn-glass {
    background: rgba(255,255,255,0.08);
    border: 1px solid var(--surface-border);
    color: rgba(255,255,255,0.9);
  }

</style>
</head>
<body>

<div class="fx-layer">
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="noise"></div>
</div>

<div class="app-shell">
  
  <div class="qr-card">
    <div class="qr-box" id="qrcode"></div>
    <div class="qr-text">
      <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
      <p>–í–∞—à–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Macros Ecosystem</p>
    </div>
  </div>

  <div class="actions">
    <button class="btn btn-primary" onclick="shareRef()">
      –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –¥–æ—Å—Ç—É–ø–æ–º
    </button>
    <button class="btn btn-glass" onclick="copyRef()">
      –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å
    </button>
  </div>

</div>

<script>
  const tg = window.Telegram.WebApp;
  const BOT_USERNAME = "llmacros_bot";
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  if(tg) {
    tg.ready();
    tg.expand();
    tg.setHeaderColor('#050505'); 
    tg.setBackgroundColor('#050505');
    
    // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -> router.html
    if(tg.BackButton) {
        tg.BackButton.show();
        tg.BackButton.onClick(function() {
            haptic('light');
            window.location.href = 'router.html';
        });
    }
  }

  const userId = tg.initDataUnsafe?.user?.id || '12345'; 
  const refLink = `https://t.me/${BOT_USERNAME}?start=ref_${userId}`;

  // –†–µ–Ω–¥–µ—Ä QR
  const qrCode = new QRCodeStyling({
    width: 200,
    height: 200,
    type: "svg",
    data: refLink,
    dotsOptions: { color: "#000000", type: "rounded" },
    backgroundOptions: { color: "#ffffff" },
    imageOptions: { crossOrigin: "anonymous", margin: 10 },
    cornersSquareOptions: { type: "extra-rounded" },
    cornersDotOptions: { type: "dot" }
  });
  qrCode.append(document.getElementById("qrcode"));

  // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
  function shareRef() {
    haptic('medium');
    
    // 1. –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç + —Å—Å—ã–ª–∫—É –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
    // \n\n –¥–µ–ª–∞–µ—Ç –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–µ–¥ —Å—Å—ã–ª–∫–æ–π –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
    const fullText = `–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ Macros. –≠—Ç–æ –∑–∞–∫—Ä—ã—Ç–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –±–∏–æ—Ö–∞–∫–∏–Ω–≥–∞: –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–∏—Ç–∞–Ω–∏—è, —É–º–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ.\n\n–¢–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø:\n${refLink}`;
    
    // 2. –ö–æ–¥–∏—Ä—É–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
    // –ú—ã –ø–µ—Ä–µ–¥–∞–µ–º –ø—É—Å—Ç–æ–π url –ø–∞—Ä–∞–º–µ—Ç—Ä (url=), –∞ —Å—Å—ã–ª–∫—É –∫–ª–∞–¥–µ–º –≤ text, 
    // –ª–∏–±–æ –ø–µ—Ä–µ–¥–∞–µ–º —Å—Å—ã–ª–∫—É –∏ —Ç—É–¥–∞ –∏ —Ç—É–¥–∞. 
    // –°–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±, —á—Ç–æ–±—ã —Å—Å—ã–ª–∫–∞ –±—ã–ª–∞ –≤ –¢–ï–ö–°–¢–ï - –¥–æ–±–∞–≤–∏—Ç—å –µ—ë –≤ text.
    const url = `https://t.me/share/url?url=${encodeURIComponent(refLink)}&text=${encodeURIComponent(fullText)}`;
    
    tg.openTelegramLink(url);
  }

  function copyRef() {
    haptic('light');
    navigator.clipboard.writeText(refLink).then(() => {
      tg.showPopup({
        title: '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ',
        message: '–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ Macros —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞',
        buttons: [{type: 'ok'}]
      });
    }).catch(err => console.error(err));
  }

  function haptic(style) {
    if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred(style);
  }

</script>
</body>
</html>
