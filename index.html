<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* --- Base / reset --- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    html, body { scrollbar-gutter: stable both-edges; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 16px 16px 120px 16px;
      color: #222;
    }

    .container {
      max-width: 600px;
      margin: 0 auto 16px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,.25);
      overflow: hidden;
    }

    /* --- Header (compact) --- */
    .header {
      position: sticky; top: 0; left: 0; right: 0; /* –ø—Ä–∏–ª–∏–ø–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 12px 16px; /* –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
      text-align: center;
      z-index: 1;
    }
    .header-inner { position: relative; display: inline-block; }
    .header h1 { font-size: 18px; font-weight: 700; letter-spacing: .2px; }

    .info-button {
      position: absolute; inset-inline-end: -44px; top: 50%; translate: 0 -50%;
      width: 28px; height: 28px; border-radius: 999px; border: 1px solid rgba(255,255,255,.35);
      background: rgba(255,255,255,.15);
      cursor: pointer; display: inline-grid; place-items: center;
      transition: transform .15s ease, background .15s ease, box-shadow .15s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,.15) inset;
    }
    .info-button:focus-visible { outline: 2px solid rgba(255,255,255,.9); outline-offset: 2px; }
    .info-button:hover { transform: scale(1.06); background: rgba(255,255,255,.22); }

    /* User-info —Å–∫—Ä—ã—Ç –Ω–∞ –ø—Ä–æ–¥–µ (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ö—É–∫ –¥–ª—è –ø—Ä–µ–ª–æ–∞–¥–µ—Ä–∞/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Ö.–∏–Ω—Ñ–æ) */
    .user-info { display: none; }

    /* --- Search --- */
    .search-container { padding: 16px; border-bottom: 1px solid #eee; }
    .search-wrap { position: relative; width: 100%; }
    .search-ico { position: absolute; inset-inline-start: 12px; top: 50%; translate: 0 -50%; width: 18px; height: 18px;
      background: no-repeat center/contain url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%238899A6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>');
      pointer-events: none; }
    .search-input {
      width: 100%;
      padding: 12px 14px 12px 40px; /* –º–µ—Å—Ç–æ –ø–æ–¥ –ª—É–ø—É */
      font-size: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      transition: border-color .2s, box-shadow .2s;
      caret-color: #667eea; /* –≤–∏–¥–∏–º—ã–π –∫—É—Ä—Å–æ—Ä */
    }
    .search-input::placeholder { color: #98a2b3; }
    .search-input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,.12); }

    .loading-indicator { text-align: center; padding: 16px; color: #667eea; }

    /* --- Categories --- */
    .categories { display: grid; gap: 12px; padding: 12px 0; }
    .category { border: 1px solid #eee; border-radius: 12px; overflow: hidden; background: #fff; }

    .category-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px; background: linear-gradient(135deg, #6b7ded 0%, #7a70b0 100%);
      color: #fff; cursor: pointer; user-select: none;
    }
    .category-title { display: inline-flex; align-items: center; gap: 8px; font-weight: 600; }
    .category-count { background: rgba(255,255,255,.2); padding: 2px 8px; border-radius: 999px; font-weight: 700; font-size: 12px; }
    .category-arrow { width: 7px; height: 7px; border-right: 2px solid #fff; border-bottom: 2px solid #fff; transform: rotate(45deg); transition: transform .2s; margin-left: 6px; }
    .category.open .category-arrow { transform: rotate(-135deg); }

    .category-products { max-height: 0; overflow: hidden; transition: max-height .32s ease; background: #fff; }
    .category-products.open { overflow-y: auto; }

    .select-all-container { padding: 12px 16px; background: #f7f7fa; border-bottom: 1px solid #eee; display: flex; justify-content: center; }
    .select-all-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none; color:#fff; padding: 10px 20px; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer;
      box-shadow: 0 4px 12px rgba(102,126,234,.28); transition: transform .15s, box-shadow .15s, opacity .15s;
    }
    .select-all-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(102,126,234,.4); }
    .select-all-btn:active { transform: translateY(0); }

    .product-item { display: flex; align-items: center; gap: 10px; padding: 12px 16px; border-bottom: 1px solid #f0f0f0; }
    .product-item:last-child { border-bottom: 0; }
    .product-label { flex: 1; cursor: pointer; }

    /* --- Save / footer spacing --- */
    .selected-count { text-align:center; padding: 12px 16px; font-weight: 600; }
    .save-container { padding: 0 16px 16px; }
    .save-button {
      width: 100%; padding: 12px; border-radius: 12px; border: none; cursor: pointer; font-weight: 700; font-size: 15px; color:#fff;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 4px 12px rgba(102,126,234,.3); transition: transform .15s, box-shadow .15s, opacity .15s;
    }
    .save-button:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(102,126,234,.4); }
    .save-button:disabled { opacity:.6; cursor:not-allowed; transform:none; }

    /* --- Bottom nav (kept) --- */
    .footer-nav { position: fixed; left:0; right:0; bottom:0; height:60px; background:#fff; border-top:1px solid #e0e0e0;
      display:flex; align-items:center; justify-content:space-around; z-index: 5; }
    .nav-item { flex: 1; display:flex; align-items:center; justify-content:center; }
    .nav-item.active .nav-icon-home { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip:text; background-clip:text; color: transparent; }
    .nav-icon-home { width:28px; height:28px; color:#98a2b3; }
    .nav-icon-home svg { width:100%; height:100%; fill: currentColor; }

    /* --- Toasts --- */
    .success, .error { position: fixed; left: 50%; translate: -50% 0; bottom: 76px; z-index: 6; padding: 10px 14px; border-radius: 10px; font-weight:600; color:#fff; }
    .success { background:#22c55e; }
    .error { background:#ef4444; }

    /* --- Modal --- */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index: 10; }
    .modal-overlay.active { display: flex; }
    .modal-content { position: relative; width:min(640px, calc(100% - 24px)); max-height: 80vh; background:#fff; border-radius: 16px; padding: 16px 16px 0; overflow: hidden; box-shadow: 0 24px 60px rgba(0,0,0,.35); }
    .modal-title { font-size: 18px; font-weight: 700; margin: 4px 8px 8px; color:#333; padding-right: 40px; }
    .modal-body { overflow: auto; max-height: calc(80vh - 64px); padding: 8px 8px 16px; }
    .modal-text { font-size: 15px; line-height: 1.7; color:#333; white-space: pre-wrap; }
    .modal-loading { text-align:center; padding: 16px; color:#667eea; }

    .modal-close { position:absolute; top: 10px; right: 10px; width: 32px; height: 32px; border-radius: 999px; border: none; background:#f1f3f5; display:grid; place-items:center; font-size: 22px; line-height: 1; cursor:pointer; color:#555; transition: transform .15s ease, background .15s ease, box-shadow .15s ease; }
    .modal-close:hover { transform: scale(1.08); background:#e9ecef; }
    .modal-close:active { transform: scale(0.96); }
    .modal-close:focus-visible { outline: 2px solid #667eea; outline-offset: 2px; }

    @media (prefers-reduced-motion: reduce) {
      .select-all-btn, .save-button, .info-button, .modal-close { transition: none !important; }
      .category-products { transition: none !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-inner">
        <h1>–í—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h1>
        <button class="info-button" id="infoBtn" aria-label="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è">?</button>
      </div>
    </div>

    <!-- —Å–∫—Ä—ã—Ç–∞—è —Ç–µ—Ö.–∑–æ–Ω–∞: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥ –ø—Ä–µ–ª–æ–∞–¥–µ—Ä—ã/—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–æ –∏–º—è/ID –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º -->
    <div class="user-info" id="userInfo"></div>

    <div class="search-container" id="searchContainer">
      <div class="search-wrap">
        <span class="search-ico" aria-hidden="true"></span>
        <input id="searchInput" class="search-input" type="search" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤..." autocomplete="off" />
      </div>
    </div>

    <div id="loading" class="loading-indicator">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö‚Ä¶</div>
    <div id="categories" class="categories" hidden></div>

    <div class="selected-count" id="selectedCount">–í—ã–±—Ä–∞–Ω–æ: 0</div>
    <div class="save-container">
      <button id="saveButton" class="save-button" disabled>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>

  <div class="footer-nav">
    <div class="nav-item"></div>
    <div class="nav-item"></div>
    <div class="nav-item active" id="navHome">
      <div class="nav-icon-home">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 9.5L12 2.5L21 9.5V20.5C21 21.0523 20.5523 21.5 20 21.5H4C3.44772 21.5 3 21.0523 3 20.5V9.5Z"/><path d="M9 21.5V12.5H15V21.5"/></svg>
      </div>
    </div>
    <div class="nav-item"></div>
    <div class="nav-item"></div>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
      <button class="modal-close" id="modalClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      <div class="modal-title">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</div>
      <div class="modal-body">
        <div class="modal-text" id="modalText"><div class="modal-loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏...</div></div>
      </div>
    </div>
  </div>

  <script>
    /* === CONFIG / TG init === */
    const CONFIG = {
      APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbxOJTIJ74ADNnwqjo-jTB5o80JBHI3LyZWGCefos4dJibThb8KUJ1avBieFaggSz_99/exec'
    };

    const tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;
    if (tg) { try { tg.expand(); } catch(e){} }

    /* === State === */
    const selectedProducts = new Set();
    let allProducts = []; // [{id, name, category}]
    let manualCache = null; let manualCacheTime = 0; const MANUAL_CACHE_DURATION = 5 * 60 * 1000;

    /* === Helpers === */
    const sleep = (ms)=> new Promise(r=>setTimeout(r,ms));
    const escapeHtml = (s='') => s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));

    function updateSelectedCounter(){
      const el = document.getElementById('selectedCount');
      el.textContent = `–í—ã–±—Ä–∞–Ω–æ: ${selectedProducts.size}`;
      document.getElementById('saveButton').disabled = selectedProducts.size === 0;
    }

    function showSuccess(msg){ const e=document.querySelector('.success'); if(e) e.remove(); const d=document.createElement('div'); d.className='success'; d.textContent=msg; document.body.appendChild(d); setTimeout(()=>d.remove(),3000); }
    function showError(msg){ const e=document.querySelector('.error'); if(e) e.remove(); const d=document.createElement('div'); d.className='error'; d.textContent=msg; document.body.appendChild(d); setTimeout(()=>d.remove(),4000); }

    /* === Render === */
    async function initApp(){
      // fetch data
      try{
        const url = `${CONFIG.APPS_SCRIPT_URL}?action=init&initData=${encodeURIComponent(tg?.initData || '')}`;
        const res = await fetch(url, { method:'GET', cache:'no-cache' });
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        if(!data || data.error) throw new Error(data?.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');

        allProducts = (data.products || []).map(p=>({ id: String(p.id), name: p.name, category: p.category }));
        const saved = String(data.user_data?.selected_products || '').split(',').filter(Boolean);
        saved.forEach(id => selectedProducts.add(String(id)));

        renderApp();
      }catch(err){
        console.error(err); showError(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${err.message}`);
      }
    }

    function renderApp(){
      const loading = document.getElementById('loading');
      const categoriesEl = document.getElementById('categories');
      const grouped = groupByCategory(allProducts);

      loading.hidden = true; categoriesEl.hidden = false; categoriesEl.innerHTML = '';

      Object.entries(grouped).forEach(([cat, items], index) => {
        categoriesEl.appendChild(renderCategory(cat, items, index));
      });

      updateSelectedCounter();
    }

    function groupByCategory(items){
      const map = {};
      for(const p of items){ (map[p.category] ||= []).push(p); }
      return map;
    }

    function renderCategory(categoryName, products, index){
      const categoryId = `cat-${index}`;
      const selectedInCategory = products.filter(p=>selectedProducts.has(String(p.id))).length;

      const wrapper = document.createElement('div');
      wrapper.className = 'category';
      wrapper.dataset.categoryId = categoryId;
      wrapper.dataset.products = JSON.stringify(products);

      wrapper.innerHTML = `
        <div class="category-header" role="button" aria-expanded="false" aria-controls="${categoryId}-panel">
          <span class="category-title">${escapeHtml(categoryName)}</span>
          <div style="display:flex;align-items:center;gap:8px;">
            <span class="category-count">${selectedInCategory}/${products.length}</span>
            <div class="category-arrow"></div>
          </div>
        </div>
        <div id="${categoryId}-panel" class="category-products" role="region" aria-labelledby="${categoryId}-btn"></div>
      `;

      const header = wrapper.querySelector('.category-header');
      const panel = wrapper.querySelector('.category-products');

      header.addEventListener('click', () => toggleCategory(wrapper, panel, header));

      return wrapper;
    }

    function mountProducts(categoryEl){
      const products = JSON.parse(categoryEl.dataset.products);
      const panel = categoryEl.querySelector('.category-products');
      const allSelected = products.every(p => selectedProducts.has(String(p.id)));

      const html = `
        <div class="select-all-container">
          <button class="select-all-btn" data-category-id="${categoryEl.dataset.categoryId}">${allSelected ? '‚úì –°–Ω—è—Ç—å –≤—Å–µ' : '+ –í—ã–±—Ä–∞—Ç—å –≤—Å–µ'}</button>
        </div>
        ${products.map(p=>`
          <div class="product-item" data-product-id="${p.id}">
            <input id="prod-${p.id}" type="checkbox" class="product-checkbox" ${selectedProducts.has(String(p.id)) ? 'checked' : ''} />
            <label for="prod-${p.id}" class="product-label">${escapeHtml(p.name)}</label>
          </div>
        `).join('')}
      `;
      panel.innerHTML = html;

      panel.querySelector('.select-all-btn').addEventListener('click', (e)=>{ e.stopPropagation(); handleSelectAll(e.currentTarget); });
      panel.querySelectorAll('.product-checkbox').forEach(cb=>{
        cb.addEventListener('change', onCheckboxChange);
      });
    }

    function toggleCategory(categoryEl, panel, header){
      const isOpen = panel.classList.contains('open');
      if(isOpen){
        panel.style.maxHeight = panel.scrollHeight + 'px';
        requestAnimationFrame(()=>{ panel.classList.remove('open'); panel.style.maxHeight = '0px'; });
        categoryEl.classList.remove('open');
        header.setAttribute('aria-expanded','false');
      } else {
        if(!panel.hasChildNodes()) mountProducts(categoryEl);
        panel.classList.add('open');
        panel.style.maxHeight = panel.scrollHeight + 'px';
        categoryEl.classList.add('open');
        header.setAttribute('aria-expanded','true');
      }
      // –æ—á–∏—Å—Ç–∫–∞ inline-—Å—Ç–∏–ª–µ–π –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å
      panel.addEventListener('transitionend', ()=>{ if(panel.classList.contains('open')) panel.style.maxHeight = panel.scrollHeight + 'px'; });
    }

    function handleSelectAll(button){
      const category = document.querySelector(`.category[data-category-id="${button.dataset.categoryId}"]`);
      const products = JSON.parse(category.dataset.products);
      const panel = category.querySelector('.category-products');
      const cbs = panel.querySelectorAll('.product-checkbox');
      const allSelected = Array.from(cbs).every(cb=>cb.checked);

      if(allSelected){ cbs.forEach(cb=>{ cb.checked=false; selectedProducts.delete(cb.id.replace('prod-','')); }); button.textContent = '+ –í—ã–±—Ä–∞—Ç—å –≤—Å–µ'; }
      else { cbs.forEach(cb=>{ cb.checked=true; selectedProducts.add(cb.id.replace('prod-','')); }); button.textContent = '‚úì –°–Ω—è—Ç—å –≤—Å–µ'; }

      const countEl = category.querySelector('.category-count');
      countEl.textContent = `${Array.from(cbs).filter(cb=>cb.checked).length}/${products.length}`;
      updateSelectedCounter();
    }

    function onCheckboxChange(e){
      const cb = e.currentTarget; const id = cb.id.replace('prod-','');
      if(cb.checked) selectedProducts.add(id); else selectedProducts.delete(id);

      const categoryEl = cb.closest('.category');
      const products = JSON.parse(categoryEl.dataset.products);
      const checkedCount = cb.closest('.category-products').querySelectorAll('.product-checkbox:checked').length;
      categoryEl.querySelector('.category-count').textContent = `${checkedCount}/${products.length}`;
      const btn = categoryEl.querySelector('.select-all-btn');
      if(btn) btn.textContent = (checkedCount === products.length) ? '‚úì –°–Ω—è—Ç—å –≤—Å–µ' : '+ –í—ã–±—Ä–∞—Ç—å –≤—Å–µ';

      updateSelectedCounter();
    }

    /* === Search === */
    const searchInput = document.getElementById('searchInput');
    let searchTimer = null;
    searchInput.addEventListener('input', () => {
      clearTimeout(searchTimer);
      searchTimer = setTimeout(applySearch, 250);
    });

    function applySearch(){
      const q = searchInput.value.trim().toLowerCase();
      const cats = document.querySelectorAll('.category');
      cats.forEach(cat => {
        const products = JSON.parse(cat.dataset.products || '[]');
        const name = (cat.querySelector('.category-title')?.textContent || '').toLowerCase();
        const matchCat = name.includes(q);
        const hasMatch = matchCat || products.some(p => (p.name || '').toLowerCase().includes(q));
        cat.style.display = hasMatch ? '' : 'none';
      });
    }

    /* === Save === */
    document.getElementById('saveButton').addEventListener('click', saveSelection);
    async function saveSelection(){
      const btn = document.getElementById('saveButton');
      btn.disabled = true; btn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ‚Ä¶';
      try{
        const ids = Array.from(selectedProducts).join(',');
        const url = `${CONFIG.APPS_SCRIPT_URL}?action=save&initData=${encodeURIComponent(tg?.initData || '')}`;
        const res = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ selected_products: ids }) });
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        if(data?.ok){ showSuccess('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ'); } else { throw new Error(data?.error || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å'); }
      }catch(err){ showError(err.message); }
      finally{ btn.textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å'; btn.disabled = selectedProducts.size === 0; }
    }

    /* === Modal === */
    document.getElementById('infoBtn').addEventListener('click', showManual);
    document.getElementById('modalClose').addEventListener('click', closeManual);
    document.getElementById('modalOverlay').addEventListener('click', (e)=>{ if(e.target.id==='modalOverlay') closeManual(); });

    async function showManual(){
      const overlay = document.getElementById('modalOverlay');
      const modalText = document.getElementById('modalText');
      overlay.classList.add('active');

      const now = Date.now();
      if(manualCache && (now - manualCacheTime < MANUAL_CACHE_DURATION)){
        modalText.innerHTML = `<div style="white-space: pre-wrap;">${escapeHtml(manualCache)}</div>`; return;
      }

      modalText.innerHTML = '<div class="modal-loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏...</div>';
      try{
        const url = `${CONFIG.APPS_SCRIPT_URL}?action=get_manual&initData=${encodeURIComponent(tg?.initData || '')}`;
        const res = await fetch(url, { method:'GET', cache:'no-cache' });
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const text = await res.text();
        manualCache = text; manualCacheTime = now;
        modalText.innerHTML = `<div style="white-space: pre-wrap;">${escapeHtml(text)}</div>`;
      }catch(err){ modalText.innerHTML = `<div class="modal-loading">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å. ${escapeHtml(err.message)}</div>`; }
    }

    function closeManual(){ document.getElementById('modalOverlay').classList.remove('active'); }

    // Init
    if(document.readyState === 'loading'){ document.addEventListener('DOMContentLoaded', initApp); } else { initApp(); }
  </script>
</body>
</html>
