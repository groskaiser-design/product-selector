<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Nutrition Module</title>
    <style>
        :root {
            --bg-color: #0F0F0F;
            --card-bg: #1C1C1E;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --accent-blue: #0A84FF;
            --accent-green: #30D158;
            --accent-red: #FF453A;
            --accent-yellow: #FFD60A;
            --separator: #38383A;
            --input-bg: #2C2C2E;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- ZONE A: HEADER (Sticky) --- */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(15, 15, 15, 0.85);
            backdrop-filter: blur(20px);
            z-index: 100;
            border-bottom: 0.5px solid var(--separator);
            padding-bottom: 10px;
        }

        .calendar-strip {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            font-weight: 600;
            font-size: 16px;
        }
        
        .calendar-nav { color: var(--accent-blue); cursor: pointer; }

        .stats-dashboard {
            display: flex;
            justify-content: space-around;
            padding: 0 15px;
            gap: 10px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            flex: 1;
            padding: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .stat-val { font-size: 14px; font-weight: 700; z-index: 2; }
        .stat-label { font-size: 10px; color: var(--text-secondary); z-index: 2; margin-top: 2px; }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä—ã –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .progress-bg {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* –í–æ–¥–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
        .water-widget {
            background: rgba(10, 132, 255, 0.15);
            color: var(--accent-blue);
            border: 1px solid rgba(10, 132, 255, 0.3);
        }

        /* --- ZONE B: BODY (Scrollable) --- */
        .content-area {
            padding-top: 110px; /* –û—Ç—Å—Ç—É–ø –ø–æ–¥ —Ö–µ–¥–µ—Ä */
            padding-bottom: 100px; /* –û—Ç—Å—Ç—É–ø –ø–æ–¥ –∏–Ω–ø—É—Ç */
            padding-left: 15px;
            padding-right: 15px;
        }

        .meal-group { margin-bottom: 25px; }
        .meal-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 12px;
        }

        .food-item {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 12px 16px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        .food-item:active { transform: scale(0.98); }

        .food-info { display: flex; flex-direction: column; }
        .food-name { font-weight: 500; font-size: 16px; }
        .food-desc { font-size: 13px; color: var(--text-secondary); margin-top: 4px; }
        .food-macros { font-size: 13px; font-weight: 600; color: var(--accent-green); }

        /* --- ZONE C: INPUT DOCK (Sticky) --- */
        .input-dock {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            padding: 12px 15px 25px 15px; /* Extra padding for iPhone Home Indicator */
            border-top: 0.5px solid var(--separator);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .attach-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-blue);
            font-size: 20px;
            cursor: pointer;
        }

        .main-input {
            flex: 1;
            background: var(--input-bg);
            border: none;
            border-radius: 20px;
            padding: 12px 15px;
            color: white;
            font-size: 16px;
            outline: none;
        }

        .send-btn-mock {
            color: var(--accent-blue);
            font-weight: 600;
            cursor: pointer;
            display: none; /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç */
        }

        /* --- DRAFT SHEET (Verification) --- */
        .sheet-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        .sheet-overlay.active { opacity: 1; visibility: visible; }

        .bottom-sheet {
            background: #1C1C1E;
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            max-height: 80vh;
            overflow-y: auto;
        }
        .sheet-overlay.active .bottom-sheet { transform: translateY(0); }

        .sheet-handle {
            width: 40px; height: 5px; background: #38383A; border-radius: 3px;
            margin: 0 auto 20px auto;
        }

        .sheet-title { font-size: 20px; font-weight: 700; margin-bottom: 15px; }

        .draft-card {
            background: #2C2C2E;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .draft-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .draft-name { font-weight: 600; font-size: 16px; }
        
        .stepper {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #1C1C1E;
            padding: 5px 10px;
            border-radius: 8px;
        }
        .step-btn { color: var(--accent-blue); font-size: 20px; font-weight: bold; cursor: pointer; }
        
        .macro-pills { display: flex; gap: 5px; font-size: 12px; color: var(--text-secondary); margin-top: 5px; }
        .pill { padding: 2px 6px; background: #3A3A3C; border-radius: 4px; }

        .action-btn {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
            cursor: pointer;
        }
        .btn-primary { background: var(--accent-blue); color: white; }
        .btn-secondary { background: transparent; color: var(--accent-red); margin-top: 5px; }

        /* Loading Animation */
        .ai-thinking {
            display: none;
            text-align: center;
            padding: 10px;
            color: var(--text-secondary);
            font-size: 14px;
        }
        .dots::after { content: ' .'; animation: dots 1.5s steps(5, end) infinite;}
        @keyframes dots { 0%, 20% { content: ' .'; } 40% { content: ' ..'; } 60% { content: ' ...'; } 80%, 100% { content: ''; }}

    </style>
</head>
<body>

    <header class="header">
        <div class="calendar-strip">
            <span class="calendar-nav">‚Äπ</span>
            <span>–°–µ–≥–æ–¥–Ω—è, 22 –û–∫—Ç</span>
            <span class="calendar-nav">‚Ä∫</span>
        </div>

        <div class="stats-dashboard">
            <div class="stat-card">
                <div class="stat-val" id="val-kcal">1240</div>
                <div class="stat-label">–ö–ö–ê–õ / 2000</div>
                <div class="progress-bg"><div class="progress-fill" style="width: 62%; background: var(--accent-green);"></div></div>
            </div>
            <div class="stat-card">
                <div class="stat-val" id="val-prot">90g</div>
                <div class="stat-label">–ë–ï–õ–ö–ò</div>
                <div class="progress-bg"><div class="progress-fill" style="width: 80%; background: var(--accent-blue);"></div></div>
            </div>
            <div class="stat-card">
                <div class="stat-val" id="val-fat">45g</div>
                <div class="stat-label">–ñ–ò–†–´</div>
                <div class="progress-bg"><div class="progress-fill" style="width: 50%; background: var(--accent-yellow);"></div></div>
            </div>
            <div class="stat-card water-widget" onclick="addWater()">
                <div class="stat-val" id="val-water">1.2L</div>
                <div class="stat-label">–í–û–î–ê +</div>
                <div class="progress-bg"><div class="progress-fill" style="width: 60%; background: var(--accent-blue);"></div></div>
            </div>
        </div>
    </header>

    <div class="content-area" id="food-list">
        
        <div class="meal-group">
            <div class="meal-title">–ó–∞–≤—Ç—Ä–∞–∫ ‚Ä¢ 09:30</div>
            <div class="food-item">
                <div class="food-info">
                    <span class="food-name">–û–≤—Å—è–Ω–∫–∞ —Å —è–≥–æ–¥–∞–º–∏</span>
                    <span class="food-desc">250–≥ ‚Ä¢ –ù–∞ –º–æ–ª–æ–∫–µ</span>
                </div>
                <div class="food-macros">320 –∫–∫–∞–ª</div>
            </div>
            <div class="food-item">
                <div class="food-info">
                    <span class="food-name">–ö–æ—Ñ–µ –∫–∞–ø—É—á–∏–Ω–æ</span>
                    <span class="food-desc">300–º–ª ‚Ä¢ –ë–µ–∑ —Å–∞—Ö–∞—Ä–∞</span>
                </div>
                <div class="food-macros">110 –∫–∫–∞–ª</div>
            </div>
        </div>

        <div class="meal-group">
            <div class="meal-title">–û–±–µ–¥ ‚Ä¢ 13:15</div>
            <div class="food-item">
                <div class="food-info">
                    <span class="food-name">–ë–æ—Ä—â —Å –≥–æ–≤—è–¥–∏–Ω–æ–π</span>
                    <span class="food-desc">350–≥ ‚Ä¢ –°–æ —Å–º–µ—Ç–∞–Ω–æ–π</span>
                </div>
                <div class="food-macros">450 –∫–∫–∞–ª</div>
            </div>
        </div>

        </div>

    <div class="input-dock">
        <div class="attach-btn">üì∑</div>
        <div class="attach-btn">üîó</div>
        <input type="text" class="main-input" id="user-input" placeholder="–ù–∞–ø–∏—à–∏, —á—Ç–æ —Å—ä–µ–ª...">
        <div class="send-btn-mock" id="send-btn" onclick="processInput()">‚Üë</div>
    </div>

    <div class="sheet-overlay" id="draft-sheet">
        <div class="bottom-sheet">
            <div class="sheet-handle"></div>
            <div class="ai-thinking" id="ai-loader">–ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–æ—Ç–æ –∏ —Ç–µ–∫—Å—Ç<span class="dots"></span></div>
            
            <div id="ai-results" style="display: none;">
                <div class="sheet-title">–î–æ–±–∞–≤–∏—Ç—å –≤ –û–±–µ–¥?</div>
                
                <div class="draft-card">
                    <div class="draft-row">
                        <span class="draft-name" id="draft-name">–°—Ç–µ–π–∫ –ª–æ—Å–æ—Å—è</span>
                        <div class="stepper">
                            <span class="step-btn">-</span>
                            <span style="font-weight: 600;">150 –≥</span>
                            <span class="step-btn">+</span>
                        </div>
                    </div>
                    <div class="macro-pills">
                        <span class="pill">üî• 310 –∫–∫–∞–ª</span>
                        <span class="pill">–ë: 30</span>
                        <span class="pill">–ñ: 20</span>
                        <span class="pill">–£: 0</span>
                    </div>
                </div>

                 <div class="draft-card">
                    <div class="draft-row">
                        <span class="draft-name">–û–≤–æ—â–∏ –≥—Ä–∏–ª—å</span>
                        <div class="stepper">
                            <span class="step-btn">-</span>
                            <span style="font-weight: 600;">200 –≥</span>
                            <span class="step-btn">+</span>
                        </div>
                    </div>
                    <div class="macro-pills">
                        <span class="pill">üî• 120 –∫–∫–∞–ª</span>
                    </div>
                </div>

                <div class="action-btn btn-primary" onclick="confirmFood()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</div>
                <div class="action-btn btn-secondary" onclick="closeSheet()">–û—Ç–º–µ–Ω–∞</div>
            </div>
        </div>
    </div>

    <script>
        /* --- LOGIC --- */

        const input = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const sheet = document.getElementById('draft-sheet');
        const aiLoader = document.getElementById('ai-loader');
        const aiResults = document.getElementById('ai-results');
        const foodList = document.getElementById('food-list');
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
        input.addEventListener('input', (e) => {
            if(e.target.value.length > 0) {
                sendBtn.style.display = 'block';
            } else {
                sendBtn.style.display = 'none';
            }
        });

        // –°–∏–º—É–ª—è—Ü–∏—è –ò–ò (–ú–∞–≥–∏—è)
        function processInput() {
            const text = input.value;
            if(!text) return;

            // –°–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
            input.blur();
            
            // –û—Ç–∫—Ä—ã—Ç—å —à—Ç–æ—Ä–∫—É
            sheet.classList.add('active');
            aiLoader.style.display = 'block';
            aiResults.style.display = 'none';

            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ 1.5 —Å–µ–∫
            setTimeout(() => {
                aiLoader.style.display = 'none';
                aiResults.style.display = 'block';
                
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ, –ø–æ–¥—Å—Ç–∞–≤–∏–º —ç—Ç–æ –≤ –º–æ–¥–∞–ª–∫—É (mock)
                if(text.length > 3) {
                    document.getElementById('draft-name').innerText = text;
                }
            }, 1500);
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        function confirmFood() {
            // 1. –ó–∞–∫—Ä—ã–≤–∞–µ–º —à—Ç–æ—Ä–∫—É
            closeSheet();
            input.value = '';
            sendBtn.style.display = 'none';

            // 2. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ (–í–∏–∑—É–∞–ª—å–Ω–æ)
            const name = document.getElementById('draft-name').innerText;
            const newFoodHTML = `
                <div class="food-item" style="animation: popIn 0.3s ease;">
                    <div class="food-info">
                        <span class="food-name">${name}</span>
                        <span class="food-desc">150–≥ ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ —á—Ç–æ</span>
                    </div>
                    <div class="food-macros">310 –∫–∫–∞–ª</div>
                </div>
            `;

            // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ "–û–±–µ–¥" (–¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
            // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –Ω—É–∂–Ω—ã–π meal-group
            const lunchGroup = document.querySelector('.meal-group:nth-child(2)');
            lunchGroup.insertAdjacentHTML('beforeend', newFoodHTML);

            // 3. –û–±–Ω–æ–≤–ª—è–µ–º —Ö–µ–¥–µ—Ä (–ê–Ω–∏–º–∞—Ü–∏—è —Ü–∏—Ñ—Ä)
            updateStat('val-kcal', 1240, 1550, '–ö–ö–ê–õ');
            updateStat('val-prot', 90, 120, 'g');
        }

        function closeSheet() {
            sheet.classList.remove('active');
        }

        // –õ–æ–≥–∏–∫–∞ –≤–æ–¥—ã
        let waterLiters = 1.2;
        function addWater() {
            waterLiters += 0.25;
            document.getElementById('val-water').innerText = waterLiters.toFixed(1) + 'L';
            // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è
            const widget = document.querySelector('.water-widget');
            widget.style.transform = 'scale(0.95)';
            setTimeout(() => widget.style.transform = 'scale(1)', 150);
        }

        // –ö—Ä–∞—Å–∏–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–µ–ª
        function updateStat(id, start, end, unit) {
            const obj = document.getElementById(id);
            let current = start;
            const step = (end - start) / 20;
            
            const timer = setInterval(() => {
                current += step;
                if(current >= end) {
                    clearInterval(timer);
                    current = end;
                }
                obj.innerText = Math.floor(current) + (unit === 'g' ? 'g' : '');
            }, 20);
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ —à—Ç–æ—Ä–∫–∏ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        sheet.addEventListener('click', (e) => {
            if(e.target === sheet) closeSheet();
        });
        
        // Enter to send
        input.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                processInput();
            }
        });

    </script>
</body>
</html>
