const a0_0x317797=a0_0x3c5a;(function(_0x41079e,_0x27ccac){const _0x895e61=a0_0x3c5a,_0x29d001=_0x41079e();while(!![]){try{const _0x55e63c=-parseInt(_0x895e61(0x164))/0x1+-parseInt(_0x895e61(0x151))/0x2+parseInt(_0x895e61(0x1b0))/0x3+parseInt(_0x895e61(0x15e))/0x4+-parseInt(_0x895e61(0x18b))/0x5+parseInt(_0x895e61(0x15f))/0x6+-parseInt(_0x895e61(0x180))/0x7*(-parseInt(_0x895e61(0x196))/0x8);if(_0x55e63c===_0x27ccac)break;else _0x29d001['push'](_0x29d001['shift']());}catch(_0x25dbbf){_0x29d001['push'](_0x29d001['shift']());}}}(a0_0xf354,0xdd4f2));const tg=window[a0_0x317797(0x16b)]?.['WebApp'],HOME_URL=a0_0x317797(0x1b9);function setupTelegramBackButton(){const _0x51182a=a0_0x317797,_0x368016=(function(){let _0x4d2c00=!![];return function(_0x45b13f,_0x374365){const _0x297178=_0x4d2c00?function(){const _0x161a22=a0_0x3c5a;if(_0x374365){const _0x30497f=_0x374365[_0x161a22(0x169)](_0x45b13f,arguments);return _0x374365=null,_0x30497f;}}:function(){};return _0x4d2c00=![],_0x297178;};}()),_0x2433ad=_0x368016(this,function(){const _0x5b7a6e=a0_0x3c5a;return _0x2433ad[_0x5b7a6e(0x1a1)]()['search'](_0x5b7a6e(0x199))[_0x5b7a6e(0x1a1)]()[_0x5b7a6e(0x182)](_0x2433ad)[_0x5b7a6e(0x1a2)]('(((.+)+)+)+$');});_0x2433ad();if(!tg)return;try{tg[_0x51182a(0x1bc)](),tg[_0x51182a(0x1a6)](),tg[_0x51182a(0x186)]?.('#050505');if(tg['isVersionAtLeast']?.(_0x51182a(0x1a7)))tg['disableVerticalSwipes']?.();const _0x322c2b=tg[_0x51182a(0x1bb)];if(_0x322c2b){_0x322c2b[_0x51182a(0x1b2)]();if(typeof _0x322c2b[_0x51182a(0x19d)]===_0x51182a(0x1ac))try{_0x322c2b[_0x51182a(0x19d)]();}catch(_0x48072d){}_0x322c2b[_0x51182a(0x153)](()=>{const _0x2fc679=_0x51182a;if(tg[_0x2fc679(0x189)])tg[_0x2fc679(0x189)]['impactOccurred'](_0x2fc679(0x174));location[_0x2fc679(0x155)]=HOME_URL;});}}catch(_0x24316b){console[_0x51182a(0x168)](_0x51182a(0x14b),_0x24316b);}}(function initStableLayout(){const _0x4bee3c=a0_0x317797,_0x4b8975=document[_0x4bee3c(0x143)](_0x4bee3c(0x175)),_0x3be624=document[_0x4bee3c(0x191)](_0x4bee3c(0x161)),_0x2fbf3e=document[_0x4bee3c(0x191)](_0x4bee3c(0x1ab)),_0x3b85e2=document[_0x4bee3c(0x191)](_0x4bee3c(0x1b3));function _0x2cc27d(){const _0x8805e=_0x4bee3c;if(!_0x4b8975)return;const _0x4a8bda=tg&&tg[_0x8805e(0x190)]?tg[_0x8805e(0x190)]:window[_0x8805e(0x1b7)];_0x4b8975[_0x8805e(0x19b)][_0x8805e(0x195)]=_0x4a8bda+'px';if(_0x3be624){const _0x4d3fbe=_0x3be624[_0x8805e(0x15c)];_0x2fbf3e[_0x8805e(0x19b)][_0x8805e(0x144)]=_0x4d3fbe+0x28+'px';}}tg?tg[_0x4bee3c(0x1b1)](_0x4bee3c(0x194),({isStateStable:_0x26d4b6})=>{_0x2cc27d();if(_0x26d4b6)requestAnimationFrame(()=>{const _0x24576a=a0_0x3c5a;_0x2fbf3e[_0x24576a(0x17c)]=_0x2fbf3e['scrollHeight'];});}):window[_0x4bee3c(0x1aa)]('resize',_0x2cc27d),_0x2cc27d(),_0x3b85e2&&(_0x3b85e2['addEventListener'](_0x4bee3c(0x142),()=>{requestAnimationFrame(_0x2cc27d);}),_0x3b85e2[_0x4bee3c(0x1aa)](_0x4bee3c(0x18f),()=>{setTimeout(()=>{const _0xcb9d9f=a0_0x3c5a;_0x2fbf3e['scrollTop']=_0x2fbf3e[_0xcb9d9f(0x1b5)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x317797(0x159),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x317797(0x191)](a0_0x317797(0x1ab)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x317797(0x191)]('messageInput'),sendBtn=document['getElementById'](a0_0x317797(0x188)),clearBtn=document[a0_0x317797(0x191)](a0_0x317797(0x1ba)),modal=document[a0_0x317797(0x191)](a0_0x317797(0x185)),mTitle=document[a0_0x317797(0x191)](a0_0x317797(0x156)),mText=document['getElementById'](a0_0x317797(0x15a));let modalCallback=null;async function callBackend(_0x20606f,_0x3ee901){const _0x548aeb=a0_0x317797,_0x2b2e64=tg?.[_0x548aeb(0x148)]?.[_0x548aeb(0x172)]||{},_0x335123=_0x2b2e64['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x548aeb(0x1ae)](Math['random']()*0x3b9aca00);if(!_0x2b2e64['id'])localStorage['setItem'](_0x548aeb(0x16f),_0x335123);const _0x580164={'action':_0x20606f,'user_id':_0x335123,'user_data':{'first_name':_0x2b2e64[_0x548aeb(0x18a)],'username':_0x2b2e64[_0x548aeb(0x178)]},'init_data':tg?.[_0x548aeb(0x1ad)]||'',..._0x3ee901},_0x5614fb=new AbortController(),_0x5916c9=setTimeout(()=>_0x5614fb['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5ad200=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x548aeb(0x181)](_0x580164),'signal':_0x5614fb['signal']});return clearTimeout(_0x5916c9),await _0x5ad200[_0x548aeb(0x192)]();}catch(_0x17012c){return{'success':![],'error':String(_0x17012c)};}}function formatTime(_0x1c91bf){const _0x33ce7b=a0_0x317797,_0x443ddd=new Date(_0x1c91bf);return String(_0x443ddd[_0x33ce7b(0x17b)]())['padStart'](0x2,'0')+':'+String(_0x443ddd[_0x33ce7b(0x147)]())[_0x33ce7b(0x19a)](0x2,'0');}function createMessageElement(_0x1c720e,_0x3c1526){const _0x166e80=a0_0x317797,_0x10d77d=document[_0x166e80(0x187)](_0x166e80(0x17a));_0x10d77d[_0x166e80(0x184)]=_0x166e80(0x13f)+_0x1c720e[_0x166e80(0x171)];const _0x302e4e=document[_0x166e80(0x187)](_0x166e80(0x17a));_0x302e4e[_0x166e80(0x184)]=_0x166e80(0x197),_0x302e4e[_0x166e80(0x160)]=_0x1c720e[_0x166e80(0x198)]['replace'](/\n/g,_0x166e80(0x16a));const _0x208714=document[_0x166e80(0x187)](_0x166e80(0x17a));_0x208714[_0x166e80(0x184)]=_0x166e80(0x1af),_0x208714[_0x166e80(0x160)]=_0x166e80(0x19c),_0x208714[_0x166e80(0x157)]=_0x1d54d7=>{_0x1d54d7['stopPropagation'](),confirmDelete(_0x3c1526);};let _0x21fb04;_0x302e4e[_0x166e80(0x1aa)]('touchstart',()=>_0x21fb04=setTimeout(()=>{const _0x55c05d=_0x166e80;_0x10d77d[_0x55c05d(0x166)]['add'](_0x55c05d(0x145));if(tg?.[_0x55c05d(0x189)])tg['HapticFeedback'][_0x55c05d(0x17d)]('medium');},0x1f4)),_0x302e4e[_0x166e80(0x1aa)](_0x166e80(0x17f),()=>clearTimeout(_0x21fb04));const _0x4461f0=document[_0x166e80(0x187)](_0x166e80(0x17a));return _0x4461f0[_0x166e80(0x184)]=_0x166e80(0x15d),_0x4461f0[_0x166e80(0x162)]=formatTime(_0x1c720e[_0x166e80(0x1b4)]),_0x10d77d[_0x166e80(0x14a)](_0x208714),_0x10d77d[_0x166e80(0x14a)](_0x302e4e),_0x10d77d[_0x166e80(0x14a)](_0x4461f0),_0x10d77d;}function createTypingIndicator(){const _0x108240=a0_0x317797,_0x25229c=document[_0x108240(0x187)]('div');return _0x25229c['className']=_0x108240(0x176),_0x25229c['id']=_0x108240(0x1a4),_0x25229c[_0x108240(0x160)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x25229c;}function renderMessages(){const _0x614e03=a0_0x317797;Array['from'](chatArea[_0x614e03(0x177)])[_0x614e03(0x146)](_0x2442a8=>{const _0x274721=_0x614e03;if(_0x2442a8['id']!==_0x274721(0x13e))_0x2442a8[_0x274721(0x1a8)]();}),messages['length']>0x0?(emptyState[_0x614e03(0x19b)][_0x614e03(0x193)]=_0x614e03(0x149),messages['forEach']((_0x304f3d,_0x32cd03)=>chatArea[_0x614e03(0x14a)](createMessageElement(_0x304f3d,_0x32cd03)))):emptyState[_0x614e03(0x19b)][_0x614e03(0x193)]=_0x614e03(0x18e),requestAnimationFrame(()=>chatArea[_0x614e03(0x17c)]=chatArea[_0x614e03(0x1b5)]);}function autoResizeTextarea(){const _0x203088=a0_0x317797;messageInput[_0x203088(0x19b)][_0x203088(0x195)]=_0x203088(0x158),messageInput[_0x203088(0x19b)]['height']=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0xa3184e=a0_0x317797,_0x4f38cb=messageInput['value'][_0xa3184e(0x14c)]();sendBtn[_0xa3184e(0x141)]=!_0x4f38cb||isTyping;}function a0_0x3c5a(_0x17364c,_0x36c78a){_0x17364c=_0x17364c-0x13e;const _0x553ae5=a0_0xf354();let _0x3fedfe=_0x553ae5[_0x17364c];return _0x3fedfe;}async function sendMessage(){const _0xbed6a0=a0_0x317797,_0x1131bb=messageInput[_0xbed6a0(0x16e)][_0xbed6a0(0x14c)]();if(!_0x1131bb||isTyping)return;if(tg?.[_0xbed6a0(0x189)])tg[_0xbed6a0(0x189)]['impactOccurred'](_0xbed6a0(0x174));messages[_0xbed6a0(0x16d)]({'role':'user','content':_0x1131bb,'timestamp':Date[_0xbed6a0(0x165)]()}),localStorage[_0xbed6a0(0x1b8)](_0xbed6a0(0x15b),JSON[_0xbed6a0(0x181)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xbed6a0(0x14a)](createTypingIndicator()),chatArea[_0xbed6a0(0x17c)]=chatArea[_0xbed6a0(0x1b5)];const _0x370753=await callBackend(_0xbed6a0(0x173),{'message':_0x1131bb});isTyping=![];const _0x16c4ca=document[_0xbed6a0(0x191)](_0xbed6a0(0x1a4));if(_0x16c4ca)_0x16c4ca[_0xbed6a0(0x1a8)]();let _0x13f50c=_0xbed6a0(0x14e);if(_0x370753['success']){_0x13f50c=_0x370753[_0xbed6a0(0x163)]||_0xbed6a0(0x179);if(tg?.['HapticFeedback'])tg[_0xbed6a0(0x189)][_0xbed6a0(0x1a5)](_0xbed6a0(0x14f));}else{_0x13f50c=_0x370753[_0xbed6a0(0x18d)]||'Ошибка\x20сервера';if(tg?.[_0xbed6a0(0x189)])tg[_0xbed6a0(0x189)][_0xbed6a0(0x1a5)]('error');}messages[_0xbed6a0(0x16d)]({'role':'ai','content':_0x13f50c,'timestamp':Date[_0xbed6a0(0x165)]()}),localStorage[_0xbed6a0(0x1b8)](_0xbed6a0(0x15b),JSON[_0xbed6a0(0x181)](messages)),renderMessages();}function confirmDelete(_0x5b07df){const _0x3a5c9c=a0_0x317797;if(mTitle)mTitle[_0x3a5c9c(0x162)]='Удалить?';if(mText)mText[_0x3a5c9c(0x162)]=_0x3a5c9c(0x14d);modalCallback=()=>{const _0x467387=_0x3a5c9c;messages[_0x467387(0x18c)](_0x5b07df,0x1),localStorage[_0x467387(0x1b8)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x3a5c9c(0x166)][_0x3a5c9c(0x17e)]('show');}if(clearBtn)clearBtn[a0_0x317797(0x157)]=()=>{const _0x11f328=a0_0x317797;if(!messages[_0x11f328(0x1a3)])return;if(mTitle)mTitle[_0x11f328(0x162)]=_0x11f328(0x150);if(mText)mText[_0x11f328(0x162)]=_0x11f328(0x19e);modalCallback=async()=>{const _0x87dc7a=_0x11f328;messages=[],localStorage[_0x87dc7a(0x140)](_0x87dc7a(0x15b)),renderMessages(),callBackend('clear_history',{});},modal[_0x11f328(0x166)][_0x11f328(0x17e)]('show');};document[a0_0x317797(0x191)](a0_0x317797(0x170))[a0_0x317797(0x157)]=()=>modal[a0_0x317797(0x166)][a0_0x317797(0x1a8)](a0_0x317797(0x1b2)),document[a0_0x317797(0x191)](a0_0x317797(0x183))[a0_0x317797(0x157)]=()=>{const _0x51c753=a0_0x317797;if(modalCallback)modalCallback();modal['classList'][_0x51c753(0x1a8)]('show');},messageInput[a0_0x317797(0x1aa)](a0_0x317797(0x142),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x317797(0x1a9),_0x314676=>{const _0x3aef4e=a0_0x317797;_0x314676[_0x3aef4e(0x154)]===_0x3aef4e(0x1a0)&&!_0x314676['shiftKey']&&(_0x314676['preventDefault'](),sendMessage());}),sendBtn[a0_0x317797(0x157)]=sendMessage,document[a0_0x317797(0x1aa)](a0_0x317797(0x1b6),_0x541137=>{const _0x1cf20a=a0_0x317797;document[_0x1cf20a(0x16c)]('.message.show-delete')[_0x1cf20a(0x146)](_0xf675d3=>{const _0x260122=_0x1cf20a;if(!_0xf675d3[_0x260122(0x167)](_0x541137[_0x260122(0x19f)]))_0xf675d3[_0x260122(0x166)][_0x260122(0x1a8)](_0x260122(0x145));});});function a0_0xf354(){const _0x81624c=['onEvent','show','messageInput','timestamp','scrollHeight','click','innerHeight','setItem','./router.html','clearBtn','BackButton','ready','emptyState','message\x20','removeItem','disabled','input','querySelector','paddingBottom','show-delete','forEach','getMinutes','initDataUnsafe','none','appendChild','TG\x20setup\x20error:','trim','Действие\x20необратимо.','Ошибка\x20сети','success','Очистить\x20историю?','1115368GUORRh','getItem','onClick','key','href','modalTitle','onclick','auto','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','modalText','ai_chat_messages','offsetHeight','message-time','2799568omxaqy','6404574bwECBk','innerHTML','inputArea','textContent','text','1126222NCaJCO','now','classList','contains','warn','apply','<br>','Telegram','querySelectorAll','push','value','debug_uid','modalCancel','role','user','send_message','light','.container','message\x20ai','children','username','Пустой\x20ответ','div','getHours','scrollTop','impactOccurred','add','touchend','74893vVksgx','stringify','constructor','modalConfirm','className','confirmModal','setHeaderColor','createElement','sendBtn','HapticFeedback','first_name','7992790hNEWdN','splice','error','flex','focus','viewportHeight','getElementById','json','display','viewportChanged','height','1000bvIVuQ','message-bubble','content','(((.+)+)+)+$','padStart','style','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','offClick','Начнется\x20новый\x20диалог.','target','Enter','toString','search','length','typingIndicator','notificationOccurred','expand','6.1','remove','keydown','addEventListener','chatArea','function','initData','floor','delete-btn','3252750PnBCHI'];a0_0xf354=function(){return _0x81624c;};return a0_0xf354();}const saved=localStorage[a0_0x317797(0x152)](a0_0x317797(0x15b));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x587a25){}updateSendButton();