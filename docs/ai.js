const a0_0x308b79=a0_0x4dfd;(function(_0xd886f4,_0x4306d0){const _0xfa57be=a0_0x4dfd,_0x12d908=_0xd886f4();while(!![]){try{const _0x246b4a=parseInt(_0xfa57be(0xe3))/0x1+-parseInt(_0xfa57be(0x127))/0x2+-parseInt(_0xfa57be(0xd1))/0x3*(parseInt(_0xfa57be(0x120))/0x4)+parseInt(_0xfa57be(0x14d))/0x5*(parseInt(_0xfa57be(0x133))/0x6)+-parseInt(_0xfa57be(0x13f))/0x7*(parseInt(_0xfa57be(0xf1))/0x8)+parseInt(_0xfa57be(0x108))/0x9*(-parseInt(_0xfa57be(0x11b))/0xa)+parseInt(_0xfa57be(0x145))/0xb;if(_0x246b4a===_0x4306d0)break;else _0x12d908['push'](_0x12d908['shift']());}catch(_0x93e4e3){_0x12d908['push'](_0x12d908['shift']());}}}(a0_0x5473,0xa92d5));const tg=window[a0_0x308b79(0xe1)]?.[a0_0x308b79(0xf0)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x5bace5=a0_0x308b79;if(!tg)return;try{tg[_0x5bace5(0x12f)](),tg[_0x5bace5(0xec)](),tg['setHeaderColor']?.('#050505');if(tg[_0x5bace5(0xfd)]?.(_0x5bace5(0x117)))tg[_0x5bace5(0xdb)]?.();const _0x583a36=tg[_0x5bace5(0x122)];if(_0x583a36){_0x583a36[_0x5bace5(0x124)]();if(typeof _0x583a36[_0x5bace5(0x12b)]===_0x5bace5(0x139))try{_0x583a36[_0x5bace5(0x12b)]();}catch(_0x4af79f){}_0x583a36[_0x5bace5(0x148)](()=>{const _0x4b3d38=_0x5bace5;if(tg[_0x4b3d38(0xed)])tg[_0x4b3d38(0xed)][_0x4b3d38(0xd9)]('light');location['href']=HOME_URL;});}}catch(_0x5dfcfa){console[_0x5bace5(0xd6)]('TG\x20setup\x20error:',_0x5dfcfa);}}(function initStableLayout(){const _0x825d68=a0_0x308b79,_0x391c63=(function(){let _0x59352d=!![];return function(_0x52e100,_0x195d25){const _0x589852=_0x59352d?function(){const _0x13b697=a0_0x4dfd;if(_0x195d25){const _0xa5face=_0x195d25[_0x13b697(0x11d)](_0x52e100,arguments);return _0x195d25=null,_0xa5face;}}:function(){};return _0x59352d=![],_0x589852;};}()),_0x4a6226=document[_0x825d68(0x103)](_0x825d68(0x11c)),_0x90eaeb=document[_0x825d68(0xf7)](_0x825d68(0x13e)),_0x102b83=document[_0x825d68(0xf7)](_0x825d68(0x150)),_0xf780be=document[_0x825d68(0xf7)](_0x825d68(0x12a));function _0x541aaf(){const _0x19c3f1=_0x825d68,_0x53fefc=_0x391c63(this,function(){const _0x1bf36f=a0_0x4dfd;return _0x53fefc[_0x1bf36f(0x144)]()[_0x1bf36f(0x14f)](_0x1bf36f(0x13a))[_0x1bf36f(0x144)]()['constructor'](_0x53fefc)['search'](_0x1bf36f(0x13a));});_0x53fefc();if(!_0x4a6226)return;const _0x1fa1a1=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x19c3f1(0x11a)];_0x4a6226['style'][_0x19c3f1(0xe0)]=_0x1fa1a1+'px';if(_0x90eaeb){const _0x2965eb=_0x90eaeb['offsetHeight'];_0x102b83[_0x19c3f1(0xff)][_0x19c3f1(0xfe)]=_0x2965eb+0x28+'px';}}tg?tg[_0x825d68(0x111)](_0x825d68(0x101),({isStateStable:_0x3aac5c})=>{_0x541aaf();if(_0x3aac5c)requestAnimationFrame(()=>{const _0x3c0d9b=a0_0x4dfd;_0x102b83[_0x3c0d9b(0x13b)]=_0x102b83[_0x3c0d9b(0x140)];});}):window[_0x825d68(0xcf)]('resize',_0x541aaf),_0x541aaf(),_0xf780be&&(_0xf780be[_0x825d68(0xcf)](_0x825d68(0xd7),()=>{requestAnimationFrame(_0x541aaf);}),_0xf780be[_0x825d68(0xcf)](_0x825d68(0xd4),()=>{setTimeout(()=>{_0x102b83['scrollTop']=_0x102b83['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x308b79(0x137),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x308b79(0xf7)](a0_0x308b79(0x150)),emptyState=document[a0_0x308b79(0xf7)](a0_0x308b79(0xe6)),messageInput=document[a0_0x308b79(0xf7)](a0_0x308b79(0x12a)),sendBtn=document[a0_0x308b79(0xf7)](a0_0x308b79(0x135)),clearBtn=document[a0_0x308b79(0xf7)](a0_0x308b79(0x104)),modal=document[a0_0x308b79(0xf7)]('confirmModal'),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x308b79(0xf7)]('modalText');let modalCallback=null;async function callBackend(_0x5ad921,_0x25b4fe){const _0x42a574=a0_0x308b79,_0x32b283=tg?.[_0x42a574(0x13c)]?.[_0x42a574(0x10e)]||{},_0xd4bbd7=_0x32b283['id']||localStorage[_0x42a574(0x125)](_0x42a574(0x11f))||'d-'+Math[_0x42a574(0x146)](Math[_0x42a574(0xf5)]()*0x3b9aca00);if(!_0x32b283['id'])localStorage['setItem'](_0x42a574(0x11f),_0xd4bbd7);const _0x5b0282={'action':_0x5ad921,'user_id':_0xd4bbd7,'user_data':{'first_name':_0x32b283[_0x42a574(0x141)],'username':_0x32b283['username']},'init_data':tg?.['initData']||'',..._0x25b4fe},_0x4b9cc7=new AbortController(),_0x1187bb=setTimeout(()=>_0x4b9cc7['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3f14b8=await fetch(BACKEND_URL,{'method':_0x42a574(0x11e),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x42a574(0x13d)](_0x5b0282),'signal':_0x4b9cc7[_0x42a574(0xd8)]});return clearTimeout(_0x1187bb),await _0x3f14b8[_0x42a574(0x134)]();}catch(_0x59dc4b){return{'success':![],'error':String(_0x59dc4b)};}}function formatTime(_0x42be4d){const _0x343f68=a0_0x308b79,_0x2fafd8=new Date(_0x42be4d);return String(_0x2fafd8[_0x343f68(0xf8)]())['padStart'](0x2,'0')+':'+String(_0x2fafd8[_0x343f68(0xe7)]())[_0x343f68(0x105)](0x2,'0');}function createMessageElement(_0x247845,_0x139a83){const _0x291990=a0_0x308b79,_0x63cc5d=document[_0x291990(0x10b)]('div');_0x63cc5d['className']='message\x20'+_0x247845[_0x291990(0x12c)];const _0x53b251=document[_0x291990(0x10b)](_0x291990(0x113));_0x53b251[_0x291990(0x142)]=_0x291990(0x116),_0x53b251[_0x291990(0x114)]=_0x247845[_0x291990(0x131)][_0x291990(0x119)](/\n/g,_0x291990(0xeb));const _0x568263=document[_0x291990(0x10b)](_0x291990(0x113));_0x568263[_0x291990(0x142)]=_0x291990(0x107),_0x568263['innerHTML']=_0x291990(0xe4),_0x568263['onclick']=_0x484a45=>{const _0x57a0fe=_0x291990;_0x484a45[_0x57a0fe(0x10a)](),confirmDelete(_0x139a83);};let _0x2ca1a2;_0x53b251['addEventListener'](_0x291990(0xdd),()=>_0x2ca1a2=setTimeout(()=>{const _0x5c5778=_0x291990;_0x63cc5d[_0x5c5778(0xde)]['add'](_0x5c5778(0x106));if(tg?.[_0x5c5778(0xed)])tg[_0x5c5778(0xed)][_0x5c5778(0xd9)]('medium');},0x1f4)),_0x53b251[_0x291990(0xcf)](_0x291990(0xdc),()=>clearTimeout(_0x2ca1a2));const _0x41615e=document[_0x291990(0x10b)](_0x291990(0x113));return _0x41615e[_0x291990(0x142)]='message-time',_0x41615e[_0x291990(0xd5)]=formatTime(_0x247845[_0x291990(0x149)]),_0x63cc5d[_0x291990(0x130)](_0x568263),_0x63cc5d['appendChild'](_0x53b251),_0x63cc5d[_0x291990(0x130)](_0x41615e),_0x63cc5d;}function createTypingIndicator(){const _0x37fb3e=a0_0x308b79,_0x1c345f=document[_0x37fb3e(0x10b)]('div');return _0x1c345f[_0x37fb3e(0x142)]=_0x37fb3e(0xea),_0x1c345f['id']=_0x37fb3e(0x10d),_0x1c345f[_0x37fb3e(0x114)]=_0x37fb3e(0xda),_0x1c345f;}function renderMessages(){const _0x104d7c=a0_0x308b79;Array['from'](chatArea[_0x104d7c(0xe8)])[_0x104d7c(0x12d)](_0x1a6b65=>{const _0x1edd23=_0x104d7c;if(_0x1a6b65['id']!==_0x1edd23(0xe6))_0x1a6b65['remove']();}),messages[_0x104d7c(0xf9)]>0x0?(emptyState[_0x104d7c(0xff)]['display']=_0x104d7c(0x112),messages[_0x104d7c(0x12d)]((_0x41b03e,_0x3126ff)=>chatArea[_0x104d7c(0x130)](createMessageElement(_0x41b03e,_0x3126ff)))):emptyState[_0x104d7c(0xff)][_0x104d7c(0x102)]=_0x104d7c(0x129),requestAnimationFrame(()=>chatArea[_0x104d7c(0x13b)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0xf9a582=a0_0x308b79;messageInput[_0xf9a582(0xff)][_0xf9a582(0xe0)]=_0xf9a582(0xef),messageInput[_0xf9a582(0xff)][_0xf9a582(0xe0)]=Math[_0xf9a582(0x143)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x1e66b9=a0_0x308b79,_0x44f01d=messageInput[_0x1e66b9(0x151)][_0x1e66b9(0x132)]();sendBtn[_0x1e66b9(0x121)]=!_0x44f01d||isTyping;}async function sendMessage(){const _0x553995=a0_0x308b79,_0xbc39c3=messageInput[_0x553995(0x151)]['trim']();if(!_0xbc39c3||isTyping)return;if(tg?.[_0x553995(0xed)])tg[_0x553995(0xed)][_0x553995(0xd9)](_0x553995(0xe2));messages[_0x553995(0xe5)]({'role':'user','content':_0xbc39c3,'timestamp':Date['now']()}),localStorage[_0x553995(0x100)]('ai_chat_messages',JSON[_0x553995(0x13d)](messages)),renderMessages(),messageInput[_0x553995(0x151)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x553995(0x130)](createTypingIndicator()),chatArea[_0x553995(0x13b)]=chatArea[_0x553995(0x140)];const _0x2128af=await callBackend(_0x553995(0xf3),{'message':_0xbc39c3});isTyping=![];const _0x1243ee=document['getElementById'](_0x553995(0x10d));if(_0x1243ee)_0x1243ee['remove']();let _0x5c42fd=_0x553995(0xdf);if(_0x2128af[_0x553995(0xfc)]){_0x5c42fd=_0x2128af[_0x553995(0x14b)]||_0x553995(0x123);if(tg?.[_0x553995(0xed)])tg[_0x553995(0xed)][_0x553995(0xd3)](_0x553995(0xfc));}else{_0x5c42fd=_0x2128af['error']||_0x553995(0x10f);if(tg?.[_0x553995(0xed)])tg[_0x553995(0xed)][_0x553995(0xd3)](_0x553995(0x136));}messages[_0x553995(0xe5)]({'role':'ai','content':_0x5c42fd,'timestamp':Date[_0x553995(0x138)]()}),localStorage['setItem'](_0x553995(0x109),JSON[_0x553995(0x13d)](messages)),renderMessages();}function confirmDelete(_0xf1b2db){const _0x4fb765=a0_0x308b79;if(mTitle)mTitle[_0x4fb765(0xd5)]=_0x4fb765(0xf6);if(mText)mText[_0x4fb765(0xd5)]=_0x4fb765(0xf4);modalCallback=()=>{const _0x54fcee=_0x4fb765;messages[_0x54fcee(0xf2)](_0xf1b2db,0x1),localStorage[_0x54fcee(0x100)](_0x54fcee(0x109),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x4fb765(0x147)](_0x4fb765(0x124));}if(clearBtn)clearBtn[a0_0x308b79(0x14e)]=()=>{const _0x2b83d5=a0_0x308b79;if(!messages['length'])return;if(mTitle)mTitle[_0x2b83d5(0xd5)]=_0x2b83d5(0xfb);if(mText)mText[_0x2b83d5(0xd5)]=_0x2b83d5(0x12e);modalCallback=async()=>{const _0x5472e8=_0x2b83d5;messages=[],localStorage[_0x5472e8(0x115)](_0x5472e8(0x109)),renderMessages(),callBackend(_0x5472e8(0xe9),{});},modal[_0x2b83d5(0xde)]['add'](_0x2b83d5(0x124));};function a0_0x5473(){const _0x14fa42=['getHours','length','remove','Очистить\x20историю?','success','isVersionAtLeast','paddingBottom','style','setItem','viewportChanged','display','querySelector','clearBtn','padStart','show-delete','delete-btn','101862mHzugq','ai_chat_messages','stopPropagation','createElement','key','typingIndicator','user','Ошибка\x20сервера','contains','onEvent','none','div','innerHTML','removeItem','message-bubble','6.1','keydown','replace','innerHeight','640SsWJHY','.container','apply','POST','debug_uid','1706024PbQnDZ','disabled','BackButton','Пустой\x20ответ','show','getItem','modalCancel','172496CybWVq','shiftKey','flex','messageInput','offClick','role','forEach','Начнется\x20новый\x20диалог.','ready','appendChild','content','trim','78054BfuxLW','json','sendBtn','error','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','now','function','(((.+)+)+)+$','scrollTop','initDataUnsafe','stringify','inputArea','7bPwhhF','scrollHeight','first_name','className','min','toString','10510544oeBAEZ','floor','add','onClick','timestamp','preventDefault','text','querySelectorAll','370iEBZGw','onclick','search','chatArea','value','addEventListener','click','6THWmbX','Enter','notificationOccurred','focus','textContent','warn','input','signal','impactOccurred','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','disableVerticalSwipes','touchend','touchstart','classList','Ошибка\x20сети','height','Telegram','light','1061040qFswJk','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','push','emptyState','getMinutes','children','clear_history','message\x20ai','<br>','expand','HapticFeedback','.message.show-delete','auto','WebApp','4981192ZMbNUS','splice','send_message','Действие\x20необратимо.','random','Удалить?','getElementById'];a0_0x5473=function(){return _0x14fa42;};return a0_0x5473();}document[a0_0x308b79(0xf7)](a0_0x308b79(0x126))[a0_0x308b79(0x14e)]=()=>modal[a0_0x308b79(0xde)][a0_0x308b79(0xfa)]('show'),document['getElementById']('modalConfirm')[a0_0x308b79(0x14e)]=()=>{const _0x551294=a0_0x308b79;if(modalCallback)modalCallback();modal[_0x551294(0xde)][_0x551294(0xfa)](_0x551294(0x124));},messageInput[a0_0x308b79(0xcf)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x308b79(0xcf)](a0_0x308b79(0x118),_0x3d01da=>{const _0x22b404=a0_0x308b79;_0x3d01da[_0x22b404(0x10c)]===_0x22b404(0xd2)&&!_0x3d01da[_0x22b404(0x128)]&&(_0x3d01da[_0x22b404(0x14a)](),sendMessage());}),sendBtn[a0_0x308b79(0x14e)]=sendMessage,document[a0_0x308b79(0xcf)](a0_0x308b79(0xd0),_0x32d4ea=>{const _0x46b0f5=a0_0x308b79;document[_0x46b0f5(0x14c)](_0x46b0f5(0xee))[_0x46b0f5(0x12d)](_0x200641=>{const _0x3181ed=_0x46b0f5;if(!_0x200641[_0x3181ed(0x110)](_0x32d4ea['target']))_0x200641[_0x3181ed(0xde)]['remove'](_0x3181ed(0x106));});});const saved=localStorage['getItem'](a0_0x308b79(0x109));function a0_0x4dfd(_0x322392,_0x11ecf6){_0x322392=_0x322392-0xcf;const _0x16c0c9=a0_0x5473();let _0x5e04be=_0x16c0c9[_0x322392];return _0x5e04be;}if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x5ab182){}updateSendButton();