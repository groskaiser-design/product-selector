const a0_0xbd7aac=a0_0x1846;(function(_0x49daa9,_0x22d1cb){const _0x1daaf3=a0_0x1846,_0x5ae8c9=_0x49daa9();while(!![]){try{const _0x3265b7=parseInt(_0x1daaf3(0xf3))/0x1*(parseInt(_0x1daaf3(0x9f))/0x2)+parseInt(_0x1daaf3(0xae))/0x3*(-parseInt(_0x1daaf3(0xc7))/0x4)+parseInt(_0x1daaf3(0x8d))/0x5+-parseInt(_0x1daaf3(0xc0))/0x6*(parseInt(_0x1daaf3(0x8c))/0x7)+-parseInt(_0x1daaf3(0xa4))/0x8*(-parseInt(_0x1daaf3(0x88))/0x9)+parseInt(_0x1daaf3(0xad))/0xa+-parseInt(_0x1daaf3(0xc5))/0xb;if(_0x3265b7===_0x22d1cb)break;else _0x5ae8c9['push'](_0x5ae8c9['shift']());}catch(_0x2eb509){_0x5ae8c9['push'](_0x5ae8c9['shift']());}}}(a0_0x185b,0x84774));const tg=window[a0_0xbd7aac(0xe7)]?.[a0_0xbd7aac(0x82)],HOME_URL=a0_0xbd7aac(0xb3);function a0_0x1846(_0x2b11cc,_0x4fea01){_0x2b11cc=_0x2b11cc-0x82;const _0x5da068=a0_0x185b();let _0x25b66a=_0x5da068[_0x2b11cc];return _0x25b66a;}function setupTelegramBackButton(){const _0x4c3480=a0_0xbd7aac,_0x2db1b6=(function(){let _0x4a2681=!![];return function(_0x45789d,_0x23728c){const _0x3d0c55=_0x4a2681?function(){const _0x52b8ea=a0_0x1846;if(_0x23728c){const _0x301aee=_0x23728c[_0x52b8ea(0xec)](_0x45789d,arguments);return _0x23728c=null,_0x301aee;}}:function(){};return _0x4a2681=![],_0x3d0c55;};}()),_0x1057ca=_0x2db1b6(this,function(){const _0x42dc30=a0_0x1846;return _0x1057ca['toString']()['search'](_0x42dc30(0x8f))[_0x42dc30(0x94)]()[_0x42dc30(0x96)](_0x1057ca)[_0x42dc30(0xc1)]('(((.+)+)+)+$');});_0x1057ca();if(!tg)return;try{tg[_0x4c3480(0x95)](),tg[_0x4c3480(0xb7)](),tg['setHeaderColor']?.(_0x4c3480(0x8a));if(tg['isVersionAtLeast']?.('6.1'))tg['disableVerticalSwipes']?.();const _0x467bae=tg[_0x4c3480(0xd9)];if(_0x467bae){_0x467bae['show']();if(typeof _0x467bae[_0x4c3480(0x8e)]===_0x4c3480(0xc8))try{_0x467bae[_0x4c3480(0x8e)]();}catch(_0x20441a){}_0x467bae['onClick'](()=>{const _0x754a7d=_0x4c3480;if(tg[_0x754a7d(0xeb)])tg['HapticFeedback'][_0x754a7d(0x9d)]('light');location['href']=HOME_URL;});}}catch(_0x247860){console[_0x4c3480(0x93)](_0x4c3480(0xd1),_0x247860);}}function a0_0x185b(){const _0x41f4d0=['getHours','show','style','add','TG\x20setup\x20error:','display','input','scrollTop','addEventListener','clearBtn','user','inputArea','BackButton','typingIndicator','onEvent','ai_chat_messages','textContent','sendBtn','setItem','preventDefault','from','removeItem','none','stopPropagation','resize','modalCancel','Telegram','children','getItem','paddingBottom','HapticFeedback','apply','className','div','getMinutes','medium','signal','auto','118YkQKeI','content','height','Удалить?','debug_uid','username','createElement','WebApp','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','remove','<br>','push','stringify','36Ltyfee','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','#050505','length','6864697CfpyKa','1139965NmYsyg','offClick','(((.+)+)+)+$','scrollHeight','modalTitle','messageInput','warn','toString','ready','constructor','touchstart','appendChild','floor','viewportHeight','forEach','key','impactOccurred','value','10862qlSSqj','focus','success','classList','modalConfirm','1038264zIlcyM','querySelector','onclick','getElementById','text/plain','offsetHeight','delete-btn','Пустой\x20ответ','disabled','3017520vYgGnQ','18WCDwUH','first_name','modalText','timestamp','viewportChanged','./router.html','message-bubble','text','trim','expand','min','chatArea','replace','clear_history','innerHTML','show-delete','splice','initData','6ckstPi','search','click','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','parse','1792120PDUENJ','message\x20ai','2376IWOWfP','function','padStart','initDataUnsafe','querySelectorAll','notificationOccurred'];a0_0x185b=function(){return _0x41f4d0;};return a0_0x185b();}(function initStableLayout(){const _0xf17555=a0_0xbd7aac,_0x43b2dd=document[_0xf17555(0xa5)]('.container'),_0x173335=document[_0xf17555(0xa7)](_0xf17555(0xd8)),_0x36051c=document['getElementById'](_0xf17555(0xb9)),_0x581655=document[_0xf17555(0xa7)](_0xf17555(0x92));function _0xe1fa99(){const _0x17ffda=_0xf17555;if(!_0x43b2dd)return;const _0x692f8e=tg&&tg[_0x17ffda(0x9a)]?tg['viewportHeight']:window['innerHeight'];_0x43b2dd[_0x17ffda(0xcf)][_0x17ffda(0xf5)]=_0x692f8e+'px';if(_0x173335){const _0xe261be=_0x173335[_0x17ffda(0xa9)];_0x36051c[_0x17ffda(0xcf)][_0x17ffda(0xea)]=_0xe261be+0x28+'px';}}tg?tg[_0xf17555(0xdb)](_0xf17555(0xb2),({isStateStable:_0x4d1900})=>{_0xe1fa99();if(_0x4d1900)requestAnimationFrame(()=>{const _0x28fc2c=a0_0x1846;_0x36051c[_0x28fc2c(0xd4)]=_0x36051c[_0x28fc2c(0x90)];});}):window['addEventListener'](_0xf17555(0xe5),_0xe1fa99),_0xe1fa99(),_0x581655&&(_0x581655[_0xf17555(0xd5)](_0xf17555(0xd3),()=>{requestAnimationFrame(_0xe1fa99);}),_0x581655['addEventListener'](_0xf17555(0xa0),()=>{setTimeout(()=>{const _0x5443bb=a0_0x1846;_0x36051c[_0x5443bb(0xd4)]=_0x36051c[_0x5443bb(0x90)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xbd7aac(0x89),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xbd7aac(0xa7)](a0_0xbd7aac(0xb9)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0xbd7aac(0xa7)](a0_0xbd7aac(0x92)),sendBtn=document[a0_0xbd7aac(0xa7)](a0_0xbd7aac(0xde)),clearBtn=document[a0_0xbd7aac(0xa7)](a0_0xbd7aac(0xd6)),modal=document[a0_0xbd7aac(0xa7)]('confirmModal'),mTitle=document[a0_0xbd7aac(0xa7)](a0_0xbd7aac(0x91)),mText=document[a0_0xbd7aac(0xa7)](a0_0xbd7aac(0xb0));let modalCallback=null;async function callBackend(_0x420fd1,_0xbc1253){const _0x5c5e75=a0_0xbd7aac,_0x54061e=tg?.[_0x5c5e75(0xca)]?.[_0x5c5e75(0xd7)]||{},_0x1ae953=_0x54061e['id']||localStorage[_0x5c5e75(0xe9)](_0x5c5e75(0xf7))||'d-'+Math[_0x5c5e75(0x99)](Math['random']()*0x3b9aca00);if(!_0x54061e['id'])localStorage['setItem'](_0x5c5e75(0xf7),_0x1ae953);const _0x65e549={'action':_0x420fd1,'user_id':_0x1ae953,'user_data':{'first_name':_0x54061e[_0x5c5e75(0xaf)],'username':_0x54061e[_0x5c5e75(0xf8)]},'init_data':tg?.[_0x5c5e75(0xbf)]||'',..._0xbc1253},_0x4f2d1d=new AbortController(),_0x3e507d=setTimeout(()=>_0x4f2d1d['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3bba5d=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x5c5e75(0xa8)},'body':JSON[_0x5c5e75(0x87)](_0x65e549),'signal':_0x4f2d1d[_0x5c5e75(0xf1)]});return clearTimeout(_0x3e507d),await _0x3bba5d['json']();}catch(_0x1fae3b){return{'success':![],'error':String(_0x1fae3b)};}}function formatTime(_0x2e5027){const _0x3c58fa=a0_0xbd7aac,_0x2b2f19=new Date(_0x2e5027);return String(_0x2b2f19[_0x3c58fa(0xcd)]())[_0x3c58fa(0xc9)](0x2,'0')+':'+String(_0x2b2f19[_0x3c58fa(0xef)]())[_0x3c58fa(0xc9)](0x2,'0');}function createMessageElement(_0x353c3f,_0x307e23){const _0x11e231=a0_0xbd7aac,_0x2553a5=document[_0x11e231(0xf9)](_0x11e231(0xee));_0x2553a5[_0x11e231(0xed)]='message\x20'+_0x353c3f['role'];const _0x4d844d=document['createElement'](_0x11e231(0xee));_0x4d844d[_0x11e231(0xed)]=_0x11e231(0xb4),_0x4d844d[_0x11e231(0xbc)]=_0x353c3f[_0x11e231(0xf4)][_0x11e231(0xba)](/\n/g,_0x11e231(0x85));const _0x151305=document[_0x11e231(0xf9)](_0x11e231(0xee));_0x151305[_0x11e231(0xed)]=_0x11e231(0xaa),_0x151305[_0x11e231(0xbc)]=_0x11e231(0xc3),_0x151305['onclick']=_0x194c7=>{const _0x18f3f3=_0x11e231;_0x194c7[_0x18f3f3(0xe4)](),confirmDelete(_0x307e23);};let _0x34aaff;_0x4d844d[_0x11e231(0xd5)](_0x11e231(0x97),()=>_0x34aaff=setTimeout(()=>{const _0x3add61=_0x11e231;_0x2553a5['classList'][_0x3add61(0xd0)](_0x3add61(0xbd));if(tg?.['HapticFeedback'])tg['HapticFeedback']['impactOccurred'](_0x3add61(0xf0));},0x1f4)),_0x4d844d[_0x11e231(0xd5)]('touchend',()=>clearTimeout(_0x34aaff));const _0x2f0f53=document[_0x11e231(0xf9)](_0x11e231(0xee));return _0x2f0f53[_0x11e231(0xed)]='message-time',_0x2f0f53[_0x11e231(0xdd)]=formatTime(_0x353c3f[_0x11e231(0xb1)]),_0x2553a5[_0x11e231(0x98)](_0x151305),_0x2553a5['appendChild'](_0x4d844d),_0x2553a5[_0x11e231(0x98)](_0x2f0f53),_0x2553a5;}function createTypingIndicator(){const _0x2e174f=a0_0xbd7aac,_0x2c3eb7=document[_0x2e174f(0xf9)](_0x2e174f(0xee));return _0x2c3eb7['className']=_0x2e174f(0xc6),_0x2c3eb7['id']=_0x2e174f(0xda),_0x2c3eb7['innerHTML']=_0x2e174f(0x83),_0x2c3eb7;}function renderMessages(){const _0x2a0a1f=a0_0xbd7aac;Array[_0x2a0a1f(0xe1)](chatArea[_0x2a0a1f(0xe8)])[_0x2a0a1f(0x9b)](_0x153781=>{const _0x4cd8e2=_0x2a0a1f;if(_0x153781['id']!=='emptyState')_0x153781[_0x4cd8e2(0x84)]();}),messages[_0x2a0a1f(0x8b)]>0x0?(emptyState[_0x2a0a1f(0xcf)]['display']=_0x2a0a1f(0xe3),messages[_0x2a0a1f(0x9b)]((_0xe6deed,_0x4a41e5)=>chatArea[_0x2a0a1f(0x98)](createMessageElement(_0xe6deed,_0x4a41e5)))):emptyState[_0x2a0a1f(0xcf)][_0x2a0a1f(0xd2)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x2a0a1f(0x90)]);}function autoResizeTextarea(){const _0xb0b689=a0_0xbd7aac;messageInput['style'][_0xb0b689(0xf5)]=_0xb0b689(0xf2),messageInput[_0xb0b689(0xcf)][_0xb0b689(0xf5)]=Math[_0xb0b689(0xb8)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x551894=a0_0xbd7aac,_0x51939a=messageInput['value'][_0x551894(0xb6)]();sendBtn[_0x551894(0xac)]=!_0x51939a||isTyping;}async function sendMessage(){const _0x577490=a0_0xbd7aac,_0x568598=messageInput[_0x577490(0x9e)][_0x577490(0xb6)]();if(!_0x568598||isTyping)return;if(tg?.[_0x577490(0xeb)])tg['HapticFeedback'][_0x577490(0x9d)]('light');messages[_0x577490(0x86)]({'role':_0x577490(0xd7),'content':_0x568598,'timestamp':Date['now']()}),localStorage[_0x577490(0xdf)](_0x577490(0xdc),JSON['stringify'](messages)),renderMessages(),messageInput[_0x577490(0x9e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x577490(0x98)](createTypingIndicator()),chatArea[_0x577490(0xd4)]=chatArea['scrollHeight'];const _0x19f67c=await callBackend('send_message',{'message':_0x568598});isTyping=![];const _0x1739d2=document['getElementById']('typingIndicator');if(_0x1739d2)_0x1739d2[_0x577490(0x84)]();let _0x3f04a5='Ошибка\x20сети';if(_0x19f67c[_0x577490(0xa1)]){_0x3f04a5=_0x19f67c[_0x577490(0xb5)]||_0x577490(0xab);if(tg?.[_0x577490(0xeb)])tg[_0x577490(0xeb)][_0x577490(0xcc)]('success');}else{_0x3f04a5=_0x19f67c['error']||'Ошибка\x20сервера';if(tg?.[_0x577490(0xeb)])tg[_0x577490(0xeb)]['notificationOccurred']('error');}messages[_0x577490(0x86)]({'role':'ai','content':_0x3f04a5,'timestamp':Date['now']()}),localStorage['setItem'](_0x577490(0xdc),JSON[_0x577490(0x87)](messages)),renderMessages();}function confirmDelete(_0x336aff){const _0x101493=a0_0xbd7aac;if(mTitle)mTitle[_0x101493(0xdd)]=_0x101493(0xf6);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x364c5a=_0x101493;messages[_0x364c5a(0xbe)](_0x336aff,0x1),localStorage[_0x364c5a(0xdf)](_0x364c5a(0xdc),JSON[_0x364c5a(0x87)](messages)),renderMessages();},modal[_0x101493(0xa2)][_0x101493(0xd0)]('show');}if(clearBtn)clearBtn[a0_0xbd7aac(0xa6)]=()=>{const _0x5db8a2=a0_0xbd7aac;if(!messages[_0x5db8a2(0x8b)])return;if(mTitle)mTitle[_0x5db8a2(0xdd)]='Очистить\x20историю?';if(mText)mText[_0x5db8a2(0xdd)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x3d43cd=_0x5db8a2;messages=[],localStorage[_0x3d43cd(0xe2)](_0x3d43cd(0xdc)),renderMessages(),callBackend(_0x3d43cd(0xbb),{});},modal[_0x5db8a2(0xa2)][_0x5db8a2(0xd0)](_0x5db8a2(0xce));};document[a0_0xbd7aac(0xa7)](a0_0xbd7aac(0xe6))['onclick']=()=>modal[a0_0xbd7aac(0xa2)][a0_0xbd7aac(0x84)](a0_0xbd7aac(0xce)),document[a0_0xbd7aac(0xa7)](a0_0xbd7aac(0xa3))['onclick']=()=>{const _0x203025=a0_0xbd7aac;if(modalCallback)modalCallback();modal['classList'][_0x203025(0x84)]('show');},messageInput[a0_0xbd7aac(0xd5)](a0_0xbd7aac(0xd3),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xbd7aac(0xd5)]('keydown',_0x154721=>{const _0x28840a=a0_0xbd7aac;_0x154721[_0x28840a(0x9c)]==='Enter'&&!_0x154721['shiftKey']&&(_0x154721[_0x28840a(0xe0)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0xbd7aac(0xc2),_0x2bdc73=>{const _0x277982=a0_0xbd7aac;document[_0x277982(0xcb)]('.message.show-delete')[_0x277982(0x9b)](_0x52776e=>{const _0x246a8d=_0x277982;if(!_0x52776e['contains'](_0x2bdc73['target']))_0x52776e[_0x246a8d(0xa2)][_0x246a8d(0x84)](_0x246a8d(0xbd));});});const saved=localStorage[a0_0xbd7aac(0xe9)](a0_0xbd7aac(0xdc));if(saved)try{messages=JSON[a0_0xbd7aac(0xc4)](saved),renderMessages();}catch(a0_0x5568f7){}updateSendButton();