const a0_0x1e6286=a0_0x4936;(function(_0x3fcf03,_0x31fff5){const _0x1d57ad=a0_0x4936,_0x174c31=_0x3fcf03();while(!![]){try{const _0x73ed96=parseInt(_0x1d57ad(0x25f))/0x1+parseInt(_0x1d57ad(0x264))/0x2+-parseInt(_0x1d57ad(0x1f3))/0x3+-parseInt(_0x1d57ad(0x233))/0x4*(parseInt(_0x1d57ad(0x255))/0x5)+-parseInt(_0x1d57ad(0x1fe))/0x6+parseInt(_0x1d57ad(0x23f))/0x7+-parseInt(_0x1d57ad(0x231))/0x8*(-parseInt(_0x1d57ad(0x201))/0x9);if(_0x73ed96===_0x31fff5)break;else _0x174c31['push'](_0x174c31['shift']());}catch(_0x13a71f){_0x174c31['push'](_0x174c31['shift']());}}}(a0_0x36d3,0xcc5c8));const tg=window[a0_0x1e6286(0x218)]?.[a0_0x1e6286(0x205)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x84a7b2=a0_0x1e6286,_0xbaade2=(function(){let _0x1ca071=!![];return function(_0x424613,_0x42ffcb){const _0x21837a=_0x1ca071?function(){const _0x96bb66=a0_0x4936;if(_0x42ffcb){const _0x148ec3=_0x42ffcb[_0x96bb66(0x207)](_0x424613,arguments);return _0x42ffcb=null,_0x148ec3;}}:function(){};return _0x1ca071=![],_0x21837a;};}()),_0x435137=_0xbaade2(this,function(){const _0x4732c7=a0_0x4936;return _0x435137[_0x4732c7(0x1f9)]()[_0x4732c7(0x267)](_0x4732c7(0x222))[_0x4732c7(0x1f9)]()[_0x4732c7(0x24c)](_0x435137)[_0x4732c7(0x267)](_0x4732c7(0x222));});_0x435137();if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x84a7b2(0x230)]?.(_0x84a7b2(0x1fa));if(tg[_0x84a7b2(0x246)]?.('6.1'))tg[_0x84a7b2(0x257)]?.();const _0x349b9f=tg[_0x84a7b2(0x262)];if(_0x349b9f){_0x349b9f[_0x84a7b2(0x20a)]();if(typeof _0x349b9f[_0x84a7b2(0x243)]===_0x84a7b2(0x22c))try{_0x349b9f[_0x84a7b2(0x243)]();}catch(_0x150cd1){}_0x349b9f[_0x84a7b2(0x25c)](()=>{const _0xf87d8e=_0x84a7b2;if(tg[_0xf87d8e(0x268)])tg[_0xf87d8e(0x268)][_0xf87d8e(0x240)]('light');location[_0xf87d8e(0x20f)]=HOME_URL;});}}catch(_0x31c69d){console['warn'](_0x84a7b2(0x24d),_0x31c69d);}}(function initStableLayout(){const _0x46046a=a0_0x1e6286,_0x2e04da=document[_0x46046a(0x224)](_0x46046a(0x265)),_0x889a2e=document[_0x46046a(0x24f)](_0x46046a(0x25e)),_0x4a2061=document[_0x46046a(0x24f)](_0x46046a(0x223)),_0x441b1a=document[_0x46046a(0x24f)](_0x46046a(0x21b));function _0x1ce27e(){const _0x3d3914=_0x46046a;if(!_0x2e04da)return;const _0x45f2e6=tg&&tg[_0x3d3914(0x259)]?tg[_0x3d3914(0x259)]:window[_0x3d3914(0x236)];_0x2e04da[_0x3d3914(0x235)][_0x3d3914(0x208)]=_0x45f2e6+'px';if(_0x889a2e){const _0xb2fce3=_0x889a2e[_0x3d3914(0x250)];_0x4a2061[_0x3d3914(0x235)][_0x3d3914(0x21a)]=_0xb2fce3+0x28+'px';}}tg?tg['onEvent'](_0x46046a(0x26b),({isStateStable:_0x2e2a8c})=>{_0x1ce27e();if(_0x2e2a8c)requestAnimationFrame(()=>{const _0x5adbe6=a0_0x4936;_0x4a2061[_0x5adbe6(0x261)]=_0x4a2061[_0x5adbe6(0x20c)];});}):window['addEventListener'](_0x46046a(0x24b),_0x1ce27e),_0x1ce27e(),_0x441b1a&&(_0x441b1a[_0x46046a(0x226)](_0x46046a(0x1f6),()=>{requestAnimationFrame(_0x1ce27e);}),_0x441b1a[_0x46046a(0x226)](_0x46046a(0x1f4),()=>{setTimeout(()=>{const _0x37f22b=a0_0x4936;_0x4a2061[_0x37f22b(0x261)]=_0x4a2061[_0x37f22b(0x20c)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1e6286(0x202),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1e6286(0x24f)](a0_0x1e6286(0x223)),emptyState=document['getElementById'](a0_0x1e6286(0x232)),messageInput=document[a0_0x1e6286(0x24f)]('messageInput'),sendBtn=document[a0_0x1e6286(0x24f)](a0_0x1e6286(0x252)),clearBtn=document['getElementById'](a0_0x1e6286(0x210)),modal=document[a0_0x1e6286(0x24f)]('confirmModal'),mTitle=document[a0_0x1e6286(0x24f)](a0_0x1e6286(0x214)),mText=document[a0_0x1e6286(0x24f)](a0_0x1e6286(0x213));let modalCallback=null;async function callBackend(_0x470988,_0x3c3b83){const _0xaed6a1=a0_0x1e6286,_0x1f6a35=tg?.[_0xaed6a1(0x258)]?.[_0xaed6a1(0x24e)]||{},_0x4ba56f=_0x1f6a35['id']||localStorage[_0xaed6a1(0x25a)]('debug_uid')||'d-'+Math['floor'](Math[_0xaed6a1(0x1f2)]()*0x3b9aca00);if(!_0x1f6a35['id'])localStorage[_0xaed6a1(0x239)](_0xaed6a1(0x256),_0x4ba56f);const _0x252242={'action':_0x470988,'user_id':_0x4ba56f,'user_data':{'first_name':_0x1f6a35[_0xaed6a1(0x20e)],'username':_0x1f6a35['username']},'init_data':tg?.[_0xaed6a1(0x237)]||'',..._0x3c3b83},_0x25a2cf=new AbortController(),_0x520525=setTimeout(()=>_0x25a2cf[_0xaed6a1(0x254)](),REQUEST_TIMEOUT_MS);try{const _0x4de5cd=await fetch(BACKEND_URL,{'method':_0xaed6a1(0x22b),'headers':{'Content-Type':_0xaed6a1(0x260)},'body':JSON[_0xaed6a1(0x20d)](_0x252242),'signal':_0x25a2cf[_0xaed6a1(0x209)]});return clearTimeout(_0x520525),await _0x4de5cd[_0xaed6a1(0x1ff)]();}catch(_0x3ef614){return{'success':![],'error':String(_0x3ef614)};}}function a0_0x36d3(){const _0x2d6cfe=['preventDefault','show-delete','innerHTML','POST','function','timestamp','ai_chat_messages','onclick','setHeaderColor','24XpstaZ','emptyState','104cUNHwM','appendChild','style','innerHeight','initData','keydown','setItem','disabled','trim','value','div','touchend','5953934YBHdsF','impactOccurred','getMinutes','text','offClick','typingIndicator','target','isVersionAtLeast','clear_history','textContent','flex','splice','resize','constructor','TG\x20setup\x20error:','user','getElementById','offsetHeight','add','sendBtn','createElement','abort','215065DEyuzr','debug_uid','disableVerticalSwipes','initDataUnsafe','viewportHeight','getItem','className','onClick','querySelectorAll','inputArea','1091061mXAUOj','text/plain','scrollTop','BackButton','.message.show-delete','837178PEjXyw','.container','remove','search','HapticFeedback','message-time','touchstart','viewportChanged','Ошибка\x20сети','random','1751430plNWTs','focus','key','input','now','push','toString','#050505','delete-btn','click','from','2757012OgUBNF','json','padStart','1915506ZIdPte','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','content','role','WebApp','error','apply','height','signal','show','Действие\x20необратимо.','scrollHeight','stringify','first_name','href','clearBtn','Очистить\x20историю?','classList','modalText','modalTitle','display','send_message','message-bubble','Telegram','modalConfirm','paddingBottom','messageInput','light','notificationOccurred','forEach','message\x20ai','length','<br>','(((.+)+)+)+$','chatArea','querySelector','message\x20','addEventListener','medium'];a0_0x36d3=function(){return _0x2d6cfe;};return a0_0x36d3();}function formatTime(_0x259457){const _0x51f7ea=a0_0x1e6286,_0xb2af3f=new Date(_0x259457);return String(_0xb2af3f['getHours']())['padStart'](0x2,'0')+':'+String(_0xb2af3f[_0x51f7ea(0x241)]())[_0x51f7ea(0x200)](0x2,'0');}function createMessageElement(_0x55e271,_0x13f835){const _0x2a112e=a0_0x1e6286,_0x381d7d=document[_0x2a112e(0x253)]('div');_0x381d7d[_0x2a112e(0x25b)]=_0x2a112e(0x225)+_0x55e271[_0x2a112e(0x204)];const _0x3500cf=document[_0x2a112e(0x253)]('div');_0x3500cf[_0x2a112e(0x25b)]=_0x2a112e(0x217),_0x3500cf[_0x2a112e(0x22a)]=_0x55e271[_0x2a112e(0x203)]['replace'](/\n/g,_0x2a112e(0x221));const _0x202133=document[_0x2a112e(0x253)](_0x2a112e(0x23d));_0x202133[_0x2a112e(0x25b)]=_0x2a112e(0x1fb),_0x202133[_0x2a112e(0x22a)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x202133[_0x2a112e(0x22f)]=_0x1ac3be=>{_0x1ac3be['stopPropagation'](),confirmDelete(_0x13f835);};let _0x287849;_0x3500cf[_0x2a112e(0x226)](_0x2a112e(0x26a),()=>_0x287849=setTimeout(()=>{const _0x1ef985=_0x2a112e;_0x381d7d[_0x1ef985(0x212)][_0x1ef985(0x251)](_0x1ef985(0x229));if(tg?.['HapticFeedback'])tg[_0x1ef985(0x268)][_0x1ef985(0x240)](_0x1ef985(0x227));},0x1f4)),_0x3500cf['addEventListener'](_0x2a112e(0x23e),()=>clearTimeout(_0x287849));const _0x7480bd=document[_0x2a112e(0x253)](_0x2a112e(0x23d));return _0x7480bd[_0x2a112e(0x25b)]=_0x2a112e(0x269),_0x7480bd[_0x2a112e(0x248)]=formatTime(_0x55e271[_0x2a112e(0x22d)]),_0x381d7d[_0x2a112e(0x234)](_0x202133),_0x381d7d[_0x2a112e(0x234)](_0x3500cf),_0x381d7d[_0x2a112e(0x234)](_0x7480bd),_0x381d7d;}function createTypingIndicator(){const _0x4166c4=a0_0x1e6286,_0x260c18=document['createElement'](_0x4166c4(0x23d));return _0x260c18[_0x4166c4(0x25b)]=_0x4166c4(0x21f),_0x260c18['id']='typingIndicator',_0x260c18[_0x4166c4(0x22a)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x260c18;}function renderMessages(){const _0x58ab29=a0_0x1e6286;Array[_0x58ab29(0x1fd)](chatArea['children'])[_0x58ab29(0x21e)](_0x1a6cb8=>{const _0x375caa=_0x58ab29;if(_0x1a6cb8['id']!=='emptyState')_0x1a6cb8[_0x375caa(0x266)]();}),messages[_0x58ab29(0x220)]>0x0?(emptyState[_0x58ab29(0x235)][_0x58ab29(0x215)]='none',messages[_0x58ab29(0x21e)]((_0x1cfe4e,_0x465988)=>chatArea[_0x58ab29(0x234)](createMessageElement(_0x1cfe4e,_0x465988)))):emptyState[_0x58ab29(0x235)]['display']=_0x58ab29(0x249),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function a0_0x4936(_0x40b4dd,_0x248612){_0x40b4dd=_0x40b4dd-0x1f2;const _0x42cb4e=a0_0x36d3();let _0x5baa09=_0x42cb4e[_0x40b4dd];return _0x5baa09;}function autoResizeTextarea(){const _0x1405fd=a0_0x1e6286;messageInput['style']['height']='auto',messageInput[_0x1405fd(0x235)][_0x1405fd(0x208)]=Math['min'](messageInput[_0x1405fd(0x20c)],0x78)+'px';}function updateSendButton(){const _0x3ef533=a0_0x1e6286,_0x484401=messageInput['value'][_0x3ef533(0x23b)]();sendBtn[_0x3ef533(0x23a)]=!_0x484401||isTyping;}async function sendMessage(){const _0x578468=a0_0x1e6286,_0x4eaba5=messageInput[_0x578468(0x23c)][_0x578468(0x23b)]();if(!_0x4eaba5||isTyping)return;if(tg?.[_0x578468(0x268)])tg[_0x578468(0x268)][_0x578468(0x240)](_0x578468(0x21c));messages[_0x578468(0x1f8)]({'role':_0x578468(0x24e),'content':_0x4eaba5,'timestamp':Date[_0x578468(0x1f7)]()}),localStorage[_0x578468(0x239)](_0x578468(0x22e),JSON[_0x578468(0x20d)](messages)),renderMessages(),messageInput[_0x578468(0x23c)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x578468(0x261)]=chatArea[_0x578468(0x20c)];const _0x54af82=await callBackend(_0x578468(0x216),{'message':_0x4eaba5});isTyping=![];const _0x31e6f5=document[_0x578468(0x24f)](_0x578468(0x244));if(_0x31e6f5)_0x31e6f5[_0x578468(0x266)]();let _0x224f08=_0x578468(0x26c);if(_0x54af82['success']){_0x224f08=_0x54af82[_0x578468(0x242)]||'Пустой\x20ответ';if(tg?.[_0x578468(0x268)])tg[_0x578468(0x268)][_0x578468(0x21d)]('success');}else{_0x224f08=_0x54af82['error']||'Ошибка\x20сервера';if(tg?.[_0x578468(0x268)])tg[_0x578468(0x268)][_0x578468(0x21d)](_0x578468(0x206));}messages[_0x578468(0x1f8)]({'role':'ai','content':_0x224f08,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x578468(0x20d)](messages)),renderMessages();}function confirmDelete(_0x35cd02){const _0x21496e=a0_0x1e6286;if(mTitle)mTitle[_0x21496e(0x248)]='Удалить?';if(mText)mText[_0x21496e(0x248)]=_0x21496e(0x20b);modalCallback=()=>{const _0x5bb18b=_0x21496e;messages[_0x5bb18b(0x24a)](_0x35cd02,0x1),localStorage[_0x5bb18b(0x239)]('ai_chat_messages',JSON[_0x5bb18b(0x20d)](messages)),renderMessages();},modal[_0x21496e(0x212)]['add'](_0x21496e(0x20a));}if(clearBtn)clearBtn[a0_0x1e6286(0x22f)]=()=>{const _0x176400=a0_0x1e6286;if(!messages[_0x176400(0x220)])return;if(mTitle)mTitle[_0x176400(0x248)]=_0x176400(0x211);if(mText)mText[_0x176400(0x248)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x1eb1b4=_0x176400;messages=[],localStorage['removeItem'](_0x1eb1b4(0x22e)),renderMessages(),callBackend(_0x1eb1b4(0x247),{});},modal[_0x176400(0x212)][_0x176400(0x251)](_0x176400(0x20a));};document[a0_0x1e6286(0x24f)]('modalCancel')[a0_0x1e6286(0x22f)]=()=>modal[a0_0x1e6286(0x212)][a0_0x1e6286(0x266)](a0_0x1e6286(0x20a)),document['getElementById'](a0_0x1e6286(0x219))['onclick']=()=>{const _0x15ccee=a0_0x1e6286;if(modalCallback)modalCallback();modal[_0x15ccee(0x212)][_0x15ccee(0x266)](_0x15ccee(0x20a));},messageInput['addEventListener'](a0_0x1e6286(0x1f6),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1e6286(0x226)](a0_0x1e6286(0x238),_0x4b8bb7=>{const _0x3843ac=a0_0x1e6286;_0x4b8bb7[_0x3843ac(0x1f5)]==='Enter'&&!_0x4b8bb7['shiftKey']&&(_0x4b8bb7[_0x3843ac(0x228)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x1e6286(0x1fc),_0x3b5d99=>{const _0x76f4e9=a0_0x1e6286;document[_0x76f4e9(0x25d)](_0x76f4e9(0x263))['forEach'](_0x409ed1=>{const _0x420f25=_0x76f4e9;if(!_0x409ed1['contains'](_0x3b5d99[_0x420f25(0x245)]))_0x409ed1[_0x420f25(0x212)][_0x420f25(0x266)](_0x420f25(0x229));});});const saved=localStorage[a0_0x1e6286(0x25a)](a0_0x1e6286(0x22e));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x22eb64){}updateSendButton();