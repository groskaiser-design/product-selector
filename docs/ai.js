const a0_0x337320=a0_0x2110;(function(_0x17a69b,_0x33a15d){const _0x48f247=a0_0x2110,_0x5703e5=_0x17a69b();while(!![]){try{const _0x1559be=parseInt(_0x48f247(0x110))/0x1*(-parseInt(_0x48f247(0xd4))/0x2)+parseInt(_0x48f247(0xd7))/0x3+parseInt(_0x48f247(0x12a))/0x4+parseInt(_0x48f247(0xff))/0x5*(-parseInt(_0x48f247(0x11d))/0x6)+-parseInt(_0x48f247(0xf8))/0x7*(parseInt(_0x48f247(0x102))/0x8)+parseInt(_0x48f247(0xcb))/0x9+parseInt(_0x48f247(0xbc))/0xa*(parseInt(_0x48f247(0xeb))/0xb);if(_0x1559be===_0x33a15d)break;else _0x5703e5['push'](_0x5703e5['shift']());}catch(_0x4120c9){_0x5703e5['push'](_0x5703e5['shift']());}}}(a0_0x3f97,0xac010));const tg=window[a0_0x337320(0xb1)]?.[a0_0x337320(0x119)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x3e67f4=a0_0x337320;if(!tg)return;try{tg[_0x3e67f4(0xbf)](),tg['expand'](),tg[_0x3e67f4(0xf2)]?.(_0x3e67f4(0x127));if(tg[_0x3e67f4(0xf4)]?.('6.1'))tg[_0x3e67f4(0xe6)]?.();const _0x1828a4=tg[_0x3e67f4(0xea)];if(_0x1828a4){_0x1828a4[_0x3e67f4(0x10a)]();if(typeof _0x1828a4[_0x3e67f4(0x10f)]==='function')try{_0x1828a4[_0x3e67f4(0x10f)]();}catch(_0x10cab7){}_0x1828a4['onClick'](()=>{const _0x55774b=_0x3e67f4;if(tg['HapticFeedback'])tg[_0x55774b(0xf0)][_0x55774b(0xe9)]('light');location[_0x55774b(0x100)]=HOME_URL;});}}catch(_0x1d1da8){console[_0x3e67f4(0xfa)]('TG\x20setup\x20error:',_0x1d1da8);}}(function initStableLayout(){const _0x39766d=a0_0x337320,_0x59e767=(function(){let _0x36ed39=!![];return function(_0x3e0340,_0x360e96){const _0x249b27=_0x36ed39?function(){const _0x9aad79=a0_0x2110;if(_0x360e96){const _0x388c26=_0x360e96[_0x9aad79(0xf9)](_0x3e0340,arguments);return _0x360e96=null,_0x388c26;}}:function(){};return _0x36ed39=![],_0x249b27;};}()),_0xdec122=document[_0x39766d(0xc3)]('.container'),_0x15cddc=document[_0x39766d(0xfe)](_0x39766d(0xd2)),_0x5eaad6=document['getElementById']('chatArea'),_0x468c48=document['getElementById']('messageInput');function _0x2382c6(){const _0x41b4f4=_0x39766d,_0x458c60=_0x59e767(this,function(){const _0x2a80e0=a0_0x2110;return _0x458c60['toString']()[_0x2a80e0(0x129)](_0x2a80e0(0xc9))[_0x2a80e0(0xfb)]()[_0x2a80e0(0xee)](_0x458c60)[_0x2a80e0(0x129)](_0x2a80e0(0xc9));});_0x458c60();if(!_0xdec122)return;const _0x13c30b=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x41b4f4(0xf5)];_0xdec122[_0x41b4f4(0x107)]['height']=_0x13c30b+'px';if(_0x15cddc){const _0x1cb88e=_0x15cddc[_0x41b4f4(0xd1)];_0x5eaad6[_0x41b4f4(0x107)][_0x41b4f4(0xf1)]=_0x1cb88e+0x28+'px';}}tg?tg[_0x39766d(0x126)]('viewportChanged',({isStateStable:_0x1b312f})=>{_0x2382c6();if(_0x1b312f)requestAnimationFrame(()=>{const _0x36b685=a0_0x2110;_0x5eaad6[_0x36b685(0x109)]=_0x5eaad6[_0x36b685(0xe4)];});}):window['addEventListener']('resize',_0x2382c6),_0x2382c6(),_0x468c48&&(_0x468c48['addEventListener'](_0x39766d(0x125),()=>{requestAnimationFrame(_0x2382c6);}),_0x468c48[_0x39766d(0xde)](_0x39766d(0xcd),()=>{setTimeout(()=>{const _0x502543=a0_0x2110;_0x5eaad6[_0x502543(0x109)]=_0x5eaad6['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x337320(0x11c),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x2110(_0x167ba0,_0x5f0a9d){_0x167ba0=_0x167ba0-0xb1;const _0x5ea575=a0_0x3f97();let _0x10c161=_0x5ea575[_0x167ba0];return _0x10c161;}let messages=[],isTyping=![];function a0_0x3f97(){const _0x20605c=['replace','scrollTop','show','value','Удалить?','push','modalTitle','offClick','1yZgatc','username','flex','initDataUnsafe','confirmModal','light','sendBtn','display','classList','WebApp','POST','div','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','12IGKQja','textContent','padStart','parse','now','Очистить\x20историю?','Ошибка\x20сервера','message\x20ai','input','onEvent','#050505','modalText','search','2008664SXsdVs','random','target','getMinutes','message-bubble','Telegram','shiftKey','querySelectorAll','key','Начнется\x20новый\x20диалог.','Действие\x20необратимо.','<br>','show-delete','.message.show-delete','debug_uid','keydown','389590XZcHao','length','send_message','ready','modalCancel','timestamp','stringify','querySelector','add','getItem','touchend','signal','text','(((.+)+)+)+$','clear_history','6277041raJxtL','preventDefault','focus','notificationOccurred','appendChild','setItem','offsetHeight','inputArea','stopPropagation','308774niGvHc','getHours','forEach','1431846rTkahT','onclick','trim','user','ai_chat_messages','typingIndicator','Пустой\x20ответ','addEventListener','createElement','abort','Ошибка\x20сети','json','role','scrollHeight','auto','disableVerticalSwipes','medium','emptyState','impactOccurred','BackButton','11ZZTYKP','Enter','height','constructor','delete-btn','HapticFeedback','paddingBottom','setHeaderColor','first_name','isVersionAtLeast','innerHeight','chatArea','remove','7ZmLHye','apply','warn','toString','message\x20','initData','getElementById','1964705fSkRFK','href','success','568472vCRLtd','disabled','click','children','className','style'];a0_0x3f97=function(){return _0x20605c;};return a0_0x3f97();}const chatArea=document['getElementById'](a0_0x337320(0xf6)),emptyState=document['getElementById'](a0_0x337320(0xe8)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x337320(0xfe)](a0_0x337320(0x116)),clearBtn=document[a0_0x337320(0xfe)]('clearBtn'),modal=document[a0_0x337320(0xfe)](a0_0x337320(0x114)),mTitle=document[a0_0x337320(0xfe)](a0_0x337320(0x10e)),mText=document[a0_0x337320(0xfe)](a0_0x337320(0x128));let modalCallback=null;async function callBackend(_0x4de96a,_0x4ed9e7){const _0x429b51=a0_0x337320,_0x744453=tg?.[_0x429b51(0x113)]?.[_0x429b51(0xda)]||{},_0x17bd82=_0x744453['id']||localStorage[_0x429b51(0xc5)](_0x429b51(0xba))||'d-'+Math['floor'](Math[_0x429b51(0x12b)]()*0x3b9aca00);if(!_0x744453['id'])localStorage['setItem'](_0x429b51(0xba),_0x17bd82);const _0x42d8cd={'action':_0x4de96a,'user_id':_0x17bd82,'user_data':{'first_name':_0x744453[_0x429b51(0xf3)],'username':_0x744453[_0x429b51(0x111)]},'init_data':tg?.[_0x429b51(0xfd)]||'',..._0x4ed9e7},_0x33232f=new AbortController(),_0x655910=setTimeout(()=>_0x33232f[_0x429b51(0xe0)](),REQUEST_TIMEOUT_MS);try{const _0xdd8910=await fetch(BACKEND_URL,{'method':_0x429b51(0x11a),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x429b51(0xc2)](_0x42d8cd),'signal':_0x33232f[_0x429b51(0xc7)]});return clearTimeout(_0x655910),await _0xdd8910[_0x429b51(0xe2)]();}catch(_0x35ea58){return{'success':![],'error':String(_0x35ea58)};}}function formatTime(_0x1b635a){const _0x53094d=a0_0x337320,_0x435663=new Date(_0x1b635a);return String(_0x435663[_0x53094d(0xd5)]())['padStart'](0x2,'0')+':'+String(_0x435663[_0x53094d(0x12d)]())[_0x53094d(0x11f)](0x2,'0');}function createMessageElement(_0xc584ea,_0x4d53f0){const _0x4155c5=a0_0x337320,_0x37cf9f=document[_0x4155c5(0xdf)](_0x4155c5(0x11b));_0x37cf9f[_0x4155c5(0x106)]=_0x4155c5(0xfc)+_0xc584ea[_0x4155c5(0xe3)];const _0x12a8c4=document[_0x4155c5(0xdf)](_0x4155c5(0x11b));_0x12a8c4[_0x4155c5(0x106)]=_0x4155c5(0x12e),_0x12a8c4['innerHTML']=_0xc584ea['content'][_0x4155c5(0x108)](/\n/g,_0x4155c5(0xb7));const _0x5c4284=document[_0x4155c5(0xdf)](_0x4155c5(0x11b));_0x5c4284[_0x4155c5(0x106)]=_0x4155c5(0xef),_0x5c4284['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x5c4284[_0x4155c5(0xd8)]=_0x4b8b0c=>{const _0x45ba6d=_0x4155c5;_0x4b8b0c[_0x45ba6d(0xd3)](),confirmDelete(_0x4d53f0);};let _0x3362bb;_0x12a8c4[_0x4155c5(0xde)]('touchstart',()=>_0x3362bb=setTimeout(()=>{const _0x47e9f5=_0x4155c5;_0x37cf9f[_0x47e9f5(0x118)][_0x47e9f5(0xc4)](_0x47e9f5(0xb8));if(tg?.[_0x47e9f5(0xf0)])tg[_0x47e9f5(0xf0)][_0x47e9f5(0xe9)](_0x47e9f5(0xe7));},0x1f4)),_0x12a8c4[_0x4155c5(0xde)](_0x4155c5(0xc6),()=>clearTimeout(_0x3362bb));const _0x525da7=document[_0x4155c5(0xdf)]('div');return _0x525da7[_0x4155c5(0x106)]='message-time',_0x525da7[_0x4155c5(0x11e)]=formatTime(_0xc584ea[_0x4155c5(0xc1)]),_0x37cf9f[_0x4155c5(0xcf)](_0x5c4284),_0x37cf9f[_0x4155c5(0xcf)](_0x12a8c4),_0x37cf9f['appendChild'](_0x525da7),_0x37cf9f;}function createTypingIndicator(){const _0x52546c=a0_0x337320,_0x34fd4c=document[_0x52546c(0xdf)]('div');return _0x34fd4c[_0x52546c(0x106)]=_0x52546c(0x124),_0x34fd4c['id']='typingIndicator',_0x34fd4c['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x34fd4c;}function renderMessages(){const _0x283247=a0_0x337320;Array['from'](chatArea[_0x283247(0x105)])[_0x283247(0xd6)](_0xe00d18=>{const _0x2ad17e=_0x283247;if(_0xe00d18['id']!==_0x2ad17e(0xe8))_0xe00d18['remove']();}),messages[_0x283247(0xbd)]>0x0?(emptyState[_0x283247(0x107)][_0x283247(0x117)]='none',messages[_0x283247(0xd6)]((_0x3045c8,_0xe1e336)=>chatArea[_0x283247(0xcf)](createMessageElement(_0x3045c8,_0xe1e336)))):emptyState[_0x283247(0x107)][_0x283247(0x117)]=_0x283247(0x112),requestAnimationFrame(()=>chatArea[_0x283247(0x109)]=chatArea[_0x283247(0xe4)]);}function autoResizeTextarea(){const _0x27d4c8=a0_0x337320;messageInput[_0x27d4c8(0x107)][_0x27d4c8(0xed)]=_0x27d4c8(0xe5),messageInput['style'][_0x27d4c8(0xed)]=Math['min'](messageInput[_0x27d4c8(0xe4)],0x78)+'px';}function updateSendButton(){const _0x541751=a0_0x337320,_0x180480=messageInput['value'][_0x541751(0xd9)]();sendBtn[_0x541751(0x103)]=!_0x180480||isTyping;}async function sendMessage(){const _0x5d29df=a0_0x337320,_0x8e5303=messageInput[_0x5d29df(0x10b)][_0x5d29df(0xd9)]();if(!_0x8e5303||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x5d29df(0xf0)][_0x5d29df(0xe9)](_0x5d29df(0x115));messages[_0x5d29df(0x10d)]({'role':'user','content':_0x8e5303,'timestamp':Date[_0x5d29df(0x121)]()}),localStorage[_0x5d29df(0xd0)](_0x5d29df(0xdb),JSON[_0x5d29df(0xc2)](messages)),renderMessages(),messageInput[_0x5d29df(0x10b)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5d29df(0xcf)](createTypingIndicator()),chatArea[_0x5d29df(0x109)]=chatArea['scrollHeight'];const _0x196bfd=await callBackend(_0x5d29df(0xbe),{'message':_0x8e5303});isTyping=![];const _0x2b5354=document['getElementById'](_0x5d29df(0xdc));if(_0x2b5354)_0x2b5354[_0x5d29df(0xf7)]();let _0x1d69a7=_0x5d29df(0xe1);if(_0x196bfd['success']){_0x1d69a7=_0x196bfd[_0x5d29df(0xc8)]||_0x5d29df(0xdd);if(tg?.[_0x5d29df(0xf0)])tg[_0x5d29df(0xf0)][_0x5d29df(0xce)](_0x5d29df(0x101));}else{_0x1d69a7=_0x196bfd['error']||_0x5d29df(0x123);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x5d29df(0xce)]('error');}messages[_0x5d29df(0x10d)]({'role':'ai','content':_0x1d69a7,'timestamp':Date[_0x5d29df(0x121)]()}),localStorage[_0x5d29df(0xd0)](_0x5d29df(0xdb),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x4cf548){const _0x18515e=a0_0x337320;if(mTitle)mTitle[_0x18515e(0x11e)]=_0x18515e(0x10c);if(mText)mText[_0x18515e(0x11e)]=_0x18515e(0xb6);modalCallback=()=>{const _0xf4ce9b=_0x18515e;messages['splice'](_0x4cf548,0x1),localStorage[_0xf4ce9b(0xd0)](_0xf4ce9b(0xdb),JSON[_0xf4ce9b(0xc2)](messages)),renderMessages();},modal[_0x18515e(0x118)]['add']('show');}if(clearBtn)clearBtn[a0_0x337320(0xd8)]=()=>{const _0x37bd11=a0_0x337320;if(!messages[_0x37bd11(0xbd)])return;if(mTitle)mTitle[_0x37bd11(0x11e)]=_0x37bd11(0x122);if(mText)mText[_0x37bd11(0x11e)]=_0x37bd11(0xb5);modalCallback=async()=>{const _0x279bcb=_0x37bd11;messages=[],localStorage['removeItem'](_0x279bcb(0xdb)),renderMessages(),callBackend(_0x279bcb(0xca),{});},modal[_0x37bd11(0x118)][_0x37bd11(0xc4)](_0x37bd11(0x10a));};document[a0_0x337320(0xfe)](a0_0x337320(0xc0))[a0_0x337320(0xd8)]=()=>modal[a0_0x337320(0x118)][a0_0x337320(0xf7)](a0_0x337320(0x10a)),document[a0_0x337320(0xfe)]('modalConfirm')[a0_0x337320(0xd8)]=()=>{const _0x31cec7=a0_0x337320;if(modalCallback)modalCallback();modal[_0x31cec7(0x118)][_0x31cec7(0xf7)](_0x31cec7(0x10a));},messageInput[a0_0x337320(0xde)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x337320(0xde)](a0_0x337320(0xbb),_0x36bad4=>{const _0x220e2d=a0_0x337320;_0x36bad4[_0x220e2d(0xb4)]===_0x220e2d(0xec)&&!_0x36bad4[_0x220e2d(0xb2)]&&(_0x36bad4[_0x220e2d(0xcc)](),sendMessage());}),sendBtn[a0_0x337320(0xd8)]=sendMessage,document[a0_0x337320(0xde)](a0_0x337320(0x104),_0x4ce6b0=>{const _0x3362e8=a0_0x337320;document[_0x3362e8(0xb3)](_0x3362e8(0xb9))['forEach'](_0x3801a8=>{const _0x380dcf=_0x3362e8;if(!_0x3801a8['contains'](_0x4ce6b0[_0x380dcf(0x12c)]))_0x3801a8[_0x380dcf(0x118)][_0x380dcf(0xf7)](_0x380dcf(0xb8));});});const saved=localStorage[a0_0x337320(0xc5)](a0_0x337320(0xdb));if(saved)try{messages=JSON[a0_0x337320(0x120)](saved),renderMessages();}catch(a0_0xa66fc3){}updateSendButton();