const a0_0x7b74a5=a0_0x3688;(function(_0x51cbb9,_0x266e4a){const _0x47df7c=a0_0x3688,_0x551460=_0x51cbb9();while(!![]){try{const _0x446c8e=parseInt(_0x47df7c(0x1e3))/0x1+-parseInt(_0x47df7c(0x1ad))/0x2+parseInt(_0x47df7c(0x1a2))/0x3+-parseInt(_0x47df7c(0x170))/0x4*(-parseInt(_0x47df7c(0x19e))/0x5)+-parseInt(_0x47df7c(0x174))/0x6*(parseInt(_0x47df7c(0x18d))/0x7)+parseInt(_0x47df7c(0x1d0))/0x8*(-parseInt(_0x47df7c(0x1d7))/0x9)+-parseInt(_0x47df7c(0x1a0))/0xa;if(_0x446c8e===_0x266e4a)break;else _0x551460['push'](_0x551460['shift']());}catch(_0x547215){_0x551460['push'](_0x551460['shift']());}}}(a0_0x1f58,0xcc3c8));const tg=window[a0_0x7b74a5(0x1e4)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x423286=a0_0x7b74a5;if(!tg)return;try{tg[_0x423286(0x1a8)](),tg[_0x423286(0x199)](),tg[_0x423286(0x1bb)]?.(_0x423286(0x177));if(tg[_0x423286(0x187)]?.(_0x423286(0x18a)))tg[_0x423286(0x1d1)]?.();const _0x38555=tg[_0x423286(0x189)];if(_0x38555){_0x38555[_0x423286(0x1cc)]();if(typeof _0x38555[_0x423286(0x1bc)]==='function')try{_0x38555['offClick']();}catch(_0x581333){}_0x38555['onClick'](()=>{const _0x2a5fd2=_0x423286;if(tg[_0x2a5fd2(0x1b0)])tg['HapticFeedback'][_0x2a5fd2(0x1be)](_0x2a5fd2(0x180));location['href']=HOME_URL;});}}catch(_0x6e783f){console[_0x423286(0x1b4)]('TG\x20setup\x20error:',_0x6e783f);}}(function initStableLayout(){const _0x220a01=a0_0x7b74a5,_0x5a9d48=(function(){let _0x12194d=!![];return function(_0xc8b9f7,_0x2ff40f){const _0x32fe42=_0x12194d?function(){if(_0x2ff40f){const _0xd83e49=_0x2ff40f['apply'](_0xc8b9f7,arguments);return _0x2ff40f=null,_0xd83e49;}}:function(){};return _0x12194d=![],_0x32fe42;};}()),_0x12bb5f=document[_0x220a01(0x1d8)]('.container'),_0x5353b4=document['getElementById'](_0x220a01(0x1dd)),_0x534c22=document['getElementById'](_0x220a01(0x1a3)),_0x2161fb=document[_0x220a01(0x17a)](_0x220a01(0x1df));function _0x2d442b(){const _0x4427cd=_0x220a01,_0x97bf46=_0x5a9d48(this,function(){const _0x123913=a0_0x3688;return _0x97bf46['toString']()[_0x123913(0x17b)](_0x123913(0x18e))[_0x123913(0x181)]()[_0x123913(0x1b2)](_0x97bf46)['search']('(((.+)+)+)+$');});_0x97bf46();if(!_0x12bb5f)return;const _0x451637=tg&&tg[_0x4427cd(0x1bd)]?tg[_0x4427cd(0x1bd)]:window[_0x4427cd(0x1c3)];_0x12bb5f['style'][_0x4427cd(0x1c2)]=_0x451637+'px';if(_0x5353b4){const _0x9147ca=_0x5353b4[_0x4427cd(0x196)];_0x534c22[_0x4427cd(0x194)]['paddingBottom']=_0x9147ca+0x28+'px';}}tg?tg[_0x220a01(0x1b3)](_0x220a01(0x197),({isStateStable:_0x324480})=>{_0x2d442b();if(_0x324480)requestAnimationFrame(()=>{const _0x5843ae=a0_0x3688;_0x534c22[_0x5843ae(0x1c7)]=_0x534c22[_0x5843ae(0x1b7)];});}):window['addEventListener']('resize',_0x2d442b),_0x2d442b(),_0x2161fb&&(_0x2161fb[_0x220a01(0x16e)]('input',()=>{requestAnimationFrame(_0x2d442b);}),_0x2161fb['addEventListener'](_0x220a01(0x186),()=>{setTimeout(()=>{const _0xa52be7=a0_0x3688;_0x534c22['scrollTop']=_0x534c22[_0xa52be7(0x1b7)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x7b74a5(0x1ae),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x1f58(){const _0x507be2=['isVersionAtLeast','preventDefault','BackButton','6.1','Очистить\x20историю?','click','1295791QCmsBb','(((.+)+)+)+$','Пустой\x20ответ','stopPropagation','touchend','success','padStart','style','floor','offsetHeight','viewportChanged','stringify','expand','querySelectorAll','Удалить?','keydown','initData','2677595ORBBbX','flex','9474210iULkwK','replace','2818530MlSQOH','chatArea','send_message','Начнется\x20новый\x20диалог.','display','username','ready','contains','message-bubble','target','Ошибка\x20сервера','1166068SOsDXM','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','modalConfirm','HapticFeedback','timestamp','constructor','onEvent','warn','abort','setItem','scrollHeight','initDataUnsafe','getItem','modalCancel','setHeaderColor','offClick','viewportHeight','impactOccurred','Ошибка\x20сети','disabled','now','height','innerHeight','ai_chat_messages','from','innerHTML','scrollTop','modalText','min','typingIndicator','emptyState','show','debug_uid','parse','getHours','1307856bVzwqP','disableVerticalSwipes','content','getMinutes','createElement','textContent','show-delete','9Uvlyiw','querySelector','first_name','text','classList','div','inputArea','length','messageInput','appendChild','children','className','705054VhqyYv','Telegram','error','addEventListener','onclick','8ifbjwb','push','text/plain','add','6xYAfSi','confirmModal','Действие\x20необратимо.','#050505','shiftKey','value','getElementById','search','remove','forEach','clear_history','input','light','toString','key','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','user','role','focus'];a0_0x1f58=function(){return _0x507be2;};return a0_0x1f58();}let messages=[],isTyping=![];const chatArea=document[a0_0x7b74a5(0x17a)](a0_0x7b74a5(0x1a3)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x7b74a5(0x17a)](a0_0x7b74a5(0x1df)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x7b74a5(0x17a)]('clearBtn'),modal=document[a0_0x7b74a5(0x17a)](a0_0x7b74a5(0x175)),mTitle=document[a0_0x7b74a5(0x17a)]('modalTitle'),mText=document[a0_0x7b74a5(0x17a)](a0_0x7b74a5(0x1c8));let modalCallback=null;async function callBackend(_0x310029,_0x457218){const _0x14e186=a0_0x7b74a5,_0x371529=tg?.[_0x14e186(0x1b8)]?.[_0x14e186(0x184)]||{},_0x3be376=_0x371529['id']||localStorage[_0x14e186(0x1b9)](_0x14e186(0x1cd))||'d-'+Math[_0x14e186(0x195)](Math['random']()*0x3b9aca00);if(!_0x371529['id'])localStorage[_0x14e186(0x1b6)](_0x14e186(0x1cd),_0x3be376);const _0xed61cf={'action':_0x310029,'user_id':_0x3be376,'user_data':{'first_name':_0x371529[_0x14e186(0x1d9)],'username':_0x371529[_0x14e186(0x1a7)]},'init_data':tg?.[_0x14e186(0x19d)]||'',..._0x457218},_0x18898c=new AbortController(),_0x234b6f=setTimeout(()=>_0x18898c[_0x14e186(0x1b5)](),REQUEST_TIMEOUT_MS);try{const _0x14fb0a=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x14e186(0x172)},'body':JSON[_0x14e186(0x198)](_0xed61cf),'signal':_0x18898c['signal']});return clearTimeout(_0x234b6f),await _0x14fb0a['json']();}catch(_0x1c4908){return{'success':![],'error':String(_0x1c4908)};}}function formatTime(_0x1ac083){const _0x48a19d=a0_0x7b74a5,_0x1e5112=new Date(_0x1ac083);return String(_0x1e5112[_0x48a19d(0x1cf)]())[_0x48a19d(0x193)](0x2,'0')+':'+String(_0x1e5112[_0x48a19d(0x1d3)]())['padStart'](0x2,'0');}function createMessageElement(_0x3c75e5,_0x4e159e){const _0x102e68=a0_0x7b74a5,_0x1ce9ae=document['createElement'](_0x102e68(0x1dc));_0x1ce9ae[_0x102e68(0x1e2)]='message\x20'+_0x3c75e5[_0x102e68(0x185)];const _0x1d9c01=document['createElement'](_0x102e68(0x1dc));_0x1d9c01['className']=_0x102e68(0x1aa),_0x1d9c01['innerHTML']=_0x3c75e5[_0x102e68(0x1d2)][_0x102e68(0x1a1)](/\n/g,'<br>');const _0x49d9ea=document['createElement'](_0x102e68(0x1dc));_0x49d9ea[_0x102e68(0x1e2)]='delete-btn',_0x49d9ea[_0x102e68(0x1c6)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x49d9ea[_0x102e68(0x16f)]=_0x30826f=>{const _0x57404e=_0x102e68;_0x30826f[_0x57404e(0x190)](),confirmDelete(_0x4e159e);};let _0x158e2f;_0x1d9c01['addEventListener']('touchstart',()=>_0x158e2f=setTimeout(()=>{const _0x3df636=_0x102e68;_0x1ce9ae[_0x3df636(0x1db)]['add'](_0x3df636(0x1d6));if(tg?.['HapticFeedback'])tg[_0x3df636(0x1b0)][_0x3df636(0x1be)]('medium');},0x1f4)),_0x1d9c01[_0x102e68(0x16e)](_0x102e68(0x191),()=>clearTimeout(_0x158e2f));const _0x38f360=document['createElement'](_0x102e68(0x1dc));return _0x38f360[_0x102e68(0x1e2)]='message-time',_0x38f360[_0x102e68(0x1d5)]=formatTime(_0x3c75e5[_0x102e68(0x1b1)]),_0x1ce9ae['appendChild'](_0x49d9ea),_0x1ce9ae[_0x102e68(0x1e0)](_0x1d9c01),_0x1ce9ae[_0x102e68(0x1e0)](_0x38f360),_0x1ce9ae;}function createTypingIndicator(){const _0x25eba2=a0_0x7b74a5,_0x4f4ff7=document[_0x25eba2(0x1d4)](_0x25eba2(0x1dc));return _0x4f4ff7[_0x25eba2(0x1e2)]='message\x20ai',_0x4f4ff7['id']=_0x25eba2(0x1ca),_0x4f4ff7[_0x25eba2(0x1c6)]=_0x25eba2(0x183),_0x4f4ff7;}function renderMessages(){const _0x35f12b=a0_0x7b74a5;Array[_0x35f12b(0x1c5)](chatArea[_0x35f12b(0x1e1)])['forEach'](_0x1e0161=>{const _0x1f6eee=_0x35f12b;if(_0x1e0161['id']!==_0x1f6eee(0x1cb))_0x1e0161['remove']();}),messages[_0x35f12b(0x1de)]>0x0?(emptyState[_0x35f12b(0x194)][_0x35f12b(0x1a6)]='none',messages[_0x35f12b(0x17d)]((_0x190e9b,_0x450182)=>chatArea[_0x35f12b(0x1e0)](createMessageElement(_0x190e9b,_0x450182)))):emptyState[_0x35f12b(0x194)][_0x35f12b(0x1a6)]=_0x35f12b(0x19f),requestAnimationFrame(()=>chatArea[_0x35f12b(0x1c7)]=chatArea[_0x35f12b(0x1b7)]);}function autoResizeTextarea(){const _0x598b69=a0_0x7b74a5;messageInput[_0x598b69(0x194)][_0x598b69(0x1c2)]='auto',messageInput[_0x598b69(0x194)]['height']=Math[_0x598b69(0x1c9)](messageInput[_0x598b69(0x1b7)],0x78)+'px';}function updateSendButton(){const _0x213d77=a0_0x7b74a5,_0x3fbc23=messageInput[_0x213d77(0x179)]['trim']();sendBtn[_0x213d77(0x1c0)]=!_0x3fbc23||isTyping;}async function sendMessage(){const _0x134849=a0_0x7b74a5,_0x226d78=messageInput[_0x134849(0x179)]['trim']();if(!_0x226d78||isTyping)return;if(tg?.[_0x134849(0x1b0)])tg[_0x134849(0x1b0)][_0x134849(0x1be)](_0x134849(0x180));messages[_0x134849(0x171)]({'role':_0x134849(0x184),'content':_0x226d78,'timestamp':Date[_0x134849(0x1c1)]()}),localStorage[_0x134849(0x1b6)](_0x134849(0x1c4),JSON[_0x134849(0x198)](messages)),renderMessages(),messageInput[_0x134849(0x179)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x134849(0x1c7)]=chatArea[_0x134849(0x1b7)];const _0x489719=await callBackend(_0x134849(0x1a4),{'message':_0x226d78});isTyping=![];const _0x15d28f=document['getElementById'](_0x134849(0x1ca));if(_0x15d28f)_0x15d28f[_0x134849(0x17c)]();let _0x22b11b=_0x134849(0x1bf);if(_0x489719[_0x134849(0x192)]){_0x22b11b=_0x489719[_0x134849(0x1da)]||_0x134849(0x18f);if(tg?.['HapticFeedback'])tg[_0x134849(0x1b0)]['notificationOccurred'](_0x134849(0x192));}else{_0x22b11b=_0x489719[_0x134849(0x1e5)]||_0x134849(0x1ac);if(tg?.[_0x134849(0x1b0)])tg['HapticFeedback']['notificationOccurred']('error');}messages['push']({'role':'ai','content':_0x22b11b,'timestamp':Date[_0x134849(0x1c1)]()}),localStorage[_0x134849(0x1b6)](_0x134849(0x1c4),JSON[_0x134849(0x198)](messages)),renderMessages();}function confirmDelete(_0x184f04){const _0x29efde=a0_0x7b74a5;if(mTitle)mTitle[_0x29efde(0x1d5)]=_0x29efde(0x19b);if(mText)mText['textContent']=_0x29efde(0x176);modalCallback=()=>{const _0x4ba08a=_0x29efde;messages['splice'](_0x184f04,0x1),localStorage[_0x4ba08a(0x1b6)](_0x4ba08a(0x1c4),JSON[_0x4ba08a(0x198)](messages)),renderMessages();},modal[_0x29efde(0x1db)][_0x29efde(0x173)](_0x29efde(0x1cc));}if(clearBtn)clearBtn[a0_0x7b74a5(0x16f)]=()=>{const _0x4ed667=a0_0x7b74a5;if(!messages[_0x4ed667(0x1de)])return;if(mTitle)mTitle[_0x4ed667(0x1d5)]=_0x4ed667(0x18b);if(mText)mText[_0x4ed667(0x1d5)]=_0x4ed667(0x1a5);modalCallback=async()=>{const _0x193224=_0x4ed667;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x193224(0x17e),{});},modal[_0x4ed667(0x1db)]['add'](_0x4ed667(0x1cc));};document[a0_0x7b74a5(0x17a)](a0_0x7b74a5(0x1ba))[a0_0x7b74a5(0x16f)]=()=>modal[a0_0x7b74a5(0x1db)][a0_0x7b74a5(0x17c)](a0_0x7b74a5(0x1cc)),document[a0_0x7b74a5(0x17a)](a0_0x7b74a5(0x1af))[a0_0x7b74a5(0x16f)]=()=>{const _0x439467=a0_0x7b74a5;if(modalCallback)modalCallback();modal['classList'][_0x439467(0x17c)](_0x439467(0x1cc));},messageInput['addEventListener'](a0_0x7b74a5(0x17f),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x7b74a5(0x16e)](a0_0x7b74a5(0x19c),_0x3bc52b=>{const _0x333868=a0_0x7b74a5;_0x3bc52b[_0x333868(0x182)]==='Enter'&&!_0x3bc52b[_0x333868(0x178)]&&(_0x3bc52b[_0x333868(0x188)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x7b74a5(0x18c),_0x597584=>{const _0x49ff33=a0_0x7b74a5;document[_0x49ff33(0x19a)]('.message.show-delete')[_0x49ff33(0x17d)](_0x4ed538=>{const _0x4b404d=_0x49ff33;if(!_0x4ed538[_0x4b404d(0x1a9)](_0x597584[_0x4b404d(0x1ab)]))_0x4ed538[_0x4b404d(0x1db)][_0x4b404d(0x17c)](_0x4b404d(0x1d6));});});const saved=localStorage[a0_0x7b74a5(0x1b9)](a0_0x7b74a5(0x1c4));function a0_0x3688(_0x2ce962,_0x2a1e9e){_0x2ce962=_0x2ce962-0x16e;const _0x2d2a6d=a0_0x1f58();let _0x20a9e5=_0x2d2a6d[_0x2ce962];return _0x20a9e5;}if(saved)try{messages=JSON[a0_0x7b74a5(0x1ce)](saved),renderMessages();}catch(a0_0x3190fe){}updateSendButton();