const a0_0x137d6c=a0_0x3af7;function a0_0x4700(){const _0x52f628=['messageInput','scrollTop','stopPropagation','length','click','offClick','success','56874AhGoWT','viewportHeight','Начнется\x20новый\x20диалог.','clearBtn','textContent','timestamp','impactOccurred','emptyState','Telegram','none','contains','medium','function','error','disableVerticalSwipes','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','abort','WebApp','input','Enter','signal','message\x20ai','2067030oEwDpp','viewportChanged','focus','search','role','flex','message-bubble','#050505','Ошибка\x20сервера','ai_chat_messages','appendChild','now','6.1','initData','(((.+)+)+)+$','text/plain','initDataUnsafe','24CqfzDZ','children','keydown','.message.show-delete','add','touchstart','shiftKey','offsetHeight','481030GkbMyN','forEach','addEventListener','href','HapticFeedback','innerHeight','inputArea','BackButton','Пустой\x20ответ','chatArea','value','json','username','first_name','paddingBottom','delete-btn','typingIndicator','ready','className','stringify','auto','getMinutes','trim','user','push','10000386SjuOnH','preventDefault','notificationOccurred','message-time','remove','display','setItem','constructor','message\x20','removeItem','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','min','.container','onEvent','innerHTML','key','style','parse','querySelector','send_message','show-delete','<br>','sendBtn','classList','2853974nseApF','646050CaosKw','modalConfirm','padStart','scrollHeight','createElement','confirmModal','setHeaderColor','getElementById','modalCancel','TG\x20setup\x20error:','49869zlcwQs','debug_uid','52aTpQCj','modalTitle','height','floor','apply','show','onclick','POST','light','getItem','Действие\x20необратимо.','div'];a0_0x4700=function(){return _0x52f628;};return a0_0x4700();}(function(_0x4cbc99,_0x4bf1e2){const _0x19c5ad=a0_0x3af7,_0x163a5e=_0x4cbc99();while(!![]){try{const _0x56849d=parseInt(_0x19c5ad(0x1e5))/0x1+-parseInt(_0x19c5ad(0x1e4))/0x2+parseInt(_0x19c5ad(0x204))/0x3*(-parseInt(_0x19c5ad(0x1f1))/0x4)+-parseInt(_0x19c5ad(0x1b3))/0x5+parseInt(_0x19c5ad(0x1cc))/0x6+parseInt(_0x19c5ad(0x19a))/0x7+-parseInt(_0x19c5ad(0x1ab))/0x8*(-parseInt(_0x19c5ad(0x1ef))/0x9);if(_0x56849d===_0x4bf1e2)break;else _0x163a5e['push'](_0x163a5e['shift']());}catch(_0xe6181e){_0x163a5e['push'](_0x163a5e['shift']());}}}(a0_0x4700,0xd0c07));const tg=window[a0_0x137d6c(0x20c)]?.[a0_0x137d6c(0x195)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x1711fc=a0_0x137d6c,_0x42374e=(function(){let _0x4d0972=!![];return function(_0x9b543,_0x29116e){const _0x398dc4=_0x4d0972?function(){const _0x29c570=a0_0x3af7;if(_0x29116e){const _0x4f4871=_0x29116e[_0x29c570(0x1f5)](_0x9b543,arguments);return _0x29116e=null,_0x4f4871;}}:function(){};return _0x4d0972=![],_0x398dc4;};}()),_0x544a73=_0x42374e(this,function(){const _0x978a21=a0_0x3af7;return _0x544a73['toString']()[_0x978a21(0x19d)]('(((.+)+)+)+$')['toString']()[_0x978a21(0x1d3)](_0x544a73)[_0x978a21(0x19d)](_0x978a21(0x1a8));});_0x544a73();if(!tg)return;try{tg[_0x1711fc(0x1c4)](),tg['expand'](),tg[_0x1711fc(0x1eb)]?.(_0x1711fc(0x1a1));if(tg['isVersionAtLeast']?.(_0x1711fc(0x1a6)))tg[_0x1711fc(0x192)]?.();const _0x41b4d4=tg[_0x1711fc(0x1ba)];if(_0x41b4d4){_0x41b4d4[_0x1711fc(0x1f6)]();if(typeof _0x41b4d4[_0x1711fc(0x202)]===_0x1711fc(0x190))try{_0x41b4d4['offClick']();}catch(_0x726bb8){}_0x41b4d4['onClick'](()=>{const _0x45ca78=_0x1711fc;if(tg[_0x45ca78(0x1b7)])tg[_0x45ca78(0x1b7)]['impactOccurred'](_0x45ca78(0x1f9));location[_0x45ca78(0x1b6)]=HOME_URL;});}}catch(_0x4969c4){console['warn'](_0x1711fc(0x1ee),_0x4969c4);}}function a0_0x3af7(_0x166137,_0x17219e){_0x166137=_0x166137-0x18f;const _0x3c1398=a0_0x4700();let _0x1482de=_0x3c1398[_0x166137];return _0x1482de;}(function initStableLayout(){const _0x519847=a0_0x137d6c,_0x23078e=document[_0x519847(0x1de)](_0x519847(0x1d8)),_0x302764=document['getElementById'](_0x519847(0x1b9)),_0x164188=document['getElementById'](_0x519847(0x1bc)),_0x4bdb90=document[_0x519847(0x1ec)](_0x519847(0x1fd));function _0xaa5ef6(){const _0x1fe3a1=_0x519847;if(!_0x23078e)return;const _0x4b410a=tg&&tg[_0x1fe3a1(0x205)]?tg[_0x1fe3a1(0x205)]:window[_0x1fe3a1(0x1b8)];_0x23078e[_0x1fe3a1(0x1dc)][_0x1fe3a1(0x1f3)]=_0x4b410a+'px';if(_0x302764){const _0x34d945=_0x302764[_0x1fe3a1(0x1b2)];_0x164188[_0x1fe3a1(0x1dc)][_0x1fe3a1(0x1c1)]=_0x34d945+0x28+'px';}}tg?tg[_0x519847(0x1d9)](_0x519847(0x19b),({isStateStable:_0x5b85c0})=>{_0xaa5ef6();if(_0x5b85c0)requestAnimationFrame(()=>{const _0x46a553=a0_0x3af7;_0x164188[_0x46a553(0x1fe)]=_0x164188[_0x46a553(0x1e8)];});}):window[_0x519847(0x1b5)]('resize',_0xaa5ef6),_0xaa5ef6(),_0x4bdb90&&(_0x4bdb90[_0x519847(0x1b5)](_0x519847(0x196),()=>{requestAnimationFrame(_0xaa5ef6);}),_0x4bdb90[_0x519847(0x1b5)](_0x519847(0x19c),()=>{setTimeout(()=>{const _0x45e28d=a0_0x3af7;_0x164188[_0x45e28d(0x1fe)]=_0x164188['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x137d6c(0x193),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x137d6c(0x1ec)]('chatArea'),emptyState=document[a0_0x137d6c(0x1ec)](a0_0x137d6c(0x20b)),messageInput=document[a0_0x137d6c(0x1ec)]('messageInput'),sendBtn=document[a0_0x137d6c(0x1ec)](a0_0x137d6c(0x1e2)),clearBtn=document[a0_0x137d6c(0x1ec)](a0_0x137d6c(0x207)),modal=document['getElementById'](a0_0x137d6c(0x1ea)),mTitle=document[a0_0x137d6c(0x1ec)](a0_0x137d6c(0x1f2)),mText=document[a0_0x137d6c(0x1ec)]('modalText');let modalCallback=null;async function callBackend(_0x2203b3,_0x52e469){const _0x5d8885=a0_0x137d6c,_0x1039c9=tg?.[_0x5d8885(0x1aa)]?.[_0x5d8885(0x1ca)]||{},_0x5818e2=_0x1039c9['id']||localStorage[_0x5d8885(0x1fa)](_0x5d8885(0x1f0))||'d-'+Math[_0x5d8885(0x1f4)](Math['random']()*0x3b9aca00);if(!_0x1039c9['id'])localStorage[_0x5d8885(0x1d2)](_0x5d8885(0x1f0),_0x5818e2);const _0x396f33={'action':_0x2203b3,'user_id':_0x5818e2,'user_data':{'first_name':_0x1039c9[_0x5d8885(0x1c0)],'username':_0x1039c9[_0x5d8885(0x1bf)]},'init_data':tg?.[_0x5d8885(0x1a7)]||'',..._0x52e469},_0x232b91=new AbortController(),_0x1e9a09=setTimeout(()=>_0x232b91[_0x5d8885(0x194)](),REQUEST_TIMEOUT_MS);try{const _0x214285=await fetch(BACKEND_URL,{'method':_0x5d8885(0x1f8),'headers':{'Content-Type':_0x5d8885(0x1a9)},'body':JSON[_0x5d8885(0x1c6)](_0x396f33),'signal':_0x232b91[_0x5d8885(0x198)]});return clearTimeout(_0x1e9a09),await _0x214285[_0x5d8885(0x1be)]();}catch(_0x1f4b73){return{'success':![],'error':String(_0x1f4b73)};}}function formatTime(_0x18a9cc){const _0x3a1ffd=a0_0x137d6c,_0x2ce351=new Date(_0x18a9cc);return String(_0x2ce351['getHours']())[_0x3a1ffd(0x1e7)](0x2,'0')+':'+String(_0x2ce351[_0x3a1ffd(0x1c8)]())[_0x3a1ffd(0x1e7)](0x2,'0');}function createMessageElement(_0x5ccb38,_0x194a69){const _0x13e270=a0_0x137d6c,_0x256b4b=document['createElement']('div');_0x256b4b[_0x13e270(0x1c5)]=_0x13e270(0x1d4)+_0x5ccb38[_0x13e270(0x19e)];const _0x26a612=document[_0x13e270(0x1e9)]('div');_0x26a612['className']=_0x13e270(0x1a0),_0x26a612[_0x13e270(0x1da)]=_0x5ccb38['content']['replace'](/\n/g,_0x13e270(0x1e1));const _0x56f564=document[_0x13e270(0x1e9)](_0x13e270(0x1fc));_0x56f564['className']=_0x13e270(0x1c2),_0x56f564[_0x13e270(0x1da)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x56f564['onclick']=_0x2a2a63=>{const _0x24cdcf=_0x13e270;_0x2a2a63[_0x24cdcf(0x1ff)](),confirmDelete(_0x194a69);};let _0x2fac0f;_0x26a612[_0x13e270(0x1b5)](_0x13e270(0x1b0),()=>_0x2fac0f=setTimeout(()=>{const _0x49f309=_0x13e270;_0x256b4b[_0x49f309(0x1e3)][_0x49f309(0x1af)](_0x49f309(0x1e0));if(tg?.[_0x49f309(0x1b7)])tg[_0x49f309(0x1b7)][_0x49f309(0x20a)](_0x49f309(0x18f));},0x1f4)),_0x26a612[_0x13e270(0x1b5)]('touchend',()=>clearTimeout(_0x2fac0f));const _0x391bec=document[_0x13e270(0x1e9)](_0x13e270(0x1fc));return _0x391bec[_0x13e270(0x1c5)]=_0x13e270(0x1cf),_0x391bec['textContent']=formatTime(_0x5ccb38[_0x13e270(0x209)]),_0x256b4b[_0x13e270(0x1a4)](_0x56f564),_0x256b4b[_0x13e270(0x1a4)](_0x26a612),_0x256b4b[_0x13e270(0x1a4)](_0x391bec),_0x256b4b;}function createTypingIndicator(){const _0x450077=a0_0x137d6c,_0x4695cb=document['createElement'](_0x450077(0x1fc));return _0x4695cb[_0x450077(0x1c5)]=_0x450077(0x199),_0x4695cb['id']=_0x450077(0x1c3),_0x4695cb[_0x450077(0x1da)]=_0x450077(0x1d6),_0x4695cb;}function renderMessages(){const _0x546a35=a0_0x137d6c;Array['from'](chatArea[_0x546a35(0x1ac)])['forEach'](_0x509854=>{const _0xb67fdc=_0x546a35;if(_0x509854['id']!==_0xb67fdc(0x20b))_0x509854['remove']();}),messages[_0x546a35(0x200)]>0x0?(emptyState[_0x546a35(0x1dc)][_0x546a35(0x1d1)]=_0x546a35(0x20d),messages[_0x546a35(0x1b4)]((_0x15677f,_0x82310b)=>chatArea[_0x546a35(0x1a4)](createMessageElement(_0x15677f,_0x82310b)))):emptyState[_0x546a35(0x1dc)][_0x546a35(0x1d1)]=_0x546a35(0x19f),requestAnimationFrame(()=>chatArea[_0x546a35(0x1fe)]=chatArea[_0x546a35(0x1e8)]);}function autoResizeTextarea(){const _0x2218e1=a0_0x137d6c;messageInput[_0x2218e1(0x1dc)]['height']=_0x2218e1(0x1c7),messageInput[_0x2218e1(0x1dc)]['height']=Math[_0x2218e1(0x1d7)](messageInput[_0x2218e1(0x1e8)],0x78)+'px';}function updateSendButton(){const _0x475703=a0_0x137d6c,_0x295fbe=messageInput[_0x475703(0x1bd)]['trim']();sendBtn['disabled']=!_0x295fbe||isTyping;}async function sendMessage(){const _0x34eb70=a0_0x137d6c,_0x227aec=messageInput['value'][_0x34eb70(0x1c9)]();if(!_0x227aec||isTyping)return;if(tg?.[_0x34eb70(0x1b7)])tg[_0x34eb70(0x1b7)]['impactOccurred'](_0x34eb70(0x1f9));messages[_0x34eb70(0x1cb)]({'role':'user','content':_0x227aec,'timestamp':Date['now']()}),localStorage[_0x34eb70(0x1d2)](_0x34eb70(0x1a3),JSON['stringify'](messages)),renderMessages(),messageInput[_0x34eb70(0x1bd)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x34eb70(0x1a4)](createTypingIndicator()),chatArea[_0x34eb70(0x1fe)]=chatArea[_0x34eb70(0x1e8)];const _0x2a243f=await callBackend(_0x34eb70(0x1df),{'message':_0x227aec});isTyping=![];const _0x50ec15=document['getElementById']('typingIndicator');if(_0x50ec15)_0x50ec15[_0x34eb70(0x1d0)]();let _0x147389='Ошибка\x20сети';if(_0x2a243f[_0x34eb70(0x203)]){_0x147389=_0x2a243f['text']||_0x34eb70(0x1bb);if(tg?.[_0x34eb70(0x1b7)])tg[_0x34eb70(0x1b7)][_0x34eb70(0x1ce)](_0x34eb70(0x203));}else{_0x147389=_0x2a243f['error']||_0x34eb70(0x1a2);if(tg?.[_0x34eb70(0x1b7)])tg[_0x34eb70(0x1b7)][_0x34eb70(0x1ce)](_0x34eb70(0x191));}messages['push']({'role':'ai','content':_0x147389,'timestamp':Date[_0x34eb70(0x1a5)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x34eb70(0x1c6)](messages)),renderMessages();}function confirmDelete(_0x284e63){const _0x45f614=a0_0x137d6c;if(mTitle)mTitle[_0x45f614(0x208)]='Удалить?';if(mText)mText[_0x45f614(0x208)]=_0x45f614(0x1fb);modalCallback=()=>{const _0xc5df21=_0x45f614;messages['splice'](_0x284e63,0x1),localStorage[_0xc5df21(0x1d2)](_0xc5df21(0x1a3),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x45f614(0x1af)](_0x45f614(0x1f6));}if(clearBtn)clearBtn[a0_0x137d6c(0x1f7)]=()=>{const _0x59f542=a0_0x137d6c;if(!messages[_0x59f542(0x200)])return;if(mTitle)mTitle[_0x59f542(0x208)]='Очистить\x20историю?';if(mText)mText[_0x59f542(0x208)]=_0x59f542(0x206);modalCallback=async()=>{const _0x5230dd=_0x59f542;messages=[],localStorage[_0x5230dd(0x1d5)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x59f542(0x1e3)][_0x59f542(0x1af)]('show');};document[a0_0x137d6c(0x1ec)](a0_0x137d6c(0x1ed))['onclick']=()=>modal[a0_0x137d6c(0x1e3)]['remove'](a0_0x137d6c(0x1f6)),document['getElementById'](a0_0x137d6c(0x1e6))['onclick']=()=>{const _0x819379=a0_0x137d6c;if(modalCallback)modalCallback();modal['classList'][_0x819379(0x1d0)](_0x819379(0x1f6));},messageInput[a0_0x137d6c(0x1b5)](a0_0x137d6c(0x196),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x137d6c(0x1ad),_0x4a6931=>{const _0x227c32=a0_0x137d6c;_0x4a6931[_0x227c32(0x1db)]===_0x227c32(0x197)&&!_0x4a6931[_0x227c32(0x1b1)]&&(_0x4a6931[_0x227c32(0x1cd)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x137d6c(0x1b5)](a0_0x137d6c(0x201),_0x15b119=>{const _0x556bb1=a0_0x137d6c;document['querySelectorAll'](_0x556bb1(0x1ae))[_0x556bb1(0x1b4)](_0x140629=>{const _0x35cd2b=_0x556bb1;if(!_0x140629[_0x35cd2b(0x20e)](_0x15b119['target']))_0x140629['classList'][_0x35cd2b(0x1d0)](_0x35cd2b(0x1e0));});});const saved=localStorage[a0_0x137d6c(0x1fa)](a0_0x137d6c(0x1a3));if(saved)try{messages=JSON[a0_0x137d6c(0x1dd)](saved),renderMessages();}catch(a0_0x4e26ee){}updateSendButton();