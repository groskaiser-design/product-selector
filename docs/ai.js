function a0_0x3ddd(_0x28ef39,_0x4c3c27){_0x28ef39=_0x28ef39-0x10f;const _0x1f9693=a0_0x226b();let _0x15cb13=_0x1f9693[_0x28ef39];return _0x15cb13;}const a0_0x308793=a0_0x3ddd;(function(_0x35c45a,_0x49a708){const _0x33e8f9=a0_0x3ddd,_0x127691=_0x35c45a();while(!![]){try{const _0x4727ab=parseInt(_0x33e8f9(0x152))/0x1+-parseInt(_0x33e8f9(0x11f))/0x2+parseInt(_0x33e8f9(0x126))/0x3*(-parseInt(_0x33e8f9(0x115))/0x4)+-parseInt(_0x33e8f9(0x172))/0x5+-parseInt(_0x33e8f9(0x128))/0x6+-parseInt(_0x33e8f9(0x131))/0x7+parseInt(_0x33e8f9(0x15a))/0x8*(parseInt(_0x33e8f9(0x14d))/0x9);if(_0x4727ab===_0x49a708)break;else _0x127691['push'](_0x127691['shift']());}catch(_0x1897d7){_0x127691['push'](_0x127691['shift']());}}}(a0_0x226b,0x27495));const tg=window[a0_0x308793(0x120)]?.[a0_0x308793(0x12a)],HOME_URL=a0_0x308793(0x15b);function setupTelegramBackButton(){const _0x5e3a27=a0_0x308793;if(!tg)return;try{tg[_0x5e3a27(0x111)](),tg[_0x5e3a27(0x157)](),tg[_0x5e3a27(0x167)]?.(_0x5e3a27(0x114));if(tg[_0x5e3a27(0x185)]?.(_0x5e3a27(0x11a)))tg[_0x5e3a27(0x17a)]?.();const _0x6882d1=tg[_0x5e3a27(0x141)];if(_0x6882d1){_0x6882d1[_0x5e3a27(0x14b)]();if(typeof _0x6882d1[_0x5e3a27(0x13d)]===_0x5e3a27(0x155))try{_0x6882d1[_0x5e3a27(0x13d)]();}catch(_0x1bdcb1){}_0x6882d1[_0x5e3a27(0x153)](()=>{const _0xcef777=_0x5e3a27;if(tg[_0xcef777(0x14f)])tg[_0xcef777(0x14f)][_0xcef777(0x142)](_0xcef777(0x184));location[_0xcef777(0x13f)]=HOME_URL;});}}catch(_0x4cb8a3){console['warn']('TG\x20setup\x20error:',_0x4cb8a3);}}(function initStableLayout(){const _0x227065=a0_0x308793,_0x2ef450=(function(){let _0x36013c=!![];return function(_0x6252f3,_0x81e24b){const _0x2a9ee7=_0x36013c?function(){if(_0x81e24b){const _0x18171e=_0x81e24b['apply'](_0x6252f3,arguments);return _0x81e24b=null,_0x18171e;}}:function(){};return _0x36013c=![],_0x2a9ee7;};}()),_0x199539=document[_0x227065(0x134)]('.container'),_0x2ba4cb=document[_0x227065(0x125)](_0x227065(0x162)),_0x4baff8=document[_0x227065(0x125)](_0x227065(0x183)),_0x53f289=document['getElementById'](_0x227065(0x174));function _0x4fa989(){const _0x505646=_0x227065,_0x119b01=_0x2ef450(this,function(){const _0x54d8b1=a0_0x3ddd;return _0x119b01[_0x54d8b1(0x135)]()[_0x54d8b1(0x16a)](_0x54d8b1(0x181))[_0x54d8b1(0x135)]()[_0x54d8b1(0x176)](_0x119b01)[_0x54d8b1(0x16a)]('(((.+)+)+)+$');});_0x119b01();if(!_0x199539)return;const _0x265834=tg&&tg[_0x505646(0x164)]?tg['viewportHeight']:window[_0x505646(0x163)];_0x199539[_0x505646(0x169)][_0x505646(0x13e)]=_0x265834+'px';if(_0x2ba4cb){const _0x53396d=_0x2ba4cb[_0x505646(0x165)];_0x4baff8['style'][_0x505646(0x12e)]=_0x53396d+0x28+'px';}}tg?tg[_0x227065(0x144)](_0x227065(0x127),({isStateStable:_0x3c38fb})=>{_0x4fa989();if(_0x3c38fb)requestAnimationFrame(()=>{const _0x192af7=a0_0x3ddd;_0x4baff8[_0x192af7(0x12d)]=_0x4baff8[_0x192af7(0x159)];});}):window[_0x227065(0x15e)](_0x227065(0x122),_0x4fa989),_0x4fa989(),_0x53f289&&(_0x53f289[_0x227065(0x15e)](_0x227065(0x14a),()=>{requestAnimationFrame(_0x4fa989);}),_0x53f289[_0x227065(0x15e)](_0x227065(0x17e),()=>{setTimeout(()=>{const _0x33c648=a0_0x3ddd;_0x4baff8[_0x33c648(0x12d)]=_0x4baff8[_0x33c648(0x159)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x226b(){const _0x31b887=['offClick','height','href','json','BackButton','impactOccurred','div','onEvent','abort','none','createElement','clearBtn','content','input','show','user','4343796KQkOko','message\x20ai','HapticFeedback','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','notificationOccurred','201684SeZJol','onClick','modalCancel','function','random','expand','message\x20','scrollHeight','16ZsPTps','./router.html','Ошибка\x20сети','padStart','addEventListener','touchend','replace','first_name','inputArea','innerHeight','viewportHeight','offsetHeight','value','setHeaderColor','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','style','search','touchstart','role','stringify','clear_history','confirmModal','flex','className','826220XhBnti','Начнется\x20новый\x20диалог.','messageInput','Пустой\x20ответ','constructor','typingIndicator','ai_chat_messages','error','disableVerticalSwipes','<br>','children','setItem','focus','click','classList','(((.+)+)+)+$','modalConfirm','chatArea','light','isVersionAtLeast','success','message-bubble','push','key','target','remove','splice','ready','onclick','preventDefault','#050505','519064OYZuoF','getItem','shiftKey','Удалить?','parse','6.1','trim','Действие\x20необратимо.','length','stopPropagation','534044dPXqwo','Telegram','show-delete','resize','signal','min','getElementById','6xGlEVY','viewportChanged','1350144RqRrYW','initDataUnsafe','WebApp','send_message','innerHTML','scrollTop','paddingBottom','sendBtn','from','624631npxyOy','textContent','appendChild','querySelector','toString','debug_uid','emptyState','querySelectorAll','getHours','display','forEach','add'];a0_0x226b=function(){return _0x31b887;};return a0_0x226b();}const chatArea=document['getElementById'](a0_0x308793(0x183)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x308793(0x125)]('messageInput'),sendBtn=document[a0_0x308793(0x125)](a0_0x308793(0x12f)),clearBtn=document[a0_0x308793(0x125)](a0_0x308793(0x148)),modal=document['getElementById'](a0_0x308793(0x16f)),mTitle=document[a0_0x308793(0x125)]('modalTitle'),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x113392,_0x3e160f){const _0x59953d=a0_0x308793,_0x345bbb=tg?.[_0x59953d(0x129)]?.[_0x59953d(0x14c)]||{},_0x11f413=_0x345bbb['id']||localStorage[_0x59953d(0x116)](_0x59953d(0x136))||'d-'+Math['floor'](Math[_0x59953d(0x156)]()*0x3b9aca00);if(!_0x345bbb['id'])localStorage[_0x59953d(0x17d)](_0x59953d(0x136),_0x11f413);const _0xa783f7={'action':_0x113392,'user_id':_0x11f413,'user_data':{'first_name':_0x345bbb[_0x59953d(0x161)],'username':_0x345bbb['username']},'init_data':tg?.['initData']||'',..._0x3e160f},_0x304602=new AbortController(),_0x5eef17=setTimeout(()=>_0x304602[_0x59953d(0x145)](),REQUEST_TIMEOUT_MS);try{const _0x546a2f=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x59953d(0x16d)](_0xa783f7),'signal':_0x304602[_0x59953d(0x123)]});return clearTimeout(_0x5eef17),await _0x546a2f[_0x59953d(0x140)]();}catch(_0x2754c2){return{'success':![],'error':String(_0x2754c2)};}}function formatTime(_0x135f4e){const _0x3418d7=a0_0x308793,_0x251f3c=new Date(_0x135f4e);return String(_0x251f3c[_0x3418d7(0x139)]())[_0x3418d7(0x15d)](0x2,'0')+':'+String(_0x251f3c['getMinutes']())[_0x3418d7(0x15d)](0x2,'0');}function createMessageElement(_0x2357a8,_0x4f24d8){const _0x33a8be=a0_0x308793,_0x26bae2=document[_0x33a8be(0x147)](_0x33a8be(0x143));_0x26bae2['className']=_0x33a8be(0x158)+_0x2357a8[_0x33a8be(0x16c)];const _0x4de8e4=document['createElement'](_0x33a8be(0x143));_0x4de8e4[_0x33a8be(0x171)]=_0x33a8be(0x187),_0x4de8e4[_0x33a8be(0x12c)]=_0x2357a8[_0x33a8be(0x149)][_0x33a8be(0x160)](/\n/g,_0x33a8be(0x17b));const _0x2cd020=document[_0x33a8be(0x147)]('div');_0x2cd020[_0x33a8be(0x171)]='delete-btn',_0x2cd020[_0x33a8be(0x12c)]=_0x33a8be(0x168),_0x2cd020['onclick']=_0x5a6231=>{const _0x44c619=_0x33a8be;_0x5a6231[_0x44c619(0x11e)](),confirmDelete(_0x4f24d8);};let _0x58938d;_0x4de8e4['addEventListener'](_0x33a8be(0x16b),()=>_0x58938d=setTimeout(()=>{const _0x2a9659=_0x33a8be;_0x26bae2[_0x2a9659(0x180)][_0x2a9659(0x13c)](_0x2a9659(0x121));if(tg?.[_0x2a9659(0x14f)])tg[_0x2a9659(0x14f)][_0x2a9659(0x142)]('medium');},0x1f4)),_0x4de8e4[_0x33a8be(0x15e)](_0x33a8be(0x15f),()=>clearTimeout(_0x58938d));const _0x1915b1=document[_0x33a8be(0x147)](_0x33a8be(0x143));return _0x1915b1[_0x33a8be(0x171)]='message-time',_0x1915b1[_0x33a8be(0x132)]=formatTime(_0x2357a8['timestamp']),_0x26bae2[_0x33a8be(0x133)](_0x2cd020),_0x26bae2[_0x33a8be(0x133)](_0x4de8e4),_0x26bae2[_0x33a8be(0x133)](_0x1915b1),_0x26bae2;}function createTypingIndicator(){const _0x2412d3=a0_0x308793,_0x1812c5=document[_0x2412d3(0x147)](_0x2412d3(0x143));return _0x1812c5[_0x2412d3(0x171)]=_0x2412d3(0x14e),_0x1812c5['id']=_0x2412d3(0x177),_0x1812c5[_0x2412d3(0x12c)]=_0x2412d3(0x150),_0x1812c5;}function renderMessages(){const _0x1d826e=a0_0x308793;Array[_0x1d826e(0x130)](chatArea[_0x1d826e(0x17c)])[_0x1d826e(0x13b)](_0x1ce825=>{const _0x62ea9=_0x1d826e;if(_0x1ce825['id']!==_0x62ea9(0x137))_0x1ce825[_0x62ea9(0x10f)]();}),messages[_0x1d826e(0x11d)]>0x0?(emptyState[_0x1d826e(0x169)][_0x1d826e(0x13a)]=_0x1d826e(0x146),messages[_0x1d826e(0x13b)]((_0x1befd4,_0x4a41b8)=>chatArea[_0x1d826e(0x133)](createMessageElement(_0x1befd4,_0x4a41b8)))):emptyState[_0x1d826e(0x169)]['display']=_0x1d826e(0x170),requestAnimationFrame(()=>chatArea[_0x1d826e(0x12d)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x122346=a0_0x308793;messageInput[_0x122346(0x169)][_0x122346(0x13e)]='auto',messageInput['style'][_0x122346(0x13e)]=Math[_0x122346(0x124)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x28c265=a0_0x308793,_0x245df9=messageInput[_0x28c265(0x166)][_0x28c265(0x11b)]();sendBtn['disabled']=!_0x245df9||isTyping;}async function sendMessage(){const _0x3aa2c4=a0_0x308793,_0x5a18ec=messageInput['value'][_0x3aa2c4(0x11b)]();if(!_0x5a18ec||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x3aa2c4(0x14f)][_0x3aa2c4(0x142)](_0x3aa2c4(0x184));messages[_0x3aa2c4(0x188)]({'role':_0x3aa2c4(0x14c),'content':_0x5a18ec,'timestamp':Date['now']()}),localStorage[_0x3aa2c4(0x17d)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0x3aa2c4(0x166)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x3aa2c4(0x12d)]=chatArea[_0x3aa2c4(0x159)];const _0x5abaca=await callBackend(_0x3aa2c4(0x12b),{'message':_0x5a18ec});isTyping=![];const _0x4a93b5=document['getElementById'](_0x3aa2c4(0x177));if(_0x4a93b5)_0x4a93b5[_0x3aa2c4(0x10f)]();let _0x352192=_0x3aa2c4(0x15c);if(_0x5abaca['success']){_0x352192=_0x5abaca['text']||_0x3aa2c4(0x175);if(tg?.[_0x3aa2c4(0x14f)])tg['HapticFeedback'][_0x3aa2c4(0x151)](_0x3aa2c4(0x186));}else{_0x352192=_0x5abaca['error']||'Ошибка\x20сервера';if(tg?.[_0x3aa2c4(0x14f)])tg[_0x3aa2c4(0x14f)][_0x3aa2c4(0x151)](_0x3aa2c4(0x179));}messages['push']({'role':'ai','content':_0x352192,'timestamp':Date['now']()}),localStorage[_0x3aa2c4(0x17d)](_0x3aa2c4(0x178),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x54f3ab){const _0x39cc3a=a0_0x308793;if(mTitle)mTitle[_0x39cc3a(0x132)]=_0x39cc3a(0x118);if(mText)mText[_0x39cc3a(0x132)]=_0x39cc3a(0x11c);modalCallback=()=>{const _0x1ba089=_0x39cc3a;messages[_0x1ba089(0x110)](_0x54f3ab,0x1),localStorage[_0x1ba089(0x17d)]('ai_chat_messages',JSON[_0x1ba089(0x16d)](messages)),renderMessages();},modal[_0x39cc3a(0x180)]['add']('show');}if(clearBtn)clearBtn[a0_0x308793(0x112)]=()=>{const _0x2a4189=a0_0x308793;if(!messages[_0x2a4189(0x11d)])return;if(mTitle)mTitle[_0x2a4189(0x132)]='Очистить\x20историю?';if(mText)mText[_0x2a4189(0x132)]=_0x2a4189(0x173);modalCallback=async()=>{const _0x36a4dd=_0x2a4189;messages=[],localStorage['removeItem'](_0x36a4dd(0x178)),renderMessages(),callBackend(_0x36a4dd(0x16e),{});},modal['classList'][_0x2a4189(0x13c)](_0x2a4189(0x14b));};document[a0_0x308793(0x125)](a0_0x308793(0x154))[a0_0x308793(0x112)]=()=>modal[a0_0x308793(0x180)]['remove'](a0_0x308793(0x14b)),document['getElementById'](a0_0x308793(0x182))[a0_0x308793(0x112)]=()=>{const _0xd75ddb=a0_0x308793;if(modalCallback)modalCallback();modal[_0xd75ddb(0x180)][_0xd75ddb(0x10f)]('show');},messageInput[a0_0x308793(0x15e)](a0_0x308793(0x14a),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x308793(0x15e)]('keydown',_0x11d8d6=>{const _0x3a0b48=a0_0x308793;_0x11d8d6[_0x3a0b48(0x189)]==='Enter'&&!_0x11d8d6[_0x3a0b48(0x117)]&&(_0x11d8d6[_0x3a0b48(0x113)](),sendMessage());}),sendBtn[a0_0x308793(0x112)]=sendMessage,document[a0_0x308793(0x15e)](a0_0x308793(0x17f),_0x2c24bb=>{const _0x575655=a0_0x308793;document[_0x575655(0x138)]('.message.show-delete')['forEach'](_0x4cdfe0=>{const _0x1bcce2=_0x575655;if(!_0x4cdfe0['contains'](_0x2c24bb[_0x1bcce2(0x18a)]))_0x4cdfe0[_0x1bcce2(0x180)][_0x1bcce2(0x10f)](_0x1bcce2(0x121));});});const saved=localStorage[a0_0x308793(0x116)](a0_0x308793(0x178));if(saved)try{messages=JSON[a0_0x308793(0x119)](saved),renderMessages();}catch(a0_0x29aa36){}updateSendButton();