const a0_0x2cfb98=a0_0x249e;(function(_0x42d8d8,_0x1e2336){const _0x15947e=a0_0x249e,_0x2d926f=_0x42d8d8();while(!![]){try{const _0x445a02=-parseInt(_0x15947e(0x23b))/0x1*(parseInt(_0x15947e(0x236))/0x2)+parseInt(_0x15947e(0x25f))/0x3*(-parseInt(_0x15947e(0x209))/0x4)+-parseInt(_0x15947e(0x1f3))/0x5+parseInt(_0x15947e(0x23a))/0x6+parseInt(_0x15947e(0x264))/0x7+-parseInt(_0x15947e(0x225))/0x8+parseInt(_0x15947e(0x25e))/0x9;if(_0x445a02===_0x1e2336)break;else _0x2d926f['push'](_0x2d926f['shift']());}catch(_0x52aca4){_0x2d926f['push'](_0x2d926f['shift']());}}}(a0_0x680a,0x1dd64));const tg=window[a0_0x2cfb98(0x259)]?.['WebApp'],HOME_URL=a0_0x2cfb98(0x253);function setupTelegramBackButton(){const _0x48266f=a0_0x2cfb98,_0x33c452=(function(){let _0x2a88f5=!![];return function(_0x3e88a4,_0x1ea09f){const _0x2436e2=_0x2a88f5?function(){const _0x40d339=a0_0x249e;if(_0x1ea09f){const _0x2c150f=_0x1ea09f[_0x40d339(0x22c)](_0x3e88a4,arguments);return _0x1ea09f=null,_0x2c150f;}}:function(){};return _0x2a88f5=![],_0x2436e2;};}()),_0x2a63b1=_0x33c452(this,function(){const _0x444be5=a0_0x249e;return _0x2a63b1[_0x444be5(0x1f4)]()[_0x444be5(0x249)](_0x444be5(0x260))['toString']()['constructor'](_0x2a63b1)[_0x444be5(0x249)](_0x444be5(0x260));});_0x2a63b1();if(!tg)return;try{tg[_0x48266f(0x235)](),tg[_0x48266f(0x200)](),tg[_0x48266f(0x244)]?.('#050505');if(tg[_0x48266f(0x21d)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x67dab=tg[_0x48266f(0x24c)];if(_0x67dab){_0x67dab[_0x48266f(0x26c)]();if(typeof _0x67dab[_0x48266f(0x234)]===_0x48266f(0x25b))try{_0x67dab[_0x48266f(0x234)]();}catch(_0x5c5cb7){}_0x67dab['onClick'](()=>{const _0x19fc85=_0x48266f;if(tg['HapticFeedback'])tg[_0x19fc85(0x20c)][_0x19fc85(0x217)]('light');location[_0x19fc85(0x246)]=HOME_URL;});}}catch(_0x59cb2e){console[_0x48266f(0x232)](_0x48266f(0x269),_0x59cb2e);}}function a0_0x680a(){const _0x5329ef=['BackButton','touchend','ai_chat_messages','height','disabled','abort','querySelector','./router.html','querySelectorAll','children','emptyState','className','initData','Telegram','flex','function','target','classList','374652fDRkSl','135FmhqkD','(((.+)+)+)+$','getMinutes','POST','shiftKey','1487409PtoJwq','scrollHeight','message-bubble','success','modalCancel','TG\x20setup\x20error:','error','setItem','show','onEvent','innerHeight','498700oCAcEN','toString','padStart','none','modalTitle','light','show-delete','Enter','stringify','remove','scrollTop','trim','text/plain','expand','send_message','viewportChanged','getHours','timestamp','initDataUnsafe','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','medium','confirmModal','584PqbXQj','replace','floor','HapticFeedback','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','auto','style','getElementById','div','from','modalText','Ошибка\x20сети','value','Очистить\x20историю?','impactOccurred','createElement','appendChild','push','length','sendBtn','isVersionAtLeast','<br>','message\x20ai','username','.message.show-delete','message-time','min','forEach','1587160WnEbnI','role','preventDefault','chatArea','user','Пустой\x20ответ','content','apply','getItem','modalConfirm','Ошибка\x20сервера','message\x20','messageInput','warn','key','offClick','ready','20264wxNtUf','splice','debug_uid','now','1158396TWSbzu','2xdYuHy','innerHTML','typingIndicator','viewportHeight','onclick','delete-btn','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','parse','textContent','setHeaderColor','Начнется\x20новый\x20диалог.','href','add','addEventListener','search','clear_history','input'];a0_0x680a=function(){return _0x5329ef;};return a0_0x680a();}(function initStableLayout(){const _0x538dcf=a0_0x2cfb98,_0x13dd04=document[_0x538dcf(0x252)]('.container'),_0x329b8c=document[_0x538dcf(0x210)]('inputArea'),_0x3df7c7=document[_0x538dcf(0x210)](_0x538dcf(0x228)),_0x266b51=document[_0x538dcf(0x210)](_0x538dcf(0x231));function _0x5e858c(){const _0x1423ae=_0x538dcf;if(!_0x13dd04)return;const _0x22ad1b=tg&&tg[_0x1423ae(0x23e)]?tg['viewportHeight']:window[_0x1423ae(0x26e)];_0x13dd04[_0x1423ae(0x20f)][_0x1423ae(0x24f)]=_0x22ad1b+'px';if(_0x329b8c){const _0x2f6725=_0x329b8c['offsetHeight'];_0x3df7c7['style']['paddingBottom']=_0x2f6725+0x28+'px';}}tg?tg[_0x538dcf(0x26d)](_0x538dcf(0x202),({isStateStable:_0x5211d2})=>{_0x5e858c();if(_0x5211d2)requestAnimationFrame(()=>{_0x3df7c7['scrollTop']=_0x3df7c7['scrollHeight'];});}):window[_0x538dcf(0x248)]('resize',_0x5e858c),_0x5e858c(),_0x266b51&&(_0x266b51[_0x538dcf(0x248)](_0x538dcf(0x24b),()=>{requestAnimationFrame(_0x5e858c);}),_0x266b51[_0x538dcf(0x248)]('focus',()=>{setTimeout(()=>{const _0x441cf5=a0_0x249e;_0x3df7c7['scrollTop']=_0x3df7c7[_0x441cf5(0x265)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2cfb98(0x206),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x249e(_0x2accc4,_0x89520f){_0x2accc4=_0x2accc4-0x1f3;const _0x59bcd0=a0_0x680a();let _0x2dffa5=_0x59bcd0[_0x2accc4];return _0x2dffa5;}let messages=[],isTyping=![];const chatArea=document[a0_0x2cfb98(0x210)](a0_0x2cfb98(0x228)),emptyState=document[a0_0x2cfb98(0x210)](a0_0x2cfb98(0x256)),messageInput=document[a0_0x2cfb98(0x210)]('messageInput'),sendBtn=document['getElementById'](a0_0x2cfb98(0x21c)),clearBtn=document[a0_0x2cfb98(0x210)]('clearBtn'),modal=document[a0_0x2cfb98(0x210)](a0_0x2cfb98(0x208)),mTitle=document[a0_0x2cfb98(0x210)](a0_0x2cfb98(0x1f7)),mText=document[a0_0x2cfb98(0x210)](a0_0x2cfb98(0x213));let modalCallback=null;async function callBackend(_0x519069,_0x7dbb1c){const _0x284abd=a0_0x2cfb98,_0x422f7c=tg?.[_0x284abd(0x205)]?.[_0x284abd(0x229)]||{},_0x1da876=_0x422f7c['id']||localStorage[_0x284abd(0x22d)](_0x284abd(0x238))||'d-'+Math[_0x284abd(0x20b)](Math['random']()*0x3b9aca00);if(!_0x422f7c['id'])localStorage[_0x284abd(0x26b)](_0x284abd(0x238),_0x1da876);const _0x4228bc={'action':_0x519069,'user_id':_0x1da876,'user_data':{'first_name':_0x422f7c['first_name'],'username':_0x422f7c[_0x284abd(0x220)]},'init_data':tg?.[_0x284abd(0x258)]||'',..._0x7dbb1c},_0xea6fb8=new AbortController(),_0x446ad6=setTimeout(()=>_0xea6fb8[_0x284abd(0x251)](),REQUEST_TIMEOUT_MS);try{const _0x35e05e=await fetch(BACKEND_URL,{'method':_0x284abd(0x262),'headers':{'Content-Type':_0x284abd(0x1ff)},'body':JSON[_0x284abd(0x1fb)](_0x4228bc),'signal':_0xea6fb8['signal']});return clearTimeout(_0x446ad6),await _0x35e05e['json']();}catch(_0x224608){return{'success':![],'error':String(_0x224608)};}}function formatTime(_0xd6d55){const _0x12fab4=a0_0x2cfb98,_0x23e614=new Date(_0xd6d55);return String(_0x23e614[_0x12fab4(0x203)]())[_0x12fab4(0x1f5)](0x2,'0')+':'+String(_0x23e614[_0x12fab4(0x261)]())[_0x12fab4(0x1f5)](0x2,'0');}function createMessageElement(_0xfcb130,_0x1598cb){const _0x4b2d11=a0_0x2cfb98,_0x142a3c=document[_0x4b2d11(0x218)](_0x4b2d11(0x211));_0x142a3c[_0x4b2d11(0x257)]=_0x4b2d11(0x230)+_0xfcb130[_0x4b2d11(0x226)];const _0x41cf2d=document['createElement'](_0x4b2d11(0x211));_0x41cf2d['className']=_0x4b2d11(0x266),_0x41cf2d['innerHTML']=_0xfcb130[_0x4b2d11(0x22b)][_0x4b2d11(0x20a)](/\n/g,_0x4b2d11(0x21e));const _0x17aaba=document['createElement'](_0x4b2d11(0x211));_0x17aaba['className']=_0x4b2d11(0x240),_0x17aaba[_0x4b2d11(0x23c)]=_0x4b2d11(0x241),_0x17aaba[_0x4b2d11(0x23f)]=_0x4bdade=>{_0x4bdade['stopPropagation'](),confirmDelete(_0x1598cb);};let _0x6fcf37;_0x41cf2d[_0x4b2d11(0x248)]('touchstart',()=>_0x6fcf37=setTimeout(()=>{const _0x5221ad=_0x4b2d11;_0x142a3c['classList'][_0x5221ad(0x247)](_0x5221ad(0x1f9));if(tg?.['HapticFeedback'])tg[_0x5221ad(0x20c)][_0x5221ad(0x217)](_0x5221ad(0x207));},0x1f4)),_0x41cf2d['addEventListener'](_0x4b2d11(0x24d),()=>clearTimeout(_0x6fcf37));const _0x174596=document[_0x4b2d11(0x218)]('div');return _0x174596[_0x4b2d11(0x257)]=_0x4b2d11(0x222),_0x174596[_0x4b2d11(0x243)]=formatTime(_0xfcb130[_0x4b2d11(0x204)]),_0x142a3c[_0x4b2d11(0x219)](_0x17aaba),_0x142a3c[_0x4b2d11(0x219)](_0x41cf2d),_0x142a3c[_0x4b2d11(0x219)](_0x174596),_0x142a3c;}function createTypingIndicator(){const _0x1c29d1=a0_0x2cfb98,_0x5ea456=document['createElement']('div');return _0x5ea456[_0x1c29d1(0x257)]=_0x1c29d1(0x21f),_0x5ea456['id']=_0x1c29d1(0x23d),_0x5ea456['innerHTML']=_0x1c29d1(0x20d),_0x5ea456;}function renderMessages(){const _0x2141dd=a0_0x2cfb98;Array[_0x2141dd(0x212)](chatArea[_0x2141dd(0x255)])[_0x2141dd(0x224)](_0x148b50=>{const _0x340ba8=_0x2141dd;if(_0x148b50['id']!==_0x340ba8(0x256))_0x148b50['remove']();}),messages[_0x2141dd(0x21b)]>0x0?(emptyState['style']['display']=_0x2141dd(0x1f6),messages['forEach']((_0x3e39fd,_0x1ae76f)=>chatArea[_0x2141dd(0x219)](createMessageElement(_0x3e39fd,_0x1ae76f)))):emptyState[_0x2141dd(0x20f)]['display']=_0x2141dd(0x25a),requestAnimationFrame(()=>chatArea[_0x2141dd(0x1fd)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0xb8b507=a0_0x2cfb98;messageInput['style'][_0xb8b507(0x24f)]=_0xb8b507(0x20e),messageInput[_0xb8b507(0x20f)][_0xb8b507(0x24f)]=Math[_0xb8b507(0x223)](messageInput[_0xb8b507(0x265)],0x78)+'px';}function updateSendButton(){const _0x7fd695=a0_0x2cfb98,_0x61de3c=messageInput['value']['trim']();sendBtn[_0x7fd695(0x250)]=!_0x61de3c||isTyping;}async function sendMessage(){const _0x35cb59=a0_0x2cfb98,_0x32ff0e=messageInput[_0x35cb59(0x215)][_0x35cb59(0x1fe)]();if(!_0x32ff0e||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x35cb59(0x20c)]['impactOccurred'](_0x35cb59(0x1f8));messages[_0x35cb59(0x21a)]({'role':_0x35cb59(0x229),'content':_0x32ff0e,'timestamp':Date[_0x35cb59(0x239)]()}),localStorage[_0x35cb59(0x26b)](_0x35cb59(0x24e),JSON[_0x35cb59(0x1fb)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x35cb59(0x1fd)]=chatArea[_0x35cb59(0x265)];const _0x3141ad=await callBackend(_0x35cb59(0x201),{'message':_0x32ff0e});isTyping=![];const _0xc52467=document['getElementById'](_0x35cb59(0x23d));if(_0xc52467)_0xc52467[_0x35cb59(0x1fc)]();let _0x19ba76=_0x35cb59(0x214);if(_0x3141ad[_0x35cb59(0x267)]){_0x19ba76=_0x3141ad['text']||_0x35cb59(0x22a);if(tg?.[_0x35cb59(0x20c)])tg[_0x35cb59(0x20c)]['notificationOccurred'](_0x35cb59(0x267));}else{_0x19ba76=_0x3141ad['error']||_0x35cb59(0x22f);if(tg?.[_0x35cb59(0x20c)])tg[_0x35cb59(0x20c)]['notificationOccurred'](_0x35cb59(0x26a));}messages[_0x35cb59(0x21a)]({'role':'ai','content':_0x19ba76,'timestamp':Date['now']()}),localStorage[_0x35cb59(0x26b)](_0x35cb59(0x24e),JSON[_0x35cb59(0x1fb)](messages)),renderMessages();}function confirmDelete(_0x447901){const _0x6bea6e=a0_0x2cfb98;if(mTitle)mTitle[_0x6bea6e(0x243)]='Удалить?';if(mText)mText[_0x6bea6e(0x243)]='Действие\x20необратимо.';modalCallback=()=>{const _0x14e26b=_0x6bea6e;messages[_0x14e26b(0x237)](_0x447901,0x1),localStorage['setItem'](_0x14e26b(0x24e),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x6bea6e(0x247)](_0x6bea6e(0x26c));}if(clearBtn)clearBtn['onclick']=()=>{const _0x53e91b=a0_0x2cfb98;if(!messages['length'])return;if(mTitle)mTitle[_0x53e91b(0x243)]=_0x53e91b(0x216);if(mText)mText['textContent']=_0x53e91b(0x245);modalCallback=async()=>{const _0x13deca=_0x53e91b;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x13deca(0x24a),{});},modal[_0x53e91b(0x25d)]['add']('show');};document[a0_0x2cfb98(0x210)](a0_0x2cfb98(0x268))['onclick']=()=>modal[a0_0x2cfb98(0x25d)]['remove'](a0_0x2cfb98(0x26c)),document[a0_0x2cfb98(0x210)](a0_0x2cfb98(0x22e))[a0_0x2cfb98(0x23f)]=()=>{const _0x4eb60e=a0_0x2cfb98;if(modalCallback)modalCallback();modal[_0x4eb60e(0x25d)][_0x4eb60e(0x1fc)](_0x4eb60e(0x26c));},messageInput[a0_0x2cfb98(0x248)](a0_0x2cfb98(0x24b),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2cfb98(0x248)]('keydown',_0x24ed64=>{const _0x149805=a0_0x2cfb98;_0x24ed64[_0x149805(0x233)]===_0x149805(0x1fa)&&!_0x24ed64[_0x149805(0x263)]&&(_0x24ed64[_0x149805(0x227)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x2cfb98(0x248)]('click',_0x1e4f4c=>{const _0x16c640=a0_0x2cfb98;document[_0x16c640(0x254)](_0x16c640(0x221))['forEach'](_0x549a5e=>{const _0x55fe47=_0x16c640;if(!_0x549a5e['contains'](_0x1e4f4c[_0x55fe47(0x25c)]))_0x549a5e[_0x55fe47(0x25d)]['remove'](_0x55fe47(0x1f9));});});const saved=localStorage['getItem'](a0_0x2cfb98(0x24e));if(saved)try{messages=JSON[a0_0x2cfb98(0x242)](saved),renderMessages();}catch(a0_0xadbaa4){}updateSendButton();