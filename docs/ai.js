const a0_0x5607a3=a0_0x53db;(function(_0x12a2ae,_0x56da62){const _0x512db8=a0_0x53db,_0x93bc42=_0x12a2ae();while(!![]){try{const _0x49f8dd=-parseInt(_0x512db8(0x18c))/0x1+parseInt(_0x512db8(0x195))/0x2+-parseInt(_0x512db8(0x1ab))/0x3+parseInt(_0x512db8(0x187))/0x4*(-parseInt(_0x512db8(0x173))/0x5)+-parseInt(_0x512db8(0x1b8))/0x6+parseInt(_0x512db8(0x1b6))/0x7+-parseInt(_0x512db8(0x156))/0x8*(-parseInt(_0x512db8(0x19a))/0x9);if(_0x49f8dd===_0x56da62)break;else _0x93bc42['push'](_0x93bc42['shift']());}catch(_0x31f544){_0x93bc42['push'](_0x93bc42['shift']());}}}(a0_0x3672,0x77764));const tg=window[a0_0x5607a3(0x197)]?.[a0_0x5607a3(0x1a8)],HOME_URL=a0_0x5607a3(0x1b2);function setupTelegramBackButton(){const _0x51c020=a0_0x5607a3;if(!tg)return;try{tg[_0x51c020(0x1c4)](),tg['expand'](),tg['setHeaderColor']?.(_0x51c020(0x194));if(tg['isVersionAtLeast']?.('6.1'))tg[_0x51c020(0x17b)]?.();const _0x274896=tg[_0x51c020(0x14d)];if(_0x274896){_0x274896['show']();if(typeof _0x274896[_0x51c020(0x1b4)]===_0x51c020(0x15b))try{_0x274896[_0x51c020(0x1b4)]();}catch(_0x16e4f5){}_0x274896[_0x51c020(0x191)](()=>{const _0x27ff3f=_0x51c020;if(tg[_0x27ff3f(0x1aa)])tg[_0x27ff3f(0x1aa)]['impactOccurred'](_0x27ff3f(0x1b1));location[_0x27ff3f(0x19b)]=HOME_URL;});}}catch(_0x96420c){console[_0x51c020(0x15e)](_0x51c020(0x151),_0x96420c);}}(function initStableLayout(){const _0x1eb161=a0_0x5607a3,_0x4c9a83=(function(){let _0x27e335=!![];return function(_0x2d57e0,_0x5c70c6){const _0x1ef316=_0x27e335?function(){const _0x1b760e=a0_0x53db;if(_0x5c70c6){const _0x43706b=_0x5c70c6[_0x1b760e(0x165)](_0x2d57e0,arguments);return _0x5c70c6=null,_0x43706b;}}:function(){};return _0x27e335=![],_0x1ef316;};}()),_0x2b11c9=document[_0x1eb161(0x184)](_0x1eb161(0x1a2)),_0x531d75=document[_0x1eb161(0x182)]('inputArea'),_0x4c7315=document['getElementById'](_0x1eb161(0x19d)),_0xf1fc86=document['getElementById'](_0x1eb161(0x1a3));function _0x15d804(){const _0x43342a=_0x1eb161,_0x11a880=_0x4c9a83(this,function(){const _0x38d1c2=a0_0x53db;return _0x11a880['toString']()['search'](_0x38d1c2(0x149))[_0x38d1c2(0x176)]()['constructor'](_0x11a880)[_0x38d1c2(0x158)](_0x38d1c2(0x149));});_0x11a880();if(!_0x2b11c9)return;const _0x3f9363=tg&&tg['viewportHeight']?tg[_0x43342a(0x163)]:window[_0x43342a(0x192)];_0x2b11c9[_0x43342a(0x18b)][_0x43342a(0x147)]=_0x3f9363+'px';if(_0x531d75){const _0x2a580f=_0x531d75['offsetHeight'];_0x4c7315[_0x43342a(0x18b)][_0x43342a(0x1a9)]=_0x2a580f+0x28+'px';}}tg?tg['onEvent'](_0x1eb161(0x1bb),({isStateStable:_0x29da52})=>{_0x15d804();if(_0x29da52)requestAnimationFrame(()=>{const _0x2e86f2=a0_0x53db;_0x4c7315[_0x2e86f2(0x145)]=_0x4c7315[_0x2e86f2(0x171)];});}):window['addEventListener'](_0x1eb161(0x168),_0x15d804),_0x15d804(),_0xf1fc86&&(_0xf1fc86[_0x1eb161(0x1a5)](_0x1eb161(0x18e),()=>{requestAnimationFrame(_0x15d804);}),_0xf1fc86['addEventListener'](_0x1eb161(0x1c0),()=>{setTimeout(()=>{const _0x147355=a0_0x53db;_0x4c7315['scrollTop']=_0x4c7315[_0x147355(0x171)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5607a3(0x1ae),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5607a3(0x182)](a0_0x5607a3(0x19d)),emptyState=document[a0_0x5607a3(0x182)](a0_0x5607a3(0x1b7)),messageInput=document[a0_0x5607a3(0x182)](a0_0x5607a3(0x1a3)),sendBtn=document['getElementById'](a0_0x5607a3(0x174)),clearBtn=document[a0_0x5607a3(0x182)]('clearBtn'),modal=document[a0_0x5607a3(0x182)]('confirmModal'),mTitle=document[a0_0x5607a3(0x182)](a0_0x5607a3(0x15f)),mText=document[a0_0x5607a3(0x182)]('modalText');let modalCallback=null;async function callBackend(_0x28c708,_0x28aac1){const _0x494089=a0_0x5607a3,_0x23d7a5=tg?.[_0x494089(0x199)]?.[_0x494089(0x159)]||{},_0x34444b=_0x23d7a5['id']||localStorage[_0x494089(0x18d)](_0x494089(0x180))||'d-'+Math[_0x494089(0x183)](Math[_0x494089(0x172)]()*0x3b9aca00);if(!_0x23d7a5['id'])localStorage[_0x494089(0x1b5)](_0x494089(0x180),_0x34444b);const _0x2167ec={'action':_0x28c708,'user_id':_0x34444b,'user_data':{'first_name':_0x23d7a5[_0x494089(0x19e)],'username':_0x23d7a5[_0x494089(0x1ba)]},'init_data':tg?.[_0x494089(0x178)]||'',..._0x28aac1},_0x47177a=new AbortController(),_0x8d862b=setTimeout(()=>_0x47177a[_0x494089(0x152)](),REQUEST_TIMEOUT_MS);try{const _0x2d85e2=await fetch(BACKEND_URL,{'method':_0x494089(0x155),'headers':{'Content-Type':_0x494089(0x1bf)},'body':JSON['stringify'](_0x2167ec),'signal':_0x47177a[_0x494089(0x1c3)]});return clearTimeout(_0x8d862b),await _0x2d85e2['json']();}catch(_0x52bf0c){return{'success':![],'error':String(_0x52bf0c)};}}function a0_0x53db(_0x1c5a6f,_0x5dbe9d){_0x1c5a6f=_0x1c5a6f-0x145;const _0x130728=a0_0x3672();let _0x58bf7a=_0x130728[_0x1c5a6f];return _0x58bf7a;}function formatTime(_0x558db7){const _0x3afb3b=a0_0x5607a3,_0xc774b5=new Date(_0x558db7);return String(_0xc774b5[_0x3afb3b(0x18f)]())[_0x3afb3b(0x1ad)](0x2,'0')+':'+String(_0xc774b5[_0x3afb3b(0x1be)]())[_0x3afb3b(0x1ad)](0x2,'0');}function createMessageElement(_0x31116d,_0x3cae2f){const _0x495380=a0_0x5607a3,_0x42a3c0=document[_0x495380(0x14c)](_0x495380(0x1a4));_0x42a3c0[_0x495380(0x148)]='message\x20'+_0x31116d[_0x495380(0x19f)];const _0x4da05e=document[_0x495380(0x14c)]('div');_0x4da05e[_0x495380(0x148)]=_0x495380(0x170),_0x4da05e['innerHTML']=_0x31116d['content']['replace'](/\n/g,_0x495380(0x1a1));const _0xc375f1=document[_0x495380(0x14c)](_0x495380(0x1a4));_0xc375f1[_0x495380(0x148)]=_0x495380(0x153),_0xc375f1[_0x495380(0x1a6)]=_0x495380(0x179),_0xc375f1[_0x495380(0x157)]=_0x2e53e2=>{_0x2e53e2['stopPropagation'](),confirmDelete(_0x3cae2f);};let _0x3141d4;_0x4da05e['addEventListener'](_0x495380(0x19c),()=>_0x3141d4=setTimeout(()=>{const _0x2e0419=_0x495380;_0x42a3c0['classList'][_0x2e0419(0x162)](_0x2e0419(0x196));if(tg?.[_0x2e0419(0x1aa)])tg['HapticFeedback'][_0x2e0419(0x15c)]('medium');},0x1f4)),_0x4da05e['addEventListener'](_0x495380(0x175),()=>clearTimeout(_0x3141d4));const _0x52f8e7=document['createElement'](_0x495380(0x1a4));return _0x52f8e7[_0x495380(0x148)]=_0x495380(0x190),_0x52f8e7[_0x495380(0x186)]=formatTime(_0x31116d[_0x495380(0x17c)]),_0x42a3c0[_0x495380(0x17d)](_0xc375f1),_0x42a3c0['appendChild'](_0x4da05e),_0x42a3c0['appendChild'](_0x52f8e7),_0x42a3c0;}function createTypingIndicator(){const _0x2c32dc=a0_0x5607a3,_0x51b8f0=document[_0x2c32dc(0x14c)](_0x2c32dc(0x1a4));return _0x51b8f0[_0x2c32dc(0x148)]=_0x2c32dc(0x169),_0x51b8f0['id']=_0x2c32dc(0x1b9),_0x51b8f0[_0x2c32dc(0x1a6)]=_0x2c32dc(0x16c),_0x51b8f0;}function renderMessages(){const _0x44253a=a0_0x5607a3;Array[_0x44253a(0x1bd)](chatArea[_0x44253a(0x193)])['forEach'](_0x58fb0b=>{const _0x54562c=_0x44253a;if(_0x58fb0b['id']!=='emptyState')_0x58fb0b[_0x54562c(0x166)]();}),messages[_0x44253a(0x15a)]>0x0?(emptyState[_0x44253a(0x18b)]['display']=_0x44253a(0x1af),messages[_0x44253a(0x17f)]((_0x1bb701,_0x2f4c41)=>chatArea[_0x44253a(0x17d)](createMessageElement(_0x1bb701,_0x2f4c41)))):emptyState[_0x44253a(0x18b)][_0x44253a(0x1ac)]=_0x44253a(0x14a),requestAnimationFrame(()=>chatArea[_0x44253a(0x145)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x508b49=a0_0x5607a3;messageInput['style'][_0x508b49(0x147)]=_0x508b49(0x18a),messageInput[_0x508b49(0x18b)][_0x508b49(0x147)]=Math['min'](messageInput[_0x508b49(0x171)],0x78)+'px';}function updateSendButton(){const _0x44e932=a0_0x5607a3,_0x5c135d=messageInput['value']['trim']();sendBtn[_0x44e932(0x15d)]=!_0x5c135d||isTyping;}async function sendMessage(){const _0x9f2b73=a0_0x5607a3,_0x15cf40=messageInput[_0x9f2b73(0x1bc)][_0x9f2b73(0x177)]();if(!_0x15cf40||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x9f2b73(0x1aa)][_0x9f2b73(0x15c)](_0x9f2b73(0x1b1));messages[_0x9f2b73(0x1a7)]({'role':_0x9f2b73(0x159),'content':_0x15cf40,'timestamp':Date['now']()}),localStorage['setItem'](_0x9f2b73(0x154),JSON['stringify'](messages)),renderMessages(),messageInput[_0x9f2b73(0x1bc)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x9f2b73(0x145)]=chatArea[_0x9f2b73(0x171)];const _0x20f9b7=await callBackend(_0x9f2b73(0x1c2),{'message':_0x15cf40});isTyping=![];const _0x3af97d=document['getElementById']('typingIndicator');if(_0x3af97d)_0x3af97d[_0x9f2b73(0x166)]();let _0x255df1=_0x9f2b73(0x14b);if(_0x20f9b7[_0x9f2b73(0x181)]){_0x255df1=_0x20f9b7['text']||_0x9f2b73(0x16f);if(tg?.[_0x9f2b73(0x1aa)])tg[_0x9f2b73(0x1aa)][_0x9f2b73(0x164)](_0x9f2b73(0x181));}else{_0x255df1=_0x20f9b7[_0x9f2b73(0x1b0)]||_0x9f2b73(0x188);if(tg?.[_0x9f2b73(0x1aa)])tg[_0x9f2b73(0x1aa)][_0x9f2b73(0x164)]('error');}messages[_0x9f2b73(0x1a7)]({'role':'ai','content':_0x255df1,'timestamp':Date[_0x9f2b73(0x16e)]()}),localStorage[_0x9f2b73(0x1b5)](_0x9f2b73(0x154),JSON[_0x9f2b73(0x14e)](messages)),renderMessages();}function confirmDelete(_0x45c9ce){const _0x41653a=a0_0x5607a3;if(mTitle)mTitle[_0x41653a(0x186)]='Удалить?';if(mText)mText['textContent']=_0x41653a(0x14f);modalCallback=()=>{const _0x5a2c4f=_0x41653a;messages[_0x5a2c4f(0x150)](_0x45c9ce,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x5a2c4f(0x14e)](messages)),renderMessages();},modal[_0x41653a(0x1b3)][_0x41653a(0x162)](_0x41653a(0x16d));}if(clearBtn)clearBtn[a0_0x5607a3(0x157)]=()=>{const _0x564e41=a0_0x5607a3;if(!messages['length'])return;if(mTitle)mTitle[_0x564e41(0x186)]=_0x564e41(0x16a);if(mText)mText[_0x564e41(0x186)]=_0x564e41(0x17a);modalCallback=async()=>{const _0x217050=_0x564e41;messages=[],localStorage['removeItem'](_0x217050(0x154)),renderMessages(),callBackend(_0x217050(0x17e),{});},modal['classList'][_0x564e41(0x162)](_0x564e41(0x16d));};document[a0_0x5607a3(0x182)](a0_0x5607a3(0x167))[a0_0x5607a3(0x157)]=()=>modal[a0_0x5607a3(0x1b3)][a0_0x5607a3(0x166)](a0_0x5607a3(0x16d)),document[a0_0x5607a3(0x182)](a0_0x5607a3(0x160))[a0_0x5607a3(0x157)]=()=>{const _0x79bef8=a0_0x5607a3;if(modalCallback)modalCallback();modal[_0x79bef8(0x1b3)][_0x79bef8(0x166)](_0x79bef8(0x16d));},messageInput[a0_0x5607a3(0x1a5)](a0_0x5607a3(0x18e),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5607a3(0x1a5)](a0_0x5607a3(0x161),_0x89e91a=>{const _0x194f95=a0_0x5607a3;_0x89e91a['key']===_0x194f95(0x1a0)&&!_0x89e91a[_0x194f95(0x198)]&&(_0x89e91a[_0x194f95(0x185)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x5607a3(0x1a5)]('click',_0x52b167=>{const _0x616bc4=a0_0x5607a3;document[_0x616bc4(0x16b)](_0x616bc4(0x146))['forEach'](_0x36814b=>{const _0x3fe561=_0x616bc4;if(!_0x36814b[_0x3fe561(0x1c1)](_0x52b167['target']))_0x36814b['classList'][_0x3fe561(0x166)]('show-delete');});});const saved=localStorage[a0_0x5607a3(0x18d)](a0_0x5607a3(0x154));if(saved)try{messages=JSON[a0_0x5607a3(0x189)](saved),renderMessages();}catch(a0_0x3cdc43){}function a0_0x3672(){const _0x249844=['innerHTML','push','WebApp','paddingBottom','HapticFeedback','959934vOxrNX','display','padStart','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','none','error','light','./router.html','classList','offClick','setItem','2653840RCXkTn','emptyState','903108CujCgU','typingIndicator','username','viewportChanged','value','from','getMinutes','text/plain','focus','contains','send_message','signal','ready','scrollTop','.message.show-delete','height','className','(((.+)+)+)+$','flex','Ошибка\x20сети','createElement','BackButton','stringify','Действие\x20необратимо.','splice','TG\x20setup\x20error:','abort','delete-btn','ai_chat_messages','POST','40CJgRCE','onclick','search','user','length','function','impactOccurred','disabled','warn','modalTitle','modalConfirm','keydown','add','viewportHeight','notificationOccurred','apply','remove','modalCancel','resize','message\x20ai','Очистить\x20историю?','querySelectorAll','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','show','now','Пустой\x20ответ','message-bubble','scrollHeight','random','5IqVtqC','sendBtn','touchend','toString','trim','initData','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Начнется\x20новый\x20диалог.','disableVerticalSwipes','timestamp','appendChild','clear_history','forEach','debug_uid','success','getElementById','floor','querySelector','preventDefault','textContent','1187632MhuQVJ','Ошибка\x20сервера','parse','auto','style','124214TwNrNh','getItem','input','getHours','message-time','onClick','innerHeight','children','#050505','533718xkuOLj','show-delete','Telegram','shiftKey','initDataUnsafe','1322919ZYbGww','href','touchstart','chatArea','first_name','role','Enter','<br>','.container','messageInput','div','addEventListener'];a0_0x3672=function(){return _0x249844;};return a0_0x3672();}updateSendButton();