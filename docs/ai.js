const a0_0xb3e091=a0_0x4b70;(function(_0x1107c7,_0x43736e){const _0x1122c0=a0_0x4b70,_0x11d789=_0x1107c7();while(!![]){try{const _0x166b7c=-parseInt(_0x1122c0(0x123))/0x1*(-parseInt(_0x1122c0(0x134))/0x2)+parseInt(_0x1122c0(0xcd))/0x3*(-parseInt(_0x1122c0(0xc1))/0x4)+parseInt(_0x1122c0(0x105))/0x5+-parseInt(_0x1122c0(0x124))/0x6+-parseInt(_0x1122c0(0xd8))/0x7*(-parseInt(_0x1122c0(0x10d))/0x8)+parseInt(_0x1122c0(0xe5))/0x9+-parseInt(_0x1122c0(0xdc))/0xa;if(_0x166b7c===_0x43736e)break;else _0x11d789['push'](_0x11d789['shift']());}catch(_0x27f390){_0x11d789['push'](_0x11d789['shift']());}}}(a0_0x2afb,0x95c39));const tg=window[a0_0xb3e091(0x112)]?.[a0_0xb3e091(0xc5)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x4a5de9=a0_0xb3e091,_0x24f556=(function(){let _0x31db22=!![];return function(_0x24a198,_0x438b9f){const _0x2d9bff=_0x31db22?function(){const _0x23259a=a0_0x4b70;if(_0x438b9f){const _0x15e053=_0x438b9f[_0x23259a(0x114)](_0x24a198,arguments);return _0x438b9f=null,_0x15e053;}}:function(){};return _0x31db22=![],_0x2d9bff;};}()),_0x263aa2=_0x24f556(this,function(){const _0x5e1d18=a0_0x4b70;return _0x263aa2[_0x5e1d18(0x11f)]()[_0x5e1d18(0xf5)](_0x5e1d18(0xe9))[_0x5e1d18(0x11f)]()[_0x5e1d18(0x12d)](_0x263aa2)[_0x5e1d18(0xf5)](_0x5e1d18(0xe9));});_0x263aa2();if(!tg)return;try{tg[_0x4a5de9(0xd1)](),tg[_0x4a5de9(0xda)](),tg[_0x4a5de9(0xe7)]?.('#050505');if(tg[_0x4a5de9(0x10c)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x29e094=tg['BackButton'];if(_0x29e094){_0x29e094['show']();if(typeof _0x29e094[_0x4a5de9(0xc4)]===_0x4a5de9(0x10a))try{_0x29e094[_0x4a5de9(0xc4)]();}catch(_0x4ca9af){}_0x29e094['onClick'](()=>{const _0x1c8f7d=_0x4a5de9;if(tg[_0x1c8f7d(0x131)])tg[_0x1c8f7d(0x131)][_0x1c8f7d(0x107)]('light');location['href']=HOME_URL;});}}catch(_0x15d578){console[_0x4a5de9(0x133)](_0x4a5de9(0x119),_0x15d578);}}(function initStableLayout(){const _0x5a311d=a0_0xb3e091,_0x488e0e=document['querySelector'](_0x5a311d(0xcf)),_0x3d02d5=document[_0x5a311d(0xff)]('inputArea'),_0x1a3db1=document[_0x5a311d(0xff)]('chatArea'),_0x40235c=document[_0x5a311d(0xff)]('messageInput');function _0x49bbb9(){const _0x56427b=_0x5a311d;if(!_0x488e0e)return;const _0xb23dd2=tg&&tg[_0x56427b(0xd4)]?tg[_0x56427b(0xd4)]:window['innerHeight'];_0x488e0e[_0x56427b(0xdd)]['height']=_0xb23dd2+'px';if(_0x3d02d5){const _0x2348b0=_0x3d02d5[_0x56427b(0xfb)];_0x1a3db1[_0x56427b(0xdd)]['paddingBottom']=_0x2348b0+0x28+'px';}}tg?tg[_0x5a311d(0x106)]('viewportChanged',({isStateStable:_0x400db6})=>{_0x49bbb9();if(_0x400db6)requestAnimationFrame(()=>{const _0x2e0965=a0_0x4b70;_0x1a3db1[_0x2e0965(0xcb)]=_0x1a3db1[_0x2e0965(0x129)];});}):window[_0x5a311d(0xd0)](_0x5a311d(0x122),_0x49bbb9),_0x49bbb9(),_0x40235c&&(_0x40235c[_0x5a311d(0xd0)](_0x5a311d(0x115),()=>{requestAnimationFrame(_0x49bbb9);}),_0x40235c[_0x5a311d(0xd0)](_0x5a311d(0xde),()=>{setTimeout(()=>{const _0x1533dd=a0_0x4b70;_0x1a3db1[_0x1533dd(0xcb)]=_0x1a3db1[_0x1533dd(0x129)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0xb3e091(0x110)),emptyState=document[a0_0xb3e091(0xff)](a0_0xb3e091(0xc2)),messageInput=document['getElementById'](a0_0xb3e091(0x109)),sendBtn=document[a0_0xb3e091(0xff)]('sendBtn'),clearBtn=document[a0_0xb3e091(0xff)](a0_0xb3e091(0x12c)),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0xb3e091(0xff)](a0_0xb3e091(0xd9)),mText=document[a0_0xb3e091(0xff)](a0_0xb3e091(0x126));let modalCallback=null;async function callBackend(_0x465b32,_0x596927){const _0x4d60a1=a0_0xb3e091,_0x1a395d=tg?.['initDataUnsafe']?.['user']||{},_0x409efa=_0x1a395d['id']||localStorage[_0x4d60a1(0xe4)](_0x4d60a1(0x11b))||'d-'+Math[_0x4d60a1(0xbf)](Math[_0x4d60a1(0xf0)]()*0x3b9aca00);if(!_0x1a395d['id'])localStorage[_0x4d60a1(0xf9)](_0x4d60a1(0x11b),_0x409efa);const _0x4171f0={'action':_0x465b32,'user_id':_0x409efa,'user_data':{'first_name':_0x1a395d[_0x4d60a1(0xea)],'username':_0x1a395d[_0x4d60a1(0xf4)]},'init_data':tg?.[_0x4d60a1(0x11e)]||'',..._0x596927},_0x1dcbb3=new AbortController(),_0x5943d2=setTimeout(()=>_0x1dcbb3[_0x4d60a1(0xf8)](),REQUEST_TIMEOUT_MS);try{const _0x35df96=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x4d60a1(0xe2)},'body':JSON[_0x4d60a1(0x100)](_0x4171f0),'signal':_0x1dcbb3[_0x4d60a1(0x113)]});return clearTimeout(_0x5943d2),await _0x35df96[_0x4d60a1(0xfa)]();}catch(_0x19eb5f){return{'success':![],'error':String(_0x19eb5f)};}}function formatTime(_0x1696d5){const _0x2ffc26=a0_0xb3e091,_0x596e82=new Date(_0x1696d5);return String(_0x596e82[_0x2ffc26(0xee)]())['padStart'](0x2,'0')+':'+String(_0x596e82[_0x2ffc26(0x10e)]())[_0x2ffc26(0xf1)](0x2,'0');}function createMessageElement(_0x271dcd,_0x480410){const _0x5723f8=a0_0xb3e091,_0x19aa9b=document[_0x5723f8(0x135)](_0x5723f8(0xf2));_0x19aa9b['className']=_0x5723f8(0x127)+_0x271dcd[_0x5723f8(0xfd)];const _0x4e57b4=document[_0x5723f8(0x135)](_0x5723f8(0xf2));_0x4e57b4[_0x5723f8(0x108)]=_0x5723f8(0x11c),_0x4e57b4[_0x5723f8(0xc7)]=_0x271dcd[_0x5723f8(0x121)][_0x5723f8(0xfe)](/\n/g,_0x5723f8(0xe8));const _0x295aa4=document[_0x5723f8(0x135)](_0x5723f8(0xf2));_0x295aa4[_0x5723f8(0x108)]='delete-btn',_0x295aa4[_0x5723f8(0xc7)]=_0x5723f8(0xd3),_0x295aa4[_0x5723f8(0x11a)]=_0x305d24=>{_0x305d24['stopPropagation'](),confirmDelete(_0x480410);};let _0x2ca379;_0x4e57b4[_0x5723f8(0xd0)]('touchstart',()=>_0x2ca379=setTimeout(()=>{const _0x14b50a=_0x5723f8;_0x19aa9b[_0x14b50a(0x12f)]['add'](_0x14b50a(0x10b));if(tg?.[_0x14b50a(0x131)])tg[_0x14b50a(0x131)][_0x14b50a(0x107)]('medium');},0x1f4)),_0x4e57b4[_0x5723f8(0xd0)]('touchend',()=>clearTimeout(_0x2ca379));const _0x259144=document['createElement']('div');return _0x259144['className']=_0x5723f8(0x125),_0x259144[_0x5723f8(0xd7)]=formatTime(_0x271dcd[_0x5723f8(0x12a)]),_0x19aa9b[_0x5723f8(0xc9)](_0x295aa4),_0x19aa9b['appendChild'](_0x4e57b4),_0x19aa9b['appendChild'](_0x259144),_0x19aa9b;}function a0_0x2afb(){const _0x449d7e=['scrollTop','.message.show-delete','14253ApTprg','error','.container','addEventListener','ready','user','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','viewportHeight','value','message\x20ai','textContent','6299566zXOHSh','modalTitle','expand','light','22899280AHkzUQ','style','focus','typingIndicator','children','modalConfirm','text/plain','add','getItem','9414747EOnFCk','trim','setHeaderColor','<br>','(((.+)+)+)+$','first_name','clear_history','Enter','keydown','getHours','Действие\x20необратимо.','random','padStart','div','height','username','search','none','remove','abort','setItem','json','offsetHeight','Ошибка\x20сети','role','replace','getElementById','stringify','modalCancel','push','now','min','4814415kfiREa','onEvent','impactOccurred','className','messageInput','function','show-delete','isVersionAtLeast','8mBhTCo','getMinutes','parse','chatArea','disabled','Telegram','signal','apply','input','splice','send_message','show','TG\x20setup\x20error:','onclick','debug_uid','message-bubble','Очистить\x20историю?','initData','toString','notificationOccurred','content','resize','87903OwRcyo','333198oAkHbO','message-time','modalText','message\x20','Удалить?','scrollHeight','timestamp','contains','clearBtn','constructor','forEach','classList','length','HapticFeedback','ai_chat_messages','warn','22hrQrJZ','createElement','floor','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','772RefmyY','emptyState','text','offClick','WebApp','flex','innerHTML','display','appendChild','Ошибка\x20сервера'];a0_0x2afb=function(){return _0x449d7e;};return a0_0x2afb();}function createTypingIndicator(){const _0x49de58=a0_0xb3e091,_0x4c5efa=document[_0x49de58(0x135)]('div');return _0x4c5efa[_0x49de58(0x108)]=_0x49de58(0xd6),_0x4c5efa['id']=_0x49de58(0xdf),_0x4c5efa[_0x49de58(0xc7)]=_0x49de58(0xc0),_0x4c5efa;}function renderMessages(){const _0x1e20ec=a0_0xb3e091;Array['from'](chatArea[_0x1e20ec(0xe0)])[_0x1e20ec(0x12e)](_0xb95d40=>{const _0x326629=_0x1e20ec;if(_0xb95d40['id']!==_0x326629(0xc2))_0xb95d40[_0x326629(0xf7)]();}),messages['length']>0x0?(emptyState[_0x1e20ec(0xdd)][_0x1e20ec(0xc8)]=_0x1e20ec(0xf6),messages['forEach']((_0x2b1c10,_0x1ad48b)=>chatArea[_0x1e20ec(0xc9)](createMessageElement(_0x2b1c10,_0x1ad48b)))):emptyState['style'][_0x1e20ec(0xc8)]=_0x1e20ec(0xc6),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x1e20ec(0x129)]);}function a0_0x4b70(_0xd1c95b,_0x28e25d){_0xd1c95b=_0xd1c95b-0xbf;const _0x4b2a18=a0_0x2afb();let _0x4d5cd7=_0x4b2a18[_0xd1c95b];return _0x4d5cd7;}function autoResizeTextarea(){const _0x3660a3=a0_0xb3e091;messageInput[_0x3660a3(0xdd)]['height']='auto',messageInput['style'][_0x3660a3(0xf3)]=Math[_0x3660a3(0x104)](messageInput[_0x3660a3(0x129)],0x78)+'px';}function updateSendButton(){const _0x4f1b33=a0_0xb3e091,_0xb4867e=messageInput[_0x4f1b33(0xd5)][_0x4f1b33(0xe6)]();sendBtn[_0x4f1b33(0x111)]=!_0xb4867e||isTyping;}async function sendMessage(){const _0x4cf3a5=a0_0xb3e091,_0x37ea45=messageInput[_0x4cf3a5(0xd5)][_0x4cf3a5(0xe6)]();if(!_0x37ea45||isTyping)return;if(tg?.[_0x4cf3a5(0x131)])tg[_0x4cf3a5(0x131)]['impactOccurred'](_0x4cf3a5(0xdb));messages[_0x4cf3a5(0x102)]({'role':_0x4cf3a5(0xd2),'content':_0x37ea45,'timestamp':Date[_0x4cf3a5(0x103)]()}),localStorage[_0x4cf3a5(0xf9)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0x4cf3a5(0xd5)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4cf3a5(0xc9)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x4cf3a5(0x129)];const _0x1b7334=await callBackend(_0x4cf3a5(0x117),{'message':_0x37ea45});isTyping=![];const _0x547818=document[_0x4cf3a5(0xff)](_0x4cf3a5(0xdf));if(_0x547818)_0x547818[_0x4cf3a5(0xf7)]();let _0x3e2187=_0x4cf3a5(0xfc);if(_0x1b7334['success']){_0x3e2187=_0x1b7334[_0x4cf3a5(0xc3)]||'Пустой\x20ответ';if(tg?.[_0x4cf3a5(0x131)])tg[_0x4cf3a5(0x131)][_0x4cf3a5(0x120)]('success');}else{_0x3e2187=_0x1b7334[_0x4cf3a5(0xce)]||_0x4cf3a5(0xca);if(tg?.[_0x4cf3a5(0x131)])tg[_0x4cf3a5(0x131)][_0x4cf3a5(0x120)]('error');}messages['push']({'role':'ai','content':_0x3e2187,'timestamp':Date[_0x4cf3a5(0x103)]()}),localStorage[_0x4cf3a5(0xf9)](_0x4cf3a5(0x132),JSON[_0x4cf3a5(0x100)](messages)),renderMessages();}function confirmDelete(_0xebdce8){const _0x1f94ae=a0_0xb3e091;if(mTitle)mTitle['textContent']=_0x1f94ae(0x128);if(mText)mText[_0x1f94ae(0xd7)]=_0x1f94ae(0xef);modalCallback=()=>{const _0x5e47ef=_0x1f94ae;messages[_0x5e47ef(0x116)](_0xebdce8,0x1),localStorage['setItem'](_0x5e47ef(0x132),JSON[_0x5e47ef(0x100)](messages)),renderMessages();},modal['classList'][_0x1f94ae(0xe3)](_0x1f94ae(0x118));}if(clearBtn)clearBtn[a0_0xb3e091(0x11a)]=()=>{const _0x8b899d=a0_0xb3e091;if(!messages[_0x8b899d(0x130)])return;if(mTitle)mTitle[_0x8b899d(0xd7)]=_0x8b899d(0x11d);if(mText)mText[_0x8b899d(0xd7)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x32fd5a=_0x8b899d;messages=[],localStorage['removeItem'](_0x32fd5a(0x132)),renderMessages(),callBackend(_0x32fd5a(0xeb),{});},modal[_0x8b899d(0x12f)][_0x8b899d(0xe3)]('show');};document[a0_0xb3e091(0xff)](a0_0xb3e091(0x101))[a0_0xb3e091(0x11a)]=()=>modal[a0_0xb3e091(0x12f)]['remove']('show'),document[a0_0xb3e091(0xff)](a0_0xb3e091(0xe1))[a0_0xb3e091(0x11a)]=()=>{const _0x229e11=a0_0xb3e091;if(modalCallback)modalCallback();modal['classList'][_0x229e11(0xf7)](_0x229e11(0x118));},messageInput[a0_0xb3e091(0xd0)](a0_0xb3e091(0x115),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xb3e091(0xd0)](a0_0xb3e091(0xed),_0x7c5841=>{const _0x3ee8de=a0_0xb3e091;_0x7c5841['key']===_0x3ee8de(0xec)&&!_0x7c5841['shiftKey']&&(_0x7c5841['preventDefault'](),sendMessage());}),sendBtn[a0_0xb3e091(0x11a)]=sendMessage,document['addEventListener']('click',_0x20442a=>{const _0x50ecce=a0_0xb3e091;document['querySelectorAll'](_0x50ecce(0xcc))[_0x50ecce(0x12e)](_0xf560e=>{const _0x4552c4=_0x50ecce;if(!_0xf560e[_0x4552c4(0x12b)](_0x20442a['target']))_0xf560e[_0x4552c4(0x12f)][_0x4552c4(0xf7)]('show-delete');});});const saved=localStorage[a0_0xb3e091(0xe4)](a0_0xb3e091(0x132));if(saved)try{messages=JSON[a0_0xb3e091(0x10f)](saved),renderMessages();}catch(a0_0x29d918){}updateSendButton();