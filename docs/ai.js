const a0_0x314c6f=a0_0x179e;(function(_0x1eb69a,_0x2651aa){const _0x3e7cfc=a0_0x179e,_0xf353a7=_0x1eb69a();while(!![]){try{const _0x41a278=-parseInt(_0x3e7cfc(0x176))/0x1*(parseInt(_0x3e7cfc(0x1ae))/0x2)+parseInt(_0x3e7cfc(0x1a8))/0x3*(-parseInt(_0x3e7cfc(0x1a0))/0x4)+parseInt(_0x3e7cfc(0x198))/0x5+-parseInt(_0x3e7cfc(0x19f))/0x6*(-parseInt(_0x3e7cfc(0x192))/0x7)+-parseInt(_0x3e7cfc(0x18e))/0x8*(-parseInt(_0x3e7cfc(0x1a2))/0x9)+parseInt(_0x3e7cfc(0x14f))/0xa+-parseInt(_0x3e7cfc(0x1a4))/0xb*(parseInt(_0x3e7cfc(0x193))/0xc);if(_0x41a278===_0x2651aa)break;else _0xf353a7['push'](_0xf353a7['shift']());}catch(_0x424c26){_0xf353a7['push'](_0xf353a7['shift']());}}}(a0_0x3a4f,0xd3a5a));const tg=window[a0_0x314c6f(0x191)]?.[a0_0x314c6f(0x1ac)],HOME_URL=a0_0x314c6f(0x16c);function setupTelegramBackButton(){const _0x1809e2=a0_0x314c6f;if(!tg)return;try{tg[_0x1809e2(0x181)](),tg['expand'](),tg[_0x1809e2(0x161)]?.(_0x1809e2(0x160));if(tg[_0x1809e2(0x156)]?.('6.1'))tg[_0x1809e2(0x185)]?.();const _0x50c219=tg[_0x1809e2(0x13a)];if(_0x50c219){_0x50c219[_0x1809e2(0x173)]();if(typeof _0x50c219[_0x1809e2(0x145)]==='function')try{_0x50c219[_0x1809e2(0x145)]();}catch(_0x55784a){}_0x50c219[_0x1809e2(0x194)](()=>{const _0x2d0b1e=_0x1809e2;if(tg[_0x2d0b1e(0x186)])tg['HapticFeedback']['impactOccurred'](_0x2d0b1e(0x18a));location['href']=HOME_URL;});}}catch(_0x3ead55){console[_0x1809e2(0x17a)]('TG\x20setup\x20error:',_0x3ead55);}}(function initStableLayout(){const _0x5c64c3=a0_0x314c6f,_0x3eb116=(function(){let _0xecf8d6=!![];return function(_0x363fd0,_0x19d3d6){const _0x3906f4=_0xecf8d6?function(){const _0x310d45=a0_0x179e;if(_0x19d3d6){const _0x48fa3f=_0x19d3d6[_0x310d45(0x1b3)](_0x363fd0,arguments);return _0x19d3d6=null,_0x48fa3f;}}:function(){};return _0xecf8d6=![],_0x3906f4;};}()),_0x35132f=document[_0x5c64c3(0x163)](_0x5c64c3(0x1b1)),_0x58e682=document[_0x5c64c3(0x196)]('inputArea'),_0x36c290=document[_0x5c64c3(0x196)](_0x5c64c3(0x14c)),_0x670ff=document[_0x5c64c3(0x196)](_0x5c64c3(0x1a7));function _0x3d071e(){const _0x1d82f9=_0x5c64c3,_0x2809d2=_0x3eb116(this,function(){const _0x387374=a0_0x179e;return _0x2809d2[_0x387374(0x165)]()[_0x387374(0x1a6)](_0x387374(0x188))[_0x387374(0x165)]()[_0x387374(0x14e)](_0x2809d2)[_0x387374(0x1a6)](_0x387374(0x188));});_0x2809d2();if(!_0x35132f)return;const _0x23865d=tg&&tg[_0x1d82f9(0x1b6)]?tg['viewportHeight']:window[_0x1d82f9(0x1b8)];_0x35132f[_0x1d82f9(0x13e)][_0x1d82f9(0x187)]=_0x23865d+'px';if(_0x58e682){const _0xdd59ee=_0x58e682[_0x1d82f9(0x1b4)];_0x36c290['style'][_0x1d82f9(0x18f)]=_0xdd59ee+0x28+'px';}}tg?tg['onEvent'](_0x5c64c3(0x147),({isStateStable:_0xc2a393})=>{_0x3d071e();if(_0xc2a393)requestAnimationFrame(()=>{const _0x42bd08=a0_0x179e;_0x36c290[_0x42bd08(0x189)]=_0x36c290[_0x42bd08(0x155)];});}):window[_0x5c64c3(0x19a)](_0x5c64c3(0x19e),_0x3d071e),_0x3d071e(),_0x670ff&&(_0x670ff[_0x5c64c3(0x19a)](_0x5c64c3(0x13d),()=>{requestAnimationFrame(_0x3d071e);}),_0x670ff[_0x5c64c3(0x19a)](_0x5c64c3(0x162),()=>{setTimeout(()=>{const _0x419d58=a0_0x179e;_0x36c290['scrollTop']=_0x36c290[_0x419d58(0x155)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x179e(_0x243049,_0xcc5afc){_0x243049=_0x243049-0x138;const _0x2d1837=a0_0x3a4f();let _0x8803bf=_0x2d1837[_0x243049];return _0x8803bf;}const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x314c6f(0x196)]('chatArea'),emptyState=document[a0_0x314c6f(0x196)](a0_0x314c6f(0x182)),messageInput=document[a0_0x314c6f(0x196)]('messageInput'),sendBtn=document[a0_0x314c6f(0x196)]('sendBtn'),clearBtn=document['getElementById'](a0_0x314c6f(0x142)),modal=document[a0_0x314c6f(0x196)](a0_0x314c6f(0x171)),mTitle=document[a0_0x314c6f(0x196)](a0_0x314c6f(0x180)),mText=document[a0_0x314c6f(0x196)](a0_0x314c6f(0x1b5));let modalCallback=null;async function callBackend(_0x11d21c,_0x503e28){const _0x4be57f=a0_0x314c6f,_0xdc377b=tg?.[_0x4be57f(0x15a)]?.[_0x4be57f(0x19b)]||{},_0x2f5b42=_0xdc377b['id']||localStorage[_0x4be57f(0x17c)]('debug_uid')||'d-'+Math[_0x4be57f(0x1aa)](Math[_0x4be57f(0x1a9)]()*0x3b9aca00);if(!_0xdc377b['id'])localStorage['setItem'](_0x4be57f(0x199),_0x2f5b42);const _0x38d731={'action':_0x11d21c,'user_id':_0x2f5b42,'user_data':{'first_name':_0xdc377b['first_name'],'username':_0xdc377b[_0x4be57f(0x15b)]},'init_data':tg?.[_0x4be57f(0x19c)]||'',..._0x503e28},_0x5c19f7=new AbortController(),_0x4a0c65=setTimeout(()=>_0x5c19f7[_0x4be57f(0x18d)](),REQUEST_TIMEOUT_MS);try{const _0x15998f=await fetch(BACKEND_URL,{'method':_0x4be57f(0x166),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x4be57f(0x195)](_0x38d731),'signal':_0x5c19f7[_0x4be57f(0x172)]});return clearTimeout(_0x4a0c65),await _0x15998f[_0x4be57f(0x16d)]();}catch(_0x1cc3a4){return{'success':![],'error':String(_0x1cc3a4)};}}function formatTime(_0x1d5f5f){const _0x380708=a0_0x314c6f,_0x9abf13=new Date(_0x1d5f5f);return String(_0x9abf13[_0x380708(0x19d)]())[_0x380708(0x164)](0x2,'0')+':'+String(_0x9abf13[_0x380708(0x17e)]())[_0x380708(0x164)](0x2,'0');}function createMessageElement(_0x56f40b,_0x24c140){const _0x8db0e5=a0_0x314c6f,_0x4728ce=document['createElement']('div');_0x4728ce[_0x8db0e5(0x197)]=_0x8db0e5(0x15d)+_0x56f40b[_0x8db0e5(0x168)];const _0xaed9a1=document[_0x8db0e5(0x149)](_0x8db0e5(0x148));_0xaed9a1['className']=_0x8db0e5(0x1a1),_0xaed9a1[_0x8db0e5(0x138)]=_0x56f40b['content']['replace'](/\n/g,_0x8db0e5(0x143));const _0xccd96f=document[_0x8db0e5(0x149)]('div');_0xccd96f[_0x8db0e5(0x197)]='delete-btn',_0xccd96f[_0x8db0e5(0x138)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0xccd96f[_0x8db0e5(0x14a)]=_0x44e4da=>{_0x44e4da['stopPropagation'](),confirmDelete(_0x24c140);};let _0xea4da8;_0xaed9a1[_0x8db0e5(0x19a)]('touchstart',()=>_0xea4da8=setTimeout(()=>{const _0x4ef2fd=_0x8db0e5;_0x4728ce[_0x4ef2fd(0x177)][_0x4ef2fd(0x15f)](_0x4ef2fd(0x157));if(tg?.[_0x4ef2fd(0x186)])tg[_0x4ef2fd(0x186)][_0x4ef2fd(0x146)](_0x4ef2fd(0x151));},0x1f4)),_0xaed9a1['addEventListener']('touchend',()=>clearTimeout(_0xea4da8));const _0x401baa=document[_0x8db0e5(0x149)]('div');return _0x401baa[_0x8db0e5(0x197)]=_0x8db0e5(0x178),_0x401baa['textContent']=formatTime(_0x56f40b['timestamp']),_0x4728ce['appendChild'](_0xccd96f),_0x4728ce['appendChild'](_0xaed9a1),_0x4728ce[_0x8db0e5(0x1a5)](_0x401baa),_0x4728ce;}function createTypingIndicator(){const _0x22bb0f=a0_0x314c6f,_0xc83d29=document['createElement'](_0x22bb0f(0x148));return _0xc83d29['className']=_0x22bb0f(0x175),_0xc83d29['id']=_0x22bb0f(0x150),_0xc83d29['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0xc83d29;}function renderMessages(){const _0x4e26ba=a0_0x314c6f;Array['from'](chatArea['children'])['forEach'](_0x3a5d05=>{const _0x3e04f8=a0_0x179e;if(_0x3a5d05['id']!==_0x3e04f8(0x182))_0x3a5d05[_0x3e04f8(0x158)]();}),messages[_0x4e26ba(0x1ad)]>0x0?(emptyState[_0x4e26ba(0x13e)]['display']=_0x4e26ba(0x170),messages[_0x4e26ba(0x13c)]((_0x371bfb,_0x1b437c)=>chatArea['appendChild'](createMessageElement(_0x371bfb,_0x1b437c)))):emptyState['style'][_0x4e26ba(0x153)]='flex',requestAnimationFrame(()=>chatArea[_0x4e26ba(0x189)]=chatArea[_0x4e26ba(0x155)]);}function a0_0x3a4f(){const _0x31ca86=['height','(((.+)+)+)+$','scrollTop','light','shiftKey','keydown','abort','8UXJBag','paddingBottom','target','Telegram','133McTIsW','204gcZPJN','onClick','stringify','getElementById','className','3280755ARBWcM','debug_uid','addEventListener','user','initData','getHours','resize','519522gZTFZj','20QSZVKR','message-bubble','15452046NmvDda','.message.show-delete','655545tGEUpd','appendChild','search','messageInput','837423ThZBLd','random','floor','Действие\x20необратимо.','WebApp','length','2832022XIUZHr','textContent','modalCancel','.container','Пустой\x20ответ','apply','offsetHeight','modalText','viewportHeight','success','innerHeight','innerHTML','text','BackButton','Очистить\x20историю?','forEach','input','style','Начнется\x20новый\x20диалог.','querySelectorAll','min','clearBtn','<br>','disabled','offClick','impactOccurred','viewportChanged','div','createElement','onclick','key','chatArea','notificationOccurred','constructor','6735390JvYMlb','typingIndicator','medium','value','display','trim','scrollHeight','isVersionAtLeast','show-delete','remove','Enter','initDataUnsafe','username','send_message','message\x20','modalConfirm','add','#050505','setHeaderColor','focus','querySelector','padStart','toString','POST','Ошибка\x20сервера','role','push','preventDefault','setItem','./router.html','json','ai_chat_messages','Удалить?','none','confirmModal','signal','show','click','message\x20ai','1MmmkoR','classList','message-time','error','warn','Ошибка\x20сети','getItem','auto','getMinutes','clear_history','modalTitle','ready','emptyState','contains','now','disableVerticalSwipes','HapticFeedback'];a0_0x3a4f=function(){return _0x31ca86;};return a0_0x3a4f();}function autoResizeTextarea(){const _0x2dfea3=a0_0x314c6f;messageInput[_0x2dfea3(0x13e)][_0x2dfea3(0x187)]=_0x2dfea3(0x17d),messageInput[_0x2dfea3(0x13e)]['height']=Math[_0x2dfea3(0x141)](messageInput[_0x2dfea3(0x155)],0x78)+'px';}function updateSendButton(){const _0x25378c=a0_0x314c6f,_0x450934=messageInput[_0x25378c(0x152)][_0x25378c(0x154)]();sendBtn[_0x25378c(0x144)]=!_0x450934||isTyping;}async function sendMessage(){const _0x3bc283=a0_0x314c6f,_0x4ba89d=messageInput[_0x3bc283(0x152)][_0x3bc283(0x154)]();if(!_0x4ba89d||isTyping)return;if(tg?.[_0x3bc283(0x186)])tg['HapticFeedback'][_0x3bc283(0x146)](_0x3bc283(0x18a));messages[_0x3bc283(0x169)]({'role':'user','content':_0x4ba89d,'timestamp':Date['now']()}),localStorage[_0x3bc283(0x16b)](_0x3bc283(0x16e),JSON[_0x3bc283(0x195)](messages)),renderMessages(),messageInput[_0x3bc283(0x152)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x3bc283(0x1a5)](createTypingIndicator()),chatArea[_0x3bc283(0x189)]=chatArea[_0x3bc283(0x155)];const _0x316879=await callBackend(_0x3bc283(0x15c),{'message':_0x4ba89d});isTyping=![];const _0x35744a=document[_0x3bc283(0x196)](_0x3bc283(0x150));if(_0x35744a)_0x35744a['remove']();let _0x53496d=_0x3bc283(0x17b);if(_0x316879[_0x3bc283(0x1b7)]){_0x53496d=_0x316879[_0x3bc283(0x139)]||_0x3bc283(0x1b2);if(tg?.[_0x3bc283(0x186)])tg[_0x3bc283(0x186)][_0x3bc283(0x14d)](_0x3bc283(0x1b7));}else{_0x53496d=_0x316879[_0x3bc283(0x179)]||_0x3bc283(0x167);if(tg?.[_0x3bc283(0x186)])tg[_0x3bc283(0x186)][_0x3bc283(0x14d)](_0x3bc283(0x179));}messages[_0x3bc283(0x169)]({'role':'ai','content':_0x53496d,'timestamp':Date[_0x3bc283(0x184)]()}),localStorage[_0x3bc283(0x16b)](_0x3bc283(0x16e),JSON[_0x3bc283(0x195)](messages)),renderMessages();}function confirmDelete(_0x4a437d){const _0x4044c4=a0_0x314c6f;if(mTitle)mTitle['textContent']=_0x4044c4(0x16f);if(mText)mText[_0x4044c4(0x1af)]=_0x4044c4(0x1ab);modalCallback=()=>{const _0x4f8ce2=_0x4044c4;messages['splice'](_0x4a437d,0x1),localStorage['setItem'](_0x4f8ce2(0x16e),JSON[_0x4f8ce2(0x195)](messages)),renderMessages();},modal['classList'][_0x4044c4(0x15f)](_0x4044c4(0x173));}if(clearBtn)clearBtn[a0_0x314c6f(0x14a)]=()=>{const _0x7da940=a0_0x314c6f;if(!messages['length'])return;if(mTitle)mTitle[_0x7da940(0x1af)]=_0x7da940(0x13b);if(mText)mText[_0x7da940(0x1af)]=_0x7da940(0x13f);modalCallback=async()=>{const _0x35f5e6=_0x7da940;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x35f5e6(0x17f),{});},modal['classList'][_0x7da940(0x15f)](_0x7da940(0x173));};document[a0_0x314c6f(0x196)](a0_0x314c6f(0x1b0))[a0_0x314c6f(0x14a)]=()=>modal[a0_0x314c6f(0x177)][a0_0x314c6f(0x158)](a0_0x314c6f(0x173)),document['getElementById'](a0_0x314c6f(0x15e))['onclick']=()=>{const _0x195647=a0_0x314c6f;if(modalCallback)modalCallback();modal[_0x195647(0x177)][_0x195647(0x158)](_0x195647(0x173));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x314c6f(0x18c),_0x360251=>{const _0x575bbf=a0_0x314c6f;_0x360251[_0x575bbf(0x14b)]===_0x575bbf(0x159)&&!_0x360251[_0x575bbf(0x18b)]&&(_0x360251[_0x575bbf(0x16a)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x314c6f(0x174),_0x15dee5=>{const _0x1379d7=a0_0x314c6f;document[_0x1379d7(0x140)](_0x1379d7(0x1a3))[_0x1379d7(0x13c)](_0x427517=>{const _0x4f4e2a=_0x1379d7;if(!_0x427517[_0x4f4e2a(0x183)](_0x15dee5[_0x4f4e2a(0x190)]))_0x427517['classList'][_0x4f4e2a(0x158)]('show-delete');});});const saved=localStorage[a0_0x314c6f(0x17c)]('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x309afa){}updateSendButton();