function a0_0x8769(_0x58e9b6,_0x5e8519){_0x58e9b6=_0x58e9b6-0x19b;const _0x3ce211=a0_0x1ae7();let _0x2d34d3=_0x3ce211[_0x58e9b6];return _0x2d34d3;}const a0_0x214d4f=a0_0x8769;(function(_0x541e25,_0x188a75){const _0x4aff81=a0_0x8769,_0x1f96c7=_0x541e25();while(!![]){try{const _0x3a234f=-parseInt(_0x4aff81(0x1e7))/0x1+-parseInt(_0x4aff81(0x1dd))/0x2+parseInt(_0x4aff81(0x1af))/0x3+parseInt(_0x4aff81(0x1c8))/0x4*(-parseInt(_0x4aff81(0x1ac))/0x5)+-parseInt(_0x4aff81(0x1c9))/0x6+-parseInt(_0x4aff81(0x1ce))/0x7+-parseInt(_0x4aff81(0x216))/0x8*(-parseInt(_0x4aff81(0x1b2))/0x9);if(_0x3a234f===_0x188a75)break;else _0x1f96c7['push'](_0x1f96c7['shift']());}catch(_0x335259){_0x1f96c7['push'](_0x1f96c7['shift']());}}}(a0_0x1ae7,0x76e7e));const tg=window[a0_0x214d4f(0x1ca)]?.['WebApp'],HOME_URL=a0_0x214d4f(0x1d0);function setupTelegramBackButton(){const _0x44470b=a0_0x214d4f,_0x5764bb=(function(){let _0x1542e2=!![];return function(_0x1b37f6,_0x1152c6){const _0x98eb90=_0x1542e2?function(){const _0x9c66ac=a0_0x8769;if(_0x1152c6){const _0x5dbc65=_0x1152c6[_0x9c66ac(0x205)](_0x1b37f6,arguments);return _0x1152c6=null,_0x5dbc65;}}:function(){};return _0x1542e2=![],_0x98eb90;};}()),_0x4907b1=_0x5764bb(this,function(){const _0x56a1b8=a0_0x8769;return _0x4907b1['toString']()['search']('(((.+)+)+)+$')[_0x56a1b8(0x1fe)]()[_0x56a1b8(0x1aa)](_0x4907b1)[_0x56a1b8(0x1f1)](_0x56a1b8(0x1f0));});_0x4907b1();if(!tg)return;try{tg[_0x44470b(0x208)](),tg['expand'](),tg[_0x44470b(0x1ec)]?.('#050505');if(tg['isVersionAtLeast']?.(_0x44470b(0x1d4)))tg[_0x44470b(0x1c6)]?.();const _0x45c2b3=tg[_0x44470b(0x1c1)];if(_0x45c2b3){_0x45c2b3[_0x44470b(0x20c)]();if(typeof _0x45c2b3['offClick']==='function')try{_0x45c2b3['offClick']();}catch(_0x23a0d3){}_0x45c2b3[_0x44470b(0x1bc)](()=>{const _0x44d886=_0x44470b;if(tg[_0x44d886(0x1e0)])tg['HapticFeedback'][_0x44d886(0x1e2)](_0x44d886(0x1f9));location[_0x44d886(0x1b6)]=HOME_URL;});}}catch(_0x3749f9){console[_0x44470b(0x1a2)](_0x44470b(0x202),_0x3749f9);}}(function initStableLayout(){const _0x535e5d=a0_0x214d4f,_0x10587a=document[_0x535e5d(0x1f5)](_0x535e5d(0x1d5)),_0x5ed3e7=document['getElementById']('inputArea'),_0x26122a=document[_0x535e5d(0x1ed)]('chatArea'),_0x4c29d6=document['getElementById']('messageInput');function _0x563d69(){const _0x267ffb=_0x535e5d;if(!_0x10587a)return;const _0xac0879=tg&&tg[_0x267ffb(0x1f2)]?tg[_0x267ffb(0x1f2)]:window[_0x267ffb(0x213)];_0x10587a['style'][_0x267ffb(0x1d2)]=_0xac0879+'px';if(_0x5ed3e7){const _0x51f996=_0x5ed3e7[_0x267ffb(0x1cc)];_0x26122a['style'][_0x267ffb(0x1b8)]=_0x51f996+0x28+'px';}}tg?tg[_0x535e5d(0x1cd)](_0x535e5d(0x1df),({isStateStable:_0x9c71c0})=>{_0x563d69();if(_0x9c71c0)requestAnimationFrame(()=>{const _0x5697d3=a0_0x8769;_0x26122a[_0x5697d3(0x1fc)]=_0x26122a['scrollHeight'];});}):window[_0x535e5d(0x1ef)]('resize',_0x563d69),_0x563d69(),_0x4c29d6&&(_0x4c29d6[_0x535e5d(0x1ef)](_0x535e5d(0x1b0),()=>{requestAnimationFrame(_0x563d69);}),_0x4c29d6[_0x535e5d(0x1ef)](_0x535e5d(0x1ee),()=>{setTimeout(()=>{const _0x4c3eb=a0_0x8769;_0x26122a['scrollTop']=_0x26122a[_0x4c3eb(0x210)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x214d4f(0x1cf),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x214d4f(0x1ed)](a0_0x214d4f(0x1cb)),emptyState=document[a0_0x214d4f(0x1ed)](a0_0x214d4f(0x1ff)),messageInput=document['getElementById'](a0_0x214d4f(0x1ea)),sendBtn=document[a0_0x214d4f(0x1ed)]('sendBtn'),clearBtn=document[a0_0x214d4f(0x1ed)](a0_0x214d4f(0x204)),modal=document['getElementById'](a0_0x214d4f(0x20d)),mTitle=document[a0_0x214d4f(0x1ed)]('modalTitle'),mText=document[a0_0x214d4f(0x1ed)](a0_0x214d4f(0x1db));let modalCallback=null;async function callBackend(_0x500aae,_0x5ab587){const _0x17df3e=a0_0x214d4f,_0x1f4765=tg?.['initDataUnsafe']?.[_0x17df3e(0x1b5)]||{},_0x1817d7=_0x1f4765['id']||localStorage[_0x17df3e(0x1d6)](_0x17df3e(0x1da))||'d-'+Math[_0x17df3e(0x1d7)](Math[_0x17df3e(0x1ae)]()*0x3b9aca00);if(!_0x1f4765['id'])localStorage['setItem'](_0x17df3e(0x1da),_0x1817d7);const _0x18928b={'action':_0x500aae,'user_id':_0x1817d7,'user_data':{'first_name':_0x1f4765[_0x17df3e(0x1e1)],'username':_0x1f4765['username']},'init_data':tg?.[_0x17df3e(0x20f)]||'',..._0x5ab587},_0x23bb65=new AbortController(),_0x18ffc4=setTimeout(()=>_0x23bb65['abort'](),REQUEST_TIMEOUT_MS);try{const _0x189138=await fetch(BACKEND_URL,{'method':_0x17df3e(0x19e),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x17df3e(0x1b3)](_0x18928b),'signal':_0x23bb65['signal']});return clearTimeout(_0x18ffc4),await _0x189138['json']();}catch(_0x44224f){return{'success':![],'error':String(_0x44224f)};}}function formatTime(_0x258f5a){const _0x2cff51=a0_0x214d4f,_0x5d63f5=new Date(_0x258f5a);return String(_0x5d63f5[_0x2cff51(0x1ab)]())[_0x2cff51(0x1d8)](0x2,'0')+':'+String(_0x5d63f5[_0x2cff51(0x1eb)]())[_0x2cff51(0x1d8)](0x2,'0');}function createMessageElement(_0x89950b,_0x18211c){const _0x46dc6a=a0_0x214d4f,_0x1d2aa1=document[_0x46dc6a(0x1ba)](_0x46dc6a(0x1b9));_0x1d2aa1['className']=_0x46dc6a(0x19d)+_0x89950b[_0x46dc6a(0x1be)];const _0x1c7c99=document[_0x46dc6a(0x1ba)]('div');_0x1c7c99[_0x46dc6a(0x1f3)]=_0x46dc6a(0x1b1),_0x1c7c99['innerHTML']=_0x89950b[_0x46dc6a(0x1a7)][_0x46dc6a(0x20e)](/\n/g,_0x46dc6a(0x1a4));const _0x8dd96e=document[_0x46dc6a(0x1ba)](_0x46dc6a(0x1b9));_0x8dd96e[_0x46dc6a(0x1f3)]=_0x46dc6a(0x1c3),_0x8dd96e[_0x46dc6a(0x201)]=_0x46dc6a(0x1b7),_0x8dd96e[_0x46dc6a(0x214)]=_0x5612be=>{const _0xe9475c=_0x46dc6a;_0x5612be[_0xe9475c(0x1d9)](),confirmDelete(_0x18211c);};let _0x274efb;_0x1c7c99[_0x46dc6a(0x1ef)](_0x46dc6a(0x209),()=>_0x274efb=setTimeout(()=>{const _0x218ebd=_0x46dc6a;_0x1d2aa1['classList']['add']('show-delete');if(tg?.[_0x218ebd(0x1e0)])tg[_0x218ebd(0x1e0)]['impactOccurred'](_0x218ebd(0x1a1));},0x1f4)),_0x1c7c99['addEventListener']('touchend',()=>clearTimeout(_0x274efb));const _0x48b279=document[_0x46dc6a(0x1ba)](_0x46dc6a(0x1b9));return _0x48b279['className']='message-time',_0x48b279[_0x46dc6a(0x1e5)]=formatTime(_0x89950b[_0x46dc6a(0x1c4)]),_0x1d2aa1['appendChild'](_0x8dd96e),_0x1d2aa1['appendChild'](_0x1c7c99),_0x1d2aa1[_0x46dc6a(0x19b)](_0x48b279),_0x1d2aa1;}function createTypingIndicator(){const _0x3414a7=a0_0x214d4f,_0x1e0cac=document['createElement'](_0x3414a7(0x1b9));return _0x1e0cac[_0x3414a7(0x1f3)]=_0x3414a7(0x215),_0x1e0cac['id']=_0x3414a7(0x211),_0x1e0cac[_0x3414a7(0x201)]=_0x3414a7(0x1ad),_0x1e0cac;}function renderMessages(){const _0x130a06=a0_0x214d4f;Array['from'](chatArea[_0x130a06(0x206)])[_0x130a06(0x203)](_0x29169b=>{const _0x536a54=_0x130a06;if(_0x29169b['id']!==_0x536a54(0x1ff))_0x29169b[_0x536a54(0x20a)]();}),messages[_0x130a06(0x1c5)]>0x0?(emptyState[_0x130a06(0x1f8)][_0x130a06(0x1a9)]=_0x130a06(0x1d1),messages['forEach']((_0x4284a0,_0xbc7646)=>chatArea[_0x130a06(0x19b)](createMessageElement(_0x4284a0,_0xbc7646)))):emptyState[_0x130a06(0x1f8)][_0x130a06(0x1a9)]='flex',requestAnimationFrame(()=>chatArea[_0x130a06(0x1fc)]=chatArea[_0x130a06(0x210)]);}function autoResizeTextarea(){const _0x2c39c5=a0_0x214d4f;messageInput[_0x2c39c5(0x1f8)][_0x2c39c5(0x1d2)]='auto',messageInput[_0x2c39c5(0x1f8)][_0x2c39c5(0x1d2)]=Math[_0x2c39c5(0x1e4)](messageInput[_0x2c39c5(0x210)],0x78)+'px';}function updateSendButton(){const _0x5a66c2=a0_0x214d4f,_0x5e1ed2=messageInput[_0x5a66c2(0x1d3)][_0x5a66c2(0x212)]();sendBtn['disabled']=!_0x5e1ed2||isTyping;}async function sendMessage(){const _0x576479=a0_0x214d4f,_0x3da8a7=messageInput[_0x576479(0x1d3)][_0x576479(0x212)]();if(!_0x3da8a7||isTyping)return;if(tg?.[_0x576479(0x1e0)])tg['HapticFeedback'][_0x576479(0x1e2)](_0x576479(0x1f9));messages[_0x576479(0x1bf)]({'role':_0x576479(0x1b5),'content':_0x3da8a7,'timestamp':Date[_0x576479(0x1c7)]()}),localStorage[_0x576479(0x1de)](_0x576479(0x1a5),JSON[_0x576479(0x1b3)](messages)),renderMessages(),messageInput[_0x576479(0x1d3)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x576479(0x19b)](createTypingIndicator()),chatArea[_0x576479(0x1fc)]=chatArea[_0x576479(0x210)];const _0x283d30=await callBackend(_0x576479(0x1dc),{'message':_0x3da8a7});isTyping=![];const _0xa5fe6=document[_0x576479(0x1ed)](_0x576479(0x211));if(_0xa5fe6)_0xa5fe6[_0x576479(0x20a)]();let _0x2bf3dc='Ошибка\x20сети';if(_0x283d30[_0x576479(0x1fb)]){_0x2bf3dc=_0x283d30[_0x576479(0x1e3)]||_0x576479(0x1f6);if(tg?.[_0x576479(0x1e0)])tg['HapticFeedback']['notificationOccurred']('success');}else{_0x2bf3dc=_0x283d30['error']||_0x576479(0x1e6);if(tg?.[_0x576479(0x1e0)])tg[_0x576479(0x1e0)][_0x576479(0x1fd)](_0x576479(0x19c));}messages[_0x576479(0x1bf)]({'role':'ai','content':_0x2bf3dc,'timestamp':Date['now']()}),localStorage[_0x576479(0x1de)](_0x576479(0x1a5),JSON[_0x576479(0x1b3)](messages)),renderMessages();}function confirmDelete(_0x48f8a9){const _0x3b3b95=a0_0x214d4f;if(mTitle)mTitle[_0x3b3b95(0x1e5)]=_0x3b3b95(0x1a3);if(mText)mText[_0x3b3b95(0x1e5)]=_0x3b3b95(0x1b4);modalCallback=()=>{const _0x5a13a7=_0x3b3b95;messages[_0x5a13a7(0x1c0)](_0x48f8a9,0x1),localStorage[_0x5a13a7(0x1de)]('ai_chat_messages',JSON[_0x5a13a7(0x1b3)](messages)),renderMessages();},modal[_0x3b3b95(0x200)][_0x3b3b95(0x1a6)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0x1033e4=a0_0x214d4f;if(!messages[_0x1033e4(0x1c5)])return;if(mTitle)mTitle['textContent']=_0x1033e4(0x1fa);if(mText)mText[_0x1033e4(0x1e5)]=_0x1033e4(0x207);modalCallback=async()=>{const _0x28099d=_0x1033e4;messages=[],localStorage[_0x28099d(0x1f4)](_0x28099d(0x1a5)),renderMessages(),callBackend(_0x28099d(0x1a8),{});},modal[_0x1033e4(0x200)][_0x1033e4(0x1a6)](_0x1033e4(0x20c));};document[a0_0x214d4f(0x1ed)](a0_0x214d4f(0x1a0))[a0_0x214d4f(0x214)]=()=>modal['classList'][a0_0x214d4f(0x20a)](a0_0x214d4f(0x20c)),document['getElementById'](a0_0x214d4f(0x1bd))['onclick']=()=>{const _0x38b160=a0_0x214d4f;if(modalCallback)modalCallback();modal[_0x38b160(0x200)]['remove'](_0x38b160(0x20c));},messageInput['addEventListener'](a0_0x214d4f(0x1b0),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x214d4f(0x1ef)](a0_0x214d4f(0x1bb),_0x39cc60=>{const _0x46f34f=a0_0x214d4f;_0x39cc60['key']===_0x46f34f(0x1e9)&&!_0x39cc60[_0x46f34f(0x1e8)]&&(_0x39cc60[_0x46f34f(0x20b)](),sendMessage());}),sendBtn[a0_0x214d4f(0x214)]=sendMessage,document['addEventListener'](a0_0x214d4f(0x1c2),_0x18d3d0=>{const _0x3d78b6=a0_0x214d4f;document['querySelectorAll']('.message.show-delete')[_0x3d78b6(0x203)](_0x35c810=>{const _0x2502f6=_0x3d78b6;if(!_0x35c810['contains'](_0x18d3d0[_0x2502f6(0x19f)]))_0x35c810[_0x2502f6(0x200)]['remove'](_0x2502f6(0x1f7));});});const saved=localStorage[a0_0x214d4f(0x1d6)](a0_0x214d4f(0x1a5));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x1076ca){}updateSendButton();function a0_0x1ae7(){const _0x195a95=['6.1','.container','getItem','floor','padStart','stopPropagation','debug_uid','modalText','send_message','1492962aocDtz','setItem','viewportChanged','HapticFeedback','first_name','impactOccurred','text','min','textContent','Ошибка\x20сервера','856526TMJZDG','shiftKey','Enter','messageInput','getMinutes','setHeaderColor','getElementById','focus','addEventListener','(((.+)+)+)+$','search','viewportHeight','className','removeItem','querySelector','Пустой\x20ответ','show-delete','style','light','Очистить\x20историю?','success','scrollTop','notificationOccurred','toString','emptyState','classList','innerHTML','TG\x20setup\x20error:','forEach','clearBtn','apply','children','Начнется\x20новый\x20диалог.','ready','touchstart','remove','preventDefault','show','confirmModal','replace','initData','scrollHeight','typingIndicator','trim','innerHeight','onclick','message\x20ai','408WkVfuY','appendChild','error','message\x20','POST','target','modalCancel','medium','warn','Удалить?','<br>','ai_chat_messages','add','content','clear_history','display','constructor','getHours','272060tKxyMB','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','random','2699466qpXKFw','input','message-bubble','372492VzOmcQ','stringify','Действие\x20необратимо.','user','href','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','paddingBottom','div','createElement','keydown','onClick','modalConfirm','role','push','splice','BackButton','click','delete-btn','timestamp','length','disableVerticalSwipes','now','12cxCrrk','2094726hTPuMz','Telegram','chatArea','offsetHeight','onEvent','2857456mdnCVj','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','./router.html','none','height','value'];a0_0x1ae7=function(){return _0x195a95;};return a0_0x1ae7();}