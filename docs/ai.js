const a0_0x567a35=a0_0x4617;(function(_0x859887,_0xf68811){const _0x5372bc=a0_0x4617,_0x4fcb1d=_0x859887();while(!![]){try{const _0x13ca80=-parseInt(_0x5372bc(0x212))/0x1+-parseInt(_0x5372bc(0x1e9))/0x2+parseInt(_0x5372bc(0x1d7))/0x3*(-parseInt(_0x5372bc(0x205))/0x4)+-parseInt(_0x5372bc(0x21e))/0x5*(-parseInt(_0x5372bc(0x223))/0x6)+parseInt(_0x5372bc(0x1cf))/0x7+-parseInt(_0x5372bc(0x1ec))/0x8+parseInt(_0x5372bc(0x1d9))/0x9*(parseInt(_0x5372bc(0x20a))/0xa);if(_0x13ca80===_0xf68811)break;else _0x4fcb1d['push'](_0x4fcb1d['shift']());}catch(_0x565baa){_0x4fcb1d['push'](_0x4fcb1d['shift']());}}}(a0_0x2640,0x66f1f));const tg=window[a0_0x567a35(0x1f7)]?.[a0_0x567a35(0x1e0)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x59f221=a0_0x567a35;if(!tg)return;try{tg[_0x59f221(0x213)](),tg[_0x59f221(0x1d3)](),tg['setHeaderColor']?.(_0x59f221(0x1f4));if(tg[_0x59f221(0x1d8)]?.(_0x59f221(0x1ea)))tg[_0x59f221(0x1b1)]?.();const _0x4eb72b=tg['BackButton'];if(_0x4eb72b){_0x4eb72b[_0x59f221(0x20d)]();if(typeof _0x4eb72b[_0x59f221(0x1c9)]==='function')try{_0x4eb72b['offClick']();}catch(_0x42647c){}_0x4eb72b[_0x59f221(0x20b)](()=>{const _0xb1cdea=_0x59f221;if(tg['HapticFeedback'])tg[_0xb1cdea(0x1c5)][_0xb1cdea(0x1df)]('light');location['href']=HOME_URL;});}}catch(_0x3c0997){console[_0x59f221(0x1c8)](_0x59f221(0x1da),_0x3c0997);}}(function initStableLayout(){const _0x176a13=a0_0x567a35,_0x1bc1b6=(function(){let _0xc4fb7d=!![];return function(_0x1c69bf,_0x3eec92){const _0x54b3be=_0xc4fb7d?function(){const _0x5a0af1=a0_0x4617;if(_0x3eec92){const _0x497dfb=_0x3eec92[_0x5a0af1(0x1d5)](_0x1c69bf,arguments);return _0x3eec92=null,_0x497dfb;}}:function(){};return _0xc4fb7d=![],_0x54b3be;};}()),_0x42ca4f=document[_0x176a13(0x215)](_0x176a13(0x1bf)),_0x195195=document[_0x176a13(0x217)](_0x176a13(0x1e8)),_0x349ded=document[_0x176a13(0x217)](_0x176a13(0x208)),_0x15a349=document['getElementById'](_0x176a13(0x22b));function _0x576ccc(){const _0x28b04d=_0x176a13,_0x5db097=_0x1bc1b6(this,function(){const _0x11e173=a0_0x4617;return _0x5db097['toString']()['search'](_0x11e173(0x20c))['toString']()[_0x11e173(0x1f6)](_0x5db097)['search']('(((.+)+)+)+$');});_0x5db097();if(!_0x42ca4f)return;const _0x548a7f=tg&&tg['viewportHeight']?tg[_0x28b04d(0x20f)]:window[_0x28b04d(0x20e)];_0x42ca4f[_0x28b04d(0x1b6)]['height']=_0x548a7f+'px';if(_0x195195){const _0x218aa8=_0x195195['offsetHeight'];_0x349ded[_0x28b04d(0x1b6)]['paddingBottom']=_0x218aa8+0x28+'px';}}tg?tg[_0x176a13(0x1b7)](_0x176a13(0x1bc),({isStateStable:_0x5f2e8d})=>{_0x576ccc();if(_0x5f2e8d)requestAnimationFrame(()=>{const _0x15c4d1=a0_0x4617;_0x349ded['scrollTop']=_0x349ded[_0x15c4d1(0x229)];});}):window['addEventListener']('resize',_0x576ccc),_0x576ccc(),_0x15a349&&(_0x15a349[_0x176a13(0x210)](_0x176a13(0x22a),()=>{requestAnimationFrame(_0x576ccc);}),_0x15a349[_0x176a13(0x210)](_0x176a13(0x21b),()=>{setTimeout(()=>{const _0x5cc0ed=a0_0x4617;_0x349ded[_0x5cc0ed(0x1ff)]=_0x349ded[_0x5cc0ed(0x229)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x2640(){const _0xdb1895=['children','display','HapticFeedback','stopPropagation','sendBtn','warn','offClick','padStart','Enter','user','Очистить\x20историю?','querySelectorAll','4594205Atyqyf','createElement','ai_chat_messages','setItem','expand','text/plain','apply','send_message','1025301OucNQF','isVersionAtLeast','1670157KEeMgg','TG\x20setup\x20error:','trim','show-delete','random','appendChild','impactOccurred','WebApp','content','typingIndicator','length','keydown','innerHTML','notificationOccurred','shiftKey','inputArea','1138026fauzNU','6.1','div','4145504RXETqC','message-bubble','Удалить?','clear_history','role','username','timestamp','initData','#050505','first_name','constructor','Telegram','initDataUnsafe','modalText','getItem','Действие\x20необратимо.','click','floor','modalCancel','scrollTop','push','signal','stringify','delete-btn','touchstart','4zyvzvi','parse','emptyState','chatArea','contains','80fVgqdI','onClick','(((.+)+)+)+$','show','innerHeight','viewportHeight','addEventListener','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','471868zEZMan','ready','add','querySelector','preventDefault','getElementById','remove','textContent','className','focus','none','.message.show-delete','9080jcdwJc','error','from','forEach','Пустой\x20ответ','600kVrkfG','splice','replace','touchend','abort','classList','scrollHeight','input','messageInput','disableVerticalSwipes','modalTitle','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','debug_uid','value','style','onEvent','message-time','now','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','json','viewportChanged','<br>','confirmModal','.container','success','removeItem','onclick'];a0_0x2640=function(){return _0xdb1895;};return a0_0x2640();}const BACKEND_URL=a0_0x567a35(0x1b3),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x4617(_0x1baa6e,_0x49e682){_0x1baa6e=_0x1baa6e-0x1b1;const _0x149653=a0_0x2640();let _0x307793=_0x149653[_0x1baa6e];return _0x307793;}let messages=[],isTyping=![];const chatArea=document[a0_0x567a35(0x217)](a0_0x567a35(0x208)),emptyState=document[a0_0x567a35(0x217)]('emptyState'),messageInput=document[a0_0x567a35(0x217)](a0_0x567a35(0x22b)),sendBtn=document['getElementById'](a0_0x567a35(0x1c7)),clearBtn=document[a0_0x567a35(0x217)]('clearBtn'),modal=document[a0_0x567a35(0x217)](a0_0x567a35(0x1be)),mTitle=document[a0_0x567a35(0x217)](a0_0x567a35(0x1b2)),mText=document['getElementById'](a0_0x567a35(0x1f9));let modalCallback=null;async function callBackend(_0x507b50,_0x3074df){const _0x246fbd=a0_0x567a35,_0x5635a9=tg?.[_0x246fbd(0x1f8)]?.['user']||{},_0x391b76=_0x5635a9['id']||localStorage[_0x246fbd(0x1fa)]('debug_uid')||'d-'+Math[_0x246fbd(0x1fd)](Math[_0x246fbd(0x1dd)]()*0x3b9aca00);if(!_0x5635a9['id'])localStorage[_0x246fbd(0x1d2)](_0x246fbd(0x1b4),_0x391b76);const _0x20a15c={'action':_0x507b50,'user_id':_0x391b76,'user_data':{'first_name':_0x5635a9[_0x246fbd(0x1f5)],'username':_0x5635a9[_0x246fbd(0x1f1)]},'init_data':tg?.[_0x246fbd(0x1f3)]||'',..._0x3074df},_0x1813d9=new AbortController(),_0x2c5395=setTimeout(()=>_0x1813d9[_0x246fbd(0x227)](),REQUEST_TIMEOUT_MS);try{const _0xe789d6=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x246fbd(0x1d4)},'body':JSON[_0x246fbd(0x202)](_0x20a15c),'signal':_0x1813d9[_0x246fbd(0x201)]});return clearTimeout(_0x2c5395),await _0xe789d6[_0x246fbd(0x1bb)]();}catch(_0x2d06ba){return{'success':![],'error':String(_0x2d06ba)};}}function formatTime(_0x5c548b){const _0x43fc50=a0_0x567a35,_0x4acc15=new Date(_0x5c548b);return String(_0x4acc15['getHours']())['padStart'](0x2,'0')+':'+String(_0x4acc15['getMinutes']())[_0x43fc50(0x1ca)](0x2,'0');}function createMessageElement(_0x454d20,_0x15a832){const _0x2a048f=a0_0x567a35,_0x440f7f=document[_0x2a048f(0x1d0)](_0x2a048f(0x1eb));_0x440f7f[_0x2a048f(0x21a)]='message\x20'+_0x454d20[_0x2a048f(0x1f0)];const _0x4ab1c5=document[_0x2a048f(0x1d0)](_0x2a048f(0x1eb));_0x4ab1c5[_0x2a048f(0x21a)]=_0x2a048f(0x1ed),_0x4ab1c5[_0x2a048f(0x1e5)]=_0x454d20[_0x2a048f(0x1e1)][_0x2a048f(0x225)](/\n/g,_0x2a048f(0x1bd));const _0x4735f5=document['createElement'](_0x2a048f(0x1eb));_0x4735f5[_0x2a048f(0x21a)]=_0x2a048f(0x203),_0x4735f5['innerHTML']=_0x2a048f(0x211),_0x4735f5['onclick']=_0x1eecf5=>{const _0x4a9524=_0x2a048f;_0x1eecf5[_0x4a9524(0x1c6)](),confirmDelete(_0x15a832);};let _0x352577;_0x4ab1c5[_0x2a048f(0x210)](_0x2a048f(0x204),()=>_0x352577=setTimeout(()=>{const _0x7c3325=_0x2a048f;_0x440f7f[_0x7c3325(0x228)][_0x7c3325(0x214)](_0x7c3325(0x1dc));if(tg?.[_0x7c3325(0x1c5)])tg[_0x7c3325(0x1c5)][_0x7c3325(0x1df)]('medium');},0x1f4)),_0x4ab1c5[_0x2a048f(0x210)](_0x2a048f(0x226),()=>clearTimeout(_0x352577));const _0x1e3281=document['createElement']('div');return _0x1e3281['className']=_0x2a048f(0x1b8),_0x1e3281[_0x2a048f(0x219)]=formatTime(_0x454d20[_0x2a048f(0x1f2)]),_0x440f7f[_0x2a048f(0x1de)](_0x4735f5),_0x440f7f[_0x2a048f(0x1de)](_0x4ab1c5),_0x440f7f[_0x2a048f(0x1de)](_0x1e3281),_0x440f7f;}function createTypingIndicator(){const _0x25cb78=a0_0x567a35,_0x1701b2=document[_0x25cb78(0x1d0)]('div');return _0x1701b2[_0x25cb78(0x21a)]='message\x20ai',_0x1701b2['id']=_0x25cb78(0x1e2),_0x1701b2[_0x25cb78(0x1e5)]=_0x25cb78(0x1ba),_0x1701b2;}function renderMessages(){const _0x15c6de=a0_0x567a35;Array[_0x15c6de(0x220)](chatArea[_0x15c6de(0x1c3)])[_0x15c6de(0x221)](_0x30c334=>{const _0x131496=_0x15c6de;if(_0x30c334['id']!==_0x131496(0x207))_0x30c334[_0x131496(0x218)]();}),messages['length']>0x0?(emptyState['style']['display']=_0x15c6de(0x21c),messages[_0x15c6de(0x221)]((_0x2f1823,_0x1c9329)=>chatArea[_0x15c6de(0x1de)](createMessageElement(_0x2f1823,_0x1c9329)))):emptyState[_0x15c6de(0x1b6)][_0x15c6de(0x1c4)]='flex',requestAnimationFrame(()=>chatArea[_0x15c6de(0x1ff)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x19cb10=a0_0x567a35;messageInput[_0x19cb10(0x1b6)]['height']='auto',messageInput[_0x19cb10(0x1b6)]['height']=Math['min'](messageInput[_0x19cb10(0x229)],0x78)+'px';}function updateSendButton(){const _0x4194e1=a0_0x567a35,_0x16b207=messageInput[_0x4194e1(0x1b5)][_0x4194e1(0x1db)]();sendBtn['disabled']=!_0x16b207||isTyping;}async function sendMessage(){const _0x2fc507=a0_0x567a35,_0x53aeb4=messageInput[_0x2fc507(0x1b5)][_0x2fc507(0x1db)]();if(!_0x53aeb4||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2fc507(0x1c5)][_0x2fc507(0x1df)]('light');messages[_0x2fc507(0x200)]({'role':_0x2fc507(0x1cc),'content':_0x53aeb4,'timestamp':Date[_0x2fc507(0x1b9)]()}),localStorage[_0x2fc507(0x1d2)](_0x2fc507(0x1d1),JSON[_0x2fc507(0x202)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x2fc507(0x1ff)]=chatArea[_0x2fc507(0x229)];const _0x489089=await callBackend(_0x2fc507(0x1d6),{'message':_0x53aeb4});isTyping=![];const _0x4a1ac7=document[_0x2fc507(0x217)]('typingIndicator');if(_0x4a1ac7)_0x4a1ac7['remove']();let _0x17a757='Ошибка\x20сети';if(_0x489089[_0x2fc507(0x1c0)]){_0x17a757=_0x489089['text']||_0x2fc507(0x222);if(tg?.[_0x2fc507(0x1c5)])tg['HapticFeedback']['notificationOccurred'](_0x2fc507(0x1c0));}else{_0x17a757=_0x489089[_0x2fc507(0x21f)]||'Ошибка\x20сервера';if(tg?.[_0x2fc507(0x1c5)])tg[_0x2fc507(0x1c5)][_0x2fc507(0x1e6)](_0x2fc507(0x21f));}messages[_0x2fc507(0x200)]({'role':'ai','content':_0x17a757,'timestamp':Date[_0x2fc507(0x1b9)]()}),localStorage[_0x2fc507(0x1d2)](_0x2fc507(0x1d1),JSON[_0x2fc507(0x202)](messages)),renderMessages();}function confirmDelete(_0x44162e){const _0x296e60=a0_0x567a35;if(mTitle)mTitle[_0x296e60(0x219)]=_0x296e60(0x1ee);if(mText)mText['textContent']=_0x296e60(0x1fb);modalCallback=()=>{const _0x42e679=_0x296e60;messages[_0x42e679(0x224)](_0x44162e,0x1),localStorage[_0x42e679(0x1d2)](_0x42e679(0x1d1),JSON[_0x42e679(0x202)](messages)),renderMessages();},modal[_0x296e60(0x228)][_0x296e60(0x214)](_0x296e60(0x20d));}if(clearBtn)clearBtn['onclick']=()=>{const _0x10148c=a0_0x567a35;if(!messages[_0x10148c(0x1e3)])return;if(mTitle)mTitle[_0x10148c(0x219)]=_0x10148c(0x1cd);if(mText)mText[_0x10148c(0x219)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x1bad56=_0x10148c;messages=[],localStorage[_0x1bad56(0x1c1)](_0x1bad56(0x1d1)),renderMessages(),callBackend(_0x1bad56(0x1ef),{});},modal[_0x10148c(0x228)]['add'](_0x10148c(0x20d));};document[a0_0x567a35(0x217)](a0_0x567a35(0x1fe))[a0_0x567a35(0x1c2)]=()=>modal[a0_0x567a35(0x228)]['remove']('show'),document[a0_0x567a35(0x217)]('modalConfirm')[a0_0x567a35(0x1c2)]=()=>{const _0x59efbf=a0_0x567a35;if(modalCallback)modalCallback();modal[_0x59efbf(0x228)][_0x59efbf(0x218)](_0x59efbf(0x20d));},messageInput[a0_0x567a35(0x210)](a0_0x567a35(0x22a),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x567a35(0x210)](a0_0x567a35(0x1e4),_0x450594=>{const _0x3025c2=a0_0x567a35;_0x450594['key']===_0x3025c2(0x1cb)&&!_0x450594[_0x3025c2(0x1e7)]&&(_0x450594[_0x3025c2(0x216)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x567a35(0x210)](a0_0x567a35(0x1fc),_0x49d013=>{const _0x342014=a0_0x567a35;document[_0x342014(0x1ce)](_0x342014(0x21d))[_0x342014(0x221)](_0x20f071=>{const _0x1506da=_0x342014;if(!_0x20f071[_0x1506da(0x209)](_0x49d013['target']))_0x20f071[_0x1506da(0x228)][_0x1506da(0x218)](_0x1506da(0x1dc));});});const saved=localStorage[a0_0x567a35(0x1fa)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x567a35(0x206)](saved),renderMessages();}catch(a0_0x44a0a5){}updateSendButton();