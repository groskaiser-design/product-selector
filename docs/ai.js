const a0_0x5672b7=a0_0x512c;(function(_0x1b9be6,_0x2bf15d){const _0x4ed939=a0_0x512c,_0x1be7a1=_0x1b9be6();while(!![]){try{const _0xe42e30=-parseInt(_0x4ed939(0x153))/0x1*(parseInt(_0x4ed939(0x111))/0x2)+parseInt(_0x4ed939(0x156))/0x3*(-parseInt(_0x4ed939(0x12a))/0x4)+parseInt(_0x4ed939(0x169))/0x5*(parseInt(_0x4ed939(0x133))/0x6)+-parseInt(_0x4ed939(0x15c))/0x7+-parseInt(_0x4ed939(0x15f))/0x8*(-parseInt(_0x4ed939(0x102))/0x9)+-parseInt(_0x4ed939(0xf2))/0xa+parseInt(_0x4ed939(0x10b))/0xb;if(_0xe42e30===_0x2bf15d)break;else _0x1be7a1['push'](_0x1be7a1['shift']());}catch(_0x1a2b83){_0x1be7a1['push'](_0x1be7a1['shift']());}}}(a0_0x36f2,0x5bc63));const tg=window[a0_0x5672b7(0x15e)]?.['WebApp'],HOME_URL=a0_0x5672b7(0x13f);function setupTelegramBackButton(){const _0x530dd9=a0_0x5672b7;if(!tg)return;try{tg['ready'](),tg[_0x530dd9(0x15a)](),tg[_0x530dd9(0x114)]?.('#050505');if(tg[_0x530dd9(0x122)]?.(_0x530dd9(0x11d)))tg['disableVerticalSwipes']?.();const _0x45c203=tg[_0x530dd9(0x100)];if(_0x45c203){_0x45c203['show']();if(typeof _0x45c203[_0x530dd9(0xff)]==='function')try{_0x45c203[_0x530dd9(0xff)]();}catch(_0x2d6f14){}_0x45c203[_0x530dd9(0x11b)](()=>{const _0x442217=_0x530dd9;if(tg['HapticFeedback'])tg[_0x442217(0xfa)][_0x442217(0x126)](_0x442217(0x105));location[_0x442217(0x15d)]=HOME_URL;});}}catch(_0x49467c){console[_0x530dd9(0x146)](_0x530dd9(0x14e),_0x49467c);}}(function initStableLayout(){const _0x44a390=a0_0x5672b7,_0x3781d3=(function(){let _0x56fbb1=!![];return function(_0x4cefaa,_0x5768d3){const _0x2f548c=_0x56fbb1?function(){if(_0x5768d3){const _0x39f972=_0x5768d3['apply'](_0x4cefaa,arguments);return _0x5768d3=null,_0x39f972;}}:function(){};return _0x56fbb1=![],_0x2f548c;};}()),_0x3e093c=document[_0x44a390(0x151)]('.container'),_0x141659=document[_0x44a390(0xf4)](_0x44a390(0x119)),_0x20c93d=document['getElementById']('chatArea'),_0x507bee=document[_0x44a390(0xf4)](_0x44a390(0x13b));function _0x252fc5(){const _0x13a9e4=_0x44a390,_0x1b8f23=_0x3781d3(this,function(){const _0x42a74e=a0_0x512c;return _0x1b8f23['toString']()[_0x42a74e(0x101)](_0x42a74e(0x11f))[_0x42a74e(0xf8)]()['constructor'](_0x1b8f23)[_0x42a74e(0x101)](_0x42a74e(0x11f));});_0x1b8f23();if(!_0x3e093c)return;const _0x2f4fd0=tg&&tg[_0x13a9e4(0x128)]?tg[_0x13a9e4(0x128)]:window['innerHeight'];_0x3e093c['style'][_0x13a9e4(0x14a)]=_0x2f4fd0+'px';if(_0x141659){const _0x22af2d=_0x141659['offsetHeight'];_0x20c93d[_0x13a9e4(0xee)]['paddingBottom']=_0x22af2d+0x28+'px';}}tg?tg[_0x44a390(0x160)](_0x44a390(0x144),({isStateStable:_0x509a2f})=>{_0x252fc5();if(_0x509a2f)requestAnimationFrame(()=>{const _0x21f162=a0_0x512c;_0x20c93d['scrollTop']=_0x20c93d[_0x21f162(0x12f)];});}):window[_0x44a390(0x154)](_0x44a390(0x167),_0x252fc5),_0x252fc5(),_0x507bee&&(_0x507bee[_0x44a390(0x154)](_0x44a390(0x103),()=>{requestAnimationFrame(_0x252fc5);}),_0x507bee[_0x44a390(0x154)]('focus',()=>{setTimeout(()=>{const _0x454d26=a0_0x512c;_0x20c93d['scrollTop']=_0x20c93d[_0x454d26(0x12f)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5672b7(0x135),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x512c(_0x25257f,_0x659b36){_0x25257f=_0x25257f-0xee;const _0x2d26c0=a0_0x36f2();let _0x168b94=_0x2d26c0[_0x25257f];return _0x168b94;}let messages=[],isTyping=![];const chatArea=document['getElementById']('chatArea'),emptyState=document[a0_0x5672b7(0xf4)](a0_0x5672b7(0x121)),messageInput=document[a0_0x5672b7(0xf4)](a0_0x5672b7(0x13b)),sendBtn=document[a0_0x5672b7(0xf4)](a0_0x5672b7(0x16d)),clearBtn=document[a0_0x5672b7(0xf4)](a0_0x5672b7(0x110)),modal=document[a0_0x5672b7(0xf4)](a0_0x5672b7(0x117)),mTitle=document[a0_0x5672b7(0xf4)]('modalTitle'),mText=document['getElementById'](a0_0x5672b7(0x16a));let modalCallback=null;async function callBackend(_0x13ea68,_0x454aff){const _0x3096b6=a0_0x5672b7,_0x5c5a61=tg?.[_0x3096b6(0x113)]?.[_0x3096b6(0x13e)]||{},_0x3f83b6=_0x5c5a61['id']||localStorage[_0x3096b6(0x143)](_0x3096b6(0x12c))||'d-'+Math['floor'](Math[_0x3096b6(0x118)]()*0x3b9aca00);if(!_0x5c5a61['id'])localStorage[_0x3096b6(0x11c)](_0x3096b6(0x12c),_0x3f83b6);const _0x24530c={'action':_0x13ea68,'user_id':_0x3f83b6,'user_data':{'first_name':_0x5c5a61[_0x3096b6(0x158)],'username':_0x5c5a61[_0x3096b6(0x152)]},'init_data':tg?.[_0x3096b6(0x10e)]||'',..._0x454aff},_0x5a0cb1=new AbortController(),_0x4734c6=setTimeout(()=>_0x5a0cb1[_0x3096b6(0x130)](),REQUEST_TIMEOUT_MS);try{const _0x1e030a=await fetch(BACKEND_URL,{'method':_0x3096b6(0x112),'headers':{'Content-Type':_0x3096b6(0x149)},'body':JSON[_0x3096b6(0x115)](_0x24530c),'signal':_0x5a0cb1['signal']});return clearTimeout(_0x4734c6),await _0x1e030a[_0x3096b6(0x16b)]();}catch(_0x871af4){return{'success':![],'error':String(_0x871af4)};}}function formatTime(_0x2c5e3f){const _0x179b0a=a0_0x5672b7,_0x33d2b0=new Date(_0x2c5e3f);return String(_0x33d2b0['getHours']())['padStart'](0x2,'0')+':'+String(_0x33d2b0[_0x179b0a(0x148)]())[_0x179b0a(0xf6)](0x2,'0');}function createMessageElement(_0x4e4d6e,_0x2c9bb5){const _0x48f5ee=a0_0x5672b7,_0x1e9268=document['createElement'](_0x48f5ee(0x168));_0x1e9268[_0x48f5ee(0x137)]=_0x48f5ee(0x13a)+_0x4e4d6e[_0x48f5ee(0x145)];const _0x11943b=document[_0x48f5ee(0xf0)]('div');_0x11943b['className']=_0x48f5ee(0x12b),_0x11943b[_0x48f5ee(0x159)]=_0x4e4d6e[_0x48f5ee(0x10c)][_0x48f5ee(0xfd)](/\n/g,_0x48f5ee(0x123));const _0xc860e7=document[_0x48f5ee(0xf0)]('div');_0xc860e7[_0x48f5ee(0x137)]='delete-btn',_0xc860e7[_0x48f5ee(0x159)]=_0x48f5ee(0x132),_0xc860e7[_0x48f5ee(0x164)]=_0x3eccf0=>{const _0x1a1743=_0x48f5ee;_0x3eccf0[_0x1a1743(0x116)](),confirmDelete(_0x2c9bb5);};let _0x3d7b70;_0x11943b[_0x48f5ee(0x154)]('touchstart',()=>_0x3d7b70=setTimeout(()=>{const _0x4a35b5=_0x48f5ee;_0x1e9268[_0x4a35b5(0x150)][_0x4a35b5(0x141)](_0x4a35b5(0x120));if(tg?.['HapticFeedback'])tg[_0x4a35b5(0xfa)][_0x4a35b5(0x126)](_0x4a35b5(0x106));},0x1f4)),_0x11943b[_0x48f5ee(0x154)](_0x48f5ee(0x14f),()=>clearTimeout(_0x3d7b70));const _0x1c0be6=document[_0x48f5ee(0xf0)](_0x48f5ee(0x168));return _0x1c0be6[_0x48f5ee(0x137)]=_0x48f5ee(0x108),_0x1c0be6[_0x48f5ee(0x124)]=formatTime(_0x4e4d6e[_0x48f5ee(0x10a)]),_0x1e9268[_0x48f5ee(0x147)](_0xc860e7),_0x1e9268['appendChild'](_0x11943b),_0x1e9268['appendChild'](_0x1c0be6),_0x1e9268;}function createTypingIndicator(){const _0x51d55c=a0_0x5672b7,_0x2579e5=document[_0x51d55c(0xf0)]('div');return _0x2579e5[_0x51d55c(0x137)]=_0x51d55c(0x13d),_0x2579e5['id']=_0x51d55c(0x11a),_0x2579e5[_0x51d55c(0x159)]=_0x51d55c(0xf7),_0x2579e5;}function renderMessages(){const _0x470c61=a0_0x5672b7;Array['from'](chatArea[_0x470c61(0x163)])[_0x470c61(0x107)](_0x1bc268=>{const _0x2e6ab6=_0x470c61;if(_0x1bc268['id']!=='emptyState')_0x1bc268[_0x2e6ab6(0x14d)]();}),messages['length']>0x0?(emptyState['style'][_0x470c61(0x134)]=_0x470c61(0x166),messages[_0x470c61(0x107)]((_0x59ac16,_0x1b67fb)=>chatArea[_0x470c61(0x147)](createMessageElement(_0x59ac16,_0x1b67fb)))):emptyState['style'][_0x470c61(0x134)]=_0x470c61(0x161),requestAnimationFrame(()=>chatArea[_0x470c61(0x140)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x16f6f7=a0_0x5672b7;messageInput[_0x16f6f7(0xee)][_0x16f6f7(0x14a)]=_0x16f6f7(0x129),messageInput[_0x16f6f7(0xee)][_0x16f6f7(0x14a)]=Math['min'](messageInput[_0x16f6f7(0x12f)],0x78)+'px';}function updateSendButton(){const _0x5d8364=a0_0x5672b7,_0x4269df=messageInput[_0x5d8364(0x15b)][_0x5d8364(0xf1)]();sendBtn[_0x5d8364(0x11e)]=!_0x4269df||isTyping;}async function sendMessage(){const _0x35b91f=a0_0x5672b7,_0x2876d1=messageInput['value'][_0x35b91f(0xf1)]();if(!_0x2876d1||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x35b91f(0xfa)][_0x35b91f(0x126)]('light');messages[_0x35b91f(0x125)]({'role':'user','content':_0x2876d1,'timestamp':Date[_0x35b91f(0x14c)]()}),localStorage[_0x35b91f(0x11c)](_0x35b91f(0x139),JSON[_0x35b91f(0x115)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x35b91f(0x147)](createTypingIndicator()),chatArea[_0x35b91f(0x140)]=chatArea[_0x35b91f(0x12f)];const _0x1fdb0e=await callBackend('send_message',{'message':_0x2876d1});isTyping=![];const _0x35b4b9=document['getElementById'](_0x35b91f(0x11a));if(_0x35b4b9)_0x35b4b9[_0x35b91f(0x14d)]();let _0x44f179=_0x35b91f(0x10d);if(_0x1fdb0e[_0x35b91f(0x16c)]){_0x44f179=_0x1fdb0e[_0x35b91f(0x155)]||'Пустой\x20ответ';if(tg?.[_0x35b91f(0xfa)])tg[_0x35b91f(0xfa)][_0x35b91f(0xf9)]('success');}else{_0x44f179=_0x1fdb0e[_0x35b91f(0xfc)]||_0x35b91f(0x109);if(tg?.[_0x35b91f(0xfa)])tg[_0x35b91f(0xfa)][_0x35b91f(0xf9)]('error');}messages['push']({'role':'ai','content':_0x44f179,'timestamp':Date[_0x35b91f(0x14c)]()}),localStorage[_0x35b91f(0x11c)](_0x35b91f(0x139),JSON[_0x35b91f(0x115)](messages)),renderMessages();}function confirmDelete(_0x2c2642){const _0x51148e=a0_0x5672b7;if(mTitle)mTitle['textContent']=_0x51148e(0x10f);if(mText)mText[_0x51148e(0x124)]=_0x51148e(0x13c);modalCallback=()=>{const _0x13142f=_0x51148e;messages[_0x13142f(0xf3)](_0x2c2642,0x1),localStorage['setItem'](_0x13142f(0x139),JSON[_0x13142f(0x115)](messages)),renderMessages();},modal[_0x51148e(0x150)][_0x51148e(0x141)](_0x51148e(0x162));}if(clearBtn)clearBtn[a0_0x5672b7(0x164)]=()=>{const _0x16b303=a0_0x5672b7;if(!messages[_0x16b303(0x157)])return;if(mTitle)mTitle['textContent']=_0x16b303(0x12d);if(mText)mText['textContent']=_0x16b303(0x131);modalCallback=async()=>{const _0x18c460=_0x16b303;messages=[],localStorage[_0x18c460(0x127)]('ai_chat_messages'),renderMessages(),callBackend(_0x18c460(0x14b),{});},modal[_0x16b303(0x150)][_0x16b303(0x141)](_0x16b303(0x162));};document[a0_0x5672b7(0xf4)](a0_0x5672b7(0x138))[a0_0x5672b7(0x164)]=()=>modal['classList'][a0_0x5672b7(0x14d)](a0_0x5672b7(0x162)),document[a0_0x5672b7(0xf4)](a0_0x5672b7(0xfb))['onclick']=()=>{const _0xd4bbf9=a0_0x5672b7;if(modalCallback)modalCallback();modal[_0xd4bbf9(0x150)][_0xd4bbf9(0x14d)](_0xd4bbf9(0x162));},messageInput[a0_0x5672b7(0x154)](a0_0x5672b7(0x103),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x5672b7(0x165),_0x39de52=>{const _0x141b00=a0_0x5672b7;_0x39de52[_0x141b00(0x104)]===_0x141b00(0x12e)&&!_0x39de52['shiftKey']&&(_0x39de52[_0x141b00(0xfe)](),sendMessage());}),sendBtn[a0_0x5672b7(0x164)]=sendMessage,document[a0_0x5672b7(0x154)](a0_0x5672b7(0xf5),_0x1570fb=>{const _0x49eb74=a0_0x5672b7;document[_0x49eb74(0x136)]('.message.show-delete')[_0x49eb74(0x107)](_0x5816c6=>{const _0x11f9f9=_0x49eb74;if(!_0x5816c6['contains'](_0x1570fb[_0x11f9f9(0x142)]))_0x5816c6['classList'][_0x11f9f9(0x14d)](_0x11f9f9(0x120));});});const saved=localStorage[a0_0x5672b7(0x143)](a0_0x5672b7(0x139));function a0_0x36f2(){const _0x56b722=['modalCancel','ai_chat_messages','message\x20','messageInput','Действие\x20необратимо.','message\x20ai','user','./router.html','scrollTop','add','target','getItem','viewportChanged','role','warn','appendChild','getMinutes','text/plain','height','clear_history','now','remove','TG\x20setup\x20error:','touchend','classList','querySelector','username','5PGnEaM','addEventListener','text','1698WKFrKr','length','first_name','innerHTML','expand','value','730219UjwbJe','href','Telegram','872KCMXcK','onEvent','flex','show','children','onclick','keydown','none','resize','div','25uMvWCE','modalText','json','success','sendBtn','style','parse','createElement','trim','158590XeNBgt','splice','getElementById','click','padStart','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','toString','notificationOccurred','HapticFeedback','modalConfirm','error','replace','preventDefault','offClick','BackButton','search','61443bzzevl','input','key','light','medium','forEach','message-time','Ошибка\x20сервера','timestamp','886160gomBSo','content','Ошибка\x20сети','initData','Удалить?','clearBtn','119338LhlxRR','POST','initDataUnsafe','setHeaderColor','stringify','stopPropagation','confirmModal','random','inputArea','typingIndicator','onClick','setItem','6.1','disabled','(((.+)+)+)+$','show-delete','emptyState','isVersionAtLeast','<br>','textContent','push','impactOccurred','removeItem','viewportHeight','auto','1660vQEsXh','message-bubble','debug_uid','Очистить\x20историю?','Enter','scrollHeight','abort','Начнется\x20новый\x20диалог.','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','245538nheDCs','display','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','querySelectorAll','className'];a0_0x36f2=function(){return _0x56b722;};return a0_0x36f2();}if(saved)try{messages=JSON[a0_0x5672b7(0xef)](saved),renderMessages();}catch(a0_0x4db1b1){}updateSendButton();