const a0_0x28ff4f=a0_0x54ab;function a0_0x54ab(_0x4528a0,_0x3494c0){_0x4528a0=_0x4528a0-0x1e5;const _0x3784f2=a0_0x13dc();let _0x6ea6=_0x3784f2[_0x4528a0];return _0x6ea6;}(function(_0x585017,_0x1e7128){const _0x44be5b=a0_0x54ab,_0x2068fc=_0x585017();while(!![]){try{const _0x24286a=-parseInt(_0x44be5b(0x1fa))/0x1*(-parseInt(_0x44be5b(0x207))/0x2)+parseInt(_0x44be5b(0x22b))/0x3+-parseInt(_0x44be5b(0x240))/0x4+parseInt(_0x44be5b(0x23f))/0x5+parseInt(_0x44be5b(0x1ea))/0x6+parseInt(_0x44be5b(0x244))/0x7*(-parseInt(_0x44be5b(0x1ed))/0x8)+-parseInt(_0x44be5b(0x210))/0x9;if(_0x24286a===_0x1e7128)break;else _0x2068fc['push'](_0x2068fc['shift']());}catch(_0x116b4b){_0x2068fc['push'](_0x2068fc['shift']());}}}(a0_0x13dc,0x65c09));const tg=window[a0_0x28ff4f(0x23a)]?.[a0_0x28ff4f(0x257)],HOME_URL=a0_0x28ff4f(0x22d);function setupTelegramBackButton(){const _0x3494b3=a0_0x28ff4f,_0x436940=(function(){let _0x14bf5b=!![];return function(_0x4034cf,_0x34d17b){const _0x583e97=_0x14bf5b?function(){const _0x1d1ba3=a0_0x54ab;if(_0x34d17b){const _0x3e47c8=_0x34d17b[_0x1d1ba3(0x215)](_0x4034cf,arguments);return _0x34d17b=null,_0x3e47c8;}}:function(){};return _0x14bf5b=![],_0x583e97;};}()),_0x1faae4=_0x436940(this,function(){const _0x3f1f95=a0_0x54ab;return _0x1faae4['toString']()[_0x3f1f95(0x222)](_0x3f1f95(0x221))[_0x3f1f95(0x216)]()['constructor'](_0x1faae4)[_0x3f1f95(0x222)](_0x3f1f95(0x221));});_0x1faae4();if(!tg)return;try{tg[_0x3494b3(0x20b)](),tg[_0x3494b3(0x212)](),tg[_0x3494b3(0x202)]?.(_0x3494b3(0x204));if(tg['isVersionAtLeast']?.(_0x3494b3(0x1f4)))tg['disableVerticalSwipes']?.();const _0x4e7a9f=tg[_0x3494b3(0x21c)];if(_0x4e7a9f){_0x4e7a9f[_0x3494b3(0x209)]();if(typeof _0x4e7a9f[_0x3494b3(0x1e6)]===_0x3494b3(0x1ec))try{_0x4e7a9f[_0x3494b3(0x1e6)]();}catch(_0x3ca8f4){}_0x4e7a9f[_0x3494b3(0x23d)](()=>{const _0x333c51=_0x3494b3;if(tg[_0x333c51(0x20a)])tg['HapticFeedback'][_0x333c51(0x1f5)](_0x333c51(0x259));location['href']=HOME_URL;});}}catch(_0xdeb952){console['warn'](_0x3494b3(0x258),_0xdeb952);}}(function initStableLayout(){const _0x320c7b=a0_0x28ff4f,_0x417477=document['querySelector'](_0x320c7b(0x20d)),_0x40f5c9=document[_0x320c7b(0x1f6)](_0x320c7b(0x236)),_0x5c632a=document[_0x320c7b(0x1f6)](_0x320c7b(0x239)),_0x2ce9c8=document[_0x320c7b(0x1f6)](_0x320c7b(0x1f3));function _0x19b0d7(){const _0x8cb6f0=_0x320c7b;if(!_0x417477)return;const _0x346e59=tg&&tg[_0x8cb6f0(0x1e5)]?tg[_0x8cb6f0(0x1e5)]:window['innerHeight'];_0x417477[_0x8cb6f0(0x205)][_0x8cb6f0(0x23b)]=_0x346e59+'px';if(_0x40f5c9){const _0x5e77d6=_0x40f5c9[_0x8cb6f0(0x248)];_0x5c632a[_0x8cb6f0(0x205)]['paddingBottom']=_0x5e77d6+0x28+'px';}}tg?tg[_0x320c7b(0x220)]('viewportChanged',({isStateStable:_0x3c4f6e})=>{_0x19b0d7();if(_0x3c4f6e)requestAnimationFrame(()=>{const _0x1565ac=a0_0x54ab;_0x5c632a[_0x1565ac(0x22c)]=_0x5c632a[_0x1565ac(0x1e9)];});}):window[_0x320c7b(0x1f2)](_0x320c7b(0x1fd),_0x19b0d7),_0x19b0d7(),_0x2ce9c8&&(_0x2ce9c8[_0x320c7b(0x1f2)](_0x320c7b(0x230),()=>{requestAnimationFrame(_0x19b0d7);}),_0x2ce9c8[_0x320c7b(0x1f2)](_0x320c7b(0x1f7),()=>{setTimeout(()=>{const _0x56f2fa=a0_0x54ab;_0x5c632a[_0x56f2fa(0x22c)]=_0x5c632a['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x28ff4f(0x227),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x28ff4f(0x1f6)](a0_0x28ff4f(0x239)),emptyState=document[a0_0x28ff4f(0x1f6)]('emptyState'),messageInput=document['getElementById'](a0_0x28ff4f(0x1f3)),sendBtn=document[a0_0x28ff4f(0x1f6)](a0_0x28ff4f(0x24a)),clearBtn=document[a0_0x28ff4f(0x1f6)](a0_0x28ff4f(0x231)),modal=document[a0_0x28ff4f(0x1f6)](a0_0x28ff4f(0x238)),mTitle=document[a0_0x28ff4f(0x1f6)](a0_0x28ff4f(0x206)),mText=document[a0_0x28ff4f(0x1f6)](a0_0x28ff4f(0x242));let modalCallback=null;async function callBackend(_0x58ed26,_0x522cb9){const _0x1ebca4=a0_0x28ff4f,_0x2b434d=tg?.['initDataUnsafe']?.[_0x1ebca4(0x1e8)]||{},_0xada0fd=_0x2b434d['id']||localStorage[_0x1ebca4(0x20c)]('debug_uid')||'d-'+Math[_0x1ebca4(0x255)](Math[_0x1ebca4(0x208)]()*0x3b9aca00);if(!_0x2b434d['id'])localStorage['setItem'](_0x1ebca4(0x21f),_0xada0fd);const _0xa143f={'action':_0x58ed26,'user_id':_0xada0fd,'user_data':{'first_name':_0x2b434d['first_name'],'username':_0x2b434d[_0x1ebca4(0x256)]},'init_data':tg?.[_0x1ebca4(0x243)]||'',..._0x522cb9},_0x1a9864=new AbortController(),_0x19b6fd=setTimeout(()=>_0x1a9864[_0x1ebca4(0x1f8)](),REQUEST_TIMEOUT_MS);try{const _0x2c023f=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x1ebca4(0x25d)},'body':JSON[_0x1ebca4(0x22a)](_0xa143f),'signal':_0x1a9864['signal']});return clearTimeout(_0x19b6fd),await _0x2c023f['json']();}catch(_0x10ea05){return{'success':![],'error':String(_0x10ea05)};}}function formatTime(_0x49c231){const _0x3695e4=a0_0x28ff4f,_0x3c46f1=new Date(_0x49c231);return String(_0x3c46f1[_0x3695e4(0x1ff)]())[_0x3695e4(0x200)](0x2,'0')+':'+String(_0x3c46f1['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x3a4b93,_0x5916b3){const _0x1d9d13=a0_0x28ff4f,_0x266f22=document[_0x1d9d13(0x229)]('div');_0x266f22[_0x1d9d13(0x25b)]='message\x20'+_0x3a4b93[_0x1d9d13(0x234)];const _0x3c3614=document['createElement'](_0x1d9d13(0x245));_0x3c3614['className']='message-bubble',_0x3c3614[_0x1d9d13(0x24e)]=_0x3a4b93[_0x1d9d13(0x1fc)]['replace'](/\n/g,_0x1d9d13(0x223));const _0x41b189=document['createElement']('div');_0x41b189[_0x1d9d13(0x25b)]=_0x1d9d13(0x1f0),_0x41b189[_0x1d9d13(0x24e)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x41b189[_0x1d9d13(0x1ee)]=_0x42ac5a=>{const _0x38e6c8=_0x1d9d13;_0x42ac5a[_0x38e6c8(0x25c)](),confirmDelete(_0x5916b3);};let _0x1f9539;_0x3c3614[_0x1d9d13(0x1f2)](_0x1d9d13(0x254),()=>_0x1f9539=setTimeout(()=>{const _0x598286=_0x1d9d13;_0x266f22[_0x598286(0x249)]['add']('show-delete');if(tg?.[_0x598286(0x20a)])tg[_0x598286(0x20a)]['impactOccurred'](_0x598286(0x20f));},0x1f4)),_0x3c3614['addEventListener'](_0x1d9d13(0x246),()=>clearTimeout(_0x1f9539));const _0x4f524a=document['createElement']('div');return _0x4f524a[_0x1d9d13(0x25b)]=_0x1d9d13(0x217),_0x4f524a[_0x1d9d13(0x251)]=formatTime(_0x3a4b93[_0x1d9d13(0x252)]),_0x266f22['appendChild'](_0x41b189),_0x266f22[_0x1d9d13(0x226)](_0x3c3614),_0x266f22[_0x1d9d13(0x226)](_0x4f524a),_0x266f22;}function a0_0x13dc(){const _0x5d85b5=['show-delete','ai_chat_messages','apply','toString','message-time','error','key','click','flex','BackButton','remove','shiftKey','debug_uid','onEvent','(((.+)+)+)+$','search','<br>','from','auto','appendChild','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','send_message','createElement','stringify','956739YfnTBL','scrollTop','./router.html','display','modalCancel','input','clearBtn','add','typingIndicator','role','Действие\x20необратимо.','inputArea','keydown','confirmModal','chatArea','Telegram','height','now','onClick','emptyState','1474250RFdjRY','1278748sJAyHC','message\x20ai','modalText','initData','7swXOTM','div','touchend','text','offsetHeight','classList','sendBtn','preventDefault','notificationOccurred','clear_history','innerHTML','Начнется\x20новый\x20диалог.','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','textContent','timestamp','children','touchstart','floor','username','WebApp','TG\x20setup\x20error:','light','forEach','className','stopPropagation','text/plain','viewportHeight','offClick','length','user','scrollHeight','1368678WdMGNa','setItem','function','1039912XBlnEl','onclick','value','delete-btn','splice','addEventListener','messageInput','6.1','impactOccurred','getElementById','focus','abort','contains','14jFUGGT','push','content','resize','.message.show-delete','getHours','padStart','trim','setHeaderColor','disabled','#050505','style','modalTitle','57052qspCTC','random','show','HapticFeedback','ready','getItem','.container','none','medium','3373083yQjpww','target','expand'];a0_0x13dc=function(){return _0x5d85b5;};return a0_0x13dc();}function createTypingIndicator(){const _0x58fbed=a0_0x28ff4f,_0x2dd8a5=document['createElement'](_0x58fbed(0x245));return _0x2dd8a5['className']=_0x58fbed(0x241),_0x2dd8a5['id']=_0x58fbed(0x233),_0x2dd8a5[_0x58fbed(0x24e)]=_0x58fbed(0x250),_0x2dd8a5;}function renderMessages(){const _0x530a55=a0_0x28ff4f;Array[_0x530a55(0x224)](chatArea[_0x530a55(0x253)])[_0x530a55(0x25a)](_0x4c8e66=>{const _0x2d2482=_0x530a55;if(_0x4c8e66['id']!==_0x2d2482(0x23e))_0x4c8e66['remove']();}),messages[_0x530a55(0x1e7)]>0x0?(emptyState['style']['display']=_0x530a55(0x20e),messages[_0x530a55(0x25a)]((_0x507824,_0x2e84f9)=>chatArea[_0x530a55(0x226)](createMessageElement(_0x507824,_0x2e84f9)))):emptyState[_0x530a55(0x205)][_0x530a55(0x22e)]=_0x530a55(0x21b),requestAnimationFrame(()=>chatArea[_0x530a55(0x22c)]=chatArea[_0x530a55(0x1e9)]);}function autoResizeTextarea(){const _0x56c4ea=a0_0x28ff4f;messageInput[_0x56c4ea(0x205)][_0x56c4ea(0x23b)]=_0x56c4ea(0x225),messageInput[_0x56c4ea(0x205)][_0x56c4ea(0x23b)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x22416e=a0_0x28ff4f,_0x44177a=messageInput[_0x22416e(0x1ef)][_0x22416e(0x201)]();sendBtn[_0x22416e(0x203)]=!_0x44177a||isTyping;}async function sendMessage(){const _0x13ffcc=a0_0x28ff4f,_0x1ace48=messageInput[_0x13ffcc(0x1ef)][_0x13ffcc(0x201)]();if(!_0x1ace48||isTyping)return;if(tg?.[_0x13ffcc(0x20a)])tg[_0x13ffcc(0x20a)][_0x13ffcc(0x1f5)](_0x13ffcc(0x259));messages[_0x13ffcc(0x1fb)]({'role':_0x13ffcc(0x1e8),'content':_0x1ace48,'timestamp':Date[_0x13ffcc(0x23c)]()}),localStorage[_0x13ffcc(0x1eb)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0x13ffcc(0x1ef)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x13ffcc(0x226)](createTypingIndicator()),chatArea[_0x13ffcc(0x22c)]=chatArea[_0x13ffcc(0x1e9)];const _0x2701ba=await callBackend(_0x13ffcc(0x228),{'message':_0x1ace48});isTyping=![];const _0x2eb6c9=document[_0x13ffcc(0x1f6)](_0x13ffcc(0x233));if(_0x2eb6c9)_0x2eb6c9[_0x13ffcc(0x21d)]();let _0x4d76a0='Ошибка\x20сети';if(_0x2701ba['success']){_0x4d76a0=_0x2701ba[_0x13ffcc(0x247)]||'Пустой\x20ответ';if(tg?.[_0x13ffcc(0x20a)])tg[_0x13ffcc(0x20a)]['notificationOccurred']('success');}else{_0x4d76a0=_0x2701ba[_0x13ffcc(0x218)]||'Ошибка\x20сервера';if(tg?.[_0x13ffcc(0x20a)])tg[_0x13ffcc(0x20a)][_0x13ffcc(0x24c)]('error');}messages[_0x13ffcc(0x1fb)]({'role':'ai','content':_0x4d76a0,'timestamp':Date[_0x13ffcc(0x23c)]()}),localStorage[_0x13ffcc(0x1eb)](_0x13ffcc(0x214),JSON[_0x13ffcc(0x22a)](messages)),renderMessages();}function confirmDelete(_0x2fb20a){const _0x3b7051=a0_0x28ff4f;if(mTitle)mTitle[_0x3b7051(0x251)]='Удалить?';if(mText)mText[_0x3b7051(0x251)]=_0x3b7051(0x235);modalCallback=()=>{const _0x24a813=_0x3b7051;messages[_0x24a813(0x1f1)](_0x2fb20a,0x1),localStorage[_0x24a813(0x1eb)](_0x24a813(0x214),JSON[_0x24a813(0x22a)](messages)),renderMessages();},modal[_0x3b7051(0x249)][_0x3b7051(0x232)]('show');}if(clearBtn)clearBtn[a0_0x28ff4f(0x1ee)]=()=>{const _0x1dc471=a0_0x28ff4f;if(!messages[_0x1dc471(0x1e7)])return;if(mTitle)mTitle[_0x1dc471(0x251)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x1dc471(0x24f);modalCallback=async()=>{const _0x2835d3=_0x1dc471;messages=[],localStorage['removeItem'](_0x2835d3(0x214)),renderMessages(),callBackend(_0x2835d3(0x24d),{});},modal[_0x1dc471(0x249)][_0x1dc471(0x232)](_0x1dc471(0x209));};document[a0_0x28ff4f(0x1f6)](a0_0x28ff4f(0x22f))[a0_0x28ff4f(0x1ee)]=()=>modal['classList'][a0_0x28ff4f(0x21d)](a0_0x28ff4f(0x209)),document[a0_0x28ff4f(0x1f6)]('modalConfirm')[a0_0x28ff4f(0x1ee)]=()=>{const _0x38d8e8=a0_0x28ff4f;if(modalCallback)modalCallback();modal['classList'][_0x38d8e8(0x21d)](_0x38d8e8(0x209));},messageInput[a0_0x28ff4f(0x1f2)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x28ff4f(0x1f2)](a0_0x28ff4f(0x237),_0x139c13=>{const _0x5630e2=a0_0x28ff4f;_0x139c13[_0x5630e2(0x219)]==='Enter'&&!_0x139c13[_0x5630e2(0x21e)]&&(_0x139c13[_0x5630e2(0x24b)](),sendMessage());}),sendBtn[a0_0x28ff4f(0x1ee)]=sendMessage,document[a0_0x28ff4f(0x1f2)](a0_0x28ff4f(0x21a),_0x1bf8b7=>{const _0x3707ac=a0_0x28ff4f;document['querySelectorAll'](_0x3707ac(0x1fe))['forEach'](_0x3b94f4=>{const _0x1725aa=_0x3707ac;if(!_0x3b94f4[_0x1725aa(0x1f9)](_0x1bf8b7[_0x1725aa(0x211)]))_0x3b94f4[_0x1725aa(0x249)][_0x1725aa(0x21d)](_0x1725aa(0x213));});});const saved=localStorage[a0_0x28ff4f(0x20c)](a0_0x28ff4f(0x214));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x1fdbc0){}updateSendButton();