const a0_0x256c99=a0_0x4ad1;function a0_0x4ad1(_0x372e9e,_0x77860c){_0x372e9e=_0x372e9e-0x142;const _0x20ddf1=a0_0x2d26();let _0x13e748=_0x20ddf1[_0x372e9e];return _0x13e748;}(function(_0x4ee44a,_0x417ee4){const _0x2b8725=a0_0x4ad1,_0x365453=_0x4ee44a();while(!![]){try{const _0x52fa97=-parseInt(_0x2b8725(0x1c1))/0x1*(parseInt(_0x2b8725(0x156))/0x2)+-parseInt(_0x2b8725(0x15e))/0x3+-parseInt(_0x2b8725(0x1b9))/0x4+-parseInt(_0x2b8725(0x144))/0x5+parseInt(_0x2b8725(0x1bd))/0x6*(parseInt(_0x2b8725(0x192))/0x7)+-parseInt(_0x2b8725(0x18c))/0x8+parseInt(_0x2b8725(0x14b))/0x9;if(_0x52fa97===_0x417ee4)break;else _0x365453['push'](_0x365453['shift']());}catch(_0x54d533){_0x365453['push'](_0x365453['shift']());}}}(a0_0x2d26,0x62ce1));const tg=window[a0_0x256c99(0x1ad)]?.[a0_0x256c99(0x1b5)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x4910b1=a0_0x256c99;if(!tg)return;try{tg[_0x4910b1(0x16a)](),tg[_0x4910b1(0x198)](),tg[_0x4910b1(0x161)]?.(_0x4910b1(0x15a));if(tg['isVersionAtLeast']?.(_0x4910b1(0x191)))tg[_0x4910b1(0x158)]?.();const _0x164b98=tg[_0x4910b1(0x18a)];if(_0x164b98){_0x164b98[_0x4910b1(0x16f)]();if(typeof _0x164b98['offClick']===_0x4910b1(0x175))try{_0x164b98[_0x4910b1(0x14f)]();}catch(_0x444085){}_0x164b98['onClick'](()=>{const _0x319225=_0x4910b1;if(tg[_0x319225(0x179)])tg[_0x319225(0x179)][_0x319225(0x16b)](_0x319225(0x147));location[_0x319225(0x188)]=HOME_URL;});}}catch(_0x29215e){console[_0x4910b1(0x1a6)](_0x4910b1(0x1a3),_0x29215e);}}(function initStableLayout(){const _0x5e0e79=a0_0x256c99,_0x789bf2=(function(){let _0x29c978=!![];return function(_0x17a0db,_0x4381fd){const _0x5cf213=_0x29c978?function(){const _0x49480b=a0_0x4ad1;if(_0x4381fd){const _0x495b23=_0x4381fd[_0x49480b(0x1ba)](_0x17a0db,arguments);return _0x4381fd=null,_0x495b23;}}:function(){};return _0x29c978=![],_0x5cf213;};}()),_0x226631=document[_0x5e0e79(0x1a5)](_0x5e0e79(0x19b)),_0x49814a=document['getElementById'](_0x5e0e79(0x170)),_0x280dac=document[_0x5e0e79(0x1bf)]('chatArea'),_0x5e2c12=document[_0x5e0e79(0x1bf)](_0x5e0e79(0x17a));function _0x373c30(){const _0x57062a=_0x5e0e79,_0x105de6=_0x789bf2(this,function(){const _0x2aa7fd=a0_0x4ad1;return _0x105de6['toString']()[_0x2aa7fd(0x157)](_0x2aa7fd(0x16d))[_0x2aa7fd(0x1b6)]()[_0x2aa7fd(0x16c)](_0x105de6)[_0x2aa7fd(0x157)](_0x2aa7fd(0x16d));});_0x105de6();if(!_0x226631)return;const _0x250e5a=tg&&tg['viewportHeight']?tg[_0x57062a(0x1ae)]:window[_0x57062a(0x196)];_0x226631[_0x57062a(0x149)][_0x57062a(0x153)]=_0x250e5a+'px';if(_0x49814a){const _0x3d8b78=_0x49814a[_0x57062a(0x1b4)];_0x280dac[_0x57062a(0x149)][_0x57062a(0x1ab)]=_0x3d8b78+0x28+'px';}}tg?tg[_0x5e0e79(0x1c3)](_0x5e0e79(0x18b),({isStateStable:_0x1a4b3a})=>{_0x373c30();if(_0x1a4b3a)requestAnimationFrame(()=>{const _0x5b6ec5=a0_0x4ad1;_0x280dac[_0x5b6ec5(0x171)]=_0x280dac['scrollHeight'];});}):window[_0x5e0e79(0x145)](_0x5e0e79(0x168),_0x373c30),_0x373c30(),_0x5e2c12&&(_0x5e2c12[_0x5e0e79(0x145)](_0x5e0e79(0x163),()=>{requestAnimationFrame(_0x373c30);}),_0x5e2c12[_0x5e0e79(0x145)]('focus',()=>{setTimeout(()=>{const _0x30ae75=a0_0x4ad1;_0x280dac[_0x30ae75(0x171)]=_0x280dac['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x256c99(0x189),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x256c99(0x1bf)](a0_0x256c99(0x14e)),emptyState=document[a0_0x256c99(0x1bf)](a0_0x256c99(0x1a7)),messageInput=document[a0_0x256c99(0x1bf)](a0_0x256c99(0x17a)),sendBtn=document[a0_0x256c99(0x1bf)](a0_0x256c99(0x182)),clearBtn=document[a0_0x256c99(0x1bf)](a0_0x256c99(0x19f)),modal=document[a0_0x256c99(0x1bf)](a0_0x256c99(0x165)),mTitle=document[a0_0x256c99(0x1bf)](a0_0x256c99(0x19a)),mText=document[a0_0x256c99(0x1bf)](a0_0x256c99(0x190));let modalCallback=null;async function callBackend(_0x338b0e,_0x2c3ae0){const _0x22965d=a0_0x256c99,_0x2ee702=tg?.[_0x22965d(0x148)]?.['user']||{},_0x10989b=_0x2ee702['id']||localStorage[_0x22965d(0x16e)](_0x22965d(0x1a9))||'d-'+Math[_0x22965d(0x14c)](Math[_0x22965d(0x1b2)]()*0x3b9aca00);if(!_0x2ee702['id'])localStorage[_0x22965d(0x15c)]('debug_uid',_0x10989b);const _0x3748ad={'action':_0x338b0e,'user_id':_0x10989b,'user_data':{'first_name':_0x2ee702[_0x22965d(0x169)],'username':_0x2ee702[_0x22965d(0x1a1)]},'init_data':tg?.[_0x22965d(0x151)]||'',..._0x2c3ae0},_0x2977a4=new AbortController(),_0x4d339f=setTimeout(()=>_0x2977a4[_0x22965d(0x152)](),REQUEST_TIMEOUT_MS);try{const _0x4e9358=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x22965d(0x15f)](_0x3748ad),'signal':_0x2977a4[_0x22965d(0x164)]});return clearTimeout(_0x4d339f),await _0x4e9358[_0x22965d(0x1b3)]();}catch(_0x20347a){return{'success':![],'error':String(_0x20347a)};}}function formatTime(_0x742783){const _0x458eb0=a0_0x256c99,_0x898147=new Date(_0x742783);return String(_0x898147['getHours']())[_0x458eb0(0x1a8)](0x2,'0')+':'+String(_0x898147['getMinutes']())[_0x458eb0(0x1a8)](0x2,'0');}function createMessageElement(_0x4242de,_0x22f680){const _0x29d68f=a0_0x256c99,_0x3cdd4c=document[_0x29d68f(0x197)](_0x29d68f(0x14a));_0x3cdd4c[_0x29d68f(0x17d)]=_0x29d68f(0x178)+_0x4242de['role'];const _0x54ea29=document['createElement'](_0x29d68f(0x14a));_0x54ea29[_0x29d68f(0x17d)]='message-bubble',_0x54ea29[_0x29d68f(0x181)]=_0x4242de[_0x29d68f(0x1aa)][_0x29d68f(0x19c)](/\n/g,_0x29d68f(0x1be));const _0x17b022=document[_0x29d68f(0x197)](_0x29d68f(0x14a));_0x17b022[_0x29d68f(0x17d)]=_0x29d68f(0x15d),_0x17b022[_0x29d68f(0x181)]=_0x29d68f(0x17e),_0x17b022['onclick']=_0x46e4fa=>{const _0x2820bb=_0x29d68f;_0x46e4fa[_0x2820bb(0x1b8)](),confirmDelete(_0x22f680);};let _0x11a5c0;_0x54ea29[_0x29d68f(0x145)]('touchstart',()=>_0x11a5c0=setTimeout(()=>{const _0x2ba51b=_0x29d68f;_0x3cdd4c['classList']['add'](_0x2ba51b(0x160));if(tg?.[_0x2ba51b(0x179)])tg[_0x2ba51b(0x179)][_0x2ba51b(0x16b)](_0x2ba51b(0x194));},0x1f4)),_0x54ea29[_0x29d68f(0x145)](_0x29d68f(0x18e),()=>clearTimeout(_0x11a5c0));const _0x4d732b=document[_0x29d68f(0x197)](_0x29d68f(0x14a));return _0x4d732b['className']=_0x29d68f(0x1c0),_0x4d732b[_0x29d68f(0x184)]=formatTime(_0x4242de[_0x29d68f(0x185)]),_0x3cdd4c['appendChild'](_0x17b022),_0x3cdd4c[_0x29d68f(0x150)](_0x54ea29),_0x3cdd4c[_0x29d68f(0x150)](_0x4d732b),_0x3cdd4c;}function createTypingIndicator(){const _0x27cd79=a0_0x256c99,_0x1d17e4=document['createElement'](_0x27cd79(0x14a));return _0x1d17e4[_0x27cd79(0x17d)]=_0x27cd79(0x193),_0x1d17e4['id']='typingIndicator',_0x1d17e4[_0x27cd79(0x181)]=_0x27cd79(0x180),_0x1d17e4;}function renderMessages(){const _0x368465=a0_0x256c99;Array[_0x368465(0x167)](chatArea[_0x368465(0x1bc)])[_0x368465(0x176)](_0x6bf294=>{const _0xc86aaf=_0x368465;if(_0x6bf294['id']!=='emptyState')_0x6bf294[_0xc86aaf(0x14d)]();}),messages[_0x368465(0x17b)]>0x0?(emptyState[_0x368465(0x149)][_0x368465(0x1c2)]='none',messages['forEach']((_0x279353,_0x519a7c)=>chatArea[_0x368465(0x150)](createMessageElement(_0x279353,_0x519a7c)))):emptyState[_0x368465(0x149)][_0x368465(0x1c2)]=_0x368465(0x173),requestAnimationFrame(()=>chatArea[_0x368465(0x171)]=chatArea[_0x368465(0x1a2)]);}function autoResizeTextarea(){const _0xaaeb24=a0_0x256c99;messageInput['style']['height']=_0xaaeb24(0x162),messageInput[_0xaaeb24(0x149)][_0xaaeb24(0x153)]=Math[_0xaaeb24(0x1ac)](messageInput[_0xaaeb24(0x1a2)],0x78)+'px';}function updateSendButton(){const _0x3646d9=a0_0x256c99,_0x505aef=messageInput[_0x3646d9(0x1c5)][_0x3646d9(0x195)]();sendBtn['disabled']=!_0x505aef||isTyping;}async function sendMessage(){const _0x1efb62=a0_0x256c99,_0x230c7c=messageInput[_0x1efb62(0x1c5)][_0x1efb62(0x195)]();if(!_0x230c7c||isTyping)return;if(tg?.[_0x1efb62(0x179)])tg[_0x1efb62(0x179)][_0x1efb62(0x16b)](_0x1efb62(0x147));messages['push']({'role':'user','content':_0x230c7c,'timestamp':Date[_0x1efb62(0x18f)]()}),localStorage[_0x1efb62(0x15c)]('ai_chat_messages',JSON[_0x1efb62(0x15f)](messages)),renderMessages(),messageInput[_0x1efb62(0x1c5)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1efb62(0x150)](createTypingIndicator()),chatArea[_0x1efb62(0x171)]=chatArea[_0x1efb62(0x1a2)];const _0x38e0a8=await callBackend(_0x1efb62(0x1a0),{'message':_0x230c7c});isTyping=![];const _0x352a44=document[_0x1efb62(0x1bf)]('typingIndicator');if(_0x352a44)_0x352a44[_0x1efb62(0x14d)]();let _0x18f413='Ошибка\x20сети';if(_0x38e0a8[_0x1efb62(0x166)]){_0x18f413=_0x38e0a8['text']||_0x1efb62(0x199);if(tg?.[_0x1efb62(0x179)])tg[_0x1efb62(0x179)][_0x1efb62(0x19d)](_0x1efb62(0x166));}else{_0x18f413=_0x38e0a8[_0x1efb62(0x19e)]||_0x1efb62(0x187);if(tg?.['HapticFeedback'])tg[_0x1efb62(0x179)]['notificationOccurred'](_0x1efb62(0x19e));}messages[_0x1efb62(0x1b7)]({'role':'ai','content':_0x18f413,'timestamp':Date[_0x1efb62(0x18f)]()}),localStorage[_0x1efb62(0x15c)](_0x1efb62(0x159),JSON[_0x1efb62(0x15f)](messages)),renderMessages();}function confirmDelete(_0x87d164){const _0x350cdd=a0_0x256c99;if(mTitle)mTitle['textContent']=_0x350cdd(0x1bb);if(mText)mText[_0x350cdd(0x184)]=_0x350cdd(0x155);modalCallback=()=>{const _0x4fa735=_0x350cdd;messages[_0x4fa735(0x177)](_0x87d164,0x1),localStorage['setItem'](_0x4fa735(0x159),JSON[_0x4fa735(0x15f)](messages)),renderMessages();},modal['classList'][_0x350cdd(0x17f)]('show');}if(clearBtn)clearBtn[a0_0x256c99(0x15b)]=()=>{const _0x1aa0aa=a0_0x256c99;if(!messages['length'])return;if(mTitle)mTitle[_0x1aa0aa(0x184)]=_0x1aa0aa(0x1c4);if(mText)mText[_0x1aa0aa(0x184)]=_0x1aa0aa(0x183);modalCallback=async()=>{const _0x53b3b4=_0x1aa0aa;messages=[],localStorage[_0x53b3b4(0x17c)](_0x53b3b4(0x159)),renderMessages(),callBackend(_0x53b3b4(0x18d),{});},modal[_0x1aa0aa(0x1b1)][_0x1aa0aa(0x17f)](_0x1aa0aa(0x16f));};document[a0_0x256c99(0x1bf)](a0_0x256c99(0x172))[a0_0x256c99(0x15b)]=()=>modal[a0_0x256c99(0x1b1)][a0_0x256c99(0x14d)]('show'),document[a0_0x256c99(0x1bf)](a0_0x256c99(0x154))[a0_0x256c99(0x15b)]=()=>{const _0x2e6903=a0_0x256c99;if(modalCallback)modalCallback();modal[_0x2e6903(0x1b1)][_0x2e6903(0x14d)]('show');},messageInput[a0_0x256c99(0x145)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x256c99(0x146),_0xc4ba0e=>{const _0x10fe02=a0_0x256c99;_0xc4ba0e['key']==='Enter'&&!_0xc4ba0e[_0x10fe02(0x142)]&&(_0xc4ba0e[_0x10fe02(0x1a4)](),sendMessage());}),sendBtn[a0_0x256c99(0x15b)]=sendMessage,document['addEventListener'](a0_0x256c99(0x174),_0x43f0b6=>{const _0x209d1c=a0_0x256c99;document[_0x209d1c(0x143)](_0x209d1c(0x1af))['forEach'](_0x137ebb=>{const _0x1701c0=_0x209d1c;if(!_0x137ebb[_0x1701c0(0x186)](_0x43f0b6[_0x1701c0(0x1b0)]))_0x137ebb[_0x1701c0(0x1b1)][_0x1701c0(0x14d)](_0x1701c0(0x160));});});const saved=localStorage['getItem'](a0_0x256c99(0x159));function a0_0x2d26(){const _0x254c3a=['splice','message\x20','HapticFeedback','messageInput','length','removeItem','className','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','add','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','innerHTML','sendBtn','Начнется\x20новый\x20диалог.','textContent','timestamp','contains','Ошибка\x20сервера','href','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','BackButton','viewportChanged','924192kNuGwg','clear_history','touchend','now','modalText','6.1','126xVuknd','message\x20ai','medium','trim','innerHeight','createElement','expand','Пустой\x20ответ','modalTitle','.container','replace','notificationOccurred','error','clearBtn','send_message','username','scrollHeight','TG\x20setup\x20error:','preventDefault','querySelector','warn','emptyState','padStart','debug_uid','content','paddingBottom','min','Telegram','viewportHeight','.message.show-delete','target','classList','random','json','offsetHeight','WebApp','toString','push','stopPropagation','851552pKRoDf','apply','Удалить?','children','167682mEBdVT','<br>','getElementById','message-time','1MYaARd','display','onEvent','Очистить\x20историю?','value','shiftKey','querySelectorAll','2099020DtZCSZ','addEventListener','keydown','light','initDataUnsafe','style','div','12394962NpENSc','floor','remove','chatArea','offClick','appendChild','initData','abort','height','modalConfirm','Действие\x20необратимо.','876274CyNkrj','search','disableVerticalSwipes','ai_chat_messages','#050505','onclick','setItem','delete-btn','867618vrZpIR','stringify','show-delete','setHeaderColor','auto','input','signal','confirmModal','success','from','resize','first_name','ready','impactOccurred','constructor','(((.+)+)+)+$','getItem','show','inputArea','scrollTop','modalCancel','flex','click','function','forEach'];a0_0x2d26=function(){return _0x254c3a;};return a0_0x2d26();}if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x25dd38){}updateSendButton();