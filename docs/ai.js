const a0_0x23f436=a0_0x47f5;(function(_0x380562,_0x512ba2){const _0x56a253=a0_0x47f5,_0x3bd700=_0x380562();while(!![]){try{const _0x278800=parseInt(_0x56a253(0x1c6))/0x1*(parseInt(_0x56a253(0x195))/0x2)+-parseInt(_0x56a253(0x1ca))/0x3*(parseInt(_0x56a253(0x19b))/0x4)+parseInt(_0x56a253(0x202))/0x5*(-parseInt(_0x56a253(0x1a1))/0x6)+parseInt(_0x56a253(0x208))/0x7*(-parseInt(_0x56a253(0x1d0))/0x8)+parseInt(_0x56a253(0x1d2))/0x9+-parseInt(_0x56a253(0x206))/0xa+parseInt(_0x56a253(0x1c1))/0xb;if(_0x278800===_0x512ba2)break;else _0x3bd700['push'](_0x3bd700['shift']());}catch(_0x20460c){_0x3bd700['push'](_0x3bd700['shift']());}}}(a0_0x2852,0x6f818));const tg=window[a0_0x23f436(0x1f6)]?.['WebApp'],HOME_URL=a0_0x23f436(0x191);function setupTelegramBackButton(){const _0x15420c=a0_0x23f436,_0x3076c3=(function(){let _0x54c057=!![];return function(_0x36a920,_0x29eb79){const _0x17165a=_0x54c057?function(){const _0x54eb37=a0_0x47f5;if(_0x29eb79){const _0x55cbce=_0x29eb79[_0x54eb37(0x1ff)](_0x36a920,arguments);return _0x29eb79=null,_0x55cbce;}}:function(){};return _0x54c057=![],_0x17165a;};}()),_0x4c552a=_0x3076c3(this,function(){const _0x3d5a93=a0_0x47f5;return _0x4c552a['toString']()[_0x3d5a93(0x1fb)](_0x3d5a93(0x1f9))[_0x3d5a93(0x1ef)]()[_0x3d5a93(0x1aa)](_0x4c552a)[_0x3d5a93(0x1fb)]('(((.+)+)+)+$');});_0x4c552a();if(!tg)return;try{tg[_0x15420c(0x18f)](),tg[_0x15420c(0x1c8)](),tg[_0x15420c(0x192)]?.(_0x15420c(0x1e0));if(tg['isVersionAtLeast']?.(_0x15420c(0x1be)))tg[_0x15420c(0x1f3)]?.();const _0x361f64=tg[_0x15420c(0x1d8)];if(_0x361f64){_0x361f64[_0x15420c(0x1f8)]();if(typeof _0x361f64['offClick']==='function')try{_0x361f64['offClick']();}catch(_0x17be40){}_0x361f64[_0x15420c(0x1f7)](()=>{const _0x1233f8=_0x15420c;if(tg[_0x1233f8(0x1e1)])tg['HapticFeedback'][_0x1233f8(0x19e)](_0x1233f8(0x1f1));location[_0x1233f8(0x1f4)]=HOME_URL;});}}catch(_0xee3d96){console[_0x15420c(0x1ab)](_0x15420c(0x207),_0xee3d96);}}(function initStableLayout(){const _0x55106e=a0_0x23f436,_0x2b5e15=document[_0x55106e(0x1b0)]('.container'),_0xd4632c=document['getElementById']('inputArea'),_0x5d1ad4=document[_0x55106e(0x1ec)]('chatArea'),_0x53dbc6=document[_0x55106e(0x1ec)]('messageInput');function _0x2a1ca5(){const _0x5bff17=_0x55106e;if(!_0x2b5e15)return;const _0x495f24=tg&&tg[_0x5bff17(0x1de)]?tg[_0x5bff17(0x1de)]:window['innerHeight'];_0x2b5e15['style']['height']=_0x495f24+'px';if(_0xd4632c){const _0x366d57=_0xd4632c[_0x5bff17(0x1d3)];_0x5d1ad4[_0x5bff17(0x1e6)][_0x5bff17(0x1ce)]=_0x366d57+0x28+'px';}}tg?tg[_0x55106e(0x1fd)](_0x55106e(0x1d9),({isStateStable:_0x1a47d4})=>{_0x2a1ca5();if(_0x1a47d4)requestAnimationFrame(()=>{const _0x4676a6=a0_0x47f5;_0x5d1ad4['scrollTop']=_0x5d1ad4[_0x4676a6(0x1c2)];});}):window[_0x55106e(0x1b1)]('resize',_0x2a1ca5),_0x2a1ca5(),_0x53dbc6&&(_0x53dbc6[_0x55106e(0x1b1)]('input',()=>{requestAnimationFrame(_0x2a1ca5);}),_0x53dbc6[_0x55106e(0x1b1)](_0x55106e(0x1ea),()=>{setTimeout(()=>{const _0x989234=a0_0x47f5;_0x5d1ad4['scrollTop']=_0x5d1ad4[_0x989234(0x1c2)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x23f436(0x200),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x2852(){const _0x27c571=['push','ai_chat_messages','toString','auto','light','confirmModal','disableVerticalSwipes','href','stringify','Telegram','onClick','show','(((.+)+)+)+$','touchstart','search','createElement','onEvent','input','apply','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','padStart','5iqmEnS','getHours','flex','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','1640920NEiuEi','TG\x20setup\x20error:','5032279zvtjtN','splice','forEach','ready','key','./router.html','setHeaderColor','parse','from','6yZkmBp','role','length','typingIndicator','Действие\x20необратимо.','stopPropagation','48RWJzXz','modalText','user','impactOccurred','preventDefault','text','2224830qUdIsf','innerHTML','json','appendChild','message\x20ai','classList','keydown','Ошибка\x20сервера','div','constructor','warn','debug_uid','modalConfirm','<br>','none','querySelector','addEventListener','value','notificationOccurred','modalCancel','clearBtn','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','querySelectorAll','className','remove','username','message-bubble','Enter','emptyState','6.1','textContent','sendBtn','15219457uIruaq','scrollHeight','messageInput','success','trim','103353oUUMys','signal','expand','removeItem','153564SUtiQL','now','show-delete','click','paddingBottom','text/plain','8xzevSh','onclick','5680188uIMWZT','offsetHeight','abort','contains','getItem','setItem','BackButton','viewportChanged','add','Очистить\x20историю?','Удалить?','timestamp','viewportHeight','scrollTop','#050505','HapticFeedback','Начнется\x20новый\x20диалог.','POST','floor','height','style','replace','initDataUnsafe','display','focus','min','getElementById'];a0_0x2852=function(){return _0x27c571;};return a0_0x2852();}const chatArea=document[a0_0x23f436(0x1ec)]('chatArea'),emptyState=document[a0_0x23f436(0x1ec)](a0_0x23f436(0x1bd)),messageInput=document['getElementById'](a0_0x23f436(0x1c3)),sendBtn=document[a0_0x23f436(0x1ec)](a0_0x23f436(0x1c0)),clearBtn=document['getElementById'](a0_0x23f436(0x1b5)),modal=document[a0_0x23f436(0x1ec)](a0_0x23f436(0x1f2)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x23f436(0x1ec)](a0_0x23f436(0x19c));let modalCallback=null;async function callBackend(_0x1bf46f,_0x5f1aca){const _0x795ad7=a0_0x23f436,_0x335546=tg?.[_0x795ad7(0x1e8)]?.[_0x795ad7(0x19d)]||{},_0x27a6c6=_0x335546['id']||localStorage[_0x795ad7(0x1d6)](_0x795ad7(0x1ac))||'d-'+Math[_0x795ad7(0x1e4)](Math['random']()*0x3b9aca00);if(!_0x335546['id'])localStorage[_0x795ad7(0x1d7)](_0x795ad7(0x1ac),_0x27a6c6);const _0x352b5f={'action':_0x1bf46f,'user_id':_0x27a6c6,'user_data':{'first_name':_0x335546['first_name'],'username':_0x335546[_0x795ad7(0x1ba)]},'init_data':tg?.['initData']||'',..._0x5f1aca},_0x19a139=new AbortController(),_0xb4bb2f=setTimeout(()=>_0x19a139[_0x795ad7(0x1d4)](),REQUEST_TIMEOUT_MS);try{const _0x825a90=await fetch(BACKEND_URL,{'method':_0x795ad7(0x1e3),'headers':{'Content-Type':_0x795ad7(0x1cf)},'body':JSON[_0x795ad7(0x1f5)](_0x352b5f),'signal':_0x19a139[_0x795ad7(0x1c7)]});return clearTimeout(_0xb4bb2f),await _0x825a90[_0x795ad7(0x1a3)]();}catch(_0x372b0d){return{'success':![],'error':String(_0x372b0d)};}}function formatTime(_0x16a627){const _0x37598e=a0_0x23f436,_0x9fcd04=new Date(_0x16a627);return String(_0x9fcd04[_0x37598e(0x203)]())[_0x37598e(0x201)](0x2,'0')+':'+String(_0x9fcd04['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0xdc66a5,_0x822412){const _0x304ed7=a0_0x23f436,_0x1abf65=document[_0x304ed7(0x1fc)](_0x304ed7(0x1a9));_0x1abf65[_0x304ed7(0x1b8)]='message\x20'+_0xdc66a5[_0x304ed7(0x196)];const _0x26836e=document[_0x304ed7(0x1fc)](_0x304ed7(0x1a9));_0x26836e[_0x304ed7(0x1b8)]=_0x304ed7(0x1bb),_0x26836e['innerHTML']=_0xdc66a5['content'][_0x304ed7(0x1e7)](/\n/g,_0x304ed7(0x1ae));const _0x3d881c=document[_0x304ed7(0x1fc)](_0x304ed7(0x1a9));_0x3d881c[_0x304ed7(0x1b8)]='delete-btn',_0x3d881c[_0x304ed7(0x1a2)]=_0x304ed7(0x1b6),_0x3d881c[_0x304ed7(0x1d1)]=_0x5b103b=>{const _0x51779f=_0x304ed7;_0x5b103b[_0x51779f(0x19a)](),confirmDelete(_0x822412);};let _0x45a0ba;_0x26836e['addEventListener'](_0x304ed7(0x1fa),()=>_0x45a0ba=setTimeout(()=>{const _0x106176=_0x304ed7;_0x1abf65[_0x106176(0x1a6)][_0x106176(0x1da)](_0x106176(0x1cc));if(tg?.[_0x106176(0x1e1)])tg[_0x106176(0x1e1)][_0x106176(0x19e)]('medium');},0x1f4)),_0x26836e[_0x304ed7(0x1b1)]('touchend',()=>clearTimeout(_0x45a0ba));const _0x1c1879=document[_0x304ed7(0x1fc)](_0x304ed7(0x1a9));return _0x1c1879[_0x304ed7(0x1b8)]='message-time',_0x1c1879[_0x304ed7(0x1bf)]=formatTime(_0xdc66a5[_0x304ed7(0x1dd)]),_0x1abf65['appendChild'](_0x3d881c),_0x1abf65[_0x304ed7(0x1a4)](_0x26836e),_0x1abf65['appendChild'](_0x1c1879),_0x1abf65;}function createTypingIndicator(){const _0x364af8=a0_0x23f436,_0x8c8a5a=document[_0x364af8(0x1fc)]('div');return _0x8c8a5a[_0x364af8(0x1b8)]=_0x364af8(0x1a5),_0x8c8a5a['id']=_0x364af8(0x198),_0x8c8a5a[_0x364af8(0x1a2)]=_0x364af8(0x205),_0x8c8a5a;}function renderMessages(){const _0xecf89f=a0_0x23f436;Array[_0xecf89f(0x194)](chatArea['children'])[_0xecf89f(0x18e)](_0x462549=>{const _0x118f55=_0xecf89f;if(_0x462549['id']!==_0x118f55(0x1bd))_0x462549['remove']();}),messages[_0xecf89f(0x197)]>0x0?(emptyState[_0xecf89f(0x1e6)][_0xecf89f(0x1e9)]=_0xecf89f(0x1af),messages[_0xecf89f(0x18e)]((_0x1635c0,_0x1e4b66)=>chatArea[_0xecf89f(0x1a4)](createMessageElement(_0x1635c0,_0x1e4b66)))):emptyState[_0xecf89f(0x1e6)]['display']=_0xecf89f(0x204),requestAnimationFrame(()=>chatArea[_0xecf89f(0x1df)]=chatArea[_0xecf89f(0x1c2)]);}function autoResizeTextarea(){const _0x45d468=a0_0x23f436;messageInput[_0x45d468(0x1e6)][_0x45d468(0x1e5)]=_0x45d468(0x1f0),messageInput[_0x45d468(0x1e6)][_0x45d468(0x1e5)]=Math[_0x45d468(0x1eb)](messageInput[_0x45d468(0x1c2)],0x78)+'px';}function updateSendButton(){const _0x5e4109=a0_0x23f436,_0x318dc3=messageInput[_0x5e4109(0x1b2)][_0x5e4109(0x1c5)]();sendBtn['disabled']=!_0x318dc3||isTyping;}function a0_0x47f5(_0x48b27a,_0x554c79){_0x48b27a=_0x48b27a-0x18e;const _0x332dad=a0_0x2852();let _0x221c22=_0x332dad[_0x48b27a];return _0x221c22;}async function sendMessage(){const _0x49e34c=a0_0x23f436,_0x4dc224=messageInput[_0x49e34c(0x1b2)][_0x49e34c(0x1c5)]();if(!_0x4dc224||isTyping)return;if(tg?.[_0x49e34c(0x1e1)])tg[_0x49e34c(0x1e1)][_0x49e34c(0x19e)](_0x49e34c(0x1f1));messages[_0x49e34c(0x1ed)]({'role':'user','content':_0x4dc224,'timestamp':Date[_0x49e34c(0x1cb)]()}),localStorage[_0x49e34c(0x1d7)](_0x49e34c(0x1ee),JSON[_0x49e34c(0x1f5)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x49e34c(0x1a4)](createTypingIndicator()),chatArea[_0x49e34c(0x1df)]=chatArea['scrollHeight'];const _0x1b41a2=await callBackend('send_message',{'message':_0x4dc224});isTyping=![];const _0x11e27a=document[_0x49e34c(0x1ec)]('typingIndicator');if(_0x11e27a)_0x11e27a[_0x49e34c(0x1b9)]();let _0x2eebe3='Ошибка\x20сети';if(_0x1b41a2['success']){_0x2eebe3=_0x1b41a2[_0x49e34c(0x1a0)]||'Пустой\x20ответ';if(tg?.[_0x49e34c(0x1e1)])tg['HapticFeedback']['notificationOccurred'](_0x49e34c(0x1c4));}else{_0x2eebe3=_0x1b41a2['error']||_0x49e34c(0x1a8);if(tg?.[_0x49e34c(0x1e1)])tg['HapticFeedback'][_0x49e34c(0x1b3)]('error');}messages[_0x49e34c(0x1ed)]({'role':'ai','content':_0x2eebe3,'timestamp':Date[_0x49e34c(0x1cb)]()}),localStorage[_0x49e34c(0x1d7)]('ai_chat_messages',JSON[_0x49e34c(0x1f5)](messages)),renderMessages();}function confirmDelete(_0xe17dbc){const _0xa5f4a2=a0_0x23f436;if(mTitle)mTitle[_0xa5f4a2(0x1bf)]=_0xa5f4a2(0x1dc);if(mText)mText[_0xa5f4a2(0x1bf)]=_0xa5f4a2(0x199);modalCallback=()=>{const _0x1ef1e8=_0xa5f4a2;messages[_0x1ef1e8(0x209)](_0xe17dbc,0x1),localStorage[_0x1ef1e8(0x1d7)]('ai_chat_messages',JSON[_0x1ef1e8(0x1f5)](messages)),renderMessages();},modal[_0xa5f4a2(0x1a6)]['add'](_0xa5f4a2(0x1f8));}if(clearBtn)clearBtn[a0_0x23f436(0x1d1)]=()=>{const _0x5e183b=a0_0x23f436;if(!messages[_0x5e183b(0x197)])return;if(mTitle)mTitle[_0x5e183b(0x1bf)]=_0x5e183b(0x1db);if(mText)mText[_0x5e183b(0x1bf)]=_0x5e183b(0x1e2);modalCallback=async()=>{const _0x3290a6=_0x5e183b;messages=[],localStorage[_0x3290a6(0x1c9)](_0x3290a6(0x1ee)),renderMessages(),callBackend('clear_history',{});},modal[_0x5e183b(0x1a6)]['add']('show');};document[a0_0x23f436(0x1ec)](a0_0x23f436(0x1b4))[a0_0x23f436(0x1d1)]=()=>modal[a0_0x23f436(0x1a6)][a0_0x23f436(0x1b9)](a0_0x23f436(0x1f8)),document[a0_0x23f436(0x1ec)](a0_0x23f436(0x1ad))[a0_0x23f436(0x1d1)]=()=>{const _0x5a5465=a0_0x23f436;if(modalCallback)modalCallback();modal[_0x5a5465(0x1a6)][_0x5a5465(0x1b9)](_0x5a5465(0x1f8));},messageInput['addEventListener'](a0_0x23f436(0x1fe),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x23f436(0x1b1)](a0_0x23f436(0x1a7),_0x4e54c5=>{const _0x5c41db=a0_0x23f436;_0x4e54c5[_0x5c41db(0x190)]===_0x5c41db(0x1bc)&&!_0x4e54c5['shiftKey']&&(_0x4e54c5[_0x5c41db(0x19f)](),sendMessage());}),sendBtn[a0_0x23f436(0x1d1)]=sendMessage,document[a0_0x23f436(0x1b1)](a0_0x23f436(0x1cd),_0x4925dc=>{const _0x582503=a0_0x23f436;document[_0x582503(0x1b7)]('.message.show-delete')['forEach'](_0x265fff=>{const _0x5211a3=_0x582503;if(!_0x265fff[_0x5211a3(0x1d5)](_0x4925dc['target']))_0x265fff['classList']['remove']('show-delete');});});const saved=localStorage['getItem'](a0_0x23f436(0x1ee));if(saved)try{messages=JSON[a0_0x23f436(0x193)](saved),renderMessages();}catch(a0_0x4f5104){}updateSendButton();