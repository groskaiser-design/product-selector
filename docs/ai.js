const a0_0x3c8c5e=a0_0xbbb7;(function(_0x259261,_0x111b43){const _0xf9a122=a0_0xbbb7,_0xf97f8a=_0x259261();while(!![]){try{const _0x46f8aa=-parseInt(_0xf9a122(0x225))/0x1+parseInt(_0xf9a122(0x234))/0x2+parseInt(_0xf9a122(0x201))/0x3*(-parseInt(_0xf9a122(0x22e))/0x4)+parseInt(_0xf9a122(0x1d8))/0x5*(-parseInt(_0xf9a122(0x1d4))/0x6)+parseInt(_0xf9a122(0x1f6))/0x7+parseInt(_0xf9a122(0x21d))/0x8*(-parseInt(_0xf9a122(0x1db))/0x9)+-parseInt(_0xf9a122(0x228))/0xa*(-parseInt(_0xf9a122(0x216))/0xb);if(_0x46f8aa===_0x111b43)break;else _0xf97f8a['push'](_0xf97f8a['shift']());}catch(_0x170638){_0xf97f8a['push'](_0xf97f8a['shift']());}}}(a0_0x594b,0x67d08));const tg=window[a0_0x3c8c5e(0x1ed)]?.[a0_0x3c8c5e(0x200)],HOME_URL=a0_0x3c8c5e(0x1e2);function setupTelegramBackButton(){const _0x1376a2=a0_0x3c8c5e,_0x476408=(function(){let _0x296b5e=!![];return function(_0x59049b,_0x130739){const _0x5441c6=_0x296b5e?function(){const _0x4ca26c=a0_0xbbb7;if(_0x130739){const _0x149bff=_0x130739[_0x4ca26c(0x23e)](_0x59049b,arguments);return _0x130739=null,_0x149bff;}}:function(){};return _0x296b5e=![],_0x5441c6;};}()),_0x188130=_0x476408(this,function(){const _0x569dbc=a0_0xbbb7;return _0x188130[_0x569dbc(0x231)]()[_0x569dbc(0x20e)](_0x569dbc(0x22b))[_0x569dbc(0x231)]()[_0x569dbc(0x202)](_0x188130)[_0x569dbc(0x20e)](_0x569dbc(0x22b));});_0x188130();if(!tg)return;try{tg[_0x1376a2(0x1f2)](),tg[_0x1376a2(0x1f4)](),tg[_0x1376a2(0x253)]?.(_0x1376a2(0x23b));if(tg['isVersionAtLeast']?.(_0x1376a2(0x215)))tg[_0x1376a2(0x1d9)]?.();const _0x43cd66=tg[_0x1376a2(0x248)];if(_0x43cd66){_0x43cd66[_0x1376a2(0x1df)]();if(typeof _0x43cd66[_0x1376a2(0x242)]===_0x1376a2(0x1f3))try{_0x43cd66[_0x1376a2(0x242)]();}catch(_0x3300c4){}_0x43cd66[_0x1376a2(0x223)](()=>{const _0x22a717=_0x1376a2;if(tg['HapticFeedback'])tg[_0x22a717(0x1d6)][_0x22a717(0x21a)]('light');location[_0x22a717(0x240)]=HOME_URL;});}}catch(_0x19c7bd){console[_0x1376a2(0x246)](_0x1376a2(0x1fd),_0x19c7bd);}}(function initStableLayout(){const _0x4eb503=a0_0x3c8c5e,_0x1d7c48=document[_0x4eb503(0x239)](_0x4eb503(0x1f1)),_0x2dd58e=document[_0x4eb503(0x224)](_0x4eb503(0x1f9)),_0x5d81d5=document[_0x4eb503(0x224)](_0x4eb503(0x1e8)),_0x12109b=document[_0x4eb503(0x224)](_0x4eb503(0x245));function _0x2fa376(){const _0x3de9ac=_0x4eb503;if(!_0x1d7c48)return;const _0x5a330c=tg&&tg['viewportHeight']?tg[_0x3de9ac(0x205)]:window[_0x3de9ac(0x24a)];_0x1d7c48[_0x3de9ac(0x1e3)]['height']=_0x5a330c+'px';if(_0x2dd58e){const _0x16e09c=_0x2dd58e[_0x3de9ac(0x20f)];_0x5d81d5[_0x3de9ac(0x1e3)][_0x3de9ac(0x1d3)]=_0x16e09c+0x28+'px';}}tg?tg[_0x4eb503(0x1e0)](_0x4eb503(0x243),({isStateStable:_0x590909})=>{_0x2fa376();if(_0x590909)requestAnimationFrame(()=>{const _0xb5ce3f=a0_0xbbb7;_0x5d81d5[_0xb5ce3f(0x218)]=_0x5d81d5['scrollHeight'];});}):window['addEventListener']('resize',_0x2fa376),_0x2fa376(),_0x12109b&&(_0x12109b[_0x4eb503(0x1ee)](_0x4eb503(0x22d),()=>{requestAnimationFrame(_0x2fa376);}),_0x12109b[_0x4eb503(0x1ee)]('focus',()=>{setTimeout(()=>{const _0x3ca994=a0_0xbbb7;_0x5d81d5[_0x3ca994(0x218)]=_0x5d81d5['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());function a0_0x594b(){const _0x426b98=['BackButton','now','innerHeight','length','message-bubble','modalText','value','key','Ошибка\x20сервера','textContent','setItem','setHeaderColor','className','target','none','paddingBottom','1990650lVRxxj','splice','HapticFeedback','children','10LmwKRd','disableVerticalSwipes','classList','2463741iiMyHE','touchend','light','success','show','onEvent','Enter','./router.html','style','forEach','text','json','Ошибка\x20сети','chatArea','debug_uid','getHours','querySelectorAll','ai_chat_messages','Telegram','addEventListener','push','initData','.container','ready','function','expand','floor','4850944UwTFlf','touchstart','onclick','inputArea','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','contains','height','TG\x20setup\x20error:','emptyState','preventDefault','WebApp','367953vBdOiL','constructor','add','modalTitle','viewportHeight','replace','remove','getItem','<br>','stringify','message-time','role','click','search','offsetHeight','stopPropagation','random','signal','content','scrollHeight','6.1','724834KLGkkA','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','scrollTop','message\x20','impactOccurred','username','Удалить?','8vHiKIb','medium','modalCancel','show-delete','parse','modalConfirm','onClick','getElementById','634255aCpBtf','first_name','notificationOccurred','170RLRUOB','auto','trim','(((.+)+)+)+$','Очистить\x20историю?','input','8TuLZBo','typingIndicator','sendBtn','toString','div','createElement','857780bRBaVq','user','.message.show-delete','appendChild','disabled','querySelector','initDataUnsafe','#050505','min','padStart','apply','display','href','removeItem','offClick','viewportChanged','error','messageInput','warn','innerHTML'];a0_0x594b=function(){return _0x426b98;};return a0_0x594b();}const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x3c8c5e(0x1e8)),emptyState=document[a0_0x3c8c5e(0x224)]('emptyState'),messageInput=document[a0_0x3c8c5e(0x224)]('messageInput'),sendBtn=document[a0_0x3c8c5e(0x224)](a0_0x3c8c5e(0x230)),clearBtn=document[a0_0x3c8c5e(0x224)]('clearBtn'),modal=document[a0_0x3c8c5e(0x224)]('confirmModal'),mTitle=document[a0_0x3c8c5e(0x224)](a0_0x3c8c5e(0x204)),mText=document['getElementById'](a0_0x3c8c5e(0x24d));let modalCallback=null;async function callBackend(_0x1b6e8d,_0x4fb757){const _0x379822=a0_0x3c8c5e,_0x1544ab=tg?.[_0x379822(0x23a)]?.[_0x379822(0x235)]||{},_0x442f3b=_0x1544ab['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x379822(0x1f5)](Math[_0x379822(0x211)]()*0x3b9aca00);if(!_0x1544ab['id'])localStorage['setItem'](_0x379822(0x1e9),_0x442f3b);const _0x1948bb={'action':_0x1b6e8d,'user_id':_0x442f3b,'user_data':{'first_name':_0x1544ab[_0x379822(0x226)],'username':_0x1544ab[_0x379822(0x21b)]},'init_data':tg?.[_0x379822(0x1f0)]||'',..._0x4fb757},_0x54f6fd=new AbortController(),_0x1486b5=setTimeout(()=>_0x54f6fd['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3ac2c1=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x1948bb),'signal':_0x54f6fd[_0x379822(0x212)]});return clearTimeout(_0x1486b5),await _0x3ac2c1[_0x379822(0x1e6)]();}catch(_0x1b9765){return{'success':![],'error':String(_0x1b9765)};}}function formatTime(_0x4a8be3){const _0x99a469=a0_0x3c8c5e,_0x37edd2=new Date(_0x4a8be3);return String(_0x37edd2[_0x99a469(0x1ea)]())[_0x99a469(0x23d)](0x2,'0')+':'+String(_0x37edd2['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x24506a,_0x1a514){const _0x17cce5=a0_0x3c8c5e,_0xb1ab76=document[_0x17cce5(0x233)](_0x17cce5(0x232));_0xb1ab76[_0x17cce5(0x254)]=_0x17cce5(0x219)+_0x24506a[_0x17cce5(0x20c)];const _0x51a79f=document[_0x17cce5(0x233)](_0x17cce5(0x232));_0x51a79f[_0x17cce5(0x254)]=_0x17cce5(0x24c),_0x51a79f['innerHTML']=_0x24506a[_0x17cce5(0x213)][_0x17cce5(0x206)](/\n/g,_0x17cce5(0x209));const _0x5f587c=document[_0x17cce5(0x233)](_0x17cce5(0x232));_0x5f587c[_0x17cce5(0x254)]='delete-btn',_0x5f587c[_0x17cce5(0x247)]=_0x17cce5(0x217),_0x5f587c[_0x17cce5(0x1f8)]=_0x1db927=>{const _0x45e8d9=_0x17cce5;_0x1db927[_0x45e8d9(0x210)](),confirmDelete(_0x1a514);};let _0x18e9f2;_0x51a79f[_0x17cce5(0x1ee)](_0x17cce5(0x1f7),()=>_0x18e9f2=setTimeout(()=>{const _0x5c8a76=_0x17cce5;_0xb1ab76[_0x5c8a76(0x1da)][_0x5c8a76(0x203)](_0x5c8a76(0x220));if(tg?.[_0x5c8a76(0x1d6)])tg[_0x5c8a76(0x1d6)]['impactOccurred'](_0x5c8a76(0x21e));},0x1f4)),_0x51a79f[_0x17cce5(0x1ee)](_0x17cce5(0x1dc),()=>clearTimeout(_0x18e9f2));const _0x454c4f=document[_0x17cce5(0x233)]('div');return _0x454c4f[_0x17cce5(0x254)]=_0x17cce5(0x20b),_0x454c4f[_0x17cce5(0x251)]=formatTime(_0x24506a['timestamp']),_0xb1ab76[_0x17cce5(0x237)](_0x5f587c),_0xb1ab76[_0x17cce5(0x237)](_0x51a79f),_0xb1ab76[_0x17cce5(0x237)](_0x454c4f),_0xb1ab76;}function createTypingIndicator(){const _0x209a3e=a0_0x3c8c5e,_0x31b860=document[_0x209a3e(0x233)]('div');return _0x31b860['className']='message\x20ai',_0x31b860['id']='typingIndicator',_0x31b860['innerHTML']=_0x209a3e(0x1fa),_0x31b860;}function renderMessages(){const _0x232281=a0_0x3c8c5e;Array['from'](chatArea[_0x232281(0x1d7)])[_0x232281(0x1e4)](_0x3f4570=>{const _0x43e968=_0x232281;if(_0x3f4570['id']!==_0x43e968(0x1fe))_0x3f4570[_0x43e968(0x207)]();}),messages[_0x232281(0x24b)]>0x0?(emptyState['style'][_0x232281(0x23f)]=_0x232281(0x1d2),messages[_0x232281(0x1e4)]((_0x209cb0,_0x56e4c5)=>chatArea[_0x232281(0x237)](createMessageElement(_0x209cb0,_0x56e4c5)))):emptyState[_0x232281(0x1e3)][_0x232281(0x23f)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x232281(0x214)]);}function autoResizeTextarea(){const _0x411a50=a0_0x3c8c5e;messageInput[_0x411a50(0x1e3)][_0x411a50(0x1fc)]=_0x411a50(0x229),messageInput[_0x411a50(0x1e3)][_0x411a50(0x1fc)]=Math[_0x411a50(0x23c)](messageInput[_0x411a50(0x214)],0x78)+'px';}function updateSendButton(){const _0x3f960b=a0_0x3c8c5e,_0x27f3fb=messageInput[_0x3f960b(0x24e)][_0x3f960b(0x22a)]();sendBtn[_0x3f960b(0x238)]=!_0x27f3fb||isTyping;}async function sendMessage(){const _0x5dac72=a0_0x3c8c5e,_0x3316a4=messageInput[_0x5dac72(0x24e)][_0x5dac72(0x22a)]();if(!_0x3316a4||isTyping)return;if(tg?.[_0x5dac72(0x1d6)])tg['HapticFeedback']['impactOccurred'](_0x5dac72(0x1dd));messages['push']({'role':'user','content':_0x3316a4,'timestamp':Date[_0x5dac72(0x249)]()}),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5dac72(0x237)](createTypingIndicator()),chatArea[_0x5dac72(0x218)]=chatArea['scrollHeight'];const _0x5010c4=await callBackend('send_message',{'message':_0x3316a4});isTyping=![];const _0x13ef11=document[_0x5dac72(0x224)](_0x5dac72(0x22f));if(_0x13ef11)_0x13ef11[_0x5dac72(0x207)]();let _0x21cf09=_0x5dac72(0x1e7);if(_0x5010c4[_0x5dac72(0x1de)]){_0x21cf09=_0x5010c4[_0x5dac72(0x1e5)]||'Пустой\x20ответ';if(tg?.[_0x5dac72(0x1d6)])tg[_0x5dac72(0x1d6)][_0x5dac72(0x227)](_0x5dac72(0x1de));}else{_0x21cf09=_0x5010c4['error']||_0x5dac72(0x250);if(tg?.[_0x5dac72(0x1d6)])tg[_0x5dac72(0x1d6)][_0x5dac72(0x227)](_0x5dac72(0x244));}messages[_0x5dac72(0x1ef)]({'role':'ai','content':_0x21cf09,'timestamp':Date[_0x5dac72(0x249)]()}),localStorage[_0x5dac72(0x252)]('ai_chat_messages',JSON[_0x5dac72(0x20a)](messages)),renderMessages();}function confirmDelete(_0x19b353){const _0x2e763c=a0_0x3c8c5e;if(mTitle)mTitle[_0x2e763c(0x251)]=_0x2e763c(0x21c);if(mText)mText[_0x2e763c(0x251)]='Действие\x20необратимо.';modalCallback=()=>{const _0x53ffe8=_0x2e763c;messages[_0x53ffe8(0x1d5)](_0x19b353,0x1),localStorage[_0x53ffe8(0x252)]('ai_chat_messages',JSON[_0x53ffe8(0x20a)](messages)),renderMessages();},modal[_0x2e763c(0x1da)]['add'](_0x2e763c(0x1df));}if(clearBtn)clearBtn[a0_0x3c8c5e(0x1f8)]=()=>{const _0x536132=a0_0x3c8c5e;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x536132(0x22c);if(mText)mText[_0x536132(0x251)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x5448fc=_0x536132;messages=[],localStorage[_0x5448fc(0x241)](_0x5448fc(0x1ec)),renderMessages(),callBackend('clear_history',{});},modal[_0x536132(0x1da)][_0x536132(0x203)]('show');};document[a0_0x3c8c5e(0x224)](a0_0x3c8c5e(0x21f))[a0_0x3c8c5e(0x1f8)]=()=>modal['classList']['remove']('show'),document[a0_0x3c8c5e(0x224)](a0_0x3c8c5e(0x222))[a0_0x3c8c5e(0x1f8)]=()=>{const _0x5ae803=a0_0x3c8c5e;if(modalCallback)modalCallback();modal['classList'][_0x5ae803(0x207)]('show');},messageInput[a0_0x3c8c5e(0x1ee)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x22ba17=>{const _0x5a4438=a0_0x3c8c5e;_0x22ba17[_0x5a4438(0x24f)]===_0x5a4438(0x1e1)&&!_0x22ba17['shiftKey']&&(_0x22ba17[_0x5a4438(0x1ff)](),sendMessage());}),sendBtn[a0_0x3c8c5e(0x1f8)]=sendMessage,document[a0_0x3c8c5e(0x1ee)](a0_0x3c8c5e(0x20d),_0x11ac2c=>{const _0x4ac080=a0_0x3c8c5e;document[_0x4ac080(0x1eb)](_0x4ac080(0x236))[_0x4ac080(0x1e4)](_0x3ba0a5=>{const _0x66678b=_0x4ac080;if(!_0x3ba0a5[_0x66678b(0x1fb)](_0x11ac2c[_0x66678b(0x255)]))_0x3ba0a5[_0x66678b(0x1da)][_0x66678b(0x207)](_0x66678b(0x220));});});const saved=localStorage[a0_0x3c8c5e(0x208)](a0_0x3c8c5e(0x1ec));if(saved)try{messages=JSON[a0_0x3c8c5e(0x221)](saved),renderMessages();}catch(a0_0x11c8a4){}function a0_0xbbb7(_0x946bc5,_0x82f3ec){_0x946bc5=_0x946bc5-0x1d2;const _0x47f95f=a0_0x594b();let _0x168766=_0x47f95f[_0x946bc5];return _0x168766;}updateSendButton();