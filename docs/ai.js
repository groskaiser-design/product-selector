const a0_0x3c2c44=a0_0x3824;function a0_0x2d63(){const _0xc848fd=['inputArea','div','Очистить\x20историю?','ready','chatArea','function','from','text','forEach','4815896uPhsyj','5570415BIfnsB','createElement','remove','offsetHeight','textContent','flex','target','6.1','padStart','signal','Enter','Действие\x20необратимо.','offClick','getElementById','auto','shiftKey','json','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','message\x20ai','key','click','confirmModal','setItem','timestamp','viewportHeight','role','messageInput','Ошибка\x20сети','now','impactOccurred','message-time','1SoUYIG','TG\x20setup\x20error:','display','scrollHeight','search','Telegram','1808349GvqgQx','warn','message\x20','resize','stringify','show-delete','style','appendChild','className','abort','light','.container','length','show','push','45nyQaYA','toString','querySelector','error','289212wyqVLv','onclick','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','setHeaderColor','contains','41267190yuYCgt','onEvent','children','splice','first_name','clearBtn','<br>','2774482WiQhJE','(((.+)+)+)+$','debug_uid','classList','min','input','send_message','.message.show-delete','apply','modalTitle','removeItem','message-bubble','trim','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','add','height','querySelectorAll','href','disableVerticalSwipes','paddingBottom','value','#050505','getItem','ai_chat_messages','user','expand','text/plain','getMinutes','scrollTop','delete-btn','parse','disabled','content','notificationOccurred','emptyState','viewportChanged','touchend','Удалить?','Начнется\x20новый\x20диалог.','HapticFeedback','innerHTML','48WCcRqI','keydown','635850OapNXB','Ошибка\x20сервера','addEventListener','typingIndicator'];a0_0x2d63=function(){return _0xc848fd;};return a0_0x2d63();}(function(_0x47daf1,_0x25ebd5){const _0x1e0d5b=a0_0x3824,_0x5b1b3b=_0x47daf1();while(!![]){try{const _0x56d3a6=parseInt(_0x1e0d5b(0x172))/0x1*(parseInt(_0x1e0d5b(0x197))/0x2)+parseInt(_0x1e0d5b(0x178))/0x3+parseInt(_0x1e0d5b(0x152))/0x4+parseInt(_0x1e0d5b(0x187))/0x5*(parseInt(_0x1e0d5b(0x145))/0x6)+-parseInt(_0x1e0d5b(0x18b))/0x7*(-parseInt(_0x1e0d5b(0x143))/0x8)+parseInt(_0x1e0d5b(0x153))/0x9+-parseInt(_0x1e0d5b(0x190))/0xa;if(_0x56d3a6===_0x25ebd5)break;else _0x5b1b3b['push'](_0x5b1b3b['shift']());}catch(_0x1492a2){_0x5b1b3b['push'](_0x5b1b3b['shift']());}}}(a0_0x2d63,0xd8c4d));const tg=window[a0_0x3c2c44(0x177)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x47667d=a0_0x3c2c44,_0x117465=(function(){let _0x2f33fc=!![];return function(_0x4108f9,_0x21ddd3){const _0x293944=_0x2f33fc?function(){const _0x1ee372=a0_0x3824;if(_0x21ddd3){const _0x3952ae=_0x21ddd3[_0x1ee372(0x19f)](_0x4108f9,arguments);return _0x21ddd3=null,_0x3952ae;}}:function(){};return _0x2f33fc=![],_0x293944;};}()),_0x4f06ea=_0x117465(this,function(){const _0x46537c=a0_0x3824;return _0x4f06ea[_0x46537c(0x188)]()[_0x46537c(0x176)](_0x46537c(0x198))['toString']()['constructor'](_0x4f06ea)['search'](_0x46537c(0x198));});_0x4f06ea();if(!tg)return;try{tg[_0x47667d(0x14c)](),tg[_0x47667d(0x1b0)](),tg[_0x47667d(0x18e)]?.(_0x47667d(0x1ac));if(tg['isVersionAtLeast']?.(_0x47667d(0x15a)))tg[_0x47667d(0x1a9)]?.();const _0x5186fa=tg['BackButton'];if(_0x5186fa){_0x5186fa['show']();if(typeof _0x5186fa[_0x47667d(0x15f)]===_0x47667d(0x14e))try{_0x5186fa['offClick']();}catch(_0x3c15ca){}_0x5186fa['onClick'](()=>{const _0x22ed54=_0x47667d;if(tg[_0x22ed54(0x141)])tg[_0x22ed54(0x141)]['impactOccurred'](_0x22ed54(0x182));location[_0x22ed54(0x1a8)]=HOME_URL;});}}catch(_0xfb5673){console[_0x47667d(0x179)](_0x47667d(0x173),_0xfb5673);}}(function initStableLayout(){const _0x48cad4=a0_0x3c2c44,_0x3b5aee=document[_0x48cad4(0x189)](_0x48cad4(0x183)),_0xcbf118=document[_0x48cad4(0x160)](_0x48cad4(0x149)),_0x1d7bfe=document[_0x48cad4(0x160)](_0x48cad4(0x14d)),_0x4476c5=document['getElementById'](_0x48cad4(0x16d));function _0x67c34a(){const _0x493cfa=_0x48cad4;if(!_0x3b5aee)return;const _0x470366=tg&&tg[_0x493cfa(0x16b)]?tg['viewportHeight']:window['innerHeight'];_0x3b5aee['style']['height']=_0x470366+'px';if(_0xcbf118){const _0x4ba9ae=_0xcbf118[_0x493cfa(0x156)];_0x1d7bfe[_0x493cfa(0x17e)][_0x493cfa(0x1aa)]=_0x4ba9ae+0x28+'px';}}tg?tg[_0x48cad4(0x191)](_0x48cad4(0x13d),({isStateStable:_0x4c92db})=>{_0x67c34a();if(_0x4c92db)requestAnimationFrame(()=>{const _0x3c755f=a0_0x3824;_0x1d7bfe[_0x3c755f(0x136)]=_0x1d7bfe[_0x3c755f(0x175)];});}):window[_0x48cad4(0x147)](_0x48cad4(0x17b),_0x67c34a),_0x67c34a(),_0x4476c5&&(_0x4476c5[_0x48cad4(0x147)](_0x48cad4(0x19c),()=>{requestAnimationFrame(_0x67c34a);}),_0x4476c5[_0x48cad4(0x147)]('focus',()=>{setTimeout(()=>{const _0x28e055=a0_0x3824;_0x1d7bfe[_0x28e055(0x136)]=_0x1d7bfe['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3c2c44(0x164),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x3c2c44(0x14d)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x3c2c44(0x160)]('messageInput'),sendBtn=document[a0_0x3c2c44(0x160)]('sendBtn'),clearBtn=document[a0_0x3c2c44(0x160)](a0_0x3c2c44(0x195)),modal=document[a0_0x3c2c44(0x160)](a0_0x3c2c44(0x168)),mTitle=document[a0_0x3c2c44(0x160)](a0_0x3c2c44(0x1a0)),mText=document[a0_0x3c2c44(0x160)]('modalText');let modalCallback=null;async function callBackend(_0x56afe1,_0x2b2f9b){const _0x28716e=a0_0x3c2c44,_0x31b62c=tg?.['initDataUnsafe']?.[_0x28716e(0x1af)]||{},_0x17522f=_0x31b62c['id']||localStorage[_0x28716e(0x1ad)](_0x28716e(0x199))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x31b62c['id'])localStorage[_0x28716e(0x169)]('debug_uid',_0x17522f);const _0x27f31e={'action':_0x56afe1,'user_id':_0x17522f,'user_data':{'first_name':_0x31b62c[_0x28716e(0x194)],'username':_0x31b62c['username']},'init_data':tg?.['initData']||'',..._0x2b2f9b},_0x3ffc23=new AbortController(),_0xbfe6ad=setTimeout(()=>_0x3ffc23[_0x28716e(0x181)](),REQUEST_TIMEOUT_MS);try{const _0x3a82d0=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x28716e(0x1b1)},'body':JSON[_0x28716e(0x17c)](_0x27f31e),'signal':_0x3ffc23[_0x28716e(0x15c)]});return clearTimeout(_0xbfe6ad),await _0x3a82d0[_0x28716e(0x163)]();}catch(_0x5ca25f){return{'success':![],'error':String(_0x5ca25f)};}}function formatTime(_0x37ea04){const _0x3fcca2=a0_0x3c2c44,_0x386c43=new Date(_0x37ea04);return String(_0x386c43['getHours']())['padStart'](0x2,'0')+':'+String(_0x386c43[_0x3fcca2(0x135)]())[_0x3fcca2(0x15b)](0x2,'0');}function createMessageElement(_0x326c0d,_0x3375be){const _0xd8774b=a0_0x3c2c44,_0x4f3bf9=document[_0xd8774b(0x154)](_0xd8774b(0x14a));_0x4f3bf9[_0xd8774b(0x180)]=_0xd8774b(0x17a)+_0x326c0d[_0xd8774b(0x16c)];const _0xd495=document[_0xd8774b(0x154)](_0xd8774b(0x14a));_0xd495[_0xd8774b(0x180)]=_0xd8774b(0x1a2),_0xd495[_0xd8774b(0x142)]=_0x326c0d[_0xd8774b(0x13a)]['replace'](/\n/g,_0xd8774b(0x196));const _0x1ef053=document[_0xd8774b(0x154)](_0xd8774b(0x14a));_0x1ef053[_0xd8774b(0x180)]=_0xd8774b(0x137),_0x1ef053[_0xd8774b(0x142)]=_0xd8774b(0x18d),_0x1ef053[_0xd8774b(0x18c)]=_0x5c2144=>{_0x5c2144['stopPropagation'](),confirmDelete(_0x3375be);};let _0x1add52;_0xd495[_0xd8774b(0x147)]('touchstart',()=>_0x1add52=setTimeout(()=>{const _0x3c4410=_0xd8774b;_0x4f3bf9[_0x3c4410(0x19a)][_0x3c4410(0x1a5)](_0x3c4410(0x17d));if(tg?.[_0x3c4410(0x141)])tg[_0x3c4410(0x141)][_0x3c4410(0x170)]('medium');},0x1f4)),_0xd495['addEventListener'](_0xd8774b(0x13e),()=>clearTimeout(_0x1add52));const _0x55c6c=document[_0xd8774b(0x154)]('div');return _0x55c6c['className']=_0xd8774b(0x171),_0x55c6c[_0xd8774b(0x157)]=formatTime(_0x326c0d[_0xd8774b(0x16a)]),_0x4f3bf9[_0xd8774b(0x17f)](_0x1ef053),_0x4f3bf9[_0xd8774b(0x17f)](_0xd495),_0x4f3bf9[_0xd8774b(0x17f)](_0x55c6c),_0x4f3bf9;}function createTypingIndicator(){const _0x16a4cc=a0_0x3c2c44,_0x25503e=document[_0x16a4cc(0x154)](_0x16a4cc(0x14a));return _0x25503e[_0x16a4cc(0x180)]=_0x16a4cc(0x165),_0x25503e['id']=_0x16a4cc(0x148),_0x25503e[_0x16a4cc(0x142)]=_0x16a4cc(0x1a4),_0x25503e;}function renderMessages(){const _0x57df85=a0_0x3c2c44;Array[_0x57df85(0x14f)](chatArea[_0x57df85(0x192)])[_0x57df85(0x151)](_0x42e99f=>{const _0x24f8a7=_0x57df85;if(_0x42e99f['id']!==_0x24f8a7(0x13c))_0x42e99f['remove']();}),messages[_0x57df85(0x184)]>0x0?(emptyState[_0x57df85(0x17e)][_0x57df85(0x174)]='none',messages['forEach']((_0x29576d,_0x81fa5)=>chatArea[_0x57df85(0x17f)](createMessageElement(_0x29576d,_0x81fa5)))):emptyState[_0x57df85(0x17e)]['display']=_0x57df85(0x158),requestAnimationFrame(()=>chatArea[_0x57df85(0x136)]=chatArea[_0x57df85(0x175)]);}function autoResizeTextarea(){const _0x4b1d8f=a0_0x3c2c44;messageInput[_0x4b1d8f(0x17e)][_0x4b1d8f(0x1a6)]=_0x4b1d8f(0x161),messageInput[_0x4b1d8f(0x17e)]['height']=Math[_0x4b1d8f(0x19b)](messageInput[_0x4b1d8f(0x175)],0x78)+'px';}function a0_0x3824(_0xe9896f,_0x289f3c){_0xe9896f=_0xe9896f-0x135;const _0x4c1fb1=a0_0x2d63();let _0x1ccd5f=_0x4c1fb1[_0xe9896f];return _0x1ccd5f;}function updateSendButton(){const _0x5cf837=a0_0x3c2c44,_0x54df8e=messageInput[_0x5cf837(0x1ab)][_0x5cf837(0x1a3)]();sendBtn[_0x5cf837(0x139)]=!_0x54df8e||isTyping;}async function sendMessage(){const _0x47db63=a0_0x3c2c44,_0x29f5e4=messageInput[_0x47db63(0x1ab)][_0x47db63(0x1a3)]();if(!_0x29f5e4||isTyping)return;if(tg?.[_0x47db63(0x141)])tg[_0x47db63(0x141)][_0x47db63(0x170)](_0x47db63(0x182));messages[_0x47db63(0x186)]({'role':_0x47db63(0x1af),'content':_0x29f5e4,'timestamp':Date['now']()}),localStorage['setItem'](_0x47db63(0x1ae),JSON[_0x47db63(0x17c)](messages)),renderMessages(),messageInput[_0x47db63(0x1ab)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x47db63(0x17f)](createTypingIndicator()),chatArea[_0x47db63(0x136)]=chatArea[_0x47db63(0x175)];const _0x4f692a=await callBackend(_0x47db63(0x19d),{'message':_0x29f5e4});isTyping=![];const _0x44324c=document['getElementById'](_0x47db63(0x148));if(_0x44324c)_0x44324c['remove']();let _0x5d515e=_0x47db63(0x16e);if(_0x4f692a['success']){_0x5d515e=_0x4f692a[_0x47db63(0x150)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x47db63(0x13b)]('success');}else{_0x5d515e=_0x4f692a[_0x47db63(0x18a)]||_0x47db63(0x146);if(tg?.[_0x47db63(0x141)])tg[_0x47db63(0x141)]['notificationOccurred']('error');}messages[_0x47db63(0x186)]({'role':'ai','content':_0x5d515e,'timestamp':Date[_0x47db63(0x16f)]()}),localStorage[_0x47db63(0x169)](_0x47db63(0x1ae),JSON[_0x47db63(0x17c)](messages)),renderMessages();}function confirmDelete(_0x5cff10){const _0x360134=a0_0x3c2c44;if(mTitle)mTitle[_0x360134(0x157)]=_0x360134(0x13f);if(mText)mText[_0x360134(0x157)]=_0x360134(0x15e);modalCallback=()=>{const _0x16313a=_0x360134;messages[_0x16313a(0x193)](_0x5cff10,0x1),localStorage['setItem'](_0x16313a(0x1ae),JSON['stringify'](messages)),renderMessages();},modal[_0x360134(0x19a)]['add'](_0x360134(0x185));}if(clearBtn)clearBtn[a0_0x3c2c44(0x18c)]=()=>{const _0x2fb815=a0_0x3c2c44;if(!messages[_0x2fb815(0x184)])return;if(mTitle)mTitle[_0x2fb815(0x157)]=_0x2fb815(0x14b);if(mText)mText[_0x2fb815(0x157)]=_0x2fb815(0x140);modalCallback=async()=>{const _0x524e88=_0x2fb815;messages=[],localStorage[_0x524e88(0x1a1)](_0x524e88(0x1ae)),renderMessages(),callBackend('clear_history',{});},modal[_0x2fb815(0x19a)][_0x2fb815(0x1a5)](_0x2fb815(0x185));};document[a0_0x3c2c44(0x160)]('modalCancel')['onclick']=()=>modal['classList'][a0_0x3c2c44(0x155)](a0_0x3c2c44(0x185)),document[a0_0x3c2c44(0x160)]('modalConfirm')[a0_0x3c2c44(0x18c)]=()=>{const _0x447056=a0_0x3c2c44;if(modalCallback)modalCallback();modal[_0x447056(0x19a)][_0x447056(0x155)]('show');},messageInput[a0_0x3c2c44(0x147)](a0_0x3c2c44(0x19c),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x3c2c44(0x144),_0x450aa3=>{const _0xf5de13=a0_0x3c2c44;_0x450aa3[_0xf5de13(0x166)]===_0xf5de13(0x15d)&&!_0x450aa3[_0xf5de13(0x162)]&&(_0x450aa3['preventDefault'](),sendMessage());}),sendBtn[a0_0x3c2c44(0x18c)]=sendMessage,document[a0_0x3c2c44(0x147)](a0_0x3c2c44(0x167),_0x50f0c5=>{const _0x36e615=a0_0x3c2c44;document[_0x36e615(0x1a7)](_0x36e615(0x19e))[_0x36e615(0x151)](_0x241440=>{const _0x3f2e41=_0x36e615;if(!_0x241440[_0x3f2e41(0x18f)](_0x50f0c5[_0x3f2e41(0x159)]))_0x241440[_0x3f2e41(0x19a)]['remove'](_0x3f2e41(0x17d));});});const saved=localStorage[a0_0x3c2c44(0x1ad)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x3c2c44(0x138)](saved),renderMessages();}catch(a0_0x5322e7){}updateSendButton();