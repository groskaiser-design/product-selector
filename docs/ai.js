const a0_0x57fe8a=a0_0x28c9;(function(_0x34c2fe,_0x2cbab5){const _0x688a70=a0_0x28c9,_0x3c6256=_0x34c2fe();while(!![]){try{const _0x5bc2ad=parseInt(_0x688a70(0xe6))/0x1*(-parseInt(_0x688a70(0x100))/0x2)+-parseInt(_0x688a70(0x93))/0x3+-parseInt(_0x688a70(0x94))/0x4*(parseInt(_0x688a70(0xc7))/0x5)+parseInt(_0x688a70(0xc0))/0x6*(parseInt(_0x688a70(0xa4))/0x7)+-parseInt(_0x688a70(0x10e))/0x8*(parseInt(_0x688a70(0xf8))/0x9)+-parseInt(_0x688a70(0xbb))/0xa+parseInt(_0x688a70(0x112))/0xb;if(_0x5bc2ad===_0x2cbab5)break;else _0x3c6256['push'](_0x3c6256['shift']());}catch(_0x2004cc){_0x3c6256['push'](_0x3c6256['shift']());}}}(a0_0x1258,0x7a41d));const tg=window[a0_0x57fe8a(0xf3)]?.[a0_0x57fe8a(0xd3)],HOME_URL=a0_0x57fe8a(0x97);function setupTelegramBackButton(){const _0x11cea7=a0_0x57fe8a;if(!tg)return;try{tg[_0x11cea7(0xf0)](),tg[_0x11cea7(0x9d)](),tg[_0x11cea7(0xfa)]?.(_0x11cea7(0xb0));if(tg[_0x11cea7(0xfb)]?.(_0x11cea7(0xcf)))tg['disableVerticalSwipes']?.();const _0x5eb1a0=tg[_0x11cea7(0xc3)];if(_0x5eb1a0){_0x5eb1a0['show']();if(typeof _0x5eb1a0[_0x11cea7(0xa1)]==='function')try{_0x5eb1a0[_0x11cea7(0xa1)]();}catch(_0x3aca2d){}_0x5eb1a0[_0x11cea7(0x111)](()=>{const _0x50eada=_0x11cea7;if(tg['HapticFeedback'])tg[_0x50eada(0x9c)][_0x50eada(0xa7)](_0x50eada(0xf1));location[_0x50eada(0x9a)]=HOME_URL;});}}catch(_0x19e80b){console['warn'](_0x11cea7(0x9e),_0x19e80b);}}(function initStableLayout(){const _0x4ff9aa=a0_0x57fe8a,_0x42022e=(function(){let _0x54bb33=!![];return function(_0x378165,_0x42330a){const _0x2760ca=_0x54bb33?function(){if(_0x42330a){const _0x514e1a=_0x42330a['apply'](_0x378165,arguments);return _0x42330a=null,_0x514e1a;}}:function(){};return _0x54bb33=![],_0x2760ca;};}()),_0x3fc2a5=document['querySelector'](_0x4ff9aa(0xd2)),_0x31775b=document['getElementById'](_0x4ff9aa(0xe4)),_0x4ad36c=document['getElementById'](_0x4ff9aa(0xab)),_0x84beab=document[_0x4ff9aa(0x118)](_0x4ff9aa(0xaa));function _0x26fdde(){const _0x9864f1=_0x4ff9aa,_0x324ac6=_0x42022e(this,function(){const _0x5b3c84=a0_0x28c9;return _0x324ac6['toString']()[_0x5b3c84(0x106)]('(((.+)+)+)+$')[_0x5b3c84(0x114)]()['constructor'](_0x324ac6)['search'](_0x5b3c84(0xf4));});_0x324ac6();if(!_0x3fc2a5)return;const _0x511810=tg&&tg[_0x9864f1(0xb8)]?tg[_0x9864f1(0xb8)]:window[_0x9864f1(0xd5)];_0x3fc2a5[_0x9864f1(0xc2)][_0x9864f1(0xca)]=_0x511810+'px';if(_0x31775b){const _0x570389=_0x31775b[_0x9864f1(0xad)];_0x4ad36c[_0x9864f1(0xc2)][_0x9864f1(0xce)]=_0x570389+0x28+'px';}}tg?tg[_0x4ff9aa(0xee)](_0x4ff9aa(0xed),({isStateStable:_0x558c52})=>{_0x26fdde();if(_0x558c52)requestAnimationFrame(()=>{const _0x3beb3f=a0_0x28c9;_0x4ad36c[_0x3beb3f(0xcb)]=_0x4ad36c['scrollHeight'];});}):window['addEventListener']('resize',_0x26fdde),_0x26fdde(),_0x84beab&&(_0x84beab[_0x4ff9aa(0xb7)]('input',()=>{requestAnimationFrame(_0x26fdde);}),_0x84beab['addEventListener'](_0x4ff9aa(0xdd),()=>{setTimeout(()=>{const _0x4bab3a=a0_0x28c9;_0x4ad36c[_0x4bab3a(0xcb)]=_0x4ad36c[_0x4bab3a(0xb4)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x57fe8a(0x10c),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x28c9(_0x31e955,_0x2603f1){_0x31e955=_0x31e955-0x92;const _0x1df5b5=a0_0x1258();let _0x4b24db=_0x1df5b5[_0x31e955];return _0x4b24db;}let messages=[],isTyping=![];const chatArea=document[a0_0x57fe8a(0x118)]('chatArea'),emptyState=document[a0_0x57fe8a(0x118)](a0_0x57fe8a(0xe9)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x57fe8a(0x118)](a0_0x57fe8a(0xf7)),clearBtn=document[a0_0x57fe8a(0x118)](a0_0x57fe8a(0xa3)),modal=document['getElementById'](a0_0x57fe8a(0xe1)),mTitle=document[a0_0x57fe8a(0x118)](a0_0x57fe8a(0xe8)),mText=document[a0_0x57fe8a(0x118)](a0_0x57fe8a(0xc4));let modalCallback=null;async function callBackend(_0x421053,_0xc9964e){const _0x4db08e=a0_0x57fe8a,_0x1ba7e8=tg?.[_0x4db08e(0xdf)]?.['user']||{},_0x423050=_0x1ba7e8['id']||localStorage['getItem'](_0x4db08e(0x102))||'d-'+Math[_0x4db08e(0xb9)](Math[_0x4db08e(0x99)]()*0x3b9aca00);if(!_0x1ba7e8['id'])localStorage[_0x4db08e(0x9b)](_0x4db08e(0x102),_0x423050);const _0x5d0e97={'action':_0x421053,'user_id':_0x423050,'user_data':{'first_name':_0x1ba7e8[_0x4db08e(0xfc)],'username':_0x1ba7e8[_0x4db08e(0xb2)]},'init_data':tg?.[_0x4db08e(0xf5)]||'',..._0xc9964e},_0x2afb58=new AbortController(),_0x1fac2f=setTimeout(()=>_0x2afb58[_0x4db08e(0xd7)](),REQUEST_TIMEOUT_MS);try{const _0x37f037=await fetch(BACKEND_URL,{'method':_0x4db08e(0xa9),'headers':{'Content-Type':_0x4db08e(0xd0)},'body':JSON[_0x4db08e(0x107)](_0x5d0e97),'signal':_0x2afb58[_0x4db08e(0x103)]});return clearTimeout(_0x1fac2f),await _0x37f037[_0x4db08e(0xe3)]();}catch(_0x5690d7){return{'success':![],'error':String(_0x5690d7)};}}function formatTime(_0x31681e){const _0x1ee025=a0_0x57fe8a,_0x5960b7=new Date(_0x31681e);return String(_0x5960b7[_0x1ee025(0xdb)]())[_0x1ee025(0x116)](0x2,'0')+':'+String(_0x5960b7[_0x1ee025(0x96)]())[_0x1ee025(0x116)](0x2,'0');}function createMessageElement(_0x4289a3,_0x392d16){const _0x121e32=a0_0x57fe8a,_0x2a67c5=document['createElement'](_0x121e32(0xcc));_0x2a67c5[_0x121e32(0xdc)]=_0x121e32(0xea)+_0x4289a3[_0x121e32(0xb6)];const _0x19eb20=document[_0x121e32(0xba)](_0x121e32(0xcc));_0x19eb20[_0x121e32(0xdc)]=_0x121e32(0xe0),_0x19eb20[_0x121e32(0x117)]=_0x4289a3['content'][_0x121e32(0xcd)](/\n/g,_0x121e32(0xae));const _0x5cb8a0=document['createElement'](_0x121e32(0xcc));_0x5cb8a0[_0x121e32(0xdc)]=_0x121e32(0xe7),_0x5cb8a0[_0x121e32(0x117)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x5cb8a0['onclick']=_0x14b50c=>{const _0x43e047=_0x121e32;_0x14b50c[_0x43e047(0xd4)](),confirmDelete(_0x392d16);};let _0x4ede02;_0x19eb20['addEventListener'](_0x121e32(0xf9),()=>_0x4ede02=setTimeout(()=>{const _0x3d8934=_0x121e32;_0x2a67c5[_0x3d8934(0x109)]['add'](_0x3d8934(0xbf));if(tg?.['HapticFeedback'])tg[_0x3d8934(0x9c)][_0x3d8934(0xa7)](_0x3d8934(0xc1));},0x1f4)),_0x19eb20['addEventListener'](_0x121e32(0xc5),()=>clearTimeout(_0x4ede02));const _0x1a137e=document[_0x121e32(0xba)](_0x121e32(0xcc));return _0x1a137e[_0x121e32(0xdc)]=_0x121e32(0xe5),_0x1a137e['textContent']=formatTime(_0x4289a3[_0x121e32(0xa8)]),_0x2a67c5[_0x121e32(0x95)](_0x5cb8a0),_0x2a67c5[_0x121e32(0x95)](_0x19eb20),_0x2a67c5['appendChild'](_0x1a137e),_0x2a67c5;}function createTypingIndicator(){const _0x58852f=a0_0x57fe8a,_0x53fc74=document[_0x58852f(0xba)](_0x58852f(0xcc));return _0x53fc74[_0x58852f(0xdc)]=_0x58852f(0x9f),_0x53fc74['id']=_0x58852f(0xeb),_0x53fc74[_0x58852f(0x117)]=_0x58852f(0xb1),_0x53fc74;}function renderMessages(){const _0x2f08d4=a0_0x57fe8a;Array[_0x2f08d4(0xef)](chatArea['children'])[_0x2f08d4(0xac)](_0x45b99a=>{const _0x29775d=_0x2f08d4;if(_0x45b99a['id']!==_0x29775d(0xe9))_0x45b99a[_0x29775d(0x110)]();}),messages[_0x2f08d4(0xa2)]>0x0?(emptyState[_0x2f08d4(0xc2)][_0x2f08d4(0xbe)]=_0x2f08d4(0xc9),messages[_0x2f08d4(0xac)]((_0x3ce561,_0x323dd1)=>chatArea[_0x2f08d4(0x95)](createMessageElement(_0x3ce561,_0x323dd1)))):emptyState[_0x2f08d4(0xc2)][_0x2f08d4(0xbe)]=_0x2f08d4(0xf2),requestAnimationFrame(()=>chatArea[_0x2f08d4(0xcb)]=chatArea[_0x2f08d4(0xb4)]);}function autoResizeTextarea(){const _0x4ba014=a0_0x57fe8a;messageInput[_0x4ba014(0xc2)]['height']=_0x4ba014(0xb5),messageInput['style'][_0x4ba014(0xca)]=Math[_0x4ba014(0xe2)](messageInput[_0x4ba014(0xb4)],0x78)+'px';}function updateSendButton(){const _0x2e9454=a0_0x57fe8a,_0x59d12f=messageInput[_0x2e9454(0x10f)]['trim']();sendBtn[_0x2e9454(0x113)]=!_0x59d12f||isTyping;}async function sendMessage(){const _0xea75c9=a0_0x57fe8a,_0x181191=messageInput[_0xea75c9(0x10f)][_0xea75c9(0xec)]();if(!_0x181191||isTyping)return;if(tg?.[_0xea75c9(0x9c)])tg[_0xea75c9(0x9c)][_0xea75c9(0xa7)]('light');messages['push']({'role':'user','content':_0x181191,'timestamp':Date[_0xea75c9(0xb3)]()}),localStorage[_0xea75c9(0x9b)]('ai_chat_messages',JSON[_0xea75c9(0x107)](messages)),renderMessages(),messageInput[_0xea75c9(0x10f)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xea75c9(0x95)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0xea75c9(0xb4)];const _0x52b72b=await callBackend(_0xea75c9(0xde),{'message':_0x181191});isTyping=![];const _0x1f4364=document[_0xea75c9(0x118)]('typingIndicator');if(_0x1f4364)_0x1f4364['remove']();let _0x2e3663='Ошибка\x20сети';if(_0x52b72b[_0xea75c9(0x92)]){_0x2e3663=_0x52b72b[_0xea75c9(0xaf)]||'Пустой\x20ответ';if(tg?.[_0xea75c9(0x9c)])tg[_0xea75c9(0x9c)][_0xea75c9(0xd1)](_0xea75c9(0x92));}else{_0x2e3663=_0x52b72b[_0xea75c9(0x119)]||'Ошибка\x20сервера';if(tg?.[_0xea75c9(0x9c)])tg[_0xea75c9(0x9c)]['notificationOccurred'](_0xea75c9(0x119));}messages[_0xea75c9(0x10d)]({'role':'ai','content':_0x2e3663,'timestamp':Date['now']()}),localStorage['setItem'](_0xea75c9(0xc8),JSON['stringify'](messages)),renderMessages();}function a0_0x1258(){const _0x2e477b=['signal','keydown','parse','search','stringify','querySelectorAll','classList','preventDefault','textContent','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','push','1104216MuzZHD','value','remove','onClick','32425899TPlItz','disabled','toString','clear_history','padStart','innerHTML','getElementById','error','success','1923870dqXTce','9496QCEjmS','appendChild','getMinutes','./router.html','removeItem','random','href','setItem','HapticFeedback','expand','TG\x20setup\x20error:','message\x20ai','onclick','offClick','length','clearBtn','42ElZGBI','Действие\x20необратимо.','key','impactOccurred','timestamp','POST','messageInput','chatArea','forEach','offsetHeight','<br>','text','#050505','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','username','now','scrollHeight','auto','role','addEventListener','viewportHeight','floor','createElement','4384030BeKyii','click','Очистить\x20историю?','display','show-delete','500598coCeQR','medium','style','BackButton','modalText','touchend','show','1390ijTKNO','ai_chat_messages','none','height','scrollTop','div','replace','paddingBottom','6.1','text/plain','notificationOccurred','.container','WebApp','stopPropagation','innerHeight','splice','abort','.message.show-delete','Enter','target','getHours','className','focus','send_message','initDataUnsafe','message-bubble','confirmModal','min','json','inputArea','message-time','3icJCjw','delete-btn','modalTitle','emptyState','message\x20','typingIndicator','trim','viewportChanged','onEvent','from','ready','light','flex','Telegram','(((.+)+)+)+$','initData','getItem','sendBtn','36zfIREk','touchstart','setHeaderColor','isVersionAtLeast','first_name','modalConfirm','add','Удалить?','437246NOchbu','input','debug_uid'];a0_0x1258=function(){return _0x2e477b;};return a0_0x1258();}function confirmDelete(_0xe68c72){const _0x3b7bcd=a0_0x57fe8a;if(mTitle)mTitle['textContent']=_0x3b7bcd(0xff);if(mText)mText[_0x3b7bcd(0x10b)]=_0x3b7bcd(0xa5);modalCallback=()=>{const _0x1802b2=_0x3b7bcd;messages[_0x1802b2(0xd6)](_0xe68c72,0x1),localStorage['setItem'](_0x1802b2(0xc8),JSON['stringify'](messages)),renderMessages();},modal[_0x3b7bcd(0x109)][_0x3b7bcd(0xfe)](_0x3b7bcd(0xc6));}if(clearBtn)clearBtn[a0_0x57fe8a(0xa0)]=()=>{const _0x44865f=a0_0x57fe8a;if(!messages[_0x44865f(0xa2)])return;if(mTitle)mTitle[_0x44865f(0x10b)]=_0x44865f(0xbd);if(mText)mText[_0x44865f(0x10b)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x550ec5=_0x44865f;messages=[],localStorage[_0x550ec5(0x98)]('ai_chat_messages'),renderMessages(),callBackend(_0x550ec5(0x115),{});},modal[_0x44865f(0x109)][_0x44865f(0xfe)](_0x44865f(0xc6));};document['getElementById']('modalCancel')['onclick']=()=>modal[a0_0x57fe8a(0x109)]['remove'](a0_0x57fe8a(0xc6)),document[a0_0x57fe8a(0x118)](a0_0x57fe8a(0xfd))[a0_0x57fe8a(0xa0)]=()=>{const _0x2428ab=a0_0x57fe8a;if(modalCallback)modalCallback();modal[_0x2428ab(0x109)][_0x2428ab(0x110)](_0x2428ab(0xc6));},messageInput[a0_0x57fe8a(0xb7)](a0_0x57fe8a(0x101),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x57fe8a(0xb7)](a0_0x57fe8a(0x104),_0x32e2bc=>{const _0x302d19=a0_0x57fe8a;_0x32e2bc[_0x302d19(0xa6)]===_0x302d19(0xd9)&&!_0x32e2bc['shiftKey']&&(_0x32e2bc[_0x302d19(0x10a)](),sendMessage());}),sendBtn[a0_0x57fe8a(0xa0)]=sendMessage,document[a0_0x57fe8a(0xb7)](a0_0x57fe8a(0xbc),_0x3f0d46=>{const _0x2a90f4=a0_0x57fe8a;document[_0x2a90f4(0x108)](_0x2a90f4(0xd8))[_0x2a90f4(0xac)](_0x5aa56f=>{const _0x4c9c99=_0x2a90f4;if(!_0x5aa56f['contains'](_0x3f0d46[_0x4c9c99(0xda)]))_0x5aa56f['classList'][_0x4c9c99(0x110)]('show-delete');});});const saved=localStorage[a0_0x57fe8a(0xf6)](a0_0x57fe8a(0xc8));if(saved)try{messages=JSON[a0_0x57fe8a(0x105)](saved),renderMessages();}catch(a0_0x3d5374){}updateSendButton();