const a0_0x2f5c98=a0_0x1130;(function(_0x48b470,_0x431e85){const _0x461fa2=a0_0x1130,_0x474a30=_0x48b470();while(!![]){try{const _0x3f309b=parseInt(_0x461fa2(0x183))/0x1+parseInt(_0x461fa2(0x19f))/0x2+parseInt(_0x461fa2(0x16d))/0x3*(parseInt(_0x461fa2(0x1ba))/0x4)+-parseInt(_0x461fa2(0x17c))/0x5+parseInt(_0x461fa2(0x154))/0x6+parseInt(_0x461fa2(0x1af))/0x7*(parseInt(_0x461fa2(0x1ab))/0x8)+parseInt(_0x461fa2(0x1a3))/0x9*(-parseInt(_0x461fa2(0x1c5))/0xa);if(_0x3f309b===_0x431e85)break;else _0x474a30['push'](_0x474a30['shift']());}catch(_0xc0c6e7){_0x474a30['push'](_0x474a30['shift']());}}}(a0_0x53b4,0x8e250));const tg=window['Telegram']?.[a0_0x2f5c98(0x167)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x35f0e7=a0_0x2f5c98;if(!tg)return;try{tg[_0x35f0e7(0x1ad)](),tg[_0x35f0e7(0x196)](),tg[_0x35f0e7(0x15f)]?.(_0x35f0e7(0x16b));if(tg['isVersionAtLeast']?.(_0x35f0e7(0x191)))tg['disableVerticalSwipes']?.();const _0x179368=tg[_0x35f0e7(0x190)];if(_0x179368){_0x179368[_0x35f0e7(0x186)]();if(typeof _0x179368['offClick']===_0x35f0e7(0x176))try{_0x179368[_0x35f0e7(0x18f)]();}catch(_0x51e9c1){}_0x179368[_0x35f0e7(0x1b5)](()=>{const _0x2ab6e1=_0x35f0e7;if(tg[_0x2ab6e1(0x1a6)])tg['HapticFeedback']['impactOccurred'](_0x2ab6e1(0x1b2));location[_0x2ab6e1(0x1a7)]=HOME_URL;});}}catch(_0x518b0a){console[_0x35f0e7(0x153)](_0x35f0e7(0x17a),_0x518b0a);}}(function initStableLayout(){const _0x286ba6=a0_0x2f5c98,_0x1c0b27=(function(){let _0x45ff48=!![];return function(_0x504b91,_0x4d2a68){const _0xdcbda2=_0x45ff48?function(){if(_0x4d2a68){const _0x2cbd23=_0x4d2a68['apply'](_0x504b91,arguments);return _0x4d2a68=null,_0x2cbd23;}}:function(){};return _0x45ff48=![],_0xdcbda2;};}()),_0x2dff64=document['querySelector'](_0x286ba6(0x1c6)),_0x93226f=document[_0x286ba6(0x19d)](_0x286ba6(0x16a)),_0x8156fe=document['getElementById'](_0x286ba6(0x193)),_0x5e2e19=document[_0x286ba6(0x19d)](_0x286ba6(0x18c));function _0x4058fc(){const _0xe601e6=_0x286ba6,_0x398b84=_0x1c0b27(this,function(){const _0xcbccda=a0_0x1130;return _0x398b84[_0xcbccda(0x181)]()['search']('(((.+)+)+)+$')['toString']()[_0xcbccda(0x15b)](_0x398b84)[_0xcbccda(0x1c0)]('(((.+)+)+)+$');});_0x398b84();if(!_0x2dff64)return;const _0x22ca11=tg&&tg[_0xe601e6(0x1c8)]?tg[_0xe601e6(0x1c8)]:window[_0xe601e6(0x1a1)];_0x2dff64[_0xe601e6(0x189)][_0xe601e6(0x1c3)]=_0x22ca11+'px';if(_0x93226f){const _0x58b18d=_0x93226f['offsetHeight'];_0x8156fe['style']['paddingBottom']=_0x58b18d+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x2b0170})=>{_0x4058fc();if(_0x2b0170)requestAnimationFrame(()=>{const _0x92ffce=a0_0x1130;_0x8156fe[_0x92ffce(0x171)]=_0x8156fe[_0x92ffce(0x1a9)];});}):window[_0x286ba6(0x177)](_0x286ba6(0x1a5),_0x4058fc),_0x4058fc(),_0x5e2e19&&(_0x5e2e19[_0x286ba6(0x177)](_0x286ba6(0x1b8),()=>{requestAnimationFrame(_0x4058fc);}),_0x5e2e19[_0x286ba6(0x177)](_0x286ba6(0x17d),()=>{setTimeout(()=>{const _0x308fed=a0_0x1130;_0x8156fe['scrollTop']=_0x8156fe[_0x308fed(0x1a9)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2f5c98(0x1cc),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x53b4(){const _0x431905=['Ошибка\x20сервера','notificationOccurred','add','function','addEventListener','floor','setItem','TG\x20setup\x20error:','show-delete','4432015AWbxfm','focus','Удалить?','touchend','div','toString','classList','7510ukPvRV','impactOccurred','shiftKey','show','content','textContent','style','createElement','preventDefault','messageInput','debug_uid','message-bubble','offClick','BackButton','6.1','from','chatArea','json','getHours','expand','role','innerHTML','Очистить\x20историю?','medium','Пустой\x20ответ','Действие\x20необратимо.','getElementById','message-time','2301764kPdOal','forEach','innerHeight','initDataUnsafe','117YqWPnP','length','resize','HapticFeedback','href','first_name','scrollHeight','timestamp','4813160cyEfjy','auto','ready','trim','7IPNuRs','appendChild','signal','light','POST','error','onClick','querySelectorAll','value','input','emptyState','39992BiDHDa','children','clear_history','initData','ai_chat_messages','modalText','search','onclick','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','height','remove','1157060zoqLmw','.container','splice','viewportHeight','user','push','delete-btn','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','padStart','className','send_message','warn','2777508cVGrwe','disabled','key','success','click','text','getMinutes','constructor','text/plain','typingIndicator','display','setHeaderColor','stopPropagation','Начнется\x20новый\x20диалог.','keydown','.message.show-delete','<br>','Ошибка\x20сети','stringify','WebApp','getItem','username','inputArea','#050505','Enter','225mvnXKY','clearBtn','flex','now','scrollTop','confirmModal'];a0_0x53b4=function(){return _0x431905;};return a0_0x53b4();}const chatArea=document[a0_0x2f5c98(0x19d)]('chatArea'),emptyState=document['getElementById'](a0_0x2f5c98(0x1b9)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x2f5c98(0x19d)]('sendBtn'),clearBtn=document[a0_0x2f5c98(0x19d)](a0_0x2f5c98(0x16e)),modal=document['getElementById'](a0_0x2f5c98(0x172)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x2f5c98(0x19d)](a0_0x2f5c98(0x1bf));let modalCallback=null;async function callBackend(_0x37c40b,_0x4826df){const _0x2af0de=a0_0x2f5c98,_0x5299e5=tg?.[_0x2af0de(0x1a2)]?.[_0x2af0de(0x1c9)]||{},_0x58006d=_0x5299e5['id']||localStorage[_0x2af0de(0x168)](_0x2af0de(0x18d))||'d-'+Math[_0x2af0de(0x178)](Math['random']()*0x3b9aca00);if(!_0x5299e5['id'])localStorage['setItem'](_0x2af0de(0x18d),_0x58006d);const _0x396627={'action':_0x37c40b,'user_id':_0x58006d,'user_data':{'first_name':_0x5299e5[_0x2af0de(0x1a8)],'username':_0x5299e5[_0x2af0de(0x169)]},'init_data':tg?.[_0x2af0de(0x1bd)]||'',..._0x4826df},_0xa4bf34=new AbortController(),_0x40ea49=setTimeout(()=>_0xa4bf34['abort'](),REQUEST_TIMEOUT_MS);try{const _0x19ceeb=await fetch(BACKEND_URL,{'method':_0x2af0de(0x1b3),'headers':{'Content-Type':_0x2af0de(0x15c)},'body':JSON[_0x2af0de(0x166)](_0x396627),'signal':_0xa4bf34[_0x2af0de(0x1b1)]});return clearTimeout(_0x40ea49),await _0x19ceeb[_0x2af0de(0x194)]();}catch(_0x557359){return{'success':![],'error':String(_0x557359)};}}function formatTime(_0x11aefb){const _0x4e6fdc=a0_0x2f5c98,_0x575021=new Date(_0x11aefb);return String(_0x575021[_0x4e6fdc(0x195)]())['padStart'](0x2,'0')+':'+String(_0x575021[_0x4e6fdc(0x15a)]())[_0x4e6fdc(0x1cd)](0x2,'0');}function createMessageElement(_0x18051b,_0x15b809){const _0x8800ff=a0_0x2f5c98,_0x589a92=document[_0x8800ff(0x18a)](_0x8800ff(0x180));_0x589a92['className']='message\x20'+_0x18051b[_0x8800ff(0x197)];const _0x5cef9b=document['createElement']('div');_0x5cef9b['className']=_0x8800ff(0x18e),_0x5cef9b[_0x8800ff(0x198)]=_0x18051b[_0x8800ff(0x187)]['replace'](/\n/g,_0x8800ff(0x164));const _0x5cb2bd=document[_0x8800ff(0x18a)]('div');_0x5cb2bd[_0x8800ff(0x1ce)]=_0x8800ff(0x1cb),_0x5cb2bd[_0x8800ff(0x198)]=_0x8800ff(0x1c2),_0x5cb2bd[_0x8800ff(0x1c1)]=_0x486041=>{const _0x2071f8=_0x8800ff;_0x486041[_0x2071f8(0x160)](),confirmDelete(_0x15b809);};let _0x51e0a3;_0x5cef9b['addEventListener']('touchstart',()=>_0x51e0a3=setTimeout(()=>{const _0x40e7ea=_0x8800ff;_0x589a92[_0x40e7ea(0x182)][_0x40e7ea(0x175)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x40e7ea(0x1a6)][_0x40e7ea(0x184)](_0x40e7ea(0x19a));},0x1f4)),_0x5cef9b[_0x8800ff(0x177)](_0x8800ff(0x17f),()=>clearTimeout(_0x51e0a3));const _0x38e632=document[_0x8800ff(0x18a)](_0x8800ff(0x180));return _0x38e632[_0x8800ff(0x1ce)]=_0x8800ff(0x19e),_0x38e632[_0x8800ff(0x188)]=formatTime(_0x18051b[_0x8800ff(0x1aa)]),_0x589a92[_0x8800ff(0x1b0)](_0x5cb2bd),_0x589a92[_0x8800ff(0x1b0)](_0x5cef9b),_0x589a92[_0x8800ff(0x1b0)](_0x38e632),_0x589a92;}function createTypingIndicator(){const _0x7b2794=a0_0x2f5c98,_0x28facd=document[_0x7b2794(0x18a)](_0x7b2794(0x180));return _0x28facd['className']='message\x20ai',_0x28facd['id']=_0x7b2794(0x15d),_0x28facd[_0x7b2794(0x198)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x28facd;}function renderMessages(){const _0x1ed7f6=a0_0x2f5c98;Array[_0x1ed7f6(0x192)](chatArea[_0x1ed7f6(0x1bb)])[_0x1ed7f6(0x1a0)](_0x2f6ece=>{const _0x307f3b=_0x1ed7f6;if(_0x2f6ece['id']!==_0x307f3b(0x1b9))_0x2f6ece[_0x307f3b(0x1c4)]();}),messages['length']>0x0?(emptyState[_0x1ed7f6(0x189)]['display']='none',messages['forEach']((_0xe942ee,_0x18cd77)=>chatArea[_0x1ed7f6(0x1b0)](createMessageElement(_0xe942ee,_0x18cd77)))):emptyState[_0x1ed7f6(0x189)][_0x1ed7f6(0x15e)]=_0x1ed7f6(0x16f),requestAnimationFrame(()=>chatArea[_0x1ed7f6(0x171)]=chatArea[_0x1ed7f6(0x1a9)]);}function autoResizeTextarea(){const _0x135004=a0_0x2f5c98;messageInput[_0x135004(0x189)]['height']=_0x135004(0x1ac),messageInput['style'][_0x135004(0x1c3)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x556098=a0_0x2f5c98,_0x2e3ca7=messageInput[_0x556098(0x1b7)]['trim']();sendBtn[_0x556098(0x155)]=!_0x2e3ca7||isTyping;}async function sendMessage(){const _0x4bdaec=a0_0x2f5c98,_0x5170da=messageInput['value'][_0x4bdaec(0x1ae)]();if(!_0x5170da||isTyping)return;if(tg?.[_0x4bdaec(0x1a6)])tg['HapticFeedback']['impactOccurred']('light');messages[_0x4bdaec(0x1ca)]({'role':'user','content':_0x5170da,'timestamp':Date['now']()}),localStorage[_0x4bdaec(0x179)](_0x4bdaec(0x1be),JSON[_0x4bdaec(0x166)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x4bdaec(0x171)]=chatArea[_0x4bdaec(0x1a9)];const _0x59c7c7=await callBackend(_0x4bdaec(0x152),{'message':_0x5170da});isTyping=![];const _0x14cfeb=document[_0x4bdaec(0x19d)](_0x4bdaec(0x15d));if(_0x14cfeb)_0x14cfeb[_0x4bdaec(0x1c4)]();let _0x580366=_0x4bdaec(0x165);if(_0x59c7c7[_0x4bdaec(0x157)]){_0x580366=_0x59c7c7[_0x4bdaec(0x159)]||_0x4bdaec(0x19b);if(tg?.[_0x4bdaec(0x1a6)])tg[_0x4bdaec(0x1a6)]['notificationOccurred'](_0x4bdaec(0x157));}else{_0x580366=_0x59c7c7[_0x4bdaec(0x1b4)]||_0x4bdaec(0x173);if(tg?.[_0x4bdaec(0x1a6)])tg[_0x4bdaec(0x1a6)][_0x4bdaec(0x174)]('error');}messages[_0x4bdaec(0x1ca)]({'role':'ai','content':_0x580366,'timestamp':Date[_0x4bdaec(0x170)]()}),localStorage[_0x4bdaec(0x179)](_0x4bdaec(0x1be),JSON[_0x4bdaec(0x166)](messages)),renderMessages();}function confirmDelete(_0x3bd07c){const _0x6c5401=a0_0x2f5c98;if(mTitle)mTitle[_0x6c5401(0x188)]=_0x6c5401(0x17e);if(mText)mText['textContent']=_0x6c5401(0x19c);modalCallback=()=>{const _0x4b708e=_0x6c5401;messages[_0x4b708e(0x1c7)](_0x3bd07c,0x1),localStorage[_0x4b708e(0x179)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x6c5401(0x182)][_0x6c5401(0x175)]('show');}function a0_0x1130(_0x1f8a5e,_0x161809){_0x1f8a5e=_0x1f8a5e-0x152;const _0x135398=a0_0x53b4();let _0x3e7316=_0x135398[_0x1f8a5e];return _0x3e7316;}if(clearBtn)clearBtn[a0_0x2f5c98(0x1c1)]=()=>{const _0x3710a6=a0_0x2f5c98;if(!messages[_0x3710a6(0x1a4)])return;if(mTitle)mTitle['textContent']=_0x3710a6(0x199);if(mText)mText['textContent']=_0x3710a6(0x161);modalCallback=async()=>{const _0x38125f=_0x3710a6;messages=[],localStorage['removeItem'](_0x38125f(0x1be)),renderMessages(),callBackend(_0x38125f(0x1bc),{});},modal[_0x3710a6(0x182)][_0x3710a6(0x175)](_0x3710a6(0x186));};document[a0_0x2f5c98(0x19d)]('modalCancel')['onclick']=()=>modal[a0_0x2f5c98(0x182)][a0_0x2f5c98(0x1c4)]('show'),document['getElementById']('modalConfirm')['onclick']=()=>{const _0x432c48=a0_0x2f5c98;if(modalCallback)modalCallback();modal[_0x432c48(0x182)][_0x432c48(0x1c4)](_0x432c48(0x186));},messageInput[a0_0x2f5c98(0x177)](a0_0x2f5c98(0x1b8),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2f5c98(0x177)](a0_0x2f5c98(0x162),_0x1789fb=>{const _0x1082de=a0_0x2f5c98;_0x1789fb[_0x1082de(0x156)]===_0x1082de(0x16c)&&!_0x1789fb[_0x1082de(0x185)]&&(_0x1789fb[_0x1082de(0x18b)](),sendMessage());}),sendBtn[a0_0x2f5c98(0x1c1)]=sendMessage,document['addEventListener'](a0_0x2f5c98(0x158),_0x39f7fa=>{const _0x3ad109=a0_0x2f5c98;document[_0x3ad109(0x1b6)](_0x3ad109(0x163))['forEach'](_0x1a053c=>{const _0x4c0591=_0x3ad109;if(!_0x1a053c['contains'](_0x39f7fa['target']))_0x1a053c[_0x4c0591(0x182)][_0x4c0591(0x1c4)](_0x4c0591(0x17b));});});const saved=localStorage['getItem'](a0_0x2f5c98(0x1be));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x5664af){}updateSendButton();