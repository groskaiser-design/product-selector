const a0_0xdf1001=a0_0x5c5b;(function(_0x22fef7,_0x10aa08){const _0x1b651d=a0_0x5c5b,_0x61218e=_0x22fef7();while(!![]){try{const _0x460869=-parseInt(_0x1b651d(0x16c))/0x1*(parseInt(_0x1b651d(0x14f))/0x2)+-parseInt(_0x1b651d(0x199))/0x3*(parseInt(_0x1b651d(0x124))/0x4)+parseInt(_0x1b651d(0x18d))/0x5*(-parseInt(_0x1b651d(0x193))/0x6)+-parseInt(_0x1b651d(0x16a))/0x7*(parseInt(_0x1b651d(0x150))/0x8)+-parseInt(_0x1b651d(0x135))/0x9+parseInt(_0x1b651d(0x141))/0xa*(-parseInt(_0x1b651d(0x13d))/0xb)+parseInt(_0x1b651d(0x18f))/0xc;if(_0x460869===_0x10aa08)break;else _0x61218e['push'](_0x61218e['shift']());}catch(_0x2e0dd5){_0x61218e['push'](_0x61218e['shift']());}}}(a0_0x583f,0x8ddbb));const tg=window[a0_0xdf1001(0x187)]?.[a0_0xdf1001(0x171)],HOME_URL=a0_0xdf1001(0x197);function setupTelegramBackButton(){const _0x9df982=a0_0xdf1001;if(!tg)return;try{tg[_0x9df982(0x16f)](),tg[_0x9df982(0x16b)](),tg['setHeaderColor']?.('#050505');if(tg[_0x9df982(0x176)]?.(_0x9df982(0x191)))tg[_0x9df982(0x178)]?.();const _0x2ad72f=tg[_0x9df982(0x12a)];if(_0x2ad72f){_0x2ad72f[_0x9df982(0x154)]();if(typeof _0x2ad72f[_0x9df982(0x138)]===_0x9df982(0x153))try{_0x2ad72f[_0x9df982(0x138)]();}catch(_0x583af6){}_0x2ad72f['onClick'](()=>{const _0x55d34c=_0x9df982;if(tg['HapticFeedback'])tg[_0x55d34c(0x19e)]['impactOccurred'](_0x55d34c(0x182));location[_0x55d34c(0x177)]=HOME_URL;});}}catch(_0x15b8ad){console[_0x9df982(0x198)]('TG\x20setup\x20error:',_0x15b8ad);}}(function initStableLayout(){const _0x49b94b=a0_0xdf1001,_0x2188fc=(function(){let _0x2eb4d0=!![];return function(_0x44a0ec,_0x36836c){const _0x44e5e9=_0x2eb4d0?function(){if(_0x36836c){const _0x44baba=_0x36836c['apply'](_0x44a0ec,arguments);return _0x36836c=null,_0x44baba;}}:function(){};return _0x2eb4d0=![],_0x44e5e9;};}()),_0x30f317=document[_0x49b94b(0x188)](_0x49b94b(0x133)),_0x4440ad=document[_0x49b94b(0x12e)](_0x49b94b(0x132)),_0x3d7a4a=document['getElementById']('chatArea'),_0x438a79=document[_0x49b94b(0x12e)](_0x49b94b(0x120));function _0x1e7242(){const _0x2c8ebe=_0x49b94b,_0x5538e0=_0x2188fc(this,function(){const _0x24aefc=a0_0x5c5b;return _0x5538e0[_0x24aefc(0x152)]()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x5538e0)['search']('(((.+)+)+)+$');});_0x5538e0();if(!_0x30f317)return;const _0x4dc555=tg&&tg[_0x2c8ebe(0x18b)]?tg[_0x2c8ebe(0x18b)]:window['innerHeight'];_0x30f317[_0x2c8ebe(0x173)][_0x2c8ebe(0x137)]=_0x4dc555+'px';if(_0x4440ad){const _0x275482=_0x4440ad[_0x2c8ebe(0x136)];_0x3d7a4a['style'][_0x2c8ebe(0x164)]=_0x275482+0x28+'px';}}tg?tg[_0x49b94b(0x121)]('viewportChanged',({isStateStable:_0x3af307})=>{_0x1e7242();if(_0x3af307)requestAnimationFrame(()=>{const _0x366337=a0_0x5c5b;_0x3d7a4a[_0x366337(0x122)]=_0x3d7a4a[_0x366337(0x12f)];});}):window[_0x49b94b(0x19f)](_0x49b94b(0x19d),_0x1e7242),_0x1e7242(),_0x438a79&&(_0x438a79[_0x49b94b(0x19f)](_0x49b94b(0x151),()=>{requestAnimationFrame(_0x1e7242);}),_0x438a79[_0x49b94b(0x19f)](_0x49b94b(0x14b),()=>{setTimeout(()=>{const _0x16d70b=a0_0x5c5b;_0x3d7a4a['scrollTop']=_0x3d7a4a[_0x16d70b(0x12f)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xdf1001(0x126),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x5c5b(_0x18331f,_0x33a71d){_0x18331f=_0x18331f-0x11e;const _0x1b6182=a0_0x583f();let _0x3c21af=_0x1b6182[_0x18331f];return _0x3c21af;}let messages=[],isTyping=![];const chatArea=document[a0_0xdf1001(0x12e)](a0_0xdf1001(0x140)),emptyState=document[a0_0xdf1001(0x12e)](a0_0xdf1001(0x16d)),messageInput=document[a0_0xdf1001(0x12e)](a0_0xdf1001(0x120)),sendBtn=document[a0_0xdf1001(0x12e)](a0_0xdf1001(0x169)),clearBtn=document['getElementById'](a0_0xdf1001(0x179)),modal=document['getElementById'](a0_0xdf1001(0x17e)),mTitle=document[a0_0xdf1001(0x12e)](a0_0xdf1001(0x15b)),mText=document[a0_0xdf1001(0x12e)](a0_0xdf1001(0x18e));let modalCallback=null;async function callBackend(_0x39cc74,_0x531f2e){const _0x50e7db=a0_0xdf1001,_0x3513f1=tg?.[_0x50e7db(0x147)]?.[_0x50e7db(0x15d)]||{},_0x196c98=_0x3513f1['id']||localStorage[_0x50e7db(0x146)]('debug_uid')||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x3513f1['id'])localStorage[_0x50e7db(0x15c)](_0x50e7db(0x139),_0x196c98);const _0x2e2182={'action':_0x39cc74,'user_id':_0x196c98,'user_data':{'first_name':_0x3513f1[_0x50e7db(0x149)],'username':_0x3513f1['username']},'init_data':tg?.['initData']||'',..._0x531f2e},_0x32aefe=new AbortController(),_0x4fe320=setTimeout(()=>_0x32aefe['abort'](),REQUEST_TIMEOUT_MS);try{const _0x32bc8a=await fetch(BACKEND_URL,{'method':_0x50e7db(0x142),'headers':{'Content-Type':_0x50e7db(0x11f)},'body':JSON['stringify'](_0x2e2182),'signal':_0x32aefe[_0x50e7db(0x172)]});return clearTimeout(_0x4fe320),await _0x32bc8a[_0x50e7db(0x15e)]();}catch(_0x226dc9){return{'success':![],'error':String(_0x226dc9)};}}function formatTime(_0x4df1f9){const _0x4f2b10=a0_0xdf1001,_0x20882d=new Date(_0x4df1f9);return String(_0x20882d[_0x4f2b10(0x13f)]())[_0x4f2b10(0x13c)](0x2,'0')+':'+String(_0x20882d[_0x4f2b10(0x15f)]())[_0x4f2b10(0x13c)](0x2,'0');}function createMessageElement(_0xa0505d,_0x3b181d){const _0x1c99b0=a0_0xdf1001,_0x751c0c=document['createElement']('div');_0x751c0c[_0x1c99b0(0x123)]=_0x1c99b0(0x196)+_0xa0505d['role'];const _0x515077=document['createElement'](_0x1c99b0(0x18c));_0x515077[_0x1c99b0(0x123)]=_0x1c99b0(0x161),_0x515077[_0x1c99b0(0x17f)]=_0xa0505d['content']['replace'](/\n/g,_0x1c99b0(0x12b));const _0x98b77b=document[_0x1c99b0(0x163)](_0x1c99b0(0x18c));_0x98b77b[_0x1c99b0(0x123)]='delete-btn',_0x98b77b['innerHTML']=_0x1c99b0(0x129),_0x98b77b['onclick']=_0x25f840=>{const _0x51dce4=_0x1c99b0;_0x25f840[_0x51dce4(0x167)](),confirmDelete(_0x3b181d);};let _0x2eabd1;_0x515077[_0x1c99b0(0x19f)](_0x1c99b0(0x156),()=>_0x2eabd1=setTimeout(()=>{const _0x5eedc0=_0x1c99b0;_0x751c0c[_0x5eedc0(0x13e)][_0x5eedc0(0x159)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x5eedc0(0x19e)][_0x5eedc0(0x143)](_0x5eedc0(0x1a1));},0x1f4)),_0x515077[_0x1c99b0(0x19f)](_0x1c99b0(0x181),()=>clearTimeout(_0x2eabd1));const _0x5e2b15=document[_0x1c99b0(0x163)]('div');return _0x5e2b15[_0x1c99b0(0x123)]=_0x1c99b0(0x162),_0x5e2b15[_0x1c99b0(0x166)]=formatTime(_0xa0505d[_0x1c99b0(0x18a)]),_0x751c0c[_0x1c99b0(0x17d)](_0x98b77b),_0x751c0c['appendChild'](_0x515077),_0x751c0c[_0x1c99b0(0x17d)](_0x5e2b15),_0x751c0c;}function a0_0x583f(){const _0x686115=['<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','modalConfirm','Действие\x20необратимо.','Telegram','querySelector','Enter','timestamp','viewportHeight','div','6495WCMdAg','modalText','45680364IVgnZs','onclick','6.1','removeItem','2442NnHnQF','shiftKey','stringify','message\x20','./router.html','warn','244899QFILDw','trim','send_message','remove','resize','HapticFeedback','addEventListener','error','medium','notificationOccurred','text/plain','messageInput','onEvent','scrollTop','className','44bVkkmN','children','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Пустой\x20ответ','message\x20ai','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','BackButton','<br>','ai_chat_messages','disabled','getElementById','scrollHeight','push','querySelectorAll','inputArea','.container','length','730989mImIXS','offsetHeight','height','offClick','debug_uid','splice','success','padStart','583MlbWTk','classList','getHours','chatArea','118470BbSXiI','POST','impactOccurred','Ошибка\x20сети','from','getItem','initDataUnsafe','show-delete','first_name','click','focus','display','Очистить\x20историю?','.message.show-delete','2tsNhTi','348088gJHpxf','input','toString','function','show','min','touchstart','parse','value','add','text','modalTitle','setItem','user','json','getMinutes','Ошибка\x20сервера','message-bubble','message-time','createElement','paddingBottom','target','textContent','stopPropagation','Начнется\x20новый\x20диалог.','sendBtn','140tlokGL','expand','219658KFZrwo','emptyState','typingIndicator','ready','none','WebApp','signal','style','now','modalCancel','isVersionAtLeast','href','disableVerticalSwipes','clearBtn','Удалить?','auto','forEach','appendChild','confirmModal','innerHTML','flex','touchend','light','key'];a0_0x583f=function(){return _0x686115;};return a0_0x583f();}function createTypingIndicator(){const _0x3a5f63=a0_0xdf1001,_0x179416=document[_0x3a5f63(0x163)](_0x3a5f63(0x18c));return _0x179416[_0x3a5f63(0x123)]=_0x3a5f63(0x128),_0x179416['id']=_0x3a5f63(0x16e),_0x179416[_0x3a5f63(0x17f)]=_0x3a5f63(0x184),_0x179416;}function renderMessages(){const _0x276f6f=a0_0xdf1001;Array[_0x276f6f(0x145)](chatArea[_0x276f6f(0x125)])['forEach'](_0x5b423c=>{if(_0x5b423c['id']!=='emptyState')_0x5b423c['remove']();}),messages[_0x276f6f(0x134)]>0x0?(emptyState['style'][_0x276f6f(0x14c)]=_0x276f6f(0x170),messages[_0x276f6f(0x17c)]((_0x2c8171,_0x3439fa)=>chatArea['appendChild'](createMessageElement(_0x2c8171,_0x3439fa)))):emptyState[_0x276f6f(0x173)]['display']=_0x276f6f(0x180),requestAnimationFrame(()=>chatArea[_0x276f6f(0x122)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x14d515=a0_0xdf1001;messageInput[_0x14d515(0x173)][_0x14d515(0x137)]=_0x14d515(0x17b),messageInput[_0x14d515(0x173)][_0x14d515(0x137)]=Math[_0x14d515(0x155)](messageInput[_0x14d515(0x12f)],0x78)+'px';}function updateSendButton(){const _0x3511f2=a0_0xdf1001,_0x1cd019=messageInput[_0x3511f2(0x158)]['trim']();sendBtn[_0x3511f2(0x12d)]=!_0x1cd019||isTyping;}async function sendMessage(){const _0x376b84=a0_0xdf1001,_0x1dfd13=messageInput[_0x376b84(0x158)][_0x376b84(0x19a)]();if(!_0x1dfd13||isTyping)return;if(tg?.[_0x376b84(0x19e)])tg['HapticFeedback'][_0x376b84(0x143)](_0x376b84(0x182));messages['push']({'role':_0x376b84(0x15d),'content':_0x1dfd13,'timestamp':Date[_0x376b84(0x174)]()}),localStorage[_0x376b84(0x15c)](_0x376b84(0x12c),JSON['stringify'](messages)),renderMessages(),messageInput[_0x376b84(0x158)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x376b84(0x122)]=chatArea[_0x376b84(0x12f)];const _0x6e4285=await callBackend(_0x376b84(0x19b),{'message':_0x1dfd13});isTyping=![];const _0x18228b=document[_0x376b84(0x12e)]('typingIndicator');if(_0x18228b)_0x18228b[_0x376b84(0x19c)]();let _0x21e5fd=_0x376b84(0x144);if(_0x6e4285[_0x376b84(0x13b)]){_0x21e5fd=_0x6e4285[_0x376b84(0x15a)]||_0x376b84(0x127);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x376b84(0x11e)](_0x376b84(0x13b));}else{_0x21e5fd=_0x6e4285[_0x376b84(0x1a0)]||_0x376b84(0x160);if(tg?.['HapticFeedback'])tg[_0x376b84(0x19e)]['notificationOccurred'](_0x376b84(0x1a0));}messages[_0x376b84(0x130)]({'role':'ai','content':_0x21e5fd,'timestamp':Date[_0x376b84(0x174)]()}),localStorage[_0x376b84(0x15c)]('ai_chat_messages',JSON[_0x376b84(0x195)](messages)),renderMessages();}function confirmDelete(_0x6083be){const _0x2b14c8=a0_0xdf1001;if(mTitle)mTitle[_0x2b14c8(0x166)]=_0x2b14c8(0x17a);if(mText)mText[_0x2b14c8(0x166)]=_0x2b14c8(0x186);modalCallback=()=>{const _0x24718f=_0x2b14c8;messages[_0x24718f(0x13a)](_0x6083be,0x1),localStorage[_0x24718f(0x15c)](_0x24718f(0x12c),JSON[_0x24718f(0x195)](messages)),renderMessages();},modal['classList']['add'](_0x2b14c8(0x154));}if(clearBtn)clearBtn[a0_0xdf1001(0x190)]=()=>{const _0x504f8d=a0_0xdf1001;if(!messages[_0x504f8d(0x134)])return;if(mTitle)mTitle['textContent']=_0x504f8d(0x14d);if(mText)mText['textContent']=_0x504f8d(0x168);modalCallback=async()=>{const _0x166090=_0x504f8d;messages=[],localStorage[_0x166090(0x192)](_0x166090(0x12c)),renderMessages(),callBackend('clear_history',{});},modal[_0x504f8d(0x13e)]['add'](_0x504f8d(0x154));};document[a0_0xdf1001(0x12e)](a0_0xdf1001(0x175))[a0_0xdf1001(0x190)]=()=>modal[a0_0xdf1001(0x13e)][a0_0xdf1001(0x19c)](a0_0xdf1001(0x154)),document[a0_0xdf1001(0x12e)](a0_0xdf1001(0x185))[a0_0xdf1001(0x190)]=()=>{const _0x3732f1=a0_0xdf1001;if(modalCallback)modalCallback();modal[_0x3732f1(0x13e)][_0x3732f1(0x19c)]('show');},messageInput[a0_0xdf1001(0x19f)](a0_0xdf1001(0x151),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x5e7071=>{const _0x1e7353=a0_0xdf1001;_0x5e7071[_0x1e7353(0x183)]===_0x1e7353(0x189)&&!_0x5e7071[_0x1e7353(0x194)]&&(_0x5e7071['preventDefault'](),sendMessage());}),sendBtn[a0_0xdf1001(0x190)]=sendMessage,document[a0_0xdf1001(0x19f)](a0_0xdf1001(0x14a),_0x411091=>{const _0x47dd7e=a0_0xdf1001;document[_0x47dd7e(0x131)](_0x47dd7e(0x14e))[_0x47dd7e(0x17c)](_0x25a303=>{const _0x4af5bc=_0x47dd7e;if(!_0x25a303['contains'](_0x411091[_0x4af5bc(0x165)]))_0x25a303['classList'][_0x4af5bc(0x19c)](_0x4af5bc(0x148));});});const saved=localStorage[a0_0xdf1001(0x146)](a0_0xdf1001(0x12c));if(saved)try{messages=JSON[a0_0xdf1001(0x157)](saved),renderMessages();}catch(a0_0x1347d){}updateSendButton();