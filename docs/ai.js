const a0_0x1e6f85=a0_0x17fe;(function(_0x579206,_0x4a11ad){const _0x4ab7df=a0_0x17fe,_0x40ec86=_0x579206();while(!![]){try{const _0x247c21=parseInt(_0x4ab7df(0x131))/0x1+-parseInt(_0x4ab7df(0x15e))/0x2+-parseInt(_0x4ab7df(0x189))/0x3+parseInt(_0x4ab7df(0x16e))/0x4*(-parseInt(_0x4ab7df(0x129))/0x5)+-parseInt(_0x4ab7df(0x165))/0x6*(parseInt(_0x4ab7df(0x166))/0x7)+-parseInt(_0x4ab7df(0x121))/0x8+parseInt(_0x4ab7df(0x17d))/0x9;if(_0x247c21===_0x4a11ad)break;else _0x40ec86['push'](_0x40ec86['shift']());}catch(_0x21c2a2){_0x40ec86['push'](_0x40ec86['shift']());}}}(a0_0x3b71,0x50d7b));const tg=window[a0_0x1e6f85(0x17e)]?.['WebApp'],HOME_URL=a0_0x1e6f85(0x14c);function a0_0x17fe(_0x16beba,_0x42c32f){_0x16beba=_0x16beba-0x10a;const _0x171a6a=a0_0x3b71();let _0x508550=_0x171a6a[_0x16beba];return _0x508550;}function a0_0x3b71(){const _0x2c34af=['112987dUsrqf','clear_history','json','disableVerticalSwipes','apply','replace','getHours','getMinutes','184dLPIOz','setHeaderColor','className','toString','text/plain','first_name','message-bubble','username','emptyState','typingIndicator','expand','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Очистить\x20историю?','modalTitle','send_message','4273803RsqYEE','Telegram','role','length','viewportHeight','div','querySelector','messageInput','modalText','onclick','isVersionAtLeast','push','671493YfoqoZ','height','now','flex','6.1','appendChild','content','show-delete','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','contains','createElement','splice','forEach','textContent','floor','signal','setItem','impactOccurred','message\x20','light','classList','modalCancel','POST','resize','Удалить?','querySelectorAll','warn','809904QMIdbr','BackButton','keydown','HapticFeedback','show','debug_uid','innerHTML','ai_chat_messages','9890aVtMWz','.message.show-delete','remove','.container','sendBtn','stringify','Ошибка\x20сети','#050505','556555PpQvux','touchstart','success','padStart','style','scrollHeight','paddingBottom','value','initData','target','random','offClick','abort','auto','user','delete-btn','from','disabled','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','add','text','Пустой\x20ответ','constructor','search','inputArea','notificationOccurred','none','./router.html','input','Ошибка\x20сервера','display','preventDefault','message-time','viewportChanged','getItem','href','getElementById','message\x20ai','Начнется\x20новый\x20диалог.','scrollTop','(((.+)+)+)+$','offsetHeight','addEventListener','chatArea','TG\x20setup\x20error:','116520wGorse','trim','confirmModal','onClick','focus','ready','min','84zXUyRE'];a0_0x3b71=function(){return _0x2c34af;};return a0_0x3b71();}function setupTelegramBackButton(){const _0x227bf8=a0_0x1e6f85;if(!tg)return;try{tg[_0x227bf8(0x163)](),tg[_0x227bf8(0x178)](),tg[_0x227bf8(0x16f)]?.(_0x227bf8(0x130));if(tg[_0x227bf8(0x187)]?.(_0x227bf8(0x10a)))tg[_0x227bf8(0x169)]?.();const _0x35c380=tg[_0x227bf8(0x122)];if(_0x35c380){_0x35c380[_0x227bf8(0x125)]();if(typeof _0x35c380['offClick']==='function')try{_0x35c380[_0x227bf8(0x13c)]();}catch(_0x130bb2){}_0x35c380[_0x227bf8(0x161)](()=>{const _0x574422=_0x227bf8;if(tg[_0x574422(0x124)])tg[_0x574422(0x124)]['impactOccurred'](_0x574422(0x119));location[_0x574422(0x154)]=HOME_URL;});}}catch(_0x3c1dd4){console[_0x227bf8(0x120)](_0x227bf8(0x15d),_0x3c1dd4);}}(function initStableLayout(){const _0x588878=a0_0x1e6f85,_0x3be1e9=(function(){let _0x3936b9=!![];return function(_0x1a82bf,_0x94d5ee){const _0x1fabd5=_0x3936b9?function(){const _0x3f7909=a0_0x17fe;if(_0x94d5ee){const _0x46e0a1=_0x94d5ee[_0x3f7909(0x16a)](_0x1a82bf,arguments);return _0x94d5ee=null,_0x46e0a1;}}:function(){};return _0x3936b9=![],_0x1fabd5;};}()),_0x1a1a14=document[_0x588878(0x183)](_0x588878(0x12c)),_0x591499=document[_0x588878(0x155)](_0x588878(0x149)),_0x3a331d=document['getElementById']('chatArea'),_0x112ad5=document[_0x588878(0x155)](_0x588878(0x184));function _0x656cdf(){const _0x3a954e=_0x588878,_0x839391=_0x3be1e9(this,function(){const _0x28c008=a0_0x17fe;return _0x839391[_0x28c008(0x171)]()[_0x28c008(0x148)]('(((.+)+)+)+$')[_0x28c008(0x171)]()[_0x28c008(0x147)](_0x839391)['search'](_0x28c008(0x159));});_0x839391();if(!_0x1a1a14)return;const _0x1fbbd6=tg&&tg[_0x3a954e(0x181)]?tg[_0x3a954e(0x181)]:window['innerHeight'];_0x1a1a14[_0x3a954e(0x135)][_0x3a954e(0x18a)]=_0x1fbbd6+'px';if(_0x591499){const _0x14c2a0=_0x591499[_0x3a954e(0x15a)];_0x3a331d[_0x3a954e(0x135)][_0x3a954e(0x137)]=_0x14c2a0+0x28+'px';}}tg?tg['onEvent'](_0x588878(0x152),({isStateStable:_0x4e1b66})=>{_0x656cdf();if(_0x4e1b66)requestAnimationFrame(()=>{const _0x50e6e6=a0_0x17fe;_0x3a331d[_0x50e6e6(0x158)]=_0x3a331d[_0x50e6e6(0x136)];});}):window[_0x588878(0x15b)](_0x588878(0x11d),_0x656cdf),_0x656cdf(),_0x112ad5&&(_0x112ad5['addEventListener'](_0x588878(0x14d),()=>{requestAnimationFrame(_0x656cdf);}),_0x112ad5['addEventListener'](_0x588878(0x162),()=>{setTimeout(()=>{const _0x24bb65=a0_0x17fe;_0x3a331d[_0x24bb65(0x158)]=_0x3a331d[_0x24bb65(0x136)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1e6f85(0x143),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1e6f85(0x155)](a0_0x1e6f85(0x15c)),emptyState=document[a0_0x1e6f85(0x155)](a0_0x1e6f85(0x176)),messageInput=document[a0_0x1e6f85(0x155)](a0_0x1e6f85(0x184)),sendBtn=document[a0_0x1e6f85(0x155)](a0_0x1e6f85(0x12d)),clearBtn=document[a0_0x1e6f85(0x155)]('clearBtn'),modal=document[a0_0x1e6f85(0x155)](a0_0x1e6f85(0x160)),mTitle=document[a0_0x1e6f85(0x155)](a0_0x1e6f85(0x17b)),mText=document[a0_0x1e6f85(0x155)](a0_0x1e6f85(0x185));let modalCallback=null;async function callBackend(_0x2cd9ae,_0x5e0748){const _0x58249a=a0_0x1e6f85,_0x24b176=tg?.['initDataUnsafe']?.['user']||{},_0x33364a=_0x24b176['id']||localStorage[_0x58249a(0x153)](_0x58249a(0x126))||'d-'+Math[_0x58249a(0x114)](Math[_0x58249a(0x13b)]()*0x3b9aca00);if(!_0x24b176['id'])localStorage[_0x58249a(0x116)](_0x58249a(0x126),_0x33364a);const _0x270c0c={'action':_0x2cd9ae,'user_id':_0x33364a,'user_data':{'first_name':_0x24b176[_0x58249a(0x173)],'username':_0x24b176[_0x58249a(0x175)]},'init_data':tg?.[_0x58249a(0x139)]||'',..._0x5e0748},_0x445149=new AbortController(),_0x2355ae=setTimeout(()=>_0x445149[_0x58249a(0x13d)](),REQUEST_TIMEOUT_MS);try{const _0x1f993e=await fetch(BACKEND_URL,{'method':_0x58249a(0x11c),'headers':{'Content-Type':_0x58249a(0x172)},'body':JSON['stringify'](_0x270c0c),'signal':_0x445149[_0x58249a(0x115)]});return clearTimeout(_0x2355ae),await _0x1f993e[_0x58249a(0x168)]();}catch(_0x4d1d8e){return{'success':![],'error':String(_0x4d1d8e)};}}function formatTime(_0x2563f4){const _0x5ec61d=a0_0x1e6f85,_0x8fffd1=new Date(_0x2563f4);return String(_0x8fffd1[_0x5ec61d(0x16c)]())[_0x5ec61d(0x134)](0x2,'0')+':'+String(_0x8fffd1[_0x5ec61d(0x16d)]())[_0x5ec61d(0x134)](0x2,'0');}function createMessageElement(_0xd357ab,_0x197600){const _0x475a26=a0_0x1e6f85,_0x3179a8=document['createElement'](_0x475a26(0x182));_0x3179a8['className']=_0x475a26(0x118)+_0xd357ab[_0x475a26(0x17f)];const _0x153afc=document[_0x475a26(0x110)](_0x475a26(0x182));_0x153afc[_0x475a26(0x170)]=_0x475a26(0x174),_0x153afc[_0x475a26(0x127)]=_0xd357ab[_0x475a26(0x10c)][_0x475a26(0x16b)](/\n/g,'<br>');const _0x382193=document[_0x475a26(0x110)](_0x475a26(0x182));_0x382193[_0x475a26(0x170)]=_0x475a26(0x140),_0x382193[_0x475a26(0x127)]=_0x475a26(0x179),_0x382193['onclick']=_0x1c077a=>{_0x1c077a['stopPropagation'](),confirmDelete(_0x197600);};let _0x4ef41d;_0x153afc[_0x475a26(0x15b)](_0x475a26(0x132),()=>_0x4ef41d=setTimeout(()=>{const _0x1c8eae=_0x475a26;_0x3179a8[_0x1c8eae(0x11a)][_0x1c8eae(0x144)](_0x1c8eae(0x10d));if(tg?.[_0x1c8eae(0x124)])tg['HapticFeedback'][_0x1c8eae(0x117)]('medium');},0x1f4)),_0x153afc[_0x475a26(0x15b)]('touchend',()=>clearTimeout(_0x4ef41d));const _0x3e0861=document['createElement'](_0x475a26(0x182));return _0x3e0861[_0x475a26(0x170)]=_0x475a26(0x151),_0x3e0861['textContent']=formatTime(_0xd357ab['timestamp']),_0x3179a8[_0x475a26(0x10b)](_0x382193),_0x3179a8[_0x475a26(0x10b)](_0x153afc),_0x3179a8[_0x475a26(0x10b)](_0x3e0861),_0x3179a8;}function createTypingIndicator(){const _0x43601d=a0_0x1e6f85,_0xedf4ac=document[_0x43601d(0x110)](_0x43601d(0x182));return _0xedf4ac[_0x43601d(0x170)]=_0x43601d(0x156),_0xedf4ac['id']=_0x43601d(0x177),_0xedf4ac[_0x43601d(0x127)]=_0x43601d(0x10e),_0xedf4ac;}function renderMessages(){const _0x32d40d=a0_0x1e6f85;Array[_0x32d40d(0x141)](chatArea['children'])['forEach'](_0x276b80=>{const _0x30a130=_0x32d40d;if(_0x276b80['id']!==_0x30a130(0x176))_0x276b80[_0x30a130(0x12b)]();}),messages[_0x32d40d(0x180)]>0x0?(emptyState[_0x32d40d(0x135)][_0x32d40d(0x14f)]=_0x32d40d(0x14b),messages[_0x32d40d(0x112)]((_0x247122,_0xf7c5d7)=>chatArea[_0x32d40d(0x10b)](createMessageElement(_0x247122,_0xf7c5d7)))):emptyState['style'][_0x32d40d(0x14f)]=_0x32d40d(0x18c),requestAnimationFrame(()=>chatArea[_0x32d40d(0x158)]=chatArea[_0x32d40d(0x136)]);}function autoResizeTextarea(){const _0x1c66c4=a0_0x1e6f85;messageInput['style'][_0x1c66c4(0x18a)]=_0x1c66c4(0x13e),messageInput['style']['height']=Math[_0x1c66c4(0x164)](messageInput[_0x1c66c4(0x136)],0x78)+'px';}function updateSendButton(){const _0x383250=a0_0x1e6f85,_0x169440=messageInput['value'][_0x383250(0x15f)]();sendBtn[_0x383250(0x142)]=!_0x169440||isTyping;}async function sendMessage(){const _0x2b1768=a0_0x1e6f85,_0x4e3a15=messageInput[_0x2b1768(0x138)][_0x2b1768(0x15f)]();if(!_0x4e3a15||isTyping)return;if(tg?.[_0x2b1768(0x124)])tg[_0x2b1768(0x124)][_0x2b1768(0x117)]('light');messages[_0x2b1768(0x188)]({'role':_0x2b1768(0x13f),'content':_0x4e3a15,'timestamp':Date[_0x2b1768(0x18b)]()}),localStorage[_0x2b1768(0x116)](_0x2b1768(0x128),JSON[_0x2b1768(0x12e)](messages)),renderMessages(),messageInput[_0x2b1768(0x138)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2b1768(0x10b)](createTypingIndicator()),chatArea[_0x2b1768(0x158)]=chatArea[_0x2b1768(0x136)];const _0x30ac6c=await callBackend(_0x2b1768(0x17c),{'message':_0x4e3a15});isTyping=![];const _0x5d89b5=document[_0x2b1768(0x155)]('typingIndicator');if(_0x5d89b5)_0x5d89b5[_0x2b1768(0x12b)]();let _0x5f289f=_0x2b1768(0x12f);if(_0x30ac6c[_0x2b1768(0x133)]){_0x5f289f=_0x30ac6c[_0x2b1768(0x145)]||_0x2b1768(0x146);if(tg?.[_0x2b1768(0x124)])tg['HapticFeedback'][_0x2b1768(0x14a)](_0x2b1768(0x133));}else{_0x5f289f=_0x30ac6c['error']||_0x2b1768(0x14e);if(tg?.[_0x2b1768(0x124)])tg[_0x2b1768(0x124)][_0x2b1768(0x14a)]('error');}messages[_0x2b1768(0x188)]({'role':'ai','content':_0x5f289f,'timestamp':Date['now']()}),localStorage[_0x2b1768(0x116)](_0x2b1768(0x128),JSON[_0x2b1768(0x12e)](messages)),renderMessages();}function confirmDelete(_0x54e701){const _0x7d4b3d=a0_0x1e6f85;if(mTitle)mTitle[_0x7d4b3d(0x113)]=_0x7d4b3d(0x11e);if(mText)mText[_0x7d4b3d(0x113)]='Действие\x20необратимо.';modalCallback=()=>{const _0x3cf849=_0x7d4b3d;messages[_0x3cf849(0x111)](_0x54e701,0x1),localStorage[_0x3cf849(0x116)](_0x3cf849(0x128),JSON['stringify'](messages)),renderMessages();},modal[_0x7d4b3d(0x11a)][_0x7d4b3d(0x144)]('show');}if(clearBtn)clearBtn[a0_0x1e6f85(0x186)]=()=>{const _0x42bae7=a0_0x1e6f85;if(!messages[_0x42bae7(0x180)])return;if(mTitle)mTitle[_0x42bae7(0x113)]=_0x42bae7(0x17a);if(mText)mText[_0x42bae7(0x113)]=_0x42bae7(0x157);modalCallback=async()=>{const _0x584355=_0x42bae7;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x584355(0x167),{});},modal['classList'][_0x42bae7(0x144)](_0x42bae7(0x125));};document[a0_0x1e6f85(0x155)](a0_0x1e6f85(0x11b))[a0_0x1e6f85(0x186)]=()=>modal[a0_0x1e6f85(0x11a)][a0_0x1e6f85(0x12b)](a0_0x1e6f85(0x125)),document[a0_0x1e6f85(0x155)]('modalConfirm')[a0_0x1e6f85(0x186)]=()=>{const _0x194aae=a0_0x1e6f85;if(modalCallback)modalCallback();modal[_0x194aae(0x11a)][_0x194aae(0x12b)](_0x194aae(0x125));},messageInput[a0_0x1e6f85(0x15b)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1e6f85(0x15b)](a0_0x1e6f85(0x123),_0x4584b4=>{const _0x359558=a0_0x1e6f85;_0x4584b4['key']==='Enter'&&!_0x4584b4['shiftKey']&&(_0x4584b4[_0x359558(0x150)](),sendMessage());}),sendBtn[a0_0x1e6f85(0x186)]=sendMessage,document['addEventListener']('click',_0x525a74=>{const _0x27d3c5=a0_0x1e6f85;document[_0x27d3c5(0x11f)](_0x27d3c5(0x12a))[_0x27d3c5(0x112)](_0x1de62e=>{const _0x3458e5=_0x27d3c5;if(!_0x1de62e[_0x3458e5(0x10f)](_0x525a74[_0x3458e5(0x13a)]))_0x1de62e[_0x3458e5(0x11a)][_0x3458e5(0x12b)](_0x3458e5(0x10d));});});const saved=localStorage['getItem'](a0_0x1e6f85(0x128));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x5bb3a8){}updateSendButton();