const a0_0x5ed029=a0_0x40b9;function a0_0x4187(){const _0x28a7b1=['confirmModal','5534742QWoJEv','flex','click','auto','Ошибка\x20сети','length','message\x20','resize','<br>','min','chatArea','display','paddingBottom','innerHeight','success','delete-btn','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','push','Начнется\x20новый\x20диалог.','1729535TTRVan','POST','replace','touchend','user','7QkJPlp','text','ready','27BvxBhm','modalTitle','offsetHeight','children','apply','Пустой\x20ответ','viewportHeight','inputArea','initData','modalConfirm','debug_uid','.message.show-delete','search','onclick','3958041tjEgyb','content','Действие\x20необратимо.','2egCAEd','createElement','classList','value','parse','send_message','getElementById','focus','keydown','stringify','abort','1930150EbYoSR','clear_history','function','warn','show-delete','shiftKey','from','first_name','Удалить?','remove','json','height','modalCancel','22Wnqahd','viewportChanged','impactOccurred','clearBtn','HapticFeedback','messageInput','contains','getItem','constructor','addEventListener','message-time','6.1','disabled','setItem','scrollHeight','disableVerticalSwipes','TG\x20setup\x20error:','toString','add','text/plain','./router.html','textContent','Очистить\x20историю?','div','BackButton','ai_chat_messages','offClick','splice','onClick','padStart','input','31941EbOgWS','trim','(((.+)+)+)+$','WebApp','role','error','now','isVersionAtLeast','message-bubble','show','querySelectorAll','51638736BxvlaL','16WpOOGm','modalText','emptyState','initDataUnsafe','none','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','innerHTML','typingIndicator','light','1585288oniJQC','message\x20ai','floor','forEach','style','appendChild','touchstart','medium','Telegram','Enter','random','scrollTop','#050505','key','Ошибка\x20сервера','className','preventDefault','notificationOccurred','href'];a0_0x4187=function(){return _0x28a7b1;};return a0_0x4187();}(function(_0x3f220b,_0x1a9164){const _0x87868=a0_0x40b9,_0xb406d7=_0x3f220b();while(!![]){try{const _0x4b6a26=-parseInt(_0x87868(0x185))/0x1*(-parseInt(_0x87868(0x14e))/0x2)+-parseInt(_0x87868(0x1d7))/0x3+parseInt(_0x87868(0x191))/0x4*(-parseInt(_0x87868(0x1c1))/0x5)+-parseInt(_0x87868(0x1ae))/0x6*(parseInt(_0x87868(0x1c6))/0x7)+-parseInt(_0x87868(0x19a))/0x8*(-parseInt(_0x87868(0x1c9))/0x9)+parseInt(_0x87868(0x159))/0xa*(-parseInt(_0x87868(0x166))/0xb)+parseInt(_0x87868(0x190))/0xc;if(_0x4b6a26===_0x1a9164)break;else _0xb406d7['push'](_0xb406d7['shift']());}catch(_0x2da6a9){_0xb406d7['push'](_0xb406d7['shift']());}}}(a0_0x4187,0xe02ae));const tg=window[a0_0x5ed029(0x1a2)]?.[a0_0x5ed029(0x188)],HOME_URL=a0_0x5ed029(0x17a);function setupTelegramBackButton(){const _0x139c26=a0_0x5ed029;if(!tg)return;try{tg[_0x139c26(0x1c8)](),tg['expand'](),tg['setHeaderColor']?.(_0x139c26(0x1a6));if(tg[_0x139c26(0x18c)]?.(_0x139c26(0x171)))tg[_0x139c26(0x175)]?.();const _0x255fcc=tg[_0x139c26(0x17e)];if(_0x255fcc){_0x255fcc[_0x139c26(0x18e)]();if(typeof _0x255fcc[_0x139c26(0x180)]===_0x139c26(0x15b))try{_0x255fcc[_0x139c26(0x180)]();}catch(_0x3acef6){}_0x255fcc[_0x139c26(0x182)](()=>{const _0x454a5a=_0x139c26;if(tg[_0x454a5a(0x16a)])tg[_0x454a5a(0x16a)][_0x454a5a(0x168)](_0x454a5a(0x199));location[_0x454a5a(0x1ac)]=HOME_URL;});}}catch(_0x2e6f68){console[_0x139c26(0x15c)](_0x139c26(0x176),_0x2e6f68);}}(function initStableLayout(){const _0x47a3bb=a0_0x5ed029,_0x1df027=(function(){let _0x4b540d=!![];return function(_0x180514,_0x501b31){const _0xce28ed=_0x4b540d?function(){const _0x1426db=a0_0x40b9;if(_0x501b31){const _0x42afaa=_0x501b31[_0x1426db(0x1cd)](_0x180514,arguments);return _0x501b31=null,_0x42afaa;}}:function(){};return _0x4b540d=![],_0xce28ed;};}()),_0x2a682c=document['querySelector']('.container'),_0xda86ad=document[_0x47a3bb(0x154)](_0x47a3bb(0x1d0)),_0x20b4ff=document['getElementById'](_0x47a3bb(0x1b8)),_0x2725e8=document[_0x47a3bb(0x154)](_0x47a3bb(0x16b));function _0x4828fe(){const _0x126029=_0x47a3bb,_0x5e8887=_0x1df027(this,function(){const _0x24294e=a0_0x40b9;return _0x5e8887[_0x24294e(0x177)]()['search'](_0x24294e(0x187))[_0x24294e(0x177)]()[_0x24294e(0x16e)](_0x5e8887)[_0x24294e(0x1d5)]('(((.+)+)+)+$');});_0x5e8887();if(!_0x2a682c)return;const _0x292a85=tg&&tg[_0x126029(0x1cf)]?tg[_0x126029(0x1cf)]:window[_0x126029(0x1bb)];_0x2a682c[_0x126029(0x19e)][_0x126029(0x164)]=_0x292a85+'px';if(_0xda86ad){const _0x303e03=_0xda86ad[_0x126029(0x1cb)];_0x20b4ff[_0x126029(0x19e)][_0x126029(0x1ba)]=_0x303e03+0x28+'px';}}tg?tg['onEvent'](_0x47a3bb(0x167),({isStateStable:_0x498728})=>{_0x4828fe();if(_0x498728)requestAnimationFrame(()=>{const _0x244494=a0_0x40b9;_0x20b4ff[_0x244494(0x1a5)]=_0x20b4ff['scrollHeight'];});}):window[_0x47a3bb(0x16f)](_0x47a3bb(0x1b5),_0x4828fe),_0x4828fe(),_0x2725e8&&(_0x2725e8[_0x47a3bb(0x16f)](_0x47a3bb(0x184),()=>{requestAnimationFrame(_0x4828fe);}),_0x2725e8[_0x47a3bb(0x16f)](_0x47a3bb(0x155),()=>{setTimeout(()=>{const _0x3c4bd7=a0_0x40b9;_0x20b4ff[_0x3c4bd7(0x1a5)]=_0x20b4ff[_0x3c4bd7(0x174)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x5ed029(0x1b8)),emptyState=document['getElementById'](a0_0x5ed029(0x193)),messageInput=document[a0_0x5ed029(0x154)](a0_0x5ed029(0x16b)),sendBtn=document[a0_0x5ed029(0x154)]('sendBtn'),clearBtn=document[a0_0x5ed029(0x154)](a0_0x5ed029(0x169)),modal=document['getElementById'](a0_0x5ed029(0x1ad)),mTitle=document[a0_0x5ed029(0x154)](a0_0x5ed029(0x1ca)),mText=document[a0_0x5ed029(0x154)](a0_0x5ed029(0x192));let modalCallback=null;function a0_0x40b9(_0x41c988,_0x2e2d47){_0x41c988=_0x41c988-0x14e;const _0x1b2117=a0_0x4187();let _0x3c4431=_0x1b2117[_0x41c988];return _0x3c4431;}async function callBackend(_0x3e4aea,_0x1cb676){const _0x45d5de=a0_0x5ed029,_0x537b84=tg?.[_0x45d5de(0x194)]?.[_0x45d5de(0x1c5)]||{},_0x5ce836=_0x537b84['id']||localStorage[_0x45d5de(0x16d)](_0x45d5de(0x1d3))||'d-'+Math[_0x45d5de(0x19c)](Math[_0x45d5de(0x1a4)]()*0x3b9aca00);if(!_0x537b84['id'])localStorage[_0x45d5de(0x173)](_0x45d5de(0x1d3),_0x5ce836);const _0x1c11e6={'action':_0x3e4aea,'user_id':_0x5ce836,'user_data':{'first_name':_0x537b84[_0x45d5de(0x160)],'username':_0x537b84['username']},'init_data':tg?.[_0x45d5de(0x1d1)]||'',..._0x1cb676},_0x56684d=new AbortController(),_0xabbaf1=setTimeout(()=>_0x56684d[_0x45d5de(0x158)](),REQUEST_TIMEOUT_MS);try{const _0x1e0b33=await fetch(BACKEND_URL,{'method':_0x45d5de(0x1c2),'headers':{'Content-Type':_0x45d5de(0x179)},'body':JSON['stringify'](_0x1c11e6),'signal':_0x56684d['signal']});return clearTimeout(_0xabbaf1),await _0x1e0b33[_0x45d5de(0x163)]();}catch(_0x25a44b){return{'success':![],'error':String(_0x25a44b)};}}function formatTime(_0x212933){const _0x6cf706=a0_0x5ed029,_0x1894b0=new Date(_0x212933);return String(_0x1894b0['getHours']())[_0x6cf706(0x183)](0x2,'0')+':'+String(_0x1894b0['getMinutes']())[_0x6cf706(0x183)](0x2,'0');}function createMessageElement(_0x196215,_0x306842){const _0x314da6=a0_0x5ed029,_0x292e66=document[_0x314da6(0x14f)](_0x314da6(0x17d));_0x292e66[_0x314da6(0x1a9)]=_0x314da6(0x1b4)+_0x196215[_0x314da6(0x189)];const _0x5d6fa3=document[_0x314da6(0x14f)](_0x314da6(0x17d));_0x5d6fa3['className']=_0x314da6(0x18d),_0x5d6fa3['innerHTML']=_0x196215[_0x314da6(0x1d8)][_0x314da6(0x1c3)](/\n/g,_0x314da6(0x1b6));const _0x399c99=document[_0x314da6(0x14f)](_0x314da6(0x17d));_0x399c99[_0x314da6(0x1a9)]=_0x314da6(0x1bd),_0x399c99[_0x314da6(0x197)]=_0x314da6(0x196),_0x399c99['onclick']=_0x1f1f78=>{_0x1f1f78['stopPropagation'](),confirmDelete(_0x306842);};let _0x1a1c40;_0x5d6fa3[_0x314da6(0x16f)](_0x314da6(0x1a0),()=>_0x1a1c40=setTimeout(()=>{const _0xcd4715=_0x314da6;_0x292e66[_0xcd4715(0x150)][_0xcd4715(0x178)](_0xcd4715(0x15d));if(tg?.['HapticFeedback'])tg[_0xcd4715(0x16a)]['impactOccurred'](_0xcd4715(0x1a1));},0x1f4)),_0x5d6fa3['addEventListener'](_0x314da6(0x1c4),()=>clearTimeout(_0x1a1c40));const _0x4bdac8=document[_0x314da6(0x14f)](_0x314da6(0x17d));return _0x4bdac8['className']=_0x314da6(0x170),_0x4bdac8[_0x314da6(0x17b)]=formatTime(_0x196215['timestamp']),_0x292e66[_0x314da6(0x19f)](_0x399c99),_0x292e66[_0x314da6(0x19f)](_0x5d6fa3),_0x292e66['appendChild'](_0x4bdac8),_0x292e66;}function createTypingIndicator(){const _0x25ac95=a0_0x5ed029,_0x45e1b1=document[_0x25ac95(0x14f)]('div');return _0x45e1b1['className']=_0x25ac95(0x19b),_0x45e1b1['id']=_0x25ac95(0x198),_0x45e1b1[_0x25ac95(0x197)]=_0x25ac95(0x1be),_0x45e1b1;}function renderMessages(){const _0x4df898=a0_0x5ed029;Array[_0x4df898(0x15f)](chatArea[_0x4df898(0x1cc)])[_0x4df898(0x19d)](_0xb9f193=>{const _0x5049ca=_0x4df898;if(_0xb9f193['id']!==_0x5049ca(0x193))_0xb9f193['remove']();}),messages['length']>0x0?(emptyState[_0x4df898(0x19e)][_0x4df898(0x1b9)]=_0x4df898(0x195),messages[_0x4df898(0x19d)]((_0x11528f,_0x52daee)=>chatArea[_0x4df898(0x19f)](createMessageElement(_0x11528f,_0x52daee)))):emptyState[_0x4df898(0x19e)]['display']=_0x4df898(0x1af),requestAnimationFrame(()=>chatArea[_0x4df898(0x1a5)]=chatArea[_0x4df898(0x174)]);}function autoResizeTextarea(){const _0x2dbf1b=a0_0x5ed029;messageInput[_0x2dbf1b(0x19e)][_0x2dbf1b(0x164)]=_0x2dbf1b(0x1b1),messageInput[_0x2dbf1b(0x19e)][_0x2dbf1b(0x164)]=Math[_0x2dbf1b(0x1b7)](messageInput[_0x2dbf1b(0x174)],0x78)+'px';}function updateSendButton(){const _0x3f4589=a0_0x5ed029,_0x23e234=messageInput[_0x3f4589(0x151)][_0x3f4589(0x186)]();sendBtn[_0x3f4589(0x172)]=!_0x23e234||isTyping;}async function sendMessage(){const _0x2177c8=a0_0x5ed029,_0x5daaf7=messageInput[_0x2177c8(0x151)]['trim']();if(!_0x5daaf7||isTyping)return;if(tg?.[_0x2177c8(0x16a)])tg[_0x2177c8(0x16a)][_0x2177c8(0x168)](_0x2177c8(0x199));messages[_0x2177c8(0x1bf)]({'role':_0x2177c8(0x1c5),'content':_0x5daaf7,'timestamp':Date[_0x2177c8(0x18b)]()}),localStorage['setItem'](_0x2177c8(0x17f),JSON[_0x2177c8(0x157)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2177c8(0x19f)](createTypingIndicator()),chatArea[_0x2177c8(0x1a5)]=chatArea[_0x2177c8(0x174)];const _0x381a48=await callBackend(_0x2177c8(0x153),{'message':_0x5daaf7});isTyping=![];const _0x5c6938=document['getElementById'](_0x2177c8(0x198));if(_0x5c6938)_0x5c6938[_0x2177c8(0x162)]();let _0x171c15=_0x2177c8(0x1b2);if(_0x381a48[_0x2177c8(0x1bc)]){_0x171c15=_0x381a48[_0x2177c8(0x1c7)]||_0x2177c8(0x1ce);if(tg?.[_0x2177c8(0x16a)])tg['HapticFeedback'][_0x2177c8(0x1ab)](_0x2177c8(0x1bc));}else{_0x171c15=_0x381a48[_0x2177c8(0x18a)]||_0x2177c8(0x1a8);if(tg?.[_0x2177c8(0x16a)])tg['HapticFeedback'][_0x2177c8(0x1ab)](_0x2177c8(0x18a));}messages[_0x2177c8(0x1bf)]({'role':'ai','content':_0x171c15,'timestamp':Date['now']()}),localStorage[_0x2177c8(0x173)](_0x2177c8(0x17f),JSON[_0x2177c8(0x157)](messages)),renderMessages();}function confirmDelete(_0x29ccb7){const _0x586af8=a0_0x5ed029;if(mTitle)mTitle['textContent']=_0x586af8(0x161);if(mText)mText[_0x586af8(0x17b)]=_0x586af8(0x1d9);modalCallback=()=>{const _0x55157a=_0x586af8;messages[_0x55157a(0x181)](_0x29ccb7,0x1),localStorage[_0x55157a(0x173)]('ai_chat_messages',JSON[_0x55157a(0x157)](messages)),renderMessages();},modal[_0x586af8(0x150)][_0x586af8(0x178)](_0x586af8(0x18e));}if(clearBtn)clearBtn[a0_0x5ed029(0x1d6)]=()=>{const _0x43747c=a0_0x5ed029;if(!messages[_0x43747c(0x1b3)])return;if(mTitle)mTitle[_0x43747c(0x17b)]=_0x43747c(0x17c);if(mText)mText['textContent']=_0x43747c(0x1c0);modalCallback=async()=>{const _0x1882a3=_0x43747c;messages=[],localStorage['removeItem'](_0x1882a3(0x17f)),renderMessages(),callBackend(_0x1882a3(0x15a),{});},modal[_0x43747c(0x150)][_0x43747c(0x178)]('show');};document[a0_0x5ed029(0x154)](a0_0x5ed029(0x165))['onclick']=()=>modal['classList'][a0_0x5ed029(0x162)](a0_0x5ed029(0x18e)),document[a0_0x5ed029(0x154)](a0_0x5ed029(0x1d2))[a0_0x5ed029(0x1d6)]=()=>{const _0x1fc882=a0_0x5ed029;if(modalCallback)modalCallback();modal[_0x1fc882(0x150)]['remove'](_0x1fc882(0x18e));},messageInput[a0_0x5ed029(0x16f)](a0_0x5ed029(0x184),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x5ed029(0x156),_0x1bbf27=>{const _0xab9091=a0_0x5ed029;_0x1bbf27[_0xab9091(0x1a7)]===_0xab9091(0x1a3)&&!_0x1bbf27[_0xab9091(0x15e)]&&(_0x1bbf27[_0xab9091(0x1aa)](),sendMessage());}),sendBtn[a0_0x5ed029(0x1d6)]=sendMessage,document[a0_0x5ed029(0x16f)](a0_0x5ed029(0x1b0),_0x3392bc=>{const _0x5282bc=a0_0x5ed029;document[_0x5282bc(0x18f)](_0x5282bc(0x1d4))[_0x5282bc(0x19d)](_0x4c99ef=>{const _0x2fb01b=_0x5282bc;if(!_0x4c99ef[_0x2fb01b(0x16c)](_0x3392bc['target']))_0x4c99ef[_0x2fb01b(0x150)][_0x2fb01b(0x162)]('show-delete');});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x5ed029(0x152)](saved),renderMessages();}catch(a0_0x2ffe7b){}updateSendButton();