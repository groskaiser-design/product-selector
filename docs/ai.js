const a0_0x22b3e9=a0_0x38e8;(function(_0x3aecec,_0x2cbd48){const _0x22009f=a0_0x38e8,_0x2f7de9=_0x3aecec();while(!![]){try{const _0x961afa=-parseInt(_0x22009f(0x220))/0x1+parseInt(_0x22009f(0x1e4))/0x2*(-parseInt(_0x22009f(0x1c5))/0x3)+-parseInt(_0x22009f(0x1c3))/0x4*(-parseInt(_0x22009f(0x206))/0x5)+-parseInt(_0x22009f(0x20d))/0x6+-parseInt(_0x22009f(0x1cb))/0x7+parseInt(_0x22009f(0x1f5))/0x8*(-parseInt(_0x22009f(0x1d0))/0x9)+parseInt(_0x22009f(0x1da))/0xa;if(_0x961afa===_0x2cbd48)break;else _0x2f7de9['push'](_0x2f7de9['shift']());}catch(_0x372b8a){_0x2f7de9['push'](_0x2f7de9['shift']());}}}(a0_0x39f1,0x5d9d1));const tg=window['Telegram']?.[a0_0x22b3e9(0x1c9)],HOME_URL=a0_0x22b3e9(0x216);function setupTelegramBackButton(){const _0x396302=a0_0x22b3e9,_0x2a2435=(function(){let _0x176146=!![];return function(_0x4d616d,_0x2254d3){const _0x499c37=_0x176146?function(){const _0x152a5a=a0_0x38e8;if(_0x2254d3){const _0x2310d0=_0x2254d3[_0x152a5a(0x1ac)](_0x4d616d,arguments);return _0x2254d3=null,_0x2310d0;}}:function(){};return _0x176146=![],_0x499c37;};}()),_0x5da710=_0x2a2435(this,function(){const _0x266053=a0_0x38e8;return _0x5da710['toString']()[_0x266053(0x204)](_0x266053(0x1c6))['toString']()[_0x266053(0x1a4)](_0x5da710)['search'](_0x266053(0x1c6));});_0x5da710();if(!tg)return;try{tg[_0x396302(0x1e9)](),tg[_0x396302(0x1eb)](),tg[_0x396302(0x1f4)]?.(_0x396302(0x1d4));if(tg[_0x396302(0x1ad)]?.('6.1'))tg[_0x396302(0x1df)]?.();const _0x1a2cb1=tg['BackButton'];if(_0x1a2cb1){_0x1a2cb1[_0x396302(0x1fd)]();if(typeof _0x1a2cb1['offClick']===_0x396302(0x1c0))try{_0x1a2cb1[_0x396302(0x1ff)]();}catch(_0x3071ab){}_0x1a2cb1['onClick'](()=>{const _0x146d30=_0x396302;if(tg[_0x146d30(0x205)])tg[_0x146d30(0x205)][_0x146d30(0x202)]('light');location['href']=HOME_URL;});}}catch(_0x442b6c){console['warn']('TG\x20setup\x20error:',_0x442b6c);}}(function initStableLayout(){const _0x447d77=a0_0x22b3e9,_0x269b6e=document['querySelector'](_0x447d77(0x20c)),_0x50b1bf=document['getElementById'](_0x447d77(0x215)),_0x13dca8=document['getElementById'](_0x447d77(0x1c8)),_0x1f7d7c=document['getElementById'](_0x447d77(0x1cc));function _0x3a19d6(){const _0x1e8561=_0x447d77;if(!_0x269b6e)return;const _0x56188f=tg&&tg['viewportHeight']?tg[_0x1e8561(0x1cf)]:window[_0x1e8561(0x1b4)];_0x269b6e[_0x1e8561(0x1b5)][_0x1e8561(0x1bf)]=_0x56188f+'px';if(_0x50b1bf){const _0x2b3ddb=_0x50b1bf[_0x1e8561(0x209)];_0x13dca8[_0x1e8561(0x1b5)][_0x1e8561(0x20b)]=_0x2b3ddb+0x28+'px';}}tg?tg[_0x447d77(0x1a5)](_0x447d77(0x1c4),({isStateStable:_0x1c2d63})=>{_0x3a19d6();if(_0x1c2d63)requestAnimationFrame(()=>{const _0x4323a9=a0_0x38e8;_0x13dca8[_0x4323a9(0x1de)]=_0x13dca8[_0x4323a9(0x21b)];});}):window[_0x447d77(0x1f7)](_0x447d77(0x1e6),_0x3a19d6),_0x3a19d6(),_0x1f7d7c&&(_0x1f7d7c[_0x447d77(0x1f7)](_0x447d77(0x1ee),()=>{requestAnimationFrame(_0x3a19d6);}),_0x1f7d7c[_0x447d77(0x1f7)](_0x447d77(0x1e7),()=>{setTimeout(()=>{const _0x4a0b85=a0_0x38e8;_0x13dca8[_0x4a0b85(0x1de)]=_0x13dca8[_0x4a0b85(0x21b)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x22b3e9(0x1fe)](a0_0x22b3e9(0x1c8)),emptyState=document[a0_0x22b3e9(0x1fe)](a0_0x22b3e9(0x222)),messageInput=document[a0_0x22b3e9(0x1fe)]('messageInput'),sendBtn=document[a0_0x22b3e9(0x1fe)]('sendBtn'),clearBtn=document[a0_0x22b3e9(0x1fe)](a0_0x22b3e9(0x1ca)),modal=document[a0_0x22b3e9(0x1fe)](a0_0x22b3e9(0x203)),mTitle=document[a0_0x22b3e9(0x1fe)](a0_0x22b3e9(0x20f)),mText=document[a0_0x22b3e9(0x1fe)](a0_0x22b3e9(0x1d8));let modalCallback=null;async function callBackend(_0x4d97f4,_0x40c0e5){const _0x26f49b=a0_0x22b3e9,_0x284b34=tg?.[_0x26f49b(0x211)]?.[_0x26f49b(0x212)]||{},_0x78d378=_0x284b34['id']||localStorage[_0x26f49b(0x221)](_0x26f49b(0x1a9))||'d-'+Math[_0x26f49b(0x224)](Math[_0x26f49b(0x1be)]()*0x3b9aca00);if(!_0x284b34['id'])localStorage[_0x26f49b(0x1dc)](_0x26f49b(0x1a9),_0x78d378);const _0x269e01={'action':_0x4d97f4,'user_id':_0x78d378,'user_data':{'first_name':_0x284b34['first_name'],'username':_0x284b34[_0x26f49b(0x1e8)]},'init_data':tg?.['initData']||'',..._0x40c0e5},_0x249536=new AbortController(),_0x503106=setTimeout(()=>_0x249536[_0x26f49b(0x21a)](),REQUEST_TIMEOUT_MS);try{const _0x164040=await fetch(BACKEND_URL,{'method':_0x26f49b(0x1c2),'headers':{'Content-Type':_0x26f49b(0x1b0)},'body':JSON[_0x26f49b(0x210)](_0x269e01),'signal':_0x249536[_0x26f49b(0x214)]});return clearTimeout(_0x503106),await _0x164040['json']();}catch(_0x574111){return{'success':![],'error':String(_0x574111)};}}function formatTime(_0x2aa134){const _0x50c3ef=a0_0x22b3e9,_0x3f717e=new Date(_0x2aa134);return String(_0x3f717e[_0x50c3ef(0x219)]())['padStart'](0x2,'0')+':'+String(_0x3f717e[_0x50c3ef(0x208)]())[_0x50c3ef(0x1a8)](0x2,'0');}function createMessageElement(_0x3c6504,_0x7eff8){const _0x23f591=a0_0x22b3e9,_0x47637b=document['createElement'](_0x23f591(0x1dd));_0x47637b[_0x23f591(0x1af)]=_0x23f591(0x1fb)+_0x3c6504[_0x23f591(0x21d)];const _0x48fad7=document[_0x23f591(0x1f6)](_0x23f591(0x1dd));_0x48fad7['className']=_0x23f591(0x1f9),_0x48fad7[_0x23f591(0x1ab)]=_0x3c6504[_0x23f591(0x1e1)][_0x23f591(0x1bd)](/\n/g,_0x23f591(0x21c));const _0x59ebde=document[_0x23f591(0x1f6)]('div');_0x59ebde[_0x23f591(0x1af)]=_0x23f591(0x1d6),_0x59ebde['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x59ebde[_0x23f591(0x1c7)]=_0x4490be=>{const _0x1ebd3b=_0x23f591;_0x4490be[_0x1ebd3b(0x1cd)](),confirmDelete(_0x7eff8);};let _0x265705;_0x48fad7[_0x23f591(0x1f7)](_0x23f591(0x1bb),()=>_0x265705=setTimeout(()=>{const _0x44b86d=_0x23f591;_0x47637b['classList']['add'](_0x44b86d(0x1f2));if(tg?.[_0x44b86d(0x205)])tg[_0x44b86d(0x205)][_0x44b86d(0x202)]('medium');},0x1f4)),_0x48fad7[_0x23f591(0x1f7)](_0x23f591(0x1ed),()=>clearTimeout(_0x265705));const _0x345faa=document['createElement'](_0x23f591(0x1dd));return _0x345faa[_0x23f591(0x1af)]=_0x23f591(0x1d2),_0x345faa[_0x23f591(0x1ef)]=formatTime(_0x3c6504[_0x23f591(0x1f0)]),_0x47637b[_0x23f591(0x1d9)](_0x59ebde),_0x47637b[_0x23f591(0x1d9)](_0x48fad7),_0x47637b[_0x23f591(0x1d9)](_0x345faa),_0x47637b;}function createTypingIndicator(){const _0x241d1a=a0_0x22b3e9,_0x1ea064=document[_0x241d1a(0x1f6)](_0x241d1a(0x1dd));return _0x1ea064[_0x241d1a(0x1af)]=_0x241d1a(0x20e),_0x1ea064['id']=_0x241d1a(0x1b1),_0x1ea064[_0x241d1a(0x1ab)]=_0x241d1a(0x201),_0x1ea064;}function renderMessages(){const _0x50dfb1=a0_0x22b3e9;Array[_0x50dfb1(0x1a6)](chatArea[_0x50dfb1(0x21f)])['forEach'](_0x293bfd=>{const _0x4cd60d=_0x50dfb1;if(_0x293bfd['id']!==_0x4cd60d(0x222))_0x293bfd['remove']();}),messages['length']>0x0?(emptyState[_0x50dfb1(0x1b5)]['display']='none',messages[_0x50dfb1(0x20a)]((_0x10dc94,_0x49d3fb)=>chatArea[_0x50dfb1(0x1d9)](createMessageElement(_0x10dc94,_0x49d3fb)))):emptyState[_0x50dfb1(0x1b5)][_0x50dfb1(0x213)]=_0x50dfb1(0x207),requestAnimationFrame(()=>chatArea[_0x50dfb1(0x1de)]=chatArea[_0x50dfb1(0x21b)]);}function autoResizeTextarea(){const _0x1435a1=a0_0x22b3e9;messageInput[_0x1435a1(0x1b5)][_0x1435a1(0x1bf)]='auto',messageInput['style'][_0x1435a1(0x1bf)]=Math[_0x1435a1(0x1d5)](messageInput['scrollHeight'],0x78)+'px';}function a0_0x39f1(){const _0xbfe766=['stopPropagation','removeItem','viewportHeight','18zRUWyd','Ошибка\x20сервера','message-time','notificationOccurred','#050505','min','delete-btn','Enter','modalText','appendChild','26195530ETaHkC','trim','setItem','div','scrollTop','disableVerticalSwipes','clear_history','content','text','shiftKey','10046ulMtnf','.message.show-delete','resize','focus','username','ready','ai_chat_messages','expand','push','touchend','input','textContent','timestamp','value','show-delete','target','setHeaderColor','1361432KvKRhK','createElement','addEventListener','success','message-bubble','contains','message\x20','add','show','getElementById','offClick','now','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','impactOccurred','confirmModal','search','HapticFeedback','10JKBJSA','flex','getMinutes','offsetHeight','forEach','paddingBottom','.container','642462EsoWKK','message\x20ai','modalTitle','stringify','initDataUnsafe','user','display','signal','inputArea','./router.html','Действие\x20необратимо.','Начнется\x20новый\x20диалог.','getHours','abort','scrollHeight','<br>','role','disabled','children','570304zlMtmE','getItem','emptyState','parse','floor','constructor','onEvent','from','send_message','padStart','debug_uid','Пустой\x20ответ','innerHTML','apply','isVersionAtLeast','Ошибка\x20сети','className','text/plain','typingIndicator','Очистить\x20историю?','key','innerHeight','style','classList','preventDefault','click','light','error','touchstart','splice','replace','random','height','function','remove','POST','468860Xhmfah','viewportChanged','411ufwdkE','(((.+)+)+)+$','onclick','chatArea','WebApp','clearBtn','5352564ROenTz','messageInput'];a0_0x39f1=function(){return _0xbfe766;};return a0_0x39f1();}function a0_0x38e8(_0x2f6c21,_0x25f54e){_0x2f6c21=_0x2f6c21-0x1a4;const _0x34097a=a0_0x39f1();let _0x44d5b6=_0x34097a[_0x2f6c21];return _0x44d5b6;}function updateSendButton(){const _0x1713cf=a0_0x22b3e9,_0x7cc704=messageInput[_0x1713cf(0x1f1)][_0x1713cf(0x1db)]();sendBtn[_0x1713cf(0x21e)]=!_0x7cc704||isTyping;}async function sendMessage(){const _0x174398=a0_0x22b3e9,_0x55dca7=messageInput[_0x174398(0x1f1)][_0x174398(0x1db)]();if(!_0x55dca7||isTyping)return;if(tg?.[_0x174398(0x205)])tg[_0x174398(0x205)][_0x174398(0x202)](_0x174398(0x1b9));messages[_0x174398(0x1ec)]({'role':_0x174398(0x212),'content':_0x55dca7,'timestamp':Date[_0x174398(0x200)]()}),localStorage[_0x174398(0x1dc)](_0x174398(0x1ea),JSON[_0x174398(0x210)](messages)),renderMessages(),messageInput[_0x174398(0x1f1)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x174398(0x1d9)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x5ddfcd=await callBackend(_0x174398(0x1a7),{'message':_0x55dca7});isTyping=![];const _0x1612f2=document[_0x174398(0x1fe)](_0x174398(0x1b1));if(_0x1612f2)_0x1612f2[_0x174398(0x1c1)]();let _0x105977=_0x174398(0x1ae);if(_0x5ddfcd[_0x174398(0x1f8)]){_0x105977=_0x5ddfcd[_0x174398(0x1e2)]||_0x174398(0x1aa);if(tg?.[_0x174398(0x205)])tg[_0x174398(0x205)][_0x174398(0x1d3)]('success');}else{_0x105977=_0x5ddfcd[_0x174398(0x1ba)]||_0x174398(0x1d1);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x174398(0x1d3)](_0x174398(0x1ba));}messages[_0x174398(0x1ec)]({'role':'ai','content':_0x105977,'timestamp':Date[_0x174398(0x200)]()}),localStorage[_0x174398(0x1dc)]('ai_chat_messages',JSON[_0x174398(0x210)](messages)),renderMessages();}function confirmDelete(_0x525226){const _0x47d09c=a0_0x22b3e9;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText['textContent']=_0x47d09c(0x217);modalCallback=()=>{const _0x58f720=_0x47d09c;messages[_0x58f720(0x1bc)](_0x525226,0x1),localStorage[_0x58f720(0x1dc)](_0x58f720(0x1ea),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x47d09c(0x1fc)](_0x47d09c(0x1fd));}if(clearBtn)clearBtn['onclick']=()=>{const _0x32f656=a0_0x22b3e9;if(!messages['length'])return;if(mTitle)mTitle[_0x32f656(0x1ef)]=_0x32f656(0x1b2);if(mText)mText[_0x32f656(0x1ef)]=_0x32f656(0x218);modalCallback=async()=>{const _0x117e44=_0x32f656;messages=[],localStorage[_0x117e44(0x1ce)]('ai_chat_messages'),renderMessages(),callBackend(_0x117e44(0x1e0),{});},modal[_0x32f656(0x1b6)][_0x32f656(0x1fc)](_0x32f656(0x1fd));};document[a0_0x22b3e9(0x1fe)]('modalCancel')[a0_0x22b3e9(0x1c7)]=()=>modal['classList'][a0_0x22b3e9(0x1c1)](a0_0x22b3e9(0x1fd)),document[a0_0x22b3e9(0x1fe)]('modalConfirm')[a0_0x22b3e9(0x1c7)]=()=>{const _0x2ff64f=a0_0x22b3e9;if(modalCallback)modalCallback();modal['classList'][_0x2ff64f(0x1c1)]('show');},messageInput['addEventListener'](a0_0x22b3e9(0x1ee),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x22b3e9(0x1f7)]('keydown',_0x5d3f9f=>{const _0x818231=a0_0x22b3e9;_0x5d3f9f[_0x818231(0x1b3)]===_0x818231(0x1d7)&&!_0x5d3f9f[_0x818231(0x1e3)]&&(_0x5d3f9f[_0x818231(0x1b7)](),sendMessage());}),sendBtn[a0_0x22b3e9(0x1c7)]=sendMessage,document[a0_0x22b3e9(0x1f7)](a0_0x22b3e9(0x1b8),_0x51f756=>{const _0x4169c8=a0_0x22b3e9;document['querySelectorAll'](_0x4169c8(0x1e5))['forEach'](_0x2ad5e7=>{const _0x28641d=_0x4169c8;if(!_0x2ad5e7[_0x28641d(0x1fa)](_0x51f756[_0x28641d(0x1f3)]))_0x2ad5e7[_0x28641d(0x1b6)]['remove']('show-delete');});});const saved=localStorage[a0_0x22b3e9(0x221)](a0_0x22b3e9(0x1ea));if(saved)try{messages=JSON[a0_0x22b3e9(0x223)](saved),renderMessages();}catch(a0_0x4bcc31){}updateSendButton();