const a0_0x3571dc=a0_0x5192;(function(_0x54e0fd,_0x5439d3){const _0x4f6480=a0_0x5192,_0x2a3b5c=_0x54e0fd();while(!![]){try{const _0x4c4749=-parseInt(_0x4f6480(0x127))/0x1+-parseInt(_0x4f6480(0x135))/0x2+parseInt(_0x4f6480(0x143))/0x3+-parseInt(_0x4f6480(0xdf))/0x4*(-parseInt(_0x4f6480(0xd9))/0x5)+parseInt(_0x4f6480(0x120))/0x6+parseInt(_0x4f6480(0x130))/0x7*(-parseInt(_0x4f6480(0x107))/0x8)+-parseInt(_0x4f6480(0xde))/0x9;if(_0x4c4749===_0x5439d3)break;else _0x2a3b5c['push'](_0x2a3b5c['shift']());}catch(_0x10e49d){_0x2a3b5c['push'](_0x2a3b5c['shift']());}}}(a0_0x7708,0xe6f99));const tg=window[a0_0x3571dc(0xf6)]?.[a0_0x3571dc(0xd4)],HOME_URL=a0_0x3571dc(0xe8);function setupTelegramBackButton(){const _0x7c03e8=a0_0x3571dc,_0x13f262=(function(){let _0x77f37a=!![];return function(_0x37ac1f,_0x4c88e1){const _0x1ba0ab=_0x77f37a?function(){const _0xd6247d=a0_0x5192;if(_0x4c88e1){const _0x10f912=_0x4c88e1[_0xd6247d(0x140)](_0x37ac1f,arguments);return _0x4c88e1=null,_0x10f912;}}:function(){};return _0x77f37a=![],_0x1ba0ab;};}()),_0x2aab86=_0x13f262(this,function(){const _0x456d81=a0_0x5192;return _0x2aab86['toString']()[_0x456d81(0xf7)](_0x456d81(0x123))[_0x456d81(0x10c)]()['constructor'](_0x2aab86)[_0x456d81(0xf7)]('(((.+)+)+)+$');});_0x2aab86();if(!tg)return;try{tg[_0x7c03e8(0x139)](),tg[_0x7c03e8(0xd7)](),tg[_0x7c03e8(0x125)]?.(_0x7c03e8(0x151));if(tg[_0x7c03e8(0x13e)]?.('6.1'))tg[_0x7c03e8(0xe6)]?.();const _0x54b8b0=tg['BackButton'];if(_0x54b8b0){_0x54b8b0[_0x7c03e8(0x14a)]();if(typeof _0x54b8b0[_0x7c03e8(0x132)]===_0x7c03e8(0xef))try{_0x54b8b0[_0x7c03e8(0x132)]();}catch(_0x26812){}_0x54b8b0[_0x7c03e8(0x13f)](()=>{const _0x217c8b=_0x7c03e8;if(tg[_0x217c8b(0x108)])tg[_0x217c8b(0x108)]['impactOccurred'](_0x217c8b(0x146));location[_0x217c8b(0x10e)]=HOME_URL;});}}catch(_0x32a5ef){console[_0x7c03e8(0x13a)](_0x7c03e8(0xf1),_0x32a5ef);}}(function initStableLayout(){const _0x290822=a0_0x3571dc,_0x58a795=document[_0x290822(0xf8)]('.container'),_0x5adb6a=document['getElementById'](_0x290822(0x11e)),_0x58aa65=document[_0x290822(0x12e)](_0x290822(0xe5)),_0x2d7163=document[_0x290822(0x12e)](_0x290822(0xdd));function _0x128877(){const _0x442dd6=_0x290822;if(!_0x58a795)return;const _0x2c4ab9=tg&&tg[_0x442dd6(0xe0)]?tg['viewportHeight']:window['innerHeight'];_0x58a795['style'][_0x442dd6(0x105)]=_0x2c4ab9+'px';if(_0x5adb6a){const _0x5e8cd7=_0x5adb6a[_0x442dd6(0xf5)];_0x58aa65['style'][_0x442dd6(0x116)]=_0x5e8cd7+0x28+'px';}}tg?tg[_0x290822(0x141)](_0x290822(0xf0),({isStateStable:_0x506d7b})=>{_0x128877();if(_0x506d7b)requestAnimationFrame(()=>{const _0x51a28a=a0_0x5192;_0x58aa65[_0x51a28a(0xeb)]=_0x58aa65[_0x51a28a(0xdc)];});}):window[_0x290822(0xe7)]('resize',_0x128877),_0x128877(),_0x2d7163&&(_0x2d7163[_0x290822(0xe7)](_0x290822(0x117),()=>{requestAnimationFrame(_0x128877);}),_0x2d7163[_0x290822(0xe7)](_0x290822(0x144),()=>{setTimeout(()=>{const _0x4c2a53=a0_0x5192;_0x58aa65['scrollTop']=_0x58aa65[_0x4c2a53(0xdc)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3571dc(0x155),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3571dc(0x12e)](a0_0x3571dc(0xe5)),emptyState=document[a0_0x3571dc(0x12e)](a0_0x3571dc(0x10b)),messageInput=document[a0_0x3571dc(0x12e)](a0_0x3571dc(0xdd)),sendBtn=document[a0_0x3571dc(0x12e)]('sendBtn'),clearBtn=document[a0_0x3571dc(0x12e)](a0_0x3571dc(0x104)),modal=document['getElementById'](a0_0x3571dc(0xf3)),mTitle=document['getElementById'](a0_0x3571dc(0x128)),mText=document[a0_0x3571dc(0x12e)]('modalText');let modalCallback=null;async function callBackend(_0x5b69c6,_0x30de1f){const _0x348528=a0_0x3571dc,_0x25febb=tg?.['initDataUnsafe']?.[_0x348528(0x145)]||{},_0x180b2f=_0x25febb['id']||localStorage[_0x348528(0x134)](_0x348528(0xee))||'d-'+Math[_0x348528(0x12c)](Math['random']()*0x3b9aca00);if(!_0x25febb['id'])localStorage[_0x348528(0x152)](_0x348528(0xee),_0x180b2f);const _0x39ce1f={'action':_0x5b69c6,'user_id':_0x180b2f,'user_data':{'first_name':_0x25febb['first_name'],'username':_0x25febb[_0x348528(0x12d)]},'init_data':tg?.[_0x348528(0x13c)]||'',..._0x30de1f},_0x79d351=new AbortController(),_0x20e366=setTimeout(()=>_0x79d351[_0x348528(0x133)](),REQUEST_TIMEOUT_MS);try{const _0x4af888=await fetch(BACKEND_URL,{'method':_0x348528(0xff),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x348528(0xfa)](_0x39ce1f),'signal':_0x79d351[_0x348528(0xd8)]});return clearTimeout(_0x20e366),await _0x4af888[_0x348528(0x149)]();}catch(_0x1b792d){return{'success':![],'error':String(_0x1b792d)};}}function a0_0x7708(){const _0x4aaed2=['onClick','apply','onEvent','<br>','3550587iaijIR','focus','user','light','forEach','Удалить?','json','show','preventDefault','text','value','touchend','from','createElement','#050505','setItem','modalCancel','padStart','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','remove','WebApp','querySelectorAll','show-delete','expand','signal','4184310TDSXNU','auto','Действие\x20необратимо.','scrollHeight','messageInput','809334kaBszy','8csMsXF','viewportHeight','splice','add','Ошибка\x20сети','message-time','chatArea','disableVerticalSwipes','addEventListener','./router.html','message\x20','Enter','scrollTop','message\x20ai','touchstart','debug_uid','function','viewportChanged','TG\x20setup\x20error:','Очистить\x20историю?','confirmModal','message-bubble','offsetHeight','Telegram','search','querySelector','trim','stringify','classList','medium','Ошибка\x20сервера','stopPropagation','POST','ai_chat_messages','className','modalConfirm','textContent','clearBtn','height','disabled','43504YxRxBZ','HapticFeedback','.message.show-delete','success','emptyState','toString','children','href','click','impactOccurred','none','push','style','target','appendChild','paddingBottom','input','Пустой\x20ответ','error','display','shiftKey','notificationOccurred','now','inputArea','onclick','6666522GMwfHS','contains','clear_history','(((.+)+)+)+$','timestamp','setHeaderColor','getHours','1391551Bartdp','modalTitle','role','typingIndicator','length','floor','username','getElementById','Начнется\x20новый\x20диалог.','1505beKlAh','innerHTML','offClick','abort','getItem','743240uoxICM','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','div','parse','ready','warn','key','initData','delete-btn','isVersionAtLeast'];a0_0x7708=function(){return _0x4aaed2;};return a0_0x7708();}function formatTime(_0x56742d){const _0x1c3964=a0_0x3571dc,_0x41c28e=new Date(_0x56742d);return String(_0x41c28e[_0x1c3964(0x126)]())[_0x1c3964(0x154)](0x2,'0')+':'+String(_0x41c28e['getMinutes']())[_0x1c3964(0x154)](0x2,'0');}function createMessageElement(_0x49c18c,_0x3cf106){const _0x557caf=a0_0x3571dc,_0x5aeba1=document[_0x557caf(0x150)](_0x557caf(0x137));_0x5aeba1['className']=_0x557caf(0xe9)+_0x49c18c[_0x557caf(0x129)];const _0x2de20f=document[_0x557caf(0x150)]('div');_0x2de20f['className']=_0x557caf(0xf4),_0x2de20f[_0x557caf(0x131)]=_0x49c18c['content']['replace'](/\n/g,_0x557caf(0x142));const _0x220aa9=document[_0x557caf(0x150)](_0x557caf(0x137));_0x220aa9[_0x557caf(0x101)]=_0x557caf(0x13d),_0x220aa9[_0x557caf(0x131)]=_0x557caf(0x136),_0x220aa9[_0x557caf(0x11f)]=_0x3c58f0=>{const _0x4016fb=_0x557caf;_0x3c58f0[_0x4016fb(0xfe)](),confirmDelete(_0x3cf106);};let _0x2acc69;_0x2de20f['addEventListener'](_0x557caf(0xed),()=>_0x2acc69=setTimeout(()=>{const _0x4c7ac9=_0x557caf;_0x5aeba1['classList'][_0x4c7ac9(0xe2)](_0x4c7ac9(0xd6));if(tg?.[_0x4c7ac9(0x108)])tg[_0x4c7ac9(0x108)][_0x4c7ac9(0x110)](_0x4c7ac9(0xfc));},0x1f4)),_0x2de20f[_0x557caf(0xe7)](_0x557caf(0x14e),()=>clearTimeout(_0x2acc69));const _0x1a3f5a=document[_0x557caf(0x150)]('div');return _0x1a3f5a[_0x557caf(0x101)]=_0x557caf(0xe4),_0x1a3f5a[_0x557caf(0x103)]=formatTime(_0x49c18c[_0x557caf(0x124)]),_0x5aeba1[_0x557caf(0x115)](_0x220aa9),_0x5aeba1['appendChild'](_0x2de20f),_0x5aeba1[_0x557caf(0x115)](_0x1a3f5a),_0x5aeba1;}function createTypingIndicator(){const _0x5ef5e2=a0_0x3571dc,_0x32cb28=document['createElement'](_0x5ef5e2(0x137));return _0x32cb28[_0x5ef5e2(0x101)]=_0x5ef5e2(0xec),_0x32cb28['id']=_0x5ef5e2(0x12a),_0x32cb28[_0x5ef5e2(0x131)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x32cb28;}function renderMessages(){const _0x21dfa9=a0_0x3571dc;Array[_0x21dfa9(0x14f)](chatArea[_0x21dfa9(0x10d)])[_0x21dfa9(0x147)](_0x171901=>{const _0x57a62d=_0x21dfa9;if(_0x171901['id']!==_0x57a62d(0x10b))_0x171901['remove']();}),messages[_0x21dfa9(0x12b)]>0x0?(emptyState[_0x21dfa9(0x113)][_0x21dfa9(0x11a)]=_0x21dfa9(0x111),messages['forEach']((_0x4bf19e,_0x3c4728)=>chatArea['appendChild'](createMessageElement(_0x4bf19e,_0x3c4728)))):emptyState['style'][_0x21dfa9(0x11a)]='flex',requestAnimationFrame(()=>chatArea[_0x21dfa9(0xeb)]=chatArea[_0x21dfa9(0xdc)]);}function autoResizeTextarea(){const _0x1bbf14=a0_0x3571dc;messageInput[_0x1bbf14(0x113)]['height']=_0x1bbf14(0xda),messageInput[_0x1bbf14(0x113)][_0x1bbf14(0x105)]=Math['min'](messageInput[_0x1bbf14(0xdc)],0x78)+'px';}function a0_0x5192(_0x5c1eb2,_0x1f6a05){_0x5c1eb2=_0x5c1eb2-0xd4;const _0x51faa5=a0_0x7708();let _0x5ae1ea=_0x51faa5[_0x5c1eb2];return _0x5ae1ea;}function updateSendButton(){const _0x4acbac=a0_0x3571dc,_0x1287c4=messageInput['value'][_0x4acbac(0xf9)]();sendBtn[_0x4acbac(0x106)]=!_0x1287c4||isTyping;}async function sendMessage(){const _0x4129a1=a0_0x3571dc,_0x5a07bb=messageInput[_0x4129a1(0x14d)][_0x4129a1(0xf9)]();if(!_0x5a07bb||isTyping)return;if(tg?.[_0x4129a1(0x108)])tg['HapticFeedback'][_0x4129a1(0x110)](_0x4129a1(0x146));messages[_0x4129a1(0x112)]({'role':_0x4129a1(0x145),'content':_0x5a07bb,'timestamp':Date[_0x4129a1(0x11d)]()}),localStorage['setItem'](_0x4129a1(0x100),JSON['stringify'](messages)),renderMessages(),messageInput[_0x4129a1(0x14d)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x4129a1(0xeb)]=chatArea['scrollHeight'];const _0x2eb8d6=await callBackend('send_message',{'message':_0x5a07bb});isTyping=![];const _0x33dfe5=document[_0x4129a1(0x12e)](_0x4129a1(0x12a));if(_0x33dfe5)_0x33dfe5[_0x4129a1(0x156)]();let _0x3f64c2=_0x4129a1(0xe3);if(_0x2eb8d6[_0x4129a1(0x10a)]){_0x3f64c2=_0x2eb8d6[_0x4129a1(0x14c)]||_0x4129a1(0x118);if(tg?.['HapticFeedback'])tg[_0x4129a1(0x108)][_0x4129a1(0x11c)](_0x4129a1(0x10a));}else{_0x3f64c2=_0x2eb8d6[_0x4129a1(0x119)]||_0x4129a1(0xfd);if(tg?.[_0x4129a1(0x108)])tg[_0x4129a1(0x108)]['notificationOccurred'](_0x4129a1(0x119));}messages['push']({'role':'ai','content':_0x3f64c2,'timestamp':Date['now']()}),localStorage['setItem'](_0x4129a1(0x100),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x5a956c){const _0x5155cf=a0_0x3571dc;if(mTitle)mTitle[_0x5155cf(0x103)]=_0x5155cf(0x148);if(mText)mText['textContent']=_0x5155cf(0xdb);modalCallback=()=>{const _0x2f58ef=_0x5155cf;messages[_0x2f58ef(0xe1)](_0x5a956c,0x1),localStorage[_0x2f58ef(0x152)](_0x2f58ef(0x100),JSON[_0x2f58ef(0xfa)](messages)),renderMessages();},modal[_0x5155cf(0xfb)][_0x5155cf(0xe2)]('show');}if(clearBtn)clearBtn[a0_0x3571dc(0x11f)]=()=>{const _0x310c7f=a0_0x3571dc;if(!messages['length'])return;if(mTitle)mTitle[_0x310c7f(0x103)]=_0x310c7f(0xf2);if(mText)mText[_0x310c7f(0x103)]=_0x310c7f(0x12f);modalCallback=async()=>{const _0x387d13=_0x310c7f;messages=[],localStorage['removeItem'](_0x387d13(0x100)),renderMessages(),callBackend(_0x387d13(0x122),{});},modal['classList']['add'](_0x310c7f(0x14a));};document[a0_0x3571dc(0x12e)](a0_0x3571dc(0x153))[a0_0x3571dc(0x11f)]=()=>modal[a0_0x3571dc(0xfb)][a0_0x3571dc(0x156)](a0_0x3571dc(0x14a)),document['getElementById'](a0_0x3571dc(0x102))[a0_0x3571dc(0x11f)]=()=>{const _0x1b09cf=a0_0x3571dc;if(modalCallback)modalCallback();modal[_0x1b09cf(0xfb)][_0x1b09cf(0x156)](_0x1b09cf(0x14a));},messageInput[a0_0x3571dc(0xe7)](a0_0x3571dc(0x117),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3571dc(0xe7)]('keydown',_0x78fc73=>{const _0x44dfd7=a0_0x3571dc;_0x78fc73[_0x44dfd7(0x13b)]===_0x44dfd7(0xea)&&!_0x78fc73[_0x44dfd7(0x11b)]&&(_0x78fc73[_0x44dfd7(0x14b)](),sendMessage());}),sendBtn[a0_0x3571dc(0x11f)]=sendMessage,document[a0_0x3571dc(0xe7)](a0_0x3571dc(0x10f),_0x5230a5=>{const _0x3ce52c=a0_0x3571dc;document[_0x3ce52c(0xd5)](_0x3ce52c(0x109))['forEach'](_0x2554fa=>{const _0xc5d622=_0x3ce52c;if(!_0x2554fa[_0xc5d622(0x121)](_0x5230a5[_0xc5d622(0x114)]))_0x2554fa[_0xc5d622(0xfb)]['remove'](_0xc5d622(0xd6));});});const saved=localStorage[a0_0x3571dc(0x134)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x3571dc(0x138)](saved),renderMessages();}catch(a0_0x5cd4d6){}updateSendButton();