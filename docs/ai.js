const a0_0x38cba9=a0_0x1479;(function(_0x2dc3b1,_0x2fb588){const _0x5bdd46=a0_0x1479,_0x3ef9c9=_0x2dc3b1();while(!![]){try{const _0x56ed9c=parseInt(_0x5bdd46(0x1d3))/0x1+-parseInt(_0x5bdd46(0x1fc))/0x2*(-parseInt(_0x5bdd46(0x223))/0x3)+-parseInt(_0x5bdd46(0x23c))/0x4*(parseInt(_0x5bdd46(0x1df))/0x5)+-parseInt(_0x5bdd46(0x24d))/0x6+-parseInt(_0x5bdd46(0x1d2))/0x7+-parseInt(_0x5bdd46(0x1da))/0x8*(parseInt(_0x5bdd46(0x207))/0x9)+parseInt(_0x5bdd46(0x1f2))/0xa*(parseInt(_0x5bdd46(0x225))/0xb);if(_0x56ed9c===_0x2fb588)break;else _0x3ef9c9['push'](_0x3ef9c9['shift']());}catch(_0x21783e){_0x3ef9c9['push'](_0x3ef9c9['shift']());}}}(a0_0x21b2,0x8366d));function a0_0x21b2(){const _0x1cd2ad=['HapticFeedback','contains','remove','typingIndicator','modalCancel','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','forEach','getElementById','function','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','href','delete-btn','sendBtn','length','notificationOccurred','text','ready','361832MXvMlF','send_message','scrollHeight','Пустой\x20ответ','json','.message.show-delete','setHeaderColor','setItem','innerHeight','apply','show','stringify','target','display','signal','createElement','(((.+)+)+)+$','3960654FkmAxs','message-bubble','none','4597600CCBTwp','739487ScAExv','flex','search','keydown','className','shiftKey','padStart','136aWohjF','input','emptyState','auto','confirmModal','55egobDG','impactOccurred','success','getHours','6.1','getItem','modalText','removeItem','stopPropagation','push','user','<br>','Enter','focus','inputArea','click','style','textContent','WebApp','3262150AqfBXK','TG\x20setup\x20error:','offsetHeight','error','viewportHeight','querySelector','onclick','debug_uid','chatArea','paddingBottom','44zsFCkm','offClick','div','Telegram','username','min','Удалить?','value','./router.html','modalTitle','clear_history','433872AThJph','ai_chat_messages','abort','Начнется\x20новый\x20диалог.','.container','initDataUnsafe','children','Действие\x20необратимо.','height','initData','modalConfirm','innerHTML','querySelectorAll','text/plain','light','#050505','message-time','timestamp','addEventListener','POST','scrollTop','trim','show-delete','onClick','medium','add','appendChild','touchstart','88188vDwNst','toString','77woyhiN','first_name','constructor','classList','disabled','Ошибка\x20сервера'];a0_0x21b2=function(){return _0x1cd2ad;};return a0_0x21b2();}const tg=window[a0_0x38cba9(0x1ff)]?.[a0_0x38cba9(0x1f1)],HOME_URL=a0_0x38cba9(0x204);function setupTelegramBackButton(){const _0x53dce9=a0_0x38cba9,_0x4dfd8c=(function(){let _0x1f8bd6=!![];return function(_0x54fe71,_0x27cf2e){const _0x905a6=_0x1f8bd6?function(){const _0x5877ec=a0_0x1479;if(_0x27cf2e){const _0x290fbe=_0x27cf2e[_0x5877ec(0x245)](_0x54fe71,arguments);return _0x27cf2e=null,_0x290fbe;}}:function(){};return _0x1f8bd6=![],_0x905a6;};}()),_0x1f4c1b=_0x4dfd8c(this,function(){const _0x1d0cdc=a0_0x1479;return _0x1f4c1b[_0x1d0cdc(0x224)]()[_0x1d0cdc(0x1d5)](_0x1d0cdc(0x24c))['toString']()[_0x1d0cdc(0x227)](_0x1f4c1b)[_0x1d0cdc(0x1d5)](_0x1d0cdc(0x24c));});_0x1f4c1b();if(!tg)return;try{tg[_0x53dce9(0x23b)](),tg['expand'](),tg[_0x53dce9(0x242)]?.(_0x53dce9(0x216));if(tg['isVersionAtLeast']?.(_0x53dce9(0x1e3)))tg['disableVerticalSwipes']?.();const _0xc550f1=tg['BackButton'];if(_0xc550f1){_0xc550f1[_0x53dce9(0x246)]();if(typeof _0xc550f1['offClick']===_0x53dce9(0x233))try{_0xc550f1[_0x53dce9(0x1fd)]();}catch(_0x3957e3){}_0xc550f1[_0x53dce9(0x21e)](()=>{const _0x6a90ef=_0x53dce9;if(tg[_0x6a90ef(0x22b)])tg[_0x6a90ef(0x22b)][_0x6a90ef(0x1e0)](_0x6a90ef(0x215));location[_0x6a90ef(0x235)]=HOME_URL;});}}catch(_0x5a4cf4){console['warn'](_0x53dce9(0x1f3),_0x5a4cf4);}}(function initStableLayout(){const _0x44624a=a0_0x38cba9,_0x11bf05=document[_0x44624a(0x1f7)](_0x44624a(0x20b)),_0x58d60a=document['getElementById'](_0x44624a(0x1ed)),_0x39e31b=document[_0x44624a(0x232)](_0x44624a(0x1fa)),_0xa0da0e=document['getElementById']('messageInput');function _0x530ddf(){const _0x343c27=_0x44624a;if(!_0x11bf05)return;const _0x7e15ba=tg&&tg[_0x343c27(0x1f6)]?tg[_0x343c27(0x1f6)]:window[_0x343c27(0x244)];_0x11bf05['style'][_0x343c27(0x20f)]=_0x7e15ba+'px';if(_0x58d60a){const _0xf9f0db=_0x58d60a[_0x343c27(0x1f4)];_0x39e31b[_0x343c27(0x1ef)][_0x343c27(0x1fb)]=_0xf9f0db+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x5e50b8})=>{_0x530ddf();if(_0x5e50b8)requestAnimationFrame(()=>{const _0x31c676=a0_0x1479;_0x39e31b[_0x31c676(0x21b)]=_0x39e31b['scrollHeight'];});}):window['addEventListener']('resize',_0x530ddf),_0x530ddf(),_0xa0da0e&&(_0xa0da0e['addEventListener'](_0x44624a(0x1db),()=>{requestAnimationFrame(_0x530ddf);}),_0xa0da0e[_0x44624a(0x219)](_0x44624a(0x1ec),()=>{setTimeout(()=>{const _0x532167=a0_0x1479;_0x39e31b['scrollTop']=_0x39e31b[_0x532167(0x23e)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x38cba9(0x234),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x1479(_0x4cc1ba,_0x2b38c1){_0x4cc1ba=_0x4cc1ba-0x1d2;const _0x4db9e4=a0_0x21b2();let _0x50f21d=_0x4db9e4[_0x4cc1ba];return _0x50f21d;}let messages=[],isTyping=![];const chatArea=document[a0_0x38cba9(0x232)](a0_0x38cba9(0x1fa)),emptyState=document[a0_0x38cba9(0x232)]('emptyState'),messageInput=document[a0_0x38cba9(0x232)]('messageInput'),sendBtn=document['getElementById'](a0_0x38cba9(0x237)),clearBtn=document[a0_0x38cba9(0x232)]('clearBtn'),modal=document[a0_0x38cba9(0x232)](a0_0x38cba9(0x1de)),mTitle=document[a0_0x38cba9(0x232)](a0_0x38cba9(0x205)),mText=document[a0_0x38cba9(0x232)](a0_0x38cba9(0x1e5));let modalCallback=null;async function callBackend(_0x34391b,_0x196992){const _0x4167c8=a0_0x38cba9,_0x32d350=tg?.[_0x4167c8(0x20c)]?.[_0x4167c8(0x1e9)]||{},_0x10c97f=_0x32d350['id']||localStorage[_0x4167c8(0x1e4)](_0x4167c8(0x1f9))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x32d350['id'])localStorage[_0x4167c8(0x243)](_0x4167c8(0x1f9),_0x10c97f);const _0x18b650={'action':_0x34391b,'user_id':_0x10c97f,'user_data':{'first_name':_0x32d350[_0x4167c8(0x226)],'username':_0x32d350[_0x4167c8(0x200)]},'init_data':tg?.[_0x4167c8(0x210)]||'',..._0x196992},_0x1381e5=new AbortController(),_0x2b1bc8=setTimeout(()=>_0x1381e5[_0x4167c8(0x209)](),REQUEST_TIMEOUT_MS);try{const _0x5a0894=await fetch(BACKEND_URL,{'method':_0x4167c8(0x21a),'headers':{'Content-Type':_0x4167c8(0x214)},'body':JSON['stringify'](_0x18b650),'signal':_0x1381e5[_0x4167c8(0x24a)]});return clearTimeout(_0x2b1bc8),await _0x5a0894[_0x4167c8(0x240)]();}catch(_0x559cd3){return{'success':![],'error':String(_0x559cd3)};}}function formatTime(_0x4987e6){const _0x216266=a0_0x38cba9,_0xea7a=new Date(_0x4987e6);return String(_0xea7a[_0x216266(0x1e2)]())[_0x216266(0x1d9)](0x2,'0')+':'+String(_0xea7a['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x5f4f8,_0x5bd7a4){const _0x213e0e=a0_0x38cba9,_0x235bad=document[_0x213e0e(0x24b)](_0x213e0e(0x1fe));_0x235bad[_0x213e0e(0x1d7)]='message\x20'+_0x5f4f8['role'];const _0x369100=document[_0x213e0e(0x24b)]('div');_0x369100[_0x213e0e(0x1d7)]=_0x213e0e(0x24e),_0x369100['innerHTML']=_0x5f4f8['content']['replace'](/\n/g,_0x213e0e(0x1ea));const _0x1d7fef=document[_0x213e0e(0x24b)](_0x213e0e(0x1fe));_0x1d7fef[_0x213e0e(0x1d7)]=_0x213e0e(0x236),_0x1d7fef[_0x213e0e(0x212)]=_0x213e0e(0x230),_0x1d7fef[_0x213e0e(0x1f8)]=_0x1a4fad=>{const _0x49782f=_0x213e0e;_0x1a4fad[_0x49782f(0x1e7)](),confirmDelete(_0x5bd7a4);};let _0x29027a;_0x369100[_0x213e0e(0x219)](_0x213e0e(0x222),()=>_0x29027a=setTimeout(()=>{const _0x1d2fc7=_0x213e0e;_0x235bad[_0x1d2fc7(0x228)][_0x1d2fc7(0x220)](_0x1d2fc7(0x21d));if(tg?.[_0x1d2fc7(0x22b)])tg[_0x1d2fc7(0x22b)][_0x1d2fc7(0x1e0)](_0x1d2fc7(0x21f));},0x1f4)),_0x369100[_0x213e0e(0x219)]('touchend',()=>clearTimeout(_0x29027a));const _0x3f7ba0=document['createElement'](_0x213e0e(0x1fe));return _0x3f7ba0[_0x213e0e(0x1d7)]=_0x213e0e(0x217),_0x3f7ba0['textContent']=formatTime(_0x5f4f8[_0x213e0e(0x218)]),_0x235bad[_0x213e0e(0x221)](_0x1d7fef),_0x235bad['appendChild'](_0x369100),_0x235bad[_0x213e0e(0x221)](_0x3f7ba0),_0x235bad;}function createTypingIndicator(){const _0xb11c45=a0_0x38cba9,_0x5bc4f2=document['createElement'](_0xb11c45(0x1fe));return _0x5bc4f2[_0xb11c45(0x1d7)]='message\x20ai',_0x5bc4f2['id']=_0xb11c45(0x22e),_0x5bc4f2[_0xb11c45(0x212)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x5bc4f2;}function renderMessages(){const _0x2e0155=a0_0x38cba9;Array['from'](chatArea[_0x2e0155(0x20d)])[_0x2e0155(0x231)](_0x28fa2f=>{const _0x345052=_0x2e0155;if(_0x28fa2f['id']!==_0x345052(0x1dc))_0x28fa2f[_0x345052(0x22d)]();}),messages[_0x2e0155(0x238)]>0x0?(emptyState['style'][_0x2e0155(0x249)]=_0x2e0155(0x24f),messages[_0x2e0155(0x231)]((_0xd21af4,_0x52c5fc)=>chatArea[_0x2e0155(0x221)](createMessageElement(_0xd21af4,_0x52c5fc)))):emptyState[_0x2e0155(0x1ef)][_0x2e0155(0x249)]=_0x2e0155(0x1d4),requestAnimationFrame(()=>chatArea[_0x2e0155(0x21b)]=chatArea[_0x2e0155(0x23e)]);}function autoResizeTextarea(){const _0x290d1e=a0_0x38cba9;messageInput[_0x290d1e(0x1ef)]['height']=_0x290d1e(0x1dd),messageInput[_0x290d1e(0x1ef)][_0x290d1e(0x20f)]=Math[_0x290d1e(0x201)](messageInput[_0x290d1e(0x23e)],0x78)+'px';}function updateSendButton(){const _0x2c1463=a0_0x38cba9,_0x40adbd=messageInput[_0x2c1463(0x203)][_0x2c1463(0x21c)]();sendBtn[_0x2c1463(0x229)]=!_0x40adbd||isTyping;}async function sendMessage(){const _0x2f058b=a0_0x38cba9,_0x147599=messageInput['value'][_0x2f058b(0x21c)]();if(!_0x147599||isTyping)return;if(tg?.[_0x2f058b(0x22b)])tg[_0x2f058b(0x22b)]['impactOccurred']('light');messages[_0x2f058b(0x1e8)]({'role':_0x2f058b(0x1e9),'content':_0x147599,'timestamp':Date['now']()}),localStorage[_0x2f058b(0x243)](_0x2f058b(0x208),JSON[_0x2f058b(0x247)](messages)),renderMessages(),messageInput[_0x2f058b(0x203)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2f058b(0x221)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x1f6639=await callBackend(_0x2f058b(0x23d),{'message':_0x147599});isTyping=![];const _0x3c1545=document['getElementById']('typingIndicator');if(_0x3c1545)_0x3c1545['remove']();let _0x134e6b='Ошибка\x20сети';if(_0x1f6639[_0x2f058b(0x1e1)]){_0x134e6b=_0x1f6639[_0x2f058b(0x23a)]||_0x2f058b(0x23f);if(tg?.[_0x2f058b(0x22b)])tg[_0x2f058b(0x22b)][_0x2f058b(0x239)](_0x2f058b(0x1e1));}else{_0x134e6b=_0x1f6639[_0x2f058b(0x1f5)]||_0x2f058b(0x22a);if(tg?.[_0x2f058b(0x22b)])tg[_0x2f058b(0x22b)][_0x2f058b(0x239)](_0x2f058b(0x1f5));}messages[_0x2f058b(0x1e8)]({'role':'ai','content':_0x134e6b,'timestamp':Date['now']()}),localStorage[_0x2f058b(0x243)](_0x2f058b(0x208),JSON[_0x2f058b(0x247)](messages)),renderMessages();}function confirmDelete(_0x3469c4){const _0x43e13a=a0_0x38cba9;if(mTitle)mTitle[_0x43e13a(0x1f0)]=_0x43e13a(0x202);if(mText)mText[_0x43e13a(0x1f0)]=_0x43e13a(0x20e);modalCallback=()=>{const _0x5b0d04=_0x43e13a;messages['splice'](_0x3469c4,0x1),localStorage[_0x5b0d04(0x243)]('ai_chat_messages',JSON[_0x5b0d04(0x247)](messages)),renderMessages();},modal[_0x43e13a(0x228)]['add'](_0x43e13a(0x246));}if(clearBtn)clearBtn[a0_0x38cba9(0x1f8)]=()=>{const _0x2201bb=a0_0x38cba9;if(!messages[_0x2201bb(0x238)])return;if(mTitle)mTitle[_0x2201bb(0x1f0)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x2201bb(0x20a);modalCallback=async()=>{const _0x1bd8fb=_0x2201bb;messages=[],localStorage[_0x1bd8fb(0x1e6)](_0x1bd8fb(0x208)),renderMessages(),callBackend(_0x1bd8fb(0x206),{});},modal['classList']['add'](_0x2201bb(0x246));};document[a0_0x38cba9(0x232)](a0_0x38cba9(0x22f))[a0_0x38cba9(0x1f8)]=()=>modal[a0_0x38cba9(0x228)]['remove'](a0_0x38cba9(0x246)),document['getElementById'](a0_0x38cba9(0x211))['onclick']=()=>{const _0x3ad5f7=a0_0x38cba9;if(modalCallback)modalCallback();modal['classList'][_0x3ad5f7(0x22d)](_0x3ad5f7(0x246));},messageInput[a0_0x38cba9(0x219)](a0_0x38cba9(0x1db),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x38cba9(0x219)](a0_0x38cba9(0x1d6),_0x564953=>{const _0x3b61b4=a0_0x38cba9;_0x564953['key']===_0x3b61b4(0x1eb)&&!_0x564953[_0x3b61b4(0x1d8)]&&(_0x564953['preventDefault'](),sendMessage());}),sendBtn[a0_0x38cba9(0x1f8)]=sendMessage,document['addEventListener'](a0_0x38cba9(0x1ee),_0x4cb472=>{const _0x2dc148=a0_0x38cba9;document[_0x2dc148(0x213)](_0x2dc148(0x241))[_0x2dc148(0x231)](_0xcd62bd=>{const _0x6a4c10=_0x2dc148;if(!_0xcd62bd[_0x6a4c10(0x22c)](_0x4cb472[_0x6a4c10(0x248)]))_0xcd62bd[_0x6a4c10(0x228)][_0x6a4c10(0x22d)](_0x6a4c10(0x21d));});});const saved=localStorage[a0_0x38cba9(0x1e4)]('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x338c94){}updateSendButton();