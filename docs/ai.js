const a0_0x3ffbea=a0_0x261a;(function(_0x4513d7,_0x7a0030){const _0x585ed1=a0_0x261a,_0x8f9b07=_0x4513d7();while(!![]){try{const _0x1e60d2=parseInt(_0x585ed1(0xac))/0x1+parseInt(_0x585ed1(0xf0))/0x2+parseInt(_0x585ed1(0xb3))/0x3*(-parseInt(_0x585ed1(0xbb))/0x4)+parseInt(_0x585ed1(0xf1))/0x5+-parseInt(_0x585ed1(0xdd))/0x6+-parseInt(_0x585ed1(0xef))/0x7*(-parseInt(_0x585ed1(0xa2))/0x8)+parseInt(_0x585ed1(0xdb))/0x9;if(_0x1e60d2===_0x7a0030)break;else _0x8f9b07['push'](_0x8f9b07['shift']());}catch(_0x2ecd46){_0x8f9b07['push'](_0x8f9b07['shift']());}}}(a0_0x2565,0xcb011));const tg=window[a0_0x3ffbea(0xd3)]?.[a0_0x3ffbea(0x87)],HOME_URL=a0_0x3ffbea(0x7b);function setupTelegramBackButton(){const _0x2e1625=a0_0x3ffbea;if(!tg)return;try{tg[_0x2e1625(0xc2)](),tg['expand'](),tg['setHeaderColor']?.(_0x2e1625(0xba));if(tg['isVersionAtLeast']?.(_0x2e1625(0xde)))tg[_0x2e1625(0x8d)]?.();const _0x68bf2d=tg['BackButton'];if(_0x68bf2d){_0x68bf2d['show']();if(typeof _0x68bf2d[_0x2e1625(0xa7)]===_0x2e1625(0xec))try{_0x68bf2d[_0x2e1625(0xa7)]();}catch(_0x2aa050){}_0x68bf2d['onClick'](()=>{const _0xcfba1=_0x2e1625;if(tg[_0xcfba1(0xe2)])tg['HapticFeedback'][_0xcfba1(0x8f)](_0xcfba1(0xc8));location[_0xcfba1(0xbc)]=HOME_URL;});}}catch(_0x45b833){console[_0x2e1625(0x79)]('TG\x20setup\x20error:',_0x45b833);}}(function initStableLayout(){const _0x20958c=a0_0x3ffbea,_0x993a0f=(function(){let _0x4e9dd1=!![];return function(_0xbd9843,_0x1d25c2){const _0x5d879e=_0x4e9dd1?function(){const _0x410ac7=a0_0x261a;if(_0x1d25c2){const _0x369a36=_0x1d25c2[_0x410ac7(0xe9)](_0xbd9843,arguments);return _0x1d25c2=null,_0x369a36;}}:function(){};return _0x4e9dd1=![],_0x5d879e;};}()),_0x54bcec=document['querySelector'](_0x20958c(0xad)),_0x239d6d=document[_0x20958c(0xa3)]('inputArea'),_0x45821f=document[_0x20958c(0xa3)](_0x20958c(0xe6)),_0x5b452d=document[_0x20958c(0xa3)](_0x20958c(0xeb));function _0x53f5f7(){const _0x36c90c=_0x20958c,_0x5e7f7b=_0x993a0f(this,function(){const _0x3c79d7=a0_0x261a;return _0x5e7f7b[_0x3c79d7(0xc6)]()[_0x3c79d7(0x80)](_0x3c79d7(0xbe))[_0x3c79d7(0xc6)]()[_0x3c79d7(0xfd)](_0x5e7f7b)['search']('(((.+)+)+)+$');});_0x5e7f7b();if(!_0x54bcec)return;const _0x211a07=tg&&tg[_0x36c90c(0x82)]?tg[_0x36c90c(0x82)]:window[_0x36c90c(0x9a)];_0x54bcec['style'][_0x36c90c(0xa9)]=_0x211a07+'px';if(_0x239d6d){const _0x421e6d=_0x239d6d[_0x36c90c(0x7d)];_0x45821f[_0x36c90c(0x9d)][_0x36c90c(0x91)]=_0x421e6d+0x28+'px';}}tg?tg[_0x20958c(0xd2)](_0x20958c(0x97),({isStateStable:_0x2bba59})=>{_0x53f5f7();if(_0x2bba59)requestAnimationFrame(()=>{const _0x29382c=a0_0x261a;_0x45821f[_0x29382c(0xf4)]=_0x45821f[_0x29382c(0xca)];});}):window[_0x20958c(0xe7)](_0x20958c(0x92),_0x53f5f7),_0x53f5f7(),_0x5b452d&&(_0x5b452d[_0x20958c(0xe7)](_0x20958c(0xf7),()=>{requestAnimationFrame(_0x53f5f7);}),_0x5b452d[_0x20958c(0xe7)]('focus',()=>{setTimeout(()=>{const _0x49c8a4=a0_0x261a;_0x45821f[_0x49c8a4(0xf4)]=_0x45821f[_0x49c8a4(0xca)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3ffbea(0xf6),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3ffbea(0xa3)](a0_0x3ffbea(0xe6)),emptyState=document['getElementById'](a0_0x3ffbea(0xe1)),messageInput=document[a0_0x3ffbea(0xa3)](a0_0x3ffbea(0xeb)),sendBtn=document[a0_0x3ffbea(0xa3)](a0_0x3ffbea(0xb6)),clearBtn=document[a0_0x3ffbea(0xa3)](a0_0x3ffbea(0x9c)),modal=document[a0_0x3ffbea(0xa3)](a0_0x3ffbea(0xcd)),mTitle=document[a0_0x3ffbea(0xa3)](a0_0x3ffbea(0xb5)),mText=document['getElementById'](a0_0x3ffbea(0xb0));let modalCallback=null;async function callBackend(_0x98ecf5,_0x16b1f8){const _0x17487d=a0_0x3ffbea,_0x3f3565=tg?.[_0x17487d(0xf2)]?.['user']||{},_0x58d2c2=_0x3f3565['id']||localStorage['getItem']('debug_uid')||'d-'+Math['floor'](Math[_0x17487d(0xb9)]()*0x3b9aca00);if(!_0x3f3565['id'])localStorage[_0x17487d(0xc4)](_0x17487d(0x90),_0x58d2c2);const _0x2d88f3={'action':_0x98ecf5,'user_id':_0x58d2c2,'user_data':{'first_name':_0x3f3565['first_name'],'username':_0x3f3565[_0x17487d(0xe3)]},'init_data':tg?.[_0x17487d(0xaa)]||'',..._0x16b1f8},_0xa5f6ad=new AbortController(),_0x32b53a=setTimeout(()=>_0xa5f6ad[_0x17487d(0xd4)](),REQUEST_TIMEOUT_MS);try{const _0x5320da=await fetch(BACKEND_URL,{'method':_0x17487d(0x8b),'headers':{'Content-Type':_0x17487d(0x86)},'body':JSON[_0x17487d(0x84)](_0x2d88f3),'signal':_0xa5f6ad[_0x17487d(0xaf)]});return clearTimeout(_0x32b53a),await _0x5320da[_0x17487d(0xf5)]();}catch(_0x2e6ec6){return{'success':![],'error':String(_0x2e6ec6)};}}function formatTime(_0x1bac4b){const _0x58ea80=a0_0x3ffbea,_0x4930d4=new Date(_0x1bac4b);return String(_0x4930d4[_0x58ea80(0xee)]())[_0x58ea80(0xf3)](0x2,'0')+':'+String(_0x4930d4[_0x58ea80(0xfa)]())['padStart'](0x2,'0');}function createMessageElement(_0xd5a9be,_0x326547){const _0x56e148=a0_0x3ffbea,_0x108860=document[_0x56e148(0xa8)](_0x56e148(0xdc));_0x108860[_0x56e148(0xfb)]=_0x56e148(0xd7)+_0xd5a9be[_0x56e148(0xc7)];const _0x2098e9=document[_0x56e148(0xa8)](_0x56e148(0xdc));_0x2098e9[_0x56e148(0xfb)]=_0x56e148(0xdf),_0x2098e9[_0x56e148(0xa5)]=_0xd5a9be[_0x56e148(0xce)]['replace'](/\n/g,_0x56e148(0xd8));const _0xe12e3f=document[_0x56e148(0xa8)](_0x56e148(0xdc));_0xe12e3f['className']=_0x56e148(0xe8),_0xe12e3f[_0x56e148(0xa5)]=_0x56e148(0xcf),_0xe12e3f[_0x56e148(0x9f)]=_0x298265=>{const _0xdedb48=_0x56e148;_0x298265[_0xdedb48(0xb4)](),confirmDelete(_0x326547);};let _0x1d3d83;_0x2098e9[_0x56e148(0xe7)](_0x56e148(0xfc),()=>_0x1d3d83=setTimeout(()=>{const _0x7bc1bc=_0x56e148;_0x108860[_0x7bc1bc(0xe4)][_0x7bc1bc(0x7e)](_0x7bc1bc(0x8e));if(tg?.[_0x7bc1bc(0xe2)])tg[_0x7bc1bc(0xe2)]['impactOccurred']('medium');},0x1f4)),_0x2098e9['addEventListener'](_0x56e148(0xa0),()=>clearTimeout(_0x1d3d83));const _0x493f1b=document[_0x56e148(0xa8)]('div');return _0x493f1b['className']=_0x56e148(0xfe),_0x493f1b[_0x56e148(0xed)]=formatTime(_0xd5a9be[_0x56e148(0xc1)]),_0x108860[_0x56e148(0xb2)](_0xe12e3f),_0x108860['appendChild'](_0x2098e9),_0x108860[_0x56e148(0xb2)](_0x493f1b),_0x108860;}function a0_0x2565(){const _0xc0b098=['viewportChanged','Ошибка\x20сети','display','innerHeight','length','clearBtn','style','Действие\x20необратимо.','onclick','touchend','send_message','642984ZEJYnt','getElementById','auto','innerHTML','text','offClick','createElement','height','initData','modalConfirm','686423RrsmTg','.container','push','signal','modalText','key','appendChild','1255698MqZFzt','stopPropagation','modalTitle','sendBtn','typingIndicator','querySelectorAll','random','#050505','8dpViZq','href','click','(((.+)+)+)+$','children','shiftKey','timestamp','ready','none','setItem','modalCancel','toString','role','light','now','scrollHeight','value','message\x20ai','confirmModal','content','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Ошибка\x20сервера','from','onEvent','Telegram','abort','success','keydown','message\x20','<br>','.message.show-delete','notificationOccurred','3822768SYTYHR','div','6360150GvgGRQ','6.1','message-bubble','trim','emptyState','HapticFeedback','username','classList','parse','chatArea','addEventListener','delete-btn','apply','clear_history','messageInput','function','textContent','getHours','21uWDnNT','2071464XGBfZr','1703180srCCzS','initDataUnsafe','padStart','scrollTop','json','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','input','splice','Очистить\x20историю?','getMinutes','className','touchstart','constructor','message-time','warn','forEach','./router.html','target','offsetHeight','add','user','search','ai_chat_messages','viewportHeight','remove','stringify','flex','text/plain','WebApp','preventDefault','getItem','error','POST','removeItem','disableVerticalSwipes','show-delete','impactOccurred','debug_uid','paddingBottom','resize','Начнется\x20новый\x20диалог.','show','min','contains'];a0_0x2565=function(){return _0xc0b098;};return a0_0x2565();}function createTypingIndicator(){const _0x4fd6f8=a0_0x3ffbea,_0x103807=document[_0x4fd6f8(0xa8)]('div');return _0x103807[_0x4fd6f8(0xfb)]=_0x4fd6f8(0xcc),_0x103807['id']=_0x4fd6f8(0xb7),_0x103807[_0x4fd6f8(0xa5)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x103807;}function renderMessages(){const _0x494ba7=a0_0x3ffbea;Array[_0x494ba7(0xd1)](chatArea[_0x494ba7(0xbf)])[_0x494ba7(0x7a)](_0x3743c7=>{const _0x58186d=_0x494ba7;if(_0x3743c7['id']!=='emptyState')_0x3743c7[_0x58186d(0x83)]();}),messages[_0x494ba7(0x9b)]>0x0?(emptyState[_0x494ba7(0x9d)][_0x494ba7(0x99)]=_0x494ba7(0xc3),messages[_0x494ba7(0x7a)]((_0x4aea9c,_0xb84c92)=>chatArea['appendChild'](createMessageElement(_0x4aea9c,_0xb84c92)))):emptyState[_0x494ba7(0x9d)][_0x494ba7(0x99)]=_0x494ba7(0x85),requestAnimationFrame(()=>chatArea[_0x494ba7(0xf4)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x5644d4=a0_0x3ffbea;messageInput['style'][_0x5644d4(0xa9)]=_0x5644d4(0xa4),messageInput[_0x5644d4(0x9d)][_0x5644d4(0xa9)]=Math[_0x5644d4(0x95)](messageInput[_0x5644d4(0xca)],0x78)+'px';}function updateSendButton(){const _0x22a1da=a0_0x3ffbea,_0x330b5d=messageInput[_0x22a1da(0xcb)]['trim']();sendBtn['disabled']=!_0x330b5d||isTyping;}async function sendMessage(){const _0x37d0f4=a0_0x3ffbea,_0x517b7c=messageInput[_0x37d0f4(0xcb)][_0x37d0f4(0xe0)]();if(!_0x517b7c||isTyping)return;if(tg?.[_0x37d0f4(0xe2)])tg[_0x37d0f4(0xe2)][_0x37d0f4(0x8f)](_0x37d0f4(0xc8));messages[_0x37d0f4(0xae)]({'role':_0x37d0f4(0x7f),'content':_0x517b7c,'timestamp':Date[_0x37d0f4(0xc9)]()}),localStorage[_0x37d0f4(0xc4)](_0x37d0f4(0x81),JSON[_0x37d0f4(0x84)](messages)),renderMessages(),messageInput[_0x37d0f4(0xcb)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x37d0f4(0xf4)]=chatArea['scrollHeight'];const _0x46ad89=await callBackend(_0x37d0f4(0xa1),{'message':_0x517b7c});isTyping=![];const _0x5e3ee6=document[_0x37d0f4(0xa3)](_0x37d0f4(0xb7));if(_0x5e3ee6)_0x5e3ee6[_0x37d0f4(0x83)]();let _0x117a85=_0x37d0f4(0x98);if(_0x46ad89[_0x37d0f4(0xd5)]){_0x117a85=_0x46ad89[_0x37d0f4(0xa6)]||'Пустой\x20ответ';if(tg?.[_0x37d0f4(0xe2)])tg[_0x37d0f4(0xe2)][_0x37d0f4(0xda)](_0x37d0f4(0xd5));}else{_0x117a85=_0x46ad89[_0x37d0f4(0x8a)]||_0x37d0f4(0xd0);if(tg?.[_0x37d0f4(0xe2)])tg[_0x37d0f4(0xe2)][_0x37d0f4(0xda)](_0x37d0f4(0x8a));}messages['push']({'role':'ai','content':_0x117a85,'timestamp':Date[_0x37d0f4(0xc9)]()}),localStorage['setItem'](_0x37d0f4(0x81),JSON[_0x37d0f4(0x84)](messages)),renderMessages();}function confirmDelete(_0x38812d){const _0x199cd3=a0_0x3ffbea;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x199cd3(0xed)]=_0x199cd3(0x9e);modalCallback=()=>{const _0x1e9a64=_0x199cd3;messages[_0x1e9a64(0xf8)](_0x38812d,0x1),localStorage[_0x1e9a64(0xc4)](_0x1e9a64(0x81),JSON[_0x1e9a64(0x84)](messages)),renderMessages();},modal['classList'][_0x199cd3(0x7e)](_0x199cd3(0x94));}if(clearBtn)clearBtn[a0_0x3ffbea(0x9f)]=()=>{const _0x557e78=a0_0x3ffbea;if(!messages['length'])return;if(mTitle)mTitle[_0x557e78(0xed)]=_0x557e78(0xf9);if(mText)mText[_0x557e78(0xed)]=_0x557e78(0x93);modalCallback=async()=>{const _0x20cfd7=_0x557e78;messages=[],localStorage[_0x20cfd7(0x8c)]('ai_chat_messages'),renderMessages(),callBackend(_0x20cfd7(0xea),{});},modal['classList']['add']('show');};function a0_0x261a(_0x449330,_0x42a7df){_0x449330=_0x449330-0x79;const _0x252117=a0_0x2565();let _0x282728=_0x252117[_0x449330];return _0x282728;}document[a0_0x3ffbea(0xa3)](a0_0x3ffbea(0xc5))[a0_0x3ffbea(0x9f)]=()=>modal['classList'][a0_0x3ffbea(0x83)](a0_0x3ffbea(0x94)),document[a0_0x3ffbea(0xa3)](a0_0x3ffbea(0xab))[a0_0x3ffbea(0x9f)]=()=>{const _0x14e306=a0_0x3ffbea;if(modalCallback)modalCallback();modal[_0x14e306(0xe4)][_0x14e306(0x83)](_0x14e306(0x94));},messageInput[a0_0x3ffbea(0xe7)](a0_0x3ffbea(0xf7),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3ffbea(0xe7)](a0_0x3ffbea(0xd6),_0x2e1f0=>{const _0x4a5232=a0_0x3ffbea;_0x2e1f0[_0x4a5232(0xb1)]==='Enter'&&!_0x2e1f0[_0x4a5232(0xc0)]&&(_0x2e1f0[_0x4a5232(0x88)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x3ffbea(0xe7)](a0_0x3ffbea(0xbd),_0x3923f1=>{const _0x17fbba=a0_0x3ffbea;document[_0x17fbba(0xb8)](_0x17fbba(0xd9))[_0x17fbba(0x7a)](_0x33b750=>{const _0xbc6906=_0x17fbba;if(!_0x33b750[_0xbc6906(0x96)](_0x3923f1[_0xbc6906(0x7c)]))_0x33b750['classList'][_0xbc6906(0x83)]('show-delete');});});const saved=localStorage[a0_0x3ffbea(0x89)](a0_0x3ffbea(0x81));if(saved)try{messages=JSON[a0_0x3ffbea(0xe5)](saved),renderMessages();}catch(a0_0x20a709){}updateSendButton();