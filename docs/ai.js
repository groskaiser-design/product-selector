const a0_0xe5b5f1=a0_0x13ff;(function(_0x1f4bca,_0x517502){const _0x4c608a=a0_0x13ff,_0x3af663=_0x1f4bca();while(!![]){try{const _0x5b617=parseInt(_0x4c608a(0x130))/0x1*(parseInt(_0x4c608a(0x150))/0x2)+parseInt(_0x4c608a(0x109))/0x3*(parseInt(_0x4c608a(0x181))/0x4)+-parseInt(_0x4c608a(0xff))/0x5*(-parseInt(_0x4c608a(0x11a))/0x6)+parseInt(_0x4c608a(0x15f))/0x7*(parseInt(_0x4c608a(0x175))/0x8)+-parseInt(_0x4c608a(0x179))/0x9*(-parseInt(_0x4c608a(0x13d))/0xa)+parseInt(_0x4c608a(0xfd))/0xb*(-parseInt(_0x4c608a(0x126))/0xc)+-parseInt(_0x4c608a(0x178))/0xd*(parseInt(_0x4c608a(0x15c))/0xe);if(_0x5b617===_0x517502)break;else _0x3af663['push'](_0x3af663['shift']());}catch(_0x3d04f8){_0x3af663['push'](_0x3af663['shift']());}}}(a0_0x10c0,0x953f7));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0xe5b5f1(0x14f);function setupTelegramBackButton(){const _0x4bc0ca=a0_0xe5b5f1;if(!tg)return;try{tg[_0x4bc0ca(0x14e)](),tg[_0x4bc0ca(0x180)](),tg[_0x4bc0ca(0x118)]?.(_0x4bc0ca(0x14c));if(tg[_0x4bc0ca(0x177)]?.(_0x4bc0ca(0x134)))tg[_0x4bc0ca(0x15a)]?.();const _0x3ab984=tg[_0x4bc0ca(0x143)];if(_0x3ab984){_0x3ab984['show']();if(typeof _0x3ab984['offClick']===_0x4bc0ca(0x17a))try{_0x3ab984[_0x4bc0ca(0x163)]();}catch(_0xe76949){}_0x3ab984['onClick'](()=>{const _0x563d5a=_0x4bc0ca;if(tg[_0x563d5a(0x135)])tg['HapticFeedback'][_0x563d5a(0x108)](_0x563d5a(0x16b));location['href']=HOME_URL;});}}catch(_0xd4639b){console[_0x4bc0ca(0x114)](_0x4bc0ca(0x14d),_0xd4639b);}}(function initStableLayout(){const _0x47c430=a0_0xe5b5f1,_0x20c983=(function(){let _0x3e377f=!![];return function(_0x51244e,_0x40e109){const _0x6f684=_0x3e377f?function(){const _0x8fc94b=a0_0x13ff;if(_0x40e109){const _0x4664fc=_0x40e109[_0x8fc94b(0xfc)](_0x51244e,arguments);return _0x40e109=null,_0x4664fc;}}:function(){};return _0x3e377f=![],_0x6f684;};}()),_0x4f9ced=document[_0x47c430(0x10d)](_0x47c430(0x11b)),_0xe9878c=document['getElementById'](_0x47c430(0x11f)),_0x33fb89=document[_0x47c430(0x164)](_0x47c430(0x16c)),_0x58d470=document[_0x47c430(0x164)]('messageInput');function _0x3ef29a(){const _0x3d0c35=_0x47c430,_0x1f8920=_0x20c983(this,function(){const _0xccb12c=a0_0x13ff;return _0x1f8920[_0xccb12c(0x176)]()[_0xccb12c(0x13a)](_0xccb12c(0x165))[_0xccb12c(0x176)]()['constructor'](_0x1f8920)[_0xccb12c(0x13a)](_0xccb12c(0x165));});_0x1f8920();if(!_0x4f9ced)return;const _0x901f27=tg&&tg[_0x3d0c35(0x113)]?tg[_0x3d0c35(0x113)]:window[_0x3d0c35(0x137)];_0x4f9ced[_0x3d0c35(0x154)][_0x3d0c35(0x11e)]=_0x901f27+'px';if(_0xe9878c){const _0x4df48e=_0xe9878c[_0x3d0c35(0x10a)];_0x33fb89[_0x3d0c35(0x154)]['paddingBottom']=_0x4df48e+0x28+'px';}}tg?tg[_0x47c430(0xfa)]('viewportChanged',({isStateStable:_0x307d9f})=>{_0x3ef29a();if(_0x307d9f)requestAnimationFrame(()=>{const _0x330694=a0_0x13ff;_0x33fb89[_0x330694(0x16e)]=_0x33fb89['scrollHeight'];});}):window[_0x47c430(0x120)]('resize',_0x3ef29a),_0x3ef29a(),_0x58d470&&(_0x58d470[_0x47c430(0x120)](_0x47c430(0x122),()=>{requestAnimationFrame(_0x3ef29a);}),_0x58d470[_0x47c430(0x120)](_0x47c430(0x156),()=>{setTimeout(()=>{const _0x794db5=a0_0x13ff;_0x33fb89[_0x794db5(0x16e)]=_0x33fb89[_0x794db5(0x185)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xe5b5f1(0x182),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xe5b5f1(0x164)](a0_0xe5b5f1(0x16c)),emptyState=document[a0_0xe5b5f1(0x164)](a0_0xe5b5f1(0x127)),messageInput=document[a0_0xe5b5f1(0x164)](a0_0xe5b5f1(0x12a)),sendBtn=document['getElementById'](a0_0xe5b5f1(0x13b)),clearBtn=document[a0_0xe5b5f1(0x164)](a0_0xe5b5f1(0x151)),modal=document[a0_0xe5b5f1(0x164)](a0_0xe5b5f1(0x13c)),mTitle=document[a0_0xe5b5f1(0x164)](a0_0xe5b5f1(0x128)),mText=document[a0_0xe5b5f1(0x164)](a0_0xe5b5f1(0x112));let modalCallback=null;async function callBackend(_0x11fbd3,_0x543da1){const _0x2f5cd2=a0_0xe5b5f1,_0x201afe=tg?.[_0x2f5cd2(0x169)]?.[_0x2f5cd2(0x121)]||{},_0x98b483=_0x201afe['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x2f5cd2(0x111)](Math[_0x2f5cd2(0x105)]()*0x3b9aca00);if(!_0x201afe['id'])localStorage['setItem'](_0x2f5cd2(0x172),_0x98b483);const _0x2ac763={'action':_0x11fbd3,'user_id':_0x98b483,'user_data':{'first_name':_0x201afe[_0x2f5cd2(0x101)],'username':_0x201afe[_0x2f5cd2(0x144)]},'init_data':tg?.[_0x2f5cd2(0x10b)]||'',..._0x543da1},_0x12dfb8=new AbortController(),_0x1b0cff=setTimeout(()=>_0x12dfb8['abort'](),REQUEST_TIMEOUT_MS);try{const _0x4d1d12=await fetch(BACKEND_URL,{'method':_0x2f5cd2(0x161),'headers':{'Content-Type':_0x2f5cd2(0x17c)},'body':JSON[_0x2f5cd2(0x10e)](_0x2ac763),'signal':_0x12dfb8[_0x2f5cd2(0x140)]});return clearTimeout(_0x1b0cff),await _0x4d1d12[_0x2f5cd2(0x166)]();}catch(_0x133ff7){return{'success':![],'error':String(_0x133ff7)};}}function formatTime(_0x57ce5f){const _0x48ba31=a0_0xe5b5f1,_0x3d0470=new Date(_0x57ce5f);return String(_0x3d0470[_0x48ba31(0x17d)]())[_0x48ba31(0x11d)](0x2,'0')+':'+String(_0x3d0470[_0x48ba31(0xfe)]())[_0x48ba31(0x11d)](0x2,'0');}function createMessageElement(_0x1bf5ec,_0x4c8c9e){const _0x1b8e40=a0_0xe5b5f1,_0x1eab50=document[_0x1b8e40(0x100)](_0x1b8e40(0x110));_0x1eab50['className']=_0x1b8e40(0x183)+_0x1bf5ec[_0x1b8e40(0x153)];const _0x2a7a03=document[_0x1b8e40(0x100)](_0x1b8e40(0x110));_0x2a7a03[_0x1b8e40(0x136)]='message-bubble',_0x2a7a03[_0x1b8e40(0x14a)]=_0x1bf5ec[_0x1b8e40(0x15d)][_0x1b8e40(0x16f)](/\n/g,_0x1b8e40(0x12d));const _0x40b42d=document['createElement']('div');_0x40b42d[_0x1b8e40(0x136)]=_0x1b8e40(0x157),_0x40b42d[_0x1b8e40(0x14a)]=_0x1b8e40(0x16a),_0x40b42d['onclick']=_0x2f2fed=>{const _0x39c055=_0x1b8e40;_0x2f2fed[_0x39c055(0x12e)](),confirmDelete(_0x4c8c9e);};let _0x58f965;_0x2a7a03['addEventListener'](_0x1b8e40(0x13e),()=>_0x58f965=setTimeout(()=>{const _0x2c250d=_0x1b8e40;_0x1eab50[_0x2c250d(0x173)]['add'](_0x2c250d(0x145));if(tg?.[_0x2c250d(0x135)])tg['HapticFeedback'][_0x2c250d(0x108)](_0x2c250d(0x17b));},0x1f4)),_0x2a7a03[_0x1b8e40(0x120)](_0x1b8e40(0x158),()=>clearTimeout(_0x58f965));const _0x325a48=document['createElement'](_0x1b8e40(0x110));return _0x325a48['className']=_0x1b8e40(0x15e),_0x325a48['textContent']=formatTime(_0x1bf5ec[_0x1b8e40(0x13f)]),_0x1eab50[_0x1b8e40(0x132)](_0x40b42d),_0x1eab50[_0x1b8e40(0x132)](_0x2a7a03),_0x1eab50[_0x1b8e40(0x132)](_0x325a48),_0x1eab50;}function createTypingIndicator(){const _0x1de278=a0_0xe5b5f1,_0x589321=document['createElement'](_0x1de278(0x110));return _0x589321[_0x1de278(0x136)]='message\x20ai',_0x589321['id']=_0x1de278(0x142),_0x589321[_0x1de278(0x14a)]=_0x1de278(0xfb),_0x589321;}function a0_0x13ff(_0x1ab2c6,_0xa7de53){_0x1ab2c6=_0x1ab2c6-0xfa;const _0x178d54=a0_0x10c0();let _0x32be2e=_0x178d54[_0x1ab2c6];return _0x32be2e;}function a0_0x10c0(){const _0x1ed275=['chatArea','now','scrollTop','replace','Очистить\x20историю?','click','debug_uid','classList','value','8pnYTFN','toString','isVersionAtLeast','351rpgHrE','27qdkbQJ','function','medium','text/plain','getHours','children','success','expand','56Tchedd','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','message\x20','min','scrollHeight','onEvent','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','apply','3207534FpKgRD','getMinutes','5ITKJyc','createElement','first_name','contains','send_message','notificationOccurred','random','keydown','ai_chat_messages','impactOccurred','168726zGMNkt','offsetHeight','initData','Ошибка\x20сервера','querySelector','stringify','removeItem','div','floor','modalText','viewportHeight','warn','flex','shiftKey','Удалить?','setHeaderColor','display','5918982dELUvW','.container','preventDefault','padStart','height','inputArea','addEventListener','user','input','remove','.message.show-delete','trim','24fnOjQZ','emptyState','modalTitle','modalConfirm','messageInput','text','onclick','<br>','stopPropagation','none','1sRBJIN','from','appendChild','setItem','6.1','HapticFeedback','className','innerHeight','error','target','search','sendBtn','confirmModal','2758810vlzpbd','touchstart','timestamp','signal','querySelectorAll','typingIndicator','BackButton','username','show-delete','length','splice','forEach','add','innerHTML','getItem','#050505','TG\x20setup\x20error:','ready','./router.html','2439694Yzgcwj','clearBtn','Пустой\x20ответ','role','style','parse','focus','delete-btn','touchend','textContent','disableVerticalSwipes','Ошибка\x20сети','1514618kCaQnz','content','message-time','2059267HHWlHW','auto','POST','show','offClick','getElementById','(((.+)+)+)+$','json','push','disabled','initDataUnsafe','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','light'];a0_0x10c0=function(){return _0x1ed275;};return a0_0x10c0();}function renderMessages(){const _0x5044b6=a0_0xe5b5f1;Array[_0x5044b6(0x131)](chatArea[_0x5044b6(0x17e)])['forEach'](_0x543c24=>{const _0x19473e=_0x5044b6;if(_0x543c24['id']!=='emptyState')_0x543c24[_0x19473e(0x123)]();}),messages[_0x5044b6(0x146)]>0x0?(emptyState[_0x5044b6(0x154)][_0x5044b6(0x119)]=_0x5044b6(0x12f),messages['forEach']((_0x49109f,_0x52abaa)=>chatArea['appendChild'](createMessageElement(_0x49109f,_0x52abaa)))):emptyState[_0x5044b6(0x154)][_0x5044b6(0x119)]=_0x5044b6(0x115),requestAnimationFrame(()=>chatArea[_0x5044b6(0x16e)]=chatArea[_0x5044b6(0x185)]);}function autoResizeTextarea(){const _0x24bece=a0_0xe5b5f1;messageInput[_0x24bece(0x154)][_0x24bece(0x11e)]=_0x24bece(0x160),messageInput[_0x24bece(0x154)][_0x24bece(0x11e)]=Math[_0x24bece(0x184)](messageInput[_0x24bece(0x185)],0x78)+'px';}function updateSendButton(){const _0x5504ef=a0_0xe5b5f1,_0x5934c1=messageInput[_0x5504ef(0x174)][_0x5504ef(0x125)]();sendBtn[_0x5504ef(0x168)]=!_0x5934c1||isTyping;}async function sendMessage(){const _0x475278=a0_0xe5b5f1,_0x390605=messageInput[_0x475278(0x174)][_0x475278(0x125)]();if(!_0x390605||isTyping)return;if(tg?.[_0x475278(0x135)])tg['HapticFeedback'][_0x475278(0x108)](_0x475278(0x16b));messages[_0x475278(0x167)]({'role':_0x475278(0x121),'content':_0x390605,'timestamp':Date[_0x475278(0x16d)]()}),localStorage[_0x475278(0x133)](_0x475278(0x107),JSON[_0x475278(0x10e)](messages)),renderMessages(),messageInput[_0x475278(0x174)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x475278(0x132)](createTypingIndicator()),chatArea[_0x475278(0x16e)]=chatArea['scrollHeight'];const _0x1157a6=await callBackend(_0x475278(0x103),{'message':_0x390605});isTyping=![];const _0x3bca38=document[_0x475278(0x164)](_0x475278(0x142));if(_0x3bca38)_0x3bca38[_0x475278(0x123)]();let _0x4187ab=_0x475278(0x15b);if(_0x1157a6[_0x475278(0x17f)]){_0x4187ab=_0x1157a6[_0x475278(0x12b)]||_0x475278(0x152);if(tg?.[_0x475278(0x135)])tg[_0x475278(0x135)][_0x475278(0x104)](_0x475278(0x17f));}else{_0x4187ab=_0x1157a6[_0x475278(0x138)]||_0x475278(0x10c);if(tg?.[_0x475278(0x135)])tg[_0x475278(0x135)][_0x475278(0x104)]('error');}messages[_0x475278(0x167)]({'role':'ai','content':_0x4187ab,'timestamp':Date[_0x475278(0x16d)]()}),localStorage[_0x475278(0x133)]('ai_chat_messages',JSON[_0x475278(0x10e)](messages)),renderMessages();}function confirmDelete(_0x3124b2){const _0x24da8c=a0_0xe5b5f1;if(mTitle)mTitle[_0x24da8c(0x159)]=_0x24da8c(0x117);if(mText)mText[_0x24da8c(0x159)]='Действие\x20необратимо.';modalCallback=()=>{const _0x45c405=_0x24da8c;messages[_0x45c405(0x147)](_0x3124b2,0x1),localStorage[_0x45c405(0x133)]('ai_chat_messages',JSON[_0x45c405(0x10e)](messages)),renderMessages();},modal['classList'][_0x24da8c(0x149)](_0x24da8c(0x162));}if(clearBtn)clearBtn[a0_0xe5b5f1(0x12c)]=()=>{const _0x58c235=a0_0xe5b5f1;if(!messages[_0x58c235(0x146)])return;if(mTitle)mTitle[_0x58c235(0x159)]=_0x58c235(0x170);if(mText)mText[_0x58c235(0x159)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x90d224=_0x58c235;messages=[],localStorage[_0x90d224(0x10f)](_0x90d224(0x107)),renderMessages(),callBackend('clear_history',{});},modal[_0x58c235(0x173)][_0x58c235(0x149)](_0x58c235(0x162));};document[a0_0xe5b5f1(0x164)]('modalCancel')[a0_0xe5b5f1(0x12c)]=()=>modal[a0_0xe5b5f1(0x173)][a0_0xe5b5f1(0x123)](a0_0xe5b5f1(0x162)),document[a0_0xe5b5f1(0x164)](a0_0xe5b5f1(0x129))[a0_0xe5b5f1(0x12c)]=()=>{const _0x555fa0=a0_0xe5b5f1;if(modalCallback)modalCallback();modal[_0x555fa0(0x173)][_0x555fa0(0x123)]('show');},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0xe5b5f1(0x106),_0x450411=>{const _0x4e142f=a0_0xe5b5f1;_0x450411['key']==='Enter'&&!_0x450411[_0x4e142f(0x116)]&&(_0x450411[_0x4e142f(0x11c)](),sendMessage());}),sendBtn[a0_0xe5b5f1(0x12c)]=sendMessage,document[a0_0xe5b5f1(0x120)](a0_0xe5b5f1(0x171),_0x4d496b=>{const _0x7cf42c=a0_0xe5b5f1;document[_0x7cf42c(0x141)](_0x7cf42c(0x124))[_0x7cf42c(0x148)](_0x3c6e93=>{const _0x254a86=_0x7cf42c;if(!_0x3c6e93[_0x254a86(0x102)](_0x4d496b[_0x254a86(0x139)]))_0x3c6e93[_0x254a86(0x173)]['remove']('show-delete');});});const saved=localStorage[a0_0xe5b5f1(0x14b)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0xe5b5f1(0x155)](saved),renderMessages();}catch(a0_0x36bf7f){}updateSendButton();