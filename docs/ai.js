const a0_0x58ae43=a0_0x5bec;(function(_0x3ace66,_0x2b89a0){const _0x40eaf1=a0_0x5bec,_0x5e223d=_0x3ace66();while(!![]){try{const _0x3cb955=-parseInt(_0x40eaf1(0x198))/0x1*(parseInt(_0x40eaf1(0x16e))/0x2)+-parseInt(_0x40eaf1(0x146))/0x3*(-parseInt(_0x40eaf1(0x1af))/0x4)+-parseInt(_0x40eaf1(0x180))/0x5*(parseInt(_0x40eaf1(0x197))/0x6)+-parseInt(_0x40eaf1(0x18e))/0x7*(-parseInt(_0x40eaf1(0x139))/0x8)+-parseInt(_0x40eaf1(0x15a))/0x9+parseInt(_0x40eaf1(0x152))/0xa*(parseInt(_0x40eaf1(0x191))/0xb)+-parseInt(_0x40eaf1(0x132))/0xc*(parseInt(_0x40eaf1(0x160))/0xd);if(_0x3cb955===_0x2b89a0)break;else _0x5e223d['push'](_0x5e223d['shift']());}catch(_0x4e8ad1){_0x5e223d['push'](_0x5e223d['shift']());}}}(a0_0x4656,0x1c73a));const tg=window[a0_0x58ae43(0x196)]?.[a0_0x58ae43(0x161)],HOME_URL=a0_0x58ae43(0x19b);function setupTelegramBackButton(){const _0x3a2181=a0_0x58ae43,_0x359db8=(function(){let _0x33e82c=!![];return function(_0xa01000,_0x518382){const _0x1622cc=_0x33e82c?function(){const _0x2e767b=a0_0x5bec;if(_0x518382){const _0x2042cf=_0x518382[_0x2e767b(0x15c)](_0xa01000,arguments);return _0x518382=null,_0x2042cf;}}:function(){};return _0x33e82c=![],_0x1622cc;};}()),_0x5d90e5=_0x359db8(this,function(){const _0x3a3d8f=a0_0x5bec;return _0x5d90e5[_0x3a3d8f(0x1a8)]()[_0x3a3d8f(0x192)](_0x3a3d8f(0x18a))['toString']()['constructor'](_0x5d90e5)[_0x3a3d8f(0x192)](_0x3a3d8f(0x18a));});_0x5d90e5();if(!tg)return;try{tg[_0x3a2181(0x166)](),tg['expand'](),tg[_0x3a2181(0x188)]?.('#050505');if(tg[_0x3a2181(0x141)]?.('6.1'))tg[_0x3a2181(0x135)]?.();const _0x49dd24=tg[_0x3a2181(0x18c)];if(_0x49dd24){_0x49dd24[_0x3a2181(0x177)]();if(typeof _0x49dd24['offClick']===_0x3a2181(0x13f))try{_0x49dd24['offClick']();}catch(_0x56dc02){}_0x49dd24['onClick'](()=>{const _0x32d618=_0x3a2181;if(tg[_0x32d618(0x158)])tg[_0x32d618(0x158)]['impactOccurred'](_0x32d618(0x1a5));location[_0x32d618(0x18d)]=HOME_URL;});}}catch(_0x1fc239){console[_0x3a2181(0x155)](_0x3a2181(0x19a),_0x1fc239);}}(function initStableLayout(){const _0x5e1ab8=a0_0x58ae43,_0x449356=document[_0x5e1ab8(0x1a6)](_0x5e1ab8(0x1ae)),_0x2b312d=document[_0x5e1ab8(0x1a4)](_0x5e1ab8(0x190)),_0x305b72=document['getElementById'](_0x5e1ab8(0x136)),_0x483983=document[_0x5e1ab8(0x1a4)](_0x5e1ab8(0x182));function _0xff8b0d(){const _0x1f0f4e=_0x5e1ab8;if(!_0x449356)return;const _0x2096cd=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x1f0f4e(0x156)];_0x449356[_0x1f0f4e(0x151)]['height']=_0x2096cd+'px';if(_0x2b312d){const _0x5b9b99=_0x2b312d[_0x1f0f4e(0x145)];_0x305b72[_0x1f0f4e(0x151)][_0x1f0f4e(0x17b)]=_0x5b9b99+0x28+'px';}}tg?tg['onEvent'](_0x5e1ab8(0x159),({isStateStable:_0x3ccf34})=>{_0xff8b0d();if(_0x3ccf34)requestAnimationFrame(()=>{_0x305b72['scrollTop']=_0x305b72['scrollHeight'];});}):window[_0x5e1ab8(0x1ac)](_0x5e1ab8(0x13e),_0xff8b0d),_0xff8b0d(),_0x483983&&(_0x483983[_0x5e1ab8(0x1ac)](_0x5e1ab8(0x14b),()=>{requestAnimationFrame(_0xff8b0d);}),_0x483983[_0x5e1ab8(0x1ac)]('focus',()=>{setTimeout(()=>{const _0x3db974=a0_0x5bec;_0x305b72[_0x3db974(0x14c)]=_0x305b72[_0x3db974(0x167)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x58ae43(0x149),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x58ae43(0x1a4)]('chatArea'),emptyState=document[a0_0x58ae43(0x1a4)](a0_0x58ae43(0x169)),messageInput=document[a0_0x58ae43(0x1a4)](a0_0x58ae43(0x182)),sendBtn=document[a0_0x58ae43(0x1a4)]('sendBtn'),clearBtn=document['getElementById'](a0_0x58ae43(0x174)),modal=document[a0_0x58ae43(0x1a4)]('confirmModal'),mTitle=document[a0_0x58ae43(0x1a4)]('modalTitle'),mText=document[a0_0x58ae43(0x1a4)](a0_0x58ae43(0x13c));let modalCallback=null;async function callBackend(_0x865e56,_0x3bcd10){const _0x2fc6f4=a0_0x58ae43,_0x24beb5=tg?.['initDataUnsafe']?.[_0x2fc6f4(0x178)]||{},_0x2d0e8=_0x24beb5['id']||localStorage[_0x2fc6f4(0x138)](_0x2fc6f4(0x17e))||'d-'+Math[_0x2fc6f4(0x1aa)](Math[_0x2fc6f4(0x154)]()*0x3b9aca00);if(!_0x24beb5['id'])localStorage[_0x2fc6f4(0x16f)](_0x2fc6f4(0x17e),_0x2d0e8);const _0x1765c2={'action':_0x865e56,'user_id':_0x2d0e8,'user_data':{'first_name':_0x24beb5[_0x2fc6f4(0x179)],'username':_0x24beb5[_0x2fc6f4(0x16d)]},'init_data':tg?.[_0x2fc6f4(0x1a2)]||'',..._0x3bcd10},_0x74e026=new AbortController(),_0x13e98a=setTimeout(()=>_0x74e026['abort'](),REQUEST_TIMEOUT_MS);try{const _0x4fb2e0=await fetch(BACKEND_URL,{'method':_0x2fc6f4(0x19d),'headers':{'Content-Type':_0x2fc6f4(0x189)},'body':JSON['stringify'](_0x1765c2),'signal':_0x74e026[_0x2fc6f4(0x199)]});return clearTimeout(_0x13e98a),await _0x4fb2e0['json']();}catch(_0xf1aeba){return{'success':![],'error':String(_0xf1aeba)};}}function formatTime(_0x2bb92e){const _0x58b47d=a0_0x58ae43,_0x3c28a4=new Date(_0x2bb92e);return String(_0x3c28a4[_0x58b47d(0x157)]())[_0x58b47d(0x1b1)](0x2,'0')+':'+String(_0x3c28a4['getMinutes']())[_0x58b47d(0x1b1)](0x2,'0');}function createMessageElement(_0x186f07,_0x97dfbc){const _0xf7bcbe=a0_0x58ae43,_0x5876d4=document[_0xf7bcbe(0x176)](_0xf7bcbe(0x153));_0x5876d4[_0xf7bcbe(0x16c)]=_0xf7bcbe(0x193)+_0x186f07[_0xf7bcbe(0x16b)];const _0xcbad7a=document[_0xf7bcbe(0x176)](_0xf7bcbe(0x153));_0xcbad7a[_0xf7bcbe(0x16c)]=_0xf7bcbe(0x171),_0xcbad7a[_0xf7bcbe(0x183)]=_0x186f07[_0xf7bcbe(0x137)][_0xf7bcbe(0x187)](/\n/g,_0xf7bcbe(0x1ad));const _0x2c97ac=document['createElement'](_0xf7bcbe(0x153));_0x2c97ac[_0xf7bcbe(0x16c)]=_0xf7bcbe(0x173),_0x2c97ac[_0xf7bcbe(0x183)]=_0xf7bcbe(0x15e),_0x2c97ac[_0xf7bcbe(0x133)]=_0x470caa=>{const _0x276a37=_0xf7bcbe;_0x470caa[_0x276a37(0x14e)](),confirmDelete(_0x97dfbc);};let _0x1c7fd4;_0xcbad7a[_0xf7bcbe(0x1ac)](_0xf7bcbe(0x185),()=>_0x1c7fd4=setTimeout(()=>{const _0x2ce6e5=_0xf7bcbe;_0x5876d4[_0x2ce6e5(0x134)]['add'](_0x2ce6e5(0x16a));if(tg?.[_0x2ce6e5(0x158)])tg[_0x2ce6e5(0x158)][_0x2ce6e5(0x18f)](_0x2ce6e5(0x148));},0x1f4)),_0xcbad7a['addEventListener'](_0xf7bcbe(0x142),()=>clearTimeout(_0x1c7fd4));const _0x59444c=document[_0xf7bcbe(0x176)](_0xf7bcbe(0x153));return _0x59444c[_0xf7bcbe(0x16c)]=_0xf7bcbe(0x147),_0x59444c['textContent']=formatTime(_0x186f07[_0xf7bcbe(0x15d)]),_0x5876d4[_0xf7bcbe(0x15f)](_0x2c97ac),_0x5876d4[_0xf7bcbe(0x15f)](_0xcbad7a),_0x5876d4[_0xf7bcbe(0x15f)](_0x59444c),_0x5876d4;}function createTypingIndicator(){const _0x3f4909=a0_0x58ae43,_0x3f389f=document[_0x3f4909(0x176)]('div');return _0x3f389f[_0x3f4909(0x16c)]='message\x20ai',_0x3f389f['id']=_0x3f4909(0x19f),_0x3f389f[_0x3f4909(0x183)]=_0x3f4909(0x164),_0x3f389f;}function renderMessages(){const _0x220deb=a0_0x58ae43;Array[_0x220deb(0x1b0)](chatArea['children'])[_0x220deb(0x143)](_0x4f33e6=>{const _0x4a532f=_0x220deb;if(_0x4f33e6['id']!==_0x4a532f(0x169))_0x4f33e6[_0x4a532f(0x186)]();}),messages['length']>0x0?(emptyState[_0x220deb(0x151)][_0x220deb(0x19e)]='none',messages['forEach']((_0x2243aa,_0x3ce56f)=>chatArea['appendChild'](createMessageElement(_0x2243aa,_0x3ce56f)))):emptyState['style'][_0x220deb(0x19e)]='flex',requestAnimationFrame(()=>chatArea[_0x220deb(0x14c)]=chatArea[_0x220deb(0x167)]);}function autoResizeTextarea(){const _0x54e27d=a0_0x58ae43;messageInput[_0x54e27d(0x151)]['height']=_0x54e27d(0x19c),messageInput['style'][_0x54e27d(0x1a9)]=Math[_0x54e27d(0x14d)](messageInput[_0x54e27d(0x167)],0x78)+'px';}function updateSendButton(){const _0x3b480c=a0_0x58ae43,_0x2168d0=messageInput[_0x3b480c(0x165)]['trim']();sendBtn['disabled']=!_0x2168d0||isTyping;}async function sendMessage(){const _0x567766=a0_0x58ae43,_0x33f74e=messageInput[_0x567766(0x165)][_0x567766(0x18b)]();if(!_0x33f74e||isTyping)return;if(tg?.[_0x567766(0x158)])tg[_0x567766(0x158)][_0x567766(0x18f)](_0x567766(0x1a5));messages[_0x567766(0x144)]({'role':'user','content':_0x33f74e,'timestamp':Date[_0x567766(0x1a1)]()}),localStorage[_0x567766(0x16f)](_0x567766(0x17d),JSON[_0x567766(0x1ab)](messages)),renderMessages(),messageInput[_0x567766(0x165)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x567766(0x15f)](createTypingIndicator()),chatArea[_0x567766(0x14c)]=chatArea[_0x567766(0x167)];const _0x5c26d8=await callBackend(_0x567766(0x15b),{'message':_0x33f74e});isTyping=![];const _0x51ae03=document[_0x567766(0x1a4)](_0x567766(0x19f));if(_0x51ae03)_0x51ae03[_0x567766(0x186)]();let _0x423654=_0x567766(0x14f);if(_0x5c26d8[_0x567766(0x13d)]){_0x423654=_0x5c26d8[_0x567766(0x13b)]||_0x567766(0x1a0);if(tg?.[_0x567766(0x158)])tg[_0x567766(0x158)][_0x567766(0x175)](_0x567766(0x13d));}else{_0x423654=_0x5c26d8['error']||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg[_0x567766(0x158)][_0x567766(0x175)](_0x567766(0x170));}messages[_0x567766(0x144)]({'role':'ai','content':_0x423654,'timestamp':Date[_0x567766(0x1a1)]()}),localStorage[_0x567766(0x16f)](_0x567766(0x17d),JSON[_0x567766(0x1ab)](messages)),renderMessages();}function confirmDelete(_0xdca3e7){const _0x498732=a0_0x58ae43;if(mTitle)mTitle['textContent']=_0x498732(0x195);if(mText)mText[_0x498732(0x1a7)]=_0x498732(0x184);modalCallback=()=>{const _0x438e3f=_0x498732;messages[_0x438e3f(0x181)](_0xdca3e7,0x1),localStorage[_0x438e3f(0x16f)](_0x438e3f(0x17d),JSON[_0x438e3f(0x1ab)](messages)),renderMessages();},modal[_0x498732(0x134)][_0x498732(0x194)](_0x498732(0x177));}if(clearBtn)clearBtn[a0_0x58ae43(0x133)]=()=>{const _0x5f55db=a0_0x58ae43;if(!messages['length'])return;if(mTitle)mTitle[_0x5f55db(0x1a7)]=_0x5f55db(0x17c);if(mText)mText[_0x5f55db(0x1a7)]=_0x5f55db(0x1a3);modalCallback=async()=>{const _0x2442d4=_0x5f55db;messages=[],localStorage[_0x2442d4(0x17a)](_0x2442d4(0x17d)),renderMessages(),callBackend(_0x2442d4(0x172),{});},modal['classList']['add'](_0x5f55db(0x177));};document[a0_0x58ae43(0x1a4)](a0_0x58ae43(0x162))['onclick']=()=>modal[a0_0x58ae43(0x134)][a0_0x58ae43(0x186)](a0_0x58ae43(0x177)),document['getElementById'](a0_0x58ae43(0x150))[a0_0x58ae43(0x133)]=()=>{const _0x21ebbf=a0_0x58ae43;if(modalCallback)modalCallback();modal[_0x21ebbf(0x134)][_0x21ebbf(0x186)](_0x21ebbf(0x177));},messageInput[a0_0x58ae43(0x1ac)](a0_0x58ae43(0x14b),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x58ae43(0x14a),_0x4877c3=>{const _0x466db3=a0_0x58ae43;_0x4877c3[_0x466db3(0x131)]==='Enter'&&!_0x4877c3['shiftKey']&&(_0x4877c3[_0x466db3(0x17f)](),sendMessage());}),sendBtn[a0_0x58ae43(0x133)]=sendMessage,document[a0_0x58ae43(0x1ac)]('click',_0x541016=>{const _0x183392=a0_0x58ae43;document[_0x183392(0x168)](_0x183392(0x13a))[_0x183392(0x143)](_0x244f71=>{const _0x4a5ddd=_0x183392;if(!_0x244f71['contains'](_0x541016[_0x4a5ddd(0x163)]))_0x244f71[_0x4a5ddd(0x134)]['remove']('show-delete');});});function a0_0x4656(){const _0x5030d9=['inputArea','22YFPWcA','search','message\x20','add','Удалить?','Telegram','30306QtKqlP','1hVMjLJ','signal','TG\x20setup\x20error:','./router.html','auto','POST','display','typingIndicator','Пустой\x20ответ','now','initData','Начнется\x20новый\x20диалог.','getElementById','light','querySelector','textContent','toString','height','floor','stringify','addEventListener','<br>','.container','868sKitbg','from','padStart','key','756RKvLSN','onclick','classList','disableVerticalSwipes','chatArea','content','getItem','8UOmGrk','.message.show-delete','text','modalText','success','resize','function','parse','isVersionAtLeast','touchend','forEach','push','offsetHeight','1797umgast','message-time','medium','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','keydown','input','scrollTop','min','stopPropagation','Ошибка\x20сети','modalConfirm','style','1047280qgUqMk','div','random','warn','innerHeight','getHours','HapticFeedback','viewportChanged','977544rVYbts','send_message','apply','timestamp','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','appendChild','23530UwTQXE','WebApp','modalCancel','target','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','value','ready','scrollHeight','querySelectorAll','emptyState','show-delete','role','className','username','76918sDxSrx','setItem','error','message-bubble','clear_history','delete-btn','clearBtn','notificationOccurred','createElement','show','user','first_name','removeItem','paddingBottom','Очистить\x20историю?','ai_chat_messages','debug_uid','preventDefault','25FMIbFO','splice','messageInput','innerHTML','Действие\x20необратимо.','touchstart','remove','replace','setHeaderColor','text/plain','(((.+)+)+)+$','trim','BackButton','href','444213euwSJb','impactOccurred'];a0_0x4656=function(){return _0x5030d9;};return a0_0x4656();}const saved=localStorage[a0_0x58ae43(0x138)](a0_0x58ae43(0x17d));function a0_0x5bec(_0x273c81,_0x352e32){_0x273c81=_0x273c81-0x131;const _0x4d36e4=a0_0x4656();let _0x300992=_0x4d36e4[_0x273c81];return _0x300992;}if(saved)try{messages=JSON[a0_0x58ae43(0x140)](saved),renderMessages();}catch(a0_0xda1400){}updateSendButton();