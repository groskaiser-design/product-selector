const a0_0x52ab8d=a0_0x41b4;(function(_0x5f28b8,_0x4de6d2){const _0x3be509=a0_0x41b4,_0x1fe29d=_0x5f28b8();while(!![]){try{const _0x515c7b=parseInt(_0x3be509(0x1dc))/0x1+parseInt(_0x3be509(0x1cd))/0x2+parseInt(_0x3be509(0x1b6))/0x3*(-parseInt(_0x3be509(0x19e))/0x4)+-parseInt(_0x3be509(0x217))/0x5+-parseInt(_0x3be509(0x1df))/0x6+parseInt(_0x3be509(0x1bd))/0x7+parseInt(_0x3be509(0x214))/0x8;if(_0x515c7b===_0x4de6d2)break;else _0x1fe29d['push'](_0x1fe29d['shift']());}catch(_0x20e18b){_0x1fe29d['push'](_0x1fe29d['shift']());}}}(a0_0x38f7,0x5bfa6));const tg=window[a0_0x52ab8d(0x1fa)]?.[a0_0x52ab8d(0x1ab)],HOME_URL=a0_0x52ab8d(0x1c7);function setupTelegramBackButton(){const _0x73a5bb=a0_0x52ab8d,_0x2726d0=(function(){let _0x30d315=!![];return function(_0x1e2f7f,_0x2149fe){const _0x585e9f=_0x30d315?function(){const _0xf4e8e6=a0_0x41b4;if(_0x2149fe){const _0x1123f4=_0x2149fe[_0xf4e8e6(0x1e3)](_0x1e2f7f,arguments);return _0x2149fe=null,_0x1123f4;}}:function(){};return _0x30d315=![],_0x585e9f;};}()),_0x22e294=_0x2726d0(this,function(){const _0x3e77e6=a0_0x41b4;return _0x22e294[_0x3e77e6(0x1fd)]()[_0x3e77e6(0x1e7)](_0x3e77e6(0x1a3))[_0x3e77e6(0x1fd)]()[_0x3e77e6(0x21c)](_0x22e294)[_0x3e77e6(0x1e7)](_0x3e77e6(0x1a3));});_0x22e294();if(!tg)return;try{tg['ready'](),tg[_0x73a5bb(0x1ff)](),tg[_0x73a5bb(0x1f2)]?.(_0x73a5bb(0x20d));if(tg[_0x73a5bb(0x1b4)]?.(_0x73a5bb(0x21a)))tg[_0x73a5bb(0x204)]?.();const _0x26e1fd=tg[_0x73a5bb(0x19f)];if(_0x26e1fd){_0x26e1fd[_0x73a5bb(0x1ad)]();if(typeof _0x26e1fd[_0x73a5bb(0x1e8)]==='function')try{_0x26e1fd[_0x73a5bb(0x1e8)]();}catch(_0x1546b1){}_0x26e1fd[_0x73a5bb(0x1a7)](()=>{const _0x522706=_0x73a5bb;if(tg['HapticFeedback'])tg[_0x522706(0x1ca)][_0x522706(0x1af)](_0x522706(0x1e4));location[_0x522706(0x1e0)]=HOME_URL;});}}catch(_0x1908a1){console[_0x73a5bb(0x20c)](_0x73a5bb(0x1be),_0x1908a1);}}function a0_0x41b4(_0x266293,_0x362563){_0x266293=_0x266293-0x19c;const _0x460ee1=a0_0x38f7();let _0x3ffc27=_0x460ee1[_0x266293];return _0x3ffc27;}(function initStableLayout(){const _0x37b368=a0_0x52ab8d,_0x12a3ce=document[_0x37b368(0x1dd)](_0x37b368(0x20a)),_0x5176f5=document['getElementById'](_0x37b368(0x1f4)),_0x2d9bb1=document[_0x37b368(0x20f)](_0x37b368(0x1f7)),_0x4a2347=document[_0x37b368(0x20f)](_0x37b368(0x1cb));function _0x2ef3d0(){const _0x514d21=_0x37b368;if(!_0x12a3ce)return;const _0x185dbb=tg&&tg[_0x514d21(0x1a4)]?tg[_0x514d21(0x1a4)]:window[_0x514d21(0x1d9)];_0x12a3ce[_0x514d21(0x1fe)][_0x514d21(0x1ce)]=_0x185dbb+'px';if(_0x5176f5){const _0x2b9deb=_0x5176f5[_0x514d21(0x210)];_0x2d9bb1[_0x514d21(0x1fe)][_0x514d21(0x1aa)]=_0x2b9deb+0x28+'px';}}tg?tg[_0x37b368(0x1d4)]('viewportChanged',({isStateStable:_0x481235})=>{_0x2ef3d0();if(_0x481235)requestAnimationFrame(()=>{const _0x337dd7=a0_0x41b4;_0x2d9bb1[_0x337dd7(0x1c3)]=_0x2d9bb1[_0x337dd7(0x211)];});}):window[_0x37b368(0x1ee)](_0x37b368(0x1d1),_0x2ef3d0),_0x2ef3d0(),_0x4a2347&&(_0x4a2347['addEventListener'](_0x37b368(0x20b),()=>{requestAnimationFrame(_0x2ef3d0);}),_0x4a2347[_0x37b368(0x1ee)](_0x37b368(0x1f0),()=>{setTimeout(()=>{const _0x556afd=a0_0x41b4;_0x2d9bb1[_0x556afd(0x1c3)]=_0x2d9bb1['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x52ab8d(0x1b1),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x52ab8d(0x20f)]('chatArea'),emptyState=document[a0_0x52ab8d(0x20f)]('emptyState'),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x52ab8d(0x20f)](a0_0x52ab8d(0x1f3)),clearBtn=document[a0_0x52ab8d(0x20f)]('clearBtn'),modal=document[a0_0x52ab8d(0x20f)](a0_0x52ab8d(0x1f1)),mTitle=document[a0_0x52ab8d(0x20f)](a0_0x52ab8d(0x1a5)),mText=document['getElementById'](a0_0x52ab8d(0x1d3));let modalCallback=null;async function callBackend(_0x159b8e,_0x29fdfe){const _0x5f3229=a0_0x52ab8d,_0x9a1af5=tg?.['initDataUnsafe']?.[_0x5f3229(0x1d6)]||{},_0x33ad51=_0x9a1af5['id']||localStorage[_0x5f3229(0x1fb)](_0x5f3229(0x1c6))||'d-'+Math['floor'](Math[_0x5f3229(0x1bc)]()*0x3b9aca00);if(!_0x9a1af5['id'])localStorage['setItem'](_0x5f3229(0x1c6),_0x33ad51);const _0x487541={'action':_0x159b8e,'user_id':_0x33ad51,'user_data':{'first_name':_0x9a1af5[_0x5f3229(0x203)],'username':_0x9a1af5[_0x5f3229(0x1ac)]},'init_data':tg?.['initData']||'',..._0x29fdfe},_0x3b8ffa=new AbortController(),_0x3bdbaa=setTimeout(()=>_0x3b8ffa[_0x5f3229(0x1ed)](),REQUEST_TIMEOUT_MS);try{const _0x48702b=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x5f3229(0x1c9)](_0x487541),'signal':_0x3b8ffa['signal']});return clearTimeout(_0x3bdbaa),await _0x48702b[_0x5f3229(0x1e2)]();}catch(_0x4d7673){return{'success':![],'error':String(_0x4d7673)};}}function formatTime(_0x4967af){const _0xa6b93c=a0_0x52ab8d,_0x351525=new Date(_0x4967af);return String(_0x351525[_0xa6b93c(0x206)]())[_0xa6b93c(0x200)](0x2,'0')+':'+String(_0x351525[_0xa6b93c(0x1bf)]())[_0xa6b93c(0x200)](0x2,'0');}function createMessageElement(_0x24f4e9,_0x519422){const _0x319a4d=a0_0x52ab8d,_0x3b850f=document[_0x319a4d(0x1d5)](_0x319a4d(0x1bb));_0x3b850f[_0x319a4d(0x207)]=_0x319a4d(0x209)+_0x24f4e9[_0x319a4d(0x1e1)];const _0x1d0a5b=document[_0x319a4d(0x1d5)](_0x319a4d(0x1bb));_0x1d0a5b['className']=_0x319a4d(0x205),_0x1d0a5b[_0x319a4d(0x1b0)]=_0x24f4e9[_0x319a4d(0x1ea)][_0x319a4d(0x1a9)](/\n/g,'<br>');const _0x253577=document['createElement'](_0x319a4d(0x1bb));_0x253577[_0x319a4d(0x207)]=_0x319a4d(0x19d),_0x253577[_0x319a4d(0x1b0)]=_0x319a4d(0x1eb),_0x253577[_0x319a4d(0x1b8)]=_0x427911=>{_0x427911['stopPropagation'](),confirmDelete(_0x519422);};let _0x751cdd;_0x1d0a5b[_0x319a4d(0x1ee)]('touchstart',()=>_0x751cdd=setTimeout(()=>{const _0x9629b6=_0x319a4d;_0x3b850f[_0x9629b6(0x1ba)][_0x9629b6(0x1a6)]('show-delete');if(tg?.[_0x9629b6(0x1ca)])tg[_0x9629b6(0x1ca)][_0x9629b6(0x1af)](_0x9629b6(0x1de));},0x1f4)),_0x1d0a5b[_0x319a4d(0x1ee)]('touchend',()=>clearTimeout(_0x751cdd));const _0x270161=document[_0x319a4d(0x1d5)]('div');return _0x270161[_0x319a4d(0x207)]=_0x319a4d(0x1ef),_0x270161['textContent']=formatTime(_0x24f4e9[_0x319a4d(0x1a0)]),_0x3b850f['appendChild'](_0x253577),_0x3b850f['appendChild'](_0x1d0a5b),_0x3b850f[_0x319a4d(0x1b5)](_0x270161),_0x3b850f;}function createTypingIndicator(){const _0x2f7666=a0_0x52ab8d,_0x3b9e61=document[_0x2f7666(0x1d5)](_0x2f7666(0x1bb));return _0x3b9e61[_0x2f7666(0x207)]='message\x20ai',_0x3b9e61['id']=_0x2f7666(0x1f8),_0x3b9e61[_0x2f7666(0x1b0)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x3b9e61;}function renderMessages(){const _0x4a525e=a0_0x52ab8d;Array[_0x4a525e(0x1d7)](chatArea[_0x4a525e(0x1f6)])['forEach'](_0x53419c=>{const _0x1a811d=_0x4a525e;if(_0x53419c['id']!==_0x1a811d(0x19c))_0x53419c['remove']();}),messages[_0x4a525e(0x215)]>0x0?(emptyState[_0x4a525e(0x1fe)][_0x4a525e(0x1cf)]=_0x4a525e(0x1f9),messages[_0x4a525e(0x21b)]((_0x54c5c7,_0x56d881)=>chatArea[_0x4a525e(0x1b5)](createMessageElement(_0x54c5c7,_0x56d881)))):emptyState[_0x4a525e(0x1fe)]['display']=_0x4a525e(0x1c4),requestAnimationFrame(()=>chatArea[_0x4a525e(0x1c3)]=chatArea[_0x4a525e(0x211)]);}function autoResizeTextarea(){const _0xf49f9=a0_0x52ab8d;messageInput[_0xf49f9(0x1fe)]['height']='auto',messageInput[_0xf49f9(0x1fe)][_0xf49f9(0x1ce)]=Math[_0xf49f9(0x20e)](messageInput[_0xf49f9(0x211)],0x78)+'px';}function updateSendButton(){const _0x1bf67d=a0_0x52ab8d,_0x5706f3=messageInput[_0x1bf67d(0x1cc)][_0x1bf67d(0x219)]();sendBtn[_0x1bf67d(0x1a1)]=!_0x5706f3||isTyping;}async function sendMessage(){const _0x35de25=a0_0x52ab8d,_0x33c074=messageInput[_0x35de25(0x1cc)]['trim']();if(!_0x33c074||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x35de25(0x1ca)][_0x35de25(0x1af)](_0x35de25(0x1e4));messages[_0x35de25(0x208)]({'role':_0x35de25(0x1d6),'content':_0x33c074,'timestamp':Date[_0x35de25(0x1b3)]()}),localStorage[_0x35de25(0x202)]('ai_chat_messages',JSON[_0x35de25(0x1c9)](messages)),renderMessages(),messageInput[_0x35de25(0x1cc)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x35de25(0x1b5)](createTypingIndicator()),chatArea[_0x35de25(0x1c3)]=chatArea[_0x35de25(0x211)];const _0x57b983=await callBackend(_0x35de25(0x1b7),{'message':_0x33c074});isTyping=![];const _0x58b00a=document[_0x35de25(0x20f)](_0x35de25(0x1f8));if(_0x58b00a)_0x58b00a[_0x35de25(0x212)]();let _0x5b5d9f='Ошибка\x20сети';if(_0x57b983[_0x35de25(0x1d8)]){_0x5b5d9f=_0x57b983[_0x35de25(0x1b2)]||_0x35de25(0x216);if(tg?.[_0x35de25(0x1ca)])tg['HapticFeedback'][_0x35de25(0x1e5)]('success');}else{_0x5b5d9f=_0x57b983[_0x35de25(0x1c2)]||_0x35de25(0x1a2);if(tg?.['HapticFeedback'])tg[_0x35de25(0x1ca)][_0x35de25(0x1e5)](_0x35de25(0x1c2));}messages[_0x35de25(0x208)]({'role':'ai','content':_0x5b5d9f,'timestamp':Date['now']()}),localStorage['setItem'](_0x35de25(0x1da),JSON[_0x35de25(0x1c9)](messages)),renderMessages();}function a0_0x38f7(){const _0x1dcca5=['setHeaderColor','sendBtn','inputArea','textContent','children','chatArea','typingIndicator','none','Telegram','getItem','parse','toString','style','expand','padStart','show-delete','setItem','first_name','disableVerticalSwipes','message-bubble','getHours','className','push','message\x20','.container','input','warn','#050505','min','getElementById','offsetHeight','scrollHeight','remove','contains','7718088gicmMy','length','Пустой\x20ответ','773555lJMJKb','clear_history','trim','6.1','forEach','constructor','emptyState','delete-btn','12dXlYFs','BackButton','timestamp','disabled','Ошибка\x20сервера','(((.+)+)+)+$','viewportHeight','modalTitle','add','onClick','modalConfirm','replace','paddingBottom','WebApp','username','show','Очистить\x20историю?','impactOccurred','innerHTML','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','text','now','isVersionAtLeast','appendChild','327771NzaSWa','send_message','onclick','splice','classList','div','random','754670YGIrLa','TG\x20setup\x20error:','getMinutes','.message.show-delete','removeItem','error','scrollTop','flex','Действие\x20необратимо.','debug_uid','./router.html','querySelectorAll','stringify','HapticFeedback','messageInput','value','176314nptbzh','height','display','target','resize','click','modalText','onEvent','createElement','user','from','success','innerHeight','ai_chat_messages','preventDefault','265060HTATqC','querySelector','medium','3399384sqhLrx','href','role','json','apply','light','notificationOccurred','Начнется\x20новый\x20диалог.','search','offClick','shiftKey','content','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Удалить?','abort','addEventListener','message-time','focus','confirmModal'];a0_0x38f7=function(){return _0x1dcca5;};return a0_0x38f7();}function confirmDelete(_0xb48a3e){const _0x5d1bc2=a0_0x52ab8d;if(mTitle)mTitle['textContent']=_0x5d1bc2(0x1ec);if(mText)mText[_0x5d1bc2(0x1f5)]=_0x5d1bc2(0x1c5);modalCallback=()=>{const _0x438e33=_0x5d1bc2;messages[_0x438e33(0x1b9)](_0xb48a3e,0x1),localStorage[_0x438e33(0x202)](_0x438e33(0x1da),JSON[_0x438e33(0x1c9)](messages)),renderMessages();},modal[_0x5d1bc2(0x1ba)]['add'](_0x5d1bc2(0x1ad));}if(clearBtn)clearBtn[a0_0x52ab8d(0x1b8)]=()=>{const _0x57b8ed=a0_0x52ab8d;if(!messages['length'])return;if(mTitle)mTitle[_0x57b8ed(0x1f5)]=_0x57b8ed(0x1ae);if(mText)mText[_0x57b8ed(0x1f5)]=_0x57b8ed(0x1e6);modalCallback=async()=>{const _0x369b74=_0x57b8ed;messages=[],localStorage[_0x369b74(0x1c1)]('ai_chat_messages'),renderMessages(),callBackend(_0x369b74(0x218),{});},modal[_0x57b8ed(0x1ba)][_0x57b8ed(0x1a6)]('show');};document['getElementById']('modalCancel')[a0_0x52ab8d(0x1b8)]=()=>modal[a0_0x52ab8d(0x1ba)]['remove'](a0_0x52ab8d(0x1ad)),document[a0_0x52ab8d(0x20f)](a0_0x52ab8d(0x1a8))[a0_0x52ab8d(0x1b8)]=()=>{const _0x30bafa=a0_0x52ab8d;if(modalCallback)modalCallback();modal[_0x30bafa(0x1ba)]['remove'](_0x30bafa(0x1ad));},messageInput['addEventListener'](a0_0x52ab8d(0x20b),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x52ab8d(0x1ee)]('keydown',_0x5c20a4=>{const _0x1b9b2f=a0_0x52ab8d;_0x5c20a4['key']==='Enter'&&!_0x5c20a4[_0x1b9b2f(0x1e9)]&&(_0x5c20a4[_0x1b9b2f(0x1db)](),sendMessage());}),sendBtn[a0_0x52ab8d(0x1b8)]=sendMessage,document[a0_0x52ab8d(0x1ee)](a0_0x52ab8d(0x1d2),_0x240f45=>{const _0x5061a8=a0_0x52ab8d;document[_0x5061a8(0x1c8)](_0x5061a8(0x1c0))[_0x5061a8(0x21b)](_0x580320=>{const _0x43667f=_0x5061a8;if(!_0x580320[_0x43667f(0x213)](_0x240f45[_0x43667f(0x1d0)]))_0x580320[_0x43667f(0x1ba)][_0x43667f(0x212)](_0x43667f(0x201));});});const saved=localStorage[a0_0x52ab8d(0x1fb)](a0_0x52ab8d(0x1da));if(saved)try{messages=JSON[a0_0x52ab8d(0x1fc)](saved),renderMessages();}catch(a0_0x512e7d){}updateSendButton();