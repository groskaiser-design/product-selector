const a0_0xda0263=a0_0x4308;(function(_0x558724,_0x535144){const _0x38994b=a0_0x4308,_0x4cdb26=_0x558724();while(!![]){try{const _0x241397=parseInt(_0x38994b(0x216))/0x1+parseInt(_0x38994b(0x1d1))/0x2+-parseInt(_0x38994b(0x1ce))/0x3+-parseInt(_0x38994b(0x1b1))/0x4*(parseInt(_0x38994b(0x21b))/0x5)+-parseInt(_0x38994b(0x1db))/0x6*(-parseInt(_0x38994b(0x1b5))/0x7)+parseInt(_0x38994b(0x203))/0x8*(parseInt(_0x38994b(0x1d7))/0x9)+parseInt(_0x38994b(0x1e1))/0xa*(-parseInt(_0x38994b(0x1b6))/0xb);if(_0x241397===_0x535144)break;else _0x4cdb26['push'](_0x4cdb26['shift']());}catch(_0x2031fb){_0x4cdb26['push'](_0x4cdb26['shift']());}}}(a0_0x2380,0x513cd));const tg=window[a0_0xda0263(0x205)]?.[a0_0xda0263(0x1cd)],HOME_URL=a0_0xda0263(0x204);function setupTelegramBackButton(){const _0x1a86a3=a0_0xda0263;if(!tg)return;try{tg[_0x1a86a3(0x1b3)](),tg[_0x1a86a3(0x1ea)](),tg[_0x1a86a3(0x1d3)]?.(_0x1a86a3(0x1da));if(tg[_0x1a86a3(0x1e4)]?.(_0x1a86a3(0x1eb)))tg[_0x1a86a3(0x1ef)]?.();const _0x2c2896=tg[_0x1a86a3(0x1d9)];if(_0x2c2896){_0x2c2896[_0x1a86a3(0x1ac)]();if(typeof _0x2c2896[_0x1a86a3(0x1af)]==='function')try{_0x2c2896[_0x1a86a3(0x1af)]();}catch(_0x27fbb6){}_0x2c2896['onClick'](()=>{const _0x3e0eba=_0x1a86a3;if(tg['HapticFeedback'])tg['HapticFeedback']['impactOccurred'](_0x3e0eba(0x207));location['href']=HOME_URL;});}}catch(_0x4fd011){console[_0x1a86a3(0x1f9)](_0x1a86a3(0x1f8),_0x4fd011);}}(function initStableLayout(){const _0x557587=a0_0xda0263,_0x2346f0=(function(){let _0x50670d=!![];return function(_0x220c91,_0x57e2f6){const _0x4af15c=_0x50670d?function(){const _0x494b6d=a0_0x4308;if(_0x57e2f6){const _0x4c816a=_0x57e2f6[_0x494b6d(0x1b2)](_0x220c91,arguments);return _0x57e2f6=null,_0x4c816a;}}:function(){};return _0x50670d=![],_0x4af15c;};}()),_0x586c67=document['querySelector'](_0x557587(0x1e5)),_0x286e1d=document[_0x557587(0x1b9)]('inputArea'),_0x1ebe69=document[_0x557587(0x1b9)](_0x557587(0x1f0)),_0x2f4b9d=document[_0x557587(0x1b9)](_0x557587(0x1d4));function _0x5c7a68(){const _0x4f7a81=_0x557587,_0x1fd602=_0x2346f0(this,function(){const _0x424c6b=a0_0x4308;return _0x1fd602[_0x424c6b(0x1fa)]()[_0x424c6b(0x21e)](_0x424c6b(0x20f))[_0x424c6b(0x1fa)]()['constructor'](_0x1fd602)['search'](_0x424c6b(0x20f));});_0x1fd602();if(!_0x586c67)return;const _0x1f6462=tg&&tg[_0x4f7a81(0x1fe)]?tg[_0x4f7a81(0x1fe)]:window['innerHeight'];_0x586c67[_0x4f7a81(0x21f)][_0x4f7a81(0x20a)]=_0x1f6462+'px';if(_0x286e1d){const _0x513989=_0x286e1d['offsetHeight'];_0x1ebe69[_0x4f7a81(0x21f)][_0x4f7a81(0x1c8)]=_0x513989+0x28+'px';}}tg?tg[_0x557587(0x1cf)](_0x557587(0x202),({isStateStable:_0x1d7bc0})=>{_0x5c7a68();if(_0x1d7bc0)requestAnimationFrame(()=>{const _0x59e57a=a0_0x4308;_0x1ebe69[_0x59e57a(0x1ba)]=_0x1ebe69[_0x59e57a(0x1ed)];});}):window[_0x557587(0x1ff)]('resize',_0x5c7a68),_0x5c7a68(),_0x2f4b9d&&(_0x2f4b9d[_0x557587(0x1ff)]('input',()=>{requestAnimationFrame(_0x5c7a68);}),_0x2f4b9d[_0x557587(0x1ff)]('focus',()=>{setTimeout(()=>{const _0x40fde7=a0_0x4308;_0x1ebe69['scrollTop']=_0x1ebe69[_0x40fde7(0x1ed)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xda0263(0x1fd),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xda0263(0x1b9)]('chatArea'),emptyState=document['getElementById'](a0_0xda0263(0x1b7)),messageInput=document[a0_0xda0263(0x1b9)]('messageInput'),sendBtn=document[a0_0xda0263(0x1b9)](a0_0xda0263(0x1d5)),clearBtn=document[a0_0xda0263(0x1b9)](a0_0xda0263(0x1c0)),modal=document[a0_0xda0263(0x1b9)](a0_0xda0263(0x1be)),mTitle=document[a0_0xda0263(0x1b9)]('modalTitle'),mText=document[a0_0xda0263(0x1b9)](a0_0xda0263(0x1f3));let modalCallback=null;async function callBackend(_0x206fa6,_0x2c3dd1){const _0x34b862=a0_0xda0263,_0x215d01=tg?.['initDataUnsafe']?.[_0x34b862(0x1b8)]||{},_0x3c7cfd=_0x215d01['id']||localStorage['getItem'](_0x34b862(0x224))||'d-'+Math['floor'](Math[_0x34b862(0x1fb)]()*0x3b9aca00);if(!_0x215d01['id'])localStorage['setItem'](_0x34b862(0x224),_0x3c7cfd);const _0x52ca56={'action':_0x206fa6,'user_id':_0x3c7cfd,'user_data':{'first_name':_0x215d01[_0x34b862(0x21c)],'username':_0x215d01['username']},'init_data':tg?.[_0x34b862(0x21a)]||'',..._0x2c3dd1},_0x2a6fb1=new AbortController(),_0x18b39f=setTimeout(()=>_0x2a6fb1['abort'](),REQUEST_TIMEOUT_MS);try{const _0x281840=await fetch(BACKEND_URL,{'method':_0x34b862(0x217),'headers':{'Content-Type':_0x34b862(0x20e)},'body':JSON[_0x34b862(0x218)](_0x52ca56),'signal':_0x2a6fb1['signal']});return clearTimeout(_0x18b39f),await _0x281840[_0x34b862(0x1e8)]();}catch(_0x392627){return{'success':![],'error':String(_0x392627)};}}function formatTime(_0x295f6f){const _0x52ee3e=a0_0xda0263,_0x38b424=new Date(_0x295f6f);return String(_0x38b424[_0x52ee3e(0x212)]())[_0x52ee3e(0x1b4)](0x2,'0')+':'+String(_0x38b424[_0x52ee3e(0x1f7)]())['padStart'](0x2,'0');}function createMessageElement(_0x38c765,_0x5c6a6a){const _0x208255=a0_0xda0263,_0x5bdeb1=document['createElement']('div');_0x5bdeb1['className']='message\x20'+_0x38c765[_0x208255(0x1bd)];const _0x40fa32=document['createElement'](_0x208255(0x1b0));_0x40fa32['className']='message-bubble',_0x40fa32['innerHTML']=_0x38c765[_0x208255(0x1f5)][_0x208255(0x211)](/\n/g,_0x208255(0x1c4));const _0x1e0963=document[_0x208255(0x1c6)](_0x208255(0x1b0));_0x1e0963['className']=_0x208255(0x206),_0x1e0963[_0x208255(0x1dc)]=_0x208255(0x1bf),_0x1e0963['onclick']=_0x92313e=>{const _0x4a7fc6=_0x208255;_0x92313e[_0x4a7fc6(0x1d6)](),confirmDelete(_0x5c6a6a);};let _0x3567ec;_0x40fa32[_0x208255(0x1ff)]('touchstart',()=>_0x3567ec=setTimeout(()=>{const _0x453f9e=_0x208255;_0x5bdeb1[_0x453f9e(0x1e2)][_0x453f9e(0x219)](_0x453f9e(0x226));if(tg?.[_0x453f9e(0x1c7)])tg[_0x453f9e(0x1c7)][_0x453f9e(0x210)](_0x453f9e(0x1e6));},0x1f4)),_0x40fa32[_0x208255(0x1ff)](_0x208255(0x222),()=>clearTimeout(_0x3567ec));const _0x14fa96=document[_0x208255(0x1c6)]('div');return _0x14fa96[_0x208255(0x1c3)]=_0x208255(0x1e9),_0x14fa96[_0x208255(0x221)]=formatTime(_0x38c765[_0x208255(0x1f1)]),_0x5bdeb1[_0x208255(0x1d2)](_0x1e0963),_0x5bdeb1[_0x208255(0x1d2)](_0x40fa32),_0x5bdeb1['appendChild'](_0x14fa96),_0x5bdeb1;}function createTypingIndicator(){const _0x246982=a0_0xda0263,_0x3c85ce=document[_0x246982(0x1c6)]('div');return _0x3c85ce[_0x246982(0x1c3)]=_0x246982(0x201),_0x3c85ce['id']='typingIndicator',_0x3c85ce[_0x246982(0x1dc)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x3c85ce;}function renderMessages(){const _0x325828=a0_0xda0263;Array[_0x325828(0x20b)](chatArea['children'])[_0x325828(0x20d)](_0xb357c6=>{const _0x347b1e=_0x325828;if(_0xb357c6['id']!==_0x347b1e(0x1b7))_0xb357c6['remove']();}),messages['length']>0x0?(emptyState['style'][_0x325828(0x1c5)]=_0x325828(0x200),messages[_0x325828(0x20d)]((_0x48dbe3,_0x43da61)=>chatArea[_0x325828(0x1d2)](createMessageElement(_0x48dbe3,_0x43da61)))):emptyState['style']['display']=_0x325828(0x1bc),requestAnimationFrame(()=>chatArea[_0x325828(0x1ba)]=chatArea[_0x325828(0x1ed)]);}function autoResizeTextarea(){const _0x3da952=a0_0xda0263;messageInput[_0x3da952(0x21f)][_0x3da952(0x20a)]=_0x3da952(0x1cc),messageInput[_0x3da952(0x21f)][_0x3da952(0x20a)]=Math[_0x3da952(0x1d8)](messageInput[_0x3da952(0x1ed)],0x78)+'px';}function updateSendButton(){const _0x4cdfd2=a0_0xda0263,_0x5eaf8d=messageInput[_0x4cdfd2(0x1ae)]['trim']();sendBtn[_0x4cdfd2(0x1e7)]=!_0x5eaf8d||isTyping;}async function sendMessage(){const _0x17f9f4=a0_0xda0263,_0x1cd626=messageInput[_0x17f9f4(0x1ae)]['trim']();if(!_0x1cd626||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x17f9f4(0x1c7)][_0x17f9f4(0x210)](_0x17f9f4(0x207));messages[_0x17f9f4(0x1c2)]({'role':_0x17f9f4(0x1b8),'content':_0x1cd626,'timestamp':Date[_0x17f9f4(0x1d0)]()}),localStorage[_0x17f9f4(0x215)](_0x17f9f4(0x1dd),JSON[_0x17f9f4(0x218)](messages)),renderMessages(),messageInput[_0x17f9f4(0x1ae)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x17f9f4(0x1ba)]=chatArea[_0x17f9f4(0x1ed)];const _0xa66e09=await callBackend('send_message',{'message':_0x1cd626});isTyping=![];const _0x174e5a=document['getElementById']('typingIndicator');if(_0x174e5a)_0x174e5a[_0x17f9f4(0x1f4)]();let _0x1f271e=_0x17f9f4(0x1bb);if(_0xa66e09[_0x17f9f4(0x1df)]){_0x1f271e=_0xa66e09['text']||_0x17f9f4(0x1ec);if(tg?.[_0x17f9f4(0x1c7)])tg[_0x17f9f4(0x1c7)][_0x17f9f4(0x1ad)](_0x17f9f4(0x1df));}else{_0x1f271e=_0xa66e09[_0x17f9f4(0x20c)]||_0x17f9f4(0x1ee);if(tg?.[_0x17f9f4(0x1c7)])tg[_0x17f9f4(0x1c7)][_0x17f9f4(0x1ad)](_0x17f9f4(0x20c));}messages['push']({'role':'ai','content':_0x1f271e,'timestamp':Date[_0x17f9f4(0x1d0)]()}),localStorage[_0x17f9f4(0x215)](_0x17f9f4(0x1dd),JSON[_0x17f9f4(0x218)](messages)),renderMessages();}function confirmDelete(_0x1f7ca3){const _0x278582=a0_0xda0263;if(mTitle)mTitle[_0x278582(0x221)]=_0x278582(0x213);if(mText)mText[_0x278582(0x221)]=_0x278582(0x1c1);modalCallback=()=>{const _0xa145c9=_0x278582;messages[_0xa145c9(0x220)](_0x1f7ca3,0x1),localStorage[_0xa145c9(0x215)](_0xa145c9(0x1dd),JSON[_0xa145c9(0x218)](messages)),renderMessages();},modal['classList'][_0x278582(0x219)]('show');}if(clearBtn)clearBtn[a0_0xda0263(0x209)]=()=>{const _0x3f9d45=a0_0xda0263;if(!messages[_0x3f9d45(0x1e0)])return;if(mTitle)mTitle[_0x3f9d45(0x221)]=_0x3f9d45(0x1f6);if(mText)mText[_0x3f9d45(0x221)]=_0x3f9d45(0x1ca);modalCallback=async()=>{const _0x4b6669=_0x3f9d45;messages=[],localStorage[_0x4b6669(0x1cb)](_0x4b6669(0x1dd)),renderMessages(),callBackend(_0x4b6669(0x21d),{});},modal['classList'][_0x3f9d45(0x219)](_0x3f9d45(0x1ac));};document[a0_0xda0263(0x1b9)]('modalCancel')['onclick']=()=>modal[a0_0xda0263(0x1e2)][a0_0xda0263(0x1f4)]('show'),document[a0_0xda0263(0x1b9)](a0_0xda0263(0x214))['onclick']=()=>{const _0xa55be=a0_0xda0263;if(modalCallback)modalCallback();modal['classList']['remove'](_0xa55be(0x1ac));},messageInput[a0_0xda0263(0x1ff)](a0_0xda0263(0x1c9),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xda0263(0x1ff)]('keydown',_0x332147=>{const _0xe56c28=a0_0xda0263;_0x332147[_0xe56c28(0x225)]===_0xe56c28(0x1de)&&!_0x332147[_0xe56c28(0x208)]&&(_0x332147[_0xe56c28(0x1fc)](),sendMessage());}),sendBtn[a0_0xda0263(0x209)]=sendMessage,document['addEventListener'](a0_0xda0263(0x223),_0x231226=>{const _0xc56b4b=a0_0xda0263;document['querySelectorAll'](_0xc56b4b(0x1e3))['forEach'](_0x42ca47=>{const _0x59d141=_0xc56b4b;if(!_0x42ca47['contains'](_0x231226['target']))_0x42ca47['classList']['remove'](_0x59d141(0x226));});});const saved=localStorage[a0_0xda0263(0x1f2)](a0_0xda0263(0x1dd));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x1e2824){}function a0_0x4308(_0x1b000e,_0x49d755){_0x1b000e=_0x1b000e-0x1ac;const _0x3642d=a0_0x2380();let _0x575a56=_0x3642d[_0x1b000e];return _0x575a56;}updateSendButton();function a0_0x2380(){const _0x4cce55=['Ошибка\x20сервера','disableVerticalSwipes','chatArea','timestamp','getItem','modalText','remove','content','Очистить\x20историю?','getMinutes','TG\x20setup\x20error:','warn','toString','random','preventDefault','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','viewportHeight','addEventListener','none','message\x20ai','viewportChanged','49848JcNblN','./router.html','Telegram','delete-btn','light','shiftKey','onclick','height','from','error','forEach','text/plain','(((.+)+)+)+$','impactOccurred','replace','getHours','Удалить?','modalConfirm','setItem','99995ptxSnP','POST','stringify','add','initData','5vROvGU','first_name','clear_history','search','style','splice','textContent','touchend','click','debug_uid','key','show-delete','show','notificationOccurred','value','offClick','div','2397892bXcEFP','apply','ready','padStart','4522231klLWOF','121bBJDBo','emptyState','user','getElementById','scrollTop','Ошибка\x20сети','flex','role','confirmModal','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','clearBtn','Действие\x20необратимо.','push','className','<br>','display','createElement','HapticFeedback','paddingBottom','input','Начнется\x20новый\x20диалог.','removeItem','auto','WebApp','224106ZiiSXy','onEvent','now','1110538nXNwZX','appendChild','setHeaderColor','messageInput','sendBtn','stopPropagation','36pdDpFg','min','BackButton','#050505','6NZtSyC','innerHTML','ai_chat_messages','Enter','success','length','290270IVCJQD','classList','.message.show-delete','isVersionAtLeast','.container','medium','disabled','json','message-time','expand','6.1','Пустой\x20ответ','scrollHeight'];a0_0x2380=function(){return _0x4cce55;};return a0_0x2380();}