const a0_0x18cec9=a0_0x3e76;(function(_0x233f33,_0x32eef1){const _0x3486a1=a0_0x3e76,_0x550948=_0x233f33();while(!![]){try{const _0x467109=parseInt(_0x3486a1(0x1fe))/0x1+parseInt(_0x3486a1(0x201))/0x2+-parseInt(_0x3486a1(0x1e7))/0x3+-parseInt(_0x3486a1(0x214))/0x4+-parseInt(_0x3486a1(0x232))/0x5+-parseInt(_0x3486a1(0x1fa))/0x6+parseInt(_0x3486a1(0x1eb))/0x7;if(_0x467109===_0x32eef1)break;else _0x550948['push'](_0x550948['shift']());}catch(_0x4fc48c){_0x550948['push'](_0x550948['shift']());}}}(a0_0xd414,0xb5c62));const tg=window['Telegram']?.[a0_0x18cec9(0x1ee)],HOME_URL=a0_0x18cec9(0x22e);function setupTelegramBackButton(){const _0x2b0179=a0_0x18cec9,_0x2aae8a=(function(){let _0x59a6ec=!![];return function(_0x2f02cc,_0xfa8ab7){const _0x4cc983=_0x59a6ec?function(){const _0xebe2a8=a0_0x3e76;if(_0xfa8ab7){const _0x5c8d78=_0xfa8ab7[_0xebe2a8(0x226)](_0x2f02cc,arguments);return _0xfa8ab7=null,_0x5c8d78;}}:function(){};return _0x59a6ec=![],_0x4cc983;};}()),_0x36b1a3=_0x2aae8a(this,function(){const _0x5ea0b5=a0_0x3e76;return _0x36b1a3[_0x5ea0b5(0x1f6)]()[_0x5ea0b5(0x246)](_0x5ea0b5(0x22a))['toString']()[_0x5ea0b5(0x24d)](_0x36b1a3)['search']('(((.+)+)+)+$');});_0x36b1a3();if(!tg)return;try{tg[_0x2b0179(0x217)](),tg[_0x2b0179(0x1f4)](),tg[_0x2b0179(0x227)]?.('#050505');if(tg[_0x2b0179(0x23e)]?.(_0x2b0179(0x1f8)))tg[_0x2b0179(0x24f)]?.();const _0xc895dc=tg['BackButton'];if(_0xc895dc){_0xc895dc['show']();if(typeof _0xc895dc['offClick']===_0x2b0179(0x218))try{_0xc895dc[_0x2b0179(0x253)]();}catch(_0x4e2c10){}_0xc895dc[_0x2b0179(0x209)](()=>{const _0x33294c=_0x2b0179;if(tg['HapticFeedback'])tg[_0x33294c(0x1e3)][_0x33294c(0x21d)](_0x33294c(0x21e));location['href']=HOME_URL;});}}catch(_0x5a9b91){console[_0x2b0179(0x236)]('TG\x20setup\x20error:',_0x5a9b91);}}(function initStableLayout(){const _0x3d17a1=a0_0x18cec9,_0x216479=document[_0x3d17a1(0x252)](_0x3d17a1(0x224)),_0x21886a=document[_0x3d17a1(0x1f0)](_0x3d17a1(0x20d)),_0x59ad25=document['getElementById'](_0x3d17a1(0x207)),_0x3d00f7=document[_0x3d17a1(0x1f0)]('messageInput');function _0xa5f388(){const _0x28a7b3=_0x3d17a1;if(!_0x216479)return;const _0xd4fdba=tg&&tg[_0x28a7b3(0x204)]?tg[_0x28a7b3(0x204)]:window['innerHeight'];_0x216479[_0x28a7b3(0x222)][_0x28a7b3(0x1e5)]=_0xd4fdba+'px';if(_0x21886a){const _0x41ea2d=_0x21886a[_0x28a7b3(0x208)];_0x59ad25['style'][_0x28a7b3(0x20f)]=_0x41ea2d+0x28+'px';}}tg?tg[_0x3d17a1(0x206)](_0x3d17a1(0x1f9),({isStateStable:_0x2eb49b})=>{_0xa5f388();if(_0x2eb49b)requestAnimationFrame(()=>{const _0x56006b=a0_0x3e76;_0x59ad25['scrollTop']=_0x59ad25[_0x56006b(0x223)];});}):window['addEventListener'](_0x3d17a1(0x255),_0xa5f388),_0xa5f388(),_0x3d00f7&&(_0x3d00f7[_0x3d17a1(0x1e0)](_0x3d17a1(0x203),()=>{requestAnimationFrame(_0xa5f388);}),_0x3d00f7[_0x3d17a1(0x1e0)](_0x3d17a1(0x25a),()=>{setTimeout(()=>{const _0xd3ec3a=a0_0x3e76;_0x59ad25['scrollTop']=_0x59ad25[_0xd3ec3a(0x223)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x18cec9(0x200),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById']('chatArea'),emptyState=document[a0_0x18cec9(0x1f0)](a0_0x18cec9(0x231)),messageInput=document[a0_0x18cec9(0x1f0)]('messageInput'),sendBtn=document[a0_0x18cec9(0x1f0)](a0_0x18cec9(0x247)),clearBtn=document[a0_0x18cec9(0x1f0)]('clearBtn'),modal=document[a0_0x18cec9(0x1f0)](a0_0x18cec9(0x21a)),mTitle=document['getElementById']('modalTitle'),mText=document['getElementById'](a0_0x18cec9(0x205));let modalCallback=null;async function callBackend(_0x94cd16,_0x4af436){const _0x515f98=a0_0x18cec9,_0xdfe9fa=tg?.[_0x515f98(0x1ef)]?.[_0x515f98(0x229)]||{},_0x119d06=_0xdfe9fa['id']||localStorage['getItem'](_0x515f98(0x221))||'d-'+Math[_0x515f98(0x257)](Math[_0x515f98(0x212)]()*0x3b9aca00);if(!_0xdfe9fa['id'])localStorage[_0x515f98(0x213)]('debug_uid',_0x119d06);const _0x361238={'action':_0x94cd16,'user_id':_0x119d06,'user_data':{'first_name':_0xdfe9fa['first_name'],'username':_0xdfe9fa['username']},'init_data':tg?.[_0x515f98(0x22f)]||'',..._0x4af436},_0x1c0325=new AbortController(),_0x4e14ac=setTimeout(()=>_0x1c0325[_0x515f98(0x1ea)](),REQUEST_TIMEOUT_MS);try{const _0x234d2f=await fetch(BACKEND_URL,{'method':_0x515f98(0x23b),'headers':{'Content-Type':_0x515f98(0x239)},'body':JSON[_0x515f98(0x234)](_0x361238),'signal':_0x1c0325[_0x515f98(0x250)]});return clearTimeout(_0x4e14ac),await _0x234d2f[_0x515f98(0x240)]();}catch(_0x36e988){return{'success':![],'error':String(_0x36e988)};}}function formatTime(_0x233e76){const _0x1da1d2=a0_0x18cec9,_0x9418e=new Date(_0x233e76);return String(_0x9418e[_0x1da1d2(0x241)]())[_0x1da1d2(0x256)](0x2,'0')+':'+String(_0x9418e['getMinutes']())[_0x1da1d2(0x256)](0x2,'0');}function createMessageElement(_0x1e86b7,_0x5b0395){const _0x496c15=a0_0x18cec9,_0x548c40=document[_0x496c15(0x22b)](_0x496c15(0x1f2));_0x548c40['className']=_0x496c15(0x220)+_0x1e86b7[_0x496c15(0x1e4)];const _0x30e19=document[_0x496c15(0x22b)](_0x496c15(0x1f2));_0x30e19[_0x496c15(0x1f5)]=_0x496c15(0x225),_0x30e19[_0x496c15(0x1e2)]=_0x1e86b7[_0x496c15(0x235)][_0x496c15(0x24a)](/\n/g,_0x496c15(0x22d));const _0x44014b=document[_0x496c15(0x22b)](_0x496c15(0x1f2));_0x44014b[_0x496c15(0x1f5)]='delete-btn',_0x44014b['innerHTML']=_0x496c15(0x215),_0x44014b[_0x496c15(0x210)]=_0x34ed47=>{const _0x1e9487=_0x496c15;_0x34ed47[_0x1e9487(0x24b)](),confirmDelete(_0x5b0395);};let _0x4244b8;_0x30e19[_0x496c15(0x1e0)]('touchstart',()=>_0x4244b8=setTimeout(()=>{const _0x3875ce=_0x496c15;_0x548c40[_0x3875ce(0x242)][_0x3875ce(0x1ed)](_0x3875ce(0x21f));if(tg?.[_0x3875ce(0x1e3)])tg[_0x3875ce(0x1e3)][_0x3875ce(0x21d)](_0x3875ce(0x238));},0x1f4)),_0x30e19[_0x496c15(0x1e0)](_0x496c15(0x1e1),()=>clearTimeout(_0x4244b8));const _0x544221=document[_0x496c15(0x22b)](_0x496c15(0x1f2));return _0x544221[_0x496c15(0x1f5)]=_0x496c15(0x259),_0x544221['textContent']=formatTime(_0x1e86b7['timestamp']),_0x548c40[_0x496c15(0x237)](_0x44014b),_0x548c40[_0x496c15(0x237)](_0x30e19),_0x548c40[_0x496c15(0x237)](_0x544221),_0x548c40;}function createTypingIndicator(){const _0x4c0d39=a0_0x18cec9,_0x14a53a=document[_0x4c0d39(0x22b)](_0x4c0d39(0x1f2));return _0x14a53a[_0x4c0d39(0x1f5)]=_0x4c0d39(0x216),_0x14a53a['id']=_0x4c0d39(0x23f),_0x14a53a[_0x4c0d39(0x1e2)]=_0x4c0d39(0x245),_0x14a53a;}function a0_0x3e76(_0x3e35bd,_0x4b69ad){_0x3e35bd=_0x3e35bd-0x1df;const _0x535158=a0_0xd414();let _0x3d0749=_0x535158[_0x3e35bd];return _0x3d0749;}function renderMessages(){const _0x42c3c3=a0_0x18cec9;Array['from'](chatArea[_0x42c3c3(0x258)])[_0x42c3c3(0x23c)](_0x11aa76=>{const _0x50835f=_0x42c3c3;if(_0x11aa76['id']!=='emptyState')_0x11aa76[_0x50835f(0x1e9)]();}),messages[_0x42c3c3(0x1e8)]>0x0?(emptyState[_0x42c3c3(0x222)]['display']=_0x42c3c3(0x1e6),messages[_0x42c3c3(0x23c)]((_0x20335e,_0x528321)=>chatArea[_0x42c3c3(0x237)](createMessageElement(_0x20335e,_0x528321)))):emptyState[_0x42c3c3(0x222)][_0x42c3c3(0x20b)]=_0x42c3c3(0x1fb),requestAnimationFrame(()=>chatArea[_0x42c3c3(0x24c)]=chatArea[_0x42c3c3(0x223)]);}function a0_0xd414(){const _0x26a65b=['auto','replace','stopPropagation','scrollTop','constructor','splice','disableVerticalSwipes','signal','key','querySelector','offClick','Действие\x20необратимо.','resize','padStart','floor','children','message-time','focus','Очистить\x20историю?','addEventListener','touchend','innerHTML','HapticFeedback','role','height','none','3119559CPfYmb','length','remove','abort','25758873BkdHST','getItem','add','WebApp','initDataUnsafe','getElementById','removeItem','div','show','expand','className','toString','error','6.1','viewportChanged','2751192ovxMzW','flex','disabled','text','455027nourDo','target','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','92892XzEmdl','value','input','viewportHeight','modalText','onEvent','chatArea','offsetHeight','onClick','Ошибка\x20сети','display','keydown','inputArea','clear_history','paddingBottom','onclick','shiftKey','random','setItem','4680468myJqdV','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','message\x20ai','ready','function','Начнется\x20новый\x20диалог.','confirmModal','preventDefault','trim','impactOccurred','light','show-delete','message\x20','debug_uid','style','scrollHeight','.container','message-bubble','apply','setHeaderColor','Enter','user','(((.+)+)+)+$','createElement','success','<br>','./router.html','initData','parse','emptyState','3841320TeYraJ','ai_chat_messages','stringify','content','warn','appendChild','medium','text/plain','now','POST','forEach','push','isVersionAtLeast','typingIndicator','json','getHours','classList','textContent','min','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','search','sendBtn','.message.show-delete'];a0_0xd414=function(){return _0x26a65b;};return a0_0xd414();}function autoResizeTextarea(){const _0x45441c=a0_0x18cec9;messageInput['style'][_0x45441c(0x1e5)]=_0x45441c(0x249),messageInput['style'][_0x45441c(0x1e5)]=Math[_0x45441c(0x244)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x27a7a4=a0_0x18cec9,_0x33144d=messageInput[_0x27a7a4(0x202)]['trim']();sendBtn[_0x27a7a4(0x1fc)]=!_0x33144d||isTyping;}async function sendMessage(){const _0x56fd89=a0_0x18cec9,_0x15d2bf=messageInput['value'][_0x56fd89(0x21c)]();if(!_0x15d2bf||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x56fd89(0x1e3)][_0x56fd89(0x21d)](_0x56fd89(0x21e));messages[_0x56fd89(0x23d)]({'role':'user','content':_0x15d2bf,'timestamp':Date[_0x56fd89(0x23a)]()}),localStorage[_0x56fd89(0x213)](_0x56fd89(0x233),JSON[_0x56fd89(0x234)](messages)),renderMessages(),messageInput[_0x56fd89(0x202)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x56fd89(0x237)](createTypingIndicator()),chatArea[_0x56fd89(0x24c)]=chatArea[_0x56fd89(0x223)];const _0x17855a=await callBackend('send_message',{'message':_0x15d2bf});isTyping=![];const _0x336259=document[_0x56fd89(0x1f0)]('typingIndicator');if(_0x336259)_0x336259['remove']();let _0x2f9012=_0x56fd89(0x20a);if(_0x17855a[_0x56fd89(0x22c)]){_0x2f9012=_0x17855a[_0x56fd89(0x1fd)]||'Пустой\x20ответ';if(tg?.[_0x56fd89(0x1e3)])tg[_0x56fd89(0x1e3)]['notificationOccurred'](_0x56fd89(0x22c));}else{_0x2f9012=_0x17855a[_0x56fd89(0x1f7)]||'Ошибка\x20сервера';if(tg?.[_0x56fd89(0x1e3)])tg[_0x56fd89(0x1e3)]['notificationOccurred'](_0x56fd89(0x1f7));}messages['push']({'role':'ai','content':_0x2f9012,'timestamp':Date[_0x56fd89(0x23a)]()}),localStorage[_0x56fd89(0x213)]('ai_chat_messages',JSON[_0x56fd89(0x234)](messages)),renderMessages();}function confirmDelete(_0x2ad3d3){const _0x164b23=a0_0x18cec9;if(mTitle)mTitle[_0x164b23(0x243)]='Удалить?';if(mText)mText[_0x164b23(0x243)]=_0x164b23(0x254);modalCallback=()=>{const _0x4ca897=_0x164b23;messages[_0x4ca897(0x24e)](_0x2ad3d3,0x1),localStorage[_0x4ca897(0x213)](_0x4ca897(0x233),JSON[_0x4ca897(0x234)](messages)),renderMessages();},modal['classList'][_0x164b23(0x1ed)](_0x164b23(0x1f3));}if(clearBtn)clearBtn[a0_0x18cec9(0x210)]=()=>{const _0xc86cac=a0_0x18cec9;if(!messages[_0xc86cac(0x1e8)])return;if(mTitle)mTitle[_0xc86cac(0x243)]=_0xc86cac(0x1df);if(mText)mText[_0xc86cac(0x243)]=_0xc86cac(0x219);modalCallback=async()=>{const _0x5c7252=_0xc86cac;messages=[],localStorage[_0x5c7252(0x1f1)](_0x5c7252(0x233)),renderMessages(),callBackend(_0x5c7252(0x20e),{});},modal[_0xc86cac(0x242)]['add'](_0xc86cac(0x1f3));};document['getElementById']('modalCancel')[a0_0x18cec9(0x210)]=()=>modal[a0_0x18cec9(0x242)][a0_0x18cec9(0x1e9)](a0_0x18cec9(0x1f3)),document[a0_0x18cec9(0x1f0)]('modalConfirm')[a0_0x18cec9(0x210)]=()=>{const _0x5c7526=a0_0x18cec9;if(modalCallback)modalCallback();modal['classList'][_0x5c7526(0x1e9)](_0x5c7526(0x1f3));},messageInput[a0_0x18cec9(0x1e0)](a0_0x18cec9(0x203),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x18cec9(0x1e0)](a0_0x18cec9(0x20c),_0x59dbd5=>{const _0x5e4283=a0_0x18cec9;_0x59dbd5[_0x5e4283(0x251)]===_0x5e4283(0x228)&&!_0x59dbd5[_0x5e4283(0x211)]&&(_0x59dbd5[_0x5e4283(0x21b)](),sendMessage());}),sendBtn[a0_0x18cec9(0x210)]=sendMessage,document[a0_0x18cec9(0x1e0)]('click',_0x1d076e=>{const _0x121b00=a0_0x18cec9;document['querySelectorAll'](_0x121b00(0x248))[_0x121b00(0x23c)](_0x18a036=>{const _0xc14ddf=_0x121b00;if(!_0x18a036['contains'](_0x1d076e[_0xc14ddf(0x1ff)]))_0x18a036[_0xc14ddf(0x242)][_0xc14ddf(0x1e9)](_0xc14ddf(0x21f));});});const saved=localStorage[a0_0x18cec9(0x1ec)](a0_0x18cec9(0x233));if(saved)try{messages=JSON[a0_0x18cec9(0x230)](saved),renderMessages();}catch(a0_0x59b190){}updateSendButton();