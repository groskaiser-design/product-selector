const a0_0xae57a2=a0_0x248d;(function(_0x219409,_0x18cb81){const _0x25e387=a0_0x248d,_0x3f1762=_0x219409();while(!![]){try{const _0x3a0028=parseInt(_0x25e387(0x177))/0x1*(parseInt(_0x25e387(0x16f))/0x2)+parseInt(_0x25e387(0x17f))/0x3+-parseInt(_0x25e387(0x192))/0x4+-parseInt(_0x25e387(0x182))/0x5+-parseInt(_0x25e387(0x164))/0x6*(parseInt(_0x25e387(0x16b))/0x7)+parseInt(_0x25e387(0x1a7))/0x8*(parseInt(_0x25e387(0x18d))/0x9)+parseInt(_0x25e387(0x16e))/0xa*(parseInt(_0x25e387(0x1c0))/0xb);if(_0x3a0028===_0x18cb81)break;else _0x3f1762['push'](_0x3f1762['shift']());}catch(_0x2ac118){_0x3f1762['push'](_0x3f1762['shift']());}}}(a0_0x24fa,0xab769));const tg=window[a0_0xae57a2(0x1ca)]?.['WebApp'],HOME_URL=a0_0xae57a2(0x155);function setupTelegramBackButton(){const _0x3da605=a0_0xae57a2;if(!tg)return;try{tg['ready'](),tg['expand'](),tg['setHeaderColor']?.('#050505');if(tg['isVersionAtLeast']?.(_0x3da605(0x1b7)))tg['disableVerticalSwipes']?.();const _0x4ee7a7=tg[_0x3da605(0x1a1)];if(_0x4ee7a7){_0x4ee7a7[_0x3da605(0x175)]();if(typeof _0x4ee7a7['offClick']===_0x3da605(0x1b5))try{_0x4ee7a7[_0x3da605(0x166)]();}catch(_0x1b7833){}_0x4ee7a7['onClick'](()=>{const _0x592e8c=_0x3da605;if(tg['HapticFeedback'])tg[_0x592e8c(0x1a6)][_0x592e8c(0x170)](_0x592e8c(0x16c));location[_0x592e8c(0x1b9)]=HOME_URL;});}}catch(_0x1763c5){console[_0x3da605(0x17e)]('TG\x20setup\x20error:',_0x1763c5);}}(function initStableLayout(){const _0x57fae8=a0_0xae57a2,_0x274c57=(function(){let _0x4d641d=!![];return function(_0x1ec40b,_0x36f850){const _0x4f67c9=_0x4d641d?function(){const _0x62fe8a=a0_0x248d;if(_0x36f850){const _0x460672=_0x36f850[_0x62fe8a(0x1bc)](_0x1ec40b,arguments);return _0x36f850=null,_0x460672;}}:function(){};return _0x4d641d=![],_0x4f67c9;};}()),_0x3cda02=document[_0x57fae8(0x1c4)](_0x57fae8(0x190)),_0x520a99=document[_0x57fae8(0x198)](_0x57fae8(0x1a2)),_0xd08d7c=document[_0x57fae8(0x198)](_0x57fae8(0x1a9)),_0x1adc64=document[_0x57fae8(0x198)](_0x57fae8(0x19f));function _0x5df656(){const _0x533b0e=_0x57fae8,_0x2aac43=_0x274c57(this,function(){const _0x1d4be6=a0_0x248d;return _0x2aac43[_0x1d4be6(0x1b8)]()[_0x1d4be6(0x1ac)](_0x1d4be6(0x16a))[_0x1d4be6(0x1b8)]()[_0x1d4be6(0x181)](_0x2aac43)[_0x1d4be6(0x1ac)](_0x1d4be6(0x16a));});_0x2aac43();if(!_0x3cda02)return;const _0x27ce81=tg&&tg[_0x533b0e(0x163)]?tg[_0x533b0e(0x163)]:window['innerHeight'];_0x3cda02['style'][_0x533b0e(0x1c5)]=_0x27ce81+'px';if(_0x520a99){const _0x1f2ad9=_0x520a99[_0x533b0e(0x189)];_0xd08d7c[_0x533b0e(0x15b)][_0x533b0e(0x19e)]=_0x1f2ad9+0x28+'px';}}tg?tg[_0x57fae8(0x1c7)]('viewportChanged',({isStateStable:_0x19259e})=>{_0x5df656();if(_0x19259e)requestAnimationFrame(()=>{_0xd08d7c['scrollTop']=_0xd08d7c['scrollHeight'];});}):window['addEventListener'](_0x57fae8(0x152),_0x5df656),_0x5df656(),_0x1adc64&&(_0x1adc64[_0x57fae8(0x187)](_0x57fae8(0x17c),()=>{requestAnimationFrame(_0x5df656);}),_0x1adc64[_0x57fae8(0x187)](_0x57fae8(0x1ab),()=>{setTimeout(()=>{const _0x1be93f=a0_0x248d;_0xd08d7c['scrollTop']=_0xd08d7c[_0x1be93f(0x165)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xae57a2(0x178),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xae57a2(0x198)]('chatArea'),emptyState=document[a0_0xae57a2(0x198)](a0_0xae57a2(0x154)),messageInput=document[a0_0xae57a2(0x198)](a0_0xae57a2(0x19f)),sendBtn=document[a0_0xae57a2(0x198)](a0_0xae57a2(0x194)),clearBtn=document[a0_0xae57a2(0x198)]('clearBtn'),modal=document['getElementById'](a0_0xae57a2(0x172)),mTitle=document[a0_0xae57a2(0x198)](a0_0xae57a2(0x153)),mText=document[a0_0xae57a2(0x198)](a0_0xae57a2(0x150));function a0_0x24fa(){const _0xffe2fb=['now','Очистить\x20историю?','value','send_message','first_name','div','function','getMinutes','6.1','toString','href','from','preventDefault','apply','splice','querySelectorAll','display','18007HTeamV','getItem','createElement','contains','querySelector','height','initDataUnsafe','onEvent','POST','none','Telegram','message-time','modalText','success','resize','modalTitle','emptyState','./router.html','ai_chat_messages','role','notificationOccurred','json','message\x20ai','style','user','forEach','scrollTop','push','appendChild','keydown','children','viewportHeight','6VNxBxa','scrollHeight','offClick','stopPropagation','floor','stringify','(((.+)+)+)+$','4727093xGFkoG','light','Ошибка\x20сети','250HEkJTz','1066THMMde','impactOccurred','parse','confirmModal','className','trim','show','touchstart','895FqqWNw','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Пустой\x20ответ','length','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','input','error','warn','3347556wHSHrq','innerHTML','constructor','5173970TMiYRz','message\x20','signal','abort','.message.show-delete','addEventListener','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','offsetHeight','flex','content','padStart','89487DBhvDV','auto','onclick','.container','classList','1021912NRJvzj','getHours','sendBtn','removeItem','target','remove','getElementById','typingIndicator','setItem','message-bubble','username','text/plain','paddingBottom','messageInput','debug_uid','BackButton','inputArea','Действие\x20необратимо.','show-delete','Начнется\x20новый\x20диалог.','HapticFeedback','832DKtOwG','random','chatArea','Ошибка\x20сервера','focus','search','textContent','add'];a0_0x24fa=function(){return _0xffe2fb;};return a0_0x24fa();}let modalCallback=null;async function callBackend(_0xb7c685,_0x1e6fcb){const _0x3aef0b=a0_0xae57a2,_0x47fd75=tg?.[_0x3aef0b(0x1c6)]?.[_0x3aef0b(0x15c)]||{},_0x2b973c=_0x47fd75['id']||localStorage[_0x3aef0b(0x1c1)]('debug_uid')||'d-'+Math[_0x3aef0b(0x168)](Math[_0x3aef0b(0x1a8)]()*0x3b9aca00);if(!_0x47fd75['id'])localStorage[_0x3aef0b(0x19a)](_0x3aef0b(0x1a0),_0x2b973c);const _0x4ff830={'action':_0xb7c685,'user_id':_0x2b973c,'user_data':{'first_name':_0x47fd75[_0x3aef0b(0x1b3)],'username':_0x47fd75[_0x3aef0b(0x19c)]},'init_data':tg?.['initData']||'',..._0x1e6fcb},_0x5b5fe8=new AbortController(),_0x4fc417=setTimeout(()=>_0x5b5fe8[_0x3aef0b(0x185)](),REQUEST_TIMEOUT_MS);try{const _0x5084eb=await fetch(BACKEND_URL,{'method':_0x3aef0b(0x1c8),'headers':{'Content-Type':_0x3aef0b(0x19d)},'body':JSON[_0x3aef0b(0x169)](_0x4ff830),'signal':_0x5b5fe8[_0x3aef0b(0x184)]});return clearTimeout(_0x4fc417),await _0x5084eb[_0x3aef0b(0x159)]();}catch(_0x34a2d2){return{'success':![],'error':String(_0x34a2d2)};}}function formatTime(_0x1442e3){const _0x14ec39=a0_0xae57a2,_0x34bce0=new Date(_0x1442e3);return String(_0x34bce0[_0x14ec39(0x193)]())[_0x14ec39(0x18c)](0x2,'0')+':'+String(_0x34bce0[_0x14ec39(0x1b6)]())[_0x14ec39(0x18c)](0x2,'0');}function createMessageElement(_0x3cf1e0,_0x13d06c){const _0x5d40d3=a0_0xae57a2,_0x432649=document[_0x5d40d3(0x1c2)]('div');_0x432649[_0x5d40d3(0x173)]=_0x5d40d3(0x183)+_0x3cf1e0[_0x5d40d3(0x157)];const _0x348cd7=document[_0x5d40d3(0x1c2)]('div');_0x348cd7[_0x5d40d3(0x173)]=_0x5d40d3(0x19b),_0x348cd7[_0x5d40d3(0x180)]=_0x3cf1e0[_0x5d40d3(0x18b)]['replace'](/\n/g,'<br>');const _0x3c1600=document[_0x5d40d3(0x1c2)]('div');_0x3c1600[_0x5d40d3(0x173)]='delete-btn',_0x3c1600[_0x5d40d3(0x180)]=_0x5d40d3(0x17b),_0x3c1600[_0x5d40d3(0x18f)]=_0x26b9fc=>{const _0x291bbd=_0x5d40d3;_0x26b9fc[_0x291bbd(0x167)](),confirmDelete(_0x13d06c);};let _0x33d9de;_0x348cd7['addEventListener'](_0x5d40d3(0x176),()=>_0x33d9de=setTimeout(()=>{const _0xfcee31=_0x5d40d3;_0x432649['classList'][_0xfcee31(0x1ae)]('show-delete');if(tg?.['HapticFeedback'])tg[_0xfcee31(0x1a6)][_0xfcee31(0x170)]('medium');},0x1f4)),_0x348cd7[_0x5d40d3(0x187)]('touchend',()=>clearTimeout(_0x33d9de));const _0x2e3bd1=document[_0x5d40d3(0x1c2)](_0x5d40d3(0x1b4));return _0x2e3bd1['className']=_0x5d40d3(0x1cb),_0x2e3bd1['textContent']=formatTime(_0x3cf1e0['timestamp']),_0x432649['appendChild'](_0x3c1600),_0x432649['appendChild'](_0x348cd7),_0x432649[_0x5d40d3(0x160)](_0x2e3bd1),_0x432649;}function createTypingIndicator(){const _0x5eda5c=a0_0xae57a2,_0x581db8=document[_0x5eda5c(0x1c2)](_0x5eda5c(0x1b4));return _0x581db8[_0x5eda5c(0x173)]=_0x5eda5c(0x15a),_0x581db8['id']=_0x5eda5c(0x199),_0x581db8[_0x5eda5c(0x180)]=_0x5eda5c(0x188),_0x581db8;}function renderMessages(){const _0x4b2921=a0_0xae57a2;Array[_0x4b2921(0x1ba)](chatArea[_0x4b2921(0x162)])[_0x4b2921(0x15d)](_0x46751b=>{const _0x4a0765=_0x4b2921;if(_0x46751b['id']!=='emptyState')_0x46751b[_0x4a0765(0x197)]();}),messages[_0x4b2921(0x17a)]>0x0?(emptyState['style'][_0x4b2921(0x1bf)]=_0x4b2921(0x1c9),messages['forEach']((_0x514091,_0x254733)=>chatArea[_0x4b2921(0x160)](createMessageElement(_0x514091,_0x254733)))):emptyState['style'][_0x4b2921(0x1bf)]=_0x4b2921(0x18a),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x4b2921(0x165)]);}function autoResizeTextarea(){const _0x1f5a15=a0_0xae57a2;messageInput[_0x1f5a15(0x15b)]['height']=_0x1f5a15(0x18e),messageInput[_0x1f5a15(0x15b)][_0x1f5a15(0x1c5)]=Math['min'](messageInput[_0x1f5a15(0x165)],0x78)+'px';}function updateSendButton(){const _0x2592cf=a0_0xae57a2,_0x4b8e4e=messageInput[_0x2592cf(0x1b1)][_0x2592cf(0x174)]();sendBtn['disabled']=!_0x4b8e4e||isTyping;}async function sendMessage(){const _0x41c5ed=a0_0xae57a2,_0x3aa1cb=messageInput[_0x41c5ed(0x1b1)]['trim']();if(!_0x3aa1cb||isTyping)return;if(tg?.[_0x41c5ed(0x1a6)])tg[_0x41c5ed(0x1a6)]['impactOccurred'](_0x41c5ed(0x16c));messages['push']({'role':'user','content':_0x3aa1cb,'timestamp':Date['now']()}),localStorage[_0x41c5ed(0x19a)](_0x41c5ed(0x156),JSON[_0x41c5ed(0x169)](messages)),renderMessages(),messageInput[_0x41c5ed(0x1b1)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x41c5ed(0x160)](createTypingIndicator()),chatArea[_0x41c5ed(0x15e)]=chatArea['scrollHeight'];const _0x424a59=await callBackend(_0x41c5ed(0x1b2),{'message':_0x3aa1cb});isTyping=![];const _0x16c1d3=document[_0x41c5ed(0x198)](_0x41c5ed(0x199));if(_0x16c1d3)_0x16c1d3[_0x41c5ed(0x197)]();let _0x25a00e=_0x41c5ed(0x16d);if(_0x424a59[_0x41c5ed(0x151)]){_0x25a00e=_0x424a59['text']||_0x41c5ed(0x179);if(tg?.[_0x41c5ed(0x1a6)])tg['HapticFeedback'][_0x41c5ed(0x158)]('success');}else{_0x25a00e=_0x424a59[_0x41c5ed(0x17d)]||_0x41c5ed(0x1aa);if(tg?.[_0x41c5ed(0x1a6)])tg[_0x41c5ed(0x1a6)]['notificationOccurred'](_0x41c5ed(0x17d));}messages[_0x41c5ed(0x15f)]({'role':'ai','content':_0x25a00e,'timestamp':Date[_0x41c5ed(0x1af)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x41c5ed(0x169)](messages)),renderMessages();}function confirmDelete(_0x403766){const _0x522b89=a0_0xae57a2;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x522b89(0x1ad)]=_0x522b89(0x1a3);modalCallback=()=>{const _0x23669f=_0x522b89;messages[_0x23669f(0x1bd)](_0x403766,0x1),localStorage[_0x23669f(0x19a)](_0x23669f(0x156),JSON[_0x23669f(0x169)](messages)),renderMessages();},modal[_0x522b89(0x191)]['add']('show');}function a0_0x248d(_0x138c0a,_0x4ab925){_0x138c0a=_0x138c0a-0x150;const _0x35adac=a0_0x24fa();let _0x38ea13=_0x35adac[_0x138c0a];return _0x38ea13;}if(clearBtn)clearBtn[a0_0xae57a2(0x18f)]=()=>{const _0x4a687e=a0_0xae57a2;if(!messages[_0x4a687e(0x17a)])return;if(mTitle)mTitle['textContent']=_0x4a687e(0x1b0);if(mText)mText['textContent']=_0x4a687e(0x1a5);modalCallback=async()=>{const _0x3e8358=_0x4a687e;messages=[],localStorage[_0x3e8358(0x195)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x4a687e(0x191)][_0x4a687e(0x1ae)]('show');};document[a0_0xae57a2(0x198)]('modalCancel')[a0_0xae57a2(0x18f)]=()=>modal[a0_0xae57a2(0x191)][a0_0xae57a2(0x197)](a0_0xae57a2(0x175)),document[a0_0xae57a2(0x198)]('modalConfirm')[a0_0xae57a2(0x18f)]=()=>{const _0x2404b5=a0_0xae57a2;if(modalCallback)modalCallback();modal[_0x2404b5(0x191)]['remove'](_0x2404b5(0x175));},messageInput[a0_0xae57a2(0x187)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0xae57a2(0x161),_0x48dbfd=>{const _0x1fe741=a0_0xae57a2;_0x48dbfd['key']==='Enter'&&!_0x48dbfd['shiftKey']&&(_0x48dbfd[_0x1fe741(0x1bb)](),sendMessage());}),sendBtn[a0_0xae57a2(0x18f)]=sendMessage,document[a0_0xae57a2(0x187)]('click',_0x34248d=>{const _0x46ca57=a0_0xae57a2;document[_0x46ca57(0x1be)](_0x46ca57(0x186))[_0x46ca57(0x15d)](_0x5b5e6b=>{const _0x3e74f7=_0x46ca57;if(!_0x5b5e6b[_0x3e74f7(0x1c3)](_0x34248d[_0x3e74f7(0x196)]))_0x5b5e6b[_0x3e74f7(0x191)][_0x3e74f7(0x197)](_0x3e74f7(0x1a4));});});const saved=localStorage[a0_0xae57a2(0x1c1)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0xae57a2(0x171)](saved),renderMessages();}catch(a0_0x144f37){}updateSendButton();