function a0_0x5c7a(_0xb606b1,_0x3bcd07){_0xb606b1=_0xb606b1-0x1d2;const _0x55a125=a0_0x2c78();let _0x1658d9=_0x55a125[_0xb606b1];return _0x1658d9;}const a0_0x4e79c0=a0_0x5c7a;(function(_0x5d3fd2,_0x567ce5){const _0x439e4d=a0_0x5c7a,_0x19b00d=_0x5d3fd2();while(!![]){try{const _0x329a8a=parseInt(_0x439e4d(0x245))/0x1+parseInt(_0x439e4d(0x1da))/0x2+parseInt(_0x439e4d(0x21f))/0x3+parseInt(_0x439e4d(0x1e1))/0x4+parseInt(_0x439e4d(0x227))/0x5*(-parseInt(_0x439e4d(0x22e))/0x6)+parseInt(_0x439e4d(0x20e))/0x7*(parseInt(_0x439e4d(0x243))/0x8)+-parseInt(_0x439e4d(0x1d7))/0x9;if(_0x329a8a===_0x567ce5)break;else _0x19b00d['push'](_0x19b00d['shift']());}catch(_0x36a1ed){_0x19b00d['push'](_0x19b00d['shift']());}}}(a0_0x2c78,0x8c808));const tg=window[a0_0x4e79c0(0x249)]?.[a0_0x4e79c0(0x1e4)],HOME_URL=a0_0x4e79c0(0x24c);function setupTelegramBackButton(){const _0x554c80=a0_0x4e79c0,_0x5a63ed=(function(){let _0x21e6e5=!![];return function(_0x320568,_0x425961){const _0x2c66d=_0x21e6e5?function(){const _0x468211=a0_0x5c7a;if(_0x425961){const _0x15767d=_0x425961[_0x468211(0x237)](_0x320568,arguments);return _0x425961=null,_0x15767d;}}:function(){};return _0x21e6e5=![],_0x2c66d;};}()),_0x1b6abf=_0x5a63ed(this,function(){const _0x4130b2=a0_0x5c7a;return _0x1b6abf[_0x4130b2(0x202)]()[_0x4130b2(0x1f5)](_0x4130b2(0x1fe))[_0x4130b2(0x202)]()[_0x4130b2(0x1e0)](_0x1b6abf)[_0x4130b2(0x1f5)](_0x4130b2(0x1fe));});_0x1b6abf();if(!tg)return;try{tg['ready'](),tg[_0x554c80(0x220)](),tg['setHeaderColor']?.(_0x554c80(0x21b));if(tg[_0x554c80(0x1f6)]?.(_0x554c80(0x1e3)))tg['disableVerticalSwipes']?.();const _0x1ddbd9=tg[_0x554c80(0x207)];if(_0x1ddbd9){_0x1ddbd9[_0x554c80(0x24d)]();if(typeof _0x1ddbd9[_0x554c80(0x204)]===_0x554c80(0x201))try{_0x1ddbd9[_0x554c80(0x204)]();}catch(_0x9ce8f7){}_0x1ddbd9[_0x554c80(0x210)](()=>{const _0x65f34c=_0x554c80;if(tg[_0x65f34c(0x240)])tg[_0x65f34c(0x240)][_0x65f34c(0x22a)]('light');location[_0x65f34c(0x1e2)]=HOME_URL;});}}catch(_0x117c26){console[_0x554c80(0x1df)](_0x554c80(0x248),_0x117c26);}}(function initStableLayout(){const _0x1c5f4d=a0_0x4e79c0,_0x26c385=document[_0x1c5f4d(0x232)](_0x1c5f4d(0x22f)),_0x5666a6=document[_0x1c5f4d(0x238)](_0x1c5f4d(0x22b)),_0xf1b3ee=document[_0x1c5f4d(0x238)](_0x1c5f4d(0x211)),_0x37f17d=document[_0x1c5f4d(0x238)](_0x1c5f4d(0x215));function _0x49d18b(){const _0x2810ab=_0x1c5f4d;if(!_0x26c385)return;const _0x519be3=tg&&tg[_0x2810ab(0x218)]?tg['viewportHeight']:window[_0x2810ab(0x241)];_0x26c385[_0x2810ab(0x1d5)]['height']=_0x519be3+'px';if(_0x5666a6){const _0x25e9da=_0x5666a6[_0x2810ab(0x1d2)];_0xf1b3ee[_0x2810ab(0x1d5)]['paddingBottom']=_0x25e9da+0x28+'px';}}tg?tg[_0x1c5f4d(0x233)](_0x1c5f4d(0x231),({isStateStable:_0x40b4a4})=>{_0x49d18b();if(_0x40b4a4)requestAnimationFrame(()=>{const _0x398d61=a0_0x5c7a;_0xf1b3ee[_0x398d61(0x1eb)]=_0xf1b3ee[_0x398d61(0x217)];});}):window[_0x1c5f4d(0x21e)](_0x1c5f4d(0x22d),_0x49d18b),_0x49d18b(),_0x37f17d&&(_0x37f17d['addEventListener'](_0x1c5f4d(0x224),()=>{requestAnimationFrame(_0x49d18b);}),_0x37f17d[_0x1c5f4d(0x21e)](_0x1c5f4d(0x1f9),()=>{setTimeout(()=>{const _0x5e4c87=a0_0x5c7a;_0xf1b3ee[_0x5e4c87(0x1eb)]=_0xf1b3ee[_0x5e4c87(0x217)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4e79c0(0x24a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4e79c0(0x238)](a0_0x4e79c0(0x211)),emptyState=document[a0_0x4e79c0(0x238)]('emptyState'),messageInput=document[a0_0x4e79c0(0x238)]('messageInput'),sendBtn=document[a0_0x4e79c0(0x238)](a0_0x4e79c0(0x1e6)),clearBtn=document[a0_0x4e79c0(0x238)](a0_0x4e79c0(0x1fa)),modal=document['getElementById'](a0_0x4e79c0(0x1ec)),mTitle=document[a0_0x4e79c0(0x238)]('modalTitle'),mText=document[a0_0x4e79c0(0x238)](a0_0x4e79c0(0x20c));let modalCallback=null;async function callBackend(_0x3550cd,_0xb18049){const _0x11dd67=a0_0x4e79c0,_0x481cee=tg?.[_0x11dd67(0x20f)]?.[_0x11dd67(0x250)]||{},_0x507a2a=_0x481cee['id']||localStorage['getItem']('debug_uid')||'d-'+Math['floor'](Math[_0x11dd67(0x23c)]()*0x3b9aca00);if(!_0x481cee['id'])localStorage[_0x11dd67(0x229)](_0x11dd67(0x244),_0x507a2a);const _0x203fb7={'action':_0x3550cd,'user_id':_0x507a2a,'user_data':{'first_name':_0x481cee['first_name'],'username':_0x481cee[_0x11dd67(0x1ff)]},'init_data':tg?.[_0x11dd67(0x1f3)]||'',..._0xb18049},_0x48b1c0=new AbortController(),_0x854dfc=setTimeout(()=>_0x48b1c0[_0x11dd67(0x23e)](),REQUEST_TIMEOUT_MS);try{const _0x2c57b0=await fetch(BACKEND_URL,{'method':_0x11dd67(0x1d6),'headers':{'Content-Type':_0x11dd67(0x1e9)},'body':JSON[_0x11dd67(0x1d8)](_0x203fb7),'signal':_0x48b1c0['signal']});return clearTimeout(_0x854dfc),await _0x2c57b0['json']();}catch(_0x2f7e86){return{'success':![],'error':String(_0x2f7e86)};}}function formatTime(_0x507628){const _0x2da085=a0_0x4e79c0,_0x333e33=new Date(_0x507628);return String(_0x333e33[_0x2da085(0x253)]())['padStart'](0x2,'0')+':'+String(_0x333e33[_0x2da085(0x23d)]())['padStart'](0x2,'0');}function createMessageElement(_0x6c4de,_0x5edb5b){const _0x18884a=a0_0x4e79c0,_0x12bfa7=document[_0x18884a(0x225)](_0x18884a(0x1db));_0x12bfa7[_0x18884a(0x1f8)]=_0x18884a(0x1e8)+_0x6c4de[_0x18884a(0x223)];const _0x17c7e1=document['createElement']('div');_0x17c7e1[_0x18884a(0x1f8)]='message-bubble',_0x17c7e1['innerHTML']=_0x6c4de[_0x18884a(0x1f0)][_0x18884a(0x20d)](/\n/g,'<br>');const _0x47b60d=document[_0x18884a(0x225)](_0x18884a(0x1db));_0x47b60d[_0x18884a(0x1f8)]=_0x18884a(0x221),_0x47b60d[_0x18884a(0x216)]=_0x18884a(0x1dc),_0x47b60d['onclick']=_0x40b005=>{const _0x5ce6ee=_0x18884a;_0x40b005[_0x5ce6ee(0x1ed)](),confirmDelete(_0x5edb5b);};let _0x520ef1;_0x17c7e1[_0x18884a(0x21e)](_0x18884a(0x1d4),()=>_0x520ef1=setTimeout(()=>{const _0x46ebb9=_0x18884a;_0x12bfa7[_0x46ebb9(0x21d)][_0x46ebb9(0x1ea)](_0x46ebb9(0x205));if(tg?.[_0x46ebb9(0x240)])tg['HapticFeedback'][_0x46ebb9(0x22a)](_0x46ebb9(0x24e));},0x1f4)),_0x17c7e1[_0x18884a(0x21e)](_0x18884a(0x236),()=>clearTimeout(_0x520ef1));const _0x3cc593=document['createElement'](_0x18884a(0x1db));return _0x3cc593[_0x18884a(0x1f8)]=_0x18884a(0x1d9),_0x3cc593['textContent']=formatTime(_0x6c4de[_0x18884a(0x200)]),_0x12bfa7[_0x18884a(0x23f)](_0x47b60d),_0x12bfa7[_0x18884a(0x23f)](_0x17c7e1),_0x12bfa7[_0x18884a(0x23f)](_0x3cc593),_0x12bfa7;}function createTypingIndicator(){const _0xc7c2ae=a0_0x4e79c0,_0x56ed73=document[_0xc7c2ae(0x225)]('div');return _0x56ed73['className']=_0xc7c2ae(0x230),_0x56ed73['id']='typingIndicator',_0x56ed73['innerHTML']=_0xc7c2ae(0x20b),_0x56ed73;}function renderMessages(){const _0x5a7711=a0_0x4e79c0;Array[_0x5a7711(0x1fd)](chatArea[_0x5a7711(0x1fb)])[_0x5a7711(0x247)](_0x1a5f70=>{const _0x5492d4=_0x5a7711;if(_0x1a5f70['id']!==_0x5492d4(0x1f2))_0x1a5f70['remove']();}),messages[_0x5a7711(0x251)]>0x0?(emptyState[_0x5a7711(0x1d5)][_0x5a7711(0x254)]=_0x5a7711(0x1e5),messages[_0x5a7711(0x247)]((_0x594807,_0x1a1ca9)=>chatArea['appendChild'](createMessageElement(_0x594807,_0x1a1ca9)))):emptyState['style'][_0x5a7711(0x254)]=_0x5a7711(0x206),requestAnimationFrame(()=>chatArea[_0x5a7711(0x1eb)]=chatArea[_0x5a7711(0x217)]);}function autoResizeTextarea(){const _0x302a6d=a0_0x4e79c0;messageInput[_0x302a6d(0x1d5)][_0x302a6d(0x1dd)]=_0x302a6d(0x21a),messageInput[_0x302a6d(0x1d5)][_0x302a6d(0x1dd)]=Math[_0x302a6d(0x1fc)](messageInput[_0x302a6d(0x217)],0x78)+'px';}function updateSendButton(){const _0x3678f0=a0_0x4e79c0,_0x128958=messageInput[_0x3678f0(0x242)][_0x3678f0(0x222)]();sendBtn[_0x3678f0(0x226)]=!_0x128958||isTyping;}async function sendMessage(){const _0x4f3ba7=a0_0x4e79c0,_0x361eef=messageInput[_0x4f3ba7(0x242)][_0x4f3ba7(0x222)]();if(!_0x361eef||isTyping)return;if(tg?.[_0x4f3ba7(0x240)])tg['HapticFeedback']['impactOccurred'](_0x4f3ba7(0x23a));messages[_0x4f3ba7(0x1f1)]({'role':_0x4f3ba7(0x250),'content':_0x361eef,'timestamp':Date[_0x4f3ba7(0x23b)]()}),localStorage[_0x4f3ba7(0x229)](_0x4f3ba7(0x1ee),JSON['stringify'](messages)),renderMessages(),messageInput[_0x4f3ba7(0x242)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4f3ba7(0x23f)](createTypingIndicator()),chatArea[_0x4f3ba7(0x1eb)]=chatArea[_0x4f3ba7(0x217)];const _0x217bff=await callBackend(_0x4f3ba7(0x24b),{'message':_0x361eef});isTyping=![];const _0x16c59f=document[_0x4f3ba7(0x238)]('typingIndicator');if(_0x16c59f)_0x16c59f[_0x4f3ba7(0x208)]();let _0x1e9037=_0x4f3ba7(0x24f);if(_0x217bff['success']){_0x1e9037=_0x217bff['text']||_0x4f3ba7(0x252);if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred']('success');}else{_0x1e9037=_0x217bff['error']||'Ошибка\x20сервера';if(tg?.[_0x4f3ba7(0x240)])tg[_0x4f3ba7(0x240)][_0x4f3ba7(0x239)]('error');}messages['push']({'role':'ai','content':_0x1e9037,'timestamp':Date[_0x4f3ba7(0x23b)]()}),localStorage[_0x4f3ba7(0x229)](_0x4f3ba7(0x1ee),JSON[_0x4f3ba7(0x1d8)](messages)),renderMessages();}function confirmDelete(_0x3e00f3){const _0x1cb2ef=a0_0x4e79c0;if(mTitle)mTitle[_0x1cb2ef(0x203)]='Удалить?';if(mText)mText[_0x1cb2ef(0x203)]='Действие\x20необратимо.';modalCallback=()=>{const _0x49ec7e=_0x1cb2ef;messages['splice'](_0x3e00f3,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x49ec7e(0x1d8)](messages)),renderMessages();},modal['classList']['add'](_0x1cb2ef(0x24d));}if(clearBtn)clearBtn['onclick']=()=>{const _0x22bb60=a0_0x4e79c0;if(!messages[_0x22bb60(0x251)])return;if(mTitle)mTitle['textContent']=_0x22bb60(0x1d3);if(mText)mText[_0x22bb60(0x203)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x3f5bb0=_0x22bb60;messages=[],localStorage[_0x3f5bb0(0x1f7)](_0x3f5bb0(0x1ee)),renderMessages(),callBackend(_0x3f5bb0(0x214),{});},modal[_0x22bb60(0x21d)][_0x22bb60(0x1ea)](_0x22bb60(0x24d));};document['getElementById'](a0_0x4e79c0(0x228))[a0_0x4e79c0(0x1f4)]=()=>modal[a0_0x4e79c0(0x21d)][a0_0x4e79c0(0x208)](a0_0x4e79c0(0x24d)),document[a0_0x4e79c0(0x238)](a0_0x4e79c0(0x20a))[a0_0x4e79c0(0x1f4)]=()=>{const _0x2948e8=a0_0x4e79c0;if(modalCallback)modalCallback();modal[_0x2948e8(0x21d)][_0x2948e8(0x208)](_0x2948e8(0x24d));},messageInput[a0_0x4e79c0(0x21e)](a0_0x4e79c0(0x224),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4e79c0(0x21e)](a0_0x4e79c0(0x21c),_0x45a884=>{const _0x3a5cf9=a0_0x4e79c0;_0x45a884[_0x3a5cf9(0x235)]===_0x3a5cf9(0x212)&&!_0x45a884[_0x3a5cf9(0x1de)]&&(_0x45a884[_0x3a5cf9(0x1ef)](),sendMessage());}),sendBtn[a0_0x4e79c0(0x1f4)]=sendMessage,document[a0_0x4e79c0(0x21e)](a0_0x4e79c0(0x219),_0x1e4859=>{const _0x5d07cc=a0_0x4e79c0;document[_0x5d07cc(0x209)](_0x5d07cc(0x246))[_0x5d07cc(0x247)](_0xd70970=>{const _0x74a57f=_0x5d07cc;if(!_0xd70970[_0x74a57f(0x22c)](_0x1e4859[_0x74a57f(0x213)]))_0xd70970[_0x74a57f(0x21d)]['remove']('show-delete');});});const saved=localStorage[a0_0x4e79c0(0x1e7)](a0_0x4e79c0(0x1ee));if(saved)try{messages=JSON[a0_0x4e79c0(0x234)](saved),renderMessages();}catch(a0_0x323f59){}function a0_0x2c78(){const _0xe039ee=['appendChild','HapticFeedback','innerHeight','value','808ZYkycM','debug_uid','406589VzRiYJ','.message.show-delete','forEach','TG\x20setup\x20error:','Telegram','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','send_message','./router.html','show','medium','Ошибка\x20сети','user','length','Пустой\x20ответ','getHours','display','offsetHeight','Очистить\x20историю?','touchstart','style','POST','15007302Rdnhet','stringify','message-time','1872372oqxEMZ','div','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','height','shiftKey','warn','constructor','326412KIGWqR','href','6.1','WebApp','none','sendBtn','getItem','message\x20','text/plain','add','scrollTop','confirmModal','stopPropagation','ai_chat_messages','preventDefault','content','push','emptyState','initData','onclick','search','isVersionAtLeast','removeItem','className','focus','clearBtn','children','min','from','(((.+)+)+)+$','username','timestamp','function','toString','textContent','offClick','show-delete','flex','BackButton','remove','querySelectorAll','modalConfirm','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','modalText','replace','24626hHMJsB','initDataUnsafe','onClick','chatArea','Enter','target','clear_history','messageInput','innerHTML','scrollHeight','viewportHeight','click','auto','#050505','keydown','classList','addEventListener','2461302hGsIAY','expand','delete-btn','trim','role','input','createElement','disabled','16535dhfLTr','modalCancel','setItem','impactOccurred','inputArea','contains','resize','648LxqMGw','.container','message\x20ai','viewportChanged','querySelector','onEvent','parse','key','touchend','apply','getElementById','notificationOccurred','light','now','random','getMinutes','abort'];a0_0x2c78=function(){return _0xe039ee;};return a0_0x2c78();}updateSendButton();