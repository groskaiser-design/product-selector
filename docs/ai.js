const a0_0x663fdb=a0_0x2dfc;(function(_0x486ad1,_0x49b47b){const _0x507a55=a0_0x2dfc,_0x2e05b4=_0x486ad1();while(!![]){try{const _0x1c5187=parseInt(_0x507a55(0x1ad))/0x1*(-parseInt(_0x507a55(0x165))/0x2)+parseInt(_0x507a55(0x154))/0x3*(parseInt(_0x507a55(0x157))/0x4)+parseInt(_0x507a55(0x158))/0x5+parseInt(_0x507a55(0x199))/0x6+parseInt(_0x507a55(0x161))/0x7*(-parseInt(_0x507a55(0x144))/0x8)+-parseInt(_0x507a55(0x13f))/0x9+-parseInt(_0x507a55(0x1a0))/0xa*(-parseInt(_0x507a55(0x19f))/0xb);if(_0x1c5187===_0x49b47b)break;else _0x2e05b4['push'](_0x2e05b4['shift']());}catch(_0x22f016){_0x2e05b4['push'](_0x2e05b4['shift']());}}}(a0_0x3656,0xeefc6));const tg=window[a0_0x663fdb(0x1a9)]?.[a0_0x663fdb(0x140)],HOME_URL=a0_0x663fdb(0x193);function setupTelegramBackButton(){const _0x4a90d8=a0_0x663fdb;if(!tg)return;try{tg[_0x4a90d8(0x156)](),tg[_0x4a90d8(0x197)](),tg[_0x4a90d8(0x192)]?.(_0x4a90d8(0x1a6));if(tg[_0x4a90d8(0x15b)]?.(_0x4a90d8(0x17f)))tg[_0x4a90d8(0x166)]?.();const _0x37cf2d=tg[_0x4a90d8(0x15e)];if(_0x37cf2d){_0x37cf2d[_0x4a90d8(0x179)]();if(typeof _0x37cf2d['offClick']===_0x4a90d8(0x160))try{_0x37cf2d['offClick']();}catch(_0x38fca4){}_0x37cf2d['onClick'](()=>{const _0x528a9d=_0x4a90d8;if(tg['HapticFeedback'])tg['HapticFeedback']['impactOccurred'](_0x528a9d(0x177));location[_0x528a9d(0x151)]=HOME_URL;});}}catch(_0x1c27a6){console[_0x4a90d8(0x14d)](_0x4a90d8(0x164),_0x1c27a6);}}(function initStableLayout(){const _0x56a70d=a0_0x663fdb,_0x2ecfe4=(function(){let _0x4d0df7=!![];return function(_0x3112f0,_0x403a5f){const _0x955425=_0x4d0df7?function(){const _0x523ac2=a0_0x2dfc;if(_0x403a5f){const _0x2ea50f=_0x403a5f[_0x523ac2(0x18d)](_0x3112f0,arguments);return _0x403a5f=null,_0x2ea50f;}}:function(){};return _0x4d0df7=![],_0x955425;};}()),_0x1a4bc6=document[_0x56a70d(0x162)]('.container'),_0x593561=document[_0x56a70d(0x146)]('inputArea'),_0x1136c6=document[_0x56a70d(0x146)](_0x56a70d(0x16b)),_0x24b66a=document[_0x56a70d(0x146)]('messageInput');function _0x104057(){const _0x231da5=_0x56a70d,_0x127d2d=_0x2ecfe4(this,function(){const _0x15be95=a0_0x2dfc;return _0x127d2d[_0x15be95(0x185)]()[_0x15be95(0x139)](_0x15be95(0x171))[_0x15be95(0x185)]()['constructor'](_0x127d2d)[_0x15be95(0x139)](_0x15be95(0x171));});_0x127d2d();if(!_0x1a4bc6)return;const _0x341db5=tg&&tg[_0x231da5(0x1ab)]?tg[_0x231da5(0x1ab)]:window[_0x231da5(0x152)];_0x1a4bc6[_0x231da5(0x180)][_0x231da5(0x19a)]=_0x341db5+'px';if(_0x593561){const _0x308a60=_0x593561[_0x231da5(0x1aa)];_0x1136c6[_0x231da5(0x180)]['paddingBottom']=_0x308a60+0x28+'px';}}tg?tg[_0x56a70d(0x174)](_0x56a70d(0x173),({isStateStable:_0x12b8a8})=>{_0x104057();if(_0x12b8a8)requestAnimationFrame(()=>{_0x1136c6['scrollTop']=_0x1136c6['scrollHeight'];});}):window['addEventListener']('resize',_0x104057),_0x104057(),_0x24b66a&&(_0x24b66a[_0x56a70d(0x13c)]('input',()=>{requestAnimationFrame(_0x104057);}),_0x24b66a[_0x56a70d(0x13c)](_0x56a70d(0x189),()=>{setTimeout(()=>{const _0x3d32fe=a0_0x2dfc;_0x1136c6[_0x3d32fe(0x187)]=_0x1136c6[_0x3d32fe(0x1a4)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x663fdb(0x18a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x663fdb(0x146)](a0_0x663fdb(0x16b)),emptyState=document[a0_0x663fdb(0x146)](a0_0x663fdb(0x19d)),messageInput=document['getElementById'](a0_0x663fdb(0x138)),sendBtn=document[a0_0x663fdb(0x146)](a0_0x663fdb(0x147)),clearBtn=document['getElementById'](a0_0x663fdb(0x15a)),modal=document[a0_0x663fdb(0x146)](a0_0x663fdb(0x16c)),mTitle=document[a0_0x663fdb(0x146)]('modalTitle'),mText=document[a0_0x663fdb(0x146)]('modalText');let modalCallback=null;function a0_0x3656(){const _0x412cb0=['message-time','trim','Enter','auto','warn','random','Очистить\x20историю?','Начнется\x20новый\x20диалог.','href','innerHeight','show-delete','1011eEfOYt','click','ready','14636QyOvmi','3342585XkdBov','getMinutes','clearBtn','isVersionAtLeast','send_message','Ошибка\x20сервера','BackButton','touchstart','function','14VJxtOa','querySelector','createElement','TG\x20setup\x20error:','324536ASHEbB','disableVerticalSwipes','innerHTML','floor','timestamp','target','chatArea','confirmModal','now','text/plain','key','ai_chat_messages','(((.+)+)+)+$','HapticFeedback','viewportChanged','onEvent','contains','username','light','getHours','show','div','modalCancel','abort','length','success','6.1','style','display','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','initData','touchend','toString','from','scrollTop','parse','focus','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','keydown','content','apply','impactOccurred','typingIndicator','className','debug_uid','setHeaderColor','./router.html','Пустой\x20ответ','querySelectorAll','message\x20','expand','json','11733162hzxIkH','height','appendChild','classList','emptyState','children','15821553edCFKb','10PwPdRy','preventDefault','remove','.message.show-delete','scrollHeight','medium','#050505','shiftKey','stringify','Telegram','offsetHeight','viewportHeight','textContent','10hJXQnM','messageInput','search','initDataUnsafe','value','addEventListener','setItem','<br>','15446286tQcTKa','WebApp','onclick','push','role','3910520lzrTPP','disabled','getElementById','sendBtn','error'];a0_0x3656=function(){return _0x412cb0;};return a0_0x3656();}async function callBackend(_0x5e5953,_0x57bd97){const _0x2b182d=a0_0x663fdb,_0xe26d65=tg?.[_0x2b182d(0x13a)]?.['user']||{},_0x459bab=_0xe26d65['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x2b182d(0x168)](Math[_0x2b182d(0x14e)]()*0x3b9aca00);if(!_0xe26d65['id'])localStorage['setItem'](_0x2b182d(0x191),_0x459bab);const _0x18cf74={'action':_0x5e5953,'user_id':_0x459bab,'user_data':{'first_name':_0xe26d65['first_name'],'username':_0xe26d65[_0x2b182d(0x176)]},'init_data':tg?.[_0x2b182d(0x183)]||'',..._0x57bd97},_0x561d4c=new AbortController(),_0xeefcb8=setTimeout(()=>_0x561d4c[_0x2b182d(0x17c)](),REQUEST_TIMEOUT_MS);try{const _0x210123=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x2b182d(0x16e)},'body':JSON[_0x2b182d(0x1a8)](_0x18cf74),'signal':_0x561d4c['signal']});return clearTimeout(_0xeefcb8),await _0x210123[_0x2b182d(0x198)]();}catch(_0x21f0f8){return{'success':![],'error':String(_0x21f0f8)};}}function a0_0x2dfc(_0x146690,_0x7871ae){_0x146690=_0x146690-0x138;const _0x214310=a0_0x3656();let _0x34f762=_0x214310[_0x146690];return _0x34f762;}function formatTime(_0xc7f40){const _0x405fb5=a0_0x663fdb,_0x25635a=new Date(_0xc7f40);return String(_0x25635a[_0x405fb5(0x178)]())['padStart'](0x2,'0')+':'+String(_0x25635a[_0x405fb5(0x159)]())['padStart'](0x2,'0');}function createMessageElement(_0x1879ef,_0x392172){const _0x49447e=a0_0x663fdb,_0x4fe18c=document[_0x49447e(0x163)](_0x49447e(0x17a));_0x4fe18c[_0x49447e(0x190)]=_0x49447e(0x196)+_0x1879ef[_0x49447e(0x143)];const _0x286807=document[_0x49447e(0x163)](_0x49447e(0x17a));_0x286807[_0x49447e(0x190)]='message-bubble',_0x286807['innerHTML']=_0x1879ef[_0x49447e(0x18c)]['replace'](/\n/g,_0x49447e(0x13e));const _0x6178af=document['createElement']('div');_0x6178af[_0x49447e(0x190)]='delete-btn',_0x6178af[_0x49447e(0x167)]=_0x49447e(0x182),_0x6178af[_0x49447e(0x141)]=_0x23c578=>{_0x23c578['stopPropagation'](),confirmDelete(_0x392172);};let _0xd4a470;_0x286807[_0x49447e(0x13c)](_0x49447e(0x15f),()=>_0xd4a470=setTimeout(()=>{const _0x48c41a=_0x49447e;_0x4fe18c[_0x48c41a(0x19c)]['add'](_0x48c41a(0x153));if(tg?.[_0x48c41a(0x172)])tg[_0x48c41a(0x172)]['impactOccurred'](_0x48c41a(0x1a5));},0x1f4)),_0x286807['addEventListener'](_0x49447e(0x184),()=>clearTimeout(_0xd4a470));const _0x1531e2=document['createElement'](_0x49447e(0x17a));return _0x1531e2[_0x49447e(0x190)]=_0x49447e(0x149),_0x1531e2[_0x49447e(0x1ac)]=formatTime(_0x1879ef[_0x49447e(0x169)]),_0x4fe18c[_0x49447e(0x19b)](_0x6178af),_0x4fe18c[_0x49447e(0x19b)](_0x286807),_0x4fe18c[_0x49447e(0x19b)](_0x1531e2),_0x4fe18c;}function createTypingIndicator(){const _0x4add88=a0_0x663fdb,_0x138ef1=document[_0x4add88(0x163)](_0x4add88(0x17a));return _0x138ef1[_0x4add88(0x190)]='message\x20ai',_0x138ef1['id']=_0x4add88(0x18f),_0x138ef1[_0x4add88(0x167)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x138ef1;}function renderMessages(){const _0x67c297=a0_0x663fdb;Array[_0x67c297(0x186)](chatArea[_0x67c297(0x19e)])['forEach'](_0x1cad58=>{const _0x56cd30=_0x67c297;if(_0x1cad58['id']!==_0x56cd30(0x19d))_0x1cad58[_0x56cd30(0x1a2)]();}),messages[_0x67c297(0x17d)]>0x0?(emptyState[_0x67c297(0x180)][_0x67c297(0x181)]='none',messages['forEach']((_0x2b5224,_0x12ede1)=>chatArea[_0x67c297(0x19b)](createMessageElement(_0x2b5224,_0x12ede1)))):emptyState[_0x67c297(0x180)]['display']='flex',requestAnimationFrame(()=>chatArea[_0x67c297(0x187)]=chatArea[_0x67c297(0x1a4)]);}function autoResizeTextarea(){const _0x4b3b35=a0_0x663fdb;messageInput[_0x4b3b35(0x180)][_0x4b3b35(0x19a)]=_0x4b3b35(0x14c),messageInput[_0x4b3b35(0x180)][_0x4b3b35(0x19a)]=Math['min'](messageInput[_0x4b3b35(0x1a4)],0x78)+'px';}function updateSendButton(){const _0x33a911=a0_0x663fdb,_0x1926a3=messageInput['value'][_0x33a911(0x14a)]();sendBtn[_0x33a911(0x145)]=!_0x1926a3||isTyping;}async function sendMessage(){const _0x4ca816=a0_0x663fdb,_0x18c06b=messageInput[_0x4ca816(0x13b)][_0x4ca816(0x14a)]();if(!_0x18c06b||isTyping)return;if(tg?.[_0x4ca816(0x172)])tg['HapticFeedback'][_0x4ca816(0x18e)](_0x4ca816(0x177));messages[_0x4ca816(0x142)]({'role':'user','content':_0x18c06b,'timestamp':Date[_0x4ca816(0x16d)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x4ca816(0x1a8)](messages)),renderMessages(),messageInput[_0x4ca816(0x13b)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4ca816(0x19b)](createTypingIndicator()),chatArea[_0x4ca816(0x187)]=chatArea[_0x4ca816(0x1a4)];const _0x4cb6eb=await callBackend(_0x4ca816(0x15c),{'message':_0x18c06b});isTyping=![];const _0x4c826f=document[_0x4ca816(0x146)](_0x4ca816(0x18f));if(_0x4c826f)_0x4c826f[_0x4ca816(0x1a2)]();let _0x521098='Ошибка\x20сети';if(_0x4cb6eb[_0x4ca816(0x17e)]){_0x521098=_0x4cb6eb['text']||_0x4ca816(0x194);if(tg?.[_0x4ca816(0x172)])tg[_0x4ca816(0x172)]['notificationOccurred'](_0x4ca816(0x17e));}else{_0x521098=_0x4cb6eb[_0x4ca816(0x148)]||_0x4ca816(0x15d);if(tg?.[_0x4ca816(0x172)])tg[_0x4ca816(0x172)]['notificationOccurred'](_0x4ca816(0x148));}messages[_0x4ca816(0x142)]({'role':'ai','content':_0x521098,'timestamp':Date[_0x4ca816(0x16d)]()}),localStorage[_0x4ca816(0x13d)]('ai_chat_messages',JSON[_0x4ca816(0x1a8)](messages)),renderMessages();}function confirmDelete(_0x2d61b1){const _0x4338d5=a0_0x663fdb;if(mTitle)mTitle[_0x4338d5(0x1ac)]='Удалить?';if(mText)mText[_0x4338d5(0x1ac)]='Действие\x20необратимо.';modalCallback=()=>{const _0x2111d7=_0x4338d5;messages['splice'](_0x2d61b1,0x1),localStorage[_0x2111d7(0x13d)](_0x2111d7(0x170),JSON[_0x2111d7(0x1a8)](messages)),renderMessages();},modal['classList']['add']('show');}if(clearBtn)clearBtn[a0_0x663fdb(0x141)]=()=>{const _0x3157a8=a0_0x663fdb;if(!messages['length'])return;if(mTitle)mTitle[_0x3157a8(0x1ac)]=_0x3157a8(0x14f);if(mText)mText[_0x3157a8(0x1ac)]=_0x3157a8(0x150);modalCallback=async()=>{messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x3157a8(0x19c)]['add'](_0x3157a8(0x179));};document[a0_0x663fdb(0x146)](a0_0x663fdb(0x17b))['onclick']=()=>modal[a0_0x663fdb(0x19c)][a0_0x663fdb(0x1a2)](a0_0x663fdb(0x179)),document[a0_0x663fdb(0x146)]('modalConfirm')[a0_0x663fdb(0x141)]=()=>{const _0x2a0ae5=a0_0x663fdb;if(modalCallback)modalCallback();modal[_0x2a0ae5(0x19c)][_0x2a0ae5(0x1a2)](_0x2a0ae5(0x179));},messageInput[a0_0x663fdb(0x13c)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x663fdb(0x13c)](a0_0x663fdb(0x18b),_0xe56951=>{const _0x332b95=a0_0x663fdb;_0xe56951[_0x332b95(0x16f)]===_0x332b95(0x14b)&&!_0xe56951[_0x332b95(0x1a7)]&&(_0xe56951[_0x332b95(0x1a1)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x663fdb(0x155),_0x3ab0a7=>{const _0x1c7260=a0_0x663fdb;document[_0x1c7260(0x195)](_0x1c7260(0x1a3))['forEach'](_0x8339=>{const _0x30a2b1=_0x1c7260;if(!_0x8339[_0x30a2b1(0x175)](_0x3ab0a7[_0x30a2b1(0x16a)]))_0x8339[_0x30a2b1(0x19c)][_0x30a2b1(0x1a2)](_0x30a2b1(0x153));});});const saved=localStorage['getItem'](a0_0x663fdb(0x170));if(saved)try{messages=JSON[a0_0x663fdb(0x188)](saved),renderMessages();}catch(a0_0x332706){}updateSendButton();