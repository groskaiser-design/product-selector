const a0_0x329cdc=a0_0x7081;(function(_0x2085a3,_0x3f018d){const _0x1a3526=a0_0x7081,_0x46d740=_0x2085a3();while(!![]){try{const _0x327138=-parseInt(_0x1a3526(0x22c))/0x1*(parseInt(_0x1a3526(0x215))/0x2)+parseInt(_0x1a3526(0x222))/0x3*(-parseInt(_0x1a3526(0x1ee))/0x4)+-parseInt(_0x1a3526(0x1d8))/0x5*(parseInt(_0x1a3526(0x24c))/0x6)+-parseInt(_0x1a3526(0x238))/0x7*(-parseInt(_0x1a3526(0x207))/0x8)+parseInt(_0x1a3526(0x1fe))/0x9*(-parseInt(_0x1a3526(0x1e7))/0xa)+-parseInt(_0x1a3526(0x1e1))/0xb*(parseInt(_0x1a3526(0x1c7))/0xc)+parseInt(_0x1a3526(0x227))/0xd;if(_0x327138===_0x3f018d)break;else _0x46d740['push'](_0x46d740['shift']());}catch(_0x580d8f){_0x46d740['push'](_0x46d740['shift']());}}}(a0_0x5c6f,0x660d5));const tg=window[a0_0x329cdc(0x1cf)]?.['WebApp'],HOME_URL=a0_0x329cdc(0x1d6);function setupTelegramBackButton(){const _0x4ed392=a0_0x329cdc;if(!tg)return;try{tg[_0x4ed392(0x1e2)](),tg[_0x4ed392(0x23c)](),tg[_0x4ed392(0x20a)]?.(_0x4ed392(0x232));if(tg[_0x4ed392(0x205)]?.(_0x4ed392(0x241)))tg[_0x4ed392(0x210)]?.();const _0x452510=tg['BackButton'];if(_0x452510){_0x452510['show']();if(typeof _0x452510['offClick']==='function')try{_0x452510['offClick']();}catch(_0x4d4bc3){}_0x452510[_0x4ed392(0x1e0)](()=>{const _0x216d87=_0x4ed392;if(tg[_0x216d87(0x248)])tg['HapticFeedback'][_0x216d87(0x237)](_0x216d87(0x1dc));location[_0x216d87(0x228)]=HOME_URL;});}}catch(_0xd8cef1){console[_0x4ed392(0x246)]('TG\x20setup\x20error:',_0xd8cef1);}}(function initStableLayout(){const _0x251dde=a0_0x329cdc,_0xab0134=(function(){let _0xe069c3=!![];return function(_0x270b7d,_0x5cd2cd){const _0x56f313=_0xe069c3?function(){const _0x491088=a0_0x7081;if(_0x5cd2cd){const _0x42c7b0=_0x5cd2cd[_0x491088(0x23f)](_0x270b7d,arguments);return _0x5cd2cd=null,_0x42c7b0;}}:function(){};return _0xe069c3=![],_0x56f313;};}()),_0x4ca3e7=document[_0x251dde(0x230)](_0x251dde(0x221)),_0x2ceead=document['getElementById'](_0x251dde(0x1fc)),_0x449c99=document[_0x251dde(0x1c6)]('chatArea'),_0x249169=document['getElementById']('messageInput');function _0x5f4391(){const _0x4d5e5f=_0x251dde,_0x4b6654=_0xab0134(this,function(){const _0x927183=a0_0x7081;return _0x4b6654[_0x927183(0x1f1)]()['search'](_0x927183(0x20d))[_0x927183(0x1f1)]()[_0x927183(0x21c)](_0x4b6654)[_0x927183(0x1e6)](_0x927183(0x20d));});_0x4b6654();if(!_0x4ca3e7)return;const _0x7091c2=tg&&tg[_0x4d5e5f(0x1dd)]?tg[_0x4d5e5f(0x1dd)]:window[_0x4d5e5f(0x201)];_0x4ca3e7['style']['height']=_0x7091c2+'px';if(_0x2ceead){const _0x1225ef=_0x2ceead['offsetHeight'];_0x449c99[_0x4d5e5f(0x1d2)][_0x4d5e5f(0x204)]=_0x1225ef+0x28+'px';}}tg?tg[_0x251dde(0x1f0)](_0x251dde(0x1fa),({isStateStable:_0x1b4a20})=>{_0x5f4391();if(_0x1b4a20)requestAnimationFrame(()=>{const _0x4896be=a0_0x7081;_0x449c99[_0x4896be(0x213)]=_0x449c99[_0x4896be(0x200)];});}):window[_0x251dde(0x225)](_0x251dde(0x1da),_0x5f4391),_0x5f4391(),_0x249169&&(_0x249169[_0x251dde(0x225)]('input',()=>{requestAnimationFrame(_0x5f4391);}),_0x249169[_0x251dde(0x225)]('focus',()=>{setTimeout(()=>{const _0x3f3b79=a0_0x7081;_0x449c99[_0x3f3b79(0x213)]=_0x449c99[_0x3f3b79(0x200)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x329cdc(0x208),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x5c6f(){const _0x19a9f0=['Telegram','emptyState','error','style','send_message','height','innerHTML','./router.html','abort','17785mIQIVP','Действие\x20необратимо.','resize','min','light','viewportHeight','onclick','<br>','onClick','11nPUJfi','ready','add','user','ai_chat_messages','search','20zIWQng','show','timestamp','Ошибка\x20сервера','none','initData','Ошибка\x20сети','56WpXlXi','signal','onEvent','toString','replace','from','debug_uid','content','initDataUnsafe','modalConfirm','modalTitle','floor','viewportChanged','clearBtn','inputArea','first_name','963567WXfYUR','Пустой\x20ответ','scrollHeight','innerHeight','message\x20','Enter','paddingBottom','isVersionAtLeast','className','187800DDUwOB','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','clear_history','setHeaderColor','message\x20ai','key','(((.+)+)+)+$','contains','message-bubble','disableVerticalSwipes','appendChild','message-time','scrollTop','getMinutes','2tRGrjz','chatArea','touchstart','target','padStart','modalCancel','click','constructor','push','username','disabled','forEach','.container','117681duWyvH','confirmModal','modalText','addEventListener','json','12806430nWLWOM','href','medium','touchend','querySelectorAll','88817IPAFoh','div','typingIndicator','POST','querySelector','now','#050505','value','show-delete','stopPropagation','auto','impactOccurred','105kYEiOM','textContent','random','notificationOccurred','expand','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','display','apply','classList','6.1','.message.show-delete','preventDefault','createElement','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','warn','role','HapticFeedback','length','text/plain','remove','42lGeVvW','removeItem','getItem','getElementById','506520GdOlXG','getHours','setItem','Начнется\x20новый\x20диалог.','input','messageInput','success','text'];a0_0x5c6f=function(){return _0x19a9f0;};return a0_0x5c6f();}let messages=[],isTyping=![];const chatArea=document[a0_0x329cdc(0x1c6)](a0_0x329cdc(0x216)),emptyState=document['getElementById'](a0_0x329cdc(0x1d0)),messageInput=document['getElementById'](a0_0x329cdc(0x1cc)),sendBtn=document[a0_0x329cdc(0x1c6)]('sendBtn'),clearBtn=document[a0_0x329cdc(0x1c6)](a0_0x329cdc(0x1fb)),modal=document[a0_0x329cdc(0x1c6)](a0_0x329cdc(0x223)),mTitle=document[a0_0x329cdc(0x1c6)](a0_0x329cdc(0x1f8)),mText=document[a0_0x329cdc(0x1c6)](a0_0x329cdc(0x224));let modalCallback=null;async function callBackend(_0x2d2e5a,_0x25f0e7){const _0x1816f1=a0_0x329cdc,_0x4604af=tg?.[_0x1816f1(0x1f6)]?.[_0x1816f1(0x1e4)]||{},_0x1e6f91=_0x4604af['id']||localStorage[_0x1816f1(0x24e)](_0x1816f1(0x1f4))||'d-'+Math[_0x1816f1(0x1f9)](Math[_0x1816f1(0x23a)]()*0x3b9aca00);if(!_0x4604af['id'])localStorage[_0x1816f1(0x1c9)](_0x1816f1(0x1f4),_0x1e6f91);const _0x1b5840={'action':_0x2d2e5a,'user_id':_0x1e6f91,'user_data':{'first_name':_0x4604af[_0x1816f1(0x1fd)],'username':_0x4604af[_0x1816f1(0x21e)]},'init_data':tg?.[_0x1816f1(0x1ec)]||'',..._0x25f0e7},_0x1d1f72=new AbortController(),_0x3f1ef0=setTimeout(()=>_0x1d1f72[_0x1816f1(0x1d7)](),REQUEST_TIMEOUT_MS);try{const _0x31a879=await fetch(BACKEND_URL,{'method':_0x1816f1(0x22f),'headers':{'Content-Type':_0x1816f1(0x24a)},'body':JSON['stringify'](_0x1b5840),'signal':_0x1d1f72[_0x1816f1(0x1ef)]});return clearTimeout(_0x3f1ef0),await _0x31a879[_0x1816f1(0x226)]();}catch(_0x21454f){return{'success':![],'error':String(_0x21454f)};}}function formatTime(_0x28548){const _0x48706e=a0_0x329cdc,_0x35953f=new Date(_0x28548);return String(_0x35953f[_0x48706e(0x1c8)]())[_0x48706e(0x219)](0x2,'0')+':'+String(_0x35953f[_0x48706e(0x214)]())[_0x48706e(0x219)](0x2,'0');}function createMessageElement(_0x5da891,_0x916490){const _0x4f8cfd=a0_0x329cdc,_0x39a123=document[_0x4f8cfd(0x244)]('div');_0x39a123['className']=_0x4f8cfd(0x202)+_0x5da891[_0x4f8cfd(0x247)];const _0x5cc009=document[_0x4f8cfd(0x244)](_0x4f8cfd(0x22d));_0x5cc009[_0x4f8cfd(0x206)]=_0x4f8cfd(0x20f),_0x5cc009[_0x4f8cfd(0x1d5)]=_0x5da891[_0x4f8cfd(0x1f5)][_0x4f8cfd(0x1f2)](/\n/g,_0x4f8cfd(0x1df));const _0xb21b20=document['createElement'](_0x4f8cfd(0x22d));_0xb21b20[_0x4f8cfd(0x206)]='delete-btn',_0xb21b20[_0x4f8cfd(0x1d5)]=_0x4f8cfd(0x245),_0xb21b20[_0x4f8cfd(0x1de)]=_0x300bb1=>{const _0x444759=_0x4f8cfd;_0x300bb1[_0x444759(0x235)](),confirmDelete(_0x916490);};let _0x5d460f;_0x5cc009[_0x4f8cfd(0x225)](_0x4f8cfd(0x217),()=>_0x5d460f=setTimeout(()=>{const _0x49cb97=_0x4f8cfd;_0x39a123[_0x49cb97(0x240)]['add'](_0x49cb97(0x234));if(tg?.[_0x49cb97(0x248)])tg[_0x49cb97(0x248)]['impactOccurred'](_0x49cb97(0x229));},0x1f4)),_0x5cc009[_0x4f8cfd(0x225)](_0x4f8cfd(0x22a),()=>clearTimeout(_0x5d460f));const _0x33977e=document[_0x4f8cfd(0x244)](_0x4f8cfd(0x22d));return _0x33977e['className']=_0x4f8cfd(0x212),_0x33977e['textContent']=formatTime(_0x5da891[_0x4f8cfd(0x1e9)]),_0x39a123['appendChild'](_0xb21b20),_0x39a123[_0x4f8cfd(0x211)](_0x5cc009),_0x39a123[_0x4f8cfd(0x211)](_0x33977e),_0x39a123;}function createTypingIndicator(){const _0x3e407a=a0_0x329cdc,_0x321a6d=document['createElement'](_0x3e407a(0x22d));return _0x321a6d[_0x3e407a(0x206)]=_0x3e407a(0x20b),_0x321a6d['id']='typingIndicator',_0x321a6d[_0x3e407a(0x1d5)]=_0x3e407a(0x23d),_0x321a6d;}function renderMessages(){const _0x1dec05=a0_0x329cdc;Array[_0x1dec05(0x1f3)](chatArea['children'])[_0x1dec05(0x220)](_0x496e1b=>{const _0x279d95=_0x1dec05;if(_0x496e1b['id']!==_0x279d95(0x1d0))_0x496e1b[_0x279d95(0x24b)]();}),messages[_0x1dec05(0x249)]>0x0?(emptyState[_0x1dec05(0x1d2)][_0x1dec05(0x23e)]=_0x1dec05(0x1eb),messages['forEach']((_0x186f28,_0x509af6)=>chatArea['appendChild'](createMessageElement(_0x186f28,_0x509af6)))):emptyState[_0x1dec05(0x1d2)][_0x1dec05(0x23e)]='flex',requestAnimationFrame(()=>chatArea[_0x1dec05(0x213)]=chatArea[_0x1dec05(0x200)]);}function autoResizeTextarea(){const _0x49f7f6=a0_0x329cdc;messageInput[_0x49f7f6(0x1d2)][_0x49f7f6(0x1d4)]=_0x49f7f6(0x236),messageInput[_0x49f7f6(0x1d2)][_0x49f7f6(0x1d4)]=Math[_0x49f7f6(0x1db)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x44da93=a0_0x329cdc,_0x476483=messageInput['value']['trim']();sendBtn[_0x44da93(0x21f)]=!_0x476483||isTyping;}async function sendMessage(){const _0x35cbc7=a0_0x329cdc,_0x6594b8=messageInput[_0x35cbc7(0x233)]['trim']();if(!_0x6594b8||isTyping)return;if(tg?.[_0x35cbc7(0x248)])tg['HapticFeedback'][_0x35cbc7(0x237)](_0x35cbc7(0x1dc));messages['push']({'role':'user','content':_0x6594b8,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x35cbc7(0x211)](createTypingIndicator()),chatArea[_0x35cbc7(0x213)]=chatArea[_0x35cbc7(0x200)];const _0x45742e=await callBackend(_0x35cbc7(0x1d3),{'message':_0x6594b8});isTyping=![];const _0x2b19a9=document[_0x35cbc7(0x1c6)](_0x35cbc7(0x22e));if(_0x2b19a9)_0x2b19a9[_0x35cbc7(0x24b)]();let _0x33af1=_0x35cbc7(0x1ed);if(_0x45742e[_0x35cbc7(0x1cd)]){_0x33af1=_0x45742e[_0x35cbc7(0x1ce)]||_0x35cbc7(0x1ff);if(tg?.[_0x35cbc7(0x248)])tg[_0x35cbc7(0x248)][_0x35cbc7(0x23b)](_0x35cbc7(0x1cd));}else{_0x33af1=_0x45742e[_0x35cbc7(0x1d1)]||_0x35cbc7(0x1ea);if(tg?.[_0x35cbc7(0x248)])tg[_0x35cbc7(0x248)][_0x35cbc7(0x23b)](_0x35cbc7(0x1d1));}messages[_0x35cbc7(0x21d)]({'role':'ai','content':_0x33af1,'timestamp':Date[_0x35cbc7(0x231)]()}),localStorage['setItem'](_0x35cbc7(0x1e5),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x30756a){const _0x467ddf=a0_0x329cdc;if(mTitle)mTitle[_0x467ddf(0x239)]='Удалить?';if(mText)mText[_0x467ddf(0x239)]=_0x467ddf(0x1d9);modalCallback=()=>{const _0x30afdc=_0x467ddf;messages['splice'](_0x30756a,0x1),localStorage[_0x30afdc(0x1c9)](_0x30afdc(0x1e5),JSON['stringify'](messages)),renderMessages();},modal[_0x467ddf(0x240)][_0x467ddf(0x1e3)]('show');}if(clearBtn)clearBtn[a0_0x329cdc(0x1de)]=()=>{const _0x550ecb=a0_0x329cdc;if(!messages[_0x550ecb(0x249)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x550ecb(0x239)]=_0x550ecb(0x1ca);modalCallback=async()=>{const _0x3d948d=_0x550ecb;messages=[],localStorage[_0x3d948d(0x24d)]('ai_chat_messages'),renderMessages(),callBackend(_0x3d948d(0x209),{});},modal[_0x550ecb(0x240)][_0x550ecb(0x1e3)](_0x550ecb(0x1e8));};document[a0_0x329cdc(0x1c6)](a0_0x329cdc(0x21a))[a0_0x329cdc(0x1de)]=()=>modal['classList'][a0_0x329cdc(0x24b)](a0_0x329cdc(0x1e8)),document['getElementById'](a0_0x329cdc(0x1f7))[a0_0x329cdc(0x1de)]=()=>{const _0x48762f=a0_0x329cdc;if(modalCallback)modalCallback();modal[_0x48762f(0x240)][_0x48762f(0x24b)](_0x48762f(0x1e8));},messageInput[a0_0x329cdc(0x225)](a0_0x329cdc(0x1cb),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x329cdc(0x225)]('keydown',_0x215470=>{const _0x109139=a0_0x329cdc;_0x215470[_0x109139(0x20c)]===_0x109139(0x203)&&!_0x215470['shiftKey']&&(_0x215470[_0x109139(0x243)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x329cdc(0x225)](a0_0x329cdc(0x21b),_0x75c1c2=>{const _0x137191=a0_0x329cdc;document[_0x137191(0x22b)](_0x137191(0x242))[_0x137191(0x220)](_0x37277f=>{const _0x51cf33=_0x137191;if(!_0x37277f[_0x51cf33(0x20e)](_0x75c1c2[_0x51cf33(0x218)]))_0x37277f[_0x51cf33(0x240)]['remove'](_0x51cf33(0x234));});});const saved=localStorage['getItem'](a0_0x329cdc(0x1e5));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x498bb2){}function a0_0x7081(_0x56c252,_0x12a7d5){_0x56c252=_0x56c252-0x1c6;const _0x1486cd=a0_0x5c6f();let _0x19151a=_0x1486cd[_0x56c252];return _0x19151a;}updateSendButton();