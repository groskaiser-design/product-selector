const a0_0x30619a=a0_0x2a86;(function(_0x161f68,_0x1733a9){const _0x47e4ee=a0_0x2a86,_0x3d6165=_0x161f68();while(!![]){try{const _0x56f3d8=-parseInt(_0x47e4ee(0x153))/0x1+-parseInt(_0x47e4ee(0x131))/0x2*(parseInt(_0x47e4ee(0x133))/0x3)+-parseInt(_0x47e4ee(0x136))/0x4*(-parseInt(_0x47e4ee(0x13c))/0x5)+-parseInt(_0x47e4ee(0x175))/0x6*(-parseInt(_0x47e4ee(0x17d))/0x7)+-parseInt(_0x47e4ee(0x14c))/0x8*(-parseInt(_0x47e4ee(0x11f))/0x9)+-parseInt(_0x47e4ee(0x169))/0xa*(-parseInt(_0x47e4ee(0x172))/0xb)+-parseInt(_0x47e4ee(0x155))/0xc*(parseInt(_0x47e4ee(0x137))/0xd);if(_0x56f3d8===_0x1733a9)break;else _0x3d6165['push'](_0x3d6165['shift']());}catch(_0x4ceae3){_0x3d6165['push'](_0x3d6165['shift']());}}}(a0_0xa0a4,0x81740));const tg=window[a0_0x30619a(0x196)]?.['WebApp'],HOME_URL=a0_0x30619a(0x18a);function setupTelegramBackButton(){const _0x3034b4=a0_0x30619a;if(!tg)return;try{tg[_0x3034b4(0x194)](),tg[_0x3034b4(0x12d)](),tg['setHeaderColor']?.(_0x3034b4(0x141));if(tg[_0x3034b4(0x151)]?.(_0x3034b4(0x142)))tg[_0x3034b4(0x130)]?.();const _0x11e5ae=tg[_0x3034b4(0x148)];if(_0x11e5ae){_0x11e5ae[_0x3034b4(0x163)]();if(typeof _0x11e5ae[_0x3034b4(0x116)]===_0x3034b4(0x16b))try{_0x11e5ae['offClick']();}catch(_0x201418){}_0x11e5ae[_0x3034b4(0x150)](()=>{const _0x85f5d3=_0x3034b4;if(tg[_0x85f5d3(0x167)])tg[_0x85f5d3(0x167)]['impactOccurred'](_0x85f5d3(0x145));location[_0x85f5d3(0x181)]=HOME_URL;});}}catch(_0x14e2e4){console['warn'](_0x3034b4(0x18b),_0x14e2e4);}}(function initStableLayout(){const _0x4936c3=a0_0x30619a,_0x4a70ad=(function(){let _0x59e354=!![];return function(_0x1403bd,_0x1d4f69){const _0x945c88=_0x59e354?function(){const _0x2f76d9=a0_0x2a86;if(_0x1d4f69){const _0x39c5b2=_0x1d4f69[_0x2f76d9(0x13e)](_0x1403bd,arguments);return _0x1d4f69=null,_0x39c5b2;}}:function(){};return _0x59e354=![],_0x945c88;};}()),_0x27eb09=document[_0x4936c3(0x121)](_0x4936c3(0x159)),_0x22568f=document[_0x4936c3(0x183)](_0x4936c3(0x165)),_0x2eb92e=document[_0x4936c3(0x183)]('chatArea'),_0x128783=document['getElementById'](_0x4936c3(0x191));function _0x6078c7(){const _0x14f8d1=_0x4936c3,_0x3d0795=_0x4a70ad(this,function(){const _0x305690=a0_0x2a86;return _0x3d0795[_0x305690(0x124)]()[_0x305690(0x16c)](_0x305690(0x174))[_0x305690(0x124)]()[_0x305690(0x14f)](_0x3d0795)['search'](_0x305690(0x174));});_0x3d0795();if(!_0x27eb09)return;const _0x1b3e86=tg&&tg[_0x14f8d1(0x147)]?tg['viewportHeight']:window['innerHeight'];_0x27eb09['style'][_0x14f8d1(0x12c)]=_0x1b3e86+'px';if(_0x22568f){const _0x49c560=_0x22568f['offsetHeight'];_0x2eb92e['style'][_0x14f8d1(0x161)]=_0x49c560+0x28+'px';}}tg?tg[_0x4936c3(0x134)](_0x4936c3(0x13a),({isStateStable:_0x5ef0e2})=>{_0x6078c7();if(_0x5ef0e2)requestAnimationFrame(()=>{const _0x42c840=a0_0x2a86;_0x2eb92e[_0x42c840(0x164)]=_0x2eb92e['scrollHeight'];});}):window[_0x4936c3(0x179)]('resize',_0x6078c7),_0x6078c7(),_0x128783&&(_0x128783[_0x4936c3(0x179)](_0x4936c3(0x16e),()=>{requestAnimationFrame(_0x6078c7);}),_0x128783[_0x4936c3(0x179)](_0x4936c3(0x115),()=>{setTimeout(()=>{const _0x2f21fa=a0_0x2a86;_0x2eb92e[_0x2f21fa(0x164)]=_0x2eb92e['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x30619a(0x187),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x30619a(0x183)]('chatArea'),emptyState=document[a0_0x30619a(0x183)](a0_0x30619a(0x127)),messageInput=document[a0_0x30619a(0x183)]('messageInput'),sendBtn=document[a0_0x30619a(0x183)](a0_0x30619a(0x185)),clearBtn=document[a0_0x30619a(0x183)](a0_0x30619a(0x197)),modal=document[a0_0x30619a(0x183)](a0_0x30619a(0x14d)),mTitle=document[a0_0x30619a(0x183)](a0_0x30619a(0x192)),mText=document[a0_0x30619a(0x183)](a0_0x30619a(0x160));let modalCallback=null;async function callBackend(_0x2b5403,_0x5ace2e){const _0x3d4c13=a0_0x30619a,_0x14a196=tg?.[_0x3d4c13(0x173)]?.[_0x3d4c13(0x168)]||{},_0x320aa5=_0x14a196['id']||localStorage[_0x3d4c13(0x16f)](_0x3d4c13(0x135))||'d-'+Math[_0x3d4c13(0x186)](Math['random']()*0x3b9aca00);if(!_0x14a196['id'])localStorage['setItem'](_0x3d4c13(0x135),_0x320aa5);const _0x5c7429={'action':_0x2b5403,'user_id':_0x320aa5,'user_data':{'first_name':_0x14a196['first_name'],'username':_0x14a196['username']},'init_data':tg?.[_0x3d4c13(0x15b)]||'',..._0x5ace2e},_0x3b2ede=new AbortController(),_0x4b6c6a=setTimeout(()=>_0x3b2ede[_0x3d4c13(0x12b)](),REQUEST_TIMEOUT_MS);try{const _0x3a0300=await fetch(BACKEND_URL,{'method':_0x3d4c13(0x11e),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x3d4c13(0x140)](_0x5c7429),'signal':_0x3b2ede['signal']});return clearTimeout(_0x4b6c6a),await _0x3a0300[_0x3d4c13(0x129)]();}catch(_0x2ba7d4){return{'success':![],'error':String(_0x2ba7d4)};}}function formatTime(_0x4a4c52){const _0x1f4d14=a0_0x30619a,_0x5cbfdc=new Date(_0x4a4c52);return String(_0x5cbfdc[_0x1f4d14(0x195)]())['padStart'](0x2,'0')+':'+String(_0x5cbfdc[_0x1f4d14(0x119)]())[_0x1f4d14(0x13f)](0x2,'0');}function createMessageElement(_0x5390ad,_0x4d0363){const _0x24969d=a0_0x30619a,_0x44f20c=document['createElement'](_0x24969d(0x11c));_0x44f20c[_0x24969d(0x12a)]=_0x24969d(0x17f)+_0x5390ad[_0x24969d(0x13b)];const _0x565f0c=document[_0x24969d(0x120)]('div');_0x565f0c['className']=_0x24969d(0x18c),_0x565f0c[_0x24969d(0x188)]=_0x5390ad[_0x24969d(0x158)][_0x24969d(0x118)](/\n/g,'<br>');const _0x1ef888=document['createElement'](_0x24969d(0x11c));_0x1ef888[_0x24969d(0x12a)]='delete-btn',_0x1ef888[_0x24969d(0x188)]=_0x24969d(0x132),_0x1ef888[_0x24969d(0x17e)]=_0x16f228=>{const _0x120d3a=_0x24969d;_0x16f228[_0x120d3a(0x122)](),confirmDelete(_0x4d0363);};let _0x3f8ed5;_0x565f0c['addEventListener'](_0x24969d(0x15a),()=>_0x3f8ed5=setTimeout(()=>{const _0x5711d4=_0x24969d;_0x44f20c['classList'][_0x5711d4(0x125)](_0x5711d4(0x17b));if(tg?.[_0x5711d4(0x167)])tg[_0x5711d4(0x167)]['impactOccurred'](_0x5711d4(0x156));},0x1f4)),_0x565f0c[_0x24969d(0x179)]('touchend',()=>clearTimeout(_0x3f8ed5));const _0x258567=document[_0x24969d(0x120)](_0x24969d(0x11c));return _0x258567[_0x24969d(0x12a)]='message-time',_0x258567[_0x24969d(0x11b)]=formatTime(_0x5390ad[_0x24969d(0x18d)]),_0x44f20c['appendChild'](_0x1ef888),_0x44f20c[_0x24969d(0x15e)](_0x565f0c),_0x44f20c[_0x24969d(0x15e)](_0x258567),_0x44f20c;}function createTypingIndicator(){const _0xaebcad=a0_0x30619a,_0x348978=document[_0xaebcad(0x120)](_0xaebcad(0x11c));return _0x348978[_0xaebcad(0x12a)]=_0xaebcad(0x14e),_0x348978['id']=_0xaebcad(0x176),_0x348978[_0xaebcad(0x188)]=_0xaebcad(0x12f),_0x348978;}function renderMessages(){const _0x3492e9=a0_0x30619a;Array['from'](chatArea[_0x3492e9(0x157)])[_0x3492e9(0x13d)](_0x1daf4=>{const _0x5a36c9=_0x3492e9;if(_0x1daf4['id']!==_0x5a36c9(0x127))_0x1daf4[_0x5a36c9(0x170)]();}),messages[_0x3492e9(0x146)]>0x0?(emptyState[_0x3492e9(0x144)][_0x3492e9(0x15d)]=_0x3492e9(0x162),messages[_0x3492e9(0x13d)]((_0x310b29,_0x51ef8e)=>chatArea['appendChild'](createMessageElement(_0x310b29,_0x51ef8e)))):emptyState[_0x3492e9(0x144)][_0x3492e9(0x15d)]=_0x3492e9(0x17a),requestAnimationFrame(()=>chatArea[_0x3492e9(0x164)]=chatArea[_0x3492e9(0x193)]);}function autoResizeTextarea(){const _0x4b3419=a0_0x30619a;messageInput[_0x4b3419(0x144)]['height']=_0x4b3419(0x126),messageInput[_0x4b3419(0x144)]['height']=Math[_0x4b3419(0x154)](messageInput[_0x4b3419(0x193)],0x78)+'px';}function updateSendButton(){const _0x1e9d77=a0_0x30619a,_0x15688b=messageInput[_0x1e9d77(0x152)][_0x1e9d77(0x128)]();sendBtn[_0x1e9d77(0x177)]=!_0x15688b||isTyping;}async function sendMessage(){const _0x62cfd7=a0_0x30619a,_0x535369=messageInput[_0x62cfd7(0x152)][_0x62cfd7(0x128)]();if(!_0x535369||isTyping)return;if(tg?.[_0x62cfd7(0x167)])tg[_0x62cfd7(0x167)]['impactOccurred'](_0x62cfd7(0x145));messages[_0x62cfd7(0x14a)]({'role':_0x62cfd7(0x168),'content':_0x535369,'timestamp':Date[_0x62cfd7(0x17c)]()}),localStorage[_0x62cfd7(0x18e)](_0x62cfd7(0x138),JSON[_0x62cfd7(0x140)](messages)),renderMessages(),messageInput[_0x62cfd7(0x152)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x62cfd7(0x164)]=chatArea[_0x62cfd7(0x193)];const _0x78ad8a=await callBackend('send_message',{'message':_0x535369});isTyping=![];const _0x46c7bc=document[_0x62cfd7(0x183)](_0x62cfd7(0x176));if(_0x46c7bc)_0x46c7bc[_0x62cfd7(0x170)]();let _0x15e279=_0x62cfd7(0x189);if(_0x78ad8a['success']){_0x15e279=_0x78ad8a[_0x62cfd7(0x11d)]||_0x62cfd7(0x143);if(tg?.[_0x62cfd7(0x167)])tg[_0x62cfd7(0x167)]['notificationOccurred'](_0x62cfd7(0x16d));}else{_0x15e279=_0x78ad8a[_0x62cfd7(0x184)]||'Ошибка\x20сервера';if(tg?.[_0x62cfd7(0x167)])tg[_0x62cfd7(0x167)][_0x62cfd7(0x16a)](_0x62cfd7(0x184));}messages[_0x62cfd7(0x14a)]({'role':'ai','content':_0x15e279,'timestamp':Date[_0x62cfd7(0x17c)]()}),localStorage[_0x62cfd7(0x18e)](_0x62cfd7(0x138),JSON[_0x62cfd7(0x140)](messages)),renderMessages();}function a0_0x2a86(_0x22e5d3,_0x3a98c){_0x22e5d3=_0x22e5d3-0x115;const _0x81e572=a0_0xa0a4();let _0x4a9e68=_0x81e572[_0x22e5d3];return _0x4a9e68;}function a0_0xa0a4(){const _0x3b86a8=['<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','disableVerticalSwipes','290882rBsSrp','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','21Rdetii','onEvent','debug_uid','101168HnpOTk','20835581BhqLKD','ai_chat_messages','splice','viewportChanged','role','105QUqPoA','forEach','apply','padStart','stringify','#050505','6.1','Пустой\x20ответ','style','light','length','viewportHeight','BackButton','Удалить?','push','keydown','2068984sgBLuG','confirmModal','message\x20ai','constructor','onClick','isVersionAtLeast','value','99414ZoAWcm','min','12iwtaNe','medium','children','content','.container','touchstart','initData','classList','display','appendChild','querySelectorAll','modalText','paddingBottom','none','show','scrollTop','inputArea','clear_history','HapticFeedback','user','32610ZVVjXI','notificationOccurred','function','search','success','input','getItem','remove','Действие\x20необратимо.','3179rtEFhh','initDataUnsafe','(((.+)+)+)+$','150fGENFu','typingIndicator','disabled','.message.show-delete','addEventListener','flex','show-delete','now','207879gJPneI','onclick','message\x20','parse','href','removeItem','getElementById','error','sendBtn','floor','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','innerHTML','Ошибка\x20сети','./router.html','TG\x20setup\x20error:','message-bubble','timestamp','setItem','contains','target','messageInput','modalTitle','scrollHeight','ready','getHours','Telegram','clearBtn','focus','offClick','modalConfirm','replace','getMinutes','Начнется\x20новый\x20диалог.','textContent','div','text','POST','36junPTf','createElement','querySelector','stopPropagation','Очистить\x20историю?','toString','add','auto','emptyState','trim','json','className','abort','height','expand','modalCancel'];a0_0xa0a4=function(){return _0x3b86a8;};return a0_0xa0a4();}function confirmDelete(_0x76846c){const _0x5ddb70=a0_0x30619a;if(mTitle)mTitle[_0x5ddb70(0x11b)]=_0x5ddb70(0x149);if(mText)mText[_0x5ddb70(0x11b)]=_0x5ddb70(0x171);modalCallback=()=>{const _0x5350aa=_0x5ddb70;messages[_0x5350aa(0x139)](_0x76846c,0x1),localStorage['setItem'](_0x5350aa(0x138),JSON[_0x5350aa(0x140)](messages)),renderMessages();},modal[_0x5ddb70(0x15c)][_0x5ddb70(0x125)](_0x5ddb70(0x163));}if(clearBtn)clearBtn['onclick']=()=>{const _0x39deaf=a0_0x30619a;if(!messages['length'])return;if(mTitle)mTitle[_0x39deaf(0x11b)]=_0x39deaf(0x123);if(mText)mText[_0x39deaf(0x11b)]=_0x39deaf(0x11a);modalCallback=async()=>{const _0x531e72=_0x39deaf;messages=[],localStorage[_0x531e72(0x182)](_0x531e72(0x138)),renderMessages(),callBackend(_0x531e72(0x166),{});},modal[_0x39deaf(0x15c)][_0x39deaf(0x125)](_0x39deaf(0x163));};document['getElementById'](a0_0x30619a(0x12e))['onclick']=()=>modal[a0_0x30619a(0x15c)][a0_0x30619a(0x170)](a0_0x30619a(0x163)),document[a0_0x30619a(0x183)](a0_0x30619a(0x117))['onclick']=()=>{const _0xd1a9ed=a0_0x30619a;if(modalCallback)modalCallback();modal[_0xd1a9ed(0x15c)][_0xd1a9ed(0x170)](_0xd1a9ed(0x163));},messageInput[a0_0x30619a(0x179)](a0_0x30619a(0x16e),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x30619a(0x179)](a0_0x30619a(0x14b),_0x5246f0=>{_0x5246f0['key']==='Enter'&&!_0x5246f0['shiftKey']&&(_0x5246f0['preventDefault'](),sendMessage());}),sendBtn[a0_0x30619a(0x17e)]=sendMessage,document[a0_0x30619a(0x179)]('click',_0x313aaf=>{const _0x176beb=a0_0x30619a;document[_0x176beb(0x15f)](_0x176beb(0x178))[_0x176beb(0x13d)](_0x15ab0d=>{const _0x3dd182=_0x176beb;if(!_0x15ab0d[_0x3dd182(0x18f)](_0x313aaf[_0x3dd182(0x190)]))_0x15ab0d[_0x3dd182(0x15c)][_0x3dd182(0x170)](_0x3dd182(0x17b));});});const saved=localStorage[a0_0x30619a(0x16f)](a0_0x30619a(0x138));if(saved)try{messages=JSON[a0_0x30619a(0x180)](saved),renderMessages();}catch(a0_0x3ed017){}updateSendButton();