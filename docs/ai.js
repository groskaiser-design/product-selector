const a0_0x58fa49=a0_0x3eb6;(function(_0x3dfdfb,_0x277e6b){const _0x40b812=a0_0x3eb6,_0xebcf82=_0x3dfdfb();while(!![]){try{const _0x8ec3f2=-parseInt(_0x40b812(0x130))/0x1+-parseInt(_0x40b812(0x138))/0x2*(-parseInt(_0x40b812(0x117))/0x3)+parseInt(_0x40b812(0x13d))/0x4*(-parseInt(_0x40b812(0x147))/0x5)+-parseInt(_0x40b812(0xfa))/0x6+-parseInt(_0x40b812(0x129))/0x7+-parseInt(_0x40b812(0x116))/0x8*(parseInt(_0x40b812(0x108))/0x9)+-parseInt(_0x40b812(0xed))/0xa*(-parseInt(_0x40b812(0x131))/0xb);if(_0x8ec3f2===_0x277e6b)break;else _0xebcf82['push'](_0xebcf82['shift']());}catch(_0x36a6fa){_0xebcf82['push'](_0xebcf82['shift']());}}}(a0_0x54b5,0x1d46c));const tg=window['Telegram']?.[a0_0x58fa49(0xe2)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x230ebf=a0_0x58fa49;if(!tg)return;try{tg[_0x230ebf(0x11b)](),tg[_0x230ebf(0xfb)](),tg['setHeaderColor']?.(_0x230ebf(0xd2));if(tg[_0x230ebf(0xfd)]?.(_0x230ebf(0x150)))tg[_0x230ebf(0xdf)]?.();const _0x190455=tg[_0x230ebf(0x145)];if(_0x190455){_0x190455[_0x230ebf(0xcf)]();if(typeof _0x190455[_0x230ebf(0x10f)]==='function')try{_0x190455[_0x230ebf(0x10f)]();}catch(_0x3b73c2){}_0x190455[_0x230ebf(0x137)](()=>{const _0x1f9d9a=_0x230ebf;if(tg[_0x1f9d9a(0xd7)])tg[_0x1f9d9a(0xd7)][_0x1f9d9a(0x12f)]('light');location[_0x1f9d9a(0x124)]=HOME_URL;});}}catch(_0x11865c){console[_0x230ebf(0x12c)](_0x230ebf(0xef),_0x11865c);}}(function initStableLayout(){const _0x32775f=a0_0x58fa49,_0xc37728=(function(){let _0x44d9b9=!![];return function(_0x54b3ba,_0x25cc4a){const _0x403745=_0x44d9b9?function(){const _0x295051=a0_0x3eb6;if(_0x25cc4a){const _0x4b07ea=_0x25cc4a[_0x295051(0xd6)](_0x54b3ba,arguments);return _0x25cc4a=null,_0x4b07ea;}}:function(){};return _0x44d9b9=![],_0x403745;};}()),_0x528ff3=document[_0x32775f(0x12b)](_0x32775f(0x10d)),_0x353ef1=document[_0x32775f(0xde)](_0x32775f(0x11a)),_0x295d5a=document[_0x32775f(0xde)](_0x32775f(0xce)),_0x13193e=document[_0x32775f(0xde)]('messageInput');function _0x1b4ddd(){const _0x45eda6=_0x32775f,_0x1cdb45=_0xc37728(this,function(){const _0x4389ee=a0_0x3eb6;return _0x1cdb45[_0x4389ee(0x14e)]()[_0x4389ee(0x113)](_0x4389ee(0x141))[_0x4389ee(0x14e)]()[_0x4389ee(0xf1)](_0x1cdb45)['search'](_0x4389ee(0x141));});_0x1cdb45();if(!_0x528ff3)return;const _0x2eebc0=tg&&tg[_0x45eda6(0x10a)]?tg[_0x45eda6(0x10a)]:window[_0x45eda6(0x101)];_0x528ff3[_0x45eda6(0x13a)][_0x45eda6(0x133)]=_0x2eebc0+'px';if(_0x353ef1){const _0x40fe30=_0x353ef1[_0x45eda6(0x13e)];_0x295d5a['style'][_0x45eda6(0xdc)]=_0x40fe30+0x28+'px';}}tg?tg['onEvent'](_0x32775f(0x110),({isStateStable:_0x25c4bf})=>{_0x1b4ddd();if(_0x25c4bf)requestAnimationFrame(()=>{const _0x5a40b4=a0_0x3eb6;_0x295d5a[_0x5a40b4(0xff)]=_0x295d5a[_0x5a40b4(0xeb)];});}):window[_0x32775f(0x144)](_0x32775f(0x114),_0x1b4ddd),_0x1b4ddd(),_0x13193e&&(_0x13193e['addEventListener']('input',()=>{requestAnimationFrame(_0x1b4ddd);}),_0x13193e[_0x32775f(0x144)](_0x32775f(0xe5),()=>{setTimeout(()=>{const _0x9aca31=a0_0x3eb6;_0x295d5a[_0x9aca31(0xff)]=_0x295d5a[_0x9aca31(0xeb)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x58fa49(0x142),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x58fa49(0xce)),emptyState=document[a0_0x58fa49(0xde)](a0_0x58fa49(0x148)),messageInput=document[a0_0x58fa49(0xde)](a0_0x58fa49(0x120)),sendBtn=document['getElementById'](a0_0x58fa49(0x111)),clearBtn=document[a0_0x58fa49(0xde)](a0_0x58fa49(0x11d)),modal=document[a0_0x58fa49(0xde)]('confirmModal'),mTitle=document[a0_0x58fa49(0xde)](a0_0x58fa49(0x143)),mText=document[a0_0x58fa49(0xde)](a0_0x58fa49(0xfe));let modalCallback=null;async function callBackend(_0x48233f,_0x4c9ec7){const _0x3c5ddc=a0_0x58fa49,_0x14423e=tg?.['initDataUnsafe']?.[_0x3c5ddc(0x126)]||{},_0x4e2124=_0x14423e['id']||localStorage[_0x3c5ddc(0x13b)]('debug_uid')||'d-'+Math[_0x3c5ddc(0x112)](Math[_0x3c5ddc(0x122)]()*0x3b9aca00);if(!_0x14423e['id'])localStorage[_0x3c5ddc(0x12a)]('debug_uid',_0x4e2124);const _0x3ae701={'action':_0x48233f,'user_id':_0x4e2124,'user_data':{'first_name':_0x14423e[_0x3c5ddc(0x107)],'username':_0x14423e[_0x3c5ddc(0xe9)]},'init_data':tg?.[_0x3c5ddc(0xd4)]||'',..._0x4c9ec7},_0x294ab8=new AbortController(),_0x2c5908=setTimeout(()=>_0x294ab8[_0x3c5ddc(0xd5)](),REQUEST_TIMEOUT_MS);try{const _0x7ffec=await fetch(BACKEND_URL,{'method':_0x3c5ddc(0x14b),'headers':{'Content-Type':_0x3c5ddc(0xe4)},'body':JSON[_0x3c5ddc(0x139)](_0x3ae701),'signal':_0x294ab8[_0x3c5ddc(0x102)]});return clearTimeout(_0x2c5908),await _0x7ffec[_0x3c5ddc(0x12e)]();}catch(_0x55955c){return{'success':![],'error':String(_0x55955c)};}}function a0_0x3eb6(_0x22cb0b,_0x2451e6){_0x22cb0b=_0x22cb0b-0xce;const _0x1df0c5=a0_0x54b5();let _0x4921b3=_0x1df0c5[_0x22cb0b];return _0x4921b3;}function formatTime(_0x16dadb){const _0x2e4069=a0_0x58fa49,_0x517993=new Date(_0x16dadb);return String(_0x517993['getHours']())[_0x2e4069(0x13c)](0x2,'0')+':'+String(_0x517993[_0x2e4069(0x14c)]())['padStart'](0x2,'0');}function createMessageElement(_0x552d03,_0x57291c){const _0x491361=a0_0x58fa49,_0x7fe9a2=document[_0x491361(0x134)]('div');_0x7fe9a2[_0x491361(0xfc)]=_0x491361(0xd8)+_0x552d03[_0x491361(0xf8)];const _0x8e5258=document['createElement'](_0x491361(0x140));_0x8e5258[_0x491361(0xfc)]='message-bubble',_0x8e5258['innerHTML']=_0x552d03[_0x491361(0xe0)]['replace'](/\n/g,_0x491361(0x13f));const _0x476a3a=document[_0x491361(0x134)]('div');_0x476a3a[_0x491361(0xfc)]=_0x491361(0xd3),_0x476a3a[_0x491361(0x125)]=_0x491361(0x104),_0x476a3a[_0x491361(0x146)]=_0x579786=>{const _0x673c8f=_0x491361;_0x579786[_0x673c8f(0x115)](),confirmDelete(_0x57291c);};let _0x3ed6d2;_0x8e5258['addEventListener'](_0x491361(0xf0),()=>_0x3ed6d2=setTimeout(()=>{const _0x3c00da=_0x491361;_0x7fe9a2[_0x3c00da(0xf6)][_0x3c00da(0xe1)]('show-delete');if(tg?.[_0x3c00da(0xd7)])tg[_0x3c00da(0xd7)][_0x3c00da(0x12f)](_0x3c00da(0xee));},0x1f4)),_0x8e5258['addEventListener'](_0x491361(0x11e),()=>clearTimeout(_0x3ed6d2));const _0x1ede74=document[_0x491361(0x134)](_0x491361(0x140));return _0x1ede74[_0x491361(0xfc)]=_0x491361(0x135),_0x1ede74[_0x491361(0xf7)]=formatTime(_0x552d03[_0x491361(0xd1)]),_0x7fe9a2[_0x491361(0x119)](_0x476a3a),_0x7fe9a2[_0x491361(0x119)](_0x8e5258),_0x7fe9a2[_0x491361(0x119)](_0x1ede74),_0x7fe9a2;}function createTypingIndicator(){const _0x5c9a41=a0_0x58fa49,_0x47d138=document['createElement'](_0x5c9a41(0x140));return _0x47d138[_0x5c9a41(0xfc)]=_0x5c9a41(0x121),_0x47d138['id']=_0x5c9a41(0x123),_0x47d138[_0x5c9a41(0x125)]=_0x5c9a41(0x105),_0x47d138;}function renderMessages(){const _0x29a2d1=a0_0x58fa49;Array[_0x29a2d1(0x12d)](chatArea['children'])[_0x29a2d1(0x136)](_0x2ef197=>{const _0x23c1fc=_0x29a2d1;if(_0x2ef197['id']!==_0x23c1fc(0x148))_0x2ef197[_0x23c1fc(0x103)]();}),messages[_0x29a2d1(0xd9)]>0x0?(emptyState[_0x29a2d1(0x13a)]['display']=_0x29a2d1(0xe7),messages[_0x29a2d1(0x136)]((_0x3f2815,_0x4ed0)=>chatArea['appendChild'](createMessageElement(_0x3f2815,_0x4ed0)))):emptyState[_0x29a2d1(0x13a)][_0x29a2d1(0xec)]=_0x29a2d1(0x106),requestAnimationFrame(()=>chatArea[_0x29a2d1(0xff)]=chatArea[_0x29a2d1(0xeb)]);}function autoResizeTextarea(){const _0x1957e3=a0_0x58fa49;messageInput[_0x1957e3(0x13a)][_0x1957e3(0x133)]=_0x1957e3(0xe6),messageInput[_0x1957e3(0x13a)]['height']=Math['min'](messageInput[_0x1957e3(0xeb)],0x78)+'px';}function a0_0x54b5(){const _0x55ee1a=['16KIcpQr','stringify','style','getItem','padStart','4sEbjuf','offsetHeight','<br>','div','(((.+)+)+)+$','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','modalTitle','addEventListener','BackButton','onclick','1139735nBVvWJ','emptyState','text','click','POST','getMinutes','target','toString','ai_chat_messages','6.1','chatArea','show','keydown','timestamp','#050505','delete-btn','initData','abort','apply','HapticFeedback','message\x20','length','Действие\x20необратимо.','value','paddingBottom','push','getElementById','disableVerticalSwipes','content','add','WebApp','parse','text/plain','focus','auto','none','Очистить\x20историю?','username','Enter','scrollHeight','display','10aiRzss','medium','TG\x20setup\x20error:','touchstart','constructor','input','show-delete','light','error','classList','textContent','role','Ошибка\x20сервера','429696xBZDYR','expand','className','isVersionAtLeast','modalText','scrollTop','Удалить?','innerHeight','signal','remove','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','flex','first_name','6939uwbFJV','.message.show-delete','viewportHeight','Пустой\x20ответ','removeItem','.container','key','offClick','viewportChanged','sendBtn','floor','search','resize','stopPropagation','1816YlCMhD','44952iEyYhy','Ошибка\x20сети','appendChild','inputArea','ready','trim','clearBtn','touchend','now','messageInput','message\x20ai','random','typingIndicator','href','innerHTML','user','notificationOccurred','success','1319521iUSQzx','setItem','querySelector','warn','from','json','impactOccurred','143072HVCTgJ','8868189Cvbtkp','contains','height','createElement','message-time','forEach','onClick'];a0_0x54b5=function(){return _0x55ee1a;};return a0_0x54b5();}function updateSendButton(){const _0x1cf440=a0_0x58fa49,_0x2c43f6=messageInput['value'][_0x1cf440(0x11c)]();sendBtn['disabled']=!_0x2c43f6||isTyping;}async function sendMessage(){const _0x249975=a0_0x58fa49,_0x4b09c5=messageInput[_0x249975(0xdb)][_0x249975(0x11c)]();if(!_0x4b09c5||isTyping)return;if(tg?.[_0x249975(0xd7)])tg[_0x249975(0xd7)][_0x249975(0x12f)](_0x249975(0xf4));messages[_0x249975(0xdd)]({'role':'user','content':_0x4b09c5,'timestamp':Date[_0x249975(0x11f)]()}),localStorage[_0x249975(0x12a)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0x249975(0xdb)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x249975(0x119)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x249975(0xeb)];const _0x51a198=await callBackend('send_message',{'message':_0x4b09c5});isTyping=![];const _0x17a15f=document['getElementById'](_0x249975(0x123));if(_0x17a15f)_0x17a15f[_0x249975(0x103)]();let _0x5893bb=_0x249975(0x118);if(_0x51a198[_0x249975(0x128)]){_0x5893bb=_0x51a198[_0x249975(0x149)]||_0x249975(0x10b);if(tg?.[_0x249975(0xd7)])tg[_0x249975(0xd7)][_0x249975(0x127)](_0x249975(0x128));}else{_0x5893bb=_0x51a198[_0x249975(0xf5)]||_0x249975(0xf9);if(tg?.[_0x249975(0xd7)])tg[_0x249975(0xd7)]['notificationOccurred']('error');}messages[_0x249975(0xdd)]({'role':'ai','content':_0x5893bb,'timestamp':Date[_0x249975(0x11f)]()}),localStorage[_0x249975(0x12a)]('ai_chat_messages',JSON[_0x249975(0x139)](messages)),renderMessages();}function confirmDelete(_0x3ab390){const _0x39dd58=a0_0x58fa49;if(mTitle)mTitle['textContent']=_0x39dd58(0x100);if(mText)mText['textContent']=_0x39dd58(0xda);modalCallback=()=>{const _0x5255d8=_0x39dd58;messages['splice'](_0x3ab390,0x1),localStorage['setItem'](_0x5255d8(0x14f),JSON['stringify'](messages)),renderMessages();},modal[_0x39dd58(0xf6)][_0x39dd58(0xe1)](_0x39dd58(0xcf));}if(clearBtn)clearBtn[a0_0x58fa49(0x146)]=()=>{const _0x5a48a0=a0_0x58fa49;if(!messages[_0x5a48a0(0xd9)])return;if(mTitle)mTitle[_0x5a48a0(0xf7)]=_0x5a48a0(0xe8);if(mText)mText[_0x5a48a0(0xf7)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x3cff2b=_0x5a48a0;messages=[],localStorage[_0x3cff2b(0x10c)](_0x3cff2b(0x14f)),renderMessages(),callBackend('clear_history',{});},modal[_0x5a48a0(0xf6)][_0x5a48a0(0xe1)](_0x5a48a0(0xcf));};document[a0_0x58fa49(0xde)]('modalCancel')[a0_0x58fa49(0x146)]=()=>modal['classList']['remove'](a0_0x58fa49(0xcf)),document[a0_0x58fa49(0xde)]('modalConfirm')[a0_0x58fa49(0x146)]=()=>{const _0x4091e7=a0_0x58fa49;if(modalCallback)modalCallback();modal[_0x4091e7(0xf6)][_0x4091e7(0x103)](_0x4091e7(0xcf));},messageInput['addEventListener'](a0_0x58fa49(0xf2),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x58fa49(0x144)](a0_0x58fa49(0xd0),_0x1e1c64=>{const _0x2955bf=a0_0x58fa49;_0x1e1c64[_0x2955bf(0x10e)]===_0x2955bf(0xea)&&!_0x1e1c64['shiftKey']&&(_0x1e1c64['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x58fa49(0x144)](a0_0x58fa49(0x14a),_0x394bf3=>{const _0x1d9ee8=a0_0x58fa49;document['querySelectorAll'](_0x1d9ee8(0x109))[_0x1d9ee8(0x136)](_0x14889e=>{const _0x1088be=_0x1d9ee8;if(!_0x14889e[_0x1088be(0x132)](_0x394bf3[_0x1088be(0x14d)]))_0x14889e[_0x1088be(0xf6)][_0x1088be(0x103)](_0x1088be(0xf3));});});const saved=localStorage[a0_0x58fa49(0x13b)](a0_0x58fa49(0x14f));if(saved)try{messages=JSON[a0_0x58fa49(0xe3)](saved),renderMessages();}catch(a0_0x1dd3b9){}updateSendButton();