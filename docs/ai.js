const a0_0x369763=a0_0x18d3;(function(_0x14d213,_0x12e42d){const _0x55460f=a0_0x18d3,_0x3e7327=_0x14d213();while(!![]){try{const _0x5cbba8=parseInt(_0x55460f(0x203))/0x1*(parseInt(_0x55460f(0x210))/0x2)+parseInt(_0x55460f(0x1ce))/0x3+parseInt(_0x55460f(0x206))/0x4*(-parseInt(_0x55460f(0x20a))/0x5)+-parseInt(_0x55460f(0x1f3))/0x6*(-parseInt(_0x55460f(0x208))/0x7)+parseInt(_0x55460f(0x221))/0x8*(-parseInt(_0x55460f(0x1ee))/0x9)+parseInt(_0x55460f(0x231))/0xa+-parseInt(_0x55460f(0x238))/0xb*(-parseInt(_0x55460f(0x21d))/0xc);if(_0x5cbba8===_0x12e42d)break;else _0x3e7327['push'](_0x3e7327['shift']());}catch(_0x254c80){_0x3e7327['push'](_0x3e7327['shift']());}}}(a0_0x3c03,0xb3a2c));const tg=window['Telegram']?.[a0_0x369763(0x212)],HOME_URL=a0_0x369763(0x1c7);function setupTelegramBackButton(){const _0x5939fe=a0_0x369763;if(!tg)return;try{tg[_0x5939fe(0x209)](),tg[_0x5939fe(0x1ec)](),tg[_0x5939fe(0x1f7)]?.('#050505');if(tg[_0x5939fe(0x1ef)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x3ab373=tg['BackButton'];if(_0x3ab373){_0x3ab373['show']();if(typeof _0x3ab373[_0x5939fe(0x1fc)]==='function')try{_0x3ab373[_0x5939fe(0x1fc)]();}catch(_0x5977d9){}_0x3ab373[_0x5939fe(0x233)](()=>{const _0x322ce0=_0x5939fe;if(tg[_0x322ce0(0x228)])tg[_0x322ce0(0x228)][_0x322ce0(0x1f5)](_0x322ce0(0x227));location[_0x322ce0(0x213)]=HOME_URL;});}}catch(_0x1004f1){console[_0x5939fe(0x1d4)](_0x5939fe(0x1da),_0x1004f1);}}(function initStableLayout(){const _0x20ad3d=a0_0x369763,_0x415fd4=(function(){let _0x202654=!![];return function(_0x429793,_0x4d0d6e){const _0x784f36=_0x202654?function(){const _0x18af38=a0_0x18d3;if(_0x4d0d6e){const _0x5941e5=_0x4d0d6e[_0x18af38(0x1d2)](_0x429793,arguments);return _0x4d0d6e=null,_0x5941e5;}}:function(){};return _0x202654=![],_0x784f36;};}()),_0x1ad057=document['querySelector'](_0x20ad3d(0x214)),_0x4eece0=document[_0x20ad3d(0x22f)](_0x20ad3d(0x237)),_0x11c52c=document['getElementById'](_0x20ad3d(0x1c6)),_0x10d978=document[_0x20ad3d(0x22f)]('messageInput');function _0x4fc9b1(){const _0x4d2501=_0x20ad3d,_0x4f21ed=_0x415fd4(this,function(){const _0x241d6d=a0_0x18d3;return _0x4f21ed[_0x241d6d(0x216)]()[_0x241d6d(0x1fe)]('(((.+)+)+)+$')['toString']()[_0x241d6d(0x1d0)](_0x4f21ed)[_0x241d6d(0x1fe)](_0x241d6d(0x1be));});_0x4f21ed();if(!_0x1ad057)return;const _0x5e4ba7=tg&&tg['viewportHeight']?tg[_0x4d2501(0x1c8)]:window[_0x4d2501(0x20f)];_0x1ad057[_0x4d2501(0x1e6)]['height']=_0x5e4ba7+'px';if(_0x4eece0){const _0x3b699e=_0x4eece0['offsetHeight'];_0x11c52c[_0x4d2501(0x1e6)][_0x4d2501(0x1e4)]=_0x3b699e+0x28+'px';}}tg?tg[_0x20ad3d(0x1c4)](_0x20ad3d(0x1d1),({isStateStable:_0xcc01a3})=>{_0x4fc9b1();if(_0xcc01a3)requestAnimationFrame(()=>{const _0x3f706c=a0_0x18d3;_0x11c52c['scrollTop']=_0x11c52c[_0x3f706c(0x1c9)];});}):window[_0x20ad3d(0x22d)]('resize',_0x4fc9b1),_0x4fc9b1(),_0x10d978&&(_0x10d978[_0x20ad3d(0x22d)](_0x20ad3d(0x1f2),()=>{requestAnimationFrame(_0x4fc9b1);}),_0x10d978[_0x20ad3d(0x22d)]('focus',()=>{setTimeout(()=>{const _0x25bc3c=a0_0x18d3;_0x11c52c['scrollTop']=_0x11c52c[_0x25bc3c(0x1c9)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x369763(0x1e3),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x369763(0x22f)](a0_0x369763(0x1c6)),emptyState=document[a0_0x369763(0x22f)](a0_0x369763(0x1f0)),messageInput=document[a0_0x369763(0x22f)](a0_0x369763(0x1bc)),sendBtn=document[a0_0x369763(0x22f)](a0_0x369763(0x1eb)),clearBtn=document[a0_0x369763(0x22f)](a0_0x369763(0x202)),modal=document[a0_0x369763(0x22f)](a0_0x369763(0x226)),mTitle=document[a0_0x369763(0x22f)](a0_0x369763(0x1c2)),mText=document[a0_0x369763(0x22f)](a0_0x369763(0x1d6));let modalCallback=null;async function callBackend(_0x4c287d,_0x111c15){const _0x246b87=a0_0x369763,_0x15bc94=tg?.[_0x246b87(0x20d)]?.[_0x246b87(0x1dc)]||{},_0x36102e=_0x15bc94['id']||localStorage[_0x246b87(0x1e0)](_0x246b87(0x1d5))||'d-'+Math[_0x246b87(0x1c5)](Math['random']()*0x3b9aca00);if(!_0x15bc94['id'])localStorage[_0x246b87(0x223)](_0x246b87(0x1d5),_0x36102e);const _0x33e3cb={'action':_0x4c287d,'user_id':_0x36102e,'user_data':{'first_name':_0x15bc94[_0x246b87(0x1ea)],'username':_0x15bc94[_0x246b87(0x230)]},'init_data':tg?.[_0x246b87(0x229)]||'',..._0x111c15},_0x4ac001=new AbortController(),_0x41e585=setTimeout(()=>_0x4ac001['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5b0e51=await fetch(BACKEND_URL,{'method':_0x246b87(0x21a),'headers':{'Content-Type':_0x246b87(0x235)},'body':JSON['stringify'](_0x33e3cb),'signal':_0x4ac001[_0x246b87(0x20b)]});return clearTimeout(_0x41e585),await _0x5b0e51[_0x246b87(0x1d9)]();}catch(_0x59dfe3){return{'success':![],'error':String(_0x59dfe3)};}}function formatTime(_0x5723f9){const _0x12af0c=a0_0x369763,_0x4bd3c5=new Date(_0x5723f9);return String(_0x4bd3c5[_0x12af0c(0x1f4)]())['padStart'](0x2,'0')+':'+String(_0x4bd3c5[_0x12af0c(0x215)]())[_0x12af0c(0x224)](0x2,'0');}function createMessageElement(_0x43c0a0,_0xeb310f){const _0x1ee76a=a0_0x369763,_0x3b5256=document[_0x1ee76a(0x21e)]('div');_0x3b5256[_0x1ee76a(0x220)]=_0x1ee76a(0x1c1)+_0x43c0a0[_0x1ee76a(0x1cd)];const _0x50840c=document[_0x1ee76a(0x21e)](_0x1ee76a(0x1fb));_0x50840c[_0x1ee76a(0x220)]=_0x1ee76a(0x1d3),_0x50840c[_0x1ee76a(0x1e7)]=_0x43c0a0[_0x1ee76a(0x201)][_0x1ee76a(0x20c)](/\n/g,_0x1ee76a(0x22a));const _0x80dfc5=document[_0x1ee76a(0x21e)]('div');_0x80dfc5[_0x1ee76a(0x220)]='delete-btn',_0x80dfc5[_0x1ee76a(0x1e7)]=_0x1ee76a(0x1e9),_0x80dfc5[_0x1ee76a(0x219)]=_0xee25ea=>{const _0xb76bd0=_0x1ee76a;_0xee25ea[_0xb76bd0(0x1db)](),confirmDelete(_0xeb310f);};let _0x2a50e8;_0x50840c[_0x1ee76a(0x22d)](_0x1ee76a(0x234),()=>_0x2a50e8=setTimeout(()=>{const _0x17f3be=_0x1ee76a;_0x3b5256[_0x17f3be(0x21c)][_0x17f3be(0x1fa)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x17f3be(0x228)][_0x17f3be(0x1f5)]('medium');},0x1f4)),_0x50840c[_0x1ee76a(0x22d)](_0x1ee76a(0x236),()=>clearTimeout(_0x2a50e8));const _0x35161d=document['createElement'](_0x1ee76a(0x1fb));return _0x35161d['className']=_0x1ee76a(0x1ff),_0x35161d[_0x1ee76a(0x1f6)]=formatTime(_0x43c0a0['timestamp']),_0x3b5256[_0x1ee76a(0x217)](_0x80dfc5),_0x3b5256['appendChild'](_0x50840c),_0x3b5256[_0x1ee76a(0x217)](_0x35161d),_0x3b5256;}function createTypingIndicator(){const _0x86a07a=a0_0x369763,_0x461874=document[_0x86a07a(0x21e)](_0x86a07a(0x1fb));return _0x461874[_0x86a07a(0x220)]='message\x20ai',_0x461874['id']='typingIndicator',_0x461874[_0x86a07a(0x1e7)]=_0x86a07a(0x20e),_0x461874;}function renderMessages(){const _0x554e3a=a0_0x369763;Array[_0x554e3a(0x1ca)](chatArea[_0x554e3a(0x200)])[_0x554e3a(0x1fd)](_0x372093=>{const _0x5c2cc7=_0x554e3a;if(_0x372093['id']!==_0x5c2cc7(0x1f0))_0x372093[_0x5c2cc7(0x23b)]();}),messages['length']>0x0?(emptyState[_0x554e3a(0x1e6)][_0x554e3a(0x22c)]=_0x554e3a(0x22b),messages[_0x554e3a(0x1fd)]((_0x4c563f,_0x1c9ac8)=>chatArea[_0x554e3a(0x217)](createMessageElement(_0x4c563f,_0x1c9ac8)))):emptyState[_0x554e3a(0x1e6)][_0x554e3a(0x22c)]=_0x554e3a(0x1c0),requestAnimationFrame(()=>chatArea[_0x554e3a(0x23a)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x44cfdb=a0_0x369763;messageInput[_0x44cfdb(0x1e6)][_0x44cfdb(0x207)]=_0x44cfdb(0x239),messageInput[_0x44cfdb(0x1e6)]['height']=Math['min'](messageInput[_0x44cfdb(0x1c9)],0x78)+'px';}function updateSendButton(){const _0x2daa0f=a0_0x369763,_0x56698b=messageInput['value'][_0x2daa0f(0x1f8)]();sendBtn[_0x2daa0f(0x1cb)]=!_0x56698b||isTyping;}async function sendMessage(){const _0xb6b3eb=a0_0x369763,_0x13a677=messageInput['value']['trim']();if(!_0x13a677||isTyping)return;if(tg?.[_0xb6b3eb(0x228)])tg[_0xb6b3eb(0x228)][_0xb6b3eb(0x1f5)](_0xb6b3eb(0x227));messages['push']({'role':_0xb6b3eb(0x1dc),'content':_0x13a677,'timestamp':Date[_0xb6b3eb(0x1d8)]()}),localStorage['setItem'](_0xb6b3eb(0x21b),JSON[_0xb6b3eb(0x232)](messages)),renderMessages(),messageInput[_0xb6b3eb(0x22e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xb6b3eb(0x217)](createTypingIndicator()),chatArea[_0xb6b3eb(0x23a)]=chatArea[_0xb6b3eb(0x1c9)];const _0x572a5c=await callBackend(_0xb6b3eb(0x222),{'message':_0x13a677});isTyping=![];const _0x166ad2=document[_0xb6b3eb(0x22f)](_0xb6b3eb(0x1df));if(_0x166ad2)_0x166ad2[_0xb6b3eb(0x23b)]();let _0x47902c=_0xb6b3eb(0x1c3);if(_0x572a5c[_0xb6b3eb(0x1de)]){_0x47902c=_0x572a5c['text']||'Пустой\x20ответ';if(tg?.[_0xb6b3eb(0x228)])tg['HapticFeedback'][_0xb6b3eb(0x21f)](_0xb6b3eb(0x1de));}else{_0x47902c=_0x572a5c[_0xb6b3eb(0x205)]||'Ошибка\x20сервера';if(tg?.[_0xb6b3eb(0x228)])tg[_0xb6b3eb(0x228)][_0xb6b3eb(0x21f)](_0xb6b3eb(0x205));}messages[_0xb6b3eb(0x1d7)]({'role':'ai','content':_0x47902c,'timestamp':Date[_0xb6b3eb(0x1d8)]()}),localStorage[_0xb6b3eb(0x223)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x875d91){const _0x1526d0=a0_0x369763;if(mTitle)mTitle[_0x1526d0(0x1f6)]=_0x1526d0(0x1f9);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x5487c7=_0x1526d0;messages[_0x5487c7(0x1f1)](_0x875d91,0x1),localStorage[_0x5487c7(0x223)](_0x5487c7(0x21b),JSON[_0x5487c7(0x232)](messages)),renderMessages();},modal[_0x1526d0(0x21c)][_0x1526d0(0x1fa)](_0x1526d0(0x1e8));}if(clearBtn)clearBtn[a0_0x369763(0x219)]=()=>{const _0x2b04bb=a0_0x369763;if(!messages[_0x2b04bb(0x1bd)])return;if(mTitle)mTitle[_0x2b04bb(0x1f6)]=_0x2b04bb(0x211);if(mText)mText[_0x2b04bb(0x1f6)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x2f3de7=_0x2b04bb;messages=[],localStorage[_0x2f3de7(0x1ed)](_0x2f3de7(0x21b)),renderMessages(),callBackend('clear_history',{});},modal[_0x2b04bb(0x21c)][_0x2b04bb(0x1fa)](_0x2b04bb(0x1e8));};document[a0_0x369763(0x22f)]('modalCancel')['onclick']=()=>modal['classList']['remove'](a0_0x369763(0x1e8)),document[a0_0x369763(0x22f)]('modalConfirm')[a0_0x369763(0x219)]=()=>{const _0x5e8ee3=a0_0x369763;if(modalCallback)modalCallback();modal[_0x5e8ee3(0x21c)][_0x5e8ee3(0x23b)]('show');},messageInput[a0_0x369763(0x22d)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x369763(0x22d)](a0_0x369763(0x1e2),_0x3dcad5=>{const _0xc418d8=a0_0x369763;_0x3dcad5[_0xc418d8(0x1cc)]===_0xc418d8(0x218)&&!_0x3dcad5[_0xc418d8(0x1cf)]&&(_0x3dcad5[_0xc418d8(0x1bf)](),sendMessage());}),sendBtn[a0_0x369763(0x219)]=sendMessage,document[a0_0x369763(0x22d)](a0_0x369763(0x1e5),_0x395ebc=>{const _0x3da280=a0_0x369763;document[_0x3da280(0x1e1)](_0x3da280(0x225))['forEach'](_0x2f8cb2=>{const _0xe29e1e=_0x3da280;if(!_0x2f8cb2['contains'](_0x395ebc[_0xe29e1e(0x1dd)]))_0x2f8cb2[_0xe29e1e(0x21c)][_0xe29e1e(0x23b)]('show-delete');});});function a0_0x3c03(){const _0x1e4b8b=['signal','replace','initDataUnsafe','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','innerHeight','22qNoPro','Очистить\x20историю?','WebApp','href','.container','getMinutes','toString','appendChild','Enter','onclick','POST','ai_chat_messages','classList','22824iZJcml','createElement','notificationOccurred','className','24DnsSmK','send_message','setItem','padStart','.message.show-delete','confirmModal','light','HapticFeedback','initData','<br>','none','display','addEventListener','value','getElementById','username','9798920CEomej','stringify','onClick','touchstart','text/plain','touchend','inputArea','682ERDIdu','auto','scrollTop','remove','messageInput','length','(((.+)+)+)+$','preventDefault','flex','message\x20','modalTitle','Ошибка\x20сети','onEvent','floor','chatArea','./router.html','viewportHeight','scrollHeight','from','disabled','key','role','83697uAiZAr','shiftKey','constructor','viewportChanged','apply','message-bubble','warn','debug_uid','modalText','push','now','json','TG\x20setup\x20error:','stopPropagation','user','target','success','typingIndicator','getItem','querySelectorAll','keydown','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','paddingBottom','click','style','innerHTML','show','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','first_name','sendBtn','expand','removeItem','2959767CGoxrz','isVersionAtLeast','emptyState','splice','input','54HTgvIk','getHours','impactOccurred','textContent','setHeaderColor','trim','Удалить?','add','div','offClick','forEach','search','message-time','children','content','clearBtn','101995AMFAcy','parse','error','112UCAlMI','height','332479yyEyaR','ready','170135FguqHq'];a0_0x3c03=function(){return _0x1e4b8b;};return a0_0x3c03();}const saved=localStorage[a0_0x369763(0x1e0)](a0_0x369763(0x21b));function a0_0x18d3(_0x3168ed,_0x3b3049){_0x3168ed=_0x3168ed-0x1bc;const _0x148485=a0_0x3c03();let _0x3dbcab=_0x148485[_0x3168ed];return _0x3dbcab;}if(saved)try{messages=JSON[a0_0x369763(0x204)](saved),renderMessages();}catch(a0_0x325e46){}updateSendButton();