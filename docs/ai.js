const a0_0x3f17e2=a0_0x56cb;(function(_0x26c16d,_0x177260){const _0x38bf01=a0_0x56cb,_0x20b76b=_0x26c16d();while(!![]){try{const _0x1c2bca=parseInt(_0x38bf01(0x1c5))/0x1*(-parseInt(_0x38bf01(0x1bf))/0x2)+parseInt(_0x38bf01(0x1bb))/0x3*(parseInt(_0x38bf01(0x234))/0x4)+parseInt(_0x38bf01(0x203))/0x5*(parseInt(_0x38bf01(0x1ce))/0x6)+parseInt(_0x38bf01(0x1bd))/0x7+parseInt(_0x38bf01(0x1c0))/0x8*(-parseInt(_0x38bf01(0x1c7))/0x9)+-parseInt(_0x38bf01(0x1c2))/0xa*(-parseInt(_0x38bf01(0x1d7))/0xb)+parseInt(_0x38bf01(0x200))/0xc;if(_0x1c2bca===_0x177260)break;else _0x20b76b['push'](_0x20b76b['shift']());}catch(_0x6d5822){_0x20b76b['push'](_0x20b76b['shift']());}}}(a0_0x571d,0xa6a91));const tg=window['Telegram']?.[a0_0x3f17e2(0x1e8)],HOME_URL=a0_0x3f17e2(0x1c6);function setupTelegramBackButton(){const _0x49d89b=a0_0x3f17e2,_0x9f7c7c=(function(){let _0x1e1b23=!![];return function(_0x41999b,_0x4e9fc3){const _0xa98c13=_0x1e1b23?function(){if(_0x4e9fc3){const _0x4d70ef=_0x4e9fc3['apply'](_0x41999b,arguments);return _0x4e9fc3=null,_0x4d70ef;}}:function(){};return _0x1e1b23=![],_0xa98c13;};}()),_0x4f5c98=_0x9f7c7c(this,function(){const _0x5a2abd=a0_0x56cb;return _0x4f5c98[_0x5a2abd(0x1fc)]()[_0x5a2abd(0x21b)](_0x5a2abd(0x1b6))[_0x5a2abd(0x1fc)]()[_0x5a2abd(0x221)](_0x4f5c98)['search'](_0x5a2abd(0x1b6));});_0x4f5c98();if(!tg)return;try{tg[_0x49d89b(0x1b4)](),tg[_0x49d89b(0x201)](),tg[_0x49d89b(0x22b)]?.('#050505');if(tg['isVersionAtLeast']?.('6.1'))tg[_0x49d89b(0x1ee)]?.();const _0x3bfe9a=tg[_0x49d89b(0x1e6)];if(_0x3bfe9a){_0x3bfe9a['show']();if(typeof _0x3bfe9a['offClick']===_0x49d89b(0x205))try{_0x3bfe9a[_0x49d89b(0x1e0)]();}catch(_0x4c3dbd){}_0x3bfe9a[_0x49d89b(0x1cc)](()=>{const _0x195ca2=_0x49d89b;if(tg[_0x195ca2(0x1be)])tg[_0x195ca2(0x1be)][_0x195ca2(0x1da)]('light');location[_0x195ca2(0x1f5)]=HOME_URL;});}}catch(_0x1c192a){console[_0x49d89b(0x1e7)](_0x49d89b(0x1d5),_0x1c192a);}}(function initStableLayout(){const _0x4709f4=a0_0x3f17e2,_0xbc6cf8=document[_0x4709f4(0x20b)]('.container'),_0xca3133=document[_0x4709f4(0x1f6)](_0x4709f4(0x1c3)),_0x259db9=document['getElementById'](_0x4709f4(0x21d)),_0x943eb5=document[_0x4709f4(0x1f6)](_0x4709f4(0x237));function _0x3bf06e(){const _0x1f5f20=_0x4709f4;if(!_0xbc6cf8)return;const _0x23fabe=tg&&tg[_0x1f5f20(0x1bc)]?tg[_0x1f5f20(0x1bc)]:window[_0x1f5f20(0x225)];_0xbc6cf8[_0x1f5f20(0x1cd)][_0x1f5f20(0x1c4)]=_0x23fabe+'px';if(_0xca3133){const _0x599453=_0xca3133[_0x1f5f20(0x1b9)];_0x259db9[_0x1f5f20(0x1cd)][_0x1f5f20(0x216)]=_0x599453+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x5dcaf8})=>{_0x3bf06e();if(_0x5dcaf8)requestAnimationFrame(()=>{const _0x46e97c=a0_0x56cb;_0x259db9[_0x46e97c(0x209)]=_0x259db9[_0x46e97c(0x207)];});}):window[_0x4709f4(0x1c8)](_0x4709f4(0x1e9),_0x3bf06e),_0x3bf06e(),_0x943eb5&&(_0x943eb5[_0x4709f4(0x1c8)](_0x4709f4(0x1f3),()=>{requestAnimationFrame(_0x3bf06e);}),_0x943eb5[_0x4709f4(0x1c8)](_0x4709f4(0x1d3),()=>{setTimeout(()=>{const _0xa773f3=a0_0x56cb;_0x259db9[_0xa773f3(0x209)]=_0x259db9['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3f17e2(0x238),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3f17e2(0x1f6)](a0_0x3f17e2(0x21d)),emptyState=document['getElementById'](a0_0x3f17e2(0x1ed)),messageInput=document['getElementById'](a0_0x3f17e2(0x237)),sendBtn=document[a0_0x3f17e2(0x1f6)](a0_0x3f17e2(0x215)),clearBtn=document[a0_0x3f17e2(0x1f6)](a0_0x3f17e2(0x212)),modal=document[a0_0x3f17e2(0x1f6)](a0_0x3f17e2(0x1fe)),mTitle=document['getElementById'](a0_0x3f17e2(0x227)),mText=document[a0_0x3f17e2(0x1f6)](a0_0x3f17e2(0x1b5));let modalCallback=null;async function callBackend(_0x5b4b78,_0x265e55){const _0x3a9600=a0_0x3f17e2,_0x3f681f=tg?.[_0x3a9600(0x20e)]?.[_0x3a9600(0x1c1)]||{},_0x5838d7=_0x3f681f['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x3a9600(0x1fd)](Math['random']()*0x3b9aca00);if(!_0x3f681f['id'])localStorage[_0x3a9600(0x1b7)](_0x3a9600(0x1f2),_0x5838d7);const _0x2a5271={'action':_0x5b4b78,'user_id':_0x5838d7,'user_data':{'first_name':_0x3f681f[_0x3a9600(0x20f)],'username':_0x3f681f[_0x3a9600(0x1e2)]},'init_data':tg?.[_0x3a9600(0x21a)]||'',..._0x265e55},_0x523e7c=new AbortController(),_0xd86236=setTimeout(()=>_0x523e7c['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5d94fa=await fetch(BACKEND_URL,{'method':_0x3a9600(0x20c),'headers':{'Content-Type':_0x3a9600(0x22f)},'body':JSON[_0x3a9600(0x1f9)](_0x2a5271),'signal':_0x523e7c['signal']});return clearTimeout(_0xd86236),await _0x5d94fa[_0x3a9600(0x22a)]();}catch(_0x2869e1){return{'success':![],'error':String(_0x2869e1)};}}function formatTime(_0x107781){const _0x1b0c7d=a0_0x3f17e2,_0xeb2c23=new Date(_0x107781);return String(_0xeb2c23[_0x1b0c7d(0x1cf)]())[_0x1b0c7d(0x1dc)](0x2,'0')+':'+String(_0xeb2c23[_0x1b0c7d(0x222)]())[_0x1b0c7d(0x1dc)](0x2,'0');}function a0_0x571d(){const _0x390287=['children','scrollHeight','appendChild','scrollTop','key','querySelector','POST','now','initDataUnsafe','first_name','success','from','clearBtn','error','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','sendBtn','paddingBottom','remove','trim','clear_history','initData','search','classList','chatArea','Enter','show-delete','contains','constructor','getMinutes','Начнется\x20новый\x20диалог.','click','innerHeight','role','modalTitle','notificationOccurred','forEach','json','setHeaderColor','light','parse','message\x20ai','text/plain','value','textContent','disabled','div','34936zEgUqp','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','flex','messageInput','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','ready','modalText','(((.+)+)+)+$','setItem','message-bubble','offsetHeight','message\x20','87aWcsuv','viewportHeight','2152199dWBAWj','HapticFeedback','5548Wlwghq','560rtgarU','user','90WngKmX','inputArea','height','431KpTqPl','./router.html','31536PZEtuI','addEventListener','ai_chat_messages','innerHTML','createElement','onClick','style','2701068WxjsSY','getHours','modalConfirm','replace','getItem','focus','timestamp','TG\x20setup\x20error:','Ошибка\x20сети','688017OZmaGl','keydown','className','impactOccurred','Пустой\x20ответ','padStart','typingIndicator','querySelectorAll','onclick','offClick','add','username','touchstart','auto','show','BackButton','warn','WebApp','resize','Действие\x20необратимо.','message-time','delete-btn','emptyState','disableVerticalSwipes','min','stopPropagation','shiftKey','debug_uid','input','touchend','href','getElementById','send_message','Удалить?','stringify','modalCancel','text','toString','floor','confirmModal','push','6596052bdiYGs','expand','length','5Wstoux','.message.show-delete','function'];a0_0x571d=function(){return _0x390287;};return a0_0x571d();}function createMessageElement(_0x379853,_0x4379f8){const _0x339360=a0_0x3f17e2,_0x498a34=document[_0x339360(0x1cb)](_0x339360(0x233));_0x498a34['className']=_0x339360(0x1ba)+_0x379853[_0x339360(0x226)];const _0x28724c=document[_0x339360(0x1cb)]('div');_0x28724c['className']=_0x339360(0x1b8),_0x28724c[_0x339360(0x1ca)]=_0x379853['content'][_0x339360(0x1d1)](/\n/g,'<br>');const _0x593152=document[_0x339360(0x1cb)](_0x339360(0x233));_0x593152['className']=_0x339360(0x1ec),_0x593152['innerHTML']=_0x339360(0x214),_0x593152[_0x339360(0x1df)]=_0x5867c4=>{const _0x182e68=_0x339360;_0x5867c4[_0x182e68(0x1f0)](),confirmDelete(_0x4379f8);};let _0x26c928;_0x28724c['addEventListener'](_0x339360(0x1e3),()=>_0x26c928=setTimeout(()=>{const _0x2ba712=_0x339360;_0x498a34['classList'][_0x2ba712(0x1e1)](_0x2ba712(0x21f));if(tg?.[_0x2ba712(0x1be)])tg[_0x2ba712(0x1be)][_0x2ba712(0x1da)]('medium');},0x1f4)),_0x28724c[_0x339360(0x1c8)](_0x339360(0x1f4),()=>clearTimeout(_0x26c928));const _0x833972=document['createElement'](_0x339360(0x233));return _0x833972[_0x339360(0x1d9)]=_0x339360(0x1eb),_0x833972[_0x339360(0x231)]=formatTime(_0x379853[_0x339360(0x1d4)]),_0x498a34[_0x339360(0x208)](_0x593152),_0x498a34[_0x339360(0x208)](_0x28724c),_0x498a34[_0x339360(0x208)](_0x833972),_0x498a34;}function createTypingIndicator(){const _0x452db0=a0_0x3f17e2,_0x2a7c41=document[_0x452db0(0x1cb)](_0x452db0(0x233));return _0x2a7c41[_0x452db0(0x1d9)]=_0x452db0(0x22e),_0x2a7c41['id']=_0x452db0(0x1dd),_0x2a7c41[_0x452db0(0x1ca)]=_0x452db0(0x235),_0x2a7c41;}function renderMessages(){const _0x29b52a=a0_0x3f17e2;Array[_0x29b52a(0x211)](chatArea[_0x29b52a(0x206)])[_0x29b52a(0x229)](_0x14722c=>{const _0x2bdc08=_0x29b52a;if(_0x14722c['id']!==_0x2bdc08(0x1ed))_0x14722c['remove']();}),messages[_0x29b52a(0x202)]>0x0?(emptyState[_0x29b52a(0x1cd)]['display']='none',messages['forEach']((_0x599a2b,_0x116d4f)=>chatArea[_0x29b52a(0x208)](createMessageElement(_0x599a2b,_0x116d4f)))):emptyState['style']['display']=_0x29b52a(0x236),requestAnimationFrame(()=>chatArea[_0x29b52a(0x209)]=chatArea[_0x29b52a(0x207)]);}function autoResizeTextarea(){const _0x5bfdc1=a0_0x3f17e2;messageInput[_0x5bfdc1(0x1cd)]['height']=_0x5bfdc1(0x1e4),messageInput['style'][_0x5bfdc1(0x1c4)]=Math[_0x5bfdc1(0x1ef)](messageInput[_0x5bfdc1(0x207)],0x78)+'px';}function updateSendButton(){const _0x58af38=a0_0x3f17e2,_0x4053c9=messageInput[_0x58af38(0x230)][_0x58af38(0x218)]();sendBtn[_0x58af38(0x232)]=!_0x4053c9||isTyping;}async function sendMessage(){const _0x4d7899=a0_0x3f17e2,_0x381878=messageInput[_0x4d7899(0x230)][_0x4d7899(0x218)]();if(!_0x381878||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x4d7899(0x1be)]['impactOccurred'](_0x4d7899(0x22c));messages['push']({'role':_0x4d7899(0x1c1),'content':_0x381878,'timestamp':Date[_0x4d7899(0x20d)]()}),localStorage[_0x4d7899(0x1b7)](_0x4d7899(0x1c9),JSON['stringify'](messages)),renderMessages(),messageInput[_0x4d7899(0x230)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4d7899(0x208)](createTypingIndicator()),chatArea[_0x4d7899(0x209)]=chatArea[_0x4d7899(0x207)];const _0xbfec1f=await callBackend(_0x4d7899(0x1f7),{'message':_0x381878});isTyping=![];const _0x847bcb=document['getElementById'](_0x4d7899(0x1dd));if(_0x847bcb)_0x847bcb[_0x4d7899(0x217)]();let _0x2811d9=_0x4d7899(0x1d6);if(_0xbfec1f[_0x4d7899(0x210)]){_0x2811d9=_0xbfec1f[_0x4d7899(0x1fb)]||_0x4d7899(0x1db);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x4d7899(0x228)](_0x4d7899(0x210));}else{_0x2811d9=_0xbfec1f[_0x4d7899(0x213)]||'Ошибка\x20сервера';if(tg?.[_0x4d7899(0x1be)])tg[_0x4d7899(0x1be)][_0x4d7899(0x228)]('error');}messages[_0x4d7899(0x1ff)]({'role':'ai','content':_0x2811d9,'timestamp':Date[_0x4d7899(0x20d)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x4d7899(0x1f9)](messages)),renderMessages();}function confirmDelete(_0x42a05e){const _0x222b78=a0_0x3f17e2;if(mTitle)mTitle[_0x222b78(0x231)]=_0x222b78(0x1f8);if(mText)mText[_0x222b78(0x231)]=_0x222b78(0x1ea);modalCallback=()=>{const _0x20b9d0=_0x222b78;messages['splice'](_0x42a05e,0x1),localStorage[_0x20b9d0(0x1b7)](_0x20b9d0(0x1c9),JSON[_0x20b9d0(0x1f9)](messages)),renderMessages();},modal[_0x222b78(0x21c)][_0x222b78(0x1e1)](_0x222b78(0x1e5));}if(clearBtn)clearBtn[a0_0x3f17e2(0x1df)]=()=>{const _0x5c246a=a0_0x3f17e2;if(!messages[_0x5c246a(0x202)])return;if(mTitle)mTitle[_0x5c246a(0x231)]='Очистить\x20историю?';if(mText)mText[_0x5c246a(0x231)]=_0x5c246a(0x223);modalCallback=async()=>{const _0x3fc9ba=_0x5c246a;messages=[],localStorage['removeItem'](_0x3fc9ba(0x1c9)),renderMessages(),callBackend(_0x3fc9ba(0x219),{});},modal['classList'][_0x5c246a(0x1e1)](_0x5c246a(0x1e5));};document[a0_0x3f17e2(0x1f6)](a0_0x3f17e2(0x1fa))[a0_0x3f17e2(0x1df)]=()=>modal['classList']['remove'](a0_0x3f17e2(0x1e5)),document['getElementById'](a0_0x3f17e2(0x1d0))[a0_0x3f17e2(0x1df)]=()=>{const _0x5163a1=a0_0x3f17e2;if(modalCallback)modalCallback();modal['classList'][_0x5163a1(0x217)]('show');},messageInput[a0_0x3f17e2(0x1c8)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3f17e2(0x1c8)](a0_0x3f17e2(0x1d8),_0x2a33d3=>{const _0xf1b7eb=a0_0x3f17e2;_0x2a33d3[_0xf1b7eb(0x20a)]===_0xf1b7eb(0x21e)&&!_0x2a33d3[_0xf1b7eb(0x1f1)]&&(_0x2a33d3['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x3f17e2(0x1c8)](a0_0x3f17e2(0x224),_0x4e0c1d=>{const _0x3c4245=a0_0x3f17e2;document[_0x3c4245(0x1de)](_0x3c4245(0x204))[_0x3c4245(0x229)](_0x2e5104=>{const _0x40506a=_0x3c4245;if(!_0x2e5104[_0x40506a(0x220)](_0x4e0c1d['target']))_0x2e5104[_0x40506a(0x21c)][_0x40506a(0x217)]('show-delete');});});const saved=localStorage[a0_0x3f17e2(0x1d2)]('ai_chat_messages');function a0_0x56cb(_0x580c53,_0x17bed0){_0x580c53=_0x580c53-0x1b4;const _0x5143ce=a0_0x571d();let _0x3ffbe9=_0x5143ce[_0x580c53];return _0x3ffbe9;}if(saved)try{messages=JSON[a0_0x3f17e2(0x22d)](saved),renderMessages();}catch(a0_0x3da7cd){}updateSendButton();