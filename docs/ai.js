const a0_0x3ee92d=a0_0x6f79;(function(_0x33850f,_0x77065d){const _0x5928be=a0_0x6f79,_0x234786=_0x33850f();while(!![]){try{const _0x1ecea4=-parseInt(_0x5928be(0xe4))/0x1+-parseInt(_0x5928be(0x141))/0x2+parseInt(_0x5928be(0x10f))/0x3+parseInt(_0x5928be(0xdc))/0x4+parseInt(_0x5928be(0x11f))/0x5*(-parseInt(_0x5928be(0x121))/0x6)+parseInt(_0x5928be(0x133))/0x7+parseInt(_0x5928be(0xde))/0x8;if(_0x1ecea4===_0x77065d)break;else _0x234786['push'](_0x234786['shift']());}catch(_0x4cd70f){_0x234786['push'](_0x234786['shift']());}}}(a0_0x1772,0x7b4e2));function a0_0x1772(){const _0x31b2d5=['typingIndicator','scrollTop','send_message','(((.+)+)+)+$','trim','style','Начнется\x20новый\x20диалог.','.container','className','children','notificationOccurred','onclick','createElement','Очистить\x20историю?','modalText','3161165GiiGCF','Enter','debug_uid','initDataUnsafe','min','TG\x20setup\x20error:','delete-btn','div','innerHTML','first_name','innerHeight','content','Ошибка\x20сети','emptyState','931096RaObid','ready','height','classList','touchend','POST','querySelectorAll','Удалить?','timestamp','now','auto','clearBtn','error','message-bubble','Ошибка\x20сервера','clear_history','target','parse','stopPropagation','<br>','floor','input','getElementById','chatArea','2245916pAOAdQ','key','65200LtgJfN','random','function','offsetHeight','offClick','ai_chat_messages','345044tUUmyU','viewportChanged','appendChild','keydown','add','HapticFeedback','modalTitle','getItem','sendBtn','light','username','abort','viewportHeight','forEach','show-delete','messageInput','success','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','message-time','length','WebApp','scrollHeight','text','toString','message\x20','search','message\x20ai','warn','touchstart','show','inputArea','remove','Telegram','padStart','preventDefault','display','replace','querySelector','removeItem','signal','getMinutes','setItem','2625525sMEScD','constructor','#050505','./router.html','onClick','stringify','flex','getHours','textContent','apply','from','click','none','value','Пустой\x20ответ','.message.show-delete','223365UjwhlD','addEventListener','78UpbpaJ','disableVerticalSwipes','role'];a0_0x1772=function(){return _0x31b2d5;};return a0_0x1772();}const tg=window[a0_0x3ee92d(0x105)]?.[a0_0x3ee92d(0xf9)],HOME_URL=a0_0x3ee92d(0x112);function setupTelegramBackButton(){const _0x11c074=a0_0x3ee92d,_0x3a771d=(function(){let _0xc21844=!![];return function(_0x14c13c,_0x22716d){const _0x282a03=_0xc21844?function(){const _0x38fe6a=a0_0x6f79;if(_0x22716d){const _0x452035=_0x22716d[_0x38fe6a(0x118)](_0x14c13c,arguments);return _0x22716d=null,_0x452035;}}:function(){};return _0xc21844=![],_0x282a03;};}()),_0x1c5ff1=_0x3a771d(this,function(){const _0x526753=a0_0x6f79;return _0x1c5ff1[_0x526753(0xfc)]()[_0x526753(0xfe)](_0x526753(0x127))['toString']()[_0x526753(0x110)](_0x1c5ff1)[_0x526753(0xfe)](_0x526753(0x127));});_0x1c5ff1();if(!tg)return;try{tg[_0x11c074(0x142)](),tg['expand'](),tg['setHeaderColor']?.(_0x11c074(0x111));if(tg['isVersionAtLeast']?.('6.1'))tg[_0x11c074(0x122)]?.();const _0x492ff6=tg['BackButton'];if(_0x492ff6){_0x492ff6[_0x11c074(0x102)]();if(typeof _0x492ff6[_0x11c074(0xe2)]===_0x11c074(0xe0))try{_0x492ff6[_0x11c074(0xe2)]();}catch(_0x4e752e){}_0x492ff6[_0x11c074(0x113)](()=>{const _0x3d93d5=_0x11c074;if(tg['HapticFeedback'])tg[_0x3d93d5(0xe9)]['impactOccurred'](_0x3d93d5(0xed));location['href']=HOME_URL;});}}catch(_0x4ea8dc){console[_0x11c074(0x100)](_0x11c074(0x138),_0x4ea8dc);}}(function initStableLayout(){const _0x56975f=a0_0x3ee92d,_0x153e0a=document[_0x56975f(0x10a)](_0x56975f(0x12b)),_0x3449ec=document[_0x56975f(0xda)](_0x56975f(0x103)),_0x4175eb=document[_0x56975f(0xda)](_0x56975f(0xdb)),_0x2fe043=document[_0x56975f(0xda)](_0x56975f(0xf3));function _0x21a247(){const _0x1c377f=_0x56975f;if(!_0x153e0a)return;const _0x2f3473=tg&&tg['viewportHeight']?tg[_0x1c377f(0xf0)]:window[_0x1c377f(0x13d)];_0x153e0a[_0x1c377f(0x129)][_0x1c377f(0x143)]=_0x2f3473+'px';if(_0x3449ec){const _0x3b14a5=_0x3449ec[_0x1c377f(0xe1)];_0x4175eb[_0x1c377f(0x129)]['paddingBottom']=_0x3b14a5+0x28+'px';}}tg?tg['onEvent'](_0x56975f(0xe5),({isStateStable:_0x2ca215})=>{_0x21a247();if(_0x2ca215)requestAnimationFrame(()=>{const _0x2ba68d=a0_0x6f79;_0x4175eb['scrollTop']=_0x4175eb[_0x2ba68d(0xfa)];});}):window[_0x56975f(0x120)]('resize',_0x21a247),_0x21a247(),_0x2fe043&&(_0x2fe043[_0x56975f(0x120)]('input',()=>{requestAnimationFrame(_0x21a247);}),_0x2fe043[_0x56975f(0x120)]('focus',()=>{setTimeout(()=>{const _0x5e39d6=a0_0x6f79;_0x4175eb['scrollTop']=_0x4175eb[_0x5e39d6(0xfa)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x6f79(_0x26bf61,_0x14492b){_0x26bf61=_0x26bf61-0xc7;const _0x509231=a0_0x1772();let _0x33af94=_0x509231[_0x26bf61];return _0x33af94;}const BACKEND_URL=a0_0x3ee92d(0xf6),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x3ee92d(0xdb)),emptyState=document[a0_0x3ee92d(0xda)]('emptyState'),messageInput=document[a0_0x3ee92d(0xda)]('messageInput'),sendBtn=document[a0_0x3ee92d(0xda)](a0_0x3ee92d(0xec)),clearBtn=document['getElementById'](a0_0x3ee92d(0xcf)),modal=document['getElementById']('confirmModal'),mTitle=document['getElementById'](a0_0x3ee92d(0xea)),mText=document['getElementById'](a0_0x3ee92d(0x132));let modalCallback=null;async function callBackend(_0xa55e9c,_0x4ed4e3){const _0x4c65d7=a0_0x3ee92d,_0x107f76=tg?.[_0x4c65d7(0x136)]?.['user']||{},_0x3aed2f=_0x107f76['id']||localStorage[_0x4c65d7(0xeb)](_0x4c65d7(0x135))||'d-'+Math[_0x4c65d7(0xd8)](Math[_0x4c65d7(0xdf)]()*0x3b9aca00);if(!_0x107f76['id'])localStorage['setItem'](_0x4c65d7(0x135),_0x3aed2f);const _0x53741d={'action':_0xa55e9c,'user_id':_0x3aed2f,'user_data':{'first_name':_0x107f76[_0x4c65d7(0x13c)],'username':_0x107f76[_0x4c65d7(0xee)]},'init_data':tg?.['initData']||'',..._0x4ed4e3},_0x8517dc=new AbortController(),_0x44826b=setTimeout(()=>_0x8517dc[_0x4c65d7(0xef)](),REQUEST_TIMEOUT_MS);try{const _0xf3f2b5=await fetch(BACKEND_URL,{'method':_0x4c65d7(0xc9),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x4c65d7(0x114)](_0x53741d),'signal':_0x8517dc[_0x4c65d7(0x10c)]});return clearTimeout(_0x44826b),await _0xf3f2b5['json']();}catch(_0x34cd71){return{'success':![],'error':String(_0x34cd71)};}}function formatTime(_0x25be9f){const _0x2ef5ad=a0_0x3ee92d,_0x13bb78=new Date(_0x25be9f);return String(_0x13bb78[_0x2ef5ad(0x116)]())[_0x2ef5ad(0x106)](0x2,'0')+':'+String(_0x13bb78[_0x2ef5ad(0x10d)]())[_0x2ef5ad(0x106)](0x2,'0');}function createMessageElement(_0x1e8024,_0x1274d6){const _0x56b549=a0_0x3ee92d,_0x52e9f8=document['createElement'](_0x56b549(0x13a));_0x52e9f8['className']=_0x56b549(0xfd)+_0x1e8024[_0x56b549(0x123)];const _0xfd5a47=document[_0x56b549(0x130)](_0x56b549(0x13a));_0xfd5a47[_0x56b549(0x12c)]=_0x56b549(0xd1),_0xfd5a47[_0x56b549(0x13b)]=_0x1e8024[_0x56b549(0x13e)][_0x56b549(0x109)](/\n/g,_0x56b549(0xd7));const _0x15f84b=document[_0x56b549(0x130)](_0x56b549(0x13a));_0x15f84b['className']=_0x56b549(0x139),_0x15f84b[_0x56b549(0x13b)]=_0x56b549(0xf5),_0x15f84b[_0x56b549(0x12f)]=_0x5e88d9=>{const _0x5029bc=_0x56b549;_0x5e88d9[_0x5029bc(0xd6)](),confirmDelete(_0x1274d6);};let _0xd27739;_0xfd5a47[_0x56b549(0x120)](_0x56b549(0x101),()=>_0xd27739=setTimeout(()=>{const _0x45720f=_0x56b549;_0x52e9f8[_0x45720f(0xc7)]['add'](_0x45720f(0xf2));if(tg?.[_0x45720f(0xe9)])tg[_0x45720f(0xe9)]['impactOccurred']('medium');},0x1f4)),_0xfd5a47[_0x56b549(0x120)](_0x56b549(0xc8),()=>clearTimeout(_0xd27739));const _0x1bb307=document['createElement'](_0x56b549(0x13a));return _0x1bb307[_0x56b549(0x12c)]=_0x56b549(0xf7),_0x1bb307['textContent']=formatTime(_0x1e8024[_0x56b549(0xcc)]),_0x52e9f8['appendChild'](_0x15f84b),_0x52e9f8[_0x56b549(0xe6)](_0xfd5a47),_0x52e9f8[_0x56b549(0xe6)](_0x1bb307),_0x52e9f8;}function createTypingIndicator(){const _0x500f2d=a0_0x3ee92d,_0x590bdb=document['createElement'](_0x500f2d(0x13a));return _0x590bdb['className']=_0x500f2d(0xff),_0x590bdb['id']=_0x500f2d(0x124),_0x590bdb[_0x500f2d(0x13b)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x590bdb;}function renderMessages(){const _0x3f9503=a0_0x3ee92d;Array[_0x3f9503(0x119)](chatArea[_0x3f9503(0x12d)])[_0x3f9503(0xf1)](_0x42902e=>{const _0x2bf82e=_0x3f9503;if(_0x42902e['id']!==_0x2bf82e(0x140))_0x42902e['remove']();}),messages[_0x3f9503(0xf8)]>0x0?(emptyState[_0x3f9503(0x129)][_0x3f9503(0x108)]=_0x3f9503(0x11b),messages[_0x3f9503(0xf1)]((_0x38d994,_0x2ea5ad)=>chatArea[_0x3f9503(0xe6)](createMessageElement(_0x38d994,_0x2ea5ad)))):emptyState[_0x3f9503(0x129)][_0x3f9503(0x108)]=_0x3f9503(0x115),requestAnimationFrame(()=>chatArea[_0x3f9503(0x125)]=chatArea[_0x3f9503(0xfa)]);}function autoResizeTextarea(){const _0x2375ac=a0_0x3ee92d;messageInput['style'][_0x2375ac(0x143)]=_0x2375ac(0xce),messageInput[_0x2375ac(0x129)][_0x2375ac(0x143)]=Math[_0x2375ac(0x137)](messageInput[_0x2375ac(0xfa)],0x78)+'px';}function updateSendButton(){const _0x5365f6=a0_0x3ee92d,_0x59ed11=messageInput[_0x5365f6(0x11c)][_0x5365f6(0x128)]();sendBtn['disabled']=!_0x59ed11||isTyping;}async function sendMessage(){const _0xe8eb2f=a0_0x3ee92d,_0x1e82c5=messageInput[_0xe8eb2f(0x11c)][_0xe8eb2f(0x128)]();if(!_0x1e82c5||isTyping)return;if(tg?.[_0xe8eb2f(0xe9)])tg[_0xe8eb2f(0xe9)]['impactOccurred'](_0xe8eb2f(0xed));messages['push']({'role':'user','content':_0x1e82c5,'timestamp':Date[_0xe8eb2f(0xcd)]()}),localStorage['setItem'](_0xe8eb2f(0xe3),JSON[_0xe8eb2f(0x114)](messages)),renderMessages(),messageInput[_0xe8eb2f(0x11c)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xe8eb2f(0xe6)](createTypingIndicator()),chatArea[_0xe8eb2f(0x125)]=chatArea[_0xe8eb2f(0xfa)];const _0x1adb0f=await callBackend(_0xe8eb2f(0x126),{'message':_0x1e82c5});isTyping=![];const _0x783c01=document[_0xe8eb2f(0xda)]('typingIndicator');if(_0x783c01)_0x783c01[_0xe8eb2f(0x104)]();let _0x5edfdb=_0xe8eb2f(0x13f);if(_0x1adb0f[_0xe8eb2f(0xf4)]){_0x5edfdb=_0x1adb0f[_0xe8eb2f(0xfb)]||_0xe8eb2f(0x11d);if(tg?.[_0xe8eb2f(0xe9)])tg[_0xe8eb2f(0xe9)][_0xe8eb2f(0x12e)](_0xe8eb2f(0xf4));}else{_0x5edfdb=_0x1adb0f['error']||_0xe8eb2f(0xd2);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0xe8eb2f(0x12e)](_0xe8eb2f(0xd0));}messages['push']({'role':'ai','content':_0x5edfdb,'timestamp':Date[_0xe8eb2f(0xcd)]()}),localStorage[_0xe8eb2f(0x10e)](_0xe8eb2f(0xe3),JSON[_0xe8eb2f(0x114)](messages)),renderMessages();}function confirmDelete(_0xab24fb){const _0x3fbd8a=a0_0x3ee92d;if(mTitle)mTitle[_0x3fbd8a(0x117)]=_0x3fbd8a(0xcb);if(mText)mText[_0x3fbd8a(0x117)]='Действие\x20необратимо.';modalCallback=()=>{const _0x310d56=_0x3fbd8a;messages['splice'](_0xab24fb,0x1),localStorage['setItem'](_0x310d56(0xe3),JSON[_0x310d56(0x114)](messages)),renderMessages();},modal[_0x3fbd8a(0xc7)]['add'](_0x3fbd8a(0x102));}if(clearBtn)clearBtn[a0_0x3ee92d(0x12f)]=()=>{const _0x29df05=a0_0x3ee92d;if(!messages[_0x29df05(0xf8)])return;if(mTitle)mTitle[_0x29df05(0x117)]=_0x29df05(0x131);if(mText)mText['textContent']=_0x29df05(0x12a);modalCallback=async()=>{const _0x180e0d=_0x29df05;messages=[],localStorage[_0x180e0d(0x10b)]('ai_chat_messages'),renderMessages(),callBackend(_0x180e0d(0xd3),{});},modal[_0x29df05(0xc7)][_0x29df05(0xe8)](_0x29df05(0x102));};document[a0_0x3ee92d(0xda)]('modalCancel')[a0_0x3ee92d(0x12f)]=()=>modal[a0_0x3ee92d(0xc7)][a0_0x3ee92d(0x104)]('show'),document['getElementById']('modalConfirm')[a0_0x3ee92d(0x12f)]=()=>{const _0x30f34b=a0_0x3ee92d;if(modalCallback)modalCallback();modal[_0x30f34b(0xc7)][_0x30f34b(0x104)](_0x30f34b(0x102));},messageInput['addEventListener'](a0_0x3ee92d(0xd9),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x3ee92d(0xe7),_0x3c1a79=>{const _0x4eeec8=a0_0x3ee92d;_0x3c1a79[_0x4eeec8(0xdd)]===_0x4eeec8(0x134)&&!_0x3c1a79['shiftKey']&&(_0x3c1a79[_0x4eeec8(0x107)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x3ee92d(0x120)](a0_0x3ee92d(0x11a),_0xf48135=>{const _0x5a7853=a0_0x3ee92d;document[_0x5a7853(0xca)](_0x5a7853(0x11e))[_0x5a7853(0xf1)](_0x471717=>{const _0x55e3e2=_0x5a7853;if(!_0x471717['contains'](_0xf48135[_0x55e3e2(0xd4)]))_0x471717[_0x55e3e2(0xc7)][_0x55e3e2(0x104)](_0x55e3e2(0xf2));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x3ee92d(0xd5)](saved),renderMessages();}catch(a0_0x19d60f){}updateSendButton();