const a0_0x4ae352=a0_0x3b1a;(function(_0x447d09,_0x2bdafa){const _0x474e37=a0_0x3b1a,_0x32eddd=_0x447d09();while(!![]){try{const _0x307edc=-parseInt(_0x474e37(0xba))/0x1+parseInt(_0x474e37(0xd4))/0x2*(parseInt(_0x474e37(0xf8))/0x3)+-parseInt(_0x474e37(0xb2))/0x4*(-parseInt(_0x474e37(0x115))/0x5)+-parseInt(_0x474e37(0xb6))/0x6+-parseInt(_0x474e37(0xae))/0x7*(parseInt(_0x474e37(0xed))/0x8)+-parseInt(_0x474e37(0xce))/0x9+-parseInt(_0x474e37(0xc7))/0xa*(-parseInt(_0x474e37(0xd1))/0xb);if(_0x307edc===_0x2bdafa)break;else _0x32eddd['push'](_0x32eddd['shift']());}catch(_0x259b77){_0x32eddd['push'](_0x32eddd['shift']());}}}(a0_0x5616,0xc3b77));const tg=window['Telegram']?.[a0_0x4ae352(0xdc)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x573c3b=a0_0x4ae352,_0x2c9df2=(function(){let _0x12a6a4=!![];return function(_0x4c906f,_0x21ee14){const _0x4ab4e8=_0x12a6a4?function(){if(_0x21ee14){const _0x837e32=_0x21ee14['apply'](_0x4c906f,arguments);return _0x21ee14=null,_0x837e32;}}:function(){};return _0x12a6a4=![],_0x4ab4e8;};}()),_0x4580e6=_0x2c9df2(this,function(){const _0x369b75=a0_0x3b1a;return _0x4580e6[_0x369b75(0xa9)]()[_0x369b75(0xf0)]('(((.+)+)+)+$')['toString']()[_0x369b75(0xd8)](_0x4580e6)[_0x369b75(0xf0)](_0x369b75(0x118));});_0x4580e6();if(!tg)return;try{tg[_0x573c3b(0xa6)](),tg['expand'](),tg[_0x573c3b(0x116)]?.(_0x573c3b(0x11d));if(tg[_0x573c3b(0xde)]?.(_0x573c3b(0xd0)))tg[_0x573c3b(0xfd)]?.();const _0x582373=tg[_0x573c3b(0x103)];if(_0x582373){_0x582373[_0x573c3b(0xfe)]();if(typeof _0x582373[_0x573c3b(0x114)]===_0x573c3b(0xb8))try{_0x582373[_0x573c3b(0x114)]();}catch(_0x1ddfa5){}_0x582373[_0x573c3b(0xbf)](()=>{const _0x3f27c0=_0x573c3b;if(tg[_0x3f27c0(0xc0)])tg[_0x3f27c0(0xc0)][_0x3f27c0(0xb3)](_0x3f27c0(0x10a));location['href']=HOME_URL;});}}catch(_0x352922){console[_0x573c3b(0xb1)]('TG\x20setup\x20error:',_0x352922);}}(function initStableLayout(){const _0xf1361a=a0_0x4ae352,_0x456c9f=document[_0xf1361a(0x123)](_0xf1361a(0xc6)),_0x42c05e=document[_0xf1361a(0xda)]('inputArea'),_0x1fa946=document[_0xf1361a(0xda)]('chatArea'),_0x414eec=document[_0xf1361a(0xda)](_0xf1361a(0xc8));function _0x5243b3(){const _0x1a4151=_0xf1361a;if(!_0x456c9f)return;const _0x1fa936=tg&&tg[_0x1a4151(0xc3)]?tg[_0x1a4151(0xc3)]:window['innerHeight'];_0x456c9f['style'][_0x1a4151(0xee)]=_0x1fa936+'px';if(_0x42c05e){const _0x590779=_0x42c05e[_0x1a4151(0x104)];_0x1fa946[_0x1a4151(0xaa)][_0x1a4151(0x10b)]=_0x590779+0x28+'px';}}tg?tg[_0xf1361a(0xbe)]('viewportChanged',({isStateStable:_0x2c0f78})=>{_0x5243b3();if(_0x2c0f78)requestAnimationFrame(()=>{const _0x1b6d68=a0_0x3b1a;_0x1fa946[_0x1b6d68(0xca)]=_0x1fa946['scrollHeight'];});}):window['addEventListener'](_0xf1361a(0x108),_0x5243b3),_0x5243b3(),_0x414eec&&(_0x414eec['addEventListener']('input',()=>{requestAnimationFrame(_0x5243b3);}),_0x414eec['addEventListener'](_0xf1361a(0x122),()=>{setTimeout(()=>{const _0xc70c9c=a0_0x3b1a;_0x1fa946[_0xc70c9c(0xca)]=_0x1fa946[_0xc70c9c(0xeb)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4ae352(0xfb),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x4ae352(0x105)),emptyState=document[a0_0x4ae352(0xda)](a0_0x4ae352(0x11c)),messageInput=document['getElementById'](a0_0x4ae352(0xc8)),sendBtn=document[a0_0x4ae352(0xda)]('sendBtn'),clearBtn=document[a0_0x4ae352(0xda)]('clearBtn'),modal=document['getElementById'](a0_0x4ae352(0xc5)),mTitle=document[a0_0x4ae352(0xda)](a0_0x4ae352(0xd5)),mText=document[a0_0x4ae352(0xda)](a0_0x4ae352(0x10e));let modalCallback=null;async function callBackend(_0x5552b2,_0x282ef7){const _0x29011f=a0_0x4ae352,_0x13400f=tg?.[_0x29011f(0xe7)]?.[_0x29011f(0xc9)]||{},_0x37b3d9=_0x13400f['id']||localStorage['getItem'](_0x29011f(0x112))||'d-'+Math[_0x29011f(0x117)](Math[_0x29011f(0xbd)]()*0x3b9aca00);if(!_0x13400f['id'])localStorage['setItem'](_0x29011f(0x112),_0x37b3d9);const _0x43da6a={'action':_0x5552b2,'user_id':_0x37b3d9,'user_data':{'first_name':_0x13400f[_0x29011f(0xe1)],'username':_0x13400f[_0x29011f(0x113)]},'init_data':tg?.[_0x29011f(0xb5)]||'',..._0x282ef7},_0x1f82a9=new AbortController(),_0x1fe8e6=setTimeout(()=>_0x1f82a9[_0x29011f(0x11f)](),REQUEST_TIMEOUT_MS);try{const _0x22fe38=await fetch(BACKEND_URL,{'method':_0x29011f(0xf4),'headers':{'Content-Type':_0x29011f(0xcc)},'body':JSON['stringify'](_0x43da6a),'signal':_0x1f82a9[_0x29011f(0xdf)]});return clearTimeout(_0x1fe8e6),await _0x22fe38[_0x29011f(0xc2)]();}catch(_0x4564c8){return{'success':![],'error':String(_0x4564c8)};}}function formatTime(_0x35a63a){const _0x2a782e=a0_0x4ae352,_0x35f9cb=new Date(_0x35a63a);return String(_0x35f9cb[_0x2a782e(0xe2)]())[_0x2a782e(0xf9)](0x2,'0')+':'+String(_0x35f9cb['getMinutes']())[_0x2a782e(0xf9)](0x2,'0');}function createMessageElement(_0x231b45,_0x52283a){const _0xf26af5=a0_0x4ae352,_0x530201=document['createElement'](_0xf26af5(0xad));_0x530201[_0xf26af5(0xe5)]='message\x20'+_0x231b45[_0xf26af5(0x119)];const _0x346627=document[_0xf26af5(0xe8)](_0xf26af5(0xad));_0x346627['className']=_0xf26af5(0xf5),_0x346627[_0xf26af5(0x101)]=_0x231b45[_0xf26af5(0xfa)][_0xf26af5(0x10d)](/\n/g,_0xf26af5(0xea));const _0x4ff333=document[_0xf26af5(0xe8)](_0xf26af5(0xad));_0x4ff333['className']=_0xf26af5(0xd3),_0x4ff333[_0xf26af5(0x101)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x4ff333['onclick']=_0x4e4fa0=>{const _0x265443=_0xf26af5;_0x4e4fa0[_0x265443(0x11e)](),confirmDelete(_0x52283a);};let _0x4a21ff;_0x346627[_0xf26af5(0xf2)]('touchstart',()=>_0x4a21ff=setTimeout(()=>{const _0x5dae79=_0xf26af5;_0x530201[_0x5dae79(0xf7)]['add'](_0x5dae79(0xa8));if(tg?.[_0x5dae79(0xc0)])tg['HapticFeedback'][_0x5dae79(0xb3)](_0x5dae79(0xac));},0x1f4)),_0x346627[_0xf26af5(0xf2)](_0xf26af5(0x10c),()=>clearTimeout(_0x4a21ff));const _0x248857=document[_0xf26af5(0xe8)](_0xf26af5(0xad));return _0x248857['className']=_0xf26af5(0xcf),_0x248857[_0xf26af5(0xe9)]=formatTime(_0x231b45[_0xf26af5(0xdd)]),_0x530201['appendChild'](_0x4ff333),_0x530201[_0xf26af5(0xab)](_0x346627),_0x530201[_0xf26af5(0xab)](_0x248857),_0x530201;}function createTypingIndicator(){const _0x22989b=a0_0x4ae352,_0x1781ec=document[_0x22989b(0xe8)]('div');return _0x1781ec['className']='message\x20ai',_0x1781ec['id']=_0x22989b(0x106),_0x1781ec['innerHTML']=_0x22989b(0xe0),_0x1781ec;}function renderMessages(){const _0x3d32d7=a0_0x4ae352;Array[_0x3d32d7(0xcd)](chatArea['children'])[_0x3d32d7(0xe4)](_0xb1a65d=>{const _0x1d3faa=_0x3d32d7;if(_0xb1a65d['id']!==_0x1d3faa(0x11c))_0xb1a65d[_0x1d3faa(0x100)]();}),messages[_0x3d32d7(0x102)]>0x0?(emptyState[_0x3d32d7(0xaa)]['display']='none',messages[_0x3d32d7(0xe4)]((_0x26bae6,_0x390304)=>chatArea[_0x3d32d7(0xab)](createMessageElement(_0x26bae6,_0x390304)))):emptyState['style'][_0x3d32d7(0xaf)]='flex',requestAnimationFrame(()=>chatArea[_0x3d32d7(0xca)]=chatArea['scrollHeight']);}function a0_0x3b1a(_0x1d0e09,_0x14fe5a){_0x1d0e09=_0x1d0e09-0xa6;const _0x57c998=a0_0x5616();let _0x18c65b=_0x57c998[_0x1d0e09];return _0x18c65b;}function autoResizeTextarea(){const _0x15fbff=a0_0x4ae352;messageInput['style'][_0x15fbff(0xee)]=_0x15fbff(0xd9),messageInput['style'][_0x15fbff(0xee)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x49ba07=a0_0x4ae352,_0x5d73b9=messageInput[_0x49ba07(0xb0)][_0x49ba07(0xd6)]();sendBtn[_0x49ba07(0xef)]=!_0x5d73b9||isTyping;}async function sendMessage(){const _0x5b7fcf=a0_0x4ae352,_0x325d2f=messageInput[_0x5b7fcf(0xb0)][_0x5b7fcf(0xd6)]();if(!_0x325d2f||isTyping)return;if(tg?.[_0x5b7fcf(0xc0)])tg[_0x5b7fcf(0xc0)]['impactOccurred'](_0x5b7fcf(0x10a));messages[_0x5b7fcf(0x11b)]({'role':_0x5b7fcf(0xc9),'content':_0x325d2f,'timestamp':Date[_0x5b7fcf(0xf1)]()}),localStorage[_0x5b7fcf(0xff)]('ai_chat_messages',JSON[_0x5b7fcf(0xec)](messages)),renderMessages(),messageInput[_0x5b7fcf(0xb0)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x5b7fcf(0xca)]=chatArea[_0x5b7fcf(0xeb)];const _0x12f3f0=await callBackend(_0x5b7fcf(0x120),{'message':_0x325d2f});isTyping=![];const _0x227a72=document[_0x5b7fcf(0xda)](_0x5b7fcf(0x106));if(_0x227a72)_0x227a72[_0x5b7fcf(0x100)]();let _0x4b1f8e=_0x5b7fcf(0xdb);if(_0x12f3f0[_0x5b7fcf(0xe6)]){_0x4b1f8e=_0x12f3f0[_0x5b7fcf(0xf6)]||_0x5b7fcf(0xe3);if(tg?.['HapticFeedback'])tg[_0x5b7fcf(0xc0)][_0x5b7fcf(0xcb)](_0x5b7fcf(0xe6));}else{_0x4b1f8e=_0x12f3f0[_0x5b7fcf(0x107)]||_0x5b7fcf(0xfc);if(tg?.[_0x5b7fcf(0xc0)])tg[_0x5b7fcf(0xc0)][_0x5b7fcf(0xcb)](_0x5b7fcf(0x107));}messages[_0x5b7fcf(0x11b)]({'role':'ai','content':_0x4b1f8e,'timestamp':Date[_0x5b7fcf(0xf1)]()}),localStorage[_0x5b7fcf(0xff)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x220682){const _0x50ec98=a0_0x4ae352;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x50ec98(0xe9)]=_0x50ec98(0xf3);modalCallback=()=>{const _0x24abaf=_0x50ec98;messages['splice'](_0x220682,0x1),localStorage['setItem'](_0x24abaf(0xd7),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x50ec98(0xbc)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0x2b15d4=a0_0x4ae352;if(!messages[_0x2b15d4(0x102)])return;if(mTitle)mTitle['textContent']=_0x2b15d4(0x109);if(mText)mText[_0x2b15d4(0xe9)]=_0x2b15d4(0x121);modalCallback=async()=>{const _0x46f79d=_0x2b15d4;messages=[],localStorage[_0x46f79d(0xa7)](_0x46f79d(0xd7)),renderMessages(),callBackend('clear_history',{});},modal[_0x2b15d4(0xf7)][_0x2b15d4(0xbc)]('show');};document[a0_0x4ae352(0xda)](a0_0x4ae352(0x11a))[a0_0x4ae352(0xb9)]=()=>modal[a0_0x4ae352(0xf7)][a0_0x4ae352(0x100)](a0_0x4ae352(0xfe)),document['getElementById']('modalConfirm')[a0_0x4ae352(0xb9)]=()=>{const _0x3def39=a0_0x4ae352;if(modalCallback)modalCallback();modal[_0x3def39(0xf7)][_0x3def39(0x100)](_0x3def39(0xfe));},messageInput[a0_0x4ae352(0xf2)](a0_0x4ae352(0xc1),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x4ae352(0xd2),_0x460e0c=>{const _0x393c19=a0_0x4ae352;_0x460e0c['key']===_0x393c19(0x110)&&!_0x460e0c[_0x393c19(0x111)]&&(_0x460e0c['preventDefault'](),sendMessage());}),sendBtn[a0_0x4ae352(0xb9)]=sendMessage,document[a0_0x4ae352(0xf2)](a0_0x4ae352(0xb4),_0x1fa535=>{document['querySelectorAll']('.message.show-delete')['forEach'](_0x6cd418=>{const _0x3e7437=a0_0x3b1a;if(!_0x6cd418[_0x3e7437(0x10f)](_0x1fa535[_0x3e7437(0xc4)]))_0x6cd418[_0x3e7437(0xf7)][_0x3e7437(0x100)](_0x3e7437(0xa8));});});const saved=localStorage[a0_0x4ae352(0xb7)](a0_0x4ae352(0xd7));if(saved)try{messages=JSON[a0_0x4ae352(0xbb)](saved),renderMessages();}catch(a0_0x53dea9){}updateSendButton();function a0_0x5616(){const _0x2a9a8c=['offsetHeight','chatArea','typingIndicator','error','resize','Очистить\x20историю?','light','paddingBottom','touchend','replace','modalText','contains','Enter','shiftKey','debug_uid','username','offClick','185gJKvtR','setHeaderColor','floor','(((.+)+)+)+$','role','modalCancel','push','emptyState','#050505','stopPropagation','abort','send_message','Начнется\x20новый\x20диалог.','focus','querySelector','ready','removeItem','show-delete','toString','style','appendChild','medium','div','55741jyFnjz','display','value','warn','73076kqvfTI','impactOccurred','click','initData','8930208MczrHg','getItem','function','onclick','451309uGPMGK','parse','add','random','onEvent','onClick','HapticFeedback','input','json','viewportHeight','target','confirmModal','.container','890bivfPc','messageInput','user','scrollTop','notificationOccurred','text/plain','from','10489446cDAPUo','message-time','6.1','395879OuxDNo','keydown','delete-btn','2BXsZXa','modalTitle','trim','ai_chat_messages','constructor','auto','getElementById','Ошибка\x20сети','WebApp','timestamp','isVersionAtLeast','signal','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','first_name','getHours','Пустой\x20ответ','forEach','className','success','initDataUnsafe','createElement','textContent','<br>','scrollHeight','stringify','536BlDwtv','height','disabled','search','now','addEventListener','Действие\x20необратимо.','POST','message-bubble','text','classList','1684119RfwKMm','padStart','content','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Ошибка\x20сервера','disableVerticalSwipes','show','setItem','remove','innerHTML','length','BackButton'];a0_0x5616=function(){return _0x2a9a8c;};return a0_0x5616();}