const a0_0x2902a2=a0_0x52ab;(function(_0x4a0a09,_0x54baed){const _0x1c624f=a0_0x52ab,_0x2bc2b9=_0x4a0a09();while(!![]){try{const _0x5854e5=parseInt(_0x1c624f(0x170))/0x1+parseInt(_0x1c624f(0x172))/0x2+-parseInt(_0x1c624f(0x1a7))/0x3*(parseInt(_0x1c624f(0x1aa))/0x4)+-parseInt(_0x1c624f(0x166))/0x5*(parseInt(_0x1c624f(0x1b8))/0x6)+parseInt(_0x1c624f(0x1a4))/0x7+-parseInt(_0x1c624f(0x15f))/0x8*(parseInt(_0x1c624f(0x191))/0x9)+parseInt(_0x1c624f(0x17e))/0xa;if(_0x5854e5===_0x54baed)break;else _0x2bc2b9['push'](_0x2bc2b9['shift']());}catch(_0xaa653b){_0x2bc2b9['push'](_0x2bc2b9['shift']());}}}(a0_0x5d60,0xc871f));const tg=window['Telegram']?.[a0_0x2902a2(0x1b9)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x325dbc=a0_0x2902a2;if(!tg)return;try{tg['ready'](),tg['expand'](),tg['setHeaderColor']?.(_0x325dbc(0x17f));if(tg[_0x325dbc(0x18f)]?.(_0x325dbc(0x16f)))tg[_0x325dbc(0x173)]?.();const _0x5a4ce9=tg[_0x325dbc(0x16b)];if(_0x5a4ce9){_0x5a4ce9['show']();if(typeof _0x5a4ce9['offClick']===_0x325dbc(0x1d1))try{_0x5a4ce9['offClick']();}catch(_0x2ca018){}_0x5a4ce9[_0x325dbc(0x1ad)](()=>{const _0x47bf9e=_0x325dbc;if(tg[_0x47bf9e(0x1af)])tg[_0x47bf9e(0x1af)]['impactOccurred'](_0x47bf9e(0x1b6));location['href']=HOME_URL;});}}catch(_0x4e1dc2){console['warn'](_0x325dbc(0x1d3),_0x4e1dc2);}}(function initStableLayout(){const _0x3e33d3=a0_0x2902a2,_0x807dbf=(function(){let _0x15a110=!![];return function(_0x156841,_0xa371e6){const _0x3cf775=_0x15a110?function(){if(_0xa371e6){const _0x55205e=_0xa371e6['apply'](_0x156841,arguments);return _0xa371e6=null,_0x55205e;}}:function(){};return _0x15a110=![],_0x3cf775;};}()),_0x172aae=document[_0x3e33d3(0x186)]('.container'),_0x54c0a4=document[_0x3e33d3(0x1ba)]('inputArea'),_0x43999c=document[_0x3e33d3(0x1ba)]('chatArea'),_0x4c7467=document['getElementById']('messageInput');function _0x47ff2a(){const _0x10d2a8=_0x3e33d3,_0x17f1b6=_0x807dbf(this,function(){const _0x40a489=a0_0x52ab;return _0x17f1b6[_0x40a489(0x1b5)]()[_0x40a489(0x194)](_0x40a489(0x16e))['toString']()[_0x40a489(0x1d9)](_0x17f1b6)['search'](_0x40a489(0x16e));});_0x17f1b6();if(!_0x172aae)return;const _0x48c64b=tg&&tg[_0x10d2a8(0x1a1)]?tg[_0x10d2a8(0x1a1)]:window[_0x10d2a8(0x1b3)];_0x172aae[_0x10d2a8(0x1d6)][_0x10d2a8(0x196)]=_0x48c64b+'px';if(_0x54c0a4){const _0x56507a=_0x54c0a4[_0x10d2a8(0x1c6)];_0x43999c['style'][_0x10d2a8(0x1bf)]=_0x56507a+0x28+'px';}}tg?tg[_0x3e33d3(0x167)](_0x3e33d3(0x1d4),({isStateStable:_0x240e26})=>{_0x47ff2a();if(_0x240e26)requestAnimationFrame(()=>{const _0x512d61=a0_0x52ab;_0x43999c['scrollTop']=_0x43999c[_0x512d61(0x1c8)];});}):window[_0x3e33d3(0x1ac)](_0x3e33d3(0x16d),_0x47ff2a),_0x47ff2a(),_0x4c7467&&(_0x4c7467[_0x3e33d3(0x1ac)](_0x3e33d3(0x1d8),()=>{requestAnimationFrame(_0x47ff2a);}),_0x4c7467['addEventListener'](_0x3e33d3(0x19a),()=>{setTimeout(()=>{const _0x9705c9=a0_0x52ab;_0x43999c[_0x9705c9(0x1a6)]=_0x43999c[_0x9705c9(0x1c8)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2902a2(0x1bb),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2902a2(0x1ba)](a0_0x2902a2(0x1c7)),emptyState=document[a0_0x2902a2(0x1ba)]('emptyState'),messageInput=document[a0_0x2902a2(0x1ba)]('messageInput'),sendBtn=document['getElementById'](a0_0x2902a2(0x162)),clearBtn=document[a0_0x2902a2(0x1ba)](a0_0x2902a2(0x176)),modal=document[a0_0x2902a2(0x1ba)](a0_0x2902a2(0x175)),mTitle=document[a0_0x2902a2(0x1ba)](a0_0x2902a2(0x1d2)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x51e3b9,_0x306e4c){const _0x504b42=a0_0x2902a2,_0x393e0e=tg?.[_0x504b42(0x192)]?.[_0x504b42(0x184)]||{},_0x51c6ef=_0x393e0e['id']||localStorage[_0x504b42(0x1c2)](_0x504b42(0x16c))||'d-'+Math[_0x504b42(0x1b7)](Math[_0x504b42(0x1c0)]()*0x3b9aca00);if(!_0x393e0e['id'])localStorage[_0x504b42(0x164)](_0x504b42(0x16c),_0x51c6ef);const _0x1f9194={'action':_0x51e3b9,'user_id':_0x51c6ef,'user_data':{'first_name':_0x393e0e['first_name'],'username':_0x393e0e[_0x504b42(0x179)]},'init_data':tg?.[_0x504b42(0x1c3)]||'',..._0x306e4c},_0x387b6e=new AbortController(),_0x199881=setTimeout(()=>_0x387b6e[_0x504b42(0x1cd)](),REQUEST_TIMEOUT_MS);try{const _0x37b7b1=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x1f9194),'signal':_0x387b6e[_0x504b42(0x1ce)]});return clearTimeout(_0x199881),await _0x37b7b1[_0x504b42(0x1b0)]();}catch(_0x45ab9d){return{'success':![],'error':String(_0x45ab9d)};}}function formatTime(_0x3744d2){const _0x2558a2=a0_0x2902a2,_0x3851db=new Date(_0x3744d2);return String(_0x3851db[_0x2558a2(0x1ca)]())['padStart'](0x2,'0')+':'+String(_0x3851db[_0x2558a2(0x181)]())['padStart'](0x2,'0');}function createMessageElement(_0x249da3,_0x43e77f){const _0xe05e6f=a0_0x2902a2,_0x5e57d8=document[_0xe05e6f(0x1cc)](_0xe05e6f(0x1d5));_0x5e57d8[_0xe05e6f(0x163)]=_0xe05e6f(0x1cb)+_0x249da3[_0xe05e6f(0x17a)];const _0x475eb6=document[_0xe05e6f(0x1cc)](_0xe05e6f(0x1d5));_0x475eb6['className']=_0xe05e6f(0x160),_0x475eb6[_0xe05e6f(0x17b)]=_0x249da3[_0xe05e6f(0x185)]['replace'](/\n/g,_0xe05e6f(0x19e));const _0x263454=document[_0xe05e6f(0x1cc)](_0xe05e6f(0x1d5));_0x263454['className']=_0xe05e6f(0x183),_0x263454[_0xe05e6f(0x17b)]=_0xe05e6f(0x15e),_0x263454[_0xe05e6f(0x1b1)]=_0x23233f=>{_0x23233f['stopPropagation'](),confirmDelete(_0x43e77f);};let _0x1dde46;_0x475eb6[_0xe05e6f(0x1ac)](_0xe05e6f(0x1a3),()=>_0x1dde46=setTimeout(()=>{const _0x21df27=_0xe05e6f;_0x5e57d8[_0x21df27(0x168)][_0x21df27(0x187)](_0x21df27(0x18d));if(tg?.[_0x21df27(0x1af)])tg['HapticFeedback'][_0x21df27(0x19f)](_0x21df27(0x190));},0x1f4)),_0x475eb6['addEventListener']('touchend',()=>clearTimeout(_0x1dde46));const _0x21d719=document[_0xe05e6f(0x1cc)](_0xe05e6f(0x1d5));return _0x21d719['className']=_0xe05e6f(0x19d),_0x21d719[_0xe05e6f(0x1c5)]=formatTime(_0x249da3[_0xe05e6f(0x161)]),_0x5e57d8[_0xe05e6f(0x17c)](_0x263454),_0x5e57d8[_0xe05e6f(0x17c)](_0x475eb6),_0x5e57d8[_0xe05e6f(0x17c)](_0x21d719),_0x5e57d8;}function createTypingIndicator(){const _0x253ea3=a0_0x2902a2,_0x31ad8f=document['createElement']('div');return _0x31ad8f[_0x253ea3(0x163)]=_0x253ea3(0x171),_0x31ad8f['id']='typingIndicator',_0x31ad8f[_0x253ea3(0x17b)]=_0x253ea3(0x1a2),_0x31ad8f;}function renderMessages(){const _0x32250b=a0_0x2902a2;Array['from'](chatArea['children'])[_0x32250b(0x1ae)](_0x3b95fb=>{const _0x16be2e=_0x32250b;if(_0x3b95fb['id']!==_0x16be2e(0x178))_0x3b95fb[_0x16be2e(0x169)]();}),messages[_0x32250b(0x1a5)]>0x0?(emptyState[_0x32250b(0x1d6)][_0x32250b(0x1a0)]=_0x32250b(0x1bd),messages[_0x32250b(0x1ae)]((_0x5bd542,_0x62d09)=>chatArea[_0x32250b(0x17c)](createMessageElement(_0x5bd542,_0x62d09)))):emptyState[_0x32250b(0x1d6)][_0x32250b(0x1a0)]='flex',requestAnimationFrame(()=>chatArea[_0x32250b(0x1a6)]=chatArea[_0x32250b(0x1c8)]);}function autoResizeTextarea(){const _0x257ced=a0_0x2902a2;messageInput[_0x257ced(0x1d6)][_0x257ced(0x196)]=_0x257ced(0x1c1),messageInput[_0x257ced(0x1d6)][_0x257ced(0x196)]=Math[_0x257ced(0x165)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x597cf2=a0_0x2902a2,_0x3afe0b=messageInput[_0x597cf2(0x174)]['trim']();sendBtn[_0x597cf2(0x18a)]=!_0x3afe0b||isTyping;}async function sendMessage(){const _0x1ce867=a0_0x2902a2,_0x17dbf1=messageInput[_0x1ce867(0x174)][_0x1ce867(0x195)]();if(!_0x17dbf1||isTyping)return;if(tg?.[_0x1ce867(0x1af)])tg[_0x1ce867(0x1af)][_0x1ce867(0x19f)](_0x1ce867(0x1b6));messages[_0x1ce867(0x180)]({'role':'user','content':_0x17dbf1,'timestamp':Date[_0x1ce867(0x1b2)]()}),localStorage[_0x1ce867(0x164)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1ce867(0x17c)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x1ce867(0x1c8)];const _0x3c41fd=await callBackend(_0x1ce867(0x188),{'message':_0x17dbf1});isTyping=![];const _0x7af3a8=document[_0x1ce867(0x1ba)](_0x1ce867(0x1d7));if(_0x7af3a8)_0x7af3a8['remove']();let _0x4692b3=_0x1ce867(0x19b);if(_0x3c41fd[_0x1ce867(0x1a8)]){_0x4692b3=_0x3c41fd[_0x1ce867(0x1cf)]||_0x1ce867(0x19c);if(tg?.['HapticFeedback'])tg[_0x1ce867(0x1af)][_0x1ce867(0x1b4)]('success');}else{_0x4692b3=_0x3c41fd[_0x1ce867(0x199)]||_0x1ce867(0x198);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x1ce867(0x1b4)](_0x1ce867(0x199));}messages[_0x1ce867(0x180)]({'role':'ai','content':_0x4692b3,'timestamp':Date[_0x1ce867(0x1b2)]()}),localStorage['setItem'](_0x1ce867(0x177),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x53e87a){const _0x2c379f=a0_0x2902a2;if(mTitle)mTitle[_0x2c379f(0x1c5)]=_0x2c379f(0x1a9);if(mText)mText[_0x2c379f(0x1c5)]=_0x2c379f(0x1bc);modalCallback=()=>{const _0x39bda8=_0x2c379f;messages[_0x39bda8(0x1da)](_0x53e87a,0x1),localStorage[_0x39bda8(0x164)](_0x39bda8(0x177),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x2c379f(0x187)](_0x2c379f(0x15d));}if(clearBtn)clearBtn[a0_0x2902a2(0x1b1)]=()=>{const _0x29ed43=a0_0x2902a2;if(!messages['length'])return;if(mTitle)mTitle[_0x29ed43(0x1c5)]=_0x29ed43(0x1c4);if(mText)mText['textContent']='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x31badb=_0x29ed43;messages=[],localStorage[_0x31badb(0x1be)](_0x31badb(0x177)),renderMessages(),callBackend(_0x31badb(0x1d0),{});},modal[_0x29ed43(0x168)][_0x29ed43(0x187)](_0x29ed43(0x15d));};document['getElementById'](a0_0x2902a2(0x17d))[a0_0x2902a2(0x1b1)]=()=>modal[a0_0x2902a2(0x168)][a0_0x2902a2(0x169)](a0_0x2902a2(0x15d)),document[a0_0x2902a2(0x1ba)](a0_0x2902a2(0x16a))[a0_0x2902a2(0x1b1)]=()=>{const _0x2814e7=a0_0x2902a2;if(modalCallback)modalCallback();modal[_0x2814e7(0x168)][_0x2814e7(0x169)](_0x2814e7(0x15d));},messageInput[a0_0x2902a2(0x1ac)](a0_0x2902a2(0x1d8),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x2902a2(0x193),_0x578ec5=>{const _0x22e44e=a0_0x2902a2;_0x578ec5[_0x22e44e(0x1ab)]===_0x22e44e(0x182)&&!_0x578ec5[_0x22e44e(0x18e)]&&(_0x578ec5['preventDefault'](),sendMessage());}),sendBtn[a0_0x2902a2(0x1b1)]=sendMessage,document[a0_0x2902a2(0x1ac)](a0_0x2902a2(0x18b),_0x16a309=>{const _0x1eb5c0=a0_0x2902a2;document['querySelectorAll'](_0x1eb5c0(0x197))['forEach'](_0x19472e=>{const _0x5b2421=_0x1eb5c0;if(!_0x19472e[_0x5b2421(0x18c)](_0x16a309[_0x5b2421(0x189)]))_0x19472e[_0x5b2421(0x168)][_0x5b2421(0x169)]('show-delete');});});function a0_0x5d60(){const _0x35a38a=['text','clear_history','function','modalTitle','TG\x20setup\x20error:','viewportChanged','div','style','typingIndicator','input','constructor','splice','show','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','1634608WWGtjV','message-bubble','timestamp','sendBtn','className','setItem','min','5xzpIdu','onEvent','classList','remove','modalConfirm','BackButton','debug_uid','resize','(((.+)+)+)+$','6.1','323058fBWlQi','message\x20ai','2204282aiNRCh','disableVerticalSwipes','value','confirmModal','clearBtn','ai_chat_messages','emptyState','username','role','innerHTML','appendChild','modalCancel','18139470QzqDCx','#050505','push','getMinutes','Enter','delete-btn','user','content','querySelector','add','send_message','target','disabled','click','contains','show-delete','shiftKey','isVersionAtLeast','medium','36TXtDnb','initDataUnsafe','keydown','search','trim','height','.message.show-delete','Ошибка\x20сервера','error','focus','Ошибка\x20сети','Пустой\x20ответ','message-time','<br>','impactOccurred','display','viewportHeight','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','touchstart','901586YojCFc','length','scrollTop','156lUzQIb','success','Удалить?','52636WKYdNt','key','addEventListener','onClick','forEach','HapticFeedback','json','onclick','now','innerHeight','notificationOccurred','toString','light','floor','6272094GpqxAE','WebApp','getElementById','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Действие\x20необратимо.','none','removeItem','paddingBottom','random','auto','getItem','initData','Очистить\x20историю?','textContent','offsetHeight','chatArea','scrollHeight','parse','getHours','message\x20','createElement','abort','signal'];a0_0x5d60=function(){return _0x35a38a;};return a0_0x5d60();}function a0_0x52ab(_0x4c803d,_0x35e430){_0x4c803d=_0x4c803d-0x15d;const _0x1a8a27=a0_0x5d60();let _0xf07e1a=_0x1a8a27[_0x4c803d];return _0xf07e1a;}const saved=localStorage[a0_0x2902a2(0x1c2)](a0_0x2902a2(0x177));if(saved)try{messages=JSON[a0_0x2902a2(0x1c9)](saved),renderMessages();}catch(a0_0x5be462){}updateSendButton();