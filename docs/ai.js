const a0_0x1424c7=a0_0x3981;(function(_0x5d8114,_0x4647fe){const _0x8a410b=a0_0x3981,_0x268658=_0x5d8114();while(!![]){try{const _0xa216e2=parseInt(_0x8a410b(0x124))/0x1*(-parseInt(_0x8a410b(0x10d))/0x2)+-parseInt(_0x8a410b(0x10b))/0x3+-parseInt(_0x8a410b(0x134))/0x4+parseInt(_0x8a410b(0x101))/0x5*(-parseInt(_0x8a410b(0x122))/0x6)+parseInt(_0x8a410b(0xf3))/0x7*(-parseInt(_0x8a410b(0xfb))/0x8)+parseInt(_0x8a410b(0xe9))/0x9+parseInt(_0x8a410b(0x117))/0xa;if(_0xa216e2===_0x4647fe)break;else _0x268658['push'](_0x268658['shift']());}catch(_0x5262b9){_0x268658['push'](_0x268658['shift']());}}}(a0_0x28c0,0xbe0e2));const tg=window[a0_0x1424c7(0xc8)]?.['WebApp'],HOME_URL=a0_0x1424c7(0xd8);function setupTelegramBackButton(){const _0xcb14cd=a0_0x1424c7,_0x3c3243=(function(){let _0x25b7c1=!![];return function(_0xa855c3,_0x53cd16){const _0x2a6a2c=_0x25b7c1?function(){if(_0x53cd16){const _0xc6be27=_0x53cd16['apply'](_0xa855c3,arguments);return _0x53cd16=null,_0xc6be27;}}:function(){};return _0x25b7c1=![],_0x2a6a2c;};}()),_0x5da0f6=_0x3c3243(this,function(){const _0x22befe=a0_0x3981;return _0x5da0f6['toString']()['search']('(((.+)+)+)+$')['toString']()[_0x22befe(0x13e)](_0x5da0f6)[_0x22befe(0x12f)](_0x22befe(0xcc));});_0x5da0f6();if(!tg)return;try{tg[_0xcb14cd(0xeb)](),tg[_0xcb14cd(0xe3)](),tg['setHeaderColor']?.(_0xcb14cd(0x13f));if(tg[_0xcb14cd(0xfd)]?.(_0xcb14cd(0xd4)))tg[_0xcb14cd(0xdb)]?.();const _0x3c83b7=tg[_0xcb14cd(0x116)];if(_0x3c83b7){_0x3c83b7[_0xcb14cd(0xf1)]();if(typeof _0x3c83b7['offClick']==='function')try{_0x3c83b7[_0xcb14cd(0x136)]();}catch(_0x13e4af){}_0x3c83b7[_0xcb14cd(0xe0)](()=>{const _0x2aea05=_0xcb14cd;if(tg['HapticFeedback'])tg['HapticFeedback'][_0x2aea05(0xea)](_0x2aea05(0xe8));location[_0x2aea05(0x109)]=HOME_URL;});}}catch(_0xd07dd1){console[_0xcb14cd(0xd7)](_0xcb14cd(0xd2),_0xd07dd1);}}(function initStableLayout(){const _0x39a6e8=a0_0x1424c7,_0x52bac7=document[_0x39a6e8(0x11a)]('.container'),_0x556345=document['getElementById']('inputArea'),_0x4d6c85=document['getElementById']('chatArea'),_0x4ce3e5=document[_0x39a6e8(0x112)](_0x39a6e8(0x13a));function _0x39773c(){const _0x45103d=_0x39a6e8;if(!_0x52bac7)return;const _0x4906ac=tg&&tg[_0x45103d(0x12d)]?tg[_0x45103d(0x12d)]:window[_0x45103d(0xf0)];_0x52bac7[_0x45103d(0xcf)]['height']=_0x4906ac+'px';if(_0x556345){const _0x2e737a=_0x556345[_0x45103d(0x13c)];_0x4d6c85[_0x45103d(0xcf)][_0x45103d(0x102)]=_0x2e737a+0x28+'px';}}tg?tg['onEvent'](_0x39a6e8(0xc3),({isStateStable:_0x1ecee2})=>{_0x39773c();if(_0x1ecee2)requestAnimationFrame(()=>{const _0x12ae5e=a0_0x3981;_0x4d6c85[_0x12ae5e(0x118)]=_0x4d6c85['scrollHeight'];});}):window[_0x39a6e8(0xed)](_0x39a6e8(0xdc),_0x39773c),_0x39773c(),_0x4ce3e5&&(_0x4ce3e5[_0x39a6e8(0xed)]('input',()=>{requestAnimationFrame(_0x39773c);}),_0x4ce3e5['addEventListener']('focus',()=>{setTimeout(()=>{const _0x1a7a74=a0_0x3981;_0x4d6c85[_0x1a7a74(0x118)]=_0x4d6c85[_0x1a7a74(0x129)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x1424c7(0xc4)),emptyState=document[a0_0x1424c7(0x112)]('emptyState'),messageInput=document['getElementById'](a0_0x1424c7(0x13a)),sendBtn=document[a0_0x1424c7(0x112)](a0_0x1424c7(0x11e)),clearBtn=document[a0_0x1424c7(0x112)](a0_0x1424c7(0xf2)),modal=document[a0_0x1424c7(0x112)]('confirmModal'),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x1424c7(0x112)](a0_0x1424c7(0x10a));function a0_0x28c0(){const _0x342a0c=['auto','scrollHeight','length','key','message-time','viewportHeight','clear_history','search','splice','show-delete','.message.show-delete','success','3648272ZZWSZX','now','offClick','emptyState','random','notificationOccurred','messageInput','Удалить?','offsetHeight','touchstart','constructor','#050505','Ошибка\x20сервера','removeItem','text','innerHTML','Пустой\x20ответ','initData','Enter','content','message\x20','viewportChanged','chatArea','signal','touchend','username','Telegram','none','parse','medium','(((.+)+)+)+$','height','target','style','stringify','getMinutes','TG\x20setup\x20error:','message-bubble','6.1','display','querySelectorAll','warn','./router.html','role','keydown','disableVerticalSwipes','resize','setItem','Ошибка\x20сети','Действие\x20необратимо.','onClick','createElement','stopPropagation','expand','click','textContent','div','replace','light','12614832wrRUOh','impactOccurred','ready','first_name','addEventListener','children','getItem','innerHeight','show','clearBtn','4700598rvmcKK','push','className','contains','floor','appendChild','message\x20ai','forEach','16vPnbjI','abort','isVersionAtLeast','padStart','POST','delete-btn','660ANMpov','paddingBottom','getHours','json','Начнется\x20новый\x20диалог.','Очистить\x20историю?','disabled','shiftKey','href','modalText','2526273aHGrcz','trim','1582UuymKu','debug_uid','ai_chat_messages','<br>','add','getElementById','remove','value','input','BackButton','30398700VOFOEC','scrollTop','user','querySelector','send_message','typingIndicator','onclick','sendBtn','modalCancel','HapticFeedback','error','6054HBeybl','classList','547hJTPJY','modalConfirm','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','min'];a0_0x28c0=function(){return _0x342a0c;};return a0_0x28c0();}let modalCallback=null;async function callBackend(_0x1e297e,_0x52ad2d){const _0x541dcb=a0_0x1424c7,_0x2d8de2=tg?.['initDataUnsafe']?.['user']||{},_0x3e7501=_0x2d8de2['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x541dcb(0xf7)](Math[_0x541dcb(0x138)]()*0x3b9aca00);if(!_0x2d8de2['id'])localStorage['setItem'](_0x541dcb(0x10e),_0x3e7501);const _0x1f8b32={'action':_0x1e297e,'user_id':_0x3e7501,'user_data':{'first_name':_0x2d8de2[_0x541dcb(0xec)],'username':_0x2d8de2[_0x541dcb(0xc7)]},'init_data':tg?.[_0x541dcb(0x145)]||'',..._0x52ad2d},_0x394012=new AbortController(),_0x19f1ca=setTimeout(()=>_0x394012[_0x541dcb(0xfc)](),REQUEST_TIMEOUT_MS);try{const _0xf39ea=await fetch(BACKEND_URL,{'method':_0x541dcb(0xff),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x541dcb(0xd0)](_0x1f8b32),'signal':_0x394012[_0x541dcb(0xc5)]});return clearTimeout(_0x19f1ca),await _0xf39ea[_0x541dcb(0x104)]();}catch(_0x54745c){return{'success':![],'error':String(_0x54745c)};}}function a0_0x3981(_0x4648f4,_0x597fae){_0x4648f4=_0x4648f4-0xc3;const _0x4fe35b=a0_0x28c0();let _0x523730=_0x4fe35b[_0x4648f4];return _0x523730;}function formatTime(_0x44b143){const _0x39d81e=a0_0x1424c7,_0x3aa605=new Date(_0x44b143);return String(_0x3aa605[_0x39d81e(0x103)]())[_0x39d81e(0xfe)](0x2,'0')+':'+String(_0x3aa605[_0x39d81e(0xd1)]())[_0x39d81e(0xfe)](0x2,'0');}function createMessageElement(_0x1247ba,_0x5571d6){const _0xeb3ab9=a0_0x1424c7,_0x228837=document[_0xeb3ab9(0xe1)]('div');_0x228837[_0xeb3ab9(0xf5)]=_0xeb3ab9(0x148)+_0x1247ba[_0xeb3ab9(0xd9)];const _0x1873f4=document[_0xeb3ab9(0xe1)]('div');_0x1873f4[_0xeb3ab9(0xf5)]=_0xeb3ab9(0xd3),_0x1873f4['innerHTML']=_0x1247ba[_0xeb3ab9(0x147)][_0xeb3ab9(0xe7)](/\n/g,_0xeb3ab9(0x110));const _0x5d9421=document[_0xeb3ab9(0xe1)](_0xeb3ab9(0xe6));_0x5d9421[_0xeb3ab9(0xf5)]=_0xeb3ab9(0x100),_0x5d9421[_0xeb3ab9(0x143)]=_0xeb3ab9(0x126),_0x5d9421[_0xeb3ab9(0x11d)]=_0x33697d=>{const _0x125c17=_0xeb3ab9;_0x33697d[_0x125c17(0xe2)](),confirmDelete(_0x5571d6);};let _0x56da2a;_0x1873f4[_0xeb3ab9(0xed)](_0xeb3ab9(0x13d),()=>_0x56da2a=setTimeout(()=>{const _0x5d0328=_0xeb3ab9;_0x228837[_0x5d0328(0x123)][_0x5d0328(0x111)](_0x5d0328(0x131));if(tg?.['HapticFeedback'])tg[_0x5d0328(0x120)]['impactOccurred'](_0x5d0328(0xcb));},0x1f4)),_0x1873f4[_0xeb3ab9(0xed)](_0xeb3ab9(0xc6),()=>clearTimeout(_0x56da2a));const _0x41df8f=document[_0xeb3ab9(0xe1)](_0xeb3ab9(0xe6));return _0x41df8f[_0xeb3ab9(0xf5)]=_0xeb3ab9(0x12c),_0x41df8f[_0xeb3ab9(0xe5)]=formatTime(_0x1247ba['timestamp']),_0x228837['appendChild'](_0x5d9421),_0x228837[_0xeb3ab9(0xf8)](_0x1873f4),_0x228837[_0xeb3ab9(0xf8)](_0x41df8f),_0x228837;}function createTypingIndicator(){const _0x529380=a0_0x1424c7,_0x3e3921=document[_0x529380(0xe1)](_0x529380(0xe6));return _0x3e3921[_0x529380(0xf5)]=_0x529380(0xf9),_0x3e3921['id']=_0x529380(0x11c),_0x3e3921[_0x529380(0x143)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x3e3921;}function renderMessages(){const _0x207d4f=a0_0x1424c7;Array['from'](chatArea[_0x207d4f(0xee)])[_0x207d4f(0xfa)](_0x1cf6cc=>{const _0x288525=_0x207d4f;if(_0x1cf6cc['id']!==_0x288525(0x137))_0x1cf6cc[_0x288525(0x113)]();}),messages[_0x207d4f(0x12a)]>0x0?(emptyState[_0x207d4f(0xcf)][_0x207d4f(0xd5)]=_0x207d4f(0xc9),messages[_0x207d4f(0xfa)]((_0x32cf22,_0x468a15)=>chatArea[_0x207d4f(0xf8)](createMessageElement(_0x32cf22,_0x468a15)))):emptyState['style']['display']='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x207d4f(0x129)]);}function autoResizeTextarea(){const _0x5e6e8d=a0_0x1424c7;messageInput[_0x5e6e8d(0xcf)][_0x5e6e8d(0xcd)]=_0x5e6e8d(0x128),messageInput[_0x5e6e8d(0xcf)][_0x5e6e8d(0xcd)]=Math[_0x5e6e8d(0x127)](messageInput[_0x5e6e8d(0x129)],0x78)+'px';}function updateSendButton(){const _0x31cf8a=a0_0x1424c7,_0x531e33=messageInput[_0x31cf8a(0x114)]['trim']();sendBtn[_0x31cf8a(0x107)]=!_0x531e33||isTyping;}async function sendMessage(){const _0x4d38a7=a0_0x1424c7,_0x23404e=messageInput[_0x4d38a7(0x114)][_0x4d38a7(0x10c)]();if(!_0x23404e||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x4d38a7(0xea)](_0x4d38a7(0xe8));messages['push']({'role':_0x4d38a7(0x119),'content':_0x23404e,'timestamp':Date[_0x4d38a7(0x135)]()}),localStorage[_0x4d38a7(0xdd)](_0x4d38a7(0x10f),JSON[_0x4d38a7(0xd0)](messages)),renderMessages(),messageInput[_0x4d38a7(0x114)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4d38a7(0xf8)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x28635b=await callBackend(_0x4d38a7(0x11b),{'message':_0x23404e});isTyping=![];const _0x35e97b=document[_0x4d38a7(0x112)](_0x4d38a7(0x11c));if(_0x35e97b)_0x35e97b[_0x4d38a7(0x113)]();let _0x4b109c=_0x4d38a7(0xde);if(_0x28635b['success']){_0x4b109c=_0x28635b[_0x4d38a7(0x142)]||_0x4d38a7(0x144);if(tg?.[_0x4d38a7(0x120)])tg[_0x4d38a7(0x120)][_0x4d38a7(0x139)](_0x4d38a7(0x133));}else{_0x4b109c=_0x28635b['error']||_0x4d38a7(0x140);if(tg?.[_0x4d38a7(0x120)])tg[_0x4d38a7(0x120)]['notificationOccurred'](_0x4d38a7(0x121));}messages[_0x4d38a7(0xf4)]({'role':'ai','content':_0x4b109c,'timestamp':Date['now']()}),localStorage['setItem'](_0x4d38a7(0x10f),JSON[_0x4d38a7(0xd0)](messages)),renderMessages();}function confirmDelete(_0x122c4d){const _0x3f3fdf=a0_0x1424c7;if(mTitle)mTitle[_0x3f3fdf(0xe5)]=_0x3f3fdf(0x13b);if(mText)mText[_0x3f3fdf(0xe5)]=_0x3f3fdf(0xdf);modalCallback=()=>{const _0x1d8ef9=_0x3f3fdf;messages[_0x1d8ef9(0x130)](_0x122c4d,0x1),localStorage[_0x1d8ef9(0xdd)](_0x1d8ef9(0x10f),JSON[_0x1d8ef9(0xd0)](messages)),renderMessages();},modal['classList']['add'](_0x3f3fdf(0xf1));}if(clearBtn)clearBtn[a0_0x1424c7(0x11d)]=()=>{const _0x17f999=a0_0x1424c7;if(!messages['length'])return;if(mTitle)mTitle[_0x17f999(0xe5)]=_0x17f999(0x106);if(mText)mText[_0x17f999(0xe5)]=_0x17f999(0x105);modalCallback=async()=>{const _0x98fa7a=_0x17f999;messages=[],localStorage[_0x98fa7a(0x141)](_0x98fa7a(0x10f)),renderMessages(),callBackend(_0x98fa7a(0x12e),{});},modal[_0x17f999(0x123)]['add'](_0x17f999(0xf1));};document[a0_0x1424c7(0x112)](a0_0x1424c7(0x11f))[a0_0x1424c7(0x11d)]=()=>modal[a0_0x1424c7(0x123)]['remove'](a0_0x1424c7(0xf1)),document[a0_0x1424c7(0x112)](a0_0x1424c7(0x125))[a0_0x1424c7(0x11d)]=()=>{const _0x4f5c1e=a0_0x1424c7;if(modalCallback)modalCallback();modal[_0x4f5c1e(0x123)][_0x4f5c1e(0x113)]('show');},messageInput['addEventListener'](a0_0x1424c7(0x115),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1424c7(0xed)](a0_0x1424c7(0xda),_0x38893f=>{const _0x38aad7=a0_0x1424c7;_0x38893f[_0x38aad7(0x12b)]===_0x38aad7(0x146)&&!_0x38893f[_0x38aad7(0x108)]&&(_0x38893f['preventDefault'](),sendMessage());}),sendBtn[a0_0x1424c7(0x11d)]=sendMessage,document[a0_0x1424c7(0xed)](a0_0x1424c7(0xe4),_0x1f35d9=>{const _0x33d979=a0_0x1424c7;document[_0x33d979(0xd6)](_0x33d979(0x132))[_0x33d979(0xfa)](_0xc02bb9=>{const _0x5a7690=_0x33d979;if(!_0xc02bb9[_0x5a7690(0xf6)](_0x1f35d9[_0x5a7690(0xce)]))_0xc02bb9['classList']['remove'](_0x5a7690(0x131));});});const saved=localStorage[a0_0x1424c7(0xef)](a0_0x1424c7(0x10f));if(saved)try{messages=JSON[a0_0x1424c7(0xca)](saved),renderMessages();}catch(a0_0x2ee81c){}updateSendButton();