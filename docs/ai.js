const a0_0x3a60fa=a0_0x5bdd;(function(_0x1b231f,_0x992d84){const _0x4d8311=a0_0x5bdd,_0x3ba79e=_0x1b231f();while(!![]){try{const _0x426d3e=parseInt(_0x4d8311(0x1f7))/0x1+parseInt(_0x4d8311(0x1d9))/0x2*(-parseInt(_0x4d8311(0x198))/0x3)+parseInt(_0x4d8311(0x1fd))/0x4+-parseInt(_0x4d8311(0x188))/0x5*(parseInt(_0x4d8311(0x191))/0x6)+parseInt(_0x4d8311(0x1fa))/0x7*(parseInt(_0x4d8311(0x1b1))/0x8)+-parseInt(_0x4d8311(0x1be))/0x9*(parseInt(_0x4d8311(0x1f6))/0xa)+parseInt(_0x4d8311(0x1a4))/0xb;if(_0x426d3e===_0x992d84)break;else _0x3ba79e['push'](_0x3ba79e['shift']());}catch(_0x28b6df){_0x3ba79e['push'](_0x3ba79e['shift']());}}}(a0_0x40f2,0x5ca4b));const tg=window[a0_0x3a60fa(0x19a)]?.[a0_0x3a60fa(0x1bf)],HOME_URL=a0_0x3a60fa(0x1e2);function setupTelegramBackButton(){const _0x5a0c80=a0_0x3a60fa,_0x3b8aa2=(function(){let _0x4288da=!![];return function(_0x2f7e34,_0x348187){const _0x96f0d6=_0x4288da?function(){const _0x578b91=a0_0x5bdd;if(_0x348187){const _0x12df6c=_0x348187[_0x578b91(0x189)](_0x2f7e34,arguments);return _0x348187=null,_0x12df6c;}}:function(){};return _0x4288da=![],_0x96f0d6;};}()),_0x41260e=_0x3b8aa2(this,function(){const _0x2c5900=a0_0x5bdd;return _0x41260e[_0x2c5900(0x200)]()[_0x2c5900(0x1c1)](_0x2c5900(0x1ef))['toString']()[_0x2c5900(0x1dc)](_0x41260e)['search'](_0x2c5900(0x1ef));});_0x41260e();if(!tg)return;try{tg[_0x5a0c80(0x1b7)](),tg[_0x5a0c80(0x1f4)](),tg['setHeaderColor']?.(_0x5a0c80(0x1c9));if(tg[_0x5a0c80(0x1fc)]?.(_0x5a0c80(0x1ec)))tg[_0x5a0c80(0x1d2)]?.();const _0x3d029b=tg[_0x5a0c80(0x1c0)];if(_0x3d029b){_0x3d029b['show']();if(typeof _0x3d029b[_0x5a0c80(0x1b4)]===_0x5a0c80(0x197))try{_0x3d029b[_0x5a0c80(0x1b4)]();}catch(_0x3f869d){}_0x3d029b[_0x5a0c80(0x19d)](()=>{const _0x412942=_0x5a0c80;if(tg[_0x412942(0x1f2)])tg[_0x412942(0x1f2)][_0x412942(0x1ac)](_0x412942(0x1ce));location['href']=HOME_URL;});}}catch(_0x523bb7){console[_0x5a0c80(0x1c4)](_0x5a0c80(0x1b9),_0x523bb7);}}(function initStableLayout(){const _0x553f33=a0_0x3a60fa,_0x1e0ad6=document['querySelector'](_0x553f33(0x1c2)),_0xca0a42=document['getElementById']('inputArea'),_0x31d191=document[_0x553f33(0x18a)](_0x553f33(0x1d1)),_0x5423df=document[_0x553f33(0x18a)]('messageInput');function _0x350bbd(){const _0x2bd84f=_0x553f33;if(!_0x1e0ad6)return;const _0x230299=tg&&tg[_0x2bd84f(0x199)]?tg[_0x2bd84f(0x199)]:window[_0x2bd84f(0x193)];_0x1e0ad6['style'][_0x2bd84f(0x1da)]=_0x230299+'px';if(_0xca0a42){const _0x581244=_0xca0a42[_0x2bd84f(0x1f3)];_0x31d191[_0x2bd84f(0x1fb)][_0x2bd84f(0x1d8)]=_0x581244+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0xbc5020})=>{_0x350bbd();if(_0xbc5020)requestAnimationFrame(()=>{_0x31d191['scrollTop']=_0x31d191['scrollHeight'];});}):window['addEventListener'](_0x553f33(0x1e3),_0x350bbd),_0x350bbd(),_0x5423df&&(_0x5423df[_0x553f33(0x1cd)](_0x553f33(0x1a5),()=>{requestAnimationFrame(_0x350bbd);}),_0x5423df[_0x553f33(0x1cd)]('focus',()=>{setTimeout(()=>{const _0x4ede02=a0_0x5bdd;_0x31d191[_0x4ede02(0x1d6)]=_0x31d191['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x3a60fa(0x1d1)),emptyState=document[a0_0x3a60fa(0x18a)](a0_0x3a60fa(0x195)),messageInput=document[a0_0x3a60fa(0x18a)](a0_0x3a60fa(0x1df)),sendBtn=document['getElementById'](a0_0x3a60fa(0x1a3)),clearBtn=document['getElementById'](a0_0x3a60fa(0x204)),modal=document[a0_0x3a60fa(0x18a)](a0_0x3a60fa(0x1b2)),mTitle=document[a0_0x3a60fa(0x18a)](a0_0x3a60fa(0x1f8)),mText=document['getElementById'](a0_0x3a60fa(0x1b8));let modalCallback=null;async function callBackend(_0x41fb2a,_0x4fba37){const _0x1595ef=a0_0x3a60fa,_0x436899=tg?.[_0x1595ef(0x1db)]?.[_0x1595ef(0x203)]||{},_0x17a468=_0x436899['id']||localStorage[_0x1595ef(0x1d0)](_0x1595ef(0x1e5))||'d-'+Math[_0x1595ef(0x192)](Math[_0x1595ef(0x19f)]()*0x3b9aca00);if(!_0x436899['id'])localStorage[_0x1595ef(0x1cf)](_0x1595ef(0x1e5),_0x17a468);const _0x510042={'action':_0x41fb2a,'user_id':_0x17a468,'user_data':{'first_name':_0x436899[_0x1595ef(0x1c6)],'username':_0x436899[_0x1595ef(0x1ed)]},'init_data':tg?.['initData']||'',..._0x4fba37},_0x428ef8=new AbortController(),_0x261a54=setTimeout(()=>_0x428ef8['abort'](),REQUEST_TIMEOUT_MS);try{const _0x300344=await fetch(BACKEND_URL,{'method':_0x1595ef(0x1d7),'headers':{'Content-Type':_0x1595ef(0x1f1)},'body':JSON['stringify'](_0x510042),'signal':_0x428ef8['signal']});return clearTimeout(_0x261a54),await _0x300344['json']();}catch(_0x11388f){return{'success':![],'error':String(_0x11388f)};}}function formatTime(_0x1277c8){const _0x26a1f4=a0_0x3a60fa,_0x47bd01=new Date(_0x1277c8);return String(_0x47bd01['getHours']())[_0x26a1f4(0x196)](0x2,'0')+':'+String(_0x47bd01[_0x26a1f4(0x1cb)]())[_0x26a1f4(0x196)](0x2,'0');}function createMessageElement(_0x10b5c4,_0x2e337f){const _0x12c76c=a0_0x3a60fa,_0x52f029=document[_0x12c76c(0x1a1)](_0x12c76c(0x1ba));_0x52f029[_0x12c76c(0x1ab)]=_0x12c76c(0x1e7)+_0x10b5c4[_0x12c76c(0x1e1)];const _0x3c9ed6=document[_0x12c76c(0x1a1)]('div');_0x3c9ed6[_0x12c76c(0x1ab)]=_0x12c76c(0x1b3),_0x3c9ed6['innerHTML']=_0x10b5c4[_0x12c76c(0x1fe)][_0x12c76c(0x1c3)](/\n/g,_0x12c76c(0x1e0));const _0x282fc9=document['createElement'](_0x12c76c(0x1ba));_0x282fc9['className']=_0x12c76c(0x201),_0x282fc9[_0x12c76c(0x1f0)]=_0x12c76c(0x18e),_0x282fc9[_0x12c76c(0x1bc)]=_0x1a65de=>{const _0x182c33=_0x12c76c;_0x1a65de[_0x182c33(0x18d)](),confirmDelete(_0x2e337f);};let _0x3124d5;_0x3c9ed6['addEventListener'](_0x12c76c(0x1dd),()=>_0x3124d5=setTimeout(()=>{const _0x4dcbfc=_0x12c76c;_0x52f029[_0x4dcbfc(0x1aa)][_0x4dcbfc(0x1ea)](_0x4dcbfc(0x1cc));if(tg?.['HapticFeedback'])tg[_0x4dcbfc(0x1f2)][_0x4dcbfc(0x1ac)](_0x4dcbfc(0x187));},0x1f4)),_0x3c9ed6['addEventListener'](_0x12c76c(0x18b),()=>clearTimeout(_0x3124d5));const _0x3bf707=document[_0x12c76c(0x1a1)](_0x12c76c(0x1ba));return _0x3bf707[_0x12c76c(0x1ab)]=_0x12c76c(0x1c8),_0x3bf707[_0x12c76c(0x1f9)]=formatTime(_0x10b5c4[_0x12c76c(0x19b)]),_0x52f029['appendChild'](_0x282fc9),_0x52f029[_0x12c76c(0x1e4)](_0x3c9ed6),_0x52f029['appendChild'](_0x3bf707),_0x52f029;}function a0_0x5bdd(_0x57181b,_0x213f89){_0x57181b=_0x57181b-0x187;const _0x389648=a0_0x40f2();let _0x53d674=_0x389648[_0x57181b];return _0x53d674;}function createTypingIndicator(){const _0x2585e3=a0_0x3a60fa,_0x2079af=document[_0x2585e3(0x1a1)](_0x2585e3(0x1ba));return _0x2079af[_0x2585e3(0x1ab)]=_0x2585e3(0x1ee),_0x2079af['id']=_0x2585e3(0x1b0),_0x2079af[_0x2585e3(0x1f0)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x2079af;}function renderMessages(){const _0x601689=a0_0x3a60fa;Array[_0x601689(0x1f5)](chatArea[_0x601689(0x1a7)])['forEach'](_0x6100a8=>{const _0x5a7aac=_0x601689;if(_0x6100a8['id']!==_0x5a7aac(0x195))_0x6100a8[_0x5a7aac(0x1c7)]();}),messages['length']>0x0?(emptyState[_0x601689(0x1fb)]['display']='none',messages[_0x601689(0x1a2)]((_0x280ad2,_0x465647)=>chatArea[_0x601689(0x1e4)](createMessageElement(_0x280ad2,_0x465647)))):emptyState[_0x601689(0x1fb)][_0x601689(0x1ff)]=_0x601689(0x1af),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x601689(0x1ae)]);}function autoResizeTextarea(){const _0x3a1002=a0_0x3a60fa;messageInput[_0x3a1002(0x1fb)][_0x3a1002(0x1da)]=_0x3a1002(0x19e),messageInput[_0x3a1002(0x1fb)]['height']=Math['min'](messageInput[_0x3a1002(0x1ae)],0x78)+'px';}function updateSendButton(){const _0x39dab1=a0_0x3a60fa,_0x58c40f=messageInput[_0x39dab1(0x1ad)]['trim']();sendBtn[_0x39dab1(0x1ca)]=!_0x58c40f||isTyping;}async function sendMessage(){const _0x2efeff=a0_0x3a60fa,_0x763748=messageInput[_0x2efeff(0x1ad)][_0x2efeff(0x1bb)]();if(!_0x763748||isTyping)return;if(tg?.[_0x2efeff(0x1f2)])tg[_0x2efeff(0x1f2)][_0x2efeff(0x1ac)]('light');messages[_0x2efeff(0x1a8)]({'role':_0x2efeff(0x203),'content':_0x763748,'timestamp':Date[_0x2efeff(0x1a6)]()}),localStorage[_0x2efeff(0x1cf)](_0x2efeff(0x1b6),JSON[_0x2efeff(0x1e8)](messages)),renderMessages(),messageInput[_0x2efeff(0x1ad)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2efeff(0x1e4)](createTypingIndicator()),chatArea[_0x2efeff(0x1d6)]=chatArea['scrollHeight'];const _0x2574a4=await callBackend('send_message',{'message':_0x763748});isTyping=![];const _0x5c23c9=document['getElementById'](_0x2efeff(0x1b0));if(_0x5c23c9)_0x5c23c9[_0x2efeff(0x1c7)]();let _0x219910=_0x2efeff(0x1bd);if(_0x2574a4['success']){_0x219910=_0x2574a4['text']||_0x2efeff(0x1a0);if(tg?.[_0x2efeff(0x1f2)])tg[_0x2efeff(0x1f2)][_0x2efeff(0x18c)](_0x2efeff(0x202));}else{_0x219910=_0x2574a4[_0x2efeff(0x194)]||_0x2efeff(0x190);if(tg?.[_0x2efeff(0x1f2)])tg['HapticFeedback'][_0x2efeff(0x18c)](_0x2efeff(0x194));}messages[_0x2efeff(0x1a8)]({'role':'ai','content':_0x219910,'timestamp':Date[_0x2efeff(0x1a6)]()}),localStorage[_0x2efeff(0x1cf)](_0x2efeff(0x1b6),JSON[_0x2efeff(0x1e8)](messages)),renderMessages();}function confirmDelete(_0x371628){const _0x53f462=a0_0x3a60fa;if(mTitle)mTitle[_0x53f462(0x1f9)]='Удалить?';if(mText)mText[_0x53f462(0x1f9)]=_0x53f462(0x1e9);modalCallback=()=>{const _0x16c886=_0x53f462;messages[_0x16c886(0x18f)](_0x371628,0x1),localStorage[_0x16c886(0x1cf)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x53f462(0x1aa)][_0x53f462(0x1ea)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0x1a9037=a0_0x3a60fa;if(!messages['length'])return;if(mTitle)mTitle[_0x1a9037(0x1f9)]=_0x1a9037(0x1d4);if(mText)mText[_0x1a9037(0x1f9)]=_0x1a9037(0x1de);modalCallback=async()=>{const _0x2cceda=_0x1a9037;messages=[],localStorage['removeItem'](_0x2cceda(0x1b6)),renderMessages(),callBackend(_0x2cceda(0x1d3),{});},modal['classList'][_0x1a9037(0x1ea)](_0x1a9037(0x1eb));};document[a0_0x3a60fa(0x18a)]('modalCancel')[a0_0x3a60fa(0x1bc)]=()=>modal['classList'][a0_0x3a60fa(0x1c7)](a0_0x3a60fa(0x1eb)),document[a0_0x3a60fa(0x18a)]('modalConfirm')[a0_0x3a60fa(0x1bc)]=()=>{const _0x2a5883=a0_0x3a60fa;if(modalCallback)modalCallback();modal[_0x2a5883(0x1aa)][_0x2a5883(0x1c7)](_0x2a5883(0x1eb));},messageInput[a0_0x3a60fa(0x1cd)](a0_0x3a60fa(0x1a5),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3a60fa(0x1cd)]('keydown',_0x43ef8b=>{const _0x5d60cd=a0_0x3a60fa;_0x43ef8b['key']===_0x5d60cd(0x1c5)&&!_0x43ef8b['shiftKey']&&(_0x43ef8b['preventDefault'](),sendMessage());}),sendBtn[a0_0x3a60fa(0x1bc)]=sendMessage,document[a0_0x3a60fa(0x1cd)](a0_0x3a60fa(0x1d5),_0x4fcc4e=>{const _0x5d11d5=a0_0x3a60fa;document[_0x5d11d5(0x1b5)](_0x5d11d5(0x1a9))['forEach'](_0xe32bf5=>{const _0x27aabd=_0x5d11d5;if(!_0xe32bf5[_0x27aabd(0x1e6)](_0x4fcc4e['target']))_0xe32bf5[_0x27aabd(0x1aa)][_0x27aabd(0x1c7)](_0x27aabd(0x1cc));});});const saved=localStorage[a0_0x3a60fa(0x1d0)](a0_0x3a60fa(0x1b6));function a0_0x40f2(){const _0xd7bfd1=['div','trim','onclick','Ошибка\x20сети','99ERCvvP','WebApp','BackButton','search','.container','replace','warn','Enter','first_name','remove','message-time','#050505','disabled','getMinutes','show-delete','addEventListener','light','setItem','getItem','chatArea','disableVerticalSwipes','clear_history','Очистить\x20историю?','click','scrollTop','POST','paddingBottom','2BmwOsM','height','initDataUnsafe','constructor','touchstart','Начнется\x20новый\x20диалог.','messageInput','<br>','role','./router.html','resize','appendChild','debug_uid','contains','message\x20','stringify','Действие\x20необратимо.','add','show','6.1','username','message\x20ai','(((.+)+)+)+$','innerHTML','text/plain','HapticFeedback','offsetHeight','expand','from','386290hDnNbl','269483CuAhUl','modalTitle','textContent','466753yRIaLh','style','isVersionAtLeast','2362856uNWoDG','content','display','toString','delete-btn','success','user','clearBtn','medium','27595UvvtNA','apply','getElementById','touchend','notificationOccurred','stopPropagation','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','splice','Ошибка\x20сервера','12GJUvxg','floor','innerHeight','error','emptyState','padStart','function','424155YNHleH','viewportHeight','Telegram','timestamp','parse','onClick','auto','random','Пустой\x20ответ','createElement','forEach','sendBtn','329263LvEMJX','input','now','children','push','.message.show-delete','classList','className','impactOccurred','value','scrollHeight','flex','typingIndicator','8vriHly','confirmModal','message-bubble','offClick','querySelectorAll','ai_chat_messages','ready','modalText','TG\x20setup\x20error:'];a0_0x40f2=function(){return _0xd7bfd1;};return a0_0x40f2();}if(saved)try{messages=JSON[a0_0x3a60fa(0x19c)](saved),renderMessages();}catch(a0_0x58e57e){}updateSendButton();