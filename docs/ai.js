const a0_0x1333c9=a0_0x46c4;(function(_0x2d9cfd,_0x1f288e){const _0x23c970=a0_0x46c4,_0x40a31b=_0x2d9cfd();while(!![]){try{const _0x576cae=parseInt(_0x23c970(0x210))/0x1*(parseInt(_0x23c970(0x221))/0x2)+-parseInt(_0x23c970(0x1c2))/0x3*(-parseInt(_0x23c970(0x1bf))/0x4)+parseInt(_0x23c970(0x1d2))/0x5*(-parseInt(_0x23c970(0x1d3))/0x6)+-parseInt(_0x23c970(0x1f1))/0x7*(-parseInt(_0x23c970(0x1c3))/0x8)+-parseInt(_0x23c970(0x22a))/0x9+-parseInt(_0x23c970(0x1c7))/0xa*(parseInt(_0x23c970(0x212))/0xb)+parseInt(_0x23c970(0x20a))/0xc;if(_0x576cae===_0x1f288e)break;else _0x40a31b['push'](_0x40a31b['shift']());}catch(_0x5b3544){_0x40a31b['push'](_0x40a31b['shift']());}}}(a0_0x241b,0x5a1ce));const tg=window['Telegram']?.[a0_0x1333c9(0x205)],HOME_URL=a0_0x1333c9(0x226);function setupTelegramBackButton(){const _0x286a1b=a0_0x1333c9;if(!tg)return;try{tg[_0x286a1b(0x1cc)](),tg[_0x286a1b(0x203)](),tg[_0x286a1b(0x1b7)]?.(_0x286a1b(0x1d9));if(tg[_0x286a1b(0x237)]?.(_0x286a1b(0x1e5)))tg[_0x286a1b(0x1b9)]?.();const _0x805d84=tg[_0x286a1b(0x1cd)];if(_0x805d84){_0x805d84['show']();if(typeof _0x805d84[_0x286a1b(0x1e6)]===_0x286a1b(0x236))try{_0x805d84[_0x286a1b(0x1e6)]();}catch(_0x41821f){}_0x805d84[_0x286a1b(0x1f0)](()=>{const _0x4061da=_0x286a1b;if(tg['HapticFeedback'])tg[_0x4061da(0x232)][_0x4061da(0x207)](_0x4061da(0x20f));location[_0x4061da(0x1c0)]=HOME_URL;});}}catch(_0x54190b){console[_0x286a1b(0x1eb)](_0x286a1b(0x23a),_0x54190b);}}(function initStableLayout(){const _0x4bf40f=a0_0x1333c9,_0x2fe23d=(function(){let _0x5c0e84=!![];return function(_0x210eb6,_0x50370b){const _0x3fd39d=_0x5c0e84?function(){const _0x45aad1=a0_0x46c4;if(_0x50370b){const _0x495c85=_0x50370b[_0x45aad1(0x223)](_0x210eb6,arguments);return _0x50370b=null,_0x495c85;}}:function(){};return _0x5c0e84=![],_0x3fd39d;};}()),_0x26db0b=document['querySelector'](_0x4bf40f(0x20d)),_0xe5676c=document[_0x4bf40f(0x1cf)](_0x4bf40f(0x1df)),_0x45084c=document['getElementById'](_0x4bf40f(0x202)),_0x61cfe8=document[_0x4bf40f(0x1cf)]('messageInput');function _0x25d4bc(){const _0xa911ad=_0x4bf40f,_0x209971=_0x2fe23d(this,function(){const _0x863ff9=a0_0x46c4;return _0x209971[_0x863ff9(0x201)]()['search']('(((.+)+)+)+$')[_0x863ff9(0x201)]()[_0x863ff9(0x235)](_0x209971)[_0x863ff9(0x1fe)](_0x863ff9(0x1f4));});_0x209971();if(!_0x26db0b)return;const _0x3c87d0=tg&&tg['viewportHeight']?tg['viewportHeight']:window['innerHeight'];_0x26db0b[_0xa911ad(0x1c9)][_0xa911ad(0x1ff)]=_0x3c87d0+'px';if(_0xe5676c){const _0x24f085=_0xe5676c[_0xa911ad(0x1fa)];_0x45084c[_0xa911ad(0x1c9)][_0xa911ad(0x1fc)]=_0x24f085+0x28+'px';}}tg?tg[_0x4bf40f(0x233)](_0x4bf40f(0x1db),({isStateStable:_0x27feb3})=>{_0x25d4bc();if(_0x27feb3)requestAnimationFrame(()=>{const _0x2cf329=a0_0x46c4;_0x45084c[_0x2cf329(0x1ca)]=_0x45084c[_0x2cf329(0x217)];});}):window[_0x4bf40f(0x238)](_0x4bf40f(0x1ee),_0x25d4bc),_0x25d4bc(),_0x61cfe8&&(_0x61cfe8[_0x4bf40f(0x238)](_0x4bf40f(0x1bc),()=>{requestAnimationFrame(_0x25d4bc);}),_0x61cfe8[_0x4bf40f(0x238)](_0x4bf40f(0x1d0),()=>{setTimeout(()=>{_0x45084c['scrollTop']=_0x45084c['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1333c9(0x21a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x46c4(_0x232e05,_0x5b95ea){_0x232e05=_0x232e05-0x1b7;const _0x2f7caf=a0_0x241b();let _0x5d132a=_0x2f7caf[_0x232e05];return _0x5d132a;}const chatArea=document[a0_0x1333c9(0x1cf)]('chatArea'),emptyState=document['getElementById'](a0_0x1333c9(0x1fd)),messageInput=document['getElementById'](a0_0x1333c9(0x1cb)),sendBtn=document[a0_0x1333c9(0x1cf)](a0_0x1333c9(0x229)),clearBtn=document[a0_0x1333c9(0x1cf)](a0_0x1333c9(0x1e9)),modal=document[a0_0x1333c9(0x1cf)]('confirmModal'),mTitle=document[a0_0x1333c9(0x1cf)]('modalTitle'),mText=document[a0_0x1333c9(0x1cf)](a0_0x1333c9(0x1ea));let modalCallback=null;async function callBackend(_0x48b540,_0x3980b5){const _0x3dad67=a0_0x1333c9,_0xc33e03=tg?.[_0x3dad67(0x21c)]?.[_0x3dad67(0x21f)]||{},_0x1b6313=_0xc33e03['id']||localStorage[_0x3dad67(0x1e8)](_0x3dad67(0x200))||'d-'+Math['floor'](Math[_0x3dad67(0x1b8)]()*0x3b9aca00);if(!_0xc33e03['id'])localStorage[_0x3dad67(0x1e0)](_0x3dad67(0x200),_0x1b6313);const _0x4ee366={'action':_0x48b540,'user_id':_0x1b6313,'user_data':{'first_name':_0xc33e03[_0x3dad67(0x22b)],'username':_0xc33e03['username']},'init_data':tg?.[_0x3dad67(0x1c4)]||'',..._0x3980b5},_0x101e2e=new AbortController(),_0x445a01=setTimeout(()=>_0x101e2e[_0x3dad67(0x1d8)](),REQUEST_TIMEOUT_MS);try{const _0x4b90c5=await fetch(BACKEND_URL,{'method':_0x3dad67(0x1da),'headers':{'Content-Type':_0x3dad67(0x206)},'body':JSON[_0x3dad67(0x234)](_0x4ee366),'signal':_0x101e2e[_0x3dad67(0x1f2)]});return clearTimeout(_0x445a01),await _0x4b90c5[_0x3dad67(0x1c5)]();}catch(_0x2f13e8){return{'success':![],'error':String(_0x2f13e8)};}}function formatTime(_0x3ed3f5){const _0x171180=a0_0x1333c9,_0x2e7130=new Date(_0x3ed3f5);return String(_0x2e7130[_0x171180(0x1dd)]())[_0x171180(0x1f5)](0x2,'0')+':'+String(_0x2e7130[_0x171180(0x1f9)]())[_0x171180(0x1f5)](0x2,'0');}function createMessageElement(_0x1eaca4,_0x32935c){const _0xea5b19=a0_0x1333c9,_0x52e885=document[_0xea5b19(0x20e)]('div');_0x52e885[_0xea5b19(0x22c)]=_0xea5b19(0x220)+_0x1eaca4[_0xea5b19(0x213)];const _0x5de3aa=document[_0xea5b19(0x20e)](_0xea5b19(0x1bb));_0x5de3aa['className']='message-bubble',_0x5de3aa[_0xea5b19(0x1d6)]=_0x1eaca4['content'][_0xea5b19(0x209)](/\n/g,_0xea5b19(0x22f));const _0x1b6a6c=document['createElement'](_0xea5b19(0x1bb));_0x1b6a6c[_0xea5b19(0x22c)]=_0xea5b19(0x1dc),_0x1b6a6c[_0xea5b19(0x1d6)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x1b6a6c[_0xea5b19(0x1c8)]=_0x1c3145=>{const _0x26b99f=_0xea5b19;_0x1c3145[_0x26b99f(0x211)](),confirmDelete(_0x32935c);};let _0x35d884;_0x5de3aa[_0xea5b19(0x238)](_0xea5b19(0x218),()=>_0x35d884=setTimeout(()=>{const _0x314534=_0xea5b19;_0x52e885[_0x314534(0x1ed)][_0x314534(0x21e)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x314534(0x232)][_0x314534(0x207)]('medium');},0x1f4)),_0x5de3aa[_0xea5b19(0x238)](_0xea5b19(0x222),()=>clearTimeout(_0x35d884));const _0x1d3de9=document[_0xea5b19(0x20e)](_0xea5b19(0x1bb));return _0x1d3de9[_0xea5b19(0x22c)]=_0xea5b19(0x1f6),_0x1d3de9[_0xea5b19(0x22d)]=formatTime(_0x1eaca4[_0xea5b19(0x228)]),_0x52e885['appendChild'](_0x1b6a6c),_0x52e885[_0xea5b19(0x231)](_0x5de3aa),_0x52e885['appendChild'](_0x1d3de9),_0x52e885;}function createTypingIndicator(){const _0x198d75=a0_0x1333c9,_0x1953a9=document['createElement'](_0x198d75(0x1bb));return _0x1953a9[_0x198d75(0x22c)]=_0x198d75(0x1c6),_0x1953a9['id']=_0x198d75(0x224),_0x1953a9[_0x198d75(0x1d6)]=_0x198d75(0x1be),_0x1953a9;}function renderMessages(){const _0xdca0d2=a0_0x1333c9;Array[_0xdca0d2(0x219)](chatArea['children'])[_0xdca0d2(0x1d5)](_0x4bb32f=>{const _0x35edef=_0xdca0d2;if(_0x4bb32f['id']!=='emptyState')_0x4bb32f[_0x35edef(0x214)]();}),messages[_0xdca0d2(0x1ce)]>0x0?(emptyState[_0xdca0d2(0x1c9)]['display']=_0xdca0d2(0x1c1),messages[_0xdca0d2(0x1d5)]((_0x18a45c,_0x354d3f)=>chatArea[_0xdca0d2(0x231)](createMessageElement(_0x18a45c,_0x354d3f)))):emptyState[_0xdca0d2(0x1c9)]['display']='flex',requestAnimationFrame(()=>chatArea[_0xdca0d2(0x1ca)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x1f5e74=a0_0x1333c9;messageInput[_0x1f5e74(0x1c9)][_0x1f5e74(0x1ff)]='auto',messageInput['style']['height']=Math[_0x1f5e74(0x1f8)](messageInput[_0x1f5e74(0x217)],0x78)+'px';}function updateSendButton(){const _0x1b2f46=a0_0x1333c9,_0x52b455=messageInput['value'][_0x1b2f46(0x1e3)]();sendBtn[_0x1b2f46(0x208)]=!_0x52b455||isTyping;}async function sendMessage(){const _0x1c2f3c=a0_0x1333c9,_0x490879=messageInput[_0x1c2f3c(0x23b)]['trim']();if(!_0x490879||isTyping)return;if(tg?.[_0x1c2f3c(0x232)])tg[_0x1c2f3c(0x232)][_0x1c2f3c(0x207)](_0x1c2f3c(0x20f));messages['push']({'role':_0x1c2f3c(0x21f),'content':_0x490879,'timestamp':Date[_0x1c2f3c(0x1de)]()}),localStorage[_0x1c2f3c(0x1e0)](_0x1c2f3c(0x1e1),JSON[_0x1c2f3c(0x234)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1c2f3c(0x231)](createTypingIndicator()),chatArea[_0x1c2f3c(0x1ca)]=chatArea[_0x1c2f3c(0x217)];const _0xddfa73=await callBackend(_0x1c2f3c(0x204),{'message':_0x490879});isTyping=![];const _0x49e09a=document[_0x1c2f3c(0x1cf)](_0x1c2f3c(0x224));if(_0x49e09a)_0x49e09a['remove']();let _0x32d00d=_0x1c2f3c(0x1e2);if(_0xddfa73['success']){_0x32d00d=_0xddfa73[_0x1c2f3c(0x1e7)]||'Пустой\x20ответ';if(tg?.[_0x1c2f3c(0x232)])tg[_0x1c2f3c(0x232)]['notificationOccurred']('success');}else{_0x32d00d=_0xddfa73[_0x1c2f3c(0x1d7)]||'Ошибка\x20сервера';if(tg?.[_0x1c2f3c(0x232)])tg['HapticFeedback'][_0x1c2f3c(0x1d1)]('error');}messages[_0x1c2f3c(0x215)]({'role':'ai','content':_0x32d00d,'timestamp':Date[_0x1c2f3c(0x1de)]()}),localStorage[_0x1c2f3c(0x1e0)](_0x1c2f3c(0x1e1),JSON[_0x1c2f3c(0x234)](messages)),renderMessages();}function confirmDelete(_0x2632cd){const _0x1270fc=a0_0x1333c9;if(mTitle)mTitle[_0x1270fc(0x22d)]=_0x1270fc(0x1ec);if(mText)mText[_0x1270fc(0x22d)]=_0x1270fc(0x1ef);modalCallback=()=>{const _0x3b7caa=_0x1270fc;messages['splice'](_0x2632cd,0x1),localStorage[_0x3b7caa(0x1e0)](_0x3b7caa(0x1e1),JSON[_0x3b7caa(0x234)](messages)),renderMessages();},modal[_0x1270fc(0x1ed)]['add'](_0x1270fc(0x216));}function a0_0x241b(){const _0x3f314c=['onclick','style','scrollTop','messageInput','ready','BackButton','length','getElementById','focus','notificationOccurred','10GWcSBX','1698870NRBRVg','Начнется\x20новый\x20диалог.','forEach','innerHTML','error','abort','#050505','POST','viewportChanged','delete-btn','getHours','now','inputArea','setItem','ai_chat_messages','Ошибка\x20сети','trim','parse','6.1','offClick','text','getItem','clearBtn','modalText','warn','Удалить?','classList','resize','Действие\x20необратимо.','onClick','84DPjMck','signal','querySelectorAll','(((.+)+)+)+$','padStart','message-time','Enter','min','getMinutes','offsetHeight','show-delete','paddingBottom','emptyState','search','height','debug_uid','toString','chatArea','expand','send_message','WebApp','text/plain','impactOccurred','disabled','replace','3414648JbcIio','Очистить\x20историю?','key','.container','createElement','light','336481ZSyZyF','stopPropagation','130295OycRKN','role','remove','push','show','scrollHeight','touchstart','from','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','removeItem','initDataUnsafe','shiftKey','add','user','message\x20','4bEFMvS','touchend','apply','typingIndicator','clear_history','./router.html','target','timestamp','sendBtn','3709674QhBflX','first_name','className','textContent','contains','<br>','modalConfirm','appendChild','HapticFeedback','onEvent','stringify','constructor','function','isVersionAtLeast','addEventListener','keydown','TG\x20setup\x20error:','value','setHeaderColor','random','disableVerticalSwipes','click','div','input','preventDefault','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','23968dnXWAv','href','none','129hJaUTO','293584tSETqZ','initData','json','message\x20ai','260sZqfUd'];a0_0x241b=function(){return _0x3f314c;};return a0_0x241b();}if(clearBtn)clearBtn[a0_0x1333c9(0x1c8)]=()=>{const _0x38badf=a0_0x1333c9;if(!messages[_0x38badf(0x1ce)])return;if(mTitle)mTitle[_0x38badf(0x22d)]=_0x38badf(0x20b);if(mText)mText['textContent']=_0x38badf(0x1d4);modalCallback=async()=>{const _0x594d05=_0x38badf;messages=[],localStorage[_0x594d05(0x21b)](_0x594d05(0x1e1)),renderMessages(),callBackend(_0x594d05(0x225),{});},modal[_0x38badf(0x1ed)][_0x38badf(0x21e)](_0x38badf(0x216));};document[a0_0x1333c9(0x1cf)]('modalCancel')[a0_0x1333c9(0x1c8)]=()=>modal[a0_0x1333c9(0x1ed)][a0_0x1333c9(0x214)]('show'),document[a0_0x1333c9(0x1cf)](a0_0x1333c9(0x230))[a0_0x1333c9(0x1c8)]=()=>{const _0x17ddef=a0_0x1333c9;if(modalCallback)modalCallback();modal['classList'][_0x17ddef(0x214)]('show');},messageInput['addEventListener'](a0_0x1333c9(0x1bc),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1333c9(0x238)](a0_0x1333c9(0x239),_0x386705=>{const _0x4cb9fe=a0_0x1333c9;_0x386705[_0x4cb9fe(0x20c)]===_0x4cb9fe(0x1f7)&&!_0x386705[_0x4cb9fe(0x21d)]&&(_0x386705[_0x4cb9fe(0x1bd)](),sendMessage());}),sendBtn[a0_0x1333c9(0x1c8)]=sendMessage,document['addEventListener'](a0_0x1333c9(0x1ba),_0x2a6af7=>{const _0x49b65d=a0_0x1333c9;document[_0x49b65d(0x1f3)]('.message.show-delete')[_0x49b65d(0x1d5)](_0x97af5c=>{const _0x32ab18=_0x49b65d;if(!_0x97af5c[_0x32ab18(0x22e)](_0x2a6af7[_0x32ab18(0x227)]))_0x97af5c[_0x32ab18(0x1ed)][_0x32ab18(0x214)](_0x32ab18(0x1fb));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x1333c9(0x1e4)](saved),renderMessages();}catch(a0_0x13556e){}updateSendButton();