const a0_0x50e5d1=a0_0x185a;(function(_0x1e9e88,_0xe2866b){const _0x244285=a0_0x185a,_0x318e92=_0x1e9e88();while(!![]){try{const _0x2094ae=parseInt(_0x244285(0x185))/0x1+-parseInt(_0x244285(0x14a))/0x2*(-parseInt(_0x244285(0x12d))/0x3)+-parseInt(_0x244285(0x194))/0x4*(-parseInt(_0x244285(0x158))/0x5)+-parseInt(_0x244285(0x15f))/0x6*(-parseInt(_0x244285(0x192))/0x7)+-parseInt(_0x244285(0x14d))/0x8*(parseInt(_0x244285(0x180))/0x9)+parseInt(_0x244285(0x17b))/0xa+-parseInt(_0x244285(0x181))/0xb;if(_0x2094ae===_0xe2866b)break;else _0x318e92['push'](_0x318e92['shift']());}catch(_0x1ecc71){_0x318e92['push'](_0x318e92['shift']());}}}(a0_0x2a0b,0xc9d1e));const tg=window[a0_0x50e5d1(0x199)]?.[a0_0x50e5d1(0x146)],HOME_URL=a0_0x50e5d1(0x18a);function setupTelegramBackButton(){const _0x1f324d=a0_0x50e5d1;if(!tg)return;try{tg[_0x1f324d(0x174)](),tg['expand'](),tg['setHeaderColor']?.('#050505');if(tg['isVersionAtLeast']?.(_0x1f324d(0x167)))tg['disableVerticalSwipes']?.();const _0x4e1e3f=tg[_0x1f324d(0x164)];if(_0x4e1e3f){_0x4e1e3f['show']();if(typeof _0x4e1e3f['offClick']===_0x1f324d(0x18f))try{_0x4e1e3f[_0x1f324d(0x129)]();}catch(_0xb14e49){}_0x4e1e3f[_0x1f324d(0x179)](()=>{const _0x1fd84d=_0x1f324d;if(tg[_0x1fd84d(0x18c)])tg['HapticFeedback'][_0x1fd84d(0x15d)](_0x1fd84d(0x165));location[_0x1fd84d(0x16f)]=HOME_URL;});}}catch(_0x2344cb){console['warn'](_0x1f324d(0x145),_0x2344cb);}}(function initStableLayout(){const _0x15a063=a0_0x50e5d1,_0x20ba9b=(function(){let _0x55b2b0=!![];return function(_0x2daec5,_0x30ac44){const _0x5d8e64=_0x55b2b0?function(){const _0x56b1ae=a0_0x185a;if(_0x30ac44){const _0x2b1661=_0x30ac44[_0x56b1ae(0x184)](_0x2daec5,arguments);return _0x30ac44=null,_0x2b1661;}}:function(){};return _0x55b2b0=![],_0x5d8e64;};}()),_0x47f6cd=document[_0x15a063(0x183)]('.container'),_0x195a67=document[_0x15a063(0x138)]('inputArea'),_0x3ac045=document[_0x15a063(0x138)](_0x15a063(0x12e)),_0x4be9e6=document[_0x15a063(0x138)](_0x15a063(0x124));function _0x3b2533(){const _0x4fea71=_0x15a063,_0x198004=_0x20ba9b(this,function(){const _0x471225=a0_0x185a;return _0x198004[_0x471225(0x168)]()[_0x471225(0x188)](_0x471225(0x166))[_0x471225(0x168)]()['constructor'](_0x198004)['search'](_0x471225(0x166));});_0x198004();if(!_0x47f6cd)return;const _0x371534=tg&&tg[_0x4fea71(0x163)]?tg[_0x4fea71(0x163)]:window[_0x4fea71(0x127)];_0x47f6cd['style'][_0x4fea71(0x171)]=_0x371534+'px';if(_0x195a67){const _0x341756=_0x195a67[_0x4fea71(0x18e)];_0x3ac045[_0x4fea71(0x14e)][_0x4fea71(0x187)]=_0x341756+0x28+'px';}}tg?tg[_0x15a063(0x139)](_0x15a063(0x14b),({isStateStable:_0x504b0b})=>{_0x3b2533();if(_0x504b0b)requestAnimationFrame(()=>{const _0x3d8d07=a0_0x185a;_0x3ac045['scrollTop']=_0x3ac045[_0x3d8d07(0x125)];});}):window['addEventListener'](_0x15a063(0x148),_0x3b2533),_0x3b2533(),_0x4be9e6&&(_0x4be9e6[_0x15a063(0x12f)](_0x15a063(0x18d),()=>{requestAnimationFrame(_0x3b2533);}),_0x4be9e6['addEventListener'](_0x15a063(0x193),()=>{setTimeout(()=>{_0x3ac045['scrollTop']=_0x3ac045['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());function a0_0x185a(_0xe7dedb,_0x1d6a06){_0xe7dedb=_0xe7dedb-0x123;const _0x14c07d=a0_0x2a0b();let _0x21cad4=_0x14c07d[_0xe7dedb];return _0x21cad4;}const BACKEND_URL=a0_0x50e5d1(0x162),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x50e5d1(0x12e)),emptyState=document[a0_0x50e5d1(0x138)](a0_0x50e5d1(0x15a)),messageInput=document[a0_0x50e5d1(0x138)]('messageInput'),sendBtn=document[a0_0x50e5d1(0x138)]('sendBtn'),clearBtn=document['getElementById'](a0_0x50e5d1(0x150)),modal=document[a0_0x50e5d1(0x138)](a0_0x50e5d1(0x133)),mTitle=document[a0_0x50e5d1(0x138)](a0_0x50e5d1(0x161)),mText=document['getElementById'](a0_0x50e5d1(0x13c));let modalCallback=null;async function callBackend(_0xae3058,_0x9c1d5f){const _0x34e0e3=a0_0x50e5d1,_0x4a995c=tg?.[_0x34e0e3(0x176)]?.['user']||{},_0x1f8705=_0x4a995c['id']||localStorage[_0x34e0e3(0x136)]('debug_uid')||'d-'+Math['floor'](Math[_0x34e0e3(0x16c)]()*0x3b9aca00);if(!_0x4a995c['id'])localStorage['setItem'](_0x34e0e3(0x177),_0x1f8705);const _0x4a40cb={'action':_0xae3058,'user_id':_0x1f8705,'user_data':{'first_name':_0x4a995c['first_name'],'username':_0x4a995c['username']},'init_data':tg?.[_0x34e0e3(0x16b)]||'',..._0x9c1d5f},_0x5598b1=new AbortController(),_0x32d9a8=setTimeout(()=>_0x5598b1[_0x34e0e3(0x141)](),REQUEST_TIMEOUT_MS);try{const _0x30e8e=await fetch(BACKEND_URL,{'method':_0x34e0e3(0x126),'headers':{'Content-Type':_0x34e0e3(0x195)},'body':JSON[_0x34e0e3(0x132)](_0x4a40cb),'signal':_0x5598b1[_0x34e0e3(0x140)]});return clearTimeout(_0x32d9a8),await _0x30e8e['json']();}catch(_0x1357db){return{'success':![],'error':String(_0x1357db)};}}function formatTime(_0x797f23){const _0x1f5083=a0_0x50e5d1,_0x4f988f=new Date(_0x797f23);return String(_0x4f988f['getHours']())[_0x1f5083(0x147)](0x2,'0')+':'+String(_0x4f988f['getMinutes']())[_0x1f5083(0x147)](0x2,'0');}function createMessageElement(_0xa827ad,_0x32a598){const _0x1e7c9c=a0_0x50e5d1,_0x106388=document[_0x1e7c9c(0x14c)]('div');_0x106388['className']=_0x1e7c9c(0x157)+_0xa827ad[_0x1e7c9c(0x12c)];const _0x40132b=document[_0x1e7c9c(0x14c)](_0x1e7c9c(0x172));_0x40132b[_0x1e7c9c(0x142)]=_0x1e7c9c(0x131),_0x40132b[_0x1e7c9c(0x12b)]=_0xa827ad['content'][_0x1e7c9c(0x197)](/\n/g,'<br>');const _0x478df8=document[_0x1e7c9c(0x14c)](_0x1e7c9c(0x172));_0x478df8[_0x1e7c9c(0x142)]=_0x1e7c9c(0x175),_0x478df8[_0x1e7c9c(0x12b)]=_0x1e7c9c(0x15b),_0x478df8['onclick']=_0x2ddb3a=>{const _0x123a81=_0x1e7c9c;_0x2ddb3a[_0x123a81(0x173)](),confirmDelete(_0x32a598);};let _0x58f69e;_0x40132b[_0x1e7c9c(0x12f)](_0x1e7c9c(0x152),()=>_0x58f69e=setTimeout(()=>{const _0x3dd878=_0x1e7c9c;_0x106388['classList'][_0x3dd878(0x149)](_0x3dd878(0x13a));if(tg?.[_0x3dd878(0x18c)])tg[_0x3dd878(0x18c)][_0x3dd878(0x15d)]('medium');},0x1f4)),_0x40132b['addEventListener'](_0x1e7c9c(0x198),()=>clearTimeout(_0x58f69e));const _0x12a86a=document[_0x1e7c9c(0x14c)](_0x1e7c9c(0x172));return _0x12a86a['className']=_0x1e7c9c(0x17d),_0x12a86a[_0x1e7c9c(0x17f)]=formatTime(_0xa827ad['timestamp']),_0x106388['appendChild'](_0x478df8),_0x106388[_0x1e7c9c(0x12a)](_0x40132b),_0x106388[_0x1e7c9c(0x12a)](_0x12a86a),_0x106388;}function createTypingIndicator(){const _0x109299=a0_0x50e5d1,_0x3552bb=document[_0x109299(0x14c)](_0x109299(0x172));return _0x3552bb[_0x109299(0x142)]=_0x109299(0x160),_0x3552bb['id']=_0x109299(0x123),_0x3552bb[_0x109299(0x12b)]=_0x109299(0x170),_0x3552bb;}function renderMessages(){const _0x2cf793=a0_0x50e5d1;Array[_0x2cf793(0x15e)](chatArea['children'])[_0x2cf793(0x155)](_0x5d2c95=>{const _0xa4b7dc=_0x2cf793;if(_0x5d2c95['id']!=='emptyState')_0x5d2c95[_0xa4b7dc(0x13e)]();}),messages[_0x2cf793(0x153)]>0x0?(emptyState['style']['display']=_0x2cf793(0x143),messages[_0x2cf793(0x155)]((_0x3eeae2,_0x141e15)=>chatArea['appendChild'](createMessageElement(_0x3eeae2,_0x141e15)))):emptyState[_0x2cf793(0x14e)]['display']=_0x2cf793(0x182),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x2cf793(0x125)]);}function autoResizeTextarea(){const _0x148e62=a0_0x50e5d1;messageInput[_0x148e62(0x14e)][_0x148e62(0x171)]=_0x148e62(0x13b),messageInput[_0x148e62(0x14e)][_0x148e62(0x171)]=Math['min'](messageInput[_0x148e62(0x125)],0x78)+'px';}function updateSendButton(){const _0xb6703f=a0_0x50e5d1,_0x63e793=messageInput['value']['trim']();sendBtn[_0xb6703f(0x17a)]=!_0x63e793||isTyping;}async function sendMessage(){const _0x10a5b6=a0_0x50e5d1,_0xe6f3eb=messageInput['value']['trim']();if(!_0xe6f3eb||isTyping)return;if(tg?.[_0x10a5b6(0x18c)])tg['HapticFeedback'][_0x10a5b6(0x15d)]('light');messages[_0x10a5b6(0x169)]({'role':'user','content':_0xe6f3eb,'timestamp':Date['now']()}),localStorage[_0x10a5b6(0x191)](_0x10a5b6(0x13d),JSON[_0x10a5b6(0x132)](messages)),renderMessages(),messageInput[_0x10a5b6(0x13f)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x10a5b6(0x12a)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x10a5b6(0x125)];const _0x30621e=await callBackend(_0x10a5b6(0x156),{'message':_0xe6f3eb});isTyping=![];const _0x5563d8=document[_0x10a5b6(0x138)]('typingIndicator');if(_0x5563d8)_0x5563d8[_0x10a5b6(0x13e)]();let _0x124547='Ошибка\x20сети';if(_0x30621e[_0x10a5b6(0x17c)]){_0x124547=_0x30621e[_0x10a5b6(0x18b)]||_0x10a5b6(0x189);if(tg?.[_0x10a5b6(0x18c)])tg['HapticFeedback'][_0x10a5b6(0x135)](_0x10a5b6(0x17c));}else{_0x124547=_0x30621e['error']||_0x10a5b6(0x137);if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred'](_0x10a5b6(0x159));}messages[_0x10a5b6(0x169)]({'role':'ai','content':_0x124547,'timestamp':Date[_0x10a5b6(0x134)]()}),localStorage[_0x10a5b6(0x191)](_0x10a5b6(0x13d),JSON[_0x10a5b6(0x132)](messages)),renderMessages();}function confirmDelete(_0x5b76d8){const _0xc3da00=a0_0x50e5d1;if(mTitle)mTitle[_0xc3da00(0x17f)]=_0xc3da00(0x151);if(mText)mText[_0xc3da00(0x17f)]='Действие\x20необратимо.';modalCallback=()=>{const _0x5ecdf7=_0xc3da00;messages[_0x5ecdf7(0x190)](_0x5b76d8,0x1),localStorage[_0x5ecdf7(0x191)](_0x5ecdf7(0x13d),JSON['stringify'](messages)),renderMessages();},modal[_0xc3da00(0x19a)]['add']('show');}if(clearBtn)clearBtn[a0_0x50e5d1(0x15c)]=()=>{const _0x182726=a0_0x50e5d1;if(!messages[_0x182726(0x153)])return;if(mTitle)mTitle[_0x182726(0x17f)]='Очистить\x20историю?';if(mText)mText[_0x182726(0x17f)]=_0x182726(0x128);modalCallback=async()=>{const _0x2636ac=_0x182726;messages=[],localStorage[_0x2636ac(0x154)](_0x2636ac(0x13d)),renderMessages(),callBackend(_0x2636ac(0x130),{});},modal[_0x182726(0x19a)][_0x182726(0x149)](_0x182726(0x14f));};document[a0_0x50e5d1(0x138)](a0_0x50e5d1(0x144))[a0_0x50e5d1(0x15c)]=()=>modal[a0_0x50e5d1(0x19a)]['remove'](a0_0x50e5d1(0x14f)),document[a0_0x50e5d1(0x138)](a0_0x50e5d1(0x178))['onclick']=()=>{const _0x2f0496=a0_0x50e5d1;if(modalCallback)modalCallback();modal[_0x2f0496(0x19a)][_0x2f0496(0x13e)]('show');},messageInput[a0_0x50e5d1(0x12f)](a0_0x50e5d1(0x18d),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x50e5d1(0x186),_0x49a7f9=>{_0x49a7f9['key']==='Enter'&&!_0x49a7f9['shiftKey']&&(_0x49a7f9['preventDefault'](),sendMessage());}),sendBtn[a0_0x50e5d1(0x15c)]=sendMessage,document[a0_0x50e5d1(0x12f)](a0_0x50e5d1(0x17e),_0xe74be0=>{const _0xc19e8b=a0_0x50e5d1;document[_0xc19e8b(0x16e)](_0xc19e8b(0x16d))[_0xc19e8b(0x155)](_0x373268=>{const _0x5f25da=_0xc19e8b;if(!_0x373268['contains'](_0xe74be0[_0x5f25da(0x196)]))_0x373268[_0x5f25da(0x19a)][_0x5f25da(0x13e)](_0x5f25da(0x13a));});});const saved=localStorage[a0_0x50e5d1(0x136)](a0_0x50e5d1(0x13d));if(saved)try{messages=JSON[a0_0x50e5d1(0x16a)](saved),renderMessages();}catch(a0_0x1e6394){}function a0_0x2a0b(){const _0x55d53e=['debug_uid','modalConfirm','onClick','disabled','10744050rgNFxl','success','message-time','click','textContent','233271YOtiBY','24098492OxPoZF','flex','querySelector','apply','147075ekvijI','keydown','paddingBottom','search','Пустой\x20ответ','./router.html','text','HapticFeedback','input','offsetHeight','function','splice','setItem','511uveYzA','focus','2131004BUzbbM','text/plain','target','replace','touchend','Telegram','classList','typingIndicator','messageInput','scrollHeight','POST','innerHeight','Начнется\x20новый\x20диалог.','offClick','appendChild','innerHTML','role','3473181LACWnu','chatArea','addEventListener','clear_history','message-bubble','stringify','confirmModal','now','notificationOccurred','getItem','Ошибка\x20сервера','getElementById','onEvent','show-delete','auto','modalText','ai_chat_messages','remove','value','signal','abort','className','none','modalCancel','TG\x20setup\x20error:','WebApp','padStart','resize','add','2mveyhP','viewportChanged','createElement','472agSJtT','style','show','clearBtn','Удалить?','touchstart','length','removeItem','forEach','send_message','message\x20','5eSSPIL','error','emptyState','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','onclick','impactOccurred','from','134358BgYfTa','message\x20ai','modalTitle','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','viewportHeight','BackButton','light','(((.+)+)+)+$','6.1','toString','push','parse','initData','random','.message.show-delete','querySelectorAll','href','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','height','div','stopPropagation','ready','delete-btn','initDataUnsafe'];a0_0x2a0b=function(){return _0x55d53e;};return a0_0x2a0b();}updateSendButton();