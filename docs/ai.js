const a0_0x2ce327=a0_0x38f1;function a0_0x38f1(_0x43fad4,_0x208f8a){_0x43fad4=_0x43fad4-0x1a3;const _0x396dbf=a0_0x37e7();let _0x5e0ef5=_0x396dbf[_0x43fad4];return _0x5e0ef5;}(function(_0x5b7648,_0x8bdf62){const _0x554c6e=a0_0x38f1,_0x46de4c=_0x5b7648();while(!![]){try{const _0x377bf5=parseInt(_0x554c6e(0x1dc))/0x1*(-parseInt(_0x554c6e(0x1c6))/0x2)+parseInt(_0x554c6e(0x1c5))/0x3*(-parseInt(_0x554c6e(0x209))/0x4)+-parseInt(_0x554c6e(0x1e6))/0x5*(-parseInt(_0x554c6e(0x1fb))/0x6)+parseInt(_0x554c6e(0x1ed))/0x7*(parseInt(_0x554c6e(0x1d7))/0x8)+parseInt(_0x554c6e(0x1f5))/0x9+parseInt(_0x554c6e(0x1ef))/0xa*(parseInt(_0x554c6e(0x1e1))/0xb)+parseInt(_0x554c6e(0x1f3))/0xc*(-parseInt(_0x554c6e(0x1f0))/0xd);if(_0x377bf5===_0x8bdf62)break;else _0x46de4c['push'](_0x46de4c['shift']());}catch(_0x56abf0){_0x46de4c['push'](_0x46de4c['shift']());}}}(a0_0x37e7,0x2a39e));const tg=window[a0_0x2ce327(0x1ba)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x51effe=a0_0x2ce327,_0x3be435=(function(){let _0x20a46e=!![];return function(_0x5e6868,_0x4f5f39){const _0xd0cf4f=_0x20a46e?function(){const _0x3b9638=a0_0x38f1;if(_0x4f5f39){const _0x1bccbc=_0x4f5f39[_0x3b9638(0x207)](_0x5e6868,arguments);return _0x4f5f39=null,_0x1bccbc;}}:function(){};return _0x20a46e=![],_0xd0cf4f;};}()),_0x160978=_0x3be435(this,function(){const _0x48403f=a0_0x38f1;return _0x160978['toString']()[_0x48403f(0x1c9)](_0x48403f(0x1bc))[_0x48403f(0x20a)]()[_0x48403f(0x20e)](_0x160978)[_0x48403f(0x1c9)](_0x48403f(0x1bc));});_0x160978();if(!tg)return;try{tg[_0x51effe(0x221)](),tg[_0x51effe(0x1c1)](),tg[_0x51effe(0x1b6)]?.(_0x51effe(0x215));if(tg[_0x51effe(0x216)]?.(_0x51effe(0x1e4)))tg[_0x51effe(0x21f)]?.();const _0x1d3486=tg[_0x51effe(0x1b2)];if(_0x1d3486){_0x1d3486[_0x51effe(0x1a3)]();if(typeof _0x1d3486['offClick']==='function')try{_0x1d3486['offClick']();}catch(_0x15abdb){}_0x1d3486[_0x51effe(0x1a8)](()=>{const _0x25ee47=_0x51effe;if(tg[_0x25ee47(0x1b3)])tg['HapticFeedback']['impactOccurred'](_0x25ee47(0x223));location[_0x25ee47(0x1bf)]=HOME_URL;});}}catch(_0xdf69b){console[_0x51effe(0x1e7)]('TG\x20setup\x20error:',_0xdf69b);}}(function initStableLayout(){const _0x2e984a=a0_0x2ce327,_0x1647a9=document[_0x2e984a(0x1d1)](_0x2e984a(0x1d4)),_0x1d27a9=document[_0x2e984a(0x1de)](_0x2e984a(0x1d3)),_0x2cae55=document['getElementById'](_0x2e984a(0x1b9)),_0x50f917=document['getElementById'](_0x2e984a(0x1af));function _0x3502f0(){const _0x67be6e=_0x2e984a;if(!_0x1647a9)return;const _0x13db71=tg&&tg[_0x67be6e(0x1f4)]?tg[_0x67be6e(0x1f4)]:window['innerHeight'];_0x1647a9[_0x67be6e(0x1b8)][_0x67be6e(0x1c7)]=_0x13db71+'px';if(_0x1d27a9){const _0x28c159=_0x1d27a9[_0x67be6e(0x1bd)];_0x2cae55[_0x67be6e(0x1b8)][_0x67be6e(0x224)]=_0x28c159+0x28+'px';}}tg?tg[_0x2e984a(0x1fa)](_0x2e984a(0x218),({isStateStable:_0x23a344})=>{_0x3502f0();if(_0x23a344)requestAnimationFrame(()=>{const _0x3fa705=a0_0x38f1;_0x2cae55[_0x3fa705(0x1f2)]=_0x2cae55['scrollHeight'];});}):window[_0x2e984a(0x1d6)](_0x2e984a(0x213),_0x3502f0),_0x3502f0(),_0x50f917&&(_0x50f917[_0x2e984a(0x1d6)](_0x2e984a(0x1c3),()=>{requestAnimationFrame(_0x3502f0);}),_0x50f917['addEventListener'](_0x2e984a(0x227),()=>{setTimeout(()=>{const _0x13bcea=a0_0x38f1;_0x2cae55[_0x13bcea(0x1f2)]=_0x2cae55[_0x13bcea(0x21d)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2ce327(0x228),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x2ce327(0x1b9)),emptyState=document['getElementById'](a0_0x2ce327(0x1f9)),messageInput=document[a0_0x2ce327(0x1de)]('messageInput'),sendBtn=document['getElementById'](a0_0x2ce327(0x1d2)),clearBtn=document[a0_0x2ce327(0x1de)](a0_0x2ce327(0x225)),modal=document[a0_0x2ce327(0x1de)](a0_0x2ce327(0x1d0)),mTitle=document[a0_0x2ce327(0x1de)]('modalTitle'),mText=document[a0_0x2ce327(0x1de)](a0_0x2ce327(0x1dd));let modalCallback=null;function a0_0x37e7(){const _0x5091ac=['40hXssvA','warn','contains','ai_chat_messages','innerHTML','Действие\x20необратимо.','onclick','7JkPBTs','touchend','17570EiVXbo','324311UcKbyR','appendChild','scrollTop','36dYvAEU','viewportHeight','1510677tjWvmq','min','trim','display','emptyState','onEvent','100290sPMjOR','.message.show-delete','role','shiftKey','delete-btn','floor','text','error','children','Ошибка\x20сервера','disabled','preventDefault','apply','initData','7348lOdAIC','toString','Начнется\x20новый\x20диалог.','initDataUnsafe','getHours','constructor','from','flex','POST','parse','resize','modalCancel','#050505','isVersionAtLeast','now','viewportChanged','remove','removeItem','setItem','forEach','scrollHeight','user','disableVerticalSwipes','padStart','ready','textContent','light','paddingBottom','clearBtn','value','focus','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','content','text/plain','length','push','Удалить?','show','json','message\x20','stringify','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','onClick','querySelectorAll','show-delete','signal','classList','replace','getItem','messageInput','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','first_name','BackButton','HapticFeedback','username','debug_uid','setHeaderColor','clear_history','style','chatArea','Telegram','key','(((.+)+)+)+$','offsetHeight','medium','href','Очистить\x20историю?','expand','add','input','impactOccurred','108dNLqFY','808TaMnUY','height','message\x20ai','search','className','modalConfirm','typingIndicator','Пустой\x20ответ','<br>','target','confirmModal','querySelector','sendBtn','inputArea','.container','splice','addEventListener','1448600bJyZtE','notificationOccurred','createElement','div','success','709CzIuMT','modalText','getElementById','auto','message-bubble','737reCDsa','touchstart','click','6.1','keydown'];a0_0x37e7=function(){return _0x5091ac;};return a0_0x37e7();}async function callBackend(_0x257218,_0x58b92a){const _0x51311b=a0_0x2ce327,_0x1d1b31=tg?.[_0x51311b(0x20c)]?.[_0x51311b(0x21e)]||{},_0x50a87c=_0x1d1b31['id']||localStorage[_0x51311b(0x1ae)](_0x51311b(0x1b5))||'d-'+Math[_0x51311b(0x200)](Math['random']()*0x3b9aca00);if(!_0x1d1b31['id'])localStorage[_0x51311b(0x21b)](_0x51311b(0x1b5),_0x50a87c);const _0x216253={'action':_0x257218,'user_id':_0x50a87c,'user_data':{'first_name':_0x1d1b31[_0x51311b(0x1b1)],'username':_0x1d1b31[_0x51311b(0x1b4)]},'init_data':tg?.[_0x51311b(0x208)]||'',..._0x58b92a},_0x2d183b=new AbortController(),_0x542d7f=setTimeout(()=>_0x2d183b['abort'](),REQUEST_TIMEOUT_MS);try{const _0x125438=await fetch(BACKEND_URL,{'method':_0x51311b(0x211),'headers':{'Content-Type':_0x51311b(0x22a)},'body':JSON[_0x51311b(0x1a6)](_0x216253),'signal':_0x2d183b[_0x51311b(0x1ab)]});return clearTimeout(_0x542d7f),await _0x125438[_0x51311b(0x1a4)]();}catch(_0x94ad){return{'success':![],'error':String(_0x94ad)};}}function formatTime(_0x1d0a83){const _0x2f086f=a0_0x2ce327,_0x14063a=new Date(_0x1d0a83);return String(_0x14063a[_0x2f086f(0x20d)]())[_0x2f086f(0x220)](0x2,'0')+':'+String(_0x14063a['getMinutes']())[_0x2f086f(0x220)](0x2,'0');}function createMessageElement(_0x53fd16,_0x575f1b){const _0x548844=a0_0x2ce327,_0x29aa3d=document[_0x548844(0x1d9)](_0x548844(0x1da));_0x29aa3d[_0x548844(0x1ca)]=_0x548844(0x1a5)+_0x53fd16[_0x548844(0x1fd)];const _0x1aa070=document[_0x548844(0x1d9)](_0x548844(0x1da));_0x1aa070[_0x548844(0x1ca)]=_0x548844(0x1e0),_0x1aa070[_0x548844(0x1ea)]=_0x53fd16[_0x548844(0x229)][_0x548844(0x1ad)](/\n/g,_0x548844(0x1ce));const _0x11e94a=document[_0x548844(0x1d9)](_0x548844(0x1da));_0x11e94a[_0x548844(0x1ca)]=_0x548844(0x1ff),_0x11e94a[_0x548844(0x1ea)]=_0x548844(0x1a7),_0x11e94a[_0x548844(0x1ec)]=_0x342dbc=>{_0x342dbc['stopPropagation'](),confirmDelete(_0x575f1b);};let _0x527073;_0x1aa070[_0x548844(0x1d6)](_0x548844(0x1e2),()=>_0x527073=setTimeout(()=>{const _0x1c3350=_0x548844;_0x29aa3d[_0x1c3350(0x1ac)]['add'](_0x1c3350(0x1aa));if(tg?.[_0x1c3350(0x1b3)])tg[_0x1c3350(0x1b3)][_0x1c3350(0x1c4)](_0x1c3350(0x1be));},0x1f4)),_0x1aa070[_0x548844(0x1d6)](_0x548844(0x1ee),()=>clearTimeout(_0x527073));const _0xcd65a0=document['createElement']('div');return _0xcd65a0[_0x548844(0x1ca)]='message-time',_0xcd65a0[_0x548844(0x222)]=formatTime(_0x53fd16['timestamp']),_0x29aa3d['appendChild'](_0x11e94a),_0x29aa3d[_0x548844(0x1f1)](_0x1aa070),_0x29aa3d[_0x548844(0x1f1)](_0xcd65a0),_0x29aa3d;}function createTypingIndicator(){const _0x82f04a=a0_0x2ce327,_0x1168ef=document[_0x82f04a(0x1d9)](_0x82f04a(0x1da));return _0x1168ef['className']=_0x82f04a(0x1c8),_0x1168ef['id']=_0x82f04a(0x1cc),_0x1168ef[_0x82f04a(0x1ea)]=_0x82f04a(0x1b0),_0x1168ef;}function renderMessages(){const _0x229d04=a0_0x2ce327;Array[_0x229d04(0x20f)](chatArea[_0x229d04(0x203)])[_0x229d04(0x21c)](_0x278bf3=>{const _0x3181ab=_0x229d04;if(_0x278bf3['id']!==_0x3181ab(0x1f9))_0x278bf3[_0x3181ab(0x219)]();}),messages[_0x229d04(0x22b)]>0x0?(emptyState[_0x229d04(0x1b8)][_0x229d04(0x1f8)]='none',messages['forEach']((_0x59945c,_0xba8b09)=>chatArea[_0x229d04(0x1f1)](createMessageElement(_0x59945c,_0xba8b09)))):emptyState['style']['display']=_0x229d04(0x210),requestAnimationFrame(()=>chatArea[_0x229d04(0x1f2)]=chatArea[_0x229d04(0x21d)]);}function autoResizeTextarea(){const _0x201db9=a0_0x2ce327;messageInput['style']['height']=_0x201db9(0x1df),messageInput[_0x201db9(0x1b8)][_0x201db9(0x1c7)]=Math[_0x201db9(0x1f6)](messageInput[_0x201db9(0x21d)],0x78)+'px';}function updateSendButton(){const _0x1fd614=a0_0x2ce327,_0x2d9d1c=messageInput[_0x1fd614(0x226)][_0x1fd614(0x1f7)]();sendBtn[_0x1fd614(0x205)]=!_0x2d9d1c||isTyping;}async function sendMessage(){const _0x406e60=a0_0x2ce327,_0x40e2ee=messageInput[_0x406e60(0x226)][_0x406e60(0x1f7)]();if(!_0x40e2ee||isTyping)return;if(tg?.[_0x406e60(0x1b3)])tg[_0x406e60(0x1b3)][_0x406e60(0x1c4)]('light');messages[_0x406e60(0x22c)]({'role':_0x406e60(0x21e),'content':_0x40e2ee,'timestamp':Date[_0x406e60(0x217)]()}),localStorage[_0x406e60(0x21b)](_0x406e60(0x1e9),JSON[_0x406e60(0x1a6)](messages)),renderMessages(),messageInput[_0x406e60(0x226)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x406e60(0x1f1)](createTypingIndicator()),chatArea[_0x406e60(0x1f2)]=chatArea[_0x406e60(0x21d)];const _0x395391=await callBackend('send_message',{'message':_0x40e2ee});isTyping=![];const _0x1f3654=document[_0x406e60(0x1de)](_0x406e60(0x1cc));if(_0x1f3654)_0x1f3654[_0x406e60(0x219)]();let _0x26b872='Ошибка\x20сети';if(_0x395391[_0x406e60(0x1db)]){_0x26b872=_0x395391[_0x406e60(0x201)]||_0x406e60(0x1cd);if(tg?.[_0x406e60(0x1b3)])tg[_0x406e60(0x1b3)][_0x406e60(0x1d8)]('success');}else{_0x26b872=_0x395391['error']||_0x406e60(0x204);if(tg?.[_0x406e60(0x1b3)])tg['HapticFeedback'][_0x406e60(0x1d8)](_0x406e60(0x202));}messages[_0x406e60(0x22c)]({'role':'ai','content':_0x26b872,'timestamp':Date[_0x406e60(0x217)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x406e60(0x1a6)](messages)),renderMessages();}function confirmDelete(_0x3d93fe){const _0x17173b=a0_0x2ce327;if(mTitle)mTitle[_0x17173b(0x222)]=_0x17173b(0x22d);if(mText)mText[_0x17173b(0x222)]=_0x17173b(0x1eb);modalCallback=()=>{const _0x3d0b94=_0x17173b;messages[_0x3d0b94(0x1d5)](_0x3d93fe,0x1),localStorage[_0x3d0b94(0x21b)]('ai_chat_messages',JSON[_0x3d0b94(0x1a6)](messages)),renderMessages();},modal['classList'][_0x17173b(0x1c2)](_0x17173b(0x1a3));}if(clearBtn)clearBtn[a0_0x2ce327(0x1ec)]=()=>{const _0x1f576b=a0_0x2ce327;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x1f576b(0x1c0);if(mText)mText['textContent']=_0x1f576b(0x20b);modalCallback=async()=>{const _0xdd0f7a=_0x1f576b;messages=[],localStorage[_0xdd0f7a(0x21a)](_0xdd0f7a(0x1e9)),renderMessages(),callBackend(_0xdd0f7a(0x1b7),{});},modal[_0x1f576b(0x1ac)][_0x1f576b(0x1c2)](_0x1f576b(0x1a3));};document[a0_0x2ce327(0x1de)](a0_0x2ce327(0x214))[a0_0x2ce327(0x1ec)]=()=>modal[a0_0x2ce327(0x1ac)][a0_0x2ce327(0x219)](a0_0x2ce327(0x1a3)),document[a0_0x2ce327(0x1de)](a0_0x2ce327(0x1cb))[a0_0x2ce327(0x1ec)]=()=>{const _0x23ae33=a0_0x2ce327;if(modalCallback)modalCallback();modal[_0x23ae33(0x1ac)]['remove'](_0x23ae33(0x1a3));},messageInput[a0_0x2ce327(0x1d6)](a0_0x2ce327(0x1c3),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2ce327(0x1d6)](a0_0x2ce327(0x1e5),_0x2ed2a1=>{const _0x413633=a0_0x2ce327;_0x2ed2a1[_0x413633(0x1bb)]==='Enter'&&!_0x2ed2a1[_0x413633(0x1fe)]&&(_0x2ed2a1[_0x413633(0x206)](),sendMessage());}),sendBtn[a0_0x2ce327(0x1ec)]=sendMessage,document[a0_0x2ce327(0x1d6)](a0_0x2ce327(0x1e3),_0x28bc3b=>{const _0x569c1e=a0_0x2ce327;document[_0x569c1e(0x1a9)](_0x569c1e(0x1fc))[_0x569c1e(0x21c)](_0x223f09=>{const _0x3dd254=_0x569c1e;if(!_0x223f09[_0x3dd254(0x1e8)](_0x28bc3b[_0x3dd254(0x1cf)]))_0x223f09[_0x3dd254(0x1ac)]['remove'](_0x3dd254(0x1aa));});});const saved=localStorage['getItem'](a0_0x2ce327(0x1e9));if(saved)try{messages=JSON[a0_0x2ce327(0x212)](saved),renderMessages();}catch(a0_0x4175b4){}updateSendButton();