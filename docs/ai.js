const a0_0x264350=a0_0x33a2;(function(_0x446dd5,_0x4438cd){const _0x1679bb=a0_0x33a2,_0x3ac90c=_0x446dd5();while(!![]){try{const _0x5cc235=-parseInt(_0x1679bb(0x106))/0x1+-parseInt(_0x1679bb(0x108))/0x2*(-parseInt(_0x1679bb(0x11e))/0x3)+parseInt(_0x1679bb(0xfe))/0x4+parseInt(_0x1679bb(0x109))/0x5+parseInt(_0x1679bb(0xe8))/0x6+parseInt(_0x1679bb(0xd2))/0x7+parseInt(_0x1679bb(0xce))/0x8*(-parseInt(_0x1679bb(0xfd))/0x9);if(_0x5cc235===_0x4438cd)break;else _0x3ac90c['push'](_0x3ac90c['shift']());}catch(_0x347ba1){_0x3ac90c['push'](_0x3ac90c['shift']());}}}(a0_0x1b70,0xdea0b));const tg=window[a0_0x264350(0xdd)]?.[a0_0x264350(0xb2)],HOME_URL=a0_0x264350(0x124);function setupTelegramBackButton(){const _0x4e0bc9=a0_0x264350;if(!tg)return;try{tg[_0x4e0bc9(0xed)](),tg[_0x4e0bc9(0x129)](),tg[_0x4e0bc9(0xf4)]?.(_0x4e0bc9(0x128));if(tg['isVersionAtLeast']?.('6.1'))tg['disableVerticalSwipes']?.();const _0x8bf16f=tg[_0x4e0bc9(0x117)];if(_0x8bf16f){_0x8bf16f['show']();if(typeof _0x8bf16f[_0x4e0bc9(0xef)]===_0x4e0bc9(0xdf))try{_0x8bf16f[_0x4e0bc9(0xef)]();}catch(_0x2935fc){}_0x8bf16f[_0x4e0bc9(0xb7)](()=>{const _0x444424=_0x4e0bc9;if(tg[_0x444424(0xf5)])tg['HapticFeedback'][_0x444424(0xcb)](_0x444424(0x10f));location[_0x444424(0x120)]=HOME_URL;});}}catch(_0x2f2fb1){console['warn'](_0x4e0bc9(0xe2),_0x2f2fb1);}}(function initStableLayout(){const _0x473c64=a0_0x264350,_0x5dbbbb=(function(){let _0x5d16d4=!![];return function(_0xf20e61,_0x2ebcdb){const _0x48c876=_0x5d16d4?function(){const _0x4d6742=a0_0x33a2;if(_0x2ebcdb){const _0xd3a0a0=_0x2ebcdb[_0x4d6742(0xe0)](_0xf20e61,arguments);return _0x2ebcdb=null,_0xd3a0a0;}}:function(){};return _0x5d16d4=![],_0x48c876;};}()),_0x830255=document[_0x473c64(0xee)](_0x473c64(0x125)),_0x52cba2=document['getElementById']('inputArea'),_0x4d3352=document[_0x473c64(0x127)]('chatArea'),_0x5ecb13=document['getElementById']('messageInput');function _0x1d7379(){const _0x1f88d7=_0x473c64,_0x2874ef=_0x5dbbbb(this,function(){const _0xc6a1f9=a0_0x33a2;return _0x2874ef['toString']()['search'](_0xc6a1f9(0xc0))[_0xc6a1f9(0xda)]()['constructor'](_0x2874ef)['search'](_0xc6a1f9(0xc0));});_0x2874ef();if(!_0x830255)return;const _0x3c98c5=tg&&tg[_0x1f88d7(0x103)]?tg[_0x1f88d7(0x103)]:window['innerHeight'];_0x830255[_0x1f88d7(0x123)][_0x1f88d7(0x12e)]=_0x3c98c5+'px';if(_0x52cba2){const _0xe81de4=_0x52cba2['offsetHeight'];_0x4d3352['style']['paddingBottom']=_0xe81de4+0x28+'px';}}tg?tg[_0x473c64(0xf2)]('viewportChanged',({isStateStable:_0x6d9212})=>{_0x1d7379();if(_0x6d9212)requestAnimationFrame(()=>{_0x4d3352['scrollTop']=_0x4d3352['scrollHeight'];});}):window[_0x473c64(0xca)](_0x473c64(0x12c),_0x1d7379),_0x1d7379(),_0x5ecb13&&(_0x5ecb13[_0x473c64(0xca)](_0x473c64(0x105),()=>{requestAnimationFrame(_0x1d7379);}),_0x5ecb13[_0x473c64(0xca)](_0x473c64(0xd8),()=>{setTimeout(()=>{const _0x10e4d5=a0_0x33a2;_0x4d3352[_0x10e4d5(0x110)]=_0x4d3352[_0x10e4d5(0x12a)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x264350(0xb9),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x264350(0x127)](a0_0x264350(0xbb)),emptyState=document[a0_0x264350(0x127)]('emptyState'),messageInput=document[a0_0x264350(0x127)](a0_0x264350(0xfc)),sendBtn=document['getElementById'](a0_0x264350(0xcd)),clearBtn=document['getElementById'](a0_0x264350(0xb5)),modal=document[a0_0x264350(0x127)](a0_0x264350(0xac)),mTitle=document[a0_0x264350(0x127)](a0_0x264350(0xba)),mText=document[a0_0x264350(0x127)](a0_0x264350(0xc8));let modalCallback=null;async function callBackend(_0x19db8a,_0x17dcc2){const _0x2fa422=a0_0x264350,_0x2db6c9=tg?.[_0x2fa422(0x11d)]?.['user']||{},_0x222ff0=_0x2db6c9['id']||localStorage[_0x2fa422(0xdb)](_0x2fa422(0xde))||'d-'+Math[_0x2fa422(0xff)](Math[_0x2fa422(0x11b)]()*0x3b9aca00);if(!_0x2db6c9['id'])localStorage[_0x2fa422(0xf9)](_0x2fa422(0xde),_0x222ff0);const _0x15425a={'action':_0x19db8a,'user_id':_0x222ff0,'user_data':{'first_name':_0x2db6c9[_0x2fa422(0xae)],'username':_0x2db6c9[_0x2fa422(0xd6)]},'init_data':tg?.[_0x2fa422(0x10c)]||'',..._0x17dcc2},_0x570f8c=new AbortController(),_0x39f77a=setTimeout(()=>_0x570f8c[_0x2fa422(0xd5)](),REQUEST_TIMEOUT_MS);try{const _0x7b5838=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x2fa422(0xf7)},'body':JSON[_0x2fa422(0xec)](_0x15425a),'signal':_0x570f8c[_0x2fa422(0xe4)]});return clearTimeout(_0x39f77a),await _0x7b5838[_0x2fa422(0x118)]();}catch(_0x4a377a){return{'success':![],'error':String(_0x4a377a)};}}function formatTime(_0x2e2a12){const _0x185e24=a0_0x264350,_0x3234b7=new Date(_0x2e2a12);return String(_0x3234b7['getHours']())['padStart'](0x2,'0')+':'+String(_0x3234b7['getMinutes']())[_0x185e24(0xcc)](0x2,'0');}function createMessageElement(_0x48571e,_0x5b1ec0){const _0x2f7c6b=a0_0x264350,_0x3b48b1=document[_0x2f7c6b(0x112)]('div');_0x3b48b1[_0x2f7c6b(0xe1)]=_0x2f7c6b(0xb8)+_0x48571e[_0x2f7c6b(0xc5)];const _0x2fdea9=document['createElement'](_0x2f7c6b(0xe6));_0x2fdea9[_0x2f7c6b(0xe1)]=_0x2f7c6b(0xc9),_0x2fdea9[_0x2f7c6b(0xc4)]=_0x48571e[_0x2f7c6b(0xe5)][_0x2f7c6b(0x10e)](/\n/g,_0x2f7c6b(0xf0));const _0x386e79=document['createElement'](_0x2f7c6b(0xe6));_0x386e79[_0x2f7c6b(0xe1)]='delete-btn',_0x386e79[_0x2f7c6b(0xc4)]=_0x2f7c6b(0xf1),_0x386e79[_0x2f7c6b(0x11c)]=_0x314311=>{const _0x5e1715=_0x2f7c6b;_0x314311[_0x5e1715(0x10a)](),confirmDelete(_0x5b1ec0);};let _0x137ffe;_0x2fdea9[_0x2f7c6b(0xca)](_0x2f7c6b(0x101),()=>_0x137ffe=setTimeout(()=>{const _0x5aa7b1=_0x2f7c6b;_0x3b48b1['classList'][_0x5aa7b1(0x11a)]('show-delete');if(tg?.[_0x5aa7b1(0xf5)])tg[_0x5aa7b1(0xf5)]['impactOccurred'](_0x5aa7b1(0x113));},0x1f4)),_0x2fdea9[_0x2f7c6b(0xca)](_0x2f7c6b(0xc3),()=>clearTimeout(_0x137ffe));const _0x51fc0a=document[_0x2f7c6b(0x112)](_0x2f7c6b(0xe6));return _0x51fc0a[_0x2f7c6b(0xe1)]=_0x2f7c6b(0xea),_0x51fc0a[_0x2f7c6b(0xbc)]=formatTime(_0x48571e[_0x2f7c6b(0x10b)]),_0x3b48b1[_0x2f7c6b(0xd0)](_0x386e79),_0x3b48b1[_0x2f7c6b(0xd0)](_0x2fdea9),_0x3b48b1[_0x2f7c6b(0xd0)](_0x51fc0a),_0x3b48b1;}function createTypingIndicator(){const _0x15baf2=a0_0x264350,_0xf48014=document[_0x15baf2(0x112)]('div');return _0xf48014[_0x15baf2(0xe1)]=_0x15baf2(0x126),_0xf48014['id']=_0x15baf2(0xf6),_0xf48014[_0x15baf2(0xc4)]=_0x15baf2(0xc7),_0xf48014;}function renderMessages(){const _0x5d8979=a0_0x264350;Array[_0x5d8979(0x116)](chatArea[_0x5d8979(0x102)])[_0x5d8979(0xf8)](_0x29d09d=>{const _0x2937e0=_0x5d8979;if(_0x29d09d['id']!=='emptyState')_0x29d09d[_0x2937e0(0xcf)]();}),messages[_0x5d8979(0xe3)]>0x0?(emptyState['style'][_0x5d8979(0x122)]=_0x5d8979(0xfa),messages[_0x5d8979(0xf8)]((_0x509f39,_0x31cbfd)=>chatArea[_0x5d8979(0xd0)](createMessageElement(_0x509f39,_0x31cbfd)))):emptyState[_0x5d8979(0x123)][_0x5d8979(0x122)]=_0x5d8979(0xbf),requestAnimationFrame(()=>chatArea[_0x5d8979(0x110)]=chatArea[_0x5d8979(0x12a)]);}function autoResizeTextarea(){const _0x554473=a0_0x264350;messageInput[_0x554473(0x123)]['height']=_0x554473(0x100),messageInput[_0x554473(0x123)][_0x554473(0x12e)]=Math[_0x554473(0x121)](messageInput[_0x554473(0x12a)],0x78)+'px';}function updateSendButton(){const _0x2ee9da=a0_0x264350,_0x429c08=messageInput['value'][_0x2ee9da(0xd7)]();sendBtn['disabled']=!_0x429c08||isTyping;}async function sendMessage(){const _0x127cb7=a0_0x264350,_0x51e7a0=messageInput['value'][_0x127cb7(0xd7)]();if(!_0x51e7a0||isTyping)return;if(tg?.[_0x127cb7(0xf5)])tg['HapticFeedback']['impactOccurred'](_0x127cb7(0x10f));messages['push']({'role':_0x127cb7(0x10d),'content':_0x51e7a0,'timestamp':Date['now']()}),localStorage[_0x127cb7(0xf9)](_0x127cb7(0xf3),JSON['stringify'](messages)),renderMessages(),messageInput[_0x127cb7(0xd1)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x127cb7(0xd0)](createTypingIndicator()),chatArea[_0x127cb7(0x110)]=chatArea[_0x127cb7(0x12a)];const _0x5b2ec4=await callBackend('send_message',{'message':_0x51e7a0});isTyping=![];const _0x2eca6f=document['getElementById'](_0x127cb7(0xf6));if(_0x2eca6f)_0x2eca6f['remove']();let _0x377bb9=_0x127cb7(0xfb);if(_0x5b2ec4['success']){_0x377bb9=_0x5b2ec4[_0x127cb7(0xc6)]||_0x127cb7(0xaf);if(tg?.['HapticFeedback'])tg[_0x127cb7(0xf5)][_0x127cb7(0x119)]('success');}else{_0x377bb9=_0x5b2ec4[_0x127cb7(0xe9)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg[_0x127cb7(0xf5)][_0x127cb7(0x119)]('error');}messages[_0x127cb7(0xd3)]({'role':'ai','content':_0x377bb9,'timestamp':Date[_0x127cb7(0xbd)]()}),localStorage[_0x127cb7(0xf9)]('ai_chat_messages',JSON[_0x127cb7(0xec)](messages)),renderMessages();}function a0_0x33a2(_0x2d6bfd,_0x543512){_0x2d6bfd=_0x2d6bfd-0xac;const _0x1e1921=a0_0x1b70();let _0x5653c9=_0x1e1921[_0x2d6bfd];return _0x5653c9;}function confirmDelete(_0x556372){const _0x17a1e1=a0_0x264350;if(mTitle)mTitle['textContent']=_0x17a1e1(0x104);if(mText)mText[_0x17a1e1(0xbc)]='Действие\x20необратимо.';modalCallback=()=>{const _0x5cc2d3=_0x17a1e1;messages[_0x5cc2d3(0xdc)](_0x556372,0x1),localStorage['setItem'](_0x5cc2d3(0xf3),JSON['stringify'](messages)),renderMessages();},modal[_0x17a1e1(0xc1)][_0x17a1e1(0x11a)](_0x17a1e1(0xeb));}if(clearBtn)clearBtn[a0_0x264350(0x11c)]=()=>{const _0x5e809b=a0_0x264350;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x5e809b(0x12b);if(mText)mText[_0x5e809b(0xbc)]=_0x5e809b(0x107);modalCallback=async()=>{const _0x307b0a=_0x5e809b;messages=[],localStorage[_0x307b0a(0x11f)](_0x307b0a(0xf3)),renderMessages(),callBackend(_0x307b0a(0xb6),{});},modal[_0x5e809b(0xc1)][_0x5e809b(0x11a)](_0x5e809b(0xeb));};document[a0_0x264350(0x127)](a0_0x264350(0xb0))['onclick']=()=>modal['classList'][a0_0x264350(0xcf)](a0_0x264350(0xeb)),document[a0_0x264350(0x127)](a0_0x264350(0xb3))[a0_0x264350(0x11c)]=()=>{const _0xc85ec0=a0_0x264350;if(modalCallback)modalCallback();modal[_0xc85ec0(0xc1)][_0xc85ec0(0xcf)](_0xc85ec0(0xeb));},messageInput[a0_0x264350(0xca)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x264350(0xe7),_0x1f6d73=>{const _0x1d59b5=a0_0x264350;_0x1f6d73[_0x1d59b5(0xc2)]===_0x1d59b5(0xb4)&&!_0x1f6d73[_0x1d59b5(0x12d)]&&(_0x1f6d73[_0x1d59b5(0xad)](),sendMessage());}),sendBtn[a0_0x264350(0x11c)]=sendMessage,document['addEventListener'](a0_0x264350(0x111),_0x3c9014=>{const _0x9281c5=a0_0x264350;document[_0x9281c5(0xbe)](_0x9281c5(0x114))['forEach'](_0x2c359e=>{const _0x4c8171=_0x9281c5;if(!_0x2c359e[_0x4c8171(0xb1)](_0x3c9014[_0x4c8171(0x115)]))_0x2c359e[_0x4c8171(0xc1)]['remove'](_0x4c8171(0xd4));});});const saved=localStorage['getItem'](a0_0x264350(0xf3));function a0_0x1b70(){const _0x2da09c=['Начнется\x20новый\x20диалог.','2772ptYLtb','7329085vgHvdH','stopPropagation','timestamp','initData','user','replace','light','scrollTop','click','createElement','medium','.message.show-delete','target','from','BackButton','json','notificationOccurred','add','random','onclick','initDataUnsafe','123NCDRhi','removeItem','href','min','display','style','./router.html','.container','message\x20ai','getElementById','#050505','expand','scrollHeight','Очистить\x20историю?','resize','shiftKey','height','confirmModal','preventDefault','first_name','Пустой\x20ответ','modalCancel','contains','WebApp','modalConfirm','Enter','clearBtn','clear_history','onClick','message\x20','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','modalTitle','chatArea','textContent','now','querySelectorAll','flex','(((.+)+)+)+$','classList','key','touchend','innerHTML','role','text','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','modalText','message-bubble','addEventListener','impactOccurred','padStart','sendBtn','272osSOvv','remove','appendChild','value','2621073kFgkUv','push','show-delete','abort','username','trim','focus','parse','toString','getItem','splice','Telegram','debug_uid','function','apply','className','TG\x20setup\x20error:','length','signal','content','div','keydown','10185852chQTqb','error','message-time','show','stringify','ready','querySelector','offClick','<br>','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','onEvent','ai_chat_messages','setHeaderColor','HapticFeedback','typingIndicator','text/plain','forEach','setItem','none','Ошибка\x20сети','messageInput','632781ArMZtZ','2138272axtstH','floor','auto','touchstart','children','viewportHeight','Удалить?','input','826903AnpxUa'];a0_0x1b70=function(){return _0x2da09c;};return a0_0x1b70();}if(saved)try{messages=JSON[a0_0x264350(0xd9)](saved),renderMessages();}catch(a0_0x132dc6){}updateSendButton();