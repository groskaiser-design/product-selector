const a0_0x17de1c=a0_0x304b;(function(_0x1cf798,_0x55dfae){const _0x1090b2=a0_0x304b,_0x57208d=_0x1cf798();while(!![]){try{const _0x49743b=-parseInt(_0x1090b2(0x123))/0x1+-parseInt(_0x1090b2(0x130))/0x2*(-parseInt(_0x1090b2(0xd0))/0x3)+-parseInt(_0x1090b2(0xd1))/0x4+-parseInt(_0x1090b2(0x141))/0x5*(parseInt(_0x1090b2(0x104))/0x6)+parseInt(_0x1090b2(0x117))/0x7*(parseInt(_0x1090b2(0xce))/0x8)+parseInt(_0x1090b2(0x13c))/0x9+parseInt(_0x1090b2(0xcf))/0xa;if(_0x49743b===_0x55dfae)break;else _0x57208d['push'](_0x57208d['shift']());}catch(_0x6c8ef3){_0x57208d['push'](_0x57208d['shift']());}}}(a0_0x390d,0x95ffc));const tg=window[a0_0x17de1c(0x106)]?.[a0_0x17de1c(0xea)],HOME_URL=a0_0x17de1c(0xd8);function setupTelegramBackButton(){const _0xaa2426=a0_0x17de1c,_0x46fead=(function(){let _0x265779=!![];return function(_0x5a1b55,_0x3c6c3a){const _0x410595=_0x265779?function(){const _0xf3dbcf=a0_0x304b;if(_0x3c6c3a){const _0x3df222=_0x3c6c3a[_0xf3dbcf(0xcc)](_0x5a1b55,arguments);return _0x3c6c3a=null,_0x3df222;}}:function(){};return _0x265779=![],_0x410595;};}()),_0x225784=_0x46fead(this,function(){const _0x77fea4=a0_0x304b;return _0x225784[_0x77fea4(0x113)]()[_0x77fea4(0xf2)](_0x77fea4(0xe5))[_0x77fea4(0x113)]()[_0x77fea4(0x126)](_0x225784)['search'](_0x77fea4(0xe5));});_0x225784();if(!tg)return;try{tg[_0xaa2426(0xe6)](),tg[_0xaa2426(0xc5)](),tg['setHeaderColor']?.('#050505');if(tg[_0xaa2426(0x13a)]?.(_0xaa2426(0xdd)))tg[_0xaa2426(0x10f)]?.();const _0x5cec28=tg[_0xaa2426(0x12e)];if(_0x5cec28){_0x5cec28[_0xaa2426(0x13d)]();if(typeof _0x5cec28[_0xaa2426(0xd6)]===_0xaa2426(0xd4))try{_0x5cec28[_0xaa2426(0xd6)]();}catch(_0x7a5fa0){}_0x5cec28['onClick'](()=>{const _0x29a28f=_0xaa2426;if(tg[_0x29a28f(0x143)])tg[_0x29a28f(0x143)]['impactOccurred'](_0x29a28f(0x11c));location[_0x29a28f(0x12c)]=HOME_URL;});}}catch(_0x32fb36){console[_0xaa2426(0x134)](_0xaa2426(0xcd),_0x32fb36);}}(function initStableLayout(){const _0x402798=a0_0x17de1c,_0x4a4604=document['querySelector']('.container'),_0x50d340=document['getElementById'](_0x402798(0xda)),_0x1faa87=document['getElementById'](_0x402798(0xeb)),_0x1871ff=document['getElementById'](_0x402798(0x133));function _0x47f776(){const _0x45dd97=_0x402798;if(!_0x4a4604)return;const _0x107003=tg&&tg['viewportHeight']?tg[_0x45dd97(0xca)]:window[_0x45dd97(0x115)];_0x4a4604[_0x45dd97(0xe4)][_0x45dd97(0xe3)]=_0x107003+'px';if(_0x50d340){const _0x29c755=_0x50d340[_0x45dd97(0x124)];_0x1faa87[_0x45dd97(0xe4)][_0x45dd97(0xef)]=_0x29c755+0x28+'px';}}tg?tg[_0x402798(0x101)](_0x402798(0x105),({isStateStable:_0x3815a3})=>{_0x47f776();if(_0x3815a3)requestAnimationFrame(()=>{const _0x21ea3e=a0_0x304b;_0x1faa87[_0x21ea3e(0x107)]=_0x1faa87[_0x21ea3e(0x144)];});}):window['addEventListener'](_0x402798(0x11a),_0x47f776),_0x47f776(),_0x1871ff&&(_0x1871ff['addEventListener']('input',()=>{requestAnimationFrame(_0x47f776);}),_0x1871ff['addEventListener'](_0x402798(0xc8),()=>{setTimeout(()=>{const _0x2cdde7=a0_0x304b;_0x1faa87['scrollTop']=_0x1faa87[_0x2cdde7(0x144)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x17de1c(0xe2),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x17de1c(0xd7)]('chatArea'),emptyState=document[a0_0x17de1c(0xd7)](a0_0x17de1c(0x102)),messageInput=document[a0_0x17de1c(0xd7)](a0_0x17de1c(0x133)),sendBtn=document[a0_0x17de1c(0xd7)](a0_0x17de1c(0xde)),clearBtn=document[a0_0x17de1c(0xd7)](a0_0x17de1c(0xd9)),modal=document[a0_0x17de1c(0xd7)]('confirmModal'),mTitle=document[a0_0x17de1c(0xd7)](a0_0x17de1c(0xfd)),mText=document['getElementById'](a0_0x17de1c(0xdb));let modalCallback=null;async function callBackend(_0x25e331,_0x384c73){const _0x239bf4=a0_0x17de1c,_0x5f3066=tg?.[_0x239bf4(0xc4)]?.[_0x239bf4(0x108)]||{},_0x96d009=_0x5f3066['id']||localStorage[_0x239bf4(0x137)](_0x239bf4(0x136))||'d-'+Math[_0x239bf4(0x11b)](Math[_0x239bf4(0xe0)]()*0x3b9aca00);if(!_0x5f3066['id'])localStorage[_0x239bf4(0xe8)](_0x239bf4(0x136),_0x96d009);const _0x38878e={'action':_0x25e331,'user_id':_0x96d009,'user_data':{'first_name':_0x5f3066['first_name'],'username':_0x5f3066['username']},'init_data':tg?.[_0x239bf4(0x10a)]||'',..._0x384c73},_0x2b1db7=new AbortController(),_0x2f475a=setTimeout(()=>_0x2b1db7[_0x239bf4(0x142)](),REQUEST_TIMEOUT_MS);try{const _0x22188f=await fetch(BACKEND_URL,{'method':_0x239bf4(0x103),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x239bf4(0x109)](_0x38878e),'signal':_0x2b1db7[_0x239bf4(0x140)]});return clearTimeout(_0x2f475a),await _0x22188f[_0x239bf4(0x11e)]();}catch(_0x2ab225){return{'success':![],'error':String(_0x2ab225)};}}function formatTime(_0x20d917){const _0x385f85=a0_0x17de1c,_0x3fc14d=new Date(_0x20d917);return String(_0x3fc14d[_0x385f85(0xf9)]())['padStart'](0x2,'0')+':'+String(_0x3fc14d['getMinutes']())[_0x385f85(0x12b)](0x2,'0');}function createMessageElement(_0x3b869c,_0xce482e){const _0x21d30e=a0_0x17de1c,_0xa4bc79=document[_0x21d30e(0x12a)](_0x21d30e(0x13e));_0xa4bc79[_0x21d30e(0xfa)]=_0x21d30e(0x10d)+_0x3b869c[_0x21d30e(0xf5)];const _0x1040d1=document[_0x21d30e(0x12a)](_0x21d30e(0x13e));_0x1040d1[_0x21d30e(0xfa)]='message-bubble',_0x1040d1[_0x21d30e(0xf1)]=_0x3b869c[_0x21d30e(0x138)][_0x21d30e(0xff)](/\n/g,'<br>');const _0xacd49b=document[_0x21d30e(0x12a)](_0x21d30e(0x13e));_0xacd49b[_0x21d30e(0xfa)]=_0x21d30e(0xc6),_0xacd49b[_0x21d30e(0xf1)]=_0x21d30e(0xcb),_0xacd49b[_0x21d30e(0xc9)]=_0x2efabb=>{const _0x5849b8=_0x21d30e;_0x2efabb[_0x5849b8(0x111)](),confirmDelete(_0xce482e);};let _0x5c723c;_0x1040d1[_0x21d30e(0xdc)]('touchstart',()=>_0x5c723c=setTimeout(()=>{const _0x176039=_0x21d30e;_0xa4bc79['classList'][_0x176039(0x10b)](_0x176039(0x11d));if(tg?.[_0x176039(0x143)])tg['HapticFeedback'][_0x176039(0xf0)](_0x176039(0x116));},0x1f4)),_0x1040d1[_0x21d30e(0xdc)]('touchend',()=>clearTimeout(_0x5c723c));const _0x40a5da=document[_0x21d30e(0x12a)]('div');return _0x40a5da[_0x21d30e(0xfa)]=_0x21d30e(0xe7),_0x40a5da['textContent']=formatTime(_0x3b869c['timestamp']),_0xa4bc79[_0x21d30e(0xf3)](_0xacd49b),_0xa4bc79[_0x21d30e(0xf3)](_0x1040d1),_0xa4bc79[_0x21d30e(0xf3)](_0x40a5da),_0xa4bc79;}function createTypingIndicator(){const _0x173d8b=a0_0x17de1c,_0x3bcc16=document[_0x173d8b(0x12a)](_0x173d8b(0x13e));return _0x3bcc16[_0x173d8b(0xfa)]='message\x20ai',_0x3bcc16['id']=_0x173d8b(0xd5),_0x3bcc16[_0x173d8b(0xf1)]=_0x173d8b(0x110),_0x3bcc16;}function renderMessages(){const _0x3eab6e=a0_0x17de1c;Array[_0x3eab6e(0x12f)](chatArea[_0x3eab6e(0xe1)])['forEach'](_0x29de64=>{const _0x447995=_0x3eab6e;if(_0x29de64['id']!==_0x447995(0x102))_0x29de64[_0x447995(0xdf)]();}),messages[_0x3eab6e(0xf6)]>0x0?(emptyState[_0x3eab6e(0xe4)][_0x3eab6e(0x12d)]='none',messages['forEach']((_0xe7ab37,_0x745397)=>chatArea[_0x3eab6e(0xf3)](createMessageElement(_0xe7ab37,_0x745397)))):emptyState['style']['display']='flex',requestAnimationFrame(()=>chatArea[_0x3eab6e(0x107)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x31e82a=a0_0x17de1c;messageInput[_0x31e82a(0xe4)]['height']=_0x31e82a(0xd2),messageInput[_0x31e82a(0xe4)]['height']=Math['min'](messageInput[_0x31e82a(0x144)],0x78)+'px';}function updateSendButton(){const _0x93ee8c=a0_0x17de1c,_0x11d69d=messageInput[_0x93ee8c(0xee)][_0x93ee8c(0xe9)]();sendBtn['disabled']=!_0x11d69d||isTyping;}async function sendMessage(){const _0x2e4819=a0_0x17de1c,_0x14910a=messageInput[_0x2e4819(0xee)][_0x2e4819(0xe9)]();if(!_0x14910a||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2e4819(0x143)][_0x2e4819(0xf0)](_0x2e4819(0x11c));messages[_0x2e4819(0x118)]({'role':'user','content':_0x14910a,'timestamp':Date[_0x2e4819(0xfc)]()}),localStorage[_0x2e4819(0xe8)](_0x2e4819(0xed),JSON[_0x2e4819(0x109)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2e4819(0xf3)](createTypingIndicator()),chatArea[_0x2e4819(0x107)]=chatArea[_0x2e4819(0x144)];const _0x190219=await callBackend(_0x2e4819(0xd3),{'message':_0x14910a});isTyping=![];const _0x2f6c2c=document[_0x2e4819(0xd7)](_0x2e4819(0xd5));if(_0x2f6c2c)_0x2f6c2c[_0x2e4819(0xdf)]();let _0x2715a1=_0x2e4819(0x139);if(_0x190219[_0x2e4819(0x10c)]){_0x2715a1=_0x190219[_0x2e4819(0x131)]||_0x2e4819(0xf8);if(tg?.['HapticFeedback'])tg[_0x2e4819(0x143)][_0x2e4819(0x13f)](_0x2e4819(0x10c));}else{_0x2715a1=_0x190219['error']||'Ошибка\x20сервера';if(tg?.[_0x2e4819(0x143)])tg[_0x2e4819(0x143)][_0x2e4819(0x13f)](_0x2e4819(0x127));}messages[_0x2e4819(0x118)]({'role':'ai','content':_0x2715a1,'timestamp':Date[_0x2e4819(0xfc)]()}),localStorage[_0x2e4819(0xe8)](_0x2e4819(0xed),JSON[_0x2e4819(0x109)](messages)),renderMessages();}function a0_0x390d(){const _0x54a8a1=['935511SRrzDk','offsetHeight','clear_history','constructor','error','key','modalCancel','createElement','padStart','href','display','BackButton','from','46AYpapg','text','Удалить?','messageInput','warn','classList','debug_uid','getItem','content','Ошибка\x20сети','isVersionAtLeast','Очистить\x20историю?','4425489sfgtJx','show','div','notificationOccurred','signal','20BKXBYT','abort','HapticFeedback','scrollHeight','target','initDataUnsafe','expand','delete-btn','contains','focus','onclick','viewportHeight','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','apply','TG\x20setup\x20error:','128qruEga','11505310tEJldk','59067SCrlSr','3662080BxqiKl','auto','send_message','function','typingIndicator','offClick','getElementById','./router.html','clearBtn','inputArea','modalText','addEventListener','6.1','sendBtn','remove','random','children','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','height','style','(((.+)+)+)+$','ready','message-time','setItem','trim','WebApp','chatArea','Начнется\x20новый\x20диалог.','ai_chat_messages','value','paddingBottom','impactOccurred','innerHTML','search','appendChild','keydown','role','length','parse','Пустой\x20ответ','getHours','className','splice','now','modalTitle','Enter','replace','removeItem','onEvent','emptyState','POST','571188LHCbeD','viewportChanged','Telegram','scrollTop','user','stringify','initData','add','success','message\x20','textContent','disableVerticalSwipes','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','stopPropagation','shiftKey','toString','click','innerHeight','medium','328615SizZps','push','Действие\x20необратимо.','resize','floor','light','show-delete','json','input','.message.show-delete','forEach','preventDefault'];a0_0x390d=function(){return _0x54a8a1;};return a0_0x390d();}function a0_0x304b(_0x1e3dd9,_0x8db4fb){_0x1e3dd9=_0x1e3dd9-0xc4;const _0x53583e=a0_0x390d();let _0x489551=_0x53583e[_0x1e3dd9];return _0x489551;}function confirmDelete(_0x554ed6){const _0x1a255c=a0_0x17de1c;if(mTitle)mTitle[_0x1a255c(0x10e)]=_0x1a255c(0x132);if(mText)mText[_0x1a255c(0x10e)]=_0x1a255c(0x119);modalCallback=()=>{const _0x2b9d9e=_0x1a255c;messages[_0x2b9d9e(0xfb)](_0x554ed6,0x1),localStorage[_0x2b9d9e(0xe8)](_0x2b9d9e(0xed),JSON[_0x2b9d9e(0x109)](messages)),renderMessages();},modal['classList'][_0x1a255c(0x10b)](_0x1a255c(0x13d));}if(clearBtn)clearBtn[a0_0x17de1c(0xc9)]=()=>{const _0x57c19d=a0_0x17de1c;if(!messages['length'])return;if(mTitle)mTitle[_0x57c19d(0x10e)]=_0x57c19d(0x13b);if(mText)mText[_0x57c19d(0x10e)]=_0x57c19d(0xec);modalCallback=async()=>{const _0x48b63c=_0x57c19d;messages=[],localStorage[_0x48b63c(0x100)]('ai_chat_messages'),renderMessages(),callBackend(_0x48b63c(0x125),{});},modal[_0x57c19d(0x135)]['add'](_0x57c19d(0x13d));};document[a0_0x17de1c(0xd7)](a0_0x17de1c(0x129))[a0_0x17de1c(0xc9)]=()=>modal[a0_0x17de1c(0x135)][a0_0x17de1c(0xdf)](a0_0x17de1c(0x13d)),document['getElementById']('modalConfirm')['onclick']=()=>{const _0xb281cd=a0_0x17de1c;if(modalCallback)modalCallback();modal[_0xb281cd(0x135)][_0xb281cd(0xdf)]('show');},messageInput[a0_0x17de1c(0xdc)](a0_0x17de1c(0x11f),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x17de1c(0xdc)](a0_0x17de1c(0xf4),_0x2348d1=>{const _0x3b51ce=a0_0x17de1c;_0x2348d1[_0x3b51ce(0x128)]===_0x3b51ce(0xfe)&&!_0x2348d1[_0x3b51ce(0x112)]&&(_0x2348d1[_0x3b51ce(0x122)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x17de1c(0xdc)](a0_0x17de1c(0x114),_0x414026=>{const _0x114743=a0_0x17de1c;document['querySelectorAll'](_0x114743(0x120))[_0x114743(0x121)](_0xc9b12=>{const _0x269bf0=_0x114743;if(!_0xc9b12[_0x269bf0(0xc7)](_0x414026[_0x269bf0(0x145)]))_0xc9b12[_0x269bf0(0x135)][_0x269bf0(0xdf)](_0x269bf0(0x11d));});});const saved=localStorage[a0_0x17de1c(0x137)](a0_0x17de1c(0xed));if(saved)try{messages=JSON[a0_0x17de1c(0xf7)](saved),renderMessages();}catch(a0_0x4d40ec){}updateSendButton();