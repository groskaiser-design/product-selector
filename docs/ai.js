const a0_0x3c8ed0=a0_0x5296;(function(_0xcef72,_0x29b32a){const _0xb43193=a0_0x5296,_0x8d2686=_0xcef72();while(!![]){try{const _0x13599c=-parseInt(_0xb43193(0x11a))/0x1+parseInt(_0xb43193(0x123))/0x2*(parseInt(_0xb43193(0x12f))/0x3)+parseInt(_0xb43193(0xee))/0x4+-parseInt(_0xb43193(0xf1))/0x5+parseInt(_0xb43193(0x114))/0x6*(-parseInt(_0xb43193(0xc0))/0x7)+-parseInt(_0xb43193(0xda))/0x8*(parseInt(_0xb43193(0xf5))/0x9)+parseInt(_0xb43193(0xf7))/0xa;if(_0x13599c===_0x29b32a)break;else _0x8d2686['push'](_0x8d2686['shift']());}catch(_0xdca735){_0x8d2686['push'](_0x8d2686['shift']());}}}(a0_0x30ed,0xed716));const tg=window[a0_0x3c8ed0(0xd9)]?.[a0_0x3c8ed0(0xba)],HOME_URL=a0_0x3c8ed0(0xd6);function setupTelegramBackButton(){const _0x5dfde5=a0_0x3c8ed0,_0x2ffccc=(function(){let _0x119d54=!![];return function(_0x186a52,_0xab1716){const _0x22f105=_0x119d54?function(){const _0x1bb7ac=a0_0x5296;if(_0xab1716){const _0x8775e0=_0xab1716[_0x1bb7ac(0xf4)](_0x186a52,arguments);return _0xab1716=null,_0x8775e0;}}:function(){};return _0x119d54=![],_0x22f105;};}()),_0x4e8d7c=_0x2ffccc(this,function(){const _0x1a0d03=a0_0x5296;return _0x4e8d7c['toString']()[_0x1a0d03(0xde)](_0x1a0d03(0xd8))[_0x1a0d03(0x11d)]()['constructor'](_0x4e8d7c)[_0x1a0d03(0xde)](_0x1a0d03(0xd8));});_0x4e8d7c();if(!tg)return;try{tg[_0x5dfde5(0xb6)](),tg[_0x5dfde5(0xc6)](),tg[_0x5dfde5(0xfb)]?.(_0x5dfde5(0xfd));if(tg[_0x5dfde5(0xcd)]?.(_0x5dfde5(0xc1)))tg[_0x5dfde5(0xce)]?.();const _0x42ea24=tg[_0x5dfde5(0xfe)];if(_0x42ea24){_0x42ea24[_0x5dfde5(0xe0)]();if(typeof _0x42ea24[_0x5dfde5(0x10b)]===_0x5dfde5(0xb9))try{_0x42ea24['offClick']();}catch(_0x1443bd){}_0x42ea24[_0x5dfde5(0x128)](()=>{const _0x88c5a9=_0x5dfde5;if(tg[_0x88c5a9(0x11b)])tg[_0x88c5a9(0x11b)][_0x88c5a9(0x124)]('light');location[_0x88c5a9(0xed)]=HOME_URL;});}}catch(_0x1f4a74){console[_0x5dfde5(0xdb)]('TG\x20setup\x20error:',_0x1f4a74);}}(function initStableLayout(){const _0x34d3e4=a0_0x3c8ed0,_0x160bbc=document[_0x34d3e4(0x132)]('.container'),_0x2ae172=document[_0x34d3e4(0x110)](_0x34d3e4(0x126)),_0x42af2d=document['getElementById']('chatArea'),_0x21cde5=document['getElementById'](_0x34d3e4(0xb3));function _0x3c658f(){const _0x555aef=_0x34d3e4;if(!_0x160bbc)return;const _0x49b8e5=tg&&tg[_0x555aef(0xb7)]?tg[_0x555aef(0xb7)]:window[_0x555aef(0x12d)];_0x160bbc['style'][_0x555aef(0xea)]=_0x49b8e5+'px';if(_0x2ae172){const _0x1f3244=_0x2ae172[_0x555aef(0x12b)];_0x42af2d[_0x555aef(0x11f)]['paddingBottom']=_0x1f3244+0x28+'px';}}tg?tg['onEvent'](_0x34d3e4(0xfa),({isStateStable:_0x3571a1})=>{_0x3c658f();if(_0x3571a1)requestAnimationFrame(()=>{const _0x3e5225=a0_0x5296;_0x42af2d[_0x3e5225(0x111)]=_0x42af2d[_0x3e5225(0xc5)];});}):window[_0x34d3e4(0xeb)](_0x34d3e4(0x122),_0x3c658f),_0x3c658f(),_0x21cde5&&(_0x21cde5[_0x34d3e4(0xeb)]('input',()=>{requestAnimationFrame(_0x3c658f);}),_0x21cde5['addEventListener'](_0x34d3e4(0xb5),()=>{setTimeout(()=>{const _0xf2ed88=a0_0x5296;_0x42af2d[_0xf2ed88(0x111)]=_0x42af2d[_0xf2ed88(0xc5)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3c8ed0(0x110)](a0_0x3c8ed0(0x130)),emptyState=document[a0_0x3c8ed0(0x110)]('emptyState'),messageInput=document[a0_0x3c8ed0(0x110)]('messageInput'),sendBtn=document[a0_0x3c8ed0(0x110)](a0_0x3c8ed0(0x119)),clearBtn=document[a0_0x3c8ed0(0x110)](a0_0x3c8ed0(0x112)),modal=document[a0_0x3c8ed0(0x110)](a0_0x3c8ed0(0x11c)),mTitle=document[a0_0x3c8ed0(0x110)]('modalTitle'),mText=document['getElementById'](a0_0x3c8ed0(0xb2));let modalCallback=null;function a0_0x30ed(){const _0x5db158=['querySelectorAll','offsetHeight','text/plain','innerHeight','getItem','840435FicKfS','chatArea','error','querySelector','modalText','messageInput','floor','focus','ready','viewportHeight','Действие\x20необратимо.','function','WebApp','send_message','Очистить\x20историю?','ai_chat_messages','modalConfirm','stringify','868ruxGCJ','6.1','className','getHours','initDataUnsafe','scrollHeight','expand','innerHTML','now','splice','shiftKey','forEach','first_name','isVersionAtLeast','disableVerticalSwipes','modalCancel','from','parse','Начнется\x20новый\x20диалог.','classList','Enter','add','./router.html','stopPropagation','(((.+)+)+)+$','Telegram','1041944zWdzMh','warn','min','textContent','search','Ошибка\x20сети','show','show-delete','setItem','user','removeItem','disabled','appendChild','display','role','medium','height','addEventListener','Удалить?','href','3424336PgcINI','onclick','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','750900MRRviv','none','flex','apply','126thZSCg','abort','23563640WwUNOx','timestamp','createElement','viewportChanged','setHeaderColor','children','#050505','BackButton','touchend','padStart','preventDefault','emptyState','trim','.message.show-delete','remove','json','touchstart','light','message\x20ai','target','offClick','debug_uid','contains','success','div','getElementById','scrollTop','clearBtn','push','648dSJRKy','getMinutes','content','key','typingIndicator','sendBtn','1653633PEfaLM','HapticFeedback','confirmModal','toString','keydown','style','clear_history','notificationOccurred','resize','10SvnTgC','impactOccurred','Ошибка\x20сервера','inputArea','length','onClick','signal'];a0_0x30ed=function(){return _0x5db158;};return a0_0x30ed();}async function callBackend(_0x37de9e,_0x3a8a08){const _0xda5560=a0_0x3c8ed0,_0x3e36ae=tg?.[_0xda5560(0xc4)]?.[_0xda5560(0xe3)]||{},_0x2e4e41=_0x3e36ae['id']||localStorage[_0xda5560(0x12e)](_0xda5560(0x10c))||'d-'+Math[_0xda5560(0xb4)](Math['random']()*0x3b9aca00);if(!_0x3e36ae['id'])localStorage[_0xda5560(0xe2)](_0xda5560(0x10c),_0x2e4e41);const _0x59a1f7={'action':_0x37de9e,'user_id':_0x2e4e41,'user_data':{'first_name':_0x3e36ae[_0xda5560(0xcc)],'username':_0x3e36ae['username']},'init_data':tg?.['initData']||'',..._0x3a8a08},_0x5d7a98=new AbortController(),_0x3f59bc=setTimeout(()=>_0x5d7a98[_0xda5560(0xf6)](),REQUEST_TIMEOUT_MS);try{const _0x2a89d=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0xda5560(0x12c)},'body':JSON[_0xda5560(0xbf)](_0x59a1f7),'signal':_0x5d7a98[_0xda5560(0x129)]});return clearTimeout(_0x3f59bc),await _0x2a89d[_0xda5560(0x106)]();}catch(_0x23ab64){return{'success':![],'error':String(_0x23ab64)};}}function formatTime(_0x3fc4e4){const _0x5de517=a0_0x3c8ed0,_0x56c951=new Date(_0x3fc4e4);return String(_0x56c951[_0x5de517(0xc3)]())[_0x5de517(0x100)](0x2,'0')+':'+String(_0x56c951[_0x5de517(0x115)]())[_0x5de517(0x100)](0x2,'0');}function a0_0x5296(_0x291dee,_0x25cb2e){_0x291dee=_0x291dee-0xb2;const _0x553a56=a0_0x30ed();let _0x367f05=_0x553a56[_0x291dee];return _0x367f05;}function createMessageElement(_0x317b0b,_0x21e229){const _0x321a28=a0_0x3c8ed0,_0x118fe5=document[_0x321a28(0xf9)](_0x321a28(0x10f));_0x118fe5[_0x321a28(0xc2)]='message\x20'+_0x317b0b[_0x321a28(0xe8)];const _0x5a5d4d=document[_0x321a28(0xf9)](_0x321a28(0x10f));_0x5a5d4d[_0x321a28(0xc2)]='message-bubble',_0x5a5d4d['innerHTML']=_0x317b0b[_0x321a28(0x116)]['replace'](/\n/g,'<br>');const _0x475fb5=document['createElement']('div');_0x475fb5[_0x321a28(0xc2)]='delete-btn',_0x475fb5['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x475fb5[_0x321a28(0xef)]=_0x13bb94=>{const _0x1f91ea=_0x321a28;_0x13bb94[_0x1f91ea(0xd7)](),confirmDelete(_0x21e229);};let _0x3f7a78;_0x5a5d4d['addEventListener'](_0x321a28(0x107),()=>_0x3f7a78=setTimeout(()=>{const _0x460dc6=_0x321a28;_0x118fe5[_0x460dc6(0xd3)][_0x460dc6(0xd5)](_0x460dc6(0xe1));if(tg?.[_0x460dc6(0x11b)])tg[_0x460dc6(0x11b)][_0x460dc6(0x124)](_0x460dc6(0xe9));},0x1f4)),_0x5a5d4d[_0x321a28(0xeb)](_0x321a28(0xff),()=>clearTimeout(_0x3f7a78));const _0x3fd13c=document['createElement'](_0x321a28(0x10f));return _0x3fd13c[_0x321a28(0xc2)]='message-time',_0x3fd13c[_0x321a28(0xdd)]=formatTime(_0x317b0b[_0x321a28(0xf8)]),_0x118fe5['appendChild'](_0x475fb5),_0x118fe5[_0x321a28(0xe6)](_0x5a5d4d),_0x118fe5[_0x321a28(0xe6)](_0x3fd13c),_0x118fe5;}function createTypingIndicator(){const _0x1852df=a0_0x3c8ed0,_0x52bf05=document[_0x1852df(0xf9)](_0x1852df(0x10f));return _0x52bf05[_0x1852df(0xc2)]=_0x1852df(0x109),_0x52bf05['id']=_0x1852df(0x118),_0x52bf05[_0x1852df(0xc7)]=_0x1852df(0xf0),_0x52bf05;}function renderMessages(){const _0x469de1=a0_0x3c8ed0;Array[_0x469de1(0xd0)](chatArea[_0x469de1(0xfc)])[_0x469de1(0xcb)](_0x49937f=>{const _0x581fbd=_0x469de1;if(_0x49937f['id']!==_0x581fbd(0x102))_0x49937f[_0x581fbd(0x105)]();}),messages[_0x469de1(0x127)]>0x0?(emptyState['style'][_0x469de1(0xe7)]=_0x469de1(0xf2),messages[_0x469de1(0xcb)]((_0x20e1b9,_0x488e91)=>chatArea[_0x469de1(0xe6)](createMessageElement(_0x20e1b9,_0x488e91)))):emptyState['style'][_0x469de1(0xe7)]=_0x469de1(0xf3),requestAnimationFrame(()=>chatArea[_0x469de1(0x111)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x5c92ba=a0_0x3c8ed0;messageInput[_0x5c92ba(0x11f)][_0x5c92ba(0xea)]='auto',messageInput[_0x5c92ba(0x11f)][_0x5c92ba(0xea)]=Math[_0x5c92ba(0xdc)](messageInput[_0x5c92ba(0xc5)],0x78)+'px';}function updateSendButton(){const _0x340876=a0_0x3c8ed0,_0x172f6b=messageInput['value'][_0x340876(0x103)]();sendBtn[_0x340876(0xe5)]=!_0x172f6b||isTyping;}async function sendMessage(){const _0x47cad0=a0_0x3c8ed0,_0x54cced=messageInput['value']['trim']();if(!_0x54cced||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x47cad0(0x124)](_0x47cad0(0x108));messages[_0x47cad0(0x113)]({'role':_0x47cad0(0xe3),'content':_0x54cced,'timestamp':Date['now']()}),localStorage[_0x47cad0(0xe2)]('ai_chat_messages',JSON[_0x47cad0(0xbf)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x49f603=await callBackend(_0x47cad0(0xbb),{'message':_0x54cced});isTyping=![];const _0x4733ab=document['getElementById'](_0x47cad0(0x118));if(_0x4733ab)_0x4733ab['remove']();let _0xd872ae=_0x47cad0(0xdf);if(_0x49f603[_0x47cad0(0x10e)]){_0xd872ae=_0x49f603['text']||'Пустой\x20ответ';if(tg?.[_0x47cad0(0x11b)])tg['HapticFeedback'][_0x47cad0(0x121)](_0x47cad0(0x10e));}else{_0xd872ae=_0x49f603[_0x47cad0(0x131)]||_0x47cad0(0x125);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x47cad0(0x121)](_0x47cad0(0x131));}messages['push']({'role':'ai','content':_0xd872ae,'timestamp':Date[_0x47cad0(0xc8)]()}),localStorage['setItem'](_0x47cad0(0xbd),JSON[_0x47cad0(0xbf)](messages)),renderMessages();}function confirmDelete(_0x56d80f){const _0x4a0e43=a0_0x3c8ed0;if(mTitle)mTitle[_0x4a0e43(0xdd)]=_0x4a0e43(0xec);if(mText)mText['textContent']=_0x4a0e43(0xb8);modalCallback=()=>{const _0x478ab4=_0x4a0e43;messages[_0x478ab4(0xc9)](_0x56d80f,0x1),localStorage[_0x478ab4(0xe2)]('ai_chat_messages',JSON[_0x478ab4(0xbf)](messages)),renderMessages();},modal[_0x4a0e43(0xd3)][_0x4a0e43(0xd5)]('show');}if(clearBtn)clearBtn[a0_0x3c8ed0(0xef)]=()=>{const _0x4c4c3e=a0_0x3c8ed0;if(!messages['length'])return;if(mTitle)mTitle[_0x4c4c3e(0xdd)]=_0x4c4c3e(0xbc);if(mText)mText['textContent']=_0x4c4c3e(0xd2);modalCallback=async()=>{const _0x46898d=_0x4c4c3e;messages=[],localStorage[_0x46898d(0xe4)](_0x46898d(0xbd)),renderMessages(),callBackend(_0x46898d(0x120),{});},modal[_0x4c4c3e(0xd3)][_0x4c4c3e(0xd5)]('show');};document[a0_0x3c8ed0(0x110)](a0_0x3c8ed0(0xcf))[a0_0x3c8ed0(0xef)]=()=>modal[a0_0x3c8ed0(0xd3)][a0_0x3c8ed0(0x105)]('show'),document[a0_0x3c8ed0(0x110)](a0_0x3c8ed0(0xbe))['onclick']=()=>{const _0x19f9d3=a0_0x3c8ed0;if(modalCallback)modalCallback();modal['classList'][_0x19f9d3(0x105)](_0x19f9d3(0xe0));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x3c8ed0(0x11e),_0x368fd9=>{const _0x2bb696=a0_0x3c8ed0;_0x368fd9[_0x2bb696(0x117)]===_0x2bb696(0xd4)&&!_0x368fd9[_0x2bb696(0xca)]&&(_0x368fd9[_0x2bb696(0x101)](),sendMessage());}),sendBtn[a0_0x3c8ed0(0xef)]=sendMessage,document[a0_0x3c8ed0(0xeb)]('click',_0x32f988=>{const _0x820765=a0_0x3c8ed0;document[_0x820765(0x12a)](_0x820765(0x104))[_0x820765(0xcb)](_0x39d0ad=>{const _0x4d41fb=_0x820765;if(!_0x39d0ad[_0x4d41fb(0x10d)](_0x32f988[_0x4d41fb(0x10a)]))_0x39d0ad[_0x4d41fb(0xd3)][_0x4d41fb(0x105)]('show-delete');});});const saved=localStorage[a0_0x3c8ed0(0x12e)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x3c8ed0(0xd1)](saved),renderMessages();}catch(a0_0x50f839){}updateSendButton();