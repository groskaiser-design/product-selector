const a0_0x3c2557=a0_0x29c8;(function(_0x5e4c04,_0x5ceb5b){const _0x4b67ce=a0_0x29c8,_0xf8aae1=_0x5e4c04();while(!![]){try{const _0x5dcb62=parseInt(_0x4b67ce(0x172))/0x1+-parseInt(_0x4b67ce(0x116))/0x2+-parseInt(_0x4b67ce(0x137))/0x3+-parseInt(_0x4b67ce(0x15c))/0x4+-parseInt(_0x4b67ce(0x163))/0x5+parseInt(_0x4b67ce(0x16d))/0x6*(parseInt(_0x4b67ce(0x17f))/0x7)+parseInt(_0x4b67ce(0x131))/0x8;if(_0x5dcb62===_0x5ceb5b)break;else _0xf8aae1['push'](_0xf8aae1['shift']());}catch(_0x1086e6){_0xf8aae1['push'](_0xf8aae1['shift']());}}}(a0_0x357b,0x8bd8c));function a0_0x29c8(_0x5ef28a,_0x545115){_0x5ef28a=_0x5ef28a-0x108;const _0x1528aa=a0_0x357b();let _0x2708f5=_0x1528aa[_0x5ef28a];return _0x2708f5;}const tg=window[a0_0x3c2557(0x136)]?.['WebApp'],HOME_URL=a0_0x3c2557(0x17a);function setupTelegramBackButton(){const _0x2e928d=a0_0x3c2557;if(!tg)return;try{tg[_0x2e928d(0x164)](),tg['expand'](),tg['setHeaderColor']?.(_0x2e928d(0x128));if(tg[_0x2e928d(0x10f)]?.('6.1'))tg[_0x2e928d(0x161)]?.();const _0x5eae11=tg['BackButton'];if(_0x5eae11){_0x5eae11[_0x2e928d(0x170)]();if(typeof _0x5eae11[_0x2e928d(0x145)]===_0x2e928d(0x165))try{_0x5eae11['offClick']();}catch(_0x2d34e0){}_0x5eae11[_0x2e928d(0x166)](()=>{const _0x816e21=_0x2e928d;if(tg[_0x816e21(0x126)])tg[_0x816e21(0x126)][_0x816e21(0x14a)](_0x816e21(0x13d));location[_0x816e21(0x111)]=HOME_URL;});}}catch(_0x4a828e){console[_0x2e928d(0x159)](_0x2e928d(0x16a),_0x4a828e);}}(function initStableLayout(){const _0x2e7e7f=a0_0x3c2557,_0x3edc0b=(function(){let _0x49ec45=!![];return function(_0x31cf82,_0x7eb0c4){const _0x229861=_0x49ec45?function(){const _0x1c8e52=a0_0x29c8;if(_0x7eb0c4){const _0x8bd180=_0x7eb0c4[_0x1c8e52(0x15b)](_0x31cf82,arguments);return _0x7eb0c4=null,_0x8bd180;}}:function(){};return _0x49ec45=![],_0x229861;};}()),_0x5efc79=document[_0x2e7e7f(0x119)]('.container'),_0x35140b=document[_0x2e7e7f(0x142)]('inputArea'),_0x3f765=document['getElementById'](_0x2e7e7f(0x139)),_0x5c1201=document['getElementById'](_0x2e7e7f(0x167));function _0x8ac201(){const _0x57e5b6=_0x2e7e7f,_0x4eb728=_0x3edc0b(this,function(){const _0x20cee2=a0_0x29c8;return _0x4eb728[_0x20cee2(0x152)]()['search'](_0x20cee2(0x183))['toString']()['constructor'](_0x4eb728)[_0x20cee2(0x13a)]('(((.+)+)+)+$');});_0x4eb728();if(!_0x5efc79)return;const _0x26fa37=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x57e5b6(0x135)];_0x5efc79[_0x57e5b6(0x178)][_0x57e5b6(0x123)]=_0x26fa37+'px';if(_0x35140b){const _0x4ef887=_0x35140b[_0x57e5b6(0x182)];_0x3f765[_0x57e5b6(0x178)]['paddingBottom']=_0x4ef887+0x28+'px';}}tg?tg[_0x2e7e7f(0x17b)](_0x2e7e7f(0x176),({isStateStable:_0x2d8f87})=>{_0x8ac201();if(_0x2d8f87)requestAnimationFrame(()=>{_0x3f765['scrollTop']=_0x3f765['scrollHeight'];});}):window[_0x2e7e7f(0x10d)](_0x2e7e7f(0x177),_0x8ac201),_0x8ac201(),_0x5c1201&&(_0x5c1201['addEventListener']('input',()=>{requestAnimationFrame(_0x8ac201);}),_0x5c1201[_0x2e7e7f(0x10d)](_0x2e7e7f(0x171),()=>{setTimeout(()=>{const _0x77de80=a0_0x29c8;_0x3f765[_0x77de80(0x168)]=_0x3f765[_0x77de80(0x132)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3c2557(0x12a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3c2557(0x142)](a0_0x3c2557(0x139)),emptyState=document['getElementById']('emptyState'),messageInput=document['getElementById'](a0_0x3c2557(0x167)),sendBtn=document[a0_0x3c2557(0x142)]('sendBtn'),clearBtn=document[a0_0x3c2557(0x142)](a0_0x3c2557(0x179)),modal=document[a0_0x3c2557(0x142)](a0_0x3c2557(0x11b)),mTitle=document['getElementById'](a0_0x3c2557(0x14b)),mText=document['getElementById'](a0_0x3c2557(0x11e));let modalCallback=null;async function callBackend(_0xae0e54,_0x40b71f){const _0x251798=a0_0x3c2557,_0x530cb3=tg?.[_0x251798(0x108)]?.[_0x251798(0x114)]||{},_0x5a3d19=_0x530cb3['id']||localStorage[_0x251798(0x12d)](_0x251798(0x117))||'d-'+Math[_0x251798(0x124)](Math[_0x251798(0x186)]()*0x3b9aca00);if(!_0x530cb3['id'])localStorage[_0x251798(0x174)](_0x251798(0x117),_0x5a3d19);const _0x902f30={'action':_0xae0e54,'user_id':_0x5a3d19,'user_data':{'first_name':_0x530cb3[_0x251798(0x158)],'username':_0x530cb3[_0x251798(0x173)]},'init_data':tg?.[_0x251798(0x15f)]||'',..._0x40b71f},_0x39621f=new AbortController(),_0x540008=setTimeout(()=>_0x39621f[_0x251798(0x12b)](),REQUEST_TIMEOUT_MS);try{const _0x5aa3da=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x251798(0x125)},'body':JSON[_0x251798(0x14c)](_0x902f30),'signal':_0x39621f[_0x251798(0x150)]});return clearTimeout(_0x540008),await _0x5aa3da[_0x251798(0x121)]();}catch(_0x5a097f){return{'success':![],'error':String(_0x5a097f)};}}function formatTime(_0x3ef7b2){const _0x3c3f35=a0_0x3c2557,_0x45ec80=new Date(_0x3ef7b2);return String(_0x45ec80[_0x3c3f35(0x16e)]())['padStart'](0x2,'0')+':'+String(_0x45ec80[_0x3c3f35(0x15a)]())[_0x3c3f35(0x17d)](0x2,'0');}function createMessageElement(_0xaa5b74,_0x119f73){const _0x12bf12=a0_0x3c2557,_0x26917b=document[_0x12bf12(0x15d)](_0x12bf12(0x14f));_0x26917b[_0x12bf12(0x11c)]=_0x12bf12(0x14e)+_0xaa5b74[_0x12bf12(0x109)];const _0x17a6ba=document[_0x12bf12(0x15d)]('div');_0x17a6ba[_0x12bf12(0x11c)]=_0x12bf12(0x16b),_0x17a6ba[_0x12bf12(0x13f)]=_0xaa5b74[_0x12bf12(0x113)][_0x12bf12(0x10a)](/\n/g,_0x12bf12(0x15e));const _0xab4645=document[_0x12bf12(0x15d)](_0x12bf12(0x14f));_0xab4645[_0x12bf12(0x11c)]='delete-btn',_0xab4645[_0x12bf12(0x13f)]=_0x12bf12(0x181),_0xab4645['onclick']=_0x145a8f=>{const _0x1e0b6c=_0x12bf12;_0x145a8f[_0x1e0b6c(0x146)](),confirmDelete(_0x119f73);};let _0x250b49;_0x17a6ba[_0x12bf12(0x10d)](_0x12bf12(0x169),()=>_0x250b49=setTimeout(()=>{const _0x147e2b=_0x12bf12;_0x26917b['classList'][_0x147e2b(0x127)](_0x147e2b(0x13c));if(tg?.[_0x147e2b(0x126)])tg['HapticFeedback'][_0x147e2b(0x14a)](_0x147e2b(0x134));},0x1f4)),_0x17a6ba[_0x12bf12(0x10d)]('touchend',()=>clearTimeout(_0x250b49));const _0x95474=document[_0x12bf12(0x15d)](_0x12bf12(0x14f));return _0x95474[_0x12bf12(0x11c)]=_0x12bf12(0x12e),_0x95474[_0x12bf12(0x17c)]=formatTime(_0xaa5b74[_0x12bf12(0x13e)]),_0x26917b[_0x12bf12(0x120)](_0xab4645),_0x26917b[_0x12bf12(0x120)](_0x17a6ba),_0x26917b[_0x12bf12(0x120)](_0x95474),_0x26917b;}function createTypingIndicator(){const _0x35c516=a0_0x3c2557,_0x1cafcc=document[_0x35c516(0x15d)](_0x35c516(0x14f));return _0x1cafcc['className']=_0x35c516(0x153),_0x1cafcc['id']=_0x35c516(0x11a),_0x1cafcc['innerHTML']=_0x35c516(0x12c),_0x1cafcc;}function renderMessages(){const _0x383f6a=a0_0x3c2557;Array[_0x383f6a(0x143)](chatArea[_0x383f6a(0x115)])['forEach'](_0x3f67df=>{const _0x5ee471=_0x383f6a;if(_0x3f67df['id']!==_0x5ee471(0x130))_0x3f67df[_0x5ee471(0x112)]();}),messages[_0x383f6a(0x144)]>0x0?(emptyState[_0x383f6a(0x178)]['display']=_0x383f6a(0x16c),messages[_0x383f6a(0x157)]((_0xbfbf60,_0x2d3c37)=>chatArea[_0x383f6a(0x120)](createMessageElement(_0xbfbf60,_0x2d3c37)))):emptyState['style'][_0x383f6a(0x147)]=_0x383f6a(0x175),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x40df6c=a0_0x3c2557;messageInput[_0x40df6c(0x178)][_0x40df6c(0x123)]=_0x40df6c(0x10b),messageInput[_0x40df6c(0x178)]['height']=Math[_0x40df6c(0x129)](messageInput[_0x40df6c(0x132)],0x78)+'px';}function updateSendButton(){const _0x581df1=a0_0x3c2557,_0x153a86=messageInput[_0x581df1(0x11f)][_0x581df1(0x133)]();sendBtn['disabled']=!_0x153a86||isTyping;}async function sendMessage(){const _0x37502b=a0_0x3c2557,_0x476daa=messageInput[_0x37502b(0x11f)]['trim']();if(!_0x476daa||isTyping)return;if(tg?.[_0x37502b(0x126)])tg[_0x37502b(0x126)][_0x37502b(0x14a)]('light');messages[_0x37502b(0x148)]({'role':_0x37502b(0x114),'content':_0x476daa,'timestamp':Date[_0x37502b(0x10e)]()}),localStorage['setItem'](_0x37502b(0x149),JSON[_0x37502b(0x14c)](messages)),renderMessages(),messageInput[_0x37502b(0x11f)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x37502b(0x120)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x37502b(0x132)];const _0x4a2852=await callBackend(_0x37502b(0x151),{'message':_0x476daa});isTyping=![];const _0x311058=document['getElementById'](_0x37502b(0x11a));if(_0x311058)_0x311058['remove']();let _0x3ee988=_0x37502b(0x13b);if(_0x4a2852[_0x37502b(0x110)]){_0x3ee988=_0x4a2852[_0x37502b(0x14d)]||_0x37502b(0x118);if(tg?.['HapticFeedback'])tg[_0x37502b(0x126)][_0x37502b(0x16f)]('success');}else{_0x3ee988=_0x4a2852['error']||_0x37502b(0x185);if(tg?.[_0x37502b(0x126)])tg[_0x37502b(0x126)]['notificationOccurred']('error');}messages[_0x37502b(0x148)]({'role':'ai','content':_0x3ee988,'timestamp':Date['now']()}),localStorage['setItem'](_0x37502b(0x149),JSON[_0x37502b(0x14c)](messages)),renderMessages();}function confirmDelete(_0x623918){const _0x5978c6=a0_0x3c2557;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x5978c6(0x17c)]=_0x5978c6(0x10c);modalCallback=()=>{const _0x41ab9e=_0x5978c6;messages['splice'](_0x623918,0x1),localStorage[_0x41ab9e(0x174)](_0x41ab9e(0x149),JSON[_0x41ab9e(0x14c)](messages)),renderMessages();},modal[_0x5978c6(0x180)]['add'](_0x5978c6(0x170));}if(clearBtn)clearBtn['onclick']=()=>{const _0x5aaa9a=a0_0x3c2557;if(!messages[_0x5aaa9a(0x144)])return;if(mTitle)mTitle[_0x5aaa9a(0x17c)]='Очистить\x20историю?';if(mText)mText[_0x5aaa9a(0x17c)]=_0x5aaa9a(0x160);modalCallback=async()=>{const _0x4179c4=_0x5aaa9a;messages=[],localStorage[_0x4179c4(0x141)]('ai_chat_messages'),renderMessages(),callBackend(_0x4179c4(0x122),{});},modal[_0x5aaa9a(0x180)][_0x5aaa9a(0x127)](_0x5aaa9a(0x170));};document[a0_0x3c2557(0x142)](a0_0x3c2557(0x184))[a0_0x3c2557(0x11d)]=()=>modal[a0_0x3c2557(0x180)][a0_0x3c2557(0x112)](a0_0x3c2557(0x170)),document[a0_0x3c2557(0x142)](a0_0x3c2557(0x138))[a0_0x3c2557(0x11d)]=()=>{const _0xcdf6fa=a0_0x3c2557;if(modalCallback)modalCallback();modal['classList'][_0xcdf6fa(0x112)](_0xcdf6fa(0x170));},messageInput[a0_0x3c2557(0x10d)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3c2557(0x10d)](a0_0x3c2557(0x17e),_0x48986e=>{const _0x564b87=a0_0x3c2557;_0x48986e['key']==='Enter'&&!_0x48986e[_0x564b87(0x162)]&&(_0x48986e[_0x564b87(0x12f)](),sendMessage());}),sendBtn[a0_0x3c2557(0x11d)]=sendMessage,document[a0_0x3c2557(0x10d)](a0_0x3c2557(0x155),_0x16e031=>{const _0x43f543=a0_0x3c2557;document[_0x43f543(0x156)](_0x43f543(0x154))[_0x43f543(0x157)](_0x3948cb=>{const _0x4d4b19=_0x43f543;if(!_0x3948cb[_0x4d4b19(0x140)](_0x16e031['target']))_0x3948cb[_0x4d4b19(0x180)]['remove']('show-delete');});});const saved=localStorage[a0_0x3c2557(0x12d)](a0_0x3c2557(0x149));function a0_0x357b(){const _0x7fe0f1=['shiftKey','803000Rkyfmj','ready','function','onClick','messageInput','scrollTop','touchstart','TG\x20setup\x20error:','message-bubble','none','6uLIrDQ','getHours','notificationOccurred','show','focus','505206GEhmca','username','setItem','flex','viewportChanged','resize','style','clearBtn','./router.html','onEvent','textContent','padStart','keydown','291522YRjRoX','classList','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','offsetHeight','(((.+)+)+)+$','modalCancel','Ошибка\x20сервера','random','initDataUnsafe','role','replace','auto','Действие\x20необратимо.','addEventListener','now','isVersionAtLeast','success','href','remove','content','user','children','1745552YnlmwL','debug_uid','Пустой\x20ответ','querySelector','typingIndicator','confirmModal','className','onclick','modalText','value','appendChild','json','clear_history','height','floor','text/plain','HapticFeedback','add','#050505','min','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','abort','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','getItem','message-time','preventDefault','emptyState','17956184hpqbOG','scrollHeight','trim','medium','innerHeight','Telegram','2471574UJbgWf','modalConfirm','chatArea','search','Ошибка\x20сети','show-delete','light','timestamp','innerHTML','contains','removeItem','getElementById','from','length','offClick','stopPropagation','display','push','ai_chat_messages','impactOccurred','modalTitle','stringify','text','message\x20','div','signal','send_message','toString','message\x20ai','.message.show-delete','click','querySelectorAll','forEach','first_name','warn','getMinutes','apply','1445316hFKeuW','createElement','<br>','initData','Начнется\x20новый\x20диалог.','disableVerticalSwipes'];a0_0x357b=function(){return _0x7fe0f1;};return a0_0x357b();}if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x164ad9){}updateSendButton();