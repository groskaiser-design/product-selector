const a0_0x40e0be=a0_0x2df5;(function(_0x11ef58,_0x543938){const _0x1e1137=a0_0x2df5,_0x47284f=_0x11ef58();while(!![]){try{const _0x5256a4=-parseInt(_0x1e1137(0x1f5))/0x1*(-parseInt(_0x1e1137(0x1c8))/0x2)+parseInt(_0x1e1137(0x1db))/0x3+parseInt(_0x1e1137(0x1a0))/0x4*(-parseInt(_0x1e1137(0x1c6))/0x5)+parseInt(_0x1e1137(0x1eb))/0x6+parseInt(_0x1e1137(0x1ec))/0x7*(parseInt(_0x1e1137(0x1e3))/0x8)+-parseInt(_0x1e1137(0x209))/0x9+-parseInt(_0x1e1137(0x1b7))/0xa*(parseInt(_0x1e1137(0x1ca))/0xb);if(_0x5256a4===_0x543938)break;else _0x47284f['push'](_0x47284f['shift']());}catch(_0x3c0440){_0x47284f['push'](_0x47284f['shift']());}}}(a0_0x3419,0xbf89b));const tg=window[a0_0x40e0be(0x1f8)]?.[a0_0x40e0be(0x1e9)],HOME_URL=a0_0x40e0be(0x1f6);function setupTelegramBackButton(){const _0x46298b=a0_0x40e0be;if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x46298b(0x1e1)]?.(_0x46298b(0x20e));if(tg[_0x46298b(0x19d)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x3a073c=tg[_0x46298b(0x1e7)];if(_0x3a073c){_0x3a073c[_0x46298b(0x1d5)]();if(typeof _0x3a073c[_0x46298b(0x1bc)]===_0x46298b(0x1cd))try{_0x3a073c[_0x46298b(0x1bc)]();}catch(_0x2aa25c){}_0x3a073c[_0x46298b(0x212)](()=>{const _0x378730=_0x46298b;if(tg[_0x378730(0x1ac)])tg['HapticFeedback'][_0x378730(0x1bd)](_0x378730(0x1a3));location[_0x378730(0x1e8)]=HOME_URL;});}}catch(_0x12d8c2){console[_0x46298b(0x1c4)](_0x46298b(0x1f0),_0x12d8c2);}}(function initStableLayout(){const _0x100fca=a0_0x40e0be,_0x201256=(function(){let _0x5644f9=!![];return function(_0x59b945,_0x94c407){const _0xf5b1cd=_0x5644f9?function(){const _0x74d1d4=a0_0x2df5;if(_0x94c407){const _0x37652b=_0x94c407[_0x74d1d4(0x1dc)](_0x59b945,arguments);return _0x94c407=null,_0x37652b;}}:function(){};return _0x5644f9=![],_0xf5b1cd;};}()),_0x447d97=document[_0x100fca(0x1d0)](_0x100fca(0x20d)),_0x2d1ef6=document[_0x100fca(0x1cb)](_0x100fca(0x1b6)),_0x2cb76e=document[_0x100fca(0x1cb)](_0x100fca(0x1d8)),_0x41466f=document[_0x100fca(0x1cb)]('messageInput');function _0x27db3c(){const _0x146782=_0x100fca,_0x5dd859=_0x201256(this,function(){const _0x5e9385=a0_0x2df5;return _0x5dd859['toString']()[_0x5e9385(0x1a1)](_0x5e9385(0x1dd))[_0x5e9385(0x1a8)]()[_0x5e9385(0x1f1)](_0x5dd859)[_0x5e9385(0x1a1)](_0x5e9385(0x1dd));});_0x5dd859();if(!_0x447d97)return;const _0x2dac04=tg&&tg[_0x146782(0x1fd)]?tg[_0x146782(0x1fd)]:window['innerHeight'];_0x447d97[_0x146782(0x1a2)][_0x146782(0x1d6)]=_0x2dac04+'px';if(_0x2d1ef6){const _0x3a2cdb=_0x2d1ef6[_0x146782(0x1a9)];_0x2cb76e[_0x146782(0x1a2)]['paddingBottom']=_0x3a2cdb+0x28+'px';}}tg?tg['onEvent'](_0x100fca(0x1c7),({isStateStable:_0x31c8e7})=>{_0x27db3c();if(_0x31c8e7)requestAnimationFrame(()=>{const _0x4ed00a=a0_0x2df5;_0x2cb76e[_0x4ed00a(0x1cf)]=_0x2cb76e[_0x4ed00a(0x20c)];});}):window['addEventListener']('resize',_0x27db3c),_0x27db3c(),_0x41466f&&(_0x41466f['addEventListener'](_0x100fca(0x204),()=>{requestAnimationFrame(_0x27db3c);}),_0x41466f[_0x100fca(0x1c1)]('focus',()=>{setTimeout(()=>{const _0x35632f=a0_0x2df5;_0x2cb76e['scrollTop']=_0x2cb76e[_0x35632f(0x20c)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x3419(){const _0x40fef5=['json','message\x20ai','<br>','toString','offsetHeight','textContent','shiftKey','HapticFeedback','error','message-bubble','modalCancel','message\x20','signal','onclick','getMinutes','debug_uid','innerHTML','inputArea','481270pLvnKI','text','appendChild','delete-btn','floor','offClick','impactOccurred','notificationOccurred','className','touchstart','addEventListener','modalText','padStart','warn','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','2882805CzcRrS','viewportChanged','14bveoSA','success','187rkMDlB','getElementById','children','function','touchend','scrollTop','querySelector','.message.show-delete','push','getItem','createElement','show','height','random','chatArea','message-time','text/plain','3252015FdFPIc','apply','(((.+)+)+)+$','length','messageInput','min','setHeaderColor','display','176NnBAOO','initData','contains','now','BackButton','href','WebApp','keydown','2930382FYoCqR','341663gVYgKq','disabled','Enter','setItem','TG\x20setup\x20error:','constructor','medium','Очистить\x20историю?','click','143194wsOCnt','./router.html','ai_chat_messages','Telegram','div','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','value','preventDefault','viewportHeight','querySelectorAll','user','sendBtn','Ошибка\x20сети','Удалить?','emptyState','input','trim','Начнется\x20новый\x20диалог.','abort','none','13223691ovKHmt','show-delete','modalTitle','scrollHeight','.container','#050505','confirmModal','add','role','onClick','first_name','forEach','remove','initDataUnsafe','replace','Действие\x20необратимо.','stringify','from','isVersionAtLeast','POST','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','4WIMNuY','search','style','light','classList'];a0_0x3419=function(){return _0x40fef5;};return a0_0x3419();}const BACKEND_URL=a0_0x40e0be(0x1c5),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x40e0be(0x1d8)),emptyState=document[a0_0x40e0be(0x1cb)]('emptyState'),messageInput=document[a0_0x40e0be(0x1cb)](a0_0x40e0be(0x1df)),sendBtn=document[a0_0x40e0be(0x1cb)](a0_0x40e0be(0x200)),clearBtn=document[a0_0x40e0be(0x1cb)]('clearBtn'),modal=document[a0_0x40e0be(0x1cb)](a0_0x40e0be(0x20f)),mTitle=document[a0_0x40e0be(0x1cb)](a0_0x40e0be(0x20b)),mText=document[a0_0x40e0be(0x1cb)](a0_0x40e0be(0x1c2));let modalCallback=null;async function callBackend(_0x365329,_0x5010de){const _0x121fdc=a0_0x40e0be,_0x54bb8c=tg?.[_0x121fdc(0x216)]?.[_0x121fdc(0x1ff)]||{},_0x1e5e07=_0x54bb8c['id']||localStorage[_0x121fdc(0x1d3)](_0x121fdc(0x1b4))||'d-'+Math[_0x121fdc(0x1bb)](Math[_0x121fdc(0x1d7)]()*0x3b9aca00);if(!_0x54bb8c['id'])localStorage[_0x121fdc(0x1ef)]('debug_uid',_0x1e5e07);const _0x2089b5={'action':_0x365329,'user_id':_0x1e5e07,'user_data':{'first_name':_0x54bb8c[_0x121fdc(0x213)],'username':_0x54bb8c['username']},'init_data':tg?.[_0x121fdc(0x1e4)]||'',..._0x5010de},_0x9d5d6c=new AbortController(),_0x14dd6f=setTimeout(()=>_0x9d5d6c[_0x121fdc(0x207)](),REQUEST_TIMEOUT_MS);try{const _0x426bce=await fetch(BACKEND_URL,{'method':_0x121fdc(0x19e),'headers':{'Content-Type':_0x121fdc(0x1da)},'body':JSON['stringify'](_0x2089b5),'signal':_0x9d5d6c[_0x121fdc(0x1b1)]});return clearTimeout(_0x14dd6f),await _0x426bce[_0x121fdc(0x1a5)]();}catch(_0x235d78){return{'success':![],'error':String(_0x235d78)};}}function formatTime(_0xb4620c){const _0x36300f=a0_0x40e0be,_0x135933=new Date(_0xb4620c);return String(_0x135933['getHours']())[_0x36300f(0x1c3)](0x2,'0')+':'+String(_0x135933[_0x36300f(0x1b3)]())[_0x36300f(0x1c3)](0x2,'0');}function createMessageElement(_0x1767d8,_0x480994){const _0x424394=a0_0x40e0be,_0x5cec67=document[_0x424394(0x1d4)]('div');_0x5cec67[_0x424394(0x1bf)]=_0x424394(0x1b0)+_0x1767d8[_0x424394(0x211)];const _0x43535b=document[_0x424394(0x1d4)](_0x424394(0x1f9));_0x43535b[_0x424394(0x1bf)]=_0x424394(0x1ae),_0x43535b[_0x424394(0x1b5)]=_0x1767d8['content'][_0x424394(0x217)](/\n/g,_0x424394(0x1a7));const _0x4e825c=document[_0x424394(0x1d4)](_0x424394(0x1f9));_0x4e825c['className']=_0x424394(0x1ba),_0x4e825c['innerHTML']=_0x424394(0x1fa),_0x4e825c[_0x424394(0x1b2)]=_0x15f1e8=>{_0x15f1e8['stopPropagation'](),confirmDelete(_0x480994);};let _0x5616bb;_0x43535b[_0x424394(0x1c1)](_0x424394(0x1c0),()=>_0x5616bb=setTimeout(()=>{const _0x5af274=_0x424394;_0x5cec67[_0x5af274(0x1a4)][_0x5af274(0x210)](_0x5af274(0x20a));if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x5af274(0x1bd)](_0x5af274(0x1f2));},0x1f4)),_0x43535b[_0x424394(0x1c1)](_0x424394(0x1ce),()=>clearTimeout(_0x5616bb));const _0xf14e6a=document['createElement'](_0x424394(0x1f9));return _0xf14e6a[_0x424394(0x1bf)]=_0x424394(0x1d9),_0xf14e6a[_0x424394(0x1aa)]=formatTime(_0x1767d8['timestamp']),_0x5cec67[_0x424394(0x1b9)](_0x4e825c),_0x5cec67['appendChild'](_0x43535b),_0x5cec67['appendChild'](_0xf14e6a),_0x5cec67;}function createTypingIndicator(){const _0x294c42=a0_0x40e0be,_0x1a653f=document[_0x294c42(0x1d4)](_0x294c42(0x1f9));return _0x1a653f[_0x294c42(0x1bf)]=_0x294c42(0x1a6),_0x1a653f['id']='typingIndicator',_0x1a653f[_0x294c42(0x1b5)]=_0x294c42(0x19f),_0x1a653f;}function renderMessages(){const _0x2862c6=a0_0x40e0be;Array[_0x2862c6(0x21a)](chatArea[_0x2862c6(0x1cc)])[_0x2862c6(0x214)](_0x327dc2=>{const _0x5c5374=_0x2862c6;if(_0x327dc2['id']!==_0x5c5374(0x203))_0x327dc2['remove']();}),messages[_0x2862c6(0x1de)]>0x0?(emptyState[_0x2862c6(0x1a2)][_0x2862c6(0x1e2)]=_0x2862c6(0x208),messages[_0x2862c6(0x214)]((_0x495e0e,_0x491661)=>chatArea[_0x2862c6(0x1b9)](createMessageElement(_0x495e0e,_0x491661)))):emptyState[_0x2862c6(0x1a2)][_0x2862c6(0x1e2)]='flex',requestAnimationFrame(()=>chatArea[_0x2862c6(0x1cf)]=chatArea[_0x2862c6(0x20c)]);}function autoResizeTextarea(){const _0x103cb4=a0_0x40e0be;messageInput[_0x103cb4(0x1a2)][_0x103cb4(0x1d6)]='auto',messageInput['style'][_0x103cb4(0x1d6)]=Math[_0x103cb4(0x1e0)](messageInput['scrollHeight'],0x78)+'px';}function a0_0x2df5(_0x4dcca4,_0x1f6bbd){_0x4dcca4=_0x4dcca4-0x19d;const _0x20f338=a0_0x3419();let _0x2089c9=_0x20f338[_0x4dcca4];return _0x2089c9;}function updateSendButton(){const _0x45a140=a0_0x40e0be,_0x42388f=messageInput[_0x45a140(0x1fb)][_0x45a140(0x205)]();sendBtn[_0x45a140(0x1ed)]=!_0x42388f||isTyping;}async function sendMessage(){const _0x1afca7=a0_0x40e0be,_0x1baf8e=messageInput[_0x1afca7(0x1fb)][_0x1afca7(0x205)]();if(!_0x1baf8e||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x1afca7(0x1ac)][_0x1afca7(0x1bd)]('light');messages[_0x1afca7(0x1d2)]({'role':_0x1afca7(0x1ff),'content':_0x1baf8e,'timestamp':Date['now']()}),localStorage[_0x1afca7(0x1ef)](_0x1afca7(0x1f7),JSON[_0x1afca7(0x219)](messages)),renderMessages(),messageInput[_0x1afca7(0x1fb)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1afca7(0x1b9)](createTypingIndicator()),chatArea[_0x1afca7(0x1cf)]=chatArea[_0x1afca7(0x20c)];const _0x116a2d=await callBackend('send_message',{'message':_0x1baf8e});isTyping=![];const _0x1f3dc4=document[_0x1afca7(0x1cb)]('typingIndicator');if(_0x1f3dc4)_0x1f3dc4[_0x1afca7(0x215)]();let _0x5da389=_0x1afca7(0x201);if(_0x116a2d[_0x1afca7(0x1c9)]){_0x5da389=_0x116a2d[_0x1afca7(0x1b8)]||'Пустой\x20ответ';if(tg?.[_0x1afca7(0x1ac)])tg[_0x1afca7(0x1ac)]['notificationOccurred']('success');}else{_0x5da389=_0x116a2d['error']||'Ошибка\x20сервера';if(tg?.[_0x1afca7(0x1ac)])tg[_0x1afca7(0x1ac)][_0x1afca7(0x1be)](_0x1afca7(0x1ad));}messages[_0x1afca7(0x1d2)]({'role':'ai','content':_0x5da389,'timestamp':Date[_0x1afca7(0x1e6)]()}),localStorage[_0x1afca7(0x1ef)](_0x1afca7(0x1f7),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0xb52b46){const _0x2a28e6=a0_0x40e0be;if(mTitle)mTitle[_0x2a28e6(0x1aa)]=_0x2a28e6(0x202);if(mText)mText[_0x2a28e6(0x1aa)]=_0x2a28e6(0x218);modalCallback=()=>{const _0xb4f84=_0x2a28e6;messages['splice'](_0xb52b46,0x1),localStorage['setItem'](_0xb4f84(0x1f7),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x2a28e6(0x210)](_0x2a28e6(0x1d5));}if(clearBtn)clearBtn[a0_0x40e0be(0x1b2)]=()=>{const _0x35d0fe=a0_0x40e0be;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x35d0fe(0x1f3);if(mText)mText['textContent']=_0x35d0fe(0x206);modalCallback=async()=>{const _0x109366=_0x35d0fe;messages=[],localStorage['removeItem'](_0x109366(0x1f7)),renderMessages(),callBackend('clear_history',{});},modal[_0x35d0fe(0x1a4)][_0x35d0fe(0x210)](_0x35d0fe(0x1d5));};document[a0_0x40e0be(0x1cb)](a0_0x40e0be(0x1af))[a0_0x40e0be(0x1b2)]=()=>modal[a0_0x40e0be(0x1a4)][a0_0x40e0be(0x215)]('show'),document[a0_0x40e0be(0x1cb)]('modalConfirm')[a0_0x40e0be(0x1b2)]=()=>{const _0x4c2824=a0_0x40e0be;if(modalCallback)modalCallback();modal[_0x4c2824(0x1a4)][_0x4c2824(0x215)](_0x4c2824(0x1d5));},messageInput[a0_0x40e0be(0x1c1)](a0_0x40e0be(0x204),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x40e0be(0x1c1)](a0_0x40e0be(0x1ea),_0x270f65=>{const _0x27597e=a0_0x40e0be;_0x270f65['key']===_0x27597e(0x1ee)&&!_0x270f65[_0x27597e(0x1ab)]&&(_0x270f65[_0x27597e(0x1fc)](),sendMessage());}),sendBtn[a0_0x40e0be(0x1b2)]=sendMessage,document[a0_0x40e0be(0x1c1)](a0_0x40e0be(0x1f4),_0x1ba19f=>{const _0x52e416=a0_0x40e0be;document[_0x52e416(0x1fe)](_0x52e416(0x1d1))['forEach'](_0x832b9c=>{const _0x155090=_0x52e416;if(!_0x832b9c[_0x155090(0x1e5)](_0x1ba19f['target']))_0x832b9c['classList'][_0x155090(0x215)](_0x155090(0x20a));});});const saved=localStorage[a0_0x40e0be(0x1d3)](a0_0x40e0be(0x1f7));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x2079f8){}updateSendButton();