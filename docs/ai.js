const a0_0x40e09a=a0_0x1ee7;function a0_0x14d3(){const _0xf81d56=['stopPropagation','role','json','show','parse','splice','light','replace','3593420maKztj','Enter','offClick','querySelectorAll','offsetHeight','querySelector','from','first_name','flex','min','timestamp','Telegram','chatArea','toString','textContent','getItem','value','username','classList','debug_uid','clear_history','setItem','Начнется\x20новый\x20диалог.','error','clearBtn','message-time','393993eregiG','initData','message-bubble','viewportChanged','auto','isVersionAtLeast','floor','notificationOccurred','scrollHeight','797880yFhqat','4947432JkRdTJ','random','display','focus','./router.html','impactOccurred','search','user','confirmModal','preventDefault','target','remove','function','Очистить\x20историю?','6.1','onclick','constructor','viewportHeight','resize','#050505','content','inputArea','modalCancel','onEvent','div','innerHTML','TG\x20setup\x20error:','5bogyYy','children','send_message','medium','Ошибка\x20сети','style','sendBtn','modalConfirm','setHeaderColor','length','expand','padStart','BackButton','disabled','paddingBottom','emptyState','forEach','typingIndicator','Удалить?','text','503962ubZGGO','removeItem','136vZFONT','push','Ошибка\x20сервера','HapticFeedback','3285264kKdKSG','message\x20','disableVerticalSwipes','now','message\x20ai','createElement','touchstart','add','height','appendChild','stringify','success','ready','messageInput','none','ai_chat_messages','onClick','delete-btn','trim','scrollTop','3323022ImQcwd','href','Пустой\x20ответ','modalText','getElementById','abort','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','text/plain','show-delete','apply','addEventListener','className','2TSmlKy','<br>','.message.show-delete','(((.+)+)+)+$'];a0_0x14d3=function(){return _0xf81d56;};return a0_0x14d3();}(function(_0x456969,_0x1e5326){const _0x2a45fe=a0_0x1ee7,_0x551867=_0x456969();while(!![]){try{const _0x8263c0=-parseInt(_0x2a45fe(0x1df))/0x1*(-parseInt(_0x2a45fe(0x180))/0x2)+parseInt(_0x2a45fe(0x1af))/0x3+parseInt(_0x2a45fe(0x1e5))/0x4+parseInt(_0x2a45fe(0x1cb))/0x5*(-parseInt(_0x2a45fe(0x1f9))/0x6)+-parseInt(_0x2a45fe(0x1b0))/0x7+parseInt(_0x2a45fe(0x1e1))/0x8*(parseInt(_0x2a45fe(0x1a6))/0x9)+-parseInt(_0x2a45fe(0x18c))/0xa;if(_0x8263c0===_0x1e5326)break;else _0x551867['push'](_0x551867['shift']());}catch(_0x5b1807){_0x551867['push'](_0x551867['shift']());}}}(a0_0x14d3,0xaeae4));const tg=window[a0_0x40e09a(0x197)]?.['WebApp'],HOME_URL=a0_0x40e09a(0x1b4);function setupTelegramBackButton(){const _0xaa8824=a0_0x40e09a;if(!tg)return;try{tg[_0xaa8824(0x1f1)](),tg[_0xaa8824(0x1d5)](),tg[_0xaa8824(0x1d3)]?.(_0xaa8824(0x1c3));if(tg[_0xaa8824(0x1ab)]?.(_0xaa8824(0x1be)))tg[_0xaa8824(0x1e7)]?.();const _0x3e3f4e=tg[_0xaa8824(0x1d7)];if(_0x3e3f4e){_0x3e3f4e['show']();if(typeof _0x3e3f4e['offClick']===_0xaa8824(0x1bc))try{_0x3e3f4e[_0xaa8824(0x18e)]();}catch(_0x4a5dc3){}_0x3e3f4e[_0xaa8824(0x1f5)](()=>{const _0x5305e6=_0xaa8824;if(tg[_0x5305e6(0x1e4)])tg[_0x5305e6(0x1e4)]['impactOccurred'](_0x5305e6(0x18a));location[_0x5305e6(0x1fa)]=HOME_URL;});}}catch(_0x39a0c2){console['warn'](_0xaa8824(0x1ca),_0x39a0c2);}}(function initStableLayout(){const _0x40aedc=a0_0x40e09a,_0x5e968a=(function(){let _0x5bb931=!![];return function(_0x45365a,_0x16d117){const _0x32d6b1=_0x5bb931?function(){const _0x40f33c=a0_0x1ee7;if(_0x16d117){const _0x558103=_0x16d117[_0x40f33c(0x17d)](_0x45365a,arguments);return _0x16d117=null,_0x558103;}}:function(){};return _0x5bb931=![],_0x32d6b1;};}()),_0x26aff8=document[_0x40aedc(0x191)]('.container'),_0x46ef5f=document[_0x40aedc(0x1fd)](_0x40aedc(0x1c5)),_0x3a76dc=document[_0x40aedc(0x1fd)](_0x40aedc(0x198)),_0x10c3d7=document[_0x40aedc(0x1fd)]('messageInput');function _0x260a3d(){const _0x2b245b=_0x40aedc,_0x3603d1=_0x5e968a(this,function(){const _0x4f0362=a0_0x1ee7;return _0x3603d1[_0x4f0362(0x199)]()[_0x4f0362(0x1b6)](_0x4f0362(0x183))[_0x4f0362(0x199)]()[_0x4f0362(0x1c0)](_0x3603d1)[_0x4f0362(0x1b6)](_0x4f0362(0x183));});_0x3603d1();if(!_0x26aff8)return;const _0x1e2216=tg&&tg['viewportHeight']?tg[_0x2b245b(0x1c1)]:window['innerHeight'];_0x26aff8[_0x2b245b(0x1d0)][_0x2b245b(0x1ed)]=_0x1e2216+'px';if(_0x46ef5f){const _0xea45ca=_0x46ef5f[_0x2b245b(0x190)];_0x3a76dc[_0x2b245b(0x1d0)][_0x2b245b(0x1d9)]=_0xea45ca+0x28+'px';}}tg?tg[_0x40aedc(0x1c7)](_0x40aedc(0x1a9),({isStateStable:_0x2f3583})=>{_0x260a3d();if(_0x2f3583)requestAnimationFrame(()=>{const _0xff92e4=a0_0x1ee7;_0x3a76dc[_0xff92e4(0x1f8)]=_0x3a76dc[_0xff92e4(0x1ae)];});}):window[_0x40aedc(0x17e)](_0x40aedc(0x1c2),_0x260a3d),_0x260a3d(),_0x10c3d7&&(_0x10c3d7['addEventListener']('input',()=>{requestAnimationFrame(_0x260a3d);}),_0x10c3d7[_0x40aedc(0x17e)](_0x40aedc(0x1b3),()=>{setTimeout(()=>{const _0x51fe45=a0_0x1ee7;_0x3a76dc[_0x51fe45(0x1f8)]=_0x3a76dc[_0x51fe45(0x1ae)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x40e09a(0x1fd)](a0_0x40e09a(0x198)),emptyState=document['getElementById'](a0_0x40e09a(0x1da)),messageInput=document[a0_0x40e09a(0x1fd)](a0_0x40e09a(0x1f2)),sendBtn=document['getElementById'](a0_0x40e09a(0x1d1)),clearBtn=document[a0_0x40e09a(0x1fd)](a0_0x40e09a(0x1a4)),modal=document[a0_0x40e09a(0x1fd)](a0_0x40e09a(0x1b8)),mTitle=document[a0_0x40e09a(0x1fd)]('modalTitle'),mText=document['getElementById'](a0_0x40e09a(0x1fc));let modalCallback=null;async function callBackend(_0x3b62bb,_0x29fa83){const _0x27a9fe=a0_0x40e09a,_0x77b617=tg?.['initDataUnsafe']?.[_0x27a9fe(0x1b7)]||{},_0xfd8844=_0x77b617['id']||localStorage[_0x27a9fe(0x19b)](_0x27a9fe(0x19f))||'d-'+Math[_0x27a9fe(0x1ac)](Math[_0x27a9fe(0x1b1)]()*0x3b9aca00);if(!_0x77b617['id'])localStorage['setItem'](_0x27a9fe(0x19f),_0xfd8844);const _0x2dea21={'action':_0x3b62bb,'user_id':_0xfd8844,'user_data':{'first_name':_0x77b617[_0x27a9fe(0x193)],'username':_0x77b617[_0x27a9fe(0x19d)]},'init_data':tg?.[_0x27a9fe(0x1a7)]||'',..._0x29fa83},_0x220baa=new AbortController(),_0x50c325=setTimeout(()=>_0x220baa[_0x27a9fe(0x1fe)](),REQUEST_TIMEOUT_MS);try{const _0x55b3ea=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x27a9fe(0x200)},'body':JSON['stringify'](_0x2dea21),'signal':_0x220baa['signal']});return clearTimeout(_0x50c325),await _0x55b3ea[_0x27a9fe(0x186)]();}catch(_0x5a5a72){return{'success':![],'error':String(_0x5a5a72)};}}function formatTime(_0x44a5d3){const _0xadbea0=a0_0x40e09a,_0x5174e1=new Date(_0x44a5d3);return String(_0x5174e1['getHours']())[_0xadbea0(0x1d6)](0x2,'0')+':'+String(_0x5174e1['getMinutes']())[_0xadbea0(0x1d6)](0x2,'0');}function createMessageElement(_0xf30f04,_0x8efbf){const _0x34b745=a0_0x40e09a,_0x13e41a=document[_0x34b745(0x1ea)](_0x34b745(0x1c8));_0x13e41a['className']=_0x34b745(0x1e6)+_0xf30f04[_0x34b745(0x185)];const _0x411a3f=document[_0x34b745(0x1ea)](_0x34b745(0x1c8));_0x411a3f[_0x34b745(0x17f)]=_0x34b745(0x1a8),_0x411a3f[_0x34b745(0x1c9)]=_0xf30f04[_0x34b745(0x1c4)][_0x34b745(0x18b)](/\n/g,_0x34b745(0x181));const _0x54f1fe=document[_0x34b745(0x1ea)](_0x34b745(0x1c8));_0x54f1fe['className']=_0x34b745(0x1f6),_0x54f1fe[_0x34b745(0x1c9)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x54f1fe[_0x34b745(0x1bf)]=_0x375304=>{const _0x3bcb1a=_0x34b745;_0x375304[_0x3bcb1a(0x184)](),confirmDelete(_0x8efbf);};let _0xa2c8bf;_0x411a3f[_0x34b745(0x17e)](_0x34b745(0x1eb),()=>_0xa2c8bf=setTimeout(()=>{const _0x53b583=_0x34b745;_0x13e41a[_0x53b583(0x19e)]['add'](_0x53b583(0x17c));if(tg?.[_0x53b583(0x1e4)])tg['HapticFeedback'][_0x53b583(0x1b5)](_0x53b583(0x1ce));},0x1f4)),_0x411a3f[_0x34b745(0x17e)]('touchend',()=>clearTimeout(_0xa2c8bf));const _0x101269=document[_0x34b745(0x1ea)](_0x34b745(0x1c8));return _0x101269[_0x34b745(0x17f)]=_0x34b745(0x1a5),_0x101269['textContent']=formatTime(_0xf30f04[_0x34b745(0x196)]),_0x13e41a[_0x34b745(0x1ee)](_0x54f1fe),_0x13e41a[_0x34b745(0x1ee)](_0x411a3f),_0x13e41a[_0x34b745(0x1ee)](_0x101269),_0x13e41a;}function createTypingIndicator(){const _0x47aae0=a0_0x40e09a,_0x537c96=document['createElement'](_0x47aae0(0x1c8));return _0x537c96['className']=_0x47aae0(0x1e9),_0x537c96['id']=_0x47aae0(0x1dc),_0x537c96[_0x47aae0(0x1c9)]=_0x47aae0(0x1ff),_0x537c96;}function renderMessages(){const _0x24c5a2=a0_0x40e09a;Array[_0x24c5a2(0x192)](chatArea[_0x24c5a2(0x1cc)])['forEach'](_0x2fb51c=>{const _0x436148=_0x24c5a2;if(_0x2fb51c['id']!==_0x436148(0x1da))_0x2fb51c[_0x436148(0x1bb)]();}),messages[_0x24c5a2(0x1d4)]>0x0?(emptyState[_0x24c5a2(0x1d0)][_0x24c5a2(0x1b2)]=_0x24c5a2(0x1f3),messages[_0x24c5a2(0x1db)]((_0x61a9ac,_0x20dc8d)=>chatArea[_0x24c5a2(0x1ee)](createMessageElement(_0x61a9ac,_0x20dc8d)))):emptyState[_0x24c5a2(0x1d0)][_0x24c5a2(0x1b2)]=_0x24c5a2(0x194),requestAnimationFrame(()=>chatArea[_0x24c5a2(0x1f8)]=chatArea[_0x24c5a2(0x1ae)]);}function a0_0x1ee7(_0x49476f,_0x4fa18d){_0x49476f=_0x49476f-0x17c;const _0x13059b=a0_0x14d3();let _0x56cc9e=_0x13059b[_0x49476f];return _0x56cc9e;}function autoResizeTextarea(){const _0x29c0f3=a0_0x40e09a;messageInput[_0x29c0f3(0x1d0)][_0x29c0f3(0x1ed)]=_0x29c0f3(0x1aa),messageInput[_0x29c0f3(0x1d0)][_0x29c0f3(0x1ed)]=Math[_0x29c0f3(0x195)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x442cc8=a0_0x40e09a,_0x50c0ea=messageInput[_0x442cc8(0x19c)]['trim']();sendBtn[_0x442cc8(0x1d8)]=!_0x50c0ea||isTyping;}async function sendMessage(){const _0x52ff83=a0_0x40e09a,_0x565eec=messageInput[_0x52ff83(0x19c)][_0x52ff83(0x1f7)]();if(!_0x565eec||isTyping)return;if(tg?.[_0x52ff83(0x1e4)])tg['HapticFeedback'][_0x52ff83(0x1b5)](_0x52ff83(0x18a));messages[_0x52ff83(0x1e2)]({'role':'user','content':_0x565eec,'timestamp':Date[_0x52ff83(0x1e8)]()}),localStorage['setItem'](_0x52ff83(0x1f4),JSON['stringify'](messages)),renderMessages(),messageInput[_0x52ff83(0x19c)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x52ff83(0x1ee)](createTypingIndicator()),chatArea[_0x52ff83(0x1f8)]=chatArea[_0x52ff83(0x1ae)];const _0x2a714b=await callBackend(_0x52ff83(0x1cd),{'message':_0x565eec});isTyping=![];const _0x99ba33=document[_0x52ff83(0x1fd)](_0x52ff83(0x1dc));if(_0x99ba33)_0x99ba33[_0x52ff83(0x1bb)]();let _0x3eb5f4=_0x52ff83(0x1cf);if(_0x2a714b[_0x52ff83(0x1f0)]){_0x3eb5f4=_0x2a714b[_0x52ff83(0x1de)]||_0x52ff83(0x1fb);if(tg?.['HapticFeedback'])tg[_0x52ff83(0x1e4)][_0x52ff83(0x1ad)](_0x52ff83(0x1f0));}else{_0x3eb5f4=_0x2a714b[_0x52ff83(0x1a3)]||_0x52ff83(0x1e3);if(tg?.[_0x52ff83(0x1e4)])tg[_0x52ff83(0x1e4)]['notificationOccurred']('error');}messages[_0x52ff83(0x1e2)]({'role':'ai','content':_0x3eb5f4,'timestamp':Date[_0x52ff83(0x1e8)]()}),localStorage[_0x52ff83(0x1a1)]('ai_chat_messages',JSON[_0x52ff83(0x1ef)](messages)),renderMessages();}function confirmDelete(_0x546475){const _0x58fee4=a0_0x40e09a;if(mTitle)mTitle[_0x58fee4(0x19a)]=_0x58fee4(0x1dd);if(mText)mText[_0x58fee4(0x19a)]='Действие\x20необратимо.';modalCallback=()=>{const _0x42203a=_0x58fee4;messages[_0x42203a(0x189)](_0x546475,0x1),localStorage[_0x42203a(0x1a1)](_0x42203a(0x1f4),JSON[_0x42203a(0x1ef)](messages)),renderMessages();},modal[_0x58fee4(0x19e)][_0x58fee4(0x1ec)](_0x58fee4(0x187));}if(clearBtn)clearBtn[a0_0x40e09a(0x1bf)]=()=>{const _0x2a1f97=a0_0x40e09a;if(!messages[_0x2a1f97(0x1d4)])return;if(mTitle)mTitle[_0x2a1f97(0x19a)]=_0x2a1f97(0x1bd);if(mText)mText[_0x2a1f97(0x19a)]=_0x2a1f97(0x1a2);modalCallback=async()=>{const _0x1ecd3d=_0x2a1f97;messages=[],localStorage[_0x1ecd3d(0x1e0)](_0x1ecd3d(0x1f4)),renderMessages(),callBackend(_0x1ecd3d(0x1a0),{});},modal['classList']['add'](_0x2a1f97(0x187));};document[a0_0x40e09a(0x1fd)](a0_0x40e09a(0x1c6))[a0_0x40e09a(0x1bf)]=()=>modal['classList'][a0_0x40e09a(0x1bb)](a0_0x40e09a(0x187)),document[a0_0x40e09a(0x1fd)](a0_0x40e09a(0x1d2))[a0_0x40e09a(0x1bf)]=()=>{const _0x43d671=a0_0x40e09a;if(modalCallback)modalCallback();modal[_0x43d671(0x19e)][_0x43d671(0x1bb)](_0x43d671(0x187));},messageInput[a0_0x40e09a(0x17e)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x2f6b9a=>{const _0x1fd1b2=a0_0x40e09a;_0x2f6b9a['key']===_0x1fd1b2(0x18d)&&!_0x2f6b9a['shiftKey']&&(_0x2f6b9a[_0x1fd1b2(0x1b9)](),sendMessage());}),sendBtn[a0_0x40e09a(0x1bf)]=sendMessage,document['addEventListener']('click',_0x30baec=>{const _0x467f9b=a0_0x40e09a;document[_0x467f9b(0x18f)](_0x467f9b(0x182))[_0x467f9b(0x1db)](_0xf24459=>{const _0x4e8a62=_0x467f9b;if(!_0xf24459['contains'](_0x30baec[_0x4e8a62(0x1ba)]))_0xf24459[_0x4e8a62(0x19e)][_0x4e8a62(0x1bb)](_0x4e8a62(0x17c));});});const saved=localStorage['getItem'](a0_0x40e09a(0x1f4));if(saved)try{messages=JSON[a0_0x40e09a(0x188)](saved),renderMessages();}catch(a0_0x315030){}updateSendButton();