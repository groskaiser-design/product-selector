const a0_0x2f78d8=a0_0x5c4b;(function(_0xd6ad17,_0x19ae27){const _0x483796=a0_0x5c4b,_0xd5acb1=_0xd6ad17();while(!![]){try{const _0x136a70=parseInt(_0x483796(0x13d))/0x1+parseInt(_0x483796(0x13b))/0x2*(-parseInt(_0x483796(0x170))/0x3)+-parseInt(_0x483796(0x176))/0x4*(parseInt(_0x483796(0x152))/0x5)+-parseInt(_0x483796(0x14b))/0x6*(parseInt(_0x483796(0x145))/0x7)+-parseInt(_0x483796(0x16b))/0x8+parseInt(_0x483796(0x184))/0x9+parseInt(_0x483796(0x147))/0xa*(parseInt(_0x483796(0x17e))/0xb);if(_0x136a70===_0x19ae27)break;else _0xd5acb1['push'](_0xd5acb1['shift']());}catch(_0x58fdba){_0xd5acb1['push'](_0xd5acb1['shift']());}}}(a0_0x3605,0xba080));const tg=window[a0_0x2f78d8(0x150)]?.['WebApp'],HOME_URL=a0_0x2f78d8(0x1aa);function setupTelegramBackButton(){const _0x33bf88=a0_0x2f78d8,_0x460de8=(function(){let _0x4edea6=!![];return function(_0x478e36,_0x298fbf){const _0x18452c=_0x4edea6?function(){const _0x3cb187=a0_0x5c4b;if(_0x298fbf){const _0x1d5cba=_0x298fbf[_0x3cb187(0x181)](_0x478e36,arguments);return _0x298fbf=null,_0x1d5cba;}}:function(){};return _0x4edea6=![],_0x18452c;};}()),_0x2c0a4d=_0x460de8(this,function(){const _0x37fd11=a0_0x5c4b;return _0x2c0a4d[_0x37fd11(0x15d)]()['search']('(((.+)+)+)+$')[_0x37fd11(0x15d)]()[_0x37fd11(0x189)](_0x2c0a4d)['search']('(((.+)+)+)+$');});_0x2c0a4d();if(!tg)return;try{tg[_0x33bf88(0x165)](),tg[_0x33bf88(0x137)](),tg[_0x33bf88(0x1a7)]?.(_0x33bf88(0x18d));if(tg[_0x33bf88(0x160)]?.(_0x33bf88(0x166)))tg['disableVerticalSwipes']?.();const _0x1f5a6b=tg['BackButton'];if(_0x1f5a6b){_0x1f5a6b[_0x33bf88(0x15e)]();if(typeof _0x1f5a6b[_0x33bf88(0x168)]==='function')try{_0x1f5a6b[_0x33bf88(0x168)]();}catch(_0x171582){}_0x1f5a6b[_0x33bf88(0x19d)](()=>{const _0x4c4fe5=_0x33bf88;if(tg[_0x4c4fe5(0x144)])tg[_0x4c4fe5(0x144)][_0x4c4fe5(0x18a)]('light');location['href']=HOME_URL;});}}catch(_0xf1296d){console[_0x33bf88(0x175)](_0x33bf88(0x171),_0xf1296d);}}(function initStableLayout(){const _0x363563=a0_0x2f78d8,_0x4a5f99=document[_0x363563(0x1a2)](_0x363563(0x19a)),_0x3247cf=document['getElementById'](_0x363563(0x1a1)),_0x780ca1=document[_0x363563(0x14a)](_0x363563(0x164)),_0x20bfb6=document[_0x363563(0x14a)]('messageInput');function _0x2680ed(){const _0x289514=_0x363563;if(!_0x4a5f99)return;const _0x2959e0=tg&&tg[_0x289514(0x140)]?tg[_0x289514(0x140)]:window[_0x289514(0x173)];_0x4a5f99[_0x289514(0x178)][_0x289514(0x163)]=_0x2959e0+'px';if(_0x3247cf){const _0x547bb5=_0x3247cf[_0x289514(0x131)];_0x780ca1['style']['paddingBottom']=_0x547bb5+0x28+'px';}}tg?tg[_0x363563(0x17d)](_0x363563(0x167),({isStateStable:_0x30b016})=>{_0x2680ed();if(_0x30b016)requestAnimationFrame(()=>{const _0x31f4f9=a0_0x5c4b;_0x780ca1['scrollTop']=_0x780ca1[_0x31f4f9(0x16d)];});}):window[_0x363563(0x146)](_0x363563(0x195),_0x2680ed),_0x2680ed(),_0x20bfb6&&(_0x20bfb6[_0x363563(0x146)](_0x363563(0x17f),()=>{requestAnimationFrame(_0x2680ed);}),_0x20bfb6[_0x363563(0x146)]('focus',()=>{setTimeout(()=>{const _0x5f07c0=a0_0x5c4b;_0x780ca1['scrollTop']=_0x780ca1[_0x5f07c0(0x16d)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x3605(){const _0x3a370a=['target','light','Ошибка\x20сети','keydown','className','toString','show','Ошибка\x20сервера','isVersionAtLeast','content','emptyState','height','chatArea','ready','6.1','viewportChanged','offClick','message-time','POST','5879264PDCQfX','div','scrollHeight','children','<br>','63927nMNECQ','TG\x20setup\x20error:','display','innerHeight','getHours','warn','30712BLRMgI','now','style','modalText','add','abort','remove','onEvent','77473PtgoUi','input','show-delete','apply','flex','username','5537205osSchS','Пустой\x20ответ','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','setItem','onclick','constructor','impactOccurred','delete-btn','send_message','#050505','confirmModal','contains','classList','signal','modalConfirm','ai_chat_messages','innerHTML','resize','message\x20','forEach','debug_uid','error','.container','click','value','onClick','text','from','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','inputArea','querySelector','removeItem','Действие\x20необратимо.','replace','Очистить\x20историю?','setHeaderColor','appendChild','key','./router.html','timestamp','length','messageInput','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','disabled','role','offsetHeight','scrollTop','trim','random','first_name','auto','expand','initData','modalCancel','text/plain','14WXqwkz','push','1176819xKRjYw','textContent','Начнется\x20новый\x20диалог.','viewportHeight','preventDefault','touchstart','clear_history','HapticFeedback','77HpMyrB','addEventListener','970YlVUMf','getItem','clearBtn','getElementById','129804yoeyOj','padStart','createElement','success','getMinutes','Telegram','message\x20ai','385AwFPbP','user','stringify','querySelectorAll','none','min'];a0_0x3605=function(){return _0x3a370a;};return a0_0x3605();}const BACKEND_URL=a0_0x2f78d8(0x1ae),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2f78d8(0x14a)](a0_0x2f78d8(0x164)),emptyState=document[a0_0x2f78d8(0x14a)](a0_0x2f78d8(0x162)),messageInput=document['getElementById'](a0_0x2f78d8(0x1ad)),sendBtn=document[a0_0x2f78d8(0x14a)]('sendBtn'),clearBtn=document['getElementById'](a0_0x2f78d8(0x149)),modal=document[a0_0x2f78d8(0x14a)](a0_0x2f78d8(0x18e)),mTitle=document[a0_0x2f78d8(0x14a)]('modalTitle'),mText=document[a0_0x2f78d8(0x14a)](a0_0x2f78d8(0x179));let modalCallback=null;async function callBackend(_0x4ee523,_0x7062d6){const _0x4ca87e=a0_0x2f78d8,_0x45356b=tg?.['initDataUnsafe']?.['user']||{},_0x5170b5=_0x45356b['id']||localStorage[_0x4ca87e(0x148)](_0x4ca87e(0x198))||'d-'+Math['floor'](Math[_0x4ca87e(0x134)]()*0x3b9aca00);if(!_0x45356b['id'])localStorage[_0x4ca87e(0x187)](_0x4ca87e(0x198),_0x5170b5);const _0x52a523={'action':_0x4ee523,'user_id':_0x5170b5,'user_data':{'first_name':_0x45356b[_0x4ca87e(0x135)],'username':_0x45356b[_0x4ca87e(0x183)]},'init_data':tg?.[_0x4ca87e(0x138)]||'',..._0x7062d6},_0x5d9e1e=new AbortController(),_0x101d19=setTimeout(()=>_0x5d9e1e[_0x4ca87e(0x17b)](),REQUEST_TIMEOUT_MS);try{const _0x5dbf9b=await fetch(BACKEND_URL,{'method':_0x4ca87e(0x16a),'headers':{'Content-Type':_0x4ca87e(0x13a)},'body':JSON[_0x4ca87e(0x154)](_0x52a523),'signal':_0x5d9e1e[_0x4ca87e(0x191)]});return clearTimeout(_0x101d19),await _0x5dbf9b['json']();}catch(_0x567f16){return{'success':![],'error':String(_0x567f16)};}}function formatTime(_0x495f82){const _0x242a1b=a0_0x2f78d8,_0x4c0e24=new Date(_0x495f82);return String(_0x4c0e24[_0x242a1b(0x174)]())[_0x242a1b(0x14c)](0x2,'0')+':'+String(_0x4c0e24[_0x242a1b(0x14f)]())[_0x242a1b(0x14c)](0x2,'0');}function a0_0x5c4b(_0x4108ad,_0x2aac83){_0x4108ad=_0x4108ad-0x131;const _0x4538ad=a0_0x3605();let _0x38fb20=_0x4538ad[_0x4108ad];return _0x38fb20;}function createMessageElement(_0x43da66,_0x401ced){const _0x26bb68=a0_0x2f78d8,_0x3354b1=document[_0x26bb68(0x14d)](_0x26bb68(0x16c));_0x3354b1[_0x26bb68(0x15c)]=_0x26bb68(0x196)+_0x43da66[_0x26bb68(0x1b0)];const _0x54b3f9=document[_0x26bb68(0x14d)](_0x26bb68(0x16c));_0x54b3f9[_0x26bb68(0x15c)]='message-bubble',_0x54b3f9[_0x26bb68(0x194)]=_0x43da66[_0x26bb68(0x161)][_0x26bb68(0x1a5)](/\n/g,_0x26bb68(0x16f));const _0x6248e4=document[_0x26bb68(0x14d)](_0x26bb68(0x16c));_0x6248e4[_0x26bb68(0x15c)]=_0x26bb68(0x18b),_0x6248e4[_0x26bb68(0x194)]=_0x26bb68(0x1a0),_0x6248e4[_0x26bb68(0x188)]=_0x4a0766=>{_0x4a0766['stopPropagation'](),confirmDelete(_0x401ced);};let _0x4d4161;_0x54b3f9['addEventListener'](_0x26bb68(0x142),()=>_0x4d4161=setTimeout(()=>{const _0x28b248=_0x26bb68;_0x3354b1[_0x28b248(0x190)][_0x28b248(0x17a)](_0x28b248(0x180));if(tg?.[_0x28b248(0x144)])tg[_0x28b248(0x144)]['impactOccurred']('medium');},0x1f4)),_0x54b3f9['addEventListener']('touchend',()=>clearTimeout(_0x4d4161));const _0x46324f=document[_0x26bb68(0x14d)](_0x26bb68(0x16c));return _0x46324f[_0x26bb68(0x15c)]=_0x26bb68(0x169),_0x46324f['textContent']=formatTime(_0x43da66[_0x26bb68(0x1ab)]),_0x3354b1[_0x26bb68(0x1a8)](_0x6248e4),_0x3354b1['appendChild'](_0x54b3f9),_0x3354b1[_0x26bb68(0x1a8)](_0x46324f),_0x3354b1;}function createTypingIndicator(){const _0x39c7fb=a0_0x2f78d8,_0x1c8693=document['createElement']('div');return _0x1c8693[_0x39c7fb(0x15c)]=_0x39c7fb(0x151),_0x1c8693['id']='typingIndicator',_0x1c8693[_0x39c7fb(0x194)]=_0x39c7fb(0x186),_0x1c8693;}function renderMessages(){const _0x5def8c=a0_0x2f78d8;Array[_0x5def8c(0x19f)](chatArea[_0x5def8c(0x16e)])[_0x5def8c(0x197)](_0x123eb7=>{if(_0x123eb7['id']!=='emptyState')_0x123eb7['remove']();}),messages[_0x5def8c(0x1ac)]>0x0?(emptyState['style'][_0x5def8c(0x172)]=_0x5def8c(0x156),messages[_0x5def8c(0x197)]((_0x1f4888,_0x3a7f9b)=>chatArea[_0x5def8c(0x1a8)](createMessageElement(_0x1f4888,_0x3a7f9b)))):emptyState[_0x5def8c(0x178)][_0x5def8c(0x172)]=_0x5def8c(0x182),requestAnimationFrame(()=>chatArea[_0x5def8c(0x132)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x2d0713=a0_0x2f78d8;messageInput['style'][_0x2d0713(0x163)]=_0x2d0713(0x136),messageInput[_0x2d0713(0x178)][_0x2d0713(0x163)]=Math[_0x2d0713(0x157)](messageInput[_0x2d0713(0x16d)],0x78)+'px';}function updateSendButton(){const _0x1aea2b=a0_0x2f78d8,_0x55a3dd=messageInput[_0x1aea2b(0x19c)][_0x1aea2b(0x133)]();sendBtn[_0x1aea2b(0x1af)]=!_0x55a3dd||isTyping;}async function sendMessage(){const _0x5791f8=a0_0x2f78d8,_0x8b840d=messageInput[_0x5791f8(0x19c)][_0x5791f8(0x133)]();if(!_0x8b840d||isTyping)return;if(tg?.[_0x5791f8(0x144)])tg[_0x5791f8(0x144)][_0x5791f8(0x18a)](_0x5791f8(0x159));messages[_0x5791f8(0x13c)]({'role':_0x5791f8(0x153),'content':_0x8b840d,'timestamp':Date[_0x5791f8(0x177)]()}),localStorage['setItem'](_0x5791f8(0x193),JSON[_0x5791f8(0x154)](messages)),renderMessages(),messageInput[_0x5791f8(0x19c)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5791f8(0x1a8)](createTypingIndicator()),chatArea[_0x5791f8(0x132)]=chatArea[_0x5791f8(0x16d)];const _0x1d6bd9=await callBackend(_0x5791f8(0x18c),{'message':_0x8b840d});isTyping=![];const _0x13ea77=document[_0x5791f8(0x14a)]('typingIndicator');if(_0x13ea77)_0x13ea77[_0x5791f8(0x17c)]();let _0x495c5c=_0x5791f8(0x15a);if(_0x1d6bd9[_0x5791f8(0x14e)]){_0x495c5c=_0x1d6bd9[_0x5791f8(0x19e)]||_0x5791f8(0x185);if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred'](_0x5791f8(0x14e));}else{_0x495c5c=_0x1d6bd9['error']||_0x5791f8(0x15f);if(tg?.[_0x5791f8(0x144)])tg[_0x5791f8(0x144)]['notificationOccurred'](_0x5791f8(0x199));}messages[_0x5791f8(0x13c)]({'role':'ai','content':_0x495c5c,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x5791f8(0x154)](messages)),renderMessages();}function confirmDelete(_0x625b56){const _0x295400=a0_0x2f78d8;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x295400(0x13e)]=_0x295400(0x1a4);modalCallback=()=>{messages['splice'](_0x625b56,0x1),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x295400(0x190)][_0x295400(0x17a)](_0x295400(0x15e));}if(clearBtn)clearBtn[a0_0x2f78d8(0x188)]=()=>{const _0x381516=a0_0x2f78d8;if(!messages['length'])return;if(mTitle)mTitle[_0x381516(0x13e)]=_0x381516(0x1a6);if(mText)mText[_0x381516(0x13e)]=_0x381516(0x13f);modalCallback=async()=>{const _0x27c923=_0x381516;messages=[],localStorage[_0x27c923(0x1a3)]('ai_chat_messages'),renderMessages(),callBackend(_0x27c923(0x143),{});},modal[_0x381516(0x190)][_0x381516(0x17a)](_0x381516(0x15e));};document[a0_0x2f78d8(0x14a)](a0_0x2f78d8(0x139))['onclick']=()=>modal[a0_0x2f78d8(0x190)][a0_0x2f78d8(0x17c)](a0_0x2f78d8(0x15e)),document[a0_0x2f78d8(0x14a)](a0_0x2f78d8(0x192))[a0_0x2f78d8(0x188)]=()=>{const _0x197953=a0_0x2f78d8;if(modalCallback)modalCallback();modal['classList'][_0x197953(0x17c)](_0x197953(0x15e));},messageInput[a0_0x2f78d8(0x146)](a0_0x2f78d8(0x17f),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2f78d8(0x146)](a0_0x2f78d8(0x15b),_0x1f1746=>{const _0x1de8d8=a0_0x2f78d8;_0x1f1746[_0x1de8d8(0x1a9)]==='Enter'&&!_0x1f1746['shiftKey']&&(_0x1f1746[_0x1de8d8(0x141)](),sendMessage());}),sendBtn[a0_0x2f78d8(0x188)]=sendMessage,document['addEventListener'](a0_0x2f78d8(0x19b),_0x4e07ce=>{const _0x3f8746=a0_0x2f78d8;document[_0x3f8746(0x155)]('.message.show-delete')[_0x3f8746(0x197)](_0x990ce2=>{const _0x5bbf07=_0x3f8746;if(!_0x990ce2[_0x5bbf07(0x18f)](_0x4e07ce[_0x5bbf07(0x158)]))_0x990ce2[_0x5bbf07(0x190)][_0x5bbf07(0x17c)](_0x5bbf07(0x180));});});const saved=localStorage['getItem'](a0_0x2f78d8(0x193));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x473a3d){}updateSendButton();