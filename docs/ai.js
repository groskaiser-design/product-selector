const a0_0x2b36ac=a0_0x5d22;(function(_0x44791b,_0x26d63f){const _0xd6a206=a0_0x5d22,_0x1f405c=_0x44791b();while(!![]){try{const _0x4d4b38=-parseInt(_0xd6a206(0x15b))/0x1+-parseInt(_0xd6a206(0x135))/0x2+parseInt(_0xd6a206(0xf9))/0x3+parseInt(_0xd6a206(0x10e))/0x4+-parseInt(_0xd6a206(0x110))/0x5+parseInt(_0xd6a206(0x13e))/0x6*(-parseInt(_0xd6a206(0x10a))/0x7)+parseInt(_0xd6a206(0x16b))/0x8*(parseInt(_0xd6a206(0x159))/0x9);if(_0x4d4b38===_0x26d63f)break;else _0x1f405c['push'](_0x1f405c['shift']());}catch(_0xc382){_0x1f405c['push'](_0x1f405c['shift']());}}}(a0_0x7c76,0x766bc));const tg=window[a0_0x2b36ac(0x13a)]?.[a0_0x2b36ac(0x146)],HOME_URL=a0_0x2b36ac(0x161);function setupTelegramBackButton(){const _0x3eb7d1=a0_0x2b36ac,_0x3fe1c8=(function(){let _0x11d4eb=!![];return function(_0x34d62d,_0xfba05e){const _0x574ff9=_0x11d4eb?function(){const _0x1ffaa1=a0_0x5d22;if(_0xfba05e){const _0x2b6f9f=_0xfba05e[_0x1ffaa1(0x11e)](_0x34d62d,arguments);return _0xfba05e=null,_0x2b6f9f;}}:function(){};return _0x11d4eb=![],_0x574ff9;};}()),_0x500bb3=_0x3fe1c8(this,function(){const _0x2f3201=a0_0x5d22;return _0x500bb3[_0x2f3201(0xef)]()[_0x2f3201(0x162)](_0x2f3201(0x10d))[_0x2f3201(0xef)]()['constructor'](_0x500bb3)[_0x2f3201(0x162)]('(((.+)+)+)+$');});_0x500bb3();if(!tg)return;try{tg[_0x3eb7d1(0x107)](),tg['expand'](),tg['setHeaderColor']?.('#050505');if(tg[_0x3eb7d1(0x12b)]?.(_0x3eb7d1(0x109)))tg[_0x3eb7d1(0x12f)]?.();const _0x192592=tg['BackButton'];if(_0x192592){_0x192592[_0x3eb7d1(0x108)]();if(typeof _0x192592[_0x3eb7d1(0xfc)]===_0x3eb7d1(0x16f))try{_0x192592[_0x3eb7d1(0xfc)]();}catch(_0x10f7bb){}_0x192592[_0x3eb7d1(0x142)](()=>{const _0x46ad89=_0x3eb7d1;if(tg[_0x46ad89(0xf5)])tg[_0x46ad89(0xf5)][_0x46ad89(0x15f)]('light');location[_0x46ad89(0x125)]=HOME_URL;});}}catch(_0x2b8a7d){console['warn']('TG\x20setup\x20error:',_0x2b8a7d);}}(function initStableLayout(){const _0x4f65cf=a0_0x2b36ac,_0x58c532=document[_0x4f65cf(0xf2)]('.container'),_0x41e9f3=document[_0x4f65cf(0xf4)](_0x4f65cf(0x13c)),_0xd61ce7=document[_0x4f65cf(0xf4)](_0x4f65cf(0x11a)),_0x27d215=document['getElementById'](_0x4f65cf(0x156));function _0x5e43c1(){const _0x345004=_0x4f65cf;if(!_0x58c532)return;const _0x15f4c2=tg&&tg[_0x345004(0x10c)]?tg[_0x345004(0x10c)]:window[_0x345004(0xf1)];_0x58c532['style'][_0x345004(0x165)]=_0x15f4c2+'px';if(_0x41e9f3){const _0x529e97=_0x41e9f3[_0x345004(0x150)];_0xd61ce7[_0x345004(0x14c)][_0x345004(0xf3)]=_0x529e97+0x28+'px';}}tg?tg[_0x4f65cf(0x14a)](_0x4f65cf(0x166),({isStateStable:_0x36ef17})=>{_0x5e43c1();if(_0x36ef17)requestAnimationFrame(()=>{const _0x326967=a0_0x5d22;_0xd61ce7[_0x326967(0x153)]=_0xd61ce7[_0x326967(0x124)];});}):window[_0x4f65cf(0xfe)](_0x4f65cf(0x169),_0x5e43c1),_0x5e43c1(),_0x27d215&&(_0x27d215['addEventListener'](_0x4f65cf(0x152),()=>{requestAnimationFrame(_0x5e43c1);}),_0x27d215[_0x4f65cf(0xfe)](_0x4f65cf(0x148),()=>{setTimeout(()=>{const _0x49ddc9=a0_0x5d22;_0xd61ce7[_0x49ddc9(0x153)]=_0xd61ce7[_0x49ddc9(0x124)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2b36ac(0x158),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2b36ac(0xf4)](a0_0x2b36ac(0x11a)),emptyState=document[a0_0x2b36ac(0xf4)](a0_0x2b36ac(0x163)),messageInput=document[a0_0x2b36ac(0xf4)]('messageInput'),sendBtn=document[a0_0x2b36ac(0xf4)](a0_0x2b36ac(0x100)),clearBtn=document[a0_0x2b36ac(0xf4)](a0_0x2b36ac(0x16a)),modal=document[a0_0x2b36ac(0xf4)](a0_0x2b36ac(0x123)),mTitle=document[a0_0x2b36ac(0xf4)](a0_0x2b36ac(0x168)),mText=document['getElementById'](a0_0x2b36ac(0xec));let modalCallback=null;async function callBackend(_0xbf4990,_0x23b3b6){const _0x3ba4a3=a0_0x2b36ac,_0x3cc76a=tg?.['initDataUnsafe']?.[_0x3ba4a3(0xf8)]||{},_0x5a6bb7=_0x3cc76a['id']||localStorage[_0x3ba4a3(0x118)](_0x3ba4a3(0x16e))||'d-'+Math[_0x3ba4a3(0x10b)](Math['random']()*0x3b9aca00);if(!_0x3cc76a['id'])localStorage[_0x3ba4a3(0x147)](_0x3ba4a3(0x16e),_0x5a6bb7);const _0x1587fe={'action':_0xbf4990,'user_id':_0x5a6bb7,'user_data':{'first_name':_0x3cc76a[_0x3ba4a3(0x102)],'username':_0x3cc76a['username']},'init_data':tg?.[_0x3ba4a3(0x140)]||'',..._0x23b3b6},_0x20b82f=new AbortController(),_0x15f310=setTimeout(()=>_0x20b82f[_0x3ba4a3(0x151)](),REQUEST_TIMEOUT_MS);try{const _0x5b63ef=await fetch(BACKEND_URL,{'method':_0x3ba4a3(0x157),'headers':{'Content-Type':_0x3ba4a3(0x16c)},'body':JSON['stringify'](_0x1587fe),'signal':_0x20b82f[_0x3ba4a3(0x11c)]});return clearTimeout(_0x15f310),await _0x5b63ef['json']();}catch(_0xf74f5a){return{'success':![],'error':String(_0xf74f5a)};}}function a0_0x7c76(){const _0x3fe264=['disableVerticalSwipes','Действие\x20необратимо.','removeItem','Удалить?','display','appendChild','508206fbTMtd','message-time','classList','medium','add','Telegram','onclick','inputArea','error','90AmYfhK','contains','initData','key','onClick','light','length','push','WebApp','setItem','focus','Пустой\x20ответ','onEvent','Enter','style','createElement','getHours','replace','offsetHeight','abort','input','scrollTop','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','textContent','messageInput','POST','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','27BsVojt','Ошибка\x20сети','238363NpVAvo','Очистить\x20историю?','none','disabled','impactOccurred','.message.show-delete','./router.html','search','emptyState','Ошибка\x20сервера','height','viewportChanged','Начнется\x20новый\x20диалог.','modalTitle','resize','clearBtn','1081368ZueaZy','text/plain','padStart','debug_uid','function','modalText','getMinutes','innerHTML','toString','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','innerHeight','querySelector','paddingBottom','getElementById','HapticFeedback','from','now','user','2763570VIqJYs','timestamp','touchstart','offClick','value','addEventListener','remove','sendBtn','modalConfirm','first_name','querySelectorAll','target','parse','notificationOccurred','ready','show','6.1','168553bktwiN','floor','viewportHeight','(((.+)+)+)+$','1936284xgKZOf','role','2360355biNxcn','splice','trim','message\x20','send_message','className','show-delete','stopPropagation','getItem','preventDefault','chatArea','success','signal','forEach','apply','click','auto','ai_chat_messages','delete-btn','confirmModal','scrollHeight','href','content','text','div','clear_history','children','isVersionAtLeast','typingIndicator','flex','stringify'];a0_0x7c76=function(){return _0x3fe264;};return a0_0x7c76();}function formatTime(_0x564621){const _0xc5620f=a0_0x2b36ac,_0x1910eb=new Date(_0x564621);return String(_0x1910eb[_0xc5620f(0x14e)]())[_0xc5620f(0x16d)](0x2,'0')+':'+String(_0x1910eb[_0xc5620f(0xed)]())['padStart'](0x2,'0');}function createMessageElement(_0x38c596,_0xe2cf02){const _0x2943e6=a0_0x2b36ac,_0x3fa893=document[_0x2943e6(0x14d)]('div');_0x3fa893['className']=_0x2943e6(0x113)+_0x38c596[_0x2943e6(0x10f)];const _0x214dba=document[_0x2943e6(0x14d)](_0x2943e6(0x128));_0x214dba['className']='message-bubble',_0x214dba[_0x2943e6(0xee)]=_0x38c596[_0x2943e6(0x126)][_0x2943e6(0x14f)](/\n/g,'<br>');const _0xac8f47=document['createElement'](_0x2943e6(0x128));_0xac8f47['className']=_0x2943e6(0x122),_0xac8f47[_0x2943e6(0xee)]=_0x2943e6(0x154),_0xac8f47[_0x2943e6(0x13b)]=_0x40c375=>{const _0x37fc48=_0x2943e6;_0x40c375[_0x37fc48(0x117)](),confirmDelete(_0xe2cf02);};let _0x343e65;_0x214dba[_0x2943e6(0xfe)](_0x2943e6(0xfb),()=>_0x343e65=setTimeout(()=>{const _0x2d4c64=_0x2943e6;_0x3fa893[_0x2d4c64(0x137)][_0x2d4c64(0x139)](_0x2d4c64(0x116));if(tg?.[_0x2d4c64(0xf5)])tg[_0x2d4c64(0xf5)][_0x2d4c64(0x15f)](_0x2d4c64(0x138));},0x1f4)),_0x214dba[_0x2943e6(0xfe)]('touchend',()=>clearTimeout(_0x343e65));const _0x344fde=document[_0x2943e6(0x14d)](_0x2943e6(0x128));return _0x344fde[_0x2943e6(0x115)]=_0x2943e6(0x136),_0x344fde['textContent']=formatTime(_0x38c596[_0x2943e6(0xfa)]),_0x3fa893['appendChild'](_0xac8f47),_0x3fa893[_0x2943e6(0x134)](_0x214dba),_0x3fa893[_0x2943e6(0x134)](_0x344fde),_0x3fa893;}function createTypingIndicator(){const _0x41202a=a0_0x2b36ac,_0x989e86=document['createElement']('div');return _0x989e86['className']='message\x20ai',_0x989e86['id']='typingIndicator',_0x989e86[_0x41202a(0xee)]=_0x41202a(0xf0),_0x989e86;}function renderMessages(){const _0x3b7cfd=a0_0x2b36ac;Array[_0x3b7cfd(0xf6)](chatArea[_0x3b7cfd(0x12a)])[_0x3b7cfd(0x11d)](_0x3b8220=>{const _0x465e1f=_0x3b7cfd;if(_0x3b8220['id']!==_0x465e1f(0x163))_0x3b8220[_0x465e1f(0xff)]();}),messages[_0x3b7cfd(0x144)]>0x0?(emptyState[_0x3b7cfd(0x14c)][_0x3b7cfd(0x133)]=_0x3b7cfd(0x15d),messages['forEach']((_0x4e0793,_0x1cbd2d)=>chatArea[_0x3b7cfd(0x134)](createMessageElement(_0x4e0793,_0x1cbd2d)))):emptyState[_0x3b7cfd(0x14c)][_0x3b7cfd(0x133)]=_0x3b7cfd(0x12d),requestAnimationFrame(()=>chatArea[_0x3b7cfd(0x153)]=chatArea[_0x3b7cfd(0x124)]);}function autoResizeTextarea(){const _0x3ecc40=a0_0x2b36ac;messageInput[_0x3ecc40(0x14c)][_0x3ecc40(0x165)]=_0x3ecc40(0x120),messageInput['style'][_0x3ecc40(0x165)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x637d82=a0_0x2b36ac,_0x3b380a=messageInput[_0x637d82(0xfd)][_0x637d82(0x112)]();sendBtn[_0x637d82(0x15e)]=!_0x3b380a||isTyping;}async function sendMessage(){const _0x4f1821=a0_0x2b36ac,_0x50e844=messageInput[_0x4f1821(0xfd)][_0x4f1821(0x112)]();if(!_0x50e844||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x4f1821(0x15f)](_0x4f1821(0x143));messages[_0x4f1821(0x145)]({'role':'user','content':_0x50e844,'timestamp':Date['now']()}),localStorage[_0x4f1821(0x147)](_0x4f1821(0x121),JSON[_0x4f1821(0x12e)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4f1821(0x134)](createTypingIndicator()),chatArea[_0x4f1821(0x153)]=chatArea['scrollHeight'];const _0x49e750=await callBackend(_0x4f1821(0x114),{'message':_0x50e844});isTyping=![];const _0x272804=document[_0x4f1821(0xf4)](_0x4f1821(0x12c));if(_0x272804)_0x272804[_0x4f1821(0xff)]();let _0x1102e5=_0x4f1821(0x15a);if(_0x49e750[_0x4f1821(0x11b)]){_0x1102e5=_0x49e750[_0x4f1821(0x127)]||_0x4f1821(0x149);if(tg?.[_0x4f1821(0xf5)])tg['HapticFeedback'][_0x4f1821(0x106)](_0x4f1821(0x11b));}else{_0x1102e5=_0x49e750[_0x4f1821(0x13d)]||_0x4f1821(0x164);if(tg?.[_0x4f1821(0xf5)])tg[_0x4f1821(0xf5)][_0x4f1821(0x106)]('error');}messages[_0x4f1821(0x145)]({'role':'ai','content':_0x1102e5,'timestamp':Date[_0x4f1821(0xf7)]()}),localStorage[_0x4f1821(0x147)]('ai_chat_messages',JSON[_0x4f1821(0x12e)](messages)),renderMessages();}function a0_0x5d22(_0x4d30d5,_0x25bfb4){_0x4d30d5=_0x4d30d5-0xec;const _0x5cc59a=a0_0x7c76();let _0x3f58bc=_0x5cc59a[_0x4d30d5];return _0x3f58bc;}function confirmDelete(_0x15eec7){const _0xfc4c58=a0_0x2b36ac;if(mTitle)mTitle[_0xfc4c58(0x155)]=_0xfc4c58(0x132);if(mText)mText[_0xfc4c58(0x155)]=_0xfc4c58(0x130);modalCallback=()=>{const _0x578430=_0xfc4c58;messages[_0x578430(0x111)](_0x15eec7,0x1),localStorage[_0x578430(0x147)](_0x578430(0x121),JSON[_0x578430(0x12e)](messages)),renderMessages();},modal['classList'][_0xfc4c58(0x139)](_0xfc4c58(0x108));}if(clearBtn)clearBtn['onclick']=()=>{const _0x225a5e=a0_0x2b36ac;if(!messages[_0x225a5e(0x144)])return;if(mTitle)mTitle[_0x225a5e(0x155)]=_0x225a5e(0x15c);if(mText)mText[_0x225a5e(0x155)]=_0x225a5e(0x167);modalCallback=async()=>{const _0x5c1129=_0x225a5e;messages=[],localStorage[_0x5c1129(0x131)](_0x5c1129(0x121)),renderMessages(),callBackend(_0x5c1129(0x129),{});},modal[_0x225a5e(0x137)][_0x225a5e(0x139)](_0x225a5e(0x108));};document[a0_0x2b36ac(0xf4)]('modalCancel')[a0_0x2b36ac(0x13b)]=()=>modal['classList'][a0_0x2b36ac(0xff)]('show'),document[a0_0x2b36ac(0xf4)](a0_0x2b36ac(0x101))[a0_0x2b36ac(0x13b)]=()=>{const _0x471f86=a0_0x2b36ac;if(modalCallback)modalCallback();modal[_0x471f86(0x137)]['remove'](_0x471f86(0x108));},messageInput[a0_0x2b36ac(0xfe)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x506c81=>{const _0x39a4be=a0_0x2b36ac;_0x506c81[_0x39a4be(0x141)]===_0x39a4be(0x14b)&&!_0x506c81['shiftKey']&&(_0x506c81[_0x39a4be(0x119)](),sendMessage());}),sendBtn[a0_0x2b36ac(0x13b)]=sendMessage,document[a0_0x2b36ac(0xfe)](a0_0x2b36ac(0x11f),_0x3a3df9=>{const _0x49885c=a0_0x2b36ac;document[_0x49885c(0x103)](_0x49885c(0x160))[_0x49885c(0x11d)](_0x3759d0=>{const _0x3ea0be=_0x49885c;if(!_0x3759d0[_0x3ea0be(0x13f)](_0x3a3df9[_0x3ea0be(0x104)]))_0x3759d0[_0x3ea0be(0x137)][_0x3ea0be(0xff)](_0x3ea0be(0x116));});});const saved=localStorage[a0_0x2b36ac(0x118)](a0_0x2b36ac(0x121));if(saved)try{messages=JSON[a0_0x2b36ac(0x105)](saved),renderMessages();}catch(a0_0x36569d){}updateSendButton();