const a0_0x1759bc=a0_0x4107;(function(_0x1d5613,_0x17d23c){const _0x3e3ad7=a0_0x4107,_0x37b211=_0x1d5613();while(!![]){try{const _0x40c63b=parseInt(_0x3e3ad7(0x1e6))/0x1*(-parseInt(_0x3e3ad7(0x20e))/0x2)+-parseInt(_0x3e3ad7(0x1db))/0x3*(-parseInt(_0x3e3ad7(0x1b6))/0x4)+-parseInt(_0x3e3ad7(0x1e5))/0x5+parseInt(_0x3e3ad7(0x1c5))/0x6+parseInt(_0x3e3ad7(0x1ab))/0x7+-parseInt(_0x3e3ad7(0x1bf))/0x8*(-parseInt(_0x3e3ad7(0x1a3))/0x9)+-parseInt(_0x3e3ad7(0x20b))/0xa;if(_0x40c63b===_0x17d23c)break;else _0x37b211['push'](_0x37b211['shift']());}catch(_0x1258d0){_0x37b211['push'](_0x37b211['shift']());}}}(a0_0x583d,0x77a24));const tg=window[a0_0x1759bc(0x206)]?.[a0_0x1759bc(0x1f9)],HOME_URL=a0_0x1759bc(0x1ad);function setupTelegramBackButton(){const _0x5606bf=a0_0x1759bc,_0xe89809=(function(){let _0x27c21f=!![];return function(_0x3ccbb1,_0x3fb6fd){const _0x2bc62c=_0x27c21f?function(){const _0x52f33b=a0_0x4107;if(_0x3fb6fd){const _0x36c304=_0x3fb6fd[_0x52f33b(0x1e4)](_0x3ccbb1,arguments);return _0x3fb6fd=null,_0x36c304;}}:function(){};return _0x27c21f=![],_0x2bc62c;};}()),_0x32b7c6=_0xe89809(this,function(){const _0x4f080d=a0_0x4107;return _0x32b7c6[_0x4f080d(0x1c4)]()[_0x4f080d(0x200)]('(((.+)+)+)+$')[_0x4f080d(0x1c4)]()[_0x4f080d(0x19d)](_0x32b7c6)[_0x4f080d(0x200)](_0x4f080d(0x1bc));});_0x32b7c6();if(!tg)return;try{tg[_0x5606bf(0x1fc)](),tg[_0x5606bf(0x1b8)](),tg['setHeaderColor']?.(_0x5606bf(0x1a1));if(tg[_0x5606bf(0x1d8)]?.(_0x5606bf(0x213)))tg['disableVerticalSwipes']?.();const _0x8db32c=tg[_0x5606bf(0x1a7)];if(_0x8db32c){_0x8db32c[_0x5606bf(0x1ed)]();if(typeof _0x8db32c[_0x5606bf(0x208)]==='function')try{_0x8db32c[_0x5606bf(0x208)]();}catch(_0x25ac83){}_0x8db32c[_0x5606bf(0x212)](()=>{const _0x56f1e1=_0x5606bf;if(tg[_0x56f1e1(0x210)])tg[_0x56f1e1(0x210)][_0x56f1e1(0x1dd)](_0x56f1e1(0x1c6));location['href']=HOME_URL;});}}catch(_0x1d6d3c){console[_0x5606bf(0x1d1)](_0x5606bf(0x20d),_0x1d6d3c);}}(function initStableLayout(){const _0x2528e4=a0_0x1759bc,_0x31b7fb=document[_0x2528e4(0x1bb)](_0x2528e4(0x1f3)),_0x19549a=document[_0x2528e4(0x1e1)](_0x2528e4(0x1a4)),_0x4ede16=document[_0x2528e4(0x1e1)](_0x2528e4(0x1cc)),_0x5b475f=document[_0x2528e4(0x1e1)](_0x2528e4(0x19b));function _0x5a8cd8(){const _0x200246=_0x2528e4;if(!_0x31b7fb)return;const _0x26abe0=tg&&tg['viewportHeight']?tg[_0x200246(0x1f7)]:window['innerHeight'];_0x31b7fb['style'][_0x200246(0x1cd)]=_0x26abe0+'px';if(_0x19549a){const _0xb61f32=_0x19549a[_0x200246(0x20a)];_0x4ede16[_0x200246(0x1eb)][_0x200246(0x19a)]=_0xb61f32+0x28+'px';}}tg?tg[_0x2528e4(0x1f2)](_0x2528e4(0x1e7),({isStateStable:_0x2cbe0b})=>{_0x5a8cd8();if(_0x2cbe0b)requestAnimationFrame(()=>{const _0x2e18da=a0_0x4107;_0x4ede16[_0x2e18da(0x1d0)]=_0x4ede16[_0x2e18da(0x1b5)];});}):window['addEventListener'](_0x2528e4(0x1e0),_0x5a8cd8),_0x5a8cd8(),_0x5b475f&&(_0x5b475f['addEventListener'](_0x2528e4(0x1b7),()=>{requestAnimationFrame(_0x5a8cd8);}),_0x5b475f[_0x2528e4(0x19e)](_0x2528e4(0x1f8),()=>{setTimeout(()=>{const _0x1da939=a0_0x4107;_0x4ede16[_0x1da939(0x1d0)]=_0x4ede16[_0x1da939(0x1b5)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1759bc(0x1e9),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById']('chatArea'),emptyState=document['getElementById'](a0_0x1759bc(0x1f4)),messageInput=document[a0_0x1759bc(0x1e1)](a0_0x1759bc(0x19b)),sendBtn=document[a0_0x1759bc(0x1e1)](a0_0x1759bc(0x1c1)),clearBtn=document[a0_0x1759bc(0x1e1)](a0_0x1759bc(0x1a8)),modal=document['getElementById'](a0_0x1759bc(0x1de)),mTitle=document[a0_0x1759bc(0x1e1)]('modalTitle'),mText=document['getElementById'](a0_0x1759bc(0x1a0));let modalCallback=null;async function callBackend(_0x81a4d5,_0x46572b){const _0x3223d2=a0_0x1759bc,_0x475fe7=tg?.[_0x3223d2(0x1f5)]?.[_0x3223d2(0x1b4)]||{},_0xfd8dc0=_0x475fe7['id']||localStorage[_0x3223d2(0x195)](_0x3223d2(0x1ae))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x475fe7['id'])localStorage[_0x3223d2(0x209)](_0x3223d2(0x1ae),_0xfd8dc0);const _0x2a14c1={'action':_0x81a4d5,'user_id':_0xfd8dc0,'user_data':{'first_name':_0x475fe7[_0x3223d2(0x1e8)],'username':_0x475fe7[_0x3223d2(0x1c2)]},'init_data':tg?.[_0x3223d2(0x1fb)]||'',..._0x46572b},_0x5b700f=new AbortController(),_0x21fd25=setTimeout(()=>_0x5b700f[_0x3223d2(0x1d6)](),REQUEST_TIMEOUT_MS);try{const _0x20cd10=await fetch(BACKEND_URL,{'method':_0x3223d2(0x1aa),'headers':{'Content-Type':_0x3223d2(0x201)},'body':JSON[_0x3223d2(0x1f1)](_0x2a14c1),'signal':_0x5b700f[_0x3223d2(0x1b9)]});return clearTimeout(_0x21fd25),await _0x20cd10[_0x3223d2(0x1c7)]();}catch(_0x3cf06d){return{'success':![],'error':String(_0x3cf06d)};}}function formatTime(_0xe9ace3){const _0x3558a6=a0_0x1759bc,_0xd97932=new Date(_0xe9ace3);return String(_0xd97932[_0x3558a6(0x1ce)]())['padStart'](0x2,'0')+':'+String(_0xd97932[_0x3558a6(0x1df)]())[_0x3558a6(0x1fe)](0x2,'0');}function a0_0x583d(){const _0xa28841=['BackButton','clearBtn','timestamp','POST','1679384sgGcob','Очистить\x20историю?','./router.html','debug_uid','Начнется\x20новый\x20диалог.','className','key','content','show-delete','user','scrollHeight','717260XSfrhm','input','expand','signal','value','querySelector','(((.+)+)+)+$','appendChild','keydown','456aUgRRo','from','sendBtn','username','createElement','toString','805548hEeoVW','light','json','add','forEach','auto','modalConfirm','chatArea','height','getHours','role','scrollTop','warn','Enter','disabled','<br>','message\x20ai','abort','.message.show-delete','isVersionAtLeast','modalCancel','textContent','15HysLAK','div','impactOccurred','confirmModal','getMinutes','resize','getElementById','parse','remove','apply','4466970NUYXDg','125887pdMCcz','viewportChanged','first_name','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','style','typingIndicator','show','clear_history','min','none','stringify','onEvent','.container','emptyState','initDataUnsafe','error','viewportHeight','focus','WebApp','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','initData','ready','touchstart','padStart','contains','search','text/plain','send_message','target','push','children','Telegram','ai_chat_messages','offClick','setItem','offsetHeight','4187060JpEPHB','success','TG\x20setup\x20error:','6rXWhgM','onclick','HapticFeedback','message-bubble','onClick','6.1','getItem','splice','trim','Удалить?','shiftKey','paddingBottom','messageInput','display','constructor','addEventListener','classList','modalText','#050505','innerHTML','143532OHDiAU','inputArea','querySelectorAll','message-time'];a0_0x583d=function(){return _0xa28841;};return a0_0x583d();}function createMessageElement(_0x529c4a,_0x2d143b){const _0x42335a=a0_0x1759bc,_0x126426=document['createElement']('div');_0x126426[_0x42335a(0x1b0)]='message\x20'+_0x529c4a[_0x42335a(0x1cf)];const _0x5eb0b0=document[_0x42335a(0x1c3)](_0x42335a(0x1dc));_0x5eb0b0['className']=_0x42335a(0x211),_0x5eb0b0[_0x42335a(0x1a2)]=_0x529c4a[_0x42335a(0x1b2)]['replace'](/\n/g,_0x42335a(0x1d4));const _0x496069=document['createElement']('div');_0x496069['className']='delete-btn',_0x496069[_0x42335a(0x1a2)]=_0x42335a(0x1ea),_0x496069[_0x42335a(0x20f)]=_0x278208=>{_0x278208['stopPropagation'](),confirmDelete(_0x2d143b);};let _0x4eac2f;_0x5eb0b0[_0x42335a(0x19e)](_0x42335a(0x1fd),()=>_0x4eac2f=setTimeout(()=>{const _0x1ee3be=_0x42335a;_0x126426[_0x1ee3be(0x19f)][_0x1ee3be(0x1c8)](_0x1ee3be(0x1b3));if(tg?.[_0x1ee3be(0x210)])tg[_0x1ee3be(0x210)][_0x1ee3be(0x1dd)]('medium');},0x1f4)),_0x5eb0b0['addEventListener']('touchend',()=>clearTimeout(_0x4eac2f));const _0x4500a3=document[_0x42335a(0x1c3)](_0x42335a(0x1dc));return _0x4500a3[_0x42335a(0x1b0)]=_0x42335a(0x1a6),_0x4500a3[_0x42335a(0x1da)]=formatTime(_0x529c4a[_0x42335a(0x1a9)]),_0x126426['appendChild'](_0x496069),_0x126426['appendChild'](_0x5eb0b0),_0x126426[_0x42335a(0x1bd)](_0x4500a3),_0x126426;}function createTypingIndicator(){const _0x241a21=a0_0x1759bc,_0x4fb49f=document[_0x241a21(0x1c3)](_0x241a21(0x1dc));return _0x4fb49f[_0x241a21(0x1b0)]=_0x241a21(0x1d5),_0x4fb49f['id']=_0x241a21(0x1ec),_0x4fb49f[_0x241a21(0x1a2)]=_0x241a21(0x1fa),_0x4fb49f;}function renderMessages(){const _0x5c8e12=a0_0x1759bc;Array[_0x5c8e12(0x1c0)](chatArea[_0x5c8e12(0x205)])[_0x5c8e12(0x1c9)](_0x1a9fac=>{const _0x4245c2=_0x5c8e12;if(_0x1a9fac['id']!==_0x4245c2(0x1f4))_0x1a9fac[_0x4245c2(0x1e3)]();}),messages['length']>0x0?(emptyState[_0x5c8e12(0x1eb)][_0x5c8e12(0x19c)]=_0x5c8e12(0x1f0),messages[_0x5c8e12(0x1c9)]((_0x512e10,_0x359659)=>chatArea['appendChild'](createMessageElement(_0x512e10,_0x359659)))):emptyState[_0x5c8e12(0x1eb)][_0x5c8e12(0x19c)]='flex',requestAnimationFrame(()=>chatArea[_0x5c8e12(0x1d0)]=chatArea[_0x5c8e12(0x1b5)]);}function a0_0x4107(_0x4b159e,_0x34eb42){_0x4b159e=_0x4b159e-0x195;const _0x5a95c2=a0_0x583d();let _0x207b21=_0x5a95c2[_0x4b159e];return _0x207b21;}function autoResizeTextarea(){const _0x1331ef=a0_0x1759bc;messageInput[_0x1331ef(0x1eb)][_0x1331ef(0x1cd)]=_0x1331ef(0x1ca),messageInput[_0x1331ef(0x1eb)][_0x1331ef(0x1cd)]=Math[_0x1331ef(0x1ef)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x1e2613=a0_0x1759bc,_0x48c5fe=messageInput['value'][_0x1e2613(0x197)]();sendBtn[_0x1e2613(0x1d3)]=!_0x48c5fe||isTyping;}async function sendMessage(){const _0x82f57b=a0_0x1759bc,_0x566e8c=messageInput[_0x82f57b(0x1ba)][_0x82f57b(0x197)]();if(!_0x566e8c||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x82f57b(0x210)]['impactOccurred'](_0x82f57b(0x1c6));messages[_0x82f57b(0x204)]({'role':_0x82f57b(0x1b4),'content':_0x566e8c,'timestamp':Date['now']()}),localStorage[_0x82f57b(0x209)](_0x82f57b(0x207),JSON[_0x82f57b(0x1f1)](messages)),renderMessages(),messageInput[_0x82f57b(0x1ba)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x82f57b(0x1bd)](createTypingIndicator()),chatArea[_0x82f57b(0x1d0)]=chatArea['scrollHeight'];const _0x4405c5=await callBackend(_0x82f57b(0x202),{'message':_0x566e8c});isTyping=![];const _0x976f26=document[_0x82f57b(0x1e1)]('typingIndicator');if(_0x976f26)_0x976f26[_0x82f57b(0x1e3)]();let _0x10522c='Ошибка\x20сети';if(_0x4405c5['success']){_0x10522c=_0x4405c5['text']||'Пустой\x20ответ';if(tg?.[_0x82f57b(0x210)])tg[_0x82f57b(0x210)]['notificationOccurred'](_0x82f57b(0x20c));}else{_0x10522c=_0x4405c5['error']||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred'](_0x82f57b(0x1f6));}messages[_0x82f57b(0x204)]({'role':'ai','content':_0x10522c,'timestamp':Date['now']()}),localStorage['setItem'](_0x82f57b(0x207),JSON[_0x82f57b(0x1f1)](messages)),renderMessages();}function confirmDelete(_0x4b0f54){const _0x553150=a0_0x1759bc;if(mTitle)mTitle['textContent']=_0x553150(0x198);if(mText)mText[_0x553150(0x1da)]='Действие\x20необратимо.';modalCallback=()=>{const _0x14c4b9=_0x553150;messages[_0x14c4b9(0x196)](_0x4b0f54,0x1),localStorage['setItem'](_0x14c4b9(0x207),JSON['stringify'](messages)),renderMessages();},modal['classList']['add'](_0x553150(0x1ed));}if(clearBtn)clearBtn[a0_0x1759bc(0x20f)]=()=>{const _0x5a349b=a0_0x1759bc;if(!messages['length'])return;if(mTitle)mTitle[_0x5a349b(0x1da)]=_0x5a349b(0x1ac);if(mText)mText[_0x5a349b(0x1da)]=_0x5a349b(0x1af);modalCallback=async()=>{const _0x127767=_0x5a349b;messages=[],localStorage['removeItem'](_0x127767(0x207)),renderMessages(),callBackend(_0x127767(0x1ee),{});},modal[_0x5a349b(0x19f)][_0x5a349b(0x1c8)](_0x5a349b(0x1ed));};document['getElementById'](a0_0x1759bc(0x1d9))[a0_0x1759bc(0x20f)]=()=>modal[a0_0x1759bc(0x19f)][a0_0x1759bc(0x1e3)](a0_0x1759bc(0x1ed)),document['getElementById'](a0_0x1759bc(0x1cb))[a0_0x1759bc(0x20f)]=()=>{if(modalCallback)modalCallback();modal['classList']['remove']('show');},messageInput[a0_0x1759bc(0x19e)](a0_0x1759bc(0x1b7),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1759bc(0x19e)](a0_0x1759bc(0x1be),_0x4c586f=>{const _0x29fbe3=a0_0x1759bc;_0x4c586f[_0x29fbe3(0x1b1)]===_0x29fbe3(0x1d2)&&!_0x4c586f[_0x29fbe3(0x199)]&&(_0x4c586f['preventDefault'](),sendMessage());}),sendBtn[a0_0x1759bc(0x20f)]=sendMessage,document[a0_0x1759bc(0x19e)]('click',_0x370b0f=>{const _0x5c3ad3=a0_0x1759bc;document[_0x5c3ad3(0x1a5)](_0x5c3ad3(0x1d7))[_0x5c3ad3(0x1c9)](_0x2ec8cd=>{const _0xac8abc=_0x5c3ad3;if(!_0x2ec8cd[_0xac8abc(0x1ff)](_0x370b0f[_0xac8abc(0x203)]))_0x2ec8cd['classList'][_0xac8abc(0x1e3)]('show-delete');});});const saved=localStorage[a0_0x1759bc(0x195)](a0_0x1759bc(0x207));if(saved)try{messages=JSON[a0_0x1759bc(0x1e2)](saved),renderMessages();}catch(a0_0x62ee62){}updateSendButton();