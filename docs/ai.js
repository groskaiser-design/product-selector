const a0_0x4bcb2a=a0_0x3532;(function(_0x38d26e,_0x5dff16){const _0x249590=a0_0x3532,_0x28b337=_0x38d26e();while(!![]){try{const _0x4e8853=parseInt(_0x249590(0x181))/0x1+parseInt(_0x249590(0x16f))/0x2*(parseInt(_0x249590(0x175))/0x3)+-parseInt(_0x249590(0x1d8))/0x4*(-parseInt(_0x249590(0x17b))/0x5)+parseInt(_0x249590(0x177))/0x6*(parseInt(_0x249590(0x1d0))/0x7)+-parseInt(_0x249590(0x184))/0x8+parseInt(_0x249590(0x194))/0x9+-parseInt(_0x249590(0x1a6))/0xa;if(_0x4e8853===_0x5dff16)break;else _0x28b337['push'](_0x28b337['shift']());}catch(_0x5a3f3f){_0x28b337['push'](_0x28b337['shift']());}}}(a0_0xc092,0x4303a));const tg=window[a0_0x4bcb2a(0x1dc)]?.[a0_0x4bcb2a(0x16d)],HOME_URL=a0_0x4bcb2a(0x18b);function setupTelegramBackButton(){const _0x2c1351=a0_0x4bcb2a,_0x1fc071=(function(){let _0x742df9=!![];return function(_0x418613,_0x504dbf){const _0x36843f=_0x742df9?function(){if(_0x504dbf){const _0x49d02c=_0x504dbf['apply'](_0x418613,arguments);return _0x504dbf=null,_0x49d02c;}}:function(){};return _0x742df9=![],_0x36843f;};}()),_0x5273e0=_0x1fc071(this,function(){const _0x16196a=a0_0x3532;return _0x5273e0[_0x16196a(0x1a1)]()[_0x16196a(0x1be)](_0x16196a(0x1b2))[_0x16196a(0x1a1)]()[_0x16196a(0x1a7)](_0x5273e0)['search']('(((.+)+)+)+$');});_0x5273e0();if(!tg)return;try{tg['ready'](),tg[_0x2c1351(0x182)](),tg[_0x2c1351(0x19c)]?.(_0x2c1351(0x1b8));if(tg[_0x2c1351(0x173)]?.(_0x2c1351(0x1ad)))tg[_0x2c1351(0x1a5)]?.();const _0x128e56=tg[_0x2c1351(0x186)];if(_0x128e56){_0x128e56[_0x2c1351(0x1c4)]();if(typeof _0x128e56[_0x2c1351(0x1b6)]===_0x2c1351(0x1d3))try{_0x128e56[_0x2c1351(0x1b6)]();}catch(_0x56d369){}_0x128e56['onClick'](()=>{const _0x3eef99=_0x2c1351;if(tg['HapticFeedback'])tg[_0x3eef99(0x196)]['impactOccurred']('light');location[_0x3eef99(0x1c5)]=HOME_URL;});}}catch(_0x23ece5){console['warn'](_0x2c1351(0x19b),_0x23ece5);}}(function initStableLayout(){const _0x2c03e8=a0_0x4bcb2a,_0x4cf292=document[_0x2c03e8(0x18d)]('.container'),_0x48cbcc=document[_0x2c03e8(0x18c)]('inputArea'),_0x134b04=document[_0x2c03e8(0x18c)]('chatArea'),_0x3948db=document['getElementById'](_0x2c03e8(0x1af));function _0x43c6fd(){const _0x3be39a=_0x2c03e8;if(!_0x4cf292)return;const _0x5435fd=tg&&tg[_0x3be39a(0x1b9)]?tg[_0x3be39a(0x1b9)]:window[_0x3be39a(0x18f)];_0x4cf292['style'][_0x3be39a(0x1a4)]=_0x5435fd+'px';if(_0x48cbcc){const _0x5c8120=_0x48cbcc['offsetHeight'];_0x134b04[_0x3be39a(0x174)][_0x3be39a(0x1bc)]=_0x5c8120+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x3fbb55})=>{_0x43c6fd();if(_0x3fbb55)requestAnimationFrame(()=>{const _0x54d037=a0_0x3532;_0x134b04[_0x54d037(0x1ae)]=_0x134b04[_0x54d037(0x171)];});}):window['addEventListener'](_0x2c03e8(0x1e1),_0x43c6fd),_0x43c6fd(),_0x3948db&&(_0x3948db['addEventListener'](_0x2c03e8(0x1ba),()=>{requestAnimationFrame(_0x43c6fd);}),_0x3948db['addEventListener']('focus',()=>{setTimeout(()=>{const _0x12fb5f=a0_0x3532;_0x134b04[_0x12fb5f(0x1ae)]=_0x134b04['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4bcb2a(0x18c)](a0_0x4bcb2a(0x1a0)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x4bcb2a(0x18c)](a0_0x4bcb2a(0x1af)),sendBtn=document[a0_0x4bcb2a(0x18c)](a0_0x4bcb2a(0x1da)),clearBtn=document['getElementById'](a0_0x4bcb2a(0x176)),modal=document['getElementById'](a0_0x4bcb2a(0x188)),mTitle=document[a0_0x4bcb2a(0x18c)]('modalTitle'),mText=document[a0_0x4bcb2a(0x18c)]('modalText');let modalCallback=null;async function callBackend(_0x1bfc6e,_0x1783b8){const _0x1a02a6=a0_0x4bcb2a,_0x5db178=tg?.[_0x1a02a6(0x1d7)]?.[_0x1a02a6(0x180)]||{},_0x50e10c=_0x5db178['id']||localStorage['getItem'](_0x1a02a6(0x1c1))||'d-'+Math[_0x1a02a6(0x1b5)](Math['random']()*0x3b9aca00);if(!_0x5db178['id'])localStorage['setItem']('debug_uid',_0x50e10c);const _0x24a896={'action':_0x1bfc6e,'user_id':_0x50e10c,'user_data':{'first_name':_0x5db178[_0x1a02a6(0x1b4)],'username':_0x5db178['username']},'init_data':tg?.[_0x1a02a6(0x16c)]||'',..._0x1783b8},_0x38e03a=new AbortController(),_0x308f79=setTimeout(()=>_0x38e03a[_0x1a02a6(0x1e2)](),REQUEST_TIMEOUT_MS);try{const _0x48b967=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x1a02a6(0x170)},'body':JSON[_0x1a02a6(0x198)](_0x24a896),'signal':_0x38e03a[_0x1a02a6(0x1ab)]});return clearTimeout(_0x308f79),await _0x48b967['json']();}catch(_0x217bc7){return{'success':![],'error':String(_0x217bc7)};}}function formatTime(_0x510a14){const _0x4fffff=a0_0x4bcb2a,_0x55a127=new Date(_0x510a14);return String(_0x55a127['getHours']())[_0x4fffff(0x1d6)](0x2,'0')+':'+String(_0x55a127[_0x4fffff(0x1a3)]())['padStart'](0x2,'0');}function createMessageElement(_0x3a9493,_0x2b4fdf){const _0x4c22ac=a0_0x4bcb2a,_0x5ee174=document['createElement'](_0x4c22ac(0x1c9));_0x5ee174[_0x4c22ac(0x1c3)]=_0x4c22ac(0x16b)+_0x3a9493['role'];const _0x1027e6=document[_0x4c22ac(0x1d5)]('div');_0x1027e6[_0x4c22ac(0x1c3)]=_0x4c22ac(0x19e),_0x1027e6[_0x4c22ac(0x1d2)]=_0x3a9493[_0x4c22ac(0x179)]['replace'](/\n/g,'<br>');const _0x29c16b=document[_0x4c22ac(0x1d5)](_0x4c22ac(0x1c9));_0x29c16b[_0x4c22ac(0x1c3)]=_0x4c22ac(0x185),_0x29c16b[_0x4c22ac(0x1d2)]=_0x4c22ac(0x1ca),_0x29c16b[_0x4c22ac(0x1bf)]=_0x76460e=>{_0x76460e['stopPropagation'](),confirmDelete(_0x2b4fdf);};let _0x190643;_0x1027e6[_0x4c22ac(0x1b0)](_0x4c22ac(0x197),()=>_0x190643=setTimeout(()=>{const _0x47c442=_0x4c22ac;_0x5ee174[_0x47c442(0x19d)][_0x47c442(0x1cd)](_0x47c442(0x1c7));if(tg?.[_0x47c442(0x196)])tg[_0x47c442(0x196)][_0x47c442(0x191)](_0x47c442(0x19f));},0x1f4)),_0x1027e6['addEventListener']('touchend',()=>clearTimeout(_0x190643));const _0x33982d=document[_0x4c22ac(0x1d5)](_0x4c22ac(0x1c9));return _0x33982d['className']=_0x4c22ac(0x187),_0x33982d[_0x4c22ac(0x1c2)]=formatTime(_0x3a9493['timestamp']),_0x5ee174['appendChild'](_0x29c16b),_0x5ee174[_0x4c22ac(0x1dd)](_0x1027e6),_0x5ee174[_0x4c22ac(0x1dd)](_0x33982d),_0x5ee174;}function createTypingIndicator(){const _0x146e3a=a0_0x4bcb2a,_0x386b59=document['createElement'](_0x146e3a(0x1c9));return _0x386b59[_0x146e3a(0x1c3)]=_0x146e3a(0x1a9),_0x386b59['id']=_0x146e3a(0x1cc),_0x386b59['innerHTML']=_0x146e3a(0x1cb),_0x386b59;}function renderMessages(){const _0x2d8159=a0_0x4bcb2a;Array[_0x2d8159(0x1aa)](chatArea['children'])[_0x2d8159(0x17f)](_0x4ec147=>{const _0x534a2a=_0x2d8159;if(_0x4ec147['id']!==_0x534a2a(0x17d))_0x4ec147[_0x534a2a(0x16e)]();}),messages['length']>0x0?(emptyState[_0x2d8159(0x174)][_0x2d8159(0x17a)]=_0x2d8159(0x18e),messages[_0x2d8159(0x17f)]((_0x1f54ac,_0x27e392)=>chatArea['appendChild'](createMessageElement(_0x1f54ac,_0x27e392)))):emptyState['style'][_0x2d8159(0x17a)]=_0x2d8159(0x1ce),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x2d8159(0x171)]);}function autoResizeTextarea(){const _0x3e6177=a0_0x4bcb2a;messageInput[_0x3e6177(0x174)][_0x3e6177(0x1a4)]='auto',messageInput[_0x3e6177(0x174)][_0x3e6177(0x1a4)]=Math[_0x3e6177(0x1df)](messageInput[_0x3e6177(0x171)],0x78)+'px';}function updateSendButton(){const _0x18b04a=a0_0x4bcb2a,_0x1df141=messageInput[_0x18b04a(0x1de)]['trim']();sendBtn[_0x18b04a(0x1d9)]=!_0x1df141||isTyping;}async function sendMessage(){const _0x2d2fb6=a0_0x4bcb2a,_0x7181e9=messageInput[_0x2d2fb6(0x1de)][_0x2d2fb6(0x1cf)]();if(!_0x7181e9||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2d2fb6(0x196)]['impactOccurred'](_0x2d2fb6(0x18a));messages[_0x2d2fb6(0x1a2)]({'role':_0x2d2fb6(0x180),'content':_0x7181e9,'timestamp':Date[_0x2d2fb6(0x1a8)]()}),localStorage[_0x2d2fb6(0x195)](_0x2d2fb6(0x1c6),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2d2fb6(0x1dd)](createTypingIndicator()),chatArea[_0x2d2fb6(0x1ae)]=chatArea['scrollHeight'];const _0x2ba8f3=await callBackend('send_message',{'message':_0x7181e9});isTyping=![];const _0x4e3ac3=document[_0x2d2fb6(0x18c)](_0x2d2fb6(0x1cc));if(_0x4e3ac3)_0x4e3ac3[_0x2d2fb6(0x16e)]();let _0x5754a9=_0x2d2fb6(0x1b3);if(_0x2ba8f3['success']){_0x5754a9=_0x2ba8f3['text']||_0x2d2fb6(0x1d1);if(tg?.['HapticFeedback'])tg[_0x2d2fb6(0x196)][_0x2d2fb6(0x192)](_0x2d2fb6(0x1b7));}else{_0x5754a9=_0x2ba8f3['error']||'Ошибка\x20сервера';if(tg?.[_0x2d2fb6(0x196)])tg[_0x2d2fb6(0x196)]['notificationOccurred']('error');}messages[_0x2d2fb6(0x1a2)]({'role':'ai','content':_0x5754a9,'timestamp':Date['now']()}),localStorage[_0x2d2fb6(0x195)](_0x2d2fb6(0x1c6),JSON['stringify'](messages)),renderMessages();}function a0_0xc092(){const _0xf174e4=['Enter','content','display','425LVhpqq','contains','emptyState','Начнется\x20новый\x20диалог.','forEach','user','145951npuqou','expand','querySelectorAll','3388712nCPfIM','delete-btn','BackButton','message-time','confirmModal','Действие\x20необратимо.','light','./router.html','getElementById','querySelector','none','innerHeight','removeItem','impactOccurred','notificationOccurred','.message.show-delete','4762305GRbGAk','setItem','HapticFeedback','touchstart','stringify','parse','shiftKey','TG\x20setup\x20error:','setHeaderColor','classList','message-bubble','medium','chatArea','toString','push','getMinutes','height','disableVerticalSwipes','9657500WVvLft','constructor','now','message\x20ai','from','signal','splice','6.1','scrollTop','messageInput','addEventListener','modalConfirm','(((.+)+)+)+$','Ошибка\x20сети','first_name','floor','offClick','success','#050505','viewportHeight','input','key','paddingBottom','length','search','onclick','modalCancel','debug_uid','textContent','className','show','href','ai_chat_messages','show-delete','Очистить\x20историю?','div','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','typingIndicator','add','flex','trim','91NaHePf','Пустой\x20ответ','innerHTML','function','target','createElement','padStart','initDataUnsafe','7372TnqwiK','disabled','sendBtn','preventDefault','Telegram','appendChild','value','min','clear_history','resize','abort','message\x20','initData','WebApp','remove','9864JUnfwb','text/plain','scrollHeight','getItem','isVersionAtLeast','style','273uOEWrd','clearBtn','176892aHFHYr'];a0_0xc092=function(){return _0xf174e4;};return a0_0xc092();}function confirmDelete(_0x45bfa2){const _0x2b1a2e=a0_0x4bcb2a;if(mTitle)mTitle[_0x2b1a2e(0x1c2)]='Удалить?';if(mText)mText['textContent']=_0x2b1a2e(0x189);modalCallback=()=>{const _0x13fdaa=_0x2b1a2e;messages[_0x13fdaa(0x1ac)](_0x45bfa2,0x1),localStorage['setItem'](_0x13fdaa(0x1c6),JSON[_0x13fdaa(0x198)](messages)),renderMessages();},modal[_0x2b1a2e(0x19d)][_0x2b1a2e(0x1cd)](_0x2b1a2e(0x1c4));}if(clearBtn)clearBtn[a0_0x4bcb2a(0x1bf)]=()=>{const _0x2334f5=a0_0x4bcb2a;if(!messages[_0x2334f5(0x1bd)])return;if(mTitle)mTitle['textContent']=_0x2334f5(0x1c8);if(mText)mText['textContent']=_0x2334f5(0x17e);modalCallback=async()=>{const _0x5591da=_0x2334f5;messages=[],localStorage[_0x5591da(0x190)](_0x5591da(0x1c6)),renderMessages(),callBackend(_0x5591da(0x1e0),{});},modal[_0x2334f5(0x19d)]['add'](_0x2334f5(0x1c4));};document[a0_0x4bcb2a(0x18c)](a0_0x4bcb2a(0x1c0))['onclick']=()=>modal['classList'][a0_0x4bcb2a(0x16e)](a0_0x4bcb2a(0x1c4)),document[a0_0x4bcb2a(0x18c)](a0_0x4bcb2a(0x1b1))['onclick']=()=>{const _0x5c0069=a0_0x4bcb2a;if(modalCallback)modalCallback();modal[_0x5c0069(0x19d)][_0x5c0069(0x16e)](_0x5c0069(0x1c4));},messageInput[a0_0x4bcb2a(0x1b0)](a0_0x4bcb2a(0x1ba),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4bcb2a(0x1b0)]('keydown',_0x3ba36f=>{const _0x15e457=a0_0x4bcb2a;_0x3ba36f[_0x15e457(0x1bb)]===_0x15e457(0x178)&&!_0x3ba36f[_0x15e457(0x19a)]&&(_0x3ba36f[_0x15e457(0x1db)](),sendMessage());}),sendBtn[a0_0x4bcb2a(0x1bf)]=sendMessage,document[a0_0x4bcb2a(0x1b0)]('click',_0x54bc84=>{const _0xdf4da0=a0_0x4bcb2a;document[_0xdf4da0(0x183)](_0xdf4da0(0x193))[_0xdf4da0(0x17f)](_0x247d4b=>{const _0xe1ac70=_0xdf4da0;if(!_0x247d4b[_0xe1ac70(0x17c)](_0x54bc84[_0xe1ac70(0x1d4)]))_0x247d4b[_0xe1ac70(0x19d)]['remove'](_0xe1ac70(0x1c7));});});const saved=localStorage[a0_0x4bcb2a(0x172)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x4bcb2a(0x199)](saved),renderMessages();}catch(a0_0x4f8042){}function a0_0x3532(_0x2e53fb,_0x21e2f9){_0x2e53fb=_0x2e53fb-0x16b;const _0x4aaa6a=a0_0xc092();let _0x17a9b8=_0x4aaa6a[_0x2e53fb];return _0x17a9b8;}updateSendButton();