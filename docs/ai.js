const a0_0x15c247=a0_0x3488;(function(_0x142879,_0x5c74ea){const _0x5e272c=a0_0x3488,_0x55a921=_0x142879();while(!![]){try{const _0x26ddb1=-parseInt(_0x5e272c(0x16f))/0x1+-parseInt(_0x5e272c(0x177))/0x2*(-parseInt(_0x5e272c(0x12d))/0x3)+-parseInt(_0x5e272c(0x188))/0x4*(parseInt(_0x5e272c(0x112))/0x5)+-parseInt(_0x5e272c(0x15c))/0x6+parseInt(_0x5e272c(0x12c))/0x7*(parseInt(_0x5e272c(0x16b))/0x8)+parseInt(_0x5e272c(0x141))/0x9+parseInt(_0x5e272c(0x13d))/0xa;if(_0x26ddb1===_0x5c74ea)break;else _0x55a921['push'](_0x55a921['shift']());}catch(_0x47fd94){_0x55a921['push'](_0x55a921['shift']());}}}(a0_0x4a4c,0xb5273));const tg=window[a0_0x15c247(0x180)]?.[a0_0x15c247(0x189)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x52d830=a0_0x15c247;if(!tg)return;try{tg[_0x52d830(0x13c)](),tg[_0x52d830(0x120)](),tg[_0x52d830(0x151)]?.('#050505');if(tg[_0x52d830(0x139)]?.(_0x52d830(0x155)))tg[_0x52d830(0x164)]?.();const _0x43eaa4=tg[_0x52d830(0x160)];if(_0x43eaa4){_0x43eaa4[_0x52d830(0x132)]();if(typeof _0x43eaa4[_0x52d830(0x144)]===_0x52d830(0x185))try{_0x43eaa4[_0x52d830(0x144)]();}catch(_0x3b6c4d){}_0x43eaa4[_0x52d830(0x126)](()=>{const _0x5d5818=_0x52d830;if(tg[_0x5d5818(0x181)])tg[_0x5d5818(0x181)][_0x5d5818(0x14e)](_0x5d5818(0x12f));location[_0x5d5818(0x15f)]=HOME_URL;});}}catch(_0x4d9e9b){console[_0x52d830(0x14a)](_0x52d830(0x156),_0x4d9e9b);}}(function initStableLayout(){const _0x48ec16=a0_0x15c247,_0x30100c=(function(){let _0x17e946=!![];return function(_0xb80d1d,_0x16dd76){const _0x4dddda=_0x17e946?function(){const _0x589f5e=a0_0x3488;if(_0x16dd76){const _0x554764=_0x16dd76[_0x589f5e(0x116)](_0xb80d1d,arguments);return _0x16dd76=null,_0x554764;}}:function(){};return _0x17e946=![],_0x4dddda;};}()),_0x18e51a=document[_0x48ec16(0x146)](_0x48ec16(0x17f)),_0x1967b8=document['getElementById'](_0x48ec16(0x16d)),_0x4bc0a6=document[_0x48ec16(0x15a)](_0x48ec16(0x15d)),_0x2ce604=document[_0x48ec16(0x15a)](_0x48ec16(0x133));function _0x571909(){const _0x3927b8=_0x48ec16,_0x18a0e6=_0x30100c(this,function(){const _0x1ed216=a0_0x3488;return _0x18a0e6[_0x1ed216(0x134)]()[_0x1ed216(0x137)](_0x1ed216(0x11a))['toString']()[_0x1ed216(0x11c)](_0x18a0e6)[_0x1ed216(0x137)](_0x1ed216(0x11a));});_0x18a0e6();if(!_0x18e51a)return;const _0x54fa6c=tg&&tg[_0x3927b8(0x15b)]?tg[_0x3927b8(0x15b)]:window[_0x3927b8(0x17e)];_0x18e51a[_0x3927b8(0x170)][_0x3927b8(0x163)]=_0x54fa6c+'px';if(_0x1967b8){const _0x55e7b1=_0x1967b8[_0x3927b8(0x138)];_0x4bc0a6[_0x3927b8(0x170)]['paddingBottom']=_0x55e7b1+0x28+'px';}}tg?tg[_0x48ec16(0x121)]('viewportChanged',({isStateStable:_0x36908f})=>{_0x571909();if(_0x36908f)requestAnimationFrame(()=>{const _0x5e1800=a0_0x3488;_0x4bc0a6['scrollTop']=_0x4bc0a6[_0x5e1800(0x115)];});}):window['addEventListener'](_0x48ec16(0x158),_0x571909),_0x571909(),_0x2ce604&&(_0x2ce604['addEventListener'](_0x48ec16(0x10d),()=>{requestAnimationFrame(_0x571909);}),_0x2ce604[_0x48ec16(0x172)](_0x48ec16(0x167),()=>{setTimeout(()=>{const _0x3c7d35=a0_0x3488;_0x4bc0a6[_0x3c7d35(0x113)]=_0x4bc0a6[_0x3c7d35(0x115)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x15c247(0x15a)](a0_0x15c247(0x15d)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x15c247(0x15a)](a0_0x15c247(0x133)),sendBtn=document[a0_0x15c247(0x15a)](a0_0x15c247(0x128)),clearBtn=document['getElementById'](a0_0x15c247(0x11d)),modal=document[a0_0x15c247(0x15a)]('confirmModal'),mTitle=document[a0_0x15c247(0x15a)]('modalTitle'),mText=document[a0_0x15c247(0x15a)](a0_0x15c247(0x14f));let modalCallback=null;function a0_0x3488(_0x15a968,_0x399da0){_0x15a968=_0x15a968-0x10d;const _0x76e553=a0_0x4a4c();let _0x283ea5=_0x76e553[_0x15a968];return _0x283ea5;}async function callBackend(_0xdb1e2b,_0x549bdd){const _0x4eced6=a0_0x15c247,_0x543e2b=tg?.[_0x4eced6(0x12e)]?.['user']||{},_0x2a9a01=_0x543e2b['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x4eced6(0x162)](Math['random']()*0x3b9aca00);if(!_0x543e2b['id'])localStorage[_0x4eced6(0x17a)](_0x4eced6(0x129),_0x2a9a01);const _0x486006={'action':_0xdb1e2b,'user_id':_0x2a9a01,'user_data':{'first_name':_0x543e2b['first_name'],'username':_0x543e2b[_0x4eced6(0x17d)]},'init_data':tg?.[_0x4eced6(0x131)]||'',..._0x549bdd},_0x377696=new AbortController(),_0x3fe41a=setTimeout(()=>_0x377696[_0x4eced6(0x143)](),REQUEST_TIMEOUT_MS);try{const _0x3ae8bd=await fetch(BACKEND_URL,{'method':_0x4eced6(0x114),'headers':{'Content-Type':_0x4eced6(0x118)},'body':JSON[_0x4eced6(0x147)](_0x486006),'signal':_0x377696[_0x4eced6(0x184)]});return clearTimeout(_0x3fe41a),await _0x3ae8bd[_0x4eced6(0x18a)]();}catch(_0x219077){return{'success':![],'error':String(_0x219077)};}}function formatTime(_0x30346d){const _0x16e4d2=a0_0x15c247,_0x10c8ed=new Date(_0x30346d);return String(_0x10c8ed[_0x16e4d2(0x183)]())[_0x16e4d2(0x123)](0x2,'0')+':'+String(_0x10c8ed[_0x16e4d2(0x166)]())['padStart'](0x2,'0');}function createMessageElement(_0x31fb55,_0x2f8d67){const _0x4c5d5c=a0_0x15c247,_0x5c1431=document[_0x4c5d5c(0x171)](_0x4c5d5c(0x124));_0x5c1431[_0x4c5d5c(0x168)]=_0x4c5d5c(0x16e)+_0x31fb55[_0x4c5d5c(0x10f)];const _0x4920b8=document[_0x4c5d5c(0x171)](_0x4c5d5c(0x124));_0x4920b8[_0x4c5d5c(0x168)]=_0x4c5d5c(0x15e),_0x4920b8[_0x4c5d5c(0x136)]=_0x31fb55[_0x4c5d5c(0x11f)]['replace'](/\n/g,_0x4c5d5c(0x148));const _0x38505c=document[_0x4c5d5c(0x171)]('div');_0x38505c['className']='delete-btn',_0x38505c[_0x4c5d5c(0x136)]=_0x4c5d5c(0x17c),_0x38505c[_0x4c5d5c(0x13e)]=_0x2eb713=>{const _0x4d0e15=_0x4c5d5c;_0x2eb713[_0x4d0e15(0x174)](),confirmDelete(_0x2f8d67);};let _0x560e6c;_0x4920b8[_0x4c5d5c(0x172)]('touchstart',()=>_0x560e6c=setTimeout(()=>{const _0x334f54=_0x4c5d5c;_0x5c1431[_0x334f54(0x150)][_0x334f54(0x135)](_0x334f54(0x122));if(tg?.[_0x334f54(0x181)])tg[_0x334f54(0x181)][_0x334f54(0x14e)](_0x334f54(0x14d));},0x1f4)),_0x4920b8[_0x4c5d5c(0x172)]('touchend',()=>clearTimeout(_0x560e6c));const _0x9a3b1f=document['createElement'](_0x4c5d5c(0x124));return _0x9a3b1f[_0x4c5d5c(0x168)]=_0x4c5d5c(0x142),_0x9a3b1f[_0x4c5d5c(0x16c)]=formatTime(_0x31fb55[_0x4c5d5c(0x12a)]),_0x5c1431[_0x4c5d5c(0x161)](_0x38505c),_0x5c1431['appendChild'](_0x4920b8),_0x5c1431['appendChild'](_0x9a3b1f),_0x5c1431;}function createTypingIndicator(){const _0x3d0a0d=a0_0x15c247,_0x37a076=document['createElement'](_0x3d0a0d(0x124));return _0x37a076[_0x3d0a0d(0x168)]=_0x3d0a0d(0x153),_0x37a076['id']=_0x3d0a0d(0x125),_0x37a076[_0x3d0a0d(0x136)]=_0x3d0a0d(0x111),_0x37a076;}function renderMessages(){const _0xa5ccc9=a0_0x15c247;Array['from'](chatArea[_0xa5ccc9(0x140)])[_0xa5ccc9(0x110)](_0x5bd060=>{const _0x494c46=_0xa5ccc9;if(_0x5bd060['id']!=='emptyState')_0x5bd060[_0x494c46(0x182)]();}),messages['length']>0x0?(emptyState[_0xa5ccc9(0x170)][_0xa5ccc9(0x175)]='none',messages[_0xa5ccc9(0x110)]((_0x4373c0,_0x3a5dc1)=>chatArea[_0xa5ccc9(0x161)](createMessageElement(_0x4373c0,_0x3a5dc1)))):emptyState[_0xa5ccc9(0x170)][_0xa5ccc9(0x175)]=_0xa5ccc9(0x149),requestAnimationFrame(()=>chatArea[_0xa5ccc9(0x113)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x1a8e71=a0_0x15c247;messageInput[_0x1a8e71(0x170)][_0x1a8e71(0x163)]='auto',messageInput['style'][_0x1a8e71(0x163)]=Math['min'](messageInput[_0x1a8e71(0x115)],0x78)+'px';}function updateSendButton(){const _0x8e187=a0_0x15c247,_0x45866b=messageInput[_0x8e187(0x178)]['trim']();sendBtn[_0x8e187(0x14b)]=!_0x45866b||isTyping;}async function sendMessage(){const _0x2d624b=a0_0x15c247,_0x1038b3=messageInput[_0x2d624b(0x178)][_0x2d624b(0x176)]();if(!_0x1038b3||isTyping)return;if(tg?.[_0x2d624b(0x181)])tg['HapticFeedback'][_0x2d624b(0x14e)](_0x2d624b(0x12f));messages[_0x2d624b(0x12b)]({'role':_0x2d624b(0x13f),'content':_0x1038b3,'timestamp':Date[_0x2d624b(0x127)]()}),localStorage[_0x2d624b(0x17a)](_0x2d624b(0x152),JSON[_0x2d624b(0x147)](messages)),renderMessages(),messageInput[_0x2d624b(0x178)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2d624b(0x161)](createTypingIndicator()),chatArea[_0x2d624b(0x113)]=chatArea[_0x2d624b(0x115)];const _0xb5113a=await callBackend(_0x2d624b(0x13b),{'message':_0x1038b3});isTyping=![];const _0x2a13fb=document[_0x2d624b(0x15a)](_0x2d624b(0x125));if(_0x2a13fb)_0x2a13fb[_0x2d624b(0x182)]();let _0x495108=_0x2d624b(0x119);if(_0xb5113a[_0x2d624b(0x11e)]){_0x495108=_0xb5113a[_0x2d624b(0x165)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg[_0x2d624b(0x181)][_0x2d624b(0x130)](_0x2d624b(0x11e));}else{_0x495108=_0xb5113a[_0x2d624b(0x10e)]||_0x2d624b(0x16a);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x2d624b(0x130)](_0x2d624b(0x10e));}messages[_0x2d624b(0x12b)]({'role':'ai','content':_0x495108,'timestamp':Date['now']()}),localStorage[_0x2d624b(0x17a)](_0x2d624b(0x152),JSON[_0x2d624b(0x147)](messages)),renderMessages();}function confirmDelete(_0x2b81a5){const _0x27cc73=a0_0x15c247;if(mTitle)mTitle[_0x27cc73(0x16c)]=_0x27cc73(0x159);if(mText)mText[_0x27cc73(0x16c)]=_0x27cc73(0x186);modalCallback=()=>{const _0x2cd9e5=_0x27cc73;messages['splice'](_0x2b81a5,0x1),localStorage[_0x2cd9e5(0x17a)](_0x2cd9e5(0x152),JSON[_0x2cd9e5(0x147)](messages)),renderMessages();},modal[_0x27cc73(0x150)][_0x27cc73(0x135)](_0x27cc73(0x132));}if(clearBtn)clearBtn[a0_0x15c247(0x13e)]=()=>{const _0x2ab2bf=a0_0x15c247;if(!messages[_0x2ab2bf(0x169)])return;if(mTitle)mTitle[_0x2ab2bf(0x16c)]='Очистить\x20историю?';if(mText)mText[_0x2ab2bf(0x16c)]=_0x2ab2bf(0x179);modalCallback=async()=>{const _0x44021b=_0x2ab2bf;messages=[],localStorage[_0x44021b(0x17b)](_0x44021b(0x152)),renderMessages(),callBackend(_0x44021b(0x187),{});},modal['classList']['add'](_0x2ab2bf(0x132));};function a0_0x4a4c(){const _0x2a6942=['forEach','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','237865pinLrI','scrollTop','POST','scrollHeight','apply','keydown','text/plain','Ошибка\x20сети','(((.+)+)+)+$','modalConfirm','constructor','clearBtn','success','content','expand','onEvent','show-delete','padStart','div','typingIndicator','onClick','now','sendBtn','debug_uid','timestamp','push','42XnXtNb','8067XENDvY','initDataUnsafe','light','notificationOccurred','initData','show','messageInput','toString','add','innerHTML','search','offsetHeight','isVersionAtLeast','key','send_message','ready','2176730cOoanJ','onclick','user','children','4401144CXXGOs','message-time','abort','offClick','querySelectorAll','querySelector','stringify','<br>','flex','warn','disabled','click','medium','impactOccurred','modalText','classList','setHeaderColor','ai_chat_messages','message\x20ai','contains','6.1','TG\x20setup\x20error:','modalCancel','resize','Удалить?','getElementById','viewportHeight','45822RLUWCt','chatArea','message-bubble','href','BackButton','appendChild','floor','height','disableVerticalSwipes','text','getMinutes','focus','className','length','Ошибка\x20сервера','1131296FNrwCy','textContent','inputArea','message\x20','1323265EQdIUo','style','createElement','addEventListener','target','stopPropagation','display','trim','562fdAeZD','value','Начнется\x20новый\x20диалог.','setItem','removeItem','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','username','innerHeight','.container','Telegram','HapticFeedback','remove','getHours','signal','function','Действие\x20необратимо.','clear_history','20PYaoKs','WebApp','json','input','error','role'];a0_0x4a4c=function(){return _0x2a6942;};return a0_0x4a4c();}document[a0_0x15c247(0x15a)](a0_0x15c247(0x157))[a0_0x15c247(0x13e)]=()=>modal[a0_0x15c247(0x150)][a0_0x15c247(0x182)](a0_0x15c247(0x132)),document[a0_0x15c247(0x15a)](a0_0x15c247(0x11b))['onclick']=()=>{const _0x4f96c7=a0_0x15c247;if(modalCallback)modalCallback();modal['classList']['remove'](_0x4f96c7(0x132));},messageInput[a0_0x15c247(0x172)](a0_0x15c247(0x10d),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x15c247(0x172)](a0_0x15c247(0x117),_0x505ffa=>{const _0x43b60c=a0_0x15c247;_0x505ffa[_0x43b60c(0x13a)]==='Enter'&&!_0x505ffa['shiftKey']&&(_0x505ffa['preventDefault'](),sendMessage());}),sendBtn[a0_0x15c247(0x13e)]=sendMessage,document['addEventListener'](a0_0x15c247(0x14c),_0x1a72b5=>{const _0x26cbe3=a0_0x15c247;document[_0x26cbe3(0x145)]('.message.show-delete')[_0x26cbe3(0x110)](_0x5f1211=>{const _0x173aba=_0x26cbe3;if(!_0x5f1211[_0x173aba(0x154)](_0x1a72b5[_0x173aba(0x173)]))_0x5f1211[_0x173aba(0x150)]['remove']('show-delete');});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x4c41f4){}updateSendButton();