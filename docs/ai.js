const a0_0x54e380=a0_0xa859;function a0_0x5825(){const _0x4dc8d7=['onClick','confirmModal','stringify','getMinutes','messageInput','message\x20','scrollTop','push','Ошибка\x20сети','disableVerticalSwipes','innerHTML','BackButton','sendBtn','flex','8AvDmge','abort','typingIndicator','emptyState','notificationOccurred','15393100SwkxNk','ai_chat_messages','HapticFeedback','inputArea','add','487iWCNgL','WebApp','POST','message-bubble','Ошибка\x20сервера','height','input','touchend','trim','padStart','TG\x20setup\x20error:','onclick','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','text','floor','12191817nsPMoy','message-time','shiftKey','success','modalCancel','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','initDataUnsafe','debug_uid','Enter','14843187OXyBOV','timestamp','impactOccurred','paddingBottom','medium','target','length','.message.show-delete','modalText','initData','show-delete','min','content','signal','isVersionAtLeast','chatArea','modalConfirm','Начнется\x20новый\x20диалог.','toString','getElementById','appendChild','contains','value','focus','textContent','onEvent','54FfcNJT','scrollHeight','expand','createElement','querySelectorAll','div','show','replace','keydown','preventDefault','function','3017574MqHKeh','children','style','addEventListener','offClick','error','constructor','random','auto','disabled','send_message','971315VbdBZe','user','removeItem','getItem','light','classList','parse','clearBtn','stopPropagation','Telegram','from','#050505','offsetHeight','search','3102mzsSdD','Пустой\x20ответ','32044OZsVMn','role','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Очистить\x20историю?','setItem','remove','href','innerHeight','className','clear_history','username','querySelector','now','./router.html','viewportHeight','display','forEach','setHeaderColor','<br>','177wBscbe'];a0_0x5825=function(){return _0x4dc8d7;};return a0_0x5825();}(function(_0xfd4a07,_0x256d28){const _0x4b6ac1=a0_0xa859,_0x589347=_0xfd4a07();while(!![]){try{const _0x459550=parseInt(_0x4b6ac1(0xf8))/0x1*(parseInt(_0x4b6ac1(0xca))/0x2)+-parseInt(_0x4b6ac1(0xdf))/0x3*(-parseInt(_0x4b6ac1(0xcc))/0x4)+parseInt(_0x4b6ac1(0xbc))/0x5*(-parseInt(_0x4b6ac1(0x12a))/0x6)+parseInt(_0x4b6ac1(0xb1))/0x7+parseInt(_0x4b6ac1(0xee))/0x8*(-parseInt(_0x4b6ac1(0x110))/0x9)+parseInt(_0x4b6ac1(0xf3))/0xa+parseInt(_0x4b6ac1(0x107))/0xb;if(_0x459550===_0x256d28)break;else _0x589347['push'](_0x589347['shift']());}catch(_0x5182eb){_0x589347['push'](_0x589347['shift']());}}}(a0_0x5825,0xddf3b));const tg=window[a0_0x54e380(0xc5)]?.[a0_0x54e380(0xf9)],HOME_URL=a0_0x54e380(0xd9);function setupTelegramBackButton(){const _0x442104=a0_0x54e380;if(!tg)return;try{tg['ready'](),tg[_0x442104(0x12c)](),tg[_0x442104(0xdd)]?.(_0x442104(0xc7));if(tg[_0x442104(0x11e)]?.('6.1'))tg[_0x442104(0xe9)]?.();const _0x363c19=tg[_0x442104(0xeb)];if(_0x363c19){_0x363c19['show']();if(typeof _0x363c19[_0x442104(0xb5)]===_0x442104(0xb0))try{_0x363c19[_0x442104(0xb5)]();}catch(_0x28a3f8){}_0x363c19[_0x442104(0xe0)](()=>{const _0x1d83cf=_0x442104;if(tg[_0x1d83cf(0xf5)])tg['HapticFeedback']['impactOccurred'](_0x1d83cf(0xc0));location[_0x1d83cf(0xd2)]=HOME_URL;});}}catch(_0x58b657){console['warn'](_0x442104(0x102),_0x58b657);}}(function initStableLayout(){const _0x262ded=a0_0x54e380,_0x57f485=(function(){let _0x5039a5=!![];return function(_0x45dc94,_0x38800f){const _0x4caa02=_0x5039a5?function(){if(_0x38800f){const _0x51d3a9=_0x38800f['apply'](_0x45dc94,arguments);return _0x38800f=null,_0x51d3a9;}}:function(){};return _0x5039a5=![],_0x4caa02;};}()),_0x44f592=document[_0x262ded(0xd7)]('.container'),_0x21cabd=document[_0x262ded(0x123)](_0x262ded(0xf6)),_0x433f1b=document[_0x262ded(0x123)]('chatArea'),_0x163783=document[_0x262ded(0x123)](_0x262ded(0xe4));function _0x43a30b(){const _0xaa2f2=_0x262ded,_0x3eef02=_0x57f485(this,function(){const _0x412905=a0_0xa859;return _0x3eef02[_0x412905(0x122)]()[_0x412905(0xc9)]('(((.+)+)+)+$')['toString']()[_0x412905(0xb7)](_0x3eef02)['search']('(((.+)+)+)+$');});_0x3eef02();if(!_0x44f592)return;const _0x283594=tg&&tg[_0xaa2f2(0xda)]?tg[_0xaa2f2(0xda)]:window[_0xaa2f2(0xd3)];_0x44f592['style'][_0xaa2f2(0xfd)]=_0x283594+'px';if(_0x21cabd){const _0x577986=_0x21cabd[_0xaa2f2(0xc8)];_0x433f1b['style'][_0xaa2f2(0x113)]=_0x577986+0x28+'px';}}tg?tg[_0x262ded(0x129)]('viewportChanged',({isStateStable:_0x571870})=>{_0x43a30b();if(_0x571870)requestAnimationFrame(()=>{const _0x269026=a0_0xa859;_0x433f1b[_0x269026(0xe6)]=_0x433f1b[_0x269026(0x12b)];});}):window[_0x262ded(0xb4)]('resize',_0x43a30b),_0x43a30b(),_0x163783&&(_0x163783['addEventListener'](_0x262ded(0xfe),()=>{requestAnimationFrame(_0x43a30b);}),_0x163783[_0x262ded(0xb4)](_0x262ded(0x127),()=>{setTimeout(()=>{_0x433f1b['scrollTop']=_0x433f1b['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x54e380(0xce),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x54e380(0x11f)),emptyState=document['getElementById'](a0_0x54e380(0xf1)),messageInput=document['getElementById'](a0_0x54e380(0xe4)),sendBtn=document[a0_0x54e380(0x123)](a0_0x54e380(0xec)),clearBtn=document[a0_0x54e380(0x123)](a0_0x54e380(0xc3)),modal=document['getElementById'](a0_0x54e380(0xe1)),mTitle=document[a0_0x54e380(0x123)]('modalTitle'),mText=document[a0_0x54e380(0x123)](a0_0x54e380(0x118));let modalCallback=null;async function callBackend(_0x207f18,_0x49d1e4){const _0x46405b=a0_0x54e380,_0xdbc76c=tg?.[_0x46405b(0x10d)]?.['user']||{},_0x268261=_0xdbc76c['id']||localStorage[_0x46405b(0xbf)](_0x46405b(0x10e))||'d-'+Math[_0x46405b(0x106)](Math[_0x46405b(0xb8)]()*0x3b9aca00);if(!_0xdbc76c['id'])localStorage[_0x46405b(0xd0)](_0x46405b(0x10e),_0x268261);const _0x3b9f05={'action':_0x207f18,'user_id':_0x268261,'user_data':{'first_name':_0xdbc76c['first_name'],'username':_0xdbc76c[_0x46405b(0xd6)]},'init_data':tg?.[_0x46405b(0x119)]||'',..._0x49d1e4},_0x3793d2=new AbortController(),_0x1a68fe=setTimeout(()=>_0x3793d2[_0x46405b(0xef)](),REQUEST_TIMEOUT_MS);try{const _0x2d6e7d=await fetch(BACKEND_URL,{'method':_0x46405b(0xfa),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x3b9f05),'signal':_0x3793d2[_0x46405b(0x11d)]});return clearTimeout(_0x1a68fe),await _0x2d6e7d['json']();}catch(_0x5c0f3d){return{'success':![],'error':String(_0x5c0f3d)};}}function formatTime(_0x541e25){const _0x15adc7=a0_0x54e380,_0xa0fe94=new Date(_0x541e25);return String(_0xa0fe94['getHours']())[_0x15adc7(0x101)](0x2,'0')+':'+String(_0xa0fe94[_0x15adc7(0xe3)]())[_0x15adc7(0x101)](0x2,'0');}function createMessageElement(_0x12f3e9,_0x100ef9){const _0x35e53f=a0_0x54e380,_0x121683=document[_0x35e53f(0x12d)](_0x35e53f(0x12f));_0x121683['className']=_0x35e53f(0xe5)+_0x12f3e9[_0x35e53f(0xcd)];const _0x199b1a=document[_0x35e53f(0x12d)](_0x35e53f(0x12f));_0x199b1a[_0x35e53f(0xd4)]=_0x35e53f(0xfb),_0x199b1a['innerHTML']=_0x12f3e9[_0x35e53f(0x11c)][_0x35e53f(0xad)](/\n/g,_0x35e53f(0xde));const _0x5effdc=document['createElement'](_0x35e53f(0x12f));_0x5effdc[_0x35e53f(0xd4)]='delete-btn',_0x5effdc[_0x35e53f(0xea)]=_0x35e53f(0x10c),_0x5effdc[_0x35e53f(0x103)]=_0xb1fe3e=>{const _0x3ee5fb=_0x35e53f;_0xb1fe3e[_0x3ee5fb(0xc4)](),confirmDelete(_0x100ef9);};let _0x572cd7;_0x199b1a[_0x35e53f(0xb4)]('touchstart',()=>_0x572cd7=setTimeout(()=>{const _0x370425=_0x35e53f;_0x121683[_0x370425(0xc1)][_0x370425(0xf7)](_0x370425(0x11a));if(tg?.['HapticFeedback'])tg[_0x370425(0xf5)][_0x370425(0x112)](_0x370425(0x114));},0x1f4)),_0x199b1a['addEventListener'](_0x35e53f(0xff),()=>clearTimeout(_0x572cd7));const _0x4d384a=document[_0x35e53f(0x12d)](_0x35e53f(0x12f));return _0x4d384a[_0x35e53f(0xd4)]=_0x35e53f(0x108),_0x4d384a[_0x35e53f(0x128)]=formatTime(_0x12f3e9[_0x35e53f(0x111)]),_0x121683[_0x35e53f(0x124)](_0x5effdc),_0x121683[_0x35e53f(0x124)](_0x199b1a),_0x121683[_0x35e53f(0x124)](_0x4d384a),_0x121683;}function createTypingIndicator(){const _0x3f1cc0=a0_0x54e380,_0x5a4650=document['createElement']('div');return _0x5a4650[_0x3f1cc0(0xd4)]='message\x20ai',_0x5a4650['id']=_0x3f1cc0(0xf0),_0x5a4650['innerHTML']=_0x3f1cc0(0x104),_0x5a4650;}function renderMessages(){const _0x15ae94=a0_0x54e380;Array[_0x15ae94(0xc6)](chatArea[_0x15ae94(0xb2)])[_0x15ae94(0xdc)](_0x4a56d6=>{if(_0x4a56d6['id']!=='emptyState')_0x4a56d6['remove']();}),messages[_0x15ae94(0x116)]>0x0?(emptyState[_0x15ae94(0xb3)][_0x15ae94(0xdb)]='none',messages[_0x15ae94(0xdc)]((_0x285abe,_0x3c7d0c)=>chatArea[_0x15ae94(0x124)](createMessageElement(_0x285abe,_0x3c7d0c)))):emptyState[_0x15ae94(0xb3)][_0x15ae94(0xdb)]=_0x15ae94(0xed),requestAnimationFrame(()=>chatArea[_0x15ae94(0xe6)]=chatArea[_0x15ae94(0x12b)]);}function autoResizeTextarea(){const _0x2354ee=a0_0x54e380;messageInput['style'][_0x2354ee(0xfd)]=_0x2354ee(0xb9),messageInput[_0x2354ee(0xb3)][_0x2354ee(0xfd)]=Math[_0x2354ee(0x11b)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x2ed3c1=a0_0x54e380,_0x4d9a2b=messageInput[_0x2ed3c1(0x126)][_0x2ed3c1(0x100)]();sendBtn[_0x2ed3c1(0xba)]=!_0x4d9a2b||isTyping;}function a0_0xa859(_0x4e013c,_0x4c24eb){_0x4e013c=_0x4e013c-0xac;const _0x286094=a0_0x5825();let _0x2278bc=_0x286094[_0x4e013c];return _0x2278bc;}async function sendMessage(){const _0x12d5ea=a0_0x54e380,_0x1f2b46=messageInput[_0x12d5ea(0x126)][_0x12d5ea(0x100)]();if(!_0x1f2b46||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x12d5ea(0xf5)][_0x12d5ea(0x112)](_0x12d5ea(0xc0));messages[_0x12d5ea(0xe7)]({'role':_0x12d5ea(0xbd),'content':_0x1f2b46,'timestamp':Date['now']()}),localStorage[_0x12d5ea(0xd0)](_0x12d5ea(0xf4),JSON[_0x12d5ea(0xe2)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x12d5ea(0x124)](createTypingIndicator()),chatArea[_0x12d5ea(0xe6)]=chatArea[_0x12d5ea(0x12b)];const _0x3219bf=await callBackend(_0x12d5ea(0xbb),{'message':_0x1f2b46});isTyping=![];const _0x51d84=document[_0x12d5ea(0x123)](_0x12d5ea(0xf0));if(_0x51d84)_0x51d84['remove']();let _0x555056=_0x12d5ea(0xe8);if(_0x3219bf[_0x12d5ea(0x10a)]){_0x555056=_0x3219bf[_0x12d5ea(0x105)]||_0x12d5ea(0xcb);if(tg?.[_0x12d5ea(0xf5)])tg['HapticFeedback'][_0x12d5ea(0xf2)](_0x12d5ea(0x10a));}else{_0x555056=_0x3219bf[_0x12d5ea(0xb6)]||_0x12d5ea(0xfc);if(tg?.['HapticFeedback'])tg[_0x12d5ea(0xf5)][_0x12d5ea(0xf2)](_0x12d5ea(0xb6));}messages[_0x12d5ea(0xe7)]({'role':'ai','content':_0x555056,'timestamp':Date[_0x12d5ea(0xd8)]()}),localStorage[_0x12d5ea(0xd0)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x1b6774){const _0x327724=a0_0x54e380;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x327724(0x128)]='Действие\x20необратимо.';modalCallback=()=>{const _0x42a89b=_0x327724;messages['splice'](_0x1b6774,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x42a89b(0xe2)](messages)),renderMessages();},modal[_0x327724(0xc1)][_0x327724(0xf7)](_0x327724(0xac));}if(clearBtn)clearBtn[a0_0x54e380(0x103)]=()=>{const _0x26d75a=a0_0x54e380;if(!messages['length'])return;if(mTitle)mTitle[_0x26d75a(0x128)]=_0x26d75a(0xcf);if(mText)mText[_0x26d75a(0x128)]=_0x26d75a(0x121);modalCallback=async()=>{const _0x18d61c=_0x26d75a;messages=[],localStorage[_0x18d61c(0xbe)](_0x18d61c(0xf4)),renderMessages(),callBackend(_0x18d61c(0xd5),{});},modal[_0x26d75a(0xc1)][_0x26d75a(0xf7)](_0x26d75a(0xac));};document[a0_0x54e380(0x123)](a0_0x54e380(0x10b))[a0_0x54e380(0x103)]=()=>modal['classList'][a0_0x54e380(0xd1)](a0_0x54e380(0xac)),document[a0_0x54e380(0x123)](a0_0x54e380(0x120))[a0_0x54e380(0x103)]=()=>{const _0x59b01e=a0_0x54e380;if(modalCallback)modalCallback();modal[_0x59b01e(0xc1)][_0x59b01e(0xd1)](_0x59b01e(0xac));},messageInput[a0_0x54e380(0xb4)](a0_0x54e380(0xfe),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x54e380(0xae),_0x971918=>{const _0x567a45=a0_0x54e380;_0x971918['key']===_0x567a45(0x10f)&&!_0x971918[_0x567a45(0x109)]&&(_0x971918[_0x567a45(0xaf)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x54e380(0xb4)]('click',_0x3bc3d7=>{const _0x50da29=a0_0x54e380;document[_0x50da29(0x12e)](_0x50da29(0x117))[_0x50da29(0xdc)](_0x454cdb=>{const _0x16ed81=_0x50da29;if(!_0x454cdb[_0x16ed81(0x125)](_0x3bc3d7[_0x16ed81(0x115)]))_0x454cdb[_0x16ed81(0xc1)]['remove'](_0x16ed81(0x11a));});});const saved=localStorage[a0_0x54e380(0xbf)](a0_0x54e380(0xf4));if(saved)try{messages=JSON[a0_0x54e380(0xc2)](saved),renderMessages();}catch(a0_0x3dfc11){}updateSendButton();