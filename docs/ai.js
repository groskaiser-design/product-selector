const a0_0xd7e514=a0_0x1526;(function(_0x54eb1c,_0x59ea72){const _0x259748=a0_0x1526,_0x5ce99f=_0x54eb1c();while(!![]){try{const _0x2d39d9=parseInt(_0x259748(0x1ce))/0x1*(-parseInt(_0x259748(0x15e))/0x2)+-parseInt(_0x259748(0x14d))/0x3+parseInt(_0x259748(0x15f))/0x4*(parseInt(_0x259748(0x156))/0x5)+parseInt(_0x259748(0x176))/0x6+-parseInt(_0x259748(0x1cb))/0x7+parseInt(_0x259748(0x15a))/0x8*(parseInt(_0x259748(0x152))/0x9)+parseInt(_0x259748(0x164))/0xa*(parseInt(_0x259748(0x1b7))/0xb);if(_0x2d39d9===_0x59ea72)break;else _0x5ce99f['push'](_0x5ce99f['shift']());}catch(_0x4f4096){_0x5ce99f['push'](_0x5ce99f['shift']());}}}(a0_0x45dd,0x2dc69));const tg=window[a0_0xd7e514(0x16e)]?.[a0_0xd7e514(0x1ad)],HOME_URL=a0_0xd7e514(0x1a0);function setupTelegramBackButton(){const _0x33a145=a0_0xd7e514,_0x289f38=(function(){let _0x4c5808=!![];return function(_0x5e6683,_0x48b616){const _0x394279=_0x4c5808?function(){if(_0x48b616){const _0xb51cef=_0x48b616['apply'](_0x5e6683,arguments);return _0x48b616=null,_0xb51cef;}}:function(){};return _0x4c5808=![],_0x394279;};}()),_0x27cbdc=_0x289f38(this,function(){const _0x5b3118=a0_0x1526;return _0x27cbdc[_0x5b3118(0x179)]()[_0x5b3118(0x172)](_0x5b3118(0x17b))[_0x5b3118(0x179)]()[_0x5b3118(0x184)](_0x27cbdc)[_0x5b3118(0x172)]('(((.+)+)+)+$');});_0x27cbdc();if(!tg)return;try{tg[_0x33a145(0x160)](),tg[_0x33a145(0x169)](),tg[_0x33a145(0x180)]?.(_0x33a145(0x16b));if(tg[_0x33a145(0x166)]?.(_0x33a145(0x189)))tg['disableVerticalSwipes']?.();const _0x5ec1d2=tg[_0x33a145(0x1bb)];if(_0x5ec1d2){_0x5ec1d2[_0x33a145(0x1c5)]();if(typeof _0x5ec1d2[_0x33a145(0x163)]===_0x33a145(0x161))try{_0x5ec1d2[_0x33a145(0x163)]();}catch(_0x5bd9c3){}_0x5ec1d2['onClick'](()=>{const _0x46d1c2=_0x33a145;if(tg['HapticFeedback'])tg[_0x46d1c2(0x1c2)][_0x46d1c2(0x1a4)](_0x46d1c2(0x1be));location[_0x46d1c2(0x150)]=HOME_URL;});}}catch(_0xf00f9d){console[_0x33a145(0x1b5)](_0x33a145(0x14c),_0xf00f9d);}}(function initStableLayout(){const _0x67e23a=a0_0xd7e514,_0x364392=document[_0x67e23a(0x18c)](_0x67e23a(0x14f)),_0x113232=document[_0x67e23a(0x1d0)](_0x67e23a(0x194)),_0x25ec4c=document[_0x67e23a(0x1d0)](_0x67e23a(0x17f)),_0x3f4f40=document[_0x67e23a(0x1d0)](_0x67e23a(0x1c1));function _0x166e25(){const _0x159965=_0x67e23a;if(!_0x364392)return;const _0x4bd736=tg&&tg[_0x159965(0x19c)]?tg['viewportHeight']:window['innerHeight'];_0x364392[_0x159965(0x17e)][_0x159965(0x19a)]=_0x4bd736+'px';if(_0x113232){const _0x172b34=_0x113232['offsetHeight'];_0x25ec4c[_0x159965(0x17e)][_0x159965(0x1c8)]=_0x172b34+0x28+'px';}}tg?tg[_0x67e23a(0x158)](_0x67e23a(0x187),({isStateStable:_0x476dd1})=>{_0x166e25();if(_0x476dd1)requestAnimationFrame(()=>{const _0x5cd643=a0_0x1526;_0x25ec4c[_0x5cd643(0x1a8)]=_0x25ec4c[_0x5cd643(0x182)];});}):window[_0x67e23a(0x15c)](_0x67e23a(0x170),_0x166e25),_0x166e25(),_0x3f4f40&&(_0x3f4f40['addEventListener'](_0x67e23a(0x168),()=>{requestAnimationFrame(_0x166e25);}),_0x3f4f40['addEventListener'](_0x67e23a(0x1ac),()=>{setTimeout(()=>{_0x25ec4c['scrollTop']=_0x25ec4c['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xd7e514(0x14e),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0xd7e514(0x17f)),emptyState=document['getElementById'](a0_0xd7e514(0x18b)),messageInput=document['getElementById'](a0_0xd7e514(0x1c1)),sendBtn=document[a0_0xd7e514(0x1d0)]('sendBtn'),clearBtn=document[a0_0xd7e514(0x1d0)](a0_0xd7e514(0x19f)),modal=document[a0_0xd7e514(0x1d0)](a0_0xd7e514(0x190)),mTitle=document[a0_0xd7e514(0x1d0)](a0_0xd7e514(0x175)),mText=document[a0_0xd7e514(0x1d0)](a0_0xd7e514(0x18f));let modalCallback=null;async function callBackend(_0x2aadac,_0x55c7cd){const _0x14f427=a0_0xd7e514,_0x2cbb4e=tg?.[_0x14f427(0x1b2)]?.['user']||{},_0x55d48a=_0x2cbb4e['id']||localStorage['getItem']('debug_uid')||'d-'+Math['floor'](Math[_0x14f427(0x17c)]()*0x3b9aca00);if(!_0x2cbb4e['id'])localStorage[_0x14f427(0x1cf)](_0x14f427(0x16d),_0x55d48a);const _0x2552d3={'action':_0x2aadac,'user_id':_0x55d48a,'user_data':{'first_name':_0x2cbb4e[_0x14f427(0x174)],'username':_0x2cbb4e[_0x14f427(0x186)]},'init_data':tg?.[_0x14f427(0x1bd)]||'',..._0x55c7cd},_0x45c30d=new AbortController(),_0x2b0751=setTimeout(()=>_0x45c30d[_0x14f427(0x1af)](),REQUEST_TIMEOUT_MS);try{const _0x3add83=await fetch(BACKEND_URL,{'method':_0x14f427(0x197),'headers':{'Content-Type':_0x14f427(0x185)},'body':JSON['stringify'](_0x2552d3),'signal':_0x45c30d[_0x14f427(0x1b0)]});return clearTimeout(_0x2b0751),await _0x3add83[_0x14f427(0x1a9)]();}catch(_0x3660ac){return{'success':![],'error':String(_0x3660ac)};}}function formatTime(_0x53a4f1){const _0x12d977=a0_0xd7e514,_0xeeacf0=new Date(_0x53a4f1);return String(_0xeeacf0[_0x12d977(0x1b1)]())[_0x12d977(0x178)](0x2,'0')+':'+String(_0xeeacf0[_0x12d977(0x1b8)]())[_0x12d977(0x178)](0x2,'0');}function createMessageElement(_0x4fb2fb,_0x412813){const _0x8a363=a0_0xd7e514,_0x56b928=document[_0x8a363(0x153)](_0x8a363(0x15d));_0x56b928[_0x8a363(0x1a3)]=_0x8a363(0x1a7)+_0x4fb2fb[_0x8a363(0x1d1)];const _0x3aa992=document[_0x8a363(0x153)](_0x8a363(0x15d));_0x3aa992[_0x8a363(0x1a3)]=_0x8a363(0x1a6),_0x3aa992[_0x8a363(0x173)]=_0x4fb2fb[_0x8a363(0x1a1)][_0x8a363(0x188)](/\n/g,_0x8a363(0x151));const _0x2349c9=document[_0x8a363(0x153)](_0x8a363(0x15d));_0x2349c9[_0x8a363(0x1a3)]=_0x8a363(0x157),_0x2349c9[_0x8a363(0x173)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x2349c9[_0x8a363(0x167)]=_0x620e7e=>{const _0x544dff=_0x8a363;_0x620e7e[_0x544dff(0x1aa)](),confirmDelete(_0x412813);};let _0x1af9eb;_0x3aa992[_0x8a363(0x15c)](_0x8a363(0x19b),()=>_0x1af9eb=setTimeout(()=>{const _0x2d2799=_0x8a363;_0x56b928[_0x2d2799(0x1a5)][_0x2d2799(0x1cd)](_0x2d2799(0x15b));if(tg?.[_0x2d2799(0x1c2)])tg[_0x2d2799(0x1c2)][_0x2d2799(0x1a4)](_0x2d2799(0x16f));},0x1f4)),_0x3aa992['addEventListener'](_0x8a363(0x1b4),()=>clearTimeout(_0x1af9eb));const _0x589209=document[_0x8a363(0x153)]('div');return _0x589209['className']=_0x8a363(0x1cc),_0x589209[_0x8a363(0x16a)]=formatTime(_0x4fb2fb[_0x8a363(0x1d2)]),_0x56b928[_0x8a363(0x1c9)](_0x2349c9),_0x56b928[_0x8a363(0x1c9)](_0x3aa992),_0x56b928[_0x8a363(0x1c9)](_0x589209),_0x56b928;}function createTypingIndicator(){const _0x209c06=a0_0xd7e514,_0x25083e=document[_0x209c06(0x153)](_0x209c06(0x15d));return _0x25083e['className']='message\x20ai',_0x25083e['id']=_0x209c06(0x18e),_0x25083e['innerHTML']=_0x209c06(0x16c),_0x25083e;}function renderMessages(){const _0x1ddfd9=a0_0xd7e514;Array['from'](chatArea[_0x1ddfd9(0x162)])['forEach'](_0x59c960=>{const _0x265135=_0x1ddfd9;if(_0x59c960['id']!==_0x265135(0x18b))_0x59c960[_0x265135(0x1c4)]();}),messages[_0x1ddfd9(0x1b9)]>0x0?(emptyState['style'][_0x1ddfd9(0x199)]='none',messages[_0x1ddfd9(0x195)]((_0x2dbfc5,_0x1ef97b)=>chatArea[_0x1ddfd9(0x1c9)](createMessageElement(_0x2dbfc5,_0x1ef97b)))):emptyState['style'][_0x1ddfd9(0x199)]=_0x1ddfd9(0x1a2),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x4bba48=a0_0xd7e514;messageInput[_0x4bba48(0x17e)]['height']=_0x4bba48(0x18d),messageInput[_0x4bba48(0x17e)]['height']=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x3a3488=a0_0xd7e514,_0x46ef5e=messageInput[_0x3a3488(0x19d)][_0x3a3488(0x193)]();sendBtn[_0x3a3488(0x181)]=!_0x46ef5e||isTyping;}function a0_0x1526(_0x49f8d6,_0x52ace3){_0x49f8d6=_0x49f8d6-0x14c;const _0x4ecd99=a0_0x45dd();let _0x101c0e=_0x4ecd99[_0x49f8d6];return _0x101c0e;}async function sendMessage(){const _0x30af45=a0_0xd7e514,_0x7cc760=messageInput[_0x30af45(0x19d)][_0x30af45(0x193)]();if(!_0x7cc760||isTyping)return;if(tg?.[_0x30af45(0x1c2)])tg[_0x30af45(0x1c2)][_0x30af45(0x1a4)](_0x30af45(0x1be));messages[_0x30af45(0x1b6)]({'role':_0x30af45(0x198),'content':_0x7cc760,'timestamp':Date[_0x30af45(0x1ae)]()}),localStorage[_0x30af45(0x1cf)](_0x30af45(0x18a),JSON[_0x30af45(0x159)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x30af45(0x1c9)](createTypingIndicator()),chatArea[_0x30af45(0x1a8)]=chatArea[_0x30af45(0x182)];const _0x2586c4=await callBackend(_0x30af45(0x171),{'message':_0x7cc760});isTyping=![];const _0x4e5878=document[_0x30af45(0x1d0)](_0x30af45(0x18e));if(_0x4e5878)_0x4e5878['remove']();let _0xe9e2c6=_0x30af45(0x183);if(_0x2586c4['success']){_0xe9e2c6=_0x2586c4['text']||'Пустой\x20ответ';if(tg?.[_0x30af45(0x1c2)])tg['HapticFeedback'][_0x30af45(0x1ba)](_0x30af45(0x1ca));}else{_0xe9e2c6=_0x2586c4[_0x30af45(0x154)]||_0x30af45(0x17a);if(tg?.[_0x30af45(0x1c2)])tg[_0x30af45(0x1c2)][_0x30af45(0x1ba)](_0x30af45(0x154));}messages[_0x30af45(0x1b6)]({'role':'ai','content':_0xe9e2c6,'timestamp':Date[_0x30af45(0x1ae)]()}),localStorage['setItem'](_0x30af45(0x18a),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x348274){const _0x267ecf=a0_0xd7e514;if(mTitle)mTitle['textContent']=_0x267ecf(0x1c3);if(mText)mText[_0x267ecf(0x16a)]='Действие\x20необратимо.';modalCallback=()=>{const _0xf526dc=_0x267ecf;messages[_0xf526dc(0x155)](_0x348274,0x1),localStorage[_0xf526dc(0x1cf)]('ai_chat_messages',JSON[_0xf526dc(0x159)](messages)),renderMessages();},modal['classList']['add'](_0x267ecf(0x1c5));}if(clearBtn)clearBtn[a0_0xd7e514(0x167)]=()=>{const _0x704253=a0_0xd7e514;if(!messages['length'])return;if(mTitle)mTitle[_0x704253(0x16a)]=_0x704253(0x1bc);if(mText)mText[_0x704253(0x16a)]=_0x704253(0x1ab);modalCallback=async()=>{const _0x397ef1=_0x704253;messages=[],localStorage[_0x397ef1(0x1c7)](_0x397ef1(0x18a)),renderMessages(),callBackend(_0x397ef1(0x1c0),{});},modal['classList'][_0x704253(0x1cd)](_0x704253(0x1c5));};document[a0_0xd7e514(0x1d0)]('modalCancel')[a0_0xd7e514(0x167)]=()=>modal[a0_0xd7e514(0x1a5)][a0_0xd7e514(0x1c4)]('show'),document['getElementById'](a0_0xd7e514(0x177))[a0_0xd7e514(0x167)]=()=>{const _0x4a67a0=a0_0xd7e514;if(modalCallback)modalCallback();modal[_0x4a67a0(0x1a5)][_0x4a67a0(0x1c4)]('show');},messageInput[a0_0xd7e514(0x15c)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xd7e514(0x15c)](a0_0xd7e514(0x191),_0x3ee427=>{const _0x206af0=a0_0xd7e514;_0x3ee427[_0x206af0(0x1bf)]==='Enter'&&!_0x3ee427[_0x206af0(0x1b3)]&&(_0x3ee427['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0xd7e514(0x15c)](a0_0xd7e514(0x192),_0x459ab6=>{const _0x50d449=a0_0xd7e514;document['querySelectorAll'](_0x50d449(0x1c6))['forEach'](_0x594540=>{const _0xb4b9e8=_0x50d449;if(!_0x594540[_0xb4b9e8(0x17d)](_0x459ab6[_0xb4b9e8(0x165)]))_0x594540['classList'][_0xb4b9e8(0x1c4)](_0xb4b9e8(0x15b));});});const saved=localStorage[a0_0xd7e514(0x196)](a0_0xd7e514(0x18a));if(saved)try{messages=JSON[a0_0xd7e514(0x19e)](saved),renderMessages();}catch(a0_0x3f5fe6){}updateSendButton();function a0_0x45dd(){const _0x129f2b=['modalConfirm','padStart','toString','Ошибка\x20сервера','(((.+)+)+)+$','random','contains','style','chatArea','setHeaderColor','disabled','scrollHeight','Ошибка\x20сети','constructor','text/plain','username','viewportChanged','replace','6.1','ai_chat_messages','emptyState','querySelector','auto','typingIndicator','modalText','confirmModal','keydown','click','trim','inputArea','forEach','getItem','POST','user','display','height','touchstart','viewportHeight','value','parse','clearBtn','./router.html','content','flex','className','impactOccurred','classList','message-bubble','message\x20','scrollTop','json','stopPropagation','Начнется\x20новый\x20диалог.','focus','WebApp','now','abort','signal','getHours','initDataUnsafe','shiftKey','touchend','warn','push','76472xadHvM','getMinutes','length','notificationOccurred','BackButton','Очистить\x20историю?','initData','light','key','clear_history','messageInput','HapticFeedback','Удалить?','remove','show','.message.show-delete','removeItem','paddingBottom','appendChild','success','410550ezlqGk','message-time','add','35XrLPnJ','setItem','getElementById','role','timestamp','TG\x20setup\x20error:','1021836rELdhU','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','.container','href','<br>','27OEyOhu','createElement','error','splice','236330xHLuwv','delete-btn','onEvent','stringify','229832EjyGOm','show-delete','addEventListener','div','16098itiFlT','24HFhXFq','ready','function','children','offClick','550MvfbSi','target','isVersionAtLeast','onclick','input','expand','textContent','#050505','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','debug_uid','Telegram','medium','resize','send_message','search','innerHTML','first_name','modalTitle','697986wCxgAQ'];a0_0x45dd=function(){return _0x129f2b;};return a0_0x45dd();}