const a0_0x2295ae=a0_0x1648;(function(_0x3eed0d,_0x2ac6fd){const _0x3dc85a=a0_0x1648,_0x366ae9=_0x3eed0d();while(!![]){try{const _0x10d0a=-parseInt(_0x3dc85a(0x1e1))/0x1+-parseInt(_0x3dc85a(0x228))/0x2*(-parseInt(_0x3dc85a(0x20c))/0x3)+parseInt(_0x3dc85a(0x20f))/0x4+-parseInt(_0x3dc85a(0x1d0))/0x5+parseInt(_0x3dc85a(0x1c7))/0x6+parseInt(_0x3dc85a(0x226))/0x7*(-parseInt(_0x3dc85a(0x1eb))/0x8)+parseInt(_0x3dc85a(0x1bc))/0x9;if(_0x10d0a===_0x2ac6fd)break;else _0x366ae9['push'](_0x366ae9['shift']());}catch(_0x5965b9){_0x366ae9['push'](_0x366ae9['shift']());}}}(a0_0x5a09,0x1bf18));const tg=window[a0_0x2295ae(0x215)]?.[a0_0x2295ae(0x1b1)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0xd6c7f9=a0_0x2295ae;if(!tg)return;try{tg[_0xd6c7f9(0x1da)](),tg[_0xd6c7f9(0x1b2)](),tg['setHeaderColor']?.('#050505');if(tg[_0xd6c7f9(0x1e9)]?.(_0xd6c7f9(0x1c1)))tg[_0xd6c7f9(0x1e0)]?.();const _0x558c94=tg[_0xd6c7f9(0x22e)];if(_0x558c94){_0x558c94['show']();if(typeof _0x558c94[_0xd6c7f9(0x1d5)]===_0xd6c7f9(0x1fa))try{_0x558c94[_0xd6c7f9(0x1d5)]();}catch(_0x234248){}_0x558c94[_0xd6c7f9(0x22d)](()=>{const _0x1f6da3=_0xd6c7f9;if(tg[_0x1f6da3(0x1fb)])tg[_0x1f6da3(0x1fb)][_0x1f6da3(0x218)]('light');location[_0x1f6da3(0x1ab)]=HOME_URL;});}}catch(_0x3b22d9){console[_0xd6c7f9(0x200)](_0xd6c7f9(0x1c8),_0x3b22d9);}}(function initStableLayout(){const _0x4b9c6d=a0_0x2295ae,_0x2f2d0a=(function(){let _0x581762=!![];return function(_0x211acf,_0x1c0473){const _0x254fc1=_0x581762?function(){const _0x38a49e=a0_0x1648;if(_0x1c0473){const _0x10bcad=_0x1c0473[_0x38a49e(0x1c2)](_0x211acf,arguments);return _0x1c0473=null,_0x10bcad;}}:function(){};return _0x581762=![],_0x254fc1;};}()),_0x347c0e=document[_0x4b9c6d(0x20b)](_0x4b9c6d(0x211)),_0x4c18a4=document[_0x4b9c6d(0x1e8)](_0x4b9c6d(0x1e2)),_0x4b6bc1=document[_0x4b9c6d(0x1e8)]('chatArea'),_0x259d45=document[_0x4b9c6d(0x1e8)](_0x4b9c6d(0x1ec));function _0x49f8d8(){const _0x1f8077=_0x4b9c6d,_0x5b30e5=_0x2f2d0a(this,function(){const _0x4c582c=a0_0x1648;return _0x5b30e5[_0x4c582c(0x1ee)]()[_0x4c582c(0x1bf)]('(((.+)+)+)+$')[_0x4c582c(0x1ee)]()[_0x4c582c(0x227)](_0x5b30e5)[_0x4c582c(0x1bf)](_0x4c582c(0x1d4));});_0x5b30e5();if(!_0x347c0e)return;const _0x58bfc8=tg&&tg[_0x1f8077(0x1dc)]?tg[_0x1f8077(0x1dc)]:window['innerHeight'];_0x347c0e['style'][_0x1f8077(0x1c6)]=_0x58bfc8+'px';if(_0x4c18a4){const _0x354dc2=_0x4c18a4[_0x1f8077(0x1b3)];_0x4b6bc1[_0x1f8077(0x1c5)]['paddingBottom']=_0x354dc2+0x28+'px';}}tg?tg[_0x4b9c6d(0x22b)](_0x4b9c6d(0x1ed),({isStateStable:_0x403911})=>{_0x49f8d8();if(_0x403911)requestAnimationFrame(()=>{const _0x5adc56=a0_0x1648;_0x4b6bc1['scrollTop']=_0x4b6bc1[_0x5adc56(0x21b)];});}):window['addEventListener'](_0x4b9c6d(0x1db),_0x49f8d8),_0x49f8d8(),_0x259d45&&(_0x259d45[_0x4b9c6d(0x1d9)]('input',()=>{requestAnimationFrame(_0x49f8d8);}),_0x259d45[_0x4b9c6d(0x1d9)]('focus',()=>{setTimeout(()=>{const _0x405e32=a0_0x1648;_0x4b6bc1[_0x405e32(0x1aa)]=_0x4b6bc1[_0x405e32(0x21b)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2295ae(0x1f1),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2295ae(0x1e8)](a0_0x2295ae(0x1bb)),emptyState=document[a0_0x2295ae(0x1e8)](a0_0x2295ae(0x1cc)),messageInput=document[a0_0x2295ae(0x1e8)](a0_0x2295ae(0x1ec)),sendBtn=document[a0_0x2295ae(0x1e8)](a0_0x2295ae(0x1cf)),clearBtn=document['getElementById'](a0_0x2295ae(0x1ce)),modal=document[a0_0x2295ae(0x1e8)](a0_0x2295ae(0x201)),mTitle=document[a0_0x2295ae(0x1e8)](a0_0x2295ae(0x1ad)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x46cb98,_0x24630c){const _0x19dbd3=a0_0x2295ae,_0x221d10=tg?.[_0x19dbd3(0x221)]?.['user']||{},_0x53c66a=_0x221d10['id']||localStorage[_0x19dbd3(0x1b6)](_0x19dbd3(0x22c))||'d-'+Math['floor'](Math[_0x19dbd3(0x219)]()*0x3b9aca00);if(!_0x221d10['id'])localStorage[_0x19dbd3(0x1c0)](_0x19dbd3(0x22c),_0x53c66a);const _0x205911={'action':_0x46cb98,'user_id':_0x53c66a,'user_data':{'first_name':_0x221d10[_0x19dbd3(0x21e)],'username':_0x221d10[_0x19dbd3(0x1ea)]},'init_data':tg?.[_0x19dbd3(0x204)]||'',..._0x24630c},_0x1349cb=new AbortController(),_0x37ef51=setTimeout(()=>_0x1349cb['abort'](),REQUEST_TIMEOUT_MS);try{const _0x58c0a7=await fetch(BACKEND_URL,{'method':_0x19dbd3(0x1de),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x19dbd3(0x1b0)](_0x205911),'signal':_0x1349cb[_0x19dbd3(0x224)]});return clearTimeout(_0x37ef51),await _0x58c0a7[_0x19dbd3(0x207)]();}catch(_0xf3c97c){return{'success':![],'error':String(_0xf3c97c)};}}function formatTime(_0x537b89){const _0x5e39e5=a0_0x2295ae,_0x20a969=new Date(_0x537b89);return String(_0x20a969[_0x5e39e5(0x203)]())[_0x5e39e5(0x1d3)](0x2,'0')+':'+String(_0x20a969[_0x5e39e5(0x1be)]())['padStart'](0x2,'0');}function createMessageElement(_0x4346a0,_0x46f54b){const _0x20876d=a0_0x2295ae,_0x4b3bc3=document[_0x20876d(0x1d2)]('div');_0x4b3bc3[_0x20876d(0x210)]=_0x20876d(0x1ff)+_0x4346a0['role'];const _0x2742a4=document['createElement'](_0x20876d(0x1dd));_0x2742a4[_0x20876d(0x210)]=_0x20876d(0x1f6),_0x2742a4['innerHTML']=_0x4346a0[_0x20876d(0x1cd)][_0x20876d(0x209)](/\n/g,_0x20876d(0x20a));const _0x2e6de4=document[_0x20876d(0x1d2)]('div');_0x2e6de4[_0x20876d(0x210)]=_0x20876d(0x225),_0x2e6de4[_0x20876d(0x208)]=_0x20876d(0x1b4),_0x2e6de4[_0x20876d(0x20d)]=_0x2e2a30=>{const _0xa906e3=_0x20876d;_0x2e2a30[_0xa906e3(0x217)](),confirmDelete(_0x46f54b);};let _0x168c51;_0x2742a4[_0x20876d(0x1d9)](_0x20876d(0x222),()=>_0x168c51=setTimeout(()=>{const _0xb984a=_0x20876d;_0x4b3bc3[_0xb984a(0x1f9)][_0xb984a(0x212)]('show-delete');if(tg?.[_0xb984a(0x1fb)])tg[_0xb984a(0x1fb)][_0xb984a(0x218)]('medium');},0x1f4)),_0x2742a4[_0x20876d(0x1d9)](_0x20876d(0x1d1),()=>clearTimeout(_0x168c51));const _0x1b5e26=document[_0x20876d(0x1d2)](_0x20876d(0x1dd));return _0x1b5e26[_0x20876d(0x210)]=_0x20876d(0x1df),_0x1b5e26[_0x20876d(0x1cb)]=formatTime(_0x4346a0[_0x20876d(0x1ef)]),_0x4b3bc3[_0x20876d(0x1fd)](_0x2e6de4),_0x4b3bc3[_0x20876d(0x1fd)](_0x2742a4),_0x4b3bc3[_0x20876d(0x1fd)](_0x1b5e26),_0x4b3bc3;}function createTypingIndicator(){const _0x309faf=a0_0x2295ae,_0x5dbb2e=document[_0x309faf(0x1d2)]('div');return _0x5dbb2e[_0x309faf(0x210)]=_0x309faf(0x1f0),_0x5dbb2e['id']=_0x309faf(0x1ba),_0x5dbb2e[_0x309faf(0x208)]=_0x309faf(0x1af),_0x5dbb2e;}function renderMessages(){const _0x182a6b=a0_0x2295ae;Array[_0x182a6b(0x1ca)](chatArea[_0x182a6b(0x1fc)])[_0x182a6b(0x205)](_0x2d6f36=>{const _0x20f98e=_0x182a6b;if(_0x2d6f36['id']!==_0x20f98e(0x1cc))_0x2d6f36[_0x20f98e(0x1f4)]();}),messages['length']>0x0?(emptyState['style'][_0x182a6b(0x1e6)]=_0x182a6b(0x21c),messages[_0x182a6b(0x205)]((_0x3d2c7a,_0x18225f)=>chatArea['appendChild'](createMessageElement(_0x3d2c7a,_0x18225f)))):emptyState[_0x182a6b(0x1c5)][_0x182a6b(0x1e6)]=_0x182a6b(0x202),requestAnimationFrame(()=>chatArea[_0x182a6b(0x1aa)]=chatArea[_0x182a6b(0x21b)]);}function autoResizeTextarea(){const _0x3a41af=a0_0x2295ae;messageInput['style'][_0x3a41af(0x1c6)]=_0x3a41af(0x20e),messageInput[_0x3a41af(0x1c5)][_0x3a41af(0x1c6)]=Math[_0x3a41af(0x1f7)](messageInput[_0x3a41af(0x21b)],0x78)+'px';}function updateSendButton(){const _0x6bf926=a0_0x2295ae,_0x3fa6d8=messageInput[_0x6bf926(0x1fe)][_0x6bf926(0x206)]();sendBtn[_0x6bf926(0x1c9)]=!_0x3fa6d8||isTyping;}async function sendMessage(){const _0x2025f7=a0_0x2295ae,_0x43959a=messageInput['value'][_0x2025f7(0x206)]();if(!_0x43959a||isTyping)return;if(tg?.[_0x2025f7(0x1fb)])tg[_0x2025f7(0x1fb)][_0x2025f7(0x218)](_0x2025f7(0x216));messages[_0x2025f7(0x1e4)]({'role':_0x2025f7(0x1b7),'content':_0x43959a,'timestamp':Date['now']()}),localStorage[_0x2025f7(0x1c0)](_0x2025f7(0x21a),JSON[_0x2025f7(0x1b0)](messages)),renderMessages(),messageInput[_0x2025f7(0x1fe)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x2025f7(0x1aa)]=chatArea[_0x2025f7(0x21b)];const _0x529970=await callBackend(_0x2025f7(0x229),{'message':_0x43959a});isTyping=![];const _0x3ab93a=document['getElementById'](_0x2025f7(0x1ba));if(_0x3ab93a)_0x3ab93a['remove']();let _0x21c8a1=_0x2025f7(0x220);if(_0x529970[_0x2025f7(0x1d7)]){_0x21c8a1=_0x529970['text']||_0x2025f7(0x213);if(tg?.[_0x2025f7(0x1fb)])tg[_0x2025f7(0x1fb)]['notificationOccurred'](_0x2025f7(0x1d7));}else{_0x21c8a1=_0x529970['error']||'Ошибка\x20сервера';if(tg?.[_0x2025f7(0x1fb)])tg[_0x2025f7(0x1fb)]['notificationOccurred'](_0x2025f7(0x1ae));}messages[_0x2025f7(0x1e4)]({'role':'ai','content':_0x21c8a1,'timestamp':Date[_0x2025f7(0x1f2)]()}),localStorage[_0x2025f7(0x1c0)]('ai_chat_messages',JSON[_0x2025f7(0x1b0)](messages)),renderMessages();}function confirmDelete(_0x3175ce){const _0x37a271=a0_0x2295ae;if(mTitle)mTitle[_0x37a271(0x1cb)]=_0x37a271(0x214);if(mText)mText[_0x37a271(0x1cb)]=_0x37a271(0x1c3);modalCallback=()=>{const _0x5c8d14=_0x37a271;messages['splice'](_0x3175ce,0x1),localStorage[_0x5c8d14(0x1c0)](_0x5c8d14(0x21a),JSON[_0x5c8d14(0x1b0)](messages)),renderMessages();},modal[_0x37a271(0x1f9)][_0x37a271(0x212)](_0x37a271(0x1e5));}function a0_0x1648(_0x37c469,_0x2b8a34){_0x37c469=_0x37c469-0x1aa;const _0xa20d1d=a0_0x5a09();let _0x217497=_0xa20d1d[_0x37c469];return _0x217497;}if(clearBtn)clearBtn[a0_0x2295ae(0x20d)]=()=>{const _0xdd4904=a0_0x2295ae;if(!messages[_0xdd4904(0x1f3)])return;if(mTitle)mTitle[_0xdd4904(0x1cb)]=_0xdd4904(0x1c4);if(mText)mText['textContent']=_0xdd4904(0x223);modalCallback=async()=>{const _0x4139a0=_0xdd4904;messages=[],localStorage[_0x4139a0(0x22a)]('ai_chat_messages'),renderMessages(),callBackend(_0x4139a0(0x1bd),{});},modal[_0xdd4904(0x1f9)]['add'](_0xdd4904(0x1e5));};function a0_0x5a09(){const _0x57c904=['162219rAFxAK','inputArea','input','push','show','display','Enter','getElementById','isVersionAtLeast','username','4304TEiTWd','messageInput','viewportChanged','toString','timestamp','message\x20ai','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','now','length','remove','key','message-bubble','min','show-delete','classList','function','HapticFeedback','children','appendChild','value','message\x20','warn','confirmModal','flex','getHours','initData','forEach','trim','json','innerHTML','replace','<br>','querySelector','60087BbPNVO','onclick','auto','451340Cbooft','className','.container','add','Пустой\x20ответ','Удалить?','Telegram','light','stopPropagation','impactOccurred','random','ai_chat_messages','scrollHeight','none','querySelectorAll','first_name','modalCancel','Ошибка\x20сети','initDataUnsafe','touchstart','Начнется\x20новый\x20диалог.','signal','delete-btn','1253WNjiQT','constructor','14zUMMYt','send_message','removeItem','onEvent','debug_uid','onClick','BackButton','scrollTop','href','parse','modalTitle','error','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','stringify','WebApp','expand','offsetHeight','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','modalConfirm','getItem','user','.message.show-delete','target','typingIndicator','chatArea','1388637KntCXK','clear_history','getMinutes','search','setItem','6.1','apply','Действие\x20необратимо.','Очистить\x20историю?','style','height','413844mHRTIc','TG\x20setup\x20error:','disabled','from','textContent','emptyState','content','clearBtn','sendBtn','516640xCwtLc','touchend','createElement','padStart','(((.+)+)+)+$','offClick','click','success','keydown','addEventListener','ready','resize','viewportHeight','div','POST','message-time','disableVerticalSwipes'];a0_0x5a09=function(){return _0x57c904;};return a0_0x5a09();}document[a0_0x2295ae(0x1e8)](a0_0x2295ae(0x21f))[a0_0x2295ae(0x20d)]=()=>modal['classList'][a0_0x2295ae(0x1f4)](a0_0x2295ae(0x1e5)),document[a0_0x2295ae(0x1e8)](a0_0x2295ae(0x1b5))[a0_0x2295ae(0x20d)]=()=>{const _0x25383d=a0_0x2295ae;if(modalCallback)modalCallback();modal['classList'][_0x25383d(0x1f4)](_0x25383d(0x1e5));},messageInput[a0_0x2295ae(0x1d9)](a0_0x2295ae(0x1e3),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2295ae(0x1d9)](a0_0x2295ae(0x1d8),_0x39bace=>{const _0x4d8542=a0_0x2295ae;_0x39bace[_0x4d8542(0x1f5)]===_0x4d8542(0x1e7)&&!_0x39bace['shiftKey']&&(_0x39bace['preventDefault'](),sendMessage());}),sendBtn[a0_0x2295ae(0x20d)]=sendMessage,document[a0_0x2295ae(0x1d9)](a0_0x2295ae(0x1d6),_0x26d3f7=>{const _0x5497c1=a0_0x2295ae;document[_0x5497c1(0x21d)](_0x5497c1(0x1b8))[_0x5497c1(0x205)](_0x1fb304=>{const _0x4dbed6=_0x5497c1;if(!_0x1fb304['contains'](_0x26d3f7[_0x4dbed6(0x1b9)]))_0x1fb304[_0x4dbed6(0x1f9)][_0x4dbed6(0x1f4)](_0x4dbed6(0x1f8));});});const saved=localStorage[a0_0x2295ae(0x1b6)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x2295ae(0x1ac)](saved),renderMessages();}catch(a0_0xf94e1){}updateSendButton();