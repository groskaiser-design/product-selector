const a0_0x1e9459=a0_0x56c6;(function(_0x14e54f,_0x91bba9){const _0x386c45=a0_0x56c6,_0x5be3f3=_0x14e54f();while(!![]){try{const _0x515cd8=-parseInt(_0x386c45(0xe3))/0x1+parseInt(_0x386c45(0x9c))/0x2+parseInt(_0x386c45(0xc1))/0x3*(parseInt(_0x386c45(0xca))/0x4)+parseInt(_0x386c45(0xac))/0x5*(parseInt(_0x386c45(0xb9))/0x6)+-parseInt(_0x386c45(0xb4))/0x7+parseInt(_0x386c45(0xe1))/0x8+-parseInt(_0x386c45(0xe4))/0x9;if(_0x515cd8===_0x91bba9)break;else _0x5be3f3['push'](_0x5be3f3['shift']());}catch(_0x5850b7){_0x5be3f3['push'](_0x5be3f3['shift']());}}}(a0_0xf8b8,0x63752));const tg=window['Telegram']?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x3572b1=a0_0x56c6,_0x11ab0d=(function(){let _0x539b98=!![];return function(_0x170f79,_0x12be02){const _0x15f4d7=_0x539b98?function(){const _0x497d51=a0_0x56c6;if(_0x12be02){const _0x2779d9=_0x12be02[_0x497d51(0xe8)](_0x170f79,arguments);return _0x12be02=null,_0x2779d9;}}:function(){};return _0x539b98=![],_0x15f4d7;};}()),_0x60a546=_0x11ab0d(this,function(){const _0x4c6efb=a0_0x56c6;return _0x60a546[_0x4c6efb(0xa6)]()[_0x4c6efb(0xba)](_0x4c6efb(0xc0))[_0x4c6efb(0xa6)]()[_0x4c6efb(0xb2)](_0x60a546)[_0x4c6efb(0xba)](_0x4c6efb(0xc0));});_0x60a546();if(!tg)return;try{tg['ready'](),tg[_0x3572b1(0xce)](),tg[_0x3572b1(0xcc)]?.('#050505');if(tg['isVersionAtLeast']?.(_0x3572b1(0x100)))tg[_0x3572b1(0x106)]?.();const _0x44641e=tg[_0x3572b1(0xb8)];if(_0x44641e){_0x44641e[_0x3572b1(0xdb)]();if(typeof _0x44641e['offClick']===_0x3572b1(0xe7))try{_0x44641e[_0x3572b1(0x102)]();}catch(_0x1927a6){}_0x44641e[_0x3572b1(0xd2)](()=>{const _0x49a819=_0x3572b1;if(tg[_0x49a819(0xd4)])tg[_0x49a819(0xd4)][_0x49a819(0xd7)](_0x49a819(0xa9));location[_0x49a819(0xb6)]=HOME_URL;});}}catch(_0x54d6b2){console[_0x3572b1(0xc5)](_0x3572b1(0x9e),_0x54d6b2);}}(function initStableLayout(){const _0xa0be6=a0_0x56c6,_0xe9e3d9=document[_0xa0be6(0xf5)](_0xa0be6(0xd8)),_0x2dae5f=document['getElementById'](_0xa0be6(0x9f)),_0x4a9a7b=document[_0xa0be6(0xb7)](_0xa0be6(0xfc)),_0x48b01f=document[_0xa0be6(0xb7)]('messageInput');function _0x40b5cd(){const _0x4f0a3a=_0xa0be6;if(!_0xe9e3d9)return;const _0x145dbf=tg&&tg['viewportHeight']?tg[_0x4f0a3a(0xc4)]:window[_0x4f0a3a(0xb5)];_0xe9e3d9[_0x4f0a3a(0xf8)]['height']=_0x145dbf+'px';if(_0x2dae5f){const _0x38e660=_0x2dae5f[_0x4f0a3a(0x10c)];_0x4a9a7b[_0x4f0a3a(0xf8)][_0x4f0a3a(0x9d)]=_0x38e660+0x28+'px';}}tg?tg[_0xa0be6(0x98)]('viewportChanged',({isStateStable:_0x256918})=>{_0x40b5cd();if(_0x256918)requestAnimationFrame(()=>{const _0x4f8981=a0_0x56c6;_0x4a9a7b[_0x4f8981(0xaf)]=_0x4a9a7b[_0x4f8981(0xc3)];});}):window[_0xa0be6(0xf0)](_0xa0be6(0x99),_0x40b5cd),_0x40b5cd(),_0x48b01f&&(_0x48b01f[_0xa0be6(0xf0)]('input',()=>{requestAnimationFrame(_0x40b5cd);}),_0x48b01f['addEventListener'](_0xa0be6(0xff),()=>{setTimeout(()=>{const _0x328da8=a0_0x56c6;_0x4a9a7b['scrollTop']=_0x4a9a7b[_0x328da8(0xc3)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1e9459(0xe9),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1e9459(0xb7)](a0_0x1e9459(0xfc)),emptyState=document[a0_0x1e9459(0xb7)](a0_0x1e9459(0xbd)),messageInput=document[a0_0x1e9459(0xb7)](a0_0x1e9459(0xd3)),sendBtn=document[a0_0x1e9459(0xb7)]('sendBtn'),clearBtn=document[a0_0x1e9459(0xb7)](a0_0x1e9459(0x104)),modal=document[a0_0x1e9459(0xb7)](a0_0x1e9459(0xe2)),mTitle=document[a0_0x1e9459(0xb7)](a0_0x1e9459(0xa8)),mText=document[a0_0x1e9459(0xb7)](a0_0x1e9459(0x101));let modalCallback=null;async function callBackend(_0x5a091f,_0x1bc970){const _0x2a833e=a0_0x1e9459,_0x4bf051=tg?.[_0x2a833e(0x108)]?.[_0x2a833e(0xcf)]||{},_0x303ac5=_0x4bf051['id']||localStorage[_0x2a833e(0xfa)]('debug_uid')||'d-'+Math['floor'](Math[_0x2a833e(0xb3)]()*0x3b9aca00);if(!_0x4bf051['id'])localStorage[_0x2a833e(0xe6)](_0x2a833e(0xa1),_0x303ac5);const _0x4be531={'action':_0x5a091f,'user_id':_0x303ac5,'user_data':{'first_name':_0x4bf051[_0x2a833e(0xde)],'username':_0x4bf051[_0x2a833e(0xf3)]},'init_data':tg?.[_0x2a833e(0xae)]||'',..._0x1bc970},_0x33f14b=new AbortController(),_0x23242c=setTimeout(()=>_0x33f14b['abort'](),REQUEST_TIMEOUT_MS);try{const _0x37b3c9=await fetch(BACKEND_URL,{'method':_0x2a833e(0xec),'headers':{'Content-Type':_0x2a833e(0xd1)},'body':JSON['stringify'](_0x4be531),'signal':_0x33f14b['signal']});return clearTimeout(_0x23242c),await _0x37b3c9['json']();}catch(_0x2cb9ad){return{'success':![],'error':String(_0x2cb9ad)};}}function formatTime(_0x9c94bb){const _0x7585a3=a0_0x1e9459,_0x352565=new Date(_0x9c94bb);return String(_0x352565['getHours']())[_0x7585a3(0xd0)](0x2,'0')+':'+String(_0x352565['getMinutes']())[_0x7585a3(0xd0)](0x2,'0');}function createMessageElement(_0x1ad0c1,_0x5bd71b){const _0x29dd4a=a0_0x1e9459,_0xfa423e=document[_0x29dd4a(0xa5)]('div');_0xfa423e[_0x29dd4a(0xe5)]=_0x29dd4a(0xc2)+_0x1ad0c1[_0x29dd4a(0xf1)];const _0x4d7d8b=document[_0x29dd4a(0xa5)](_0x29dd4a(0xbf));_0x4d7d8b[_0x29dd4a(0xe5)]='message-bubble',_0x4d7d8b[_0x29dd4a(0xe0)]=_0x1ad0c1[_0x29dd4a(0xf2)][_0x29dd4a(0x10b)](/\n/g,_0x29dd4a(0xea));const _0x184e61=document[_0x29dd4a(0xa5)](_0x29dd4a(0xbf));_0x184e61[_0x29dd4a(0xe5)]=_0x29dd4a(0xad),_0x184e61[_0x29dd4a(0xe0)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x184e61[_0x29dd4a(0xbc)]=_0x20a10f=>{_0x20a10f['stopPropagation'](),confirmDelete(_0x5bd71b);};let _0x447e45;_0x4d7d8b['addEventListener'](_0x29dd4a(0xfe),()=>_0x447e45=setTimeout(()=>{const _0x199c36=_0x29dd4a;_0xfa423e[_0x199c36(0xda)][_0x199c36(0xbb)](_0x199c36(0xb1));if(tg?.[_0x199c36(0xd4)])tg[_0x199c36(0xd4)][_0x199c36(0xd7)](_0x199c36(0xc6));},0x1f4)),_0x4d7d8b[_0x29dd4a(0xf0)]('touchend',()=>clearTimeout(_0x447e45));const _0x3dada9=document[_0x29dd4a(0xa5)](_0x29dd4a(0xbf));return _0x3dada9['className']='message-time',_0x3dada9[_0x29dd4a(0x103)]=formatTime(_0x1ad0c1['timestamp']),_0xfa423e['appendChild'](_0x184e61),_0xfa423e['appendChild'](_0x4d7d8b),_0xfa423e[_0x29dd4a(0xdf)](_0x3dada9),_0xfa423e;}function createTypingIndicator(){const _0x13e994=a0_0x1e9459,_0x5132d9=document[_0x13e994(0xa5)]('div');return _0x5132d9[_0x13e994(0xe5)]='message\x20ai',_0x5132d9['id']=_0x13e994(0xdc),_0x5132d9[_0x13e994(0xe0)]=_0x13e994(0xab),_0x5132d9;}function renderMessages(){const _0x586d3f=a0_0x1e9459;Array['from'](chatArea['children'])['forEach'](_0x4be566=>{const _0x1f797e=a0_0x56c6;if(_0x4be566['id']!==_0x1f797e(0xbd))_0x4be566[_0x1f797e(0xa3)]();}),messages[_0x586d3f(0xa2)]>0x0?(emptyState['style'][_0x586d3f(0xa0)]='none',messages[_0x586d3f(0xfd)]((_0xb0f1ee,_0x452ca5)=>chatArea[_0x586d3f(0xdf)](createMessageElement(_0xb0f1ee,_0x452ca5)))):emptyState[_0x586d3f(0xf8)][_0x586d3f(0xa0)]=_0x586d3f(0x105),requestAnimationFrame(()=>chatArea[_0x586d3f(0xaf)]=chatArea[_0x586d3f(0xc3)]);}function autoResizeTextarea(){const _0x3fd652=a0_0x1e9459;messageInput[_0x3fd652(0xf8)][_0x3fd652(0x107)]=_0x3fd652(0xc7),messageInput[_0x3fd652(0xf8)]['height']=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x4691b9=a0_0x1e9459,_0x164bfa=messageInput['value'][_0x4691b9(0xeb)]();sendBtn[_0x4691b9(0xdd)]=!_0x164bfa||isTyping;}async function sendMessage(){const _0x4d8cc1=a0_0x1e9459,_0x1d72d2=messageInput[_0x4d8cc1(0xd9)][_0x4d8cc1(0xeb)]();if(!_0x1d72d2||isTyping)return;if(tg?.[_0x4d8cc1(0xd4)])tg[_0x4d8cc1(0xd4)]['impactOccurred'](_0x4d8cc1(0xa9));messages[_0x4d8cc1(0x9b)]({'role':_0x4d8cc1(0xcf),'content':_0x1d72d2,'timestamp':Date['now']()}),localStorage[_0x4d8cc1(0xe6)]('ai_chat_messages',JSON[_0x4d8cc1(0xf4)](messages)),renderMessages(),messageInput[_0x4d8cc1(0xd9)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4d8cc1(0xdf)](createTypingIndicator()),chatArea[_0x4d8cc1(0xaf)]=chatArea[_0x4d8cc1(0xc3)];const _0x55b459=await callBackend('send_message',{'message':_0x1d72d2});isTyping=![];const _0x41b489=document[_0x4d8cc1(0xb7)]('typingIndicator');if(_0x41b489)_0x41b489['remove']();let _0x43847f='Ошибка\x20сети';if(_0x55b459[_0x4d8cc1(0xd6)]){_0x43847f=_0x55b459['text']||_0x4d8cc1(0x109);if(tg?.[_0x4d8cc1(0xd4)])tg['HapticFeedback'][_0x4d8cc1(0xf6)]('success');}else{_0x43847f=_0x55b459[_0x4d8cc1(0xc9)]||_0x4d8cc1(0xcb);if(tg?.[_0x4d8cc1(0xd4)])tg['HapticFeedback'][_0x4d8cc1(0xf6)]('error');}messages[_0x4d8cc1(0x9b)]({'role':'ai','content':_0x43847f,'timestamp':Date['now']()}),localStorage[_0x4d8cc1(0xe6)](_0x4d8cc1(0xaa),JSON[_0x4d8cc1(0xf4)](messages)),renderMessages();}function confirmDelete(_0x308b00){const _0x233953=a0_0x1e9459;if(mTitle)mTitle[_0x233953(0x103)]='Удалить?';if(mText)mText['textContent']=_0x233953(0xa7);modalCallback=()=>{const _0x1e429f=_0x233953;messages['splice'](_0x308b00,0x1),localStorage[_0x1e429f(0xe6)](_0x1e429f(0xaa),JSON[_0x1e429f(0xf4)](messages)),renderMessages();},modal[_0x233953(0xda)]['add'](_0x233953(0xdb));}if(clearBtn)clearBtn[a0_0x1e9459(0xbc)]=()=>{const _0x12cb7d=a0_0x1e9459;if(!messages[_0x12cb7d(0xa2)])return;if(mTitle)mTitle[_0x12cb7d(0x103)]=_0x12cb7d(0xd5);if(mText)mText[_0x12cb7d(0x103)]=_0x12cb7d(0xf7);modalCallback=async()=>{const _0x539988=_0x12cb7d;messages=[],localStorage['removeItem'](_0x539988(0xaa)),renderMessages(),callBackend('clear_history',{});},modal[_0x12cb7d(0xda)][_0x12cb7d(0xbb)]('show');};document['getElementById'](a0_0x1e9459(0xed))['onclick']=()=>modal[a0_0x1e9459(0xda)][a0_0x1e9459(0xa3)]('show'),document[a0_0x1e9459(0xb7)](a0_0x1e9459(0x9a))[a0_0x1e9459(0xbc)]=()=>{const _0x682a3b=a0_0x1e9459;if(modalCallback)modalCallback();modal['classList']['remove'](_0x682a3b(0xdb));},messageInput[a0_0x1e9459(0xf0)](a0_0x1e9459(0xee),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1e9459(0xf0)]('keydown',_0x5dd7ab=>{const _0x35eb74=a0_0x1e9459;_0x5dd7ab[_0x35eb74(0xf9)]==='Enter'&&!_0x5dd7ab[_0x35eb74(0xef)]&&(_0x5dd7ab[_0x35eb74(0xa4)](),sendMessage());}),sendBtn[a0_0x1e9459(0xbc)]=sendMessage,document[a0_0x1e9459(0xf0)](a0_0x1e9459(0xc8),_0x4313d8=>{const _0x60b534=a0_0x1e9459;document[_0x60b534(0xfb)](_0x60b534(0x10a))[_0x60b534(0xfd)](_0x51cc6f=>{const _0x537123=_0x60b534;if(!_0x51cc6f[_0x537123(0xcd)](_0x4313d8[_0x537123(0xbe)]))_0x51cc6f[_0x537123(0xda)][_0x537123(0xa3)](_0x537123(0xb1));});});function a0_0xf8b8(){const _0x5ea692=['setItem','function','apply','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','<br>','trim','POST','modalCancel','input','shiftKey','addEventListener','role','content','username','stringify','querySelector','notificationOccurred','Начнется\x20новый\x20диалог.','style','key','getItem','querySelectorAll','chatArea','forEach','touchstart','focus','6.1','modalText','offClick','textContent','clearBtn','flex','disableVerticalSwipes','height','initDataUnsafe','Пустой\x20ответ','.message.show-delete','replace','offsetHeight','onEvent','resize','modalConfirm','push','1323390hThGZH','paddingBottom','TG\x20setup\x20error:','inputArea','display','debug_uid','length','remove','preventDefault','createElement','toString','Действие\x20необратимо.','modalTitle','light','ai_chat_messages','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','706240ivCTpZ','delete-btn','initData','scrollTop','parse','show-delete','constructor','random','55258ibPxgf','innerHeight','href','getElementById','BackButton','18goNWSd','search','add','onclick','emptyState','target','div','(((.+)+)+)+$','579YBuaMZ','message\x20','scrollHeight','viewportHeight','warn','medium','auto','click','error','14452nxKsXN','Ошибка\x20сервера','setHeaderColor','contains','expand','user','padStart','text/plain','onClick','messageInput','HapticFeedback','Очистить\x20историю?','success','impactOccurred','.container','value','classList','show','typingIndicator','disabled','first_name','appendChild','innerHTML','4598992rrPQmT','confirmModal','801355eYDWqu','10268955LblcbT','className'];a0_0xf8b8=function(){return _0x5ea692;};return a0_0xf8b8();}function a0_0x56c6(_0x5cfda9,_0x13789b){_0x5cfda9=_0x5cfda9-0x98;const _0x311e4b=a0_0xf8b8();let _0x4ef482=_0x311e4b[_0x5cfda9];return _0x4ef482;}const saved=localStorage[a0_0x1e9459(0xfa)](a0_0x1e9459(0xaa));if(saved)try{messages=JSON[a0_0x1e9459(0xb0)](saved),renderMessages();}catch(a0_0x5b23cb){}updateSendButton();