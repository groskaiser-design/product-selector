const a0_0x11165e=a0_0x5d93;function a0_0x5d93(_0x56bef2,_0x175514){_0x56bef2=_0x56bef2-0xf1;const _0x3a3830=a0_0x4c9b();let _0x93e2dc=_0x3a3830[_0x56bef2];return _0x93e2dc;}(function(_0x13a5ef,_0x5ebfef){const _0x2f7062=a0_0x5d93,_0x301cc3=_0x13a5ef();while(!![]){try{const _0x32fc88=parseInt(_0x2f7062(0x136))/0x1+parseInt(_0x2f7062(0xf5))/0x2+parseInt(_0x2f7062(0x132))/0x3*(parseInt(_0x2f7062(0x10a))/0x4)+-parseInt(_0x2f7062(0x153))/0x5*(parseInt(_0x2f7062(0x16d))/0x6)+-parseInt(_0x2f7062(0x164))/0x7+parseInt(_0x2f7062(0x139))/0x8+-parseInt(_0x2f7062(0x103))/0x9*(parseInt(_0x2f7062(0x11c))/0xa);if(_0x32fc88===_0x5ebfef)break;else _0x301cc3['push'](_0x301cc3['shift']());}catch(_0x153009){_0x301cc3['push'](_0x301cc3['shift']());}}}(a0_0x4c9b,0x6f9cf));const tg=window[a0_0x11165e(0x11d)]?.[a0_0x11165e(0x122)],HOME_URL=a0_0x11165e(0xf2);function setupTelegramBackButton(){const _0x3b71fc=a0_0x11165e,_0x16e9c9=(function(){let _0x5c37b5=!![];return function(_0x2b871e,_0x4e1493){const _0x7c65a9=_0x5c37b5?function(){if(_0x4e1493){const _0xa6f383=_0x4e1493['apply'](_0x2b871e,arguments);return _0x4e1493=null,_0xa6f383;}}:function(){};return _0x5c37b5=![],_0x7c65a9;};}()),_0x52a1c8=_0x16e9c9(this,function(){const _0x13f51c=a0_0x5d93;return _0x52a1c8[_0x13f51c(0x160)]()['search'](_0x13f51c(0x13b))[_0x13f51c(0x160)]()[_0x13f51c(0x154)](_0x52a1c8)[_0x13f51c(0x101)](_0x13f51c(0x13b));});_0x52a1c8();if(!tg)return;try{tg[_0x3b71fc(0x143)](),tg[_0x3b71fc(0x118)](),tg[_0x3b71fc(0x158)]?.(_0x3b71fc(0x15f));if(tg[_0x3b71fc(0x16a)]?.(_0x3b71fc(0x169)))tg[_0x3b71fc(0x138)]?.();const _0x459ad3=tg[_0x3b71fc(0x10f)];if(_0x459ad3){_0x459ad3[_0x3b71fc(0x161)]();if(typeof _0x459ad3[_0x3b71fc(0xf8)]===_0x3b71fc(0x142))try{_0x459ad3['offClick']();}catch(_0x2123b9){}_0x459ad3[_0x3b71fc(0x10b)](()=>{const _0x1a80bc=_0x3b71fc;if(tg[_0x1a80bc(0x14c)])tg[_0x1a80bc(0x14c)][_0x1a80bc(0x149)](_0x1a80bc(0x130));location[_0x1a80bc(0x146)]=HOME_URL;});}}catch(_0x114390){console[_0x3b71fc(0x147)](_0x3b71fc(0x113),_0x114390);}}function a0_0x4c9b(){const _0x320f2e=['text','push','remove','viewportHeight','paddingBottom','getMinutes','10172KtMpcl','onClick','modalCancel','success','disabled','BackButton','offsetHeight','message\x20','display','TG\x20setup\x20error:','modalText','Ошибка\x20сервера','getItem','random','expand','add','user','innerHeight','6166030VVmEse','Telegram','trim','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','initData','none','WebApp','Начнется\x20новый\x20диалог.','min','ai_chat_messages','now','preventDefault','scrollTop','querySelectorAll','chatArea','div','stringify','forEach','createElement','input','light','style','708HEGWBJ','scrollHeight','className','show-delete','722854RCFszw','keydown','disableVerticalSwipes','2478528gMeaEg','medium','(((.+)+)+)+$','setItem','click','message\x20ai','clear_history','appendChild','textContent','function','ready','emptyState','.message.show-delete','href','warn','initDataUnsafe','impactOccurred','first_name','flex','HapticFeedback','confirmModal','target','onEvent','innerHTML','touchend','from','876025mhaXvs','constructor','touchstart','height','message-bubble','setHeaderColor','content','notificationOccurred','children','messageInput','Удалить?','message-time','#050505','toString','show','value','sendBtn','34636gHVzYG','signal','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','abort','Enter','6.1','isVersionAtLeast','debug_uid','username','12uoZzIE','addEventListener','<br>','padStart','./router.html','shiftKey','key','825826xBGSMl','error','onclick','offClick','inputArea','getElementById','auto','replace','length','timestamp','Действие\x20необратимо.','floor','search','classList','18hdIdEl'];a0_0x4c9b=function(){return _0x320f2e;};return a0_0x4c9b();}(function initStableLayout(){const _0x3b1b06=a0_0x11165e,_0x1038fe=document['querySelector']('.container'),_0x109d0f=document[_0x3b1b06(0xfa)](_0x3b1b06(0xf9)),_0x2ea257=document[_0x3b1b06(0xfa)](_0x3b1b06(0x12a)),_0x51591c=document[_0x3b1b06(0xfa)](_0x3b1b06(0x15c));function _0x492f21(){const _0x5ef243=_0x3b1b06;if(!_0x1038fe)return;const _0x273b16=tg&&tg[_0x5ef243(0x107)]?tg[_0x5ef243(0x107)]:window[_0x5ef243(0x11b)];_0x1038fe[_0x5ef243(0x131)][_0x5ef243(0x156)]=_0x273b16+'px';if(_0x109d0f){const _0x1558ab=_0x109d0f[_0x5ef243(0x110)];_0x2ea257['style'][_0x5ef243(0x108)]=_0x1558ab+0x28+'px';}}tg?tg[_0x3b1b06(0x14f)]('viewportChanged',({isStateStable:_0x5e92af})=>{_0x492f21();if(_0x5e92af)requestAnimationFrame(()=>{_0x2ea257['scrollTop']=_0x2ea257['scrollHeight'];});}):window[_0x3b1b06(0x16e)]('resize',_0x492f21),_0x492f21(),_0x51591c&&(_0x51591c[_0x3b1b06(0x16e)](_0x3b1b06(0x12f),()=>{requestAnimationFrame(_0x492f21);}),_0x51591c['addEventListener']('focus',()=>{setTimeout(()=>{const _0x5b4229=a0_0x5d93;_0x2ea257[_0x5b4229(0x128)]=_0x2ea257[_0x5b4229(0x133)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x11165e(0x166),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x11165e(0xfa)](a0_0x11165e(0x12a)),emptyState=document['getElementById'](a0_0x11165e(0x144)),messageInput=document[a0_0x11165e(0xfa)](a0_0x11165e(0x15c)),sendBtn=document[a0_0x11165e(0xfa)](a0_0x11165e(0x163)),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0x11165e(0xfa)](a0_0x11165e(0x14d)),mTitle=document[a0_0x11165e(0xfa)]('modalTitle'),mText=document['getElementById'](a0_0x11165e(0x114));let modalCallback=null;async function callBackend(_0x359492,_0x4ab01f){const _0x570c44=a0_0x11165e,_0x3a2fea=tg?.[_0x570c44(0x148)]?.[_0x570c44(0x11a)]||{},_0x4b294d=_0x3a2fea['id']||localStorage[_0x570c44(0x116)](_0x570c44(0x16b))||'d-'+Math[_0x570c44(0x100)](Math[_0x570c44(0x117)]()*0x3b9aca00);if(!_0x3a2fea['id'])localStorage[_0x570c44(0x13c)](_0x570c44(0x16b),_0x4b294d);const _0x1b38fe={'action':_0x359492,'user_id':_0x4b294d,'user_data':{'first_name':_0x3a2fea[_0x570c44(0x14a)],'username':_0x3a2fea[_0x570c44(0x16c)]},'init_data':tg?.[_0x570c44(0x120)]||'',..._0x4ab01f},_0x3661d6=new AbortController(),_0x42c227=setTimeout(()=>_0x3661d6[_0x570c44(0x167)](),REQUEST_TIMEOUT_MS);try{const _0x4a8312=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x570c44(0x12c)](_0x1b38fe),'signal':_0x3661d6[_0x570c44(0x165)]});return clearTimeout(_0x42c227),await _0x4a8312['json']();}catch(_0x3ac880){return{'success':![],'error':String(_0x3ac880)};}}function formatTime(_0x13a921){const _0x420e64=a0_0x11165e,_0x2e6305=new Date(_0x13a921);return String(_0x2e6305['getHours']())[_0x420e64(0xf1)](0x2,'0')+':'+String(_0x2e6305[_0x420e64(0x109)]())[_0x420e64(0xf1)](0x2,'0');}function createMessageElement(_0x4d8b74,_0x4af01a){const _0x5bb814=a0_0x11165e,_0x7de41=document[_0x5bb814(0x12e)](_0x5bb814(0x12b));_0x7de41[_0x5bb814(0x134)]=_0x5bb814(0x111)+_0x4d8b74['role'];const _0x78dbb1=document['createElement'](_0x5bb814(0x12b));_0x78dbb1[_0x5bb814(0x134)]=_0x5bb814(0x157),_0x78dbb1[_0x5bb814(0x150)]=_0x4d8b74[_0x5bb814(0x159)][_0x5bb814(0xfc)](/\n/g,_0x5bb814(0x16f));const _0x1da105=document[_0x5bb814(0x12e)](_0x5bb814(0x12b));_0x1da105[_0x5bb814(0x134)]='delete-btn',_0x1da105[_0x5bb814(0x150)]=_0x5bb814(0x11f),_0x1da105[_0x5bb814(0xf7)]=_0x2ce2ff=>{_0x2ce2ff['stopPropagation'](),confirmDelete(_0x4af01a);};let _0x56deb3;_0x78dbb1['addEventListener'](_0x5bb814(0x155),()=>_0x56deb3=setTimeout(()=>{const _0x39a92f=_0x5bb814;_0x7de41['classList']['add'](_0x39a92f(0x135));if(tg?.[_0x39a92f(0x14c)])tg[_0x39a92f(0x14c)][_0x39a92f(0x149)](_0x39a92f(0x13a));},0x1f4)),_0x78dbb1[_0x5bb814(0x16e)](_0x5bb814(0x151),()=>clearTimeout(_0x56deb3));const _0x28f0b1=document[_0x5bb814(0x12e)](_0x5bb814(0x12b));return _0x28f0b1[_0x5bb814(0x134)]=_0x5bb814(0x15e),_0x28f0b1['textContent']=formatTime(_0x4d8b74[_0x5bb814(0xfe)]),_0x7de41['appendChild'](_0x1da105),_0x7de41['appendChild'](_0x78dbb1),_0x7de41[_0x5bb814(0x140)](_0x28f0b1),_0x7de41;}function createTypingIndicator(){const _0x1a38e4=a0_0x11165e,_0x41fd30=document['createElement'](_0x1a38e4(0x12b));return _0x41fd30[_0x1a38e4(0x134)]=_0x1a38e4(0x13e),_0x41fd30['id']='typingIndicator',_0x41fd30['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x41fd30;}function renderMessages(){const _0x22409a=a0_0x11165e;Array[_0x22409a(0x152)](chatArea[_0x22409a(0x15b)])[_0x22409a(0x12d)](_0x2bf119=>{const _0x2ea9b8=_0x22409a;if(_0x2bf119['id']!==_0x2ea9b8(0x144))_0x2bf119[_0x2ea9b8(0x106)]();}),messages[_0x22409a(0xfd)]>0x0?(emptyState[_0x22409a(0x131)]['display']=_0x22409a(0x121),messages[_0x22409a(0x12d)]((_0x2ba624,_0x1d39f6)=>chatArea[_0x22409a(0x140)](createMessageElement(_0x2ba624,_0x1d39f6)))):emptyState[_0x22409a(0x131)][_0x22409a(0x112)]=_0x22409a(0x14b),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x22409a(0x133)]);}function autoResizeTextarea(){const _0x5c0afc=a0_0x11165e;messageInput[_0x5c0afc(0x131)][_0x5c0afc(0x156)]=_0x5c0afc(0xfb),messageInput[_0x5c0afc(0x131)][_0x5c0afc(0x156)]=Math[_0x5c0afc(0x124)](messageInput[_0x5c0afc(0x133)],0x78)+'px';}function updateSendButton(){const _0x25f863=a0_0x11165e,_0xee2c41=messageInput[_0x25f863(0x162)][_0x25f863(0x11e)]();sendBtn[_0x25f863(0x10e)]=!_0xee2c41||isTyping;}async function sendMessage(){const _0x57319=a0_0x11165e,_0xb4d54c=messageInput['value']['trim']();if(!_0xb4d54c||isTyping)return;if(tg?.[_0x57319(0x14c)])tg[_0x57319(0x14c)][_0x57319(0x149)](_0x57319(0x130));messages[_0x57319(0x105)]({'role':_0x57319(0x11a),'content':_0xb4d54c,'timestamp':Date[_0x57319(0x126)]()}),localStorage[_0x57319(0x13c)](_0x57319(0x125),JSON[_0x57319(0x12c)](messages)),renderMessages(),messageInput[_0x57319(0x162)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x57319(0x128)]=chatArea[_0x57319(0x133)];const _0x235060=await callBackend('send_message',{'message':_0xb4d54c});isTyping=![];const _0x6e908d=document['getElementById']('typingIndicator');if(_0x6e908d)_0x6e908d[_0x57319(0x106)]();let _0x4d4cf1='Ошибка\x20сети';if(_0x235060['success']){_0x4d4cf1=_0x235060[_0x57319(0x104)]||'Пустой\x20ответ';if(tg?.[_0x57319(0x14c)])tg['HapticFeedback']['notificationOccurred'](_0x57319(0x10d));}else{_0x4d4cf1=_0x235060['error']||_0x57319(0x115);if(tg?.[_0x57319(0x14c)])tg[_0x57319(0x14c)][_0x57319(0x15a)](_0x57319(0xf6));}messages[_0x57319(0x105)]({'role':'ai','content':_0x4d4cf1,'timestamp':Date['now']()}),localStorage[_0x57319(0x13c)](_0x57319(0x125),JSON[_0x57319(0x12c)](messages)),renderMessages();}function confirmDelete(_0x57ea13){const _0x39a5d2=a0_0x11165e;if(mTitle)mTitle[_0x39a5d2(0x141)]=_0x39a5d2(0x15d);if(mText)mText[_0x39a5d2(0x141)]=_0x39a5d2(0xff);modalCallback=()=>{const _0x4924ec=_0x39a5d2;messages['splice'](_0x57ea13,0x1),localStorage['setItem'](_0x4924ec(0x125),JSON[_0x4924ec(0x12c)](messages)),renderMessages();},modal[_0x39a5d2(0x102)]['add'](_0x39a5d2(0x161));}if(clearBtn)clearBtn[a0_0x11165e(0xf7)]=()=>{const _0x4d6144=a0_0x11165e;if(!messages['length'])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText['textContent']=_0x4d6144(0x123);modalCallback=async()=>{const _0x4a5a68=_0x4d6144;messages=[],localStorage['removeItem'](_0x4a5a68(0x125)),renderMessages(),callBackend(_0x4a5a68(0x13f),{});},modal[_0x4d6144(0x102)][_0x4d6144(0x119)](_0x4d6144(0x161));};document[a0_0x11165e(0xfa)](a0_0x11165e(0x10c))[a0_0x11165e(0xf7)]=()=>modal[a0_0x11165e(0x102)][a0_0x11165e(0x106)](a0_0x11165e(0x161)),document[a0_0x11165e(0xfa)]('modalConfirm')['onclick']=()=>{const _0x544824=a0_0x11165e;if(modalCallback)modalCallback();modal[_0x544824(0x102)][_0x544824(0x106)](_0x544824(0x161));},messageInput[a0_0x11165e(0x16e)](a0_0x11165e(0x12f),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x11165e(0x16e)](a0_0x11165e(0x137),_0x127a7f=>{const _0x1cfb5a=a0_0x11165e;_0x127a7f[_0x1cfb5a(0xf4)]===_0x1cfb5a(0x168)&&!_0x127a7f[_0x1cfb5a(0xf3)]&&(_0x127a7f[_0x1cfb5a(0x127)](),sendMessage());}),sendBtn[a0_0x11165e(0xf7)]=sendMessage,document['addEventListener'](a0_0x11165e(0x13d),_0x48ca26=>{const _0x24204e=a0_0x11165e;document[_0x24204e(0x129)](_0x24204e(0x145))[_0x24204e(0x12d)](_0x32df12=>{const _0x46e72b=_0x24204e;if(!_0x32df12['contains'](_0x48ca26[_0x46e72b(0x14e)]))_0x32df12[_0x46e72b(0x102)][_0x46e72b(0x106)](_0x46e72b(0x135));});});const saved=localStorage['getItem'](a0_0x11165e(0x125));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x40b683){}updateSendButton();