const a0_0x58dea3=a0_0x3097;(function(_0x5bfb05,_0xd28f92){const _0x5a777c=a0_0x3097,_0xe69f3f=_0x5bfb05();while(!![]){try{const _0x5d0dff=parseInt(_0x5a777c(0x1da))/0x1+parseInt(_0x5a777c(0x1eb))/0x2+-parseInt(_0x5a777c(0x18d))/0x3*(parseInt(_0x5a777c(0x1e5))/0x4)+-parseInt(_0x5a777c(0x1d9))/0x5+-parseInt(_0x5a777c(0x1cb))/0x6+-parseInt(_0x5a777c(0x1c6))/0x7+parseInt(_0x5a777c(0x1b8))/0x8;if(_0x5d0dff===_0xd28f92)break;else _0xe69f3f['push'](_0xe69f3f['shift']());}catch(_0x4b3f18){_0xe69f3f['push'](_0xe69f3f['shift']());}}}(a0_0x59f1,0x5b49a));const tg=window[a0_0x58dea3(0x193)]?.[a0_0x58dea3(0x1e4)],HOME_URL=a0_0x58dea3(0x1b4);function a0_0x59f1(){const _0x41ae53=['getElementById','addEventListener','ai_chat_messages','success','innerHTML','confirmModal','remove','ready','186700gzhPgh','575343hcXQtY','modalText','forEach','children','parse','offsetHeight','light','apply','medium','toString','WebApp','2862096IKPGTr','href','inputArea','textContent','.message.show-delete','6.1','555858tgJShw','abort','trim','clearBtn','isVersionAtLeast','viewportHeight','viewportChanged','content','auto','keydown','div','add','push','from','chatArea','Начнется\x20новый\x20диалог.','now','touchend','className','impactOccurred','message\x20ai','message-time','debug_uid','json','initData','contains','replace','messageInput','3iLufPW','offClick','(((.+)+)+)+$','appendChild','getItem','input','Telegram','onEvent','HapticFeedback','display','none','value','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','onclick','modalConfirm','focus','message\x20','disableVerticalSwipes','flex','function','scrollTop','signal','scrollHeight','innerHeight','warn','getHours','search','setItem','createElement','delete-btn','classList','setHeaderColor','Пустой\x20ответ','click','modalCancel','key','stringify','padStart','#050505','./router.html','style','length','show-delete','7382584OeNicV','disabled','onClick','error','typingIndicator','querySelectorAll','emptyState','height','expand','initDataUnsafe','querySelector','modalTitle','first_name','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','2163707fFiSMx','show','user','preventDefault','target','2041296FRlCcH','touchstart','getMinutes','constructor','message-bubble','Действие\x20необратимо.'];a0_0x59f1=function(){return _0x41ae53;};return a0_0x59f1();}function setupTelegramBackButton(){const _0x331d5e=a0_0x58dea3,_0x550b41=(function(){let _0x2f8988=!![];return function(_0xd533be,_0x378f35){const _0x5ac029=_0x2f8988?function(){const _0x5eece4=a0_0x3097;if(_0x378f35){const _0xa29ca3=_0x378f35[_0x5eece4(0x1e1)](_0xd533be,arguments);return _0x378f35=null,_0xa29ca3;}}:function(){};return _0x2f8988=![],_0x5ac029;};}()),_0x2be3d3=_0x550b41(this,function(){const _0x17bf9c=a0_0x3097;return _0x2be3d3[_0x17bf9c(0x1e3)]()[_0x17bf9c(0x1a7)]('(((.+)+)+)+$')[_0x17bf9c(0x1e3)]()[_0x17bf9c(0x1ce)](_0x2be3d3)[_0x17bf9c(0x1a7)](_0x17bf9c(0x18f));});_0x2be3d3();if(!tg)return;try{tg[_0x331d5e(0x1d8)](),tg[_0x331d5e(0x1c0)](),tg[_0x331d5e(0x1ac)]?.(_0x331d5e(0x1b3));if(tg[_0x331d5e(0x1ef)]?.(_0x331d5e(0x1ea)))tg[_0x331d5e(0x19e)]?.();const _0xf68f9d=tg['BackButton'];if(_0xf68f9d){_0xf68f9d[_0x331d5e(0x1c7)]();if(typeof _0xf68f9d[_0x331d5e(0x18e)]===_0x331d5e(0x1a0))try{_0xf68f9d[_0x331d5e(0x18e)]();}catch(_0x3ce9a6){}_0xf68f9d[_0x331d5e(0x1ba)](()=>{const _0x45a01f=_0x331d5e;if(tg['HapticFeedback'])tg['HapticFeedback'][_0x45a01f(0x1fe)](_0x45a01f(0x1e0));location[_0x45a01f(0x1e6)]=HOME_URL;});}}catch(_0x10c91a){console[_0x331d5e(0x1a5)]('TG\x20setup\x20error:',_0x10c91a);}}(function initStableLayout(){const _0xadea8e=a0_0x58dea3,_0x1d179a=document[_0xadea8e(0x1c2)]('.container'),_0xcec311=document['getElementById'](_0xadea8e(0x1e7)),_0x5412df=document[_0xadea8e(0x1d1)](_0xadea8e(0x1f9)),_0x3af78f=document[_0xadea8e(0x1d1)]('messageInput');function _0x1638cc(){const _0x463454=_0xadea8e;if(!_0x1d179a)return;const _0x1de0e5=tg&&tg[_0x463454(0x1f0)]?tg[_0x463454(0x1f0)]:window[_0x463454(0x1a4)];_0x1d179a[_0x463454(0x1b5)]['height']=_0x1de0e5+'px';if(_0xcec311){const _0xb7a8e0=_0xcec311[_0x463454(0x1df)];_0x5412df[_0x463454(0x1b5)]['paddingBottom']=_0xb7a8e0+0x28+'px';}}tg?tg[_0xadea8e(0x194)](_0xadea8e(0x1f1),({isStateStable:_0x405210})=>{_0x1638cc();if(_0x405210)requestAnimationFrame(()=>{const _0x2a5306=a0_0x3097;_0x5412df[_0x2a5306(0x1a1)]=_0x5412df['scrollHeight'];});}):window['addEventListener']('resize',_0x1638cc),_0x1638cc(),_0x3af78f&&(_0x3af78f[_0xadea8e(0x1d2)](_0xadea8e(0x192),()=>{requestAnimationFrame(_0x1638cc);}),_0x3af78f[_0xadea8e(0x1d2)](_0xadea8e(0x19c),()=>{setTimeout(()=>{const _0x1ca962=a0_0x3097;_0x5412df['scrollTop']=_0x5412df[_0x1ca962(0x1a3)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x58dea3(0x199),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x58dea3(0x1d1)](a0_0x58dea3(0x1f9)),emptyState=document[a0_0x58dea3(0x1d1)](a0_0x58dea3(0x1be)),messageInput=document[a0_0x58dea3(0x1d1)](a0_0x58dea3(0x18c)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x58dea3(0x1d1)](a0_0x58dea3(0x1ee)),modal=document[a0_0x58dea3(0x1d1)](a0_0x58dea3(0x1d6)),mTitle=document[a0_0x58dea3(0x1d1)](a0_0x58dea3(0x1c3)),mText=document[a0_0x58dea3(0x1d1)](a0_0x58dea3(0x1db));let modalCallback=null;async function callBackend(_0x24686d,_0x2420a3){const _0x4ef0ef=a0_0x58dea3,_0x5f340f=tg?.[_0x4ef0ef(0x1c1)]?.[_0x4ef0ef(0x1c8)]||{},_0x43a2d6=_0x5f340f['id']||localStorage[_0x4ef0ef(0x191)](_0x4ef0ef(0x201))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x5f340f['id'])localStorage[_0x4ef0ef(0x1a8)](_0x4ef0ef(0x201),_0x43a2d6);const _0x26617e={'action':_0x24686d,'user_id':_0x43a2d6,'user_data':{'first_name':_0x5f340f[_0x4ef0ef(0x1c4)],'username':_0x5f340f['username']},'init_data':tg?.[_0x4ef0ef(0x189)]||'',..._0x2420a3},_0x9fa9ef=new AbortController(),_0x24ae69=setTimeout(()=>_0x9fa9ef[_0x4ef0ef(0x1ec)](),REQUEST_TIMEOUT_MS);try{const _0x200cf9=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x4ef0ef(0x1b1)](_0x26617e),'signal':_0x9fa9ef[_0x4ef0ef(0x1a2)]});return clearTimeout(_0x24ae69),await _0x200cf9[_0x4ef0ef(0x188)]();}catch(_0x532db8){return{'success':![],'error':String(_0x532db8)};}}function formatTime(_0x3a0163){const _0x2b105e=a0_0x58dea3,_0x28e619=new Date(_0x3a0163);return String(_0x28e619[_0x2b105e(0x1a6)]())[_0x2b105e(0x1b2)](0x2,'0')+':'+String(_0x28e619[_0x2b105e(0x1cd)]())[_0x2b105e(0x1b2)](0x2,'0');}function createMessageElement(_0x2efb0f,_0x137185){const _0x157097=a0_0x58dea3,_0x380594=document[_0x157097(0x1a9)](_0x157097(0x1f5));_0x380594['className']=_0x157097(0x19d)+_0x2efb0f['role'];const _0x1c36af=document[_0x157097(0x1a9)](_0x157097(0x1f5));_0x1c36af['className']=_0x157097(0x1cf),_0x1c36af[_0x157097(0x1d5)]=_0x2efb0f[_0x157097(0x1f2)][_0x157097(0x18b)](/\n/g,'<br>');const _0x446e4f=document[_0x157097(0x1a9)](_0x157097(0x1f5));_0x446e4f[_0x157097(0x1fd)]=_0x157097(0x1aa),_0x446e4f[_0x157097(0x1d5)]=_0x157097(0x1c5),_0x446e4f[_0x157097(0x19a)]=_0x4e5464=>{_0x4e5464['stopPropagation'](),confirmDelete(_0x137185);};let _0x4f7dee;_0x1c36af[_0x157097(0x1d2)](_0x157097(0x1cc),()=>_0x4f7dee=setTimeout(()=>{const _0x23e32c=_0x157097;_0x380594[_0x23e32c(0x1ab)]['add']('show-delete');if(tg?.[_0x23e32c(0x195)])tg[_0x23e32c(0x195)]['impactOccurred'](_0x23e32c(0x1e2));},0x1f4)),_0x1c36af[_0x157097(0x1d2)](_0x157097(0x1fc),()=>clearTimeout(_0x4f7dee));const _0x2511c6=document[_0x157097(0x1a9)]('div');return _0x2511c6[_0x157097(0x1fd)]=_0x157097(0x200),_0x2511c6[_0x157097(0x1e8)]=formatTime(_0x2efb0f['timestamp']),_0x380594[_0x157097(0x190)](_0x446e4f),_0x380594[_0x157097(0x190)](_0x1c36af),_0x380594[_0x157097(0x190)](_0x2511c6),_0x380594;}function createTypingIndicator(){const _0x55b202=a0_0x58dea3,_0x3a39f8=document[_0x55b202(0x1a9)](_0x55b202(0x1f5));return _0x3a39f8['className']=_0x55b202(0x1ff),_0x3a39f8['id']=_0x55b202(0x1bc),_0x3a39f8[_0x55b202(0x1d5)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x3a39f8;}function renderMessages(){const _0x37ce7f=a0_0x58dea3;Array[_0x37ce7f(0x1f8)](chatArea[_0x37ce7f(0x1dd)])[_0x37ce7f(0x1dc)](_0x4bd296=>{const _0x2a41f6=_0x37ce7f;if(_0x4bd296['id']!==_0x2a41f6(0x1be))_0x4bd296[_0x2a41f6(0x1d7)]();}),messages[_0x37ce7f(0x1b6)]>0x0?(emptyState[_0x37ce7f(0x1b5)][_0x37ce7f(0x196)]=_0x37ce7f(0x197),messages['forEach']((_0x3ade11,_0x32b260)=>chatArea[_0x37ce7f(0x190)](createMessageElement(_0x3ade11,_0x32b260)))):emptyState[_0x37ce7f(0x1b5)][_0x37ce7f(0x196)]=_0x37ce7f(0x19f),requestAnimationFrame(()=>chatArea[_0x37ce7f(0x1a1)]=chatArea[_0x37ce7f(0x1a3)]);}function autoResizeTextarea(){const _0x417ffc=a0_0x58dea3;messageInput[_0x417ffc(0x1b5)][_0x417ffc(0x1bf)]=_0x417ffc(0x1f3),messageInput[_0x417ffc(0x1b5)][_0x417ffc(0x1bf)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x8dd728=a0_0x58dea3,_0xf3d244=messageInput[_0x8dd728(0x198)][_0x8dd728(0x1ed)]();sendBtn[_0x8dd728(0x1b9)]=!_0xf3d244||isTyping;}async function sendMessage(){const _0x4e8893=a0_0x58dea3,_0x5e66d3=messageInput[_0x4e8893(0x198)]['trim']();if(!_0x5e66d3||isTyping)return;if(tg?.[_0x4e8893(0x195)])tg[_0x4e8893(0x195)][_0x4e8893(0x1fe)](_0x4e8893(0x1e0));messages[_0x4e8893(0x1f7)]({'role':_0x4e8893(0x1c8),'content':_0x5e66d3,'timestamp':Date['now']()}),localStorage[_0x4e8893(0x1a8)](_0x4e8893(0x1d3),JSON[_0x4e8893(0x1b1)](messages)),renderMessages(),messageInput[_0x4e8893(0x198)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4e8893(0x190)](createTypingIndicator()),chatArea[_0x4e8893(0x1a1)]=chatArea['scrollHeight'];const _0x2efddd=await callBackend('send_message',{'message':_0x5e66d3});isTyping=![];const _0xa1408d=document['getElementById'](_0x4e8893(0x1bc));if(_0xa1408d)_0xa1408d[_0x4e8893(0x1d7)]();let _0x168280='Ошибка\x20сети';if(_0x2efddd[_0x4e8893(0x1d4)]){_0x168280=_0x2efddd['text']||_0x4e8893(0x1ad);if(tg?.['HapticFeedback'])tg[_0x4e8893(0x195)]['notificationOccurred'](_0x4e8893(0x1d4));}else{_0x168280=_0x2efddd[_0x4e8893(0x1bb)]||'Ошибка\x20сервера';if(tg?.[_0x4e8893(0x195)])tg[_0x4e8893(0x195)]['notificationOccurred'](_0x4e8893(0x1bb));}messages[_0x4e8893(0x1f7)]({'role':'ai','content':_0x168280,'timestamp':Date[_0x4e8893(0x1fb)]()}),localStorage[_0x4e8893(0x1a8)]('ai_chat_messages',JSON[_0x4e8893(0x1b1)](messages)),renderMessages();}function confirmDelete(_0x27ad9b){const _0x268a59=a0_0x58dea3;if(mTitle)mTitle[_0x268a59(0x1e8)]='Удалить?';if(mText)mText[_0x268a59(0x1e8)]=_0x268a59(0x1d0);modalCallback=()=>{const _0x552152=_0x268a59;messages['splice'](_0x27ad9b,0x1),localStorage['setItem'](_0x552152(0x1d3),JSON[_0x552152(0x1b1)](messages)),renderMessages();},modal[_0x268a59(0x1ab)][_0x268a59(0x1f6)](_0x268a59(0x1c7));}if(clearBtn)clearBtn['onclick']=()=>{const _0x593103=a0_0x58dea3;if(!messages[_0x593103(0x1b6)])return;if(mTitle)mTitle[_0x593103(0x1e8)]='Очистить\x20историю?';if(mText)mText[_0x593103(0x1e8)]=_0x593103(0x1fa);modalCallback=async()=>{const _0xf105ca=_0x593103;messages=[],localStorage['removeItem'](_0xf105ca(0x1d3)),renderMessages(),callBackend('clear_history',{});},modal[_0x593103(0x1ab)][_0x593103(0x1f6)](_0x593103(0x1c7));};document[a0_0x58dea3(0x1d1)](a0_0x58dea3(0x1af))[a0_0x58dea3(0x19a)]=()=>modal[a0_0x58dea3(0x1ab)][a0_0x58dea3(0x1d7)](a0_0x58dea3(0x1c7)),document['getElementById'](a0_0x58dea3(0x19b))[a0_0x58dea3(0x19a)]=()=>{const _0x41c637=a0_0x58dea3;if(modalCallback)modalCallback();modal[_0x41c637(0x1ab)][_0x41c637(0x1d7)](_0x41c637(0x1c7));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x58dea3(0x1d2)](a0_0x58dea3(0x1f4),_0x50e580=>{const _0x53b4e1=a0_0x58dea3;_0x50e580[_0x53b4e1(0x1b0)]==='Enter'&&!_0x50e580['shiftKey']&&(_0x50e580[_0x53b4e1(0x1c9)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x58dea3(0x1ae),_0x5123b3=>{const _0x449274=a0_0x58dea3;document[_0x449274(0x1bd)](_0x449274(0x1e9))[_0x449274(0x1dc)](_0x1ac43b=>{const _0x3f038f=_0x449274;if(!_0x1ac43b[_0x3f038f(0x18a)](_0x5123b3[_0x3f038f(0x1ca)]))_0x1ac43b[_0x3f038f(0x1ab)]['remove'](_0x3f038f(0x1b7));});});function a0_0x3097(_0x34546b,_0x460b04){_0x34546b=_0x34546b-0x188;const _0x340476=a0_0x59f1();let _0x32a6d8=_0x340476[_0x34546b];return _0x32a6d8;}const saved=localStorage[a0_0x58dea3(0x191)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x58dea3(0x1de)](saved),renderMessages();}catch(a0_0x383026){}updateSendButton();