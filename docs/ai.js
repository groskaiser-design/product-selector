const a0_0x20678f=a0_0x44c4;(function(_0x3e89d6,_0x541af9){const _0x43b1e3=a0_0x44c4,_0x18813d=_0x3e89d6();while(!![]){try{const _0x1f1be2=parseInt(_0x43b1e3(0x224))/0x1+parseInt(_0x43b1e3(0x1f8))/0x2+-parseInt(_0x43b1e3(0x237))/0x3*(parseInt(_0x43b1e3(0x1e7))/0x4)+-parseInt(_0x43b1e3(0x20a))/0x5+-parseInt(_0x43b1e3(0x227))/0x6+-parseInt(_0x43b1e3(0x207))/0x7+parseInt(_0x43b1e3(0x23c))/0x8*(parseInt(_0x43b1e3(0x239))/0x9);if(_0x1f1be2===_0x541af9)break;else _0x18813d['push'](_0x18813d['shift']());}catch(_0x23e8c0){_0x18813d['push'](_0x18813d['shift']());}}}(a0_0x1bf3,0x61eae));const tg=window['Telegram']?.[a0_0x20678f(0x21f)],HOME_URL=a0_0x20678f(0x1e1);function setupTelegramBackButton(){const _0xfb96de=a0_0x20678f;if(!tg)return;try{tg[_0xfb96de(0x202)](),tg[_0xfb96de(0x1e6)](),tg[_0xfb96de(0x1dc)]?.('#050505');if(tg[_0xfb96de(0x1f7)]?.(_0xfb96de(0x1d5)))tg[_0xfb96de(0x231)]?.();const _0x57f735=tg['BackButton'];if(_0x57f735){_0x57f735['show']();if(typeof _0x57f735[_0xfb96de(0x213)]==='function')try{_0x57f735[_0xfb96de(0x213)]();}catch(_0x31dc8a){}_0x57f735[_0xfb96de(0x243)](()=>{const _0x216431=_0xfb96de;if(tg[_0x216431(0x1db)])tg[_0x216431(0x1db)][_0x216431(0x245)](_0x216431(0x1fc));location[_0x216431(0x1da)]=HOME_URL;});}}catch(_0x2b5b75){console[_0xfb96de(0x23d)](_0xfb96de(0x228),_0x2b5b75);}}(function initStableLayout(){const _0x3d3c12=a0_0x20678f,_0x27b523=(function(){let _0x4b74ae=!![];return function(_0x23c701,_0x32da2b){const _0x350555=_0x4b74ae?function(){const _0x34e2d9=a0_0x44c4;if(_0x32da2b){const _0x5bc881=_0x32da2b[_0x34e2d9(0x1ea)](_0x23c701,arguments);return _0x32da2b=null,_0x5bc881;}}:function(){};return _0x4b74ae=![],_0x350555;};}()),_0x4bc255=document[_0x3d3c12(0x223)]('.container'),_0x25ebf8=document['getElementById'](_0x3d3c12(0x1d6)),_0x20d5da=document[_0x3d3c12(0x21b)](_0x3d3c12(0x1f6)),_0x54927f=document[_0x3d3c12(0x21b)](_0x3d3c12(0x1f3));function _0x51633a(){const _0x4311d7=_0x3d3c12,_0xe9c52e=_0x27b523(this,function(){const _0x32fde3=a0_0x44c4;return _0xe9c52e[_0x32fde3(0x1eb)]()['search']('(((.+)+)+)+$')[_0x32fde3(0x1eb)]()['constructor'](_0xe9c52e)[_0x32fde3(0x1d4)]('(((.+)+)+)+$');});_0xe9c52e();if(!_0x4bc255)return;const _0x1b6755=tg&&tg['viewportHeight']?tg[_0x4311d7(0x1d9)]:window[_0x4311d7(0x200)];_0x4bc255['style'][_0x4311d7(0x1e8)]=_0x1b6755+'px';if(_0x25ebf8){const _0x1e7178=_0x25ebf8[_0x4311d7(0x241)];_0x20d5da[_0x4311d7(0x20e)][_0x4311d7(0x1ef)]=_0x1e7178+0x28+'px';}}tg?tg[_0x3d3c12(0x22b)](_0x3d3c12(0x230),({isStateStable:_0x5a3ce9})=>{_0x51633a();if(_0x5a3ce9)requestAnimationFrame(()=>{const _0x3ab2bc=a0_0x44c4;_0x20d5da[_0x3ab2bc(0x211)]=_0x20d5da[_0x3ab2bc(0x206)];});}):window[_0x3d3c12(0x212)]('resize',_0x51633a),_0x51633a(),_0x54927f&&(_0x54927f[_0x3d3c12(0x212)](_0x3d3c12(0x247),()=>{requestAnimationFrame(_0x51633a);}),_0x54927f[_0x3d3c12(0x212)]('focus',()=>{setTimeout(()=>{const _0x25b21f=a0_0x44c4;_0x20d5da[_0x25b21f(0x211)]=_0x20d5da['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x20678f(0x1dd),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x20678f(0x21b)]('chatArea'),emptyState=document[a0_0x20678f(0x21b)](a0_0x20678f(0x219)),messageInput=document[a0_0x20678f(0x21b)](a0_0x20678f(0x1f3)),sendBtn=document[a0_0x20678f(0x21b)]('sendBtn'),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0x20678f(0x21b)](a0_0x20678f(0x244)),mTitle=document['getElementById'](a0_0x20678f(0x1df)),mText=document['getElementById'](a0_0x20678f(0x203));let modalCallback=null;async function callBackend(_0x1d85d4,_0x3511d2){const _0x560aff=a0_0x20678f,_0xf12649=tg?.[_0x560aff(0x1de)]?.[_0x560aff(0x226)]||{},_0xa5df14=_0xf12649['id']||localStorage[_0x560aff(0x22e)](_0x560aff(0x1f2))||'d-'+Math[_0x560aff(0x1d7)](Math[_0x560aff(0x1cf)]()*0x3b9aca00);if(!_0xf12649['id'])localStorage[_0x560aff(0x22a)](_0x560aff(0x1f2),_0xa5df14);const _0x1bb3f9={'action':_0x1d85d4,'user_id':_0xa5df14,'user_data':{'first_name':_0xf12649['first_name'],'username':_0xf12649[_0x560aff(0x1d3)]},'init_data':tg?.[_0x560aff(0x248)]||'',..._0x3511d2},_0x1246a3=new AbortController(),_0x82c143=setTimeout(()=>_0x1246a3[_0x560aff(0x1d1)](),REQUEST_TIMEOUT_MS);try{const _0x464d6f=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x560aff(0x1ee)](_0x1bb3f9),'signal':_0x1246a3[_0x560aff(0x22d)]});return clearTimeout(_0x82c143),await _0x464d6f[_0x560aff(0x1f1)]();}catch(_0x27c4d5){return{'success':![],'error':String(_0x27c4d5)};}}function formatTime(_0x2afe66){const _0x46b95c=a0_0x20678f,_0x3be54b=new Date(_0x2afe66);return String(_0x3be54b[_0x46b95c(0x1fb)]())[_0x46b95c(0x1ec)](0x2,'0')+':'+String(_0x3be54b['getMinutes']())['padStart'](0x2,'0');}function a0_0x44c4(_0x2741be,_0x395f41){_0x2741be=_0x2741be-0x1ce;const _0xcfc7ab=a0_0x1bf3();let _0x178385=_0xcfc7ab[_0x2741be];return _0x178385;}function createMessageElement(_0x29e3af,_0x1806c1){const _0x38d6c7=a0_0x20678f,_0x10d7e5=document[_0x38d6c7(0x204)](_0x38d6c7(0x21a));_0x10d7e5[_0x38d6c7(0x201)]=_0x38d6c7(0x20f)+_0x29e3af[_0x38d6c7(0x20c)];const _0x5bc312=document['createElement'](_0x38d6c7(0x21a));_0x5bc312['className']=_0x38d6c7(0x22c),_0x5bc312[_0x38d6c7(0x20b)]=_0x29e3af[_0x38d6c7(0x1fa)][_0x38d6c7(0x220)](/\n/g,_0x38d6c7(0x1f4));const _0x52e85a=document[_0x38d6c7(0x204)](_0x38d6c7(0x21a));_0x52e85a[_0x38d6c7(0x201)]='delete-btn',_0x52e85a[_0x38d6c7(0x20b)]=_0x38d6c7(0x214),_0x52e85a[_0x38d6c7(0x1e2)]=_0x424474=>{_0x424474['stopPropagation'](),confirmDelete(_0x1806c1);};let _0x400797;_0x5bc312[_0x38d6c7(0x212)](_0x38d6c7(0x232),()=>_0x400797=setTimeout(()=>{const _0x2edd64=_0x38d6c7;_0x10d7e5[_0x2edd64(0x23e)]['add'](_0x2edd64(0x1fe));if(tg?.[_0x2edd64(0x1db)])tg['HapticFeedback'][_0x2edd64(0x245)](_0x2edd64(0x209));},0x1f4)),_0x5bc312[_0x38d6c7(0x212)]('touchend',()=>clearTimeout(_0x400797));const _0x556a24=document['createElement'](_0x38d6c7(0x21a));return _0x556a24[_0x38d6c7(0x201)]=_0x38d6c7(0x222),_0x556a24[_0x38d6c7(0x221)]=formatTime(_0x29e3af['timestamp']),_0x10d7e5[_0x38d6c7(0x229)](_0x52e85a),_0x10d7e5[_0x38d6c7(0x229)](_0x5bc312),_0x10d7e5['appendChild'](_0x556a24),_0x10d7e5;}function createTypingIndicator(){const _0x28e0e4=a0_0x20678f,_0x41ad91=document[_0x28e0e4(0x204)](_0x28e0e4(0x21a));return _0x41ad91[_0x28e0e4(0x201)]=_0x28e0e4(0x21c),_0x41ad91['id']=_0x28e0e4(0x1ff),_0x41ad91[_0x28e0e4(0x20b)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x41ad91;}function renderMessages(){const _0x430f53=a0_0x20678f;Array['from'](chatArea[_0x430f53(0x246)])['forEach'](_0x44983e=>{const _0x2edfd7=_0x430f53;if(_0x44983e['id']!==_0x2edfd7(0x219))_0x44983e[_0x2edfd7(0x21e)]();}),messages['length']>0x0?(emptyState[_0x430f53(0x20e)]['display']='none',messages[_0x430f53(0x1d2)]((_0xc13c3b,_0xe08055)=>chatArea[_0x430f53(0x229)](createMessageElement(_0xc13c3b,_0xe08055)))):emptyState[_0x430f53(0x20e)][_0x430f53(0x240)]=_0x430f53(0x1ed),requestAnimationFrame(()=>chatArea[_0x430f53(0x211)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x159d33=a0_0x20678f;messageInput[_0x159d33(0x20e)][_0x159d33(0x1e8)]=_0x159d33(0x217),messageInput[_0x159d33(0x20e)][_0x159d33(0x1e8)]=Math[_0x159d33(0x236)](messageInput[_0x159d33(0x206)],0x78)+'px';}function updateSendButton(){const _0x19eab3=a0_0x20678f,_0x221b60=messageInput[_0x19eab3(0x218)][_0x19eab3(0x22f)]();sendBtn[_0x19eab3(0x210)]=!_0x221b60||isTyping;}async function sendMessage(){const _0x253820=a0_0x20678f,_0x26b954=messageInput[_0x253820(0x218)][_0x253820(0x22f)]();if(!_0x26b954||isTyping)return;if(tg?.[_0x253820(0x1db)])tg[_0x253820(0x1db)]['impactOccurred'](_0x253820(0x1fc));messages[_0x253820(0x1e5)]({'role':_0x253820(0x226),'content':_0x26b954,'timestamp':Date['now']()}),localStorage[_0x253820(0x22a)]('ai_chat_messages',JSON[_0x253820(0x1ee)](messages)),renderMessages(),messageInput[_0x253820(0x218)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x253820(0x229)](createTypingIndicator()),chatArea[_0x253820(0x211)]=chatArea['scrollHeight'];const _0x6bf246=await callBackend(_0x253820(0x1e4),{'message':_0x26b954});isTyping=![];const _0x265542=document['getElementById'](_0x253820(0x1ff));if(_0x265542)_0x265542[_0x253820(0x21e)]();let _0x1f5c25=_0x253820(0x21d);if(_0x6bf246['success']){_0x1f5c25=_0x6bf246['text']||_0x253820(0x205);if(tg?.[_0x253820(0x1db)])tg['HapticFeedback'][_0x253820(0x1e0)](_0x253820(0x1ce));}else{_0x1f5c25=_0x6bf246[_0x253820(0x1f9)]||'Ошибка\x20сервера';if(tg?.[_0x253820(0x1db)])tg[_0x253820(0x1db)][_0x253820(0x1e0)]('error');}messages[_0x253820(0x1e5)]({'role':'ai','content':_0x1f5c25,'timestamp':Date[_0x253820(0x1fd)]()}),localStorage[_0x253820(0x22a)](_0x253820(0x234),JSON[_0x253820(0x1ee)](messages)),renderMessages();}function confirmDelete(_0x21340e){const _0x302ee8=a0_0x20678f;if(mTitle)mTitle[_0x302ee8(0x221)]=_0x302ee8(0x23b);if(mText)mText[_0x302ee8(0x221)]=_0x302ee8(0x235);modalCallback=()=>{const _0x12d98a=_0x302ee8;messages[_0x12d98a(0x216)](_0x21340e,0x1),localStorage[_0x12d98a(0x22a)]('ai_chat_messages',JSON[_0x12d98a(0x1ee)](messages)),renderMessages();},modal['classList'][_0x302ee8(0x23f)](_0x302ee8(0x225));}if(clearBtn)clearBtn[a0_0x20678f(0x1e2)]=()=>{const _0x30757b=a0_0x20678f;if(!messages[_0x30757b(0x20d)])return;if(mTitle)mTitle['textContent']=_0x30757b(0x215);if(mText)mText['textContent']=_0x30757b(0x242);modalCallback=async()=>{const _0x116786=_0x30757b;messages=[],localStorage[_0x116786(0x1f0)](_0x116786(0x234)),renderMessages(),callBackend(_0x116786(0x1e9),{});},modal[_0x30757b(0x23e)][_0x30757b(0x23f)](_0x30757b(0x225));};document[a0_0x20678f(0x21b)](a0_0x20678f(0x1f5))['onclick']=()=>modal[a0_0x20678f(0x23e)][a0_0x20678f(0x21e)](a0_0x20678f(0x225)),document['getElementById']('modalConfirm')[a0_0x20678f(0x1e2)]=()=>{const _0x1accd0=a0_0x20678f;if(modalCallback)modalCallback();modal[_0x1accd0(0x23e)][_0x1accd0(0x21e)](_0x1accd0(0x225));},messageInput[a0_0x20678f(0x212)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x548289=>{const _0x15efa6=a0_0x20678f;_0x548289[_0x15efa6(0x23a)]===_0x15efa6(0x238)&&!_0x548289[_0x15efa6(0x208)]&&(_0x548289['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x20678f(0x212)](a0_0x20678f(0x1d8),_0x2885ae=>{const _0x86d9eb=a0_0x20678f;document[_0x86d9eb(0x233)](_0x86d9eb(0x1d0))[_0x86d9eb(0x1d2)](_0xfa4e82=>{const _0x3434c3=_0x86d9eb;if(!_0xfa4e82['contains'](_0x2885ae['target']))_0xfa4e82[_0x3434c3(0x23e)][_0x3434c3(0x21e)](_0x3434c3(0x1fe));});});const saved=localStorage[a0_0x20678f(0x22e)](a0_0x20678f(0x234));if(saved)try{messages=JSON[a0_0x20678f(0x1e3)](saved),renderMessages();}catch(a0_0x3c254a){}updateSendButton();function a0_0x1bf3(){const _0x3e291c=['Пустой\x20ответ','scrollHeight','3375582PzfDcA','shiftKey','medium','1805970uyDTfs','innerHTML','role','length','style','message\x20','disabled','scrollTop','addEventListener','offClick','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Очистить\x20историю?','splice','auto','value','emptyState','div','getElementById','message\x20ai','Ошибка\x20сети','remove','WebApp','replace','textContent','message-time','querySelector','334225kbEysC','show','user','4593504TGbqeK','TG\x20setup\x20error:','appendChild','setItem','onEvent','message-bubble','signal','getItem','trim','viewportChanged','disableVerticalSwipes','touchstart','querySelectorAll','ai_chat_messages','Действие\x20необратимо.','min','134799XPfSff','Enter','2901393JzmDws','key','Удалить?','56rcQUBF','warn','classList','add','display','offsetHeight','Начнется\x20новый\x20диалог.','onClick','confirmModal','impactOccurred','children','input','initData','success','random','.message.show-delete','abort','forEach','username','search','6.1','inputArea','floor','click','viewportHeight','href','HapticFeedback','setHeaderColor','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','initDataUnsafe','modalTitle','notificationOccurred','./router.html','onclick','parse','send_message','push','expand','60gUywhE','height','clear_history','apply','toString','padStart','flex','stringify','paddingBottom','removeItem','json','debug_uid','messageInput','<br>','modalCancel','chatArea','isVersionAtLeast','186410xeJMhE','error','content','getHours','light','now','show-delete','typingIndicator','innerHeight','className','ready','modalText','createElement'];a0_0x1bf3=function(){return _0x3e291c;};return a0_0x1bf3();}