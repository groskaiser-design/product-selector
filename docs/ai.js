const a0_0x3a6ab7=a0_0x11f6;(function(_0x43a104,_0x5734a0){const _0x204fc0=a0_0x11f6,_0x568775=_0x43a104();while(!![]){try{const _0x41ab87=-parseInt(_0x204fc0(0x183))/0x1+parseInt(_0x204fc0(0x175))/0x2+-parseInt(_0x204fc0(0x14e))/0x3+-parseInt(_0x204fc0(0x16a))/0x4*(parseInt(_0x204fc0(0x168))/0x5)+parseInt(_0x204fc0(0x12f))/0x6*(-parseInt(_0x204fc0(0x112))/0x7)+parseInt(_0x204fc0(0x127))/0x8*(-parseInt(_0x204fc0(0x17e))/0x9)+parseInt(_0x204fc0(0x161))/0xa;if(_0x41ab87===_0x5734a0)break;else _0x568775['push'](_0x568775['shift']());}catch(_0x12f89c){_0x568775['push'](_0x568775['shift']());}}}(a0_0x17cd,0x802b3));const tg=window[a0_0x3a6ab7(0x16c)]?.[a0_0x3a6ab7(0x18a)],HOME_URL=a0_0x3a6ab7(0x17b);function setupTelegramBackButton(){const _0x14f301=a0_0x3a6ab7;if(!tg)return;try{tg[_0x14f301(0x140)](),tg[_0x14f301(0x11d)](),tg[_0x14f301(0x150)]?.(_0x14f301(0x172));if(tg['isVersionAtLeast']?.(_0x14f301(0x178)))tg[_0x14f301(0x180)]?.();const _0x166a3c=tg[_0x14f301(0x118)];if(_0x166a3c){_0x166a3c[_0x14f301(0x153)]();if(typeof _0x166a3c[_0x14f301(0x12e)]===_0x14f301(0x154))try{_0x166a3c[_0x14f301(0x12e)]();}catch(_0x4e604b){}_0x166a3c['onClick'](()=>{const _0x3727a6=_0x14f301;if(tg[_0x3727a6(0x159)])tg['HapticFeedback'][_0x3727a6(0x13c)]('light');location[_0x3727a6(0x18f)]=HOME_URL;});}}catch(_0x40698b){console[_0x14f301(0x143)](_0x14f301(0x13e),_0x40698b);}}(function initStableLayout(){const _0x2fe74e=a0_0x3a6ab7,_0x151e41=(function(){let _0xe1b0b7=!![];return function(_0x11ea09,_0x48c45c){const _0x58b351=_0xe1b0b7?function(){if(_0x48c45c){const _0x631c7c=_0x48c45c['apply'](_0x11ea09,arguments);return _0x48c45c=null,_0x631c7c;}}:function(){};return _0xe1b0b7=![],_0x58b351;};}()),_0x23a900=document[_0x2fe74e(0x146)](_0x2fe74e(0x141)),_0x49b0bc=document[_0x2fe74e(0x167)]('inputArea'),_0x373fab=document['getElementById'](_0x2fe74e(0x128)),_0xaca8a0=document[_0x2fe74e(0x167)](_0x2fe74e(0x164));function _0xd80070(){const _0x1f7de7=_0x2fe74e,_0x59ce7a=_0x151e41(this,function(){const _0x589891=a0_0x11f6;return _0x59ce7a[_0x589891(0x15a)]()[_0x589891(0x131)](_0x589891(0x142))[_0x589891(0x15a)]()[_0x589891(0x179)](_0x59ce7a)['search'](_0x589891(0x142));});_0x59ce7a();if(!_0x23a900)return;const _0x538235=tg&&tg[_0x1f7de7(0x182)]?tg[_0x1f7de7(0x182)]:window['innerHeight'];_0x23a900[_0x1f7de7(0x132)][_0x1f7de7(0x11a)]=_0x538235+'px';if(_0x49b0bc){const _0x4d4ec1=_0x49b0bc[_0x1f7de7(0x185)];_0x373fab[_0x1f7de7(0x132)][_0x1f7de7(0x16d)]=_0x4d4ec1+0x28+'px';}}tg?tg[_0x2fe74e(0x169)]('viewportChanged',({isStateStable:_0x38ce1f})=>{_0xd80070();if(_0x38ce1f)requestAnimationFrame(()=>{_0x373fab['scrollTop']=_0x373fab['scrollHeight'];});}):window[_0x2fe74e(0x12c)](_0x2fe74e(0x148),_0xd80070),_0xd80070(),_0xaca8a0&&(_0xaca8a0[_0x2fe74e(0x12c)](_0x2fe74e(0x137),()=>{requestAnimationFrame(_0xd80070);}),_0xaca8a0[_0x2fe74e(0x12c)](_0x2fe74e(0x113),()=>{setTimeout(()=>{const _0x5b3ed8=a0_0x11f6;_0x373fab['scrollTop']=_0x373fab[_0x5b3ed8(0x158)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3a6ab7(0x17f),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3a6ab7(0x167)](a0_0x3a6ab7(0x128)),emptyState=document['getElementById'](a0_0x3a6ab7(0x181)),messageInput=document[a0_0x3a6ab7(0x167)]('messageInput'),sendBtn=document[a0_0x3a6ab7(0x167)](a0_0x3a6ab7(0x12a)),clearBtn=document[a0_0x3a6ab7(0x167)]('clearBtn'),modal=document['getElementById'](a0_0x3a6ab7(0x171)),mTitle=document[a0_0x3a6ab7(0x167)](a0_0x3a6ab7(0x136)),mText=document[a0_0x3a6ab7(0x167)](a0_0x3a6ab7(0x165));let modalCallback=null;async function callBackend(_0x3dd77c,_0x427231){const _0x98663b=a0_0x3a6ab7,_0x552c01=tg?.[_0x98663b(0x12b)]?.[_0x98663b(0x149)]||{},_0x213dc5=_0x552c01['id']||localStorage[_0x98663b(0x15c)]('debug_uid')||'d-'+Math[_0x98663b(0x186)](Math['random']()*0x3b9aca00);if(!_0x552c01['id'])localStorage[_0x98663b(0x188)](_0x98663b(0x126),_0x213dc5);const _0x40556b={'action':_0x3dd77c,'user_id':_0x213dc5,'user_data':{'first_name':_0x552c01[_0x98663b(0x155)],'username':_0x552c01[_0x98663b(0x138)]},'init_data':tg?.[_0x98663b(0x13f)]||'',..._0x427231},_0x2195a7=new AbortController(),_0x2f78f7=setTimeout(()=>_0x2195a7['abort'](),REQUEST_TIMEOUT_MS);try{const _0x2b4e10=await fetch(BACKEND_URL,{'method':_0x98663b(0x13b),'headers':{'Content-Type':_0x98663b(0x14d)},'body':JSON[_0x98663b(0x120)](_0x40556b),'signal':_0x2195a7[_0x98663b(0x189)]});return clearTimeout(_0x2f78f7),await _0x2b4e10[_0x98663b(0x133)]();}catch(_0x41718f){return{'success':![],'error':String(_0x41718f)};}}function formatTime(_0x24ac7a){const _0x3b1333=a0_0x3a6ab7,_0x5284ae=new Date(_0x24ac7a);return String(_0x5284ae[_0x3b1333(0x17a)]())[_0x3b1333(0x152)](0x2,'0')+':'+String(_0x5284ae[_0x3b1333(0x119)]())['padStart'](0x2,'0');}function createMessageElement(_0x4baadf,_0x3a08d1){const _0x18913d=a0_0x3a6ab7,_0x140d77=document[_0x18913d(0x123)](_0x18913d(0x144));_0x140d77[_0x18913d(0x16e)]=_0x18913d(0x10f)+_0x4baadf['role'];const _0x43176f=document[_0x18913d(0x123)](_0x18913d(0x144));_0x43176f[_0x18913d(0x16e)]='message-bubble',_0x43176f[_0x18913d(0x11c)]=_0x4baadf['content'][_0x18913d(0x15f)](/\n/g,_0x18913d(0x13d));const _0x1264b2=document[_0x18913d(0x123)](_0x18913d(0x144));_0x1264b2[_0x18913d(0x16e)]=_0x18913d(0x163),_0x1264b2[_0x18913d(0x11c)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x1264b2[_0x18913d(0x17c)]=_0x4fa678=>{const _0x4cf676=_0x18913d;_0x4fa678[_0x4cf676(0x147)](),confirmDelete(_0x3a08d1);};let _0x2c80ca;_0x43176f[_0x18913d(0x12c)](_0x18913d(0x111),()=>_0x2c80ca=setTimeout(()=>{const _0x4825e3=_0x18913d;_0x140d77[_0x4825e3(0x187)][_0x4825e3(0x177)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x4825e3(0x159)]['impactOccurred'](_0x4825e3(0x166));},0x1f4)),_0x43176f[_0x18913d(0x12c)](_0x18913d(0x12d),()=>clearTimeout(_0x2c80ca));const _0x64043b=document['createElement'](_0x18913d(0x144));return _0x64043b['className']=_0x18913d(0x18d),_0x64043b['textContent']=formatTime(_0x4baadf[_0x18913d(0x18c)]),_0x140d77[_0x18913d(0x15d)](_0x1264b2),_0x140d77['appendChild'](_0x43176f),_0x140d77['appendChild'](_0x64043b),_0x140d77;}function createTypingIndicator(){const _0x1328a4=a0_0x3a6ab7,_0x4c8770=document[_0x1328a4(0x123)](_0x1328a4(0x144));return _0x4c8770[_0x1328a4(0x16e)]=_0x1328a4(0x15b),_0x4c8770['id']=_0x1328a4(0x11e),_0x4c8770[_0x1328a4(0x11c)]=_0x1328a4(0x156),_0x4c8770;}function a0_0x17cd(){const _0x5d5e5d=['disabled','sendBtn','initDataUnsafe','addEventListener','touchend','offClick','4595064fmGOLl','notificationOccurred','search','style','json','contains','Удалить?','modalTitle','input','username','key','splice','POST','impactOccurred','<br>','TG\x20setup\x20error:','initData','ready','.container','(((.+)+)+)+$','warn','div','click','querySelector','stopPropagation','resize','user','success','forEach','clear_history','text/plain','1048362bzOvaY','auto','setHeaderColor','display','padStart','show','function','first_name','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','length','scrollHeight','HapticFeedback','toString','message\x20ai','getItem','appendChild','Пустой\x20ответ','replace','from','28885270uMtWRf','Enter','delete-btn','messageInput','modalText','medium','getElementById','5HuCSWz','onEvent','1744176RaBdmg','send_message','Telegram','paddingBottom','className','ai_chat_messages','children','confirmModal','#050505','light','now','154808uPGcvd','modalCancel','add','6.1','constructor','getHours','./router.html','onclick','Ошибка\x20сервера','9vhwEnT','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','disableVerticalSwipes','emptyState','viewportHeight','382774pLLXnf','remove','offsetHeight','floor','classList','setItem','signal','WebApp','target','timestamp','message-time','removeItem','href','error','none','message\x20','querySelectorAll','touchstart','7kysYwv','focus','Ошибка\x20сети','push','Начнется\x20новый\x20диалог.','Очистить\x20историю?','BackButton','getMinutes','height','trim','innerHTML','expand','typingIndicator','keydown','stringify','textContent','min','createElement','text','value','debug_uid','4054688VKloeV','chatArea'];a0_0x17cd=function(){return _0x5d5e5d;};return a0_0x17cd();}function renderMessages(){const _0x21618a=a0_0x3a6ab7;Array[_0x21618a(0x160)](chatArea[_0x21618a(0x170)])[_0x21618a(0x14b)](_0x248e15=>{const _0xcee999=_0x21618a;if(_0x248e15['id']!==_0xcee999(0x181))_0x248e15[_0xcee999(0x184)]();}),messages['length']>0x0?(emptyState[_0x21618a(0x132)][_0x21618a(0x151)]=_0x21618a(0x10e),messages[_0x21618a(0x14b)]((_0x3ab74c,_0x25ebae)=>chatArea[_0x21618a(0x15d)](createMessageElement(_0x3ab74c,_0x25ebae)))):emptyState[_0x21618a(0x132)][_0x21618a(0x151)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x21618a(0x158)]);}function a0_0x11f6(_0xe0f325,_0x15725c){_0xe0f325=_0xe0f325-0x10d;const _0xcbb40d=a0_0x17cd();let _0x30d00b=_0xcbb40d[_0xe0f325];return _0x30d00b;}function autoResizeTextarea(){const _0x26991f=a0_0x3a6ab7;messageInput['style']['height']=_0x26991f(0x14f),messageInput['style']['height']=Math[_0x26991f(0x122)](messageInput[_0x26991f(0x158)],0x78)+'px';}function updateSendButton(){const _0x1afd55=a0_0x3a6ab7,_0x255f5b=messageInput['value'][_0x1afd55(0x11b)]();sendBtn[_0x1afd55(0x129)]=!_0x255f5b||isTyping;}async function sendMessage(){const _0x37cdd5=a0_0x3a6ab7,_0x4511b1=messageInput[_0x37cdd5(0x125)][_0x37cdd5(0x11b)]();if(!_0x4511b1||isTyping)return;if(tg?.[_0x37cdd5(0x159)])tg[_0x37cdd5(0x159)][_0x37cdd5(0x13c)](_0x37cdd5(0x173));messages[_0x37cdd5(0x115)]({'role':_0x37cdd5(0x149),'content':_0x4511b1,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x37cdd5(0x120)](messages)),renderMessages(),messageInput[_0x37cdd5(0x125)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x37cdd5(0x15d)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x37cdd5(0x158)];const _0x1cdf1c=await callBackend(_0x37cdd5(0x16b),{'message':_0x4511b1});isTyping=![];const _0x3fbcc6=document[_0x37cdd5(0x167)]('typingIndicator');if(_0x3fbcc6)_0x3fbcc6[_0x37cdd5(0x184)]();let _0x58172e=_0x37cdd5(0x114);if(_0x1cdf1c[_0x37cdd5(0x14a)]){_0x58172e=_0x1cdf1c[_0x37cdd5(0x124)]||_0x37cdd5(0x15e);if(tg?.[_0x37cdd5(0x159)])tg['HapticFeedback'][_0x37cdd5(0x130)](_0x37cdd5(0x14a));}else{_0x58172e=_0x1cdf1c[_0x37cdd5(0x10d)]||_0x37cdd5(0x17d);if(tg?.[_0x37cdd5(0x159)])tg['HapticFeedback'][_0x37cdd5(0x130)](_0x37cdd5(0x10d));}messages[_0x37cdd5(0x115)]({'role':'ai','content':_0x58172e,'timestamp':Date[_0x37cdd5(0x174)]()}),localStorage['setItem'](_0x37cdd5(0x16f),JSON[_0x37cdd5(0x120)](messages)),renderMessages();}function confirmDelete(_0x797c40){const _0x1a9f61=a0_0x3a6ab7;if(mTitle)mTitle['textContent']=_0x1a9f61(0x135);if(mText)mText[_0x1a9f61(0x121)]='Действие\x20необратимо.';modalCallback=()=>{const _0x328dd4=_0x1a9f61;messages[_0x328dd4(0x13a)](_0x797c40,0x1),localStorage[_0x328dd4(0x188)](_0x328dd4(0x16f),JSON[_0x328dd4(0x120)](messages)),renderMessages();},modal['classList'][_0x1a9f61(0x177)]('show');}if(clearBtn)clearBtn[a0_0x3a6ab7(0x17c)]=()=>{const _0x5c1405=a0_0x3a6ab7;if(!messages[_0x5c1405(0x157)])return;if(mTitle)mTitle[_0x5c1405(0x121)]=_0x5c1405(0x117);if(mText)mText['textContent']=_0x5c1405(0x116);modalCallback=async()=>{const _0x26d566=_0x5c1405;messages=[],localStorage[_0x26d566(0x18e)](_0x26d566(0x16f)),renderMessages(),callBackend(_0x26d566(0x14c),{});},modal['classList']['add'](_0x5c1405(0x153));};document[a0_0x3a6ab7(0x167)](a0_0x3a6ab7(0x176))[a0_0x3a6ab7(0x17c)]=()=>modal[a0_0x3a6ab7(0x187)]['remove']('show'),document[a0_0x3a6ab7(0x167)]('modalConfirm')[a0_0x3a6ab7(0x17c)]=()=>{const _0x48d166=a0_0x3a6ab7;if(modalCallback)modalCallback();modal[_0x48d166(0x187)][_0x48d166(0x184)](_0x48d166(0x153));},messageInput[a0_0x3a6ab7(0x12c)](a0_0x3a6ab7(0x137),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3a6ab7(0x12c)](a0_0x3a6ab7(0x11f),_0x1b2ae3=>{const _0xf859e4=a0_0x3a6ab7;_0x1b2ae3[_0xf859e4(0x139)]===_0xf859e4(0x162)&&!_0x1b2ae3['shiftKey']&&(_0x1b2ae3['preventDefault'](),sendMessage());}),sendBtn[a0_0x3a6ab7(0x17c)]=sendMessage,document[a0_0x3a6ab7(0x12c)](a0_0x3a6ab7(0x145),_0x301327=>{const _0x55b0d6=a0_0x3a6ab7;document[_0x55b0d6(0x110)]('.message.show-delete')[_0x55b0d6(0x14b)](_0x26cf80=>{const _0x638f75=_0x55b0d6;if(!_0x26cf80[_0x638f75(0x134)](_0x301327[_0x638f75(0x18b)]))_0x26cf80[_0x638f75(0x187)][_0x638f75(0x184)]('show-delete');});});const saved=localStorage[a0_0x3a6ab7(0x15c)]('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x58395f){}updateSendButton();