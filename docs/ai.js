const a0_0x2760a5=a0_0x1ca8;function a0_0x39a7(){const _0xc1d46a=['click','modalConfirm','user','Удалить?','toString','HapticFeedback','Действие\x20необратимо.','value','delete-btn','innerHeight','5331792wZfrac','show-delete','constructor','<br>','timestamp','error','POST','addEventListener','appendChild','inputArea','preventDefault','stopPropagation','apply','children','display','padStart','viewportHeight','flex','isVersionAtLeast','height','onEvent','text','188504rqdCQq','ai_chat_messages','classList','div','username','25GqRaYw','trim','setHeaderColor','send_message','from','initData','none','success','disableVerticalSwipes','typingIndicator','paddingBottom','floor','medium','offClick','notificationOccurred','6.1','Telegram','scrollHeight','replace','target','2127eeaMgz','9761110Pfsdzq','message\x20ai','resize','warn','958578zDELHy','getItem','auto','message\x20','ready','Очистить\x20историю?','innerHTML','content','remove','setItem','779468tUTSaX','stringify','expand','Enter','function','role','viewportChanged','./router.html','input','length','onclick','href','Ошибка\x20сервера','parse','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','getMinutes','initDataUnsafe','261wgpNZU','getElementById','first_name','impactOccurred','now','show','#050505','TG\x20setup\x20error:','message-bubble','Пустой\x20ответ','clearBtn','Начнется\x20новый\x20диалог.','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','add','.message.show-delete','forEach','disabled','clear_history','7IYuoXa','(((.+)+)+)+$','className','keydown','abort','140OMEIjy','createElement','json','min','touchend','contains','Ошибка\x20сети','random','search','querySelectorAll','touchstart','textContent','push','17463039dSrrlO','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','style','debug_uid','querySelector','scrollTop'];a0_0x39a7=function(){return _0xc1d46a;};return a0_0x39a7();}(function(_0x465f1e,_0x245a5e){const _0xb957b7=a0_0x1ca8,_0x5e2847=_0x465f1e();while(!![]){try{const _0x5a5e3e=-parseInt(_0xb957b7(0x1f4))/0x1*(-parseInt(_0xb957b7(0x22b))/0x2)+parseInt(_0xb957b7(0x1f9))/0x3+-parseInt(_0xb957b7(0x203))/0x4*(-parseInt(_0xb957b7(0x263))/0x5)+parseInt(_0xb957b7(0x248))/0x6*(-parseInt(_0xb957b7(0x226))/0x7)+parseInt(_0xb957b7(0x25e))/0x8*(parseInt(_0xb957b7(0x214))/0x9)+parseInt(_0xb957b7(0x1f5))/0xa+-parseInt(_0xb957b7(0x238))/0xb;if(_0x5a5e3e===_0x245a5e)break;else _0x5e2847['push'](_0x5e2847['shift']());}catch(_0x236a37){_0x5e2847['push'](_0x5e2847['shift']());}}}(a0_0x39a7,0x98d58));const tg=window[a0_0x2760a5(0x1f0)]?.['WebApp'],HOME_URL=a0_0x2760a5(0x20a);function setupTelegramBackButton(){const _0x26c8d2=a0_0x2760a5;if(!tg)return;try{tg[_0x26c8d2(0x1fd)](),tg[_0x26c8d2(0x205)](),tg[_0x26c8d2(0x265)]?.(_0x26c8d2(0x21a));if(tg[_0x26c8d2(0x25a)]?.(_0x26c8d2(0x1ef)))tg[_0x26c8d2(0x1e8)]?.();const _0x3c4149=tg['BackButton'];if(_0x3c4149){_0x3c4149[_0x26c8d2(0x219)]();if(typeof _0x3c4149['offClick']===_0x26c8d2(0x207))try{_0x3c4149[_0x26c8d2(0x1ed)]();}catch(_0x594d34){}_0x3c4149['onClick'](()=>{const _0x1220d6=_0x26c8d2;if(tg[_0x1220d6(0x243)])tg['HapticFeedback'][_0x1220d6(0x217)]('light');location[_0x1220d6(0x20e)]=HOME_URL;});}}catch(_0x1cbaec){console[_0x26c8d2(0x1f8)](_0x26c8d2(0x21b),_0x1cbaec);}}(function initStableLayout(){const _0x86d45f=a0_0x2760a5,_0x275a28=(function(){let _0x538535=!![];return function(_0x19cbc9,_0x2ba65c){const _0x4aed6d=_0x538535?function(){const _0x28901a=a0_0x1ca8;if(_0x2ba65c){const _0x2e1b28=_0x2ba65c[_0x28901a(0x254)](_0x19cbc9,arguments);return _0x2ba65c=null,_0x2e1b28;}}:function(){};return _0x538535=![],_0x4aed6d;};}()),_0x25194e=document[_0x86d45f(0x23c)]('.container'),_0x5b5db1=document[_0x86d45f(0x215)](_0x86d45f(0x251)),_0x509150=document[_0x86d45f(0x215)]('chatArea'),_0x26fa97=document[_0x86d45f(0x215)]('messageInput');function _0x8e20cf(){const _0x5cc547=_0x86d45f,_0x171763=_0x275a28(this,function(){const _0x2d0a02=a0_0x1ca8;return _0x171763[_0x2d0a02(0x242)]()['search'](_0x2d0a02(0x227))[_0x2d0a02(0x242)]()[_0x2d0a02(0x24a)](_0x171763)[_0x2d0a02(0x233)](_0x2d0a02(0x227));});_0x171763();if(!_0x25194e)return;const _0x4d611b=tg&&tg[_0x5cc547(0x258)]?tg[_0x5cc547(0x258)]:window[_0x5cc547(0x247)];_0x25194e['style']['height']=_0x4d611b+'px';if(_0x5b5db1){const _0x7c7fe4=_0x5b5db1['offsetHeight'];_0x509150[_0x5cc547(0x23a)][_0x5cc547(0x1ea)]=_0x7c7fe4+0x28+'px';}}tg?tg[_0x86d45f(0x25c)](_0x86d45f(0x209),({isStateStable:_0x280979})=>{_0x8e20cf();if(_0x280979)requestAnimationFrame(()=>{const _0x3d615b=a0_0x1ca8;_0x509150[_0x3d615b(0x23d)]=_0x509150[_0x3d615b(0x1f1)];});}):window[_0x86d45f(0x24f)](_0x86d45f(0x1f7),_0x8e20cf),_0x8e20cf(),_0x26fa97&&(_0x26fa97[_0x86d45f(0x24f)](_0x86d45f(0x20b),()=>{requestAnimationFrame(_0x8e20cf);}),_0x26fa97[_0x86d45f(0x24f)]('focus',()=>{setTimeout(()=>{const _0x1e49c7=a0_0x1ca8;_0x509150[_0x1e49c7(0x23d)]=_0x509150[_0x1e49c7(0x1f1)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2760a5(0x239),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x1ca8(_0x1183fb,_0x960358){_0x1183fb=_0x1183fb-0x1e6;const _0x60cb8c=a0_0x39a7();let _0x419c1d=_0x60cb8c[_0x1183fb];return _0x419c1d;}let messages=[],isTyping=![];const chatArea=document[a0_0x2760a5(0x215)]('chatArea'),emptyState=document[a0_0x2760a5(0x215)]('emptyState'),messageInput=document[a0_0x2760a5(0x215)]('messageInput'),sendBtn=document[a0_0x2760a5(0x215)]('sendBtn'),clearBtn=document['getElementById'](a0_0x2760a5(0x21e)),modal=document[a0_0x2760a5(0x215)]('confirmModal'),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x2760a5(0x215)]('modalText');let modalCallback=null;async function callBackend(_0x541782,_0x3f281a){const _0x2c0864=a0_0x2760a5,_0x182125=tg?.[_0x2c0864(0x213)]?.[_0x2c0864(0x240)]||{},_0x2c3966=_0x182125['id']||localStorage[_0x2c0864(0x1fa)](_0x2c0864(0x23b))||'d-'+Math[_0x2c0864(0x1eb)](Math[_0x2c0864(0x232)]()*0x3b9aca00);if(!_0x182125['id'])localStorage[_0x2c0864(0x202)](_0x2c0864(0x23b),_0x2c3966);const _0x2492fb={'action':_0x541782,'user_id':_0x2c3966,'user_data':{'first_name':_0x182125[_0x2c0864(0x216)],'username':_0x182125[_0x2c0864(0x262)]},'init_data':tg?.[_0x2c0864(0x268)]||'',..._0x3f281a},_0x1f6593=new AbortController(),_0x245f39=setTimeout(()=>_0x1f6593[_0x2c0864(0x22a)](),REQUEST_TIMEOUT_MS);try{const _0x17e4bd=await fetch(BACKEND_URL,{'method':_0x2c0864(0x24e),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x2c0864(0x204)](_0x2492fb),'signal':_0x1f6593['signal']});return clearTimeout(_0x245f39),await _0x17e4bd[_0x2c0864(0x22d)]();}catch(_0x5f3adc){return{'success':![],'error':String(_0x5f3adc)};}}function formatTime(_0x37d927){const _0x5e03a8=a0_0x2760a5,_0xa0257b=new Date(_0x37d927);return String(_0xa0257b['getHours']())[_0x5e03a8(0x257)](0x2,'0')+':'+String(_0xa0257b[_0x5e03a8(0x212)]())[_0x5e03a8(0x257)](0x2,'0');}function createMessageElement(_0x4afeee,_0x1dbd81){const _0x1e6edc=a0_0x2760a5,_0x2f59c5=document['createElement']('div');_0x2f59c5[_0x1e6edc(0x228)]=_0x1e6edc(0x1fc)+_0x4afeee[_0x1e6edc(0x208)];const _0x37fea5=document[_0x1e6edc(0x22c)](_0x1e6edc(0x261));_0x37fea5['className']=_0x1e6edc(0x21c),_0x37fea5[_0x1e6edc(0x1ff)]=_0x4afeee[_0x1e6edc(0x200)][_0x1e6edc(0x1f2)](/\n/g,_0x1e6edc(0x24b));const _0x2a8109=document[_0x1e6edc(0x22c)](_0x1e6edc(0x261));_0x2a8109[_0x1e6edc(0x228)]=_0x1e6edc(0x246),_0x2a8109[_0x1e6edc(0x1ff)]=_0x1e6edc(0x211),_0x2a8109['onclick']=_0x4890dc=>{const _0x294c22=_0x1e6edc;_0x4890dc[_0x294c22(0x253)](),confirmDelete(_0x1dbd81);};let _0x5dc5b1;_0x37fea5[_0x1e6edc(0x24f)](_0x1e6edc(0x235),()=>_0x5dc5b1=setTimeout(()=>{const _0x5a534b=_0x1e6edc;_0x2f59c5[_0x5a534b(0x260)][_0x5a534b(0x221)](_0x5a534b(0x249));if(tg?.[_0x5a534b(0x243)])tg['HapticFeedback'][_0x5a534b(0x217)](_0x5a534b(0x1ec));},0x1f4)),_0x37fea5[_0x1e6edc(0x24f)](_0x1e6edc(0x22f),()=>clearTimeout(_0x5dc5b1));const _0x5069c8=document['createElement'](_0x1e6edc(0x261));return _0x5069c8[_0x1e6edc(0x228)]='message-time',_0x5069c8['textContent']=formatTime(_0x4afeee[_0x1e6edc(0x24c)]),_0x2f59c5['appendChild'](_0x2a8109),_0x2f59c5[_0x1e6edc(0x250)](_0x37fea5),_0x2f59c5[_0x1e6edc(0x250)](_0x5069c8),_0x2f59c5;}function createTypingIndicator(){const _0x32aadf=a0_0x2760a5,_0x52832d=document[_0x32aadf(0x22c)](_0x32aadf(0x261));return _0x52832d['className']=_0x32aadf(0x1f6),_0x52832d['id']=_0x32aadf(0x1e9),_0x52832d[_0x32aadf(0x1ff)]=_0x32aadf(0x220),_0x52832d;}function renderMessages(){const _0xdf0233=a0_0x2760a5;Array[_0xdf0233(0x267)](chatArea[_0xdf0233(0x255)])[_0xdf0233(0x223)](_0x4f3e77=>{const _0x230ab4=_0xdf0233;if(_0x4f3e77['id']!=='emptyState')_0x4f3e77[_0x230ab4(0x201)]();}),messages[_0xdf0233(0x20c)]>0x0?(emptyState[_0xdf0233(0x23a)][_0xdf0233(0x256)]=_0xdf0233(0x1e6),messages[_0xdf0233(0x223)]((_0x680eeb,_0x1e665f)=>chatArea[_0xdf0233(0x250)](createMessageElement(_0x680eeb,_0x1e665f)))):emptyState[_0xdf0233(0x23a)][_0xdf0233(0x256)]=_0xdf0233(0x259),requestAnimationFrame(()=>chatArea[_0xdf0233(0x23d)]=chatArea[_0xdf0233(0x1f1)]);}function autoResizeTextarea(){const _0x1a8c20=a0_0x2760a5;messageInput[_0x1a8c20(0x23a)][_0x1a8c20(0x25b)]=_0x1a8c20(0x1fb),messageInput['style']['height']=Math[_0x1a8c20(0x22e)](messageInput[_0x1a8c20(0x1f1)],0x78)+'px';}function updateSendButton(){const _0x4b6cd0=a0_0x2760a5,_0x4c50ec=messageInput['value']['trim']();sendBtn[_0x4b6cd0(0x224)]=!_0x4c50ec||isTyping;}async function sendMessage(){const _0x5ef1b1=a0_0x2760a5,_0x2fd9a4=messageInput['value'][_0x5ef1b1(0x264)]();if(!_0x2fd9a4||isTyping)return;if(tg?.[_0x5ef1b1(0x243)])tg[_0x5ef1b1(0x243)]['impactOccurred']('light');messages['push']({'role':_0x5ef1b1(0x240),'content':_0x2fd9a4,'timestamp':Date[_0x5ef1b1(0x218)]()}),localStorage[_0x5ef1b1(0x202)](_0x5ef1b1(0x25f),JSON[_0x5ef1b1(0x204)](messages)),renderMessages(),messageInput[_0x5ef1b1(0x245)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5ef1b1(0x250)](createTypingIndicator()),chatArea[_0x5ef1b1(0x23d)]=chatArea['scrollHeight'];const _0x415435=await callBackend(_0x5ef1b1(0x266),{'message':_0x2fd9a4});isTyping=![];const _0x4a3071=document[_0x5ef1b1(0x215)]('typingIndicator');if(_0x4a3071)_0x4a3071[_0x5ef1b1(0x201)]();let _0x4559b3=_0x5ef1b1(0x231);if(_0x415435[_0x5ef1b1(0x1e7)]){_0x4559b3=_0x415435[_0x5ef1b1(0x25d)]||_0x5ef1b1(0x21d);if(tg?.[_0x5ef1b1(0x243)])tg['HapticFeedback'][_0x5ef1b1(0x1ee)]('success');}else{_0x4559b3=_0x415435['error']||_0x5ef1b1(0x20f);if(tg?.['HapticFeedback'])tg[_0x5ef1b1(0x243)][_0x5ef1b1(0x1ee)](_0x5ef1b1(0x24d));}messages[_0x5ef1b1(0x237)]({'role':'ai','content':_0x4559b3,'timestamp':Date[_0x5ef1b1(0x218)]()}),localStorage['setItem'](_0x5ef1b1(0x25f),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x5c9e8e){const _0x5a1053=a0_0x2760a5;if(mTitle)mTitle[_0x5a1053(0x236)]=_0x5a1053(0x241);if(mText)mText[_0x5a1053(0x236)]=_0x5a1053(0x244);modalCallback=()=>{const _0x312c3e=_0x5a1053;messages['splice'](_0x5c9e8e,0x1),localStorage['setItem'](_0x312c3e(0x25f),JSON[_0x312c3e(0x204)](messages)),renderMessages();},modal['classList'][_0x5a1053(0x221)](_0x5a1053(0x219));}if(clearBtn)clearBtn[a0_0x2760a5(0x20d)]=()=>{const _0x238a08=a0_0x2760a5;if(!messages[_0x238a08(0x20c)])return;if(mTitle)mTitle['textContent']=_0x238a08(0x1fe);if(mText)mText[_0x238a08(0x236)]=_0x238a08(0x21f);modalCallback=async()=>{const _0x4f3137=_0x238a08;messages=[],localStorage['removeItem'](_0x4f3137(0x25f)),renderMessages(),callBackend(_0x4f3137(0x225),{});},modal[_0x238a08(0x260)][_0x238a08(0x221)](_0x238a08(0x219));};document['getElementById']('modalCancel')[a0_0x2760a5(0x20d)]=()=>modal[a0_0x2760a5(0x260)]['remove'](a0_0x2760a5(0x219)),document[a0_0x2760a5(0x215)](a0_0x2760a5(0x23f))[a0_0x2760a5(0x20d)]=()=>{const _0x3f187a=a0_0x2760a5;if(modalCallback)modalCallback();modal[_0x3f187a(0x260)]['remove']('show');},messageInput[a0_0x2760a5(0x24f)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2760a5(0x24f)](a0_0x2760a5(0x229),_0x3b8ebd=>{const _0x5ba88f=a0_0x2760a5;_0x3b8ebd['key']===_0x5ba88f(0x206)&&!_0x3b8ebd['shiftKey']&&(_0x3b8ebd[_0x5ba88f(0x252)](),sendMessage());}),sendBtn[a0_0x2760a5(0x20d)]=sendMessage,document[a0_0x2760a5(0x24f)](a0_0x2760a5(0x23e),_0x2855cb=>{const _0x3f6213=a0_0x2760a5;document[_0x3f6213(0x234)](_0x3f6213(0x222))['forEach'](_0x3c1af8=>{const _0x2beb5d=_0x3f6213;if(!_0x3c1af8[_0x2beb5d(0x230)](_0x2855cb[_0x2beb5d(0x1f3)]))_0x3c1af8['classList']['remove']('show-delete');});});const saved=localStorage['getItem'](a0_0x2760a5(0x25f));if(saved)try{messages=JSON[a0_0x2760a5(0x210)](saved),renderMessages();}catch(a0_0x5ac878){}updateSendButton();