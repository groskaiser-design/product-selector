const a0_0x451a6a=a0_0x5334;(function(_0x5245a8,_0x1067d9){const _0x48cdae=a0_0x5334,_0x496eb9=_0x5245a8();while(!![]){try{const _0x5bab09=parseInt(_0x48cdae(0x1da))/0x1*(-parseInt(_0x48cdae(0x1ba))/0x2)+parseInt(_0x48cdae(0x1bb))/0x3*(-parseInt(_0x48cdae(0x1d1))/0x4)+parseInt(_0x48cdae(0x1b2))/0x5*(parseInt(_0x48cdae(0x1e8))/0x6)+parseInt(_0x48cdae(0x225))/0x7+-parseInt(_0x48cdae(0x228))/0x8*(-parseInt(_0x48cdae(0x209))/0x9)+parseInt(_0x48cdae(0x1ad))/0xa+-parseInt(_0x48cdae(0x1d0))/0xb*(parseInt(_0x48cdae(0x1de))/0xc);if(_0x5bab09===_0x1067d9)break;else _0x496eb9['push'](_0x496eb9['shift']());}catch(_0x21ee83){_0x496eb9['push'](_0x496eb9['shift']());}}}(a0_0x1d81,0x3e078));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x451a6a(0x208);function setupTelegramBackButton(){const _0xa12f67=a0_0x451a6a;if(!tg)return;try{tg[_0xa12f67(0x203)](),tg[_0xa12f67(0x1b4)](),tg['setHeaderColor']?.(_0xa12f67(0x224));if(tg[_0xa12f67(0x1b7)]?.(_0xa12f67(0x1b8)))tg[_0xa12f67(0x206)]?.();const _0x182be0=tg[_0xa12f67(0x221)];if(_0x182be0){_0x182be0[_0xa12f67(0x1c9)]();if(typeof _0x182be0[_0xa12f67(0x201)]===_0xa12f67(0x1cb))try{_0x182be0[_0xa12f67(0x201)]();}catch(_0x3736a0){}_0x182be0[_0xa12f67(0x1ff)](()=>{const _0x227571=_0xa12f67;if(tg[_0x227571(0x20b)])tg[_0x227571(0x20b)][_0x227571(0x1ee)](_0x227571(0x1ce));location[_0x227571(0x1e5)]=HOME_URL;});}}catch(_0x513237){console[_0xa12f67(0x227)](_0xa12f67(0x1fd),_0x513237);}}(function initStableLayout(){const _0x368aa6=a0_0x451a6a,_0x45cc57=(function(){let _0x4d1d5b=!![];return function(_0xb6f2d,_0x2fc2ed){const _0x162d06=_0x4d1d5b?function(){const _0x55fd2e=a0_0x5334;if(_0x2fc2ed){const _0x482acb=_0x2fc2ed[_0x55fd2e(0x1dd)](_0xb6f2d,arguments);return _0x2fc2ed=null,_0x482acb;}}:function(){};return _0x4d1d5b=![],_0x162d06;};}()),_0x19f9c0=document[_0x368aa6(0x21f)]('.container'),_0x1a81fd=document[_0x368aa6(0x20f)](_0x368aa6(0x1c6)),_0x335624=document[_0x368aa6(0x20f)](_0x368aa6(0x1e9)),_0x57cf42=document[_0x368aa6(0x20f)](_0x368aa6(0x1bc));function _0x5bb002(){const _0x453ac3=_0x368aa6,_0xeea056=_0x45cc57(this,function(){const _0x2ff2a5=a0_0x5334;return _0xeea056['toString']()['search'](_0x2ff2a5(0x1cc))['toString']()[_0x2ff2a5(0x223)](_0xeea056)['search'](_0x2ff2a5(0x1cc));});_0xeea056();if(!_0x19f9c0)return;const _0x426dd9=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x453ac3(0x217)];_0x19f9c0['style'][_0x453ac3(0x1d2)]=_0x426dd9+'px';if(_0x1a81fd){const _0x14820a=_0x1a81fd[_0x453ac3(0x20c)];_0x335624[_0x453ac3(0x1b9)][_0x453ac3(0x1d3)]=_0x14820a+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x35db1f})=>{_0x5bb002();if(_0x35db1f)requestAnimationFrame(()=>{const _0x55d1c2=a0_0x5334;_0x335624[_0x55d1c2(0x1ea)]=_0x335624['scrollHeight'];});}):window[_0x368aa6(0x1df)]('resize',_0x5bb002),_0x5bb002(),_0x57cf42&&(_0x57cf42[_0x368aa6(0x1df)]('input',()=>{requestAnimationFrame(_0x5bb002);}),_0x57cf42[_0x368aa6(0x1df)](_0x368aa6(0x219),()=>{setTimeout(()=>{const _0x13796c=a0_0x5334;_0x335624[_0x13796c(0x1ea)]=_0x335624[_0x13796c(0x216)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x451a6a(0x1e9)),emptyState=document[a0_0x451a6a(0x20f)](a0_0x451a6a(0x1dc)),messageInput=document['getElementById'](a0_0x451a6a(0x1bc)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x451a6a(0x20f)]('clearBtn'),modal=document[a0_0x451a6a(0x20f)]('confirmModal'),mTitle=document[a0_0x451a6a(0x20f)](a0_0x451a6a(0x1e6)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x49980b,_0x38bacf){const _0x3d693f=a0_0x451a6a,_0x4db162=tg?.[_0x3d693f(0x1c5)]?.[_0x3d693f(0x1e3)]||{},_0x24bc01=_0x4db162['id']||localStorage[_0x3d693f(0x1bd)](_0x3d693f(0x1bf))||'d-'+Math[_0x3d693f(0x1f3)](Math[_0x3d693f(0x210)]()*0x3b9aca00);if(!_0x4db162['id'])localStorage['setItem']('debug_uid',_0x24bc01);const _0x410a47={'action':_0x49980b,'user_id':_0x24bc01,'user_data':{'first_name':_0x4db162[_0x3d693f(0x1d8)],'username':_0x4db162[_0x3d693f(0x222)]},'init_data':tg?.[_0x3d693f(0x1d9)]||'',..._0x38bacf},_0x5e113b=new AbortController(),_0x247c23=setTimeout(()=>_0x5e113b[_0x3d693f(0x1f7)](),REQUEST_TIMEOUT_MS);try{const _0x7aa659=await fetch(BACKEND_URL,{'method':_0x3d693f(0x21b),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x410a47),'signal':_0x5e113b[_0x3d693f(0x1f0)]});return clearTimeout(_0x247c23),await _0x7aa659[_0x3d693f(0x20a)]();}catch(_0x1e4f53){return{'success':![],'error':String(_0x1e4f53)};}}function formatTime(_0x2b272a){const _0x2c85ff=a0_0x451a6a,_0x1addab=new Date(_0x2b272a);return String(_0x1addab[_0x2c85ff(0x1b0)]())['padStart'](0x2,'0')+':'+String(_0x1addab[_0x2c85ff(0x1e0)]())[_0x2c85ff(0x1eb)](0x2,'0');}function createMessageElement(_0x34a664,_0x557f62){const _0x5470ef=a0_0x451a6a,_0x1b06aa=document[_0x5470ef(0x211)]('div');_0x1b06aa[_0x5470ef(0x1c0)]=_0x5470ef(0x207)+_0x34a664[_0x5470ef(0x21c)];const _0x5d46b2=document['createElement']('div');_0x5d46b2[_0x5470ef(0x1c0)]='message-bubble',_0x5d46b2[_0x5470ef(0x1cf)]=_0x34a664[_0x5470ef(0x220)][_0x5470ef(0x1ed)](/\n/g,'<br>');const _0x55418f=document[_0x5470ef(0x211)](_0x5470ef(0x1fc));_0x55418f[_0x5470ef(0x1c0)]=_0x5470ef(0x1b6),_0x55418f[_0x5470ef(0x1cf)]=_0x5470ef(0x204),_0x55418f[_0x5470ef(0x1c1)]=_0x1aa406=>{_0x1aa406['stopPropagation'](),confirmDelete(_0x557f62);};let _0x565742;_0x5d46b2[_0x5470ef(0x1df)](_0x5470ef(0x1f9),()=>_0x565742=setTimeout(()=>{const _0x419ce2=_0x5470ef;_0x1b06aa['classList'][_0x419ce2(0x1b1)](_0x419ce2(0x218));if(tg?.['HapticFeedback'])tg[_0x419ce2(0x20b)]['impactOccurred'](_0x419ce2(0x1cd));},0x1f4)),_0x5d46b2['addEventListener'](_0x5470ef(0x226),()=>clearTimeout(_0x565742));const _0x1a8c24=document[_0x5470ef(0x211)](_0x5470ef(0x1fc));return _0x1a8c24['className']=_0x5470ef(0x1ec),_0x1a8c24[_0x5470ef(0x202)]=formatTime(_0x34a664[_0x5470ef(0x1b5)]),_0x1b06aa[_0x5470ef(0x1f1)](_0x55418f),_0x1b06aa[_0x5470ef(0x1f1)](_0x5d46b2),_0x1b06aa[_0x5470ef(0x1f1)](_0x1a8c24),_0x1b06aa;}function a0_0x5334(_0x240efc,_0xfc33ed){_0x240efc=_0x240efc-0x1ad;const _0x2f5664=a0_0x1d81();let _0x559af3=_0x2f5664[_0x240efc];return _0x559af3;}function a0_0x1d81(){const _0x3ac3ea=['username','constructor','#050505','806351IGsssV','touchend','warn','32HUWKwq','3460250WFoYcr','Ошибка\x20сервера','input','getHours','add','2083335YqJENh','click','expand','timestamp','delete-btn','isVersionAtLeast','6.1','style','190VdaKrS','3RLKjXC','messageInput','getItem','from','debug_uid','className','onclick','display','flex','Действие\x20необратимо.','initDataUnsafe','inputArea','keydown','remove','show','querySelectorAll','function','(((.+)+)+)+$','medium','light','innerHTML','4143271xIzGso','85664tAmXUn','height','paddingBottom','parse','notificationOccurred','ai_chat_messages','Очистить\x20историю?','first_name','initData','2500ZJoaZJ','message\x20ai','emptyState','apply','12UbGsUC','addEventListener','getMinutes','stringify','disabled','user','Пустой\x20ответ','href','modalTitle','modalConfirm','6rhccaP','chatArea','scrollTop','padStart','message-time','replace','impactOccurred','send_message','signal','appendChild','trim','floor','value','contains','forEach','abort','.message.show-delete','touchstart','setItem','now','div','TG\x20setup\x20error:','length','onClick','push','offClick','textContent','ready','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Начнется\x20новый\x20диалог.','disableVerticalSwipes','message\x20','./router.html','26469aVHsIU','json','HapticFeedback','offsetHeight','shiftKey','key','getElementById','random','createElement','typingIndicator','Enter','clear_history','error','scrollHeight','innerHeight','show-delete','focus','success','POST','role','classList','min','querySelector','content','BackButton'];a0_0x1d81=function(){return _0x3ac3ea;};return a0_0x1d81();}function createTypingIndicator(){const _0x4a708e=a0_0x451a6a,_0x53ddde=document[_0x4a708e(0x211)](_0x4a708e(0x1fc));return _0x53ddde[_0x4a708e(0x1c0)]=_0x4a708e(0x1db),_0x53ddde['id']=_0x4a708e(0x212),_0x53ddde[_0x4a708e(0x1cf)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x53ddde;}function renderMessages(){const _0x4e995b=a0_0x451a6a;Array[_0x4e995b(0x1be)](chatArea['children'])[_0x4e995b(0x1f6)](_0x8add2f=>{const _0x5a3690=_0x4e995b;if(_0x8add2f['id']!==_0x5a3690(0x1dc))_0x8add2f[_0x5a3690(0x1c8)]();}),messages[_0x4e995b(0x1fe)]>0x0?(emptyState['style']['display']='none',messages[_0x4e995b(0x1f6)]((_0x119cbb,_0x246c57)=>chatArea[_0x4e995b(0x1f1)](createMessageElement(_0x119cbb,_0x246c57)))):emptyState[_0x4e995b(0x1b9)][_0x4e995b(0x1c2)]=_0x4e995b(0x1c3),requestAnimationFrame(()=>chatArea[_0x4e995b(0x1ea)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x1f9b35=a0_0x451a6a;messageInput['style']['height']='auto',messageInput[_0x1f9b35(0x1b9)][_0x1f9b35(0x1d2)]=Math[_0x1f9b35(0x21e)](messageInput[_0x1f9b35(0x216)],0x78)+'px';}function updateSendButton(){const _0x37e964=a0_0x451a6a,_0x2042fc=messageInput[_0x37e964(0x1f4)][_0x37e964(0x1f2)]();sendBtn[_0x37e964(0x1e2)]=!_0x2042fc||isTyping;}async function sendMessage(){const _0x3c9c42=a0_0x451a6a,_0x42c436=messageInput[_0x3c9c42(0x1f4)][_0x3c9c42(0x1f2)]();if(!_0x42c436||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x3c9c42(0x20b)]['impactOccurred']('light');messages[_0x3c9c42(0x200)]({'role':_0x3c9c42(0x1e3),'content':_0x42c436,'timestamp':Date[_0x3c9c42(0x1fb)]()}),localStorage[_0x3c9c42(0x1fa)](_0x3c9c42(0x1d6),JSON[_0x3c9c42(0x1e1)](messages)),renderMessages(),messageInput[_0x3c9c42(0x1f4)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x35989c=await callBackend(_0x3c9c42(0x1ef),{'message':_0x42c436});isTyping=![];const _0x2d51ad=document[_0x3c9c42(0x20f)]('typingIndicator');if(_0x2d51ad)_0x2d51ad['remove']();let _0x1023d0='Ошибка\x20сети';if(_0x35989c[_0x3c9c42(0x21a)]){_0x1023d0=_0x35989c['text']||_0x3c9c42(0x1e4);if(tg?.[_0x3c9c42(0x20b)])tg[_0x3c9c42(0x20b)][_0x3c9c42(0x1d5)](_0x3c9c42(0x21a));}else{_0x1023d0=_0x35989c[_0x3c9c42(0x215)]||_0x3c9c42(0x1ae);if(tg?.[_0x3c9c42(0x20b)])tg[_0x3c9c42(0x20b)]['notificationOccurred']('error');}messages[_0x3c9c42(0x200)]({'role':'ai','content':_0x1023d0,'timestamp':Date[_0x3c9c42(0x1fb)]()}),localStorage[_0x3c9c42(0x1fa)](_0x3c9c42(0x1d6),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x56f5f1){const _0x2c2ebd=a0_0x451a6a;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText['textContent']=_0x2c2ebd(0x1c4);modalCallback=()=>{const _0x547d05=_0x2c2ebd;messages['splice'](_0x56f5f1,0x1),localStorage[_0x547d05(0x1fa)](_0x547d05(0x1d6),JSON[_0x547d05(0x1e1)](messages)),renderMessages();},modal[_0x2c2ebd(0x21d)][_0x2c2ebd(0x1b1)](_0x2c2ebd(0x1c9));}if(clearBtn)clearBtn['onclick']=()=>{const _0x121570=a0_0x451a6a;if(!messages[_0x121570(0x1fe)])return;if(mTitle)mTitle[_0x121570(0x202)]=_0x121570(0x1d7);if(mText)mText[_0x121570(0x202)]=_0x121570(0x205);modalCallback=async()=>{const _0x2df4bd=_0x121570;messages=[],localStorage['removeItem'](_0x2df4bd(0x1d6)),renderMessages(),callBackend(_0x2df4bd(0x214),{});},modal[_0x121570(0x21d)][_0x121570(0x1b1)](_0x121570(0x1c9));};document[a0_0x451a6a(0x20f)]('modalCancel')[a0_0x451a6a(0x1c1)]=()=>modal[a0_0x451a6a(0x21d)][a0_0x451a6a(0x1c8)](a0_0x451a6a(0x1c9)),document[a0_0x451a6a(0x20f)](a0_0x451a6a(0x1e7))['onclick']=()=>{const _0x286137=a0_0x451a6a;if(modalCallback)modalCallback();modal['classList'][_0x286137(0x1c8)](_0x286137(0x1c9));},messageInput[a0_0x451a6a(0x1df)](a0_0x451a6a(0x1af),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x451a6a(0x1df)](a0_0x451a6a(0x1c7),_0x10b1bc=>{const _0x193dfb=a0_0x451a6a;_0x10b1bc[_0x193dfb(0x20e)]===_0x193dfb(0x213)&&!_0x10b1bc[_0x193dfb(0x20d)]&&(_0x10b1bc['preventDefault'](),sendMessage());}),sendBtn[a0_0x451a6a(0x1c1)]=sendMessage,document[a0_0x451a6a(0x1df)](a0_0x451a6a(0x1b3),_0x1f9636=>{const _0x2a573b=a0_0x451a6a;document[_0x2a573b(0x1ca)](_0x2a573b(0x1f8))[_0x2a573b(0x1f6)](_0x5f4160=>{const _0x265b86=_0x2a573b;if(!_0x5f4160[_0x265b86(0x1f5)](_0x1f9636['target']))_0x5f4160['classList'][_0x265b86(0x1c8)](_0x265b86(0x218));});});const saved=localStorage[a0_0x451a6a(0x1bd)](a0_0x451a6a(0x1d6));if(saved)try{messages=JSON[a0_0x451a6a(0x1d4)](saved),renderMessages();}catch(a0_0x382752){}updateSendButton();