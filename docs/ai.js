const a0_0x43112b=a0_0x5d42;function a0_0x2059(){const _0x16a380=['debug_uid','BackButton','querySelectorAll','delete-btn','impactOccurred','notificationOccurred','clear_history','offsetHeight','medium','modalCancel','user','signal','ready','min','input','innerHTML','success','paddingBottom','Пустой\x20ответ','parse','resize','.container','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','target','<br>','30fYWWzz','message-time','3DQVOZH','padStart','initData','setItem','getHours','light','viewportChanged','touchstart','Ошибка\x20сервера','getElementById','height','POST','createElement','#050505','message\x20ai','scrollHeight','disableVerticalSwipes','isVersionAtLeast','div','text','textContent','key','style','floor','href','function','(((.+)+)+)+$','setHeaderColor','stringify','splice','classList','Telegram','apply','chatArea','first_name','33ShBJwx','sendBtn','59181252KMEkiw','typingIndicator','modalConfirm','appendChild','132195pVQhYq','initDataUnsafe','search','innerHeight','86294ymwWdV','push','onEvent','Начнется\x20новый\x20диалог.','remove','Ошибка\x20сети','Enter','role','offClick','send_message','focus','TG\x20setup\x20error:','WebApp','warn','add','username','11391567YgipJx','show-delete','contains','emptyState','timestamp','Очистить\x20историю?','632qzEYSc','confirmModal','message-bubble','toString','expand','error','modalText','display','scrollTop','.message.show-delete','constructor','auto','addEventListener','flex','from','show','172025zKIDUe','1332248FETLVk','viewportHeight','3327102EzqPoN','ai_chat_messages','forEach','Удалить?','className','messageInput','trim','value','HapticFeedback','length','stopPropagation','onclick','random','10xWfGyh','replace','now','preventDefault','getItem','getMinutes'];a0_0x2059=function(){return _0x16a380;};return a0_0x2059();}(function(_0x2e37b2,_0x3f08f0){const _0x388aea=a0_0x5d42,_0x12ad49=_0x2e37b2();while(!![]){try{const _0x5634ec=-parseInt(_0x388aea(0x14b))/0x1*(parseInt(_0x388aea(0x155))/0x2)+parseInt(_0x388aea(0x1ac))/0x3*(-parseInt(_0x388aea(0x17c))/0x4)+parseInt(_0x388aea(0x17b))/0x5*(-parseInt(_0x388aea(0x1aa))/0x6)+parseInt(_0x388aea(0x151))/0x7*(-parseInt(_0x388aea(0x16b))/0x8)+parseInt(_0x388aea(0x17e))/0x9+-parseInt(_0x388aea(0x18b))/0xa*(parseInt(_0x388aea(0x165))/0xb)+parseInt(_0x388aea(0x14d))/0xc;if(_0x5634ec===_0x3f08f0)break;else _0x12ad49['push'](_0x12ad49['shift']());}catch(_0x15f2f2){_0x12ad49['push'](_0x12ad49['shift']());}}}(a0_0x2059,0xce4c7));const tg=window[a0_0x43112b(0x147)]?.[a0_0x43112b(0x161)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x5fad29=a0_0x43112b;if(!tg)return;try{tg[_0x5fad29(0x19d)](),tg[_0x5fad29(0x16f)](),tg[_0x5fad29(0x143)]?.(_0x5fad29(0x1b9));if(tg[_0x5fad29(0x1bd)]?.('6.1'))tg[_0x5fad29(0x1bc)]?.();const _0x7c5cc4=tg[_0x5fad29(0x192)];if(_0x7c5cc4){_0x7c5cc4[_0x5fad29(0x17a)]();if(typeof _0x7c5cc4[_0x5fad29(0x15d)]===_0x5fad29(0x1c5))try{_0x7c5cc4['offClick']();}catch(_0x5524ef){}_0x7c5cc4['onClick'](()=>{const _0x58b776=_0x5fad29;if(tg[_0x58b776(0x186)])tg[_0x58b776(0x186)]['impactOccurred']('light');location[_0x58b776(0x1c4)]=HOME_URL;});}}catch(_0x542503){console[_0x5fad29(0x162)](_0x5fad29(0x160),_0x542503);}}(function initStableLayout(){const _0x3d3968=a0_0x43112b,_0x102705=(function(){let _0x251718=!![];return function(_0x7e0d5c,_0x1b4a99){const _0x4d7c5c=_0x251718?function(){const _0xe9936a=a0_0x5d42;if(_0x1b4a99){const _0x2d9d7a=_0x1b4a99[_0xe9936a(0x148)](_0x7e0d5c,arguments);return _0x1b4a99=null,_0x2d9d7a;}}:function(){};return _0x251718=![],_0x4d7c5c;};}()),_0x50c9b3=document['querySelector'](_0x3d3968(0x1a6)),_0x5f566f=document[_0x3d3968(0x1b5)]('inputArea'),_0x444915=document['getElementById'](_0x3d3968(0x149)),_0x459dee=document[_0x3d3968(0x1b5)](_0x3d3968(0x183));function _0xf76191(){const _0x5249c7=_0x3d3968,_0x4221c6=_0x102705(this,function(){const _0x46c782=a0_0x5d42;return _0x4221c6[_0x46c782(0x16e)]()[_0x46c782(0x153)](_0x46c782(0x142))[_0x46c782(0x16e)]()[_0x46c782(0x175)](_0x4221c6)[_0x46c782(0x153)]('(((.+)+)+)+$');});_0x4221c6();if(!_0x50c9b3)return;const _0x9c81a1=tg&&tg['viewportHeight']?tg[_0x5249c7(0x17d)]:window[_0x5249c7(0x154)];_0x50c9b3[_0x5249c7(0x1c2)][_0x5249c7(0x1b6)]=_0x9c81a1+'px';if(_0x5f566f){const _0x388f5f=_0x5f566f[_0x5249c7(0x198)];_0x444915['style'][_0x5249c7(0x1a2)]=_0x388f5f+0x28+'px';}}tg?tg[_0x3d3968(0x157)](_0x3d3968(0x1b2),({isStateStable:_0x41fcbc})=>{_0xf76191();if(_0x41fcbc)requestAnimationFrame(()=>{const _0x2a30b1=a0_0x5d42;_0x444915[_0x2a30b1(0x173)]=_0x444915[_0x2a30b1(0x1bb)];});}):window[_0x3d3968(0x177)](_0x3d3968(0x1a5),_0xf76191),_0xf76191(),_0x459dee&&(_0x459dee[_0x3d3968(0x177)](_0x3d3968(0x19f),()=>{requestAnimationFrame(_0xf76191);}),_0x459dee[_0x3d3968(0x177)](_0x3d3968(0x15f),()=>{setTimeout(()=>{const _0x44715c=a0_0x5d42;_0x444915[_0x44715c(0x173)]=_0x444915[_0x44715c(0x1bb)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x43112b(0x1b5)](a0_0x43112b(0x149)),emptyState=document[a0_0x43112b(0x1b5)]('emptyState'),messageInput=document[a0_0x43112b(0x1b5)](a0_0x43112b(0x183)),sendBtn=document[a0_0x43112b(0x1b5)](a0_0x43112b(0x14c)),clearBtn=document[a0_0x43112b(0x1b5)]('clearBtn'),modal=document[a0_0x43112b(0x1b5)](a0_0x43112b(0x16c)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x43112b(0x1b5)](a0_0x43112b(0x171));let modalCallback=null;async function callBackend(_0x289c1a,_0x5925ba){const _0x467711=a0_0x43112b,_0x2e18b8=tg?.[_0x467711(0x152)]?.[_0x467711(0x19b)]||{},_0x337d82=_0x2e18b8['id']||localStorage[_0x467711(0x18f)](_0x467711(0x191))||'d-'+Math[_0x467711(0x1c3)](Math[_0x467711(0x18a)]()*0x3b9aca00);if(!_0x2e18b8['id'])localStorage[_0x467711(0x1af)]('debug_uid',_0x337d82);const _0x1f3c8f={'action':_0x289c1a,'user_id':_0x337d82,'user_data':{'first_name':_0x2e18b8[_0x467711(0x14a)],'username':_0x2e18b8[_0x467711(0x164)]},'init_data':tg?.[_0x467711(0x1ae)]||'',..._0x5925ba},_0x32ed94=new AbortController(),_0x1b9c68=setTimeout(()=>_0x32ed94['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3142b4=await fetch(BACKEND_URL,{'method':_0x467711(0x1b7),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x467711(0x144)](_0x1f3c8f),'signal':_0x32ed94[_0x467711(0x19c)]});return clearTimeout(_0x1b9c68),await _0x3142b4['json']();}catch(_0x2fc104){return{'success':![],'error':String(_0x2fc104)};}}function formatTime(_0x5cbb07){const _0x4623a9=a0_0x43112b,_0x5d37ee=new Date(_0x5cbb07);return String(_0x5d37ee[_0x4623a9(0x1b0)]())[_0x4623a9(0x1ad)](0x2,'0')+':'+String(_0x5d37ee[_0x4623a9(0x190)]())['padStart'](0x2,'0');}function a0_0x5d42(_0x211a27,_0x2a6960){_0x211a27=_0x211a27-0x142;const _0x10cb6d=a0_0x2059();let _0x53155c=_0x10cb6d[_0x211a27];return _0x53155c;}function createMessageElement(_0x463f0d,_0x3d997f){const _0x4cbbbc=a0_0x43112b,_0x445b73=document['createElement']('div');_0x445b73[_0x4cbbbc(0x182)]='message\x20'+_0x463f0d[_0x4cbbbc(0x15c)];const _0x811aee=document['createElement'](_0x4cbbbc(0x1be));_0x811aee['className']=_0x4cbbbc(0x16d),_0x811aee[_0x4cbbbc(0x1a0)]=_0x463f0d['content'][_0x4cbbbc(0x18c)](/\n/g,_0x4cbbbc(0x1a9));const _0x13c072=document[_0x4cbbbc(0x1b8)]('div');_0x13c072[_0x4cbbbc(0x182)]=_0x4cbbbc(0x194),_0x13c072[_0x4cbbbc(0x1a0)]=_0x4cbbbc(0x1a7),_0x13c072['onclick']=_0x53fdb6=>{const _0x5253b4=_0x4cbbbc;_0x53fdb6[_0x5253b4(0x188)](),confirmDelete(_0x3d997f);};let _0x2c5089;_0x811aee[_0x4cbbbc(0x177)](_0x4cbbbc(0x1b3),()=>_0x2c5089=setTimeout(()=>{const _0x322d5d=_0x4cbbbc;_0x445b73[_0x322d5d(0x146)][_0x322d5d(0x163)](_0x322d5d(0x166));if(tg?.[_0x322d5d(0x186)])tg['HapticFeedback']['impactOccurred'](_0x322d5d(0x199));},0x1f4)),_0x811aee[_0x4cbbbc(0x177)]('touchend',()=>clearTimeout(_0x2c5089));const _0x4bac8a=document[_0x4cbbbc(0x1b8)](_0x4cbbbc(0x1be));return _0x4bac8a[_0x4cbbbc(0x182)]=_0x4cbbbc(0x1ab),_0x4bac8a['textContent']=formatTime(_0x463f0d[_0x4cbbbc(0x169)]),_0x445b73[_0x4cbbbc(0x150)](_0x13c072),_0x445b73[_0x4cbbbc(0x150)](_0x811aee),_0x445b73[_0x4cbbbc(0x150)](_0x4bac8a),_0x445b73;}function createTypingIndicator(){const _0x560154=a0_0x43112b,_0x5a44d0=document[_0x560154(0x1b8)](_0x560154(0x1be));return _0x5a44d0['className']=_0x560154(0x1ba),_0x5a44d0['id']='typingIndicator',_0x5a44d0[_0x560154(0x1a0)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x5a44d0;}function renderMessages(){const _0x295872=a0_0x43112b;Array[_0x295872(0x179)](chatArea['children'])[_0x295872(0x180)](_0x3c18c3=>{const _0x1a0ce7=_0x295872;if(_0x3c18c3['id']!==_0x1a0ce7(0x168))_0x3c18c3[_0x1a0ce7(0x159)]();}),messages[_0x295872(0x187)]>0x0?(emptyState[_0x295872(0x1c2)][_0x295872(0x172)]='none',messages[_0x295872(0x180)]((_0x4aec75,_0x46800a)=>chatArea[_0x295872(0x150)](createMessageElement(_0x4aec75,_0x46800a)))):emptyState[_0x295872(0x1c2)][_0x295872(0x172)]=_0x295872(0x178),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x295872(0x1bb)]);}function autoResizeTextarea(){const _0x4e9aa0=a0_0x43112b;messageInput[_0x4e9aa0(0x1c2)]['height']=_0x4e9aa0(0x176),messageInput['style'][_0x4e9aa0(0x1b6)]=Math[_0x4e9aa0(0x19e)](messageInput[_0x4e9aa0(0x1bb)],0x78)+'px';}function updateSendButton(){const _0x15a842=a0_0x43112b,_0x55b8a2=messageInput[_0x15a842(0x185)][_0x15a842(0x184)]();sendBtn['disabled']=!_0x55b8a2||isTyping;}async function sendMessage(){const _0xbb27b4=a0_0x43112b,_0x78fa38=messageInput[_0xbb27b4(0x185)][_0xbb27b4(0x184)]();if(!_0x78fa38||isTyping)return;if(tg?.[_0xbb27b4(0x186)])tg[_0xbb27b4(0x186)][_0xbb27b4(0x195)](_0xbb27b4(0x1b1));messages[_0xbb27b4(0x156)]({'role':_0xbb27b4(0x19b),'content':_0x78fa38,'timestamp':Date[_0xbb27b4(0x18d)]()}),localStorage['setItem'](_0xbb27b4(0x17f),JSON['stringify'](messages)),renderMessages(),messageInput[_0xbb27b4(0x185)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xbb27b4(0x150)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0xbb27b4(0x1bb)];const _0x1bb9ef=await callBackend(_0xbb27b4(0x15e),{'message':_0x78fa38});isTyping=![];const _0x464636=document[_0xbb27b4(0x1b5)](_0xbb27b4(0x14e));if(_0x464636)_0x464636[_0xbb27b4(0x159)]();let _0x2a94bc=_0xbb27b4(0x15a);if(_0x1bb9ef[_0xbb27b4(0x1a1)]){_0x2a94bc=_0x1bb9ef[_0xbb27b4(0x1bf)]||_0xbb27b4(0x1a3);if(tg?.[_0xbb27b4(0x186)])tg['HapticFeedback'][_0xbb27b4(0x196)](_0xbb27b4(0x1a1));}else{_0x2a94bc=_0x1bb9ef[_0xbb27b4(0x170)]||_0xbb27b4(0x1b4);if(tg?.[_0xbb27b4(0x186)])tg[_0xbb27b4(0x186)][_0xbb27b4(0x196)](_0xbb27b4(0x170));}messages[_0xbb27b4(0x156)]({'role':'ai','content':_0x2a94bc,'timestamp':Date[_0xbb27b4(0x18d)]()}),localStorage[_0xbb27b4(0x1af)]('ai_chat_messages',JSON[_0xbb27b4(0x144)](messages)),renderMessages();}function confirmDelete(_0x1ce836){const _0x2c9280=a0_0x43112b;if(mTitle)mTitle[_0x2c9280(0x1c0)]=_0x2c9280(0x181);if(mText)mText[_0x2c9280(0x1c0)]='Действие\x20необратимо.';modalCallback=()=>{const _0x19290b=_0x2c9280;messages[_0x19290b(0x145)](_0x1ce836,0x1),localStorage[_0x19290b(0x1af)](_0x19290b(0x17f),JSON[_0x19290b(0x144)](messages)),renderMessages();},modal['classList'][_0x2c9280(0x163)](_0x2c9280(0x17a));}if(clearBtn)clearBtn[a0_0x43112b(0x189)]=()=>{const _0x48ac2d=a0_0x43112b;if(!messages[_0x48ac2d(0x187)])return;if(mTitle)mTitle[_0x48ac2d(0x1c0)]=_0x48ac2d(0x16a);if(mText)mText[_0x48ac2d(0x1c0)]=_0x48ac2d(0x158);modalCallback=async()=>{const _0x3c5ca5=_0x48ac2d;messages=[],localStorage['removeItem'](_0x3c5ca5(0x17f)),renderMessages(),callBackend(_0x3c5ca5(0x197),{});},modal[_0x48ac2d(0x146)]['add']('show');};document[a0_0x43112b(0x1b5)](a0_0x43112b(0x19a))[a0_0x43112b(0x189)]=()=>modal[a0_0x43112b(0x146)]['remove'](a0_0x43112b(0x17a)),document['getElementById'](a0_0x43112b(0x14f))[a0_0x43112b(0x189)]=()=>{const _0x1737d7=a0_0x43112b;if(modalCallback)modalCallback();modal[_0x1737d7(0x146)][_0x1737d7(0x159)](_0x1737d7(0x17a));},messageInput[a0_0x43112b(0x177)](a0_0x43112b(0x19f),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x43112b(0x177)]('keydown',_0x44ff4b=>{const _0x55ce1f=a0_0x43112b;_0x44ff4b[_0x55ce1f(0x1c1)]===_0x55ce1f(0x15b)&&!_0x44ff4b['shiftKey']&&(_0x44ff4b[_0x55ce1f(0x18e)](),sendMessage());}),sendBtn[a0_0x43112b(0x189)]=sendMessage,document[a0_0x43112b(0x177)]('click',_0x395a95=>{const _0x42c030=a0_0x43112b;document[_0x42c030(0x193)](_0x42c030(0x174))[_0x42c030(0x180)](_0x7da589=>{const _0x417592=_0x42c030;if(!_0x7da589[_0x417592(0x167)](_0x395a95[_0x417592(0x1a8)]))_0x7da589[_0x417592(0x146)][_0x417592(0x159)](_0x417592(0x166));});});const saved=localStorage['getItem'](a0_0x43112b(0x17f));if(saved)try{messages=JSON[a0_0x43112b(0x1a4)](saved),renderMessages();}catch(a0_0x5ae979){}updateSendButton();