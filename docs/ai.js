const a0_0x5427c0=a0_0x6b08;(function(_0x361b8e,_0x1d5fde){const _0x2cf57a=a0_0x6b08,_0x3cd784=_0x361b8e();while(!![]){try{const _0x5950d7=-parseInt(_0x2cf57a(0x1b7))/0x1*(-parseInt(_0x2cf57a(0x1ae))/0x2)+-parseInt(_0x2cf57a(0x1ec))/0x3+parseInt(_0x2cf57a(0x1f9))/0x4+-parseInt(_0x2cf57a(0x180))/0x5*(-parseInt(_0x2cf57a(0x1b2))/0x6)+-parseInt(_0x2cf57a(0x188))/0x7+parseInt(_0x2cf57a(0x1e9))/0x8+-parseInt(_0x2cf57a(0x1f1))/0x9*(parseInt(_0x2cf57a(0x183))/0xa);if(_0x5950d7===_0x1d5fde)break;else _0x3cd784['push'](_0x3cd784['shift']());}catch(_0x5e372d){_0x3cd784['push'](_0x3cd784['shift']());}}}(a0_0x1584,0xbc621));const tg=window['Telegram']?.[a0_0x5427c0(0x1d1)],HOME_URL=a0_0x5427c0(0x1ef);function setupTelegramBackButton(){const _0x47d965=a0_0x5427c0;if(!tg)return;try{tg[_0x47d965(0x1ce)](),tg['expand'](),tg[_0x47d965(0x1b8)]?.('#050505');if(tg[_0x47d965(0x1bd)]?.(_0x47d965(0x1c7)))tg[_0x47d965(0x18e)]?.();const _0x512974=tg[_0x47d965(0x1f8)];if(_0x512974){_0x512974[_0x47d965(0x1d2)]();if(typeof _0x512974['offClick']===_0x47d965(0x1be))try{_0x512974[_0x47d965(0x1e6)]();}catch(_0x8b03cf){}_0x512974['onClick'](()=>{const _0x111d47=_0x47d965;if(tg[_0x111d47(0x1fc)])tg[_0x111d47(0x1fc)]['impactOccurred']('light');location[_0x111d47(0x1d6)]=HOME_URL;});}}catch(_0x102ed2){console[_0x47d965(0x1fa)](_0x47d965(0x1fb),_0x102ed2);}}(function initStableLayout(){const _0x2137c4=a0_0x5427c0,_0x1347a6=(function(){let _0xe8516e=!![];return function(_0x33178c,_0x47e56f){const _0x5a61d8=_0xe8516e?function(){if(_0x47e56f){const _0x1b2cb0=_0x47e56f['apply'](_0x33178c,arguments);return _0x47e56f=null,_0x1b2cb0;}}:function(){};return _0xe8516e=![],_0x5a61d8;};}()),_0x39856b=document[_0x2137c4(0x1f3)](_0x2137c4(0x1af)),_0x49f850=document['getElementById']('inputArea'),_0x46c6b2=document[_0x2137c4(0x18a)]('chatArea'),_0x288f3c=document[_0x2137c4(0x18a)](_0x2137c4(0x181));function _0x2aa270(){const _0x2521fb=_0x2137c4,_0x855f85=_0x1347a6(this,function(){const _0x364f8f=a0_0x6b08;return _0x855f85['toString']()[_0x364f8f(0x184)]('(((.+)+)+)+$')[_0x364f8f(0x1bf)]()[_0x364f8f(0x199)](_0x855f85)['search']('(((.+)+)+)+$');});_0x855f85();if(!_0x39856b)return;const _0x185291=tg&&tg['viewportHeight']?tg[_0x2521fb(0x1b1)]:window[_0x2521fb(0x1f5)];_0x39856b[_0x2521fb(0x1f2)][_0x2521fb(0x1cc)]=_0x185291+'px';if(_0x49f850){const _0x29f6ec=_0x49f850[_0x2521fb(0x18c)];_0x46c6b2[_0x2521fb(0x1f2)][_0x2521fb(0x18b)]=_0x29f6ec+0x28+'px';}}tg?tg[_0x2137c4(0x185)](_0x2137c4(0x190),({isStateStable:_0x2d92ce})=>{_0x2aa270();if(_0x2d92ce)requestAnimationFrame(()=>{_0x46c6b2['scrollTop']=_0x46c6b2['scrollHeight'];});}):window['addEventListener'](_0x2137c4(0x1a6),_0x2aa270),_0x2aa270(),_0x288f3c&&(_0x288f3c[_0x2137c4(0x1a2)](_0x2137c4(0x189),()=>{requestAnimationFrame(_0x2aa270);}),_0x288f3c['addEventListener'](_0x2137c4(0x1f4),()=>{setTimeout(()=>{const _0x57abf3=a0_0x6b08;_0x46c6b2[_0x57abf3(0x1cf)]=_0x46c6b2[_0x57abf3(0x1db)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5427c0(0x18a)](a0_0x5427c0(0x1d7)),emptyState=document['getElementById'](a0_0x5427c0(0x17d)),messageInput=document[a0_0x5427c0(0x18a)](a0_0x5427c0(0x181)),sendBtn=document[a0_0x5427c0(0x18a)](a0_0x5427c0(0x19f)),clearBtn=document['getElementById'](a0_0x5427c0(0x17f)),modal=document[a0_0x5427c0(0x18a)](a0_0x5427c0(0x1d8)),mTitle=document['getElementById'](a0_0x5427c0(0x1ad)),mText=document[a0_0x5427c0(0x18a)](a0_0x5427c0(0x1c8));let modalCallback=null;async function callBackend(_0x54763a,_0x171523){const _0x57f9f3=a0_0x5427c0,_0x357f24=tg?.[_0x57f9f3(0x1c3)]?.[_0x57f9f3(0x1da)]||{},_0x5d319b=_0x357f24['id']||localStorage[_0x57f9f3(0x1d9)]('debug_uid')||'d-'+Math['floor'](Math[_0x57f9f3(0x1ab)]()*0x3b9aca00);if(!_0x357f24['id'])localStorage[_0x57f9f3(0x1bb)]('debug_uid',_0x5d319b);const _0x183ef0={'action':_0x54763a,'user_id':_0x5d319b,'user_data':{'first_name':_0x357f24[_0x57f9f3(0x1c6)],'username':_0x357f24['username']},'init_data':tg?.[_0x57f9f3(0x1e5)]||'',..._0x171523},_0x2901ec=new AbortController(),_0x134663=setTimeout(()=>_0x2901ec[_0x57f9f3(0x1b4)](),REQUEST_TIMEOUT_MS);try{const _0x1ee6a5=await fetch(BACKEND_URL,{'method':_0x57f9f3(0x197),'headers':{'Content-Type':_0x57f9f3(0x1f6)},'body':JSON[_0x57f9f3(0x1c9)](_0x183ef0),'signal':_0x2901ec[_0x57f9f3(0x19d)]});return clearTimeout(_0x134663),await _0x1ee6a5[_0x57f9f3(0x1ba)]();}catch(_0x2743c9){return{'success':![],'error':String(_0x2743c9)};}}function formatTime(_0x1c68fd){const _0x28db37=a0_0x5427c0,_0x3ad255=new Date(_0x1c68fd);return String(_0x3ad255[_0x28db37(0x1e7)]())['padStart'](0x2,'0')+':'+String(_0x3ad255['getMinutes']())['padStart'](0x2,'0');}function a0_0x6b08(_0x59a177,_0x2f3f7a){_0x59a177=_0x59a177-0x17d;const _0x20dd26=a0_0x1584();let _0x1e70e3=_0x20dd26[_0x59a177];return _0x1e70e3;}function createMessageElement(_0xbc79ad,_0x22f146){const _0x4a0b57=a0_0x5427c0,_0x40b11e=document['createElement']('div');_0x40b11e['className']=_0x4a0b57(0x1aa)+_0xbc79ad[_0x4a0b57(0x1ac)];const _0x5ee1d5=document['createElement'](_0x4a0b57(0x1b9));_0x5ee1d5['className']=_0x4a0b57(0x1a7),_0x5ee1d5[_0x4a0b57(0x1d5)]=_0xbc79ad[_0x4a0b57(0x1df)][_0x4a0b57(0x1e1)](/\n/g,_0x4a0b57(0x1e2));const _0x2e2671=document['createElement'](_0x4a0b57(0x1b9));_0x2e2671[_0x4a0b57(0x1c4)]='delete-btn',_0x2e2671[_0x4a0b57(0x1d5)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x2e2671['onclick']=_0x35c5db=>{const _0x2b3a1b=_0x4a0b57;_0x35c5db[_0x2b3a1b(0x191)](),confirmDelete(_0x22f146);};let _0x16a763;_0x5ee1d5[_0x4a0b57(0x1a2)](_0x4a0b57(0x1b6),()=>_0x16a763=setTimeout(()=>{const _0x48331a=_0x4a0b57;_0x40b11e[_0x48331a(0x18f)][_0x48331a(0x17e)](_0x48331a(0x1eb));if(tg?.[_0x48331a(0x1fc)])tg['HapticFeedback'][_0x48331a(0x1b3)](_0x48331a(0x1d3));},0x1f4)),_0x5ee1d5[_0x4a0b57(0x1a2)](_0x4a0b57(0x196),()=>clearTimeout(_0x16a763));const _0x1e03a5=document[_0x4a0b57(0x1cb)](_0x4a0b57(0x1b9));return _0x1e03a5['className']=_0x4a0b57(0x1a0),_0x1e03a5['textContent']=formatTime(_0xbc79ad[_0x4a0b57(0x1dd)]),_0x40b11e[_0x4a0b57(0x1a5)](_0x2e2671),_0x40b11e['appendChild'](_0x5ee1d5),_0x40b11e['appendChild'](_0x1e03a5),_0x40b11e;}function createTypingIndicator(){const _0x1afb70=a0_0x5427c0,_0x3c42e5=document['createElement'](_0x1afb70(0x1b9));return _0x3c42e5['className']=_0x1afb70(0x192),_0x3c42e5['id']=_0x1afb70(0x187),_0x3c42e5[_0x1afb70(0x1d5)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x3c42e5;}function renderMessages(){const _0x1ae5ac=a0_0x5427c0;Array[_0x1ae5ac(0x1b5)](chatArea[_0x1ae5ac(0x1bc)])[_0x1ae5ac(0x1e4)](_0x400059=>{const _0x2d737b=_0x1ae5ac;if(_0x400059['id']!==_0x2d737b(0x17d))_0x400059[_0x2d737b(0x198)]();}),messages[_0x1ae5ac(0x182)]>0x0?(emptyState[_0x1ae5ac(0x1f2)][_0x1ae5ac(0x193)]=_0x1ae5ac(0x1dc),messages[_0x1ae5ac(0x1e4)]((_0x9dbe3f,_0xb49457)=>chatArea[_0x1ae5ac(0x1a5)](createMessageElement(_0x9dbe3f,_0xb49457)))):emptyState[_0x1ae5ac(0x1f2)]['display']=_0x1ae5ac(0x1cd),requestAnimationFrame(()=>chatArea[_0x1ae5ac(0x1cf)]=chatArea[_0x1ae5ac(0x1db)]);}function autoResizeTextarea(){const _0xb3317=a0_0x5427c0;messageInput[_0xb3317(0x1f2)][_0xb3317(0x1cc)]=_0xb3317(0x1a9),messageInput[_0xb3317(0x1f2)][_0xb3317(0x1cc)]=Math[_0xb3317(0x194)](messageInput[_0xb3317(0x1db)],0x78)+'px';}function updateSendButton(){const _0x5a7b5a=a0_0x5427c0,_0xb8ceff=messageInput[_0x5a7b5a(0x1fd)][_0x5a7b5a(0x1ed)]();sendBtn[_0x5a7b5a(0x1e3)]=!_0xb8ceff||isTyping;}async function sendMessage(){const _0x155a31=a0_0x5427c0,_0x2cba2e=messageInput[_0x155a31(0x1fd)]['trim']();if(!_0x2cba2e||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x155a31(0x1b3)](_0x155a31(0x1fe));messages[_0x155a31(0x19e)]({'role':_0x155a31(0x1da),'content':_0x2cba2e,'timestamp':Date[_0x155a31(0x1d0)]()}),localStorage['setItem'](_0x155a31(0x19b),JSON['stringify'](messages)),renderMessages(),messageInput[_0x155a31(0x1fd)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x155a31(0x1a5)](createTypingIndicator()),chatArea[_0x155a31(0x1cf)]=chatArea[_0x155a31(0x1db)];const _0xc8be53=await callBackend(_0x155a31(0x1ea),{'message':_0x2cba2e});isTyping=![];const _0x21dec6=document[_0x155a31(0x18a)](_0x155a31(0x187));if(_0x21dec6)_0x21dec6[_0x155a31(0x198)]();let _0x310fd3='Ошибка\x20сети';if(_0xc8be53[_0x155a31(0x1a1)]){_0x310fd3=_0xc8be53[_0x155a31(0x1e0)]||_0x155a31(0x19c);if(tg?.[_0x155a31(0x1fc)])tg['HapticFeedback']['notificationOccurred'](_0x155a31(0x1a1));}else{_0x310fd3=_0xc8be53[_0x155a31(0x1d4)]||_0x155a31(0x195);if(tg?.[_0x155a31(0x1fc)])tg[_0x155a31(0x1fc)][_0x155a31(0x1de)](_0x155a31(0x1d4));}messages[_0x155a31(0x19e)]({'role':'ai','content':_0x310fd3,'timestamp':Date['now']()}),localStorage[_0x155a31(0x1bb)](_0x155a31(0x19b),JSON[_0x155a31(0x1c9)](messages)),renderMessages();}function confirmDelete(_0x20db49){const _0x16d77b=a0_0x5427c0;if(mTitle)mTitle[_0x16d77b(0x1c1)]=_0x16d77b(0x1f0);if(mText)mText['textContent']=_0x16d77b(0x1a8);modalCallback=()=>{const _0xcfd0e8=_0x16d77b;messages['splice'](_0x20db49,0x1),localStorage[_0xcfd0e8(0x1bb)](_0xcfd0e8(0x19b),JSON[_0xcfd0e8(0x1c9)](messages)),renderMessages();},modal['classList']['add'](_0x16d77b(0x1d2));}if(clearBtn)clearBtn[a0_0x5427c0(0x1f7)]=()=>{const _0x3929ee=a0_0x5427c0;if(!messages[_0x3929ee(0x182)])return;if(mTitle)mTitle[_0x3929ee(0x1c1)]='Очистить\x20историю?';if(mText)mText[_0x3929ee(0x1c1)]=_0x3929ee(0x1c5);modalCallback=async()=>{const _0x40e648=_0x3929ee;messages=[],localStorage[_0x40e648(0x186)](_0x40e648(0x19b)),renderMessages(),callBackend(_0x40e648(0x1a3),{});},modal['classList'][_0x3929ee(0x17e)](_0x3929ee(0x1d2));};document[a0_0x5427c0(0x18a)]('modalCancel')[a0_0x5427c0(0x1f7)]=()=>modal[a0_0x5427c0(0x18f)][a0_0x5427c0(0x198)](a0_0x5427c0(0x1d2)),document[a0_0x5427c0(0x18a)](a0_0x5427c0(0x19a))[a0_0x5427c0(0x1f7)]=()=>{const _0x13cc43=a0_0x5427c0;if(modalCallback)modalCallback();modal[_0x13cc43(0x18f)]['remove'](_0x13cc43(0x1d2));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5427c0(0x1a2)](a0_0x5427c0(0x1e8),_0x4589f5=>{const _0x32f423=a0_0x5427c0;_0x4589f5[_0x32f423(0x1c2)]==='Enter'&&!_0x4589f5['shiftKey']&&(_0x4589f5[_0x32f423(0x1b0)](),sendMessage());}),sendBtn[a0_0x5427c0(0x1f7)]=sendMessage,document[a0_0x5427c0(0x1a2)]('click',_0x922c8=>{const _0x1bf979=a0_0x5427c0;document[_0x1bf979(0x1a4)](_0x1bf979(0x1c0))['forEach'](_0x207cac=>{const _0x29aa7b=_0x1bf979;if(!_0x207cac[_0x29aa7b(0x1ee)](_0x922c8[_0x29aa7b(0x1ca)]))_0x207cac[_0x29aa7b(0x18f)][_0x29aa7b(0x198)](_0x29aa7b(0x1eb));});});const saved=localStorage[a0_0x5427c0(0x1d9)](a0_0x5427c0(0x19b));if(saved)try{messages=JSON[a0_0x5427c0(0x18d)](saved),renderMessages();}catch(a0_0x1dc149){}function a0_0x1584(){const _0xe2da69=['textContent','key','initDataUnsafe','className','Начнется\x20новый\x20диалог.','first_name','6.1','modalText','stringify','target','createElement','height','flex','ready','scrollTop','now','WebApp','show','medium','error','innerHTML','href','chatArea','confirmModal','getItem','user','scrollHeight','none','timestamp','notificationOccurred','content','text','replace','<br>','disabled','forEach','initData','offClick','getHours','keydown','4276824OklGIA','send_message','show-delete','248673kCYhhn','trim','contains','./router.html','Удалить?','261mJbMTD','style','querySelector','focus','innerHeight','text/plain','onclick','BackButton','1116216MZkRNh','warn','TG\x20setup\x20error:','HapticFeedback','value','light','emptyState','add','clearBtn','1555LaDHhw','messageInput','length','103690ducFJi','search','onEvent','removeItem','typingIndicator','10560207BeVVjY','input','getElementById','paddingBottom','offsetHeight','parse','disableVerticalSwipes','classList','viewportChanged','stopPropagation','message\x20ai','display','min','Ошибка\x20сервера','touchend','POST','remove','constructor','modalConfirm','ai_chat_messages','Пустой\x20ответ','signal','push','sendBtn','message-time','success','addEventListener','clear_history','querySelectorAll','appendChild','resize','message-bubble','Действие\x20необратимо.','auto','message\x20','random','role','modalTitle','2070044DyKTWr','.container','preventDefault','viewportHeight','15726ubVIXR','impactOccurred','abort','from','touchstart','1TYGWLk','setHeaderColor','div','json','setItem','children','isVersionAtLeast','function','toString','.message.show-delete'];a0_0x1584=function(){return _0xe2da69;};return a0_0x1584();}updateSendButton();