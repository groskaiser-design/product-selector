const a0_0x2cf445=a0_0x347d;(function(_0x1134a7,_0xf4979){const _0x53f79e=a0_0x347d,_0x5d2c63=_0x1134a7();while(!![]){try{const _0x751d32=-parseInt(_0x53f79e(0x238))/0x1+parseInt(_0x53f79e(0x20f))/0x2+-parseInt(_0x53f79e(0x1e5))/0x3+parseInt(_0x53f79e(0x1fb))/0x4+-parseInt(_0x53f79e(0x239))/0x5*(parseInt(_0x53f79e(0x1fe))/0x6)+parseInt(_0x53f79e(0x217))/0x7*(parseInt(_0x53f79e(0x206))/0x8)+parseInt(_0x53f79e(0x1e1))/0x9*(parseInt(_0x53f79e(0x23b))/0xa);if(_0x751d32===_0xf4979)break;else _0x5d2c63['push'](_0x5d2c63['shift']());}catch(_0x14438b){_0x5d2c63['push'](_0x5d2c63['shift']());}}}(a0_0x4fb4,0x55293));const tg=window['Telegram']?.[a0_0x2cf445(0x1d6)],HOME_URL=a0_0x2cf445(0x1d5);function setupTelegramBackButton(){const _0xf87f3b=a0_0x2cf445,_0x392f7b=(function(){let _0x54b530=!![];return function(_0x5d45eb,_0x5a9af3){const _0x1665a5=_0x54b530?function(){if(_0x5a9af3){const _0x1166a2=_0x5a9af3['apply'](_0x5d45eb,arguments);return _0x5a9af3=null,_0x1166a2;}}:function(){};return _0x54b530=![],_0x1665a5;};}()),_0x5c7ad3=_0x392f7b(this,function(){const _0x2260ac=a0_0x347d;return _0x5c7ad3[_0x2260ac(0x1e8)]()['search'](_0x2260ac(0x1eb))[_0x2260ac(0x1e8)]()[_0x2260ac(0x1d4)](_0x5c7ad3)[_0x2260ac(0x229)](_0x2260ac(0x1eb));});_0x5c7ad3();if(!tg)return;try{tg[_0xf87f3b(0x232)](),tg['expand'](),tg[_0xf87f3b(0x22d)]?.(_0xf87f3b(0x1f8));if(tg['isVersionAtLeast']?.(_0xf87f3b(0x20b)))tg[_0xf87f3b(0x205)]?.();const _0x4c528d=tg['BackButton'];if(_0x4c528d){_0x4c528d[_0xf87f3b(0x1f0)]();if(typeof _0x4c528d[_0xf87f3b(0x241)]===_0xf87f3b(0x1e0))try{_0x4c528d['offClick']();}catch(_0xd64229){}_0x4c528d[_0xf87f3b(0x21c)](()=>{const _0x1b6d31=_0xf87f3b;if(tg[_0x1b6d31(0x1ca)])tg[_0x1b6d31(0x1ca)][_0x1b6d31(0x231)](_0x1b6d31(0x1fc));location[_0x1b6d31(0x1de)]=HOME_URL;});}}catch(_0x2c4f95){console[_0xf87f3b(0x240)]('TG\x20setup\x20error:',_0x2c4f95);}}(function initStableLayout(){const _0x354dd8=a0_0x2cf445,_0x2ab281=document[_0x354dd8(0x1ee)]('.container'),_0x1d93a8=document['getElementById']('inputArea'),_0x352a54=document[_0x354dd8(0x1f4)]('chatArea'),_0x2e64ff=document[_0x354dd8(0x1f4)](_0x354dd8(0x214));function _0x3a17b0(){const _0x2cd712=_0x354dd8;if(!_0x2ab281)return;const _0x22339e=tg&&tg[_0x2cd712(0x203)]?tg[_0x2cd712(0x203)]:window['innerHeight'];_0x2ab281[_0x2cd712(0x1e6)][_0x2cd712(0x1ed)]=_0x22339e+'px';if(_0x1d93a8){const _0x3d8d87=_0x1d93a8['offsetHeight'];_0x352a54['style']['paddingBottom']=_0x3d8d87+0x28+'px';}}tg?tg[_0x354dd8(0x1ce)](_0x354dd8(0x230),({isStateStable:_0x12b5b7})=>{_0x3a17b0();if(_0x12b5b7)requestAnimationFrame(()=>{const _0x314a26=a0_0x347d;_0x352a54['scrollTop']=_0x352a54[_0x314a26(0x23e)];});}):window[_0x354dd8(0x21b)](_0x354dd8(0x1ff),_0x3a17b0),_0x3a17b0(),_0x2e64ff&&(_0x2e64ff[_0x354dd8(0x21b)](_0x354dd8(0x1e3),()=>{requestAnimationFrame(_0x3a17b0);}),_0x2e64ff['addEventListener'](_0x354dd8(0x215),()=>{setTimeout(()=>{const _0x23776a=a0_0x347d;_0x352a54[_0x23776a(0x228)]=_0x352a54[_0x23776a(0x23e)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2cf445(0x1f4)](a0_0x2cf445(0x23a)),emptyState=document[a0_0x2cf445(0x1f4)](a0_0x2cf445(0x1ef)),messageInput=document[a0_0x2cf445(0x1f4)](a0_0x2cf445(0x214)),sendBtn=document[a0_0x2cf445(0x1f4)]('sendBtn'),clearBtn=document[a0_0x2cf445(0x1f4)](a0_0x2cf445(0x212)),modal=document['getElementById'](a0_0x2cf445(0x1ea)),mTitle=document['getElementById'](a0_0x2cf445(0x1e7)),mText=document[a0_0x2cf445(0x1f4)](a0_0x2cf445(0x1d7));function a0_0x347d(_0x7d544d,_0x1ec1e1){_0x7d544d=_0x7d544d-0x1c9;const _0x362c38=a0_0x4fb4();let _0x49b385=_0x362c38[_0x7d544d];return _0x49b385;}let modalCallback=null;async function callBackend(_0x3c2dfe,_0xe81059){const _0x1c5b1e=a0_0x2cf445,_0x4ae7aa=tg?.[_0x1c5b1e(0x20c)]?.[_0x1c5b1e(0x1fd)]||{},_0x43badb=_0x4ae7aa['id']||localStorage[_0x1c5b1e(0x1d8)]('debug_uid')||'d-'+Math[_0x1c5b1e(0x1d2)](Math[_0x1c5b1e(0x233)]()*0x3b9aca00);if(!_0x4ae7aa['id'])localStorage[_0x1c5b1e(0x210)]('debug_uid',_0x43badb);const _0x27f8af={'action':_0x3c2dfe,'user_id':_0x43badb,'user_data':{'first_name':_0x4ae7aa[_0x1c5b1e(0x221)],'username':_0x4ae7aa[_0x1c5b1e(0x1f6)]},'init_data':tg?.[_0x1c5b1e(0x216)]||'',..._0xe81059},_0x379419=new AbortController(),_0x5a0491=setTimeout(()=>_0x379419[_0x1c5b1e(0x1f5)](),REQUEST_TIMEOUT_MS);try{const _0xf019d8=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x1c5b1e(0x1cf)},'body':JSON['stringify'](_0x27f8af),'signal':_0x379419['signal']});return clearTimeout(_0x5a0491),await _0xf019d8['json']();}catch(_0x65559){return{'success':![],'error':String(_0x65559)};}}function formatTime(_0x48cf21){const _0x3c0000=a0_0x2cf445,_0x5b4ba8=new Date(_0x48cf21);return String(_0x5b4ba8['getHours']())[_0x3c0000(0x227)](0x2,'0')+':'+String(_0x5b4ba8[_0x3c0000(0x23d)]())[_0x3c0000(0x227)](0x2,'0');}function createMessageElement(_0x975d22,_0xc205b2){const _0x394585=a0_0x2cf445,_0x384a01=document[_0x394585(0x242)](_0x394585(0x1f7));_0x384a01[_0x394585(0x208)]=_0x394585(0x20d)+_0x975d22['role'];const _0x350819=document['createElement'](_0x394585(0x1f7));_0x350819[_0x394585(0x208)]=_0x394585(0x1da),_0x350819['innerHTML']=_0x975d22[_0x394585(0x234)]['replace'](/\n/g,_0x394585(0x1df));const _0xe0d202=document[_0x394585(0x242)](_0x394585(0x1f7));_0xe0d202[_0x394585(0x208)]=_0x394585(0x1d0),_0xe0d202['innerHTML']=_0x394585(0x22a),_0xe0d202[_0x394585(0x220)]=_0x5d91f1=>{const _0x2a1842=_0x394585;_0x5d91f1[_0x2a1842(0x1cb)](),confirmDelete(_0xc205b2);};let _0x9bf840;_0x350819[_0x394585(0x21b)](_0x394585(0x223),()=>_0x9bf840=setTimeout(()=>{const _0x1f9e88=_0x394585;_0x384a01[_0x1f9e88(0x1e4)][_0x1f9e88(0x213)](_0x1f9e88(0x22f));if(tg?.[_0x1f9e88(0x1ca)])tg[_0x1f9e88(0x1ca)]['impactOccurred'](_0x1f9e88(0x243));},0x1f4)),_0x350819[_0x394585(0x21b)](_0x394585(0x1fa),()=>clearTimeout(_0x9bf840));const _0x427085=document[_0x394585(0x242)](_0x394585(0x1f7));return _0x427085[_0x394585(0x208)]=_0x394585(0x224),_0x427085[_0x394585(0x237)]=formatTime(_0x975d22[_0x394585(0x225)]),_0x384a01[_0x394585(0x222)](_0xe0d202),_0x384a01[_0x394585(0x222)](_0x350819),_0x384a01[_0x394585(0x222)](_0x427085),_0x384a01;}function createTypingIndicator(){const _0x473de5=a0_0x2cf445,_0x90ff63=document['createElement']('div');return _0x90ff63[_0x473de5(0x208)]='message\x20ai',_0x90ff63['id']=_0x473de5(0x22e),_0x90ff63[_0x473de5(0x1f2)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x90ff63;}function renderMessages(){const _0x198ac5=a0_0x2cf445;Array[_0x198ac5(0x1e2)](chatArea[_0x198ac5(0x23f)])[_0x198ac5(0x1e9)](_0x2157d9=>{const _0xff6f4d=_0x198ac5;if(_0x2157d9['id']!==_0xff6f4d(0x1ef))_0x2157d9['remove']();}),messages[_0x198ac5(0x200)]>0x0?(emptyState[_0x198ac5(0x1e6)][_0x198ac5(0x21e)]=_0x198ac5(0x207),messages[_0x198ac5(0x1e9)]((_0xa7927e,_0x5828c7)=>chatArea[_0x198ac5(0x222)](createMessageElement(_0xa7927e,_0x5828c7)))):emptyState[_0x198ac5(0x1e6)][_0x198ac5(0x21e)]=_0x198ac5(0x1f3),requestAnimationFrame(()=>chatArea[_0x198ac5(0x228)]=chatArea[_0x198ac5(0x23e)]);}function autoResizeTextarea(){const _0x2470d8=a0_0x2cf445;messageInput[_0x2470d8(0x1e6)]['height']='auto',messageInput[_0x2470d8(0x1e6)][_0x2470d8(0x1ed)]=Math[_0x2470d8(0x1d1)](messageInput[_0x2470d8(0x23e)],0x78)+'px';}function updateSendButton(){const _0x1e513c=a0_0x2cf445,_0x5f4b4d=messageInput['value'][_0x1e513c(0x21a)]();sendBtn[_0x1e513c(0x1f1)]=!_0x5f4b4d||isTyping;}async function sendMessage(){const _0xffd3cf=a0_0x2cf445,_0xfc415e=messageInput[_0xffd3cf(0x202)][_0xffd3cf(0x21a)]();if(!_0xfc415e||isTyping)return;if(tg?.[_0xffd3cf(0x1ca)])tg['HapticFeedback']['impactOccurred']('light');messages[_0xffd3cf(0x1d9)]({'role':_0xffd3cf(0x1fd),'content':_0xfc415e,'timestamp':Date[_0xffd3cf(0x226)]()}),localStorage[_0xffd3cf(0x210)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0xffd3cf(0x202)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xffd3cf(0x222)](createTypingIndicator()),chatArea[_0xffd3cf(0x228)]=chatArea[_0xffd3cf(0x23e)];const _0x7cd285=await callBackend('send_message',{'message':_0xfc415e});isTyping=![];const _0x10454d=document[_0xffd3cf(0x1f4)]('typingIndicator');if(_0x10454d)_0x10454d[_0xffd3cf(0x204)]();let _0x4d3d1f=_0xffd3cf(0x236);if(_0x7cd285['success']){_0x4d3d1f=_0x7cd285[_0xffd3cf(0x20a)]||_0xffd3cf(0x1f9);if(tg?.[_0xffd3cf(0x1ca)])tg[_0xffd3cf(0x1ca)][_0xffd3cf(0x219)](_0xffd3cf(0x22c));}else{_0x4d3d1f=_0x7cd285[_0xffd3cf(0x211)]||_0xffd3cf(0x1d3);if(tg?.[_0xffd3cf(0x1ca)])tg[_0xffd3cf(0x1ca)][_0xffd3cf(0x219)](_0xffd3cf(0x211));}messages['push']({'role':'ai','content':_0x4d3d1f,'timestamp':Date[_0xffd3cf(0x226)]()}),localStorage[_0xffd3cf(0x210)](_0xffd3cf(0x1cc),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x4c11a9){const _0x188274=a0_0x2cf445;if(mTitle)mTitle[_0x188274(0x237)]=_0x188274(0x1db);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x1d3ff5=_0x188274;messages[_0x1d3ff5(0x1dc)](_0x4c11a9,0x1),localStorage['setItem'](_0x1d3ff5(0x1cc),JSON[_0x1d3ff5(0x218)](messages)),renderMessages();},modal['classList'][_0x188274(0x213)](_0x188274(0x1f0));}if(clearBtn)clearBtn['onclick']=()=>{const _0x3a1711=a0_0x2cf445;if(!messages['length'])return;if(mTitle)mTitle[_0x3a1711(0x237)]='Очистить\x20историю?';if(mText)mText[_0x3a1711(0x237)]=_0x3a1711(0x21f);modalCallback=async()=>{const _0x3b7906=_0x3a1711;messages=[],localStorage[_0x3b7906(0x201)]('ai_chat_messages'),renderMessages(),callBackend(_0x3b7906(0x23c),{});},modal[_0x3a1711(0x1e4)][_0x3a1711(0x213)]('show');};document[a0_0x2cf445(0x1f4)](a0_0x2cf445(0x21d))[a0_0x2cf445(0x220)]=()=>modal[a0_0x2cf445(0x1e4)][a0_0x2cf445(0x204)](a0_0x2cf445(0x1f0)),document[a0_0x2cf445(0x1f4)](a0_0x2cf445(0x1ec))[a0_0x2cf445(0x220)]=()=>{const _0x356af1=a0_0x2cf445;if(modalCallback)modalCallback();modal[_0x356af1(0x1e4)][_0x356af1(0x204)](_0x356af1(0x1f0));},messageInput['addEventListener'](a0_0x2cf445(0x1e3),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2cf445(0x21b)](a0_0x2cf445(0x1c9),_0x20f63b=>{const _0x1cdc99=a0_0x2cf445;_0x20f63b[_0x1cdc99(0x235)]===_0x1cdc99(0x209)&&!_0x20f63b[_0x1cdc99(0x1dd)]&&(_0x20f63b[_0x1cdc99(0x20e)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x2cf445(0x21b)]('click',_0x261b81=>{document['querySelectorAll']('.message.show-delete')['forEach'](_0x1b1dd7=>{const _0x26ef0e=a0_0x347d;if(!_0x1b1dd7[_0x26ef0e(0x22b)](_0x261b81['target']))_0x1b1dd7[_0x26ef0e(0x1e4)][_0x26ef0e(0x204)](_0x26ef0e(0x22f));});});const saved=localStorage[a0_0x2cf445(0x1d8)](a0_0x2cf445(0x1cc));function a0_0x4fb4(){const _0x59f169=['remove','disableVerticalSwipes','8fpyNkv','none','className','Enter','text','6.1','initDataUnsafe','message\x20','preventDefault','1016102RAbyzt','setItem','error','clearBtn','add','messageInput','focus','initData','1412642OrVgXH','stringify','notificationOccurred','trim','addEventListener','onClick','modalCancel','display','Начнется\x20новый\x20диалог.','onclick','first_name','appendChild','touchstart','message-time','timestamp','now','padStart','scrollTop','search','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','contains','success','setHeaderColor','typingIndicator','show-delete','viewportChanged','impactOccurred','ready','random','content','key','Ошибка\x20сети','textContent','291738NYSbPm','1790KcMpTy','chatArea','4969420MTbciw','clear_history','getMinutes','scrollHeight','children','warn','offClick','createElement','medium','keydown','HapticFeedback','stopPropagation','ai_chat_messages','parse','onEvent','text/plain','delete-btn','min','floor','Ошибка\x20сервера','constructor','./router.html','WebApp','modalText','getItem','push','message-bubble','Удалить?','splice','shiftKey','href','<br>','function','9YMMPZt','from','input','classList','2010447mDcTlV','style','modalTitle','toString','forEach','confirmModal','(((.+)+)+)+$','modalConfirm','height','querySelector','emptyState','show','disabled','innerHTML','flex','getElementById','abort','username','div','#050505','Пустой\x20ответ','touchend','855252ScVdMs','light','user','1842WsvBmi','resize','length','removeItem','value','viewportHeight'];a0_0x4fb4=function(){return _0x59f169;};return a0_0x4fb4();}if(saved)try{messages=JSON[a0_0x2cf445(0x1cd)](saved),renderMessages();}catch(a0_0x6e1c60){}updateSendButton();