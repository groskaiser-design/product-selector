const a0_0xb811a8=a0_0x44d0;(function(_0x3f0c6f,_0x4fbc02){const _0x13f6a4=a0_0x44d0,_0x2e686e=_0x3f0c6f();while(!![]){try{const _0x5a1de3=parseInt(_0x13f6a4(0x142))/0x1*(-parseInt(_0x13f6a4(0x17c))/0x2)+parseInt(_0x13f6a4(0x13d))/0x3+-parseInt(_0x13f6a4(0x152))/0x4+-parseInt(_0x13f6a4(0x159))/0x5*(parseInt(_0x13f6a4(0x176))/0x6)+-parseInt(_0x13f6a4(0x13a))/0x7*(-parseInt(_0x13f6a4(0x18f))/0x8)+parseInt(_0x13f6a4(0x121))/0x9*(parseInt(_0x13f6a4(0x199))/0xa)+parseInt(_0x13f6a4(0x146))/0xb;if(_0x5a1de3===_0x4fbc02)break;else _0x2e686e['push'](_0x2e686e['shift']());}catch(_0x5c2c8a){_0x2e686e['push'](_0x2e686e['shift']());}}}(a0_0x1f35,0xc27cf));const tg=window[a0_0xb811a8(0x174)]?.['WebApp'],HOME_URL=a0_0xb811a8(0x141);function setupTelegramBackButton(){const _0x366218=a0_0xb811a8,_0x2b68ad=(function(){let _0xc8a893=!![];return function(_0x17e468,_0x5161ec){const _0x157d84=_0xc8a893?function(){const _0x4d0198=a0_0x44d0;if(_0x5161ec){const _0x20b2d1=_0x5161ec[_0x4d0198(0x164)](_0x17e468,arguments);return _0x5161ec=null,_0x20b2d1;}}:function(){};return _0xc8a893=![],_0x157d84;};}()),_0x2c4855=_0x2b68ad(this,function(){const _0x3a6af8=a0_0x44d0;return _0x2c4855[_0x3a6af8(0x151)]()[_0x3a6af8(0x145)]('(((.+)+)+)+$')['toString']()[_0x3a6af8(0x155)](_0x2c4855)[_0x3a6af8(0x145)](_0x3a6af8(0x154));});_0x2c4855();if(!tg)return;try{tg[_0x366218(0x171)](),tg[_0x366218(0x185)](),tg[_0x366218(0x19b)]?.(_0x366218(0x14c));if(tg[_0x366218(0x170)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x547e5f=tg[_0x366218(0x156)];if(_0x547e5f){_0x547e5f['show']();if(typeof _0x547e5f[_0x366218(0x139)]===_0x366218(0x12e))try{_0x547e5f[_0x366218(0x139)]();}catch(_0x2cc738){}_0x547e5f[_0x366218(0x18d)](()=>{const _0x2ec179=_0x366218;if(tg[_0x2ec179(0x129)])tg[_0x2ec179(0x129)][_0x2ec179(0x189)](_0x2ec179(0x128));location[_0x2ec179(0x169)]=HOME_URL;});}}catch(_0x179256){console['warn']('TG\x20setup\x20error:',_0x179256);}}(function initStableLayout(){const _0x4101f0=a0_0xb811a8,_0x409c94=document[_0x4101f0(0x187)](_0x4101f0(0x123)),_0x55cc0f=document[_0x4101f0(0x13e)](_0x4101f0(0x163)),_0x5f0cf8=document[_0x4101f0(0x13e)](_0x4101f0(0x16d)),_0x320e9d=document[_0x4101f0(0x13e)](_0x4101f0(0x188));function _0x481601(){const _0x18d6e5=_0x4101f0;if(!_0x409c94)return;const _0x240a82=tg&&tg[_0x18d6e5(0x181)]?tg[_0x18d6e5(0x181)]:window[_0x18d6e5(0x196)];_0x409c94['style'][_0x18d6e5(0x149)]=_0x240a82+'px';if(_0x55cc0f){const _0x5d4386=_0x55cc0f['offsetHeight'];_0x5f0cf8['style'][_0x18d6e5(0x194)]=_0x5d4386+0x28+'px';}}tg?tg['onEvent'](_0x4101f0(0x178),({isStateStable:_0x5e1d64})=>{_0x481601();if(_0x5e1d64)requestAnimationFrame(()=>{const _0x4f8efd=a0_0x44d0;_0x5f0cf8[_0x4f8efd(0x143)]=_0x5f0cf8[_0x4f8efd(0x134)];});}):window['addEventListener']('resize',_0x481601),_0x481601(),_0x320e9d&&(_0x320e9d[_0x4101f0(0x132)](_0x4101f0(0x122),()=>{requestAnimationFrame(_0x481601);}),_0x320e9d['addEventListener'](_0x4101f0(0x138),()=>{setTimeout(()=>{const _0x525b50=a0_0x44d0;_0x5f0cf8[_0x525b50(0x143)]=_0x5f0cf8[_0x525b50(0x134)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xb811a8(0x186),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xb811a8(0x13e)](a0_0xb811a8(0x16d)),emptyState=document[a0_0xb811a8(0x13e)](a0_0xb811a8(0x17d)),messageInput=document[a0_0xb811a8(0x13e)]('messageInput'),sendBtn=document['getElementById'](a0_0xb811a8(0x175)),clearBtn=document[a0_0xb811a8(0x13e)](a0_0xb811a8(0x193)),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0xb811a8(0x13e)]('modalTitle'),mText=document['getElementById'](a0_0xb811a8(0x133));let modalCallback=null;async function callBackend(_0x275baa,_0xcb254f){const _0x240894=a0_0xb811a8,_0xce42c5=tg?.['initDataUnsafe']?.[_0x240894(0x15d)]||{},_0x52102e=_0xce42c5['id']||localStorage[_0x240894(0x15c)](_0x240894(0x183))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0xce42c5['id'])localStorage['setItem']('debug_uid',_0x52102e);const _0x583b47={'action':_0x275baa,'user_id':_0x52102e,'user_data':{'first_name':_0xce42c5[_0x240894(0x162)],'username':_0xce42c5[_0x240894(0x173)]},'init_data':tg?.[_0x240894(0x18c)]||'',..._0xcb254f},_0x13ae06=new AbortController(),_0x34fe0f=setTimeout(()=>_0x13ae06['abort'](),REQUEST_TIMEOUT_MS);try{const _0x397e44=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x240894(0x150)},'body':JSON[_0x240894(0x18e)](_0x583b47),'signal':_0x13ae06['signal']});return clearTimeout(_0x34fe0f),await _0x397e44[_0x240894(0x16a)]();}catch(_0x43d4d6){return{'success':![],'error':String(_0x43d4d6)};}}function formatTime(_0x366435){const _0x68edf7=a0_0xb811a8,_0x4520ee=new Date(_0x366435);return String(_0x4520ee['getHours']())[_0x68edf7(0x157)](0x2,'0')+':'+String(_0x4520ee[_0x68edf7(0x179)]())[_0x68edf7(0x157)](0x2,'0');}function a0_0x44d0(_0x2af082,_0x379dd8){_0x2af082=_0x2af082-0x120;const _0x3a5e46=a0_0x1f35();let _0x4c2ecb=_0x3a5e46[_0x2af082];return _0x4c2ecb;}function createMessageElement(_0x487d4b,_0x46059c){const _0x552445=a0_0xb811a8,_0xa28de2=document[_0x552445(0x12b)](_0x552445(0x191));_0xa28de2['className']=_0x552445(0x144)+_0x487d4b[_0x552445(0x17e)];const _0x24f296=document[_0x552445(0x12b)](_0x552445(0x191));_0x24f296[_0x552445(0x17a)]=_0x552445(0x12a),_0x24f296[_0x552445(0x12c)]=_0x487d4b[_0x552445(0x192)][_0x552445(0x147)](/\n/g,'<br>');const _0x5820d0=document['createElement'](_0x552445(0x191));_0x5820d0[_0x552445(0x17a)]='delete-btn',_0x5820d0[_0x552445(0x12c)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x5820d0[_0x552445(0x184)]=_0x3e883b=>{const _0x518dc6=_0x552445;_0x3e883b[_0x518dc6(0x180)](),confirmDelete(_0x46059c);};let _0x5aaa18;_0x24f296[_0x552445(0x132)](_0x552445(0x126),()=>_0x5aaa18=setTimeout(()=>{const _0x1e1131=_0x552445;_0xa28de2[_0x1e1131(0x12f)][_0x1e1131(0x15b)](_0x1e1131(0x153));if(tg?.[_0x1e1131(0x129)])tg[_0x1e1131(0x129)][_0x1e1131(0x189)]('medium');},0x1f4)),_0x24f296[_0x552445(0x132)](_0x552445(0x16c),()=>clearTimeout(_0x5aaa18));const _0x27c6ef=document[_0x552445(0x12b)](_0x552445(0x191));return _0x27c6ef[_0x552445(0x17a)]=_0x552445(0x15f),_0x27c6ef['textContent']=formatTime(_0x487d4b[_0x552445(0x17b)]),_0xa28de2[_0x552445(0x125)](_0x5820d0),_0xa28de2['appendChild'](_0x24f296),_0xa28de2['appendChild'](_0x27c6ef),_0xa28de2;}function createTypingIndicator(){const _0x29e0c2=a0_0xb811a8,_0x592a0a=document['createElement']('div');return _0x592a0a[_0x29e0c2(0x17a)]=_0x29e0c2(0x13c),_0x592a0a['id']=_0x29e0c2(0x197),_0x592a0a['innerHTML']=_0x29e0c2(0x130),_0x592a0a;}function renderMessages(){const _0x27dbda=a0_0xb811a8;Array[_0x27dbda(0x14a)](chatArea[_0x27dbda(0x131)])[_0x27dbda(0x161)](_0x18f01a=>{const _0x51e25b=_0x27dbda;if(_0x18f01a['id']!==_0x51e25b(0x17d))_0x18f01a[_0x51e25b(0x137)]();}),messages['length']>0x0?(emptyState[_0x27dbda(0x19c)][_0x27dbda(0x16b)]=_0x27dbda(0x14b),messages['forEach']((_0x148387,_0x4e4f85)=>chatArea[_0x27dbda(0x125)](createMessageElement(_0x148387,_0x4e4f85)))):emptyState['style'][_0x27dbda(0x16b)]=_0x27dbda(0x158),requestAnimationFrame(()=>chatArea[_0x27dbda(0x143)]=chatArea[_0x27dbda(0x134)]);}function autoResizeTextarea(){const _0x47b1d8=a0_0xb811a8;messageInput[_0x47b1d8(0x19c)][_0x47b1d8(0x149)]='auto',messageInput[_0x47b1d8(0x19c)][_0x47b1d8(0x149)]=Math[_0x47b1d8(0x190)](messageInput[_0x47b1d8(0x134)],0x78)+'px';}function updateSendButton(){const _0x2fdc1f=a0_0xb811a8,_0xc13ba2=messageInput[_0x2fdc1f(0x17f)][_0x2fdc1f(0x198)]();sendBtn[_0x2fdc1f(0x12d)]=!_0xc13ba2||isTyping;}async function sendMessage(){const _0xefad85=a0_0xb811a8,_0x56b2bc=messageInput[_0xefad85(0x17f)]['trim']();if(!_0x56b2bc||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0xefad85(0x189)](_0xefad85(0x128));messages[_0xefad85(0x167)]({'role':_0xefad85(0x15d),'content':_0x56b2bc,'timestamp':Date['now']()}),localStorage['setItem'](_0xefad85(0x19a),JSON[_0xefad85(0x18e)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0xefad85(0x143)]=chatArea[_0xefad85(0x134)];const _0x41d581=await callBackend(_0xefad85(0x195),{'message':_0x56b2bc});isTyping=![];const _0x4986f3=document['getElementById'](_0xefad85(0x197));if(_0x4986f3)_0x4986f3['remove']();let _0x773241=_0xefad85(0x13b);if(_0x41d581[_0xefad85(0x160)]){_0x773241=_0x41d581[_0xefad85(0x127)]||_0xefad85(0x172);if(tg?.[_0xefad85(0x129)])tg[_0xefad85(0x129)][_0xefad85(0x16f)]('success');}else{_0x773241=_0x41d581[_0xefad85(0x148)]||_0xefad85(0x177);if(tg?.[_0xefad85(0x129)])tg['HapticFeedback'][_0xefad85(0x16f)](_0xefad85(0x148));}messages[_0xefad85(0x167)]({'role':'ai','content':_0x773241,'timestamp':Date[_0xefad85(0x14f)]()}),localStorage[_0xefad85(0x15e)](_0xefad85(0x19a),JSON[_0xefad85(0x18e)](messages)),renderMessages();}function confirmDelete(_0x38b884){const _0x3718b0=a0_0xb811a8;if(mTitle)mTitle[_0x3718b0(0x14e)]=_0x3718b0(0x168);if(mText)mText[_0x3718b0(0x14e)]='Действие\x20необратимо.';modalCallback=()=>{const _0x12de1b=_0x3718b0;messages[_0x12de1b(0x18b)](_0x38b884,0x1),localStorage['setItem'](_0x12de1b(0x19a),JSON[_0x12de1b(0x18e)](messages)),renderMessages();},modal[_0x3718b0(0x12f)][_0x3718b0(0x15b)](_0x3718b0(0x124));}function a0_0x1f35(){const _0x25a9ea=['getMinutes','className','timestamp','1061846lDDGSm','emptyState','role','value','stopPropagation','viewportHeight','shiftKey','debug_uid','onclick','expand','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','querySelector','messageInput','impactOccurred','clear_history','splice','initData','onClick','stringify','8zDGpsb','min','div','content','clearBtn','paddingBottom','send_message','innerHeight','typingIndicator','trim','290770zISeEB','ai_chat_messages','setHeaderColor','style','length','153pOkrXG','input','.container','show','appendChild','touchstart','text','light','HapticFeedback','message-bubble','createElement','innerHTML','disabled','function','classList','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','children','addEventListener','modalText','scrollHeight','key','Очистить\x20историю?','remove','focus','offClick','73283PmLied','Ошибка\x20сети','message\x20ai','4495971KeChvW','getElementById','Начнется\x20новый\x20диалог.','removeItem','./router.html','1dbILOI','scrollTop','message\x20','search','8438881jVBCZD','replace','error','height','from','none','#050505','.message.show-delete','textContent','now','text/plain','toString','2976344GZoSEP','show-delete','(((.+)+)+)+$','constructor','BackButton','padStart','flex','1747435jBKpmo','Enter','add','getItem','user','setItem','message-time','success','forEach','first_name','inputArea','apply','parse','preventDefault','push','Удалить?','href','json','display','touchend','chatArea','contains','notificationOccurred','isVersionAtLeast','ready','Пустой\x20ответ','username','Telegram','sendBtn','12ogqcXa','Ошибка\x20сервера','viewportChanged'];a0_0x1f35=function(){return _0x25a9ea;};return a0_0x1f35();}if(clearBtn)clearBtn[a0_0xb811a8(0x184)]=()=>{const _0x13bd31=a0_0xb811a8;if(!messages[_0x13bd31(0x120)])return;if(mTitle)mTitle['textContent']=_0x13bd31(0x136);if(mText)mText[_0x13bd31(0x14e)]=_0x13bd31(0x13f);modalCallback=async()=>{const _0x66fe01=_0x13bd31;messages=[],localStorage[_0x66fe01(0x140)](_0x66fe01(0x19a)),renderMessages(),callBackend(_0x66fe01(0x18a),{});},modal[_0x13bd31(0x12f)][_0x13bd31(0x15b)](_0x13bd31(0x124));};document[a0_0xb811a8(0x13e)]('modalCancel')[a0_0xb811a8(0x184)]=()=>modal[a0_0xb811a8(0x12f)]['remove']('show'),document[a0_0xb811a8(0x13e)]('modalConfirm')['onclick']=()=>{const _0x2ae14b=a0_0xb811a8;if(modalCallback)modalCallback();modal[_0x2ae14b(0x12f)]['remove'](_0x2ae14b(0x124));},messageInput[a0_0xb811a8(0x132)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xb811a8(0x132)]('keydown',_0xb75e92=>{const _0x3dd1b2=a0_0xb811a8;_0xb75e92[_0x3dd1b2(0x135)]===_0x3dd1b2(0x15a)&&!_0xb75e92[_0x3dd1b2(0x182)]&&(_0xb75e92[_0x3dd1b2(0x166)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener']('click',_0x134ff7=>{const _0x16d3b8=a0_0xb811a8;document['querySelectorAll'](_0x16d3b8(0x14d))['forEach'](_0x27dd35=>{const _0x197738=_0x16d3b8;if(!_0x27dd35[_0x197738(0x16e)](_0x134ff7['target']))_0x27dd35[_0x197738(0x12f)][_0x197738(0x137)](_0x197738(0x153));});});const saved=localStorage[a0_0xb811a8(0x15c)](a0_0xb811a8(0x19a));if(saved)try{messages=JSON[a0_0xb811a8(0x165)](saved),renderMessages();}catch(a0_0x2e6350){}updateSendButton();