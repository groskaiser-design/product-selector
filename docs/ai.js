const a0_0x2c48f1=a0_0x4637;(function(_0x471c88,_0x2cdc68){const _0xa923ca=a0_0x4637,_0x27a0cb=_0x471c88();while(!![]){try{const _0x4ca6ea=parseInt(_0xa923ca(0x15e))/0x1+parseInt(_0xa923ca(0x16f))/0x2*(parseInt(_0xa923ca(0x161))/0x3)+-parseInt(_0xa923ca(0x1bb))/0x4*(-parseInt(_0xa923ca(0x16b))/0x5)+-parseInt(_0xa923ca(0x168))/0x6*(-parseInt(_0xa923ca(0x1a9))/0x7)+parseInt(_0xa923ca(0x182))/0x8+parseInt(_0xa923ca(0x1a4))/0x9+-parseInt(_0xa923ca(0x17d))/0xa;if(_0x4ca6ea===_0x2cdc68)break;else _0x27a0cb['push'](_0x27a0cb['shift']());}catch(_0x18522f){_0x27a0cb['push'](_0x27a0cb['shift']());}}}(a0_0x553c,0x418f6));const tg=window[a0_0x2c48f1(0x19f)]?.[a0_0x2c48f1(0x1b0)],HOME_URL=a0_0x2c48f1(0x1d8);function setupTelegramBackButton(){const _0x2344a2=a0_0x2c48f1,_0x5d2452=(function(){let _0x3e30eb=!![];return function(_0x4ebd4b,_0x20145a){const _0x4facc2=_0x3e30eb?function(){const _0xe51df7=a0_0x4637;if(_0x20145a){const _0x1ddc04=_0x20145a[_0xe51df7(0x199)](_0x4ebd4b,arguments);return _0x20145a=null,_0x1ddc04;}}:function(){};return _0x3e30eb=![],_0x4facc2;};}()),_0x2ce468=_0x5d2452(this,function(){const _0x4f3173=a0_0x4637;return _0x2ce468[_0x4f3173(0x1d9)]()[_0x4f3173(0x1c7)]('(((.+)+)+)+$')[_0x4f3173(0x1d9)]()[_0x4f3173(0x1bd)](_0x2ce468)[_0x4f3173(0x1c7)](_0x4f3173(0x1af));});_0x2ce468();if(!tg)return;try{tg['ready'](),tg[_0x2344a2(0x1cd)](),tg[_0x2344a2(0x1b7)]?.(_0x2344a2(0x162));if(tg[_0x2344a2(0x1cf)]?.('6.1'))tg[_0x2344a2(0x1c3)]?.();const _0x52e5d5=tg[_0x2344a2(0x1cb)];if(_0x52e5d5){_0x52e5d5[_0x2344a2(0x1d2)]();if(typeof _0x52e5d5[_0x2344a2(0x190)]==='function')try{_0x52e5d5[_0x2344a2(0x190)]();}catch(_0x15b3c9){}_0x52e5d5[_0x2344a2(0x175)](()=>{const _0x4b8a5e=_0x2344a2;if(tg[_0x4b8a5e(0x184)])tg[_0x4b8a5e(0x184)][_0x4b8a5e(0x18d)](_0x4b8a5e(0x172));location[_0x4b8a5e(0x17a)]=HOME_URL;});}}catch(_0x52c18c){console['warn'](_0x2344a2(0x1ce),_0x52c18c);}}(function initStableLayout(){const _0x16e94c=a0_0x2c48f1,_0x1dd8e7=document[_0x16e94c(0x1d6)](_0x16e94c(0x1d1)),_0x39535a=document['getElementById'](_0x16e94c(0x1d0)),_0x4253dd=document[_0x16e94c(0x193)](_0x16e94c(0x1d5)),_0x4ff774=document[_0x16e94c(0x193)](_0x16e94c(0x192));function _0x248d07(){const _0x99e839=_0x16e94c;if(!_0x1dd8e7)return;const _0x10807a=tg&&tg['viewportHeight']?tg[_0x99e839(0x1d7)]:window[_0x99e839(0x165)];_0x1dd8e7[_0x99e839(0x195)]['height']=_0x10807a+'px';if(_0x39535a){const _0x4735e3=_0x39535a[_0x99e839(0x1b5)];_0x4253dd[_0x99e839(0x195)][_0x99e839(0x1a0)]=_0x4735e3+0x28+'px';}}tg?tg['onEvent'](_0x16e94c(0x1bf),({isStateStable:_0x538824})=>{_0x248d07();if(_0x538824)requestAnimationFrame(()=>{const _0xac1d46=a0_0x4637;_0x4253dd['scrollTop']=_0x4253dd[_0xac1d46(0x180)];});}):window[_0x16e94c(0x18f)](_0x16e94c(0x16a),_0x248d07),_0x248d07(),_0x4ff774&&(_0x4ff774['addEventListener'](_0x16e94c(0x1a2),()=>{requestAnimationFrame(_0x248d07);}),_0x4ff774[_0x16e94c(0x18f)](_0x16e94c(0x1b2),()=>{setTimeout(()=>{const _0x477335=a0_0x4637;_0x4253dd[_0x477335(0x1b6)]=_0x4253dd[_0x477335(0x180)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2c48f1(0x198),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2c48f1(0x193)](a0_0x2c48f1(0x1d5)),emptyState=document[a0_0x2c48f1(0x193)]('emptyState'),messageInput=document[a0_0x2c48f1(0x193)](a0_0x2c48f1(0x192)),sendBtn=document[a0_0x2c48f1(0x193)]('sendBtn'),clearBtn=document['getElementById'](a0_0x2c48f1(0x178)),modal=document[a0_0x2c48f1(0x193)](a0_0x2c48f1(0x18b)),mTitle=document[a0_0x2c48f1(0x193)]('modalTitle'),mText=document['getElementById'](a0_0x2c48f1(0x194));let modalCallback=null;async function callBackend(_0x16a06a,_0x2a3854){const _0x254fc0=a0_0x2c48f1,_0x52fe59=tg?.[_0x254fc0(0x169)]?.[_0x254fc0(0x18a)]||{},_0x574f1e=_0x52fe59['id']||localStorage[_0x254fc0(0x164)](_0x254fc0(0x1a6))||'d-'+Math[_0x254fc0(0x1b8)](Math[_0x254fc0(0x1ca)]()*0x3b9aca00);if(!_0x52fe59['id'])localStorage['setItem']('debug_uid',_0x574f1e);const _0x1b8487={'action':_0x16a06a,'user_id':_0x574f1e,'user_data':{'first_name':_0x52fe59['first_name'],'username':_0x52fe59[_0x254fc0(0x191)]},'init_data':tg?.['initData']||'',..._0x2a3854},_0x50c95f=new AbortController(),_0x32cb7f=setTimeout(()=>_0x50c95f[_0x254fc0(0x16c)](),REQUEST_TIMEOUT_MS);try{const _0x556f71=await fetch(BACKEND_URL,{'method':_0x254fc0(0x197),'headers':{'Content-Type':_0x254fc0(0x1c1)},'body':JSON['stringify'](_0x1b8487),'signal':_0x50c95f[_0x254fc0(0x1b3)]});return clearTimeout(_0x32cb7f),await _0x556f71[_0x254fc0(0x1c6)]();}catch(_0xff6492){return{'success':![],'error':String(_0xff6492)};}}function formatTime(_0x48134e){const _0x32be03=a0_0x2c48f1,_0x25357a=new Date(_0x48134e);return String(_0x25357a['getHours']())[_0x32be03(0x18c)](0x2,'0')+':'+String(_0x25357a[_0x32be03(0x187)]())['padStart'](0x2,'0');}function createMessageElement(_0x2cfb34,_0x2e2f95){const _0x348d48=a0_0x2c48f1,_0xf30f91=document[_0x348d48(0x16d)]('div');_0xf30f91[_0x348d48(0x17b)]='message\x20'+_0x2cfb34['role'];const _0x321a53=document[_0x348d48(0x16d)](_0x348d48(0x171));_0x321a53[_0x348d48(0x17b)]='message-bubble',_0x321a53[_0x348d48(0x1a3)]=_0x2cfb34[_0x348d48(0x1a5)][_0x348d48(0x166)](/\n/g,'<br>');const _0x3601de=document[_0x348d48(0x16d)](_0x348d48(0x171));_0x3601de[_0x348d48(0x17b)]=_0x348d48(0x1c0),_0x3601de['innerHTML']=_0x348d48(0x1c5),_0x3601de['onclick']=_0x5526a3=>{const _0x37cb7c=_0x348d48;_0x5526a3[_0x37cb7c(0x16e)](),confirmDelete(_0x2e2f95);};let _0x527b1c;_0x321a53[_0x348d48(0x18f)](_0x348d48(0x188),()=>_0x527b1c=setTimeout(()=>{const _0x47b201=_0x348d48;_0xf30f91[_0x47b201(0x19d)]['add'](_0x47b201(0x1cc));if(tg?.[_0x47b201(0x184)])tg[_0x47b201(0x184)][_0x47b201(0x18d)](_0x47b201(0x1dc));},0x1f4)),_0x321a53[_0x348d48(0x18f)]('touchend',()=>clearTimeout(_0x527b1c));const _0x14387b=document[_0x348d48(0x16d)](_0x348d48(0x171));return _0x14387b[_0x348d48(0x17b)]='message-time',_0x14387b[_0x348d48(0x167)]=formatTime(_0x2cfb34['timestamp']),_0xf30f91['appendChild'](_0x3601de),_0xf30f91['appendChild'](_0x321a53),_0xf30f91['appendChild'](_0x14387b),_0xf30f91;}function createTypingIndicator(){const _0x4b83f8=a0_0x2c48f1,_0x313ce8=document[_0x4b83f8(0x16d)]('div');return _0x313ce8[_0x4b83f8(0x17b)]=_0x4b83f8(0x163),_0x313ce8['id']=_0x4b83f8(0x1b9),_0x313ce8['innerHTML']=_0x4b83f8(0x17e),_0x313ce8;}function renderMessages(){const _0x37fddb=a0_0x2c48f1;Array[_0x37fddb(0x160)](chatArea[_0x37fddb(0x15f)])[_0x37fddb(0x19a)](_0x41c6b0=>{const _0x30c12a=_0x37fddb;if(_0x41c6b0['id']!==_0x30c12a(0x1be))_0x41c6b0[_0x30c12a(0x1a1)]();}),messages['length']>0x0?(emptyState['style'][_0x37fddb(0x1c4)]=_0x37fddb(0x1db),messages[_0x37fddb(0x19a)]((_0x239e94,_0xfa8d80)=>chatArea['appendChild'](createMessageElement(_0x239e94,_0xfa8d80)))):emptyState[_0x37fddb(0x195)][_0x37fddb(0x1c4)]=_0x37fddb(0x19b),requestAnimationFrame(()=>chatArea[_0x37fddb(0x1b6)]=chatArea[_0x37fddb(0x180)]);}function autoResizeTextarea(){const _0x1b8a46=a0_0x2c48f1;messageInput[_0x1b8a46(0x195)][_0x1b8a46(0x196)]=_0x1b8a46(0x17f),messageInput['style'][_0x1b8a46(0x196)]=Math[_0x1b8a46(0x181)](messageInput['scrollHeight'],0x78)+'px';}function a0_0x553c(){const _0x5602c8=['456810Evtydt','children','from','3YsDhhw','#050505','message\x20ai','getItem','innerHeight','replace','textContent','290922ddEOmq','initDataUnsafe','resize','93690xYRDLR','abort','createElement','stopPropagation','558614COkDOW','Enter','div','light','.message.show-delete','Удалить?','onClick','key','trim','clearBtn','Очистить\x20историю?','href','className','querySelectorAll','8772270drxlNa','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','auto','scrollHeight','min','231048cMXDwT','keydown','HapticFeedback','error','notificationOccurred','getMinutes','touchstart','add','user','confirmModal','padStart','impactOccurred','modalConfirm','addEventListener','offClick','username','messageInput','getElementById','modalText','style','height','POST','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','apply','forEach','flex','contains','classList','onclick','Telegram','paddingBottom','remove','input','innerHTML','1780434fknYhF','content','debug_uid','setItem','now','21wQJFnK','parse','appendChild','target','success','stringify','(((.+)+)+)+$','WebApp','splice','focus','signal','text','offsetHeight','scrollTop','setHeaderColor','floor','typingIndicator','length','8SDYEHT','shiftKey','constructor','emptyState','viewportChanged','delete-btn','text/plain','Ошибка\x20сервера','disableVerticalSwipes','display','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','json','search','modalCancel','push','random','BackButton','show-delete','expand','TG\x20setup\x20error:','isVersionAtLeast','inputArea','.container','show','ai_chat_messages','clear_history','chatArea','querySelector','viewportHeight','./router.html','toString','Действие\x20необратимо.','none','medium','value'];a0_0x553c=function(){return _0x5602c8;};return a0_0x553c();}function a0_0x4637(_0x5c4beb,_0x45b0f9){_0x5c4beb=_0x5c4beb-0x15e;const _0x56c723=a0_0x553c();let _0x160628=_0x56c723[_0x5c4beb];return _0x160628;}function updateSendButton(){const _0x2d5b82=a0_0x2c48f1,_0x4d583f=messageInput[_0x2d5b82(0x1dd)][_0x2d5b82(0x177)]();sendBtn['disabled']=!_0x4d583f||isTyping;}async function sendMessage(){const _0x2e256d=a0_0x2c48f1,_0x5550da=messageInput['value']['trim']();if(!_0x5550da||isTyping)return;if(tg?.[_0x2e256d(0x184)])tg[_0x2e256d(0x184)][_0x2e256d(0x18d)](_0x2e256d(0x172));messages[_0x2e256d(0x1c9)]({'role':_0x2e256d(0x18a),'content':_0x5550da,'timestamp':Date[_0x2e256d(0x1a8)]()}),localStorage['setItem'](_0x2e256d(0x1d3),JSON[_0x2e256d(0x1ae)](messages)),renderMessages(),messageInput[_0x2e256d(0x1dd)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2e256d(0x1ab)](createTypingIndicator()),chatArea[_0x2e256d(0x1b6)]=chatArea['scrollHeight'];const _0x1446d3=await callBackend('send_message',{'message':_0x5550da});isTyping=![];const _0x12883b=document[_0x2e256d(0x193)](_0x2e256d(0x1b9));if(_0x12883b)_0x12883b[_0x2e256d(0x1a1)]();let _0xd6bcd6='Ошибка\x20сети';if(_0x1446d3[_0x2e256d(0x1ad)]){_0xd6bcd6=_0x1446d3[_0x2e256d(0x1b4)]||'Пустой\x20ответ';if(tg?.[_0x2e256d(0x184)])tg[_0x2e256d(0x184)][_0x2e256d(0x186)]('success');}else{_0xd6bcd6=_0x1446d3[_0x2e256d(0x185)]||_0x2e256d(0x1c2);if(tg?.[_0x2e256d(0x184)])tg[_0x2e256d(0x184)][_0x2e256d(0x186)]('error');}messages['push']({'role':'ai','content':_0xd6bcd6,'timestamp':Date['now']()}),localStorage[_0x2e256d(0x1a7)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x4ccb34){const _0x3c4a29=a0_0x2c48f1;if(mTitle)mTitle[_0x3c4a29(0x167)]=_0x3c4a29(0x174);if(mText)mText[_0x3c4a29(0x167)]=_0x3c4a29(0x1da);modalCallback=()=>{const _0x59855b=_0x3c4a29;messages[_0x59855b(0x1b1)](_0x4ccb34,0x1),localStorage['setItem'](_0x59855b(0x1d3),JSON[_0x59855b(0x1ae)](messages)),renderMessages();},modal[_0x3c4a29(0x19d)][_0x3c4a29(0x189)]('show');}if(clearBtn)clearBtn[a0_0x2c48f1(0x19e)]=()=>{const _0x163bdf=a0_0x2c48f1;if(!messages[_0x163bdf(0x1ba)])return;if(mTitle)mTitle[_0x163bdf(0x167)]=_0x163bdf(0x179);if(mText)mText[_0x163bdf(0x167)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x2461a8=_0x163bdf;messages=[],localStorage['removeItem'](_0x2461a8(0x1d3)),renderMessages(),callBackend(_0x2461a8(0x1d4),{});},modal[_0x163bdf(0x19d)][_0x163bdf(0x189)](_0x163bdf(0x1d2));};document[a0_0x2c48f1(0x193)](a0_0x2c48f1(0x1c8))[a0_0x2c48f1(0x19e)]=()=>modal[a0_0x2c48f1(0x19d)][a0_0x2c48f1(0x1a1)](a0_0x2c48f1(0x1d2)),document[a0_0x2c48f1(0x193)](a0_0x2c48f1(0x18e))['onclick']=()=>{const _0x586227=a0_0x2c48f1;if(modalCallback)modalCallback();modal[_0x586227(0x19d)]['remove'](_0x586227(0x1d2));},messageInput[a0_0x2c48f1(0x18f)](a0_0x2c48f1(0x1a2),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x2c48f1(0x183),_0x13c126=>{const _0x2733a4=a0_0x2c48f1;_0x13c126[_0x2733a4(0x176)]===_0x2733a4(0x170)&&!_0x13c126[_0x2733a4(0x1bc)]&&(_0x13c126['preventDefault'](),sendMessage());}),sendBtn[a0_0x2c48f1(0x19e)]=sendMessage,document[a0_0x2c48f1(0x18f)]('click',_0x95fa69=>{const _0x468a0e=a0_0x2c48f1;document[_0x468a0e(0x17c)](_0x468a0e(0x173))[_0x468a0e(0x19a)](_0x438865=>{const _0xe1b45c=_0x468a0e;if(!_0x438865[_0xe1b45c(0x19c)](_0x95fa69[_0xe1b45c(0x1ac)]))_0x438865[_0xe1b45c(0x19d)][_0xe1b45c(0x1a1)]('show-delete');});});const saved=localStorage[a0_0x2c48f1(0x164)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x2c48f1(0x1aa)](saved),renderMessages();}catch(a0_0x33b4b8){}updateSendButton();