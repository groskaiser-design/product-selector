const a0_0x16dcba=a0_0x2015;(function(_0x513f4a,_0x3cd05c){const _0x643323=a0_0x2015,_0x189444=_0x513f4a();while(!![]){try{const _0x49a752=parseInt(_0x643323(0x1ad))/0x1*(-parseInt(_0x643323(0x171))/0x2)+-parseInt(_0x643323(0x1ae))/0x3*(-parseInt(_0x643323(0x17b))/0x4)+-parseInt(_0x643323(0x148))/0x5+parseInt(_0x643323(0x186))/0x6*(-parseInt(_0x643323(0x14b))/0x7)+-parseInt(_0x643323(0x1a3))/0x8+-parseInt(_0x643323(0x166))/0x9*(parseInt(_0x643323(0x144))/0xa)+parseInt(_0x643323(0x164))/0xb*(parseInt(_0x643323(0x1b7))/0xc);if(_0x49a752===_0x3cd05c)break;else _0x189444['push'](_0x189444['shift']());}catch(_0x99acd2){_0x189444['push'](_0x189444['shift']());}}}(a0_0x2229,0x18ac2));const tg=window[a0_0x16dcba(0x154)]?.[a0_0x16dcba(0x1c0)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x44d400=a0_0x16dcba,_0x4d20b6=(function(){let _0x489885=!![];return function(_0x17c1b6,_0x197fa0){const _0x561adf=_0x489885?function(){if(_0x197fa0){const _0x5038a7=_0x197fa0['apply'](_0x17c1b6,arguments);return _0x197fa0=null,_0x5038a7;}}:function(){};return _0x489885=![],_0x561adf;};}()),_0x101bba=_0x4d20b6(this,function(){const _0x15fde3=a0_0x2015;return _0x101bba[_0x15fde3(0x14d)]()[_0x15fde3(0x169)](_0x15fde3(0x1bd))[_0x15fde3(0x14d)]()['constructor'](_0x101bba)[_0x15fde3(0x169)]('(((.+)+)+)+$');});_0x101bba();if(!tg)return;try{tg[_0x44d400(0x150)](),tg[_0x44d400(0x1b4)](),tg[_0x44d400(0x194)]?.('#050505');if(tg[_0x44d400(0x1b9)]?.('6.1'))tg[_0x44d400(0x188)]?.();const _0x455fa2=tg['BackButton'];if(_0x455fa2){_0x455fa2[_0x44d400(0x15c)]();if(typeof _0x455fa2[_0x44d400(0x165)]===_0x44d400(0x16a))try{_0x455fa2[_0x44d400(0x165)]();}catch(_0x1d2fa6){}_0x455fa2[_0x44d400(0x14f)](()=>{const _0x9e9fe7=_0x44d400;if(tg[_0x9e9fe7(0x18b)])tg[_0x9e9fe7(0x18b)][_0x9e9fe7(0x167)](_0x9e9fe7(0x193));location[_0x9e9fe7(0x16e)]=HOME_URL;});}}catch(_0x2cf58d){console[_0x44d400(0x173)]('TG\x20setup\x20error:',_0x2cf58d);}}(function initStableLayout(){const _0x32e2e8=a0_0x16dcba,_0x1c3c0b=document[_0x32e2e8(0x157)](_0x32e2e8(0x197)),_0x296d08=document['getElementById']('inputArea'),_0x38be25=document[_0x32e2e8(0x178)](_0x32e2e8(0x16c)),_0x4a2d62=document['getElementById'](_0x32e2e8(0x1bc));function _0x3893eb(){const _0x10640d=_0x32e2e8;if(!_0x1c3c0b)return;const _0x55acfa=tg&&tg['viewportHeight']?tg[_0x10640d(0x1be)]:window[_0x10640d(0x187)];_0x1c3c0b[_0x10640d(0x13f)]['height']=_0x55acfa+'px';if(_0x296d08){const _0x3506a4=_0x296d08[_0x10640d(0x149)];_0x38be25['style'][_0x10640d(0x18d)]=_0x3506a4+0x28+'px';}}tg?tg[_0x32e2e8(0x1b8)](_0x32e2e8(0x1a1),({isStateStable:_0x26200b})=>{_0x3893eb();if(_0x26200b)requestAnimationFrame(()=>{const _0x54cbbc=a0_0x2015;_0x38be25[_0x54cbbc(0x174)]=_0x38be25[_0x54cbbc(0x16f)];});}):window[_0x32e2e8(0x176)](_0x32e2e8(0x16d),_0x3893eb),_0x3893eb(),_0x4a2d62&&(_0x4a2d62[_0x32e2e8(0x176)]('input',()=>{requestAnimationFrame(_0x3893eb);}),_0x4a2d62[_0x32e2e8(0x176)](_0x32e2e8(0x170),()=>{setTimeout(()=>{const _0x1f1a6d=a0_0x2015;_0x38be25['scrollTop']=_0x38be25[_0x1f1a6d(0x16f)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x16dcba(0x17c),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x2015(_0x49c7ed,_0x4eb0c2){_0x49c7ed=_0x49c7ed-0x13e;const _0x333af8=a0_0x2229();let _0x2dfdfc=_0x333af8[_0x49c7ed];return _0x2dfdfc;}const chatArea=document[a0_0x16dcba(0x178)](a0_0x16dcba(0x16c)),emptyState=document[a0_0x16dcba(0x178)](a0_0x16dcba(0x156)),messageInput=document[a0_0x16dcba(0x178)](a0_0x16dcba(0x1bc)),sendBtn=document[a0_0x16dcba(0x178)](a0_0x16dcba(0x1a0)),clearBtn=document[a0_0x16dcba(0x178)]('clearBtn'),modal=document[a0_0x16dcba(0x178)](a0_0x16dcba(0x19f)),mTitle=document[a0_0x16dcba(0x178)](a0_0x16dcba(0x1b2)),mText=document[a0_0x16dcba(0x178)](a0_0x16dcba(0x1b6));let modalCallback=null;async function callBackend(_0x4c19d1,_0x45703b){const _0x2c0e7a=a0_0x16dcba,_0x4f91f5=tg?.[_0x2c0e7a(0x1a8)]?.[_0x2c0e7a(0x1a6)]||{},_0x1be5c9=_0x4f91f5['id']||localStorage[_0x2c0e7a(0x177)](_0x2c0e7a(0x195))||'d-'+Math['floor'](Math[_0x2c0e7a(0x145)]()*0x3b9aca00);if(!_0x4f91f5['id'])localStorage[_0x2c0e7a(0x184)](_0x2c0e7a(0x195),_0x1be5c9);const _0x44c35d={'action':_0x4c19d1,'user_id':_0x1be5c9,'user_data':{'first_name':_0x4f91f5[_0x2c0e7a(0x199)],'username':_0x4f91f5[_0x2c0e7a(0x159)]},'init_data':tg?.[_0x2c0e7a(0x17f)]||'',..._0x45703b},_0x46848b=new AbortController(),_0x46b14f=setTimeout(()=>_0x46848b[_0x2c0e7a(0x1a2)](),REQUEST_TIMEOUT_MS);try{const _0x33f0a1=await fetch(BACKEND_URL,{'method':_0x2c0e7a(0x18f),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x2c0e7a(0x1a5)](_0x44c35d),'signal':_0x46848b[_0x2c0e7a(0x19b)]});return clearTimeout(_0x46b14f),await _0x33f0a1[_0x2c0e7a(0x1b0)]();}catch(_0x1607b5){return{'success':![],'error':String(_0x1607b5)};}}function formatTime(_0x19bc2d){const _0x49f861=a0_0x16dcba,_0x2c256b=new Date(_0x19bc2d);return String(_0x2c256b['getHours']())[_0x49f861(0x1ab)](0x2,'0')+':'+String(_0x2c256b[_0x49f861(0x161)]())['padStart'](0x2,'0');}function createMessageElement(_0x1f6eb9,_0x208613){const _0x3a8bd5=a0_0x16dcba,_0x31e7e3=document[_0x3a8bd5(0x19a)](_0x3a8bd5(0x1ba));_0x31e7e3['className']=_0x3a8bd5(0x18e)+_0x1f6eb9['role'];const _0xad063d=document[_0x3a8bd5(0x19a)](_0x3a8bd5(0x1ba));_0xad063d[_0x3a8bd5(0x147)]=_0x3a8bd5(0x19c),_0xad063d[_0x3a8bd5(0x175)]=_0x1f6eb9[_0x3a8bd5(0x162)]['replace'](/\n/g,_0x3a8bd5(0x172));const _0x5b20e1=document[_0x3a8bd5(0x19a)]('div');_0x5b20e1[_0x3a8bd5(0x147)]=_0x3a8bd5(0x17d),_0x5b20e1[_0x3a8bd5(0x175)]=_0x3a8bd5(0x190),_0x5b20e1[_0x3a8bd5(0x18a)]=_0x16d90b=>{const _0x29a159=_0x3a8bd5;_0x16d90b[_0x29a159(0x142)](),confirmDelete(_0x208613);};let _0x3f7b90;_0xad063d[_0x3a8bd5(0x176)](_0x3a8bd5(0x180),()=>_0x3f7b90=setTimeout(()=>{const _0xd3ef9d=_0x3a8bd5;_0x31e7e3['classList']['add'](_0xd3ef9d(0x15f));if(tg?.[_0xd3ef9d(0x18b)])tg['HapticFeedback'][_0xd3ef9d(0x167)](_0xd3ef9d(0x18c));},0x1f4)),_0xad063d[_0x3a8bd5(0x176)]('touchend',()=>clearTimeout(_0x3f7b90));const _0x2d3d56=document['createElement'](_0x3a8bd5(0x1ba));return _0x2d3d56['className']=_0x3a8bd5(0x198),_0x2d3d56[_0x3a8bd5(0x1ac)]=formatTime(_0x1f6eb9[_0x3a8bd5(0x1a4)]),_0x31e7e3[_0x3a8bd5(0x19e)](_0x5b20e1),_0x31e7e3['appendChild'](_0xad063d),_0x31e7e3[_0x3a8bd5(0x19e)](_0x2d3d56),_0x31e7e3;}function createTypingIndicator(){const _0x39b581=a0_0x16dcba,_0x15ce4a=document[_0x39b581(0x19a)](_0x39b581(0x1ba));return _0x15ce4a[_0x39b581(0x147)]=_0x39b581(0x15b),_0x15ce4a['id']=_0x39b581(0x185),_0x15ce4a['innerHTML']=_0x39b581(0x1b5),_0x15ce4a;}function renderMessages(){const _0x1403fe=a0_0x16dcba;Array[_0x1403fe(0x151)](chatArea[_0x1403fe(0x146)])[_0x1403fe(0x192)](_0x11a0c4=>{const _0x28dc42=_0x1403fe;if(_0x11a0c4['id']!=='emptyState')_0x11a0c4[_0x28dc42(0x1c1)]();}),messages['length']>0x0?(emptyState[_0x1403fe(0x13f)][_0x1403fe(0x189)]=_0x1403fe(0x13e),messages[_0x1403fe(0x192)]((_0x193813,_0x23cde3)=>chatArea[_0x1403fe(0x19e)](createMessageElement(_0x193813,_0x23cde3)))):emptyState[_0x1403fe(0x13f)][_0x1403fe(0x189)]=_0x1403fe(0x158),requestAnimationFrame(()=>chatArea[_0x1403fe(0x174)]=chatArea[_0x1403fe(0x16f)]);}function autoResizeTextarea(){const _0x21492f=a0_0x16dcba;messageInput[_0x21492f(0x13f)][_0x21492f(0x183)]=_0x21492f(0x1bf),messageInput[_0x21492f(0x13f)][_0x21492f(0x183)]=Math[_0x21492f(0x14c)](messageInput[_0x21492f(0x16f)],0x78)+'px';}function updateSendButton(){const _0xddd7c9=a0_0x16dcba,_0x2ebab6=messageInput['value'][_0xddd7c9(0x196)]();sendBtn[_0xddd7c9(0x17e)]=!_0x2ebab6||isTyping;}async function sendMessage(){const _0x7f4d87=a0_0x16dcba,_0x3200ce=messageInput['value']['trim']();if(!_0x3200ce||isTyping)return;if(tg?.[_0x7f4d87(0x18b)])tg[_0x7f4d87(0x18b)][_0x7f4d87(0x167)]('light');messages[_0x7f4d87(0x140)]({'role':_0x7f4d87(0x1a6),'content':_0x3200ce,'timestamp':Date[_0x7f4d87(0x143)]()}),localStorage[_0x7f4d87(0x184)]('ai_chat_messages',JSON[_0x7f4d87(0x1a5)](messages)),renderMessages(),messageInput[_0x7f4d87(0x15e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x7f4d87(0x19e)](createTypingIndicator()),chatArea[_0x7f4d87(0x174)]=chatArea[_0x7f4d87(0x16f)];const _0x183262=await callBackend('send_message',{'message':_0x3200ce});isTyping=![];const _0x3bfcdf=document['getElementById'](_0x7f4d87(0x185));if(_0x3bfcdf)_0x3bfcdf[_0x7f4d87(0x1c1)]();let _0x57cf6b=_0x7f4d87(0x1aa);if(_0x183262[_0x7f4d87(0x141)]){_0x57cf6b=_0x183262[_0x7f4d87(0x160)]||_0x7f4d87(0x179);if(tg?.[_0x7f4d87(0x18b)])tg[_0x7f4d87(0x18b)][_0x7f4d87(0x163)](_0x7f4d87(0x141));}else{_0x57cf6b=_0x183262['error']||'Ошибка\x20сервера';if(tg?.[_0x7f4d87(0x18b)])tg[_0x7f4d87(0x18b)][_0x7f4d87(0x163)](_0x7f4d87(0x14a));}messages[_0x7f4d87(0x140)]({'role':'ai','content':_0x57cf6b,'timestamp':Date[_0x7f4d87(0x143)]()}),localStorage[_0x7f4d87(0x184)](_0x7f4d87(0x191),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x2185d9){const _0x57133e=a0_0x16dcba;if(mTitle)mTitle[_0x57133e(0x1ac)]=_0x57133e(0x182);if(mText)mText[_0x57133e(0x1ac)]=_0x57133e(0x1af);modalCallback=()=>{const _0x1b3a53=_0x57133e;messages[_0x1b3a53(0x155)](_0x2185d9,0x1),localStorage['setItem'](_0x1b3a53(0x191),JSON[_0x1b3a53(0x1a5)](messages)),renderMessages();},modal[_0x57133e(0x1b1)][_0x57133e(0x15a)](_0x57133e(0x15c));}if(clearBtn)clearBtn['onclick']=()=>{const _0x7edc0c=a0_0x16dcba;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x7edc0c(0x168);if(mText)mText['textContent']=_0x7edc0c(0x1b3);modalCallback=async()=>{const _0x189675=_0x7edc0c;messages=[],localStorage[_0x189675(0x181)](_0x189675(0x191)),renderMessages(),callBackend(_0x189675(0x153),{});},modal['classList'][_0x7edc0c(0x15a)](_0x7edc0c(0x15c));};document[a0_0x16dcba(0x178)](a0_0x16dcba(0x14e))['onclick']=()=>modal[a0_0x16dcba(0x1b1)][a0_0x16dcba(0x1c1)](a0_0x16dcba(0x15c)),document['getElementById']('modalConfirm')[a0_0x16dcba(0x18a)]=()=>{const _0x3bc42e=a0_0x16dcba;if(modalCallback)modalCallback();modal[_0x3bc42e(0x1b1)][_0x3bc42e(0x1c1)](_0x3bc42e(0x15c));},messageInput[a0_0x16dcba(0x176)](a0_0x16dcba(0x1bb),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x16dcba(0x176)](a0_0x16dcba(0x19d),_0x4e4419=>{const _0x757652=a0_0x16dcba;_0x4e4419['key']===_0x757652(0x152)&&!_0x4e4419[_0x757652(0x15d)]&&(_0x4e4419[_0x757652(0x1a7)](),sendMessage());}),sendBtn[a0_0x16dcba(0x18a)]=sendMessage,document[a0_0x16dcba(0x176)](a0_0x16dcba(0x17a),_0x552da7=>{const _0x108357=a0_0x16dcba;document[_0x108357(0x1a9)](_0x108357(0x16b))[_0x108357(0x192)](_0x1be7d7=>{const _0x30ec5c=_0x108357;if(!_0x1be7d7['contains'](_0x552da7['target']))_0x1be7d7[_0x30ec5c(0x1b1)][_0x30ec5c(0x1c1)](_0x30ec5c(0x15f));});});function a0_0x2229(){const _0x401c50=['onEvent','isVersionAtLeast','div','input','messageInput','(((.+)+)+)+$','viewportHeight','auto','WebApp','remove','none','style','push','success','stopPropagation','now','10dKhfkA','random','children','className','413980pQNpjY','offsetHeight','error','14fNrQRE','min','toString','modalCancel','onClick','ready','from','Enter','clear_history','Telegram','splice','emptyState','querySelector','flex','username','add','message\x20ai','show','shiftKey','value','show-delete','text','getMinutes','content','notificationOccurred','539IiDakT','offClick','448425KCmCwT','impactOccurred','Очистить\x20историю?','search','function','.message.show-delete','chatArea','resize','href','scrollHeight','focus','7796lkvGuL','<br>','warn','scrollTop','innerHTML','addEventListener','getItem','getElementById','Пустой\x20ответ','click','8mZfpBF','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','delete-btn','disabled','initData','touchstart','removeItem','Удалить?','height','setItem','typingIndicator','299496qlBbaY','innerHeight','disableVerticalSwipes','display','onclick','HapticFeedback','medium','paddingBottom','message\x20','POST','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','ai_chat_messages','forEach','light','setHeaderColor','debug_uid','trim','.container','message-time','first_name','createElement','signal','message-bubble','keydown','appendChild','confirmModal','sendBtn','viewportChanged','abort','948192DQEDBz','timestamp','stringify','user','preventDefault','initDataUnsafe','querySelectorAll','Ошибка\x20сети','padStart','textContent','11kbNJKm','80943DLCyLL','Действие\x20необратимо.','json','classList','modalTitle','Начнется\x20новый\x20диалог.','expand','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','modalText','107988QKJxup'];a0_0x2229=function(){return _0x401c50;};return a0_0x2229();}const saved=localStorage[a0_0x16dcba(0x177)](a0_0x16dcba(0x191));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x1f347e){}updateSendButton();