const a0_0x199e92=a0_0x1b23;(function(_0x5da07c,_0x36494d){const _0x36d303=a0_0x1b23,_0x85401a=_0x5da07c();while(!![]){try{const _0x34d0a5=parseInt(_0x36d303(0xda))/0x1*(-parseInt(_0x36d303(0xf5))/0x2)+parseInt(_0x36d303(0x10c))/0x3+-parseInt(_0x36d303(0x11b))/0x4+-parseInt(_0x36d303(0x108))/0x5+parseInt(_0x36d303(0xcd))/0x6+-parseInt(_0x36d303(0xfb))/0x7*(parseInt(_0x36d303(0xe2))/0x8)+-parseInt(_0x36d303(0xe6))/0x9*(-parseInt(_0x36d303(0xed))/0xa);if(_0x34d0a5===_0x36494d)break;else _0x85401a['push'](_0x85401a['shift']());}catch(_0xf56853){_0x85401a['push'](_0x85401a['shift']());}}}(a0_0x28c7,0x73221));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x199e92(0xce);function setupTelegramBackButton(){const _0x4e6d8c=a0_0x199e92;if(!tg)return;try{tg['ready'](),tg[_0x4e6d8c(0xfe)](),tg['setHeaderColor']?.(_0x4e6d8c(0x11d));if(tg['isVersionAtLeast']?.(_0x4e6d8c(0xd1)))tg[_0x4e6d8c(0xdb)]?.();const _0x468586=tg[_0x4e6d8c(0xe4)];if(_0x468586){_0x468586['show']();if(typeof _0x468586['offClick']==='function')try{_0x468586[_0x4e6d8c(0x112)]();}catch(_0x4e20ca){}_0x468586[_0x4e6d8c(0x12b)](()=>{const _0x35dc91=_0x4e6d8c;if(tg[_0x35dc91(0xe1)])tg[_0x35dc91(0xe1)][_0x35dc91(0x117)](_0x35dc91(0x126));location[_0x35dc91(0xe3)]=HOME_URL;});}}catch(_0x120c9d){console[_0x4e6d8c(0x122)](_0x4e6d8c(0xd6),_0x120c9d);}}(function initStableLayout(){const _0x2973be=a0_0x199e92,_0xdbf091=(function(){let _0x24a007=!![];return function(_0x484631,_0x2df1e3){const _0x5919ec=_0x24a007?function(){const _0x226b06=a0_0x1b23;if(_0x2df1e3){const _0x398cce=_0x2df1e3[_0x226b06(0x114)](_0x484631,arguments);return _0x2df1e3=null,_0x398cce;}}:function(){};return _0x24a007=![],_0x5919ec;};}()),_0x173564=document[_0x2973be(0xfd)]('.container'),_0x42cf76=document[_0x2973be(0xd0)](_0x2973be(0xf6)),_0x5c416d=document['getElementById']('chatArea'),_0x11a750=document[_0x2973be(0xd0)](_0x2973be(0xf1));function _0x57210d(){const _0x5c3129=_0x2973be,_0x32a8ab=_0xdbf091(this,function(){const _0x5b0eb5=a0_0x1b23;return _0x32a8ab['toString']()[_0x5b0eb5(0x10b)](_0x5b0eb5(0xe8))['toString']()['constructor'](_0x32a8ab)[_0x5b0eb5(0x10b)]('(((.+)+)+)+$');});_0x32a8ab();if(!_0x173564)return;const _0xfdb2fd=tg&&tg[_0x5c3129(0xcf)]?tg[_0x5c3129(0xcf)]:window[_0x5c3129(0x132)];_0x173564[_0x5c3129(0x11c)]['height']=_0xfdb2fd+'px';if(_0x42cf76){const _0x824e53=_0x42cf76[_0x5c3129(0xd7)];_0x5c416d[_0x5c3129(0x11c)][_0x5c3129(0x12c)]=_0x824e53+0x28+'px';}}tg?tg['onEvent'](_0x2973be(0xde),({isStateStable:_0x1cd3e8})=>{_0x57210d();if(_0x1cd3e8)requestAnimationFrame(()=>{_0x5c416d['scrollTop']=_0x5c416d['scrollHeight'];});}):window['addEventListener'](_0x2973be(0x138),_0x57210d),_0x57210d(),_0x11a750&&(_0x11a750['addEventListener'](_0x2973be(0xee),()=>{requestAnimationFrame(_0x57210d);}),_0x11a750[_0x2973be(0xdc)](_0x2973be(0xf2),()=>{setTimeout(()=>{const _0x554c0f=a0_0x1b23;_0x5c416d[_0x554c0f(0xc7)]=_0x5c416d['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x199e92(0x110),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x199e92(0xd0)](a0_0x199e92(0x11a)),emptyState=document[a0_0x199e92(0xd0)](a0_0x199e92(0xe0)),messageInput=document[a0_0x199e92(0xd0)](a0_0x199e92(0xf1)),sendBtn=document[a0_0x199e92(0xd0)]('sendBtn'),clearBtn=document[a0_0x199e92(0xd0)]('clearBtn'),modal=document[a0_0x199e92(0xd0)](a0_0x199e92(0x118)),mTitle=document[a0_0x199e92(0xd0)](a0_0x199e92(0x113)),mText=document[a0_0x199e92(0xd0)]('modalText');let modalCallback=null;async function callBackend(_0xbce3d5,_0xb20c77){const _0x225a35=a0_0x199e92,_0x282353=tg?.[_0x225a35(0x124)]?.[_0x225a35(0x130)]||{},_0x4da09e=_0x282353['id']||localStorage[_0x225a35(0x12a)]('debug_uid')||'d-'+Math['floor'](Math[_0x225a35(0xeb)]()*0x3b9aca00);if(!_0x282353['id'])localStorage[_0x225a35(0xf7)](_0x225a35(0x125),_0x4da09e);const _0x5b56f8={'action':_0xbce3d5,'user_id':_0x4da09e,'user_data':{'first_name':_0x282353['first_name'],'username':_0x282353[_0x225a35(0xcc)]},'init_data':tg?.[_0x225a35(0x11e)]||'',..._0xb20c77},_0x558cba=new AbortController(),_0x33e46e=setTimeout(()=>_0x558cba[_0x225a35(0x116)](),REQUEST_TIMEOUT_MS);try{const _0x517c6a=await fetch(BACKEND_URL,{'method':_0x225a35(0x10e),'headers':{'Content-Type':_0x225a35(0x121)},'body':JSON[_0x225a35(0xf3)](_0x5b56f8),'signal':_0x558cba[_0x225a35(0x115)]});return clearTimeout(_0x33e46e),await _0x517c6a['json']();}catch(_0x2dfe8f){return{'success':![],'error':String(_0x2dfe8f)};}}function formatTime(_0x54037f){const _0x29578f=a0_0x199e92,_0x10f8dd=new Date(_0x54037f);return String(_0x10f8dd['getHours']())['padStart'](0x2,'0')+':'+String(_0x10f8dd[_0x29578f(0x136)]())['padStart'](0x2,'0');}function a0_0x28c7(){const _0x597774=['.message.show-delete','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','success','offClick','modalTitle','apply','signal','abort','impactOccurred','confirmModal','contains','chatArea','1242544WRnbAb','style','#050505','initData','from','click','text/plain','warn','Enter','initDataUnsafe','debug_uid','light','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','target','auto','getItem','onClick','paddingBottom','medium','onclick','disabled','user','trim','innerHeight','textContent','forEach','min','getMinutes','Ошибка\x20сервера','resize','push','splice','add','scrollTop','scrollHeight','notificationOccurred','createElement','ai_chat_messages','username','2635086MvjDUZ','./router.html','viewportHeight','getElementById','6.1','removeItem','content','error','length','TG\x20setup\x20error:','offsetHeight','shiftKey','send_message','1rjEIEn','disableVerticalSwipes','addEventListener','height','viewportChanged','remove','emptyState','HapticFeedback','179544QnCDSm','href','BackButton','none','2502vISAXN','Пустой\x20ответ','(((.+)+)+)+$','timestamp','typingIndicator','random','message-time','71640lXXuRC','input','display','innerHTML','messageInput','focus','stringify','children','1546186MUStPa','inputArea','setItem','clear_history','className','touchstart','266AtRhlc','modalConfirm','querySelector','expand','modalCancel','div','show','<br>','appendChild','classList','role','now','Удалить?','709165qpVhgy','preventDefault','value','search','357624xhGIaS','show-delete','POST'];a0_0x28c7=function(){return _0x597774;};return a0_0x28c7();}function createMessageElement(_0x47375d,_0x38dae2){const _0x350075=a0_0x199e92,_0x5bbc5c=document[_0x350075(0xca)]('div');_0x5bbc5c[_0x350075(0xf9)]='message\x20'+_0x47375d[_0x350075(0x105)];const _0x172276=document[_0x350075(0xca)](_0x350075(0x100));_0x172276[_0x350075(0xf9)]='message-bubble',_0x172276[_0x350075(0xf0)]=_0x47375d[_0x350075(0xd3)]['replace'](/\n/g,_0x350075(0x102));const _0x3ebe02=document[_0x350075(0xca)](_0x350075(0x100));_0x3ebe02[_0x350075(0xf9)]='delete-btn',_0x3ebe02[_0x350075(0xf0)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x3ebe02[_0x350075(0x12e)]=_0x24631c=>{_0x24631c['stopPropagation'](),confirmDelete(_0x38dae2);};let _0x3cce38;_0x172276[_0x350075(0xdc)](_0x350075(0xfa),()=>_0x3cce38=setTimeout(()=>{const _0x5291e4=_0x350075;_0x5bbc5c['classList'][_0x5291e4(0xc6)]('show-delete');if(tg?.[_0x5291e4(0xe1)])tg[_0x5291e4(0xe1)][_0x5291e4(0x117)](_0x5291e4(0x12d));},0x1f4)),_0x172276[_0x350075(0xdc)]('touchend',()=>clearTimeout(_0x3cce38));const _0x3620f2=document[_0x350075(0xca)]('div');return _0x3620f2[_0x350075(0xf9)]=_0x350075(0xec),_0x3620f2['textContent']=formatTime(_0x47375d[_0x350075(0xe9)]),_0x5bbc5c[_0x350075(0x103)](_0x3ebe02),_0x5bbc5c[_0x350075(0x103)](_0x172276),_0x5bbc5c['appendChild'](_0x3620f2),_0x5bbc5c;}function createTypingIndicator(){const _0x474658=a0_0x199e92,_0x1d01ff=document[_0x474658(0xca)](_0x474658(0x100));return _0x1d01ff['className']='message\x20ai',_0x1d01ff['id']='typingIndicator',_0x1d01ff[_0x474658(0xf0)]=_0x474658(0x127),_0x1d01ff;}function a0_0x1b23(_0x1857d9,_0x2ce2cf){_0x1857d9=_0x1857d9-0xc4;const _0x2bb9b3=a0_0x28c7();let _0x1588f0=_0x2bb9b3[_0x1857d9];return _0x1588f0;}function renderMessages(){const _0x5274ee=a0_0x199e92;Array[_0x5274ee(0x11f)](chatArea[_0x5274ee(0xf4)])[_0x5274ee(0x134)](_0x4ef810=>{const _0x36e907=_0x5274ee;if(_0x4ef810['id']!==_0x36e907(0xe0))_0x4ef810[_0x36e907(0xdf)]();}),messages[_0x5274ee(0xd5)]>0x0?(emptyState['style'][_0x5274ee(0xef)]=_0x5274ee(0xe5),messages[_0x5274ee(0x134)]((_0x432280,_0x55f54d)=>chatArea[_0x5274ee(0x103)](createMessageElement(_0x432280,_0x55f54d)))):emptyState[_0x5274ee(0x11c)]['display']='flex',requestAnimationFrame(()=>chatArea[_0x5274ee(0xc7)]=chatArea[_0x5274ee(0xc8)]);}function autoResizeTextarea(){const _0x220c95=a0_0x199e92;messageInput[_0x220c95(0x11c)][_0x220c95(0xdd)]=_0x220c95(0x129),messageInput[_0x220c95(0x11c)][_0x220c95(0xdd)]=Math[_0x220c95(0x135)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x340f22=a0_0x199e92,_0x55b07c=messageInput[_0x340f22(0x10a)][_0x340f22(0x131)]();sendBtn[_0x340f22(0x12f)]=!_0x55b07c||isTyping;}async function sendMessage(){const _0x8b37a=a0_0x199e92,_0x3f2f7c=messageInput[_0x8b37a(0x10a)]['trim']();if(!_0x3f2f7c||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x8b37a(0xe1)][_0x8b37a(0x117)](_0x8b37a(0x126));messages[_0x8b37a(0xc4)]({'role':'user','content':_0x3f2f7c,'timestamp':Date[_0x8b37a(0x106)]()}),localStorage[_0x8b37a(0xf7)](_0x8b37a(0xcb),JSON[_0x8b37a(0xf3)](messages)),renderMessages(),messageInput[_0x8b37a(0x10a)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x8b37a(0x103)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x8b37a(0xc8)];const _0x323dba=await callBackend(_0x8b37a(0xd9),{'message':_0x3f2f7c});isTyping=![];const _0x243f3d=document['getElementById'](_0x8b37a(0xea));if(_0x243f3d)_0x243f3d['remove']();let _0x332e92='Ошибка\x20сети';if(_0x323dba[_0x8b37a(0x111)]){_0x332e92=_0x323dba['text']||_0x8b37a(0xe7);if(tg?.[_0x8b37a(0xe1)])tg[_0x8b37a(0xe1)][_0x8b37a(0xc9)]('success');}else{_0x332e92=_0x323dba[_0x8b37a(0xd4)]||_0x8b37a(0x137);if(tg?.[_0x8b37a(0xe1)])tg[_0x8b37a(0xe1)][_0x8b37a(0xc9)](_0x8b37a(0xd4));}messages[_0x8b37a(0xc4)]({'role':'ai','content':_0x332e92,'timestamp':Date[_0x8b37a(0x106)]()}),localStorage[_0x8b37a(0xf7)]('ai_chat_messages',JSON[_0x8b37a(0xf3)](messages)),renderMessages();}function confirmDelete(_0x2aa91b){const _0x353c1c=a0_0x199e92;if(mTitle)mTitle[_0x353c1c(0x133)]=_0x353c1c(0x107);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x5efdce=_0x353c1c;messages[_0x5efdce(0xc5)](_0x2aa91b,0x1),localStorage[_0x5efdce(0xf7)](_0x5efdce(0xcb),JSON[_0x5efdce(0xf3)](messages)),renderMessages();},modal['classList'][_0x353c1c(0xc6)](_0x353c1c(0x101));}if(clearBtn)clearBtn['onclick']=()=>{const _0x1d83fe=a0_0x199e92;if(!messages[_0x1d83fe(0xd5)])return;if(mTitle)mTitle[_0x1d83fe(0x133)]='Очистить\x20историю?';if(mText)mText[_0x1d83fe(0x133)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x452ae3=_0x1d83fe;messages=[],localStorage[_0x452ae3(0xd2)](_0x452ae3(0xcb)),renderMessages(),callBackend(_0x452ae3(0xf8),{});},modal[_0x1d83fe(0x104)][_0x1d83fe(0xc6)]('show');};document[a0_0x199e92(0xd0)](a0_0x199e92(0xff))[a0_0x199e92(0x12e)]=()=>modal[a0_0x199e92(0x104)][a0_0x199e92(0xdf)](a0_0x199e92(0x101)),document[a0_0x199e92(0xd0)](a0_0x199e92(0xfc))['onclick']=()=>{const _0x107261=a0_0x199e92;if(modalCallback)modalCallback();modal[_0x107261(0x104)][_0x107261(0xdf)](_0x107261(0x101));},messageInput[a0_0x199e92(0xdc)](a0_0x199e92(0xee),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x199e92(0xdc)]('keydown',_0x235c41=>{const _0x15947e=a0_0x199e92;_0x235c41['key']===_0x15947e(0x123)&&!_0x235c41[_0x15947e(0xd8)]&&(_0x235c41[_0x15947e(0x109)](),sendMessage());}),sendBtn[a0_0x199e92(0x12e)]=sendMessage,document[a0_0x199e92(0xdc)](a0_0x199e92(0x120),_0x560130=>{const _0x317474=a0_0x199e92;document['querySelectorAll'](_0x317474(0x10f))[_0x317474(0x134)](_0x5e595a=>{const _0x3a647c=_0x317474;if(!_0x5e595a[_0x3a647c(0x119)](_0x560130[_0x3a647c(0x128)]))_0x5e595a[_0x3a647c(0x104)][_0x3a647c(0xdf)](_0x3a647c(0x10d));});});const saved=localStorage[a0_0x199e92(0x12a)](a0_0x199e92(0xcb));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x5273ad){}updateSendButton();