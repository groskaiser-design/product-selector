const a0_0x3a982d=a0_0x4079;(function(_0x3f2331,_0x5bbd31){const _0x287596=a0_0x4079,_0x332b55=_0x3f2331();while(!![]){try{const _0x2afbb4=-parseInt(_0x287596(0x1b1))/0x1*(parseInt(_0x287596(0x163))/0x2)+-parseInt(_0x287596(0x1a5))/0x3+-parseInt(_0x287596(0x159))/0x4*(parseInt(_0x287596(0x1b5))/0x5)+parseInt(_0x287596(0x176))/0x6*(-parseInt(_0x287596(0x1bd))/0x7)+-parseInt(_0x287596(0x145))/0x8*(parseInt(_0x287596(0x17d))/0x9)+parseInt(_0x287596(0x152))/0xa+-parseInt(_0x287596(0x19e))/0xb*(-parseInt(_0x287596(0x198))/0xc);if(_0x2afbb4===_0x5bbd31)break;else _0x332b55['push'](_0x332b55['shift']());}catch(_0x57b675){_0x332b55['push'](_0x332b55['shift']());}}}(a0_0x3ae9,0x558eb));const tg=window[a0_0x3a982d(0x16f)]?.['WebApp'],HOME_URL=a0_0x3a982d(0x182);function setupTelegramBackButton(){const _0x1157fe=a0_0x3a982d;if(!tg)return;try{tg[_0x1157fe(0x1b8)](),tg[_0x1157fe(0x1b7)](),tg['setHeaderColor']?.(_0x1157fe(0x18b));if(tg[_0x1157fe(0x154)]?.(_0x1157fe(0x158)))tg[_0x1157fe(0x189)]?.();const _0x57bc50=tg[_0x1157fe(0x147)];if(_0x57bc50){_0x57bc50['show']();if(typeof _0x57bc50['offClick']==='function')try{_0x57bc50[_0x1157fe(0x156)]();}catch(_0x2a3828){}_0x57bc50[_0x1157fe(0x17f)](()=>{const _0x520159=_0x1157fe;if(tg[_0x520159(0x181)])tg[_0x520159(0x181)][_0x520159(0x166)](_0x520159(0x19f));location[_0x520159(0x168)]=HOME_URL;});}}catch(_0x5229db){console[_0x1157fe(0x1a7)](_0x1157fe(0x14e),_0x5229db);}}(function initStableLayout(){const _0xc7a197=a0_0x3a982d,_0x3a76a9=(function(){let _0x4192bc=!![];return function(_0xb138d8,_0xb8c4a3){const _0x96379f=_0x4192bc?function(){const _0x2bc041=a0_0x4079;if(_0xb8c4a3){const _0x576ae6=_0xb8c4a3[_0x2bc041(0x164)](_0xb138d8,arguments);return _0xb8c4a3=null,_0x576ae6;}}:function(){};return _0x4192bc=![],_0x96379f;};}()),_0xe4bca4=document[_0xc7a197(0x160)](_0xc7a197(0x187)),_0x386f0a=document[_0xc7a197(0x180)](_0xc7a197(0x16c)),_0x34a600=document['getElementById'](_0xc7a197(0x14b)),_0x5eed79=document[_0xc7a197(0x180)](_0xc7a197(0x174));function _0xa01df0(){const _0x596bbd=_0xc7a197,_0x1abc29=_0x3a76a9(this,function(){const _0x2ed591=a0_0x4079;return _0x1abc29[_0x2ed591(0x18c)]()[_0x2ed591(0x148)](_0x2ed591(0x1b4))[_0x2ed591(0x18c)]()['constructor'](_0x1abc29)['search'](_0x2ed591(0x1b4));});_0x1abc29();if(!_0xe4bca4)return;const _0x2fd859=tg&&tg[_0x596bbd(0x1b9)]?tg['viewportHeight']:window[_0x596bbd(0x144)];_0xe4bca4[_0x596bbd(0x1b0)][_0x596bbd(0x155)]=_0x2fd859+'px';if(_0x386f0a){const _0x4b9e97=_0x386f0a[_0x596bbd(0x19d)];_0x34a600[_0x596bbd(0x1b0)][_0x596bbd(0x143)]=_0x4b9e97+0x28+'px';}}tg?tg[_0xc7a197(0x162)](_0xc7a197(0x18e),({isStateStable:_0x2506a8})=>{_0xa01df0();if(_0x2506a8)requestAnimationFrame(()=>{const _0x189c2a=a0_0x4079;_0x34a600[_0x189c2a(0x191)]=_0x34a600[_0x189c2a(0x186)];});}):window[_0xc7a197(0x183)](_0xc7a197(0x188),_0xa01df0),_0xa01df0(),_0x5eed79&&(_0x5eed79['addEventListener'](_0xc7a197(0x1ad),()=>{requestAnimationFrame(_0xa01df0);}),_0x5eed79[_0xc7a197(0x183)](_0xc7a197(0x17c),()=>{setTimeout(()=>{const _0x59d01b=a0_0x4079;_0x34a600['scrollTop']=_0x34a600[_0x59d01b(0x186)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3a982d(0x180)]('chatArea'),emptyState=document[a0_0x3a982d(0x180)](a0_0x3a982d(0x1a4)),messageInput=document[a0_0x3a982d(0x180)](a0_0x3a982d(0x174)),sendBtn=document[a0_0x3a982d(0x180)](a0_0x3a982d(0x16d)),clearBtn=document[a0_0x3a982d(0x180)]('clearBtn'),modal=document[a0_0x3a982d(0x180)](a0_0x3a982d(0x190)),mTitle=document['getElementById'](a0_0x3a982d(0x149)),mText=document['getElementById'](a0_0x3a982d(0x1be));function a0_0x3ae9(){const _0x391098=['6.1','551596zsSlQp','typingIndicator','json','key','modalConfirm','content','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','querySelector','add','onEvent','86102CCmNFt','apply','medium','impactOccurred','setItem','href','ai_chat_messages','forEach','debug_uid','inputArea','sendBtn','first_name','Telegram','touchstart','children','show-delete','className','messageInput','keydown','6BBImrk','<br>','padStart','length','trim','createElement','focus','2148813dAqNIR','getMinutes','onClick','getElementById','HapticFeedback','./router.html','addEventListener','clear_history','querySelectorAll','scrollHeight','.container','resize','disableVerticalSwipes','delete-btn','#050505','toString','abort','viewportChanged','stopPropagation','confirmModal','scrollTop','push','Удалить?','classList','remove','Начнется\x20новый\x20диалог.','getItem','163128WuLpRi','Ошибка\x20сети','random','appendChild','replace','offsetHeight','1199LlFtiO','light','show','min','value','stringify','emptyState','442050tiPBGo','Очистить\x20историю?','warn','Пустой\x20ответ','message\x20ai','error','floor','auto','input','none','Ошибка\x20сервера','style','10JxfwhQ','contains','onclick','(((.+)+)+)+$','5YfPmEU','message-bubble','expand','ready','viewportHeight','POST','div','target','3930913gLIUdK','modalText','text/plain','success','send_message','initData','textContent','initDataUnsafe','innerHTML','username','message-time','paddingBottom','innerHeight','16jlSedV','splice','BackButton','search','modalTitle','notificationOccurred','chatArea','display','user','TG\x20setup\x20error:','shiftKey','modalCancel','text','6235290SdTOUy','signal','isVersionAtLeast','height','offClick','Действие\x20необратимо.'];a0_0x3ae9=function(){return _0x391098;};return a0_0x3ae9();}let modalCallback=null;async function callBackend(_0x3069dc,_0x474f01){const _0x3ac3c4=a0_0x3a982d,_0x3cdc8b=tg?.[_0x3ac3c4(0x13f)]?.[_0x3ac3c4(0x14d)]||{},_0x121ad9=_0x3cdc8b['id']||localStorage[_0x3ac3c4(0x197)](_0x3ac3c4(0x16b))||'d-'+Math[_0x3ac3c4(0x1ab)](Math[_0x3ac3c4(0x19a)]()*0x3b9aca00);if(!_0x3cdc8b['id'])localStorage[_0x3ac3c4(0x167)](_0x3ac3c4(0x16b),_0x121ad9);const _0x596faf={'action':_0x3069dc,'user_id':_0x121ad9,'user_data':{'first_name':_0x3cdc8b[_0x3ac3c4(0x16e)],'username':_0x3cdc8b[_0x3ac3c4(0x141)]},'init_data':tg?.[_0x3ac3c4(0x13d)]||'',..._0x474f01},_0x39d95f=new AbortController(),_0x346c56=setTimeout(()=>_0x39d95f[_0x3ac3c4(0x18d)](),REQUEST_TIMEOUT_MS);try{const _0x34b908=await fetch(BACKEND_URL,{'method':_0x3ac3c4(0x1ba),'headers':{'Content-Type':_0x3ac3c4(0x1bf)},'body':JSON['stringify'](_0x596faf),'signal':_0x39d95f[_0x3ac3c4(0x153)]});return clearTimeout(_0x346c56),await _0x34b908[_0x3ac3c4(0x15b)]();}catch(_0x5452b2){return{'success':![],'error':String(_0x5452b2)};}}function formatTime(_0x367680){const _0x3a54f2=a0_0x3a982d,_0x1cf6fd=new Date(_0x367680);return String(_0x1cf6fd['getHours']())[_0x3a54f2(0x178)](0x2,'0')+':'+String(_0x1cf6fd[_0x3a54f2(0x17e)]())[_0x3a54f2(0x178)](0x2,'0');}function createMessageElement(_0x4ac8c4,_0x1d247){const _0x45c828=a0_0x3a982d,_0x58f142=document[_0x45c828(0x17b)](_0x45c828(0x1bb));_0x58f142[_0x45c828(0x173)]='message\x20'+_0x4ac8c4['role'];const _0x56065f=document[_0x45c828(0x17b)](_0x45c828(0x1bb));_0x56065f[_0x45c828(0x173)]=_0x45c828(0x1b6),_0x56065f[_0x45c828(0x140)]=_0x4ac8c4[_0x45c828(0x15e)][_0x45c828(0x19c)](/\n/g,_0x45c828(0x177));const _0x1b6eb8=document['createElement'](_0x45c828(0x1bb));_0x1b6eb8['className']=_0x45c828(0x18a),_0x1b6eb8['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x1b6eb8[_0x45c828(0x1b3)]=_0x380bb9=>{const _0x354964=_0x45c828;_0x380bb9[_0x354964(0x18f)](),confirmDelete(_0x1d247);};let _0x2e1285;_0x56065f[_0x45c828(0x183)](_0x45c828(0x170),()=>_0x2e1285=setTimeout(()=>{const _0x1bd32d=_0x45c828;_0x58f142[_0x1bd32d(0x194)]['add'](_0x1bd32d(0x172));if(tg?.[_0x1bd32d(0x181)])tg['HapticFeedback'][_0x1bd32d(0x166)](_0x1bd32d(0x165));},0x1f4)),_0x56065f[_0x45c828(0x183)]('touchend',()=>clearTimeout(_0x2e1285));const _0x3a796d=document[_0x45c828(0x17b)]('div');return _0x3a796d[_0x45c828(0x173)]=_0x45c828(0x142),_0x3a796d[_0x45c828(0x13e)]=formatTime(_0x4ac8c4['timestamp']),_0x58f142[_0x45c828(0x19b)](_0x1b6eb8),_0x58f142[_0x45c828(0x19b)](_0x56065f),_0x58f142[_0x45c828(0x19b)](_0x3a796d),_0x58f142;}function a0_0x4079(_0x3857d6,_0x4752cd){_0x3857d6=_0x3857d6-0x13d;const _0x1adff8=a0_0x3ae9();let _0x36e65d=_0x1adff8[_0x3857d6];return _0x36e65d;}function createTypingIndicator(){const _0x5e1d9c=a0_0x3a982d,_0x4993c5=document[_0x5e1d9c(0x17b)](_0x5e1d9c(0x1bb));return _0x4993c5[_0x5e1d9c(0x173)]=_0x5e1d9c(0x1a9),_0x4993c5['id']=_0x5e1d9c(0x15a),_0x4993c5[_0x5e1d9c(0x140)]=_0x5e1d9c(0x15f),_0x4993c5;}function renderMessages(){const _0x40e476=a0_0x3a982d;Array['from'](chatArea[_0x40e476(0x171)])['forEach'](_0x24dfe1=>{const _0x316f9b=_0x40e476;if(_0x24dfe1['id']!==_0x316f9b(0x1a4))_0x24dfe1['remove']();}),messages[_0x40e476(0x179)]>0x0?(emptyState[_0x40e476(0x1b0)]['display']=_0x40e476(0x1ae),messages['forEach']((_0x58a3bb,_0x1c1466)=>chatArea['appendChild'](createMessageElement(_0x58a3bb,_0x1c1466)))):emptyState[_0x40e476(0x1b0)][_0x40e476(0x14c)]='flex',requestAnimationFrame(()=>chatArea[_0x40e476(0x191)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x2f1b39=a0_0x3a982d;messageInput[_0x2f1b39(0x1b0)][_0x2f1b39(0x155)]=_0x2f1b39(0x1ac),messageInput[_0x2f1b39(0x1b0)][_0x2f1b39(0x155)]=Math[_0x2f1b39(0x1a1)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x105c07=a0_0x3a982d,_0x509e19=messageInput[_0x105c07(0x1a2)][_0x105c07(0x17a)]();sendBtn['disabled']=!_0x509e19||isTyping;}async function sendMessage(){const _0x5a2f4f=a0_0x3a982d,_0x5732f8=messageInput['value'][_0x5a2f4f(0x17a)]();if(!_0x5732f8||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback']['impactOccurred']('light');messages[_0x5a2f4f(0x192)]({'role':_0x5a2f4f(0x14d),'content':_0x5732f8,'timestamp':Date['now']()}),localStorage[_0x5a2f4f(0x167)]('ai_chat_messages',JSON[_0x5a2f4f(0x1a3)](messages)),renderMessages(),messageInput[_0x5a2f4f(0x1a2)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5a2f4f(0x19b)](createTypingIndicator()),chatArea[_0x5a2f4f(0x191)]=chatArea[_0x5a2f4f(0x186)];const _0x4b794a=await callBackend(_0x5a2f4f(0x1c1),{'message':_0x5732f8});isTyping=![];const _0x37161b=document[_0x5a2f4f(0x180)](_0x5a2f4f(0x15a));if(_0x37161b)_0x37161b[_0x5a2f4f(0x195)]();let _0xbfe7b8=_0x5a2f4f(0x199);if(_0x4b794a[_0x5a2f4f(0x1c0)]){_0xbfe7b8=_0x4b794a[_0x5a2f4f(0x151)]||_0x5a2f4f(0x1a8);if(tg?.['HapticFeedback'])tg[_0x5a2f4f(0x181)][_0x5a2f4f(0x14a)](_0x5a2f4f(0x1c0));}else{_0xbfe7b8=_0x4b794a[_0x5a2f4f(0x1aa)]||_0x5a2f4f(0x1af);if(tg?.[_0x5a2f4f(0x181)])tg[_0x5a2f4f(0x181)][_0x5a2f4f(0x14a)](_0x5a2f4f(0x1aa));}messages['push']({'role':'ai','content':_0xbfe7b8,'timestamp':Date['now']()}),localStorage['setItem'](_0x5a2f4f(0x169),JSON[_0x5a2f4f(0x1a3)](messages)),renderMessages();}function confirmDelete(_0x46e21f){const _0x190322=a0_0x3a982d;if(mTitle)mTitle[_0x190322(0x13e)]=_0x190322(0x193);if(mText)mText[_0x190322(0x13e)]=_0x190322(0x157);modalCallback=()=>{const _0xc8ef5=_0x190322;messages[_0xc8ef5(0x146)](_0x46e21f,0x1),localStorage[_0xc8ef5(0x167)](_0xc8ef5(0x169),JSON[_0xc8ef5(0x1a3)](messages)),renderMessages();},modal[_0x190322(0x194)]['add'](_0x190322(0x1a0));}if(clearBtn)clearBtn['onclick']=()=>{const _0x352eaa=a0_0x3a982d;if(!messages[_0x352eaa(0x179)])return;if(mTitle)mTitle[_0x352eaa(0x13e)]=_0x352eaa(0x1a6);if(mText)mText[_0x352eaa(0x13e)]=_0x352eaa(0x196);modalCallback=async()=>{const _0x3959ba=_0x352eaa;messages=[],localStorage['removeItem'](_0x3959ba(0x169)),renderMessages(),callBackend(_0x3959ba(0x184),{});},modal[_0x352eaa(0x194)][_0x352eaa(0x161)]('show');};document[a0_0x3a982d(0x180)](a0_0x3a982d(0x150))['onclick']=()=>modal[a0_0x3a982d(0x194)]['remove'](a0_0x3a982d(0x1a0)),document[a0_0x3a982d(0x180)](a0_0x3a982d(0x15d))[a0_0x3a982d(0x1b3)]=()=>{const _0x4f7ac7=a0_0x3a982d;if(modalCallback)modalCallback();modal[_0x4f7ac7(0x194)]['remove'](_0x4f7ac7(0x1a0));},messageInput['addEventListener'](a0_0x3a982d(0x1ad),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3a982d(0x183)](a0_0x3a982d(0x175),_0x29b543=>{const _0x442ebd=a0_0x3a982d;_0x29b543[_0x442ebd(0x15c)]==='Enter'&&!_0x29b543[_0x442ebd(0x14f)]&&(_0x29b543['preventDefault'](),sendMessage());}),sendBtn[a0_0x3a982d(0x1b3)]=sendMessage,document[a0_0x3a982d(0x183)]('click',_0x4517de=>{const _0x248c90=a0_0x3a982d;document[_0x248c90(0x185)]('.message.show-delete')[_0x248c90(0x16a)](_0x401cbc=>{const _0x4bbba7=_0x248c90;if(!_0x401cbc[_0x4bbba7(0x1b2)](_0x4517de[_0x4bbba7(0x1bc)]))_0x401cbc[_0x4bbba7(0x194)][_0x4bbba7(0x195)](_0x4bbba7(0x172));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0xc09bd8){}updateSendButton();