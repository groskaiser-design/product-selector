const a0_0x58ae9c=a0_0x5634;(function(_0x4b5411,_0x3bf3e2){const _0x482741=a0_0x5634,_0x17848e=_0x4b5411();while(!![]){try{const _0x2b27f9=-parseInt(_0x482741(0x1b8))/0x1+-parseInt(_0x482741(0x1d0))/0x2*(-parseInt(_0x482741(0x1af))/0x3)+parseInt(_0x482741(0x20a))/0x4+-parseInt(_0x482741(0x214))/0x5+-parseInt(_0x482741(0x1bf))/0x6*(parseInt(_0x482741(0x1f9))/0x7)+parseInt(_0x482741(0x1dd))/0x8+-parseInt(_0x482741(0x1b3))/0x9*(-parseInt(_0x482741(0x1c0))/0xa);if(_0x2b27f9===_0x3bf3e2)break;else _0x17848e['push'](_0x17848e['shift']());}catch(_0x1d1c30){_0x17848e['push'](_0x17848e['shift']());}}}(a0_0x4f8e,0xdedc4));function a0_0x4f8e(){const _0x379a21=['querySelectorAll','first_name','children','touchend','onclick','Пустой\x20ответ','ai_chat_messages','2190044eoORjd','search','textContent','random','display','keydown','shiftKey','click','sendBtn','href','6906095KfganQ','innerHTML','abort','./router.html','floor','message\x20','expand','delete-btn','offsetHeight','Очистить\x20историю?','querySelector','from','Ошибка\x20сети','light','ready','disabled','message-bubble','isVersionAtLeast','chatArea','(((.+)+)+)+$','getItem','splice','scrollTop','171xUyQAe','viewportHeight','getElementById','getMinutes','98793JTcaNo','onEvent','appendChild','setItem','auto','703091qklpRB','impactOccurred','classList','div','HapticFeedback','className','modalTitle','81294TSdPPM','1910DhysvA','modalCancel','trim','warn','typingIndicator','add','user','focus','createElement','BackButton','function','initDataUnsafe','value','notificationOccurred','push','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','29614eGBvmG','padStart','setHeaderColor','timestamp','inputArea','Удалить?','error','removeItem','signal','show','success','toString','none','2033792UqgpEC','remove','stopPropagation','6.1','send_message','clearBtn','key','addEventListener','resize','now','show-delete','Telegram','height','scrollHeight','.message.show-delete','Ошибка\x20сервера','Enter','text','style','role','#050505','viewportChanged','medium','onClick','offClick','apply','min','<br>','385NBFxxg','forEach','message-time','emptyState','Действие\x20необратимо.','parse','stringify','preventDefault','length','messageInput'];a0_0x4f8e=function(){return _0x379a21;};return a0_0x4f8e();}const tg=window[a0_0x58ae9c(0x1e8)]?.['WebApp'],HOME_URL=a0_0x58ae9c(0x217);function setupTelegramBackButton(){const _0x2f4407=a0_0x58ae9c;if(!tg)return;try{tg[_0x2f4407(0x222)](),tg[_0x2f4407(0x21a)](),tg[_0x2f4407(0x1d2)]?.(_0x2f4407(0x1f1));if(tg[_0x2f4407(0x225)]?.(_0x2f4407(0x1e0)))tg['disableVerticalSwipes']?.();const _0x5a92cf=tg[_0x2f4407(0x1c9)];if(_0x5a92cf){_0x5a92cf[_0x2f4407(0x1d9)]();if(typeof _0x5a92cf[_0x2f4407(0x1f5)]===_0x2f4407(0x1ca))try{_0x5a92cf['offClick']();}catch(_0x480e9e){}_0x5a92cf[_0x2f4407(0x1f4)](()=>{const _0x4ef77b=_0x2f4407;if(tg['HapticFeedback'])tg[_0x4ef77b(0x1bc)]['impactOccurred']('light');location[_0x4ef77b(0x213)]=HOME_URL;});}}catch(_0x509041){console[_0x2f4407(0x1c3)]('TG\x20setup\x20error:',_0x509041);}}(function initStableLayout(){const _0x353704=a0_0x58ae9c,_0x5af4c0=(function(){let _0x392b5b=!![];return function(_0x292a87,_0x45fb83){const _0x16f255=_0x392b5b?function(){const _0x30fb8e=a0_0x5634;if(_0x45fb83){const _0x542bb0=_0x45fb83[_0x30fb8e(0x1f6)](_0x292a87,arguments);return _0x45fb83=null,_0x542bb0;}}:function(){};return _0x392b5b=![],_0x16f255;};}()),_0x798312=document[_0x353704(0x21e)]('.container'),_0x23cf4b=document[_0x353704(0x1b1)](_0x353704(0x1d4)),_0x3ecbe1=document['getElementById'](_0x353704(0x226)),_0xf3b20d=document[_0x353704(0x1b1)]('messageInput');function _0x2f0d45(){const _0x159018=_0x353704,_0x245dfe=_0x5af4c0(this,function(){const _0x45ec6e=a0_0x5634;return _0x245dfe['toString']()[_0x45ec6e(0x20b)](_0x45ec6e(0x227))[_0x45ec6e(0x1db)]()['constructor'](_0x245dfe)['search'](_0x45ec6e(0x227));});_0x245dfe();if(!_0x798312)return;const _0x430956=tg&&tg[_0x159018(0x1b0)]?tg[_0x159018(0x1b0)]:window['innerHeight'];_0x798312[_0x159018(0x1ef)][_0x159018(0x1e9)]=_0x430956+'px';if(_0x23cf4b){const _0x421b73=_0x23cf4b[_0x159018(0x21c)];_0x3ecbe1['style']['paddingBottom']=_0x421b73+0x28+'px';}}tg?tg[_0x353704(0x1b4)](_0x353704(0x1f2),({isStateStable:_0x1c9f64})=>{_0x2f0d45();if(_0x1c9f64)requestAnimationFrame(()=>{const _0x5f3f09=a0_0x5634;_0x3ecbe1[_0x5f3f09(0x1ae)]=_0x3ecbe1[_0x5f3f09(0x1ea)];});}):window[_0x353704(0x1e4)](_0x353704(0x1e5),_0x2f0d45),_0x2f0d45(),_0xf3b20d&&(_0xf3b20d[_0x353704(0x1e4)]('input',()=>{requestAnimationFrame(_0x2f0d45);}),_0xf3b20d['addEventListener'](_0x353704(0x1c7),()=>{setTimeout(()=>{_0x3ecbe1['scrollTop']=_0x3ecbe1['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x58ae9c(0x226)),emptyState=document['getElementById'](a0_0x58ae9c(0x1fc)),messageInput=document[a0_0x58ae9c(0x1b1)](a0_0x58ae9c(0x202)),sendBtn=document[a0_0x58ae9c(0x1b1)](a0_0x58ae9c(0x212)),clearBtn=document[a0_0x58ae9c(0x1b1)](a0_0x58ae9c(0x1e2)),modal=document['getElementById']('confirmModal'),mTitle=document['getElementById'](a0_0x58ae9c(0x1be)),mText=document[a0_0x58ae9c(0x1b1)]('modalText');let modalCallback=null;function a0_0x5634(_0x3bbcb9,_0x16e920){_0x3bbcb9=_0x3bbcb9-0x1ae;const _0xbccaa2=a0_0x4f8e();let _0x39a77e=_0xbccaa2[_0x3bbcb9];return _0x39a77e;}async function callBackend(_0x5677c0,_0xf97924){const _0xe14434=a0_0x58ae9c,_0x23ecd5=tg?.[_0xe14434(0x1cb)]?.[_0xe14434(0x1c6)]||{},_0x237be9=_0x23ecd5['id']||localStorage[_0xe14434(0x228)]('debug_uid')||'d-'+Math[_0xe14434(0x218)](Math[_0xe14434(0x20d)]()*0x3b9aca00);if(!_0x23ecd5['id'])localStorage[_0xe14434(0x1b6)]('debug_uid',_0x237be9);const _0x4448b3={'action':_0x5677c0,'user_id':_0x237be9,'user_data':{'first_name':_0x23ecd5[_0xe14434(0x204)],'username':_0x23ecd5['username']},'init_data':tg?.['initData']||'',..._0xf97924},_0xd15a08=new AbortController(),_0x3796cf=setTimeout(()=>_0xd15a08[_0xe14434(0x216)](),REQUEST_TIMEOUT_MS);try{const _0x1a1900=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0xe14434(0x1ff)](_0x4448b3),'signal':_0xd15a08[_0xe14434(0x1d8)]});return clearTimeout(_0x3796cf),await _0x1a1900['json']();}catch(_0x43c57b){return{'success':![],'error':String(_0x43c57b)};}}function formatTime(_0xd2a141){const _0xae4544=a0_0x58ae9c,_0x21d1be=new Date(_0xd2a141);return String(_0x21d1be['getHours']())[_0xae4544(0x1d1)](0x2,'0')+':'+String(_0x21d1be[_0xae4544(0x1b2)]())['padStart'](0x2,'0');}function createMessageElement(_0x12ea7f,_0x538a53){const _0x17683d=a0_0x58ae9c,_0x18fa50=document['createElement'](_0x17683d(0x1bb));_0x18fa50['className']=_0x17683d(0x219)+_0x12ea7f[_0x17683d(0x1f0)];const _0x1d7039=document[_0x17683d(0x1c8)](_0x17683d(0x1bb));_0x1d7039[_0x17683d(0x1bd)]=_0x17683d(0x224),_0x1d7039['innerHTML']=_0x12ea7f['content']['replace'](/\n/g,_0x17683d(0x1f8));const _0x267d50=document[_0x17683d(0x1c8)](_0x17683d(0x1bb));_0x267d50['className']=_0x17683d(0x21b),_0x267d50[_0x17683d(0x215)]=_0x17683d(0x1cf),_0x267d50['onclick']=_0x44de0a=>{const _0x3166fe=_0x17683d;_0x44de0a[_0x3166fe(0x1df)](),confirmDelete(_0x538a53);};let _0x2e5d3d;_0x1d7039[_0x17683d(0x1e4)]('touchstart',()=>_0x2e5d3d=setTimeout(()=>{const _0x354fd1=_0x17683d;_0x18fa50[_0x354fd1(0x1ba)][_0x354fd1(0x1c5)](_0x354fd1(0x1e7));if(tg?.[_0x354fd1(0x1bc)])tg[_0x354fd1(0x1bc)][_0x354fd1(0x1b9)](_0x354fd1(0x1f3));},0x1f4)),_0x1d7039[_0x17683d(0x1e4)](_0x17683d(0x206),()=>clearTimeout(_0x2e5d3d));const _0x4ada58=document[_0x17683d(0x1c8)]('div');return _0x4ada58[_0x17683d(0x1bd)]=_0x17683d(0x1fb),_0x4ada58['textContent']=formatTime(_0x12ea7f[_0x17683d(0x1d3)]),_0x18fa50[_0x17683d(0x1b5)](_0x267d50),_0x18fa50[_0x17683d(0x1b5)](_0x1d7039),_0x18fa50[_0x17683d(0x1b5)](_0x4ada58),_0x18fa50;}function createTypingIndicator(){const _0x348d7c=a0_0x58ae9c,_0x315452=document[_0x348d7c(0x1c8)](_0x348d7c(0x1bb));return _0x315452[_0x348d7c(0x1bd)]='message\x20ai',_0x315452['id']=_0x348d7c(0x1c4),_0x315452['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x315452;}function renderMessages(){const _0x8ecab3=a0_0x58ae9c;Array[_0x8ecab3(0x21f)](chatArea[_0x8ecab3(0x205)])['forEach'](_0x9bfcec=>{const _0x12f66f=_0x8ecab3;if(_0x9bfcec['id']!=='emptyState')_0x9bfcec[_0x12f66f(0x1de)]();}),messages[_0x8ecab3(0x201)]>0x0?(emptyState['style'][_0x8ecab3(0x20e)]=_0x8ecab3(0x1dc),messages[_0x8ecab3(0x1fa)]((_0x2c04a2,_0x1ee6e2)=>chatArea['appendChild'](createMessageElement(_0x2c04a2,_0x1ee6e2)))):emptyState[_0x8ecab3(0x1ef)][_0x8ecab3(0x20e)]='flex',requestAnimationFrame(()=>chatArea[_0x8ecab3(0x1ae)]=chatArea[_0x8ecab3(0x1ea)]);}function autoResizeTextarea(){const _0x220f2d=a0_0x58ae9c;messageInput['style']['height']=_0x220f2d(0x1b7),messageInput[_0x220f2d(0x1ef)][_0x220f2d(0x1e9)]=Math[_0x220f2d(0x1f7)](messageInput[_0x220f2d(0x1ea)],0x78)+'px';}function updateSendButton(){const _0x27ad86=a0_0x58ae9c,_0x1c5224=messageInput[_0x27ad86(0x1cc)]['trim']();sendBtn[_0x27ad86(0x223)]=!_0x1c5224||isTyping;}async function sendMessage(){const _0x4b75f5=a0_0x58ae9c,_0x31911e=messageInput[_0x4b75f5(0x1cc)][_0x4b75f5(0x1c2)]();if(!_0x31911e||isTyping)return;if(tg?.[_0x4b75f5(0x1bc)])tg[_0x4b75f5(0x1bc)][_0x4b75f5(0x1b9)](_0x4b75f5(0x221));messages[_0x4b75f5(0x1ce)]({'role':_0x4b75f5(0x1c6),'content':_0x31911e,'timestamp':Date['now']()}),localStorage[_0x4b75f5(0x1b6)]('ai_chat_messages',JSON[_0x4b75f5(0x1ff)](messages)),renderMessages(),messageInput[_0x4b75f5(0x1cc)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x4b75f5(0x1ae)]=chatArea['scrollHeight'];const _0x13314c=await callBackend(_0x4b75f5(0x1e1),{'message':_0x31911e});isTyping=![];const _0x43f450=document[_0x4b75f5(0x1b1)](_0x4b75f5(0x1c4));if(_0x43f450)_0x43f450[_0x4b75f5(0x1de)]();let _0x424050=_0x4b75f5(0x220);if(_0x13314c[_0x4b75f5(0x1da)]){_0x424050=_0x13314c[_0x4b75f5(0x1ee)]||_0x4b75f5(0x208);if(tg?.[_0x4b75f5(0x1bc)])tg[_0x4b75f5(0x1bc)][_0x4b75f5(0x1cd)](_0x4b75f5(0x1da));}else{_0x424050=_0x13314c[_0x4b75f5(0x1d6)]||_0x4b75f5(0x1ec);if(tg?.['HapticFeedback'])tg[_0x4b75f5(0x1bc)]['notificationOccurred']('error');}messages[_0x4b75f5(0x1ce)]({'role':'ai','content':_0x424050,'timestamp':Date[_0x4b75f5(0x1e6)]()}),localStorage[_0x4b75f5(0x1b6)]('ai_chat_messages',JSON[_0x4b75f5(0x1ff)](messages)),renderMessages();}function confirmDelete(_0x16e37b){const _0x5932d0=a0_0x58ae9c;if(mTitle)mTitle[_0x5932d0(0x20c)]=_0x5932d0(0x1d5);if(mText)mText[_0x5932d0(0x20c)]=_0x5932d0(0x1fd);modalCallback=()=>{const _0x421783=_0x5932d0;messages[_0x421783(0x229)](_0x16e37b,0x1),localStorage[_0x421783(0x1b6)](_0x421783(0x209),JSON['stringify'](messages)),renderMessages();},modal[_0x5932d0(0x1ba)]['add']('show');}if(clearBtn)clearBtn[a0_0x58ae9c(0x207)]=()=>{const _0x536b82=a0_0x58ae9c;if(!messages[_0x536b82(0x201)])return;if(mTitle)mTitle['textContent']=_0x536b82(0x21d);if(mText)mText[_0x536b82(0x20c)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x6349c1=_0x536b82;messages=[],localStorage[_0x6349c1(0x1d7)](_0x6349c1(0x209)),renderMessages(),callBackend('clear_history',{});},modal[_0x536b82(0x1ba)][_0x536b82(0x1c5)]('show');};document[a0_0x58ae9c(0x1b1)](a0_0x58ae9c(0x1c1))[a0_0x58ae9c(0x207)]=()=>modal[a0_0x58ae9c(0x1ba)][a0_0x58ae9c(0x1de)](a0_0x58ae9c(0x1d9)),document[a0_0x58ae9c(0x1b1)]('modalConfirm')[a0_0x58ae9c(0x207)]=()=>{const _0x400b6a=a0_0x58ae9c;if(modalCallback)modalCallback();modal[_0x400b6a(0x1ba)][_0x400b6a(0x1de)](_0x400b6a(0x1d9));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x58ae9c(0x1e4)](a0_0x58ae9c(0x20f),_0x4a00ea=>{const _0x22729e=a0_0x58ae9c;_0x4a00ea[_0x22729e(0x1e3)]===_0x22729e(0x1ed)&&!_0x4a00ea[_0x22729e(0x210)]&&(_0x4a00ea[_0x22729e(0x200)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x58ae9c(0x1e4)](a0_0x58ae9c(0x211),_0x25a419=>{const _0x48d556=a0_0x58ae9c;document[_0x48d556(0x203)](_0x48d556(0x1eb))['forEach'](_0xf5dafd=>{const _0x97575d=_0x48d556;if(!_0xf5dafd['contains'](_0x25a419['target']))_0xf5dafd[_0x97575d(0x1ba)]['remove'](_0x97575d(0x1e7));});});const saved=localStorage[a0_0x58ae9c(0x228)](a0_0x58ae9c(0x209));if(saved)try{messages=JSON[a0_0x58ae9c(0x1fe)](saved),renderMessages();}catch(a0_0x1f82f9){}updateSendButton();