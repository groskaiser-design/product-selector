const a0_0x2667bf=a0_0x44e4;(function(_0x5507d7,_0x3c5b85){const _0x2e8d2f=a0_0x44e4,_0x368e8d=_0x5507d7();while(!![]){try{const _0x28addd=-parseInt(_0x2e8d2f(0x16f))/0x1+parseInt(_0x2e8d2f(0x1ac))/0x2*(-parseInt(_0x2e8d2f(0x17f))/0x3)+-parseInt(_0x2e8d2f(0x1b3))/0x4*(-parseInt(_0x2e8d2f(0x1d6))/0x5)+parseInt(_0x2e8d2f(0x1bf))/0x6+parseInt(_0x2e8d2f(0x17d))/0x7*(parseInt(_0x2e8d2f(0x186))/0x8)+parseInt(_0x2e8d2f(0x1e4))/0x9*(-parseInt(_0x2e8d2f(0x18a))/0xa)+-parseInt(_0x2e8d2f(0x1dd))/0xb;if(_0x28addd===_0x3c5b85)break;else _0x368e8d['push'](_0x368e8d['shift']());}catch(_0x396caa){_0x368e8d['push'](_0x368e8d['shift']());}}}(a0_0x1a69,0x2410c));const tg=window['Telegram']?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x50c6dd=a0_0x44e4,_0x214f4d=(function(){let _0x37b1b1=!![];return function(_0x2dfeea,_0x4152cd){const _0x41bbd9=_0x37b1b1?function(){const _0x1b62c4=a0_0x44e4;if(_0x4152cd){const _0xfa8150=_0x4152cd[_0x1b62c4(0x18f)](_0x2dfeea,arguments);return _0x4152cd=null,_0xfa8150;}}:function(){};return _0x37b1b1=![],_0x41bbd9;};}()),_0x3cc4f2=_0x214f4d(this,function(){const _0x434c3d=a0_0x44e4;return _0x3cc4f2[_0x434c3d(0x192)]()['search'](_0x434c3d(0x1a5))[_0x434c3d(0x192)]()[_0x434c3d(0x1ae)](_0x3cc4f2)['search'](_0x434c3d(0x1a5));});_0x3cc4f2();if(!tg)return;try{tg[_0x50c6dd(0x196)](),tg[_0x50c6dd(0x1c2)](),tg[_0x50c6dd(0x180)]?.(_0x50c6dd(0x1ce));if(tg[_0x50c6dd(0x1a6)]?.(_0x50c6dd(0x1c9)))tg[_0x50c6dd(0x190)]?.();const _0x36b298=tg[_0x50c6dd(0x19c)];if(_0x36b298){_0x36b298['show']();if(typeof _0x36b298['offClick']===_0x50c6dd(0x17a))try{_0x36b298['offClick']();}catch(_0x596c5d){}_0x36b298[_0x50c6dd(0x1b5)](()=>{const _0x532cc6=_0x50c6dd;if(tg[_0x532cc6(0x1a3)])tg[_0x532cc6(0x1a3)][_0x532cc6(0x1b4)]('light');location[_0x532cc6(0x1b0)]=HOME_URL;});}}catch(_0x193955){console[_0x50c6dd(0x1cd)](_0x50c6dd(0x1b2),_0x193955);}}function a0_0x44e4(_0x58df59,_0x34e735){_0x58df59=_0x58df59-0x16e;const _0x422adc=a0_0x1a69();let _0x26a10c=_0x422adc[_0x58df59];return _0x26a10c;}(function initStableLayout(){const _0x260525=a0_0x44e4,_0x5b2edf=document[_0x260525(0x188)]('.container'),_0x5bf891=document['getElementById'](_0x260525(0x19b)),_0xbc2ef=document[_0x260525(0x1d4)]('chatArea'),_0x747721=document[_0x260525(0x1d4)](_0x260525(0x173));function _0x100d0d(){const _0x27dc72=_0x260525;if(!_0x5b2edf)return;const _0x3779b1=tg&&tg[_0x27dc72(0x179)]?tg[_0x27dc72(0x179)]:window[_0x27dc72(0x195)];_0x5b2edf[_0x27dc72(0x1b8)][_0x27dc72(0x181)]=_0x3779b1+'px';if(_0x5bf891){const _0x4bd521=_0x5bf891[_0x27dc72(0x19d)];_0xbc2ef[_0x27dc72(0x1b8)][_0x27dc72(0x191)]=_0x4bd521+0x28+'px';}}tg?tg['onEvent'](_0x260525(0x1ca),({isStateStable:_0x3622a3})=>{_0x100d0d();if(_0x3622a3)requestAnimationFrame(()=>{const _0x7234fc=a0_0x44e4;_0xbc2ef['scrollTop']=_0xbc2ef[_0x7234fc(0x1cf)];});}):window[_0x260525(0x193)](_0x260525(0x1df),_0x100d0d),_0x100d0d(),_0x747721&&(_0x747721[_0x260525(0x193)](_0x260525(0x1c0),()=>{requestAnimationFrame(_0x100d0d);}),_0x747721[_0x260525(0x193)](_0x260525(0x1dc),()=>{setTimeout(()=>{const _0x158f3c=a0_0x44e4;_0xbc2ef[_0x158f3c(0x18c)]=_0xbc2ef[_0x158f3c(0x1cf)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2667bf(0x1b1),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x2667bf(0x18d)),emptyState=document[a0_0x2667bf(0x1d4)]('emptyState'),messageInput=document[a0_0x2667bf(0x1d4)]('messageInput'),sendBtn=document[a0_0x2667bf(0x1d4)](a0_0x2667bf(0x17e)),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0x2667bf(0x1d4)](a0_0x2667bf(0x1d5)),mTitle=document[a0_0x2667bf(0x1d4)](a0_0x2667bf(0x1c1)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x54238a,_0x2433b8){const _0x55c0fe=a0_0x2667bf,_0x270a27=tg?.[_0x55c0fe(0x1ba)]?.[_0x55c0fe(0x174)]||{},_0x83ed30=_0x270a27['id']||localStorage['getItem'](_0x55c0fe(0x183))||'d-'+Math[_0x55c0fe(0x1da)](Math[_0x55c0fe(0x1e6)]()*0x3b9aca00);if(!_0x270a27['id'])localStorage['setItem'](_0x55c0fe(0x183),_0x83ed30);const _0x29d212={'action':_0x54238a,'user_id':_0x83ed30,'user_data':{'first_name':_0x270a27[_0x55c0fe(0x1e0)],'username':_0x270a27['username']},'init_data':tg?.[_0x55c0fe(0x1bb)]||'',..._0x2433b8},_0x590d0f=new AbortController(),_0x53ca65=setTimeout(()=>_0x590d0f[_0x55c0fe(0x1b9)](),REQUEST_TIMEOUT_MS);try{const _0x34fed5=await fetch(BACKEND_URL,{'method':_0x55c0fe(0x198),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x55c0fe(0x1c8)](_0x29d212),'signal':_0x590d0f['signal']});return clearTimeout(_0x53ca65),await _0x34fed5[_0x55c0fe(0x1bc)]();}catch(_0x277b69){return{'success':![],'error':String(_0x277b69)};}}function formatTime(_0x4cdd09){const _0x1d208=a0_0x2667bf,_0x48c3bd=new Date(_0x4cdd09);return String(_0x48c3bd['getHours']())[_0x1d208(0x1e8)](0x2,'0')+':'+String(_0x48c3bd[_0x1d208(0x1be)]())[_0x1d208(0x1e8)](0x2,'0');}function createMessageElement(_0x4b7b12,_0x378e){const _0x326ddd=a0_0x2667bf,_0x4e8e18=document[_0x326ddd(0x1d0)](_0x326ddd(0x1a1));_0x4e8e18[_0x326ddd(0x1a8)]=_0x326ddd(0x1cc)+_0x4b7b12['role'];const _0x5560e5=document[_0x326ddd(0x1d0)](_0x326ddd(0x1a1));_0x5560e5[_0x326ddd(0x1a8)]=_0x326ddd(0x19e),_0x5560e5['innerHTML']=_0x4b7b12[_0x326ddd(0x19a)][_0x326ddd(0x18e)](/\n/g,'<br>');const _0x9730e1=document[_0x326ddd(0x1d0)](_0x326ddd(0x1a1));_0x9730e1[_0x326ddd(0x1a8)]=_0x326ddd(0x1d3),_0x9730e1[_0x326ddd(0x1d1)]=_0x326ddd(0x1e7),_0x9730e1['onclick']=_0x10406a=>{const _0x3656d7=_0x326ddd;_0x10406a[_0x3656d7(0x1c6)](),confirmDelete(_0x378e);};let _0x2f8a4f;_0x5560e5[_0x326ddd(0x193)](_0x326ddd(0x19f),()=>_0x2f8a4f=setTimeout(()=>{const _0x38ff99=_0x326ddd;_0x4e8e18[_0x38ff99(0x1a7)]['add'](_0x38ff99(0x1a4));if(tg?.[_0x38ff99(0x1a3)])tg[_0x38ff99(0x1a3)][_0x38ff99(0x1b4)]('medium');},0x1f4)),_0x5560e5[_0x326ddd(0x193)](_0x326ddd(0x1db),()=>clearTimeout(_0x2f8a4f));const _0x55fbcc=document['createElement']('div');return _0x55fbcc[_0x326ddd(0x1a8)]='message-time',_0x55fbcc[_0x326ddd(0x175)]=formatTime(_0x4b7b12['timestamp']),_0x4e8e18['appendChild'](_0x9730e1),_0x4e8e18['appendChild'](_0x5560e5),_0x4e8e18['appendChild'](_0x55fbcc),_0x4e8e18;}function createTypingIndicator(){const _0x35ff7f=a0_0x2667bf,_0x14e6d2=document['createElement']('div');return _0x14e6d2[_0x35ff7f(0x1a8)]=_0x35ff7f(0x1cb),_0x14e6d2['id']=_0x35ff7f(0x194),_0x14e6d2[_0x35ff7f(0x1d1)]=_0x35ff7f(0x1b7),_0x14e6d2;}function renderMessages(){const _0x389a31=a0_0x2667bf;Array[_0x389a31(0x1d2)](chatArea['children'])['forEach'](_0x34b2ee=>{const _0x51b501=_0x389a31;if(_0x34b2ee['id']!==_0x51b501(0x178))_0x34b2ee[_0x51b501(0x1c5)]();}),messages[_0x389a31(0x1bd)]>0x0?(emptyState[_0x389a31(0x1b8)][_0x389a31(0x1e5)]=_0x389a31(0x1c7),messages['forEach']((_0x21ea66,_0x41470f)=>chatArea['appendChild'](createMessageElement(_0x21ea66,_0x41470f)))):emptyState['style']['display']=_0x389a31(0x199),requestAnimationFrame(()=>chatArea[_0x389a31(0x18c)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x8ccad8=a0_0x2667bf;messageInput['style'][_0x8ccad8(0x181)]=_0x8ccad8(0x1d7),messageInput[_0x8ccad8(0x1b8)][_0x8ccad8(0x181)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x11b61c=a0_0x2667bf,_0x41a8cf=messageInput['value'][_0x11b61c(0x1b6)]();sendBtn[_0x11b61c(0x1a0)]=!_0x41a8cf||isTyping;}async function sendMessage(){const _0x557979=a0_0x2667bf,_0x2fd264=messageInput[_0x557979(0x1c4)][_0x557979(0x1b6)]();if(!_0x2fd264||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x557979(0x1a3)]['impactOccurred'](_0x557979(0x1de));messages['push']({'role':_0x557979(0x174),'content':_0x2fd264,'timestamp':Date['now']()}),localStorage[_0x557979(0x197)](_0x557979(0x189),JSON['stringify'](messages)),renderMessages(),messageInput[_0x557979(0x1c4)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x557979(0x16e)](createTypingIndicator()),chatArea[_0x557979(0x18c)]=chatArea[_0x557979(0x1cf)];const _0x5aab6a=await callBackend(_0x557979(0x1c3),{'message':_0x2fd264});isTyping=![];const _0x217d59=document[_0x557979(0x1d4)]('typingIndicator');if(_0x217d59)_0x217d59[_0x557979(0x1c5)]();let _0x52979e=_0x557979(0x1af);if(_0x5aab6a['success']){_0x52979e=_0x5aab6a['text']||_0x557979(0x1d8);if(tg?.[_0x557979(0x1a3)])tg['HapticFeedback']['notificationOccurred'](_0x557979(0x1a2));}else{_0x52979e=_0x5aab6a['error']||_0x557979(0x18b);if(tg?.[_0x557979(0x1a3)])tg[_0x557979(0x1a3)][_0x557979(0x1a9)](_0x557979(0x1ad));}messages['push']({'role':'ai','content':_0x52979e,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x557979(0x1c8)](messages)),renderMessages();}function confirmDelete(_0x41b753){const _0x33f6cd=a0_0x2667bf;if(mTitle)mTitle['textContent']=_0x33f6cd(0x17b);if(mText)mText[_0x33f6cd(0x175)]=_0x33f6cd(0x1ab);modalCallback=()=>{const _0x5be75c=_0x33f6cd;messages[_0x5be75c(0x1e2)](_0x41b753,0x1),localStorage[_0x5be75c(0x197)](_0x5be75c(0x189),JSON[_0x5be75c(0x1c8)](messages)),renderMessages();},modal[_0x33f6cd(0x1a7)]['add']('show');}if(clearBtn)clearBtn[a0_0x2667bf(0x1d9)]=()=>{const _0x5ee044=a0_0x2667bf;if(!messages[_0x5ee044(0x1bd)])return;if(mTitle)mTitle[_0x5ee044(0x175)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x5ee044(0x171);modalCallback=async()=>{const _0x5c68e2=_0x5ee044;messages=[],localStorage[_0x5c68e2(0x187)](_0x5c68e2(0x189)),renderMessages(),callBackend('clear_history',{});},modal[_0x5ee044(0x1a7)]['add'](_0x5ee044(0x184));};document[a0_0x2667bf(0x1d4)]('modalCancel')[a0_0x2667bf(0x1d9)]=()=>modal[a0_0x2667bf(0x1a7)][a0_0x2667bf(0x1c5)](a0_0x2667bf(0x184)),document[a0_0x2667bf(0x1d4)](a0_0x2667bf(0x172))[a0_0x2667bf(0x1d9)]=()=>{const _0x40ec3e=a0_0x2667bf;if(modalCallback)modalCallback();modal[_0x40ec3e(0x1a7)][_0x40ec3e(0x1c5)](_0x40ec3e(0x184));},messageInput[a0_0x2667bf(0x193)](a0_0x2667bf(0x1c0),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2667bf(0x193)]('keydown',_0x40b3a5=>{const _0x25298=a0_0x2667bf;_0x40b3a5[_0x25298(0x1e1)]===_0x25298(0x1aa)&&!_0x40b3a5['shiftKey']&&(_0x40b3a5['preventDefault'](),sendMessage());}),sendBtn[a0_0x2667bf(0x1d9)]=sendMessage,document['addEventListener'](a0_0x2667bf(0x1e3),_0x3f783b=>{const _0x3307c1=a0_0x2667bf;document[_0x3307c1(0x177)](_0x3307c1(0x182))['forEach'](_0x546ee7=>{const _0x1f4de0=_0x3307c1;if(!_0x546ee7[_0x1f4de0(0x170)](_0x3f783b[_0x1f4de0(0x185)]))_0x546ee7[_0x1f4de0(0x1a7)][_0x1f4de0(0x1c5)](_0x1f4de0(0x1a4));});});const saved=localStorage[a0_0x2667bf(0x176)](a0_0x2667bf(0x189));if(saved)try{messages=JSON[a0_0x2667bf(0x17c)](saved),renderMessages();}catch(a0_0x3af319){}function a0_0x1a69(){const _0x4cd513=['removeItem','querySelector','ai_chat_messages','54800anpqwt','Ошибка\x20сервера','scrollTop','chatArea','replace','apply','disableVerticalSwipes','paddingBottom','toString','addEventListener','typingIndicator','innerHeight','ready','setItem','POST','flex','content','inputArea','BackButton','offsetHeight','message-bubble','touchstart','disabled','div','success','HapticFeedback','show-delete','(((.+)+)+)+$','isVersionAtLeast','classList','className','notificationOccurred','Enter','Действие\x20необратимо.','2oUDlyq','error','constructor','Ошибка\x20сети','href','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','TG\x20setup\x20error:','52UIQFjj','impactOccurred','onClick','trim','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','style','abort','initDataUnsafe','initData','json','length','getMinutes','1480374fWLmPV','input','modalTitle','expand','send_message','value','remove','stopPropagation','none','stringify','6.1','viewportChanged','message\x20ai','message\x20','warn','#050505','scrollHeight','createElement','innerHTML','from','delete-btn','getElementById','confirmModal','70145pFGZKl','auto','Пустой\x20ответ','onclick','floor','touchend','focus','1735591FUYcpq','light','resize','first_name','key','splice','click','333cegFPS','display','random','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','padStart','appendChild','110848mfBTBw','contains','Начнется\x20новый\x20диалог.','modalConfirm','messageInput','user','textContent','getItem','querySelectorAll','emptyState','viewportHeight','function','Удалить?','parse','938tTwKvv','sendBtn','264933jWLbZw','setHeaderColor','height','.message.show-delete','debug_uid','show','target','16616ZuMJDM'];a0_0x1a69=function(){return _0x4cd513;};return a0_0x1a69();}updateSendButton();