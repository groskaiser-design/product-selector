const a0_0x22e252=a0_0x1c47;(function(_0x14cb56,_0x276b98){const _0x4bef1f=a0_0x1c47,_0x18f25f=_0x14cb56();while(!![]){try{const _0x461cf6=parseInt(_0x4bef1f(0x1cf))/0x1+parseInt(_0x4bef1f(0x233))/0x2+-parseInt(_0x4bef1f(0x1c4))/0x3+-parseInt(_0x4bef1f(0x20c))/0x4*(-parseInt(_0x4bef1f(0x222))/0x5)+parseInt(_0x4bef1f(0x1e3))/0x6+-parseInt(_0x4bef1f(0x1fa))/0x7+parseInt(_0x4bef1f(0x224))/0x8*(parseInt(_0x4bef1f(0x1d8))/0x9);if(_0x461cf6===_0x276b98)break;else _0x18f25f['push'](_0x18f25f['shift']());}catch(_0x3a4004){_0x18f25f['push'](_0x18f25f['shift']());}}}(a0_0x1cb8,0x2856d));const tg=window[a0_0x22e252(0x221)]?.[a0_0x22e252(0x1fd)],HOME_URL=a0_0x22e252(0x1f0);function setupTelegramBackButton(){const _0x4ea114=a0_0x22e252;if(!tg)return;try{tg[_0x4ea114(0x211)](),tg[_0x4ea114(0x1e7)](),tg['setHeaderColor']?.(_0x4ea114(0x214));if(tg[_0x4ea114(0x1e8)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x28189f=tg[_0x4ea114(0x1f1)];if(_0x28189f){_0x28189f['show']();if(typeof _0x28189f[_0x4ea114(0x1c8)]===_0x4ea114(0x237))try{_0x28189f['offClick']();}catch(_0x166ecc){}_0x28189f[_0x4ea114(0x206)](()=>{const _0x479bac=_0x4ea114;if(tg[_0x479bac(0x22f)])tg[_0x479bac(0x22f)][_0x479bac(0x207)](_0x479bac(0x1cc));location['href']=HOME_URL;});}}catch(_0x2c1e3b){console['warn'](_0x4ea114(0x1c9),_0x2c1e3b);}}(function initStableLayout(){const _0x4c1884=a0_0x22e252,_0x3bb9db=(function(){let _0x3c51f2=!![];return function(_0x953c88,_0x580f26){const _0x31a91e=_0x3c51f2?function(){const _0x23183f=a0_0x1c47;if(_0x580f26){const _0x3539d7=_0x580f26[_0x23183f(0x1d0)](_0x953c88,arguments);return _0x580f26=null,_0x3539d7;}}:function(){};return _0x3c51f2=![],_0x31a91e;};}()),_0x4c264b=document[_0x4c1884(0x1ea)](_0x4c1884(0x1f7)),_0x38f51a=document[_0x4c1884(0x1cb)](_0x4c1884(0x212)),_0xef542e=document[_0x4c1884(0x1cb)](_0x4c1884(0x1f2)),_0x2187b8=document[_0x4c1884(0x1cb)]('messageInput');function _0x56ccc7(){const _0x1a3425=_0x4c1884,_0x1124e0=_0x3bb9db(this,function(){const _0x1b52dd=a0_0x1c47;return _0x1124e0[_0x1b52dd(0x1c5)]()['search']('(((.+)+)+)+$')[_0x1b52dd(0x1c5)]()['constructor'](_0x1124e0)[_0x1b52dd(0x21c)](_0x1b52dd(0x1c6));});_0x1124e0();if(!_0x4c264b)return;const _0x5d90c9=tg&&tg[_0x1a3425(0x205)]?tg[_0x1a3425(0x205)]:window[_0x1a3425(0x21b)];_0x4c264b[_0x1a3425(0x1d1)][_0x1a3425(0x234)]=_0x5d90c9+'px';if(_0x38f51a){const _0x4e1e86=_0x38f51a['offsetHeight'];_0xef542e[_0x1a3425(0x1d1)][_0x1a3425(0x1db)]=_0x4e1e86+0x28+'px';}}tg?tg[_0x4c1884(0x22e)]('viewportChanged',({isStateStable:_0x49c4bb})=>{_0x56ccc7();if(_0x49c4bb)requestAnimationFrame(()=>{const _0x3c3286=a0_0x1c47;_0xef542e[_0x3c3286(0x1e0)]=_0xef542e['scrollHeight'];});}):window['addEventListener'](_0x4c1884(0x239),_0x56ccc7),_0x56ccc7(),_0x2187b8&&(_0x2187b8['addEventListener'](_0x4c1884(0x1cd),()=>{requestAnimationFrame(_0x56ccc7);}),_0x2187b8[_0x4c1884(0x1ce)](_0x4c1884(0x1e9),()=>{setTimeout(()=>{const _0x52abf9=a0_0x1c47;_0xef542e[_0x52abf9(0x1e0)]=_0xef542e[_0x52abf9(0x228)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x22e252(0x21e),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x22e252(0x1f2)),emptyState=document[a0_0x22e252(0x1cb)](a0_0x22e252(0x1dd)),messageInput=document['getElementById']('messageInput'),sendBtn=document['getElementById']('sendBtn'),clearBtn=document['getElementById'](a0_0x22e252(0x1d5)),modal=document[a0_0x22e252(0x1cb)](a0_0x22e252(0x1eb)),mTitle=document[a0_0x22e252(0x1cb)](a0_0x22e252(0x210)),mText=document[a0_0x22e252(0x1cb)](a0_0x22e252(0x1f4));function a0_0x1c47(_0x36d246,_0x56e12e){_0x36d246=_0x36d246-0x1c2;const _0xc059a=a0_0x1cb8();let _0x130b2d=_0xc059a[_0x36d246];return _0x130b2d;}let modalCallback=null;function a0_0x1cb8(){const _0x32d911=['add','preventDefault','modalTitle','ready','inputArea','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','#050505','Действие\x20необратимо.','appendChild','initData','contains','content','modalConfirm','innerHeight','search','message-time','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','ai_chat_messages','clear_history','Telegram','10ZEYhqB','children','8IzxsBa','flex','error','textContent','scrollHeight','parse','Удалить?','send_message','auto','min','onEvent','HapticFeedback','success','POST','createElement','83734sAnRES','height','length','div','function','show','resize','getMinutes','abort','classList','replace','random','value','innerHTML','display','662316HSUZTX','toString','(((.+)+)+)+$','key','offClick','TG\x20setup\x20error:','disabled','getElementById','light','input','addEventListener','136501uNGfeQ','apply','style','getHours','notificationOccurred','show-delete','clearBtn','none','setItem','854442wrTWIy','touchend','<br>','paddingBottom','message\x20ai','emptyState','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','remove','scrollTop','shiftKey','typingIndicator','736524gPiBbv','querySelectorAll','.message.show-delete','trim','expand','isVersionAtLeast','focus','querySelector','confirmModal','user','forEach','Очистить\x20историю?','keydown','./router.html','BackButton','chatArea','debug_uid','modalText','stopPropagation','getItem','.container','timestamp','Enter','403039CqfEiF','from','modalCancel','WebApp','Начнется\x20новый\x20диалог.','first_name','splice','Пустой\x20ответ','now','className','delete-btn','viewportHeight','onClick','impactOccurred','Ошибка\x20сервера','json','padStart','stringify','95036ZxXGAl','onclick'];a0_0x1cb8=function(){return _0x32d911;};return a0_0x1cb8();}async function callBackend(_0x5b43fb,_0x4b4fc4){const _0x586029=a0_0x22e252,_0xadfbe=tg?.['initDataUnsafe']?.[_0x586029(0x1ec)]||{},_0x142dfe=_0xadfbe['id']||localStorage[_0x586029(0x1f6)]('debug_uid')||'d-'+Math['floor'](Math[_0x586029(0x23e)]()*0x3b9aca00);if(!_0xadfbe['id'])localStorage[_0x586029(0x1d7)](_0x586029(0x1f3),_0x142dfe);const _0x4d437b={'action':_0x5b43fb,'user_id':_0x142dfe,'user_data':{'first_name':_0xadfbe[_0x586029(0x1ff)],'username':_0xadfbe['username']},'init_data':tg?.[_0x586029(0x217)]||'',..._0x4b4fc4},_0xcaade4=new AbortController(),_0x4ddfbc=setTimeout(()=>_0xcaade4[_0x586029(0x23b)](),REQUEST_TIMEOUT_MS);try{const _0x12ba9d=await fetch(BACKEND_URL,{'method':_0x586029(0x231),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x586029(0x20b)](_0x4d437b),'signal':_0xcaade4['signal']});return clearTimeout(_0x4ddfbc),await _0x12ba9d[_0x586029(0x209)]();}catch(_0x556b79){return{'success':![],'error':String(_0x556b79)};}}function formatTime(_0x272121){const _0x5caea2=a0_0x22e252,_0x226cbd=new Date(_0x272121);return String(_0x226cbd[_0x5caea2(0x1d2)]())[_0x5caea2(0x20a)](0x2,'0')+':'+String(_0x226cbd[_0x5caea2(0x23a)]())[_0x5caea2(0x20a)](0x2,'0');}function createMessageElement(_0x3eca45,_0x3fddd6){const _0x526435=a0_0x22e252,_0xfbe289=document[_0x526435(0x232)](_0x526435(0x236));_0xfbe289['className']='message\x20'+_0x3eca45['role'];const _0x43a39c=document[_0x526435(0x232)](_0x526435(0x236));_0x43a39c[_0x526435(0x203)]='message-bubble',_0x43a39c['innerHTML']=_0x3eca45[_0x526435(0x219)][_0x526435(0x23d)](/\n/g,_0x526435(0x1da));const _0x491621=document['createElement'](_0x526435(0x236));_0x491621[_0x526435(0x203)]=_0x526435(0x204),_0x491621[_0x526435(0x1c2)]=_0x526435(0x213),_0x491621['onclick']=_0xd5cff3=>{const _0x4b2e05=_0x526435;_0xd5cff3[_0x4b2e05(0x1f5)](),confirmDelete(_0x3fddd6);};let _0x567e3e;_0x43a39c['addEventListener']('touchstart',()=>_0x567e3e=setTimeout(()=>{const _0x50c7c1=_0x526435;_0xfbe289[_0x50c7c1(0x23c)][_0x50c7c1(0x20e)](_0x50c7c1(0x1d4));if(tg?.['HapticFeedback'])tg[_0x50c7c1(0x22f)]['impactOccurred']('medium');},0x1f4)),_0x43a39c[_0x526435(0x1ce)](_0x526435(0x1d9),()=>clearTimeout(_0x567e3e));const _0x1963d6=document['createElement'](_0x526435(0x236));return _0x1963d6[_0x526435(0x203)]=_0x526435(0x21d),_0x1963d6['textContent']=formatTime(_0x3eca45[_0x526435(0x1f8)]),_0xfbe289[_0x526435(0x216)](_0x491621),_0xfbe289[_0x526435(0x216)](_0x43a39c),_0xfbe289[_0x526435(0x216)](_0x1963d6),_0xfbe289;}function createTypingIndicator(){const _0xa53ead=a0_0x22e252,_0x4d4cf4=document[_0xa53ead(0x232)](_0xa53ead(0x236));return _0x4d4cf4[_0xa53ead(0x203)]=_0xa53ead(0x1dc),_0x4d4cf4['id']=_0xa53ead(0x1e2),_0x4d4cf4['innerHTML']=_0xa53ead(0x1de),_0x4d4cf4;}function renderMessages(){const _0x13fd70=a0_0x22e252;Array[_0x13fd70(0x1fb)](chatArea[_0x13fd70(0x223)])[_0x13fd70(0x1ed)](_0x5428ed=>{const _0x1f9468=_0x13fd70;if(_0x5428ed['id']!=='emptyState')_0x5428ed[_0x1f9468(0x1df)]();}),messages['length']>0x0?(emptyState[_0x13fd70(0x1d1)][_0x13fd70(0x1c3)]=_0x13fd70(0x1d6),messages['forEach']((_0x892beb,_0x18a1fa)=>chatArea[_0x13fd70(0x216)](createMessageElement(_0x892beb,_0x18a1fa)))):emptyState[_0x13fd70(0x1d1)][_0x13fd70(0x1c3)]=_0x13fd70(0x225),requestAnimationFrame(()=>chatArea[_0x13fd70(0x1e0)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x15b6d8=a0_0x22e252;messageInput['style'][_0x15b6d8(0x234)]=_0x15b6d8(0x22c),messageInput[_0x15b6d8(0x1d1)][_0x15b6d8(0x234)]=Math[_0x15b6d8(0x22d)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x21d4df=a0_0x22e252,_0x27e8e1=messageInput[_0x21d4df(0x23f)][_0x21d4df(0x1e6)]();sendBtn[_0x21d4df(0x1ca)]=!_0x27e8e1||isTyping;}async function sendMessage(){const _0x3e5fd5=a0_0x22e252,_0x334521=messageInput[_0x3e5fd5(0x23f)][_0x3e5fd5(0x1e6)]();if(!_0x334521||isTyping)return;if(tg?.[_0x3e5fd5(0x22f)])tg[_0x3e5fd5(0x22f)][_0x3e5fd5(0x207)]('light');messages['push']({'role':_0x3e5fd5(0x1ec),'content':_0x334521,'timestamp':Date[_0x3e5fd5(0x202)]()}),localStorage[_0x3e5fd5(0x1d7)](_0x3e5fd5(0x21f),JSON[_0x3e5fd5(0x20b)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x3e5fd5(0x1e0)]=chatArea['scrollHeight'];const _0x1adc1a=await callBackend(_0x3e5fd5(0x22b),{'message':_0x334521});isTyping=![];const _0x4ea2fe=document[_0x3e5fd5(0x1cb)]('typingIndicator');if(_0x4ea2fe)_0x4ea2fe[_0x3e5fd5(0x1df)]();let _0x4b16a4='Ошибка\x20сети';if(_0x1adc1a[_0x3e5fd5(0x230)]){_0x4b16a4=_0x1adc1a['text']||_0x3e5fd5(0x201);if(tg?.[_0x3e5fd5(0x22f)])tg[_0x3e5fd5(0x22f)]['notificationOccurred'](_0x3e5fd5(0x230));}else{_0x4b16a4=_0x1adc1a[_0x3e5fd5(0x226)]||_0x3e5fd5(0x208);if(tg?.[_0x3e5fd5(0x22f)])tg['HapticFeedback'][_0x3e5fd5(0x1d3)](_0x3e5fd5(0x226));}messages['push']({'role':'ai','content':_0x4b16a4,'timestamp':Date['now']()}),localStorage[_0x3e5fd5(0x1d7)](_0x3e5fd5(0x21f),JSON[_0x3e5fd5(0x20b)](messages)),renderMessages();}function confirmDelete(_0x39049d){const _0x56afce=a0_0x22e252;if(mTitle)mTitle['textContent']=_0x56afce(0x22a);if(mText)mText[_0x56afce(0x227)]=_0x56afce(0x215);modalCallback=()=>{const _0x1264bf=_0x56afce;messages[_0x1264bf(0x200)](_0x39049d,0x1),localStorage[_0x1264bf(0x1d7)](_0x1264bf(0x21f),JSON[_0x1264bf(0x20b)](messages)),renderMessages();},modal[_0x56afce(0x23c)][_0x56afce(0x20e)](_0x56afce(0x238));}if(clearBtn)clearBtn[a0_0x22e252(0x20d)]=()=>{const _0x13e18a=a0_0x22e252;if(!messages[_0x13e18a(0x235)])return;if(mTitle)mTitle['textContent']=_0x13e18a(0x1ee);if(mText)mText['textContent']=_0x13e18a(0x1fe);modalCallback=async()=>{const _0x428b75=_0x13e18a;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x428b75(0x220),{});},modal[_0x13e18a(0x23c)][_0x13e18a(0x20e)]('show');};document['getElementById'](a0_0x22e252(0x1fc))[a0_0x22e252(0x20d)]=()=>modal[a0_0x22e252(0x23c)][a0_0x22e252(0x1df)](a0_0x22e252(0x238)),document[a0_0x22e252(0x1cb)](a0_0x22e252(0x21a))[a0_0x22e252(0x20d)]=()=>{const _0x4037d9=a0_0x22e252;if(modalCallback)modalCallback();modal[_0x4037d9(0x23c)]['remove'](_0x4037d9(0x238));},messageInput[a0_0x22e252(0x1ce)](a0_0x22e252(0x1cd),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x22e252(0x1ef),_0x4942c8=>{const _0x3a0e19=a0_0x22e252;_0x4942c8[_0x3a0e19(0x1c7)]===_0x3a0e19(0x1f9)&&!_0x4942c8[_0x3a0e19(0x1e1)]&&(_0x4942c8[_0x3a0e19(0x20f)](),sendMessage());}),sendBtn[a0_0x22e252(0x20d)]=sendMessage,document[a0_0x22e252(0x1ce)]('click',_0x1b14c5=>{const _0x3b3305=a0_0x22e252;document[_0x3b3305(0x1e4)](_0x3b3305(0x1e5))[_0x3b3305(0x1ed)](_0x42283c=>{const _0x1afff9=_0x3b3305;if(!_0x42283c[_0x1afff9(0x218)](_0x1b14c5['target']))_0x42283c[_0x1afff9(0x23c)][_0x1afff9(0x1df)]('show-delete');});});const saved=localStorage['getItem'](a0_0x22e252(0x21f));if(saved)try{messages=JSON[a0_0x22e252(0x229)](saved),renderMessages();}catch(a0_0x432562){}updateSendButton();