const a0_0x4277c=a0_0x22c7;(function(_0x59dca0,_0x35494c){const _0x14be22=a0_0x22c7,_0x155f15=_0x59dca0();while(!![]){try{const _0x84e26a=-parseInt(_0x14be22(0x1e7))/0x1+-parseInt(_0x14be22(0x256))/0x2*(parseInt(_0x14be22(0x1fd))/0x3)+parseInt(_0x14be22(0x240))/0x4*(parseInt(_0x14be22(0x248))/0x5)+parseInt(_0x14be22(0x24e))/0x6+-parseInt(_0x14be22(0x264))/0x7+parseInt(_0x14be22(0x224))/0x8*(parseInt(_0x14be22(0x20c))/0x9)+parseInt(_0x14be22(0x227))/0xa*(parseInt(_0x14be22(0x1f9))/0xb);if(_0x84e26a===_0x35494c)break;else _0x155f15['push'](_0x155f15['shift']());}catch(_0x278035){_0x155f15['push'](_0x155f15['shift']());}}}(a0_0x5e5e,0x8a223));const tg=window[a0_0x4277c(0x21f)]?.[a0_0x4277c(0x247)],HOME_URL=a0_0x4277c(0x261);function a0_0x5e5e(){const _0x4c8e00=['user','className','touchend','typingIndicator','display','Удалить?','setItem','flex','Enter','addEventListener','TG\x20setup\x20error:','Очистить\x20историю?','POST','contains','modalText','Пустой\x20ответ','error','show-delete','push','none','381252KPNbNe','show','preventDefault','(((.+)+)+)+$','getItem','resize','onClick','WebApp','45KMoUuw','replace','appendChild','toString','ai_chat_messages','warn','3505410CpLHGM','classList','add','textContent','key','querySelectorAll','stringify','text','44HSyQOh','auto','chatArea','input','inputArea','trim','send_message','querySelector','message-time','username','focus','./router.html','.container','message\x20ai','6184633QwRdJc','keydown','first_name','debug_uid','.message.show-delete','createElement','264944VuSgrl','notificationOccurred','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','scrollTop','removeItem','medium','search','#050505','BackButton','onclick','splice','children','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','6.1','impactOccurred','min','from','getElementById','11AOKgVD','success','role','style','37029Bdfsai','floor','offsetHeight','stopPropagation','value','disableVerticalSwipes','scrollHeight','initDataUnsafe','viewportChanged','length','now','remove','light','target','offClick','1278duuAZX','div','messageInput','height','padStart','href','disabled','Начнется\x20новый\x20диалог.','Ошибка\x20сети','innerHTML','modalTitle','getHours','apply','content','confirmModal','setHeaderColor','forEach','initData','message\x20','Telegram','abort','HapticFeedback','viewportHeight','Ошибка\x20сервера','16928YqCfBz','touchstart','click','2432800SxTAMM','sendBtn','expand','signal','isVersionAtLeast'];a0_0x5e5e=function(){return _0x4c8e00;};return a0_0x5e5e();}function setupTelegramBackButton(){const _0x15f084=a0_0x4277c;if(!tg)return;try{tg['ready'](),tg[_0x15f084(0x229)](),tg[_0x15f084(0x21b)]?.(_0x15f084(0x1ee));if(tg[_0x15f084(0x22b)]?.(_0x15f084(0x1f4)))tg[_0x15f084(0x202)]?.();const _0x10bed6=tg[_0x15f084(0x1ef)];if(_0x10bed6){_0x10bed6['show']();if(typeof _0x10bed6[_0x15f084(0x20b)]==='function')try{_0x10bed6[_0x15f084(0x20b)]();}catch(_0x1d10a8){}_0x10bed6[_0x15f084(0x246)](()=>{const _0x2c22c1=_0x15f084;if(tg['HapticFeedback'])tg[_0x2c22c1(0x221)][_0x2c22c1(0x1f5)](_0x2c22c1(0x209));location[_0x2c22c1(0x211)]=HOME_URL;});}}catch(_0x52330c){console[_0x15f084(0x24d)](_0x15f084(0x236),_0x52330c);}}(function initStableLayout(){const _0x2e50eb=a0_0x4277c,_0x47f58c=(function(){let _0x8978be=!![];return function(_0x2a81d6,_0x360509){const _0x2bbfd2=_0x8978be?function(){const _0x5dff7f=a0_0x22c7;if(_0x360509){const _0x3fb102=_0x360509[_0x5dff7f(0x218)](_0x2a81d6,arguments);return _0x360509=null,_0x3fb102;}}:function(){};return _0x8978be=![],_0x2bbfd2;};}()),_0x26a803=document[_0x2e50eb(0x25d)](_0x2e50eb(0x262)),_0xfbaf3c=document[_0x2e50eb(0x1f8)](_0x2e50eb(0x25a)),_0x9efd36=document['getElementById'](_0x2e50eb(0x258)),_0x23994c=document[_0x2e50eb(0x1f8)]('messageInput');function _0x5ac992(){const _0xa90adc=_0x2e50eb,_0x5e60e2=_0x47f58c(this,function(){const _0x5c9bb2=a0_0x22c7;return _0x5e60e2['toString']()[_0x5c9bb2(0x1ed)](_0x5c9bb2(0x243))[_0x5c9bb2(0x24b)]()['constructor'](_0x5e60e2)[_0x5c9bb2(0x1ed)](_0x5c9bb2(0x243));});_0x5e60e2();if(!_0x26a803)return;const _0x4adc28=tg&&tg['viewportHeight']?tg[_0xa90adc(0x222)]:window['innerHeight'];_0x26a803[_0xa90adc(0x1fc)][_0xa90adc(0x20f)]=_0x4adc28+'px';if(_0xfbaf3c){const _0x2530e8=_0xfbaf3c[_0xa90adc(0x1ff)];_0x9efd36[_0xa90adc(0x1fc)]['paddingBottom']=_0x2530e8+0x28+'px';}}tg?tg['onEvent'](_0x2e50eb(0x205),({isStateStable:_0x191c08})=>{_0x5ac992();if(_0x191c08)requestAnimationFrame(()=>{const _0x315a08=a0_0x22c7;_0x9efd36[_0x315a08(0x1ea)]=_0x9efd36[_0x315a08(0x203)];});}):window[_0x2e50eb(0x235)](_0x2e50eb(0x245),_0x5ac992),_0x5ac992(),_0x23994c&&(_0x23994c[_0x2e50eb(0x235)](_0x2e50eb(0x259),()=>{requestAnimationFrame(_0x5ac992);}),_0x23994c[_0x2e50eb(0x235)](_0x2e50eb(0x260),()=>{setTimeout(()=>{const _0x29cc29=a0_0x22c7;_0x9efd36[_0x29cc29(0x1ea)]=_0x9efd36[_0x29cc29(0x203)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x22c7(_0x440a72,_0x3a9c83){_0x440a72=_0x440a72-0x1e7;const _0xdf7d86=a0_0x5e5e();let _0x4dcb4c=_0xdf7d86[_0x440a72];return _0x4dcb4c;}const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4277c(0x1f8)](a0_0x4277c(0x258)),emptyState=document[a0_0x4277c(0x1f8)]('emptyState'),messageInput=document['getElementById'](a0_0x4277c(0x20e)),sendBtn=document[a0_0x4277c(0x1f8)](a0_0x4277c(0x228)),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0x4277c(0x1f8)](a0_0x4277c(0x21a)),mTitle=document['getElementById'](a0_0x4277c(0x216)),mText=document[a0_0x4277c(0x1f8)](a0_0x4277c(0x23a));let modalCallback=null;async function callBackend(_0x439316,_0x33a1f5){const _0x5052a4=a0_0x4277c,_0x29aedb=tg?.[_0x5052a4(0x204)]?.['user']||{},_0x320988=_0x29aedb['id']||localStorage[_0x5052a4(0x244)](_0x5052a4(0x267))||'d-'+Math[_0x5052a4(0x1fe)](Math['random']()*0x3b9aca00);if(!_0x29aedb['id'])localStorage[_0x5052a4(0x232)](_0x5052a4(0x267),_0x320988);const _0x56a700={'action':_0x439316,'user_id':_0x320988,'user_data':{'first_name':_0x29aedb[_0x5052a4(0x266)],'username':_0x29aedb[_0x5052a4(0x25f)]},'init_data':tg?.[_0x5052a4(0x21d)]||'',..._0x33a1f5},_0x385116=new AbortController(),_0x48f789=setTimeout(()=>_0x385116[_0x5052a4(0x220)](),REQUEST_TIMEOUT_MS);try{const _0x3da810=await fetch(BACKEND_URL,{'method':_0x5052a4(0x238),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x5052a4(0x254)](_0x56a700),'signal':_0x385116[_0x5052a4(0x22a)]});return clearTimeout(_0x48f789),await _0x3da810['json']();}catch(_0x3808e1){return{'success':![],'error':String(_0x3808e1)};}}function formatTime(_0x350c3f){const _0x57f2d5=a0_0x4277c,_0x16e745=new Date(_0x350c3f);return String(_0x16e745[_0x57f2d5(0x217)]())[_0x57f2d5(0x210)](0x2,'0')+':'+String(_0x16e745['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x189871,_0x3c26f6){const _0x30a5af=a0_0x4277c,_0x55cdb2=document[_0x30a5af(0x269)](_0x30a5af(0x20d));_0x55cdb2[_0x30a5af(0x22d)]=_0x30a5af(0x21e)+_0x189871[_0x30a5af(0x1fb)];const _0x462e7e=document[_0x30a5af(0x269)]('div');_0x462e7e[_0x30a5af(0x22d)]='message-bubble',_0x462e7e[_0x30a5af(0x215)]=_0x189871[_0x30a5af(0x219)][_0x30a5af(0x249)](/\n/g,'<br>');const _0x1ff075=document[_0x30a5af(0x269)]('div');_0x1ff075[_0x30a5af(0x22d)]='delete-btn',_0x1ff075[_0x30a5af(0x215)]=_0x30a5af(0x1f3),_0x1ff075[_0x30a5af(0x1f0)]=_0xc27f04=>{const _0x1ca61e=_0x30a5af;_0xc27f04[_0x1ca61e(0x200)](),confirmDelete(_0x3c26f6);};let _0x1aa0bb;_0x462e7e[_0x30a5af(0x235)](_0x30a5af(0x225),()=>_0x1aa0bb=setTimeout(()=>{const _0x364342=_0x30a5af;_0x55cdb2[_0x364342(0x24f)][_0x364342(0x250)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x364342(0x221)][_0x364342(0x1f5)](_0x364342(0x1ec));},0x1f4)),_0x462e7e[_0x30a5af(0x235)](_0x30a5af(0x22e),()=>clearTimeout(_0x1aa0bb));const _0xd45f9d=document[_0x30a5af(0x269)](_0x30a5af(0x20d));return _0xd45f9d['className']=_0x30a5af(0x25e),_0xd45f9d['textContent']=formatTime(_0x189871['timestamp']),_0x55cdb2[_0x30a5af(0x24a)](_0x1ff075),_0x55cdb2[_0x30a5af(0x24a)](_0x462e7e),_0x55cdb2[_0x30a5af(0x24a)](_0xd45f9d),_0x55cdb2;}function createTypingIndicator(){const _0x447fe6=a0_0x4277c,_0x20abc8=document[_0x447fe6(0x269)]('div');return _0x20abc8['className']=_0x447fe6(0x263),_0x20abc8['id']=_0x447fe6(0x22f),_0x20abc8[_0x447fe6(0x215)]=_0x447fe6(0x1e9),_0x20abc8;}function renderMessages(){const _0x43511b=a0_0x4277c;Array[_0x43511b(0x1f7)](chatArea[_0x43511b(0x1f2)])[_0x43511b(0x21c)](_0x2d5436=>{if(_0x2d5436['id']!=='emptyState')_0x2d5436['remove']();}),messages[_0x43511b(0x206)]>0x0?(emptyState[_0x43511b(0x1fc)]['display']=_0x43511b(0x23f),messages[_0x43511b(0x21c)]((_0x40fa82,_0x2369fc)=>chatArea[_0x43511b(0x24a)](createMessageElement(_0x40fa82,_0x2369fc)))):emptyState[_0x43511b(0x1fc)][_0x43511b(0x230)]=_0x43511b(0x233),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x35a19f=a0_0x4277c;messageInput['style'][_0x35a19f(0x20f)]=_0x35a19f(0x257),messageInput[_0x35a19f(0x1fc)]['height']=Math[_0x35a19f(0x1f6)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x3b808d=a0_0x4277c,_0x165e0d=messageInput[_0x3b808d(0x201)]['trim']();sendBtn[_0x3b808d(0x212)]=!_0x165e0d||isTyping;}async function sendMessage(){const _0x1bd68f=a0_0x4277c,_0x4a0ec7=messageInput[_0x1bd68f(0x201)][_0x1bd68f(0x25b)]();if(!_0x4a0ec7||isTyping)return;if(tg?.[_0x1bd68f(0x221)])tg['HapticFeedback'][_0x1bd68f(0x1f5)](_0x1bd68f(0x209));messages['push']({'role':_0x1bd68f(0x22c),'content':_0x4a0ec7,'timestamp':Date[_0x1bd68f(0x207)]()}),localStorage['setItem'](_0x1bd68f(0x24c),JSON[_0x1bd68f(0x254)](messages)),renderMessages(),messageInput[_0x1bd68f(0x201)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x1bd68f(0x1ea)]=chatArea[_0x1bd68f(0x203)];const _0x1c9172=await callBackend(_0x1bd68f(0x25c),{'message':_0x4a0ec7});isTyping=![];const _0x580cf5=document[_0x1bd68f(0x1f8)](_0x1bd68f(0x22f));if(_0x580cf5)_0x580cf5['remove']();let _0x30a206=_0x1bd68f(0x214);if(_0x1c9172[_0x1bd68f(0x1fa)]){_0x30a206=_0x1c9172[_0x1bd68f(0x255)]||_0x1bd68f(0x23b);if(tg?.[_0x1bd68f(0x221)])tg[_0x1bd68f(0x221)][_0x1bd68f(0x1e8)](_0x1bd68f(0x1fa));}else{_0x30a206=_0x1c9172[_0x1bd68f(0x23c)]||_0x1bd68f(0x223);if(tg?.['HapticFeedback'])tg[_0x1bd68f(0x221)][_0x1bd68f(0x1e8)](_0x1bd68f(0x23c));}messages[_0x1bd68f(0x23e)]({'role':'ai','content':_0x30a206,'timestamp':Date[_0x1bd68f(0x207)]()}),localStorage[_0x1bd68f(0x232)](_0x1bd68f(0x24c),JSON[_0x1bd68f(0x254)](messages)),renderMessages();}function confirmDelete(_0x4a4942){const _0x2187b4=a0_0x4277c;if(mTitle)mTitle[_0x2187b4(0x251)]=_0x2187b4(0x231);if(mText)mText[_0x2187b4(0x251)]='Действие\x20необратимо.';modalCallback=()=>{const _0x594c3d=_0x2187b4;messages[_0x594c3d(0x1f1)](_0x4a4942,0x1),localStorage[_0x594c3d(0x232)](_0x594c3d(0x24c),JSON[_0x594c3d(0x254)](messages)),renderMessages();},modal['classList'][_0x2187b4(0x250)](_0x2187b4(0x241));}if(clearBtn)clearBtn[a0_0x4277c(0x1f0)]=()=>{const _0x1adac3=a0_0x4277c;if(!messages[_0x1adac3(0x206)])return;if(mTitle)mTitle[_0x1adac3(0x251)]=_0x1adac3(0x237);if(mText)mText[_0x1adac3(0x251)]=_0x1adac3(0x213);modalCallback=async()=>{const _0x424441=_0x1adac3;messages=[],localStorage[_0x424441(0x1eb)](_0x424441(0x24c)),renderMessages(),callBackend('clear_history',{});},modal[_0x1adac3(0x24f)][_0x1adac3(0x250)](_0x1adac3(0x241));};document['getElementById']('modalCancel')[a0_0x4277c(0x1f0)]=()=>modal[a0_0x4277c(0x24f)]['remove'](a0_0x4277c(0x241)),document['getElementById']('modalConfirm')[a0_0x4277c(0x1f0)]=()=>{const _0x4c542f=a0_0x4277c;if(modalCallback)modalCallback();modal[_0x4c542f(0x24f)][_0x4c542f(0x208)]('show');},messageInput[a0_0x4277c(0x235)](a0_0x4277c(0x259),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4277c(0x235)](a0_0x4277c(0x265),_0x27f57a=>{const _0x25afd4=a0_0x4277c;_0x27f57a[_0x25afd4(0x252)]===_0x25afd4(0x234)&&!_0x27f57a['shiftKey']&&(_0x27f57a[_0x25afd4(0x242)](),sendMessage());}),sendBtn[a0_0x4277c(0x1f0)]=sendMessage,document[a0_0x4277c(0x235)](a0_0x4277c(0x226),_0x12166b=>{const _0x2ff03c=a0_0x4277c;document[_0x2ff03c(0x253)](_0x2ff03c(0x268))[_0x2ff03c(0x21c)](_0x8615da=>{const _0x3a548a=_0x2ff03c;if(!_0x8615da[_0x3a548a(0x239)](_0x12166b[_0x3a548a(0x20a)]))_0x8615da[_0x3a548a(0x24f)][_0x3a548a(0x208)](_0x3a548a(0x23d));});});const saved=localStorage[a0_0x4277c(0x244)](a0_0x4277c(0x24c));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x5825ee){}updateSendButton();