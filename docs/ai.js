const a0_0x325843=a0_0x717e;(function(_0x3b6f39,_0x5dd65c){const _0x23b865=a0_0x717e,_0xa3937b=_0x3b6f39();while(!![]){try{const _0x3bdd5f=parseInt(_0x23b865(0x1e1))/0x1+parseInt(_0x23b865(0x223))/0x2+parseInt(_0x23b865(0x207))/0x3+-parseInt(_0x23b865(0x237))/0x4+-parseInt(_0x23b865(0x1e3))/0x5+parseInt(_0x23b865(0x20a))/0x6*(parseInt(_0x23b865(0x236))/0x7)+-parseInt(_0x23b865(0x1db))/0x8;if(_0x3bdd5f===_0x5dd65c)break;else _0xa3937b['push'](_0xa3937b['shift']());}catch(_0x347f11){_0xa3937b['push'](_0xa3937b['shift']());}}}(a0_0x28a1,0xd2db0));const tg=window[a0_0x325843(0x24a)]?.['WebApp'],HOME_URL=a0_0x325843(0x228);function setupTelegramBackButton(){const _0x28f580=a0_0x325843;if(!tg)return;try{tg[_0x28f580(0x257)](),tg['expand'](),tg[_0x28f580(0x1eb)]?.('#050505');if(tg[_0x28f580(0x23b)]?.(_0x28f580(0x202)))tg[_0x28f580(0x1e5)]?.();const _0x29adc3=tg['BackButton'];if(_0x29adc3){_0x29adc3[_0x28f580(0x24b)]();if(typeof _0x29adc3[_0x28f580(0x1e8)]===_0x28f580(0x20c))try{_0x29adc3[_0x28f580(0x1e8)]();}catch(_0x2e075d){}_0x29adc3[_0x28f580(0x23f)](()=>{const _0x5472ce=_0x28f580;if(tg['HapticFeedback'])tg['HapticFeedback'][_0x5472ce(0x1ee)]('light');location[_0x5472ce(0x256)]=HOME_URL;});}}catch(_0x29d0c4){console['warn'](_0x28f580(0x1e4),_0x29d0c4);}}(function initStableLayout(){const _0x169266=a0_0x325843,_0x16515d=(function(){let _0x1610db=!![];return function(_0x5976d9,_0x150cf5){const _0x54d018=_0x1610db?function(){const _0x9134d3=a0_0x717e;if(_0x150cf5){const _0x3aff33=_0x150cf5[_0x9134d3(0x23e)](_0x5976d9,arguments);return _0x150cf5=null,_0x3aff33;}}:function(){};return _0x1610db=![],_0x54d018;};}()),_0x427782=document[_0x169266(0x20f)]('.container'),_0x5d8cae=document[_0x169266(0x1f3)](_0x169266(0x1e0)),_0x17b8d8=document[_0x169266(0x1f3)](_0x169266(0x205)),_0x1707fd=document['getElementById'](_0x169266(0x252));function _0x215b8c(){const _0x485f3b=_0x169266,_0x106973=_0x16515d(this,function(){const _0x3db3ad=a0_0x717e;return _0x106973['toString']()['search'](_0x3db3ad(0x23a))[_0x3db3ad(0x240)]()[_0x3db3ad(0x258)](_0x106973)['search']('(((.+)+)+)+$');});_0x106973();if(!_0x427782)return;const _0x38b4d2=tg&&tg[_0x485f3b(0x201)]?tg[_0x485f3b(0x201)]:window[_0x485f3b(0x1fe)];_0x427782[_0x485f3b(0x1ef)][_0x485f3b(0x215)]=_0x38b4d2+'px';if(_0x5d8cae){const _0x3ecf08=_0x5d8cae[_0x485f3b(0x1ea)];_0x17b8d8[_0x485f3b(0x1ef)][_0x485f3b(0x1e7)]=_0x3ecf08+0x28+'px';}}tg?tg['onEvent'](_0x169266(0x253),({isStateStable:_0x22cae8})=>{_0x215b8c();if(_0x22cae8)requestAnimationFrame(()=>{const _0x2fd94b=a0_0x717e;_0x17b8d8[_0x2fd94b(0x241)]=_0x17b8d8[_0x2fd94b(0x242)];});}):window[_0x169266(0x208)](_0x169266(0x21f),_0x215b8c),_0x215b8c(),_0x1707fd&&(_0x1707fd['addEventListener'](_0x169266(0x1fd),()=>{requestAnimationFrame(_0x215b8c);}),_0x1707fd[_0x169266(0x208)]('focus',()=>{setTimeout(()=>{const _0xeb60=a0_0x717e;_0x17b8d8[_0xeb60(0x241)]=_0x17b8d8['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x325843(0x219),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x325843(0x1f3)](a0_0x325843(0x205)),emptyState=document[a0_0x325843(0x1f3)](a0_0x325843(0x247)),messageInput=document[a0_0x325843(0x1f3)](a0_0x325843(0x252)),sendBtn=document[a0_0x325843(0x1f3)](a0_0x325843(0x204)),clearBtn=document[a0_0x325843(0x1f3)](a0_0x325843(0x1da)),modal=document['getElementById'](a0_0x325843(0x1de)),mTitle=document['getElementById'](a0_0x325843(0x218)),mText=document[a0_0x325843(0x1f3)](a0_0x325843(0x22d));let modalCallback=null;async function callBackend(_0x89e20,_0x5a2c96){const _0x19cee7=a0_0x325843,_0x498cc5=tg?.[_0x19cee7(0x231)]?.['user']||{},_0x3cf70a=_0x498cc5['id']||localStorage[_0x19cee7(0x24c)](_0x19cee7(0x226))||'d-'+Math[_0x19cee7(0x22c)](Math[_0x19cee7(0x22b)]()*0x3b9aca00);if(!_0x498cc5['id'])localStorage[_0x19cee7(0x227)](_0x19cee7(0x226),_0x3cf70a);const _0x4403b9={'action':_0x89e20,'user_id':_0x3cf70a,'user_data':{'first_name':_0x498cc5[_0x19cee7(0x232)],'username':_0x498cc5[_0x19cee7(0x1e9)]},'init_data':tg?.['initData']||'',..._0x5a2c96},_0x59ee6f=new AbortController(),_0x528683=setTimeout(()=>_0x59ee6f['abort'](),REQUEST_TIMEOUT_MS);try{const _0x2ea4f6=await fetch(BACKEND_URL,{'method':_0x19cee7(0x248),'headers':{'Content-Type':_0x19cee7(0x25b)},'body':JSON['stringify'](_0x4403b9),'signal':_0x59ee6f[_0x19cee7(0x25a)]});return clearTimeout(_0x528683),await _0x2ea4f6[_0x19cee7(0x1fa)]();}catch(_0x592e8d){return{'success':![],'error':String(_0x592e8d)};}}function formatTime(_0x2f59c4){const _0x24fe34=a0_0x325843,_0x4c519d=new Date(_0x2f59c4);return String(_0x4c519d[_0x24fe34(0x1ff)]())[_0x24fe34(0x255)](0x2,'0')+':'+String(_0x4c519d[_0x24fe34(0x213)]())[_0x24fe34(0x255)](0x2,'0');}function createMessageElement(_0x593576,_0x4be42c){const _0x491da6=a0_0x325843,_0x551a90=document[_0x491da6(0x20e)]('div');_0x551a90[_0x491da6(0x254)]=_0x491da6(0x21a)+_0x593576[_0x491da6(0x245)];const _0x526325=document[_0x491da6(0x20e)](_0x491da6(0x211));_0x526325[_0x491da6(0x254)]=_0x491da6(0x21c),_0x526325[_0x491da6(0x249)]=_0x593576[_0x491da6(0x216)][_0x491da6(0x234)](/\n/g,_0x491da6(0x1f2));const _0x2ab1a9=document[_0x491da6(0x20e)](_0x491da6(0x211));_0x2ab1a9['className']=_0x491da6(0x21e),_0x2ab1a9['innerHTML']=_0x491da6(0x24f),_0x2ab1a9[_0x491da6(0x203)]=_0x5b48f4=>{_0x5b48f4['stopPropagation'](),confirmDelete(_0x4be42c);};let _0x285962;_0x526325['addEventListener'](_0x491da6(0x21d),()=>_0x285962=setTimeout(()=>{const _0x17a327=_0x491da6;_0x551a90[_0x17a327(0x214)]['add']('show-delete');if(tg?.[_0x17a327(0x1f1)])tg['HapticFeedback'][_0x17a327(0x1ee)](_0x17a327(0x209));},0x1f4)),_0x526325['addEventListener']('touchend',()=>clearTimeout(_0x285962));const _0x2d5bac=document[_0x491da6(0x20e)](_0x491da6(0x211));return _0x2d5bac[_0x491da6(0x254)]=_0x491da6(0x1ed),_0x2d5bac['textContent']=formatTime(_0x593576[_0x491da6(0x1fb)]),_0x551a90[_0x491da6(0x20d)](_0x2ab1a9),_0x551a90['appendChild'](_0x526325),_0x551a90[_0x491da6(0x20d)](_0x2d5bac),_0x551a90;}function createTypingIndicator(){const _0x8c5a43=a0_0x325843,_0x19faf7=document[_0x8c5a43(0x20e)]('div');return _0x19faf7[_0x8c5a43(0x254)]='message\x20ai',_0x19faf7['id']=_0x8c5a43(0x1e2),_0x19faf7[_0x8c5a43(0x249)]=_0x8c5a43(0x22e),_0x19faf7;}function renderMessages(){const _0x1fe7dc=a0_0x325843;Array['from'](chatArea[_0x1fe7dc(0x217)])[_0x1fe7dc(0x1f8)](_0x4d00e7=>{if(_0x4d00e7['id']!=='emptyState')_0x4d00e7['remove']();}),messages[_0x1fe7dc(0x1f6)]>0x0?(emptyState[_0x1fe7dc(0x1ef)]['display']=_0x1fe7dc(0x246),messages[_0x1fe7dc(0x1f8)]((_0x414003,_0x41283f)=>chatArea[_0x1fe7dc(0x20d)](createMessageElement(_0x414003,_0x41283f)))):emptyState[_0x1fe7dc(0x1ef)]['display']='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x1fe7dc(0x242)]);}function autoResizeTextarea(){const _0x324041=a0_0x325843;messageInput['style'][_0x324041(0x215)]=_0x324041(0x24e),messageInput[_0x324041(0x1ef)]['height']=Math[_0x324041(0x23c)](messageInput[_0x324041(0x242)],0x78)+'px';}function updateSendButton(){const _0x5d5e00=a0_0x325843,_0x3d19a3=messageInput[_0x5d5e00(0x1f5)][_0x5d5e00(0x230)]();sendBtn[_0x5d5e00(0x200)]=!_0x3d19a3||isTyping;}async function sendMessage(){const _0x1e5108=a0_0x325843,_0x380995=messageInput[_0x1e5108(0x1f5)]['trim']();if(!_0x380995||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x1e5108(0x1f1)]['impactOccurred'](_0x1e5108(0x244));messages['push']({'role':_0x1e5108(0x22f),'content':_0x380995,'timestamp':Date[_0x1e5108(0x206)]()}),localStorage[_0x1e5108(0x227)](_0x1e5108(0x221),JSON[_0x1e5108(0x1f4)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x1e5108(0x242)];const _0x16ef93=await callBackend(_0x1e5108(0x235),{'message':_0x380995});isTyping=![];const _0x36b2f3=document[_0x1e5108(0x1f3)](_0x1e5108(0x1e2));if(_0x36b2f3)_0x36b2f3[_0x1e5108(0x243)]();let _0x217979=_0x1e5108(0x259);if(_0x16ef93['success']){_0x217979=_0x16ef93[_0x1e5108(0x1fc)]||_0x1e5108(0x1dc);if(tg?.[_0x1e5108(0x1f1)])tg['HapticFeedback']['notificationOccurred'](_0x1e5108(0x1dd));}else{_0x217979=_0x16ef93['error']||_0x1e5108(0x250);if(tg?.[_0x1e5108(0x1f1)])tg[_0x1e5108(0x1f1)][_0x1e5108(0x1f7)](_0x1e5108(0x210));}messages['push']({'role':'ai','content':_0x217979,'timestamp':Date[_0x1e5108(0x206)]()}),localStorage[_0x1e5108(0x227)](_0x1e5108(0x221),JSON[_0x1e5108(0x1f4)](messages)),renderMessages();}function confirmDelete(_0x2f3386){const _0xbd17e1=a0_0x325843;if(mTitle)mTitle[_0xbd17e1(0x21b)]=_0xbd17e1(0x225);if(mText)mText[_0xbd17e1(0x21b)]=_0xbd17e1(0x24d);modalCallback=()=>{const _0x2257d4=_0xbd17e1;messages[_0x2257d4(0x1df)](_0x2f3386,0x1),localStorage[_0x2257d4(0x227)](_0x2257d4(0x221),JSON['stringify'](messages)),renderMessages();},modal[_0xbd17e1(0x214)]['add'](_0xbd17e1(0x24b));}if(clearBtn)clearBtn[a0_0x325843(0x203)]=()=>{const _0x562de0=a0_0x325843;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x562de0(0x1ec);if(mText)mText[_0x562de0(0x21b)]=_0x562de0(0x238);modalCallback=async()=>{const _0x32680e=_0x562de0;messages=[],localStorage[_0x32680e(0x239)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x562de0(0x23d)]('show');};document[a0_0x325843(0x1f3)]('modalCancel')[a0_0x325843(0x203)]=()=>modal[a0_0x325843(0x214)]['remove'](a0_0x325843(0x24b)),document[a0_0x325843(0x1f3)](a0_0x325843(0x220))[a0_0x325843(0x203)]=()=>{const _0x499423=a0_0x325843;if(modalCallback)modalCallback();modal['classList'][_0x499423(0x243)]('show');},messageInput[a0_0x325843(0x208)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x325843(0x212),_0x2d9f5f=>{const _0x5339ec=a0_0x325843;_0x2d9f5f[_0x5339ec(0x1f0)]===_0x5339ec(0x251)&&!_0x2d9f5f[_0x5339ec(0x229)]&&(_0x2d9f5f[_0x5339ec(0x22a)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x325843(0x208)](a0_0x325843(0x1f9),_0x30885a=>{const _0x3e4c06=a0_0x325843;document[_0x3e4c06(0x1e6)](_0x3e4c06(0x222))['forEach'](_0x36c7aa=>{const _0x2ef4aa=_0x3e4c06;if(!_0x36c7aa[_0x2ef4aa(0x224)](_0x30885a['target']))_0x36c7aa[_0x2ef4aa(0x214)][_0x2ef4aa(0x243)](_0x2ef4aa(0x20b));});});const saved=localStorage[a0_0x325843(0x24c)]('ai_chat_messages');function a0_0x28a1(){const _0x4ab4d9=['div','keydown','getMinutes','classList','height','content','children','modalTitle','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','message\x20','textContent','message-bubble','touchstart','delete-btn','resize','modalConfirm','ai_chat_messages','.message.show-delete','212256ZiXkBH','contains','Удалить?','debug_uid','setItem','./router.html','shiftKey','preventDefault','random','floor','modalText','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','user','trim','initDataUnsafe','first_name','parse','replace','send_message','1764ZsOusy','1610888WYFyVL','Начнется\x20новый\x20диалог.','removeItem','(((.+)+)+)+$','isVersionAtLeast','min','add','apply','onClick','toString','scrollTop','scrollHeight','remove','light','role','none','emptyState','POST','innerHTML','Telegram','show','getItem','Действие\x20необратимо.','auto','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Ошибка\x20сервера','Enter','messageInput','viewportChanged','className','padStart','href','ready','constructor','Ошибка\x20сети','signal','text/plain','clearBtn','4808736wqyVIW','Пустой\x20ответ','success','confirmModal','splice','inputArea','445756EwwiHt','typingIndicator','5463200xngSwU','TG\x20setup\x20error:','disableVerticalSwipes','querySelectorAll','paddingBottom','offClick','username','offsetHeight','setHeaderColor','Очистить\x20историю?','message-time','impactOccurred','style','key','HapticFeedback','<br>','getElementById','stringify','value','length','notificationOccurred','forEach','click','json','timestamp','text','input','innerHeight','getHours','disabled','viewportHeight','6.1','onclick','sendBtn','chatArea','now','2325066yRylkE','addEventListener','medium','38886AEPjgl','show-delete','function','appendChild','createElement','querySelector','error'];a0_0x28a1=function(){return _0x4ab4d9;};return a0_0x28a1();}function a0_0x717e(_0xe385dc,_0x2e0300){_0xe385dc=_0xe385dc-0x1da;const _0x2854a8=a0_0x28a1();let _0x209ebd=_0x2854a8[_0xe385dc];return _0x209ebd;}if(saved)try{messages=JSON[a0_0x325843(0x233)](saved),renderMessages();}catch(a0_0x5a1532){}updateSendButton();