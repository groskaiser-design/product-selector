const a0_0x321763=a0_0x1a51;(function(_0x196749,_0x50e8d0){const _0x238c6c=a0_0x1a51,_0x2f8dce=_0x196749();while(!![]){try{const _0x4d1add=-parseInt(_0x238c6c(0x170))/0x1*(-parseInt(_0x238c6c(0x113))/0x2)+parseInt(_0x238c6c(0x10b))/0x3*(-parseInt(_0x238c6c(0x11d))/0x4)+-parseInt(_0x238c6c(0x17b))/0x5*(-parseInt(_0x238c6c(0x143))/0x6)+-parseInt(_0x238c6c(0x16d))/0x7+parseInt(_0x238c6c(0x105))/0x8+-parseInt(_0x238c6c(0x14b))/0x9*(parseInt(_0x238c6c(0x12b))/0xa)+parseInt(_0x238c6c(0x12c))/0xb*(parseInt(_0x238c6c(0x155))/0xc);if(_0x4d1add===_0x50e8d0)break;else _0x2f8dce['push'](_0x2f8dce['shift']());}catch(_0xee3193){_0x2f8dce['push'](_0x2f8dce['shift']());}}}(a0_0x2c76,0xe88ba));const tg=window['Telegram']?.[a0_0x321763(0x171)],HOME_URL=a0_0x321763(0x115);function setupTelegramBackButton(){const _0x3254f3=a0_0x321763,_0x417cdf=(function(){let _0x357392=!![];return function(_0x181629,_0x5ca00e){const _0x37ae3d=_0x357392?function(){if(_0x5ca00e){const _0x2a327f=_0x5ca00e['apply'](_0x181629,arguments);return _0x5ca00e=null,_0x2a327f;}}:function(){};return _0x357392=![],_0x37ae3d;};}()),_0x299433=_0x417cdf(this,function(){const _0x1c8010=a0_0x1a51;return _0x299433[_0x1c8010(0x13c)]()[_0x1c8010(0x121)](_0x1c8010(0x15c))['toString']()['constructor'](_0x299433)[_0x1c8010(0x121)](_0x1c8010(0x15c));});_0x299433();if(!tg)return;try{tg['ready'](),tg['expand'](),tg['setHeaderColor']?.(_0x3254f3(0x17f));if(tg[_0x3254f3(0x111)]?.(_0x3254f3(0x13b)))tg[_0x3254f3(0x112)]?.();const _0x28493f=tg[_0x3254f3(0x126)];if(_0x28493f){_0x28493f['show']();if(typeof _0x28493f[_0x3254f3(0x13f)]==='function')try{_0x28493f[_0x3254f3(0x13f)]();}catch(_0xa87736){}_0x28493f[_0x3254f3(0x132)](()=>{const _0x285d33=_0x3254f3;if(tg[_0x285d33(0x148)])tg[_0x285d33(0x148)][_0x285d33(0x13e)](_0x285d33(0x106));location[_0x285d33(0x10a)]=HOME_URL;});}}catch(_0x5f2737){console[_0x3254f3(0x16b)](_0x3254f3(0x173),_0x5f2737);}}(function initStableLayout(){const _0x2d6115=a0_0x321763,_0x3aa48b=document[_0x2d6115(0x157)](_0x2d6115(0x15d)),_0x5c5726=document[_0x2d6115(0x151)](_0x2d6115(0x140)),_0x33e11d=document[_0x2d6115(0x151)](_0x2d6115(0x14f)),_0x329e0e=document['getElementById']('messageInput');function _0x27f9e8(){const _0x565b27=_0x2d6115;if(!_0x3aa48b)return;const _0x507d5a=tg&&tg[_0x565b27(0x179)]?tg['viewportHeight']:window['innerHeight'];_0x3aa48b['style'][_0x565b27(0x128)]=_0x507d5a+'px';if(_0x5c5726){const _0x5b6832=_0x5c5726[_0x565b27(0x178)];_0x33e11d[_0x565b27(0x150)][_0x565b27(0x10f)]=_0x5b6832+0x28+'px';}}tg?tg[_0x2d6115(0x166)]('viewportChanged',({isStateStable:_0x111699})=>{_0x27f9e8();if(_0x111699)requestAnimationFrame(()=>{const _0x2ad8c7=a0_0x1a51;_0x33e11d[_0x2ad8c7(0x141)]=_0x33e11d['scrollHeight'];});}):window['addEventListener'](_0x2d6115(0x14e),_0x27f9e8),_0x27f9e8(),_0x329e0e&&(_0x329e0e[_0x2d6115(0x103)](_0x2d6115(0x12e),()=>{requestAnimationFrame(_0x27f9e8);}),_0x329e0e['addEventListener'](_0x2d6115(0x14c),()=>{setTimeout(()=>{const _0x3f5ef9=a0_0x1a51;_0x33e11d[_0x3f5ef9(0x141)]=_0x33e11d[_0x3f5ef9(0x10c)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x321763(0x11a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x321763(0x151)](a0_0x321763(0x14f)),emptyState=document[a0_0x321763(0x151)](a0_0x321763(0x13a)),messageInput=document[a0_0x321763(0x151)]('messageInput'),sendBtn=document[a0_0x321763(0x151)](a0_0x321763(0x107)),clearBtn=document[a0_0x321763(0x151)]('clearBtn'),modal=document[a0_0x321763(0x151)]('confirmModal'),mTitle=document[a0_0x321763(0x151)](a0_0x321763(0x142)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x1c368f,_0x1bc146){const _0x4cb051=a0_0x321763,_0x58f001=tg?.[_0x4cb051(0x177)]?.['user']||{},_0x225887=_0x58f001['id']||localStorage[_0x4cb051(0x116)]('debug_uid')||'d-'+Math[_0x4cb051(0x123)](Math['random']()*0x3b9aca00);if(!_0x58f001['id'])localStorage['setItem']('debug_uid',_0x225887);const _0x33153d={'action':_0x1c368f,'user_id':_0x225887,'user_data':{'first_name':_0x58f001[_0x4cb051(0x167)],'username':_0x58f001[_0x4cb051(0x14d)]},'init_data':tg?.[_0x4cb051(0x160)]||'',..._0x1bc146},_0x4a8fdc=new AbortController(),_0x2ecdf2=setTimeout(()=>_0x4a8fdc[_0x4cb051(0x12a)](),REQUEST_TIMEOUT_MS);try{const _0x201535=await fetch(BACKEND_URL,{'method':_0x4cb051(0x129),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x4cb051(0x17e)](_0x33153d),'signal':_0x4a8fdc['signal']});return clearTimeout(_0x2ecdf2),await _0x201535[_0x4cb051(0x114)]();}catch(_0x31129b){return{'success':![],'error':String(_0x31129b)};}}function a0_0x2c76(){const _0x2b7bd4=['inputArea','scrollTop','modalTitle','8028aWVvrp','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','push','appendChild','touchend','HapticFeedback','replace','click','692028SHzsFv','focus','username','resize','chatArea','style','getElementById','onclick','notificationOccurred','shiftKey','684gdMEHu','show-delete','querySelector','createElement','Ошибка\x20сети','getHours','message\x20','(((.+)+)+)+$','.container','now','Очистить\x20историю?','initData','show','splice','<br>','Удалить?','Начнется\x20новый\x20диалог.','onEvent','first_name','value','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','children','warn','parse','5213782tgfOjD','trim','setItem','8035kZPvXR','WebApp','touchstart','TG\x20setup\x20error:','target','text','role','initDataUnsafe','offsetHeight','viewportHeight','display','2400FoHXvI','keydown','add','stringify','#050505','addEventListener','user','3472336DEyvtu','light','sendBtn','Enter','flex','href','6771Arwhqt','scrollHeight','disabled','typingIndicator','paddingBottom','preventDefault','isVersionAtLeast','disableVerticalSwipes','356mHwgEW','json','./router.html','getItem','error','classList','className','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','forEach','contains','1564bDYKgt','div','timestamp','padStart','search','min','floor','length','key','BackButton','.message.show-delete','height','POST','abort','50hXIgMZ','88341hLEgqn','textContent','input','innerHTML','auto','remove','onClick','ai_chat_messages','message-time','send_message','modalCancel','success','clear_history','stopPropagation','emptyState','6.1','toString','delete-btn','impactOccurred','offClick'];a0_0x2c76=function(){return _0x2b7bd4;};return a0_0x2c76();}function formatTime(_0x30bc50){const _0xc9e5eb=a0_0x321763,_0x2d0806=new Date(_0x30bc50);return String(_0x2d0806[_0xc9e5eb(0x15a)]())['padStart'](0x2,'0')+':'+String(_0x2d0806['getMinutes']())[_0xc9e5eb(0x120)](0x2,'0');}function createMessageElement(_0x382cca,_0x4d04d8){const _0x77972c=a0_0x321763,_0x2d0b16=document['createElement']('div');_0x2d0b16[_0x77972c(0x119)]=_0x77972c(0x15b)+_0x382cca[_0x77972c(0x176)];const _0x3e30d7=document[_0x77972c(0x158)]('div');_0x3e30d7[_0x77972c(0x119)]='message-bubble',_0x3e30d7[_0x77972c(0x12f)]=_0x382cca['content'][_0x77972c(0x149)](/\n/g,_0x77972c(0x163));const _0x2f5424=document[_0x77972c(0x158)]('div');_0x2f5424[_0x77972c(0x119)]=_0x77972c(0x13d),_0x2f5424[_0x77972c(0x12f)]=_0x77972c(0x169),_0x2f5424[_0x77972c(0x152)]=_0x296568=>{const _0x2b3dda=_0x77972c;_0x296568[_0x2b3dda(0x139)](),confirmDelete(_0x4d04d8);};let _0xb0e21c;_0x3e30d7[_0x77972c(0x103)](_0x77972c(0x172),()=>_0xb0e21c=setTimeout(()=>{const _0xbe20b5=_0x77972c;_0x2d0b16['classList'][_0xbe20b5(0x17d)](_0xbe20b5(0x156));if(tg?.['HapticFeedback'])tg[_0xbe20b5(0x148)][_0xbe20b5(0x13e)]('medium');},0x1f4)),_0x3e30d7[_0x77972c(0x103)](_0x77972c(0x147),()=>clearTimeout(_0xb0e21c));const _0x2f1357=document[_0x77972c(0x158)]('div');return _0x2f1357[_0x77972c(0x119)]=_0x77972c(0x134),_0x2f1357[_0x77972c(0x12d)]=formatTime(_0x382cca[_0x77972c(0x11f)]),_0x2d0b16[_0x77972c(0x146)](_0x2f5424),_0x2d0b16['appendChild'](_0x3e30d7),_0x2d0b16[_0x77972c(0x146)](_0x2f1357),_0x2d0b16;}function createTypingIndicator(){const _0x4e5b7e=a0_0x321763,_0x20e4ff=document['createElement'](_0x4e5b7e(0x11e));return _0x20e4ff[_0x4e5b7e(0x119)]='message\x20ai',_0x20e4ff['id']=_0x4e5b7e(0x10e),_0x20e4ff['innerHTML']=_0x4e5b7e(0x144),_0x20e4ff;}function renderMessages(){const _0x5ed3ce=a0_0x321763;Array['from'](chatArea[_0x5ed3ce(0x16a)])[_0x5ed3ce(0x11b)](_0x405be8=>{if(_0x405be8['id']!=='emptyState')_0x405be8['remove']();}),messages['length']>0x0?(emptyState[_0x5ed3ce(0x150)][_0x5ed3ce(0x17a)]='none',messages[_0x5ed3ce(0x11b)]((_0xfaad28,_0x4aa6ba)=>chatArea[_0x5ed3ce(0x146)](createMessageElement(_0xfaad28,_0x4aa6ba)))):emptyState['style'][_0x5ed3ce(0x17a)]=_0x5ed3ce(0x109),requestAnimationFrame(()=>chatArea[_0x5ed3ce(0x141)]=chatArea[_0x5ed3ce(0x10c)]);}function autoResizeTextarea(){const _0x5d69a8=a0_0x321763;messageInput[_0x5d69a8(0x150)][_0x5d69a8(0x128)]=_0x5d69a8(0x130),messageInput['style']['height']=Math[_0x5d69a8(0x122)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x3f7c98=a0_0x321763,_0x2e213c=messageInput[_0x3f7c98(0x168)]['trim']();sendBtn[_0x3f7c98(0x10d)]=!_0x2e213c||isTyping;}async function sendMessage(){const _0x1ac710=a0_0x321763,_0x1674d0=messageInput[_0x1ac710(0x168)][_0x1ac710(0x16e)]();if(!_0x1674d0||isTyping)return;if(tg?.[_0x1ac710(0x148)])tg[_0x1ac710(0x148)][_0x1ac710(0x13e)](_0x1ac710(0x106));messages[_0x1ac710(0x145)]({'role':_0x1ac710(0x104),'content':_0x1674d0,'timestamp':Date[_0x1ac710(0x15e)]()}),localStorage[_0x1ac710(0x16f)]('ai_chat_messages',JSON[_0x1ac710(0x17e)](messages)),renderMessages(),messageInput[_0x1ac710(0x168)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x1ac710(0x141)]=chatArea[_0x1ac710(0x10c)];const _0x5e8906=await callBackend(_0x1ac710(0x135),{'message':_0x1674d0});isTyping=![];const _0x3c8c34=document[_0x1ac710(0x151)]('typingIndicator');if(_0x3c8c34)_0x3c8c34[_0x1ac710(0x131)]();let _0x3cca43=_0x1ac710(0x159);if(_0x5e8906[_0x1ac710(0x137)]){_0x3cca43=_0x5e8906[_0x1ac710(0x175)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg[_0x1ac710(0x148)]['notificationOccurred'](_0x1ac710(0x137));}else{_0x3cca43=_0x5e8906[_0x1ac710(0x117)]||'Ошибка\x20сервера';if(tg?.[_0x1ac710(0x148)])tg[_0x1ac710(0x148)][_0x1ac710(0x153)](_0x1ac710(0x117));}messages[_0x1ac710(0x145)]({'role':'ai','content':_0x3cca43,'timestamp':Date[_0x1ac710(0x15e)]()}),localStorage['setItem'](_0x1ac710(0x133),JSON[_0x1ac710(0x17e)](messages)),renderMessages();}function confirmDelete(_0x5bebbf){const _0x2a9314=a0_0x321763;if(mTitle)mTitle['textContent']=_0x2a9314(0x164);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x1562e0=_0x2a9314;messages[_0x1562e0(0x162)](_0x5bebbf,0x1),localStorage[_0x1562e0(0x16f)](_0x1562e0(0x133),JSON[_0x1562e0(0x17e)](messages)),renderMessages();},modal[_0x2a9314(0x118)][_0x2a9314(0x17d)](_0x2a9314(0x161));}if(clearBtn)clearBtn[a0_0x321763(0x152)]=()=>{const _0x4114ed=a0_0x321763;if(!messages[_0x4114ed(0x124)])return;if(mTitle)mTitle[_0x4114ed(0x12d)]=_0x4114ed(0x15f);if(mText)mText[_0x4114ed(0x12d)]=_0x4114ed(0x165);modalCallback=async()=>{const _0x26938f=_0x4114ed;messages=[],localStorage['removeItem'](_0x26938f(0x133)),renderMessages(),callBackend(_0x26938f(0x138),{});},modal['classList'][_0x4114ed(0x17d)](_0x4114ed(0x161));};document['getElementById'](a0_0x321763(0x136))[a0_0x321763(0x152)]=()=>modal[a0_0x321763(0x118)][a0_0x321763(0x131)](a0_0x321763(0x161)),document['getElementById']('modalConfirm')[a0_0x321763(0x152)]=()=>{const _0x38c653=a0_0x321763;if(modalCallback)modalCallback();modal[_0x38c653(0x118)][_0x38c653(0x131)]('show');},messageInput[a0_0x321763(0x103)](a0_0x321763(0x12e),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x321763(0x103)](a0_0x321763(0x17c),_0xcc6c8f=>{const _0x22a815=a0_0x321763;_0xcc6c8f[_0x22a815(0x125)]===_0x22a815(0x108)&&!_0xcc6c8f[_0x22a815(0x154)]&&(_0xcc6c8f[_0x22a815(0x110)](),sendMessage());}),sendBtn[a0_0x321763(0x152)]=sendMessage,document[a0_0x321763(0x103)](a0_0x321763(0x14a),_0xf9462d=>{const _0x552996=a0_0x321763;document['querySelectorAll'](_0x552996(0x127))[_0x552996(0x11b)](_0x5c045d=>{const _0x829ea7=_0x552996;if(!_0x5c045d[_0x829ea7(0x11c)](_0xf9462d[_0x829ea7(0x174)]))_0x5c045d[_0x829ea7(0x118)][_0x829ea7(0x131)](_0x829ea7(0x156));});});function a0_0x1a51(_0x2052aa,_0x4345e5){_0x2052aa=_0x2052aa-0x103;const _0x3aeb75=a0_0x2c76();let _0x3c3ed4=_0x3aeb75[_0x2052aa];return _0x3c3ed4;}const saved=localStorage[a0_0x321763(0x116)](a0_0x321763(0x133));if(saved)try{messages=JSON[a0_0x321763(0x16c)](saved),renderMessages();}catch(a0_0xa18a97){}updateSendButton();