const a0_0x34c214=a0_0x3a22;(function(_0x1213a7,_0x45fb07){const _0x7d62ea=a0_0x3a22,_0xdd504d=_0x1213a7();while(!![]){try{const _0x2c0bdc=-parseInt(_0x7d62ea(0x168))/0x1+-parseInt(_0x7d62ea(0x1de))/0x2+-parseInt(_0x7d62ea(0x1bb))/0x3*(parseInt(_0x7d62ea(0x17d))/0x4)+-parseInt(_0x7d62ea(0x1cd))/0x5*(-parseInt(_0x7d62ea(0x1d1))/0x6)+-parseInt(_0x7d62ea(0x16d))/0x7*(-parseInt(_0x7d62ea(0x1a8))/0x8)+parseInt(_0x7d62ea(0x196))/0x9+parseInt(_0x7d62ea(0x1ad))/0xa*(parseInt(_0x7d62ea(0x1cc))/0xb);if(_0x2c0bdc===_0x45fb07)break;else _0xdd504d['push'](_0xdd504d['shift']());}catch(_0x289069){_0xdd504d['push'](_0xdd504d['shift']());}}}(a0_0x176b,0x3638a));const tg=window[a0_0x34c214(0x1c0)]?.[a0_0x34c214(0x194)],HOME_URL=a0_0x34c214(0x18d);function setupTelegramBackButton(){const _0x4d587e=a0_0x34c214,_0x3c0807=(function(){let _0xf26f7b=!![];return function(_0x25b16c,_0x408211){const _0x3a2f2d=_0xf26f7b?function(){if(_0x408211){const _0x2559b3=_0x408211['apply'](_0x25b16c,arguments);return _0x408211=null,_0x2559b3;}}:function(){};return _0xf26f7b=![],_0x3a2f2d;};}()),_0x12201f=_0x3c0807(this,function(){const _0x42106d=a0_0x3a22;return _0x12201f[_0x42106d(0x1b1)]()[_0x42106d(0x17a)](_0x42106d(0x1a1))[_0x42106d(0x1b1)]()[_0x42106d(0x198)](_0x12201f)['search'](_0x42106d(0x1a1));});_0x12201f();if(!tg)return;try{tg['ready'](),tg[_0x4d587e(0x1ba)](),tg[_0x4d587e(0x178)]?.(_0x4d587e(0x19d));if(tg[_0x4d587e(0x163)]?.(_0x4d587e(0x16a)))tg[_0x4d587e(0x179)]?.();const _0xd0983=tg[_0x4d587e(0x1d6)];if(_0xd0983){_0xd0983[_0x4d587e(0x19b)]();if(typeof _0xd0983[_0x4d587e(0x1b2)]===_0x4d587e(0x197))try{_0xd0983['offClick']();}catch(_0x383954){}_0xd0983[_0x4d587e(0x19a)](()=>{const _0x1b8040=_0x4d587e;if(tg['HapticFeedback'])tg[_0x1b8040(0x166)]['impactOccurred'](_0x1b8040(0x1a2));location[_0x1b8040(0x184)]=HOME_URL;});}}catch(_0x368907){console[_0x4d587e(0x1ca)]('TG\x20setup\x20error:',_0x368907);}}(function initStableLayout(){const _0x7ab592=a0_0x34c214,_0x4de64a=document[_0x7ab592(0x1af)](_0x7ab592(0x1ce)),_0x4eebdc=document[_0x7ab592(0x16c)]('inputArea'),_0x172fc6=document[_0x7ab592(0x16c)](_0x7ab592(0x160)),_0x487418=document[_0x7ab592(0x16c)](_0x7ab592(0x1b7));function _0x4ea80d(){const _0xbffbd5=_0x7ab592;if(!_0x4de64a)return;const _0x14a54b=tg&&tg[_0xbffbd5(0x1c8)]?tg['viewportHeight']:window[_0xbffbd5(0x1a3)];_0x4de64a['style'][_0xbffbd5(0x193)]=_0x14a54b+'px';if(_0x4eebdc){const _0x36ffb1=_0x4eebdc[_0xbffbd5(0x17b)];_0x172fc6['style'][_0xbffbd5(0x1b4)]=_0x36ffb1+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x6117c5})=>{_0x4ea80d();if(_0x6117c5)requestAnimationFrame(()=>{const _0x2431ef=a0_0x3a22;_0x172fc6[_0x2431ef(0x165)]=_0x172fc6['scrollHeight'];});}):window['addEventListener']('resize',_0x4ea80d),_0x4ea80d(),_0x487418&&(_0x487418[_0x7ab592(0x1b8)](_0x7ab592(0x19c),()=>{requestAnimationFrame(_0x4ea80d);}),_0x487418['addEventListener'](_0x7ab592(0x173),()=>{setTimeout(()=>{const _0x208b14=a0_0x3a22;_0x172fc6[_0x208b14(0x165)]=_0x172fc6[_0x208b14(0x1d9)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x34c214(0x18c),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x34c214(0x16c)](a0_0x34c214(0x160)),emptyState=document['getElementById'](a0_0x34c214(0x17f)),messageInput=document[a0_0x34c214(0x16c)]('messageInput'),sendBtn=document[a0_0x34c214(0x16c)](a0_0x34c214(0x1df)),clearBtn=document[a0_0x34c214(0x16c)](a0_0x34c214(0x1da)),modal=document['getElementById'](a0_0x34c214(0x1e1)),mTitle=document[a0_0x34c214(0x16c)](a0_0x34c214(0x181)),mText=document[a0_0x34c214(0x16c)](a0_0x34c214(0x1ab));let modalCallback=null;async function callBackend(_0x2a77e3,_0x4a5212){const _0x453b3e=a0_0x34c214,_0x3b612f=tg?.['initDataUnsafe']?.[_0x453b3e(0x1dd)]||{},_0x17c906=_0x3b612f['id']||localStorage[_0x453b3e(0x177)](_0x453b3e(0x185))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x3b612f['id'])localStorage[_0x453b3e(0x1d3)](_0x453b3e(0x185),_0x17c906);const _0xfcd57b={'action':_0x2a77e3,'user_id':_0x17c906,'user_data':{'first_name':_0x3b612f[_0x453b3e(0x1dc)],'username':_0x3b612f[_0x453b3e(0x171)]},'init_data':tg?.[_0x453b3e(0x1cb)]||'',..._0x4a5212},_0x4d4eb0=new AbortController(),_0x4f9f66=setTimeout(()=>_0x4d4eb0[_0x453b3e(0x190)](),REQUEST_TIMEOUT_MS);try{const _0x37f166=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x453b3e(0x1aa)},'body':JSON[_0x453b3e(0x1d8)](_0xfcd57b),'signal':_0x4d4eb0[_0x453b3e(0x180)]});return clearTimeout(_0x4f9f66),await _0x37f166[_0x453b3e(0x15f)]();}catch(_0xd40b9){return{'success':![],'error':String(_0xd40b9)};}}function formatTime(_0x285662){const _0x12914f=a0_0x34c214,_0x239029=new Date(_0x285662);return String(_0x239029['getHours']())[_0x12914f(0x1b6)](0x2,'0')+':'+String(_0x239029[_0x12914f(0x1c5)]())[_0x12914f(0x1b6)](0x2,'0');}function createMessageElement(_0x230791,_0x317b51){const _0x5c2329=a0_0x34c214,_0x1438fd=document[_0x5c2329(0x172)](_0x5c2329(0x18a));_0x1438fd[_0x5c2329(0x199)]='message\x20'+_0x230791[_0x5c2329(0x1c3)];const _0x5a0556=document[_0x5c2329(0x172)](_0x5c2329(0x18a));_0x5a0556[_0x5c2329(0x199)]=_0x5c2329(0x1a7),_0x5a0556[_0x5c2329(0x1d4)]=_0x230791[_0x5c2329(0x1b0)][_0x5c2329(0x183)](/\n/g,_0x5c2329(0x1a6));const _0x158b64=document[_0x5c2329(0x172)](_0x5c2329(0x18a));_0x158b64[_0x5c2329(0x199)]=_0x5c2329(0x1d2),_0x158b64[_0x5c2329(0x1d4)]=_0x5c2329(0x1a5),_0x158b64[_0x5c2329(0x1bc)]=_0x25186a=>{_0x25186a['stopPropagation'](),confirmDelete(_0x317b51);};let _0x5e9287;_0x5a0556['addEventListener'](_0x5c2329(0x1ae),()=>_0x5e9287=setTimeout(()=>{const _0x3c8799=_0x5c2329;_0x1438fd['classList'][_0x3c8799(0x18f)](_0x3c8799(0x19f));if(tg?.[_0x3c8799(0x166)])tg[_0x3c8799(0x166)]['impactOccurred'](_0x3c8799(0x1be));},0x1f4)),_0x5a0556[_0x5c2329(0x1b8)]('touchend',()=>clearTimeout(_0x5e9287));const _0x346a64=document[_0x5c2329(0x172)]('div');return _0x346a64[_0x5c2329(0x199)]=_0x5c2329(0x175),_0x346a64['textContent']=formatTime(_0x230791[_0x5c2329(0x195)]),_0x1438fd[_0x5c2329(0x174)](_0x158b64),_0x1438fd[_0x5c2329(0x174)](_0x5a0556),_0x1438fd[_0x5c2329(0x174)](_0x346a64),_0x1438fd;}function createTypingIndicator(){const _0x4aa9e0=a0_0x34c214,_0x44bf4b=document['createElement'](_0x4aa9e0(0x18a));return _0x44bf4b[_0x4aa9e0(0x199)]=_0x4aa9e0(0x16e),_0x44bf4b['id']=_0x4aa9e0(0x1d0),_0x44bf4b[_0x4aa9e0(0x1d4)]=_0x4aa9e0(0x16b),_0x44bf4b;}function a0_0x176b(){const _0x39e900=['shiftKey','add','abort','Enter','key','height','WebApp','timestamp','1727577euEFOe','function','constructor','className','onClick','show','input','#050505','Ошибка\x20сети','show-delete','display','(((.+)+)+)+$','light','innerHeight','Пустой\x20ответ','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','<br>','message-bubble','203120RaaGVS','disabled','text/plain','modalText','style','28650cwjQIq','touchstart','querySelector','content','toString','offClick','success','paddingBottom','push','padStart','messageInput','addEventListener','target','expand','15nSlXCp','onclick','Ошибка\x20сервера','medium','removeItem','Telegram','value','.message.show-delete','role','modalCancel','getMinutes','error','remove','viewportHeight','Удалить?','warn','initData','1023cNatAf','158080jdWjkJ','.container','preventDefault','typingIndicator','12XBVnwN','delete-btn','setItem','innerHTML','forEach','BackButton','splice','stringify','scrollHeight','clearBtn','clear_history','first_name','user','855364vcYyod','sendBtn','modalConfirm','confirmModal','json','chatArea','impactOccurred','ai_chat_messages','isVersionAtLeast','parse','scrollTop','HapticFeedback','auto','913DNnqWH','classList','6.1','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','getElementById','98YsOKoV','message\x20ai','contains','trim','username','createElement','focus','appendChild','message-time','now','getItem','setHeaderColor','disableVerticalSwipes','search','offsetHeight','none','181124XVgStB','from','emptyState','signal','modalTitle','text','replace','href','debug_uid','textContent','notificationOccurred','keydown','send_message','div','length','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','./router.html'];a0_0x176b=function(){return _0x39e900;};return a0_0x176b();}function renderMessages(){const _0x543b4d=a0_0x34c214;Array[_0x543b4d(0x17e)](chatArea['children'])['forEach'](_0x3624c6=>{const _0x24dbc7=_0x543b4d;if(_0x3624c6['id']!==_0x24dbc7(0x17f))_0x3624c6[_0x24dbc7(0x1c7)]();}),messages['length']>0x0?(emptyState[_0x543b4d(0x1ac)][_0x543b4d(0x1a0)]=_0x543b4d(0x17c),messages[_0x543b4d(0x1d5)]((_0x472191,_0x155209)=>chatArea['appendChild'](createMessageElement(_0x472191,_0x155209)))):emptyState[_0x543b4d(0x1ac)][_0x543b4d(0x1a0)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x543b4d(0x1d9)]);}function autoResizeTextarea(){const _0x21f5d9=a0_0x34c214;messageInput[_0x21f5d9(0x1ac)][_0x21f5d9(0x193)]=_0x21f5d9(0x167),messageInput['style'][_0x21f5d9(0x193)]=Math['min'](messageInput[_0x21f5d9(0x1d9)],0x78)+'px';}function updateSendButton(){const _0x2bc545=a0_0x34c214,_0x1905de=messageInput[_0x2bc545(0x1c1)][_0x2bc545(0x170)]();sendBtn[_0x2bc545(0x1a9)]=!_0x1905de||isTyping;}function a0_0x3a22(_0x10f885,_0x27e66b){_0x10f885=_0x10f885-0x15f;const _0x527248=a0_0x176b();let _0x4f84bb=_0x527248[_0x10f885];return _0x4f84bb;}async function sendMessage(){const _0x524153=a0_0x34c214,_0x1e4251=messageInput[_0x524153(0x1c1)][_0x524153(0x170)]();if(!_0x1e4251||isTyping)return;if(tg?.[_0x524153(0x166)])tg['HapticFeedback'][_0x524153(0x161)](_0x524153(0x1a2));messages[_0x524153(0x1b5)]({'role':_0x524153(0x1dd),'content':_0x1e4251,'timestamp':Date[_0x524153(0x176)]()}),localStorage[_0x524153(0x1d3)](_0x524153(0x162),JSON[_0x524153(0x1d8)](messages)),renderMessages(),messageInput[_0x524153(0x1c1)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x524153(0x174)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x8b8769=await callBackend(_0x524153(0x189),{'message':_0x1e4251});isTyping=![];const _0x11fc28=document[_0x524153(0x16c)](_0x524153(0x1d0));if(_0x11fc28)_0x11fc28[_0x524153(0x1c7)]();let _0x565b99=_0x524153(0x19e);if(_0x8b8769[_0x524153(0x1b3)]){_0x565b99=_0x8b8769[_0x524153(0x182)]||_0x524153(0x1a4);if(tg?.[_0x524153(0x166)])tg['HapticFeedback']['notificationOccurred'](_0x524153(0x1b3));}else{_0x565b99=_0x8b8769[_0x524153(0x1c6)]||_0x524153(0x1bd);if(tg?.[_0x524153(0x166)])tg[_0x524153(0x166)][_0x524153(0x187)]('error');}messages[_0x524153(0x1b5)]({'role':'ai','content':_0x565b99,'timestamp':Date[_0x524153(0x176)]()}),localStorage[_0x524153(0x1d3)](_0x524153(0x162),JSON[_0x524153(0x1d8)](messages)),renderMessages();}function confirmDelete(_0x489764){const _0x58e74f=a0_0x34c214;if(mTitle)mTitle[_0x58e74f(0x186)]=_0x58e74f(0x1c9);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x122f09=_0x58e74f;messages[_0x122f09(0x1d7)](_0x489764,0x1),localStorage['setItem'](_0x122f09(0x162),JSON[_0x122f09(0x1d8)](messages)),renderMessages();},modal[_0x58e74f(0x169)][_0x58e74f(0x18f)](_0x58e74f(0x19b));}if(clearBtn)clearBtn['onclick']=()=>{const _0x1bf02a=a0_0x34c214;if(!messages[_0x1bf02a(0x18b)])return;if(mTitle)mTitle[_0x1bf02a(0x186)]='Очистить\x20историю?';if(mText)mText[_0x1bf02a(0x186)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x3ce295=_0x1bf02a;messages=[],localStorage[_0x3ce295(0x1bf)]('ai_chat_messages'),renderMessages(),callBackend(_0x3ce295(0x1db),{});},modal[_0x1bf02a(0x169)][_0x1bf02a(0x18f)](_0x1bf02a(0x19b));};document[a0_0x34c214(0x16c)](a0_0x34c214(0x1c4))[a0_0x34c214(0x1bc)]=()=>modal[a0_0x34c214(0x169)]['remove'](a0_0x34c214(0x19b)),document[a0_0x34c214(0x16c)](a0_0x34c214(0x1e0))[a0_0x34c214(0x1bc)]=()=>{const _0x3d56bb=a0_0x34c214;if(modalCallback)modalCallback();modal[_0x3d56bb(0x169)][_0x3d56bb(0x1c7)](_0x3d56bb(0x19b));},messageInput[a0_0x34c214(0x1b8)](a0_0x34c214(0x19c),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x34c214(0x1b8)](a0_0x34c214(0x188),_0x3e9f9d=>{const _0x5e269e=a0_0x34c214;_0x3e9f9d[_0x5e269e(0x192)]===_0x5e269e(0x191)&&!_0x3e9f9d[_0x5e269e(0x18e)]&&(_0x3e9f9d[_0x5e269e(0x1cf)](),sendMessage());}),sendBtn[a0_0x34c214(0x1bc)]=sendMessage,document[a0_0x34c214(0x1b8)]('click',_0x51e08e=>{const _0x4f38ce=a0_0x34c214;document['querySelectorAll'](_0x4f38ce(0x1c2))[_0x4f38ce(0x1d5)](_0x3bd85b=>{const _0x39ac6a=_0x4f38ce;if(!_0x3bd85b[_0x39ac6a(0x16f)](_0x51e08e[_0x39ac6a(0x1b9)]))_0x3bd85b[_0x39ac6a(0x169)][_0x39ac6a(0x1c7)](_0x39ac6a(0x19f));});});const saved=localStorage[a0_0x34c214(0x177)](a0_0x34c214(0x162));if(saved)try{messages=JSON[a0_0x34c214(0x164)](saved),renderMessages();}catch(a0_0x2a7eab){}updateSendButton();