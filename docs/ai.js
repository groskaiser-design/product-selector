const a0_0xe0cf20=a0_0x476c;(function(_0x4269db,_0x1c2281){const _0x13ddb5=a0_0x476c,_0xbd7550=_0x4269db();while(!![]){try{const _0x34c36b=parseInt(_0x13ddb5(0xb9))/0x1+-parseInt(_0x13ddb5(0x111))/0x2+parseInt(_0x13ddb5(0x117))/0x3*(parseInt(_0x13ddb5(0xbf))/0x4)+parseInt(_0x13ddb5(0xe9))/0x5*(-parseInt(_0x13ddb5(0xb8))/0x6)+parseInt(_0x13ddb5(0xfc))/0x7+-parseInt(_0x13ddb5(0xcf))/0x8+parseInt(_0x13ddb5(0xae))/0x9*(parseInt(_0x13ddb5(0xe3))/0xa);if(_0x34c36b===_0x1c2281)break;else _0xbd7550['push'](_0xbd7550['shift']());}catch(_0x27d92b){_0xbd7550['push'](_0xbd7550['shift']());}}}(a0_0x3309,0x74a76));const tg=window[a0_0xe0cf20(0xbd)]?.['WebApp'],HOME_URL=a0_0xe0cf20(0x121);function setupTelegramBackButton(){const _0x312495=a0_0xe0cf20;if(!tg)return;try{tg[_0x312495(0xd5)](),tg[_0x312495(0xb7)](),tg[_0x312495(0xee)]?.(_0x312495(0xd3));if(tg[_0x312495(0xb1)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x20dffd=tg[_0x312495(0xd7)];if(_0x20dffd){_0x20dffd[_0x312495(0x104)]();if(typeof _0x20dffd[_0x312495(0xbb)]==='function')try{_0x20dffd['offClick']();}catch(_0x189b08){}_0x20dffd['onClick'](()=>{const _0x4af3cb=_0x312495;if(tg[_0x4af3cb(0xc2)])tg[_0x4af3cb(0xc2)][_0x4af3cb(0x102)]('light');location[_0x4af3cb(0xdf)]=HOME_URL;});}}catch(_0x4c61f3){console[_0x312495(0xb0)](_0x312495(0xa8),_0x4c61f3);}}function a0_0x476c(_0x556c18,_0x286be5){_0x556c18=_0x556c18-0xa6;const _0x2eae8d=a0_0x3309();let _0x5e630f=_0x2eae8d[_0x556c18];return _0x5e630f;}(function initStableLayout(){const _0x2581d1=a0_0xe0cf20,_0x3db3cd=(function(){let _0x4854c4=!![];return function(_0x479371,_0x3ed3c1){const _0x56807c=_0x4854c4?function(){if(_0x3ed3c1){const _0x44d0e8=_0x3ed3c1['apply'](_0x479371,arguments);return _0x3ed3c1=null,_0x44d0e8;}}:function(){};return _0x4854c4=![],_0x56807c;};}()),_0x286dd1=document[_0x2581d1(0xfd)]('.container'),_0x2117f7=document[_0x2581d1(0x116)](_0x2581d1(0xc5)),_0x22c88e=document[_0x2581d1(0x116)](_0x2581d1(0xe0)),_0x2bce33=document[_0x2581d1(0x116)](_0x2581d1(0xf5));function _0x10790e(){const _0x50d06d=_0x2581d1,_0x1a1924=_0x3db3cd(this,function(){const _0x4d4830=a0_0x476c;return _0x1a1924[_0x4d4830(0xb2)]()[_0x4d4830(0xbe)](_0x4d4830(0xed))[_0x4d4830(0xb2)]()['constructor'](_0x1a1924)['search'](_0x4d4830(0xed));});_0x1a1924();if(!_0x286dd1)return;const _0x410ba8=tg&&tg['viewportHeight']?tg[_0x50d06d(0xcc)]:window['innerHeight'];_0x286dd1[_0x50d06d(0x10a)][_0x50d06d(0xa9)]=_0x410ba8+'px';if(_0x2117f7){const _0x41f15e=_0x2117f7[_0x50d06d(0xd1)];_0x22c88e[_0x50d06d(0x10a)][_0x50d06d(0xf4)]=_0x41f15e+0x28+'px';}}tg?tg[_0x2581d1(0xac)]('viewportChanged',({isStateStable:_0x26bccf})=>{_0x10790e();if(_0x26bccf)requestAnimationFrame(()=>{const _0x2d300c=a0_0x476c;_0x22c88e[_0x2d300c(0xad)]=_0x22c88e[_0x2d300c(0xdd)];});}):window[_0x2581d1(0xf1)]('resize',_0x10790e),_0x10790e(),_0x2bce33&&(_0x2bce33[_0x2581d1(0xf1)](_0x2581d1(0x103),()=>{requestAnimationFrame(_0x10790e);}),_0x2bce33[_0x2581d1(0xf1)](_0x2581d1(0x100),()=>{setTimeout(()=>{const _0x3d1638=a0_0x476c;_0x22c88e[_0x3d1638(0xad)]=_0x22c88e['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xe0cf20(0xe4),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xe0cf20(0x116)]('chatArea'),emptyState=document[a0_0xe0cf20(0x116)](a0_0xe0cf20(0xf2)),messageInput=document[a0_0xe0cf20(0x116)]('messageInput'),sendBtn=document[a0_0xe0cf20(0x116)](a0_0xe0cf20(0xef)),clearBtn=document[a0_0xe0cf20(0x116)](a0_0xe0cf20(0xdb)),modal=document[a0_0xe0cf20(0x116)](a0_0xe0cf20(0x11b)),mTitle=document['getElementById'](a0_0xe0cf20(0xf8)),mText=document['getElementById'](a0_0xe0cf20(0x11e));let modalCallback=null;async function callBackend(_0x343249,_0x376a49){const _0x1b696f=a0_0xe0cf20,_0x403317=tg?.[_0x1b696f(0x105)]?.['user']||{},_0x34a73c=_0x403317['id']||localStorage[_0x1b696f(0xf0)]('debug_uid')||'d-'+Math[_0x1b696f(0xe2)](Math['random']()*0x3b9aca00);if(!_0x403317['id'])localStorage[_0x1b696f(0xec)](_0x1b696f(0xe5),_0x34a73c);const _0x559406={'action':_0x343249,'user_id':_0x34a73c,'user_data':{'first_name':_0x403317[_0x1b696f(0x123)],'username':_0x403317[_0x1b696f(0xaf)]},'init_data':tg?.[_0x1b696f(0xd8)]||'',..._0x376a49},_0x42fe0a=new AbortController(),_0x3fb638=setTimeout(()=>_0x42fe0a[_0x1b696f(0xeb)](),REQUEST_TIMEOUT_MS);try{const _0x55f586=await fetch(BACKEND_URL,{'method':_0x1b696f(0xf6),'headers':{'Content-Type':_0x1b696f(0x11a)},'body':JSON[_0x1b696f(0xd0)](_0x559406),'signal':_0x42fe0a[_0x1b696f(0x109)]});return clearTimeout(_0x3fb638),await _0x55f586[_0x1b696f(0xbc)]();}catch(_0x43b989){return{'success':![],'error':String(_0x43b989)};}}function a0_0x3309(){const _0x1561be=['HapticFeedback','disabled','touchend','inputArea','Удалить?','medium','querySelectorAll','appendChild','push','splice','viewportHeight','touchstart','getMinutes','3210088mbpXBG','stringify','offsetHeight','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','#050505','Действие\x20необратимо.','ready','light','BackButton','initData','contains','error','clearBtn','replace','scrollHeight','clear_history','href','chatArea','timestamp','floor','35820uvMlTn','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','debug_uid','.message.show-delete','notificationOccurred','createElement','65clkgcx','classList','abort','setItem','(((.+)+)+)+$','setHeaderColor','sendBtn','getItem','addEventListener','emptyState','success','paddingBottom','messageInput','POST','typingIndicator','modalTitle','div','Очистить\x20историю?','textContent','5082343qouSDh','querySelector','Ошибка\x20сети','Начнется\x20новый\x20диалог.','focus','role','impactOccurred','input','show','initDataUnsafe','Пустой\x20ответ','keydown','user','signal','style','message\x20','className','parse','key','Ошибка\x20сервера','remove','1142196JimJHL','length','add','content','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','getElementById','470031YKoSZu','show-delete','message\x20ai','text/plain','confirmModal','modalCancel','display','modalText','shiftKey','trim','./router.html','value','first_name','padStart','message-bubble','TG\x20setup\x20error:','height','none','onclick','onEvent','scrollTop','2916bdAGrM','username','warn','isVersionAtLeast','toString','ai_chat_messages','innerHTML','send_message','forEach','expand','362994HpFsfZ','36689hQrpMX','now','offClick','json','Telegram','search','8zaoCkp','text','modalConfirm'];a0_0x3309=function(){return _0x1561be;};return a0_0x3309();}function formatTime(_0x2011cd){const _0x1f25ca=a0_0xe0cf20,_0x34e174=new Date(_0x2011cd);return String(_0x34e174['getHours']())[_0x1f25ca(0xa6)](0x2,'0')+':'+String(_0x34e174[_0x1f25ca(0xce)]())[_0x1f25ca(0xa6)](0x2,'0');}function createMessageElement(_0x1854d4,_0x539b2b){const _0x26277d=a0_0xe0cf20,_0x1aae8d=document[_0x26277d(0xe8)](_0x26277d(0xf9));_0x1aae8d[_0x26277d(0x10c)]=_0x26277d(0x10b)+_0x1854d4[_0x26277d(0x101)];const _0x3dd035=document[_0x26277d(0xe8)](_0x26277d(0xf9));_0x3dd035[_0x26277d(0x10c)]=_0x26277d(0xa7),_0x3dd035[_0x26277d(0xb4)]=_0x1854d4[_0x26277d(0x114)][_0x26277d(0xdc)](/\n/g,'<br>');const _0xcebc38=document[_0x26277d(0xe8)]('div');_0xcebc38[_0x26277d(0x10c)]='delete-btn',_0xcebc38[_0x26277d(0xb4)]=_0x26277d(0xd2),_0xcebc38[_0x26277d(0xab)]=_0xa87121=>{_0xa87121['stopPropagation'](),confirmDelete(_0x539b2b);};let _0xd8d7d9;_0x3dd035[_0x26277d(0xf1)](_0x26277d(0xcd),()=>_0xd8d7d9=setTimeout(()=>{const _0x28baa8=_0x26277d;_0x1aae8d[_0x28baa8(0xea)][_0x28baa8(0x113)](_0x28baa8(0x118));if(tg?.[_0x28baa8(0xc2)])tg[_0x28baa8(0xc2)]['impactOccurred'](_0x28baa8(0xc7));},0x1f4)),_0x3dd035[_0x26277d(0xf1)](_0x26277d(0xc4),()=>clearTimeout(_0xd8d7d9));const _0x79e96b=document[_0x26277d(0xe8)](_0x26277d(0xf9));return _0x79e96b['className']='message-time',_0x79e96b[_0x26277d(0xfb)]=formatTime(_0x1854d4[_0x26277d(0xe1)]),_0x1aae8d[_0x26277d(0xc9)](_0xcebc38),_0x1aae8d[_0x26277d(0xc9)](_0x3dd035),_0x1aae8d[_0x26277d(0xc9)](_0x79e96b),_0x1aae8d;}function createTypingIndicator(){const _0x297a87=a0_0xe0cf20,_0x2e50fc=document['createElement']('div');return _0x2e50fc[_0x297a87(0x10c)]=_0x297a87(0x119),_0x2e50fc['id']=_0x297a87(0xf7),_0x2e50fc[_0x297a87(0xb4)]=_0x297a87(0x115),_0x2e50fc;}function renderMessages(){const _0x36ffa1=a0_0xe0cf20;Array['from'](chatArea['children'])[_0x36ffa1(0xb6)](_0x3d0d76=>{const _0x81103a=_0x36ffa1;if(_0x3d0d76['id']!==_0x81103a(0xf2))_0x3d0d76['remove']();}),messages[_0x36ffa1(0x112)]>0x0?(emptyState[_0x36ffa1(0x10a)][_0x36ffa1(0x11d)]=_0x36ffa1(0xaa),messages[_0x36ffa1(0xb6)]((_0xb83886,_0x573450)=>chatArea['appendChild'](createMessageElement(_0xb83886,_0x573450)))):emptyState[_0x36ffa1(0x10a)][_0x36ffa1(0x11d)]='flex',requestAnimationFrame(()=>chatArea[_0x36ffa1(0xad)]=chatArea[_0x36ffa1(0xdd)]);}function autoResizeTextarea(){const _0x35b44d=a0_0xe0cf20;messageInput[_0x35b44d(0x10a)][_0x35b44d(0xa9)]='auto',messageInput[_0x35b44d(0x10a)][_0x35b44d(0xa9)]=Math['min'](messageInput[_0x35b44d(0xdd)],0x78)+'px';}function updateSendButton(){const _0x477551=a0_0xe0cf20,_0x313fae=messageInput[_0x477551(0x122)][_0x477551(0x120)]();sendBtn[_0x477551(0xc3)]=!_0x313fae||isTyping;}async function sendMessage(){const _0x370c03=a0_0xe0cf20,_0x56815=messageInput[_0x370c03(0x122)]['trim']();if(!_0x56815||isTyping)return;if(tg?.[_0x370c03(0xc2)])tg[_0x370c03(0xc2)]['impactOccurred'](_0x370c03(0xd6));messages[_0x370c03(0xca)]({'role':_0x370c03(0x108),'content':_0x56815,'timestamp':Date['now']()}),localStorage[_0x370c03(0xec)](_0x370c03(0xb3),JSON[_0x370c03(0xd0)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x370c03(0xc9)](createTypingIndicator()),chatArea[_0x370c03(0xad)]=chatArea[_0x370c03(0xdd)];const _0x1435ba=await callBackend(_0x370c03(0xb5),{'message':_0x56815});isTyping=![];const _0x1c482a=document[_0x370c03(0x116)](_0x370c03(0xf7));if(_0x1c482a)_0x1c482a[_0x370c03(0x110)]();let _0x30b489=_0x370c03(0xfe);if(_0x1435ba[_0x370c03(0xf3)]){_0x30b489=_0x1435ba[_0x370c03(0xc0)]||_0x370c03(0x106);if(tg?.['HapticFeedback'])tg[_0x370c03(0xc2)]['notificationOccurred'](_0x370c03(0xf3));}else{_0x30b489=_0x1435ba['error']||_0x370c03(0x10f);if(tg?.[_0x370c03(0xc2)])tg[_0x370c03(0xc2)][_0x370c03(0xe7)](_0x370c03(0xda));}messages[_0x370c03(0xca)]({'role':'ai','content':_0x30b489,'timestamp':Date[_0x370c03(0xba)]()}),localStorage[_0x370c03(0xec)](_0x370c03(0xb3),JSON[_0x370c03(0xd0)](messages)),renderMessages();}function confirmDelete(_0x3950d2){const _0x17aa6a=a0_0xe0cf20;if(mTitle)mTitle['textContent']=_0x17aa6a(0xc6);if(mText)mText[_0x17aa6a(0xfb)]=_0x17aa6a(0xd4);modalCallback=()=>{const _0x4c1f9b=_0x17aa6a;messages[_0x4c1f9b(0xcb)](_0x3950d2,0x1),localStorage[_0x4c1f9b(0xec)](_0x4c1f9b(0xb3),JSON['stringify'](messages)),renderMessages();},modal[_0x17aa6a(0xea)][_0x17aa6a(0x113)](_0x17aa6a(0x104));}if(clearBtn)clearBtn[a0_0xe0cf20(0xab)]=()=>{const _0x29fb1a=a0_0xe0cf20;if(!messages[_0x29fb1a(0x112)])return;if(mTitle)mTitle['textContent']=_0x29fb1a(0xfa);if(mText)mText[_0x29fb1a(0xfb)]=_0x29fb1a(0xff);modalCallback=async()=>{const _0x3479b5=_0x29fb1a;messages=[],localStorage['removeItem'](_0x3479b5(0xb3)),renderMessages(),callBackend(_0x3479b5(0xde),{});},modal['classList'][_0x29fb1a(0x113)](_0x29fb1a(0x104));};document['getElementById'](a0_0xe0cf20(0x11c))['onclick']=()=>modal['classList'][a0_0xe0cf20(0x110)](a0_0xe0cf20(0x104)),document[a0_0xe0cf20(0x116)](a0_0xe0cf20(0xc1))[a0_0xe0cf20(0xab)]=()=>{const _0x362ca3=a0_0xe0cf20;if(modalCallback)modalCallback();modal[_0x362ca3(0xea)][_0x362ca3(0x110)](_0x362ca3(0x104));},messageInput[a0_0xe0cf20(0xf1)](a0_0xe0cf20(0x103),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xe0cf20(0xf1)](a0_0xe0cf20(0x107),_0x83bc87=>{const _0x50cf6e=a0_0xe0cf20;_0x83bc87[_0x50cf6e(0x10e)]==='Enter'&&!_0x83bc87[_0x50cf6e(0x11f)]&&(_0x83bc87['preventDefault'](),sendMessage());}),sendBtn[a0_0xe0cf20(0xab)]=sendMessage,document['addEventListener']('click',_0x5c2440=>{const _0x5460dd=a0_0xe0cf20;document[_0x5460dd(0xc8)](_0x5460dd(0xe6))['forEach'](_0x539254=>{const _0x239bff=_0x5460dd;if(!_0x539254[_0x239bff(0xd9)](_0x5c2440['target']))_0x539254['classList'][_0x239bff(0x110)](_0x239bff(0x118));});});const saved=localStorage[a0_0xe0cf20(0xf0)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0xe0cf20(0x10d)](saved),renderMessages();}catch(a0_0x12370c){}updateSendButton();