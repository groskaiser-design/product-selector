const a0_0x50d17e=a0_0x341e;(function(_0x463908,_0x5ef561){const _0x50d961=a0_0x341e,_0x5e72e7=_0x463908();while(!![]){try{const _0x1100f2=-parseInt(_0x50d961(0x207))/0x1*(parseInt(_0x50d961(0x1ca))/0x2)+-parseInt(_0x50d961(0x19e))/0x3+parseInt(_0x50d961(0x20d))/0x4*(-parseInt(_0x50d961(0x1f5))/0x5)+-parseInt(_0x50d961(0x1d0))/0x6*(-parseInt(_0x50d961(0x211))/0x7)+-parseInt(_0x50d961(0x1c9))/0x8*(parseInt(_0x50d961(0x20b))/0x9)+-parseInt(_0x50d961(0x20e))/0xa*(parseInt(_0x50d961(0x1e2))/0xb)+-parseInt(_0x50d961(0x21b))/0xc*(-parseInt(_0x50d961(0x1cb))/0xd);if(_0x1100f2===_0x5ef561)break;else _0x5e72e7['push'](_0x5e72e7['shift']());}catch(_0x5c429c){_0x5e72e7['push'](_0x5e72e7['shift']());}}}(a0_0x3add,0x1ea08));function a0_0x341e(_0x46bf94,_0x36dd09){_0x46bf94=_0x46bf94-0x19a;const _0x11c981=a0_0x3add();let _0x1e79e7=_0x11c981[_0x46bf94];return _0x1e79e7;}const tg=window[a0_0x50d17e(0x19c)]?.[a0_0x50d17e(0x1de)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x5068fd=a0_0x50d17e;if(!tg)return;try{tg['ready'](),tg[_0x5068fd(0x1cd)](),tg[_0x5068fd(0x1f0)]?.(_0x5068fd(0x1db));if(tg[_0x5068fd(0x1da)]?.(_0x5068fd(0x1ee)))tg[_0x5068fd(0x1a1)]?.();const _0x4fc325=tg[_0x5068fd(0x1a9)];if(_0x4fc325){_0x4fc325[_0x5068fd(0x1bc)]();if(typeof _0x4fc325['offClick']==='function')try{_0x4fc325[_0x5068fd(0x1b8)]();}catch(_0x46513d){}_0x4fc325[_0x5068fd(0x1d7)](()=>{const _0x52567c=_0x5068fd;if(tg[_0x52567c(0x1dd)])tg['HapticFeedback'][_0x52567c(0x1f3)](_0x52567c(0x19d));location[_0x52567c(0x1c8)]=HOME_URL;});}}catch(_0x53bea2){console[_0x5068fd(0x206)](_0x5068fd(0x1fd),_0x53bea2);}}(function initStableLayout(){const _0x1d14df=a0_0x50d17e,_0x159db7=(function(){let _0x509929=!![];return function(_0x20652f,_0x18da00){const _0x5cabcf=_0x509929?function(){if(_0x18da00){const _0x3f6119=_0x18da00['apply'](_0x20652f,arguments);return _0x18da00=null,_0x3f6119;}}:function(){};return _0x509929=![],_0x5cabcf;};}()),_0x2f9fa4=document[_0x1d14df(0x1b4)](_0x1d14df(0x1be)),_0x3eee5b=document[_0x1d14df(0x1a0)](_0x1d14df(0x1ab)),_0x2d53e2=document['getElementById']('chatArea'),_0x44ca3c=document[_0x1d14df(0x1a0)](_0x1d14df(0x205));function _0x47980c(){const _0x2b542a=_0x1d14df,_0x4cd8b8=_0x159db7(this,function(){const _0x451c56=a0_0x341e;return _0x4cd8b8[_0x451c56(0x1e6)]()[_0x451c56(0x1e5)]('(((.+)+)+)+$')['toString']()[_0x451c56(0x20f)](_0x4cd8b8)[_0x451c56(0x1e5)](_0x451c56(0x1f6));});_0x4cd8b8();if(!_0x2f9fa4)return;const _0x1ca1f5=tg&&tg['viewportHeight']?tg[_0x2b542a(0x219)]:window[_0x2b542a(0x19f)];_0x2f9fa4[_0x2b542a(0x204)][_0x2b542a(0x1fb)]=_0x1ca1f5+'px';if(_0x3eee5b){const _0x598202=_0x3eee5b[_0x2b542a(0x1e4)];_0x2d53e2[_0x2b542a(0x204)][_0x2b542a(0x19b)]=_0x598202+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x57d887})=>{_0x47980c();if(_0x57d887)requestAnimationFrame(()=>{const _0x4ae476=a0_0x341e;_0x2d53e2[_0x4ae476(0x1b9)]=_0x2d53e2[_0x4ae476(0x1d9)];});}):window[_0x1d14df(0x1eb)](_0x1d14df(0x203),_0x47980c),_0x47980c(),_0x44ca3c&&(_0x44ca3c[_0x1d14df(0x1eb)](_0x1d14df(0x1a6),()=>{requestAnimationFrame(_0x47980c);}),_0x44ca3c[_0x1d14df(0x1eb)](_0x1d14df(0x1b1),()=>{setTimeout(()=>{const _0x3c627d=a0_0x341e;_0x2d53e2[_0x3c627d(0x1b9)]=_0x2d53e2[_0x3c627d(0x1d9)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x50d17e(0x1b6)),emptyState=document[a0_0x50d17e(0x1a0)](a0_0x50d17e(0x1c3)),messageInput=document['getElementById'](a0_0x50d17e(0x205)),sendBtn=document[a0_0x50d17e(0x1a0)]('sendBtn'),clearBtn=document[a0_0x50d17e(0x1a0)](a0_0x50d17e(0x201)),modal=document[a0_0x50d17e(0x1a0)](a0_0x50d17e(0x21e)),mTitle=document['getElementById'](a0_0x50d17e(0x1e9)),mText=document[a0_0x50d17e(0x1a0)](a0_0x50d17e(0x1d2));let modalCallback=null;async function callBackend(_0x2a64ee,_0xa7bc94){const _0x178700=a0_0x50d17e,_0x372082=tg?.[_0x178700(0x1c0)]?.[_0x178700(0x1dc)]||{},_0x43e537=_0x372082['id']||localStorage[_0x178700(0x1a7)]('debug_uid')||'d-'+Math[_0x178700(0x21d)](Math[_0x178700(0x1c5)]()*0x3b9aca00);if(!_0x372082['id'])localStorage[_0x178700(0x1ec)](_0x178700(0x1b3),_0x43e537);const _0x3b74a1={'action':_0x2a64ee,'user_id':_0x43e537,'user_data':{'first_name':_0x372082[_0x178700(0x21a)],'username':_0x372082['username']},'init_data':tg?.[_0x178700(0x1ac)]||'',..._0xa7bc94},_0x47993e=new AbortController(),_0x2d4cd6=setTimeout(()=>_0x47993e[_0x178700(0x1d5)](),REQUEST_TIMEOUT_MS);try{const _0xc237cd=await fetch(BACKEND_URL,{'method':_0x178700(0x1c7),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x178700(0x217)](_0x3b74a1),'signal':_0x47993e[_0x178700(0x1b2)]});return clearTimeout(_0x2d4cd6),await _0xc237cd[_0x178700(0x1f2)]();}catch(_0x31352a){return{'success':![],'error':String(_0x31352a)};}}function formatTime(_0x912a7b){const _0x503ce0=a0_0x50d17e,_0x212bcb=new Date(_0x912a7b);return String(_0x212bcb[_0x503ce0(0x215)]())[_0x503ce0(0x21c)](0x2,'0')+':'+String(_0x212bcb[_0x503ce0(0x1fc)]())[_0x503ce0(0x21c)](0x2,'0');}function createMessageElement(_0x3391d1,_0x4ca555){const _0x5679ea=a0_0x50d17e,_0x2a50ec=document[_0x5679ea(0x1f4)](_0x5679ea(0x1a2));_0x2a50ec[_0x5679ea(0x1ff)]=_0x5679ea(0x216)+_0x3391d1[_0x5679ea(0x1c1)];const _0x928bbf=document[_0x5679ea(0x1f4)]('div');_0x928bbf[_0x5679ea(0x1ff)]='message-bubble',_0x928bbf[_0x5679ea(0x1df)]=_0x3391d1[_0x5679ea(0x1ba)][_0x5679ea(0x1c4)](/\n/g,_0x5679ea(0x1b5));const _0x52b77e=document[_0x5679ea(0x1f4)](_0x5679ea(0x1a2));_0x52b77e[_0x5679ea(0x1ff)]=_0x5679ea(0x1a4),_0x52b77e[_0x5679ea(0x1df)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x52b77e[_0x5679ea(0x209)]=_0x5b1db4=>{const _0x58a135=_0x5679ea;_0x5b1db4[_0x58a135(0x1af)](),confirmDelete(_0x4ca555);};let _0x29e5b2;_0x928bbf[_0x5679ea(0x1eb)](_0x5679ea(0x1ea),()=>_0x29e5b2=setTimeout(()=>{const _0x3e4b9a=_0x5679ea;_0x2a50ec[_0x3e4b9a(0x212)][_0x3e4b9a(0x1ce)](_0x3e4b9a(0x1a3));if(tg?.['HapticFeedback'])tg[_0x3e4b9a(0x1dd)][_0x3e4b9a(0x1f3)](_0x3e4b9a(0x1e1));},0x1f4)),_0x928bbf[_0x5679ea(0x1eb)]('touchend',()=>clearTimeout(_0x29e5b2));const _0x38620a=document[_0x5679ea(0x1f4)](_0x5679ea(0x1a2));return _0x38620a[_0x5679ea(0x1ff)]=_0x5679ea(0x1ad),_0x38620a[_0x5679ea(0x202)]=formatTime(_0x3391d1['timestamp']),_0x2a50ec[_0x5679ea(0x1e0)](_0x52b77e),_0x2a50ec[_0x5679ea(0x1e0)](_0x928bbf),_0x2a50ec['appendChild'](_0x38620a),_0x2a50ec;}function createTypingIndicator(){const _0x54bab6=a0_0x50d17e,_0xfc205a=document['createElement'](_0x54bab6(0x1a2));return _0xfc205a['className']=_0x54bab6(0x19a),_0xfc205a['id']='typingIndicator',_0xfc205a['innerHTML']=_0x54bab6(0x1d4),_0xfc205a;}function renderMessages(){const _0x15ac78=a0_0x50d17e;Array[_0x15ac78(0x1fe)](chatArea[_0x15ac78(0x1e3)])[_0x15ac78(0x1d1)](_0xfbb9d1=>{const _0x43c690=_0x15ac78;if(_0xfbb9d1['id']!=='emptyState')_0xfbb9d1[_0x43c690(0x214)]();}),messages[_0x15ac78(0x1bf)]>0x0?(emptyState[_0x15ac78(0x204)]['display']=_0x15ac78(0x200),messages[_0x15ac78(0x1d1)]((_0x4f5e7f,_0x5b1677)=>chatArea[_0x15ac78(0x1e0)](createMessageElement(_0x4f5e7f,_0x5b1677)))):emptyState[_0x15ac78(0x204)]['display']=_0x15ac78(0x1c2),requestAnimationFrame(()=>chatArea[_0x15ac78(0x1b9)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x9a1a45=a0_0x50d17e;messageInput[_0x9a1a45(0x204)][_0x9a1a45(0x1fb)]='auto',messageInput[_0x9a1a45(0x204)]['height']=Math[_0x9a1a45(0x208)](messageInput[_0x9a1a45(0x1d9)],0x78)+'px';}function a0_0x3add(){const _0x38668a=['href','8aumDDH','28360aQHnvB','1050179LvBDwX','keydown','expand','add','trim','438ndsehT','forEach','modalText','text','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','abort','error','onClick','parse','scrollHeight','isVersionAtLeast','#050505','user','HapticFeedback','WebApp','innerHTML','appendChild','medium','803kZcrQp','children','offsetHeight','search','toString','contains','click','modalTitle','touchstart','addEventListener','setItem','Enter','6.1','Ошибка\x20сети','setHeaderColor','Ошибка\x20сервера','json','impactOccurred','createElement','4465ZRmNxJ','(((.+)+)+)+$','success','value','now','removeItem','height','getMinutes','TG\x20setup\x20error:','from','className','none','clearBtn','textContent','resize','style','messageInput','warn','10LPkHkO','min','onclick','key','785493nyyJVO','target','248EclBRC','4630LTCdar','constructor','push','4858BoCCyh','classList','Начнется\x20новый\x20диалог.','remove','getHours','message\x20','stringify','splice','viewportHeight','first_name','84rxVRxY','padStart','floor','confirmModal','message\x20ai','paddingBottom','Telegram','light','517359pnqSBI','innerHeight','getElementById','disableVerticalSwipes','div','show-delete','delete-btn','clear_history','input','getItem','notificationOccurred','BackButton','querySelectorAll','inputArea','initData','message-time','disabled','stopPropagation','preventDefault','focus','signal','debug_uid','querySelector','<br>','chatArea','Очистить\x20историю?','offClick','scrollTop','content','ai_chat_messages','show','Пустой\x20ответ','.container','length','initDataUnsafe','role','flex','emptyState','replace','random','Действие\x20необратимо.','POST'];a0_0x3add=function(){return _0x38668a;};return a0_0x3add();}function updateSendButton(){const _0x5ce7f4=a0_0x50d17e,_0x3381c2=messageInput['value'][_0x5ce7f4(0x1cf)]();sendBtn[_0x5ce7f4(0x1ae)]=!_0x3381c2||isTyping;}async function sendMessage(){const _0x4af009=a0_0x50d17e,_0x48c580=messageInput[_0x4af009(0x1f8)][_0x4af009(0x1cf)]();if(!_0x48c580||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x4af009(0x1f3)](_0x4af009(0x19d));messages[_0x4af009(0x210)]({'role':_0x4af009(0x1dc),'content':_0x48c580,'timestamp':Date[_0x4af009(0x1f9)]()}),localStorage[_0x4af009(0x1ec)](_0x4af009(0x1bb),JSON[_0x4af009(0x217)](messages)),renderMessages(),messageInput[_0x4af009(0x1f8)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x4af009(0x1b9)]=chatArea[_0x4af009(0x1d9)];const _0x25c8b8=await callBackend('send_message',{'message':_0x48c580});isTyping=![];const _0x147600=document[_0x4af009(0x1a0)]('typingIndicator');if(_0x147600)_0x147600[_0x4af009(0x214)]();let _0x288baa=_0x4af009(0x1ef);if(_0x25c8b8[_0x4af009(0x1f7)]){_0x288baa=_0x25c8b8[_0x4af009(0x1d3)]||_0x4af009(0x1bd);if(tg?.[_0x4af009(0x1dd)])tg['HapticFeedback'][_0x4af009(0x1a8)](_0x4af009(0x1f7));}else{_0x288baa=_0x25c8b8['error']||_0x4af009(0x1f1);if(tg?.[_0x4af009(0x1dd)])tg[_0x4af009(0x1dd)][_0x4af009(0x1a8)](_0x4af009(0x1d6));}messages['push']({'role':'ai','content':_0x288baa,'timestamp':Date[_0x4af009(0x1f9)]()}),localStorage[_0x4af009(0x1ec)]('ai_chat_messages',JSON[_0x4af009(0x217)](messages)),renderMessages();}function confirmDelete(_0x319344){const _0x318a96=a0_0x50d17e;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x318a96(0x202)]=_0x318a96(0x1c6);modalCallback=()=>{const _0xc78ad1=_0x318a96;messages[_0xc78ad1(0x218)](_0x319344,0x1),localStorage[_0xc78ad1(0x1ec)](_0xc78ad1(0x1bb),JSON[_0xc78ad1(0x217)](messages)),renderMessages();},modal[_0x318a96(0x212)][_0x318a96(0x1ce)](_0x318a96(0x1bc));}if(clearBtn)clearBtn['onclick']=()=>{const _0x3ca183=a0_0x50d17e;if(!messages[_0x3ca183(0x1bf)])return;if(mTitle)mTitle[_0x3ca183(0x202)]=_0x3ca183(0x1b7);if(mText)mText['textContent']=_0x3ca183(0x213);modalCallback=async()=>{const _0x453171=_0x3ca183;messages=[],localStorage[_0x453171(0x1fa)](_0x453171(0x1bb)),renderMessages(),callBackend(_0x453171(0x1a5),{});},modal[_0x3ca183(0x212)][_0x3ca183(0x1ce)](_0x3ca183(0x1bc));};document['getElementById']('modalCancel')['onclick']=()=>modal[a0_0x50d17e(0x212)][a0_0x50d17e(0x214)](a0_0x50d17e(0x1bc)),document[a0_0x50d17e(0x1a0)]('modalConfirm')[a0_0x50d17e(0x209)]=()=>{const _0x13c785=a0_0x50d17e;if(modalCallback)modalCallback();modal[_0x13c785(0x212)][_0x13c785(0x214)](_0x13c785(0x1bc));},messageInput['addEventListener'](a0_0x50d17e(0x1a6),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x50d17e(0x1eb)](a0_0x50d17e(0x1cc),_0x785c02=>{const _0x37e0b2=a0_0x50d17e;_0x785c02[_0x37e0b2(0x20a)]===_0x37e0b2(0x1ed)&&!_0x785c02['shiftKey']&&(_0x785c02[_0x37e0b2(0x1b0)](),sendMessage());}),sendBtn[a0_0x50d17e(0x209)]=sendMessage,document[a0_0x50d17e(0x1eb)](a0_0x50d17e(0x1e8),_0x6d2fca=>{const _0x397011=a0_0x50d17e;document[_0x397011(0x1aa)]('.message.show-delete')['forEach'](_0xd7dde3=>{const _0x3933ae=_0x397011;if(!_0xd7dde3[_0x3933ae(0x1e7)](_0x6d2fca[_0x3933ae(0x20c)]))_0xd7dde3['classList'][_0x3933ae(0x214)](_0x3933ae(0x1a3));});});const saved=localStorage['getItem'](a0_0x50d17e(0x1bb));if(saved)try{messages=JSON[a0_0x50d17e(0x1d8)](saved),renderMessages();}catch(a0_0x1b3974){}updateSendButton();