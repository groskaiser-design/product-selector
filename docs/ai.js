const a0_0x9b27e=a0_0x2f2c;(function(_0x57e367,_0x35a128){const _0x35d26b=a0_0x2f2c,_0x1caca0=_0x57e367();while(!![]){try{const _0x1e3b18=-parseInt(_0x35d26b(0x14f))/0x1+-parseInt(_0x35d26b(0x1c0))/0x2+-parseInt(_0x35d26b(0x150))/0x3+parseInt(_0x35d26b(0x19a))/0x4+parseInt(_0x35d26b(0x179))/0x5+-parseInt(_0x35d26b(0x1a4))/0x6*(-parseInt(_0x35d26b(0x156))/0x7)+-parseInt(_0x35d26b(0x173))/0x8*(parseInt(_0x35d26b(0x170))/0x9);if(_0x1e3b18===_0x35a128)break;else _0x1caca0['push'](_0x1caca0['shift']());}catch(_0x595efe){_0x1caca0['push'](_0x1caca0['shift']());}}}(a0_0x4954,0xcdad1));const tg=window[a0_0x9b27e(0x181)]?.[a0_0x9b27e(0x166)],HOME_URL=a0_0x9b27e(0x187);function setupTelegramBackButton(){const _0x27046b=a0_0x9b27e;if(!tg)return;try{tg['ready'](),tg[_0x27046b(0x18c)](),tg['setHeaderColor']?.(_0x27046b(0x1c8));if(tg['isVersionAtLeast']?.(_0x27046b(0x1b2)))tg['disableVerticalSwipes']?.();const _0x266050=tg[_0x27046b(0x1b5)];if(_0x266050){_0x266050['show']();if(typeof _0x266050[_0x27046b(0x190)]===_0x27046b(0x1b6))try{_0x266050[_0x27046b(0x190)]();}catch(_0x2e64e9){}_0x266050[_0x27046b(0x19e)](()=>{const _0x18d434=_0x27046b;if(tg[_0x18d434(0x1a1)])tg[_0x18d434(0x1a1)]['impactOccurred'](_0x18d434(0x172));location[_0x18d434(0x17a)]=HOME_URL;});}}catch(_0x405d42){console[_0x27046b(0x193)](_0x27046b(0x183),_0x405d42);}}function a0_0x4954(){const _0x165769=['<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Действие\x20необратимо.','key','abort','signal','modalConfirm','send_message','chatArea','initData','touchstart','6.1','show-delete','emptyState','BackButton','function','appendChild','success','<br>','message-bubble','Enter','json','viewportChanged','add','min','974290kTWflo','input','stopPropagation','viewportHeight','getHours','trim','.message.show-delete','random','#050505','ai_chat_messages','timestamp','auto','length','value','305080PIuLZs','3659211YwlVPx','resize','.container','forEach','onclick','(((.+)+)+)+$','49XbjjYU','delete-btn','contains','Удалить?','clear_history','offsetHeight','content','messageInput','push','notificationOccurred','querySelectorAll','getElementById','message\x20','medium','textContent','display','WebApp','getMinutes','setItem','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','text','stringify','div','padStart','initDataUnsafe','Ошибка\x20сети','9XzxrYI','clearBtn','light','386440IvNmCs','getItem','modalCancel','click','typingIndicator','user','6765680lKnZyw','href','constructor','className','replace','scrollTop','from','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','Telegram','createElement','TG\x20setup\x20error:','inputArea','username','addEventListener','./router.html','innerHTML','message\x20ai','show','Ошибка\x20сервера','expand','role','classList','Пустой\x20ответ','offClick','parse','height','warn','focus','impactOccurred','querySelector','first_name','style','target','1211044MjnoCl','keydown','children','scrollHeight','onClick','now','shiftKey','HapticFeedback','error','remove','1068702AudIog','text/plain','sendBtn','floor'];a0_0x4954=function(){return _0x165769;};return a0_0x4954();}(function initStableLayout(){const _0xa3a8c8=a0_0x9b27e,_0x8bd2eb=(function(){let _0xc7e4bb=!![];return function(_0x5c0253,_0x2cb9d1){const _0x5ae3d9=_0xc7e4bb?function(){if(_0x2cb9d1){const _0x2e9385=_0x2cb9d1['apply'](_0x5c0253,arguments);return _0x2cb9d1=null,_0x2e9385;}}:function(){};return _0xc7e4bb=![],_0x5ae3d9;};}()),_0x26f359=document[_0xa3a8c8(0x196)](_0xa3a8c8(0x152)),_0xb919bf=document[_0xa3a8c8(0x161)](_0xa3a8c8(0x184)),_0x7073b5=document[_0xa3a8c8(0x161)](_0xa3a8c8(0x1af)),_0x54b139=document[_0xa3a8c8(0x161)](_0xa3a8c8(0x15d));function _0x4190ed(){const _0x46792d=_0xa3a8c8,_0x2eab7b=_0x8bd2eb(this,function(){const _0x5ea0cf=a0_0x2f2c;return _0x2eab7b['toString']()['search'](_0x5ea0cf(0x155))['toString']()[_0x5ea0cf(0x17b)](_0x2eab7b)['search']('(((.+)+)+)+$');});_0x2eab7b();if(!_0x26f359)return;const _0x2879da=tg&&tg['viewportHeight']?tg[_0x46792d(0x1c3)]:window['innerHeight'];_0x26f359['style'][_0x46792d(0x192)]=_0x2879da+'px';if(_0xb919bf){const _0x1d4b42=_0xb919bf[_0x46792d(0x15b)];_0x7073b5['style']['paddingBottom']=_0x1d4b42+0x28+'px';}}tg?tg['onEvent'](_0xa3a8c8(0x1bd),({isStateStable:_0x263dc2})=>{_0x4190ed();if(_0x263dc2)requestAnimationFrame(()=>{const _0x2f550c=a0_0x2f2c;_0x7073b5['scrollTop']=_0x7073b5[_0x2f550c(0x19d)];});}):window[_0xa3a8c8(0x186)](_0xa3a8c8(0x151),_0x4190ed),_0x4190ed(),_0x54b139&&(_0x54b139[_0xa3a8c8(0x186)](_0xa3a8c8(0x1c1),()=>{requestAnimationFrame(_0x4190ed);}),_0x54b139[_0xa3a8c8(0x186)](_0xa3a8c8(0x194),()=>{setTimeout(()=>{const _0x64e3f8=a0_0x2f2c;_0x7073b5[_0x64e3f8(0x17e)]=_0x7073b5[_0x64e3f8(0x19d)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x9b27e(0x169),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x9b27e(0x161)](a0_0x9b27e(0x1af)),emptyState=document[a0_0x9b27e(0x161)](a0_0x9b27e(0x1b4)),messageInput=document[a0_0x9b27e(0x161)](a0_0x9b27e(0x15d)),sendBtn=document['getElementById'](a0_0x9b27e(0x1a6)),clearBtn=document[a0_0x9b27e(0x161)](a0_0x9b27e(0x171)),modal=document[a0_0x9b27e(0x161)]('confirmModal'),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x9b27e(0x161)]('modalText');let modalCallback=null;async function callBackend(_0x110ae0,_0x16dfd3){const _0x1f7ff5=a0_0x9b27e,_0x19fc4f=tg?.[_0x1f7ff5(0x16e)]?.[_0x1f7ff5(0x178)]||{},_0x4237b7=_0x19fc4f['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x1f7ff5(0x1a7)](Math[_0x1f7ff5(0x1c7)]()*0x3b9aca00);if(!_0x19fc4f['id'])localStorage[_0x1f7ff5(0x168)]('debug_uid',_0x4237b7);const _0x25d967={'action':_0x110ae0,'user_id':_0x4237b7,'user_data':{'first_name':_0x19fc4f[_0x1f7ff5(0x197)],'username':_0x19fc4f[_0x1f7ff5(0x185)]},'init_data':tg?.[_0x1f7ff5(0x1b0)]||'',..._0x16dfd3},_0x3f1489=new AbortController(),_0x3f96be=setTimeout(()=>_0x3f1489[_0x1f7ff5(0x1ab)](),REQUEST_TIMEOUT_MS);try{const _0x26164a=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x1f7ff5(0x1a5)},'body':JSON[_0x1f7ff5(0x16b)](_0x25d967),'signal':_0x3f1489[_0x1f7ff5(0x1ac)]});return clearTimeout(_0x3f96be),await _0x26164a[_0x1f7ff5(0x1bc)]();}catch(_0x3531b5){return{'success':![],'error':String(_0x3531b5)};}}function formatTime(_0x51b3e8){const _0x51f6de=a0_0x9b27e,_0x343364=new Date(_0x51b3e8);return String(_0x343364[_0x51f6de(0x1c4)]())[_0x51f6de(0x16d)](0x2,'0')+':'+String(_0x343364[_0x51f6de(0x167)]())[_0x51f6de(0x16d)](0x2,'0');}function createMessageElement(_0x33dfe0,_0x23d67){const _0x92350c=a0_0x9b27e,_0x2bb194=document[_0x92350c(0x182)](_0x92350c(0x16c));_0x2bb194[_0x92350c(0x17c)]=_0x92350c(0x162)+_0x33dfe0[_0x92350c(0x18d)];const _0x4a9f5b=document[_0x92350c(0x182)](_0x92350c(0x16c));_0x4a9f5b[_0x92350c(0x17c)]=_0x92350c(0x1ba),_0x4a9f5b[_0x92350c(0x188)]=_0x33dfe0[_0x92350c(0x15c)][_0x92350c(0x17d)](/\n/g,_0x92350c(0x1b9));const _0x25d5de=document[_0x92350c(0x182)](_0x92350c(0x16c));_0x25d5de[_0x92350c(0x17c)]=_0x92350c(0x157),_0x25d5de[_0x92350c(0x188)]=_0x92350c(0x1a8),_0x25d5de[_0x92350c(0x154)]=_0x2d6b75=>{const _0x40281c=_0x92350c;_0x2d6b75[_0x40281c(0x1c2)](),confirmDelete(_0x23d67);};let _0x32593a;_0x4a9f5b[_0x92350c(0x186)](_0x92350c(0x1b1),()=>_0x32593a=setTimeout(()=>{const _0x6d6f5d=_0x92350c;_0x2bb194[_0x6d6f5d(0x18e)][_0x6d6f5d(0x1be)](_0x6d6f5d(0x1b3));if(tg?.[_0x6d6f5d(0x1a1)])tg[_0x6d6f5d(0x1a1)][_0x6d6f5d(0x195)](_0x6d6f5d(0x163));},0x1f4)),_0x4a9f5b[_0x92350c(0x186)]('touchend',()=>clearTimeout(_0x32593a));const _0x195cd9=document[_0x92350c(0x182)]('div');return _0x195cd9['className']='message-time',_0x195cd9['textContent']=formatTime(_0x33dfe0[_0x92350c(0x14b)]),_0x2bb194[_0x92350c(0x1b7)](_0x25d5de),_0x2bb194[_0x92350c(0x1b7)](_0x4a9f5b),_0x2bb194[_0x92350c(0x1b7)](_0x195cd9),_0x2bb194;}function createTypingIndicator(){const _0x258bcc=a0_0x9b27e,_0x11bf46=document[_0x258bcc(0x182)](_0x258bcc(0x16c));return _0x11bf46['className']=_0x258bcc(0x189),_0x11bf46['id']=_0x258bcc(0x177),_0x11bf46[_0x258bcc(0x188)]=_0x258bcc(0x180),_0x11bf46;}function renderMessages(){const _0x20dc38=a0_0x9b27e;Array[_0x20dc38(0x17f)](chatArea[_0x20dc38(0x19c)])[_0x20dc38(0x153)](_0x2f3a7a=>{const _0x42eb35=_0x20dc38;if(_0x2f3a7a['id']!==_0x42eb35(0x1b4))_0x2f3a7a[_0x42eb35(0x1a3)]();}),messages[_0x20dc38(0x14d)]>0x0?(emptyState['style'][_0x20dc38(0x165)]='none',messages['forEach']((_0x439b0b,_0x328515)=>chatArea[_0x20dc38(0x1b7)](createMessageElement(_0x439b0b,_0x328515)))):emptyState[_0x20dc38(0x198)]['display']='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x20dc38(0x19d)]);}function autoResizeTextarea(){const _0x157fc9=a0_0x9b27e;messageInput['style']['height']=_0x157fc9(0x14c),messageInput[_0x157fc9(0x198)][_0x157fc9(0x192)]=Math[_0x157fc9(0x1bf)](messageInput[_0x157fc9(0x19d)],0x78)+'px';}function updateSendButton(){const _0x2e8cf3=a0_0x9b27e,_0x1320c7=messageInput[_0x2e8cf3(0x14e)]['trim']();sendBtn['disabled']=!_0x1320c7||isTyping;}async function sendMessage(){const _0xb49d80=a0_0x9b27e,_0x22152f=messageInput[_0xb49d80(0x14e)][_0xb49d80(0x1c5)]();if(!_0x22152f||isTyping)return;if(tg?.[_0xb49d80(0x1a1)])tg[_0xb49d80(0x1a1)][_0xb49d80(0x195)]('light');messages[_0xb49d80(0x15e)]({'role':'user','content':_0x22152f,'timestamp':Date['now']()}),localStorage[_0xb49d80(0x168)](_0xb49d80(0x14a),JSON[_0xb49d80(0x16b)](messages)),renderMessages(),messageInput[_0xb49d80(0x14e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xb49d80(0x1b7)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0xb49d80(0x19d)];const _0x29ba89=await callBackend(_0xb49d80(0x1ae),{'message':_0x22152f});isTyping=![];const _0x4d5c28=document['getElementById']('typingIndicator');if(_0x4d5c28)_0x4d5c28[_0xb49d80(0x1a3)]();let _0x19f72b=_0xb49d80(0x16f);if(_0x29ba89[_0xb49d80(0x1b8)]){_0x19f72b=_0x29ba89[_0xb49d80(0x16a)]||_0xb49d80(0x18f);if(tg?.[_0xb49d80(0x1a1)])tg[_0xb49d80(0x1a1)][_0xb49d80(0x15f)](_0xb49d80(0x1b8));}else{_0x19f72b=_0x29ba89[_0xb49d80(0x1a2)]||_0xb49d80(0x18b);if(tg?.['HapticFeedback'])tg[_0xb49d80(0x1a1)]['notificationOccurred']('error');}messages[_0xb49d80(0x15e)]({'role':'ai','content':_0x19f72b,'timestamp':Date[_0xb49d80(0x19f)]()}),localStorage['setItem'](_0xb49d80(0x14a),JSON[_0xb49d80(0x16b)](messages)),renderMessages();}function confirmDelete(_0x24cf24){const _0xfaed0c=a0_0x9b27e;if(mTitle)mTitle[_0xfaed0c(0x164)]=_0xfaed0c(0x159);if(mText)mText[_0xfaed0c(0x164)]=_0xfaed0c(0x1a9);modalCallback=()=>{const _0x233e89=_0xfaed0c;messages['splice'](_0x24cf24,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x233e89(0x16b)](messages)),renderMessages();},modal[_0xfaed0c(0x18e)][_0xfaed0c(0x1be)](_0xfaed0c(0x18a));}if(clearBtn)clearBtn[a0_0x9b27e(0x154)]=()=>{const _0x38b42c=a0_0x9b27e;if(!messages['length'])return;if(mTitle)mTitle[_0x38b42c(0x164)]='Очистить\x20историю?';if(mText)mText[_0x38b42c(0x164)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x20f7b1=_0x38b42c;messages=[],localStorage['removeItem'](_0x20f7b1(0x14a)),renderMessages(),callBackend(_0x20f7b1(0x15a),{});},modal[_0x38b42c(0x18e)][_0x38b42c(0x1be)](_0x38b42c(0x18a));};function a0_0x2f2c(_0x22ce8d,_0x380300){_0x22ce8d=_0x22ce8d-0x14a;const _0x50af85=a0_0x4954();let _0xd2d5e=_0x50af85[_0x22ce8d];return _0xd2d5e;}document[a0_0x9b27e(0x161)](a0_0x9b27e(0x175))[a0_0x9b27e(0x154)]=()=>modal['classList'][a0_0x9b27e(0x1a3)](a0_0x9b27e(0x18a)),document['getElementById'](a0_0x9b27e(0x1ad))['onclick']=()=>{const _0x5e5aa5=a0_0x9b27e;if(modalCallback)modalCallback();modal[_0x5e5aa5(0x18e)]['remove']('show');},messageInput[a0_0x9b27e(0x186)](a0_0x9b27e(0x1c1),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x9b27e(0x19b),_0x30733a=>{const _0x1b5b8c=a0_0x9b27e;_0x30733a[_0x1b5b8c(0x1aa)]===_0x1b5b8c(0x1bb)&&!_0x30733a[_0x1b5b8c(0x1a0)]&&(_0x30733a['preventDefault'](),sendMessage());}),sendBtn[a0_0x9b27e(0x154)]=sendMessage,document[a0_0x9b27e(0x186)](a0_0x9b27e(0x176),_0x390c62=>{const _0x795df7=a0_0x9b27e;document[_0x795df7(0x160)](_0x795df7(0x1c6))[_0x795df7(0x153)](_0x328a9d=>{const _0x37ab7a=_0x795df7;if(!_0x328a9d[_0x37ab7a(0x158)](_0x390c62[_0x37ab7a(0x199)]))_0x328a9d[_0x37ab7a(0x18e)][_0x37ab7a(0x1a3)](_0x37ab7a(0x1b3));});});const saved=localStorage[a0_0x9b27e(0x174)](a0_0x9b27e(0x14a));if(saved)try{messages=JSON[a0_0x9b27e(0x191)](saved),renderMessages();}catch(a0_0x3bf26e){}updateSendButton();