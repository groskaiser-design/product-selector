function a0_0xcd14(){const _0x13233c=['66803IGWzrq','error','viewportHeight','show-delete','touchend','inputArea','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','2330GBYxsK','onclick','addEventListener','focus','key','message\x20','viewportChanged','innerHeight','messageInput','BackButton','onClick','6.1','now','#050505','constructor','sendBtn','Telegram','133qNbfBd','signal','getItem','div','emptyState','clearBtn','delete-btn','Начнется\x20новый\x20диалог.','text/plain','message-time','toString','username','Enter','45912rvlodt','WebApp','send_message','typingIndicator','remove','light','stopPropagation','getElementById','HapticFeedback','12FChSsl','add','value','setItem','(((.+)+)+)+$','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','user','disabled','length','search','push','2293488BVjgAU','Пустой\x20ответ','querySelector','classList','resize','disableVerticalSwipes','height','from','flex','2movzhz','isVersionAtLeast','modalConfirm','input','onEvent','random','502485bZCtRL','textContent','getHours','impactOccurred','Очистить\x20историю?','display','message-bubble','Действие\x20необратимо.','debug_uid','offClick','text','shiftKey','716292PfplqV','contains','className','medium','apply','modalText','3275190ABLttr','forEach','content','function','show','abort','chatArea','Ошибка\x20сети','innerHTML','trim','preventDefault','Удалить?','keydown','createElement','replace','appendChild','first_name','scrollHeight','parse','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','POST','<br>','success','none','stringify','role','ai_chat_messages','auto','295233VKZMeb','.container','./router.html','offsetHeight','padStart','removeItem','clear_history','warn','initDataUnsafe','min','style','click','scrollTop','Ошибка\x20сервера'];a0_0xcd14=function(){return _0x13233c;};return a0_0xcd14();}const a0_0x575591=a0_0x40b9;(function(_0x38dc84,_0x332f39){const _0x3fb4cf=a0_0x40b9,_0x62bd0d=_0x38dc84();while(!![]){try{const _0x1be2a5=-parseInt(_0x3fb4cf(0x1d6))/0x1*(parseInt(_0x3fb4cf(0x1a2))/0x2)+-parseInt(_0x3fb4cf(0x1b4))/0x3+parseInt(_0x3fb4cf(0x212))/0x4*(-parseInt(_0x3fb4cf(0x1a8))/0x5)+parseInt(_0x3fb4cf(0x209))/0x6*(-parseInt(_0x3fb4cf(0x1fc))/0x7)+parseInt(_0x3fb4cf(0x199))/0x8+-parseInt(_0x3fb4cf(0x1ba))/0x9+-parseInt(_0x3fb4cf(0x1eb))/0xa*(-parseInt(_0x3fb4cf(0x1e4))/0xb);if(_0x1be2a5===_0x332f39)break;else _0x62bd0d['push'](_0x62bd0d['shift']());}catch(_0x29a2aa){_0x62bd0d['push'](_0x62bd0d['shift']());}}}(a0_0xcd14,0x5722d));const tg=window[a0_0x575591(0x1fb)]?.[a0_0x575591(0x20a)],HOME_URL=a0_0x575591(0x1d8);function setupTelegramBackButton(){const _0x3b587d=a0_0x575591;if(!tg)return;try{tg['ready'](),tg['expand'](),tg['setHeaderColor']?.(_0x3b587d(0x1f8));if(tg[_0x3b587d(0x1a3)]?.(_0x3b587d(0x1f6)))tg[_0x3b587d(0x19e)]?.();const _0x13aaeb=tg[_0x3b587d(0x1f4)];if(_0x13aaeb){_0x13aaeb[_0x3b587d(0x1be)]();if(typeof _0x13aaeb[_0x3b587d(0x1b1)]===_0x3b587d(0x1bd))try{_0x13aaeb['offClick']();}catch(_0x4ab38e){}_0x13aaeb[_0x3b587d(0x1f5)](()=>{const _0x960d7f=_0x3b587d;if(tg['HapticFeedback'])tg[_0x960d7f(0x211)][_0x960d7f(0x1ab)](_0x960d7f(0x20e));location['href']=HOME_URL;});}}catch(_0x2f3794){console[_0x3b587d(0x1dd)]('TG\x20setup\x20error:',_0x2f3794);}}(function initStableLayout(){const _0x3e70ce=a0_0x575591,_0x57f41d=(function(){let _0x1065e1=!![];return function(_0x1acf3f,_0x4ed752){const _0x5098fd=_0x1065e1?function(){const _0x227160=a0_0x40b9;if(_0x4ed752){const _0x29c7ed=_0x4ed752[_0x227160(0x1b8)](_0x1acf3f,arguments);return _0x4ed752=null,_0x29c7ed;}}:function(){};return _0x1065e1=![],_0x5098fd;};}()),_0xaf2ec9=document[_0x3e70ce(0x19b)](_0x3e70ce(0x1d7)),_0x5f0d0f=document['getElementById'](_0x3e70ce(0x1e9)),_0x21f3ea=document[_0x3e70ce(0x210)](_0x3e70ce(0x1c0)),_0x20ce7b=document[_0x3e70ce(0x210)](_0x3e70ce(0x1f3));function _0x5863a5(){const _0x454442=_0x3e70ce,_0x4bc2f3=_0x57f41d(this,function(){const _0x50fc10=a0_0x40b9;return _0x4bc2f3[_0x50fc10(0x206)]()['search'](_0x50fc10(0x192))[_0x50fc10(0x206)]()[_0x50fc10(0x1f9)](_0x4bc2f3)[_0x50fc10(0x197)](_0x50fc10(0x192));});_0x4bc2f3();if(!_0xaf2ec9)return;const _0x587163=tg&&tg[_0x454442(0x1e6)]?tg['viewportHeight']:window[_0x454442(0x1f2)];_0xaf2ec9['style'][_0x454442(0x19f)]=_0x587163+'px';if(_0x5f0d0f){const _0x301a6c=_0x5f0d0f[_0x454442(0x1d9)];_0x21f3ea[_0x454442(0x1e0)]['paddingBottom']=_0x301a6c+0x28+'px';}}tg?tg[_0x3e70ce(0x1a6)](_0x3e70ce(0x1f1),({isStateStable:_0x145f23})=>{_0x5863a5();if(_0x145f23)requestAnimationFrame(()=>{const _0x23b39c=a0_0x40b9;_0x21f3ea['scrollTop']=_0x21f3ea[_0x23b39c(0x1cb)];});}):window['addEventListener'](_0x3e70ce(0x19d),_0x5863a5),_0x5863a5(),_0x20ce7b&&(_0x20ce7b[_0x3e70ce(0x1ed)]('input',()=>{requestAnimationFrame(_0x5863a5);}),_0x20ce7b['addEventListener'](_0x3e70ce(0x1ee),()=>{setTimeout(()=>{const _0x34491d=a0_0x40b9;_0x21f3ea[_0x34491d(0x1e2)]=_0x21f3ea['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x575591(0x193),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x575591(0x210)](a0_0x575591(0x1c0)),emptyState=document[a0_0x575591(0x210)](a0_0x575591(0x200)),messageInput=document[a0_0x575591(0x210)](a0_0x575591(0x1f3)),sendBtn=document[a0_0x575591(0x210)](a0_0x575591(0x1fa)),clearBtn=document[a0_0x575591(0x210)](a0_0x575591(0x201)),modal=document[a0_0x575591(0x210)]('confirmModal'),mTitle=document[a0_0x575591(0x210)]('modalTitle'),mText=document['getElementById'](a0_0x575591(0x1b9));let modalCallback=null;async function callBackend(_0x677eef,_0x35c396){const _0x5ec77=a0_0x575591,_0x33434d=tg?.[_0x5ec77(0x1de)]?.[_0x5ec77(0x194)]||{},_0x1071f6=_0x33434d['id']||localStorage[_0x5ec77(0x1fe)](_0x5ec77(0x1b0))||'d-'+Math['floor'](Math[_0x5ec77(0x1a7)]()*0x3b9aca00);if(!_0x33434d['id'])localStorage[_0x5ec77(0x191)](_0x5ec77(0x1b0),_0x1071f6);const _0x34669f={'action':_0x677eef,'user_id':_0x1071f6,'user_data':{'first_name':_0x33434d[_0x5ec77(0x1ca)],'username':_0x33434d[_0x5ec77(0x207)]},'init_data':tg?.['initData']||'',..._0x35c396},_0x10aefa=new AbortController(),_0x59bcf7=setTimeout(()=>_0x10aefa[_0x5ec77(0x1bf)](),REQUEST_TIMEOUT_MS);try{const _0x3e219c=await fetch(BACKEND_URL,{'method':_0x5ec77(0x1ce),'headers':{'Content-Type':_0x5ec77(0x204)},'body':JSON['stringify'](_0x34669f),'signal':_0x10aefa[_0x5ec77(0x1fd)]});return clearTimeout(_0x59bcf7),await _0x3e219c['json']();}catch(_0x4329ff){return{'success':![],'error':String(_0x4329ff)};}}function formatTime(_0x400e4b){const _0x113ff3=a0_0x575591,_0x2de718=new Date(_0x400e4b);return String(_0x2de718[_0x113ff3(0x1aa)]())['padStart'](0x2,'0')+':'+String(_0x2de718['getMinutes']())[_0x113ff3(0x1da)](0x2,'0');}function createMessageElement(_0x3b27c1,_0x2b36d3){const _0x5f085c=a0_0x575591,_0xd402a1=document[_0x5f085c(0x1c7)](_0x5f085c(0x1ff));_0xd402a1[_0x5f085c(0x1b6)]=_0x5f085c(0x1f0)+_0x3b27c1[_0x5f085c(0x1d3)];const _0x56d229=document[_0x5f085c(0x1c7)]('div');_0x56d229[_0x5f085c(0x1b6)]=_0x5f085c(0x1ae),_0x56d229[_0x5f085c(0x1c2)]=_0x3b27c1[_0x5f085c(0x1bc)][_0x5f085c(0x1c8)](/\n/g,_0x5f085c(0x1cf));const _0x3497a6=document[_0x5f085c(0x1c7)](_0x5f085c(0x1ff));_0x3497a6['className']=_0x5f085c(0x202),_0x3497a6[_0x5f085c(0x1c2)]=_0x5f085c(0x1cd),_0x3497a6[_0x5f085c(0x1ec)]=_0x57ff5=>{const _0x4fbd82=_0x5f085c;_0x57ff5[_0x4fbd82(0x20f)](),confirmDelete(_0x2b36d3);};let _0x1d83bb;_0x56d229[_0x5f085c(0x1ed)]('touchstart',()=>_0x1d83bb=setTimeout(()=>{const _0x4761a1=_0x5f085c;_0xd402a1['classList'][_0x4761a1(0x213)](_0x4761a1(0x1e7));if(tg?.['HapticFeedback'])tg[_0x4761a1(0x211)][_0x4761a1(0x1ab)](_0x4761a1(0x1b7));},0x1f4)),_0x56d229['addEventListener'](_0x5f085c(0x1e8),()=>clearTimeout(_0x1d83bb));const _0x1426c4=document[_0x5f085c(0x1c7)]('div');return _0x1426c4['className']=_0x5f085c(0x205),_0x1426c4[_0x5f085c(0x1a9)]=formatTime(_0x3b27c1['timestamp']),_0xd402a1[_0x5f085c(0x1c9)](_0x3497a6),_0xd402a1['appendChild'](_0x56d229),_0xd402a1[_0x5f085c(0x1c9)](_0x1426c4),_0xd402a1;}function a0_0x40b9(_0x3361cf,_0xe6621b){_0x3361cf=_0x3361cf-0x190;const _0x270557=a0_0xcd14();let _0x2f7580=_0x270557[_0x3361cf];return _0x2f7580;}function createTypingIndicator(){const _0x39e1b0=a0_0x575591,_0x13720e=document[_0x39e1b0(0x1c7)](_0x39e1b0(0x1ff));return _0x13720e[_0x39e1b0(0x1b6)]='message\x20ai',_0x13720e['id']='typingIndicator',_0x13720e[_0x39e1b0(0x1c2)]=_0x39e1b0(0x1ea),_0x13720e;}function renderMessages(){const _0xcda8da=a0_0x575591;Array[_0xcda8da(0x1a0)](chatArea['children'])[_0xcda8da(0x1bb)](_0x266013=>{if(_0x266013['id']!=='emptyState')_0x266013['remove']();}),messages['length']>0x0?(emptyState[_0xcda8da(0x1e0)][_0xcda8da(0x1ad)]=_0xcda8da(0x1d1),messages['forEach']((_0x365bdf,_0x496279)=>chatArea['appendChild'](createMessageElement(_0x365bdf,_0x496279)))):emptyState['style'][_0xcda8da(0x1ad)]=_0xcda8da(0x1a1),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x47b9d1=a0_0x575591;messageInput[_0x47b9d1(0x1e0)][_0x47b9d1(0x19f)]=_0x47b9d1(0x1d5),messageInput[_0x47b9d1(0x1e0)][_0x47b9d1(0x19f)]=Math[_0x47b9d1(0x1df)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x36faa9=a0_0x575591,_0x2ca10e=messageInput[_0x36faa9(0x190)][_0x36faa9(0x1c3)]();sendBtn[_0x36faa9(0x195)]=!_0x2ca10e||isTyping;}async function sendMessage(){const _0x4d81e9=a0_0x575591,_0x40df19=messageInput[_0x4d81e9(0x190)]['trim']();if(!_0x40df19||isTyping)return;if(tg?.[_0x4d81e9(0x211)])tg[_0x4d81e9(0x211)][_0x4d81e9(0x1ab)](_0x4d81e9(0x20e));messages['push']({'role':_0x4d81e9(0x194),'content':_0x40df19,'timestamp':Date['now']()}),localStorage[_0x4d81e9(0x191)](_0x4d81e9(0x1d4),JSON[_0x4d81e9(0x1d2)](messages)),renderMessages(),messageInput[_0x4d81e9(0x190)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4d81e9(0x1c9)](createTypingIndicator()),chatArea[_0x4d81e9(0x1e2)]=chatArea[_0x4d81e9(0x1cb)];const _0x7a7b5f=await callBackend(_0x4d81e9(0x20b),{'message':_0x40df19});isTyping=![];const _0x2f332a=document[_0x4d81e9(0x210)](_0x4d81e9(0x20c));if(_0x2f332a)_0x2f332a['remove']();let _0xa6617d=_0x4d81e9(0x1c1);if(_0x7a7b5f[_0x4d81e9(0x1d0)]){_0xa6617d=_0x7a7b5f[_0x4d81e9(0x1b2)]||_0x4d81e9(0x19a);if(tg?.[_0x4d81e9(0x211)])tg[_0x4d81e9(0x211)]['notificationOccurred'](_0x4d81e9(0x1d0));}else{_0xa6617d=_0x7a7b5f[_0x4d81e9(0x1e5)]||_0x4d81e9(0x1e3);if(tg?.[_0x4d81e9(0x211)])tg['HapticFeedback']['notificationOccurred'](_0x4d81e9(0x1e5));}messages[_0x4d81e9(0x198)]({'role':'ai','content':_0xa6617d,'timestamp':Date[_0x4d81e9(0x1f7)]()}),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x21de4a){const _0x27fc93=a0_0x575591;if(mTitle)mTitle[_0x27fc93(0x1a9)]=_0x27fc93(0x1c5);if(mText)mText[_0x27fc93(0x1a9)]=_0x27fc93(0x1af);modalCallback=()=>{const _0x5b1a4c=_0x27fc93;messages['splice'](_0x21de4a,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x5b1a4c(0x1d2)](messages)),renderMessages();},modal[_0x27fc93(0x19c)][_0x27fc93(0x213)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0x34d4c3=a0_0x575591;if(!messages[_0x34d4c3(0x196)])return;if(mTitle)mTitle[_0x34d4c3(0x1a9)]=_0x34d4c3(0x1ac);if(mText)mText[_0x34d4c3(0x1a9)]=_0x34d4c3(0x203);modalCallback=async()=>{const _0x1410a7=_0x34d4c3;messages=[],localStorage[_0x1410a7(0x1db)](_0x1410a7(0x1d4)),renderMessages(),callBackend(_0x1410a7(0x1dc),{});},modal[_0x34d4c3(0x19c)]['add'](_0x34d4c3(0x1be));};document[a0_0x575591(0x210)]('modalCancel')[a0_0x575591(0x1ec)]=()=>modal[a0_0x575591(0x19c)]['remove']('show'),document[a0_0x575591(0x210)](a0_0x575591(0x1a4))[a0_0x575591(0x1ec)]=()=>{const _0x225849=a0_0x575591;if(modalCallback)modalCallback();modal[_0x225849(0x19c)][_0x225849(0x20d)](_0x225849(0x1be));},messageInput[a0_0x575591(0x1ed)](a0_0x575591(0x1a5),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x575591(0x1ed)](a0_0x575591(0x1c6),_0xb475bf=>{const _0x5d64ee=a0_0x575591;_0xb475bf[_0x5d64ee(0x1ef)]===_0x5d64ee(0x208)&&!_0xb475bf[_0x5d64ee(0x1b3)]&&(_0xb475bf[_0x5d64ee(0x1c4)](),sendMessage());}),sendBtn[a0_0x575591(0x1ec)]=sendMessage,document['addEventListener'](a0_0x575591(0x1e1),_0x12f445=>{const _0x3ad417=a0_0x575591;document['querySelectorAll']('.message.show-delete')[_0x3ad417(0x1bb)](_0x2442ef=>{const _0x17f627=_0x3ad417;if(!_0x2442ef[_0x17f627(0x1b5)](_0x12f445['target']))_0x2442ef[_0x17f627(0x19c)][_0x17f627(0x20d)](_0x17f627(0x1e7));});});const saved=localStorage[a0_0x575591(0x1fe)](a0_0x575591(0x1d4));if(saved)try{messages=JSON[a0_0x575591(0x1cc)](saved),renderMessages();}catch(a0_0x51e973){}updateSendButton();