const a0_0x50d586=a0_0x1372;function a0_0x1372(_0x46ca1b,_0x4ed9f4){_0x46ca1b=_0x46ca1b-0xb2;const _0x34a6d1=a0_0x52c0();let _0x596599=_0x34a6d1[_0x46ca1b];return _0x596599;}(function(_0x1c8e08,_0x653a15){const _0x51de76=a0_0x1372,_0x1ed3c0=_0x1c8e08();while(!![]){try{const _0x408ff3=parseInt(_0x51de76(0xe3))/0x1+parseInt(_0x51de76(0x12b))/0x2+parseInt(_0x51de76(0x120))/0x3+parseInt(_0x51de76(0x122))/0x4+-parseInt(_0x51de76(0xe5))/0x5*(-parseInt(_0x51de76(0xc7))/0x6)+parseInt(_0x51de76(0xcc))/0x7*(parseInt(_0x51de76(0x130))/0x8)+-parseInt(_0x51de76(0xf5))/0x9;if(_0x408ff3===_0x653a15)break;else _0x1ed3c0['push'](_0x1ed3c0['shift']());}catch(_0x5d2259){_0x1ed3c0['push'](_0x1ed3c0['shift']());}}}(a0_0x52c0,0x47fcd));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x50d586(0x11b);function setupTelegramBackButton(){const _0xe9c446=a0_0x50d586,_0x5b34bc=(function(){let _0x4b1fe0=!![];return function(_0x5e5dcb,_0x4e218e){const _0x466114=_0x4b1fe0?function(){const _0x2e8deb=a0_0x1372;if(_0x4e218e){const _0x143c74=_0x4e218e[_0x2e8deb(0xd8)](_0x5e5dcb,arguments);return _0x4e218e=null,_0x143c74;}}:function(){};return _0x4b1fe0=![],_0x466114;};}()),_0x501cde=_0x5b34bc(this,function(){const _0x215774=a0_0x1372;return _0x501cde[_0x215774(0xbf)]()[_0x215774(0x11c)]('(((.+)+)+)+$')['toString']()[_0x215774(0x109)](_0x501cde)['search']('(((.+)+)+)+$');});_0x501cde();if(!tg)return;try{tg[_0xe9c446(0xfb)](),tg[_0xe9c446(0x10b)](),tg[_0xe9c446(0xb2)]?.(_0xe9c446(0x10d));if(tg[_0xe9c446(0x116)]?.(_0xe9c446(0xf7)))tg['disableVerticalSwipes']?.();const _0x1b97b5=tg[_0xe9c446(0xc6)];if(_0x1b97b5){_0x1b97b5[_0xe9c446(0xfc)]();if(typeof _0x1b97b5[_0xe9c446(0x107)]===_0xe9c446(0xbe))try{_0x1b97b5[_0xe9c446(0x107)]();}catch(_0x4666c4){}_0x1b97b5[_0xe9c446(0x12d)](()=>{const _0x57d42c=_0xe9c446;if(tg['HapticFeedback'])tg[_0x57d42c(0x106)][_0x57d42c(0x12c)](_0x57d42c(0xb6));location[_0x57d42c(0x104)]=HOME_URL;});}}catch(_0x20971a){console[_0xe9c446(0xd5)](_0xe9c446(0x125),_0x20971a);}}(function initStableLayout(){const _0x8bb140=a0_0x50d586,_0x5c50fb=document[_0x8bb140(0x113)]('.container'),_0x213a76=document[_0x8bb140(0xd4)](_0x8bb140(0xef)),_0x10ee59=document[_0x8bb140(0xd4)](_0x8bb140(0xde)),_0x428190=document[_0x8bb140(0xd4)](_0x8bb140(0x102));function _0x19f49c(){const _0x205d7d=_0x8bb140;if(!_0x5c50fb)return;const _0x18f0b4=tg&&tg[_0x205d7d(0xd9)]?tg['viewportHeight']:window[_0x205d7d(0xc0)];_0x5c50fb[_0x205d7d(0x126)][_0x205d7d(0xca)]=_0x18f0b4+'px';if(_0x213a76){const _0x5890f4=_0x213a76['offsetHeight'];_0x10ee59[_0x205d7d(0x126)][_0x205d7d(0xb5)]=_0x5890f4+0x28+'px';}}tg?tg['onEvent'](_0x8bb140(0x133),({isStateStable:_0xcea7ca})=>{_0x19f49c();if(_0xcea7ca)requestAnimationFrame(()=>{const _0xec4577=a0_0x1372;_0x10ee59[_0xec4577(0xc5)]=_0x10ee59[_0xec4577(0x11f)];});}):window[_0x8bb140(0xb3)](_0x8bb140(0x132),_0x19f49c),_0x19f49c(),_0x428190&&(_0x428190['addEventListener'](_0x8bb140(0xe6),()=>{requestAnimationFrame(_0x19f49c);}),_0x428190['addEventListener']('focus',()=>{setTimeout(()=>{const _0x2984c7=a0_0x1372;_0x10ee59[_0x2984c7(0xc5)]=_0x10ee59[_0x2984c7(0x11f)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x50d586(0xbd),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x52c0(){const _0x2242bd=['key','textContent','height','push','7XIrZbj','<br>','first_name','disabled','text/plain','onclick','error','initDataUnsafe','getElementById','warn','timestamp','preventDefault','apply','viewportHeight','sendBtn','role','trim','medium','chatArea','getMinutes','now','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','createElement','276920kLjEqo','classList','2503045PswzLJ','input','length','Действие\x20необратимо.','username','display','debug_uid','stringify','message\x20','contains','inputArea','target','send_message','Ошибка\x20сети','json','Начнется\x20новый\x20диалог.','13875687xRtKSN','className','6.1','auto','initData','appendChild','ready','show','flex','success','value','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','min','messageInput','getItem','href','remove','HapticFeedback','offClick','replace','constructor','splice','expand','delete-btn','#050505','getHours','message-bubble','from','Enter','notificationOccurred','querySelector','div','user','isVersionAtLeast','add','padStart','abort','typingIndicator','./router.html','search','message\x20ai','Ошибка\x20сервера','scrollHeight','1369692nuBzpU','modalCancel','342744HgJcRO','none','forEach','TG\x20setup\x20error:','style','touchstart','shiftKey','clear_history','Удалить?','579264ifPodI','impactOccurred','onClick','modalText','floor','1817544PeWnoy','modalConfirm','resize','viewportChanged','ai_chat_messages','random','.message.show-delete','setHeaderColor','addEventListener','removeItem','paddingBottom','light','innerHTML','text','emptyState','keydown','touchend','Пустой\x20ответ','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','function','toString','innerHeight','stopPropagation','setItem','signal','clearBtn','scrollTop','BackButton','6rUErSw'];a0_0x52c0=function(){return _0x2242bd;};return a0_0x52c0();}let messages=[],isTyping=![];const chatArea=document[a0_0x50d586(0xd4)](a0_0x50d586(0xde)),emptyState=document[a0_0x50d586(0xd4)](a0_0x50d586(0xb9)),messageInput=document[a0_0x50d586(0xd4)]('messageInput'),sendBtn=document[a0_0x50d586(0xd4)](a0_0x50d586(0xda)),clearBtn=document['getElementById'](a0_0x50d586(0xc4)),modal=document[a0_0x50d586(0xd4)]('confirmModal'),mTitle=document[a0_0x50d586(0xd4)]('modalTitle'),mText=document[a0_0x50d586(0xd4)](a0_0x50d586(0x12e));let modalCallback=null;async function callBackend(_0x25ef2a,_0x919b6d){const _0xaa04de=a0_0x50d586,_0x27e1f2=tg?.[_0xaa04de(0xd3)]?.[_0xaa04de(0x115)]||{},_0x50c755=_0x27e1f2['id']||localStorage[_0xaa04de(0x103)](_0xaa04de(0xeb))||'d-'+Math[_0xaa04de(0x12f)](Math[_0xaa04de(0x135)]()*0x3b9aca00);if(!_0x27e1f2['id'])localStorage[_0xaa04de(0xc2)](_0xaa04de(0xeb),_0x50c755);const _0x23d519={'action':_0x25ef2a,'user_id':_0x50c755,'user_data':{'first_name':_0x27e1f2[_0xaa04de(0xce)],'username':_0x27e1f2[_0xaa04de(0xe9)]},'init_data':tg?.[_0xaa04de(0xf9)]||'',..._0x919b6d},_0x22987a=new AbortController(),_0x204ff2=setTimeout(()=>_0x22987a[_0xaa04de(0x119)](),REQUEST_TIMEOUT_MS);try{const _0x4cc567=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0xaa04de(0xd0)},'body':JSON[_0xaa04de(0xec)](_0x23d519),'signal':_0x22987a[_0xaa04de(0xc3)]});return clearTimeout(_0x204ff2),await _0x4cc567[_0xaa04de(0xf3)]();}catch(_0x131de3){return{'success':![],'error':String(_0x131de3)};}}function formatTime(_0xb7504b){const _0x3587c7=a0_0x50d586,_0x9d656c=new Date(_0xb7504b);return String(_0x9d656c[_0x3587c7(0x10e)]())[_0x3587c7(0x118)](0x2,'0')+':'+String(_0x9d656c[_0x3587c7(0xdf)]())[_0x3587c7(0x118)](0x2,'0');}function createMessageElement(_0x421a9b,_0x5557e4){const _0x26d0d8=a0_0x50d586,_0x2eb3b1=document[_0x26d0d8(0xe2)](_0x26d0d8(0x114));_0x2eb3b1['className']=_0x26d0d8(0xed)+_0x421a9b[_0x26d0d8(0xdb)];const _0x40b229=document[_0x26d0d8(0xe2)](_0x26d0d8(0x114));_0x40b229[_0x26d0d8(0xf6)]=_0x26d0d8(0x10f),_0x40b229[_0x26d0d8(0xb7)]=_0x421a9b['content'][_0x26d0d8(0x108)](/\n/g,_0x26d0d8(0xcd));const _0x2b24e6=document[_0x26d0d8(0xe2)]('div');_0x2b24e6[_0x26d0d8(0xf6)]=_0x26d0d8(0x10c),_0x2b24e6[_0x26d0d8(0xb7)]=_0x26d0d8(0xe1),_0x2b24e6[_0x26d0d8(0xd1)]=_0x2c6eba=>{const _0x45ece1=_0x26d0d8;_0x2c6eba[_0x45ece1(0xc1)](),confirmDelete(_0x5557e4);};let _0x3bf534;_0x40b229['addEventListener'](_0x26d0d8(0x127),()=>_0x3bf534=setTimeout(()=>{const _0x4f9372=_0x26d0d8;_0x2eb3b1['classList'][_0x4f9372(0x117)]('show-delete');if(tg?.[_0x4f9372(0x106)])tg['HapticFeedback'][_0x4f9372(0x12c)](_0x4f9372(0xdd));},0x1f4)),_0x40b229[_0x26d0d8(0xb3)](_0x26d0d8(0xbb),()=>clearTimeout(_0x3bf534));const _0x233a9d=document['createElement']('div');return _0x233a9d[_0x26d0d8(0xf6)]='message-time',_0x233a9d[_0x26d0d8(0xc9)]=formatTime(_0x421a9b[_0x26d0d8(0xd6)]),_0x2eb3b1['appendChild'](_0x2b24e6),_0x2eb3b1[_0x26d0d8(0xfa)](_0x40b229),_0x2eb3b1[_0x26d0d8(0xfa)](_0x233a9d),_0x2eb3b1;}function createTypingIndicator(){const _0x27af71=a0_0x50d586,_0x18f0cf=document[_0x27af71(0xe2)](_0x27af71(0x114));return _0x18f0cf[_0x27af71(0xf6)]=_0x27af71(0x11d),_0x18f0cf['id']='typingIndicator',_0x18f0cf['innerHTML']=_0x27af71(0x100),_0x18f0cf;}function renderMessages(){const _0x2a904a=a0_0x50d586;Array[_0x2a904a(0x110)](chatArea['children'])[_0x2a904a(0x124)](_0xb254bb=>{if(_0xb254bb['id']!=='emptyState')_0xb254bb['remove']();}),messages[_0x2a904a(0xe7)]>0x0?(emptyState[_0x2a904a(0x126)][_0x2a904a(0xea)]=_0x2a904a(0x123),messages[_0x2a904a(0x124)]((_0x206b91,_0x1aac7f)=>chatArea[_0x2a904a(0xfa)](createMessageElement(_0x206b91,_0x1aac7f)))):emptyState[_0x2a904a(0x126)][_0x2a904a(0xea)]=_0x2a904a(0xfd),requestAnimationFrame(()=>chatArea[_0x2a904a(0xc5)]=chatArea[_0x2a904a(0x11f)]);}function autoResizeTextarea(){const _0x1ac003=a0_0x50d586;messageInput[_0x1ac003(0x126)]['height']=_0x1ac003(0xf8),messageInput[_0x1ac003(0x126)]['height']=Math[_0x1ac003(0x101)](messageInput[_0x1ac003(0x11f)],0x78)+'px';}function updateSendButton(){const _0x47279b=a0_0x50d586,_0x295868=messageInput['value'][_0x47279b(0xdc)]();sendBtn[_0x47279b(0xcf)]=!_0x295868||isTyping;}async function sendMessage(){const _0x51811b=a0_0x50d586,_0x2b52c7=messageInput['value']['trim']();if(!_0x2b52c7||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x51811b(0x106)][_0x51811b(0x12c)](_0x51811b(0xb6));messages['push']({'role':_0x51811b(0x115),'content':_0x2b52c7,'timestamp':Date[_0x51811b(0xe0)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x51811b(0xec)](messages)),renderMessages(),messageInput[_0x51811b(0xff)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x51811b(0xfa)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x51811b(0x11f)];const _0x37e502=await callBackend(_0x51811b(0xf1),{'message':_0x2b52c7});isTyping=![];const _0x1a9463=document['getElementById'](_0x51811b(0x11a));if(_0x1a9463)_0x1a9463[_0x51811b(0x105)]();let _0x3007eb=_0x51811b(0xf2);if(_0x37e502[_0x51811b(0xfe)]){_0x3007eb=_0x37e502[_0x51811b(0xb8)]||_0x51811b(0xbc);if(tg?.[_0x51811b(0x106)])tg[_0x51811b(0x106)][_0x51811b(0x112)](_0x51811b(0xfe));}else{_0x3007eb=_0x37e502[_0x51811b(0xd2)]||_0x51811b(0x11e);if(tg?.[_0x51811b(0x106)])tg[_0x51811b(0x106)][_0x51811b(0x112)](_0x51811b(0xd2));}messages[_0x51811b(0xcb)]({'role':'ai','content':_0x3007eb,'timestamp':Date[_0x51811b(0xe0)]()}),localStorage[_0x51811b(0xc2)]('ai_chat_messages',JSON[_0x51811b(0xec)](messages)),renderMessages();}function confirmDelete(_0x46227f){const _0xe5534b=a0_0x50d586;if(mTitle)mTitle[_0xe5534b(0xc9)]=_0xe5534b(0x12a);if(mText)mText[_0xe5534b(0xc9)]=_0xe5534b(0xe8);modalCallback=()=>{const _0x5077e4=_0xe5534b;messages[_0x5077e4(0x10a)](_0x46227f,0x1),localStorage[_0x5077e4(0xc2)]('ai_chat_messages',JSON[_0x5077e4(0xec)](messages)),renderMessages();},modal['classList'][_0xe5534b(0x117)]('show');}if(clearBtn)clearBtn[a0_0x50d586(0xd1)]=()=>{const _0x381116=a0_0x50d586;if(!messages['length'])return;if(mTitle)mTitle[_0x381116(0xc9)]='Очистить\x20историю?';if(mText)mText[_0x381116(0xc9)]=_0x381116(0xf4);modalCallback=async()=>{const _0x2e199f=_0x381116;messages=[],localStorage[_0x2e199f(0xb4)](_0x2e199f(0x134)),renderMessages(),callBackend(_0x2e199f(0x129),{});},modal['classList'][_0x381116(0x117)](_0x381116(0xfc));};document[a0_0x50d586(0xd4)](a0_0x50d586(0x121))[a0_0x50d586(0xd1)]=()=>modal['classList'][a0_0x50d586(0x105)](a0_0x50d586(0xfc)),document['getElementById'](a0_0x50d586(0x131))['onclick']=()=>{const _0x4c8b55=a0_0x50d586;if(modalCallback)modalCallback();modal[_0x4c8b55(0xe4)][_0x4c8b55(0x105)](_0x4c8b55(0xfc));},messageInput[a0_0x50d586(0xb3)](a0_0x50d586(0xe6),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x50d586(0xb3)](a0_0x50d586(0xba),_0x54870c=>{const _0x1a458c=a0_0x50d586;_0x54870c[_0x1a458c(0xc8)]===_0x1a458c(0x111)&&!_0x54870c[_0x1a458c(0x128)]&&(_0x54870c[_0x1a458c(0xd7)](),sendMessage());}),sendBtn[a0_0x50d586(0xd1)]=sendMessage,document[a0_0x50d586(0xb3)]('click',_0xb7081e=>{const _0x40f4ab=a0_0x50d586;document['querySelectorAll'](_0x40f4ab(0x136))[_0x40f4ab(0x124)](_0x37060e=>{const _0x5abfec=_0x40f4ab;if(!_0x37060e[_0x5abfec(0xee)](_0xb7081e[_0x5abfec(0xf0)]))_0x37060e[_0x5abfec(0xe4)][_0x5abfec(0x105)]('show-delete');});});const saved=localStorage['getItem'](a0_0x50d586(0x134));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x5541b1){}updateSendButton();