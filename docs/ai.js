const a0_0x29e5b8=a0_0x1fa5;(function(_0x328475,_0xb85113){const _0x4c42b4=a0_0x1fa5,_0x4d73b7=_0x328475();while(!![]){try{const _0x5d64a5=parseInt(_0x4c42b4(0x15f))/0x1*(-parseInt(_0x4c42b4(0x12f))/0x2)+-parseInt(_0x4c42b4(0x133))/0x3*(-parseInt(_0x4c42b4(0x157))/0x4)+-parseInt(_0x4c42b4(0x179))/0x5+-parseInt(_0x4c42b4(0x13a))/0x6*(parseInt(_0x4c42b4(0x193))/0x7)+-parseInt(_0x4c42b4(0x151))/0x8*(-parseInt(_0x4c42b4(0x13e))/0x9)+parseInt(_0x4c42b4(0x1a0))/0xa*(-parseInt(_0x4c42b4(0x192))/0xb)+parseInt(_0x4c42b4(0x170))/0xc;if(_0x5d64a5===_0xb85113)break;else _0x4d73b7['push'](_0x4d73b7['shift']());}catch(_0x2d14d5){_0x4d73b7['push'](_0x4d73b7['shift']());}}}(a0_0x3ea9,0x33f57));const tg=window[a0_0x29e5b8(0x169)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x539f6a=a0_0x29e5b8,_0x1c8b77=(function(){let _0x179086=!![];return function(_0x3da65e,_0x260b2b){const _0x5c9752=_0x179086?function(){if(_0x260b2b){const _0x51edee=_0x260b2b['apply'](_0x3da65e,arguments);return _0x260b2b=null,_0x51edee;}}:function(){};return _0x179086=![],_0x5c9752;};}()),_0x4ee866=_0x1c8b77(this,function(){const _0x662584=a0_0x1fa5;return _0x4ee866[_0x662584(0x12a)]()[_0x662584(0x19a)]('(((.+)+)+)+$')[_0x662584(0x12a)]()[_0x662584(0x17d)](_0x4ee866)['search']('(((.+)+)+)+$');});_0x4ee866();if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x539f6a(0x149)]?.(_0x539f6a(0x14e));if(tg[_0x539f6a(0x196)]?.('6.1'))tg[_0x539f6a(0x131)]?.();const _0x37d443=tg[_0x539f6a(0x18b)];if(_0x37d443){_0x37d443['show']();if(typeof _0x37d443[_0x539f6a(0x12e)]==='function')try{_0x37d443[_0x539f6a(0x12e)]();}catch(_0x7027c){}_0x37d443[_0x539f6a(0x148)](()=>{const _0x276686=_0x539f6a;if(tg[_0x276686(0x19f)])tg[_0x276686(0x19f)][_0x276686(0x132)](_0x276686(0x174));location[_0x276686(0x139)]=HOME_URL;});}}catch(_0x3e636a){console[_0x539f6a(0x186)]('TG\x20setup\x20error:',_0x3e636a);}}(function initStableLayout(){const _0x21054c=a0_0x29e5b8,_0x32a26e=document[_0x21054c(0x14d)](_0x21054c(0x127)),_0x26755f=document[_0x21054c(0x162)](_0x21054c(0x185)),_0x57451c=document[_0x21054c(0x162)](_0x21054c(0x18a)),_0x51dce8=document[_0x21054c(0x162)](_0x21054c(0x138));function _0x5cf892(){const _0x132ab3=_0x21054c;if(!_0x32a26e)return;const _0x37fd4f=tg&&tg[_0x132ab3(0x17b)]?tg[_0x132ab3(0x17b)]:window['innerHeight'];_0x32a26e[_0x132ab3(0x16d)][_0x132ab3(0x1a2)]=_0x37fd4f+'px';if(_0x26755f){const _0x116ad2=_0x26755f[_0x132ab3(0x120)];_0x57451c['style']['paddingBottom']=_0x116ad2+0x28+'px';}}tg?tg[_0x21054c(0x130)](_0x21054c(0x187),({isStateStable:_0x3ab02f})=>{_0x5cf892();if(_0x3ab02f)requestAnimationFrame(()=>{const _0x3d20b3=a0_0x1fa5;_0x57451c[_0x3d20b3(0x128)]=_0x57451c['scrollHeight'];});}):window[_0x21054c(0x135)]('resize',_0x5cf892),_0x5cf892(),_0x51dce8&&(_0x51dce8[_0x21054c(0x135)]('input',()=>{requestAnimationFrame(_0x5cf892);}),_0x51dce8[_0x21054c(0x135)](_0x21054c(0x146),()=>{setTimeout(()=>{const _0x160bd2=a0_0x1fa5;_0x57451c[_0x160bd2(0x128)]=_0x57451c['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x29e5b8(0x18a)),emptyState=document['getElementById'](a0_0x29e5b8(0x18c)),messageInput=document[a0_0x29e5b8(0x162)](a0_0x29e5b8(0x138)),sendBtn=document[a0_0x29e5b8(0x162)](a0_0x29e5b8(0x18f)),clearBtn=document['getElementById'](a0_0x29e5b8(0x13f)),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0x29e5b8(0x162)](a0_0x29e5b8(0x13c)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x5d0201,_0x58e4e1){const _0x24b8d4=a0_0x29e5b8,_0x3433de=tg?.[_0x24b8d4(0x121)]?.[_0x24b8d4(0x15e)]||{},_0x2b2e9a=_0x3433de['id']||localStorage['getItem'](_0x24b8d4(0x183))||'d-'+Math[_0x24b8d4(0x161)](Math[_0x24b8d4(0x18e)]()*0x3b9aca00);if(!_0x3433de['id'])localStorage[_0x24b8d4(0x16e)](_0x24b8d4(0x183),_0x2b2e9a);const _0x2c665b={'action':_0x5d0201,'user_id':_0x2b2e9a,'user_data':{'first_name':_0x3433de[_0x24b8d4(0x144)],'username':_0x3433de[_0x24b8d4(0x11f)]},'init_data':tg?.[_0x24b8d4(0x19e)]||'',..._0x58e4e1},_0x5c062d=new AbortController(),_0x1be628=setTimeout(()=>_0x5c062d[_0x24b8d4(0x15a)](),REQUEST_TIMEOUT_MS);try{const _0x29d588=await fetch(BACKEND_URL,{'method':_0x24b8d4(0x14f),'headers':{'Content-Type':_0x24b8d4(0x163)},'body':JSON['stringify'](_0x2c665b),'signal':_0x5c062d[_0x24b8d4(0x126)]});return clearTimeout(_0x1be628),await _0x29d588['json']();}catch(_0x44a2f8){return{'success':![],'error':String(_0x44a2f8)};}}function formatTime(_0x4e1a03){const _0x10a498=a0_0x29e5b8,_0x7e499e=new Date(_0x4e1a03);return String(_0x7e499e[_0x10a498(0x14c)]())[_0x10a498(0x17c)](0x2,'0')+':'+String(_0x7e499e[_0x10a498(0x177)]())[_0x10a498(0x17c)](0x2,'0');}function createMessageElement(_0x4546db,_0x579170){const _0x5e9b2e=a0_0x29e5b8,_0x14612e=document[_0x5e9b2e(0x12c)](_0x5e9b2e(0x155));_0x14612e[_0x5e9b2e(0x195)]=_0x5e9b2e(0x17a)+_0x4546db[_0x5e9b2e(0x15b)];const _0x5b2cae=document[_0x5e9b2e(0x12c)]('div');_0x5b2cae['className']=_0x5e9b2e(0x140),_0x5b2cae['innerHTML']=_0x4546db['content'][_0x5e9b2e(0x199)](/\n/g,_0x5e9b2e(0x194));const _0x2cbdd7=document[_0x5e9b2e(0x12c)](_0x5e9b2e(0x155));_0x2cbdd7[_0x5e9b2e(0x195)]=_0x5e9b2e(0x167),_0x2cbdd7[_0x5e9b2e(0x12d)]=_0x5e9b2e(0x181),_0x2cbdd7[_0x5e9b2e(0x150)]=_0x43ba11=>{const _0x47100f=_0x5e9b2e;_0x43ba11[_0x47100f(0x173)](),confirmDelete(_0x579170);};let _0x40e053;_0x5b2cae[_0x5e9b2e(0x135)](_0x5e9b2e(0x19b),()=>_0x40e053=setTimeout(()=>{const _0x5eb6b4=_0x5e9b2e;_0x14612e['classList'][_0x5eb6b4(0x168)](_0x5eb6b4(0x18d));if(tg?.[_0x5eb6b4(0x19f)])tg[_0x5eb6b4(0x19f)][_0x5eb6b4(0x132)](_0x5eb6b4(0x16b));},0x1f4)),_0x5b2cae[_0x5e9b2e(0x135)](_0x5e9b2e(0x153),()=>clearTimeout(_0x40e053));const _0x447010=document['createElement'](_0x5e9b2e(0x155));return _0x447010[_0x5e9b2e(0x195)]=_0x5e9b2e(0x160),_0x447010['textContent']=formatTime(_0x4546db[_0x5e9b2e(0x17e)]),_0x14612e['appendChild'](_0x2cbdd7),_0x14612e['appendChild'](_0x5b2cae),_0x14612e['appendChild'](_0x447010),_0x14612e;}function createTypingIndicator(){const _0x320d8e=a0_0x29e5b8,_0xb928db=document[_0x320d8e(0x12c)](_0x320d8e(0x155));return _0xb928db[_0x320d8e(0x195)]=_0x320d8e(0x19d),_0xb928db['id']=_0x320d8e(0x125),_0xb928db[_0x320d8e(0x12d)]=_0x320d8e(0x17f),_0xb928db;}function renderMessages(){const _0x274d89=a0_0x29e5b8;Array[_0x274d89(0x191)](chatArea[_0x274d89(0x188)])[_0x274d89(0x158)](_0x25ace9=>{const _0x3bc43c=_0x274d89;if(_0x25ace9['id']!=='emptyState')_0x25ace9[_0x3bc43c(0x164)]();}),messages[_0x274d89(0x134)]>0x0?(emptyState[_0x274d89(0x16d)][_0x274d89(0x197)]='none',messages[_0x274d89(0x158)]((_0x5decae,_0x34a222)=>chatArea[_0x274d89(0x198)](createMessageElement(_0x5decae,_0x34a222)))):emptyState[_0x274d89(0x16d)][_0x274d89(0x197)]=_0x274d89(0x16c),requestAnimationFrame(()=>chatArea[_0x274d89(0x128)]=chatArea[_0x274d89(0x178)]);}function autoResizeTextarea(){const _0x1a4221=a0_0x29e5b8;messageInput[_0x1a4221(0x16d)]['height']=_0x1a4221(0x12b),messageInput[_0x1a4221(0x16d)]['height']=Math[_0x1a4221(0x15c)](messageInput[_0x1a4221(0x178)],0x78)+'px';}function updateSendButton(){const _0xe68770=a0_0x29e5b8,_0x265e4d=messageInput[_0xe68770(0x16f)][_0xe68770(0x14a)]();sendBtn[_0xe68770(0x190)]=!_0x265e4d||isTyping;}async function sendMessage(){const _0x3276f0=a0_0x29e5b8,_0x97511d=messageInput[_0x3276f0(0x16f)]['trim']();if(!_0x97511d||isTyping)return;if(tg?.[_0x3276f0(0x19f)])tg[_0x3276f0(0x19f)][_0x3276f0(0x132)]('light');messages[_0x3276f0(0x172)]({'role':'user','content':_0x97511d,'timestamp':Date[_0x3276f0(0x142)]()}),localStorage['setItem'](_0x3276f0(0x14b),JSON['stringify'](messages)),renderMessages(),messageInput[_0x3276f0(0x16f)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x3276f0(0x198)](createTypingIndicator()),chatArea[_0x3276f0(0x128)]=chatArea[_0x3276f0(0x178)];const _0x393d57=await callBackend(_0x3276f0(0x141),{'message':_0x97511d});isTyping=![];const _0x259d1e=document['getElementById'](_0x3276f0(0x125));if(_0x259d1e)_0x259d1e[_0x3276f0(0x164)]();let _0x5cc245=_0x3276f0(0x19c);if(_0x393d57['success']){_0x5cc245=_0x393d57[_0x3276f0(0x159)]||'Пустой\x20ответ';if(tg?.[_0x3276f0(0x19f)])tg[_0x3276f0(0x19f)][_0x3276f0(0x154)]('success');}else{_0x5cc245=_0x393d57['error']||_0x3276f0(0x166);if(tg?.[_0x3276f0(0x19f)])tg['HapticFeedback']['notificationOccurred'](_0x3276f0(0x165));}messages[_0x3276f0(0x172)]({'role':'ai','content':_0x5cc245,'timestamp':Date[_0x3276f0(0x142)]()}),localStorage['setItem'](_0x3276f0(0x14b),JSON[_0x3276f0(0x122)](messages)),renderMessages();}function a0_0x3ea9(){const _0x4c6ee5=['addEventListener','querySelectorAll','shiftKey','messageInput','href','724506UBUIDQ','splice','modalTitle','removeItem','458037XvGMNs','clearBtn','message-bubble','send_message','now','modalConfirm','first_name','Начнется\x20новый\x20диалог.','focus','getItem','onClick','setHeaderColor','trim','ai_chat_messages','getHours','querySelector','#050505','POST','onclick','16AOYyzD','modalCancel','touchend','notificationOccurred','div','classList','32oIqMWX','forEach','text','abort','role','min','click','user','1jhxGdo','message-time','floor','getElementById','text/plain','remove','error','Ошибка\x20сервера','delete-btn','add','Telegram','key','medium','flex','style','setItem','value','2240892WBFPmr','Очистить\x20историю?','push','stopPropagation','light','textContent','input','getMinutes','scrollHeight','196860SDwvea','message\x20','viewportHeight','padStart','constructor','timestamp','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','Действие\x20необратимо.','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','preventDefault','debug_uid','contains','inputArea','warn','viewportChanged','children','show','chatArea','BackButton','emptyState','show-delete','random','sendBtn','disabled','from','1639957eHwqvQ','7AiGgaY','<br>','className','isVersionAtLeast','display','appendChild','replace','search','touchstart','Ошибка\x20сети','message\x20ai','initData','HapticFeedback','10WIwlQi','.message.show-delete','height','username','offsetHeight','initDataUnsafe','stringify','Enter','parse','typingIndicator','signal','.container','scrollTop','target','toString','auto','createElement','innerHTML','offClick','137212XJFSxm','onEvent','disableVerticalSwipes','impactOccurred','113292ZevRnK','length'];a0_0x3ea9=function(){return _0x4c6ee5;};return a0_0x3ea9();}function confirmDelete(_0x48e2ef){const _0x86f2ce=a0_0x29e5b8;if(mTitle)mTitle[_0x86f2ce(0x175)]='Удалить?';if(mText)mText['textContent']=_0x86f2ce(0x180);modalCallback=()=>{const _0x354e59=_0x86f2ce;messages[_0x354e59(0x13b)](_0x48e2ef,0x1),localStorage['setItem'](_0x354e59(0x14b),JSON[_0x354e59(0x122)](messages)),renderMessages();},modal[_0x86f2ce(0x156)][_0x86f2ce(0x168)]('show');}function a0_0x1fa5(_0x4650cd,_0x676906){_0x4650cd=_0x4650cd-0x11f;const _0x596a2a=a0_0x3ea9();let _0x4ed344=_0x596a2a[_0x4650cd];return _0x4ed344;}if(clearBtn)clearBtn[a0_0x29e5b8(0x150)]=()=>{const _0x225c7d=a0_0x29e5b8;if(!messages[_0x225c7d(0x134)])return;if(mTitle)mTitle[_0x225c7d(0x175)]=_0x225c7d(0x171);if(mText)mText['textContent']=_0x225c7d(0x145);modalCallback=async()=>{const _0x36dd13=_0x225c7d;messages=[],localStorage[_0x36dd13(0x13d)](_0x36dd13(0x14b)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x225c7d(0x168)](_0x225c7d(0x189));};document[a0_0x29e5b8(0x162)](a0_0x29e5b8(0x152))[a0_0x29e5b8(0x150)]=()=>modal[a0_0x29e5b8(0x156)][a0_0x29e5b8(0x164)](a0_0x29e5b8(0x189)),document['getElementById'](a0_0x29e5b8(0x143))[a0_0x29e5b8(0x150)]=()=>{const _0x350ca6=a0_0x29e5b8;if(modalCallback)modalCallback();modal['classList'][_0x350ca6(0x164)](_0x350ca6(0x189));},messageInput['addEventListener'](a0_0x29e5b8(0x176),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x3f329f=>{const _0x34afb4=a0_0x29e5b8;_0x3f329f[_0x34afb4(0x16a)]===_0x34afb4(0x123)&&!_0x3f329f[_0x34afb4(0x137)]&&(_0x3f329f[_0x34afb4(0x182)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x29e5b8(0x135)](a0_0x29e5b8(0x15d),_0x514653=>{const _0x39d28c=a0_0x29e5b8;document[_0x39d28c(0x136)](_0x39d28c(0x1a1))[_0x39d28c(0x158)](_0x2383cf=>{const _0x465a3e=_0x39d28c;if(!_0x2383cf[_0x465a3e(0x184)](_0x514653[_0x465a3e(0x129)]))_0x2383cf[_0x465a3e(0x156)]['remove']('show-delete');});});const saved=localStorage[a0_0x29e5b8(0x147)](a0_0x29e5b8(0x14b));if(saved)try{messages=JSON[a0_0x29e5b8(0x124)](saved),renderMessages();}catch(a0_0x15939b){}updateSendButton();