const a0_0xdba820=a0_0x4862;(function(_0x41dee2,_0x31397d){const _0x2d150b=a0_0x4862,_0x2ea210=_0x41dee2();while(!![]){try{const _0x483eb8=parseInt(_0x2d150b(0x166))/0x1*(-parseInt(_0x2d150b(0x149))/0x2)+-parseInt(_0x2d150b(0x1a2))/0x3*(parseInt(_0x2d150b(0x156))/0x4)+parseInt(_0x2d150b(0x176))/0x5+-parseInt(_0x2d150b(0x14e))/0x6+-parseInt(_0x2d150b(0x1ac))/0x7*(-parseInt(_0x2d150b(0x14c))/0x8)+-parseInt(_0x2d150b(0x1a9))/0x9+parseInt(_0x2d150b(0x17b))/0xa;if(_0x483eb8===_0x31397d)break;else _0x2ea210['push'](_0x2ea210['shift']());}catch(_0x561fe0){_0x2ea210['push'](_0x2ea210['shift']());}}}(a0_0x4a70,0x7a6e7));const tg=window[a0_0xdba820(0x17a)]?.['WebApp'],HOME_URL=a0_0xdba820(0x18d);function setupTelegramBackButton(){const _0x5b3398=a0_0xdba820;if(!tg)return;try{tg['ready'](),tg[_0x5b3398(0x1b1)](),tg[_0x5b3398(0x15d)]?.(_0x5b3398(0x174));if(tg[_0x5b3398(0x150)]?.(_0x5b3398(0x18b)))tg[_0x5b3398(0x188)]?.();const _0x44b3bd=tg[_0x5b3398(0x1af)];if(_0x44b3bd){_0x44b3bd['show']();if(typeof _0x44b3bd[_0x5b3398(0x19e)]===_0x5b3398(0x1be))try{_0x44b3bd[_0x5b3398(0x19e)]();}catch(_0x492fa4){}_0x44b3bd[_0x5b3398(0x160)](()=>{const _0x4ae9d5=_0x5b3398;if(tg[_0x4ae9d5(0x19a)])tg[_0x4ae9d5(0x19a)][_0x4ae9d5(0x170)](_0x4ae9d5(0x183));location[_0x4ae9d5(0x15f)]=HOME_URL;});}}catch(_0x31dc3c){console[_0x5b3398(0x1aa)](_0x5b3398(0x168),_0x31dc3c);}}function a0_0x4a70(){const _0x4a5f6e=['stringify','ai_chat_messages','classList','clearBtn','setItem','preventDefault','8480XMHeZF','Действие\x20необратимо.','signal','7937464osfQDo','paddingBottom','3246864KASrBx','parse','isVersionAtLeast','from','push','textContent','input','timestamp','28928qsDsfo','floor','message-time','emptyState','Ошибка\x20сервера','appendChild','messageInput','setHeaderColor','now','href','onClick','POST','notificationOccurred','clear_history','scrollTop','key','218SExamq','.message.show-delete','TG\x20setup\x20error:','addEventListener','chatArea','focus','username','children','style','touchend','impactOccurred','content','length','createElement','#050505','modalText','2283905TdBEMa','random','add','success','Telegram','20407580NlzeSO','forEach','modalTitle','delete-btn','min','first_name','querySelector','getHours','light','keydown','inputArea','<br>','padStart','disableVerticalSwipes','Пустой\x20ответ','removeItem','6.1','text','./router.html','getElementById','(((.+)+)+)+$','className','getItem','viewportChanged','scrollHeight','user','flex','viewportHeight','div','remove','value','HapticFeedback','onclick','constructor','display','offClick','role','error','replace','291OYtHOb','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Enter','none','medium','toString','apply','7391475NBOHsi','warn','touchstart','7jOsCxv','target','shiftKey','BackButton','height','expand','onEvent','sendBtn','message-bubble','splice','stopPropagation','search','contains','show','modalCancel','json','innerHTML','.container','function'];a0_0x4a70=function(){return _0x4a5f6e;};return a0_0x4a70();}function a0_0x4862(_0x558884,_0x28d8b0){_0x558884=_0x558884-0x146;const _0x6b963e=a0_0x4a70();let _0x33241c=_0x6b963e[_0x558884];return _0x33241c;}(function initStableLayout(){const _0x132909=a0_0xdba820,_0x3cd7ba=(function(){let _0x57c31e=!![];return function(_0x345a73,_0x1c0495){const _0x2aa81b=_0x57c31e?function(){const _0x21b528=a0_0x4862;if(_0x1c0495){const _0x427e8d=_0x1c0495[_0x21b528(0x1a8)](_0x345a73,arguments);return _0x1c0495=null,_0x427e8d;}}:function(){};return _0x57c31e=![],_0x2aa81b;};}()),_0x1cb1df=document[_0x132909(0x181)](_0x132909(0x1bd)),_0x5ecb60=document[_0x132909(0x18e)](_0x132909(0x185)),_0x3a5827=document[_0x132909(0x18e)](_0x132909(0x16a)),_0xb1b2d4=document[_0x132909(0x18e)](_0x132909(0x15c));function _0x3afe3e(){const _0x5f4450=_0x132909,_0x507377=_0x3cd7ba(this,function(){const _0x5ecf12=a0_0x4862;return _0x507377[_0x5ecf12(0x1a7)]()['search'](_0x5ecf12(0x18f))['toString']()[_0x5ecf12(0x19c)](_0x507377)[_0x5ecf12(0x1b7)](_0x5ecf12(0x18f));});_0x507377();if(!_0x1cb1df)return;const _0x2a46ed=tg&&tg[_0x5f4450(0x196)]?tg[_0x5f4450(0x196)]:window['innerHeight'];_0x1cb1df['style'][_0x5f4450(0x1b0)]=_0x2a46ed+'px';if(_0x5ecb60){const _0x31ea68=_0x5ecb60['offsetHeight'];_0x3a5827[_0x5f4450(0x16e)][_0x5f4450(0x14d)]=_0x31ea68+0x28+'px';}}tg?tg[_0x132909(0x1b2)](_0x132909(0x192),({isStateStable:_0x3d9ca7})=>{_0x3afe3e();if(_0x3d9ca7)requestAnimationFrame(()=>{const _0x1e2097=a0_0x4862;_0x3a5827[_0x1e2097(0x164)]=_0x3a5827['scrollHeight'];});}):window['addEventListener']('resize',_0x3afe3e),_0x3afe3e(),_0xb1b2d4&&(_0xb1b2d4[_0x132909(0x169)](_0x132909(0x154),()=>{requestAnimationFrame(_0x3afe3e);}),_0xb1b2d4[_0x132909(0x169)](_0x132909(0x16b),()=>{setTimeout(()=>{const _0x4cb36d=a0_0x4862;_0x3a5827['scrollTop']=_0x3a5827[_0x4cb36d(0x193)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xdba820(0x1a3),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xdba820(0x18e)](a0_0xdba820(0x16a)),emptyState=document[a0_0xdba820(0x18e)](a0_0xdba820(0x159)),messageInput=document[a0_0xdba820(0x18e)](a0_0xdba820(0x15c)),sendBtn=document[a0_0xdba820(0x18e)](a0_0xdba820(0x1b3)),clearBtn=document[a0_0xdba820(0x18e)](a0_0xdba820(0x146)),modal=document[a0_0xdba820(0x18e)]('confirmModal'),mTitle=document[a0_0xdba820(0x18e)](a0_0xdba820(0x17d)),mText=document[a0_0xdba820(0x18e)](a0_0xdba820(0x175));let modalCallback=null;async function callBackend(_0xda654b,_0x101dfe){const _0x2ad187=a0_0xdba820,_0x454eb7=tg?.['initDataUnsafe']?.[_0x2ad187(0x194)]||{},_0x13c634=_0x454eb7['id']||localStorage[_0x2ad187(0x191)]('debug_uid')||'d-'+Math[_0x2ad187(0x157)](Math[_0x2ad187(0x177)]()*0x3b9aca00);if(!_0x454eb7['id'])localStorage[_0x2ad187(0x147)]('debug_uid',_0x13c634);const _0x40980a={'action':_0xda654b,'user_id':_0x13c634,'user_data':{'first_name':_0x454eb7[_0x2ad187(0x180)],'username':_0x454eb7[_0x2ad187(0x16c)]},'init_data':tg?.['initData']||'',..._0x101dfe},_0x1fb93e=new AbortController(),_0x3388d9=setTimeout(()=>_0x1fb93e['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3bc322=await fetch(BACKEND_URL,{'method':_0x2ad187(0x161),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x2ad187(0x1bf)](_0x40980a),'signal':_0x1fb93e[_0x2ad187(0x14b)]});return clearTimeout(_0x3388d9),await _0x3bc322[_0x2ad187(0x1bb)]();}catch(_0x3c9ce1){return{'success':![],'error':String(_0x3c9ce1)};}}function formatTime(_0x164373){const _0x375a41=a0_0xdba820,_0x321129=new Date(_0x164373);return String(_0x321129[_0x375a41(0x182)]())['padStart'](0x2,'0')+':'+String(_0x321129['getMinutes']())[_0x375a41(0x187)](0x2,'0');}function createMessageElement(_0x42d9e7,_0x49c49b){const _0x48f967=a0_0xdba820,_0x3c1822=document[_0x48f967(0x173)](_0x48f967(0x197));_0x3c1822[_0x48f967(0x190)]='message\x20'+_0x42d9e7[_0x48f967(0x19f)];const _0x26b3b3=document[_0x48f967(0x173)]('div');_0x26b3b3['className']=_0x48f967(0x1b4),_0x26b3b3[_0x48f967(0x1bc)]=_0x42d9e7[_0x48f967(0x171)][_0x48f967(0x1a1)](/\n/g,_0x48f967(0x186));const _0x590f34=document[_0x48f967(0x173)](_0x48f967(0x197));_0x590f34[_0x48f967(0x190)]=_0x48f967(0x17e),_0x590f34['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x590f34['onclick']=_0x28404b=>{const _0x215b75=_0x48f967;_0x28404b[_0x215b75(0x1b6)](),confirmDelete(_0x49c49b);};let _0x5d04e8;_0x26b3b3['addEventListener'](_0x48f967(0x1ab),()=>_0x5d04e8=setTimeout(()=>{const _0x535e4a=_0x48f967;_0x3c1822['classList']['add']('show-delete');if(tg?.['HapticFeedback'])tg[_0x535e4a(0x19a)][_0x535e4a(0x170)](_0x535e4a(0x1a6));},0x1f4)),_0x26b3b3[_0x48f967(0x169)](_0x48f967(0x16f),()=>clearTimeout(_0x5d04e8));const _0x39cc03=document[_0x48f967(0x173)](_0x48f967(0x197));return _0x39cc03['className']=_0x48f967(0x158),_0x39cc03[_0x48f967(0x153)]=formatTime(_0x42d9e7[_0x48f967(0x155)]),_0x3c1822[_0x48f967(0x15b)](_0x590f34),_0x3c1822['appendChild'](_0x26b3b3),_0x3c1822[_0x48f967(0x15b)](_0x39cc03),_0x3c1822;}function createTypingIndicator(){const _0x397fbe=a0_0xdba820,_0x58f4f2=document['createElement'](_0x397fbe(0x197));return _0x58f4f2[_0x397fbe(0x190)]='message\x20ai',_0x58f4f2['id']='typingIndicator',_0x58f4f2[_0x397fbe(0x1bc)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x58f4f2;}function renderMessages(){const _0x214671=a0_0xdba820;Array[_0x214671(0x151)](chatArea[_0x214671(0x16d)])[_0x214671(0x17c)](_0x343e24=>{const _0x3cde1a=_0x214671;if(_0x343e24['id']!==_0x3cde1a(0x159))_0x343e24[_0x3cde1a(0x198)]();}),messages['length']>0x0?(emptyState[_0x214671(0x16e)]['display']=_0x214671(0x1a5),messages[_0x214671(0x17c)]((_0x5549b7,_0x3657a4)=>chatArea[_0x214671(0x15b)](createMessageElement(_0x5549b7,_0x3657a4)))):emptyState[_0x214671(0x16e)][_0x214671(0x19d)]=_0x214671(0x195),requestAnimationFrame(()=>chatArea[_0x214671(0x164)]=chatArea[_0x214671(0x193)]);}function autoResizeTextarea(){const _0x391f2f=a0_0xdba820;messageInput['style'][_0x391f2f(0x1b0)]='auto',messageInput['style'][_0x391f2f(0x1b0)]=Math[_0x391f2f(0x17f)](messageInput[_0x391f2f(0x193)],0x78)+'px';}function updateSendButton(){const _0x382355=a0_0xdba820,_0x524b3d=messageInput[_0x382355(0x199)]['trim']();sendBtn['disabled']=!_0x524b3d||isTyping;}async function sendMessage(){const _0x2eac5b=a0_0xdba820,_0xfe1dd6=messageInput[_0x2eac5b(0x199)]['trim']();if(!_0xfe1dd6||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2eac5b(0x19a)][_0x2eac5b(0x170)](_0x2eac5b(0x183));messages[_0x2eac5b(0x152)]({'role':_0x2eac5b(0x194),'content':_0xfe1dd6,'timestamp':Date[_0x2eac5b(0x15e)]()}),localStorage['setItem'](_0x2eac5b(0x1c0),JSON[_0x2eac5b(0x1bf)](messages)),renderMessages(),messageInput[_0x2eac5b(0x199)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x2eac5b(0x193)];const _0x87d19e=await callBackend('send_message',{'message':_0xfe1dd6});isTyping=![];const _0x56adfa=document['getElementById']('typingIndicator');if(_0x56adfa)_0x56adfa[_0x2eac5b(0x198)]();let _0x560a='Ошибка\x20сети';if(_0x87d19e[_0x2eac5b(0x179)]){_0x560a=_0x87d19e[_0x2eac5b(0x18c)]||_0x2eac5b(0x189);if(tg?.[_0x2eac5b(0x19a)])tg[_0x2eac5b(0x19a)]['notificationOccurred'](_0x2eac5b(0x179));}else{_0x560a=_0x87d19e['error']||_0x2eac5b(0x15a);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x2eac5b(0x162)](_0x2eac5b(0x1a0));}messages[_0x2eac5b(0x152)]({'role':'ai','content':_0x560a,'timestamp':Date[_0x2eac5b(0x15e)]()}),localStorage[_0x2eac5b(0x147)](_0x2eac5b(0x1c0),JSON[_0x2eac5b(0x1bf)](messages)),renderMessages();}function confirmDelete(_0xb5e0d5){const _0x4d2231=a0_0xdba820;if(mTitle)mTitle[_0x4d2231(0x153)]='Удалить?';if(mText)mText[_0x4d2231(0x153)]=_0x4d2231(0x14a);modalCallback=()=>{const _0x48cb9=_0x4d2231;messages[_0x48cb9(0x1b5)](_0xb5e0d5,0x1),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x4d2231(0x1c1)][_0x4d2231(0x178)]('show');}if(clearBtn)clearBtn[a0_0xdba820(0x19b)]=()=>{const _0x29ea4e=a0_0xdba820;if(!messages[_0x29ea4e(0x172)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x29ea4e(0x153)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x2f136c=_0x29ea4e;messages=[],localStorage[_0x2f136c(0x18a)](_0x2f136c(0x1c0)),renderMessages(),callBackend(_0x2f136c(0x163),{});},modal['classList']['add'](_0x29ea4e(0x1b9));};document['getElementById'](a0_0xdba820(0x1ba))[a0_0xdba820(0x19b)]=()=>modal[a0_0xdba820(0x1c1)][a0_0xdba820(0x198)](a0_0xdba820(0x1b9)),document[a0_0xdba820(0x18e)]('modalConfirm')[a0_0xdba820(0x19b)]=()=>{const _0xbe856=a0_0xdba820;if(modalCallback)modalCallback();modal[_0xbe856(0x1c1)]['remove'](_0xbe856(0x1b9));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xdba820(0x169)](a0_0xdba820(0x184),_0x508ed1=>{const _0x3b6e1a=a0_0xdba820;_0x508ed1[_0x3b6e1a(0x165)]===_0x3b6e1a(0x1a4)&&!_0x508ed1[_0x3b6e1a(0x1ae)]&&(_0x508ed1[_0x3b6e1a(0x148)](),sendMessage());}),sendBtn[a0_0xdba820(0x19b)]=sendMessage,document['addEventListener']('click',_0xda4f1d=>{const _0x1a0872=a0_0xdba820;document['querySelectorAll'](_0x1a0872(0x167))[_0x1a0872(0x17c)](_0x5950d2=>{const _0x319533=_0x1a0872;if(!_0x5950d2[_0x319533(0x1b8)](_0xda4f1d[_0x319533(0x1ad)]))_0x5950d2[_0x319533(0x1c1)][_0x319533(0x198)]('show-delete');});});const saved=localStorage[a0_0xdba820(0x191)](a0_0xdba820(0x1c0));if(saved)try{messages=JSON[a0_0xdba820(0x14f)](saved),renderMessages();}catch(a0_0x3dfe5a){}updateSendButton();