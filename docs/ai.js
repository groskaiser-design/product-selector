const a0_0x49e696=a0_0x3757;(function(_0x368230,_0x408b53){const _0x5da327=a0_0x3757,_0x4de31d=_0x368230();while(!![]){try{const _0x35d635=parseInt(_0x5da327(0x16d))/0x1+-parseInt(_0x5da327(0x1a8))/0x2*(-parseInt(_0x5da327(0x1a0))/0x3)+parseInt(_0x5da327(0x159))/0x4+parseInt(_0x5da327(0x193))/0x5*(-parseInt(_0x5da327(0x1ac))/0x6)+parseInt(_0x5da327(0x15b))/0x7+-parseInt(_0x5da327(0x18d))/0x8+parseInt(_0x5da327(0x1b3))/0x9;if(_0x35d635===_0x408b53)break;else _0x4de31d['push'](_0x4de31d['shift']());}catch(_0x51bc28){_0x4de31d['push'](_0x4de31d['shift']());}}}(a0_0x1a02,0x5366c));const tg=window[a0_0x49e696(0x186)]?.[a0_0x49e696(0x18c)],HOME_URL=a0_0x49e696(0x15f);function setupTelegramBackButton(){const _0x21aecd=a0_0x49e696,_0x4fab6a=(function(){let _0x3cecf3=!![];return function(_0x28c8db,_0x4fb040){const _0x2295a2=_0x3cecf3?function(){const _0x346256=a0_0x3757;if(_0x4fb040){const _0x859033=_0x4fb040[_0x346256(0x1b0)](_0x28c8db,arguments);return _0x4fb040=null,_0x859033;}}:function(){};return _0x3cecf3=![],_0x2295a2;};}()),_0x295d4b=_0x4fab6a(this,function(){const _0x702c58=a0_0x3757;return _0x295d4b[_0x702c58(0x19c)]()[_0x702c58(0x160)]('(((.+)+)+)+$')['toString']()['constructor'](_0x295d4b)['search'](_0x702c58(0x188));});_0x295d4b();if(!tg)return;try{tg[_0x21aecd(0x1ba)](),tg[_0x21aecd(0x177)](),tg[_0x21aecd(0x18f)]?.('#050505');if(tg[_0x21aecd(0x185)]?.(_0x21aecd(0x155)))tg['disableVerticalSwipes']?.();const _0x22c23b=tg[_0x21aecd(0x1a1)];if(_0x22c23b){_0x22c23b[_0x21aecd(0x172)]();if(typeof _0x22c23b[_0x21aecd(0x1ae)]==='function')try{_0x22c23b[_0x21aecd(0x1ae)]();}catch(_0x485b81){}_0x22c23b[_0x21aecd(0x146)](()=>{const _0x4890dd=_0x21aecd;if(tg[_0x4890dd(0x190)])tg[_0x4890dd(0x190)][_0x4890dd(0x17b)](_0x4890dd(0x156));location[_0x4890dd(0x19f)]=HOME_URL;});}}catch(_0x5102da){console['warn'](_0x21aecd(0x195),_0x5102da);}}(function initStableLayout(){const _0x4db155=a0_0x49e696,_0x53bf78=document[_0x4db155(0x1b8)](_0x4db155(0x150)),_0x5977e1=document[_0x4db155(0x17f)](_0x4db155(0x199)),_0x230108=document['getElementById'](_0x4db155(0x165)),_0x304067=document[_0x4db155(0x17f)](_0x4db155(0x163));function _0x1de420(){const _0x126515=_0x4db155;if(!_0x53bf78)return;const _0x1b723e=tg&&tg[_0x126515(0x16e)]?tg[_0x126515(0x16e)]:window['innerHeight'];_0x53bf78[_0x126515(0x17e)][_0x126515(0x147)]=_0x1b723e+'px';if(_0x5977e1){const _0xbad7a7=_0x5977e1[_0x126515(0x189)];_0x230108[_0x126515(0x17e)]['paddingBottom']=_0xbad7a7+0x28+'px';}}tg?tg[_0x4db155(0x164)](_0x4db155(0x14a),({isStateStable:_0x1cd2b1})=>{_0x1de420();if(_0x1cd2b1)requestAnimationFrame(()=>{const _0x9c32b7=a0_0x3757;_0x230108[_0x9c32b7(0x1b9)]=_0x230108[_0x9c32b7(0x16f)];});}):window['addEventListener'](_0x4db155(0x1aa),_0x1de420),_0x1de420(),_0x304067&&(_0x304067[_0x4db155(0x14b)](_0x4db155(0x178),()=>{requestAnimationFrame(_0x1de420);}),_0x304067['addEventListener'](_0x4db155(0x1bb),()=>{setTimeout(()=>{const _0xb210e6=a0_0x3757;_0x230108[_0xb210e6(0x1b9)]=_0x230108[_0xb210e6(0x16f)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x49e696(0x1a3),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x49e696(0x17f)](a0_0x49e696(0x165)),emptyState=document['getElementById'](a0_0x49e696(0x19e)),messageInput=document['getElementById'](a0_0x49e696(0x163)),sendBtn=document[a0_0x49e696(0x17f)]('sendBtn'),clearBtn=document[a0_0x49e696(0x17f)](a0_0x49e696(0x192)),modal=document[a0_0x49e696(0x17f)](a0_0x49e696(0x143)),mTitle=document[a0_0x49e696(0x17f)]('modalTitle'),mText=document[a0_0x49e696(0x17f)](a0_0x49e696(0x176));let modalCallback=null;async function callBackend(_0x500050,_0xc8fba8){const _0x2bf541=a0_0x49e696,_0x16b86c=tg?.[_0x2bf541(0x18a)]?.['user']||{},_0x583af3=_0x16b86c['id']||localStorage[_0x2bf541(0x17d)](_0x2bf541(0x166))||'d-'+Math['floor'](Math[_0x2bf541(0x182)]()*0x3b9aca00);if(!_0x16b86c['id'])localStorage['setItem']('debug_uid',_0x583af3);const _0x589ee2={'action':_0x500050,'user_id':_0x583af3,'user_data':{'first_name':_0x16b86c[_0x2bf541(0x15c)],'username':_0x16b86c[_0x2bf541(0x145)]},'init_data':tg?.['initData']||'',..._0xc8fba8},_0x13ec7a=new AbortController(),_0x256d10=setTimeout(()=>_0x13ec7a[_0x2bf541(0x161)](),REQUEST_TIMEOUT_MS);try{const _0x1dca26=await fetch(BACKEND_URL,{'method':_0x2bf541(0x1b6),'headers':{'Content-Type':_0x2bf541(0x15a)},'body':JSON[_0x2bf541(0x16a)](_0x589ee2),'signal':_0x13ec7a[_0x2bf541(0x142)]});return clearTimeout(_0x256d10),await _0x1dca26[_0x2bf541(0x196)]();}catch(_0x156d63){return{'success':![],'error':String(_0x156d63)};}}function a0_0x3757(_0x125790,_0x4cf95c){_0x125790=_0x125790-0x141;const _0x4e83cb=a0_0x1a02();let _0x567ae3=_0x4e83cb[_0x125790];return _0x567ae3;}function formatTime(_0x1f6a4b){const _0x454ad6=a0_0x49e696,_0x518643=new Date(_0x1f6a4b);return String(_0x518643['getHours']())[_0x454ad6(0x184)](0x2,'0')+':'+String(_0x518643[_0x454ad6(0x197)]())[_0x454ad6(0x184)](0x2,'0');}function createMessageElement(_0x148a48,_0x5b5924){const _0x4c8f6b=a0_0x49e696,_0x2233cd=document['createElement'](_0x4c8f6b(0x14e));_0x2233cd['className']='message\x20'+_0x148a48[_0x4c8f6b(0x157)];const _0x376d26=document[_0x4c8f6b(0x1a5)](_0x4c8f6b(0x14e));_0x376d26[_0x4c8f6b(0x1be)]=_0x4c8f6b(0x180),_0x376d26['innerHTML']=_0x148a48['content'][_0x4c8f6b(0x16c)](/\n/g,'<br>');const _0x407018=document[_0x4c8f6b(0x1a5)]('div');_0x407018[_0x4c8f6b(0x1be)]='delete-btn',_0x407018[_0x4c8f6b(0x144)]=_0x4c8f6b(0x1ad),_0x407018[_0x4c8f6b(0x1b2)]=_0x5b615f=>{_0x5b615f['stopPropagation'](),confirmDelete(_0x5b5924);};let _0x28f818;_0x376d26['addEventListener'](_0x4c8f6b(0x16b),()=>_0x28f818=setTimeout(()=>{const _0x363d2a=_0x4c8f6b;_0x2233cd['classList'][_0x363d2a(0x187)]('show-delete');if(tg?.[_0x363d2a(0x190)])tg[_0x363d2a(0x190)][_0x363d2a(0x17b)](_0x363d2a(0x194));},0x1f4)),_0x376d26[_0x4c8f6b(0x14b)](_0x4c8f6b(0x19b),()=>clearTimeout(_0x28f818));const _0x5c99d5=document[_0x4c8f6b(0x1a5)]('div');return _0x5c99d5[_0x4c8f6b(0x1be)]=_0x4c8f6b(0x1af),_0x5c99d5[_0x4c8f6b(0x15d)]=formatTime(_0x148a48[_0x4c8f6b(0x1ab)]),_0x2233cd['appendChild'](_0x407018),_0x2233cd[_0x4c8f6b(0x1b4)](_0x376d26),_0x2233cd[_0x4c8f6b(0x1b4)](_0x5c99d5),_0x2233cd;}function createTypingIndicator(){const _0x38931f=a0_0x49e696,_0x303399=document[_0x38931f(0x1a5)](_0x38931f(0x14e));return _0x303399['className']=_0x38931f(0x19d),_0x303399['id']=_0x38931f(0x1bd),_0x303399['innerHTML']=_0x38931f(0x183),_0x303399;}function renderMessages(){const _0x41171e=a0_0x49e696;Array[_0x41171e(0x1a4)](chatArea[_0x41171e(0x14f)])[_0x41171e(0x14c)](_0x13f001=>{const _0xf85278=_0x41171e;if(_0x13f001['id']!==_0xf85278(0x19e))_0x13f001[_0xf85278(0x1a7)]();}),messages['length']>0x0?(emptyState['style'][_0x41171e(0x169)]=_0x41171e(0x17c),messages[_0x41171e(0x14c)]((_0x457902,_0xe69757)=>chatArea[_0x41171e(0x1b4)](createMessageElement(_0x457902,_0xe69757)))):emptyState[_0x41171e(0x17e)][_0x41171e(0x169)]=_0x41171e(0x151),requestAnimationFrame(()=>chatArea[_0x41171e(0x1b9)]=chatArea[_0x41171e(0x16f)]);}function a0_0x1a02(){const _0x138a8e=['push','ai_chat_messages','contains','6.1','light','role','now','912728RdnwZl','text/plain','2582076JgxpLA','first_name','textContent','target','./router.html','search','abort','modalCancel','messageInput','onEvent','chatArea','debug_uid','value','send_message','display','stringify','touchstart','replace','229725PobSfO','viewportHeight','scrollHeight','min','user','show','setItem','removeItem','querySelectorAll','modalText','expand','input','Enter','trim','impactOccurred','none','getItem','style','getElementById','message-bubble','keydown','random','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','padStart','isVersionAtLeast','Telegram','add','(((.+)+)+)+$','offsetHeight','initDataUnsafe','key','WebApp','836912euOVNu','Действие\x20необратимо.','setHeaderColor','HapticFeedback','success','clearBtn','2943715fCZSQf','medium','TG\x20setup\x20error:','json','getMinutes','text','inputArea','notificationOccurred','touchend','toString','message\x20ai','emptyState','href','13968jewLur','BackButton','auto','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','from','createElement','error','remove','78vRbbYZ','click','resize','timestamp','6nmMLkQ','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','offClick','message-time','apply','show-delete','onclick','239490WXgYKA','appendChild','classList','POST','Удалить?','querySelector','scrollTop','ready','focus','Пустой\x20ответ','typingIndicator','className','.message.show-delete','Ошибка\x20сервера','disabled','signal','confirmModal','innerHTML','username','onClick','height','parse','clear_history','viewportChanged','addEventListener','forEach','splice','div','children','.container','flex'];a0_0x1a02=function(){return _0x138a8e;};return a0_0x1a02();}function autoResizeTextarea(){const _0x510289=a0_0x49e696;messageInput[_0x510289(0x17e)][_0x510289(0x147)]=_0x510289(0x1a2),messageInput[_0x510289(0x17e)][_0x510289(0x147)]=Math[_0x510289(0x170)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x36486b=a0_0x49e696,_0x2d8811=messageInput[_0x36486b(0x167)][_0x36486b(0x17a)]();sendBtn[_0x36486b(0x141)]=!_0x2d8811||isTyping;}async function sendMessage(){const _0x1d4c05=a0_0x49e696,_0x403c60=messageInput[_0x1d4c05(0x167)][_0x1d4c05(0x17a)]();if(!_0x403c60||isTyping)return;if(tg?.[_0x1d4c05(0x190)])tg[_0x1d4c05(0x190)][_0x1d4c05(0x17b)](_0x1d4c05(0x156));messages['push']({'role':_0x1d4c05(0x171),'content':_0x403c60,'timestamp':Date[_0x1d4c05(0x158)]()}),localStorage[_0x1d4c05(0x173)](_0x1d4c05(0x153),JSON[_0x1d4c05(0x16a)](messages)),renderMessages(),messageInput[_0x1d4c05(0x167)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x1d4c05(0x1b9)]=chatArea[_0x1d4c05(0x16f)];const _0x2d8e2d=await callBackend(_0x1d4c05(0x168),{'message':_0x403c60});isTyping=![];const _0x2b6df2=document[_0x1d4c05(0x17f)]('typingIndicator');if(_0x2b6df2)_0x2b6df2[_0x1d4c05(0x1a7)]();let _0x2dfc12='Ошибка\x20сети';if(_0x2d8e2d[_0x1d4c05(0x191)]){_0x2dfc12=_0x2d8e2d[_0x1d4c05(0x198)]||_0x1d4c05(0x1bc);if(tg?.[_0x1d4c05(0x190)])tg[_0x1d4c05(0x190)][_0x1d4c05(0x19a)](_0x1d4c05(0x191));}else{_0x2dfc12=_0x2d8e2d['error']||_0x1d4c05(0x1c0);if(tg?.[_0x1d4c05(0x190)])tg[_0x1d4c05(0x190)][_0x1d4c05(0x19a)](_0x1d4c05(0x1a6));}messages[_0x1d4c05(0x152)]({'role':'ai','content':_0x2dfc12,'timestamp':Date[_0x1d4c05(0x158)]()}),localStorage['setItem'](_0x1d4c05(0x153),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x202e7f){const _0x48d8ed=a0_0x49e696;if(mTitle)mTitle[_0x48d8ed(0x15d)]=_0x48d8ed(0x1b7);if(mText)mText[_0x48d8ed(0x15d)]=_0x48d8ed(0x18e);modalCallback=()=>{const _0x2513bb=_0x48d8ed;messages[_0x2513bb(0x14d)](_0x202e7f,0x1),localStorage[_0x2513bb(0x173)](_0x2513bb(0x153),JSON[_0x2513bb(0x16a)](messages)),renderMessages();},modal[_0x48d8ed(0x1b5)][_0x48d8ed(0x187)]('show');}if(clearBtn)clearBtn[a0_0x49e696(0x1b2)]=()=>{const _0x2794b4=a0_0x49e696;if(!messages['length'])return;if(mTitle)mTitle[_0x2794b4(0x15d)]='Очистить\x20историю?';if(mText)mText[_0x2794b4(0x15d)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x459816=_0x2794b4;messages=[],localStorage[_0x459816(0x174)](_0x459816(0x153)),renderMessages(),callBackend(_0x459816(0x149),{});},modal[_0x2794b4(0x1b5)][_0x2794b4(0x187)](_0x2794b4(0x172));};document[a0_0x49e696(0x17f)](a0_0x49e696(0x162))[a0_0x49e696(0x1b2)]=()=>modal[a0_0x49e696(0x1b5)][a0_0x49e696(0x1a7)](a0_0x49e696(0x172)),document['getElementById']('modalConfirm')[a0_0x49e696(0x1b2)]=()=>{const _0x2c1e8a=a0_0x49e696;if(modalCallback)modalCallback();modal[_0x2c1e8a(0x1b5)]['remove'](_0x2c1e8a(0x172));},messageInput[a0_0x49e696(0x14b)](a0_0x49e696(0x178),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x49e696(0x14b)](a0_0x49e696(0x181),_0x4a2df4=>{const _0x56a379=a0_0x49e696;_0x4a2df4[_0x56a379(0x18b)]===_0x56a379(0x179)&&!_0x4a2df4['shiftKey']&&(_0x4a2df4['preventDefault'](),sendMessage());}),sendBtn[a0_0x49e696(0x1b2)]=sendMessage,document[a0_0x49e696(0x14b)](a0_0x49e696(0x1a9),_0x1c6801=>{const _0x47768c=a0_0x49e696;document[_0x47768c(0x175)](_0x47768c(0x1bf))[_0x47768c(0x14c)](_0x2de412=>{const _0x193350=_0x47768c;if(!_0x2de412[_0x193350(0x154)](_0x1c6801[_0x193350(0x15e)]))_0x2de412[_0x193350(0x1b5)][_0x193350(0x1a7)](_0x193350(0x1b1));});});const saved=localStorage[a0_0x49e696(0x17d)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x49e696(0x148)](saved),renderMessages();}catch(a0_0x2844bc){}updateSendButton();