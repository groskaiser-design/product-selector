const a0_0x1dc274=a0_0x383f;(function(_0x16e6e4,_0x26ab1b){const _0x453e13=a0_0x383f,_0x2ab0e9=_0x16e6e4();while(!![]){try{const _0x40525d=-parseInt(_0x453e13(0x21d))/0x1+-parseInt(_0x453e13(0x23d))/0x2*(parseInt(_0x453e13(0x1f7))/0x3)+parseInt(_0x453e13(0x1fc))/0x4+parseInt(_0x453e13(0x1de))/0x5*(parseInt(_0x453e13(0x1cd))/0x6)+parseInt(_0x453e13(0x236))/0x7*(parseInt(_0x453e13(0x230))/0x8)+parseInt(_0x453e13(0x1f0))/0x9*(-parseInt(_0x453e13(0x222))/0xa)+parseInt(_0x453e13(0x219))/0xb*(parseInt(_0x453e13(0x204))/0xc);if(_0x40525d===_0x26ab1b)break;else _0x2ab0e9['push'](_0x2ab0e9['shift']());}catch(_0x22ac00){_0x2ab0e9['push'](_0x2ab0e9['shift']());}}}(a0_0xc026,0xe9a0c));function a0_0xc026(){const _0x4d265e=['Ошибка\x20сети','send_message','viewportHeight','9ckQTBl','textContent','isVersionAtLeast','notificationOccurred','viewportChanged','Enter','innerHTML','9tsQGky','offsetHeight','offClick','stopPropagation','user','5707992mzxIWF','modalCancel','message-time','error','emptyState','WebApp','text/plain','.message.show-delete','6096ONzhSJ','href','ready','keydown','parse','search','auto','onclick','resize','Действие\x20необратимо.','touchend','display','remove','push','HapticFeedback','now','json','Очистить\x20историю?','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','contains','message-bubble','27995TljlQB','querySelectorAll','show','.container','1903434mWqBlv','scrollHeight','length','messageInput','Пустой\x20ответ','8217230uzbhmy','typingIndicator','<br>','toString','className','show-delete','height','Начнется\x20новый\x20диалог.','(((.+)+)+)+$','debug_uid','getElementById','disabled','timestamp','text','64ENohOz','padStart','input','value','ai_chat_messages','signal','1270927wyUMys','appendChild','focus','setItem','div','message\x20ai','modalConfirm','1174866Kxjtds','username','function','initData','removeItem','random','onClick','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','role','warn','6.1','click','Ошибка\x20сервера','floor','117420ecGdfK','chatArea','clearBtn','impactOccurred','modalTitle','#050505','initDataUnsafe','flex','POST','disableVerticalSwipes','createElement','classList','Telegram','none','add','clear_history','getItem','325nAgEVc','abort','Удалить?','stringify','expand','from','scrollTop','addEventListener','trim','getHours','style','light','confirmModal','shiftKey','forEach'];a0_0xc026=function(){return _0x4d265e;};return a0_0xc026();}const tg=window[a0_0x1dc274(0x1d9)]?.[a0_0x1dc274(0x201)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x3eb1f4=a0_0x1dc274;if(!tg)return;try{tg[_0x3eb1f4(0x206)](),tg[_0x3eb1f4(0x1e2)](),tg['setHeaderColor']?.(_0x3eb1f4(0x1d2));if(tg[_0x3eb1f4(0x1f2)]?.(_0x3eb1f4(0x247)))tg[_0x3eb1f4(0x1d6)]?.();const _0x5e2e72=tg['BackButton'];if(_0x5e2e72){_0x5e2e72[_0x3eb1f4(0x21b)]();if(typeof _0x5e2e72[_0x3eb1f4(0x1f9)]===_0x3eb1f4(0x23f))try{_0x5e2e72['offClick']();}catch(_0x15d7d9){}_0x5e2e72[_0x3eb1f4(0x243)](()=>{const _0x2f511=_0x3eb1f4;if(tg['HapticFeedback'])tg[_0x2f511(0x212)][_0x2f511(0x1d0)](_0x2f511(0x1e9));location[_0x2f511(0x205)]=HOME_URL;});}}catch(_0x53f0f3){console[_0x3eb1f4(0x246)]('TG\x20setup\x20error:',_0x53f0f3);}}(function initStableLayout(){const _0x12dfc3=a0_0x1dc274,_0x1fa5e0=(function(){let _0x43ef05=!![];return function(_0x4ff8ad,_0x24c1d5){const _0x131344=_0x43ef05?function(){if(_0x24c1d5){const _0x2a75cb=_0x24c1d5['apply'](_0x4ff8ad,arguments);return _0x24c1d5=null,_0x2a75cb;}}:function(){};return _0x43ef05=![],_0x131344;};}()),_0x473d27=document['querySelector'](_0x12dfc3(0x21c)),_0x7ced99=document[_0x12dfc3(0x22c)]('inputArea'),_0x47c222=document[_0x12dfc3(0x22c)](_0x12dfc3(0x1ce)),_0x277b0d=document[_0x12dfc3(0x22c)]('messageInput');function _0xf27d07(){const _0x5c3b06=_0x12dfc3,_0x381ae9=_0x1fa5e0(this,function(){const _0x28ab40=a0_0x383f;return _0x381ae9['toString']()[_0x28ab40(0x209)]('(((.+)+)+)+$')[_0x28ab40(0x225)]()['constructor'](_0x381ae9)[_0x28ab40(0x209)](_0x28ab40(0x22a));});_0x381ae9();if(!_0x473d27)return;const _0x5e720d=tg&&tg[_0x5c3b06(0x1ef)]?tg[_0x5c3b06(0x1ef)]:window['innerHeight'];_0x473d27[_0x5c3b06(0x1e8)]['height']=_0x5e720d+'px';if(_0x7ced99){const _0x3c659b=_0x7ced99[_0x5c3b06(0x1f8)];_0x47c222['style']['paddingBottom']=_0x3c659b+0x28+'px';}}tg?tg['onEvent'](_0x12dfc3(0x1f4),({isStateStable:_0x582ee2})=>{_0xf27d07();if(_0x582ee2)requestAnimationFrame(()=>{const _0x5d50f7=a0_0x383f;_0x47c222[_0x5d50f7(0x1e4)]=_0x47c222[_0x5d50f7(0x21e)];});}):window[_0x12dfc3(0x1e5)](_0x12dfc3(0x20c),_0xf27d07),_0xf27d07(),_0x277b0d&&(_0x277b0d[_0x12dfc3(0x1e5)](_0x12dfc3(0x232),()=>{requestAnimationFrame(_0xf27d07);}),_0x277b0d[_0x12dfc3(0x1e5)](_0x12dfc3(0x238),()=>{setTimeout(()=>{const _0x1ebfb5=a0_0x383f;_0x47c222['scrollTop']=_0x47c222[_0x1ebfb5(0x21e)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1dc274(0x244),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x1dc274(0x1ce)),emptyState=document[a0_0x1dc274(0x22c)](a0_0x1dc274(0x200)),messageInput=document[a0_0x1dc274(0x22c)](a0_0x1dc274(0x220)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x1dc274(0x22c)](a0_0x1dc274(0x1cf)),modal=document['getElementById'](a0_0x1dc274(0x1ea)),mTitle=document['getElementById'](a0_0x1dc274(0x1d1)),mText=document[a0_0x1dc274(0x22c)]('modalText');let modalCallback=null;function a0_0x383f(_0x152190,_0x4b3a22){_0x152190=_0x152190-0x1ca;const _0x10a4d1=a0_0xc026();let _0xf412a4=_0x10a4d1[_0x152190];return _0xf412a4;}async function callBackend(_0x53d830,_0x517a35){const _0x2c936e=a0_0x1dc274,_0x14be7d=tg?.[_0x2c936e(0x1d3)]?.[_0x2c936e(0x1fb)]||{},_0xd426a5=_0x14be7d['id']||localStorage[_0x2c936e(0x1dd)](_0x2c936e(0x22b))||'d-'+Math[_0x2c936e(0x1cc)](Math[_0x2c936e(0x242)]()*0x3b9aca00);if(!_0x14be7d['id'])localStorage[_0x2c936e(0x239)](_0x2c936e(0x22b),_0xd426a5);const _0x29459f={'action':_0x53d830,'user_id':_0xd426a5,'user_data':{'first_name':_0x14be7d['first_name'],'username':_0x14be7d[_0x2c936e(0x23e)]},'init_data':tg?.[_0x2c936e(0x240)]||'',..._0x517a35},_0x595162=new AbortController(),_0x20cea0=setTimeout(()=>_0x595162[_0x2c936e(0x1df)](),REQUEST_TIMEOUT_MS);try{const _0x37b2ed=await fetch(BACKEND_URL,{'method':_0x2c936e(0x1d5),'headers':{'Content-Type':_0x2c936e(0x202)},'body':JSON[_0x2c936e(0x1e1)](_0x29459f),'signal':_0x595162[_0x2c936e(0x235)]});return clearTimeout(_0x20cea0),await _0x37b2ed[_0x2c936e(0x214)]();}catch(_0x4ab122){return{'success':![],'error':String(_0x4ab122)};}}function formatTime(_0x300a68){const _0x5aba83=a0_0x1dc274,_0x185d44=new Date(_0x300a68);return String(_0x185d44[_0x5aba83(0x1e7)]())[_0x5aba83(0x231)](0x2,'0')+':'+String(_0x185d44['getMinutes']())[_0x5aba83(0x231)](0x2,'0');}function createMessageElement(_0x159a11,_0x2dadda){const _0x1cf333=a0_0x1dc274,_0x5b784d=document[_0x1cf333(0x1d7)](_0x1cf333(0x23a));_0x5b784d['className']='message\x20'+_0x159a11[_0x1cf333(0x245)];const _0x187afd=document[_0x1cf333(0x1d7)](_0x1cf333(0x23a));_0x187afd[_0x1cf333(0x226)]=_0x1cf333(0x218),_0x187afd[_0x1cf333(0x1f6)]=_0x159a11['content']['replace'](/\n/g,_0x1cf333(0x224));const _0x20ed86=document['createElement'](_0x1cf333(0x23a));_0x20ed86['className']='delete-btn',_0x20ed86[_0x1cf333(0x1f6)]=_0x1cf333(0x216),_0x20ed86[_0x1cf333(0x20b)]=_0x3df339=>{const _0x59d2b1=_0x1cf333;_0x3df339[_0x59d2b1(0x1fa)](),confirmDelete(_0x2dadda);};let _0x4c2511;_0x187afd[_0x1cf333(0x1e5)]('touchstart',()=>_0x4c2511=setTimeout(()=>{const _0x324ab4=_0x1cf333;_0x5b784d[_0x324ab4(0x1d8)][_0x324ab4(0x1db)]('show-delete');if(tg?.[_0x324ab4(0x212)])tg[_0x324ab4(0x212)][_0x324ab4(0x1d0)]('medium');},0x1f4)),_0x187afd[_0x1cf333(0x1e5)](_0x1cf333(0x20e),()=>clearTimeout(_0x4c2511));const _0x25f04e=document['createElement'](_0x1cf333(0x23a));return _0x25f04e['className']=_0x1cf333(0x1fe),_0x25f04e[_0x1cf333(0x1f1)]=formatTime(_0x159a11[_0x1cf333(0x22e)]),_0x5b784d[_0x1cf333(0x237)](_0x20ed86),_0x5b784d[_0x1cf333(0x237)](_0x187afd),_0x5b784d['appendChild'](_0x25f04e),_0x5b784d;}function createTypingIndicator(){const _0x20f1c0=a0_0x1dc274,_0x1b06e5=document['createElement'](_0x20f1c0(0x23a));return _0x1b06e5['className']=_0x20f1c0(0x23b),_0x1b06e5['id']=_0x20f1c0(0x223),_0x1b06e5[_0x20f1c0(0x1f6)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x1b06e5;}function renderMessages(){const _0x529d65=a0_0x1dc274;Array[_0x529d65(0x1e3)](chatArea['children'])[_0x529d65(0x1ec)](_0x1ad5e8=>{if(_0x1ad5e8['id']!=='emptyState')_0x1ad5e8['remove']();}),messages[_0x529d65(0x21f)]>0x0?(emptyState[_0x529d65(0x1e8)][_0x529d65(0x20f)]=_0x529d65(0x1da),messages['forEach']((_0x3e1fe8,_0x28a751)=>chatArea[_0x529d65(0x237)](createMessageElement(_0x3e1fe8,_0x28a751)))):emptyState[_0x529d65(0x1e8)][_0x529d65(0x20f)]=_0x529d65(0x1d4),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x529d65(0x21e)]);}function autoResizeTextarea(){const _0x2dd4b7=a0_0x1dc274;messageInput[_0x2dd4b7(0x1e8)][_0x2dd4b7(0x228)]=_0x2dd4b7(0x20a),messageInput[_0x2dd4b7(0x1e8)][_0x2dd4b7(0x228)]=Math['min'](messageInput[_0x2dd4b7(0x21e)],0x78)+'px';}function updateSendButton(){const _0x31c9b7=a0_0x1dc274,_0x10503c=messageInput[_0x31c9b7(0x233)]['trim']();sendBtn[_0x31c9b7(0x22d)]=!_0x10503c||isTyping;}async function sendMessage(){const _0x2d2447=a0_0x1dc274,_0x484fca=messageInput['value'][_0x2d2447(0x1e6)]();if(!_0x484fca||isTyping)return;if(tg?.[_0x2d2447(0x212)])tg['HapticFeedback']['impactOccurred']('light');messages[_0x2d2447(0x211)]({'role':_0x2d2447(0x1fb),'content':_0x484fca,'timestamp':Date[_0x2d2447(0x213)]()}),localStorage[_0x2d2447(0x239)](_0x2d2447(0x234),JSON[_0x2d2447(0x1e1)](messages)),renderMessages(),messageInput[_0x2d2447(0x233)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2d2447(0x237)](createTypingIndicator()),chatArea[_0x2d2447(0x1e4)]=chatArea[_0x2d2447(0x21e)];const _0x5de915=await callBackend(_0x2d2447(0x1ee),{'message':_0x484fca});isTyping=![];const _0x5cdae6=document[_0x2d2447(0x22c)](_0x2d2447(0x223));if(_0x5cdae6)_0x5cdae6[_0x2d2447(0x210)]();let _0x5105fe=_0x2d2447(0x1ed);if(_0x5de915['success']){_0x5105fe=_0x5de915[_0x2d2447(0x22f)]||_0x2d2447(0x221);if(tg?.['HapticFeedback'])tg[_0x2d2447(0x212)][_0x2d2447(0x1f3)]('success');}else{_0x5105fe=_0x5de915[_0x2d2447(0x1ff)]||_0x2d2447(0x1cb);if(tg?.[_0x2d2447(0x212)])tg[_0x2d2447(0x212)]['notificationOccurred'](_0x2d2447(0x1ff));}messages[_0x2d2447(0x211)]({'role':'ai','content':_0x5105fe,'timestamp':Date[_0x2d2447(0x213)]()}),localStorage[_0x2d2447(0x239)](_0x2d2447(0x234),JSON[_0x2d2447(0x1e1)](messages)),renderMessages();}function confirmDelete(_0x32d9c1){const _0x2ddfb5=a0_0x1dc274;if(mTitle)mTitle[_0x2ddfb5(0x1f1)]=_0x2ddfb5(0x1e0);if(mText)mText[_0x2ddfb5(0x1f1)]=_0x2ddfb5(0x20d);modalCallback=()=>{const _0xa9fe45=_0x2ddfb5;messages['splice'](_0x32d9c1,0x1),localStorage['setItem'](_0xa9fe45(0x234),JSON[_0xa9fe45(0x1e1)](messages)),renderMessages();},modal[_0x2ddfb5(0x1d8)][_0x2ddfb5(0x1db)](_0x2ddfb5(0x21b));}if(clearBtn)clearBtn[a0_0x1dc274(0x20b)]=()=>{const _0x2a0b47=a0_0x1dc274;if(!messages[_0x2a0b47(0x21f)])return;if(mTitle)mTitle[_0x2a0b47(0x1f1)]=_0x2a0b47(0x215);if(mText)mText[_0x2a0b47(0x1f1)]=_0x2a0b47(0x229);modalCallback=async()=>{const _0x3ee318=_0x2a0b47;messages=[],localStorage[_0x3ee318(0x241)](_0x3ee318(0x234)),renderMessages(),callBackend(_0x3ee318(0x1dc),{});},modal[_0x2a0b47(0x1d8)]['add'](_0x2a0b47(0x21b));};document[a0_0x1dc274(0x22c)](a0_0x1dc274(0x1fd))[a0_0x1dc274(0x20b)]=()=>modal[a0_0x1dc274(0x1d8)][a0_0x1dc274(0x210)](a0_0x1dc274(0x21b)),document[a0_0x1dc274(0x22c)](a0_0x1dc274(0x23c))[a0_0x1dc274(0x20b)]=()=>{const _0x138a4d=a0_0x1dc274;if(modalCallback)modalCallback();modal[_0x138a4d(0x1d8)]['remove']('show');},messageInput[a0_0x1dc274(0x1e5)](a0_0x1dc274(0x232),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1dc274(0x1e5)](a0_0x1dc274(0x207),_0x128a7f=>{const _0x168f4c=a0_0x1dc274;_0x128a7f['key']===_0x168f4c(0x1f5)&&!_0x128a7f[_0x168f4c(0x1eb)]&&(_0x128a7f['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x1dc274(0x1e5)](a0_0x1dc274(0x1ca),_0xabd3ad=>{const _0x5acde4=a0_0x1dc274;document[_0x5acde4(0x21a)](_0x5acde4(0x203))[_0x5acde4(0x1ec)](_0x2190c0=>{const _0x7cfd1c=_0x5acde4;if(!_0x2190c0[_0x7cfd1c(0x217)](_0xabd3ad['target']))_0x2190c0['classList'][_0x7cfd1c(0x210)](_0x7cfd1c(0x227));});});const saved=localStorage[a0_0x1dc274(0x1dd)](a0_0x1dc274(0x234));if(saved)try{messages=JSON[a0_0x1dc274(0x208)](saved),renderMessages();}catch(a0_0x49f08b){}updateSendButton();