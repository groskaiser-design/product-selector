function a0_0x2639(_0x26e7bb,_0x24244a){_0x26e7bb=_0x26e7bb-0x14f;const _0x4d4003=a0_0x5055();let _0x4b7320=_0x4d4003[_0x26e7bb];return _0x4b7320;}const a0_0x450fb3=a0_0x2639;(function(_0x13699c,_0x39c888){const _0x5502c3=a0_0x2639,_0x5d326b=_0x13699c();while(!![]){try{const _0x29c51e=-parseInt(_0x5502c3(0x168))/0x1*(-parseInt(_0x5502c3(0x166))/0x2)+-parseInt(_0x5502c3(0x197))/0x3*(parseInt(_0x5502c3(0x19f))/0x4)+-parseInt(_0x5502c3(0x1b4))/0x5+-parseInt(_0x5502c3(0x192))/0x6*(-parseInt(_0x5502c3(0x181))/0x7)+parseInt(_0x5502c3(0x15e))/0x8*(-parseInt(_0x5502c3(0x1b0))/0x9)+parseInt(_0x5502c3(0x15c))/0xa+parseInt(_0x5502c3(0x179))/0xb*(parseInt(_0x5502c3(0x17f))/0xc);if(_0x29c51e===_0x39c888)break;else _0x5d326b['push'](_0x5d326b['shift']());}catch(_0x1e76ea){_0x5d326b['push'](_0x5d326b['shift']());}}}(a0_0x5055,0x4e465));const tg=window[a0_0x450fb3(0x17c)]?.[a0_0x450fb3(0x157)],HOME_URL=a0_0x450fb3(0x1a7);function setupTelegramBackButton(){const _0x5d6149=a0_0x450fb3,_0x544d7e=(function(){let _0x3a7c55=!![];return function(_0x42e9c3,_0x2c7b2){const _0xf40157=_0x3a7c55?function(){const _0x251119=a0_0x2639;if(_0x2c7b2){const _0x3edfae=_0x2c7b2[_0x251119(0x1aa)](_0x42e9c3,arguments);return _0x2c7b2=null,_0x3edfae;}}:function(){};return _0x3a7c55=![],_0xf40157;};}()),_0x503aab=_0x544d7e(this,function(){const _0x4587ba=a0_0x2639;return _0x503aab[_0x4587ba(0x172)]()[_0x4587ba(0x17a)]('(((.+)+)+)+$')['toString']()['constructor'](_0x503aab)['search'](_0x4587ba(0x19a));});_0x503aab();if(!tg)return;try{tg[_0x5d6149(0x1ad)](),tg['expand'](),tg[_0x5d6149(0x1c0)]?.(_0x5d6149(0x18f));if(tg[_0x5d6149(0x156)]?.(_0x5d6149(0x161)))tg[_0x5d6149(0x1c4)]?.();const _0x1638c7=tg[_0x5d6149(0x1c2)];if(_0x1638c7){_0x1638c7[_0x5d6149(0x163)]();if(typeof _0x1638c7[_0x5d6149(0x186)]===_0x5d6149(0x15f))try{_0x1638c7[_0x5d6149(0x186)]();}catch(_0x4dd7f2){}_0x1638c7[_0x5d6149(0x16f)](()=>{const _0x27b863=_0x5d6149;if(tg[_0x27b863(0x19c)])tg[_0x27b863(0x19c)]['impactOccurred'](_0x27b863(0x16a));location[_0x27b863(0x1bd)]=HOME_URL;});}}catch(_0x44b879){console[_0x5d6149(0x180)](_0x5d6149(0x1cb),_0x44b879);}}(function initStableLayout(){const _0x5a006f=a0_0x450fb3,_0x4acf56=document[_0x5a006f(0x16d)](_0x5a006f(0x1bb)),_0x2c7942=document[_0x5a006f(0x14f)]('inputArea'),_0x1626b9=document[_0x5a006f(0x14f)](_0x5a006f(0x1ac)),_0x20a369=document['getElementById'](_0x5a006f(0x1ba));function _0x52efaa(){const _0x328c0e=_0x5a006f;if(!_0x4acf56)return;const _0x1eaa8f=tg&&tg['viewportHeight']?tg[_0x328c0e(0x193)]:window[_0x328c0e(0x18d)];_0x4acf56[_0x328c0e(0x1c1)][_0x328c0e(0x182)]=_0x1eaa8f+'px';if(_0x2c7942){const _0x1744d1=_0x2c7942[_0x328c0e(0x1cd)];_0x1626b9[_0x328c0e(0x1c1)][_0x328c0e(0x170)]=_0x1744d1+0x28+'px';}}tg?tg['onEvent'](_0x5a006f(0x15d),({isStateStable:_0x3fb559})=>{_0x52efaa();if(_0x3fb559)requestAnimationFrame(()=>{const _0x758c33=a0_0x2639;_0x1626b9[_0x758c33(0x1c7)]=_0x1626b9[_0x758c33(0x1c5)];});}):window[_0x5a006f(0x1b8)](_0x5a006f(0x17e),_0x52efaa),_0x52efaa(),_0x20a369&&(_0x20a369[_0x5a006f(0x1b8)](_0x5a006f(0x176),()=>{requestAnimationFrame(_0x52efaa);}),_0x20a369[_0x5a006f(0x1b8)](_0x5a006f(0x177),()=>{setTimeout(()=>{const _0x4704bc=a0_0x2639;_0x1626b9['scrollTop']=_0x1626b9[_0x4704bc(0x1c5)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x450fb3(0x1ac)),emptyState=document[a0_0x450fb3(0x14f)](a0_0x450fb3(0x1a4)),messageInput=document[a0_0x450fb3(0x14f)](a0_0x450fb3(0x1ba)),sendBtn=document[a0_0x450fb3(0x14f)](a0_0x450fb3(0x1a0)),clearBtn=document['getElementById'](a0_0x450fb3(0x15a)),modal=document['getElementById'](a0_0x450fb3(0x1af)),mTitle=document['getElementById'](a0_0x450fb3(0x1ae)),mText=document[a0_0x450fb3(0x14f)](a0_0x450fb3(0x18e));let modalCallback=null;async function callBackend(_0x5d2238,_0x5b03cc){const _0x4b1110=a0_0x450fb3,_0x3c61c0=tg?.['initDataUnsafe']?.['user']||{},_0x302887=_0x3c61c0['id']||localStorage['getItem']('debug_uid')||'d-'+Math['floor'](Math[_0x4b1110(0x1a1)]()*0x3b9aca00);if(!_0x3c61c0['id'])localStorage[_0x4b1110(0x175)](_0x4b1110(0x155),_0x302887);const _0x4ed8af={'action':_0x5d2238,'user_id':_0x302887,'user_data':{'first_name':_0x3c61c0[_0x4b1110(0x1d0)],'username':_0x3c61c0['username']},'init_data':tg?.[_0x4b1110(0x194)]||'',..._0x5b03cc},_0x70b4e2=new AbortController(),_0x516c86=setTimeout(()=>_0x70b4e2[_0x4b1110(0x151)](),REQUEST_TIMEOUT_MS);try{const _0x50b32b=await fetch(BACKEND_URL,{'method':_0x4b1110(0x187),'headers':{'Content-Type':_0x4b1110(0x195)},'body':JSON[_0x4b1110(0x154)](_0x4ed8af),'signal':_0x70b4e2[_0x4b1110(0x152)]});return clearTimeout(_0x516c86),await _0x50b32b[_0x4b1110(0x159)]();}catch(_0x43bea1){return{'success':![],'error':String(_0x43bea1)};}}function formatTime(_0xe46758){const _0x4e46e9=a0_0x450fb3,_0x43290f=new Date(_0xe46758);return String(_0x43290f[_0x4e46e9(0x1bf)]())[_0x4e46e9(0x19b)](0x2,'0')+':'+String(_0x43290f[_0x4e46e9(0x1ce)]())[_0x4e46e9(0x19b)](0x2,'0');}function createMessageElement(_0x5166bc,_0x145718){const _0x1c414e=a0_0x450fb3,_0x51ecd8=document[_0x1c414e(0x1cf)](_0x1c414e(0x19e));_0x51ecd8[_0x1c414e(0x150)]=_0x1c414e(0x196)+_0x5166bc[_0x1c414e(0x1cc)];const _0x405fda=document['createElement']('div');_0x405fda[_0x1c414e(0x150)]=_0x1c414e(0x1c9),_0x405fda['innerHTML']=_0x5166bc[_0x1c414e(0x188)]['replace'](/\n/g,'<br>');const _0x5ee26b=document[_0x1c414e(0x1cf)]('div');_0x5ee26b[_0x1c414e(0x150)]='delete-btn',_0x5ee26b[_0x1c414e(0x1a5)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x5ee26b[_0x1c414e(0x199)]=_0x15d4b7=>{const _0x402055=_0x1c414e;_0x15d4b7[_0x402055(0x1b5)](),confirmDelete(_0x145718);};let _0x28b286;_0x405fda['addEventListener']('touchstart',()=>_0x28b286=setTimeout(()=>{const _0x58d696=_0x1c414e;_0x51ecd8[_0x58d696(0x174)][_0x58d696(0x165)](_0x58d696(0x183));if(tg?.[_0x58d696(0x19c)])tg['HapticFeedback'][_0x58d696(0x1a2)](_0x58d696(0x1c3));},0x1f4)),_0x405fda[_0x1c414e(0x1b8)](_0x1c414e(0x198),()=>clearTimeout(_0x28b286));const _0x2ad331=document[_0x1c414e(0x1cf)](_0x1c414e(0x19e));return _0x2ad331[_0x1c414e(0x150)]='message-time',_0x2ad331['textContent']=formatTime(_0x5166bc[_0x1c414e(0x19d)]),_0x51ecd8[_0x1c414e(0x1b1)](_0x5ee26b),_0x51ecd8['appendChild'](_0x405fda),_0x51ecd8['appendChild'](_0x2ad331),_0x51ecd8;}function createTypingIndicator(){const _0x47b193=a0_0x450fb3,_0x36f2e4=document[_0x47b193(0x1cf)](_0x47b193(0x19e));return _0x36f2e4['className']=_0x47b193(0x190),_0x36f2e4['id']=_0x47b193(0x1a6),_0x36f2e4[_0x47b193(0x1a5)]=_0x47b193(0x1b2),_0x36f2e4;}function renderMessages(){const _0x4da0df=a0_0x450fb3;Array['from'](chatArea[_0x4da0df(0x1b7)])[_0x4da0df(0x1a9)](_0x39a050=>{const _0x345ffb=_0x4da0df;if(_0x39a050['id']!==_0x345ffb(0x1a4))_0x39a050['remove']();}),messages[_0x4da0df(0x17d)]>0x0?(emptyState[_0x4da0df(0x1c1)][_0x4da0df(0x169)]=_0x4da0df(0x18a),messages['forEach']((_0x50cfae,_0x328da8)=>chatArea[_0x4da0df(0x1b1)](createMessageElement(_0x50cfae,_0x328da8)))):emptyState['style']['display']=_0x4da0df(0x178),requestAnimationFrame(()=>chatArea[_0x4da0df(0x1c7)]=chatArea[_0x4da0df(0x1c5)]);}function autoResizeTextarea(){const _0x25bd1b=a0_0x450fb3;messageInput[_0x25bd1b(0x1c1)][_0x25bd1b(0x182)]=_0x25bd1b(0x171),messageInput['style'][_0x25bd1b(0x182)]=Math[_0x25bd1b(0x1b3)](messageInput[_0x25bd1b(0x1c5)],0x78)+'px';}function updateSendButton(){const _0x3d47a1=a0_0x450fb3,_0x4e4f3d=messageInput['value'][_0x3d47a1(0x1ab)]();sendBtn[_0x3d47a1(0x158)]=!_0x4e4f3d||isTyping;}async function sendMessage(){const _0x26bfd9=a0_0x450fb3,_0x3dd65f=messageInput['value'][_0x26bfd9(0x1ab)]();if(!_0x3dd65f||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x26bfd9(0x19c)]['impactOccurred'](_0x26bfd9(0x16a));messages[_0x26bfd9(0x18b)]({'role':_0x26bfd9(0x1ca),'content':_0x3dd65f,'timestamp':Date[_0x26bfd9(0x184)]()}),localStorage['setItem'](_0x26bfd9(0x160),JSON[_0x26bfd9(0x154)](messages)),renderMessages(),messageInput[_0x26bfd9(0x185)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x26bfd9(0x1b1)](createTypingIndicator()),chatArea[_0x26bfd9(0x1c7)]=chatArea[_0x26bfd9(0x1c5)];const _0x532361=await callBackend(_0x26bfd9(0x153),{'message':_0x3dd65f});isTyping=![];const _0x2a1a30=document[_0x26bfd9(0x14f)](_0x26bfd9(0x1a6));if(_0x2a1a30)_0x2a1a30[_0x26bfd9(0x1a3)]();let _0x3b4013='Ошибка\x20сети';if(_0x532361['success']){_0x3b4013=_0x532361['text']||_0x26bfd9(0x15b);if(tg?.[_0x26bfd9(0x19c)])tg['HapticFeedback']['notificationOccurred'](_0x26bfd9(0x1be));}else{_0x3b4013=_0x532361[_0x26bfd9(0x1a8)]||_0x26bfd9(0x167);if(tg?.[_0x26bfd9(0x19c)])tg['HapticFeedback'][_0x26bfd9(0x173)](_0x26bfd9(0x1a8));}messages[_0x26bfd9(0x18b)]({'role':'ai','content':_0x3b4013,'timestamp':Date[_0x26bfd9(0x184)]()}),localStorage['setItem'](_0x26bfd9(0x160),JSON[_0x26bfd9(0x154)](messages)),renderMessages();}function confirmDelete(_0x44b147){const _0xde8f09=a0_0x450fb3;if(mTitle)mTitle[_0xde8f09(0x164)]=_0xde8f09(0x191);if(mText)mText[_0xde8f09(0x164)]=_0xde8f09(0x1c6);modalCallback=()=>{const _0x566d02=_0xde8f09;messages['splice'](_0x44b147,0x1),localStorage['setItem'](_0x566d02(0x160),JSON[_0x566d02(0x154)](messages)),renderMessages();},modal[_0xde8f09(0x174)][_0xde8f09(0x165)](_0xde8f09(0x163));}if(clearBtn)clearBtn[a0_0x450fb3(0x199)]=()=>{const _0x2e9191=a0_0x450fb3;if(!messages[_0x2e9191(0x17d)])return;if(mTitle)mTitle[_0x2e9191(0x164)]='Очистить\x20историю?';if(mText)mText[_0x2e9191(0x164)]=_0x2e9191(0x16c);modalCallback=async()=>{const _0x424b6f=_0x2e9191;messages=[],localStorage['removeItem'](_0x424b6f(0x160)),renderMessages(),callBackend('clear_history',{});},modal[_0x2e9191(0x174)][_0x2e9191(0x165)](_0x2e9191(0x163));};document[a0_0x450fb3(0x14f)]('modalCancel')[a0_0x450fb3(0x199)]=()=>modal[a0_0x450fb3(0x174)][a0_0x450fb3(0x1a3)](a0_0x450fb3(0x163)),document[a0_0x450fb3(0x14f)](a0_0x450fb3(0x162))[a0_0x450fb3(0x199)]=()=>{const _0x3bf46c=a0_0x450fb3;if(modalCallback)modalCallback();modal[_0x3bf46c(0x174)][_0x3bf46c(0x1a3)](_0x3bf46c(0x163));},messageInput['addEventListener'](a0_0x450fb3(0x176),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x450fb3(0x16b),_0xa35d67=>{const _0x18838a=a0_0x450fb3;_0xa35d67[_0x18838a(0x18c)]==='Enter'&&!_0xa35d67[_0x18838a(0x17b)]&&(_0xa35d67[_0x18838a(0x189)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x450fb3(0x1b8)]('click',_0x24fa22=>{const _0x59f5c1=a0_0x450fb3;document[_0x59f5c1(0x16e)](_0x59f5c1(0x1b6))[_0x59f5c1(0x1a9)](_0x3adcea=>{const _0xccaecc=_0x59f5c1;if(!_0x3adcea[_0xccaecc(0x1b9)](_0x24fa22['target']))_0x3adcea[_0xccaecc(0x174)][_0xccaecc(0x1a3)](_0xccaecc(0x183));});});function a0_0x5055(){const _0x1edc08=['scrollHeight','Действие\x20необратимо.','scrollTop','parse','message-bubble','user','TG\x20setup\x20error:','role','offsetHeight','getMinutes','createElement','first_name','getElementById','className','abort','signal','send_message','stringify','debug_uid','isVersionAtLeast','WebApp','disabled','json','clearBtn','Пустой\x20ответ','1638510CZlkMa','viewportChanged','2422424hJPKar','function','ai_chat_messages','6.1','modalConfirm','show','textContent','add','557818EhLFrw','Ошибка\x20сервера','1JiaXCp','display','light','keydown','Начнется\x20новый\x20диалог.','querySelector','querySelectorAll','onClick','paddingBottom','auto','toString','notificationOccurred','classList','setItem','input','focus','flex','2673rMKCZU','search','shiftKey','Telegram','length','resize','60492ULExec','warn','174531uTcPjJ','height','show-delete','now','value','offClick','POST','content','preventDefault','none','push','key','innerHeight','modalText','#050505','message\x20ai','Удалить?','30hELysY','viewportHeight','initData','text/plain','message\x20','3nSuxEH','touchend','onclick','(((.+)+)+)+$','padStart','HapticFeedback','timestamp','div','2538964gEjTRo','sendBtn','random','impactOccurred','remove','emptyState','innerHTML','typingIndicator','./router.html','error','forEach','apply','trim','chatArea','ready','modalTitle','confirmModal','9RoXIru','appendChild','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','min','2671155JXeJcJ','stopPropagation','.message.show-delete','children','addEventListener','contains','messageInput','.container','getItem','href','success','getHours','setHeaderColor','style','BackButton','medium','disableVerticalSwipes'];a0_0x5055=function(){return _0x1edc08;};return a0_0x5055();}const saved=localStorage[a0_0x450fb3(0x1bc)](a0_0x450fb3(0x160));if(saved)try{messages=JSON[a0_0x450fb3(0x1c8)](saved),renderMessages();}catch(a0_0x16ba1c){}updateSendButton();