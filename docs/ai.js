const a0_0x2e9545=a0_0x53ca;(function(_0x2c5682,_0x2ad26b){const _0x49b9b1=a0_0x53ca,_0x3beebf=_0x2c5682();while(!![]){try{const _0x5e5b1e=parseInt(_0x49b9b1(0x24b))/0x1+-parseInt(_0x49b9b1(0x256))/0x2*(parseInt(_0x49b9b1(0x26a))/0x3)+-parseInt(_0x49b9b1(0x258))/0x4+parseInt(_0x49b9b1(0x24e))/0x5+-parseInt(_0x49b9b1(0x1f2))/0x6+parseInt(_0x49b9b1(0x218))/0x7*(-parseInt(_0x49b9b1(0x25e))/0x8)+parseInt(_0x49b9b1(0x1fd))/0x9;if(_0x5e5b1e===_0x2ad26b)break;else _0x3beebf['push'](_0x3beebf['shift']());}catch(_0x105c76){_0x3beebf['push'](_0x3beebf['shift']());}}}(a0_0x5932,0x39d7a));const tg=window[a0_0x2e9545(0x265)]?.[a0_0x2e9545(0x21d)],HOME_URL=a0_0x2e9545(0x224);function setupTelegramBackButton(){const _0xe76453=a0_0x2e9545;if(!tg)return;try{tg[_0xe76453(0x255)](),tg[_0xe76453(0x24a)](),tg['setHeaderColor']?.(_0xe76453(0x243));if(tg[_0xe76453(0x1f5)]?.('6.1'))tg[_0xe76453(0x1eb)]?.();const _0x364d6d=tg[_0xe76453(0x251)];if(_0x364d6d){_0x364d6d[_0xe76453(0x269)]();if(typeof _0x364d6d['offClick']===_0xe76453(0x261))try{_0x364d6d[_0xe76453(0x264)]();}catch(_0x1b76b5){}_0x364d6d[_0xe76453(0x23f)](()=>{const _0x1ec962=_0xe76453;if(tg[_0x1ec962(0x24f)])tg[_0x1ec962(0x24f)][_0x1ec962(0x23a)](_0x1ec962(0x248));location[_0x1ec962(0x21a)]=HOME_URL;});}}catch(_0x159d6c){console[_0xe76453(0x21e)](_0xe76453(0x1f3),_0x159d6c);}}(function initStableLayout(){const _0x4c75df=a0_0x2e9545,_0x203061=(function(){let _0xbdb68=!![];return function(_0x31caf0,_0x566213){const _0xd8f43c=_0xbdb68?function(){const _0x1aab36=a0_0x53ca;if(_0x566213){const _0x5ccb94=_0x566213[_0x1aab36(0x205)](_0x31caf0,arguments);return _0x566213=null,_0x5ccb94;}}:function(){};return _0xbdb68=![],_0xd8f43c;};}()),_0x5143af=document[_0x4c75df(0x259)](_0x4c75df(0x20b)),_0x59202d=document['getElementById'](_0x4c75df(0x1f6)),_0xc1d5c7=document[_0x4c75df(0x200)](_0x4c75df(0x206)),_0x1d7c10=document[_0x4c75df(0x200)](_0x4c75df(0x1f7));function _0x9dc73a(){const _0x59b51d=_0x4c75df,_0x469074=_0x203061(this,function(){const _0x41b1c2=a0_0x53ca;return _0x469074[_0x41b1c2(0x1ff)]()['search']('(((.+)+)+)+$')[_0x41b1c2(0x1ff)]()['constructor'](_0x469074)[_0x41b1c2(0x242)](_0x41b1c2(0x202));});_0x469074();if(!_0x5143af)return;const _0x4a4f63=tg&&tg['viewportHeight']?tg[_0x59b51d(0x212)]:window[_0x59b51d(0x26b)];_0x5143af[_0x59b51d(0x250)][_0x59b51d(0x204)]=_0x4a4f63+'px';if(_0x59202d){const _0x5a6cda=_0x59202d[_0x59b51d(0x246)];_0xc1d5c7[_0x59b51d(0x250)][_0x59b51d(0x210)]=_0x5a6cda+0x28+'px';}}tg?tg['onEvent'](_0x4c75df(0x24c),({isStateStable:_0x187443})=>{_0x9dc73a();if(_0x187443)requestAnimationFrame(()=>{const _0x341500=a0_0x53ca;_0xc1d5c7[_0x341500(0x260)]=_0xc1d5c7[_0x341500(0x21c)];});}):window[_0x4c75df(0x266)]('resize',_0x9dc73a),_0x9dc73a(),_0x1d7c10&&(_0x1d7c10['addEventListener'](_0x4c75df(0x241),()=>{requestAnimationFrame(_0x9dc73a);}),_0x1d7c10[_0x4c75df(0x266)]('focus',()=>{setTimeout(()=>{const _0x414e67=a0_0x53ca;_0xc1d5c7[_0x414e67(0x260)]=_0xc1d5c7[_0x414e67(0x21c)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x5932(){const _0x234fad=['remove','preventDefault','onClick','splice','input','search','#050505','Ошибка\x20сети','user','offsetHeight','modalConfirm','light','contains','expand','196734RnGzdT','viewportChanged','removeItem','2184495EVssEW','HapticFeedback','style','BackButton','touchend','setItem','clearBtn','ready','29138FWWKvK','disabled','994204hBdoQz','querySelector','none','message-time','success','target','1137808ThFvyp','Удалить?','scrollTop','function','onclick','textContent','offClick','Telegram','addEventListener','message-bubble','add','show','51RMHikZ','innerHeight','Действие\x20необратимо.','<br>','stopPropagation','disableVerticalSwipes','debug_uid','confirmModal','Пустой\x20ответ','length','display','touchstart','1953570RcsygX','TG\x20setup\x20error:','modalCancel','isVersionAtLeast','inputArea','messageInput','key','appendChild','message\x20ai','classList','flex','5106006xCnNXx','trim','toString','getElementById','medium','(((.+)+)+)+$','modalTitle','height','apply','chatArea','Начнется\x20новый\x20диалог.','ai_chat_messages','push','text','.container','sendBtn','from','auto','role','paddingBottom','stringify','viewportHeight','show-delete','text/plain','json','className','keydown','7ixIOVt','Ошибка\x20сервера','href','getItem','scrollHeight','WebApp','warn','signal','value','error','clear_history','.message.show-delete','./router.html','createElement','now','content','notificationOccurred','initData','send_message','padStart','first_name','Очистить\x20историю?','div','timestamp','getMinutes','abort','querySelectorAll','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','innerHTML','Enter','click','forEach','getHours','initDataUnsafe','impactOccurred','message\x20','typingIndicator'];a0_0x5932=function(){return _0x234fad;};return a0_0x5932();}const chatArea=document[a0_0x2e9545(0x200)](a0_0x2e9545(0x206)),emptyState=document[a0_0x2e9545(0x200)]('emptyState'),messageInput=document[a0_0x2e9545(0x200)](a0_0x2e9545(0x1f7)),sendBtn=document[a0_0x2e9545(0x200)](a0_0x2e9545(0x20c)),clearBtn=document[a0_0x2e9545(0x200)](a0_0x2e9545(0x254)),modal=document[a0_0x2e9545(0x200)](a0_0x2e9545(0x1ed)),mTitle=document[a0_0x2e9545(0x200)](a0_0x2e9545(0x203)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x3351b5,_0x375098){const _0xd8bab2=a0_0x2e9545,_0x2d5d15=tg?.[_0xd8bab2(0x239)]?.['user']||{},_0x5eff99=_0x2d5d15['id']||localStorage['getItem']('debug_uid')||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x2d5d15['id'])localStorage['setItem'](_0xd8bab2(0x1ec),_0x5eff99);const _0x3af07e={'action':_0x3351b5,'user_id':_0x5eff99,'user_data':{'first_name':_0x2d5d15[_0xd8bab2(0x22c)],'username':_0x2d5d15['username']},'init_data':tg?.[_0xd8bab2(0x229)]||'',..._0x375098},_0x1960f5=new AbortController(),_0x3234d0=setTimeout(()=>_0x1960f5[_0xd8bab2(0x231)](),REQUEST_TIMEOUT_MS);try{const _0x19b95a=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0xd8bab2(0x214)},'body':JSON['stringify'](_0x3af07e),'signal':_0x1960f5[_0xd8bab2(0x21f)]});return clearTimeout(_0x3234d0),await _0x19b95a[_0xd8bab2(0x215)]();}catch(_0x4f5bb1){return{'success':![],'error':String(_0x4f5bb1)};}}function formatTime(_0x3523f3){const _0x311c90=a0_0x2e9545,_0x48d5ab=new Date(_0x3523f3);return String(_0x48d5ab[_0x311c90(0x238)]())['padStart'](0x2,'0')+':'+String(_0x48d5ab[_0x311c90(0x230)]())[_0x311c90(0x22b)](0x2,'0');}function createMessageElement(_0xd16add,_0x34bf48){const _0x1a9042=a0_0x2e9545,_0x3accd7=document['createElement'](_0x1a9042(0x22e));_0x3accd7['className']=_0x1a9042(0x23b)+_0xd16add[_0x1a9042(0x20f)];const _0x2d15e7=document['createElement'](_0x1a9042(0x22e));_0x2d15e7[_0x1a9042(0x216)]=_0x1a9042(0x267),_0x2d15e7[_0x1a9042(0x234)]=_0xd16add[_0x1a9042(0x227)]['replace'](/\n/g,_0x1a9042(0x26d));const _0x4f22e3=document[_0x1a9042(0x225)](_0x1a9042(0x22e));_0x4f22e3[_0x1a9042(0x216)]='delete-btn',_0x4f22e3[_0x1a9042(0x234)]=_0x1a9042(0x233),_0x4f22e3[_0x1a9042(0x262)]=_0x3bc0ac=>{const _0x1809c5=_0x1a9042;_0x3bc0ac[_0x1809c5(0x1ea)](),confirmDelete(_0x34bf48);};let _0x3aae74;_0x2d15e7[_0x1a9042(0x266)](_0x1a9042(0x1f1),()=>_0x3aae74=setTimeout(()=>{const _0x535032=_0x1a9042;_0x3accd7[_0x535032(0x1fb)][_0x535032(0x268)](_0x535032(0x213));if(tg?.['HapticFeedback'])tg['HapticFeedback']['impactOccurred'](_0x535032(0x201));},0x1f4)),_0x2d15e7[_0x1a9042(0x266)](_0x1a9042(0x252),()=>clearTimeout(_0x3aae74));const _0x416b46=document[_0x1a9042(0x225)](_0x1a9042(0x22e));return _0x416b46[_0x1a9042(0x216)]=_0x1a9042(0x25b),_0x416b46['textContent']=formatTime(_0xd16add[_0x1a9042(0x22f)]),_0x3accd7['appendChild'](_0x4f22e3),_0x3accd7[_0x1a9042(0x1f9)](_0x2d15e7),_0x3accd7[_0x1a9042(0x1f9)](_0x416b46),_0x3accd7;}function createTypingIndicator(){const _0x140828=a0_0x2e9545,_0x280189=document[_0x140828(0x225)](_0x140828(0x22e));return _0x280189[_0x140828(0x216)]=_0x140828(0x1fa),_0x280189['id']=_0x140828(0x23c),_0x280189[_0x140828(0x234)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x280189;}function renderMessages(){const _0x50f603=a0_0x2e9545;Array[_0x50f603(0x20d)](chatArea['children'])[_0x50f603(0x237)](_0x220a03=>{const _0x20c1dd=_0x50f603;if(_0x220a03['id']!=='emptyState')_0x220a03[_0x20c1dd(0x23d)]();}),messages[_0x50f603(0x1ef)]>0x0?(emptyState[_0x50f603(0x250)][_0x50f603(0x1f0)]=_0x50f603(0x25a),messages['forEach']((_0x149f9c,_0x190030)=>chatArea[_0x50f603(0x1f9)](createMessageElement(_0x149f9c,_0x190030)))):emptyState['style']['display']=_0x50f603(0x1fc),requestAnimationFrame(()=>chatArea[_0x50f603(0x260)]=chatArea[_0x50f603(0x21c)]);}function autoResizeTextarea(){const _0x5400db=a0_0x2e9545;messageInput[_0x5400db(0x250)][_0x5400db(0x204)]=_0x5400db(0x20e),messageInput[_0x5400db(0x250)][_0x5400db(0x204)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x4d5ef8=a0_0x2e9545,_0x40eb1c=messageInput[_0x4d5ef8(0x220)][_0x4d5ef8(0x1fe)]();sendBtn[_0x4d5ef8(0x257)]=!_0x40eb1c||isTyping;}async function sendMessage(){const _0x24acf1=a0_0x2e9545,_0x42042f=messageInput[_0x24acf1(0x220)][_0x24acf1(0x1fe)]();if(!_0x42042f||isTyping)return;if(tg?.[_0x24acf1(0x24f)])tg[_0x24acf1(0x24f)]['impactOccurred'](_0x24acf1(0x248));messages[_0x24acf1(0x209)]({'role':_0x24acf1(0x245),'content':_0x42042f,'timestamp':Date[_0x24acf1(0x226)]()}),localStorage[_0x24acf1(0x253)](_0x24acf1(0x208),JSON[_0x24acf1(0x211)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x24acf1(0x1f9)](createTypingIndicator()),chatArea[_0x24acf1(0x260)]=chatArea[_0x24acf1(0x21c)];const _0x27cc81=await callBackend(_0x24acf1(0x22a),{'message':_0x42042f});isTyping=![];const _0x3e3bbd=document[_0x24acf1(0x200)](_0x24acf1(0x23c));if(_0x3e3bbd)_0x3e3bbd[_0x24acf1(0x23d)]();let _0x4bdb80=_0x24acf1(0x244);if(_0x27cc81[_0x24acf1(0x25c)]){_0x4bdb80=_0x27cc81[_0x24acf1(0x20a)]||_0x24acf1(0x1ee);if(tg?.[_0x24acf1(0x24f)])tg[_0x24acf1(0x24f)][_0x24acf1(0x228)]('success');}else{_0x4bdb80=_0x27cc81[_0x24acf1(0x221)]||_0x24acf1(0x219);if(tg?.[_0x24acf1(0x24f)])tg[_0x24acf1(0x24f)][_0x24acf1(0x228)](_0x24acf1(0x221));}messages[_0x24acf1(0x209)]({'role':'ai','content':_0x4bdb80,'timestamp':Date['now']()}),localStorage['setItem'](_0x24acf1(0x208),JSON[_0x24acf1(0x211)](messages)),renderMessages();}function confirmDelete(_0x32b5a3){const _0x2fd504=a0_0x2e9545;if(mTitle)mTitle[_0x2fd504(0x263)]=_0x2fd504(0x25f);if(mText)mText[_0x2fd504(0x263)]=_0x2fd504(0x26c);modalCallback=()=>{const _0x5071a0=_0x2fd504;messages[_0x5071a0(0x240)](_0x32b5a3,0x1),localStorage[_0x5071a0(0x253)](_0x5071a0(0x208),JSON[_0x5071a0(0x211)](messages)),renderMessages();},modal['classList']['add'](_0x2fd504(0x269));}if(clearBtn)clearBtn[a0_0x2e9545(0x262)]=()=>{const _0x1174b7=a0_0x2e9545;if(!messages[_0x1174b7(0x1ef)])return;if(mTitle)mTitle[_0x1174b7(0x263)]=_0x1174b7(0x22d);if(mText)mText[_0x1174b7(0x263)]=_0x1174b7(0x207);modalCallback=async()=>{const _0x42a051=_0x1174b7;messages=[],localStorage[_0x42a051(0x24d)](_0x42a051(0x208)),renderMessages(),callBackend(_0x42a051(0x222),{});},modal['classList']['add'](_0x1174b7(0x269));};document[a0_0x2e9545(0x200)](a0_0x2e9545(0x1f4))['onclick']=()=>modal[a0_0x2e9545(0x1fb)][a0_0x2e9545(0x23d)]('show'),document[a0_0x2e9545(0x200)](a0_0x2e9545(0x247))[a0_0x2e9545(0x262)]=()=>{const _0x140982=a0_0x2e9545;if(modalCallback)modalCallback();modal[_0x140982(0x1fb)][_0x140982(0x23d)](_0x140982(0x269));},messageInput[a0_0x2e9545(0x266)](a0_0x2e9545(0x241),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x2e9545(0x217),_0x1e0150=>{const _0x4889a4=a0_0x2e9545;_0x1e0150[_0x4889a4(0x1f8)]===_0x4889a4(0x235)&&!_0x1e0150['shiftKey']&&(_0x1e0150[_0x4889a4(0x23e)](),sendMessage());}),sendBtn[a0_0x2e9545(0x262)]=sendMessage,document[a0_0x2e9545(0x266)](a0_0x2e9545(0x236),_0x13c44a=>{const _0x53f300=a0_0x2e9545;document[_0x53f300(0x232)](_0x53f300(0x223))[_0x53f300(0x237)](_0x331f7c=>{const _0xf83a35=_0x53f300;if(!_0x331f7c[_0xf83a35(0x249)](_0x13c44a[_0xf83a35(0x25d)]))_0x331f7c[_0xf83a35(0x1fb)]['remove'](_0xf83a35(0x213));});});function a0_0x53ca(_0x595b0e,_0x3e2143){_0x595b0e=_0x595b0e-0x1ea;const _0x29e31d=a0_0x5932();let _0x5c55ee=_0x29e31d[_0x595b0e];return _0x5c55ee;}const saved=localStorage[a0_0x2e9545(0x21b)](a0_0x2e9545(0x208));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x284b25){}updateSendButton();