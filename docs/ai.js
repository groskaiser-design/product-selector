const a0_0x124dc6=a0_0x5bfc;(function(_0x2c285e,_0x38a8c3){const _0x5d783f=a0_0x5bfc,_0x1d303a=_0x2c285e();while(!![]){try{const _0x20c805=parseInt(_0x5d783f(0x1d1))/0x1+parseInt(_0x5d783f(0x16f))/0x2+-parseInt(_0x5d783f(0x194))/0x3+parseInt(_0x5d783f(0x1d7))/0x4+parseInt(_0x5d783f(0x19b))/0x5*(parseInt(_0x5d783f(0x18d))/0x6)+-parseInt(_0x5d783f(0x177))/0x7+-parseInt(_0x5d783f(0x1d3))/0x8;if(_0x20c805===_0x38a8c3)break;else _0x1d303a['push'](_0x1d303a['shift']());}catch(_0x142e4b){_0x1d303a['push'](_0x1d303a['shift']());}}}(a0_0x4dcf,0xf3edc));const tg=window[a0_0x124dc6(0x1ac)]?.[a0_0x124dc6(0x17a)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x126edc=a0_0x124dc6,_0x7da344=(function(){let _0x288cf2=!![];return function(_0x57960b,_0x254140){const _0x148be4=_0x288cf2?function(){const _0x5149fd=a0_0x5bfc;if(_0x254140){const _0x15b934=_0x254140[_0x5149fd(0x16e)](_0x57960b,arguments);return _0x254140=null,_0x15b934;}}:function(){};return _0x288cf2=![],_0x148be4;};}()),_0x3dcad6=_0x7da344(this,function(){const _0x4f76cd=a0_0x5bfc;return _0x3dcad6[_0x4f76cd(0x1c9)]()[_0x4f76cd(0x181)](_0x4f76cd(0x1a4))['toString']()[_0x4f76cd(0x1cd)](_0x3dcad6)[_0x4f76cd(0x181)](_0x4f76cd(0x1a4));});_0x3dcad6();if(!tg)return;try{tg[_0x126edc(0x19f)](),tg['expand'](),tg['setHeaderColor']?.(_0x126edc(0x184));if(tg['isVersionAtLeast']?.(_0x126edc(0x17e)))tg[_0x126edc(0x1aa)]?.();const _0x28324b=tg['BackButton'];if(_0x28324b){_0x28324b[_0x126edc(0x1e1)]();if(typeof _0x28324b[_0x126edc(0x179)]==='function')try{_0x28324b['offClick']();}catch(_0x34bb99){}_0x28324b[_0x126edc(0x19d)](()=>{const _0x45c970=_0x126edc;if(tg[_0x45c970(0x198)])tg[_0x45c970(0x198)][_0x45c970(0x1dc)](_0x45c970(0x19e));location[_0x45c970(0x197)]=HOME_URL;});}}catch(_0x26e9b8){console[_0x126edc(0x186)](_0x126edc(0x195),_0x26e9b8);}}(function initStableLayout(){const _0x201f4c=a0_0x124dc6,_0x2ef277=document[_0x201f4c(0x1c6)](_0x201f4c(0x1b9)),_0x42776a=document['getElementById'](_0x201f4c(0x1ce)),_0x5c6955=document['getElementById'](_0x201f4c(0x1bd)),_0x44c19b=document[_0x201f4c(0x1ab)](_0x201f4c(0x1b8));function _0x4857a4(){const _0x24e88e=_0x201f4c;if(!_0x2ef277)return;const _0x34ad03=tg&&tg[_0x24e88e(0x174)]?tg[_0x24e88e(0x174)]:window['innerHeight'];_0x2ef277[_0x24e88e(0x1b1)][_0x24e88e(0x171)]=_0x34ad03+'px';if(_0x42776a){const _0x2a3431=_0x42776a[_0x24e88e(0x1d6)];_0x5c6955[_0x24e88e(0x1b1)][_0x24e88e(0x187)]=_0x2a3431+0x28+'px';}}tg?tg['onEvent'](_0x201f4c(0x18e),({isStateStable:_0x162827})=>{_0x4857a4();if(_0x162827)requestAnimationFrame(()=>{const _0x2a8d39=a0_0x5bfc;_0x5c6955[_0x2a8d39(0x185)]=_0x5c6955[_0x2a8d39(0x173)];});}):window[_0x201f4c(0x1a6)](_0x201f4c(0x18f),_0x4857a4),_0x4857a4(),_0x44c19b&&(_0x44c19b['addEventListener'](_0x201f4c(0x178),()=>{requestAnimationFrame(_0x4857a4);}),_0x44c19b[_0x201f4c(0x1a6)]('focus',()=>{setTimeout(()=>{const _0x4b5508=a0_0x5bfc;_0x5c6955[_0x4b5508(0x185)]=_0x5c6955[_0x4b5508(0x173)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;function a0_0x4dcf(){const _0x18a3a5=['getItem','initDataUnsafe','(((.+)+)+)+$','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','addEventListener','div','.message.show-delete','success','disableVerticalSwipes','getElementById','Telegram','length','typingIndicator','Ошибка\x20сервера','modalConfirm','style','keydown','className','touchstart','message\x20','first_name','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','messageInput','.container','confirmModal','classList','timestamp','chatArea','clear_history','min','sendBtn','contains','delete-btn','clearBtn','medium','preventDefault','querySelector','now','splice','toString','trim','stringify','error','constructor','inputArea','shiftKey','send_message','761038hYkwyy','innerHTML','2040448AqFDaF','signal','<br>','offsetHeight','1716472BaogaK','notificationOccurred','onclick','setItem','show-delete','impactOccurred','Ошибка\x20сети','add','text','remove','show','removeItem','stopPropagation','apply','2212524vDAKSC','from','height','padStart','scrollHeight','viewportHeight','display','value','3422440WODKUd','input','offClick','WebApp','disabled','role','getMinutes','6.1','floor','getHours','search','message\x20ai','appendChild','#050505','scrollTop','warn','paddingBottom','createElement','modalTitle','Пустой\x20ответ','touchend','key','6vCuWAQ','viewportChanged','resize','user','Очистить\x20историю?','push','ai_chat_messages','5754687prCWtj','TG\x20setup\x20error:','debug_uid','href','HapticFeedback','Действие\x20необратимо.','emptyState','6824595uxopEB','forEach','onClick','light','ready','text/plain','textContent'];a0_0x4dcf=function(){return _0x18a3a5;};return a0_0x4dcf();}let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x124dc6(0x1bd)),emptyState=document[a0_0x124dc6(0x1ab)](a0_0x124dc6(0x19a)),messageInput=document[a0_0x124dc6(0x1ab)](a0_0x124dc6(0x1b8)),sendBtn=document[a0_0x124dc6(0x1ab)](a0_0x124dc6(0x1c0)),clearBtn=document[a0_0x124dc6(0x1ab)](a0_0x124dc6(0x1c3)),modal=document[a0_0x124dc6(0x1ab)](a0_0x124dc6(0x1ba)),mTitle=document[a0_0x124dc6(0x1ab)](a0_0x124dc6(0x189)),mText=document[a0_0x124dc6(0x1ab)]('modalText');let modalCallback=null;async function callBackend(_0x27a90b,_0x224ab0){const _0x235643=a0_0x124dc6,_0x4ae370=tg?.[_0x235643(0x1a3)]?.[_0x235643(0x190)]||{},_0x35742a=_0x4ae370['id']||localStorage['getItem'](_0x235643(0x196))||'d-'+Math[_0x235643(0x17f)](Math['random']()*0x3b9aca00);if(!_0x4ae370['id'])localStorage['setItem'](_0x235643(0x196),_0x35742a);const _0x39ffb9={'action':_0x27a90b,'user_id':_0x35742a,'user_data':{'first_name':_0x4ae370[_0x235643(0x1b6)],'username':_0x4ae370['username']},'init_data':tg?.['initData']||'',..._0x224ab0},_0xf2411c=new AbortController(),_0x2a5e9d=setTimeout(()=>_0xf2411c['abort'](),REQUEST_TIMEOUT_MS);try{const _0x4c62a3=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x235643(0x1a0)},'body':JSON[_0x235643(0x1cb)](_0x39ffb9),'signal':_0xf2411c[_0x235643(0x1d4)]});return clearTimeout(_0x2a5e9d),await _0x4c62a3['json']();}catch(_0x5338db){return{'success':![],'error':String(_0x5338db)};}}function formatTime(_0x58ecd5){const _0x81d84=a0_0x124dc6,_0x4b58ac=new Date(_0x58ecd5);return String(_0x4b58ac[_0x81d84(0x180)]())[_0x81d84(0x172)](0x2,'0')+':'+String(_0x4b58ac[_0x81d84(0x17d)]())['padStart'](0x2,'0');}function createMessageElement(_0x3406ec,_0x59f155){const _0x1063d5=a0_0x124dc6,_0x44ad5d=document[_0x1063d5(0x188)](_0x1063d5(0x1a7));_0x44ad5d['className']=_0x1063d5(0x1b5)+_0x3406ec[_0x1063d5(0x17c)];const _0x90c5f2=document[_0x1063d5(0x188)]('div');_0x90c5f2[_0x1063d5(0x1b3)]='message-bubble',_0x90c5f2[_0x1063d5(0x1d2)]=_0x3406ec['content']['replace'](/\n/g,_0x1063d5(0x1d5));const _0x5824c2=document[_0x1063d5(0x188)](_0x1063d5(0x1a7));_0x5824c2[_0x1063d5(0x1b3)]=_0x1063d5(0x1c2),_0x5824c2[_0x1063d5(0x1d2)]=_0x1063d5(0x1a5),_0x5824c2[_0x1063d5(0x1d9)]=_0x4de7f6=>{const _0x2961e6=_0x1063d5;_0x4de7f6[_0x2961e6(0x1e3)](),confirmDelete(_0x59f155);};let _0x3bb679;_0x90c5f2[_0x1063d5(0x1a6)](_0x1063d5(0x1b4),()=>_0x3bb679=setTimeout(()=>{const _0x598ee5=_0x1063d5;_0x44ad5d[_0x598ee5(0x1bb)][_0x598ee5(0x1de)](_0x598ee5(0x1db));if(tg?.[_0x598ee5(0x198)])tg[_0x598ee5(0x198)]['impactOccurred'](_0x598ee5(0x1c4));},0x1f4)),_0x90c5f2[_0x1063d5(0x1a6)](_0x1063d5(0x18b),()=>clearTimeout(_0x3bb679));const _0xdec5be=document[_0x1063d5(0x188)](_0x1063d5(0x1a7));return _0xdec5be[_0x1063d5(0x1b3)]='message-time',_0xdec5be['textContent']=formatTime(_0x3406ec[_0x1063d5(0x1bc)]),_0x44ad5d[_0x1063d5(0x183)](_0x5824c2),_0x44ad5d['appendChild'](_0x90c5f2),_0x44ad5d[_0x1063d5(0x183)](_0xdec5be),_0x44ad5d;}function createTypingIndicator(){const _0x4bdddc=a0_0x124dc6,_0x1b362b=document[_0x4bdddc(0x188)](_0x4bdddc(0x1a7));return _0x1b362b[_0x4bdddc(0x1b3)]=_0x4bdddc(0x182),_0x1b362b['id']=_0x4bdddc(0x1ae),_0x1b362b['innerHTML']=_0x4bdddc(0x1b7),_0x1b362b;}function renderMessages(){const _0x1a26e8=a0_0x124dc6;Array[_0x1a26e8(0x170)](chatArea['children'])[_0x1a26e8(0x19c)](_0x10a46a=>{const _0x11c997=_0x1a26e8;if(_0x10a46a['id']!==_0x11c997(0x19a))_0x10a46a['remove']();}),messages[_0x1a26e8(0x1ad)]>0x0?(emptyState['style'][_0x1a26e8(0x175)]='none',messages[_0x1a26e8(0x19c)]((_0x1aace2,_0x19116a)=>chatArea[_0x1a26e8(0x183)](createMessageElement(_0x1aace2,_0x19116a)))):emptyState['style'][_0x1a26e8(0x175)]='flex',requestAnimationFrame(()=>chatArea[_0x1a26e8(0x185)]=chatArea[_0x1a26e8(0x173)]);}function autoResizeTextarea(){const _0xe20789=a0_0x124dc6;messageInput[_0xe20789(0x1b1)][_0xe20789(0x171)]='auto',messageInput[_0xe20789(0x1b1)][_0xe20789(0x171)]=Math[_0xe20789(0x1bf)](messageInput[_0xe20789(0x173)],0x78)+'px';}function updateSendButton(){const _0x51fe9d=a0_0x124dc6,_0x50cd3c=messageInput[_0x51fe9d(0x176)][_0x51fe9d(0x1ca)]();sendBtn[_0x51fe9d(0x17b)]=!_0x50cd3c||isTyping;}async function sendMessage(){const _0x1c8969=a0_0x124dc6,_0x5d53b2=messageInput[_0x1c8969(0x176)][_0x1c8969(0x1ca)]();if(!_0x5d53b2||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x1c8969(0x1dc)](_0x1c8969(0x19e));messages[_0x1c8969(0x192)]({'role':_0x1c8969(0x190),'content':_0x5d53b2,'timestamp':Date[_0x1c8969(0x1c7)]()}),localStorage['setItem'](_0x1c8969(0x193),JSON['stringify'](messages)),renderMessages(),messageInput[_0x1c8969(0x176)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1c8969(0x183)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x1c8969(0x173)];const _0x909b88=await callBackend(_0x1c8969(0x1d0),{'message':_0x5d53b2});isTyping=![];const _0x4bfb6a=document[_0x1c8969(0x1ab)](_0x1c8969(0x1ae));if(_0x4bfb6a)_0x4bfb6a[_0x1c8969(0x1e0)]();let _0x4870b3=_0x1c8969(0x1dd);if(_0x909b88[_0x1c8969(0x1a9)]){_0x4870b3=_0x909b88[_0x1c8969(0x1df)]||_0x1c8969(0x18a);if(tg?.[_0x1c8969(0x198)])tg['HapticFeedback'][_0x1c8969(0x1d8)](_0x1c8969(0x1a9));}else{_0x4870b3=_0x909b88[_0x1c8969(0x1cc)]||_0x1c8969(0x1af);if(tg?.['HapticFeedback'])tg[_0x1c8969(0x198)][_0x1c8969(0x1d8)](_0x1c8969(0x1cc));}messages[_0x1c8969(0x192)]({'role':'ai','content':_0x4870b3,'timestamp':Date[_0x1c8969(0x1c7)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x1c8969(0x1cb)](messages)),renderMessages();}function a0_0x5bfc(_0x3ca5b5,_0x4b3a75){_0x3ca5b5=_0x3ca5b5-0x16e;const _0x3d984b=a0_0x4dcf();let _0x5addc8=_0x3d984b[_0x3ca5b5];return _0x5addc8;}function confirmDelete(_0x475268){const _0x9dc628=a0_0x124dc6;if(mTitle)mTitle[_0x9dc628(0x1a1)]='Удалить?';if(mText)mText[_0x9dc628(0x1a1)]=_0x9dc628(0x199);modalCallback=()=>{const _0x298e38=_0x9dc628;messages[_0x298e38(0x1c8)](_0x475268,0x1),localStorage[_0x298e38(0x1da)](_0x298e38(0x193),JSON['stringify'](messages)),renderMessages();},modal[_0x9dc628(0x1bb)][_0x9dc628(0x1de)]('show');}if(clearBtn)clearBtn[a0_0x124dc6(0x1d9)]=()=>{const _0x47a3aa=a0_0x124dc6;if(!messages['length'])return;if(mTitle)mTitle[_0x47a3aa(0x1a1)]=_0x47a3aa(0x191);if(mText)mText[_0x47a3aa(0x1a1)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x275ab1=_0x47a3aa;messages=[],localStorage[_0x275ab1(0x1e2)]('ai_chat_messages'),renderMessages(),callBackend(_0x275ab1(0x1be),{});},modal[_0x47a3aa(0x1bb)]['add'](_0x47a3aa(0x1e1));};document['getElementById']('modalCancel')['onclick']=()=>modal['classList']['remove'](a0_0x124dc6(0x1e1)),document[a0_0x124dc6(0x1ab)](a0_0x124dc6(0x1b0))[a0_0x124dc6(0x1d9)]=()=>{const _0x16de87=a0_0x124dc6;if(modalCallback)modalCallback();modal[_0x16de87(0x1bb)][_0x16de87(0x1e0)](_0x16de87(0x1e1));},messageInput[a0_0x124dc6(0x1a6)](a0_0x124dc6(0x178),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x124dc6(0x1a6)](a0_0x124dc6(0x1b2),_0x520686=>{const _0x4f940b=a0_0x124dc6;_0x520686[_0x4f940b(0x18c)]==='Enter'&&!_0x520686[_0x4f940b(0x1cf)]&&(_0x520686[_0x4f940b(0x1c5)](),sendMessage());}),sendBtn[a0_0x124dc6(0x1d9)]=sendMessage,document[a0_0x124dc6(0x1a6)]('click',_0x1627e7=>{const _0x5a9fed=a0_0x124dc6;document['querySelectorAll'](_0x5a9fed(0x1a8))[_0x5a9fed(0x19c)](_0x4790b8=>{const _0x3e2e75=_0x5a9fed;if(!_0x4790b8[_0x3e2e75(0x1c1)](_0x1627e7['target']))_0x4790b8['classList']['remove'](_0x3e2e75(0x1db));});});const saved=localStorage[a0_0x124dc6(0x1a2)](a0_0x124dc6(0x193));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x43fcb3){}updateSendButton();