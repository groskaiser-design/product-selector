const a0_0x274a48=a0_0x211a;(function(_0x447340,_0x39694d){const _0x41ce71=a0_0x211a,_0x391913=_0x447340();while(!![]){try{const _0xc35e2e=parseInt(_0x41ce71(0xef))/0x1+-parseInt(_0x41ce71(0x155))/0x2+-parseInt(_0x41ce71(0x12e))/0x3*(-parseInt(_0x41ce71(0x12b))/0x4)+parseInt(_0x41ce71(0x100))/0x5*(parseInt(_0x41ce71(0x113))/0x6)+parseInt(_0x41ce71(0x124))/0x7+-parseInt(_0x41ce71(0xf8))/0x8*(parseInt(_0x41ce71(0xea))/0x9)+parseInt(_0x41ce71(0x112))/0xa*(-parseInt(_0x41ce71(0x107))/0xb);if(_0xc35e2e===_0x39694d)break;else _0x391913['push'](_0x391913['shift']());}catch(_0x169372){_0x391913['push'](_0x391913['shift']());}}}(a0_0x203b,0xaf288));const tg=window[a0_0x274a48(0xff)]?.['WebApp'],HOME_URL=a0_0x274a48(0x13c);function setupTelegramBackButton(){const _0x2e16c3=a0_0x274a48;if(!tg)return;try{tg['ready'](),tg[_0x2e16c3(0x135)](),tg[_0x2e16c3(0x105)]?.(_0x2e16c3(0x115));if(tg[_0x2e16c3(0x11b)]?.(_0x2e16c3(0x15b)))tg[_0x2e16c3(0x150)]?.();const _0x40fcea=tg['BackButton'];if(_0x40fcea){_0x40fcea[_0x2e16c3(0x147)]();if(typeof _0x40fcea[_0x2e16c3(0x10b)]===_0x2e16c3(0x10a))try{_0x40fcea[_0x2e16c3(0x10b)]();}catch(_0x1817ba){}_0x40fcea['onClick'](()=>{const _0x20b8d8=_0x2e16c3;if(tg[_0x20b8d8(0xe7)])tg[_0x20b8d8(0xe7)][_0x20b8d8(0x14f)]('light');location[_0x20b8d8(0x158)]=HOME_URL;});}}catch(_0x4a5415){console['warn'](_0x2e16c3(0x157),_0x4a5415);}}(function initStableLayout(){const _0x1d0ec3=a0_0x274a48,_0x2c3174=(function(){let _0x4e4f0f=!![];return function(_0x5f2ef0,_0xee168a){const _0x3230fb=_0x4e4f0f?function(){const _0x393c15=a0_0x211a;if(_0xee168a){const _0x138d2f=_0xee168a[_0x393c15(0x11c)](_0x5f2ef0,arguments);return _0xee168a=null,_0x138d2f;}}:function(){};return _0x4e4f0f=![],_0x3230fb;};}()),_0xbe6e34=document[_0x1d0ec3(0x148)]('.container'),_0x17c385=document[_0x1d0ec3(0xe3)](_0x1d0ec3(0xfd)),_0x2a412d=document[_0x1d0ec3(0xe3)](_0x1d0ec3(0xec)),_0x2522a9=document[_0x1d0ec3(0xe3)](_0x1d0ec3(0x140));function _0x86302a(){const _0x4e2242=_0x1d0ec3,_0x47a492=_0x2c3174(this,function(){const _0x522d17=a0_0x211a;return _0x47a492[_0x522d17(0x119)]()[_0x522d17(0x153)](_0x522d17(0x111))[_0x522d17(0x119)]()[_0x522d17(0x154)](_0x47a492)[_0x522d17(0x153)](_0x522d17(0x111));});_0x47a492();if(!_0xbe6e34)return;const _0x2652ce=tg&&tg['viewportHeight']?tg[_0x4e2242(0xf9)]:window[_0x4e2242(0x114)];_0xbe6e34[_0x4e2242(0x128)][_0x4e2242(0xf5)]=_0x2652ce+'px';if(_0x17c385){const _0x3c8174=_0x17c385['offsetHeight'];_0x2a412d[_0x4e2242(0x128)][_0x4e2242(0x104)]=_0x3c8174+0x28+'px';}}tg?tg[_0x1d0ec3(0x120)](_0x1d0ec3(0x151),({isStateStable:_0x3b8e9f})=>{_0x86302a();if(_0x3b8e9f)requestAnimationFrame(()=>{const _0x375677=a0_0x211a;_0x2a412d[_0x375677(0xfc)]=_0x2a412d['scrollHeight'];});}):window[_0x1d0ec3(0x141)]('resize',_0x86302a),_0x86302a(),_0x2522a9&&(_0x2522a9[_0x1d0ec3(0x141)](_0x1d0ec3(0xe9),()=>{requestAnimationFrame(_0x86302a);}),_0x2522a9[_0x1d0ec3(0x141)](_0x1d0ec3(0x14d),()=>{setTimeout(()=>{const _0x4b7b61=a0_0x211a;_0x2a412d[_0x4b7b61(0xfc)]=_0x2a412d[_0x4b7b61(0x131)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x274a48(0xe3)](a0_0x274a48(0xec)),emptyState=document[a0_0x274a48(0xe3)](a0_0x274a48(0x122)),messageInput=document[a0_0x274a48(0xe3)]('messageInput'),sendBtn=document[a0_0x274a48(0xe3)](a0_0x274a48(0x159)),clearBtn=document[a0_0x274a48(0xe3)](a0_0x274a48(0x14c)),modal=document[a0_0x274a48(0xe3)](a0_0x274a48(0x127)),mTitle=document[a0_0x274a48(0xe3)](a0_0x274a48(0x142)),mText=document['getElementById'](a0_0x274a48(0xe4));function a0_0x211a(_0x1f2e71,_0x2b82e5){_0x1f2e71=_0x1f2e71-0xe3;const _0x1196d3=a0_0x203b();let _0xa5fdb8=_0x1196d3[_0x1f2e71];return _0xa5fdb8;}let modalCallback=null;async function callBackend(_0x2d9cb8,_0x32303a){const _0x4f5d53=a0_0x274a48,_0x409663=tg?.[_0x4f5d53(0x110)]?.['user']||{},_0xbff521=_0x409663['id']||localStorage['getItem'](_0x4f5d53(0x10e))||'d-'+Math[_0x4f5d53(0x11f)](Math['random']()*0x3b9aca00);if(!_0x409663['id'])localStorage[_0x4f5d53(0x106)]('debug_uid',_0xbff521);const _0x43fb23={'action':_0x2d9cb8,'user_id':_0xbff521,'user_data':{'first_name':_0x409663['first_name'],'username':_0x409663[_0x4f5d53(0x11d)]},'init_data':tg?.['initData']||'',..._0x32303a},_0x2b118d=new AbortController(),_0x204e21=setTimeout(()=>_0x2b118d[_0x4f5d53(0x103)](),REQUEST_TIMEOUT_MS);try{const _0x28077c=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x4f5d53(0xfb)},'body':JSON[_0x4f5d53(0x130)](_0x43fb23),'signal':_0x2b118d[_0x4f5d53(0x14e)]});return clearTimeout(_0x204e21),await _0x28077c['json']();}catch(_0x4af737){return{'success':![],'error':String(_0x4af737)};}}function formatTime(_0x16b568){const _0x4877fc=a0_0x274a48,_0x188b14=new Date(_0x16b568);return String(_0x188b14[_0x4877fc(0x109)]())[_0x4877fc(0x12f)](0x2,'0')+':'+String(_0x188b14[_0x4877fc(0x138)]())['padStart'](0x2,'0');}function createMessageElement(_0x462429,_0x4579e2){const _0x24a694=a0_0x274a48,_0x1813f4=document[_0x24a694(0x101)](_0x24a694(0xf2));_0x1813f4[_0x24a694(0x152)]=_0x24a694(0x14b)+_0x462429[_0x24a694(0x137)];const _0x1b1249=document[_0x24a694(0x101)]('div');_0x1b1249['className']=_0x24a694(0xeb),_0x1b1249[_0x24a694(0xfa)]=_0x462429['content']['replace'](/\n/g,'<br>');const _0x5dd376=document[_0x24a694(0x101)](_0x24a694(0xf2));_0x5dd376['className']=_0x24a694(0x144),_0x5dd376['innerHTML']=_0x24a694(0xf0),_0x5dd376[_0x24a694(0x10d)]=_0x3fd835=>{_0x3fd835['stopPropagation'](),confirmDelete(_0x4579e2);};let _0xc6efa;_0x1b1249['addEventListener'](_0x24a694(0x143),()=>_0xc6efa=setTimeout(()=>{const _0x56b33d=_0x24a694;_0x1813f4['classList'][_0x56b33d(0xed)]('show-delete');if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x56b33d(0x14f)](_0x56b33d(0x118));},0x1f4)),_0x1b1249['addEventListener'](_0x24a694(0x126),()=>clearTimeout(_0xc6efa));const _0xc17cc7=document[_0x24a694(0x101)]('div');return _0xc17cc7['className']=_0x24a694(0xe6),_0xc17cc7[_0x24a694(0x123)]=formatTime(_0x462429[_0x24a694(0x13a)]),_0x1813f4[_0x24a694(0x15a)](_0x5dd376),_0x1813f4[_0x24a694(0x15a)](_0x1b1249),_0x1813f4[_0x24a694(0x15a)](_0xc17cc7),_0x1813f4;}function createTypingIndicator(){const _0x32d3f7=a0_0x274a48,_0x23ab22=document[_0x32d3f7(0x101)](_0x32d3f7(0xf2));return _0x23ab22[_0x32d3f7(0x152)]=_0x32d3f7(0xee),_0x23ab22['id']='typingIndicator',_0x23ab22['innerHTML']=_0x32d3f7(0xe5),_0x23ab22;}function a0_0x203b(){const _0x2d9768=['Enter','message\x20','clearBtn','focus','signal','impactOccurred','disableVerticalSwipes','viewportChanged','className','search','constructor','298502UxDKgg','removeItem','TG\x20setup\x20error:','href','sendBtn','appendChild','6.1','getElementById','modalText','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','message-time','HapticFeedback','auto','input','49986qNFEPJ','message-bubble','chatArea','add','message\x20ai','508917IjRNfz','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','length','div','Пустой\x20ответ','from','height','keydown','key','912zTzquF','viewportHeight','innerHTML','text/plain','scrollTop','inputArea','error','Telegram','62320UnuAQA','createElement','text','abort','paddingBottom','setHeaderColor','setItem','11dsyRsw','parse','getHours','function','offClick','target','onclick','debug_uid','Ошибка\x20сервера','initDataUnsafe','(((.+)+)+)+$','7949850PaMiLa','420ftDgxL','innerHeight','#050505','contains','value','medium','toString','getItem','isVersionAtLeast','apply','username','querySelectorAll','floor','onEvent','display','emptyState','textContent','1139425wWYyTB','forEach','touchend','confirmModal','style','classList','.message.show-delete','8ekspNg','disabled','Очистить\x20историю?','1126002qGmFLw','padStart','stringify','scrollHeight','success','send_message','ai_chat_messages','expand','Действие\x20необратимо.','role','getMinutes','children','timestamp','preventDefault','./router.html','notificationOccurred','trim','flex','messageInput','addEventListener','modalTitle','touchstart','delete-btn','remove','now','show','querySelector','push'];a0_0x203b=function(){return _0x2d9768;};return a0_0x203b();}function renderMessages(){const _0x4c8fdf=a0_0x274a48;Array[_0x4c8fdf(0xf4)](chatArea[_0x4c8fdf(0x139)])[_0x4c8fdf(0x125)](_0x260555=>{const _0x5deb15=_0x4c8fdf;if(_0x260555['id']!==_0x5deb15(0x122))_0x260555[_0x5deb15(0x145)]();}),messages[_0x4c8fdf(0xf1)]>0x0?(emptyState[_0x4c8fdf(0x128)][_0x4c8fdf(0x121)]='none',messages[_0x4c8fdf(0x125)]((_0x4b8b6c,_0x36489c)=>chatArea['appendChild'](createMessageElement(_0x4b8b6c,_0x36489c)))):emptyState[_0x4c8fdf(0x128)][_0x4c8fdf(0x121)]=_0x4c8fdf(0x13f),requestAnimationFrame(()=>chatArea[_0x4c8fdf(0xfc)]=chatArea[_0x4c8fdf(0x131)]);}function autoResizeTextarea(){const _0x2b1071=a0_0x274a48;messageInput[_0x2b1071(0x128)][_0x2b1071(0xf5)]=_0x2b1071(0xe8),messageInput['style'][_0x2b1071(0xf5)]=Math['min'](messageInput[_0x2b1071(0x131)],0x78)+'px';}function updateSendButton(){const _0x1f6807=a0_0x274a48,_0x334a1e=messageInput[_0x1f6807(0x117)][_0x1f6807(0x13e)]();sendBtn[_0x1f6807(0x12c)]=!_0x334a1e||isTyping;}async function sendMessage(){const _0x53fcfc=a0_0x274a48,_0x46bd9a=messageInput[_0x53fcfc(0x117)][_0x53fcfc(0x13e)]();if(!_0x46bd9a||isTyping)return;if(tg?.[_0x53fcfc(0xe7)])tg[_0x53fcfc(0xe7)]['impactOccurred']('light');messages[_0x53fcfc(0x149)]({'role':'user','content':_0x46bd9a,'timestamp':Date['now']()}),localStorage[_0x53fcfc(0x106)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x30a140=await callBackend(_0x53fcfc(0x133),{'message':_0x46bd9a});isTyping=![];const _0x492b88=document['getElementById']('typingIndicator');if(_0x492b88)_0x492b88[_0x53fcfc(0x145)]();let _0x36b85c='Ошибка\x20сети';if(_0x30a140[_0x53fcfc(0x132)]){_0x36b85c=_0x30a140[_0x53fcfc(0x102)]||_0x53fcfc(0xf3);if(tg?.['HapticFeedback'])tg[_0x53fcfc(0xe7)][_0x53fcfc(0x13d)](_0x53fcfc(0x132));}else{_0x36b85c=_0x30a140[_0x53fcfc(0xfe)]||_0x53fcfc(0x10f);if(tg?.[_0x53fcfc(0xe7)])tg[_0x53fcfc(0xe7)][_0x53fcfc(0x13d)](_0x53fcfc(0xfe));}messages['push']({'role':'ai','content':_0x36b85c,'timestamp':Date[_0x53fcfc(0x146)]()}),localStorage[_0x53fcfc(0x106)](_0x53fcfc(0x134),JSON[_0x53fcfc(0x130)](messages)),renderMessages();}function confirmDelete(_0xd62748){const _0x32506c=a0_0x274a48;if(mTitle)mTitle[_0x32506c(0x123)]='Удалить?';if(mText)mText['textContent']=_0x32506c(0x136);modalCallback=()=>{const _0xd27e29=_0x32506c;messages['splice'](_0xd62748,0x1),localStorage[_0xd27e29(0x106)](_0xd27e29(0x134),JSON['stringify'](messages)),renderMessages();},modal[_0x32506c(0x129)][_0x32506c(0xed)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0x674b7a=a0_0x274a48;if(!messages[_0x674b7a(0xf1)])return;if(mTitle)mTitle[_0x674b7a(0x123)]=_0x674b7a(0x12d);if(mText)mText[_0x674b7a(0x123)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x27abd1=_0x674b7a;messages=[],localStorage[_0x27abd1(0x156)](_0x27abd1(0x134)),renderMessages(),callBackend('clear_history',{});},modal[_0x674b7a(0x129)]['add'](_0x674b7a(0x147));};document[a0_0x274a48(0xe3)]('modalCancel')[a0_0x274a48(0x10d)]=()=>modal[a0_0x274a48(0x129)][a0_0x274a48(0x145)](a0_0x274a48(0x147)),document[a0_0x274a48(0xe3)]('modalConfirm')[a0_0x274a48(0x10d)]=()=>{const _0x192e8a=a0_0x274a48;if(modalCallback)modalCallback();modal[_0x192e8a(0x129)]['remove']('show');},messageInput[a0_0x274a48(0x141)](a0_0x274a48(0xe9),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x274a48(0xf6),_0x365e4f=>{const _0x335ee4=a0_0x274a48;_0x365e4f[_0x335ee4(0xf7)]===_0x335ee4(0x14a)&&!_0x365e4f['shiftKey']&&(_0x365e4f[_0x335ee4(0x13b)](),sendMessage());}),sendBtn[a0_0x274a48(0x10d)]=sendMessage,document[a0_0x274a48(0x141)]('click',_0x418e5d=>{const _0x16c025=a0_0x274a48;document[_0x16c025(0x11e)](_0x16c025(0x12a))[_0x16c025(0x125)](_0x223ee5=>{const _0x412b07=_0x16c025;if(!_0x223ee5[_0x412b07(0x116)](_0x418e5d[_0x412b07(0x10c)]))_0x223ee5['classList'][_0x412b07(0x145)]('show-delete');});});const saved=localStorage[a0_0x274a48(0x11a)](a0_0x274a48(0x134));if(saved)try{messages=JSON[a0_0x274a48(0x108)](saved),renderMessages();}catch(a0_0x34f7d8){}updateSendButton();