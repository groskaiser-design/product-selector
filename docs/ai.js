const a0_0x4dfe0d=a0_0x5cfd;(function(_0x89a94e,_0x259f0d){const _0x348f6a=a0_0x5cfd,_0xe6e1a7=_0x89a94e();while(!![]){try{const _0x7f6387=-parseInt(_0x348f6a(0x214))/0x1+parseInt(_0x348f6a(0x1e8))/0x2+-parseInt(_0x348f6a(0x222))/0x3*(-parseInt(_0x348f6a(0x1d7))/0x4)+parseInt(_0x348f6a(0x1fa))/0x5*(parseInt(_0x348f6a(0x235))/0x6)+-parseInt(_0x348f6a(0x1ea))/0x7+-parseInt(_0x348f6a(0x202))/0x8+parseInt(_0x348f6a(0x1e1))/0x9*(parseInt(_0x348f6a(0x21f))/0xa);if(_0x7f6387===_0x259f0d)break;else _0xe6e1a7['push'](_0xe6e1a7['shift']());}catch(_0x137ad3){_0xe6e1a7['push'](_0xe6e1a7['shift']());}}}(a0_0x52ee,0x5088e));const tg=window['Telegram']?.[a0_0x4dfe0d(0x226)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x35d3cd=a0_0x4dfe0d;if(!tg)return;try{tg['ready'](),tg['expand'](),tg['setHeaderColor']?.(_0x35d3cd(0x1cb));if(tg[_0x35d3cd(0x22d)]?.(_0x35d3cd(0x1d4)))tg['disableVerticalSwipes']?.();const _0x30f5c7=tg[_0x35d3cd(0x1f4)];if(_0x30f5c7){_0x30f5c7[_0x35d3cd(0x1c9)]();if(typeof _0x30f5c7['offClick']==='function')try{_0x30f5c7[_0x35d3cd(0x1fc)]();}catch(_0x3f8129){}_0x30f5c7['onClick'](()=>{const _0x115f6e=_0x35d3cd;if(tg[_0x115f6e(0x22f)])tg[_0x115f6e(0x22f)][_0x115f6e(0x216)](_0x115f6e(0x1d3));location['href']=HOME_URL;});}}catch(_0x30349d){console[_0x35d3cd(0x1fe)]('TG\x20setup\x20error:',_0x30349d);}}(function initStableLayout(){const _0x4ac8f0=a0_0x4dfe0d,_0x5b0f9c=(function(){let _0x11806b=!![];return function(_0x2d1aa3,_0x475b3d){const _0x473418=_0x11806b?function(){const _0x372490=a0_0x5cfd;if(_0x475b3d){const _0x509bf1=_0x475b3d[_0x372490(0x1bd)](_0x2d1aa3,arguments);return _0x475b3d=null,_0x509bf1;}}:function(){};return _0x11806b=![],_0x473418;};}()),_0x30de78=document[_0x4ac8f0(0x1be)]('.container'),_0x495713=document[_0x4ac8f0(0x207)](_0x4ac8f0(0x234)),_0x3e941d=document[_0x4ac8f0(0x207)](_0x4ac8f0(0x230)),_0xefc5b=document[_0x4ac8f0(0x207)]('messageInput');function _0x3118aa(){const _0x4913b5=_0x4ac8f0,_0x2a80a6=_0x5b0f9c(this,function(){const _0x3b373a=a0_0x5cfd;return _0x2a80a6['toString']()[_0x3b373a(0x1dd)](_0x3b373a(0x1e5))['toString']()['constructor'](_0x2a80a6)['search'](_0x3b373a(0x1e5));});_0x2a80a6();if(!_0x30de78)return;const _0x43fd2f=tg&&tg[_0x4913b5(0x205)]?tg[_0x4913b5(0x205)]:window[_0x4913b5(0x213)];_0x30de78[_0x4913b5(0x1c0)][_0x4913b5(0x1c1)]=_0x43fd2f+'px';if(_0x495713){const _0x138f2f=_0x495713[_0x4913b5(0x1ca)];_0x3e941d['style'][_0x4913b5(0x220)]=_0x138f2f+0x28+'px';}}tg?tg[_0x4ac8f0(0x1f8)](_0x4ac8f0(0x229),({isStateStable:_0x2787f5})=>{_0x3118aa();if(_0x2787f5)requestAnimationFrame(()=>{const _0x4648c9=a0_0x5cfd;_0x3e941d[_0x4648c9(0x1e4)]=_0x3e941d[_0x4648c9(0x21a)];});}):window[_0x4ac8f0(0x1ee)](_0x4ac8f0(0x204),_0x3118aa),_0x3118aa(),_0xefc5b&&(_0xefc5b[_0x4ac8f0(0x1ee)](_0x4ac8f0(0x211),()=>{requestAnimationFrame(_0x3118aa);}),_0xefc5b['addEventListener'](_0x4ac8f0(0x1c2),()=>{setTimeout(()=>{const _0x3466b2=a0_0x5cfd;_0x3e941d['scrollTop']=_0x3e941d[_0x3466b2(0x21a)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4dfe0d(0x231),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x52ee(){const _0x275e6f=['onclick','onEvent','preventDefault','28295htKGxT','user','offClick','Начнется\x20новый\x20диалог.','warn','json','replace','messageInput','4556416HJjCsn','Удалить?','resize','viewportHeight','send_message','getElementById','querySelectorAll','ai_chat_messages','POST','modalText','className','Enter','now','message-bubble','abort','input','setItem','innerHeight','322243bwbyLW','flex','impactOccurred','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','auto','splice','scrollHeight','getHours','emptyState','modalTitle','value','70XVUAbD','paddingBottom','text/plain','343797OqGWXM','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','div','touchend','WebApp','message\x20','Пустой\x20ответ','viewportChanged','delete-btn','clearBtn','children','isVersionAtLeast','random','HapticFeedback','chatArea','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','sendBtn','createElement','inputArea','306lYzxlE','error','stringify','display','username','apply','querySelector','add','style','height','focus','initDataUnsafe','remove','success','textContent','key','contains','show','offsetHeight','#050505','timestamp','confirmModal','Ошибка\x20сервера','getItem','initData','show-delete','shiftKey','light','6.1','signal','text','12vjgNiN','click','typingIndicator','role','touchstart','min','search','Действие\x20необратимо.','clear_history','<br>','313686CWxDtC','innerHTML','Ошибка\x20сети','scrollTop','(((.+)+)+)+$','keydown','push','1241744rkDYFw','forEach','1929137AeOuiB','Очистить\x20историю?','trim','removeItem','addEventListener','notificationOccurred','classList','floor','appendChild','first_name','BackButton','target','length'];a0_0x52ee=function(){return _0x275e6f;};return a0_0x52ee();}const chatArea=document[a0_0x4dfe0d(0x207)](a0_0x4dfe0d(0x230)),emptyState=document[a0_0x4dfe0d(0x207)]('emptyState'),messageInput=document[a0_0x4dfe0d(0x207)](a0_0x4dfe0d(0x201)),sendBtn=document['getElementById'](a0_0x4dfe0d(0x232)),clearBtn=document[a0_0x4dfe0d(0x207)](a0_0x4dfe0d(0x22b)),modal=document[a0_0x4dfe0d(0x207)](a0_0x4dfe0d(0x1cd)),mTitle=document[a0_0x4dfe0d(0x207)](a0_0x4dfe0d(0x21d)),mText=document[a0_0x4dfe0d(0x207)](a0_0x4dfe0d(0x20b));let modalCallback=null;async function callBackend(_0x1b7b9f,_0x4ed012){const _0x535509=a0_0x4dfe0d,_0x478a5c=tg?.[_0x535509(0x1c3)]?.[_0x535509(0x1fb)]||{},_0x4f03ff=_0x478a5c['id']||localStorage[_0x535509(0x1cf)]('debug_uid')||'d-'+Math[_0x535509(0x1f1)](Math[_0x535509(0x22e)]()*0x3b9aca00);if(!_0x478a5c['id'])localStorage[_0x535509(0x212)]('debug_uid',_0x4f03ff);const _0xcb130c={'action':_0x1b7b9f,'user_id':_0x4f03ff,'user_data':{'first_name':_0x478a5c[_0x535509(0x1f3)],'username':_0x478a5c[_0x535509(0x239)]},'init_data':tg?.[_0x535509(0x1d0)]||'',..._0x4ed012},_0x16f983=new AbortController(),_0x31ad44=setTimeout(()=>_0x16f983[_0x535509(0x210)](),REQUEST_TIMEOUT_MS);try{const _0x476863=await fetch(BACKEND_URL,{'method':_0x535509(0x20a),'headers':{'Content-Type':_0x535509(0x221)},'body':JSON[_0x535509(0x237)](_0xcb130c),'signal':_0x16f983[_0x535509(0x1d5)]});return clearTimeout(_0x31ad44),await _0x476863[_0x535509(0x1ff)]();}catch(_0x329e8b){return{'success':![],'error':String(_0x329e8b)};}}function formatTime(_0x22d4a6){const _0x38c09d=a0_0x4dfe0d,_0x44c85b=new Date(_0x22d4a6);return String(_0x44c85b[_0x38c09d(0x21b)]())['padStart'](0x2,'0')+':'+String(_0x44c85b['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x28a299,_0x3dd641){const _0x5ab03c=a0_0x4dfe0d,_0x3cd510=document['createElement'](_0x5ab03c(0x224));_0x3cd510[_0x5ab03c(0x20c)]=_0x5ab03c(0x227)+_0x28a299[_0x5ab03c(0x1da)];const _0x21b201=document[_0x5ab03c(0x233)](_0x5ab03c(0x224));_0x21b201[_0x5ab03c(0x20c)]=_0x5ab03c(0x20f),_0x21b201[_0x5ab03c(0x1e2)]=_0x28a299['content'][_0x5ab03c(0x200)](/\n/g,_0x5ab03c(0x1e0));const _0x20ad74=document['createElement'](_0x5ab03c(0x224));_0x20ad74[_0x5ab03c(0x20c)]=_0x5ab03c(0x22a),_0x20ad74[_0x5ab03c(0x1e2)]=_0x5ab03c(0x217),_0x20ad74[_0x5ab03c(0x1f7)]=_0x383388=>{_0x383388['stopPropagation'](),confirmDelete(_0x3dd641);};let _0x324c71;_0x21b201[_0x5ab03c(0x1ee)](_0x5ab03c(0x1db),()=>_0x324c71=setTimeout(()=>{const _0x533dee=_0x5ab03c;_0x3cd510[_0x533dee(0x1f0)]['add'](_0x533dee(0x1d1));if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x533dee(0x216)]('medium');},0x1f4)),_0x21b201['addEventListener'](_0x5ab03c(0x225),()=>clearTimeout(_0x324c71));const _0x1ab686=document[_0x5ab03c(0x233)]('div');return _0x1ab686[_0x5ab03c(0x20c)]='message-time',_0x1ab686[_0x5ab03c(0x1c6)]=formatTime(_0x28a299[_0x5ab03c(0x1cc)]),_0x3cd510[_0x5ab03c(0x1f2)](_0x20ad74),_0x3cd510[_0x5ab03c(0x1f2)](_0x21b201),_0x3cd510[_0x5ab03c(0x1f2)](_0x1ab686),_0x3cd510;}function createTypingIndicator(){const _0x19a911=a0_0x4dfe0d,_0x5b8e18=document[_0x19a911(0x233)](_0x19a911(0x224));return _0x5b8e18[_0x19a911(0x20c)]='message\x20ai',_0x5b8e18['id']='typingIndicator',_0x5b8e18['innerHTML']=_0x19a911(0x223),_0x5b8e18;}function renderMessages(){const _0x2ad6ae=a0_0x4dfe0d;Array['from'](chatArea[_0x2ad6ae(0x22c)])['forEach'](_0x5dd41c=>{const _0x75f868=_0x2ad6ae;if(_0x5dd41c['id']!==_0x75f868(0x21c))_0x5dd41c['remove']();}),messages[_0x2ad6ae(0x1f6)]>0x0?(emptyState[_0x2ad6ae(0x1c0)][_0x2ad6ae(0x238)]='none',messages[_0x2ad6ae(0x1e9)]((_0x1e5d3d,_0x59f344)=>chatArea['appendChild'](createMessageElement(_0x1e5d3d,_0x59f344)))):emptyState[_0x2ad6ae(0x1c0)][_0x2ad6ae(0x238)]=_0x2ad6ae(0x215),requestAnimationFrame(()=>chatArea[_0x2ad6ae(0x1e4)]=chatArea[_0x2ad6ae(0x21a)]);}function autoResizeTextarea(){const _0x56f0a6=a0_0x4dfe0d;messageInput['style'][_0x56f0a6(0x1c1)]=_0x56f0a6(0x218),messageInput[_0x56f0a6(0x1c0)]['height']=Math[_0x56f0a6(0x1dc)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x439407=a0_0x4dfe0d,_0x46615d=messageInput[_0x439407(0x21e)][_0x439407(0x1ec)]();sendBtn['disabled']=!_0x46615d||isTyping;}async function sendMessage(){const _0x26ccf2=a0_0x4dfe0d,_0xf225b7=messageInput[_0x26ccf2(0x21e)][_0x26ccf2(0x1ec)]();if(!_0xf225b7||isTyping)return;if(tg?.[_0x26ccf2(0x22f)])tg[_0x26ccf2(0x22f)][_0x26ccf2(0x216)]('light');messages[_0x26ccf2(0x1e7)]({'role':_0x26ccf2(0x1fb),'content':_0xf225b7,'timestamp':Date[_0x26ccf2(0x20e)]()}),localStorage[_0x26ccf2(0x212)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x26ccf2(0x1f2)](createTypingIndicator()),chatArea[_0x26ccf2(0x1e4)]=chatArea[_0x26ccf2(0x21a)];const _0x50f753=await callBackend(_0x26ccf2(0x206),{'message':_0xf225b7});isTyping=![];const _0x317f22=document[_0x26ccf2(0x207)](_0x26ccf2(0x1d9));if(_0x317f22)_0x317f22['remove']();let _0x210c94=_0x26ccf2(0x1e3);if(_0x50f753[_0x26ccf2(0x1c5)]){_0x210c94=_0x50f753[_0x26ccf2(0x1d6)]||_0x26ccf2(0x228);if(tg?.['HapticFeedback'])tg[_0x26ccf2(0x22f)][_0x26ccf2(0x1ef)](_0x26ccf2(0x1c5));}else{_0x210c94=_0x50f753[_0x26ccf2(0x236)]||_0x26ccf2(0x1ce);if(tg?.['HapticFeedback'])tg[_0x26ccf2(0x22f)][_0x26ccf2(0x1ef)](_0x26ccf2(0x236));}messages[_0x26ccf2(0x1e7)]({'role':'ai','content':_0x210c94,'timestamp':Date[_0x26ccf2(0x20e)]()}),localStorage[_0x26ccf2(0x212)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0xdf007a){const _0xeccb03=a0_0x4dfe0d;if(mTitle)mTitle['textContent']=_0xeccb03(0x203);if(mText)mText[_0xeccb03(0x1c6)]=_0xeccb03(0x1de);modalCallback=()=>{const _0x9de89f=_0xeccb03;messages[_0x9de89f(0x219)](_0xdf007a,0x1),localStorage[_0x9de89f(0x212)](_0x9de89f(0x209),JSON[_0x9de89f(0x237)](messages)),renderMessages();},modal[_0xeccb03(0x1f0)][_0xeccb03(0x1bf)](_0xeccb03(0x1c9));}if(clearBtn)clearBtn[a0_0x4dfe0d(0x1f7)]=()=>{const _0x53dad3=a0_0x4dfe0d;if(!messages['length'])return;if(mTitle)mTitle[_0x53dad3(0x1c6)]=_0x53dad3(0x1eb);if(mText)mText[_0x53dad3(0x1c6)]=_0x53dad3(0x1fd);modalCallback=async()=>{const _0x5bd1ac=_0x53dad3;messages=[],localStorage[_0x5bd1ac(0x1ed)](_0x5bd1ac(0x209)),renderMessages(),callBackend(_0x5bd1ac(0x1df),{});},modal[_0x53dad3(0x1f0)][_0x53dad3(0x1bf)](_0x53dad3(0x1c9));};function a0_0x5cfd(_0x58eb2c,_0x4f3767){_0x58eb2c=_0x58eb2c-0x1bd;const _0x121dd0=a0_0x52ee();let _0x1824d9=_0x121dd0[_0x58eb2c];return _0x1824d9;}document[a0_0x4dfe0d(0x207)]('modalCancel')[a0_0x4dfe0d(0x1f7)]=()=>modal[a0_0x4dfe0d(0x1f0)][a0_0x4dfe0d(0x1c4)](a0_0x4dfe0d(0x1c9)),document[a0_0x4dfe0d(0x207)]('modalConfirm')['onclick']=()=>{const _0x1dbc18=a0_0x4dfe0d;if(modalCallback)modalCallback();modal['classList']['remove'](_0x1dbc18(0x1c9));},messageInput[a0_0x4dfe0d(0x1ee)](a0_0x4dfe0d(0x211),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x4dfe0d(0x1e6),_0x3ebbbc=>{const _0x5adeeb=a0_0x4dfe0d;_0x3ebbbc[_0x5adeeb(0x1c7)]===_0x5adeeb(0x20d)&&!_0x3ebbbc[_0x5adeeb(0x1d2)]&&(_0x3ebbbc[_0x5adeeb(0x1f9)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x4dfe0d(0x1ee)](a0_0x4dfe0d(0x1d8),_0xedcc7=>{const _0xabb8bf=a0_0x4dfe0d;document[_0xabb8bf(0x208)]('.message.show-delete')['forEach'](_0x4b42d0=>{const _0x3e1ffd=_0xabb8bf;if(!_0x4b42d0[_0x3e1ffd(0x1c8)](_0xedcc7[_0x3e1ffd(0x1f5)]))_0x4b42d0[_0x3e1ffd(0x1f0)][_0x3e1ffd(0x1c4)](_0x3e1ffd(0x1d1));});});const saved=localStorage[a0_0x4dfe0d(0x1cf)](a0_0x4dfe0d(0x209));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x11dae7){}updateSendButton();