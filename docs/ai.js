const a0_0x319b1e=a0_0x292d;(function(_0x5af8bc,_0x207bcb){const _0x297f9e=a0_0x292d,_0x47c129=_0x5af8bc();while(!![]){try{const _0x302d1b=parseInt(_0x297f9e(0x192))/0x1*(-parseInt(_0x297f9e(0x145))/0x2)+-parseInt(_0x297f9e(0x174))/0x3+parseInt(_0x297f9e(0x182))/0x4*(-parseInt(_0x297f9e(0x183))/0x5)+parseInt(_0x297f9e(0x147))/0x6+parseInt(_0x297f9e(0x156))/0x7+-parseInt(_0x297f9e(0x194))/0x8*(parseInt(_0x297f9e(0x14e))/0x9)+parseInt(_0x297f9e(0x160))/0xa*(-parseInt(_0x297f9e(0x18c))/0xb);if(_0x302d1b===_0x207bcb)break;else _0x47c129['push'](_0x47c129['shift']());}catch(_0x18c230){_0x47c129['push'](_0x47c129['shift']());}}}(a0_0x4705,0x4febc));function a0_0x4705(){const _0x57a79d=['disableVerticalSwipes','createElement','setHeaderColor','innerHTML','onEvent','resize','517ZKZpMX','now','(((.+)+)+)+$','modalConfirm','offClick','onClick','11108iBvefn','inputArea','1616tvqRpz','value','target','splice','focus','height','padStart','user','href','querySelector','ai_chat_messages','isVersionAtLeast','length','Ошибка\x20сервера','querySelectorAll','display','messageInput','className','warn','keydown','role','disabled','#050505','shiftKey','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','sendBtn','text/plain','.message.show-delete','message\x20','input','touchstart','forEach','addEventListener','initData','message-bubble','textContent','stringify','initDataUnsafe','POST','from','<br>','typingIndicator','Действие\x20необратимо.','stopPropagation','getItem','key','success','remove','scrollHeight','scrollTop','getElementById','getHours','appendChild','trim','timestamp','children','./router.html','38isTNYd','6.1','3739728aRhAqj','chatArea','TG\x20setup\x20error:','send_message','content','signal','contains','5067gzXVdx','notificationOccurred','Удалить?','Ошибка\x20сети','function','touchend','username','error','1045758lUZtEB','onclick','style','preventDefault','text','setItem','impactOccurred','confirmModal','abort','modalText','11650xRNRHm','show','classList','removeItem','first_name','Telegram','div','json','emptyState','Пустой\x20ответ','none','message\x20ai','expand','flex','debug_uid','apply','viewportChanged','Очистить\x20историю?','offsetHeight','toString','164898VjGkCc','WebApp','clearBtn','add','innerHeight','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','push','show-delete','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','HapticFeedback','message-time','delete-btn','medium','.container','36YFAgJc','6015VQClOL','search','light'];a0_0x4705=function(){return _0x57a79d;};return a0_0x4705();}const tg=window[a0_0x319b1e(0x165)]?.[a0_0x319b1e(0x175)],HOME_URL=a0_0x319b1e(0x144);function setupTelegramBackButton(){const _0xc0093d=a0_0x319b1e;if(!tg)return;try{tg['ready'](),tg[_0xc0093d(0x16c)](),tg[_0xc0093d(0x188)]?.(_0xc0093d(0x1aa));if(tg[_0xc0093d(0x19f)]?.(_0xc0093d(0x146)))tg[_0xc0093d(0x186)]?.();const _0x163f54=tg['BackButton'];if(_0x163f54){_0x163f54[_0xc0093d(0x161)]();if(typeof _0x163f54[_0xc0093d(0x190)]===_0xc0093d(0x152))try{_0x163f54['offClick']();}catch(_0x280e70){}_0x163f54[_0xc0093d(0x191)](()=>{const _0x1a3f46=_0xc0093d;if(tg['HapticFeedback'])tg['HapticFeedback']['impactOccurred'](_0x1a3f46(0x185));location[_0x1a3f46(0x19c)]=HOME_URL;});}}catch(_0x1f7f0a){console[_0xc0093d(0x1a6)](_0xc0093d(0x149),_0x1f7f0a);}}(function initStableLayout(){const _0x51c36e=a0_0x319b1e,_0x554af7=(function(){let _0x314e1b=!![];return function(_0x3733f7,_0x466982){const _0x3ff3ad=_0x314e1b?function(){const _0x175676=a0_0x292d;if(_0x466982){const _0x4c4085=_0x466982[_0x175676(0x16f)](_0x3733f7,arguments);return _0x466982=null,_0x4c4085;}}:function(){};return _0x314e1b=![],_0x3ff3ad;};}()),_0x3c5f6e=document[_0x51c36e(0x19d)](_0x51c36e(0x181)),_0x2c6a17=document[_0x51c36e(0x13e)](_0x51c36e(0x193)),_0x579007=document[_0x51c36e(0x13e)](_0x51c36e(0x148)),_0x47a05d=document[_0x51c36e(0x13e)](_0x51c36e(0x1a4));function _0x465c4a(){const _0x55371e=_0x51c36e,_0x5b8fc7=_0x554af7(this,function(){const _0x2c8763=a0_0x292d;return _0x5b8fc7[_0x2c8763(0x173)]()[_0x2c8763(0x184)](_0x2c8763(0x18e))[_0x2c8763(0x173)]()['constructor'](_0x5b8fc7)[_0x2c8763(0x184)]('(((.+)+)+)+$');});_0x5b8fc7();if(!_0x3c5f6e)return;const _0x17508a=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x55371e(0x178)];_0x3c5f6e['style'][_0x55371e(0x199)]=_0x17508a+'px';if(_0x2c6a17){const _0x16c18b=_0x2c6a17[_0x55371e(0x172)];_0x579007['style']['paddingBottom']=_0x16c18b+0x28+'px';}}tg?tg[_0x51c36e(0x18a)](_0x51c36e(0x170),({isStateStable:_0x2828f0})=>{_0x465c4a();if(_0x2828f0)requestAnimationFrame(()=>{const _0x3037a6=a0_0x292d;_0x579007[_0x3037a6(0x13d)]=_0x579007[_0x3037a6(0x13c)];});}):window[_0x51c36e(0x12c)](_0x51c36e(0x18b),_0x465c4a),_0x465c4a(),_0x47a05d&&(_0x47a05d[_0x51c36e(0x12c)](_0x51c36e(0x1b1),()=>{requestAnimationFrame(_0x465c4a);}),_0x47a05d[_0x51c36e(0x12c)](_0x51c36e(0x198),()=>{setTimeout(()=>{const _0x4a5340=a0_0x292d;_0x579007['scrollTop']=_0x579007[_0x4a5340(0x13c)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x319b1e(0x179),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x319b1e(0x13e)](a0_0x319b1e(0x148)),emptyState=document['getElementById'](a0_0x319b1e(0x168)),messageInput=document['getElementById'](a0_0x319b1e(0x1a4)),sendBtn=document[a0_0x319b1e(0x13e)](a0_0x319b1e(0x1ad)),clearBtn=document['getElementById'](a0_0x319b1e(0x176)),modal=document[a0_0x319b1e(0x13e)](a0_0x319b1e(0x15d)),mTitle=document['getElementById']('modalTitle'),mText=document['getElementById'](a0_0x319b1e(0x15f));let modalCallback=null;async function callBackend(_0x1f3a6d,_0x3960df){const _0x454fdb=a0_0x319b1e,_0x4ff0ee=tg?.[_0x454fdb(0x131)]?.[_0x454fdb(0x19b)]||{},_0x19d617=_0x4ff0ee['id']||localStorage[_0x454fdb(0x138)](_0x454fdb(0x16e))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x4ff0ee['id'])localStorage['setItem'](_0x454fdb(0x16e),_0x19d617);const _0x3ec256={'action':_0x1f3a6d,'user_id':_0x19d617,'user_data':{'first_name':_0x4ff0ee[_0x454fdb(0x164)],'username':_0x4ff0ee[_0x454fdb(0x154)]},'init_data':tg?.[_0x454fdb(0x12d)]||'',..._0x3960df},_0x232830=new AbortController(),_0x18c4d0=setTimeout(()=>_0x232830[_0x454fdb(0x15e)](),REQUEST_TIMEOUT_MS);try{const _0x319ee9=await fetch(BACKEND_URL,{'method':_0x454fdb(0x132),'headers':{'Content-Type':_0x454fdb(0x1ae)},'body':JSON['stringify'](_0x3ec256),'signal':_0x232830[_0x454fdb(0x14c)]});return clearTimeout(_0x18c4d0),await _0x319ee9[_0x454fdb(0x167)]();}catch(_0x4cd04f){return{'success':![],'error':String(_0x4cd04f)};}}function formatTime(_0x1f9178){const _0x83c171=a0_0x319b1e,_0x49e5da=new Date(_0x1f9178);return String(_0x49e5da[_0x83c171(0x13f)]())[_0x83c171(0x19a)](0x2,'0')+':'+String(_0x49e5da['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x5f3977,_0x2f95e7){const _0x4dfbd6=a0_0x319b1e,_0x43d846=document[_0x4dfbd6(0x187)]('div');_0x43d846[_0x4dfbd6(0x1a5)]=_0x4dfbd6(0x1b0)+_0x5f3977[_0x4dfbd6(0x1a8)];const _0x5e3b2f=document[_0x4dfbd6(0x187)](_0x4dfbd6(0x166));_0x5e3b2f[_0x4dfbd6(0x1a5)]=_0x4dfbd6(0x12e),_0x5e3b2f['innerHTML']=_0x5f3977[_0x4dfbd6(0x14b)]['replace'](/\n/g,_0x4dfbd6(0x134));const _0x2419cd=document[_0x4dfbd6(0x187)](_0x4dfbd6(0x166));_0x2419cd[_0x4dfbd6(0x1a5)]=_0x4dfbd6(0x17f),_0x2419cd[_0x4dfbd6(0x189)]=_0x4dfbd6(0x1ac),_0x2419cd[_0x4dfbd6(0x157)]=_0x5ea6f7=>{const _0x183fdb=_0x4dfbd6;_0x5ea6f7[_0x183fdb(0x137)](),confirmDelete(_0x2f95e7);};let _0x5027b1;_0x5e3b2f[_0x4dfbd6(0x12c)](_0x4dfbd6(0x1b2),()=>_0x5027b1=setTimeout(()=>{const _0x2ed100=_0x4dfbd6;_0x43d846[_0x2ed100(0x162)][_0x2ed100(0x177)](_0x2ed100(0x17b));if(tg?.[_0x2ed100(0x17d)])tg['HapticFeedback'][_0x2ed100(0x15c)](_0x2ed100(0x180));},0x1f4)),_0x5e3b2f[_0x4dfbd6(0x12c)](_0x4dfbd6(0x153),()=>clearTimeout(_0x5027b1));const _0x22b048=document[_0x4dfbd6(0x187)](_0x4dfbd6(0x166));return _0x22b048[_0x4dfbd6(0x1a5)]=_0x4dfbd6(0x17e),_0x22b048['textContent']=formatTime(_0x5f3977[_0x4dfbd6(0x142)]),_0x43d846[_0x4dfbd6(0x140)](_0x2419cd),_0x43d846[_0x4dfbd6(0x140)](_0x5e3b2f),_0x43d846[_0x4dfbd6(0x140)](_0x22b048),_0x43d846;}function createTypingIndicator(){const _0x37585b=a0_0x319b1e,_0x4cc34b=document[_0x37585b(0x187)](_0x37585b(0x166));return _0x4cc34b[_0x37585b(0x1a5)]=_0x37585b(0x16b),_0x4cc34b['id']=_0x37585b(0x135),_0x4cc34b[_0x37585b(0x189)]=_0x37585b(0x17c),_0x4cc34b;}function renderMessages(){const _0x4790fd=a0_0x319b1e;Array[_0x4790fd(0x133)](chatArea[_0x4790fd(0x143)])['forEach'](_0x162a66=>{const _0x91753=_0x4790fd;if(_0x162a66['id']!==_0x91753(0x168))_0x162a66[_0x91753(0x13b)]();}),messages[_0x4790fd(0x1a0)]>0x0?(emptyState[_0x4790fd(0x158)][_0x4790fd(0x1a3)]=_0x4790fd(0x16a),messages[_0x4790fd(0x1b3)]((_0x4ae7d1,_0x1118f3)=>chatArea[_0x4790fd(0x140)](createMessageElement(_0x4ae7d1,_0x1118f3)))):emptyState[_0x4790fd(0x158)][_0x4790fd(0x1a3)]=_0x4790fd(0x16d),requestAnimationFrame(()=>chatArea[_0x4790fd(0x13d)]=chatArea[_0x4790fd(0x13c)]);}function a0_0x292d(_0x5267bf,_0x1aaf37){_0x5267bf=_0x5267bf-0x12c;const _0xb31381=a0_0x4705();let _0x41a58a=_0xb31381[_0x5267bf];return _0x41a58a;}function autoResizeTextarea(){const _0x459bb6=a0_0x319b1e;messageInput[_0x459bb6(0x158)][_0x459bb6(0x199)]='auto',messageInput['style'][_0x459bb6(0x199)]=Math['min'](messageInput[_0x459bb6(0x13c)],0x78)+'px';}function updateSendButton(){const _0x581e7e=a0_0x319b1e,_0x3e9abd=messageInput['value'][_0x581e7e(0x141)]();sendBtn[_0x581e7e(0x1a9)]=!_0x3e9abd||isTyping;}async function sendMessage(){const _0x448c92=a0_0x319b1e,_0x2f2d68=messageInput['value'][_0x448c92(0x141)]();if(!_0x2f2d68||isTyping)return;if(tg?.[_0x448c92(0x17d)])tg[_0x448c92(0x17d)][_0x448c92(0x15c)](_0x448c92(0x185));messages[_0x448c92(0x17a)]({'role':_0x448c92(0x19b),'content':_0x2f2d68,'timestamp':Date[_0x448c92(0x18d)]()}),localStorage[_0x448c92(0x15b)](_0x448c92(0x19e),JSON['stringify'](messages)),renderMessages(),messageInput[_0x448c92(0x195)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x448c92(0x140)](createTypingIndicator()),chatArea[_0x448c92(0x13d)]=chatArea[_0x448c92(0x13c)];const _0x5b7cd7=await callBackend(_0x448c92(0x14a),{'message':_0x2f2d68});isTyping=![];const _0x5e29f3=document['getElementById'](_0x448c92(0x135));if(_0x5e29f3)_0x5e29f3['remove']();let _0xb95ab6=_0x448c92(0x151);if(_0x5b7cd7[_0x448c92(0x13a)]){_0xb95ab6=_0x5b7cd7[_0x448c92(0x15a)]||_0x448c92(0x169);if(tg?.['HapticFeedback'])tg[_0x448c92(0x17d)][_0x448c92(0x14f)](_0x448c92(0x13a));}else{_0xb95ab6=_0x5b7cd7[_0x448c92(0x155)]||_0x448c92(0x1a1);if(tg?.[_0x448c92(0x17d)])tg[_0x448c92(0x17d)][_0x448c92(0x14f)]('error');}messages['push']({'role':'ai','content':_0xb95ab6,'timestamp':Date[_0x448c92(0x18d)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x448c92(0x130)](messages)),renderMessages();}function confirmDelete(_0x1a2b48){const _0x541510=a0_0x319b1e;if(mTitle)mTitle[_0x541510(0x12f)]=_0x541510(0x150);if(mText)mText['textContent']=_0x541510(0x136);modalCallback=()=>{const _0x49f5f3=_0x541510;messages[_0x49f5f3(0x197)](_0x1a2b48,0x1),localStorage['setItem'](_0x49f5f3(0x19e),JSON['stringify'](messages)),renderMessages();},modal[_0x541510(0x162)][_0x541510(0x177)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0x34bee9=a0_0x319b1e;if(!messages[_0x34bee9(0x1a0)])return;if(mTitle)mTitle['textContent']=_0x34bee9(0x171);if(mText)mText[_0x34bee9(0x12f)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0xc1df9b=_0x34bee9;messages=[],localStorage[_0xc1df9b(0x163)](_0xc1df9b(0x19e)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x34bee9(0x177)](_0x34bee9(0x161));};document[a0_0x319b1e(0x13e)]('modalCancel')['onclick']=()=>modal[a0_0x319b1e(0x162)][a0_0x319b1e(0x13b)](a0_0x319b1e(0x161)),document[a0_0x319b1e(0x13e)](a0_0x319b1e(0x18f))[a0_0x319b1e(0x157)]=()=>{const _0x296e66=a0_0x319b1e;if(modalCallback)modalCallback();modal[_0x296e66(0x162)][_0x296e66(0x13b)](_0x296e66(0x161));},messageInput[a0_0x319b1e(0x12c)](a0_0x319b1e(0x1b1),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x319b1e(0x1a7),_0x12d884=>{const _0x143caa=a0_0x319b1e;_0x12d884[_0x143caa(0x139)]==='Enter'&&!_0x12d884[_0x143caa(0x1ab)]&&(_0x12d884[_0x143caa(0x159)](),sendMessage());}),sendBtn[a0_0x319b1e(0x157)]=sendMessage,document[a0_0x319b1e(0x12c)]('click',_0xd45de9=>{const _0x11b1d6=a0_0x319b1e;document[_0x11b1d6(0x1a2)](_0x11b1d6(0x1af))[_0x11b1d6(0x1b3)](_0x203f67=>{const _0x3b3b22=_0x11b1d6;if(!_0x203f67[_0x3b3b22(0x14d)](_0xd45de9[_0x3b3b22(0x196)]))_0x203f67[_0x3b3b22(0x162)]['remove'](_0x3b3b22(0x17b));});});const saved=localStorage['getItem'](a0_0x319b1e(0x19e));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x5a3c23){}updateSendButton();