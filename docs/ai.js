const a0_0x2b9cf2=a0_0x5052;(function(_0x30860f,_0x3159f1){const _0x4da23e=a0_0x5052,_0x521839=_0x30860f();while(!![]){try{const _0x2414a1=-parseInt(_0x4da23e(0x249))/0x1*(parseInt(_0x4da23e(0x1f9))/0x2)+parseInt(_0x4da23e(0x230))/0x3+-parseInt(_0x4da23e(0x24c))/0x4*(-parseInt(_0x4da23e(0x202))/0x5)+-parseInt(_0x4da23e(0x1e4))/0x6*(-parseInt(_0x4da23e(0x1fd))/0x7)+parseInt(_0x4da23e(0x1fc))/0x8+parseInt(_0x4da23e(0x256))/0x9+-parseInt(_0x4da23e(0x1ee))/0xa;if(_0x2414a1===_0x3159f1)break;else _0x521839['push'](_0x521839['shift']());}catch(_0x329eb7){_0x521839['push'](_0x521839['shift']());}}}(a0_0x334f,0x79872));const tg=window[a0_0x2b9cf2(0x21c)]?.[a0_0x2b9cf2(0x1fa)],HOME_URL=a0_0x2b9cf2(0x1e5);function setupTelegramBackButton(){const _0xeac685=a0_0x2b9cf2,_0xae4069=(function(){let _0x2556eb=!![];return function(_0x37a65f,_0x36e3f6){const _0x195869=_0x2556eb?function(){const _0x240b92=a0_0x5052;if(_0x36e3f6){const _0x62a68c=_0x36e3f6[_0x240b92(0x252)](_0x37a65f,arguments);return _0x36e3f6=null,_0x62a68c;}}:function(){};return _0x2556eb=![],_0x195869;};}()),_0x11bb07=_0xae4069(this,function(){const _0x325db7=a0_0x5052;return _0x11bb07[_0x325db7(0x235)]()[_0x325db7(0x211)](_0x325db7(0x200))['toString']()[_0x325db7(0x24e)](_0x11bb07)[_0x325db7(0x211)](_0x325db7(0x200));});_0x11bb07();if(!tg)return;try{tg[_0xeac685(0x24d)](),tg[_0xeac685(0x233)](),tg[_0xeac685(0x1f2)]?.('#050505');if(tg[_0xeac685(0x201)]?.('6.1'))tg[_0xeac685(0x1eb)]?.();const _0x4482ff=tg[_0xeac685(0x23c)];if(_0x4482ff){_0x4482ff[_0xeac685(0x243)]();if(typeof _0x4482ff[_0xeac685(0x212)]===_0xeac685(0x25c))try{_0x4482ff[_0xeac685(0x212)]();}catch(_0x4ae4c1){}_0x4482ff[_0xeac685(0x1f7)](()=>{const _0x3faee6=_0xeac685;if(tg[_0x3faee6(0x20a)])tg[_0x3faee6(0x20a)][_0x3faee6(0x23a)](_0x3faee6(0x251));location[_0x3faee6(0x218)]=HOME_URL;});}}catch(_0x5a1cf4){console[_0xeac685(0x219)](_0xeac685(0x1fe),_0x5a1cf4);}}(function initStableLayout(){const _0x302811=a0_0x2b9cf2,_0x1b8023=document['querySelector']('.container'),_0x3b1c9a=document['getElementById'](_0x302811(0x25a)),_0x4894b0=document[_0x302811(0x207)](_0x302811(0x225)),_0x41fe3f=document[_0x302811(0x207)](_0x302811(0x254));function _0x1fd5a8(){const _0x90f4a=_0x302811;if(!_0x1b8023)return;const _0x3045bd=tg&&tg[_0x90f4a(0x21b)]?tg[_0x90f4a(0x21b)]:window['innerHeight'];_0x1b8023[_0x90f4a(0x25f)][_0x90f4a(0x255)]=_0x3045bd+'px';if(_0x3b1c9a){const _0x1672c7=_0x3b1c9a[_0x90f4a(0x25e)];_0x4894b0[_0x90f4a(0x25f)][_0x90f4a(0x1e7)]=_0x1672c7+0x28+'px';}}tg?tg[_0x302811(0x20e)](_0x302811(0x205),({isStateStable:_0x1c8bd4})=>{_0x1fd5a8();if(_0x1c8bd4)requestAnimationFrame(()=>{const _0x5a9d78=a0_0x5052;_0x4894b0['scrollTop']=_0x4894b0[_0x5a9d78(0x220)];});}):window[_0x302811(0x247)](_0x302811(0x250),_0x1fd5a8),_0x1fd5a8(),_0x41fe3f&&(_0x41fe3f[_0x302811(0x247)](_0x302811(0x242),()=>{requestAnimationFrame(_0x1fd5a8);}),_0x41fe3f[_0x302811(0x247)](_0x302811(0x22f),()=>{setTimeout(()=>{const _0x4ff0ee=a0_0x5052;_0x4894b0[_0x4ff0ee(0x246)]=_0x4894b0[_0x4ff0ee(0x220)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2b9cf2(0x22a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2b9cf2(0x207)](a0_0x2b9cf2(0x225)),emptyState=document[a0_0x2b9cf2(0x207)](a0_0x2b9cf2(0x264)),messageInput=document[a0_0x2b9cf2(0x207)](a0_0x2b9cf2(0x254)),sendBtn=document[a0_0x2b9cf2(0x207)]('sendBtn'),clearBtn=document[a0_0x2b9cf2(0x207)](a0_0x2b9cf2(0x209)),modal=document[a0_0x2b9cf2(0x207)](a0_0x2b9cf2(0x1f5)),mTitle=document[a0_0x2b9cf2(0x207)]('modalTitle'),mText=document[a0_0x2b9cf2(0x207)]('modalText');let modalCallback=null;async function callBackend(_0x223f6e,_0x5330fb){const _0x3bda5d=a0_0x2b9cf2,_0x6bdb55=tg?.[_0x3bda5d(0x1e9)]?.['user']||{},_0x429a7a=_0x6bdb55['id']||localStorage[_0x3bda5d(0x20f)](_0x3bda5d(0x25b))||'d-'+Math[_0x3bda5d(0x24b)](Math['random']()*0x3b9aca00);if(!_0x6bdb55['id'])localStorage['setItem'](_0x3bda5d(0x25b),_0x429a7a);const _0x353abf={'action':_0x223f6e,'user_id':_0x429a7a,'user_data':{'first_name':_0x6bdb55[_0x3bda5d(0x214)],'username':_0x6bdb55['username']},'init_data':tg?.[_0x3bda5d(0x1ea)]||'',..._0x5330fb},_0x1f27f7=new AbortController(),_0x4a0901=setTimeout(()=>_0x1f27f7[_0x3bda5d(0x228)](),REQUEST_TIMEOUT_MS);try{const _0x1ffdfe=await fetch(BACKEND_URL,{'method':_0x3bda5d(0x21f),'headers':{'Content-Type':_0x3bda5d(0x213)},'body':JSON['stringify'](_0x353abf),'signal':_0x1f27f7[_0x3bda5d(0x20b)]});return clearTimeout(_0x4a0901),await _0x1ffdfe['json']();}catch(_0x2043a9){return{'success':![],'error':String(_0x2043a9)};}}function a0_0x5052(_0x485ee3,_0x3c7d6f){_0x485ee3=_0x485ee3-0x1e4;const _0x3361a0=a0_0x334f();let _0x7221c8=_0x3361a0[_0x485ee3];return _0x7221c8;}function formatTime(_0x4cbf80){const _0x8d9dcf=a0_0x2b9cf2,_0x2e9413=new Date(_0x4cbf80);return String(_0x2e9413[_0x8d9dcf(0x204)]())[_0x8d9dcf(0x260)](0x2,'0')+':'+String(_0x2e9413[_0x8d9dcf(0x239)]())[_0x8d9dcf(0x260)](0x2,'0');}function createMessageElement(_0x179c23,_0x4256c6){const _0x546e9a=a0_0x2b9cf2,_0x517ee5=document[_0x546e9a(0x23f)](_0x546e9a(0x208));_0x517ee5[_0x546e9a(0x216)]=_0x546e9a(0x1ed)+_0x179c23[_0x546e9a(0x234)];const _0x4e2c82=document['createElement']('div');_0x4e2c82[_0x546e9a(0x216)]=_0x546e9a(0x1f1),_0x4e2c82['innerHTML']=_0x179c23[_0x546e9a(0x248)][_0x546e9a(0x257)](/\n/g,_0x546e9a(0x265));const _0x3007d7=document[_0x546e9a(0x23f)](_0x546e9a(0x208));_0x3007d7[_0x546e9a(0x216)]=_0x546e9a(0x215),_0x3007d7[_0x546e9a(0x241)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x3007d7[_0x546e9a(0x245)]=_0x1693d1=>{const _0x19e2ce=_0x546e9a;_0x1693d1[_0x19e2ce(0x23e)](),confirmDelete(_0x4256c6);};let _0x1ffd15;_0x4e2c82[_0x546e9a(0x247)]('touchstart',()=>_0x1ffd15=setTimeout(()=>{const _0x34aa2b=_0x546e9a;_0x517ee5[_0x34aa2b(0x22e)][_0x34aa2b(0x21a)]('show-delete');if(tg?.[_0x34aa2b(0x20a)])tg['HapticFeedback'][_0x34aa2b(0x23a)](_0x34aa2b(0x262));},0x1f4)),_0x4e2c82[_0x546e9a(0x247)](_0x546e9a(0x210),()=>clearTimeout(_0x1ffd15));const _0x193ea7=document['createElement'](_0x546e9a(0x208));return _0x193ea7[_0x546e9a(0x216)]='message-time',_0x193ea7[_0x546e9a(0x221)]=formatTime(_0x179c23[_0x546e9a(0x20d)]),_0x517ee5[_0x546e9a(0x259)](_0x3007d7),_0x517ee5['appendChild'](_0x4e2c82),_0x517ee5[_0x546e9a(0x259)](_0x193ea7),_0x517ee5;}function a0_0x334f(){const _0x514786=['height','5009472qspsxx','replace','stringify','appendChild','inputArea','debug_uid','function','success','offsetHeight','style','padStart','min','medium','text','emptyState','<br>','89742LHrsqU','./router.html','forEach','paddingBottom','splice','initDataUnsafe','initData','disableVerticalSwipes','parse','message\x20','7758170GzOOFL','Пустой\x20ответ','children','message-bubble','setHeaderColor','click','Enter','confirmModal','.message.show-delete','onClick','setItem','531980mnYxIA','WebApp','Очистить\x20историю?','3665744wEAieO','14TqcbOk','TG\x20setup\x20error:','message\x20ai','(((.+)+)+)+$','isVersionAtLeast','10VyerdZ','typingIndicator','getHours','viewportChanged','clear_history','getElementById','div','clearBtn','HapticFeedback','signal','Действие\x20необратимо.','timestamp','onEvent','getItem','touchend','search','offClick','text/plain','first_name','delete-btn','className','contains','href','warn','add','viewportHeight','Telegram','keydown','target','POST','scrollHeight','textContent','none','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','value','chatArea','push','disabled','abort','send_message','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','error','preventDefault','now','classList','focus','2727327QSaTgt','Удалить?','show-delete','expand','role','toString','trim','length','notificationOccurred','getMinutes','impactOccurred','display','BackButton','ai_chat_messages','stopPropagation','createElement','remove','innerHTML','input','show','querySelectorAll','onclick','scrollTop','addEventListener','content','3PJxIcj','from','floor','235432wFIhAp','ready','constructor','Ошибка\x20сети','resize','light','apply','key','messageInput'];a0_0x334f=function(){return _0x514786;};return a0_0x334f();}function createTypingIndicator(){const _0x55f74f=a0_0x2b9cf2,_0x334733=document[_0x55f74f(0x23f)](_0x55f74f(0x208));return _0x334733['className']=_0x55f74f(0x1ff),_0x334733['id']=_0x55f74f(0x203),_0x334733['innerHTML']=_0x55f74f(0x223),_0x334733;}function renderMessages(){const _0x2e117d=a0_0x2b9cf2;Array[_0x2e117d(0x24a)](chatArea[_0x2e117d(0x1f0)])[_0x2e117d(0x1e6)](_0x188cd1=>{const _0x21ba48=_0x2e117d;if(_0x188cd1['id']!==_0x21ba48(0x264))_0x188cd1['remove']();}),messages['length']>0x0?(emptyState[_0x2e117d(0x25f)][_0x2e117d(0x23b)]=_0x2e117d(0x222),messages[_0x2e117d(0x1e6)]((_0x308bbd,_0x46c8d6)=>chatArea['appendChild'](createMessageElement(_0x308bbd,_0x46c8d6)))):emptyState['style'][_0x2e117d(0x23b)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x282faa=a0_0x2b9cf2;messageInput[_0x282faa(0x25f)]['height']='auto',messageInput[_0x282faa(0x25f)][_0x282faa(0x255)]=Math[_0x282faa(0x261)](messageInput[_0x282faa(0x220)],0x78)+'px';}function updateSendButton(){const _0x384ac2=a0_0x2b9cf2,_0x27866f=messageInput[_0x384ac2(0x224)][_0x384ac2(0x236)]();sendBtn[_0x384ac2(0x227)]=!_0x27866f||isTyping;}async function sendMessage(){const _0x3c1ca3=a0_0x2b9cf2,_0x59ed1f=messageInput[_0x3c1ca3(0x224)][_0x3c1ca3(0x236)]();if(!_0x59ed1f||isTyping)return;if(tg?.[_0x3c1ca3(0x20a)])tg[_0x3c1ca3(0x20a)][_0x3c1ca3(0x23a)](_0x3c1ca3(0x251));messages[_0x3c1ca3(0x226)]({'role':'user','content':_0x59ed1f,'timestamp':Date[_0x3c1ca3(0x22d)]()}),localStorage[_0x3c1ca3(0x1f8)](_0x3c1ca3(0x23d),JSON[_0x3c1ca3(0x258)](messages)),renderMessages(),messageInput[_0x3c1ca3(0x224)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x3c1ca3(0x259)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x3c1ca3(0x220)];const _0x1a172d=await callBackend(_0x3c1ca3(0x229),{'message':_0x59ed1f});isTyping=![];const _0x773d1f=document[_0x3c1ca3(0x207)](_0x3c1ca3(0x203));if(_0x773d1f)_0x773d1f[_0x3c1ca3(0x240)]();let _0xcce0ec=_0x3c1ca3(0x24f);if(_0x1a172d[_0x3c1ca3(0x25d)]){_0xcce0ec=_0x1a172d[_0x3c1ca3(0x263)]||_0x3c1ca3(0x1ef);if(tg?.[_0x3c1ca3(0x20a)])tg[_0x3c1ca3(0x20a)][_0x3c1ca3(0x238)]('success');}else{_0xcce0ec=_0x1a172d[_0x3c1ca3(0x22b)]||'Ошибка\x20сервера';if(tg?.[_0x3c1ca3(0x20a)])tg[_0x3c1ca3(0x20a)][_0x3c1ca3(0x238)]('error');}messages[_0x3c1ca3(0x226)]({'role':'ai','content':_0xcce0ec,'timestamp':Date[_0x3c1ca3(0x22d)]()}),localStorage[_0x3c1ca3(0x1f8)](_0x3c1ca3(0x23d),JSON[_0x3c1ca3(0x258)](messages)),renderMessages();}function confirmDelete(_0x48abfd){const _0x2c775f=a0_0x2b9cf2;if(mTitle)mTitle[_0x2c775f(0x221)]=_0x2c775f(0x231);if(mText)mText['textContent']=_0x2c775f(0x20c);modalCallback=()=>{const _0x59fd51=_0x2c775f;messages[_0x59fd51(0x1e8)](_0x48abfd,0x1),localStorage[_0x59fd51(0x1f8)]('ai_chat_messages',JSON[_0x59fd51(0x258)](messages)),renderMessages();},modal[_0x2c775f(0x22e)]['add']('show');}if(clearBtn)clearBtn[a0_0x2b9cf2(0x245)]=()=>{const _0x5b168c=a0_0x2b9cf2;if(!messages[_0x5b168c(0x237)])return;if(mTitle)mTitle['textContent']=_0x5b168c(0x1fb);if(mText)mText[_0x5b168c(0x221)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x5a0f80=_0x5b168c;messages=[],localStorage['removeItem'](_0x5a0f80(0x23d)),renderMessages(),callBackend(_0x5a0f80(0x206),{});},modal[_0x5b168c(0x22e)]['add'](_0x5b168c(0x243));};document[a0_0x2b9cf2(0x207)]('modalCancel')[a0_0x2b9cf2(0x245)]=()=>modal['classList']['remove'](a0_0x2b9cf2(0x243)),document[a0_0x2b9cf2(0x207)]('modalConfirm')['onclick']=()=>{const _0x1406bf=a0_0x2b9cf2;if(modalCallback)modalCallback();modal[_0x1406bf(0x22e)][_0x1406bf(0x240)](_0x1406bf(0x243));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2b9cf2(0x247)](a0_0x2b9cf2(0x21d),_0x506e15=>{const _0x548d5e=a0_0x2b9cf2;_0x506e15[_0x548d5e(0x253)]===_0x548d5e(0x1f4)&&!_0x506e15['shiftKey']&&(_0x506e15[_0x548d5e(0x22c)](),sendMessage());}),sendBtn[a0_0x2b9cf2(0x245)]=sendMessage,document['addEventListener'](a0_0x2b9cf2(0x1f3),_0x27ed1e=>{const _0x4a8749=a0_0x2b9cf2;document[_0x4a8749(0x244)](_0x4a8749(0x1f6))[_0x4a8749(0x1e6)](_0x83ee06=>{const _0x3ce861=_0x4a8749;if(!_0x83ee06[_0x3ce861(0x217)](_0x27ed1e[_0x3ce861(0x21e)]))_0x83ee06[_0x3ce861(0x22e)][_0x3ce861(0x240)](_0x3ce861(0x232));});});const saved=localStorage[a0_0x2b9cf2(0x20f)](a0_0x2b9cf2(0x23d));if(saved)try{messages=JSON[a0_0x2b9cf2(0x1ec)](saved),renderMessages();}catch(a0_0x3f7ecf){}updateSendButton();