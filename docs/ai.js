const a0_0x15db24=a0_0x260f;(function(_0xfb7b1c,_0x51302d){const _0x40e250=a0_0x260f,_0x4d0ea4=_0xfb7b1c();while(!![]){try{const _0x426bca=parseInt(_0x40e250(0xf5))/0x1+parseInt(_0x40e250(0xe2))/0x2*(-parseInt(_0x40e250(0xda))/0x3)+-parseInt(_0x40e250(0xbd))/0x4*(parseInt(_0x40e250(0xb1))/0x5)+-parseInt(_0x40e250(0xc7))/0x6+parseInt(_0x40e250(0x98))/0x7*(parseInt(_0x40e250(0xb8))/0x8)+-parseInt(_0x40e250(0x93))/0x9+parseInt(_0x40e250(0xce))/0xa;if(_0x426bca===_0x51302d)break;else _0x4d0ea4['push'](_0x4d0ea4['shift']());}catch(_0xeeb830){_0x4d0ea4['push'](_0x4d0ea4['shift']());}}}(a0_0x4b1b,0xcbf56));const tg=window[a0_0x15db24(0xd8)]?.[a0_0x15db24(0xfb)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x3bf45e=a0_0x15db24;if(!tg)return;try{tg[_0x3bf45e(0xf2)](),tg[_0x3bf45e(0xb7)](),tg[_0x3bf45e(0xd0)]?.('#050505');if(tg['isVersionAtLeast']?.(_0x3bf45e(0xd9)))tg['disableVerticalSwipes']?.();const _0x5560d5=tg[_0x3bf45e(0xf4)];if(_0x5560d5){_0x5560d5['show']();if(typeof _0x5560d5[_0x3bf45e(0xad)]==='function')try{_0x5560d5['offClick']();}catch(_0x4aca48){}_0x5560d5[_0x3bf45e(0xaf)](()=>{const _0xc855aa=_0x3bf45e;if(tg['HapticFeedback'])tg['HapticFeedback'][_0xc855aa(0x96)]('light');location[_0xc855aa(0xd1)]=HOME_URL;});}}catch(_0x2901fb){console['warn']('TG\x20setup\x20error:',_0x2901fb);}}(function initStableLayout(){const _0x3eb88b=a0_0x15db24,_0x313092=(function(){let _0x4301ef=!![];return function(_0x5dbab8,_0x2bc62a){const _0x57ff55=_0x4301ef?function(){const _0x5d3e4a=a0_0x260f;if(_0x2bc62a){const _0x19a8b4=_0x2bc62a[_0x5d3e4a(0x9a)](_0x5dbab8,arguments);return _0x2bc62a=null,_0x19a8b4;}}:function(){};return _0x4301ef=![],_0x57ff55;};}()),_0x1fd18b=document[_0x3eb88b(0xae)](_0x3eb88b(0xa9)),_0xa52932=document[_0x3eb88b(0xc6)]('inputArea'),_0x1b72be=document['getElementById']('chatArea'),_0x34c4d8=document[_0x3eb88b(0xc6)]('messageInput');function _0x11456d(){const _0x1716a4=_0x3eb88b,_0x54622d=_0x313092(this,function(){const _0x9e0e6f=a0_0x260f;return _0x54622d[_0x9e0e6f(0xa6)]()[_0x9e0e6f(0x9e)]('(((.+)+)+)+$')[_0x9e0e6f(0xa6)]()[_0x9e0e6f(0xc8)](_0x54622d)[_0x9e0e6f(0x9e)]('(((.+)+)+)+$');});_0x54622d();if(!_0x1fd18b)return;const _0x8f7137=tg&&tg[_0x1716a4(0xd4)]?tg[_0x1716a4(0xd4)]:window[_0x1716a4(0x103)];_0x1fd18b['style']['height']=_0x8f7137+'px';if(_0xa52932){const _0x3e3966=_0xa52932[_0x1716a4(0xa3)];_0x1b72be['style']['paddingBottom']=_0x3e3966+0x28+'px';}}tg?tg[_0x3eb88b(0xbc)](_0x3eb88b(0xb9),({isStateStable:_0x27dd60})=>{_0x11456d();if(_0x27dd60)requestAnimationFrame(()=>{const _0x12deec=a0_0x260f;_0x1b72be[_0x12deec(0xfc)]=_0x1b72be['scrollHeight'];});}):window['addEventListener'](_0x3eb88b(0xb5),_0x11456d),_0x11456d(),_0x34c4d8&&(_0x34c4d8[_0x3eb88b(0xa0)](_0x3eb88b(0xf9),()=>{requestAnimationFrame(_0x11456d);}),_0x34c4d8['addEventListener']('focus',()=>{setTimeout(()=>{const _0x21a76c=a0_0x260f;_0x1b72be['scrollTop']=_0x1b72be[_0x21a76c(0x9b)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById']('chatArea'),emptyState=document['getElementById'](a0_0x15db24(0xa8)),messageInput=document['getElementById'](a0_0x15db24(0xa2)),sendBtn=document[a0_0x15db24(0xc6)](a0_0x15db24(0xac)),clearBtn=document[a0_0x15db24(0xc6)]('clearBtn'),modal=document[a0_0x15db24(0xc6)](a0_0x15db24(0xde)),mTitle=document[a0_0x15db24(0xc6)]('modalTitle'),mText=document[a0_0x15db24(0xc6)](a0_0x15db24(0xbe));let modalCallback=null;async function callBackend(_0x35c24a,_0x469fe4){const _0x3ef5e1=a0_0x15db24,_0x290eb9=tg?.[_0x3ef5e1(0xa1)]?.[_0x3ef5e1(0xdb)]||{},_0x58f50f=_0x290eb9['id']||localStorage[_0x3ef5e1(0x106)](_0x3ef5e1(0x108))||'d-'+Math[_0x3ef5e1(0xc2)](Math[_0x3ef5e1(0xc0)]()*0x3b9aca00);if(!_0x290eb9['id'])localStorage['setItem'](_0x3ef5e1(0x108),_0x58f50f);const _0x50c6a4={'action':_0x35c24a,'user_id':_0x58f50f,'user_data':{'first_name':_0x290eb9['first_name'],'username':_0x290eb9[_0x3ef5e1(0xe3)]},'init_data':tg?.['initData']||'',..._0x469fe4},_0x5c3490=new AbortController(),_0x1d59c4=setTimeout(()=>_0x5c3490[_0x3ef5e1(0xe8)](),REQUEST_TIMEOUT_MS);try{const _0x2b115f=await fetch(BACKEND_URL,{'method':_0x3ef5e1(0xc3),'headers':{'Content-Type':_0x3ef5e1(0xeb)},'body':JSON['stringify'](_0x50c6a4),'signal':_0x5c3490['signal']});return clearTimeout(_0x1d59c4),await _0x2b115f[_0x3ef5e1(0x107)]();}catch(_0x4cc937){return{'success':![],'error':String(_0x4cc937)};}}function formatTime(_0x156c3d){const _0x77b7d0=a0_0x15db24,_0x11d14e=new Date(_0x156c3d);return String(_0x11d14e[_0x77b7d0(0xdf)]())[_0x77b7d0(0x9c)](0x2,'0')+':'+String(_0x11d14e[_0x77b7d0(0xd6)]())[_0x77b7d0(0x9c)](0x2,'0');}function createMessageElement(_0x106c1c,_0x5b10d6){const _0x5c3ad7=a0_0x15db24,_0x1b8ab7=document[_0x5c3ad7(0xfe)](_0x5c3ad7(0x92));_0x1b8ab7[_0x5c3ad7(0xbb)]=_0x5c3ad7(0xc4)+_0x106c1c[_0x5c3ad7(0xff)];const _0x9a695c=document[_0x5c3ad7(0xfe)](_0x5c3ad7(0x92));_0x9a695c['className']=_0x5c3ad7(0xb2),_0x9a695c[_0x5c3ad7(0xf3)]=_0x106c1c['content'][_0x5c3ad7(0xa7)](/\n/g,_0x5c3ad7(0xcd));const _0x212ecb=document[_0x5c3ad7(0xfe)](_0x5c3ad7(0x92));_0x212ecb['className']=_0x5c3ad7(0xab),_0x212ecb[_0x5c3ad7(0xf3)]=_0x5c3ad7(0xc5),_0x212ecb['onclick']=_0x1a325c=>{const _0x5136fb=_0x5c3ad7;_0x1a325c[_0x5136fb(0x109)](),confirmDelete(_0x5b10d6);};let _0x5d9d66;_0x9a695c[_0x5c3ad7(0xa0)](_0x5c3ad7(0xf6),()=>_0x5d9d66=setTimeout(()=>{const _0x19d0cd=_0x5c3ad7;_0x1b8ab7[_0x19d0cd(0xb4)][_0x19d0cd(0xf1)](_0x19d0cd(0x9f));if(tg?.[_0x19d0cd(0x10c)])tg[_0x19d0cd(0x10c)]['impactOccurred'](_0x19d0cd(0xcf));},0x1f4)),_0x9a695c[_0x5c3ad7(0xa0)](_0x5c3ad7(0xa5),()=>clearTimeout(_0x5d9d66));const _0x3c6eb1=document[_0x5c3ad7(0xfe)]('div');return _0x3c6eb1[_0x5c3ad7(0xbb)]=_0x5c3ad7(0xfa),_0x3c6eb1[_0x5c3ad7(0xe9)]=formatTime(_0x106c1c[_0x5c3ad7(0x94)]),_0x1b8ab7['appendChild'](_0x212ecb),_0x1b8ab7[_0x5c3ad7(0xc1)](_0x9a695c),_0x1b8ab7[_0x5c3ad7(0xc1)](_0x3c6eb1),_0x1b8ab7;}function createTypingIndicator(){const _0x4495f8=a0_0x15db24,_0x410132=document[_0x4495f8(0xfe)](_0x4495f8(0x92));return _0x410132[_0x4495f8(0xbb)]=_0x4495f8(0xe0),_0x410132['id']=_0x4495f8(0xb6),_0x410132[_0x4495f8(0xf3)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x410132;}function renderMessages(){const _0x4c2d75=a0_0x15db24;Array[_0x4c2d75(0xe1)](chatArea[_0x4c2d75(0x10a)])[_0x4c2d75(0xba)](_0x4b4d28=>{const _0x1a5e8b=_0x4c2d75;if(_0x4b4d28['id']!=='emptyState')_0x4b4d28[_0x1a5e8b(0x9d)]();}),messages['length']>0x0?(emptyState['style']['display']=_0x4c2d75(0xdc),messages['forEach']((_0x259e61,_0x23f5dd)=>chatArea[_0x4c2d75(0xc1)](createMessageElement(_0x259e61,_0x23f5dd)))):emptyState[_0x4c2d75(0xf7)][_0x4c2d75(0x104)]=_0x4c2d75(0xd5),requestAnimationFrame(()=>chatArea[_0x4c2d75(0xfc)]=chatArea[_0x4c2d75(0x9b)]);}function autoResizeTextarea(){const _0x4f6f84=a0_0x15db24;messageInput[_0x4f6f84(0xf7)][_0x4f6f84(0xe7)]=_0x4f6f84(0xe5),messageInput[_0x4f6f84(0xf7)]['height']=Math[_0x4f6f84(0xd3)](messageInput[_0x4f6f84(0x9b)],0x78)+'px';}function updateSendButton(){const _0x3c76a7=a0_0x15db24,_0x551502=messageInput[_0x3c76a7(0x101)][_0x3c76a7(0xd2)]();sendBtn['disabled']=!_0x551502||isTyping;}function a0_0x4b1b(){const _0x453108=['remove','search','show-delete','addEventListener','initDataUnsafe','messageInput','offsetHeight','preventDefault','touchend','toString','replace','emptyState','.container','splice','delete-btn','sendBtn','offClick','querySelector','onClick','ai_chat_messages','165065zKaMcl','message-bubble','parse','classList','resize','typingIndicator','expand','8uxIVnp','viewportChanged','forEach','className','onEvent','92aaOMIG','modalText','Очистить\x20историю?','random','appendChild','floor','POST','message\x20','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','getElementById','3054480HaDnAV','constructor','key','Enter','Удалить?','querySelectorAll','<br>','39151060DbUpzu','medium','setHeaderColor','href','trim','min','viewportHeight','flex','getMinutes','success','Telegram','6.1','38208jojHEu','user','none','length','confirmModal','getHours','message\x20ai','from','152xSibyL','username','target','auto','shiftKey','height','abort','textContent','.message.show-delete','text/plain','onclick','modalCancel','push','notificationOccurred','contains','add','ready','innerHTML','BackButton','680225cvQnqg','touchstart','style','setItem','input','message-time','WebApp','scrollTop','stringify','createElement','role','click','value','send_message','innerHeight','display','error','getItem','json','debug_uid','stopPropagation','children','show','HapticFeedback','now','div','13865229kbZAxd','timestamp','light','impactOccurred','Ошибка\x20сервера','118853IMJtBR','keydown','apply','scrollHeight','padStart'];a0_0x4b1b=function(){return _0x453108;};return a0_0x4b1b();}async function sendMessage(){const _0x2e436d=a0_0x15db24,_0x516f59=messageInput[_0x2e436d(0x101)][_0x2e436d(0xd2)]();if(!_0x516f59||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2e436d(0x10c)]['impactOccurred'](_0x2e436d(0x95));messages[_0x2e436d(0xee)]({'role':_0x2e436d(0xdb),'content':_0x516f59,'timestamp':Date[_0x2e436d(0x91)]()}),localStorage[_0x2e436d(0xf8)](_0x2e436d(0xb0),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2e436d(0xc1)](createTypingIndicator()),chatArea[_0x2e436d(0xfc)]=chatArea['scrollHeight'];const _0x264021=await callBackend(_0x2e436d(0x102),{'message':_0x516f59});isTyping=![];const _0x1f5f90=document[_0x2e436d(0xc6)](_0x2e436d(0xb6));if(_0x1f5f90)_0x1f5f90[_0x2e436d(0x9d)]();let _0x595091='Ошибка\x20сети';if(_0x264021[_0x2e436d(0xd7)]){_0x595091=_0x264021['text']||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg[_0x2e436d(0x10c)][_0x2e436d(0xef)]('success');}else{_0x595091=_0x264021[_0x2e436d(0x105)]||_0x2e436d(0x97);if(tg?.[_0x2e436d(0x10c)])tg['HapticFeedback'][_0x2e436d(0xef)](_0x2e436d(0x105));}messages[_0x2e436d(0xee)]({'role':'ai','content':_0x595091,'timestamp':Date[_0x2e436d(0x91)]()}),localStorage[_0x2e436d(0xf8)](_0x2e436d(0xb0),JSON[_0x2e436d(0xfd)](messages)),renderMessages();}function confirmDelete(_0x187ba1){const _0x4bcff0=a0_0x15db24;if(mTitle)mTitle[_0x4bcff0(0xe9)]=_0x4bcff0(0xcb);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x1d90c9=_0x4bcff0;messages[_0x1d90c9(0xaa)](_0x187ba1,0x1),localStorage['setItem'](_0x1d90c9(0xb0),JSON['stringify'](messages)),renderMessages();},modal[_0x4bcff0(0xb4)][_0x4bcff0(0xf1)](_0x4bcff0(0x10b));}function a0_0x260f(_0x27f5dc,_0x3c2157){_0x27f5dc=_0x27f5dc-0x91;const _0x2cdeea=a0_0x4b1b();let _0x29e93a=_0x2cdeea[_0x27f5dc];return _0x29e93a;}if(clearBtn)clearBtn[a0_0x15db24(0xec)]=()=>{const _0x175ea5=a0_0x15db24;if(!messages[_0x175ea5(0xdd)])return;if(mTitle)mTitle[_0x175ea5(0xe9)]=_0x175ea5(0xbf);if(mText)mText[_0x175ea5(0xe9)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x508feb=_0x175ea5;messages=[],localStorage['removeItem'](_0x508feb(0xb0)),renderMessages(),callBackend('clear_history',{});},modal[_0x175ea5(0xb4)]['add'](_0x175ea5(0x10b));};document[a0_0x15db24(0xc6)](a0_0x15db24(0xed))['onclick']=()=>modal[a0_0x15db24(0xb4)][a0_0x15db24(0x9d)](a0_0x15db24(0x10b)),document[a0_0x15db24(0xc6)]('modalConfirm')[a0_0x15db24(0xec)]=()=>{const _0x298191=a0_0x15db24;if(modalCallback)modalCallback();modal[_0x298191(0xb4)][_0x298191(0x9d)](_0x298191(0x10b));},messageInput[a0_0x15db24(0xa0)](a0_0x15db24(0xf9),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x15db24(0x99),_0x441dae=>{const _0x54fa46=a0_0x15db24;_0x441dae[_0x54fa46(0xc9)]===_0x54fa46(0xca)&&!_0x441dae[_0x54fa46(0xe6)]&&(_0x441dae[_0x54fa46(0xa4)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x15db24(0xa0)](a0_0x15db24(0x100),_0x5b876f=>{const _0x482645=a0_0x15db24;document[_0x482645(0xcc)](_0x482645(0xea))['forEach'](_0x370664=>{const _0x5eea25=_0x482645;if(!_0x370664[_0x5eea25(0xf0)](_0x5b876f[_0x5eea25(0xe4)]))_0x370664[_0x5eea25(0xb4)][_0x5eea25(0x9d)](_0x5eea25(0x9f));});});const saved=localStorage[a0_0x15db24(0x106)](a0_0x15db24(0xb0));if(saved)try{messages=JSON[a0_0x15db24(0xb3)](saved),renderMessages();}catch(a0_0x46e012){}updateSendButton();