const a0_0x32ae20=a0_0x4dec;(function(_0x3900c1,_0x3259cc){const _0x2cb794=a0_0x4dec,_0x17c955=_0x3900c1();while(!![]){try{const _0x454926=parseInt(_0x2cb794(0x152))/0x1+-parseInt(_0x2cb794(0x12e))/0x2*(parseInt(_0x2cb794(0x12c))/0x3)+parseInt(_0x2cb794(0x181))/0x4+parseInt(_0x2cb794(0x148))/0x5+-parseInt(_0x2cb794(0x119))/0x6+parseInt(_0x2cb794(0x168))/0x7*(-parseInt(_0x2cb794(0x180))/0x8)+parseInt(_0x2cb794(0x182))/0x9;if(_0x454926===_0x3259cc)break;else _0x17c955['push'](_0x17c955['shift']());}catch(_0x25c239){_0x17c955['push'](_0x17c955['shift']());}}}(a0_0x596f,0xa82a1));const tg=window[a0_0x32ae20(0x173)]?.['WebApp'],HOME_URL=a0_0x32ae20(0x16c);function a0_0x596f(){const _0x54e659=['auto','disabled','getItem','paddingBottom','807519pDilzC','content','viewportChanged','warn','modalText','style','modalCancel','isVersionAtLeast','resize','querySelector','touchstart','offClick','getHours','success','min','contains','floor','onClick','.message.show-delete','display','abort','random','7gsuTzF','json','push','input','./router.html','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','medium','initData','innerHTML','POST','message\x20ai','Telegram','show','username','div','modalConfirm','delete-btn','TG\x20setup\x20error:','show-delete','parse','children','focus','Enter','notificationOccurred','8791448jxgGWC','5402076NAmPAA','4979790iLOEcX','#050505','Удалить?','ready','search','(((.+)+)+)+$','none','setHeaderColor','Ошибка\x20сети','timestamp','className','height','onclick','splice','classList','add','typingIndicator','Ошибка\x20сервера','apply','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Начнется\x20новый\x20диалог.','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','2198238iTpTGL','scrollTop','signal','click','sendBtn','chatArea','querySelectorAll','flex','inputArea','offsetHeight','remove','toString','6.1','length','stringify','constructor','padStart','setItem','now','928194zcZIsE','text','4tvHgpV','createElement','.container','getElementById','ai_chat_messages','modalTitle','messageInput','scrollHeight','innerHeight','addEventListener','removeItem','Действие\x20необратимо.','first_name','user','replace','forEach','BackButton','function','text/plain','initDataUnsafe','value','Пустой\x20ответ','HapticFeedback','textContent','emptyState','from','307765UyzCWd','touchend','impactOccurred','appendChild','message-time','onEvent'];a0_0x596f=function(){return _0x54e659;};return a0_0x596f();}function setupTelegramBackButton(){const _0x4085a3=a0_0x32ae20;if(!tg)return;try{tg[_0x4085a3(0x106)](),tg['expand'](),tg[_0x4085a3(0x10a)]?.(_0x4085a3(0x104));if(tg[_0x4085a3(0x159)]?.(_0x4085a3(0x125)))tg['disableVerticalSwipes']?.();const _0x6d08aa=tg[_0x4085a3(0x13e)];if(_0x6d08aa){_0x6d08aa[_0x4085a3(0x174)]();if(typeof _0x6d08aa[_0x4085a3(0x15d)]===_0x4085a3(0x13f))try{_0x6d08aa['offClick']();}catch(_0x24ca62){}_0x6d08aa[_0x4085a3(0x163)](()=>{const _0xb90bb5=_0x4085a3;if(tg[_0xb90bb5(0x144)])tg[_0xb90bb5(0x144)]['impactOccurred']('light');location['href']=HOME_URL;});}}catch(_0x437f96){console[_0x4085a3(0x155)](_0x4085a3(0x179),_0x437f96);}}(function initStableLayout(){const _0x36bf80=a0_0x32ae20,_0x5ca5cc=(function(){let _0x10ae1e=!![];return function(_0x2a621e,_0x51f30a){const _0x73a94d=_0x10ae1e?function(){const _0x51ecd1=a0_0x4dec;if(_0x51f30a){const _0x257019=_0x51f30a[_0x51ecd1(0x115)](_0x2a621e,arguments);return _0x51f30a=null,_0x257019;}}:function(){};return _0x10ae1e=![],_0x73a94d;};}()),_0x17fa16=document[_0x36bf80(0x15b)](_0x36bf80(0x130)),_0x16ccec=document[_0x36bf80(0x131)](_0x36bf80(0x121)),_0x1d80c2=document[_0x36bf80(0x131)]('chatArea'),_0x48b86a=document[_0x36bf80(0x131)](_0x36bf80(0x134));function _0x1ddd9a(){const _0x51f095=_0x36bf80,_0x2e91cc=_0x5ca5cc(this,function(){const _0x5bbe98=a0_0x4dec;return _0x2e91cc[_0x5bbe98(0x124)]()[_0x5bbe98(0x107)]('(((.+)+)+)+$')[_0x5bbe98(0x124)]()[_0x5bbe98(0x128)](_0x2e91cc)['search'](_0x5bbe98(0x108));});_0x2e91cc();if(!_0x17fa16)return;const _0x18c10c=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x51f095(0x136)];_0x17fa16[_0x51f095(0x157)]['height']=_0x18c10c+'px';if(_0x16ccec){const _0x2b7bbf=_0x16ccec[_0x51f095(0x122)];_0x1d80c2[_0x51f095(0x157)][_0x51f095(0x151)]=_0x2b7bbf+0x28+'px';}}tg?tg[_0x36bf80(0x14d)](_0x36bf80(0x154),({isStateStable:_0x577e26})=>{_0x1ddd9a();if(_0x577e26)requestAnimationFrame(()=>{const _0x585b0b=a0_0x4dec;_0x1d80c2[_0x585b0b(0x11a)]=_0x1d80c2[_0x585b0b(0x135)];});}):window['addEventListener'](_0x36bf80(0x15a),_0x1ddd9a),_0x1ddd9a(),_0x48b86a&&(_0x48b86a[_0x36bf80(0x137)](_0x36bf80(0x16b),()=>{requestAnimationFrame(_0x1ddd9a);}),_0x48b86a[_0x36bf80(0x137)](_0x36bf80(0x17d),()=>{setTimeout(()=>{const _0x2dfa60=a0_0x4dec;_0x1d80c2[_0x2dfa60(0x11a)]=_0x1d80c2[_0x2dfa60(0x135)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x32ae20(0x116),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x32ae20(0x131)](a0_0x32ae20(0x11e)),emptyState=document[a0_0x32ae20(0x131)](a0_0x32ae20(0x146)),messageInput=document[a0_0x32ae20(0x131)](a0_0x32ae20(0x134)),sendBtn=document[a0_0x32ae20(0x131)](a0_0x32ae20(0x11d)),clearBtn=document['getElementById']('clearBtn'),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0x32ae20(0x131)](a0_0x32ae20(0x133)),mText=document[a0_0x32ae20(0x131)](a0_0x32ae20(0x156));let modalCallback=null;async function callBackend(_0x5b009e,_0xc34ba1){const _0x4c6990=a0_0x32ae20,_0x4e8f92=tg?.[_0x4c6990(0x141)]?.[_0x4c6990(0x13b)]||{},_0x1a457a=_0x4e8f92['id']||localStorage[_0x4c6990(0x150)]('debug_uid')||'d-'+Math[_0x4c6990(0x162)](Math[_0x4c6990(0x167)]()*0x3b9aca00);if(!_0x4e8f92['id'])localStorage[_0x4c6990(0x12a)]('debug_uid',_0x1a457a);const _0x32ca64={'action':_0x5b009e,'user_id':_0x1a457a,'user_data':{'first_name':_0x4e8f92[_0x4c6990(0x13a)],'username':_0x4e8f92[_0x4c6990(0x175)]},'init_data':tg?.[_0x4c6990(0x16f)]||'',..._0xc34ba1},_0x4b15c0=new AbortController(),_0x45ac99=setTimeout(()=>_0x4b15c0[_0x4c6990(0x166)](),REQUEST_TIMEOUT_MS);try{const _0x22f613=await fetch(BACKEND_URL,{'method':_0x4c6990(0x171),'headers':{'Content-Type':_0x4c6990(0x140)},'body':JSON['stringify'](_0x32ca64),'signal':_0x4b15c0[_0x4c6990(0x11b)]});return clearTimeout(_0x45ac99),await _0x22f613[_0x4c6990(0x169)]();}catch(_0x2b473e){return{'success':![],'error':String(_0x2b473e)};}}function formatTime(_0x50fdab){const _0x23cfbb=a0_0x32ae20,_0x8cee75=new Date(_0x50fdab);return String(_0x8cee75[_0x23cfbb(0x15e)]())[_0x23cfbb(0x129)](0x2,'0')+':'+String(_0x8cee75['getMinutes']())[_0x23cfbb(0x129)](0x2,'0');}function createMessageElement(_0xe3ceaa,_0x154e74){const _0x3994f1=a0_0x32ae20,_0x50075f=document[_0x3994f1(0x12f)](_0x3994f1(0x176));_0x50075f[_0x3994f1(0x10d)]='message\x20'+_0xe3ceaa['role'];const _0x1199d2=document[_0x3994f1(0x12f)](_0x3994f1(0x176));_0x1199d2['className']='message-bubble',_0x1199d2[_0x3994f1(0x170)]=_0xe3ceaa[_0x3994f1(0x153)][_0x3994f1(0x13c)](/\n/g,'<br>');const _0x4aa331=document[_0x3994f1(0x12f)](_0x3994f1(0x176));_0x4aa331[_0x3994f1(0x10d)]=_0x3994f1(0x178),_0x4aa331[_0x3994f1(0x170)]=_0x3994f1(0x118),_0x4aa331[_0x3994f1(0x10f)]=_0x429e24=>{_0x429e24['stopPropagation'](),confirmDelete(_0x154e74);};let _0x4d0d97;_0x1199d2[_0x3994f1(0x137)](_0x3994f1(0x15c),()=>_0x4d0d97=setTimeout(()=>{const _0x1abb64=_0x3994f1;_0x50075f[_0x1abb64(0x111)]['add'](_0x1abb64(0x17a));if(tg?.[_0x1abb64(0x144)])tg['HapticFeedback']['impactOccurred'](_0x1abb64(0x16e));},0x1f4)),_0x1199d2[_0x3994f1(0x137)](_0x3994f1(0x149),()=>clearTimeout(_0x4d0d97));const _0x31a565=document['createElement'](_0x3994f1(0x176));return _0x31a565[_0x3994f1(0x10d)]=_0x3994f1(0x14c),_0x31a565[_0x3994f1(0x145)]=formatTime(_0xe3ceaa[_0x3994f1(0x10c)]),_0x50075f[_0x3994f1(0x14b)](_0x4aa331),_0x50075f[_0x3994f1(0x14b)](_0x1199d2),_0x50075f[_0x3994f1(0x14b)](_0x31a565),_0x50075f;}function createTypingIndicator(){const _0xdc2364=a0_0x32ae20,_0x1e6b5f=document['createElement'](_0xdc2364(0x176));return _0x1e6b5f[_0xdc2364(0x10d)]=_0xdc2364(0x172),_0x1e6b5f['id']=_0xdc2364(0x113),_0x1e6b5f[_0xdc2364(0x170)]=_0xdc2364(0x16d),_0x1e6b5f;}function renderMessages(){const _0x8ccea5=a0_0x32ae20;Array[_0x8ccea5(0x147)](chatArea[_0x8ccea5(0x17c)])['forEach'](_0x12dd92=>{if(_0x12dd92['id']!=='emptyState')_0x12dd92['remove']();}),messages[_0x8ccea5(0x126)]>0x0?(emptyState[_0x8ccea5(0x157)][_0x8ccea5(0x165)]=_0x8ccea5(0x109),messages[_0x8ccea5(0x13d)]((_0x5cefd4,_0x55dd8b)=>chatArea[_0x8ccea5(0x14b)](createMessageElement(_0x5cefd4,_0x55dd8b)))):emptyState[_0x8ccea5(0x157)]['display']=_0x8ccea5(0x120),requestAnimationFrame(()=>chatArea[_0x8ccea5(0x11a)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x48d392=a0_0x32ae20;messageInput[_0x48d392(0x157)][_0x48d392(0x10e)]=_0x48d392(0x14e),messageInput[_0x48d392(0x157)][_0x48d392(0x10e)]=Math[_0x48d392(0x160)](messageInput[_0x48d392(0x135)],0x78)+'px';}function updateSendButton(){const _0x4d106c=a0_0x32ae20,_0x162454=messageInput[_0x4d106c(0x142)]['trim']();sendBtn[_0x4d106c(0x14f)]=!_0x162454||isTyping;}async function sendMessage(){const _0x5e25e1=a0_0x32ae20,_0x2b24f4=messageInput[_0x5e25e1(0x142)]['trim']();if(!_0x2b24f4||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x5e25e1(0x144)][_0x5e25e1(0x14a)]('light');messages[_0x5e25e1(0x16a)]({'role':_0x5e25e1(0x13b),'content':_0x2b24f4,'timestamp':Date[_0x5e25e1(0x12b)]()}),localStorage[_0x5e25e1(0x12a)](_0x5e25e1(0x132),JSON['stringify'](messages)),renderMessages(),messageInput[_0x5e25e1(0x142)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5e25e1(0x14b)](createTypingIndicator()),chatArea[_0x5e25e1(0x11a)]=chatArea[_0x5e25e1(0x135)];const _0x378eab=await callBackend('send_message',{'message':_0x2b24f4});isTyping=![];const _0x299c36=document[_0x5e25e1(0x131)](_0x5e25e1(0x113));if(_0x299c36)_0x299c36[_0x5e25e1(0x123)]();let _0xf3075e=_0x5e25e1(0x10b);if(_0x378eab[_0x5e25e1(0x15f)]){_0xf3075e=_0x378eab[_0x5e25e1(0x12d)]||_0x5e25e1(0x143);if(tg?.[_0x5e25e1(0x144)])tg['HapticFeedback']['notificationOccurred']('success');}else{_0xf3075e=_0x378eab['error']||_0x5e25e1(0x114);if(tg?.[_0x5e25e1(0x144)])tg['HapticFeedback'][_0x5e25e1(0x17f)]('error');}messages['push']({'role':'ai','content':_0xf3075e,'timestamp':Date[_0x5e25e1(0x12b)]()}),localStorage[_0x5e25e1(0x12a)](_0x5e25e1(0x132),JSON[_0x5e25e1(0x127)](messages)),renderMessages();}function confirmDelete(_0x49fd0f){const _0x21fb4c=a0_0x32ae20;if(mTitle)mTitle[_0x21fb4c(0x145)]=_0x21fb4c(0x105);if(mText)mText['textContent']=_0x21fb4c(0x139);modalCallback=()=>{const _0x468bbc=_0x21fb4c;messages[_0x468bbc(0x110)](_0x49fd0f,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x468bbc(0x127)](messages)),renderMessages();},modal[_0x21fb4c(0x111)][_0x21fb4c(0x112)](_0x21fb4c(0x174));}if(clearBtn)clearBtn[a0_0x32ae20(0x10f)]=()=>{const _0x540141=a0_0x32ae20;if(!messages[_0x540141(0x126)])return;if(mTitle)mTitle[_0x540141(0x145)]='Очистить\x20историю?';if(mText)mText[_0x540141(0x145)]=_0x540141(0x117);modalCallback=async()=>{const _0x51bf8e=_0x540141;messages=[],localStorage[_0x51bf8e(0x138)](_0x51bf8e(0x132)),renderMessages(),callBackend('clear_history',{});},modal[_0x540141(0x111)]['add'](_0x540141(0x174));};document[a0_0x32ae20(0x131)](a0_0x32ae20(0x158))['onclick']=()=>modal[a0_0x32ae20(0x111)][a0_0x32ae20(0x123)](a0_0x32ae20(0x174)),document[a0_0x32ae20(0x131)](a0_0x32ae20(0x177))['onclick']=()=>{const _0x5c6cec=a0_0x32ae20;if(modalCallback)modalCallback();modal[_0x5c6cec(0x111)][_0x5c6cec(0x123)]('show');},messageInput[a0_0x32ae20(0x137)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x45cee2=>{const _0x80c24d=a0_0x32ae20;_0x45cee2['key']===_0x80c24d(0x17e)&&!_0x45cee2['shiftKey']&&(_0x45cee2['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x32ae20(0x137)](a0_0x32ae20(0x11c),_0x285d57=>{const _0x3c882a=a0_0x32ae20;document[_0x3c882a(0x11f)](_0x3c882a(0x164))[_0x3c882a(0x13d)](_0x4aa622=>{const _0x3c2bcf=_0x3c882a;if(!_0x4aa622[_0x3c2bcf(0x161)](_0x285d57['target']))_0x4aa622[_0x3c2bcf(0x111)][_0x3c2bcf(0x123)]('show-delete');});});function a0_0x4dec(_0x3f866c,_0x2fc5c3){_0x3f866c=_0x3f866c-0x104;const _0x74a04f=a0_0x596f();let _0x134fbf=_0x74a04f[_0x3f866c];return _0x134fbf;}const saved=localStorage[a0_0x32ae20(0x150)](a0_0x32ae20(0x132));if(saved)try{messages=JSON[a0_0x32ae20(0x17b)](saved),renderMessages();}catch(a0_0xc7b08a){}updateSendButton();