const a0_0x3ed82a=a0_0x3496;(function(_0x3f2281,_0x4c2057){const _0x77aed9=a0_0x3496,_0x253206=_0x3f2281();while(!![]){try{const _0x569ebd=-parseInt(_0x77aed9(0x119))/0x1*(-parseInt(_0x77aed9(0xd8))/0x2)+-parseInt(_0x77aed9(0xf5))/0x3+-parseInt(_0x77aed9(0x133))/0x4+-parseInt(_0x77aed9(0xd7))/0x5+-parseInt(_0x77aed9(0xf2))/0x6+parseInt(_0x77aed9(0xd0))/0x7+-parseInt(_0x77aed9(0x139))/0x8*(-parseInt(_0x77aed9(0x11e))/0x9);if(_0x569ebd===_0x4c2057)break;else _0x253206['push'](_0x253206['shift']());}catch(_0x583834){_0x253206['push'](_0x253206['shift']());}}}(a0_0x1e93,0x92288));const tg=window[a0_0x3ed82a(0xe2)]?.[a0_0x3ed82a(0xe5)],HOME_URL=a0_0x3ed82a(0x118);function setupTelegramBackButton(){const _0x4f7236=a0_0x3ed82a,_0xa484b6=(function(){let _0x368255=!![];return function(_0x5704aa,_0x341c34){const _0x495375=_0x368255?function(){if(_0x341c34){const _0x120a5d=_0x341c34['apply'](_0x5704aa,arguments);return _0x341c34=null,_0x120a5d;}}:function(){};return _0x368255=![],_0x495375;};}()),_0x5c44fd=_0xa484b6(this,function(){const _0x5efe38=a0_0x3496;return _0x5c44fd[_0x5efe38(0x104)]()['search'](_0x5efe38(0x124))[_0x5efe38(0x104)]()[_0x5efe38(0x122)](_0x5c44fd)[_0x5efe38(0xd3)](_0x5efe38(0x124));});_0x5c44fd();if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x4f7236(0x120)]?.(_0x4f7236(0x102));if(tg[_0x4f7236(0xd2)]?.(_0x4f7236(0x134)))tg['disableVerticalSwipes']?.();const _0x522960=tg[_0x4f7236(0x117)];if(_0x522960){_0x522960[_0x4f7236(0xdc)]();if(typeof _0x522960[_0x4f7236(0x10c)]===_0x4f7236(0x12e))try{_0x522960['offClick']();}catch(_0x241b1f){}_0x522960[_0x4f7236(0x108)](()=>{const _0x855b4a=_0x4f7236;if(tg[_0x855b4a(0x12b)])tg['HapticFeedback']['impactOccurred']('light');location['href']=HOME_URL;});}}catch(_0x217e4d){console[_0x4f7236(0xf9)](_0x4f7236(0xf7),_0x217e4d);}}function a0_0x1e93(){const _0x4ccd49=['BackButton','./router.html','39641fTGiOs','ai_chat_messages','username','onclick','Начнется\x20новый\x20диалог.','27cCCGuD','add','setHeaderColor','getItem','constructor','scrollHeight','(((.+)+)+)+$','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','delete-btn','textContent','classList','length','replace','HapticFeedback','className','height','function','div','modalTitle','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','querySelector','3370548SahVeB','6.1','key','random','remove','typingIndicator','7389016odXuqb','timestamp','emptyState','viewportChanged','.message.show-delete','createElement','push','addEventListener','value','floor','abort','1397606IlWssI','children','isVersionAtLeast','search','appendChild','focus','Пустой\x20ответ','4732370eezxMI','28WGOxud','error','contains','now','show','text','modalText','touchstart','trim','splice','Telegram','modalConfirm','scrollTop','WebApp','inputArea','onEvent','message\x20ai','stopPropagation','notificationOccurred','stringify','user','role','.container','Enter','signal','paddingBottom','6715014rWZIQx','getElementById','viewportHeight','55707lWfTil','send_message','TG\x20setup\x20error:','messageInput','warn','debug_uid','offsetHeight','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','target','padStart','sendBtn','flex','input','#050505','Удалить?','toString','clear_history','modalCancel','success','onClick','display','innerHTML','<br>','offClick','setItem','impactOccurred','Очистить\x20историю?','show-delete','first_name','message\x20','style','click','innerHeight','forEach'];a0_0x1e93=function(){return _0x4ccd49;};return a0_0x1e93();}(function initStableLayout(){const _0x4c8d57=a0_0x3ed82a,_0x1e194f=document[_0x4c8d57(0x132)](_0x4c8d57(0xee)),_0x17d2e5=document[_0x4c8d57(0xf3)](_0x4c8d57(0xe6)),_0x19b0a5=document[_0x4c8d57(0xf3)]('chatArea'),_0x280cfd=document[_0x4c8d57(0xf3)](_0x4c8d57(0xf8));function _0x1cba56(){const _0x1419c2=_0x4c8d57;if(!_0x1e194f)return;const _0x55c746=tg&&tg[_0x1419c2(0xf4)]?tg[_0x1419c2(0xf4)]:window[_0x1419c2(0x115)];_0x1e194f[_0x1419c2(0x113)][_0x1419c2(0x12d)]=_0x55c746+'px';if(_0x17d2e5){const _0xfa1e9b=_0x17d2e5[_0x1419c2(0xfb)];_0x19b0a5[_0x1419c2(0x113)][_0x1419c2(0xf1)]=_0xfa1e9b+0x28+'px';}}tg?tg[_0x4c8d57(0xe7)](_0x4c8d57(0xc8),({isStateStable:_0x2b2b5b})=>{_0x1cba56();if(_0x2b2b5b)requestAnimationFrame(()=>{const _0xff5ae0=a0_0x3496;_0x19b0a5[_0xff5ae0(0xe4)]=_0x19b0a5[_0xff5ae0(0x123)];});}):window[_0x4c8d57(0xcc)]('resize',_0x1cba56),_0x1cba56(),_0x280cfd&&(_0x280cfd[_0x4c8d57(0xcc)](_0x4c8d57(0x101),()=>{requestAnimationFrame(_0x1cba56);}),_0x280cfd['addEventListener'](_0x4c8d57(0xd5),()=>{setTimeout(()=>{const _0x2e876d=a0_0x3496;_0x19b0a5[_0x2e876d(0xe4)]=_0x19b0a5[_0x2e876d(0x123)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3ed82a(0x125),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3ed82a(0xf3)]('chatArea'),emptyState=document[a0_0x3ed82a(0xf3)](a0_0x3ed82a(0xc7)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x3ed82a(0xf3)](a0_0x3ed82a(0xff)),clearBtn=document[a0_0x3ed82a(0xf3)]('clearBtn'),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0x3ed82a(0xf3)](a0_0x3ed82a(0x130)),mText=document[a0_0x3ed82a(0xf3)](a0_0x3ed82a(0xde));let modalCallback=null;async function callBackend(_0x10beb0,_0x3e82e0){const _0x86d72a=a0_0x3ed82a,_0x142938=tg?.['initDataUnsafe']?.[_0x86d72a(0xec)]||{},_0x1f344f=_0x142938['id']||localStorage[_0x86d72a(0x121)](_0x86d72a(0xfa))||'d-'+Math[_0x86d72a(0xce)](Math[_0x86d72a(0x136)]()*0x3b9aca00);if(!_0x142938['id'])localStorage[_0x86d72a(0x10d)](_0x86d72a(0xfa),_0x1f344f);const _0x20d172={'action':_0x10beb0,'user_id':_0x1f344f,'user_data':{'first_name':_0x142938[_0x86d72a(0x111)],'username':_0x142938[_0x86d72a(0x11b)]},'init_data':tg?.['initData']||'',..._0x3e82e0},_0x2be62a=new AbortController(),_0x1cecc0=setTimeout(()=>_0x2be62a[_0x86d72a(0xcf)](),REQUEST_TIMEOUT_MS);try{const _0x324503=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x86d72a(0xeb)](_0x20d172),'signal':_0x2be62a[_0x86d72a(0xf0)]});return clearTimeout(_0x1cecc0),await _0x324503['json']();}catch(_0x2dda81){return{'success':![],'error':String(_0x2dda81)};}}function formatTime(_0x1d5fc5){const _0x16962a=a0_0x3ed82a,_0x15ff56=new Date(_0x1d5fc5);return String(_0x15ff56['getHours']())[_0x16962a(0xfe)](0x2,'0')+':'+String(_0x15ff56['getMinutes']())[_0x16962a(0xfe)](0x2,'0');}function a0_0x3496(_0x169a1e,_0x582c98){_0x169a1e=_0x169a1e-0xc6;const _0x4e1c89=a0_0x1e93();let _0x184138=_0x4e1c89[_0x169a1e];return _0x184138;}function createMessageElement(_0x4a13dd,_0x4b05fc){const _0x264359=a0_0x3ed82a,_0x38a86d=document['createElement'](_0x264359(0x12f));_0x38a86d[_0x264359(0x12c)]=_0x264359(0x112)+_0x4a13dd[_0x264359(0xed)];const _0x47d1be=document[_0x264359(0xca)](_0x264359(0x12f));_0x47d1be[_0x264359(0x12c)]='message-bubble',_0x47d1be[_0x264359(0x10a)]=_0x4a13dd['content'][_0x264359(0x12a)](/\n/g,_0x264359(0x10b));const _0x174fe9=document['createElement'](_0x264359(0x12f));_0x174fe9['className']=_0x264359(0x126),_0x174fe9[_0x264359(0x10a)]=_0x264359(0xfc),_0x174fe9['onclick']=_0x497c7a=>{const _0x3d6ec3=_0x264359;_0x497c7a[_0x3d6ec3(0xe9)](),confirmDelete(_0x4b05fc);};let _0x2762f7;_0x47d1be[_0x264359(0xcc)](_0x264359(0xdf),()=>_0x2762f7=setTimeout(()=>{const _0x57ab07=_0x264359;_0x38a86d['classList'][_0x57ab07(0x11f)]('show-delete');if(tg?.[_0x57ab07(0x12b)])tg[_0x57ab07(0x12b)][_0x57ab07(0x10e)]('medium');},0x1f4)),_0x47d1be[_0x264359(0xcc)]('touchend',()=>clearTimeout(_0x2762f7));const _0x1e8558=document[_0x264359(0xca)](_0x264359(0x12f));return _0x1e8558[_0x264359(0x12c)]='message-time',_0x1e8558[_0x264359(0x127)]=formatTime(_0x4a13dd[_0x264359(0xc6)]),_0x38a86d[_0x264359(0xd4)](_0x174fe9),_0x38a86d['appendChild'](_0x47d1be),_0x38a86d[_0x264359(0xd4)](_0x1e8558),_0x38a86d;}function createTypingIndicator(){const _0x22dda9=a0_0x3ed82a,_0x1f42d9=document[_0x22dda9(0xca)](_0x22dda9(0x12f));return _0x1f42d9['className']=_0x22dda9(0xe8),_0x1f42d9['id']=_0x22dda9(0x138),_0x1f42d9[_0x22dda9(0x10a)]=_0x22dda9(0x131),_0x1f42d9;}function renderMessages(){const _0x4a6160=a0_0x3ed82a;Array['from'](chatArea[_0x4a6160(0xd1)])[_0x4a6160(0x116)](_0x5d174d=>{const _0xadff8b=_0x4a6160;if(_0x5d174d['id']!==_0xadff8b(0xc7))_0x5d174d['remove']();}),messages['length']>0x0?(emptyState[_0x4a6160(0x113)]['display']='none',messages['forEach']((_0x47aae4,_0xd10a12)=>chatArea[_0x4a6160(0xd4)](createMessageElement(_0x47aae4,_0xd10a12)))):emptyState['style'][_0x4a6160(0x109)]=_0x4a6160(0x100),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x3cac2a=a0_0x3ed82a;messageInput[_0x3cac2a(0x113)]['height']='auto',messageInput[_0x3cac2a(0x113)]['height']=Math['min'](messageInput[_0x3cac2a(0x123)],0x78)+'px';}function updateSendButton(){const _0x5eb51e=a0_0x3ed82a,_0x4e0ae5=messageInput['value'][_0x5eb51e(0xe0)]();sendBtn['disabled']=!_0x4e0ae5||isTyping;}async function sendMessage(){const _0x41adc3=a0_0x3ed82a,_0x1f5faf=messageInput[_0x41adc3(0xcd)][_0x41adc3(0xe0)]();if(!_0x1f5faf||isTyping)return;if(tg?.[_0x41adc3(0x12b)])tg[_0x41adc3(0x12b)][_0x41adc3(0x10e)]('light');messages[_0x41adc3(0xcb)]({'role':_0x41adc3(0xec),'content':_0x1f5faf,'timestamp':Date[_0x41adc3(0xdb)]()}),localStorage[_0x41adc3(0x10d)](_0x41adc3(0x11a),JSON['stringify'](messages)),renderMessages(),messageInput[_0x41adc3(0xcd)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x41adc3(0xe4)]=chatArea[_0x41adc3(0x123)];const _0x540b5f=await callBackend(_0x41adc3(0xf6),{'message':_0x1f5faf});isTyping=![];const _0x1999eb=document[_0x41adc3(0xf3)](_0x41adc3(0x138));if(_0x1999eb)_0x1999eb[_0x41adc3(0x137)]();let _0x264a8a='Ошибка\x20сети';if(_0x540b5f[_0x41adc3(0x107)]){_0x264a8a=_0x540b5f[_0x41adc3(0xdd)]||_0x41adc3(0xd6);if(tg?.[_0x41adc3(0x12b)])tg[_0x41adc3(0x12b)]['notificationOccurred']('success');}else{_0x264a8a=_0x540b5f[_0x41adc3(0xd9)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x41adc3(0xea)]('error');}messages[_0x41adc3(0xcb)]({'role':'ai','content':_0x264a8a,'timestamp':Date['now']()}),localStorage[_0x41adc3(0x10d)](_0x41adc3(0x11a),JSON[_0x41adc3(0xeb)](messages)),renderMessages();}function confirmDelete(_0x51d458){const _0x10b6b3=a0_0x3ed82a;if(mTitle)mTitle[_0x10b6b3(0x127)]=_0x10b6b3(0x103);if(mText)mText[_0x10b6b3(0x127)]='Действие\x20необратимо.';modalCallback=()=>{const _0x25fea8=_0x10b6b3;messages[_0x25fea8(0xe1)](_0x51d458,0x1),localStorage[_0x25fea8(0x10d)](_0x25fea8(0x11a),JSON['stringify'](messages)),renderMessages();},modal[_0x10b6b3(0x128)][_0x10b6b3(0x11f)]('show');}if(clearBtn)clearBtn[a0_0x3ed82a(0x11c)]=()=>{const _0x232306=a0_0x3ed82a;if(!messages[_0x232306(0x129)])return;if(mTitle)mTitle['textContent']=_0x232306(0x10f);if(mText)mText[_0x232306(0x127)]=_0x232306(0x11d);modalCallback=async()=>{const _0x29c987=_0x232306;messages=[],localStorage['removeItem'](_0x29c987(0x11a)),renderMessages(),callBackend(_0x29c987(0x105),{});},modal[_0x232306(0x128)]['add'](_0x232306(0xdc));};document[a0_0x3ed82a(0xf3)](a0_0x3ed82a(0x106))[a0_0x3ed82a(0x11c)]=()=>modal['classList'][a0_0x3ed82a(0x137)]('show'),document['getElementById'](a0_0x3ed82a(0xe3))[a0_0x3ed82a(0x11c)]=()=>{const _0x2a6cbf=a0_0x3ed82a;if(modalCallback)modalCallback();modal['classList'][_0x2a6cbf(0x137)](_0x2a6cbf(0xdc));},messageInput[a0_0x3ed82a(0xcc)](a0_0x3ed82a(0x101),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3ed82a(0xcc)]('keydown',_0x312673=>{const _0x523a8f=a0_0x3ed82a;_0x312673[_0x523a8f(0x135)]===_0x523a8f(0xef)&&!_0x312673['shiftKey']&&(_0x312673['preventDefault'](),sendMessage());}),sendBtn[a0_0x3ed82a(0x11c)]=sendMessage,document[a0_0x3ed82a(0xcc)](a0_0x3ed82a(0x114),_0x389209=>{const _0x897596=a0_0x3ed82a;document['querySelectorAll'](_0x897596(0xc9))['forEach'](_0x23a268=>{const _0x518d76=_0x897596;if(!_0x23a268[_0x518d76(0xda)](_0x389209[_0x518d76(0xfd)]))_0x23a268[_0x518d76(0x128)][_0x518d76(0x137)](_0x518d76(0x110));});});const saved=localStorage[a0_0x3ed82a(0x121)](a0_0x3ed82a(0x11a));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x5831f9){}updateSendButton();