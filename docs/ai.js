const a0_0x39c858=a0_0xd946;(function(_0x2ebc10,_0x568bbf){const _0x27325a=a0_0xd946,_0x30f204=_0x2ebc10();while(!![]){try{const _0x77db0c=-parseInt(_0x27325a(0xfe))/0x1*(-parseInt(_0x27325a(0x14b))/0x2)+-parseInt(_0x27325a(0x114))/0x3*(-parseInt(_0x27325a(0x122))/0x4)+-parseInt(_0x27325a(0xf3))/0x5*(parseInt(_0x27325a(0x116))/0x6)+parseInt(_0x27325a(0x129))/0x7+parseInt(_0x27325a(0xd3))/0x8*(-parseInt(_0x27325a(0x125))/0x9)+-parseInt(_0x27325a(0xce))/0xa+parseInt(_0x27325a(0x10b))/0xb;if(_0x77db0c===_0x568bbf)break;else _0x30f204['push'](_0x30f204['shift']());}catch(_0x9e7808){_0x30f204['push'](_0x30f204['shift']());}}}(a0_0x456e,0x7ccc3));const tg=window[a0_0x39c858(0x133)]?.[a0_0x39c858(0x120)],HOME_URL=a0_0x39c858(0x109);function setupTelegramBackButton(){const _0xa31793=a0_0x39c858,_0x353bef=(function(){let _0x536297=!![];return function(_0x245f36,_0x241eb0){const _0x30eafc=_0x536297?function(){const _0x2bf3ce=a0_0xd946;if(_0x241eb0){const _0xbcc9ef=_0x241eb0[_0x2bf3ce(0x134)](_0x245f36,arguments);return _0x241eb0=null,_0xbcc9ef;}}:function(){};return _0x536297=![],_0x30eafc;};}()),_0x4b1621=_0x353bef(this,function(){const _0x1ac927=a0_0xd946;return _0x4b1621[_0x1ac927(0x106)]()[_0x1ac927(0xef)](_0x1ac927(0x135))[_0x1ac927(0x106)]()['constructor'](_0x4b1621)[_0x1ac927(0xef)](_0x1ac927(0x135));});_0x4b1621();if(!tg)return;try{tg['ready'](),tg[_0xa31793(0x141)](),tg[_0xa31793(0x144)]?.(_0xa31793(0xe6));if(tg['isVersionAtLeast']?.(_0xa31793(0xe1)))tg[_0xa31793(0x143)]?.();const _0x2c5874=tg[_0xa31793(0x10c)];if(_0x2c5874){_0x2c5874[_0xa31793(0xe5)]();if(typeof _0x2c5874[_0xa31793(0x10a)]===_0xa31793(0x139))try{_0x2c5874[_0xa31793(0x10a)]();}catch(_0x1f2726){}_0x2c5874[_0xa31793(0x11d)](()=>{const _0x32fe6c=_0xa31793;if(tg[_0x32fe6c(0x131)])tg[_0x32fe6c(0x131)][_0x32fe6c(0x101)]('light');location['href']=HOME_URL;});}}catch(_0x4b916b){console[_0xa31793(0xe8)](_0xa31793(0x145),_0x4b916b);}}(function initStableLayout(){const _0x446fd8=a0_0x39c858,_0x3e6043=document[_0x446fd8(0xed)](_0x446fd8(0x123)),_0x325703=document[_0x446fd8(0xee)](_0x446fd8(0x137)),_0x11a5c6=document['getElementById'](_0x446fd8(0x13f)),_0x40bca7=document[_0x446fd8(0xee)]('messageInput');function _0xa180c1(){const _0x205ae5=_0x446fd8;if(!_0x3e6043)return;const _0x38b299=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x205ae5(0xf7)];_0x3e6043[_0x205ae5(0x100)][_0x205ae5(0x121)]=_0x38b299+'px';if(_0x325703){const _0xb2e1aa=_0x325703[_0x205ae5(0x149)];_0x11a5c6['style'][_0x205ae5(0xea)]=_0xb2e1aa+0x28+'px';}}tg?tg[_0x446fd8(0x127)](_0x446fd8(0xcf),({isStateStable:_0xe9560d})=>{_0xa180c1();if(_0xe9560d)requestAnimationFrame(()=>{_0x11a5c6['scrollTop']=_0x11a5c6['scrollHeight'];});}):window[_0x446fd8(0x12d)](_0x446fd8(0x10f),_0xa180c1),_0xa180c1(),_0x40bca7&&(_0x40bca7[_0x446fd8(0x12d)](_0x446fd8(0xdc),()=>{requestAnimationFrame(_0xa180c1);}),_0x40bca7[_0x446fd8(0x12d)](_0x446fd8(0x13a),()=>{setTimeout(()=>{const _0x142341=a0_0xd946;_0x11a5c6[_0x142341(0x138)]=_0x11a5c6[_0x142341(0xfa)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x39c858(0x11b),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x39c858(0xee)](a0_0x39c858(0x13f)),emptyState=document[a0_0x39c858(0xee)](a0_0x39c858(0xeb)),messageInput=document[a0_0x39c858(0xee)]('messageInput'),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x39c858(0xee)](a0_0x39c858(0xf8)),modal=document[a0_0x39c858(0xee)](a0_0x39c858(0xe9)),mTitle=document[a0_0x39c858(0xee)]('modalTitle'),mText=document[a0_0x39c858(0xee)](a0_0x39c858(0xf4));function a0_0xd946(_0x4c1723,_0x131a59){_0x4c1723=_0x4c1723-0xce;const _0x4ec6c6=a0_0x456e();let _0x6fc0d4=_0x4ec6c6[_0x4c1723];return _0x6fc0d4;}let modalCallback=null;async function callBackend(_0xb72cd3,_0x2270f3){const _0x42cdb2=a0_0x39c858,_0x35ae62=tg?.[_0x42cdb2(0xd1)]?.[_0x42cdb2(0x12c)]||{},_0x38d07b=_0x35ae62['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x42cdb2(0x113)](Math[_0x42cdb2(0x110)]()*0x3b9aca00);if(!_0x35ae62['id'])localStorage[_0x42cdb2(0x140)](_0x42cdb2(0xe7),_0x38d07b);const _0x9d4c02={'action':_0xb72cd3,'user_id':_0x38d07b,'user_data':{'first_name':_0x35ae62[_0x42cdb2(0xdb)],'username':_0x35ae62['username']},'init_data':tg?.['initData']||'',..._0x2270f3},_0x3f6ca4=new AbortController(),_0x597c55=setTimeout(()=>_0x3f6ca4['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5b68a2=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x9d4c02),'signal':_0x3f6ca4[_0x42cdb2(0x12b)]});return clearTimeout(_0x597c55),await _0x5b68a2['json']();}catch(_0xf571d5){return{'success':![],'error':String(_0xf571d5)};}}function a0_0x456e(){const _0x4ba26a=['offsetHeight','touchstart','114tFUUTC','light','6714400QqOUnb','viewportChanged','text','initDataUnsafe','contains','8uKtIbc','querySelectorAll','add','preventDefault','key','flex','clear_history','target','first_name','input','click','stopPropagation','textContent','getHours','6.1','display','show-delete','Действие\x20необратимо.','show','#050505','debug_uid','warn','confirmModal','paddingBottom','emptyState','error','querySelector','getElementById','search','success','getItem','parse','221250GNbawM','modalText','notificationOccurred','push','innerHeight','clearBtn','onclick','scrollHeight','typingIndicator','Enter','children','4987VqcFYK','forEach','style','impactOccurred','value','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','ai_chat_messages','Начнется\x20новый\x20диалог.','toString','message\x20ai','min','./router.html','offClick','7663480DAoCgQ','BackButton','now','message-time','resize','random','content','disabled','floor','36WRNvYa','padStart','24COsMuY','createElement','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','delete-btn','none','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','trim','onClick','div','length','WebApp','height','91516bkkTcj','.container','modalCancel','5055039eSQwTj','role','onEvent','shiftKey','4660565CZbBTA','classList','signal','user','addEventListener','modalConfirm','<br>','getMinutes','HapticFeedback','Пустой\x20ответ','Telegram','apply','(((.+)+)+)+$','Очистить\x20историю?','inputArea','scrollTop','function','focus','keydown','message\x20','stringify','appendChild','chatArea','setItem','expand','className','disableVerticalSwipes','setHeaderColor','TG\x20setup\x20error:','remove','innerHTML','splice'];a0_0x456e=function(){return _0x4ba26a;};return a0_0x456e();}function formatTime(_0x4f856c){const _0x2aa710=a0_0x39c858,_0x318241=new Date(_0x4f856c);return String(_0x318241[_0x2aa710(0xe0)]())[_0x2aa710(0x115)](0x2,'0')+':'+String(_0x318241[_0x2aa710(0x130)]())[_0x2aa710(0x115)](0x2,'0');}function createMessageElement(_0x3782a0,_0x1b28de){const _0x29baf9=a0_0x39c858,_0x34c440=document[_0x29baf9(0x117)]('div');_0x34c440[_0x29baf9(0x142)]=_0x29baf9(0x13c)+_0x3782a0[_0x29baf9(0x126)];const _0x39e588=document[_0x29baf9(0x117)](_0x29baf9(0x11e));_0x39e588[_0x29baf9(0x142)]='message-bubble',_0x39e588[_0x29baf9(0x147)]=_0x3782a0[_0x29baf9(0x111)]['replace'](/\n/g,_0x29baf9(0x12f));const _0x2b2d4f=document['createElement'](_0x29baf9(0x11e));_0x2b2d4f[_0x29baf9(0x142)]=_0x29baf9(0x119),_0x2b2d4f['innerHTML']=_0x29baf9(0x103),_0x2b2d4f[_0x29baf9(0xf9)]=_0x255762=>{const _0x356c46=_0x29baf9;_0x255762[_0x356c46(0xde)](),confirmDelete(_0x1b28de);};let _0x1b15e0;_0x39e588[_0x29baf9(0x12d)](_0x29baf9(0x14a),()=>_0x1b15e0=setTimeout(()=>{const _0x310782=_0x29baf9;_0x34c440[_0x310782(0x12a)][_0x310782(0xd5)](_0x310782(0xe3));if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x310782(0x101)]('medium');},0x1f4)),_0x39e588[_0x29baf9(0x12d)]('touchend',()=>clearTimeout(_0x1b15e0));const _0x1f8adb=document[_0x29baf9(0x117)](_0x29baf9(0x11e));return _0x1f8adb['className']=_0x29baf9(0x10e),_0x1f8adb[_0x29baf9(0xdf)]=formatTime(_0x3782a0['timestamp']),_0x34c440['appendChild'](_0x2b2d4f),_0x34c440[_0x29baf9(0x13e)](_0x39e588),_0x34c440[_0x29baf9(0x13e)](_0x1f8adb),_0x34c440;}function createTypingIndicator(){const _0xe95c4=a0_0x39c858,_0x3f6ee4=document[_0xe95c4(0x117)](_0xe95c4(0x11e));return _0x3f6ee4[_0xe95c4(0x142)]=_0xe95c4(0x107),_0x3f6ee4['id']=_0xe95c4(0xfb),_0x3f6ee4[_0xe95c4(0x147)]=_0xe95c4(0x118),_0x3f6ee4;}function renderMessages(){const _0x4c34e8=a0_0x39c858;Array['from'](chatArea[_0x4c34e8(0xfd)])[_0x4c34e8(0xff)](_0x52a853=>{const _0x350b8e=_0x4c34e8;if(_0x52a853['id']!==_0x350b8e(0xeb))_0x52a853[_0x350b8e(0x146)]();}),messages[_0x4c34e8(0x11f)]>0x0?(emptyState['style'][_0x4c34e8(0xe2)]=_0x4c34e8(0x11a),messages[_0x4c34e8(0xff)]((_0x3ce641,_0x15ec7a)=>chatArea[_0x4c34e8(0x13e)](createMessageElement(_0x3ce641,_0x15ec7a)))):emptyState[_0x4c34e8(0x100)][_0x4c34e8(0xe2)]=_0x4c34e8(0xd8),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x4c34e8(0xfa)]);}function autoResizeTextarea(){const _0x23b7c8=a0_0x39c858;messageInput[_0x23b7c8(0x100)]['height']='auto',messageInput['style'][_0x23b7c8(0x121)]=Math[_0x23b7c8(0x108)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x552a38=a0_0x39c858,_0x17ed64=messageInput[_0x552a38(0x102)]['trim']();sendBtn[_0x552a38(0x112)]=!_0x17ed64||isTyping;}async function sendMessage(){const _0x391acc=a0_0x39c858,_0x5469db=messageInput['value'][_0x391acc(0x11c)]();if(!_0x5469db||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x391acc(0x131)][_0x391acc(0x101)](_0x391acc(0x14c));messages[_0x391acc(0xf6)]({'role':_0x391acc(0x12c),'content':_0x5469db,'timestamp':Date['now']()}),localStorage[_0x391acc(0x140)](_0x391acc(0x104),JSON['stringify'](messages)),renderMessages(),messageInput[_0x391acc(0x102)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x391acc(0x13e)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x391acc(0xfa)];const _0x129aa9=await callBackend('send_message',{'message':_0x5469db});isTyping=![];const _0x450d61=document[_0x391acc(0xee)](_0x391acc(0xfb));if(_0x450d61)_0x450d61[_0x391acc(0x146)]();let _0x30bf99='Ошибка\x20сети';if(_0x129aa9['success']){_0x30bf99=_0x129aa9[_0x391acc(0xd0)]||_0x391acc(0x132);if(tg?.[_0x391acc(0x131)])tg[_0x391acc(0x131)][_0x391acc(0xf5)](_0x391acc(0xf0));}else{_0x30bf99=_0x129aa9['error']||'Ошибка\x20сервера';if(tg?.[_0x391acc(0x131)])tg[_0x391acc(0x131)][_0x391acc(0xf5)](_0x391acc(0xec));}messages['push']({'role':'ai','content':_0x30bf99,'timestamp':Date[_0x391acc(0x10d)]()}),localStorage[_0x391acc(0x140)]('ai_chat_messages',JSON[_0x391acc(0x13d)](messages)),renderMessages();}function confirmDelete(_0x380d5c){const _0x20ed7d=a0_0x39c858;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText['textContent']=_0x20ed7d(0xe4);modalCallback=()=>{const _0x519c31=_0x20ed7d;messages[_0x519c31(0x148)](_0x380d5c,0x1),localStorage['setItem'](_0x519c31(0x104),JSON[_0x519c31(0x13d)](messages)),renderMessages();},modal[_0x20ed7d(0x12a)]['add']('show');}if(clearBtn)clearBtn[a0_0x39c858(0xf9)]=()=>{const _0xa53f56=a0_0x39c858;if(!messages[_0xa53f56(0x11f)])return;if(mTitle)mTitle[_0xa53f56(0xdf)]=_0xa53f56(0x136);if(mText)mText[_0xa53f56(0xdf)]=_0xa53f56(0x105);modalCallback=async()=>{const _0x398d15=_0xa53f56;messages=[],localStorage['removeItem'](_0x398d15(0x104)),renderMessages(),callBackend(_0x398d15(0xd9),{});},modal['classList'][_0xa53f56(0xd5)]('show');};document['getElementById'](a0_0x39c858(0x124))[a0_0x39c858(0xf9)]=()=>modal[a0_0x39c858(0x12a)][a0_0x39c858(0x146)]('show'),document[a0_0x39c858(0xee)](a0_0x39c858(0x12e))[a0_0x39c858(0xf9)]=()=>{const _0x9913b3=a0_0x39c858;if(modalCallback)modalCallback();modal[_0x9913b3(0x12a)][_0x9913b3(0x146)](_0x9913b3(0xe5));},messageInput[a0_0x39c858(0x12d)](a0_0x39c858(0xdc),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x39c858(0x12d)](a0_0x39c858(0x13b),_0x5ecde9=>{const _0x53a446=a0_0x39c858;_0x5ecde9[_0x53a446(0xd7)]===_0x53a446(0xfc)&&!_0x5ecde9[_0x53a446(0x128)]&&(_0x5ecde9[_0x53a446(0xd6)](),sendMessage());}),sendBtn[a0_0x39c858(0xf9)]=sendMessage,document[a0_0x39c858(0x12d)](a0_0x39c858(0xdd),_0x1b3869=>{const _0x27d7e0=a0_0x39c858;document[_0x27d7e0(0xd4)]('.message.show-delete')[_0x27d7e0(0xff)](_0x17d224=>{const _0x318468=_0x27d7e0;if(!_0x17d224[_0x318468(0xd2)](_0x1b3869[_0x318468(0xda)]))_0x17d224['classList'][_0x318468(0x146)](_0x318468(0xe3));});});const saved=localStorage[a0_0x39c858(0xf1)](a0_0x39c858(0x104));if(saved)try{messages=JSON[a0_0x39c858(0xf2)](saved),renderMessages();}catch(a0_0x3107f8){}updateSendButton();