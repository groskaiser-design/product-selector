const a0_0x53721a=a0_0x2666;(function(_0x2b2f25,_0x11cfe5){const _0xdd0257=a0_0x2666,_0x3d5af4=_0x2b2f25();while(!![]){try{const _0x4dcfcb=-parseInt(_0xdd0257(0x1d5))/0x1+parseInt(_0xdd0257(0x217))/0x2+parseInt(_0xdd0257(0x215))/0x3*(parseInt(_0xdd0257(0x1f4))/0x4)+-parseInt(_0xdd0257(0x252))/0x5+parseInt(_0xdd0257(0x1f5))/0x6+-parseInt(_0xdd0257(0x232))/0x7+parseInt(_0xdd0257(0x238))/0x8;if(_0x4dcfcb===_0x11cfe5)break;else _0x3d5af4['push'](_0x3d5af4['shift']());}catch(_0x57f725){_0x3d5af4['push'](_0x3d5af4['shift']());}}}(a0_0x1ff2,0x3f553));const tg=window[a0_0x53721a(0x1e1)]?.[a0_0x53721a(0x248)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x2bd576=a0_0x53721a,_0x56390f=(function(){let _0x37cb3f=!![];return function(_0x32a6e2,_0x3fd216){const _0x269a88=_0x37cb3f?function(){if(_0x3fd216){const _0x4481f4=_0x3fd216['apply'](_0x32a6e2,arguments);return _0x3fd216=null,_0x4481f4;}}:function(){};return _0x37cb3f=![],_0x269a88;};}()),_0x1b4609=_0x56390f(this,function(){const _0x1e3267=a0_0x2666;return _0x1b4609[_0x1e3267(0x1e4)]()['search']('(((.+)+)+)+$')[_0x1e3267(0x1e4)]()[_0x1e3267(0x1ef)](_0x1b4609)[_0x1e3267(0x1e5)]('(((.+)+)+)+$');});_0x1b4609();if(!tg)return;try{tg[_0x2bd576(0x1e7)](),tg[_0x2bd576(0x230)](),tg[_0x2bd576(0x22f)]?.(_0x2bd576(0x1fb));if(tg['isVersionAtLeast']?.(_0x2bd576(0x1ff)))tg['disableVerticalSwipes']?.();const _0x453b35=tg[_0x2bd576(0x1f0)];if(_0x453b35){_0x453b35[_0x2bd576(0x1dc)]();if(typeof _0x453b35['offClick']===_0x2bd576(0x24e))try{_0x453b35[_0x2bd576(0x225)]();}catch(_0x5a3538){}_0x453b35[_0x2bd576(0x1eb)](()=>{const _0x55171a=_0x2bd576;if(tg[_0x55171a(0x1db)])tg[_0x55171a(0x1db)]['impactOccurred'](_0x55171a(0x22c));location[_0x55171a(0x1e9)]=HOME_URL;});}}catch(_0x3a9eda){console[_0x2bd576(0x214)](_0x2bd576(0x249),_0x3a9eda);}}(function initStableLayout(){const _0x28c13a=a0_0x53721a,_0x3ea553=document['querySelector'](_0x28c13a(0x21b)),_0x45b0f8=document['getElementById'](_0x28c13a(0x1f1)),_0x50cb33=document['getElementById'](_0x28c13a(0x204)),_0x5555c3=document['getElementById'](_0x28c13a(0x23a));function _0x3acad6(){const _0x267834=_0x28c13a;if(!_0x3ea553)return;const _0x10dd75=tg&&tg[_0x267834(0x1d7)]?tg[_0x267834(0x1d7)]:window[_0x267834(0x1d2)];_0x3ea553[_0x267834(0x21e)]['height']=_0x10dd75+'px';if(_0x45b0f8){const _0x4c43ca=_0x45b0f8[_0x267834(0x246)];_0x50cb33['style'][_0x267834(0x250)]=_0x4c43ca+0x28+'px';}}tg?tg[_0x28c13a(0x201)](_0x28c13a(0x206),({isStateStable:_0x146123})=>{_0x3acad6();if(_0x146123)requestAnimationFrame(()=>{const _0x2793d9=a0_0x2666;_0x50cb33['scrollTop']=_0x50cb33[_0x2793d9(0x224)];});}):window[_0x28c13a(0x1da)]('resize',_0x3acad6),_0x3acad6(),_0x5555c3&&(_0x5555c3['addEventListener'](_0x28c13a(0x222),()=>{requestAnimationFrame(_0x3acad6);}),_0x5555c3[_0x28c13a(0x1da)](_0x28c13a(0x24a),()=>{setTimeout(()=>{const _0x41ea17=a0_0x2666;_0x50cb33[_0x41ea17(0x218)]=_0x50cb33[_0x41ea17(0x224)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x53721a(0x24f),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x53721a(0x1dd)](a0_0x53721a(0x204)),emptyState=document[a0_0x53721a(0x1dd)](a0_0x53721a(0x236)),messageInput=document['getElementById']('messageInput'),sendBtn=document['getElementById'](a0_0x53721a(0x241)),clearBtn=document['getElementById'](a0_0x53721a(0x24d)),modal=document[a0_0x53721a(0x1dd)](a0_0x53721a(0x227)),mTitle=document['getElementById'](a0_0x53721a(0x243)),mText=document['getElementById'](a0_0x53721a(0x223));let modalCallback=null;async function callBackend(_0x1eedf0,_0x4a0bd3){const _0x4ef634=a0_0x53721a,_0x4dff14=tg?.[_0x4ef634(0x253)]?.[_0x4ef634(0x1e6)]||{},_0x3b512b=_0x4dff14['id']||localStorage['getItem'](_0x4ef634(0x203))||'d-'+Math[_0x4ef634(0x202)](Math[_0x4ef634(0x1e8)]()*0x3b9aca00);if(!_0x4dff14['id'])localStorage[_0x4ef634(0x219)](_0x4ef634(0x203),_0x3b512b);const _0x5f12a8={'action':_0x1eedf0,'user_id':_0x3b512b,'user_data':{'first_name':_0x4dff14[_0x4ef634(0x221)],'username':_0x4dff14[_0x4ef634(0x251)]},'init_data':tg?.[_0x4ef634(0x1e3)]||'',..._0x4a0bd3},_0x3abc4e=new AbortController(),_0x542021=setTimeout(()=>_0x3abc4e[_0x4ef634(0x22d)](),REQUEST_TIMEOUT_MS);try{const _0x2d9d9e=await fetch(BACKEND_URL,{'method':_0x4ef634(0x20d),'headers':{'Content-Type':_0x4ef634(0x226)},'body':JSON[_0x4ef634(0x22e)](_0x5f12a8),'signal':_0x3abc4e[_0x4ef634(0x1e0)]});return clearTimeout(_0x542021),await _0x2d9d9e['json']();}catch(_0x2e9f5e){return{'success':![],'error':String(_0x2e9f5e)};}}function formatTime(_0x35159b){const _0x20b87e=a0_0x53721a,_0x51818b=new Date(_0x35159b);return String(_0x51818b[_0x20b87e(0x1ee)]())['padStart'](0x2,'0')+':'+String(_0x51818b[_0x20b87e(0x234)]())[_0x20b87e(0x21c)](0x2,'0');}function createMessageElement(_0x525564,_0x1037c1){const _0x453083=a0_0x53721a,_0x3f099e=document[_0x453083(0x240)](_0x453083(0x1fd));_0x3f099e[_0x453083(0x1ed)]='message\x20'+_0x525564[_0x453083(0x208)];const _0x1139d8=document[_0x453083(0x240)](_0x453083(0x1fd));_0x1139d8[_0x453083(0x1ed)]=_0x453083(0x1ea),_0x1139d8[_0x453083(0x1fa)]=_0x525564[_0x453083(0x1d4)][_0x453083(0x1f3)](/\n/g,_0x453083(0x1f9));const _0x742b11=document[_0x453083(0x240)]('div');_0x742b11[_0x453083(0x1ed)]=_0x453083(0x247),_0x742b11['innerHTML']=_0x453083(0x21a),_0x742b11['onclick']=_0x5de28a=>{const _0x1a72a1=_0x453083;_0x5de28a[_0x1a72a1(0x23c)](),confirmDelete(_0x1037c1);};let _0x41b49c;_0x1139d8[_0x453083(0x1da)](_0x453083(0x24c),()=>_0x41b49c=setTimeout(()=>{const _0x233493=_0x453083;_0x3f099e[_0x233493(0x20c)][_0x233493(0x231)]('show-delete');if(tg?.[_0x233493(0x1db)])tg[_0x233493(0x1db)][_0x233493(0x245)]('medium');},0x1f4)),_0x1139d8[_0x453083(0x1da)](_0x453083(0x20f),()=>clearTimeout(_0x41b49c));const _0x124f1d=document['createElement'](_0x453083(0x1fd));return _0x124f1d[_0x453083(0x1ed)]=_0x453083(0x1de),_0x124f1d[_0x453083(0x239)]=formatTime(_0x525564['timestamp']),_0x3f099e[_0x453083(0x212)](_0x742b11),_0x3f099e[_0x453083(0x212)](_0x1139d8),_0x3f099e[_0x453083(0x212)](_0x124f1d),_0x3f099e;}function createTypingIndicator(){const _0x367074=a0_0x53721a,_0x40ebf1=document[_0x367074(0x240)](_0x367074(0x1fd));return _0x40ebf1[_0x367074(0x1ed)]=_0x367074(0x237),_0x40ebf1['id']=_0x367074(0x216),_0x40ebf1['innerHTML']=_0x367074(0x1f7),_0x40ebf1;}function renderMessages(){const _0x5198c2=a0_0x53721a;Array[_0x5198c2(0x1d9)](chatArea[_0x5198c2(0x209)])[_0x5198c2(0x24b)](_0x330d81=>{const _0x5bd9a0=_0x5198c2;if(_0x330d81['id']!==_0x5bd9a0(0x236))_0x330d81['remove']();}),messages[_0x5198c2(0x22b)]>0x0?(emptyState[_0x5198c2(0x21e)][_0x5198c2(0x23e)]=_0x5198c2(0x205),messages[_0x5198c2(0x24b)]((_0xc6a41a,_0x1c6de5)=>chatArea[_0x5198c2(0x212)](createMessageElement(_0xc6a41a,_0x1c6de5)))):emptyState[_0x5198c2(0x21e)][_0x5198c2(0x23e)]=_0x5198c2(0x23d),requestAnimationFrame(()=>chatArea[_0x5198c2(0x218)]=chatArea['scrollHeight']);}function a0_0x1ff2(){const _0x484c99=['warn','349611ChEcVQ','typingIndicator','342286OGGJQo','scrollTop','setItem','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','.container','padStart','trim','style','target','remove','first_name','input','modalText','scrollHeight','offClick','text/plain','confirmModal','value','disabled','removeItem','length','light','abort','stringify','setHeaderColor','expand','add','1121141aUiqcx','Очистить\x20историю?','getMinutes','auto','emptyState','message\x20ai','5302024snKrPO','textContent','messageInput','Удалить?','stopPropagation','flex','display','Ошибка\x20сервера','createElement','sendBtn','splice','modalTitle','click','impactOccurred','offsetHeight','delete-btn','WebApp','TG\x20setup\x20error:','focus','forEach','touchstart','clearBtn','function','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','paddingBottom','username','1175510PQzFgt','initDataUnsafe','querySelectorAll','contains','innerHeight','notificationOccurred','content','326231eWpilW','error','viewportHeight','Пустой\x20ответ','from','addEventListener','HapticFeedback','show','getElementById','message-time','clear_history','signal','Telegram','send_message','initData','toString','search','user','ready','random','href','message-bubble','onClick','push','className','getHours','constructor','BackButton','inputArea','getItem','replace','4mdMQFv','182844VWBsUP','Начнется\x20новый\x20диалог.','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','success','<br>','innerHTML','#050505','parse','div','ai_chat_messages','6.1','min','onEvent','floor','debug_uid','chatArea','none','viewportChanged','now','role','children','keydown','key','classList','POST','height','touchend','text','onclick','appendChild','modalCancel'];a0_0x1ff2=function(){return _0x484c99;};return a0_0x1ff2();}function autoResizeTextarea(){const _0x32c668=a0_0x53721a;messageInput['style'][_0x32c668(0x20e)]=_0x32c668(0x235),messageInput['style'][_0x32c668(0x20e)]=Math[_0x32c668(0x200)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x1adf4f=a0_0x53721a,_0x19d796=messageInput[_0x1adf4f(0x228)][_0x1adf4f(0x21d)]();sendBtn[_0x1adf4f(0x229)]=!_0x19d796||isTyping;}async function sendMessage(){const _0x123d79=a0_0x53721a,_0x3a270c=messageInput[_0x123d79(0x228)][_0x123d79(0x21d)]();if(!_0x3a270c||isTyping)return;if(tg?.[_0x123d79(0x1db)])tg['HapticFeedback'][_0x123d79(0x245)](_0x123d79(0x22c));messages[_0x123d79(0x1ec)]({'role':_0x123d79(0x1e6),'content':_0x3a270c,'timestamp':Date[_0x123d79(0x207)]()}),localStorage['setItem'](_0x123d79(0x1fe),JSON[_0x123d79(0x22e)](messages)),renderMessages(),messageInput[_0x123d79(0x228)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x123d79(0x212)](createTypingIndicator()),chatArea[_0x123d79(0x218)]=chatArea[_0x123d79(0x224)];const _0x15d835=await callBackend(_0x123d79(0x1e2),{'message':_0x3a270c});isTyping=![];const _0xf2404b=document['getElementById']('typingIndicator');if(_0xf2404b)_0xf2404b[_0x123d79(0x220)]();let _0x46b14e='Ошибка\x20сети';if(_0x15d835[_0x123d79(0x1f8)]){_0x46b14e=_0x15d835[_0x123d79(0x210)]||_0x123d79(0x1d8);if(tg?.[_0x123d79(0x1db)])tg[_0x123d79(0x1db)][_0x123d79(0x1d3)](_0x123d79(0x1f8));}else{_0x46b14e=_0x15d835[_0x123d79(0x1d6)]||_0x123d79(0x23f);if(tg?.['HapticFeedback'])tg[_0x123d79(0x1db)]['notificationOccurred'](_0x123d79(0x1d6));}messages[_0x123d79(0x1ec)]({'role':'ai','content':_0x46b14e,'timestamp':Date[_0x123d79(0x207)]()}),localStorage[_0x123d79(0x219)](_0x123d79(0x1fe),JSON['stringify'](messages)),renderMessages();}function a0_0x2666(_0x1d74be,_0x2cc3cb){_0x1d74be=_0x1d74be-0x1d1;const _0x585d34=a0_0x1ff2();let _0x67f6b4=_0x585d34[_0x1d74be];return _0x67f6b4;}function confirmDelete(_0x22316d){const _0x29c710=a0_0x53721a;if(mTitle)mTitle[_0x29c710(0x239)]=_0x29c710(0x23b);if(mText)mText[_0x29c710(0x239)]='Действие\x20необратимо.';modalCallback=()=>{const _0x2375bd=_0x29c710;messages[_0x2375bd(0x242)](_0x22316d,0x1),localStorage[_0x2375bd(0x219)](_0x2375bd(0x1fe),JSON[_0x2375bd(0x22e)](messages)),renderMessages();},modal['classList']['add'](_0x29c710(0x1dc));}if(clearBtn)clearBtn[a0_0x53721a(0x211)]=()=>{const _0x7e8618=a0_0x53721a;if(!messages[_0x7e8618(0x22b)])return;if(mTitle)mTitle['textContent']=_0x7e8618(0x233);if(mText)mText['textContent']=_0x7e8618(0x1f6);modalCallback=async()=>{const _0x5a2440=_0x7e8618;messages=[],localStorage[_0x5a2440(0x22a)](_0x5a2440(0x1fe)),renderMessages(),callBackend(_0x5a2440(0x1df),{});},modal[_0x7e8618(0x20c)][_0x7e8618(0x231)](_0x7e8618(0x1dc));};document['getElementById'](a0_0x53721a(0x213))[a0_0x53721a(0x211)]=()=>modal[a0_0x53721a(0x20c)][a0_0x53721a(0x220)](a0_0x53721a(0x1dc)),document[a0_0x53721a(0x1dd)]('modalConfirm')[a0_0x53721a(0x211)]=()=>{const _0x1b1bc2=a0_0x53721a;if(modalCallback)modalCallback();modal['classList'][_0x1b1bc2(0x220)](_0x1b1bc2(0x1dc));},messageInput[a0_0x53721a(0x1da)](a0_0x53721a(0x222),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x53721a(0x1da)](a0_0x53721a(0x20a),_0x256b30=>{const _0x3b48ac=a0_0x53721a;_0x256b30[_0x3b48ac(0x20b)]==='Enter'&&!_0x256b30['shiftKey']&&(_0x256b30['preventDefault'](),sendMessage());}),sendBtn[a0_0x53721a(0x211)]=sendMessage,document['addEventListener'](a0_0x53721a(0x244),_0x62cb00=>{const _0x1b8584=a0_0x53721a;document[_0x1b8584(0x254)]('.message.show-delete')[_0x1b8584(0x24b)](_0x379223=>{const _0x409724=_0x1b8584;if(!_0x379223[_0x409724(0x1d1)](_0x62cb00[_0x409724(0x21f)]))_0x379223['classList']['remove']('show-delete');});});const saved=localStorage[a0_0x53721a(0x1f2)](a0_0x53721a(0x1fe));if(saved)try{messages=JSON[a0_0x53721a(0x1fc)](saved),renderMessages();}catch(a0_0x3c0486){}updateSendButton();