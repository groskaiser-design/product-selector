const a0_0x2ab200=a0_0x217e;(function(_0x209ae9,_0x3d65ab){const _0x28577e=a0_0x217e,_0x2b5dd7=_0x209ae9();while(!![]){try{const _0x556dce=-parseInt(_0x28577e(0xd6))/0x1*(parseInt(_0x28577e(0x125))/0x2)+parseInt(_0x28577e(0x119))/0x3+-parseInt(_0x28577e(0xc5))/0x4*(parseInt(_0x28577e(0x10c))/0x5)+-parseInt(_0x28577e(0x105))/0x6*(-parseInt(_0x28577e(0xc8))/0x7)+-parseInt(_0x28577e(0x106))/0x8+-parseInt(_0x28577e(0xcd))/0x9+parseInt(_0x28577e(0x133))/0xa*(parseInt(_0x28577e(0xdd))/0xb);if(_0x556dce===_0x3d65ab)break;else _0x2b5dd7['push'](_0x2b5dd7['shift']());}catch(_0x1cac35){_0x2b5dd7['push'](_0x2b5dd7['shift']());}}}(a0_0x4c55,0x4c579));const tg=window[a0_0x2ab200(0x123)]?.['WebApp'],HOME_URL=a0_0x2ab200(0xe0);function setupTelegramBackButton(){const _0x19c622=a0_0x2ab200;if(!tg)return;try{tg['ready'](),tg[_0x19c622(0xce)](),tg['setHeaderColor']?.(_0x19c622(0x120));if(tg[_0x19c622(0xd5)]?.('6.1'))tg[_0x19c622(0xde)]?.();const _0x41d506=tg[_0x19c622(0xfd)];if(_0x41d506){_0x41d506['show']();if(typeof _0x41d506[_0x19c622(0x138)]==='function')try{_0x41d506[_0x19c622(0x138)]();}catch(_0x42498d){}_0x41d506[_0x19c622(0xe3)](()=>{const _0x41dd30=_0x19c622;if(tg['HapticFeedback'])tg[_0x41dd30(0xe4)][_0x41dd30(0xdb)](_0x41dd30(0x12e));location[_0x41dd30(0xc4)]=HOME_URL;});}}catch(_0x216acf){console['warn'](_0x19c622(0x113),_0x216acf);}}(function initStableLayout(){const _0x51fa18=a0_0x2ab200,_0x5bb3c3=(function(){let _0x4507c4=!![];return function(_0x2348d4,_0x7e1cbf){const _0x47fd5a=_0x4507c4?function(){const _0x1debe5=a0_0x217e;if(_0x7e1cbf){const _0x10f9f4=_0x7e1cbf[_0x1debe5(0x118)](_0x2348d4,arguments);return _0x7e1cbf=null,_0x10f9f4;}}:function(){};return _0x4507c4=![],_0x47fd5a;};}()),_0x2c72e7=document[_0x51fa18(0xfc)](_0x51fa18(0x12f)),_0x52262d=document[_0x51fa18(0xd8)](_0x51fa18(0x104)),_0x2eb67b=document[_0x51fa18(0xd8)](_0x51fa18(0x11a)),_0x10a7c8=document[_0x51fa18(0xd8)](_0x51fa18(0xd2));function _0x28034f(){const _0x3911e2=_0x51fa18,_0x54ec6a=_0x5bb3c3(this,function(){const _0x390e01=a0_0x217e;return _0x54ec6a[_0x390e01(0xc7)]()['search']('(((.+)+)+)+$')[_0x390e01(0xc7)]()['constructor'](_0x54ec6a)[_0x390e01(0xbc)](_0x390e01(0x12c));});_0x54ec6a();if(!_0x2c72e7)return;const _0x1392c6=tg&&tg[_0x3911e2(0x101)]?tg[_0x3911e2(0x101)]:window[_0x3911e2(0xf4)];_0x2c72e7[_0x3911e2(0x134)][_0x3911e2(0xed)]=_0x1392c6+'px';if(_0x52262d){const _0x4141fb=_0x52262d[_0x3911e2(0x115)];_0x2eb67b[_0x3911e2(0x134)][_0x3911e2(0x11e)]=_0x4141fb+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x40cc8a})=>{_0x28034f();if(_0x40cc8a)requestAnimationFrame(()=>{const _0x35a064=a0_0x217e;_0x2eb67b[_0x35a064(0xf2)]=_0x2eb67b[_0x35a064(0xc1)];});}):window[_0x51fa18(0xe5)]('resize',_0x28034f),_0x28034f(),_0x10a7c8&&(_0x10a7c8['addEventListener']('input',()=>{requestAnimationFrame(_0x28034f);}),_0x10a7c8['addEventListener'](_0x51fa18(0xea),()=>{setTimeout(()=>{const _0x4f83a9=a0_0x217e;_0x2eb67b[_0x4f83a9(0xf2)]=_0x2eb67b[_0x4f83a9(0xc1)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x217e(_0x4c014f,_0x203054){_0x4c014f=_0x4c014f-0xbb;const _0x13f775=a0_0x4c55();let _0x829485=_0x13f775[_0x4c014f];return _0x829485;}const chatArea=document[a0_0x2ab200(0xd8)](a0_0x2ab200(0x11a)),emptyState=document[a0_0x2ab200(0xd8)](a0_0x2ab200(0x11d)),messageInput=document['getElementById']('messageInput'),sendBtn=document['getElementById'](a0_0x2ab200(0xcc)),clearBtn=document[a0_0x2ab200(0xd8)](a0_0x2ab200(0x109)),modal=document[a0_0x2ab200(0xd8)](a0_0x2ab200(0xfb)),mTitle=document[a0_0x2ab200(0xd8)](a0_0x2ab200(0xe2)),mText=document[a0_0x2ab200(0xd8)](a0_0x2ab200(0xdf));let modalCallback=null;async function callBackend(_0x252639,_0x5f1ebb){const _0x3fcf74=a0_0x2ab200,_0x5d527c=tg?.['initDataUnsafe']?.[_0x3fcf74(0xe9)]||{},_0x3333ac=_0x5d527c['id']||localStorage[_0x3fcf74(0xca)](_0x3fcf74(0xbf))||'d-'+Math[_0x3fcf74(0x122)](Math[_0x3fcf74(0x136)]()*0x3b9aca00);if(!_0x5d527c['id'])localStorage[_0x3fcf74(0x10f)]('debug_uid',_0x3333ac);const _0x474b9f={'action':_0x252639,'user_id':_0x3333ac,'user_data':{'first_name':_0x5d527c[_0x3fcf74(0x131)],'username':_0x5d527c[_0x3fcf74(0xe6)]},'init_data':tg?.[_0x3fcf74(0xbd)]||'',..._0x5f1ebb},_0x2cad7f=new AbortController(),_0x2d1158=setTimeout(()=>_0x2cad7f[_0x3fcf74(0xbe)](),REQUEST_TIMEOUT_MS);try{const _0x17405a=await fetch(BACKEND_URL,{'method':_0x3fcf74(0xfa),'headers':{'Content-Type':_0x3fcf74(0x12d)},'body':JSON[_0x3fcf74(0x135)](_0x474b9f),'signal':_0x2cad7f[_0x3fcf74(0x124)]});return clearTimeout(_0x2d1158),await _0x17405a[_0x3fcf74(0xcf)]();}catch(_0x2fa0f0){return{'success':![],'error':String(_0x2fa0f0)};}}function formatTime(_0x1be2e0){const _0x31bb8b=a0_0x2ab200,_0x29b5d2=new Date(_0x1be2e0);return String(_0x29b5d2[_0x31bb8b(0xcb)]())[_0x31bb8b(0x127)](0x2,'0')+':'+String(_0x29b5d2['getMinutes']())[_0x31bb8b(0x127)](0x2,'0');}function a0_0x4c55(){const _0x5c434d=['<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','scrollTop','length','innerHeight','remove','push','show-delete','medium','onclick','POST','confirmModal','querySelector','BackButton','createElement','error','show','viewportHeight','display','send_message','inputArea','102CVtGKP','1985760XARocm','modalConfirm','classList','clearBtn','content','textContent','9195bSDSun','auto','modalCancel','setItem','flex','parse','add','TG\x20setup\x20error:','removeItem','offsetHeight','Ошибка\x20сервера','preventDefault','apply','1847304CZVoiE','chatArea','Начнется\x20новый\x20диалог.','typingIndicator','emptyState','paddingBottom','text','#050505','innerHTML','floor','Telegram','signal','864148HlNuke','appendChild','padStart','Действие\x20необратимо.','Enter','Пустой\x20ответ','input','(((.+)+)+)+$','text/plain','light','.container','<br>','first_name','keydown','10NSGidT','style','stringify','random','notificationOccurred','offClick','click','search','initData','abort','debug_uid','min','scrollHeight','splice','touchstart','href','268ueebPm','success','toString','161651EQFGHL','Ошибка\x20сети','getItem','getHours','sendBtn','4499496jaankq','expand','json','delete-btn','ai_chat_messages','messageInput','div','message\x20','isVersionAtLeast','1jAjeMo','timestamp','getElementById','value','none','impactOccurred','contains','6685789rVsRPU','disableVerticalSwipes','modalText','./router.html','.message.show-delete','modalTitle','onClick','HapticFeedback','addEventListener','username','target','forEach','user','focus','from','now','height','className','trim','clear_history'];a0_0x4c55=function(){return _0x5c434d;};return a0_0x4c55();}function createMessageElement(_0x52db08,_0xcdabff){const _0x222a29=a0_0x2ab200,_0x895b94=document[_0x222a29(0xfe)](_0x222a29(0xd3));_0x895b94[_0x222a29(0xee)]=_0x222a29(0xd4)+_0x52db08['role'];const _0x64adfa=document[_0x222a29(0xfe)](_0x222a29(0xd3));_0x64adfa[_0x222a29(0xee)]='message-bubble',_0x64adfa[_0x222a29(0x121)]=_0x52db08[_0x222a29(0x10a)]['replace'](/\n/g,_0x222a29(0x130));const _0x3d8b32=document['createElement'](_0x222a29(0xd3));_0x3d8b32[_0x222a29(0xee)]=_0x222a29(0xd0),_0x3d8b32[_0x222a29(0x121)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x3d8b32[_0x222a29(0xf9)]=_0x3c86df=>{_0x3c86df['stopPropagation'](),confirmDelete(_0xcdabff);};let _0x17b9f2;_0x64adfa[_0x222a29(0xe5)](_0x222a29(0xc3),()=>_0x17b9f2=setTimeout(()=>{const _0xd328ea=_0x222a29;_0x895b94[_0xd328ea(0x108)][_0xd328ea(0x112)](_0xd328ea(0xf7));if(tg?.[_0xd328ea(0xe4)])tg[_0xd328ea(0xe4)][_0xd328ea(0xdb)](_0xd328ea(0xf8));},0x1f4)),_0x64adfa[_0x222a29(0xe5)]('touchend',()=>clearTimeout(_0x17b9f2));const _0x3fb7de=document[_0x222a29(0xfe)](_0x222a29(0xd3));return _0x3fb7de[_0x222a29(0xee)]='message-time',_0x3fb7de[_0x222a29(0x10b)]=formatTime(_0x52db08[_0x222a29(0xd7)]),_0x895b94['appendChild'](_0x3d8b32),_0x895b94[_0x222a29(0x126)](_0x64adfa),_0x895b94[_0x222a29(0x126)](_0x3fb7de),_0x895b94;}function createTypingIndicator(){const _0x43defc=a0_0x2ab200,_0xdf9184=document['createElement'](_0x43defc(0xd3));return _0xdf9184[_0x43defc(0xee)]='message\x20ai',_0xdf9184['id']='typingIndicator',_0xdf9184[_0x43defc(0x121)]=_0x43defc(0xf1),_0xdf9184;}function renderMessages(){const _0x22017f=a0_0x2ab200;Array[_0x22017f(0xeb)](chatArea['children'])[_0x22017f(0xe8)](_0x5902d3=>{if(_0x5902d3['id']!=='emptyState')_0x5902d3['remove']();}),messages[_0x22017f(0xf3)]>0x0?(emptyState[_0x22017f(0x134)]['display']=_0x22017f(0xda),messages[_0x22017f(0xe8)]((_0x5c8a05,_0x555cb4)=>chatArea[_0x22017f(0x126)](createMessageElement(_0x5c8a05,_0x555cb4)))):emptyState[_0x22017f(0x134)][_0x22017f(0x102)]=_0x22017f(0x110),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x22017f(0xc1)]);}function autoResizeTextarea(){const _0x26d850=a0_0x2ab200;messageInput[_0x26d850(0x134)][_0x26d850(0xed)]=_0x26d850(0x10d),messageInput[_0x26d850(0x134)]['height']=Math[_0x26d850(0xc0)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x5f4db5=a0_0x2ab200,_0x2463c7=messageInput[_0x5f4db5(0xd9)][_0x5f4db5(0xef)]();sendBtn['disabled']=!_0x2463c7||isTyping;}async function sendMessage(){const _0x3ee229=a0_0x2ab200,_0x364def=messageInput[_0x3ee229(0xd9)][_0x3ee229(0xef)]();if(!_0x364def||isTyping)return;if(tg?.[_0x3ee229(0xe4)])tg[_0x3ee229(0xe4)][_0x3ee229(0xdb)](_0x3ee229(0x12e));messages['push']({'role':_0x3ee229(0xe9),'content':_0x364def,'timestamp':Date['now']()}),localStorage[_0x3ee229(0x10f)](_0x3ee229(0xd1),JSON[_0x3ee229(0x135)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x3ee229(0x126)](createTypingIndicator()),chatArea[_0x3ee229(0xf2)]=chatArea[_0x3ee229(0xc1)];const _0x5ef340=await callBackend(_0x3ee229(0x103),{'message':_0x364def});isTyping=![];const _0x4eefae=document[_0x3ee229(0xd8)](_0x3ee229(0x11c));if(_0x4eefae)_0x4eefae['remove']();let _0x5a5809=_0x3ee229(0xc9);if(_0x5ef340[_0x3ee229(0xc6)]){_0x5a5809=_0x5ef340[_0x3ee229(0x11f)]||_0x3ee229(0x12a);if(tg?.[_0x3ee229(0xe4)])tg[_0x3ee229(0xe4)][_0x3ee229(0x137)](_0x3ee229(0xc6));}else{_0x5a5809=_0x5ef340['error']||_0x3ee229(0x116);if(tg?.[_0x3ee229(0xe4)])tg[_0x3ee229(0xe4)][_0x3ee229(0x137)](_0x3ee229(0xff));}messages[_0x3ee229(0xf6)]({'role':'ai','content':_0x5a5809,'timestamp':Date[_0x3ee229(0xec)]()}),localStorage[_0x3ee229(0x10f)]('ai_chat_messages',JSON[_0x3ee229(0x135)](messages)),renderMessages();}function confirmDelete(_0x18b96e){const _0x29ab64=a0_0x2ab200;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText['textContent']=_0x29ab64(0x128);modalCallback=()=>{const _0x3dfa8c=_0x29ab64;messages[_0x3dfa8c(0xc2)](_0x18b96e,0x1),localStorage[_0x3dfa8c(0x10f)](_0x3dfa8c(0xd1),JSON[_0x3dfa8c(0x135)](messages)),renderMessages();},modal['classList'][_0x29ab64(0x112)](_0x29ab64(0x100));}if(clearBtn)clearBtn[a0_0x2ab200(0xf9)]=()=>{const _0x143b08=a0_0x2ab200;if(!messages[_0x143b08(0xf3)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x143b08(0x10b)]=_0x143b08(0x11b);modalCallback=async()=>{const _0x47d603=_0x143b08;messages=[],localStorage[_0x47d603(0x114)](_0x47d603(0xd1)),renderMessages(),callBackend(_0x47d603(0xf0),{});},modal[_0x143b08(0x108)][_0x143b08(0x112)](_0x143b08(0x100));};document['getElementById'](a0_0x2ab200(0x10e))['onclick']=()=>modal[a0_0x2ab200(0x108)][a0_0x2ab200(0xf5)](a0_0x2ab200(0x100)),document['getElementById'](a0_0x2ab200(0x107))[a0_0x2ab200(0xf9)]=()=>{const _0x54b0f8=a0_0x2ab200;if(modalCallback)modalCallback();modal['classList'][_0x54b0f8(0xf5)](_0x54b0f8(0x100));},messageInput[a0_0x2ab200(0xe5)](a0_0x2ab200(0x12b),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2ab200(0xe5)](a0_0x2ab200(0x132),_0x27b1bd=>{const _0x448c74=a0_0x2ab200;_0x27b1bd['key']===_0x448c74(0x129)&&!_0x27b1bd['shiftKey']&&(_0x27b1bd[_0x448c74(0x117)](),sendMessage());}),sendBtn[a0_0x2ab200(0xf9)]=sendMessage,document[a0_0x2ab200(0xe5)](a0_0x2ab200(0xbb),_0x552c27=>{const _0x254ca5=a0_0x2ab200;document['querySelectorAll'](_0x254ca5(0xe1))[_0x254ca5(0xe8)](_0x2f344d=>{const _0x4cb1e1=_0x254ca5;if(!_0x2f344d[_0x4cb1e1(0xdc)](_0x552c27[_0x4cb1e1(0xe7)]))_0x2f344d[_0x4cb1e1(0x108)][_0x4cb1e1(0xf5)](_0x4cb1e1(0xf7));});});const saved=localStorage[a0_0x2ab200(0xca)](a0_0x2ab200(0xd1));if(saved)try{messages=JSON[a0_0x2ab200(0x111)](saved),renderMessages();}catch(a0_0x5b82b0){}updateSendButton();