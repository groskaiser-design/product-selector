const a0_0xd186=a0_0x32a0;(function(_0x2e4345,_0x42b01a){const _0xc9ad97=a0_0x32a0,_0x23277b=_0x2e4345();while(!![]){try{const _0x4fc239=-parseInt(_0xc9ad97(0x21b))/0x1+parseInt(_0xc9ad97(0x266))/0x2+parseInt(_0xc9ad97(0x1f4))/0x3+-parseInt(_0xc9ad97(0x218))/0x4+parseInt(_0xc9ad97(0x20b))/0x5+-parseInt(_0xc9ad97(0x207))/0x6*(parseInt(_0xc9ad97(0x20e))/0x7)+parseInt(_0xc9ad97(0x268))/0x8;if(_0x4fc239===_0x42b01a)break;else _0x23277b['push'](_0x23277b['shift']());}catch(_0x6aa7e6){_0x23277b['push'](_0x23277b['shift']());}}}(a0_0x3c4a,0x87857));const tg=window[a0_0xd186(0x235)]?.[a0_0xd186(0x24c)],HOME_URL=a0_0xd186(0x252);function setupTelegramBackButton(){const _0x5bb119=a0_0xd186;if(!tg)return;try{tg['ready'](),tg['expand'](),tg['setHeaderColor']?.(_0x5bb119(0x1f9));if(tg[_0x5bb119(0x26c)]?.('6.1'))tg[_0x5bb119(0x208)]?.();const _0x2d4eb9=tg['BackButton'];if(_0x2d4eb9){_0x2d4eb9[_0x5bb119(0x21d)]();if(typeof _0x2d4eb9[_0x5bb119(0x224)]==='function')try{_0x2d4eb9[_0x5bb119(0x224)]();}catch(_0x3e0f90){}_0x2d4eb9[_0x5bb119(0x25f)](()=>{const _0x13c07a=_0x5bb119;if(tg[_0x13c07a(0x233)])tg['HapticFeedback'][_0x13c07a(0x23d)](_0x13c07a(0x232));location[_0x13c07a(0x24b)]=HOME_URL;});}}catch(_0x1a4663){console[_0x5bb119(0x213)](_0x5bb119(0x250),_0x1a4663);}}(function initStableLayout(){const _0x5995e6=a0_0xd186,_0x185f95=(function(){let _0x1bf91b=!![];return function(_0x44c6df,_0x298d13){const _0xc5dc48=_0x1bf91b?function(){if(_0x298d13){const _0x12ea7b=_0x298d13['apply'](_0x44c6df,arguments);return _0x298d13=null,_0x12ea7b;}}:function(){};return _0x1bf91b=![],_0xc5dc48;};}()),_0x3bd4df=document[_0x5995e6(0x265)](_0x5995e6(0x201)),_0x4b3010=document[_0x5995e6(0x24d)](_0x5995e6(0x206)),_0x3831c1=document[_0x5995e6(0x24d)]('chatArea'),_0x1966a7=document[_0x5995e6(0x24d)](_0x5995e6(0x26b));function _0x1f4a61(){const _0x37e3e9=_0x5995e6,_0x27a7cc=_0x185f95(this,function(){const _0x44bbfb=a0_0x32a0;return _0x27a7cc[_0x44bbfb(0x20c)]()[_0x44bbfb(0x26d)](_0x44bbfb(0x20f))['toString']()[_0x44bbfb(0x24e)](_0x27a7cc)[_0x44bbfb(0x26d)](_0x44bbfb(0x20f));});_0x27a7cc();if(!_0x3bd4df)return;const _0x1843f6=tg&&tg[_0x37e3e9(0x247)]?tg[_0x37e3e9(0x247)]:window['innerHeight'];_0x3bd4df['style'][_0x37e3e9(0x24a)]=_0x1843f6+'px';if(_0x4b3010){const _0x2cb1f8=_0x4b3010[_0x37e3e9(0x228)];_0x3831c1[_0x37e3e9(0x239)][_0x37e3e9(0x1fb)]=_0x2cb1f8+0x28+'px';}}tg?tg[_0x5995e6(0x244)](_0x5995e6(0x248),({isStateStable:_0x39fbf6})=>{_0x1f4a61();if(_0x39fbf6)requestAnimationFrame(()=>{const _0x5f2c9c=a0_0x32a0;_0x3831c1[_0x5f2c9c(0x1f3)]=_0x3831c1[_0x5f2c9c(0x237)];});}):window[_0x5995e6(0x269)](_0x5995e6(0x204),_0x1f4a61),_0x1f4a61(),_0x1966a7&&(_0x1966a7[_0x5995e6(0x269)]('input',()=>{requestAnimationFrame(_0x1f4a61);}),_0x1966a7[_0x5995e6(0x269)](_0x5995e6(0x249),()=>{setTimeout(()=>{_0x3831c1['scrollTop']=_0x3831c1['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xd186(0x236),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xd186(0x24d)](a0_0xd186(0x22e)),emptyState=document[a0_0xd186(0x24d)](a0_0xd186(0x258)),messageInput=document[a0_0xd186(0x24d)](a0_0xd186(0x26b)),sendBtn=document[a0_0xd186(0x24d)]('sendBtn'),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0xd186(0x24d)](a0_0xd186(0x21c)),mTitle=document[a0_0xd186(0x24d)](a0_0xd186(0x215)),mText=document[a0_0xd186(0x24d)](a0_0xd186(0x1f6));let modalCallback=null;async function callBackend(_0x27addd,_0x4b909a){const _0x35dc4a=a0_0xd186,_0x1ee719=tg?.[_0x35dc4a(0x23b)]?.[_0x35dc4a(0x209)]||{},_0xb7cf3c=_0x1ee719['id']||localStorage[_0x35dc4a(0x264)](_0x35dc4a(0x1fc))||'d-'+Math[_0x35dc4a(0x262)](Math[_0x35dc4a(0x238)]()*0x3b9aca00);if(!_0x1ee719['id'])localStorage[_0x35dc4a(0x25e)](_0x35dc4a(0x1fc),_0xb7cf3c);const _0x439ebd={'action':_0x27addd,'user_id':_0xb7cf3c,'user_data':{'first_name':_0x1ee719[_0x35dc4a(0x225)],'username':_0x1ee719[_0x35dc4a(0x220)]},'init_data':tg?.['initData']||'',..._0x4b909a},_0x1184b7=new AbortController(),_0x67509a=setTimeout(()=>_0x1184b7[_0x35dc4a(0x260)](),REQUEST_TIMEOUT_MS);try{const _0x133d77=await fetch(BACKEND_URL,{'method':_0x35dc4a(0x22c),'headers':{'Content-Type':_0x35dc4a(0x241)},'body':JSON[_0x35dc4a(0x259)](_0x439ebd),'signal':_0x1184b7[_0x35dc4a(0x1f2)]});return clearTimeout(_0x67509a),await _0x133d77[_0x35dc4a(0x23c)]();}catch(_0x329abf){return{'success':![],'error':String(_0x329abf)};}}function formatTime(_0x25df11){const _0x494960=a0_0xd186,_0x1393d9=new Date(_0x25df11);return String(_0x1393d9[_0x494960(0x25d)]())[_0x494960(0x223)](0x2,'0')+':'+String(_0x1393d9[_0x494960(0x1fa)]())[_0x494960(0x223)](0x2,'0');}function a0_0x3c4a(){const _0x32d67b=['input','ai_chat_messages','#050505','getMinutes','paddingBottom','debug_uid','onclick','from','delete-btn','createElement','.container','Enter','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','resize','medium','inputArea','1578570dzhYAN','disableVerticalSwipes','user','modalCancel','2415450XUZlbt','toString','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','7QAzXBD','(((.+)+)+)+$','keydown','error','message\x20ai','warn','splice','modalTitle','<br>','clear_history','795776SQVqaw','typingIndicator','touchend','995289dPQmXX','confirmModal','show','Ошибка\x20сети','contains','username','flex','querySelectorAll','padStart','offClick','first_name','.message.show-delete','message-bubble','offsetHeight','modalConfirm','div','message\x20','POST','none','chatArea','text','remove','length','light','HapticFeedback','textContent','Telegram','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','scrollHeight','random','style','success','initDataUnsafe','json','impactOccurred','className','parse','show-delete','text/plain','replace','value','onEvent','classList','now','viewportHeight','viewportChanged','focus','height','href','WebApp','getElementById','constructor','forEach','TG\x20setup\x20error:','children','./router.html','Ошибка\x20сервера','innerHTML','content','auto','removeItem','emptyState','stringify','notificationOccurred','push','add','getHours','setItem','onClick','abort','trim','floor','touchstart','getItem','querySelector','1585622TgrgMJ','key','224848txHoXZ','addEventListener','Начнется\x20новый\x20диалог.','messageInput','isVersionAtLeast','search','appendChild','signal','scrollTop','2125248VjCmYz','min','modalText'];a0_0x3c4a=function(){return _0x32d67b;};return a0_0x3c4a();}function createMessageElement(_0x3e2c71,_0x4aa15f){const _0x1bcca1=a0_0xd186,_0x59eca4=document[_0x1bcca1(0x200)]('div');_0x59eca4[_0x1bcca1(0x23e)]=_0x1bcca1(0x22b)+_0x3e2c71['role'];const _0x317d06=document[_0x1bcca1(0x200)](_0x1bcca1(0x22a));_0x317d06[_0x1bcca1(0x23e)]=_0x1bcca1(0x227),_0x317d06[_0x1bcca1(0x254)]=_0x3e2c71[_0x1bcca1(0x255)][_0x1bcca1(0x242)](/\n/g,_0x1bcca1(0x216));const _0x597553=document[_0x1bcca1(0x200)](_0x1bcca1(0x22a));_0x597553[_0x1bcca1(0x23e)]=_0x1bcca1(0x1ff),_0x597553[_0x1bcca1(0x254)]=_0x1bcca1(0x203),_0x597553[_0x1bcca1(0x1fd)]=_0x584061=>{_0x584061['stopPropagation'](),confirmDelete(_0x4aa15f);};let _0x4e2049;_0x317d06[_0x1bcca1(0x269)](_0x1bcca1(0x263),()=>_0x4e2049=setTimeout(()=>{const _0x10984f=_0x1bcca1;_0x59eca4[_0x10984f(0x245)][_0x10984f(0x25c)](_0x10984f(0x240));if(tg?.[_0x10984f(0x233)])tg[_0x10984f(0x233)][_0x10984f(0x23d)](_0x10984f(0x205));},0x1f4)),_0x317d06[_0x1bcca1(0x269)](_0x1bcca1(0x21a),()=>clearTimeout(_0x4e2049));const _0xbb7257=document[_0x1bcca1(0x200)]('div');return _0xbb7257[_0x1bcca1(0x23e)]='message-time',_0xbb7257[_0x1bcca1(0x234)]=formatTime(_0x3e2c71['timestamp']),_0x59eca4[_0x1bcca1(0x26e)](_0x597553),_0x59eca4[_0x1bcca1(0x26e)](_0x317d06),_0x59eca4[_0x1bcca1(0x26e)](_0xbb7257),_0x59eca4;}function createTypingIndicator(){const _0x58b82b=a0_0xd186,_0x156b3a=document['createElement'](_0x58b82b(0x22a));return _0x156b3a['className']=_0x58b82b(0x212),_0x156b3a['id']=_0x58b82b(0x219),_0x156b3a[_0x58b82b(0x254)]=_0x58b82b(0x20d),_0x156b3a;}function renderMessages(){const _0x1256c=a0_0xd186;Array[_0x1256c(0x1fe)](chatArea[_0x1256c(0x251)])[_0x1256c(0x24f)](_0x155eed=>{const _0x328594=_0x1256c;if(_0x155eed['id']!==_0x328594(0x258))_0x155eed[_0x328594(0x230)]();}),messages[_0x1256c(0x231)]>0x0?(emptyState[_0x1256c(0x239)]['display']=_0x1256c(0x22d),messages[_0x1256c(0x24f)]((_0x39742c,_0x4d1890)=>chatArea[_0x1256c(0x26e)](createMessageElement(_0x39742c,_0x4d1890)))):emptyState[_0x1256c(0x239)]['display']=_0x1256c(0x221),requestAnimationFrame(()=>chatArea[_0x1256c(0x1f3)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x584d0e=a0_0xd186;messageInput[_0x584d0e(0x239)][_0x584d0e(0x24a)]=_0x584d0e(0x256),messageInput[_0x584d0e(0x239)][_0x584d0e(0x24a)]=Math[_0x584d0e(0x1f5)](messageInput[_0x584d0e(0x237)],0x78)+'px';}function updateSendButton(){const _0x11f0a7=a0_0xd186,_0x4b5e11=messageInput[_0x11f0a7(0x243)][_0x11f0a7(0x261)]();sendBtn['disabled']=!_0x4b5e11||isTyping;}function a0_0x32a0(_0x588b46,_0x4589c7){_0x588b46=_0x588b46-0x1f2;const _0x25e31c=a0_0x3c4a();let _0x5998b3=_0x25e31c[_0x588b46];return _0x5998b3;}async function sendMessage(){const _0x240f29=a0_0xd186,_0x3b6ce1=messageInput[_0x240f29(0x243)][_0x240f29(0x261)]();if(!_0x3b6ce1||isTyping)return;if(tg?.[_0x240f29(0x233)])tg['HapticFeedback'][_0x240f29(0x23d)](_0x240f29(0x232));messages[_0x240f29(0x25b)]({'role':'user','content':_0x3b6ce1,'timestamp':Date[_0x240f29(0x246)]()}),localStorage[_0x240f29(0x25e)]('ai_chat_messages',JSON[_0x240f29(0x259)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x240f29(0x26e)](createTypingIndicator()),chatArea[_0x240f29(0x1f3)]=chatArea[_0x240f29(0x237)];const _0x5a517c=await callBackend('send_message',{'message':_0x3b6ce1});isTyping=![];const _0x2417aa=document['getElementById'](_0x240f29(0x219));if(_0x2417aa)_0x2417aa[_0x240f29(0x230)]();let _0x26507f=_0x240f29(0x21e);if(_0x5a517c[_0x240f29(0x23a)]){_0x26507f=_0x5a517c[_0x240f29(0x22f)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg[_0x240f29(0x233)][_0x240f29(0x25a)](_0x240f29(0x23a));}else{_0x26507f=_0x5a517c[_0x240f29(0x211)]||_0x240f29(0x253);if(tg?.[_0x240f29(0x233)])tg[_0x240f29(0x233)]['notificationOccurred'](_0x240f29(0x211));}messages[_0x240f29(0x25b)]({'role':'ai','content':_0x26507f,'timestamp':Date[_0x240f29(0x246)]()}),localStorage[_0x240f29(0x25e)](_0x240f29(0x1f8),JSON[_0x240f29(0x259)](messages)),renderMessages();}function confirmDelete(_0x167313){const _0x498879=a0_0xd186;if(mTitle)mTitle[_0x498879(0x234)]='Удалить?';if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x3a7bb0=_0x498879;messages[_0x3a7bb0(0x214)](_0x167313,0x1),localStorage[_0x3a7bb0(0x25e)](_0x3a7bb0(0x1f8),JSON[_0x3a7bb0(0x259)](messages)),renderMessages();},modal[_0x498879(0x245)]['add'](_0x498879(0x21d));}if(clearBtn)clearBtn[a0_0xd186(0x1fd)]=()=>{const _0x1b8b6f=a0_0xd186;if(!messages['length'])return;if(mTitle)mTitle[_0x1b8b6f(0x234)]='Очистить\x20историю?';if(mText)mText[_0x1b8b6f(0x234)]=_0x1b8b6f(0x26a);modalCallback=async()=>{const _0x11a2f1=_0x1b8b6f;messages=[],localStorage[_0x11a2f1(0x257)](_0x11a2f1(0x1f8)),renderMessages(),callBackend(_0x11a2f1(0x217),{});},modal[_0x1b8b6f(0x245)][_0x1b8b6f(0x25c)]('show');};document[a0_0xd186(0x24d)](a0_0xd186(0x20a))[a0_0xd186(0x1fd)]=()=>modal['classList'][a0_0xd186(0x230)]('show'),document[a0_0xd186(0x24d)](a0_0xd186(0x229))[a0_0xd186(0x1fd)]=()=>{const _0x142e0d=a0_0xd186;if(modalCallback)modalCallback();modal[_0x142e0d(0x245)][_0x142e0d(0x230)]('show');},messageInput['addEventListener'](a0_0xd186(0x1f7),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0xd186(0x210),_0x19f20e=>{const _0x3cf685=a0_0xd186;_0x19f20e[_0x3cf685(0x267)]===_0x3cf685(0x202)&&!_0x19f20e['shiftKey']&&(_0x19f20e['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0xd186(0x269)]('click',_0x4ac404=>{const _0xda7e11=a0_0xd186;document[_0xda7e11(0x222)](_0xda7e11(0x226))[_0xda7e11(0x24f)](_0x21c1f5=>{const _0x5d07a1=_0xda7e11;if(!_0x21c1f5[_0x5d07a1(0x21f)](_0x4ac404['target']))_0x21c1f5[_0x5d07a1(0x245)]['remove'](_0x5d07a1(0x240));});});const saved=localStorage['getItem'](a0_0xd186(0x1f8));if(saved)try{messages=JSON[a0_0xd186(0x23f)](saved),renderMessages();}catch(a0_0x9a0618){}updateSendButton();