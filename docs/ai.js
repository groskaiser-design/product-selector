const a0_0x3b82dc=a0_0x4a37;(function(_0x241f12,_0x1577b6){const _0xfa46e9=a0_0x4a37,_0x47f96f=_0x241f12();while(!![]){try{const _0x3b8896=-parseInt(_0xfa46e9(0x228))/0x1+parseInt(_0xfa46e9(0x21c))/0x2+-parseInt(_0xfa46e9(0x237))/0x3+parseInt(_0xfa46e9(0x1f9))/0x4*(-parseInt(_0xfa46e9(0x244))/0x5)+parseInt(_0xfa46e9(0x206))/0x6*(parseInt(_0xfa46e9(0x1f7))/0x7)+-parseInt(_0xfa46e9(0x212))/0x8*(parseInt(_0xfa46e9(0x258))/0x9)+parseInt(_0xfa46e9(0x1f2))/0xa*(parseInt(_0xfa46e9(0x247))/0xb);if(_0x3b8896===_0x1577b6)break;else _0x47f96f['push'](_0x47f96f['shift']());}catch(_0x4b14cd){_0x47f96f['push'](_0x47f96f['shift']());}}}(a0_0x4698,0xc4715));const tg=window[a0_0x3b82dc(0x213)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x7152b1=a0_0x3b82dc,_0x35e986=(function(){let _0x3b9909=!![];return function(_0x530fd5,_0x3289a3){const _0xa861a1=_0x3b9909?function(){const _0x326666=a0_0x4a37;if(_0x3289a3){const _0x4c4f8a=_0x3289a3[_0x326666(0x1fb)](_0x530fd5,arguments);return _0x3289a3=null,_0x4c4f8a;}}:function(){};return _0x3b9909=![],_0xa861a1;};}()),_0x40d743=_0x35e986(this,function(){const _0x27b7b9=a0_0x4a37;return _0x40d743[_0x27b7b9(0x235)]()[_0x27b7b9(0x1d2)](_0x27b7b9(0x21d))['toString']()[_0x27b7b9(0x23d)](_0x40d743)['search'](_0x27b7b9(0x21d));});_0x40d743();if(!tg)return;try{tg[_0x7152b1(0x24e)](),tg[_0x7152b1(0x23a)](),tg[_0x7152b1(0x241)]?.(_0x7152b1(0x203));if(tg[_0x7152b1(0x21e)]?.(_0x7152b1(0x204)))tg[_0x7152b1(0x229)]?.();const _0x19c0b7=tg[_0x7152b1(0x236)];if(_0x19c0b7){_0x19c0b7[_0x7152b1(0x219)]();if(typeof _0x19c0b7[_0x7152b1(0x253)]===_0x7152b1(0x202))try{_0x19c0b7[_0x7152b1(0x253)]();}catch(_0x50a0c9){}_0x19c0b7[_0x7152b1(0x1f4)](()=>{const _0x1f9602=_0x7152b1;if(tg[_0x1f9602(0x1e5)])tg[_0x1f9602(0x1e5)][_0x1f9602(0x1e9)](_0x1f9602(0x230));location[_0x1f9602(0x216)]=HOME_URL;});}}catch(_0x42c0a5){console[_0x7152b1(0x1d8)](_0x7152b1(0x1e2),_0x42c0a5);}}(function initStableLayout(){const _0xc62d8c=a0_0x3b82dc,_0xee0e5a=document['querySelector']('.container'),_0x53adca=document[_0xc62d8c(0x1f8)](_0xc62d8c(0x257)),_0x52ff7e=document['getElementById'](_0xc62d8c(0x256)),_0x19ea59=document[_0xc62d8c(0x1f8)]('messageInput');function _0x33fcc7(){const _0x2846cb=_0xc62d8c;if(!_0xee0e5a)return;const _0x4ed9ff=tg&&tg['viewportHeight']?tg[_0x2846cb(0x1f0)]:window[_0x2846cb(0x20e)];_0xee0e5a[_0x2846cb(0x1d5)]['height']=_0x4ed9ff+'px';if(_0x53adca){const _0xeee12e=_0x53adca[_0x2846cb(0x20d)];_0x52ff7e['style'][_0x2846cb(0x233)]=_0xeee12e+0x28+'px';}}tg?tg['onEvent'](_0xc62d8c(0x1e0),({isStateStable:_0x2e2ef6})=>{_0x33fcc7();if(_0x2e2ef6)requestAnimationFrame(()=>{const _0x265043=a0_0x4a37;_0x52ff7e['scrollTop']=_0x52ff7e[_0x265043(0x1f1)];});}):window[_0xc62d8c(0x22f)]('resize',_0x33fcc7),_0x33fcc7(),_0x19ea59&&(_0x19ea59[_0xc62d8c(0x22f)](_0xc62d8c(0x1fd),()=>{requestAnimationFrame(_0x33fcc7);}),_0x19ea59[_0xc62d8c(0x22f)](_0xc62d8c(0x1ea),()=>{setTimeout(()=>{const _0x401928=a0_0x4a37;_0x52ff7e['scrollTop']=_0x52ff7e[_0x401928(0x1f1)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3b82dc(0x1da),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById']('chatArea'),emptyState=document[a0_0x3b82dc(0x1f8)](a0_0x3b82dc(0x22d)),messageInput=document[a0_0x3b82dc(0x1f8)](a0_0x3b82dc(0x251)),sendBtn=document[a0_0x3b82dc(0x1f8)](a0_0x3b82dc(0x1dd)),clearBtn=document[a0_0x3b82dc(0x1f8)](a0_0x3b82dc(0x234)),modal=document[a0_0x3b82dc(0x1f8)](a0_0x3b82dc(0x200)),mTitle=document['getElementById'](a0_0x3b82dc(0x1e3)),mText=document[a0_0x3b82dc(0x1f8)](a0_0x3b82dc(0x1d9));let modalCallback=null;async function callBackend(_0x462716,_0x4e0fbd){const _0x4c40fe=a0_0x3b82dc,_0x2d972b=tg?.[_0x4c40fe(0x255)]?.[_0x4c40fe(0x1f5)]||{},_0x501965=_0x2d972b['id']||localStorage[_0x4c40fe(0x1ff)](_0x4c40fe(0x245))||'d-'+Math[_0x4c40fe(0x20f)](Math['random']()*0x3b9aca00);if(!_0x2d972b['id'])localStorage[_0x4c40fe(0x1de)](_0x4c40fe(0x245),_0x501965);const _0x5c4b0b={'action':_0x462716,'user_id':_0x501965,'user_data':{'first_name':_0x2d972b[_0x4c40fe(0x23b)],'username':_0x2d972b[_0x4c40fe(0x208)]},'init_data':tg?.[_0x4c40fe(0x23c)]||'',..._0x4e0fbd},_0x2b155b=new AbortController(),_0x2d5f44=setTimeout(()=>_0x2b155b[_0x4c40fe(0x20b)](),REQUEST_TIMEOUT_MS);try{const _0x59aea1=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x4c40fe(0x24b)](_0x5c4b0b),'signal':_0x2b155b['signal']});return clearTimeout(_0x2d5f44),await _0x59aea1[_0x4c40fe(0x1dc)]();}catch(_0x995698){return{'success':![],'error':String(_0x995698)};}}function formatTime(_0x19e081){const _0x2d3d42=a0_0x3b82dc,_0x5b3679=new Date(_0x19e081);return String(_0x5b3679[_0x2d3d42(0x22e)]())[_0x2d3d42(0x1e7)](0x2,'0')+':'+String(_0x5b3679[_0x2d3d42(0x1ed)]())[_0x2d3d42(0x1e7)](0x2,'0');}function a0_0x4a37(_0x13d067,_0x3621ce){_0x13d067=_0x13d067-0x1d1;const _0x51675c=a0_0x4698();let _0x42c76e=_0x51675c[_0x13d067];return _0x42c76e;}function createMessageElement(_0x475132,_0x26fb7e){const _0x57ed86=a0_0x3b82dc,_0x30ebaf=document['createElement'](_0x57ed86(0x1e6));_0x30ebaf['className']=_0x57ed86(0x215)+_0x475132[_0x57ed86(0x252)];const _0x2e29bb=document['createElement'](_0x57ed86(0x1e6));_0x2e29bb[_0x57ed86(0x209)]=_0x57ed86(0x227),_0x2e29bb[_0x57ed86(0x1e1)]=_0x475132[_0x57ed86(0x214)][_0x57ed86(0x218)](/\n/g,_0x57ed86(0x1d4));const _0x257ada=document[_0x57ed86(0x222)]('div');_0x257ada[_0x57ed86(0x209)]=_0x57ed86(0x1d6),_0x257ada[_0x57ed86(0x1e1)]=_0x57ed86(0x231),_0x257ada[_0x57ed86(0x23e)]=_0x5d9460=>{const _0x79703b=_0x57ed86;_0x5d9460[_0x79703b(0x20a)](),confirmDelete(_0x26fb7e);};let _0x5eabef;_0x2e29bb[_0x57ed86(0x22f)](_0x57ed86(0x246),()=>_0x5eabef=setTimeout(()=>{const _0x484a6e=_0x57ed86;_0x30ebaf['classList'][_0x484a6e(0x211)]('show-delete');if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x484a6e(0x1e9)](_0x484a6e(0x1fe));},0x1f4)),_0x2e29bb[_0x57ed86(0x22f)](_0x57ed86(0x1e4),()=>clearTimeout(_0x5eabef));const _0x102e56=document['createElement']('div');return _0x102e56[_0x57ed86(0x209)]=_0x57ed86(0x22b),_0x102e56['textContent']=formatTime(_0x475132['timestamp']),_0x30ebaf[_0x57ed86(0x1ee)](_0x257ada),_0x30ebaf[_0x57ed86(0x1ee)](_0x2e29bb),_0x30ebaf[_0x57ed86(0x1ee)](_0x102e56),_0x30ebaf;}function createTypingIndicator(){const _0xa3bd24=a0_0x3b82dc,_0x22be9f=document[_0xa3bd24(0x222)]('div');return _0x22be9f[_0xa3bd24(0x209)]='message\x20ai',_0x22be9f['id']=_0xa3bd24(0x21b),_0x22be9f[_0xa3bd24(0x1e1)]=_0xa3bd24(0x221),_0x22be9f;}function renderMessages(){const _0x2dad79=a0_0x3b82dc;Array[_0x2dad79(0x254)](chatArea[_0x2dad79(0x1d1)])[_0x2dad79(0x21f)](_0x11f493=>{const _0x5de995=_0x2dad79;if(_0x11f493['id']!==_0x5de995(0x22d))_0x11f493[_0x5de995(0x22c)]();}),messages[_0x2dad79(0x201)]>0x0?(emptyState['style'][_0x2dad79(0x1fa)]=_0x2dad79(0x1d3),messages['forEach']((_0x57ed12,_0x225a5c)=>chatArea[_0x2dad79(0x1ee)](createMessageElement(_0x57ed12,_0x225a5c)))):emptyState[_0x2dad79(0x1d5)][_0x2dad79(0x1fa)]=_0x2dad79(0x1f6),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x2dad79(0x1f1)]);}function autoResizeTextarea(){const _0xa55471=a0_0x3b82dc;messageInput[_0xa55471(0x1d5)][_0xa55471(0x232)]=_0xa55471(0x243),messageInput[_0xa55471(0x1d5)][_0xa55471(0x232)]=Math[_0xa55471(0x24d)](messageInput[_0xa55471(0x1f1)],0x78)+'px';}function updateSendButton(){const _0x165e69=a0_0x3b82dc,_0x3684e3=messageInput['value']['trim']();sendBtn[_0x165e69(0x1d7)]=!_0x3684e3||isTyping;}async function sendMessage(){const _0x29fa98=a0_0x3b82dc,_0x3f9847=messageInput[_0x29fa98(0x1e8)]['trim']();if(!_0x3f9847||isTyping)return;if(tg?.[_0x29fa98(0x1e5)])tg[_0x29fa98(0x1e5)]['impactOccurred'](_0x29fa98(0x230));messages['push']({'role':_0x29fa98(0x1f5),'content':_0x3f9847,'timestamp':Date[_0x29fa98(0x217)]()}),localStorage[_0x29fa98(0x1de)](_0x29fa98(0x207),JSON[_0x29fa98(0x24b)](messages)),renderMessages(),messageInput[_0x29fa98(0x1e8)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x29fa98(0x1ee)](createTypingIndicator()),chatArea[_0x29fa98(0x223)]=chatArea[_0x29fa98(0x1f1)];const _0x13b23a=await callBackend(_0x29fa98(0x24c),{'message':_0x3f9847});isTyping=![];const _0xe85b05=document[_0x29fa98(0x1f8)](_0x29fa98(0x21b));if(_0xe85b05)_0xe85b05[_0x29fa98(0x22c)]();let _0x40379a=_0x29fa98(0x226);if(_0x13b23a[_0x29fa98(0x249)]){_0x40379a=_0x13b23a['text']||_0x29fa98(0x20c);if(tg?.[_0x29fa98(0x1e5)])tg[_0x29fa98(0x1e5)][_0x29fa98(0x240)](_0x29fa98(0x249));}else{_0x40379a=_0x13b23a[_0x29fa98(0x1df)]||_0x29fa98(0x24f);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x29fa98(0x240)](_0x29fa98(0x1df));}messages[_0x29fa98(0x1f3)]({'role':'ai','content':_0x40379a,'timestamp':Date[_0x29fa98(0x217)]()}),localStorage[_0x29fa98(0x1de)](_0x29fa98(0x207),JSON[_0x29fa98(0x24b)](messages)),renderMessages();}function confirmDelete(_0x3c7ef0){const _0x31944b=a0_0x3b82dc;if(mTitle)mTitle[_0x31944b(0x225)]=_0x31944b(0x24a);if(mText)mText[_0x31944b(0x225)]=_0x31944b(0x259);modalCallback=()=>{const _0x205837=_0x31944b;messages[_0x205837(0x1ec)](_0x3c7ef0,0x1),localStorage['setItem'](_0x205837(0x207),JSON[_0x205837(0x24b)](messages)),renderMessages();},modal[_0x31944b(0x224)][_0x31944b(0x211)](_0x31944b(0x219));}if(clearBtn)clearBtn['onclick']=()=>{const _0x3f968c=a0_0x3b82dc;if(!messages[_0x3f968c(0x201)])return;if(mTitle)mTitle[_0x3f968c(0x225)]=_0x3f968c(0x1db);if(mText)mText[_0x3f968c(0x225)]=_0x3f968c(0x1fc);modalCallback=async()=>{const _0x4d6eb7=_0x3f968c;messages=[],localStorage['removeItem'](_0x4d6eb7(0x207)),renderMessages(),callBackend(_0x4d6eb7(0x210),{});},modal[_0x3f968c(0x224)][_0x3f968c(0x211)](_0x3f968c(0x219));};document[a0_0x3b82dc(0x1f8)](a0_0x3b82dc(0x23f))[a0_0x3b82dc(0x23e)]=()=>modal[a0_0x3b82dc(0x224)]['remove'](a0_0x3b82dc(0x219)),document[a0_0x3b82dc(0x1f8)]('modalConfirm')[a0_0x3b82dc(0x23e)]=()=>{const _0x261538=a0_0x3b82dc;if(modalCallback)modalCallback();modal[_0x261538(0x224)]['remove'](_0x261538(0x219));},messageInput[a0_0x3b82dc(0x22f)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3b82dc(0x22f)](a0_0x3b82dc(0x1eb),_0x1dbf45=>{const _0x1beb11=a0_0x3b82dc;_0x1dbf45[_0x1beb11(0x205)]===_0x1beb11(0x22a)&&!_0x1dbf45[_0x1beb11(0x220)]&&(_0x1dbf45[_0x1beb11(0x239)](),sendMessage());}),sendBtn[a0_0x3b82dc(0x23e)]=sendMessage,document[a0_0x3b82dc(0x22f)](a0_0x3b82dc(0x21a),_0x48a324=>{const _0x3751d5=a0_0x3b82dc;document['querySelectorAll'](_0x3751d5(0x242))[_0x3751d5(0x21f)](_0x33c3a1=>{const _0x434e51=_0x3751d5;if(!_0x33c3a1[_0x434e51(0x248)](_0x48a324[_0x434e51(0x1ef)]))_0x33c3a1[_0x434e51(0x224)][_0x434e51(0x22c)](_0x434e51(0x238));});});const saved=localStorage[a0_0x3b82dc(0x1ff)]('ai_chat_messages');function a0_0x4698(){const _0x7ad86f=['className','stopPropagation','abort','Пустой\x20ответ','offsetHeight','innerHeight','floor','clear_history','add','16ckLZpM','Telegram','content','message\x20','href','now','replace','show','click','typingIndicator','1464676FCzLFB','(((.+)+)+)+$','isVersionAtLeast','forEach','shiftKey','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','createElement','scrollTop','classList','textContent','Ошибка\x20сети','message-bubble','434626bTIsse','disableVerticalSwipes','Enter','message-time','remove','emptyState','getHours','addEventListener','light','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','height','paddingBottom','clearBtn','toString','BackButton','856689FPrkpu','show-delete','preventDefault','expand','first_name','initData','constructor','onclick','modalCancel','notificationOccurred','setHeaderColor','.message.show-delete','auto','4216465VPMNeM','debug_uid','touchstart','19290535VBhyfZ','contains','success','Удалить?','stringify','send_message','min','ready','Ошибка\x20сервера','parse','messageInput','role','offClick','from','initDataUnsafe','chatArea','inputArea','3756663rDjchq','Действие\x20необратимо.','children','search','none','<br>','style','delete-btn','disabled','warn','modalText','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Очистить\x20историю?','json','sendBtn','setItem','error','viewportChanged','innerHTML','TG\x20setup\x20error:','modalTitle','touchend','HapticFeedback','div','padStart','value','impactOccurred','focus','keydown','splice','getMinutes','appendChild','target','viewportHeight','scrollHeight','10gUAGyG','push','onClick','user','flex','4858QSftir','getElementById','4tkIwaZ','display','apply','Начнется\x20новый\x20диалог.','input','medium','getItem','confirmModal','length','function','#050505','6.1','key','6198yPaTUA','ai_chat_messages','username'];a0_0x4698=function(){return _0x7ad86f;};return a0_0x4698();}if(saved)try{messages=JSON[a0_0x3b82dc(0x250)](saved),renderMessages();}catch(a0_0x4ed8fe){}updateSendButton();