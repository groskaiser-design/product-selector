const a0_0x592360=a0_0x3245;(function(_0x477957,_0x11f02f){const _0x43c5ae=a0_0x3245,_0x63fdc5=_0x477957();while(!![]){try{const _0x413f4d=-parseInt(_0x43c5ae(0x15e))/0x1+-parseInt(_0x43c5ae(0x15b))/0x2*(-parseInt(_0x43c5ae(0x1b2))/0x3)+parseInt(_0x43c5ae(0x1bb))/0x4*(parseInt(_0x43c5ae(0x17b))/0x5)+-parseInt(_0x43c5ae(0x181))/0x6*(parseInt(_0x43c5ae(0x18e))/0x7)+parseInt(_0x43c5ae(0x159))/0x8+parseInt(_0x43c5ae(0x176))/0x9+parseInt(_0x43c5ae(0x15d))/0xa;if(_0x413f4d===_0x11f02f)break;else _0x63fdc5['push'](_0x63fdc5['shift']());}catch(_0x4801bd){_0x63fdc5['push'](_0x63fdc5['shift']());}}}(a0_0x2f1b,0x70d5c));const tg=window[a0_0x592360(0x1a9)]?.[a0_0x592360(0x1a0)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x4bf208=a0_0x592360,_0x3ebb2d=(function(){let _0x2486a9=!![];return function(_0x4b5351,_0x50c414){const _0x5ec164=_0x2486a9?function(){const _0x123f2e=a0_0x3245;if(_0x50c414){const _0x44f95e=_0x50c414[_0x123f2e(0x1d1)](_0x4b5351,arguments);return _0x50c414=null,_0x44f95e;}}:function(){};return _0x2486a9=![],_0x5ec164;};}()),_0x372c52=_0x3ebb2d(this,function(){const _0x2045bf=a0_0x3245;return _0x372c52['toString']()['search'](_0x2045bf(0x193))['toString']()['constructor'](_0x372c52)[_0x2045bf(0x1b6)]('(((.+)+)+)+$');});_0x372c52();if(!tg)return;try{tg[_0x4bf208(0x166)](),tg[_0x4bf208(0x174)](),tg[_0x4bf208(0x1c1)]?.('#050505');if(tg[_0x4bf208(0x1b5)]?.(_0x4bf208(0x1b1)))tg[_0x4bf208(0x17d)]?.();const _0x3be2be=tg[_0x4bf208(0x18c)];if(_0x3be2be){_0x3be2be[_0x4bf208(0x156)]();if(typeof _0x3be2be[_0x4bf208(0x1cb)]===_0x4bf208(0x1a2))try{_0x3be2be[_0x4bf208(0x1cb)]();}catch(_0x61ed0b){}_0x3be2be[_0x4bf208(0x1cd)](()=>{const _0x30e358=_0x4bf208;if(tg[_0x30e358(0x1be)])tg[_0x30e358(0x1be)][_0x30e358(0x158)]('light');location[_0x30e358(0x1c7)]=HOME_URL;});}}catch(_0xaabe0e){console[_0x4bf208(0x19d)]('TG\x20setup\x20error:',_0xaabe0e);}}(function initStableLayout(){const _0x5b9bd7=a0_0x592360,_0x435f1c=document[_0x5b9bd7(0x1b8)](_0x5b9bd7(0x1ba)),_0xc175d2=document[_0x5b9bd7(0x192)]('inputArea'),_0x44b129=document[_0x5b9bd7(0x192)](_0x5b9bd7(0x1bd)),_0x2dac10=document['getElementById']('messageInput');function _0x4baf37(){const _0x1363b1=_0x5b9bd7;if(!_0x435f1c)return;const _0x13b23c=tg&&tg['viewportHeight']?tg[_0x1363b1(0x167)]:window[_0x1363b1(0x188)];_0x435f1c[_0x1363b1(0x15a)]['height']=_0x13b23c+'px';if(_0xc175d2){const _0x5b2a7e=_0xc175d2['offsetHeight'];_0x44b129[_0x1363b1(0x15a)][_0x1363b1(0x199)]=_0x5b2a7e+0x28+'px';}}tg?tg['onEvent'](_0x5b9bd7(0x163),({isStateStable:_0x4a2b85})=>{_0x4baf37();if(_0x4a2b85)requestAnimationFrame(()=>{const _0x8e635a=a0_0x3245;_0x44b129[_0x8e635a(0x169)]=_0x44b129[_0x8e635a(0x18d)];});}):window[_0x5b9bd7(0x173)]('resize',_0x4baf37),_0x4baf37(),_0x2dac10&&(_0x2dac10['addEventListener'](_0x5b9bd7(0x194),()=>{requestAnimationFrame(_0x4baf37);}),_0x2dac10['addEventListener'](_0x5b9bd7(0x1d3),()=>{setTimeout(()=>{const _0x322c39=a0_0x3245;_0x44b129[_0x322c39(0x169)]=_0x44b129[_0x322c39(0x18d)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x592360(0x16d),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x592360(0x192)](a0_0x592360(0x1bd)),emptyState=document[a0_0x592360(0x192)](a0_0x592360(0x1c9)),messageInput=document[a0_0x592360(0x192)](a0_0x592360(0x15f)),sendBtn=document['getElementById'](a0_0x592360(0x1c8)),clearBtn=document[a0_0x592360(0x192)]('clearBtn'),modal=document[a0_0x592360(0x192)](a0_0x592360(0x195)),mTitle=document[a0_0x592360(0x192)](a0_0x592360(0x1ce)),mText=document[a0_0x592360(0x192)](a0_0x592360(0x19c));let modalCallback=null;async function callBackend(_0x5e6be9,_0x503f30){const _0x134558=a0_0x592360,_0x5cc71a=tg?.[_0x134558(0x1a5)]?.[_0x134558(0x165)]||{},_0x434cc5=_0x5cc71a['id']||localStorage[_0x134558(0x162)](_0x134558(0x160))||'d-'+Math[_0x134558(0x153)](Math['random']()*0x3b9aca00);if(!_0x5cc71a['id'])localStorage[_0x134558(0x171)](_0x134558(0x160),_0x434cc5);const _0x3984e7={'action':_0x5e6be9,'user_id':_0x434cc5,'user_data':{'first_name':_0x5cc71a['first_name'],'username':_0x5cc71a[_0x134558(0x190)]},'init_data':tg?.['initData']||'',..._0x503f30},_0x425a3c=new AbortController(),_0x236ddb=setTimeout(()=>_0x425a3c[_0x134558(0x1c5)](),REQUEST_TIMEOUT_MS);try{const _0x49eaf2=await fetch(BACKEND_URL,{'method':_0x134558(0x1b9),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x3984e7),'signal':_0x425a3c[_0x134558(0x1d0)]});return clearTimeout(_0x236ddb),await _0x49eaf2[_0x134558(0x18b)]();}catch(_0x63df4e){return{'success':![],'error':String(_0x63df4e)};}}function formatTime(_0x266137){const _0x472315=a0_0x592360,_0x1b509d=new Date(_0x266137);return String(_0x1b509d[_0x472315(0x178)]())[_0x472315(0x182)](0x2,'0')+':'+String(_0x1b509d[_0x472315(0x184)]())[_0x472315(0x182)](0x2,'0');}function createMessageElement(_0x46287d,_0x5ce98c){const _0x4da53d=a0_0x592360,_0x5efcec=document['createElement']('div');_0x5efcec['className']=_0x4da53d(0x15c)+_0x46287d[_0x4da53d(0x17f)];const _0x3433b2=document[_0x4da53d(0x179)](_0x4da53d(0x1cc));_0x3433b2[_0x4da53d(0x16e)]=_0x4da53d(0x161),_0x3433b2[_0x4da53d(0x1ac)]=_0x46287d[_0x4da53d(0x1c4)][_0x4da53d(0x17e)](/\n/g,_0x4da53d(0x19b));const _0x3bbdac=document['createElement']('div');_0x3bbdac[_0x4da53d(0x16e)]=_0x4da53d(0x1bc),_0x3bbdac[_0x4da53d(0x1ac)]=_0x4da53d(0x1bf),_0x3bbdac[_0x4da53d(0x1a7)]=_0xf4666e=>{_0xf4666e['stopPropagation'](),confirmDelete(_0x5ce98c);};let _0x325fda;_0x3433b2['addEventListener']('touchstart',()=>_0x325fda=setTimeout(()=>{const _0x20b7c8=_0x4da53d;_0x5efcec[_0x20b7c8(0x197)][_0x20b7c8(0x175)](_0x20b7c8(0x1b0));if(tg?.[_0x20b7c8(0x1be)])tg[_0x20b7c8(0x1be)][_0x20b7c8(0x158)]('medium');},0x1f4)),_0x3433b2['addEventListener'](_0x4da53d(0x1c0),()=>clearTimeout(_0x325fda));const _0x3b87b5=document[_0x4da53d(0x179)](_0x4da53d(0x1cc));return _0x3b87b5['className']=_0x4da53d(0x19f),_0x3b87b5[_0x4da53d(0x1ab)]=formatTime(_0x46287d[_0x4da53d(0x157)]),_0x5efcec[_0x4da53d(0x1ca)](_0x3bbdac),_0x5efcec[_0x4da53d(0x1ca)](_0x3433b2),_0x5efcec[_0x4da53d(0x1ca)](_0x3b87b5),_0x5efcec;}function a0_0x2f1b(){const _0x23c7a1=['messageInput','debug_uid','message-bubble','getItem','viewportChanged','now','user','ready','viewportHeight','.message.show-delete','scrollTop','click','key','Ошибка\x20сети','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','className','stringify','Действие\x20необратимо.','setItem','typingIndicator','addEventListener','expand','add','2105910uJbGZK','Enter','getHours','createElement','auto','10EelCkN','splice','disableVerticalSwipes','replace','role','remove','18zeeNuo','padStart','children','getMinutes','preventDefault','keydown','ai_chat_messages','innerHeight','clear_history','message\x20ai','json','BackButton','scrollHeight','1917986wvCvRF','length','username','display','getElementById','(((.+)+)+)+$','input','confirmModal','Пустой\x20ответ','classList','shiftKey','paddingBottom','modalConfirm','<br>','modalText','warn','error','message-time','WebApp','text','function','from','value','initDataUnsafe','Ошибка\x20сервера','onclick','Удалить?','Telegram','notificationOccurred','textContent','innerHTML','none','push','Очистить\x20историю?','show-delete','6.1','5745DrCMDZ','light','min','isVersionAtLeast','search','Начнется\x20новый\x20диалог.','querySelector','POST','.container','1213676LcoNAn','delete-btn','chatArea','HapticFeedback','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','touchend','setHeaderColor','forEach','modalCancel','content','abort','contains','href','sendBtn','emptyState','appendChild','offClick','div','onClick','modalTitle','flex','signal','apply','height','focus','floor','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','trim','show','timestamp','impactOccurred','168616WNHAfo','style','430cppkJS','message\x20','5567060QcblTc','546170oWIoKS'];a0_0x2f1b=function(){return _0x23c7a1;};return a0_0x2f1b();}function createTypingIndicator(){const _0x5ab08e=a0_0x592360,_0x3cafe6=document[_0x5ab08e(0x179)](_0x5ab08e(0x1cc));return _0x3cafe6[_0x5ab08e(0x16e)]=_0x5ab08e(0x18a),_0x3cafe6['id']=_0x5ab08e(0x172),_0x3cafe6[_0x5ab08e(0x1ac)]=_0x5ab08e(0x154),_0x3cafe6;}function renderMessages(){const _0x304505=a0_0x592360;Array[_0x304505(0x1a3)](chatArea[_0x304505(0x183)])['forEach'](_0xb1cb2e=>{const _0x4f6f17=_0x304505;if(_0xb1cb2e['id']!=='emptyState')_0xb1cb2e[_0x4f6f17(0x180)]();}),messages[_0x304505(0x18f)]>0x0?(emptyState[_0x304505(0x15a)]['display']=_0x304505(0x1ad),messages[_0x304505(0x1c2)]((_0x487115,_0x41bc08)=>chatArea[_0x304505(0x1ca)](createMessageElement(_0x487115,_0x41bc08)))):emptyState['style'][_0x304505(0x191)]=_0x304505(0x1cf),requestAnimationFrame(()=>chatArea[_0x304505(0x169)]=chatArea[_0x304505(0x18d)]);}function autoResizeTextarea(){const _0x598726=a0_0x592360;messageInput[_0x598726(0x15a)][_0x598726(0x1d2)]=_0x598726(0x17a),messageInput[_0x598726(0x15a)][_0x598726(0x1d2)]=Math[_0x598726(0x1b4)](messageInput[_0x598726(0x18d)],0x78)+'px';}function updateSendButton(){const _0x44e7b4=a0_0x592360,_0x4c3bbf=messageInput[_0x44e7b4(0x1a4)][_0x44e7b4(0x155)]();sendBtn['disabled']=!_0x4c3bbf||isTyping;}async function sendMessage(){const _0x379b54=a0_0x592360,_0x1ca4ae=messageInput['value']['trim']();if(!_0x1ca4ae||isTyping)return;if(tg?.[_0x379b54(0x1be)])tg['HapticFeedback'][_0x379b54(0x158)](_0x379b54(0x1b3));messages[_0x379b54(0x1ae)]({'role':'user','content':_0x1ca4ae,'timestamp':Date[_0x379b54(0x164)]()}),localStorage[_0x379b54(0x171)](_0x379b54(0x187),JSON[_0x379b54(0x16f)](messages)),renderMessages(),messageInput[_0x379b54(0x1a4)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x379b54(0x1ca)](createTypingIndicator()),chatArea[_0x379b54(0x169)]=chatArea[_0x379b54(0x18d)];const _0x41b588=await callBackend('send_message',{'message':_0x1ca4ae});isTyping=![];const _0x18f113=document['getElementById'](_0x379b54(0x172));if(_0x18f113)_0x18f113[_0x379b54(0x180)]();let _0x35b377=_0x379b54(0x16c);if(_0x41b588['success']){_0x35b377=_0x41b588[_0x379b54(0x1a1)]||_0x379b54(0x196);if(tg?.[_0x379b54(0x1be)])tg[_0x379b54(0x1be)][_0x379b54(0x1aa)]('success');}else{_0x35b377=_0x41b588[_0x379b54(0x19e)]||_0x379b54(0x1a6);if(tg?.['HapticFeedback'])tg[_0x379b54(0x1be)][_0x379b54(0x1aa)](_0x379b54(0x19e));}messages[_0x379b54(0x1ae)]({'role':'ai','content':_0x35b377,'timestamp':Date['now']()}),localStorage[_0x379b54(0x171)](_0x379b54(0x187),JSON[_0x379b54(0x16f)](messages)),renderMessages();}function confirmDelete(_0x4a3be7){const _0x5d52f2=a0_0x592360;if(mTitle)mTitle[_0x5d52f2(0x1ab)]=_0x5d52f2(0x1a8);if(mText)mText[_0x5d52f2(0x1ab)]=_0x5d52f2(0x170);modalCallback=()=>{const _0x435448=_0x5d52f2;messages[_0x435448(0x17c)](_0x4a3be7,0x1),localStorage[_0x435448(0x171)](_0x435448(0x187),JSON[_0x435448(0x16f)](messages)),renderMessages();},modal[_0x5d52f2(0x197)][_0x5d52f2(0x175)](_0x5d52f2(0x156));}if(clearBtn)clearBtn[a0_0x592360(0x1a7)]=()=>{const _0x390956=a0_0x592360;if(!messages[_0x390956(0x18f)])return;if(mTitle)mTitle[_0x390956(0x1ab)]=_0x390956(0x1af);if(mText)mText[_0x390956(0x1ab)]=_0x390956(0x1b7);modalCallback=async()=>{const _0x29f11d=_0x390956;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x29f11d(0x189),{});},modal[_0x390956(0x197)][_0x390956(0x175)](_0x390956(0x156));};document[a0_0x592360(0x192)](a0_0x592360(0x1c3))[a0_0x592360(0x1a7)]=()=>modal[a0_0x592360(0x197)]['remove'](a0_0x592360(0x156)),document[a0_0x592360(0x192)](a0_0x592360(0x19a))[a0_0x592360(0x1a7)]=()=>{const _0x13a88c=a0_0x592360;if(modalCallback)modalCallback();modal['classList'][_0x13a88c(0x180)](_0x13a88c(0x156));},messageInput[a0_0x592360(0x173)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x592360(0x186),_0x3d3694=>{const _0x59c983=a0_0x592360;_0x3d3694[_0x59c983(0x16b)]===_0x59c983(0x177)&&!_0x3d3694[_0x59c983(0x198)]&&(_0x3d3694[_0x59c983(0x185)](),sendMessage());}),sendBtn[a0_0x592360(0x1a7)]=sendMessage,document[a0_0x592360(0x173)](a0_0x592360(0x16a),_0x2cf3b6=>{const _0x48e65b=a0_0x592360;document['querySelectorAll'](_0x48e65b(0x168))[_0x48e65b(0x1c2)](_0x3422e8=>{const _0x586a49=_0x48e65b;if(!_0x3422e8[_0x586a49(0x1c6)](_0x2cf3b6['target']))_0x3422e8[_0x586a49(0x197)][_0x586a49(0x180)](_0x586a49(0x1b0));});});const saved=localStorage[a0_0x592360(0x162)](a0_0x592360(0x187));function a0_0x3245(_0x56856e,_0x3571e0){_0x56856e=_0x56856e-0x153;const _0x3f9d66=a0_0x2f1b();let _0x28502c=_0x3f9d66[_0x56856e];return _0x28502c;}if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0xd91ba2){}updateSendButton();