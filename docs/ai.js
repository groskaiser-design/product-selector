const a0_0xf81eed=a0_0x20b1;(function(_0x16bcff,_0x3d1c39){const _0x493e14=a0_0x20b1,_0x58c3df=_0x16bcff();while(!![]){try{const _0x52be9f=-parseInt(_0x493e14(0x11c))/0x1+-parseInt(_0x493e14(0xe8))/0x2*(parseInt(_0x493e14(0x114))/0x3)+parseInt(_0x493e14(0x128))/0x4*(-parseInt(_0x493e14(0x107))/0x5)+-parseInt(_0x493e14(0xf1))/0x6+parseInt(_0x493e14(0x125))/0x7+parseInt(_0x493e14(0x130))/0x8*(parseInt(_0x493e14(0x108))/0x9)+parseInt(_0x493e14(0x13f))/0xa*(parseInt(_0x493e14(0x10e))/0xb);if(_0x52be9f===_0x3d1c39)break;else _0x58c3df['push'](_0x58c3df['shift']());}catch(_0x7a66a9){_0x58c3df['push'](_0x58c3df['shift']());}}}(a0_0x3e4e,0xaf17c));const tg=window[a0_0xf81eed(0x110)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x52ad1d=a0_0xf81eed,_0x51f151=(function(){let _0xebc78=!![];return function(_0x36c77a,_0x767f88){const _0x25cb7c=_0xebc78?function(){const _0x13b957=a0_0x20b1;if(_0x767f88){const _0x4063a8=_0x767f88[_0x13b957(0x129)](_0x36c77a,arguments);return _0x767f88=null,_0x4063a8;}}:function(){};return _0xebc78=![],_0x25cb7c;};}()),_0x3fb120=_0x51f151(this,function(){const _0x39a6d7=a0_0x20b1;return _0x3fb120[_0x39a6d7(0x101)]()['search'](_0x39a6d7(0xef))[_0x39a6d7(0x101)]()[_0x39a6d7(0x140)](_0x3fb120)[_0x39a6d7(0xce)](_0x39a6d7(0xef));});_0x3fb120();if(!tg)return;try{tg[_0x52ad1d(0x148)](),tg[_0x52ad1d(0x149)](),tg[_0x52ad1d(0x115)]?.(_0x52ad1d(0xf4));if(tg[_0x52ad1d(0x13c)]?.(_0x52ad1d(0xd9)))tg[_0x52ad1d(0x117)]?.();const _0x14a10f=tg['BackButton'];if(_0x14a10f){_0x14a10f[_0x52ad1d(0xf6)]();if(typeof _0x14a10f['offClick']===_0x52ad1d(0x10c))try{_0x14a10f[_0x52ad1d(0x12e)]();}catch(_0x52629f){}_0x14a10f[_0x52ad1d(0x127)](()=>{const _0x109e7b=_0x52ad1d;if(tg[_0x109e7b(0xec)])tg[_0x109e7b(0xec)][_0x109e7b(0x10b)](_0x109e7b(0xcd));location[_0x109e7b(0x122)]=HOME_URL;});}}catch(_0x55829b){console[_0x52ad1d(0xde)]('TG\x20setup\x20error:',_0x55829b);}}(function initStableLayout(){const _0x53bbe2=a0_0xf81eed,_0x2dd4e9=document[_0x53bbe2(0x120)](_0x53bbe2(0x13d)),_0x3d97e9=document[_0x53bbe2(0x118)](_0x53bbe2(0x134)),_0x166f98=document[_0x53bbe2(0x118)](_0x53bbe2(0x11d)),_0x45ce34=document[_0x53bbe2(0x118)](_0x53bbe2(0x12c));function _0x27ea14(){const _0x4c648f=_0x53bbe2;if(!_0x2dd4e9)return;const _0x45d31e=tg&&tg[_0x4c648f(0xd3)]?tg[_0x4c648f(0xd3)]:window['innerHeight'];_0x2dd4e9[_0x4c648f(0x11e)][_0x4c648f(0x13e)]=_0x45d31e+'px';if(_0x3d97e9){const _0x33dee7=_0x3d97e9[_0x4c648f(0xed)];_0x166f98['style']['paddingBottom']=_0x33dee7+0x28+'px';}}tg?tg[_0x53bbe2(0x113)](_0x53bbe2(0x124),({isStateStable:_0x3b69dc})=>{_0x27ea14();if(_0x3b69dc)requestAnimationFrame(()=>{const _0x137ac6=a0_0x20b1;_0x166f98[_0x137ac6(0xfd)]=_0x166f98[_0x137ac6(0xf8)];});}):window[_0x53bbe2(0x138)](_0x53bbe2(0x144),_0x27ea14),_0x27ea14(),_0x45ce34&&(_0x45ce34[_0x53bbe2(0x138)](_0x53bbe2(0x11b),()=>{requestAnimationFrame(_0x27ea14);}),_0x45ce34['addEventListener']('focus',()=>{setTimeout(()=>{const _0x1e58ec=a0_0x20b1;_0x166f98[_0x1e58ec(0xfd)]=_0x166f98[_0x1e58ec(0xf8)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x3e4e(){const _0x21a296=['height','20ZYsWLS','constructor','error','floor','value','resize','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','POST','preventDefault','ready','expand','Ошибка\x20сервера','content','light','search','className','onclick','remove','length','viewportHeight','touchend','contains','success','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','keydown','6.1','typingIndicator','message-bubble','text/plain','parse','warn','emptyState','modalConfirm','Ошибка\x20сети','role','replace','div','now','min','setItem','2744EHncmF','textContent','target','modalTitle','HapticFeedback','offsetHeight','Очистить\x20историю?','(((.+)+)+)+$','getItem','7889040YhxXhT','push','abort','#050505','Пустой\x20ответ','show','text','scrollHeight','add','sendBtn','padStart','stopPropagation','scrollTop','notificationOccurred','splice','medium','toString','display','random','appendChild','Действие\x20необратимо.','show-delete','4149185WgHsuK','12466431AxxLyJ','username','auto','impactOccurred','function','querySelectorAll','9841876ctaRpt','innerHTML','Telegram','classList','stringify','onEvent','1305YNCCNi','setHeaderColor','debug_uid','disableVerticalSwipes','getElementById','user','from','input','128322joiBmF','chatArea','style','.message.show-delete','querySelector','getMinutes','href','message\x20','viewportChanged','2886856AuBbJg','forEach','onClick','4IhzkjO','apply','initDataUnsafe','click','messageInput','ai_chat_messages','offClick','message-time','8oZHLgS','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','send_message','trim','inputArea','clear_history','message\x20ai','Начнется\x20новый\x20диалог.','addEventListener','Enter','createElement','key','isVersionAtLeast','.container'];a0_0x3e4e=function(){return _0x21a296;};return a0_0x3e4e();}const BACKEND_URL=a0_0xf81eed(0xd7),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0xf81eed(0x11d)),emptyState=document[a0_0xf81eed(0x118)](a0_0xf81eed(0xdf)),messageInput=document[a0_0xf81eed(0x118)]('messageInput'),sendBtn=document[a0_0xf81eed(0x118)](a0_0xf81eed(0xfa)),clearBtn=document[a0_0xf81eed(0x118)]('clearBtn'),modal=document[a0_0xf81eed(0x118)]('confirmModal'),mTitle=document['getElementById'](a0_0xf81eed(0xeb)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x37e648,_0x1c970b){const _0x454711=a0_0xf81eed,_0x5e79aa=tg?.[_0x454711(0x12a)]?.['user']||{},_0x3e3a9d=_0x5e79aa['id']||localStorage[_0x454711(0xf0)](_0x454711(0x116))||'d-'+Math[_0x454711(0x142)](Math[_0x454711(0x103)]()*0x3b9aca00);if(!_0x5e79aa['id'])localStorage[_0x454711(0xe7)](_0x454711(0x116),_0x3e3a9d);const _0x2643d8={'action':_0x37e648,'user_id':_0x3e3a9d,'user_data':{'first_name':_0x5e79aa['first_name'],'username':_0x5e79aa[_0x454711(0x109)]},'init_data':tg?.['initData']||'',..._0x1c970b},_0x426ea2=new AbortController(),_0x1bcc04=setTimeout(()=>_0x426ea2[_0x454711(0xf3)](),REQUEST_TIMEOUT_MS);try{const _0x11ed1f=await fetch(BACKEND_URL,{'method':_0x454711(0x146),'headers':{'Content-Type':_0x454711(0xdc)},'body':JSON[_0x454711(0x112)](_0x2643d8),'signal':_0x426ea2['signal']});return clearTimeout(_0x1bcc04),await _0x11ed1f['json']();}catch(_0x18d9d7){return{'success':![],'error':String(_0x18d9d7)};}}function a0_0x20b1(_0x47ba3e,_0x14b5d2){_0x47ba3e=_0x47ba3e-0xcd;const _0x569b97=a0_0x3e4e();let _0x2a5da5=_0x569b97[_0x47ba3e];return _0x2a5da5;}function formatTime(_0x1b3075){const _0x2bb00e=a0_0xf81eed,_0x5ca72c=new Date(_0x1b3075);return String(_0x5ca72c['getHours']())[_0x2bb00e(0xfb)](0x2,'0')+':'+String(_0x5ca72c[_0x2bb00e(0x121)]())[_0x2bb00e(0xfb)](0x2,'0');}function createMessageElement(_0x1b99b6,_0x34df36){const _0xe85947=a0_0xf81eed,_0x36a183=document['createElement'](_0xe85947(0xe4));_0x36a183['className']=_0xe85947(0x123)+_0x1b99b6[_0xe85947(0xe2)];const _0x5b67bc=document['createElement'](_0xe85947(0xe4));_0x5b67bc[_0xe85947(0xcf)]=_0xe85947(0xdb),_0x5b67bc[_0xe85947(0x10f)]=_0x1b99b6[_0xe85947(0x14b)][_0xe85947(0xe3)](/\n/g,'<br>');const _0x97fb2c=document[_0xe85947(0x13a)](_0xe85947(0xe4));_0x97fb2c[_0xe85947(0xcf)]='delete-btn',_0x97fb2c[_0xe85947(0x10f)]=_0xe85947(0x131),_0x97fb2c[_0xe85947(0xd0)]=_0x5b9db1=>{const _0x4d0296=_0xe85947;_0x5b9db1[_0x4d0296(0xfc)](),confirmDelete(_0x34df36);};let _0x3066c4;_0x5b67bc['addEventListener']('touchstart',()=>_0x3066c4=setTimeout(()=>{const _0x437aab=_0xe85947;_0x36a183[_0x437aab(0x111)][_0x437aab(0xf9)](_0x437aab(0x106));if(tg?.[_0x437aab(0xec)])tg[_0x437aab(0xec)][_0x437aab(0x10b)](_0x437aab(0x100));},0x1f4)),_0x5b67bc[_0xe85947(0x138)](_0xe85947(0xd4),()=>clearTimeout(_0x3066c4));const _0x258468=document[_0xe85947(0x13a)]('div');return _0x258468[_0xe85947(0xcf)]=_0xe85947(0x12f),_0x258468[_0xe85947(0xe9)]=formatTime(_0x1b99b6['timestamp']),_0x36a183[_0xe85947(0x104)](_0x97fb2c),_0x36a183[_0xe85947(0x104)](_0x5b67bc),_0x36a183[_0xe85947(0x104)](_0x258468),_0x36a183;}function createTypingIndicator(){const _0x24b5f9=a0_0xf81eed,_0x26610f=document[_0x24b5f9(0x13a)]('div');return _0x26610f[_0x24b5f9(0xcf)]=_0x24b5f9(0x136),_0x26610f['id']=_0x24b5f9(0xda),_0x26610f['innerHTML']=_0x24b5f9(0x145),_0x26610f;}function renderMessages(){const _0x30e415=a0_0xf81eed;Array[_0x30e415(0x11a)](chatArea['children'])[_0x30e415(0x126)](_0x3e7827=>{const _0x487e0f=_0x30e415;if(_0x3e7827['id']!==_0x487e0f(0xdf))_0x3e7827['remove']();}),messages[_0x30e415(0xd2)]>0x0?(emptyState[_0x30e415(0x11e)]['display']='none',messages['forEach']((_0x2962a1,_0x4331c8)=>chatArea[_0x30e415(0x104)](createMessageElement(_0x2962a1,_0x4331c8)))):emptyState[_0x30e415(0x11e)][_0x30e415(0x102)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x30e415(0xf8)]);}function autoResizeTextarea(){const _0x306aca=a0_0xf81eed;messageInput[_0x306aca(0x11e)]['height']=_0x306aca(0x10a),messageInput[_0x306aca(0x11e)][_0x306aca(0x13e)]=Math[_0x306aca(0xe6)](messageInput[_0x306aca(0xf8)],0x78)+'px';}function updateSendButton(){const _0x3f612b=a0_0xf81eed,_0x29f995=messageInput['value'][_0x3f612b(0x133)]();sendBtn['disabled']=!_0x29f995||isTyping;}async function sendMessage(){const _0x34fbe5=a0_0xf81eed,_0x4c0109=messageInput[_0x34fbe5(0x143)][_0x34fbe5(0x133)]();if(!_0x4c0109||isTyping)return;if(tg?.[_0x34fbe5(0xec)])tg[_0x34fbe5(0xec)]['impactOccurred'](_0x34fbe5(0xcd));messages[_0x34fbe5(0xf2)]({'role':_0x34fbe5(0x119),'content':_0x4c0109,'timestamp':Date[_0x34fbe5(0xe5)]()}),localStorage['setItem'](_0x34fbe5(0x12d),JSON['stringify'](messages)),renderMessages(),messageInput[_0x34fbe5(0x143)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x34fbe5(0x104)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x34fbe5(0xf8)];const _0x6f24b=await callBackend(_0x34fbe5(0x132),{'message':_0x4c0109});isTyping=![];const _0x116b7a=document[_0x34fbe5(0x118)](_0x34fbe5(0xda));if(_0x116b7a)_0x116b7a['remove']();let _0x120c52=_0x34fbe5(0xe1);if(_0x6f24b['success']){_0x120c52=_0x6f24b[_0x34fbe5(0xf7)]||_0x34fbe5(0xf5);if(tg?.[_0x34fbe5(0xec)])tg[_0x34fbe5(0xec)][_0x34fbe5(0xfe)](_0x34fbe5(0xd6));}else{_0x120c52=_0x6f24b[_0x34fbe5(0x141)]||_0x34fbe5(0x14a);if(tg?.[_0x34fbe5(0xec)])tg[_0x34fbe5(0xec)]['notificationOccurred'](_0x34fbe5(0x141));}messages[_0x34fbe5(0xf2)]({'role':'ai','content':_0x120c52,'timestamp':Date[_0x34fbe5(0xe5)]()}),localStorage[_0x34fbe5(0xe7)](_0x34fbe5(0x12d),JSON[_0x34fbe5(0x112)](messages)),renderMessages();}function confirmDelete(_0x5c2227){const _0xce977e=a0_0xf81eed;if(mTitle)mTitle[_0xce977e(0xe9)]='Удалить?';if(mText)mText[_0xce977e(0xe9)]=_0xce977e(0x105);modalCallback=()=>{const _0x2957c6=_0xce977e;messages[_0x2957c6(0xff)](_0x5c2227,0x1),localStorage[_0x2957c6(0xe7)](_0x2957c6(0x12d),JSON[_0x2957c6(0x112)](messages)),renderMessages();},modal['classList']['add'](_0xce977e(0xf6));}if(clearBtn)clearBtn[a0_0xf81eed(0xd0)]=()=>{const _0x4be3c9=a0_0xf81eed;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x4be3c9(0xee);if(mText)mText[_0x4be3c9(0xe9)]=_0x4be3c9(0x137);modalCallback=async()=>{const _0xa73de2=_0x4be3c9;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0xa73de2(0x135),{});},modal[_0x4be3c9(0x111)][_0x4be3c9(0xf9)]('show');};document[a0_0xf81eed(0x118)]('modalCancel')['onclick']=()=>modal[a0_0xf81eed(0x111)]['remove'](a0_0xf81eed(0xf6)),document[a0_0xf81eed(0x118)](a0_0xf81eed(0xe0))[a0_0xf81eed(0xd0)]=()=>{const _0x183a8e=a0_0xf81eed;if(modalCallback)modalCallback();modal[_0x183a8e(0x111)]['remove'](_0x183a8e(0xf6));},messageInput[a0_0xf81eed(0x138)](a0_0xf81eed(0x11b),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0xf81eed(0xd8),_0x501457=>{const _0x3d1d36=a0_0xf81eed;_0x501457[_0x3d1d36(0x13b)]===_0x3d1d36(0x139)&&!_0x501457['shiftKey']&&(_0x501457[_0x3d1d36(0x147)](),sendMessage());}),sendBtn[a0_0xf81eed(0xd0)]=sendMessage,document[a0_0xf81eed(0x138)](a0_0xf81eed(0x12b),_0x39bccd=>{const _0x41d7fd=a0_0xf81eed;document[_0x41d7fd(0x10d)](_0x41d7fd(0x11f))['forEach'](_0x3c4204=>{const _0x2b2c6e=_0x41d7fd;if(!_0x3c4204[_0x2b2c6e(0xd5)](_0x39bccd[_0x2b2c6e(0xea)]))_0x3c4204[_0x2b2c6e(0x111)][_0x2b2c6e(0xd1)](_0x2b2c6e(0x106));});});const saved=localStorage[a0_0xf81eed(0xf0)](a0_0xf81eed(0x12d));if(saved)try{messages=JSON[a0_0xf81eed(0xdd)](saved),renderMessages();}catch(a0_0x1da90d){}updateSendButton();