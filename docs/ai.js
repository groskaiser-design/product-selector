const a0_0xc3f8be=a0_0x1321;(function(_0x5a007d,_0x2ae687){const _0x2f708d=a0_0x1321,_0x4819fa=_0x5a007d();while(!![]){try{const _0x406c1c=-parseInt(_0x2f708d(0x259))/0x1*(parseInt(_0x2f708d(0x23a))/0x2)+parseInt(_0x2f708d(0x240))/0x3+parseInt(_0x2f708d(0x210))/0x4*(parseInt(_0x2f708d(0x202))/0x5)+parseInt(_0x2f708d(0x209))/0x6*(parseInt(_0x2f708d(0x1f5))/0x7)+parseInt(_0x2f708d(0x1fe))/0x8*(parseInt(_0x2f708d(0x21d))/0x9)+parseInt(_0x2f708d(0x26d))/0xa*(-parseInt(_0x2f708d(0x200))/0xb)+parseInt(_0x2f708d(0x1fa))/0xc;if(_0x406c1c===_0x2ae687)break;else _0x4819fa['push'](_0x4819fa['shift']());}catch(_0x3dfea3){_0x4819fa['push'](_0x4819fa['shift']());}}}(a0_0x4917,0x448e2));const tg=window[a0_0xc3f8be(0x1fd)]?.[a0_0xc3f8be(0x251)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0xc86ef3=a0_0xc3f8be;if(!tg)return;try{tg[_0xc86ef3(0x22a)](),tg[_0xc86ef3(0x221)](),tg[_0xc86ef3(0x269)]?.(_0xc86ef3(0x245));if(tg[_0xc86ef3(0x26f)]?.(_0xc86ef3(0x218)))tg[_0xc86ef3(0x216)]?.();const _0x4294fb=tg['BackButton'];if(_0x4294fb){_0x4294fb[_0xc86ef3(0x228)]();if(typeof _0x4294fb[_0xc86ef3(0x20c)]===_0xc86ef3(0x266))try{_0x4294fb[_0xc86ef3(0x20c)]();}catch(_0x2d3216){}_0x4294fb['onClick'](()=>{const _0x51692a=_0xc86ef3;if(tg['HapticFeedback'])tg[_0x51692a(0x223)][_0x51692a(0x250)]('light');location[_0x51692a(0x265)]=HOME_URL;});}}catch(_0x3d64f5){console[_0xc86ef3(0x215)](_0xc86ef3(0x238),_0x3d64f5);}}(function initStableLayout(){const _0x169b7c=a0_0xc3f8be,_0x4ddcb3=(function(){let _0x7142fe=!![];return function(_0x498a94,_0x470cb7){const _0x46a952=_0x7142fe?function(){const _0x580f14=a0_0x1321;if(_0x470cb7){const _0x2b3abc=_0x470cb7[_0x580f14(0x252)](_0x498a94,arguments);return _0x470cb7=null,_0x2b3abc;}}:function(){};return _0x7142fe=![],_0x46a952;};}()),_0x152b23=document[_0x169b7c(0x260)]('.container'),_0x161c96=document[_0x169b7c(0x261)](_0x169b7c(0x21e)),_0x28827f=document[_0x169b7c(0x261)](_0x169b7c(0x1fb)),_0x1e0105=document['getElementById'](_0x169b7c(0x211));function _0x83afda(){const _0x244f32=_0x169b7c,_0x4456e5=_0x4ddcb3(this,function(){const _0x526156=a0_0x1321;return _0x4456e5[_0x526156(0x267)]()[_0x526156(0x206)](_0x526156(0x246))[_0x526156(0x267)]()[_0x526156(0x229)](_0x4456e5)[_0x526156(0x206)]('(((.+)+)+)+$');});_0x4456e5();if(!_0x152b23)return;const _0x9b4942=tg&&tg[_0x244f32(0x243)]?tg[_0x244f32(0x243)]:window[_0x244f32(0x20a)];_0x152b23[_0x244f32(0x244)][_0x244f32(0x242)]=_0x9b4942+'px';if(_0x161c96){const _0xb32a21=_0x161c96[_0x244f32(0x22c)];_0x28827f[_0x244f32(0x244)][_0x244f32(0x208)]=_0xb32a21+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x2f108a})=>{_0x83afda();if(_0x2f108a)requestAnimationFrame(()=>{const _0x49453c=a0_0x1321;_0x28827f[_0x49453c(0x23c)]=_0x28827f['scrollHeight'];});}):window['addEventListener'](_0x169b7c(0x207),_0x83afda),_0x83afda(),_0x1e0105&&(_0x1e0105['addEventListener']('input',()=>{requestAnimationFrame(_0x83afda);}),_0x1e0105[_0x169b7c(0x201)]('focus',()=>{setTimeout(()=>{const _0x22ed21=a0_0x1321;_0x28827f['scrollTop']=_0x28827f[_0x22ed21(0x22f)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xc3f8be(0x21c),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x1321(_0x1ce9cc,_0x5f0fde){_0x1ce9cc=_0x1ce9cc-0x1f3;const _0x2dfaa0=a0_0x4917();let _0x52a385=_0x2dfaa0[_0x1ce9cc];return _0x52a385;}let messages=[],isTyping=![];const chatArea=document[a0_0xc3f8be(0x261)](a0_0xc3f8be(0x1fb)),emptyState=document['getElementById'](a0_0xc3f8be(0x239)),messageInput=document[a0_0xc3f8be(0x261)](a0_0xc3f8be(0x211)),sendBtn=document[a0_0xc3f8be(0x261)](a0_0xc3f8be(0x24a)),clearBtn=document[a0_0xc3f8be(0x261)](a0_0xc3f8be(0x25a)),modal=document[a0_0xc3f8be(0x261)](a0_0xc3f8be(0x1f9)),mTitle=document['getElementById'](a0_0xc3f8be(0x217)),mText=document['getElementById'](a0_0xc3f8be(0x20b));let modalCallback=null;async function callBackend(_0x103eac,_0x2276a7){const _0x5ce8ad=a0_0xc3f8be,_0x3322c6=tg?.[_0x5ce8ad(0x273)]?.[_0x5ce8ad(0x272)]||{},_0x14eb1d=_0x3322c6['id']||localStorage[_0x5ce8ad(0x24e)](_0x5ce8ad(0x1f7))||'d-'+Math['floor'](Math[_0x5ce8ad(0x26c)]()*0x3b9aca00);if(!_0x3322c6['id'])localStorage[_0x5ce8ad(0x23e)](_0x5ce8ad(0x1f7),_0x14eb1d);const _0x1968c8={'action':_0x103eac,'user_id':_0x14eb1d,'user_data':{'first_name':_0x3322c6[_0x5ce8ad(0x263)],'username':_0x3322c6['username']},'init_data':tg?.[_0x5ce8ad(0x24b)]||'',..._0x2276a7},_0x485caf=new AbortController(),_0x1f76c6=setTimeout(()=>_0x485caf[_0x5ce8ad(0x22b)](),REQUEST_TIMEOUT_MS);try{const _0x21f325=await fetch(BACKEND_URL,{'method':_0x5ce8ad(0x241),'headers':{'Content-Type':_0x5ce8ad(0x1f3)},'body':JSON[_0x5ce8ad(0x220)](_0x1968c8),'signal':_0x485caf[_0x5ce8ad(0x235)]});return clearTimeout(_0x1f76c6),await _0x21f325[_0x5ce8ad(0x25f)]();}catch(_0x13643d){return{'success':![],'error':String(_0x13643d)};}}function formatTime(_0x12ab81){const _0x433ea2=a0_0xc3f8be,_0x4eb5e6=new Date(_0x12ab81);return String(_0x4eb5e6[_0x433ea2(0x24f)]())[_0x433ea2(0x213)](0x2,'0')+':'+String(_0x4eb5e6['getMinutes']())[_0x433ea2(0x213)](0x2,'0');}function createMessageElement(_0x2e26f8,_0x493e7a){const _0x39b3fa=a0_0xc3f8be,_0x25c6c7=document['createElement'](_0x39b3fa(0x20f));_0x25c6c7[_0x39b3fa(0x212)]=_0x39b3fa(0x21b)+_0x2e26f8[_0x39b3fa(0x257)];const _0x38beb6=document[_0x39b3fa(0x22d)]('div');_0x38beb6['className']=_0x39b3fa(0x1f6),_0x38beb6['innerHTML']=_0x2e26f8[_0x39b3fa(0x20e)]['replace'](/\n/g,'<br>');const _0x310579=document[_0x39b3fa(0x22d)](_0x39b3fa(0x20f));_0x310579['className']='delete-btn',_0x310579[_0x39b3fa(0x1ff)]=_0x39b3fa(0x247),_0x310579[_0x39b3fa(0x205)]=_0x321936=>{const _0x2c250a=_0x39b3fa;_0x321936[_0x2c250a(0x258)](),confirmDelete(_0x493e7a);};let _0x21300f;_0x38beb6[_0x39b3fa(0x201)](_0x39b3fa(0x264),()=>_0x21300f=setTimeout(()=>{const _0x583bd2=_0x39b3fa;_0x25c6c7['classList'][_0x583bd2(0x275)](_0x583bd2(0x234));if(tg?.[_0x583bd2(0x223)])tg[_0x583bd2(0x223)][_0x583bd2(0x250)](_0x583bd2(0x271));},0x1f4)),_0x38beb6[_0x39b3fa(0x201)](_0x39b3fa(0x1f8),()=>clearTimeout(_0x21300f));const _0xa43596=document[_0x39b3fa(0x22d)]('div');return _0xa43596[_0x39b3fa(0x212)]=_0x39b3fa(0x222),_0xa43596[_0x39b3fa(0x268)]=formatTime(_0x2e26f8[_0x39b3fa(0x236)]),_0x25c6c7[_0x39b3fa(0x270)](_0x310579),_0x25c6c7['appendChild'](_0x38beb6),_0x25c6c7[_0x39b3fa(0x270)](_0xa43596),_0x25c6c7;}function createTypingIndicator(){const _0x7f8caf=a0_0xc3f8be,_0x478d2c=document[_0x7f8caf(0x22d)]('div');return _0x478d2c[_0x7f8caf(0x212)]=_0x7f8caf(0x219),_0x478d2c['id']='typingIndicator',_0x478d2c[_0x7f8caf(0x1ff)]=_0x7f8caf(0x262),_0x478d2c;}function renderMessages(){const _0x567e6a=a0_0xc3f8be;Array[_0x567e6a(0x274)](chatArea[_0x567e6a(0x21f)])['forEach'](_0x3eb049=>{if(_0x3eb049['id']!=='emptyState')_0x3eb049['remove']();}),messages[_0x567e6a(0x25e)]>0x0?(emptyState[_0x567e6a(0x244)][_0x567e6a(0x203)]='none',messages[_0x567e6a(0x1fc)]((_0x33f6b0,_0x154614)=>chatArea[_0x567e6a(0x270)](createMessageElement(_0x33f6b0,_0x154614)))):emptyState[_0x567e6a(0x244)][_0x567e6a(0x203)]=_0x567e6a(0x256),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x567e6a(0x22f)]);}function autoResizeTextarea(){const _0x2aa345=a0_0xc3f8be;messageInput[_0x2aa345(0x244)]['height']=_0x2aa345(0x249),messageInput[_0x2aa345(0x244)][_0x2aa345(0x242)]=Math[_0x2aa345(0x253)](messageInput[_0x2aa345(0x22f)],0x78)+'px';}function updateSendButton(){const _0x5d6e84=a0_0xc3f8be,_0xc488de=messageInput[_0x5d6e84(0x20d)]['trim']();sendBtn[_0x5d6e84(0x227)]=!_0xc488de||isTyping;}async function sendMessage(){const _0x44e625=a0_0xc3f8be,_0x45ed34=messageInput[_0x44e625(0x20d)][_0x44e625(0x23f)]();if(!_0x45ed34||isTyping)return;if(tg?.[_0x44e625(0x223)])tg['HapticFeedback'][_0x44e625(0x250)]('light');messages['push']({'role':_0x44e625(0x272),'content':_0x45ed34,'timestamp':Date[_0x44e625(0x26a)]()}),localStorage[_0x44e625(0x23e)](_0x44e625(0x22e),JSON[_0x44e625(0x220)](messages)),renderMessages(),messageInput[_0x44e625(0x20d)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x44e625(0x270)](createTypingIndicator()),chatArea[_0x44e625(0x23c)]=chatArea[_0x44e625(0x22f)];const _0x595126=await callBackend('send_message',{'message':_0x45ed34});isTyping=![];const _0x5363b6=document[_0x44e625(0x261)](_0x44e625(0x225));if(_0x5363b6)_0x5363b6[_0x44e625(0x237)]();let _0x36f4b4=_0x44e625(0x254);if(_0x595126[_0x44e625(0x1f4)]){_0x36f4b4=_0x595126[_0x44e625(0x24c)]||_0x44e625(0x25c);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x44e625(0x230)](_0x44e625(0x1f4));}else{_0x36f4b4=_0x595126[_0x44e625(0x276)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x44e625(0x230)](_0x44e625(0x276));}messages[_0x44e625(0x214)]({'role':'ai','content':_0x36f4b4,'timestamp':Date[_0x44e625(0x26a)]()}),localStorage[_0x44e625(0x23e)]('ai_chat_messages',JSON[_0x44e625(0x220)](messages)),renderMessages();}function confirmDelete(_0x4cae41){const _0x1b44cc=a0_0xc3f8be;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText['textContent']=_0x1b44cc(0x233);modalCallback=()=>{const _0x5b7434=_0x1b44cc;messages['splice'](_0x4cae41,0x1),localStorage[_0x5b7434(0x23e)](_0x5b7434(0x22e),JSON[_0x5b7434(0x220)](messages)),renderMessages();},modal[_0x1b44cc(0x26e)]['add'](_0x1b44cc(0x228));}if(clearBtn)clearBtn['onclick']=()=>{const _0x35986f=a0_0xc3f8be;if(!messages[_0x35986f(0x25e)])return;if(mTitle)mTitle[_0x35986f(0x268)]=_0x35986f(0x255);if(mText)mText[_0x35986f(0x268)]=_0x35986f(0x204);modalCallback=async()=>{const _0x19a774=_0x35986f;messages=[],localStorage[_0x19a774(0x224)](_0x19a774(0x22e)),renderMessages(),callBackend(_0x19a774(0x26b),{});},modal[_0x35986f(0x26e)][_0x35986f(0x275)](_0x35986f(0x228));};document['getElementById'](a0_0xc3f8be(0x23b))[a0_0xc3f8be(0x205)]=()=>modal[a0_0xc3f8be(0x26e)][a0_0xc3f8be(0x237)](a0_0xc3f8be(0x228)),document['getElementById'](a0_0xc3f8be(0x25d))[a0_0xc3f8be(0x205)]=()=>{const _0x587c1e=a0_0xc3f8be;if(modalCallback)modalCallback();modal['classList'][_0x587c1e(0x237)](_0x587c1e(0x228));},messageInput[a0_0xc3f8be(0x201)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xc3f8be(0x201)]('keydown',_0x2649c4=>{const _0x3390a9=a0_0xc3f8be;_0x2649c4[_0x3390a9(0x24d)]===_0x3390a9(0x231)&&!_0x2649c4[_0x3390a9(0x21a)]&&(_0x2649c4[_0x3390a9(0x25b)](),sendMessage());}),sendBtn[a0_0xc3f8be(0x205)]=sendMessage,document['addEventListener']('click',_0x19052f=>{const _0x1c81a4=a0_0xc3f8be;document[_0x1c81a4(0x23d)](_0x1c81a4(0x226))[_0x1c81a4(0x1fc)](_0x1a77bb=>{const _0x2bb7c7=_0x1c81a4;if(!_0x1a77bb[_0x2bb7c7(0x248)](_0x19052f['target']))_0x1a77bb[_0x2bb7c7(0x26e)][_0x2bb7c7(0x237)](_0x2bb7c7(0x234));});});const saved=localStorage['getItem'](a0_0xc3f8be(0x22e));if(saved)try{messages=JSON[a0_0xc3f8be(0x232)](saved),renderMessages();}catch(a0_0x3d112c){}updateSendButton();function a0_0x4917(){const _0xaefeeb=['1440857VxKTUY','addEventListener','20MqWrBe','display','Начнется\x20новый\x20диалог.','onclick','search','resize','paddingBottom','6612PmBJMn','innerHeight','modalText','offClick','value','content','div','196984FIltti','messageInput','className','padStart','push','warn','disableVerticalSwipes','modalTitle','6.1','message\x20ai','shiftKey','message\x20','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','9WjicEE','inputArea','children','stringify','expand','message-time','HapticFeedback','removeItem','typingIndicator','.message.show-delete','disabled','show','constructor','ready','abort','offsetHeight','createElement','ai_chat_messages','scrollHeight','notificationOccurred','Enter','parse','Действие\x20необратимо.','show-delete','signal','timestamp','remove','TG\x20setup\x20error:','emptyState','13522TvQSJv','modalCancel','scrollTop','querySelectorAll','setItem','trim','587589FrEfSp','POST','height','viewportHeight','style','#050505','(((.+)+)+)+$','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','contains','auto','sendBtn','initData','text','key','getItem','getHours','impactOccurred','WebApp','apply','min','Ошибка\x20сети','Очистить\x20историю?','flex','role','stopPropagation','75LTrmAt','clearBtn','preventDefault','Пустой\x20ответ','modalConfirm','length','json','querySelector','getElementById','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','first_name','touchstart','href','function','toString','textContent','setHeaderColor','now','clear_history','random','10GTgcZj','classList','isVersionAtLeast','appendChild','medium','user','initDataUnsafe','from','add','error','text/plain','success','1946sogdTf','message-bubble','debug_uid','touchend','confirmModal','2611800ENsVsA','chatArea','forEach','Telegram','16088pCyYRt','innerHTML'];a0_0x4917=function(){return _0xaefeeb;};return a0_0x4917();}