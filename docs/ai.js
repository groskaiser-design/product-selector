const a0_0x1b3cab=a0_0x5cc1;(function(_0xbf242c,_0x99804d){const _0x3c7250=a0_0x5cc1,_0x2d3649=_0xbf242c();while(!![]){try{const _0x2934c9=-parseInt(_0x3c7250(0x1bf))/0x1+parseInt(_0x3c7250(0x1b8))/0x2+parseInt(_0x3c7250(0x199))/0x3*(parseInt(_0x3c7250(0x1db))/0x4)+-parseInt(_0x3c7250(0x17d))/0x5+parseInt(_0x3c7250(0x1b4))/0x6+parseInt(_0x3c7250(0x17c))/0x7*(-parseInt(_0x3c7250(0x1ec))/0x8)+parseInt(_0x3c7250(0x1dd))/0x9*(parseInt(_0x3c7250(0x19c))/0xa);if(_0x2934c9===_0x99804d)break;else _0x2d3649['push'](_0x2d3649['shift']());}catch(_0x33377c){_0x2d3649['push'](_0x2d3649['shift']());}}}(a0_0x47f3,0x21b45));const tg=window[a0_0x1b3cab(0x1e3)]?.['WebApp'],HOME_URL=a0_0x1b3cab(0x1d5);function setupTelegramBackButton(){const _0x569468=a0_0x1b3cab,_0x3bc38f=(function(){let _0x4db560=!![];return function(_0x5e1e18,_0x27006b){const _0x52f707=_0x4db560?function(){const _0x469a28=a0_0x5cc1;if(_0x27006b){const _0x3a44df=_0x27006b[_0x469a28(0x18f)](_0x5e1e18,arguments);return _0x27006b=null,_0x3a44df;}}:function(){};return _0x4db560=![],_0x52f707;};}()),_0x1815b6=_0x3bc38f(this,function(){const _0x3984c5=a0_0x5cc1;return _0x1815b6['toString']()[_0x3984c5(0x185)](_0x3984c5(0x1b1))[_0x3984c5(0x1bb)]()[_0x3984c5(0x184)](_0x1815b6)[_0x3984c5(0x185)](_0x3984c5(0x1b1));});_0x1815b6();if(!tg)return;try{tg[_0x569468(0x183)](),tg['expand'](),tg['setHeaderColor']?.(_0x569468(0x178));if(tg[_0x569468(0x1cc)]?.(_0x569468(0x1de)))tg[_0x569468(0x18e)]?.();const _0xeb8b1d=tg[_0x569468(0x186)];if(_0xeb8b1d){_0xeb8b1d[_0x569468(0x1b5)]();if(typeof _0xeb8b1d[_0x569468(0x1d7)]==='function')try{_0xeb8b1d['offClick']();}catch(_0x53dbe5){}_0xeb8b1d[_0x569468(0x1a3)](()=>{const _0x453fc0=_0x569468;if(tg['HapticFeedback'])tg[_0x453fc0(0x16d)][_0x453fc0(0x179)](_0x453fc0(0x1bd));location[_0x453fc0(0x1e7)]=HOME_URL;});}}catch(_0x1c13ce){console['warn']('TG\x20setup\x20error:',_0x1c13ce);}}(function initStableLayout(){const _0x22c965=a0_0x1b3cab,_0x1d36e3=document[_0x22c965(0x1ef)](_0x22c965(0x18c)),_0x2dddd7=document[_0x22c965(0x1be)]('inputArea'),_0x331ba4=document['getElementById'](_0x22c965(0x176)),_0x11f781=document[_0x22c965(0x1be)](_0x22c965(0x1ee));function _0x115d03(){const _0x930da7=_0x22c965;if(!_0x1d36e3)return;const _0x151051=tg&&tg[_0x930da7(0x172)]?tg['viewportHeight']:window[_0x930da7(0x1c9)];_0x1d36e3['style']['height']=_0x151051+'px';if(_0x2dddd7){const _0x65c362=_0x2dddd7[_0x930da7(0x1bc)];_0x331ba4[_0x930da7(0x1d1)][_0x930da7(0x18a)]=_0x65c362+0x28+'px';}}tg?tg[_0x22c965(0x16f)](_0x22c965(0x1b3),({isStateStable:_0x324b63})=>{_0x115d03();if(_0x324b63)requestAnimationFrame(()=>{const _0x29b73e=a0_0x5cc1;_0x331ba4[_0x29b73e(0x1dc)]=_0x331ba4[_0x29b73e(0x1ed)];});}):window[_0x22c965(0x1b7)](_0x22c965(0x1ad),_0x115d03),_0x115d03(),_0x11f781&&(_0x11f781['addEventListener'](_0x22c965(0x193),()=>{requestAnimationFrame(_0x115d03);}),_0x11f781[_0x22c965(0x1b7)](_0x22c965(0x1aa),()=>{setTimeout(()=>{const _0x15fe7c=a0_0x5cc1;_0x331ba4['scrollTop']=_0x331ba4[_0x15fe7c(0x1ed)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1b3cab(0x1af),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1b3cab(0x1be)](a0_0x1b3cab(0x176)),emptyState=document[a0_0x1b3cab(0x1be)](a0_0x1b3cab(0x191)),messageInput=document[a0_0x1b3cab(0x1be)](a0_0x1b3cab(0x1ee)),sendBtn=document[a0_0x1b3cab(0x1be)](a0_0x1b3cab(0x1e2)),clearBtn=document[a0_0x1b3cab(0x1be)](a0_0x1b3cab(0x18b)),modal=document[a0_0x1b3cab(0x1be)](a0_0x1b3cab(0x1cd)),mTitle=document['getElementById'](a0_0x1b3cab(0x1ab)),mText=document['getElementById'](a0_0x1b3cab(0x1a9));let modalCallback=null;async function callBackend(_0x10988c,_0x5e47f4){const _0x43010d=a0_0x1b3cab,_0x2d0f1d=tg?.[_0x43010d(0x1e0)]?.['user']||{},_0x5b3db4=_0x2d0f1d['id']||localStorage[_0x43010d(0x19f)](_0x43010d(0x1eb))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x2d0f1d['id'])localStorage[_0x43010d(0x16e)](_0x43010d(0x1eb),_0x5b3db4);const _0x3ac149={'action':_0x10988c,'user_id':_0x5b3db4,'user_data':{'first_name':_0x2d0f1d[_0x43010d(0x17b)],'username':_0x2d0f1d['username']},'init_data':tg?.[_0x43010d(0x1c8)]||'',..._0x5e47f4},_0x52ae4a=new AbortController(),_0x10e99b=setTimeout(()=>_0x52ae4a[_0x43010d(0x1b6)](),REQUEST_TIMEOUT_MS);try{const _0x366cff=await fetch(BACKEND_URL,{'method':_0x43010d(0x1ac),'headers':{'Content-Type':_0x43010d(0x1ce)},'body':JSON['stringify'](_0x3ac149),'signal':_0x52ae4a[_0x43010d(0x1d8)]});return clearTimeout(_0x10e99b),await _0x366cff[_0x43010d(0x1a1)]();}catch(_0x66de87){return{'success':![],'error':String(_0x66de87)};}}function formatTime(_0x1ac439){const _0x27812f=a0_0x1b3cab,_0x2feba5=new Date(_0x1ac439);return String(_0x2feba5[_0x27812f(0x1e1)]())[_0x27812f(0x194)](0x2,'0')+':'+String(_0x2feba5[_0x27812f(0x1ea)]())[_0x27812f(0x194)](0x2,'0');}function createMessageElement(_0x22b377,_0x475243){const _0x5a47f2=a0_0x1b3cab,_0x4e7f19=document[_0x5a47f2(0x1a7)](_0x5a47f2(0x1df));_0x4e7f19[_0x5a47f2(0x188)]=_0x5a47f2(0x1c4)+_0x22b377['role'];const _0x3779b9=document['createElement'](_0x5a47f2(0x1df));_0x3779b9[_0x5a47f2(0x188)]=_0x5a47f2(0x1a4),_0x3779b9['innerHTML']=_0x22b377[_0x5a47f2(0x1cb)][_0x5a47f2(0x19a)](/\n/g,_0x5a47f2(0x173));const _0xfea260=document[_0x5a47f2(0x1a7)]('div');_0xfea260[_0x5a47f2(0x188)]=_0x5a47f2(0x182),_0xfea260['innerHTML']=_0x5a47f2(0x1ca),_0xfea260[_0x5a47f2(0x1c1)]=_0x3d304b=>{_0x3d304b['stopPropagation'](),confirmDelete(_0x475243);};let _0x48ece3;_0x3779b9[_0x5a47f2(0x1b7)](_0x5a47f2(0x175),()=>_0x48ece3=setTimeout(()=>{const _0x56f477=_0x5a47f2;_0x4e7f19[_0x56f477(0x171)][_0x56f477(0x1c7)](_0x56f477(0x19d));if(tg?.['HapticFeedback'])tg[_0x56f477(0x16d)]['impactOccurred']('medium');},0x1f4)),_0x3779b9[_0x5a47f2(0x1b7)](_0x5a47f2(0x17f),()=>clearTimeout(_0x48ece3));const _0x3747c0=document[_0x5a47f2(0x1a7)](_0x5a47f2(0x1df));return _0x3747c0[_0x5a47f2(0x188)]=_0x5a47f2(0x1d4),_0x3747c0[_0x5a47f2(0x1d3)]=formatTime(_0x22b377[_0x5a47f2(0x19b)]),_0x4e7f19['appendChild'](_0xfea260),_0x4e7f19['appendChild'](_0x3779b9),_0x4e7f19[_0x5a47f2(0x1a5)](_0x3747c0),_0x4e7f19;}function createTypingIndicator(){const _0x3f4a01=a0_0x1b3cab,_0x233b23=document[_0x3f4a01(0x1a7)]('div');return _0x233b23[_0x3f4a01(0x188)]=_0x3f4a01(0x1ba),_0x233b23['id']=_0x3f4a01(0x1c2),_0x233b23[_0x3f4a01(0x177)]=_0x3f4a01(0x1d9),_0x233b23;}function renderMessages(){const _0x4ea7d3=a0_0x1b3cab;Array[_0x4ea7d3(0x1e5)](chatArea[_0x4ea7d3(0x16b)])['forEach'](_0x5d3032=>{const _0x2d3405=_0x4ea7d3;if(_0x5d3032['id']!==_0x2d3405(0x191))_0x5d3032[_0x2d3405(0x1d0)]();}),messages[_0x4ea7d3(0x1da)]>0x0?(emptyState[_0x4ea7d3(0x1d1)][_0x4ea7d3(0x174)]=_0x4ea7d3(0x180),messages[_0x4ea7d3(0x1c3)]((_0x5c13ee,_0x16ccad)=>chatArea['appendChild'](createMessageElement(_0x5c13ee,_0x16ccad)))):emptyState[_0x4ea7d3(0x1d1)][_0x4ea7d3(0x174)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x4ea7d3(0x1ed)]);}function autoResizeTextarea(){const _0x2cc444=a0_0x1b3cab;messageInput['style'][_0x2cc444(0x170)]=_0x2cc444(0x187),messageInput[_0x2cc444(0x1d1)][_0x2cc444(0x170)]=Math[_0x2cc444(0x17a)](messageInput[_0x2cc444(0x1ed)],0x78)+'px';}function updateSendButton(){const _0x2ab900=a0_0x1b3cab,_0x3872ae=messageInput[_0x2ab900(0x196)][_0x2ab900(0x1e8)]();sendBtn[_0x2ab900(0x1e4)]=!_0x3872ae||isTyping;}async function sendMessage(){const _0x13f0f5=a0_0x1b3cab,_0x4bf1f9=messageInput[_0x13f0f5(0x196)][_0x13f0f5(0x1e8)]();if(!_0x4bf1f9||isTyping)return;if(tg?.[_0x13f0f5(0x16d)])tg[_0x13f0f5(0x16d)][_0x13f0f5(0x179)](_0x13f0f5(0x1bd));messages[_0x13f0f5(0x1d6)]({'role':_0x13f0f5(0x1a6),'content':_0x4bf1f9,'timestamp':Date[_0x13f0f5(0x189)]()}),localStorage['setItem'](_0x13f0f5(0x1b2),JSON[_0x13f0f5(0x19e)](messages)),renderMessages(),messageInput[_0x13f0f5(0x196)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x13f0f5(0x1a5)](createTypingIndicator()),chatArea[_0x13f0f5(0x1dc)]=chatArea[_0x13f0f5(0x1ed)];const _0xb7943e=await callBackend(_0x13f0f5(0x192),{'message':_0x4bf1f9});isTyping=![];const _0x107a08=document[_0x13f0f5(0x1be)](_0x13f0f5(0x1c2));if(_0x107a08)_0x107a08[_0x13f0f5(0x1d0)]();let _0x374cf9=_0x13f0f5(0x1a0);if(_0xb7943e[_0x13f0f5(0x1c6)]){_0x374cf9=_0xb7943e[_0x13f0f5(0x16c)]||'Пустой\x20ответ';if(tg?.[_0x13f0f5(0x16d)])tg[_0x13f0f5(0x16d)][_0x13f0f5(0x198)](_0x13f0f5(0x1c6));}else{_0x374cf9=_0xb7943e[_0x13f0f5(0x1d2)]||_0x13f0f5(0x18d);if(tg?.[_0x13f0f5(0x16d)])tg['HapticFeedback'][_0x13f0f5(0x198)]('error');}messages[_0x13f0f5(0x1d6)]({'role':'ai','content':_0x374cf9,'timestamp':Date['now']()}),localStorage[_0x13f0f5(0x16e)](_0x13f0f5(0x1b2),JSON[_0x13f0f5(0x19e)](messages)),renderMessages();}function a0_0x5cc1(_0xc53c1c,_0x11e68a){_0xc53c1c=_0xc53c1c-0x16b;const _0x569004=a0_0x47f3();let _0x1bdefe=_0x569004[_0xc53c1c];return _0x1bdefe;}function a0_0x47f3(){const _0x50af15=['stringify','getItem','Ошибка\x20сети','json','removeItem','onClick','message-bubble','appendChild','user','createElement','Удалить?','modalText','focus','modalTitle','POST','resize','contains','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','splice','(((.+)+)+)+$','ai_chat_messages','viewportChanged','918834qBILlf','show','abort','addEventListener','269504XwRqjO','modalConfirm','message\x20ai','toString','offsetHeight','light','getElementById','243493BGwirt','querySelectorAll','onclick','typingIndicator','forEach','message\x20','preventDefault','success','add','initData','innerHeight','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','content','isVersionAtLeast','confirmModal','text/plain','key','remove','style','error','textContent','message-time','./router.html','push','offClick','signal','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','length','20ueYLnr','scrollTop','446382IvUJLX','6.1','div','initDataUnsafe','getHours','sendBtn','Telegram','disabled','from','Действие\x20необратимо.','href','trim','Начнется\x20новый\x20диалог.','getMinutes','debug_uid','293768MzNzFX','scrollHeight','messageInput','querySelector','children','text','HapticFeedback','setItem','onEvent','height','classList','viewportHeight','<br>','display','touchstart','chatArea','innerHTML','#050505','impactOccurred','min','first_name','14FCdxyd','1206970wBWWtf','.message.show-delete','touchend','none','modalCancel','delete-btn','ready','constructor','search','BackButton','auto','className','now','paddingBottom','clearBtn','.container','Ошибка\x20сервера','disableVerticalSwipes','apply','click','emptyState','send_message','input','padStart','shiftKey','value','target','notificationOccurred','36783ESSpxX','replace','timestamp','70iqDmuC','show-delete'];a0_0x47f3=function(){return _0x50af15;};return a0_0x47f3();}function confirmDelete(_0x3a1ba9){const _0x50fab9=a0_0x1b3cab;if(mTitle)mTitle[_0x50fab9(0x1d3)]=_0x50fab9(0x1a8);if(mText)mText[_0x50fab9(0x1d3)]=_0x50fab9(0x1e6);modalCallback=()=>{const _0x3f25ab=_0x50fab9;messages[_0x3f25ab(0x1b0)](_0x3a1ba9,0x1),localStorage['setItem'](_0x3f25ab(0x1b2),JSON['stringify'](messages)),renderMessages();},modal[_0x50fab9(0x171)]['add'](_0x50fab9(0x1b5));}if(clearBtn)clearBtn[a0_0x1b3cab(0x1c1)]=()=>{const _0x591659=a0_0x1b3cab;if(!messages[_0x591659(0x1da)])return;if(mTitle)mTitle[_0x591659(0x1d3)]='Очистить\x20историю?';if(mText)mText[_0x591659(0x1d3)]=_0x591659(0x1e9);modalCallback=async()=>{const _0xb270fc=_0x591659;messages=[],localStorage[_0xb270fc(0x1a2)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x591659(0x171)][_0x591659(0x1c7)](_0x591659(0x1b5));};document[a0_0x1b3cab(0x1be)](a0_0x1b3cab(0x181))[a0_0x1b3cab(0x1c1)]=()=>modal[a0_0x1b3cab(0x171)][a0_0x1b3cab(0x1d0)]('show'),document[a0_0x1b3cab(0x1be)](a0_0x1b3cab(0x1b9))['onclick']=()=>{const _0x6284f4=a0_0x1b3cab;if(modalCallback)modalCallback();modal[_0x6284f4(0x171)]['remove'](_0x6284f4(0x1b5));},messageInput[a0_0x1b3cab(0x1b7)](a0_0x1b3cab(0x193),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1b3cab(0x1b7)]('keydown',_0x61ccc=>{const _0x4219fc=a0_0x1b3cab;_0x61ccc[_0x4219fc(0x1cf)]==='Enter'&&!_0x61ccc[_0x4219fc(0x195)]&&(_0x61ccc[_0x4219fc(0x1c5)](),sendMessage());}),sendBtn[a0_0x1b3cab(0x1c1)]=sendMessage,document[a0_0x1b3cab(0x1b7)](a0_0x1b3cab(0x190),_0x565519=>{const _0x5c3d24=a0_0x1b3cab;document[_0x5c3d24(0x1c0)](_0x5c3d24(0x17e))[_0x5c3d24(0x1c3)](_0x144740=>{const _0x5d57d9=_0x5c3d24;if(!_0x144740[_0x5d57d9(0x1ae)](_0x565519[_0x5d57d9(0x197)]))_0x144740[_0x5d57d9(0x171)][_0x5d57d9(0x1d0)](_0x5d57d9(0x19d));});});const saved=localStorage[a0_0x1b3cab(0x19f)](a0_0x1b3cab(0x1b2));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x47f37a){}updateSendButton();