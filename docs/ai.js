const a0_0x53663d=a0_0xcbc8;(function(_0x2fe15d,_0x48c16b){const _0x14b968=a0_0xcbc8,_0x127324=_0x2fe15d();while(!![]){try{const _0x2240f4=-parseInt(_0x14b968(0xf7))/0x1+parseInt(_0x14b968(0xe5))/0x2*(parseInt(_0x14b968(0xcc))/0x3)+parseInt(_0x14b968(0xfd))/0x4*(-parseInt(_0x14b968(0xf0))/0x5)+-parseInt(_0x14b968(0xee))/0x6*(-parseInt(_0x14b968(0xae))/0x7)+-parseInt(_0x14b968(0x11d))/0x8+parseInt(_0x14b968(0xb4))/0x9*(-parseInt(_0x14b968(0xd5))/0xa)+-parseInt(_0x14b968(0xe8))/0xb*(-parseInt(_0x14b968(0xf5))/0xc);if(_0x2240f4===_0x48c16b)break;else _0x127324['push'](_0x127324['shift']());}catch(_0x144e5f){_0x127324['push'](_0x127324['shift']());}}}(a0_0x4706,0x8d889));const tg=window[a0_0x53663d(0xc9)]?.[a0_0x53663d(0xb2)],HOME_URL=a0_0x53663d(0x123);function setupTelegramBackButton(){const _0x24c88f=a0_0x53663d,_0x1379b2=(function(){let _0x3adfaf=!![];return function(_0x5134ed,_0x3607aa){const _0x34c980=_0x3adfaf?function(){const _0x12cb43=a0_0xcbc8;if(_0x3607aa){const _0x1b1967=_0x3607aa[_0x12cb43(0xd6)](_0x5134ed,arguments);return _0x3607aa=null,_0x1b1967;}}:function(){};return _0x3adfaf=![],_0x34c980;};}()),_0x3dc813=_0x1379b2(this,function(){const _0x477e39=a0_0xcbc8;return _0x3dc813[_0x477e39(0xff)]()[_0x477e39(0xe1)](_0x477e39(0xcf))['toString']()[_0x477e39(0x113)](_0x3dc813)[_0x477e39(0xe1)]('(((.+)+)+)+$');});_0x3dc813();if(!tg)return;try{tg[_0x24c88f(0xfa)](),tg[_0x24c88f(0xde)](),tg['setHeaderColor']?.(_0x24c88f(0x10c));if(tg['isVersionAtLeast']?.(_0x24c88f(0xbb)))tg[_0x24c88f(0xef)]?.();const _0x55a128=tg['BackButton'];if(_0x55a128){_0x55a128[_0x24c88f(0xbf)]();if(typeof _0x55a128['offClick']===_0x24c88f(0xbe))try{_0x55a128['offClick']();}catch(_0x3ce860){}_0x55a128['onClick'](()=>{const _0x491704=_0x24c88f;if(tg['HapticFeedback'])tg[_0x491704(0x11f)][_0x491704(0xfc)](_0x491704(0xf1));location[_0x491704(0xd7)]=HOME_URL;});}}catch(_0x3914d8){console[_0x24c88f(0xa1)](_0x24c88f(0xac),_0x3914d8);}}(function initStableLayout(){const _0x19aa7c=a0_0x53663d,_0x57e76f=document[_0x19aa7c(0xba)](_0x19aa7c(0xce)),_0x2ef705=document['getElementById'](_0x19aa7c(0xb6)),_0x4053bb=document[_0x19aa7c(0xe4)](_0x19aa7c(0xdf)),_0x298a1a=document[_0x19aa7c(0xe4)](_0x19aa7c(0x117));function _0x699746(){const _0x3f456b=_0x19aa7c;if(!_0x57e76f)return;const _0x11446f=tg&&tg[_0x3f456b(0xfb)]?tg[_0x3f456b(0xfb)]:window[_0x3f456b(0xcd)];_0x57e76f['style']['height']=_0x11446f+'px';if(_0x2ef705){const _0x51a73a=_0x2ef705[_0x3f456b(0xc3)];_0x4053bb[_0x3f456b(0xf9)][_0x3f456b(0xa6)]=_0x51a73a+0x28+'px';}}tg?tg[_0x19aa7c(0x105)]('viewportChanged',({isStateStable:_0x1f3094})=>{_0x699746();if(_0x1f3094)requestAnimationFrame(()=>{const _0x52ff7b=a0_0xcbc8;_0x4053bb[_0x52ff7b(0xe7)]=_0x4053bb['scrollHeight'];});}):window[_0x19aa7c(0x11b)]('resize',_0x699746),_0x699746(),_0x298a1a&&(_0x298a1a['addEventListener']('input',()=>{requestAnimationFrame(_0x699746);}),_0x298a1a[_0x19aa7c(0x11b)](_0x19aa7c(0xb7),()=>{setTimeout(()=>{const _0x1bb066=a0_0xcbc8;_0x4053bb[_0x1bb066(0xe7)]=_0x4053bb[_0x1bb066(0xd2)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x53663d(0xca),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x4706(){const _0x458061=['height','function','show','random','touchstart','medium','offsetHeight','textContent','createElement','classList','.message.show-delete','add','Telegram','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','initData','699cOWChq','innerHeight','.container','(((.+)+)+)+$','push','target','scrollHeight','contains','trim','30UMlDLT','apply','href','Начнется\x20новый\x20диалог.','modalCancel','<br>','message-time','message\x20','message\x20ai','expand','chatArea','setItem','search','now','error','getElementById','5582dBlDHV','none','scrollTop','484187rcpPkb','remove','splice','signal','first_name','auto','2929998xKljgq','disableVerticalSwipes','1198055CuTswp','light','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','success','emptyState','84eSkYnV','Очистить\x20историю?','151555fojfsc','POST','style','ready','viewportHeight','impactOccurred','4UGoQWL','json','toString','clear_history','clearBtn','touchend','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','typingIndicator','onEvent','initDataUnsafe','disabled','click','message-bubble','className','key','#050505','debug_uid','input','keydown','forEach','display','onclick','constructor','innerHTML','notificationOccurred','Действие\x20необратимо.','messageInput','Ошибка\x20сети','preventDefault','replace','addEventListener','length','3612520aMaTOS','children','HapticFeedback','shiftKey','show-delete','confirmModal','./router.html','warn','text','stopPropagation','padStart','modalTitle','paddingBottom','div','removeItem','parse','querySelectorAll','value','TG\x20setup\x20error:','ai_chat_messages','7hPXGPz','delete-btn','getHours','stringify','WebApp','text/plain','72909MrCMVh','abort','inputArea','focus','Enter','appendChild','querySelector','6.1','user'];a0_0x4706=function(){return _0x458061;};return a0_0x4706();}let messages=[],isTyping=![];const chatArea=document[a0_0x53663d(0xe4)](a0_0x53663d(0xdf)),emptyState=document[a0_0x53663d(0xe4)]('emptyState'),messageInput=document['getElementById'](a0_0x53663d(0x117)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x53663d(0xe4)](a0_0x53663d(0x101)),modal=document[a0_0x53663d(0xe4)](a0_0x53663d(0x122)),mTitle=document[a0_0x53663d(0xe4)](a0_0x53663d(0xa5)),mText=document[a0_0x53663d(0xe4)]('modalText');let modalCallback=null;async function callBackend(_0x31e775,_0x2ee5ca){const _0x187fe7=a0_0x53663d,_0x2e463d=tg?.[_0x187fe7(0x106)]?.[_0x187fe7(0xbc)]||{},_0x4926d0=_0x2e463d['id']||localStorage['getItem'](_0x187fe7(0x10d))||'d-'+Math['floor'](Math[_0x187fe7(0xc0)]()*0x3b9aca00);if(!_0x2e463d['id'])localStorage['setItem'](_0x187fe7(0x10d),_0x4926d0);const _0x1c1089={'action':_0x31e775,'user_id':_0x4926d0,'user_data':{'first_name':_0x2e463d[_0x187fe7(0xec)],'username':_0x2e463d['username']},'init_data':tg?.[_0x187fe7(0xcb)]||'',..._0x2ee5ca},_0x9b16ce=new AbortController(),_0x26883b=setTimeout(()=>_0x9b16ce[_0x187fe7(0xb5)](),REQUEST_TIMEOUT_MS);try{const _0x5b9fd8=await fetch(BACKEND_URL,{'method':_0x187fe7(0xf8),'headers':{'Content-Type':_0x187fe7(0xb3)},'body':JSON['stringify'](_0x1c1089),'signal':_0x9b16ce[_0x187fe7(0xeb)]});return clearTimeout(_0x26883b),await _0x5b9fd8[_0x187fe7(0xfe)]();}catch(_0x2a5526){return{'success':![],'error':String(_0x2a5526)};}}function formatTime(_0x467715){const _0x2141f1=a0_0x53663d,_0x132edc=new Date(_0x467715);return String(_0x132edc[_0x2141f1(0xb0)]())[_0x2141f1(0xa4)](0x2,'0')+':'+String(_0x132edc['getMinutes']())[_0x2141f1(0xa4)](0x2,'0');}function createMessageElement(_0x380e0e,_0x5c5966){const _0x2dc6b8=a0_0x53663d,_0xfa2913=document[_0x2dc6b8(0xc5)](_0x2dc6b8(0xa7));_0xfa2913[_0x2dc6b8(0x10a)]=_0x2dc6b8(0xdc)+_0x380e0e['role'];const _0x23a493=document[_0x2dc6b8(0xc5)](_0x2dc6b8(0xa7));_0x23a493[_0x2dc6b8(0x10a)]=_0x2dc6b8(0x109),_0x23a493[_0x2dc6b8(0x114)]=_0x380e0e['content'][_0x2dc6b8(0x11a)](/\n/g,_0x2dc6b8(0xda));const _0x298b53=document[_0x2dc6b8(0xc5)](_0x2dc6b8(0xa7));_0x298b53['className']=_0x2dc6b8(0xaf),_0x298b53[_0x2dc6b8(0x114)]=_0x2dc6b8(0xf2),_0x298b53[_0x2dc6b8(0x112)]=_0x5ce07d=>{const _0xe284e3=_0x2dc6b8;_0x5ce07d[_0xe284e3(0xa3)](),confirmDelete(_0x5c5966);};let _0x503838;_0x23a493[_0x2dc6b8(0x11b)](_0x2dc6b8(0xc1),()=>_0x503838=setTimeout(()=>{const _0x4adff0=_0x2dc6b8;_0xfa2913[_0x4adff0(0xc6)][_0x4adff0(0xc8)](_0x4adff0(0x121));if(tg?.[_0x4adff0(0x11f)])tg['HapticFeedback'][_0x4adff0(0xfc)](_0x4adff0(0xc2));},0x1f4)),_0x23a493[_0x2dc6b8(0x11b)](_0x2dc6b8(0x102),()=>clearTimeout(_0x503838));const _0x41f336=document[_0x2dc6b8(0xc5)](_0x2dc6b8(0xa7));return _0x41f336['className']=_0x2dc6b8(0xdb),_0x41f336['textContent']=formatTime(_0x380e0e['timestamp']),_0xfa2913[_0x2dc6b8(0xb9)](_0x298b53),_0xfa2913[_0x2dc6b8(0xb9)](_0x23a493),_0xfa2913['appendChild'](_0x41f336),_0xfa2913;}function createTypingIndicator(){const _0x3a5964=a0_0x53663d,_0x45aae6=document[_0x3a5964(0xc5)](_0x3a5964(0xa7));return _0x45aae6['className']=_0x3a5964(0xdd),_0x45aae6['id']=_0x3a5964(0x104),_0x45aae6[_0x3a5964(0x114)]=_0x3a5964(0x103),_0x45aae6;}function renderMessages(){const _0x282401=a0_0x53663d;Array['from'](chatArea[_0x282401(0x11e)])[_0x282401(0x110)](_0x186c0e=>{const _0x1f4eca=_0x282401;if(_0x186c0e['id']!==_0x1f4eca(0xf4))_0x186c0e[_0x1f4eca(0xe9)]();}),messages[_0x282401(0x11c)]>0x0?(emptyState[_0x282401(0xf9)][_0x282401(0x111)]=_0x282401(0xe6),messages['forEach']((_0x5b1387,_0x15f3e1)=>chatArea[_0x282401(0xb9)](createMessageElement(_0x5b1387,_0x15f3e1)))):emptyState[_0x282401(0xf9)][_0x282401(0x111)]='flex',requestAnimationFrame(()=>chatArea[_0x282401(0xe7)]=chatArea[_0x282401(0xd2)]);}function autoResizeTextarea(){const _0x36efad=a0_0x53663d;messageInput[_0x36efad(0xf9)][_0x36efad(0xbd)]=_0x36efad(0xed),messageInput[_0x36efad(0xf9)][_0x36efad(0xbd)]=Math['min'](messageInput[_0x36efad(0xd2)],0x78)+'px';}function updateSendButton(){const _0xbe2d69=a0_0x53663d,_0x444d39=messageInput[_0xbe2d69(0xab)][_0xbe2d69(0xd4)]();sendBtn[_0xbe2d69(0x107)]=!_0x444d39||isTyping;}async function sendMessage(){const _0xd5c92d=a0_0x53663d,_0x382c71=messageInput['value'][_0xd5c92d(0xd4)]();if(!_0x382c71||isTyping)return;if(tg?.[_0xd5c92d(0x11f)])tg[_0xd5c92d(0x11f)][_0xd5c92d(0xfc)]('light');messages[_0xd5c92d(0xd0)]({'role':'user','content':_0x382c71,'timestamp':Date[_0xd5c92d(0xe2)]()}),localStorage['setItem'](_0xd5c92d(0xad),JSON[_0xd5c92d(0xb1)](messages)),renderMessages(),messageInput[_0xd5c92d(0xab)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xd5c92d(0xb9)](createTypingIndicator()),chatArea[_0xd5c92d(0xe7)]=chatArea[_0xd5c92d(0xd2)];const _0x120272=await callBackend('send_message',{'message':_0x382c71});isTyping=![];const _0x2580fe=document[_0xd5c92d(0xe4)](_0xd5c92d(0x104));if(_0x2580fe)_0x2580fe[_0xd5c92d(0xe9)]();let _0x580386=_0xd5c92d(0x118);if(_0x120272[_0xd5c92d(0xf3)]){_0x580386=_0x120272[_0xd5c92d(0xa2)]||'Пустой\x20ответ';if(tg?.[_0xd5c92d(0x11f)])tg[_0xd5c92d(0x11f)][_0xd5c92d(0x115)](_0xd5c92d(0xf3));}else{_0x580386=_0x120272[_0xd5c92d(0xe3)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg[_0xd5c92d(0x11f)][_0xd5c92d(0x115)]('error');}messages[_0xd5c92d(0xd0)]({'role':'ai','content':_0x580386,'timestamp':Date[_0xd5c92d(0xe2)]()}),localStorage[_0xd5c92d(0xe0)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x519012){const _0x36be8d=a0_0x53663d;if(mTitle)mTitle[_0x36be8d(0xc4)]='Удалить?';if(mText)mText[_0x36be8d(0xc4)]=_0x36be8d(0x116);modalCallback=()=>{const _0x4bfdd4=_0x36be8d;messages[_0x4bfdd4(0xea)](_0x519012,0x1),localStorage[_0x4bfdd4(0xe0)](_0x4bfdd4(0xad),JSON[_0x4bfdd4(0xb1)](messages)),renderMessages();},modal[_0x36be8d(0xc6)][_0x36be8d(0xc8)]('show');}if(clearBtn)clearBtn[a0_0x53663d(0x112)]=()=>{const _0x46e40b=a0_0x53663d;if(!messages[_0x46e40b(0x11c)])return;if(mTitle)mTitle[_0x46e40b(0xc4)]=_0x46e40b(0xf6);if(mText)mText[_0x46e40b(0xc4)]=_0x46e40b(0xd8);modalCallback=async()=>{const _0x40cee2=_0x46e40b;messages=[],localStorage[_0x40cee2(0xa8)](_0x40cee2(0xad)),renderMessages(),callBackend(_0x40cee2(0x100),{});},modal['classList'][_0x46e40b(0xc8)](_0x46e40b(0xbf));};document[a0_0x53663d(0xe4)](a0_0x53663d(0xd9))[a0_0x53663d(0x112)]=()=>modal['classList'][a0_0x53663d(0xe9)](a0_0x53663d(0xbf)),document['getElementById']('modalConfirm')[a0_0x53663d(0x112)]=()=>{const _0x5b80fd=a0_0x53663d;if(modalCallback)modalCallback();modal[_0x5b80fd(0xc6)][_0x5b80fd(0xe9)](_0x5b80fd(0xbf));},messageInput[a0_0x53663d(0x11b)](a0_0x53663d(0x10e),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x53663d(0x11b)](a0_0x53663d(0x10f),_0x3f5d52=>{const _0x55d535=a0_0x53663d;_0x3f5d52[_0x55d535(0x10b)]===_0x55d535(0xb8)&&!_0x3f5d52[_0x55d535(0x120)]&&(_0x3f5d52[_0x55d535(0x119)](),sendMessage());}),sendBtn[a0_0x53663d(0x112)]=sendMessage,document[a0_0x53663d(0x11b)](a0_0x53663d(0x108),_0x34ae10=>{const _0x596ca2=a0_0x53663d;document[_0x596ca2(0xaa)](_0x596ca2(0xc7))[_0x596ca2(0x110)](_0x209b0a=>{const _0x23cb2f=_0x596ca2;if(!_0x209b0a[_0x23cb2f(0xd3)](_0x34ae10[_0x23cb2f(0xd1)]))_0x209b0a[_0x23cb2f(0xc6)]['remove'](_0x23cb2f(0x121));});});const saved=localStorage['getItem'](a0_0x53663d(0xad));function a0_0xcbc8(_0x4fe6af,_0x2b24de){_0x4fe6af=_0x4fe6af-0xa1;const _0x4e1314=a0_0x4706();let _0x31006b=_0x4e1314[_0x4fe6af];return _0x31006b;}if(saved)try{messages=JSON[a0_0x53663d(0xa9)](saved),renderMessages();}catch(a0_0x189e9b){}updateSendButton();