const a0_0x30c52b=a0_0x3984;(function(_0x1e740c,_0x3a2527){const _0x524987=a0_0x3984,_0x5d6099=_0x1e740c();while(!![]){try{const _0x4b2db8=-parseInt(_0x524987(0x7c))/0x1+-parseInt(_0x524987(0x9f))/0x2+-parseInt(_0x524987(0xb1))/0x3*(parseInt(_0x524987(0x99))/0x4)+-parseInt(_0x524987(0xcf))/0x5*(-parseInt(_0x524987(0x8c))/0x6)+-parseInt(_0x524987(0xb8))/0x7+-parseInt(_0x524987(0x97))/0x8*(-parseInt(_0x524987(0x7d))/0x9)+parseInt(_0x524987(0xd0))/0xa*(parseInt(_0x524987(0xa5))/0xb);if(_0x4b2db8===_0x3a2527)break;else _0x5d6099['push'](_0x5d6099['shift']());}catch(_0x286f5d){_0x5d6099['push'](_0x5d6099['shift']());}}}(a0_0x2af4,0x19bae));const tg=window['Telegram']?.[a0_0x30c52b(0x9e)],HOME_URL=a0_0x30c52b(0x81);function setupTelegramBackButton(){const _0x4e0970=a0_0x30c52b;if(!tg)return;try{tg[_0x4e0970(0xda)](),tg[_0x4e0970(0x7a)](),tg['setHeaderColor']?.(_0x4e0970(0x75));if(tg[_0x4e0970(0xa9)]?.(_0x4e0970(0xd9)))tg[_0x4e0970(0xec)]?.();const _0x247d46=tg[_0x4e0970(0xe7)];if(_0x247d46){_0x247d46[_0x4e0970(0xb6)]();if(typeof _0x247d46[_0x4e0970(0x76)]===_0x4e0970(0x90))try{_0x247d46[_0x4e0970(0x76)]();}catch(_0x44ba50){}_0x247d46['onClick'](()=>{const _0x463252=_0x4e0970;if(tg[_0x463252(0xad)])tg[_0x463252(0xad)][_0x463252(0xe0)](_0x463252(0xce));location[_0x463252(0xe1)]=HOME_URL;});}}catch(_0x454caf){console['warn'](_0x4e0970(0x8d),_0x454caf);}}(function initStableLayout(){const _0x399300=a0_0x30c52b,_0x388fd9=(function(){let _0x5a0fd7=!![];return function(_0x3032f3,_0x3b915c){const _0x4fb1ff=_0x5a0fd7?function(){if(_0x3b915c){const _0x275e53=_0x3b915c['apply'](_0x3032f3,arguments);return _0x3b915c=null,_0x275e53;}}:function(){};return _0x5a0fd7=![],_0x4fb1ff;};}()),_0x5bd288=document[_0x399300(0x9a)](_0x399300(0xe4)),_0x28bb87=document[_0x399300(0xe9)]('inputArea'),_0x331509=document[_0x399300(0xe9)](_0x399300(0x93)),_0x3eb843=document[_0x399300(0xe9)](_0x399300(0xe3));function _0xf867cd(){const _0x1a1ff6=_0x399300,_0x470bab=_0x388fd9(this,function(){const _0x5b1562=a0_0x3984;return _0x470bab[_0x5b1562(0x96)]()[_0x5b1562(0xb9)](_0x5b1562(0xac))['toString']()['constructor'](_0x470bab)[_0x5b1562(0xb9)](_0x5b1562(0xac));});_0x470bab();if(!_0x5bd288)return;const _0x204e50=tg&&tg[_0x1a1ff6(0xae)]?tg[_0x1a1ff6(0xae)]:window['innerHeight'];_0x5bd288[_0x1a1ff6(0x8f)][_0x1a1ff6(0xe6)]=_0x204e50+'px';if(_0x28bb87){const _0x49f812=_0x28bb87[_0x1a1ff6(0x79)];_0x331509[_0x1a1ff6(0x8f)][_0x1a1ff6(0xe2)]=_0x49f812+0x28+'px';}}tg?tg[_0x399300(0xb4)]('viewportChanged',({isStateStable:_0x4336d1})=>{_0xf867cd();if(_0x4336d1)requestAnimationFrame(()=>{const _0x4c63c3=a0_0x3984;_0x331509[_0x4c63c3(0xc1)]=_0x331509[_0x4c63c3(0xdc)];});}):window[_0x399300(0x78)](_0x399300(0xed),_0xf867cd),_0xf867cd(),_0x3eb843&&(_0x3eb843[_0x399300(0x78)](_0x399300(0xbc),()=>{requestAnimationFrame(_0xf867cd);}),_0x3eb843['addEventListener'](_0x399300(0x84),()=>{setTimeout(()=>{_0x331509['scrollTop']=_0x331509['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x30c52b(0x93)),emptyState=document['getElementById'](a0_0x30c52b(0xc2)),messageInput=document[a0_0x30c52b(0xe9)](a0_0x30c52b(0xe3)),sendBtn=document['getElementById'](a0_0x30c52b(0xb2)),clearBtn=document[a0_0x30c52b(0xe9)](a0_0x30c52b(0xb7)),modal=document[a0_0x30c52b(0xe9)](a0_0x30c52b(0xe5)),mTitle=document[a0_0x30c52b(0xe9)](a0_0x30c52b(0xc4)),mText=document['getElementById'](a0_0x30c52b(0x73));function a0_0x2af4(){const _0x571509=['9741EjFpfZ','sendBtn','notificationOccurred','onEvent','signal','show','clearBtn','753858rmVVlu','search','add','innerHTML','input','abort','Пустой\x20ответ','from','send_message','scrollTop','emptyState','splice','modalTitle','Начнется\x20новый\x20диалог.','auto','timestamp','onclick','length','trim','medium','content','push','light','5oTsDkc','10YGBgUs','success','querySelectorAll','random','message-bubble','touchstart','click','user','parse','6.1','ready','message\x20ai','scrollHeight','<br>','appendChild','div','impactOccurred','href','paddingBottom','messageInput','.container','confirmModal','height','BackButton','textContent','getElementById','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','display','disableVerticalSwipes','resize','message\x20','stopPropagation','modalText','debug_uid','#050505','offClick','Ошибка\x20сервера','addEventListener','offsetHeight','expand','removeItem','69728MgcXcV','9VJJSkZ','setItem','stringify','value','./router.html','text','className','focus','classList','error','ai_chat_messages','min','now','Удалить?','POST','555486TgIgDP','TG\x20setup\x20error:','clear_history','style','function','modalConfirm','remove','chatArea','padStart','initData','toString','395336ZsJYxa','delete-btn','72HPbjXR','querySelector','getItem','disabled','username','WebApp','313404XkLQsm','children','createElement','Ошибка\x20сети','show-delete','preventDefault','3915582saLYyG','Очистить\x20историю?','text/plain','typingIndicator','isVersionAtLeast','message-time','.message.show-delete','(((.+)+)+)+$','HapticFeedback','viewportHeight','forEach','keydown'];a0_0x2af4=function(){return _0x571509;};return a0_0x2af4();}let modalCallback=null;async function callBackend(_0x1c9ba8,_0x5b0d30){const _0x174559=a0_0x30c52b,_0x56c187=tg?.['initDataUnsafe']?.[_0x174559(0xd7)]||{},_0x23175e=_0x56c187['id']||localStorage['getItem']('debug_uid')||'d-'+Math['floor'](Math[_0x174559(0xd3)]()*0x3b9aca00);if(!_0x56c187['id'])localStorage['setItem'](_0x174559(0x74),_0x23175e);const _0xa3931e={'action':_0x1c9ba8,'user_id':_0x23175e,'user_data':{'first_name':_0x56c187['first_name'],'username':_0x56c187[_0x174559(0x9d)]},'init_data':tg?.[_0x174559(0x95)]||'',..._0x5b0d30},_0x55e6f4=new AbortController(),_0x57049a=setTimeout(()=>_0x55e6f4[_0x174559(0xbd)](),REQUEST_TIMEOUT_MS);try{const _0x1f18ec=await fetch(BACKEND_URL,{'method':_0x174559(0x8b),'headers':{'Content-Type':_0x174559(0xa7)},'body':JSON[_0x174559(0x7f)](_0xa3931e),'signal':_0x55e6f4[_0x174559(0xb5)]});return clearTimeout(_0x57049a),await _0x1f18ec['json']();}catch(_0x531bba){return{'success':![],'error':String(_0x531bba)};}}function formatTime(_0x454096){const _0x1f053c=a0_0x30c52b,_0x24ba69=new Date(_0x454096);return String(_0x24ba69['getHours']())[_0x1f053c(0x94)](0x2,'0')+':'+String(_0x24ba69['getMinutes']())[_0x1f053c(0x94)](0x2,'0');}function createMessageElement(_0x2e7aa2,_0x54b396){const _0x7511f=a0_0x30c52b,_0xca5667=document[_0x7511f(0xa1)](_0x7511f(0xdf));_0xca5667[_0x7511f(0x83)]=_0x7511f(0xee)+_0x2e7aa2['role'];const _0x105274=document[_0x7511f(0xa1)](_0x7511f(0xdf));_0x105274[_0x7511f(0x83)]=_0x7511f(0xd4),_0x105274[_0x7511f(0xbb)]=_0x2e7aa2[_0x7511f(0xcc)]['replace'](/\n/g,_0x7511f(0xdd));const _0x2bf8c4=document[_0x7511f(0xa1)](_0x7511f(0xdf));_0x2bf8c4['className']=_0x7511f(0x98),_0x2bf8c4[_0x7511f(0xbb)]=_0x7511f(0xea),_0x2bf8c4['onclick']=_0x10621e=>{const _0x511fd7=_0x7511f;_0x10621e[_0x511fd7(0xef)](),confirmDelete(_0x54b396);};let _0x2ee2e7;_0x105274[_0x7511f(0x78)](_0x7511f(0xd5),()=>_0x2ee2e7=setTimeout(()=>{const _0x4b4184=_0x7511f;_0xca5667[_0x4b4184(0x85)][_0x4b4184(0xba)](_0x4b4184(0xa3));if(tg?.[_0x4b4184(0xad)])tg[_0x4b4184(0xad)][_0x4b4184(0xe0)](_0x4b4184(0xcb));},0x1f4)),_0x105274[_0x7511f(0x78)]('touchend',()=>clearTimeout(_0x2ee2e7));const _0x5a2213=document[_0x7511f(0xa1)]('div');return _0x5a2213['className']=_0x7511f(0xaa),_0x5a2213[_0x7511f(0xe8)]=formatTime(_0x2e7aa2[_0x7511f(0xc7)]),_0xca5667['appendChild'](_0x2bf8c4),_0xca5667['appendChild'](_0x105274),_0xca5667['appendChild'](_0x5a2213),_0xca5667;}function createTypingIndicator(){const _0x417838=a0_0x30c52b,_0x572da8=document[_0x417838(0xa1)](_0x417838(0xdf));return _0x572da8['className']=_0x417838(0xdb),_0x572da8['id']=_0x417838(0xa8),_0x572da8[_0x417838(0xbb)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x572da8;}function renderMessages(){const _0x100953=a0_0x30c52b;Array[_0x100953(0xbf)](chatArea[_0x100953(0xa0)])[_0x100953(0xaf)](_0x10e01b=>{const _0x27add8=_0x100953;if(_0x10e01b['id']!==_0x27add8(0xc2))_0x10e01b[_0x27add8(0x92)]();}),messages['length']>0x0?(emptyState['style'][_0x100953(0xeb)]='none',messages['forEach']((_0x22390e,_0x48bbe4)=>chatArea[_0x100953(0xde)](createMessageElement(_0x22390e,_0x48bbe4)))):emptyState[_0x100953(0x8f)][_0x100953(0xeb)]='flex',requestAnimationFrame(()=>chatArea[_0x100953(0xc1)]=chatArea[_0x100953(0xdc)]);}function autoResizeTextarea(){const _0x4860f9=a0_0x30c52b;messageInput['style'][_0x4860f9(0xe6)]=_0x4860f9(0xc6),messageInput[_0x4860f9(0x8f)][_0x4860f9(0xe6)]=Math[_0x4860f9(0x88)](messageInput[_0x4860f9(0xdc)],0x78)+'px';}function updateSendButton(){const _0x5c337a=a0_0x30c52b,_0x3a993f=messageInput[_0x5c337a(0x80)][_0x5c337a(0xca)]();sendBtn[_0x5c337a(0x9c)]=!_0x3a993f||isTyping;}async function sendMessage(){const _0xa94cf9=a0_0x30c52b,_0x25a45d=messageInput[_0xa94cf9(0x80)]['trim']();if(!_0x25a45d||isTyping)return;if(tg?.[_0xa94cf9(0xad)])tg[_0xa94cf9(0xad)][_0xa94cf9(0xe0)](_0xa94cf9(0xce));messages[_0xa94cf9(0xcd)]({'role':_0xa94cf9(0xd7),'content':_0x25a45d,'timestamp':Date['now']()}),localStorage[_0xa94cf9(0x7e)](_0xa94cf9(0x87),JSON[_0xa94cf9(0x7f)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xa94cf9(0xde)](createTypingIndicator()),chatArea[_0xa94cf9(0xc1)]=chatArea[_0xa94cf9(0xdc)];const _0x50b3f8=await callBackend(_0xa94cf9(0xc0),{'message':_0x25a45d});isTyping=![];const _0x3c2c7a=document[_0xa94cf9(0xe9)]('typingIndicator');if(_0x3c2c7a)_0x3c2c7a[_0xa94cf9(0x92)]();let _0x1d9b23=_0xa94cf9(0xa2);if(_0x50b3f8[_0xa94cf9(0xd1)]){_0x1d9b23=_0x50b3f8[_0xa94cf9(0x82)]||_0xa94cf9(0xbe);if(tg?.[_0xa94cf9(0xad)])tg['HapticFeedback'][_0xa94cf9(0xb3)](_0xa94cf9(0xd1));}else{_0x1d9b23=_0x50b3f8[_0xa94cf9(0x86)]||_0xa94cf9(0x77);if(tg?.[_0xa94cf9(0xad)])tg[_0xa94cf9(0xad)][_0xa94cf9(0xb3)](_0xa94cf9(0x86));}messages[_0xa94cf9(0xcd)]({'role':'ai','content':_0x1d9b23,'timestamp':Date[_0xa94cf9(0x89)]()}),localStorage[_0xa94cf9(0x7e)](_0xa94cf9(0x87),JSON[_0xa94cf9(0x7f)](messages)),renderMessages();}function a0_0x3984(_0x3a1968,_0x34cb6e){_0x3a1968=_0x3a1968-0x73;const _0xbb3adf=a0_0x2af4();let _0x360e03=_0xbb3adf[_0x3a1968];return _0x360e03;}function confirmDelete(_0x4d81b8){const _0x1a2c73=a0_0x30c52b;if(mTitle)mTitle[_0x1a2c73(0xe8)]=_0x1a2c73(0x8a);if(mText)mText[_0x1a2c73(0xe8)]='Действие\x20необратимо.';modalCallback=()=>{const _0x48abda=_0x1a2c73;messages[_0x48abda(0xc3)](_0x4d81b8,0x1),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x1a2c73(0xba)](_0x1a2c73(0xb6));}if(clearBtn)clearBtn['onclick']=()=>{const _0x5a2cac=a0_0x30c52b;if(!messages[_0x5a2cac(0xc9)])return;if(mTitle)mTitle[_0x5a2cac(0xe8)]=_0x5a2cac(0xa6);if(mText)mText[_0x5a2cac(0xe8)]=_0x5a2cac(0xc5);modalCallback=async()=>{const _0x14e084=_0x5a2cac;messages=[],localStorage[_0x14e084(0x7b)](_0x14e084(0x87)),renderMessages(),callBackend(_0x14e084(0x8e),{});},modal[_0x5a2cac(0x85)][_0x5a2cac(0xba)]('show');};document['getElementById']('modalCancel')[a0_0x30c52b(0xc8)]=()=>modal[a0_0x30c52b(0x85)]['remove']('show'),document['getElementById'](a0_0x30c52b(0x91))['onclick']=()=>{const _0x29d903=a0_0x30c52b;if(modalCallback)modalCallback();modal['classList']['remove'](_0x29d903(0xb6));},messageInput[a0_0x30c52b(0x78)](a0_0x30c52b(0xbc),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x30c52b(0x78)](a0_0x30c52b(0xb0),_0x110b2d=>{const _0x409065=a0_0x30c52b;_0x110b2d['key']==='Enter'&&!_0x110b2d['shiftKey']&&(_0x110b2d[_0x409065(0xa4)](),sendMessage());}),sendBtn[a0_0x30c52b(0xc8)]=sendMessage,document[a0_0x30c52b(0x78)](a0_0x30c52b(0xd6),_0x5951ad=>{const _0x187b9c=a0_0x30c52b;document[_0x187b9c(0xd2)](_0x187b9c(0xab))[_0x187b9c(0xaf)](_0x365392=>{const _0x55f511=_0x187b9c;if(!_0x365392['contains'](_0x5951ad['target']))_0x365392[_0x55f511(0x85)][_0x55f511(0x92)](_0x55f511(0xa3));});});const saved=localStorage[a0_0x30c52b(0x9b)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x30c52b(0xd8)](saved),renderMessages();}catch(a0_0x1ec7b6){}updateSendButton();