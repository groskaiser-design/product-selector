const a0_0x4d98d1=a0_0x544a;(function(_0x47d4b3,_0x48d009){const _0xdc52bc=a0_0x544a,_0x4abf18=_0x47d4b3();while(!![]){try{const _0x58b800=-parseInt(_0xdc52bc(0x166))/0x1+parseInt(_0xdc52bc(0x121))/0x2+parseInt(_0xdc52bc(0x118))/0x3+parseInt(_0xdc52bc(0x12a))/0x4+-parseInt(_0xdc52bc(0x101))/0x5+parseInt(_0xdc52bc(0x171))/0x6*(-parseInt(_0xdc52bc(0x11b))/0x7)+parseInt(_0xdc52bc(0x163))/0x8*(parseInt(_0xdc52bc(0x16a))/0x9);if(_0x58b800===_0x48d009)break;else _0x4abf18['push'](_0x4abf18['shift']());}catch(_0x1bf62b){_0x4abf18['push'](_0x4abf18['shift']());}}}(a0_0x2ec0,0x24d04));const tg=window['Telegram']?.[a0_0x4d98d1(0xfe)],HOME_URL=a0_0x4d98d1(0x13a);function setupTelegramBackButton(){const _0x5ab2b8=a0_0x4d98d1,_0x10a281=(function(){let _0x370d78=!![];return function(_0x489e8c,_0x2714de){const _0xb549ad=_0x370d78?function(){const _0x3112e5=a0_0x544a;if(_0x2714de){const _0x35970d=_0x2714de[_0x3112e5(0x158)](_0x489e8c,arguments);return _0x2714de=null,_0x35970d;}}:function(){};return _0x370d78=![],_0xb549ad;};}()),_0x1e0841=_0x10a281(this,function(){const _0x473f66=a0_0x544a;return _0x1e0841[_0x473f66(0x179)]()['search'](_0x473f66(0x11c))[_0x473f66(0x179)]()['constructor'](_0x1e0841)['search'](_0x473f66(0x11c));});_0x1e0841();if(!tg)return;try{tg['ready'](),tg[_0x5ab2b8(0x135)](),tg[_0x5ab2b8(0x176)]?.(_0x5ab2b8(0x140));if(tg[_0x5ab2b8(0x154)]?.(_0x5ab2b8(0x124)))tg[_0x5ab2b8(0x109)]?.();const _0x3c850b=tg[_0x5ab2b8(0x14b)];if(_0x3c850b){_0x3c850b['show']();if(typeof _0x3c850b[_0x5ab2b8(0x14a)]===_0x5ab2b8(0x173))try{_0x3c850b['offClick']();}catch(_0x358c98){}_0x3c850b[_0x5ab2b8(0x127)](()=>{const _0x172476=_0x5ab2b8;if(tg['HapticFeedback'])tg[_0x172476(0x136)][_0x172476(0x164)](_0x172476(0x15f));location['href']=HOME_URL;});}}catch(_0x4ef081){console['warn'](_0x5ab2b8(0x115),_0x4ef081);}}(function initStableLayout(){const _0x5c4f86=a0_0x4d98d1,_0x50c16f=document[_0x5c4f86(0x10c)](_0x5c4f86(0x14d)),_0x902c73=document[_0x5c4f86(0x139)](_0x5c4f86(0x12d)),_0x5ca12f=document[_0x5c4f86(0x139)](_0x5c4f86(0x156)),_0x43356e=document[_0x5c4f86(0x139)]('messageInput');function _0x2bfbe3(){const _0x26d1dc=_0x5c4f86;if(!_0x50c16f)return;const _0xaaf10a=tg&&tg['viewportHeight']?tg[_0x26d1dc(0x108)]:window[_0x26d1dc(0x11d)];_0x50c16f[_0x26d1dc(0x16d)][_0x26d1dc(0x117)]=_0xaaf10a+'px';if(_0x902c73){const _0x583c33=_0x902c73['offsetHeight'];_0x5ca12f[_0x26d1dc(0x16d)][_0x26d1dc(0x143)]=_0x583c33+0x28+'px';}}tg?tg['onEvent'](_0x5c4f86(0x102),({isStateStable:_0x2c20c8})=>{_0x2bfbe3();if(_0x2c20c8)requestAnimationFrame(()=>{const _0x184568=a0_0x544a;_0x5ca12f[_0x184568(0x132)]=_0x5ca12f[_0x184568(0xff)];});}):window['addEventListener'](_0x5c4f86(0x149),_0x2bfbe3),_0x2bfbe3(),_0x43356e&&(_0x43356e['addEventListener'](_0x5c4f86(0x157),()=>{requestAnimationFrame(_0x2bfbe3);}),_0x43356e[_0x5c4f86(0x151)](_0x5c4f86(0x15a),()=>{setTimeout(()=>{const _0x2f1b59=a0_0x544a;_0x5ca12f['scrollTop']=_0x5ca12f[_0x2f1b59(0xff)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4d98d1(0x12e),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x544a(_0x3c9ec7,_0x1cda3d){_0x3c9ec7=_0x3c9ec7-0xfd;const _0x53ef0d=a0_0x2ec0();let _0x387a75=_0x53ef0d[_0x3c9ec7];return _0x387a75;}const chatArea=document[a0_0x4d98d1(0x139)](a0_0x4d98d1(0x156)),emptyState=document[a0_0x4d98d1(0x139)](a0_0x4d98d1(0x14c)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x4d98d1(0x139)]('sendBtn'),clearBtn=document[a0_0x4d98d1(0x139)](a0_0x4d98d1(0x104)),modal=document[a0_0x4d98d1(0x139)](a0_0x4d98d1(0x100)),mTitle=document['getElementById']('modalTitle'),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x14cc87,_0x5ccbaf){const _0xa7c94c=a0_0x4d98d1,_0x149889=tg?.[_0xa7c94c(0x14e)]?.[_0xa7c94c(0x125)]||{},_0x1ef7a1=_0x149889['id']||localStorage[_0xa7c94c(0xfd)]('debug_uid')||'d-'+Math[_0xa7c94c(0x130)](Math[_0xa7c94c(0x103)]()*0x3b9aca00);if(!_0x149889['id'])localStorage[_0xa7c94c(0x12c)](_0xa7c94c(0x159),_0x1ef7a1);const _0x23b418={'action':_0x14cc87,'user_id':_0x1ef7a1,'user_data':{'first_name':_0x149889[_0xa7c94c(0x16c)],'username':_0x149889['username']},'init_data':tg?.[_0xa7c94c(0x12b)]||'',..._0x5ccbaf},_0x482a22=new AbortController(),_0x5f3d13=setTimeout(()=>_0x482a22[_0xa7c94c(0x153)](),REQUEST_TIMEOUT_MS);try{const _0x5ad516=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0xa7c94c(0x16e)},'body':JSON['stringify'](_0x23b418),'signal':_0x482a22[_0xa7c94c(0x16f)]});return clearTimeout(_0x5f3d13),await _0x5ad516[_0xa7c94c(0x128)]();}catch(_0x549d3d){return{'success':![],'error':String(_0x549d3d)};}}function formatTime(_0x12bf66){const _0x45a8ab=a0_0x4d98d1,_0x23db54=new Date(_0x12bf66);return String(_0x23db54[_0x45a8ab(0x106)]())['padStart'](0x2,'0')+':'+String(_0x23db54[_0x45a8ab(0x144)]())[_0x45a8ab(0x116)](0x2,'0');}function a0_0x2ec0(){const _0x54f0e3=['apply','debug_uid','focus','error','typingIndicator','removeItem','value','light','forEach','medium','children','4064SRtWHJ','impactOccurred','<br>','237571vAJkdV','show-delete','text','Ошибка\x20сети','3213zUIjrh','stopPropagation','first_name','style','text/plain','signal','show','312WnKWIy','min','function','send_message','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','setHeaderColor','delete-btn','preventDefault','toString','getItem','WebApp','scrollHeight','confirmModal','417275WckmUS','viewportChanged','random','clearBtn','length','getHours','Очистить\x20историю?','viewportHeight','disableVerticalSwipes','shiftKey','clear_history','querySelector','className','role','onclick','.message.show-delete','Удалить?','target','parse','now','TG\x20setup\x20error:','padStart','height','631776xIOCDX','display','none','20118awLAtL','(((.+)+)+)+$','innerHeight','createElement','remove','message-bubble','25316gIlioJ','modalCancel','Начнется\x20новый\x20диалог.','6.1','user','stringify','onClick','json','appendChild','866624JcSwHv','initData','setItem','inputArea','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','notificationOccurred','floor','querySelectorAll','scrollTop','push','click','expand','HapticFeedback','add','textContent','getElementById','./router.html','Действие\x20необратимо.','innerHTML','flex','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','key','#050505','timestamp','success','paddingBottom','getMinutes','message\x20','from','classList','touchend','resize','offClick','BackButton','emptyState','.container','initDataUnsafe','div','content','addEventListener','ai_chat_messages','abort','isVersionAtLeast','contains','chatArea','input'];a0_0x2ec0=function(){return _0x54f0e3;};return a0_0x2ec0();}function createMessageElement(_0xb83730,_0x4a8b63){const _0x252974=a0_0x4d98d1,_0x1f3eb9=document[_0x252974(0x11e)]('div');_0x1f3eb9[_0x252974(0x10d)]=_0x252974(0x145)+_0xb83730[_0x252974(0x10e)];const _0x4849a9=document[_0x252974(0x11e)]('div');_0x4849a9[_0x252974(0x10d)]=_0x252974(0x120),_0x4849a9[_0x252974(0x13c)]=_0xb83730[_0x252974(0x150)]['replace'](/\n/g,_0x252974(0x165));const _0x4aaa2e=document[_0x252974(0x11e)](_0x252974(0x14f));_0x4aaa2e['className']=_0x252974(0x177),_0x4aaa2e[_0x252974(0x13c)]=_0x252974(0x175),_0x4aaa2e[_0x252974(0x10f)]=_0x756a9d=>{const _0x5d8562=_0x252974;_0x756a9d[_0x5d8562(0x16b)](),confirmDelete(_0x4a8b63);};let _0x3f38d8;_0x4849a9[_0x252974(0x151)]('touchstart',()=>_0x3f38d8=setTimeout(()=>{const _0x3df707=_0x252974;_0x1f3eb9[_0x3df707(0x147)][_0x3df707(0x137)](_0x3df707(0x167));if(tg?.['HapticFeedback'])tg['HapticFeedback']['impactOccurred'](_0x3df707(0x161));},0x1f4)),_0x4849a9['addEventListener'](_0x252974(0x148),()=>clearTimeout(_0x3f38d8));const _0x7e9dc3=document['createElement'](_0x252974(0x14f));return _0x7e9dc3[_0x252974(0x10d)]='message-time',_0x7e9dc3[_0x252974(0x138)]=formatTime(_0xb83730[_0x252974(0x141)]),_0x1f3eb9[_0x252974(0x129)](_0x4aaa2e),_0x1f3eb9['appendChild'](_0x4849a9),_0x1f3eb9['appendChild'](_0x7e9dc3),_0x1f3eb9;}function createTypingIndicator(){const _0x183aff=a0_0x4d98d1,_0x58592c=document['createElement'](_0x183aff(0x14f));return _0x58592c['className']='message\x20ai',_0x58592c['id']=_0x183aff(0x15c),_0x58592c['innerHTML']=_0x183aff(0x13e),_0x58592c;}function renderMessages(){const _0x14064b=a0_0x4d98d1;Array[_0x14064b(0x146)](chatArea[_0x14064b(0x162)])[_0x14064b(0x160)](_0x48f533=>{const _0x138784=_0x14064b;if(_0x48f533['id']!==_0x138784(0x14c))_0x48f533['remove']();}),messages[_0x14064b(0x105)]>0x0?(emptyState[_0x14064b(0x16d)][_0x14064b(0x119)]=_0x14064b(0x11a),messages[_0x14064b(0x160)]((_0x1de2d2,_0x4e8264)=>chatArea[_0x14064b(0x129)](createMessageElement(_0x1de2d2,_0x4e8264)))):emptyState[_0x14064b(0x16d)][_0x14064b(0x119)]=_0x14064b(0x13d),requestAnimationFrame(()=>chatArea[_0x14064b(0x132)]=chatArea[_0x14064b(0xff)]);}function autoResizeTextarea(){const _0x49cd9f=a0_0x4d98d1;messageInput['style'][_0x49cd9f(0x117)]='auto',messageInput['style'][_0x49cd9f(0x117)]=Math[_0x49cd9f(0x172)](messageInput[_0x49cd9f(0xff)],0x78)+'px';}function updateSendButton(){const _0x11a12e=messageInput['value']['trim']();sendBtn['disabled']=!_0x11a12e||isTyping;}async function sendMessage(){const _0x19e084=a0_0x4d98d1,_0x13b1bd=messageInput['value']['trim']();if(!_0x13b1bd||isTyping)return;if(tg?.[_0x19e084(0x136)])tg[_0x19e084(0x136)][_0x19e084(0x164)](_0x19e084(0x15f));messages[_0x19e084(0x133)]({'role':_0x19e084(0x125),'content':_0x13b1bd,'timestamp':Date['now']()}),localStorage[_0x19e084(0x12c)]('ai_chat_messages',JSON[_0x19e084(0x126)](messages)),renderMessages(),messageInput[_0x19e084(0x15e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x19e084(0x129)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x19e084(0xff)];const _0x3bca59=await callBackend(_0x19e084(0x174),{'message':_0x13b1bd});isTyping=![];const _0x52e424=document['getElementById']('typingIndicator');if(_0x52e424)_0x52e424['remove']();let _0x4b6930=_0x19e084(0x169);if(_0x3bca59[_0x19e084(0x142)]){_0x4b6930=_0x3bca59[_0x19e084(0x168)]||'Пустой\x20ответ';if(tg?.[_0x19e084(0x136)])tg[_0x19e084(0x136)][_0x19e084(0x12f)](_0x19e084(0x142));}else{_0x4b6930=_0x3bca59[_0x19e084(0x15b)]||'Ошибка\x20сервера';if(tg?.[_0x19e084(0x136)])tg['HapticFeedback'][_0x19e084(0x12f)](_0x19e084(0x15b));}messages[_0x19e084(0x133)]({'role':'ai','content':_0x4b6930,'timestamp':Date[_0x19e084(0x114)]()}),localStorage[_0x19e084(0x12c)](_0x19e084(0x152),JSON[_0x19e084(0x126)](messages)),renderMessages();}function confirmDelete(_0x34c1e1){const _0x71cab0=a0_0x4d98d1;if(mTitle)mTitle[_0x71cab0(0x138)]=_0x71cab0(0x111);if(mText)mText['textContent']=_0x71cab0(0x13b);modalCallback=()=>{const _0x26dec7=_0x71cab0;messages['splice'](_0x34c1e1,0x1),localStorage['setItem'](_0x26dec7(0x152),JSON['stringify'](messages)),renderMessages();},modal[_0x71cab0(0x147)]['add'](_0x71cab0(0x170));}if(clearBtn)clearBtn[a0_0x4d98d1(0x10f)]=()=>{const _0x57bf98=a0_0x4d98d1;if(!messages[_0x57bf98(0x105)])return;if(mTitle)mTitle['textContent']=_0x57bf98(0x107);if(mText)mText[_0x57bf98(0x138)]=_0x57bf98(0x123);modalCallback=async()=>{const _0x469f88=_0x57bf98;messages=[],localStorage[_0x469f88(0x15d)](_0x469f88(0x152)),renderMessages(),callBackend(_0x469f88(0x10b),{});},modal[_0x57bf98(0x147)][_0x57bf98(0x137)](_0x57bf98(0x170));};document['getElementById'](a0_0x4d98d1(0x122))['onclick']=()=>modal[a0_0x4d98d1(0x147)][a0_0x4d98d1(0x11f)]('show'),document['getElementById']('modalConfirm')['onclick']=()=>{const _0x50e846=a0_0x4d98d1;if(modalCallback)modalCallback();modal[_0x50e846(0x147)][_0x50e846(0x11f)](_0x50e846(0x170));},messageInput[a0_0x4d98d1(0x151)](a0_0x4d98d1(0x157),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4d98d1(0x151)]('keydown',_0x34c335=>{const _0x20baee=a0_0x4d98d1;_0x34c335[_0x20baee(0x13f)]==='Enter'&&!_0x34c335[_0x20baee(0x10a)]&&(_0x34c335[_0x20baee(0x178)](),sendMessage());}),sendBtn[a0_0x4d98d1(0x10f)]=sendMessage,document[a0_0x4d98d1(0x151)](a0_0x4d98d1(0x134),_0x321fcf=>{const _0x32f4a7=a0_0x4d98d1;document[_0x32f4a7(0x131)](_0x32f4a7(0x110))['forEach'](_0x27fb45=>{const _0x190285=_0x32f4a7;if(!_0x27fb45[_0x190285(0x155)](_0x321fcf[_0x190285(0x112)]))_0x27fb45['classList'][_0x190285(0x11f)](_0x190285(0x167));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x4d98d1(0x113)](saved),renderMessages();}catch(a0_0x1ec82a){}updateSendButton();