const a0_0x55566c=a0_0x5ce4;function a0_0x5ce4(_0x55d808,_0x26c794){_0x55d808=_0x55d808-0xec;const _0x1a67bc=a0_0x3efd();let _0xdaf3e7=_0x1a67bc[_0x55d808];return _0xdaf3e7;}(function(_0x399017,_0x2fae9a){const _0x14d2f8=a0_0x5ce4,_0x27997c=_0x399017();while(!![]){try{const _0x1b41a5=-parseInt(_0x14d2f8(0x14e))/0x1+parseInt(_0x14d2f8(0x143))/0x2*(-parseInt(_0x14d2f8(0x156))/0x3)+-parseInt(_0x14d2f8(0x103))/0x4*(parseInt(_0x14d2f8(0x140))/0x5)+-parseInt(_0x14d2f8(0x155))/0x6*(-parseInt(_0x14d2f8(0x152))/0x7)+-parseInt(_0x14d2f8(0xf4))/0x8+parseInt(_0x14d2f8(0x113))/0x9*(-parseInt(_0x14d2f8(0x105))/0xa)+parseInt(_0x14d2f8(0xf2))/0xb;if(_0x1b41a5===_0x2fae9a)break;else _0x27997c['push'](_0x27997c['shift']());}catch(_0x30e1e5){_0x27997c['push'](_0x27997c['shift']());}}}(a0_0x3efd,0x2b9eb));const tg=window[a0_0x55566c(0x15c)]?.['WebApp'],HOME_URL=a0_0x55566c(0x151);function setupTelegramBackButton(){const _0x173aad=a0_0x55566c;if(!tg)return;try{tg[_0x173aad(0x147)](),tg[_0x173aad(0xf7)](),tg['setHeaderColor']?.('#050505');if(tg['isVersionAtLeast']?.(_0x173aad(0x12f)))tg['disableVerticalSwipes']?.();const _0x345c07=tg[_0x173aad(0x14c)];if(_0x345c07){_0x345c07[_0x173aad(0x157)]();if(typeof _0x345c07[_0x173aad(0x169)]===_0x173aad(0x110))try{_0x345c07['offClick']();}catch(_0x36c9dd){}_0x345c07[_0x173aad(0x162)](()=>{const _0x477dcc=_0x173aad;if(tg[_0x477dcc(0x163)])tg[_0x477dcc(0x163)]['impactOccurred'](_0x477dcc(0x111));location[_0x477dcc(0x165)]=HOME_URL;});}}catch(_0x5609fb){console['warn'](_0x173aad(0x148),_0x5609fb);}}(function initStableLayout(){const _0x5e009b=a0_0x55566c,_0x5abe5c=(function(){let _0x325eee=!![];return function(_0xda371c,_0x315fbe){const _0x4372c7=_0x325eee?function(){if(_0x315fbe){const _0x574954=_0x315fbe['apply'](_0xda371c,arguments);return _0x315fbe=null,_0x574954;}}:function(){};return _0x325eee=![],_0x4372c7;};}()),_0x306b62=document[_0x5e009b(0xec)]('.container'),_0x1647e0=document[_0x5e009b(0xef)]('inputArea'),_0x1a46c7=document[_0x5e009b(0xef)]('chatArea'),_0x4c1174=document['getElementById']('messageInput');function _0x11e0f7(){const _0x15fa38=_0x5e009b,_0x226c2e=_0x5abe5c(this,function(){const _0x3bbfc8=a0_0x5ce4;return _0x226c2e[_0x3bbfc8(0x128)]()[_0x3bbfc8(0x108)](_0x3bbfc8(0x158))[_0x3bbfc8(0x128)]()[_0x3bbfc8(0x130)](_0x226c2e)['search']('(((.+)+)+)+$');});_0x226c2e();if(!_0x306b62)return;const _0xfb01ef=tg&&tg[_0x15fa38(0x14a)]?tg[_0x15fa38(0x14a)]:window[_0x15fa38(0x11b)];_0x306b62['style']['height']=_0xfb01ef+'px';if(_0x1647e0){const _0x5683c6=_0x1647e0[_0x15fa38(0x135)];_0x1a46c7['style'][_0x15fa38(0x142)]=_0x5683c6+0x28+'px';}}tg?tg[_0x5e009b(0xfb)]('viewportChanged',({isStateStable:_0x4e5ced})=>{_0x11e0f7();if(_0x4e5ced)requestAnimationFrame(()=>{const _0xa9dbeb=a0_0x5ce4;_0x1a46c7[_0xa9dbeb(0x116)]=_0x1a46c7[_0xa9dbeb(0x115)];});}):window['addEventListener'](_0x5e009b(0xfa),_0x11e0f7),_0x11e0f7(),_0x4c1174&&(_0x4c1174[_0x5e009b(0x123)](_0x5e009b(0x10a),()=>{requestAnimationFrame(_0x11e0f7);}),_0x4c1174[_0x5e009b(0x123)](_0x5e009b(0x11e),()=>{setTimeout(()=>{const _0x16b61e=a0_0x5ce4;_0x1a46c7[_0x16b61e(0x116)]=_0x1a46c7[_0x16b61e(0x115)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x55566c(0x12a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x55566c(0xef)](a0_0x55566c(0x13a)),emptyState=document[a0_0x55566c(0xef)](a0_0x55566c(0x138)),messageInput=document[a0_0x55566c(0xef)](a0_0x55566c(0xee)),sendBtn=document[a0_0x55566c(0xef)]('sendBtn'),clearBtn=document[a0_0x55566c(0xef)](a0_0x55566c(0x100)),modal=document[a0_0x55566c(0xef)](a0_0x55566c(0x133)),mTitle=document[a0_0x55566c(0xef)](a0_0x55566c(0x150)),mText=document['getElementById'](a0_0x55566c(0x120));let modalCallback=null;async function callBackend(_0x19ee0f,_0x582b9c){const _0x4c2541=a0_0x55566c,_0x2370ac=tg?.[_0x4c2541(0x154)]?.[_0x4c2541(0x139)]||{},_0x1e43d1=_0x2370ac['id']||localStorage['getItem'](_0x4c2541(0x119))||'d-'+Math['floor'](Math[_0x4c2541(0x127)]()*0x3b9aca00);if(!_0x2370ac['id'])localStorage[_0x4c2541(0x13f)](_0x4c2541(0x119),_0x1e43d1);const _0x132a14={'action':_0x19ee0f,'user_id':_0x1e43d1,'user_data':{'first_name':_0x2370ac['first_name'],'username':_0x2370ac[_0x4c2541(0x149)]},'init_data':tg?.[_0x4c2541(0x129)]||'',..._0x582b9c},_0x17c43d=new AbortController(),_0x1f8af5=setTimeout(()=>_0x17c43d['abort'](),REQUEST_TIMEOUT_MS);try{const _0x181e10=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x4c2541(0x12c)},'body':JSON['stringify'](_0x132a14),'signal':_0x17c43d[_0x4c2541(0x125)]});return clearTimeout(_0x1f8af5),await _0x181e10[_0x4c2541(0x124)]();}catch(_0x3caeee){return{'success':![],'error':String(_0x3caeee)};}}function formatTime(_0x170eff){const _0x1bd896=a0_0x55566c,_0xeb083e=new Date(_0x170eff);return String(_0xeb083e[_0x1bd896(0x146)]())[_0x1bd896(0x10c)](0x2,'0')+':'+String(_0xeb083e[_0x1bd896(0x10b)]())[_0x1bd896(0x10c)](0x2,'0');}function createMessageElement(_0x1e145a,_0x275a97){const _0x1b1ba2=a0_0x55566c,_0x12f139=document[_0x1b1ba2(0x14b)](_0x1b1ba2(0x15d));_0x12f139[_0x1b1ba2(0x160)]=_0x1b1ba2(0x12e)+_0x1e145a[_0x1b1ba2(0x11c)];const _0x35ae13=document[_0x1b1ba2(0x14b)](_0x1b1ba2(0x15d));_0x35ae13[_0x1b1ba2(0x160)]='message-bubble',_0x35ae13[_0x1b1ba2(0x15f)]=_0x1e145a[_0x1b1ba2(0x106)]['replace'](/\n/g,'<br>');const _0x4a4139=document[_0x1b1ba2(0x14b)]('div');_0x4a4139[_0x1b1ba2(0x160)]='delete-btn',_0x4a4139['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x4a4139[_0x1b1ba2(0x121)]=_0x519a68=>{const _0x12da57=_0x1b1ba2;_0x519a68[_0x12da57(0x15b)](),confirmDelete(_0x275a97);};let _0x1ec985;_0x35ae13['addEventListener'](_0x1b1ba2(0x144),()=>_0x1ec985=setTimeout(()=>{const _0x36057d=_0x1b1ba2;_0x12f139['classList'][_0x36057d(0x167)](_0x36057d(0xf8));if(tg?.[_0x36057d(0x163)])tg[_0x36057d(0x163)]['impactOccurred'](_0x36057d(0x134));},0x1f4)),_0x35ae13['addEventListener'](_0x1b1ba2(0x10f),()=>clearTimeout(_0x1ec985));const _0xd1e632=document[_0x1b1ba2(0x14b)](_0x1b1ba2(0x15d));return _0xd1e632[_0x1b1ba2(0x160)]=_0x1b1ba2(0x12b),_0xd1e632[_0x1b1ba2(0x137)]=formatTime(_0x1e145a['timestamp']),_0x12f139[_0x1b1ba2(0x11a)](_0x4a4139),_0x12f139[_0x1b1ba2(0x11a)](_0x35ae13),_0x12f139[_0x1b1ba2(0x11a)](_0xd1e632),_0x12f139;}function createTypingIndicator(){const _0x4243ea=a0_0x55566c,_0x7d1d23=document[_0x4243ea(0x14b)](_0x4243ea(0x15d));return _0x7d1d23[_0x4243ea(0x160)]=_0x4243ea(0x10e),_0x7d1d23['id']=_0x4243ea(0x117),_0x7d1d23[_0x4243ea(0x15f)]=_0x4243ea(0xf9),_0x7d1d23;}function renderMessages(){const _0x339bf3=a0_0x55566c;Array[_0x339bf3(0x104)](chatArea[_0x339bf3(0xed)])[_0x339bf3(0x131)](_0x5c20b8=>{const _0x264a09=_0x339bf3;if(_0x5c20b8['id']!==_0x264a09(0x138))_0x5c20b8[_0x264a09(0x126)]();}),messages[_0x339bf3(0xf3)]>0x0?(emptyState[_0x339bf3(0x101)][_0x339bf3(0xff)]=_0x339bf3(0x14f),messages[_0x339bf3(0x131)]((_0x142707,_0xec744)=>chatArea[_0x339bf3(0x11a)](createMessageElement(_0x142707,_0xec744)))):emptyState[_0x339bf3(0x101)][_0x339bf3(0xff)]='flex',requestAnimationFrame(()=>chatArea[_0x339bf3(0x116)]=chatArea[_0x339bf3(0x115)]);}function a0_0x3efd(){const _0x447573=['initDataUnsafe','5862VzOBRB','6Llshmh','show','(((.+)+)+)+$','disabled','removeItem','stopPropagation','Telegram','div','stringify','innerHTML','className','key','onClick','HapticFeedback','splice','href','parse','add','Начнется\x20новый\x20диалог.','offClick','querySelector','children','messageInput','getElementById','notificationOccurred','error','11226688XDftlh','length','2651936pLdwIM','keydown','preventDefault','expand','show-delete','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','resize','onEvent','classList','now','min','display','clearBtn','style','.message.show-delete','4IUAYFM','from','460710dPRLUe','content','modalCancel','search','Ошибка\x20сервера','input','getMinutes','padStart','auto','message\x20ai','touchend','function','light','Пустой\x20ответ','27aWTghv','contains','scrollHeight','scrollTop','typingIndicator','modalConfirm','debug_uid','appendChild','innerHeight','role','querySelectorAll','focus','impactOccurred','modalText','onclick','Удалить?','addEventListener','json','signal','remove','random','toString','initData','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','message-time','text/plain','ai_chat_messages','message\x20','6.1','constructor','forEach','clear_history','confirmModal','medium','offsetHeight','height','textContent','emptyState','user','chatArea','push','Ошибка\x20сети','success','text','setItem','918665wwGrCK','send_message','paddingBottom','66824DjNGDy','touchstart','target','getHours','ready','TG\x20setup\x20error:','username','viewportHeight','createElement','BackButton','Действие\x20необратимо.','329780OcIcLL','none','modalTitle','./router.html','1491TTeeBN','value'];a0_0x3efd=function(){return _0x447573;};return a0_0x3efd();}function autoResizeTextarea(){const _0x38093c=a0_0x55566c;messageInput[_0x38093c(0x101)][_0x38093c(0x136)]=_0x38093c(0x10d),messageInput[_0x38093c(0x101)][_0x38093c(0x136)]=Math[_0x38093c(0xfe)](messageInput[_0x38093c(0x115)],0x78)+'px';}function updateSendButton(){const _0x1fda76=a0_0x55566c,_0x2b3ee1=messageInput[_0x1fda76(0x153)]['trim']();sendBtn[_0x1fda76(0x159)]=!_0x2b3ee1||isTyping;}async function sendMessage(){const _0xcc4eed=a0_0x55566c,_0x1d3eb5=messageInput[_0xcc4eed(0x153)]['trim']();if(!_0x1d3eb5||isTyping)return;if(tg?.[_0xcc4eed(0x163)])tg[_0xcc4eed(0x163)][_0xcc4eed(0x11f)](_0xcc4eed(0x111));messages[_0xcc4eed(0x13b)]({'role':'user','content':_0x1d3eb5,'timestamp':Date[_0xcc4eed(0xfd)]()}),localStorage[_0xcc4eed(0x13f)]('ai_chat_messages',JSON[_0xcc4eed(0x15e)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xcc4eed(0x11a)](createTypingIndicator()),chatArea[_0xcc4eed(0x116)]=chatArea['scrollHeight'];const _0x4c12bc=await callBackend(_0xcc4eed(0x141),{'message':_0x1d3eb5});isTyping=![];const _0x5533ff=document[_0xcc4eed(0xef)](_0xcc4eed(0x117));if(_0x5533ff)_0x5533ff[_0xcc4eed(0x126)]();let _0xf6e443=_0xcc4eed(0x13c);if(_0x4c12bc[_0xcc4eed(0x13d)]){_0xf6e443=_0x4c12bc[_0xcc4eed(0x13e)]||_0xcc4eed(0x112);if(tg?.[_0xcc4eed(0x163)])tg[_0xcc4eed(0x163)][_0xcc4eed(0xf0)](_0xcc4eed(0x13d));}else{_0xf6e443=_0x4c12bc['error']||_0xcc4eed(0x109);if(tg?.[_0xcc4eed(0x163)])tg[_0xcc4eed(0x163)][_0xcc4eed(0xf0)](_0xcc4eed(0xf1));}messages['push']({'role':'ai','content':_0xf6e443,'timestamp':Date['now']()}),localStorage[_0xcc4eed(0x13f)](_0xcc4eed(0x12d),JSON[_0xcc4eed(0x15e)](messages)),renderMessages();}function confirmDelete(_0x2a9390){const _0x315c4c=a0_0x55566c;if(mTitle)mTitle[_0x315c4c(0x137)]=_0x315c4c(0x122);if(mText)mText[_0x315c4c(0x137)]=_0x315c4c(0x14d);modalCallback=()=>{const _0x192c91=_0x315c4c;messages[_0x192c91(0x164)](_0x2a9390,0x1),localStorage['setItem'](_0x192c91(0x12d),JSON[_0x192c91(0x15e)](messages)),renderMessages();},modal[_0x315c4c(0xfc)][_0x315c4c(0x167)](_0x315c4c(0x157));}if(clearBtn)clearBtn[a0_0x55566c(0x121)]=()=>{const _0x236041=a0_0x55566c;if(!messages[_0x236041(0xf3)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText['textContent']=_0x236041(0x168);modalCallback=async()=>{const _0x573a6a=_0x236041;messages=[],localStorage[_0x573a6a(0x15a)](_0x573a6a(0x12d)),renderMessages(),callBackend(_0x573a6a(0x132),{});},modal[_0x236041(0xfc)][_0x236041(0x167)]('show');};document['getElementById'](a0_0x55566c(0x107))['onclick']=()=>modal[a0_0x55566c(0xfc)]['remove']('show'),document[a0_0x55566c(0xef)](a0_0x55566c(0x118))[a0_0x55566c(0x121)]=()=>{const _0x1d13e2=a0_0x55566c;if(modalCallback)modalCallback();modal[_0x1d13e2(0xfc)]['remove'](_0x1d13e2(0x157));},messageInput['addEventListener'](a0_0x55566c(0x10a),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x55566c(0x123)](a0_0x55566c(0xf5),_0x378fc3=>{const _0x38f31c=a0_0x55566c;_0x378fc3[_0x38f31c(0x161)]==='Enter'&&!_0x378fc3['shiftKey']&&(_0x378fc3[_0x38f31c(0xf6)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x55566c(0x123)]('click',_0x1906f3=>{const _0xc8927b=a0_0x55566c;document[_0xc8927b(0x11d)](_0xc8927b(0x102))[_0xc8927b(0x131)](_0x2f9d6c=>{const _0xd201c3=_0xc8927b;if(!_0x2f9d6c[_0xd201c3(0x114)](_0x1906f3[_0xd201c3(0x145)]))_0x2f9d6c[_0xd201c3(0xfc)]['remove'](_0xd201c3(0xf8));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x55566c(0x166)](saved),renderMessages();}catch(a0_0x1da043){}updateSendButton();