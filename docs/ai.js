const a0_0x519a15=a0_0x4d1f;(function(_0x1182da,_0x3c551c){const _0x1d0b58=a0_0x4d1f,_0x5d1695=_0x1182da();while(!![]){try{const _0x49c217=parseInt(_0x1d0b58(0x213))/0x1*(-parseInt(_0x1d0b58(0x1d5))/0x2)+-parseInt(_0x1d0b58(0x1e2))/0x3+parseInt(_0x1d0b58(0x1e6))/0x4+parseInt(_0x1d0b58(0x20d))/0x5*(-parseInt(_0x1d0b58(0x1c4))/0x6)+parseInt(_0x1d0b58(0x1de))/0x7*(parseInt(_0x1d0b58(0x22b))/0x8)+parseInt(_0x1d0b58(0x1f8))/0x9+parseInt(_0x1d0b58(0x1cc))/0xa;if(_0x49c217===_0x3c551c)break;else _0x5d1695['push'](_0x5d1695['shift']());}catch(_0x3e3919){_0x5d1695['push'](_0x5d1695['shift']());}}}(a0_0x9eb4,0x875c2));const tg=window[a0_0x519a15(0x1ec)]?.[a0_0x519a15(0x231)],HOME_URL=a0_0x519a15(0x20c);function setupTelegramBackButton(){const _0x4fbeb4=a0_0x519a15;if(!tg)return;try{tg[_0x4fbeb4(0x234)](),tg['expand'](),tg['setHeaderColor']?.(_0x4fbeb4(0x23a));if(tg[_0x4fbeb4(0x1e5)]?.(_0x4fbeb4(0x1c2)))tg[_0x4fbeb4(0x228)]?.();const _0x5ea696=tg[_0x4fbeb4(0x1c7)];if(_0x5ea696){_0x5ea696[_0x4fbeb4(0x23b)]();if(typeof _0x5ea696[_0x4fbeb4(0x1be)]===_0x4fbeb4(0x1c0))try{_0x5ea696[_0x4fbeb4(0x1be)]();}catch(_0x16b9dc){}_0x5ea696[_0x4fbeb4(0x1eb)](()=>{const _0x1ef05e=_0x4fbeb4;if(tg[_0x1ef05e(0x220)])tg[_0x1ef05e(0x220)][_0x1ef05e(0x1f0)](_0x1ef05e(0x233));location[_0x1ef05e(0x1f2)]=HOME_URL;});}}catch(_0x38b115){console[_0x4fbeb4(0x201)](_0x4fbeb4(0x1bd),_0x38b115);}}(function initStableLayout(){const _0xd53c6a=a0_0x519a15,_0x4f9041=(function(){let _0x3e49b6=!![];return function(_0x35404c,_0x491c68){const _0x1e5481=_0x3e49b6?function(){const _0x41b0a5=a0_0x4d1f;if(_0x491c68){const _0x32bab4=_0x491c68[_0x41b0a5(0x1e0)](_0x35404c,arguments);return _0x491c68=null,_0x32bab4;}}:function(){};return _0x3e49b6=![],_0x1e5481;};}()),_0x3134c8=document['querySelector'](_0xd53c6a(0x1e4)),_0x2c11a9=document[_0xd53c6a(0x1db)](_0xd53c6a(0x1fb)),_0x40581c=document[_0xd53c6a(0x1db)](_0xd53c6a(0x1d4)),_0x421327=document[_0xd53c6a(0x1db)](_0xd53c6a(0x1fe));function _0x535de0(){const _0x3a2836=_0xd53c6a,_0x1b4395=_0x4f9041(this,function(){const _0x106651=a0_0x4d1f;return _0x1b4395[_0x106651(0x21b)]()['search'](_0x106651(0x22f))[_0x106651(0x21b)]()[_0x106651(0x1da)](_0x1b4395)[_0x106651(0x205)](_0x106651(0x22f));});_0x1b4395();if(!_0x3134c8)return;const _0x243f63=tg&&tg[_0x3a2836(0x208)]?tg[_0x3a2836(0x208)]:window[_0x3a2836(0x1f4)];_0x3134c8[_0x3a2836(0x1dd)][_0x3a2836(0x219)]=_0x243f63+'px';if(_0x2c11a9){const _0x97edd6=_0x2c11a9[_0x3a2836(0x1e9)];_0x40581c['style'][_0x3a2836(0x1e1)]=_0x97edd6+0x28+'px';}}tg?tg[_0xd53c6a(0x216)]('viewportChanged',({isStateStable:_0x1fbfab})=>{_0x535de0();if(_0x1fbfab)requestAnimationFrame(()=>{const _0x5574e6=a0_0x4d1f;_0x40581c[_0x5574e6(0x215)]=_0x40581c['scrollHeight'];});}):window[_0xd53c6a(0x1c5)](_0xd53c6a(0x22a),_0x535de0),_0x535de0(),_0x421327&&(_0x421327[_0xd53c6a(0x1c5)]('input',()=>{requestAnimationFrame(_0x535de0);}),_0x421327[_0xd53c6a(0x1c5)](_0xd53c6a(0x1cd),()=>{setTimeout(()=>{const _0x33bd65=a0_0x4d1f;_0x40581c[_0x33bd65(0x215)]=_0x40581c[_0x33bd65(0x1bc)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x519a15(0x20a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById']('chatArea'),emptyState=document[a0_0x519a15(0x1db)](a0_0x519a15(0x1c6)),messageInput=document[a0_0x519a15(0x1db)]('messageInput'),sendBtn=document[a0_0x519a15(0x1db)](a0_0x519a15(0x1c9)),clearBtn=document[a0_0x519a15(0x1db)](a0_0x519a15(0x212)),modal=document[a0_0x519a15(0x1db)]('confirmModal'),mTitle=document[a0_0x519a15(0x1db)](a0_0x519a15(0x1ef)),mText=document['getElementById'](a0_0x519a15(0x217));let modalCallback=null;async function callBackend(_0x83c136,_0x360d56){const _0x46dc36=a0_0x519a15,_0x342a05=tg?.['initDataUnsafe']?.['user']||{},_0x558ee9=_0x342a05['id']||localStorage[_0x46dc36(0x222)](_0x46dc36(0x1ff))||'d-'+Math[_0x46dc36(0x202)](Math['random']()*0x3b9aca00);if(!_0x342a05['id'])localStorage[_0x46dc36(0x225)](_0x46dc36(0x1ff),_0x558ee9);const _0x1f22d9={'action':_0x83c136,'user_id':_0x558ee9,'user_data':{'first_name':_0x342a05[_0x46dc36(0x1e8)],'username':_0x342a05['username']},'init_data':tg?.[_0x46dc36(0x1df)]||'',..._0x360d56},_0x2263f9=new AbortController(),_0x1ec57c=setTimeout(()=>_0x2263f9[_0x46dc36(0x206)](),REQUEST_TIMEOUT_MS);try{const _0x548f10=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x46dc36(0x20f)},'body':JSON[_0x46dc36(0x203)](_0x1f22d9),'signal':_0x2263f9['signal']});return clearTimeout(_0x1ec57c),await _0x548f10[_0x46dc36(0x1d0)]();}catch(_0x3ba249){return{'success':![],'error':String(_0x3ba249)};}}function formatTime(_0x327f5d){const _0x36f748=a0_0x519a15,_0x3dbf9d=new Date(_0x327f5d);return String(_0x3dbf9d[_0x36f748(0x224)]())['padStart'](0x2,'0')+':'+String(_0x3dbf9d[_0x36f748(0x1ce)]())[_0x36f748(0x200)](0x2,'0');}function createMessageElement(_0x432c74,_0x3e57ae){const _0x1a6a71=a0_0x519a15,_0x442a4a=document['createElement'](_0x1a6a71(0x207));_0x442a4a[_0x1a6a71(0x21d)]=_0x1a6a71(0x1d7)+_0x432c74[_0x1a6a71(0x22d)];const _0x593607=document[_0x1a6a71(0x1d9)]('div');_0x593607[_0x1a6a71(0x21d)]=_0x1a6a71(0x1ea),_0x593607[_0x1a6a71(0x227)]=_0x432c74['content']['replace'](/\n/g,'<br>');const _0xec0ce8=document[_0x1a6a71(0x1d9)](_0x1a6a71(0x207));_0xec0ce8[_0x1a6a71(0x21d)]=_0x1a6a71(0x21a),_0xec0ce8[_0x1a6a71(0x227)]=_0x1a6a71(0x230),_0xec0ce8['onclick']=_0x225442=>{_0x225442['stopPropagation'](),confirmDelete(_0x3e57ae);};let _0x274695;_0x593607['addEventListener'](_0x1a6a71(0x1fc),()=>_0x274695=setTimeout(()=>{const _0x3be6a9=_0x1a6a71;_0x442a4a[_0x3be6a9(0x223)][_0x3be6a9(0x1bf)](_0x3be6a9(0x1c1));if(tg?.[_0x3be6a9(0x220)])tg[_0x3be6a9(0x220)]['impactOccurred'](_0x3be6a9(0x238));},0x1f4)),_0x593607[_0x1a6a71(0x1c5)](_0x1a6a71(0x239),()=>clearTimeout(_0x274695));const _0x29ea39=document[_0x1a6a71(0x1d9)]('div');return _0x29ea39['className']=_0x1a6a71(0x210),_0x29ea39[_0x1a6a71(0x1f5)]=formatTime(_0x432c74[_0x1a6a71(0x235)]),_0x442a4a[_0x1a6a71(0x1c3)](_0xec0ce8),_0x442a4a[_0x1a6a71(0x1c3)](_0x593607),_0x442a4a[_0x1a6a71(0x1c3)](_0x29ea39),_0x442a4a;}function a0_0x9eb4(){const _0x4f4ff0=['parse','json','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','Действие\x20необратимо.','Начнется\x20новый\x20диалог.','chatArea','12850JjtdvG','user','message\x20','min','createElement','constructor','getElementById','Enter','style','935627icRpkg','initData','apply','paddingBottom','1299297ClidyS','preventDefault','.container','isVersionAtLeast','3022672lQAmYs','display','first_name','offsetHeight','message-bubble','onClick','Telegram','value','disabled','modalTitle','impactOccurred','click','href','now','innerHeight','textContent','clear_history','modalCancel','46215TITFfI','message\x20ai','querySelectorAll','inputArea','touchstart','onclick','messageInput','debug_uid','padStart','warn','floor','stringify','Ошибка\x20сети','search','abort','div','viewportHeight','removeItem','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','trim','./router.html','520345ICoIAW','Очистить\x20историю?','text/plain','message-time','modalConfirm','clearBtn','77JkNtUK','ai_chat_messages','scrollTop','onEvent','modalText','shiftKey','height','delete-btn','toString','text','className','target','from','HapticFeedback','success','getItem','classList','getHours','setItem','forEach','innerHTML','disableVerticalSwipes','Пустой\x20ответ','resize','56IuKZZW','length','role','auto','(((.+)+)+)+$','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','WebApp','remove','light','ready','timestamp','notificationOccurred','error','medium','touchend','#050505','show','none','send_message','scrollHeight','TG\x20setup\x20error:','offClick','add','function','show-delete','6.1','appendChild','60mMbhoO','addEventListener','emptyState','BackButton','push','sendBtn','Удалить?','typingIndicator','8265180TTTmwM','focus','getMinutes'];a0_0x9eb4=function(){return _0x4f4ff0;};return a0_0x9eb4();}function createTypingIndicator(){const _0x124409=a0_0x519a15,_0x2b7abb=document['createElement'](_0x124409(0x207));return _0x2b7abb[_0x124409(0x21d)]=_0x124409(0x1f9),_0x2b7abb['id']=_0x124409(0x1cb),_0x2b7abb['innerHTML']=_0x124409(0x1d1),_0x2b7abb;}function renderMessages(){const _0x4b7c22=a0_0x519a15;Array[_0x4b7c22(0x21f)](chatArea['children'])['forEach'](_0x24a20c=>{const _0x16c902=_0x4b7c22;if(_0x24a20c['id']!==_0x16c902(0x1c6))_0x24a20c[_0x16c902(0x232)]();}),messages['length']>0x0?(emptyState[_0x4b7c22(0x1dd)][_0x4b7c22(0x1e7)]=_0x4b7c22(0x23c),messages[_0x4b7c22(0x226)]((_0x150233,_0x3b8d39)=>chatArea[_0x4b7c22(0x1c3)](createMessageElement(_0x150233,_0x3b8d39)))):emptyState[_0x4b7c22(0x1dd)]['display']='flex',requestAnimationFrame(()=>chatArea[_0x4b7c22(0x215)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x251176=a0_0x519a15;messageInput[_0x251176(0x1dd)][_0x251176(0x219)]=_0x251176(0x22e),messageInput[_0x251176(0x1dd)][_0x251176(0x219)]=Math[_0x251176(0x1d8)](messageInput[_0x251176(0x1bc)],0x78)+'px';}function updateSendButton(){const _0x57ed30=a0_0x519a15,_0x5e5522=messageInput['value'][_0x57ed30(0x20b)]();sendBtn[_0x57ed30(0x1ee)]=!_0x5e5522||isTyping;}async function sendMessage(){const _0x4d6ab3=a0_0x519a15,_0x4ad9b3=messageInput[_0x4d6ab3(0x1ed)][_0x4d6ab3(0x20b)]();if(!_0x4ad9b3||isTyping)return;if(tg?.[_0x4d6ab3(0x220)])tg[_0x4d6ab3(0x220)][_0x4d6ab3(0x1f0)]('light');messages[_0x4d6ab3(0x1c8)]({'role':_0x4d6ab3(0x1d6),'content':_0x4ad9b3,'timestamp':Date[_0x4d6ab3(0x1f3)]()}),localStorage[_0x4d6ab3(0x225)](_0x4d6ab3(0x214),JSON['stringify'](messages)),renderMessages(),messageInput[_0x4d6ab3(0x1ed)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x4d6ab3(0x215)]=chatArea['scrollHeight'];const _0x39d660=await callBackend(_0x4d6ab3(0x1bb),{'message':_0x4ad9b3});isTyping=![];const _0x343510=document[_0x4d6ab3(0x1db)](_0x4d6ab3(0x1cb));if(_0x343510)_0x343510['remove']();let _0x32a908=_0x4d6ab3(0x204);if(_0x39d660[_0x4d6ab3(0x221)]){_0x32a908=_0x39d660[_0x4d6ab3(0x21c)]||_0x4d6ab3(0x229);if(tg?.[_0x4d6ab3(0x220)])tg[_0x4d6ab3(0x220)][_0x4d6ab3(0x236)](_0x4d6ab3(0x221));}else{_0x32a908=_0x39d660[_0x4d6ab3(0x237)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred'](_0x4d6ab3(0x237));}messages[_0x4d6ab3(0x1c8)]({'role':'ai','content':_0x32a908,'timestamp':Date[_0x4d6ab3(0x1f3)]()}),localStorage['setItem'](_0x4d6ab3(0x214),JSON[_0x4d6ab3(0x203)](messages)),renderMessages();}function confirmDelete(_0x2103bc){const _0x5c00ab=a0_0x519a15;if(mTitle)mTitle[_0x5c00ab(0x1f5)]=_0x5c00ab(0x1ca);if(mText)mText[_0x5c00ab(0x1f5)]=_0x5c00ab(0x1d2);modalCallback=()=>{const _0xe215fa=_0x5c00ab;messages['splice'](_0x2103bc,0x1),localStorage[_0xe215fa(0x225)](_0xe215fa(0x214),JSON['stringify'](messages)),renderMessages();},modal[_0x5c00ab(0x223)][_0x5c00ab(0x1bf)]('show');}if(clearBtn)clearBtn[a0_0x519a15(0x1fd)]=()=>{const _0x24b9eb=a0_0x519a15;if(!messages[_0x24b9eb(0x22c)])return;if(mTitle)mTitle[_0x24b9eb(0x1f5)]=_0x24b9eb(0x20e);if(mText)mText[_0x24b9eb(0x1f5)]=_0x24b9eb(0x1d3);modalCallback=async()=>{const _0x10c34d=_0x24b9eb;messages=[],localStorage[_0x10c34d(0x209)]('ai_chat_messages'),renderMessages(),callBackend(_0x10c34d(0x1f6),{});},modal['classList'][_0x24b9eb(0x1bf)](_0x24b9eb(0x23b));};document[a0_0x519a15(0x1db)](a0_0x519a15(0x1f7))[a0_0x519a15(0x1fd)]=()=>modal[a0_0x519a15(0x223)][a0_0x519a15(0x232)](a0_0x519a15(0x23b)),document['getElementById'](a0_0x519a15(0x211))[a0_0x519a15(0x1fd)]=()=>{const _0x1fc18b=a0_0x519a15;if(modalCallback)modalCallback();modal[_0x1fc18b(0x223)][_0x1fc18b(0x232)](_0x1fc18b(0x23b));},messageInput[a0_0x519a15(0x1c5)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x519a15(0x1c5)]('keydown',_0x3afc54=>{const _0x183b54=a0_0x519a15;_0x3afc54['key']===_0x183b54(0x1dc)&&!_0x3afc54[_0x183b54(0x218)]&&(_0x3afc54[_0x183b54(0x1e3)](),sendMessage());}),sendBtn[a0_0x519a15(0x1fd)]=sendMessage,document[a0_0x519a15(0x1c5)](a0_0x519a15(0x1f1),_0x156fca=>{const _0xee91d3=a0_0x519a15;document[_0xee91d3(0x1fa)]('.message.show-delete')[_0xee91d3(0x226)](_0xd7e9f=>{const _0x5a75eb=_0xee91d3;if(!_0xd7e9f['contains'](_0x156fca[_0x5a75eb(0x21e)]))_0xd7e9f['classList'][_0x5a75eb(0x232)](_0x5a75eb(0x1c1));});});const saved=localStorage['getItem']('ai_chat_messages');function a0_0x4d1f(_0xfa4423,_0x53bc6f){_0xfa4423=_0xfa4423-0x1bb;const _0x2a77b8=a0_0x9eb4();let _0xd8fe09=_0x2a77b8[_0xfa4423];return _0xd8fe09;}if(saved)try{messages=JSON[a0_0x519a15(0x1cf)](saved),renderMessages();}catch(a0_0x563941){}updateSendButton();