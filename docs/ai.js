const a0_0x3945f6=a0_0x4cd3;(function(_0x4ce28d,_0x5969ee){const _0x1920bc=a0_0x4cd3,_0x49092e=_0x4ce28d();while(!![]){try{const _0x1f9856=parseInt(_0x1920bc(0x213))/0x1+-parseInt(_0x1920bc(0x1ed))/0x2*(parseInt(_0x1920bc(0x201))/0x3)+parseInt(_0x1920bc(0x1f6))/0x4*(-parseInt(_0x1920bc(0x1a3))/0x5)+parseInt(_0x1920bc(0x1d0))/0x6*(-parseInt(_0x1920bc(0x1de))/0x7)+parseInt(_0x1920bc(0x195))/0x8*(parseInt(_0x1920bc(0x1ca))/0x9)+-parseInt(_0x1920bc(0x1bc))/0xa+-parseInt(_0x1920bc(0x1b1))/0xb*(-parseInt(_0x1920bc(0x197))/0xc);if(_0x1f9856===_0x5969ee)break;else _0x49092e['push'](_0x49092e['shift']());}catch(_0xf21934){_0x49092e['push'](_0x49092e['shift']());}}}(a0_0x51b9,0x900f3));const tg=window['Telegram']?.[a0_0x3945f6(0x1e6)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x425b4d=a0_0x3945f6,_0x1c6007=(function(){let _0x333be2=!![];return function(_0x3a679d,_0x55d1ec){const _0x52e99f=_0x333be2?function(){const _0x11e562=a0_0x4cd3;if(_0x55d1ec){const _0x442798=_0x55d1ec[_0x11e562(0x1c8)](_0x3a679d,arguments);return _0x55d1ec=null,_0x442798;}}:function(){};return _0x333be2=![],_0x52e99f;};}()),_0x575d8b=_0x1c6007(this,function(){const _0x22ceba=a0_0x4cd3;return _0x575d8b[_0x22ceba(0x209)]()['search'](_0x22ceba(0x1dc))[_0x22ceba(0x209)]()[_0x22ceba(0x1da)](_0x575d8b)[_0x22ceba(0x1a9)](_0x22ceba(0x1dc));});_0x575d8b();if(!tg)return;try{tg[_0x425b4d(0x19c)](),tg['expand'](),tg[_0x425b4d(0x1b8)]?.(_0x425b4d(0x1ba));if(tg['isVersionAtLeast']?.(_0x425b4d(0x1c5)))tg[_0x425b4d(0x1f3)]?.();const _0x28b96b=tg[_0x425b4d(0x1cb)];if(_0x28b96b){_0x28b96b[_0x425b4d(0x1fc)]();if(typeof _0x28b96b['offClick']===_0x425b4d(0x1ac))try{_0x28b96b[_0x425b4d(0x216)]();}catch(_0x14794d){}_0x28b96b[_0x425b4d(0x1f2)](()=>{const _0x31b4eb=_0x425b4d;if(tg['HapticFeedback'])tg[_0x31b4eb(0x19f)][_0x31b4eb(0x203)](_0x31b4eb(0x1c4));location[_0x31b4eb(0x1f4)]=HOME_URL;});}}catch(_0xbf29c3){console['warn'](_0x425b4d(0x1b0),_0xbf29c3);}}(function initStableLayout(){const _0x33b32=a0_0x3945f6,_0x3622e1=document['querySelector']('.container'),_0x3b5955=document[_0x33b32(0x1a5)](_0x33b32(0x1d8)),_0x47b514=document[_0x33b32(0x1a5)](_0x33b32(0x1d6)),_0x150f8a=document['getElementById'](_0x33b32(0x204));function _0x17eddf(){const _0x29b7d1=_0x33b32;if(!_0x3622e1)return;const _0x2c1fcb=tg&&tg[_0x29b7d1(0x1fb)]?tg['viewportHeight']:window[_0x29b7d1(0x1be)];_0x3622e1['style']['height']=_0x2c1fcb+'px';if(_0x3b5955){const _0x258123=_0x3b5955[_0x29b7d1(0x1d5)];_0x47b514['style'][_0x29b7d1(0x1e1)]=_0x258123+0x28+'px';}}tg?tg[_0x33b32(0x191)]('viewportChanged',({isStateStable:_0x295e8f})=>{_0x17eddf();if(_0x295e8f)requestAnimationFrame(()=>{const _0x3a3f29=a0_0x4cd3;_0x47b514[_0x3a3f29(0x19e)]=_0x47b514[_0x3a3f29(0x1f7)];});}):window['addEventListener'](_0x33b32(0x1e3),_0x17eddf),_0x17eddf(),_0x150f8a&&(_0x150f8a['addEventListener'](_0x33b32(0x194),()=>{requestAnimationFrame(_0x17eddf);}),_0x150f8a[_0x33b32(0x19d)]('focus',()=>{setTimeout(()=>{_0x47b514['scrollTop']=_0x47b514['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3945f6(0x1c2),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3945f6(0x1a5)](a0_0x3945f6(0x1d6)),emptyState=document[a0_0x3945f6(0x1a5)](a0_0x3945f6(0x20a)),messageInput=document[a0_0x3945f6(0x1a5)](a0_0x3945f6(0x204)),sendBtn=document[a0_0x3945f6(0x1a5)](a0_0x3945f6(0x1cf)),clearBtn=document[a0_0x3945f6(0x1a5)](a0_0x3945f6(0x1bf)),modal=document[a0_0x3945f6(0x1a5)]('confirmModal'),mTitle=document[a0_0x3945f6(0x1a5)](a0_0x3945f6(0x1a7)),mText=document['getElementById'](a0_0x3945f6(0x1b2));let modalCallback=null;async function callBackend(_0x25fa9b,_0x594024){const _0x495983=a0_0x3945f6,_0x18bf40=tg?.[_0x495983(0x20b)]?.[_0x495983(0x205)]||{},_0x1d4c64=_0x18bf40['id']||localStorage[_0x495983(0x1df)](_0x495983(0x211))||'d-'+Math[_0x495983(0x1b3)](Math[_0x495983(0x214)]()*0x3b9aca00);if(!_0x18bf40['id'])localStorage['setItem']('debug_uid',_0x1d4c64);const _0x2aa43c={'action':_0x25fa9b,'user_id':_0x1d4c64,'user_data':{'first_name':_0x18bf40[_0x495983(0x1e0)],'username':_0x18bf40[_0x495983(0x1e2)]},'init_data':tg?.[_0x495983(0x1e8)]||'',..._0x594024},_0x540361=new AbortController(),_0x23d3e4=setTimeout(()=>_0x540361[_0x495983(0x1ff)](),REQUEST_TIMEOUT_MS);try{const _0x3fae6a=await fetch(BACKEND_URL,{'method':_0x495983(0x1f0),'headers':{'Content-Type':_0x495983(0x1f5)},'body':JSON[_0x495983(0x1ee)](_0x2aa43c),'signal':_0x540361[_0x495983(0x1e4)]});return clearTimeout(_0x23d3e4),await _0x3fae6a['json']();}catch(_0x2e3b8a){return{'success':![],'error':String(_0x2e3b8a)};}}function formatTime(_0x390add){const _0x332bed=a0_0x3945f6,_0x337ffb=new Date(_0x390add);return String(_0x337ffb[_0x332bed(0x1af)]())['padStart'](0x2,'0')+':'+String(_0x337ffb[_0x332bed(0x1a8)]())['padStart'](0x2,'0');}function createMessageElement(_0x26eb00,_0x30e922){const _0x51d9fa=a0_0x3945f6,_0x377f20=document['createElement'](_0x51d9fa(0x1d1));_0x377f20[_0x51d9fa(0x1a4)]=_0x51d9fa(0x20c)+_0x26eb00[_0x51d9fa(0x1ef)];const _0x17dd8d=document[_0x51d9fa(0x1ae)](_0x51d9fa(0x1d1));_0x17dd8d[_0x51d9fa(0x1a4)]=_0x51d9fa(0x215),_0x17dd8d[_0x51d9fa(0x1c3)]=_0x26eb00[_0x51d9fa(0x199)][_0x51d9fa(0x20f)](/\n/g,_0x51d9fa(0x1cd));const _0x38eb47=document[_0x51d9fa(0x1ae)](_0x51d9fa(0x1d1));_0x38eb47[_0x51d9fa(0x1a4)]='delete-btn',_0x38eb47[_0x51d9fa(0x1c3)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x38eb47['onclick']=_0x44f186=>{const _0x2b9630=_0x51d9fa;_0x44f186[_0x2b9630(0x1aa)](),confirmDelete(_0x30e922);};let _0x15cc6b;_0x17dd8d[_0x51d9fa(0x19d)](_0x51d9fa(0x202),()=>_0x15cc6b=setTimeout(()=>{const _0x49091e=_0x51d9fa;_0x377f20[_0x49091e(0x1c6)][_0x49091e(0x1c9)](_0x49091e(0x1a2));if(tg?.[_0x49091e(0x19f)])tg[_0x49091e(0x19f)][_0x49091e(0x203)](_0x49091e(0x1ab));},0x1f4)),_0x17dd8d[_0x51d9fa(0x19d)](_0x51d9fa(0x1cc),()=>clearTimeout(_0x15cc6b));const _0x347390=document[_0x51d9fa(0x1ae)]('div');return _0x347390['className']=_0x51d9fa(0x1d4),_0x347390['textContent']=formatTime(_0x26eb00[_0x51d9fa(0x1b5)]),_0x377f20[_0x51d9fa(0x1fd)](_0x38eb47),_0x377f20[_0x51d9fa(0x1fd)](_0x17dd8d),_0x377f20['appendChild'](_0x347390),_0x377f20;}function a0_0x4cd3(_0x389173,_0x2acaa3){_0x389173=_0x389173-0x18f;const _0x3c3e13=a0_0x51b9();let _0x1da34c=_0x3c3e13[_0x389173];return _0x1da34c;}function createTypingIndicator(){const _0x2b4178=a0_0x3945f6,_0x41a8de=document[_0x2b4178(0x1ae)]('div');return _0x41a8de['className']=_0x2b4178(0x1ad),_0x41a8de['id']=_0x2b4178(0x1c1),_0x41a8de['innerHTML']=_0x2b4178(0x198),_0x41a8de;}function renderMessages(){const _0x4cd133=a0_0x3945f6;Array[_0x4cd133(0x193)](chatArea['children'])[_0x4cd133(0x207)](_0x2d2bb4=>{const _0x1e6fae=_0x4cd133;if(_0x2d2bb4['id']!==_0x1e6fae(0x20a))_0x2d2bb4['remove']();}),messages['length']>0x0?(emptyState[_0x4cd133(0x1ec)][_0x4cd133(0x20e)]='none',messages[_0x4cd133(0x207)]((_0x466878,_0x592d74)=>chatArea[_0x4cd133(0x1fd)](createMessageElement(_0x466878,_0x592d74)))):emptyState['style']['display']=_0x4cd133(0x1bb),requestAnimationFrame(()=>chatArea[_0x4cd133(0x19e)]=chatArea[_0x4cd133(0x1f7)]);}function autoResizeTextarea(){const _0x5d21ea=a0_0x3945f6;messageInput[_0x5d21ea(0x1ec)][_0x5d21ea(0x1db)]=_0x5d21ea(0x1b6),messageInput[_0x5d21ea(0x1ec)][_0x5d21ea(0x1db)]=Math[_0x5d21ea(0x18f)](messageInput[_0x5d21ea(0x1f7)],0x78)+'px';}function updateSendButton(){const _0x2cf02c=a0_0x3945f6,_0x13ecdf=messageInput[_0x2cf02c(0x1d3)][_0x2cf02c(0x1a6)]();sendBtn[_0x2cf02c(0x1f8)]=!_0x13ecdf||isTyping;}async function sendMessage(){const _0x4b95b1=a0_0x3945f6,_0x5be853=messageInput[_0x4b95b1(0x1d3)]['trim']();if(!_0x5be853||isTyping)return;if(tg?.[_0x4b95b1(0x19f)])tg[_0x4b95b1(0x19f)][_0x4b95b1(0x203)]('light');messages[_0x4b95b1(0x1c0)]({'role':_0x4b95b1(0x205),'content':_0x5be853,'timestamp':Date[_0x4b95b1(0x1f1)]()}),localStorage['setItem'](_0x4b95b1(0x1c7),JSON[_0x4b95b1(0x1ee)](messages)),renderMessages(),messageInput[_0x4b95b1(0x1d3)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4b95b1(0x1fd)](createTypingIndicator()),chatArea[_0x4b95b1(0x19e)]=chatArea[_0x4b95b1(0x1f7)];const _0x2c3606=await callBackend(_0x4b95b1(0x1f9),{'message':_0x5be853});isTyping=![];const _0x33367e=document[_0x4b95b1(0x1a5)](_0x4b95b1(0x1c1));if(_0x33367e)_0x33367e[_0x4b95b1(0x1a0)]();let _0x1d0ec3=_0x4b95b1(0x208);if(_0x2c3606[_0x4b95b1(0x210)]){_0x1d0ec3=_0x2c3606[_0x4b95b1(0x19b)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg[_0x4b95b1(0x19f)]['notificationOccurred'](_0x4b95b1(0x210));}else{_0x1d0ec3=_0x2c3606['error']||_0x4b95b1(0x1ea);if(tg?.['HapticFeedback'])tg[_0x4b95b1(0x19f)][_0x4b95b1(0x196)](_0x4b95b1(0x1eb));}messages[_0x4b95b1(0x1c0)]({'role':'ai','content':_0x1d0ec3,'timestamp':Date[_0x4b95b1(0x1f1)]()}),localStorage[_0x4b95b1(0x200)](_0x4b95b1(0x1c7),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x56fde4){const _0x1f42d6=a0_0x3945f6;if(mTitle)mTitle[_0x1f42d6(0x1e7)]=_0x1f42d6(0x1d2);if(mText)mText[_0x1f42d6(0x1e7)]=_0x1f42d6(0x19a);modalCallback=()=>{const _0x2df7fb=_0x1f42d6;messages[_0x2df7fb(0x1e5)](_0x56fde4,0x1),localStorage[_0x2df7fb(0x200)](_0x2df7fb(0x1c7),JSON[_0x2df7fb(0x1ee)](messages)),renderMessages();},modal[_0x1f42d6(0x1c6)]['add'](_0x1f42d6(0x1fc));}if(clearBtn)clearBtn[a0_0x3945f6(0x1fa)]=()=>{const _0x40650f=a0_0x3945f6;if(!messages[_0x40650f(0x1d9)])return;if(mTitle)mTitle['textContent']=_0x40650f(0x190);if(mText)mText[_0x40650f(0x1e7)]=_0x40650f(0x192);modalCallback=async()=>{const _0x335cd8=_0x40650f;messages=[],localStorage[_0x335cd8(0x1b4)](_0x335cd8(0x1c7)),renderMessages(),callBackend(_0x335cd8(0x1e9),{});},modal['classList'][_0x40650f(0x1c9)](_0x40650f(0x1fc));};document[a0_0x3945f6(0x1a5)]('modalCancel')[a0_0x3945f6(0x1fa)]=()=>modal[a0_0x3945f6(0x1c6)][a0_0x3945f6(0x1a0)]('show'),document['getElementById'](a0_0x3945f6(0x212))['onclick']=()=>{const _0x7aa324=a0_0x3945f6;if(modalCallback)modalCallback();modal[_0x7aa324(0x1c6)]['remove'](_0x7aa324(0x1fc));},messageInput[a0_0x3945f6(0x19d)](a0_0x3945f6(0x194),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x3945f6(0x20d),_0x587c92=>{const _0x5cb424=a0_0x3945f6;_0x587c92[_0x5cb424(0x1a1)]===_0x5cb424(0x206)&&!_0x587c92[_0x5cb424(0x1bd)]&&(_0x587c92[_0x5cb424(0x1dd)](),sendMessage());}),sendBtn[a0_0x3945f6(0x1fa)]=sendMessage,document[a0_0x3945f6(0x19d)](a0_0x3945f6(0x1d7),_0x1a79b5=>{const _0x562731=a0_0x3945f6;document[_0x562731(0x1b7)]('.message.show-delete')['forEach'](_0x1ba7da=>{const _0xc88a87=_0x562731;if(!_0x1ba7da[_0xc88a87(0x1fe)](_0x1a79b5[_0xc88a87(0x1ce)]))_0x1ba7da[_0xc88a87(0x1c6)][_0xc88a87(0x1a0)](_0xc88a87(0x1a2));});});const saved=localStorage[a0_0x3945f6(0x1df)](a0_0x3945f6(0x1c7));if(saved)try{messages=JSON[a0_0x3945f6(0x1b9)](saved),renderMessages();}catch(a0_0x21d2e9){}updateSendButton();function a0_0x51b9(){const _0x3a5752=['offsetHeight','chatArea','click','inputArea','length','constructor','height','(((.+)+)+)+$','preventDefault','5762589kkcAVc','getItem','first_name','paddingBottom','username','resize','signal','splice','WebApp','textContent','initData','clear_history','Ошибка\x20сервера','error','style','4796VVQPde','stringify','role','POST','now','onClick','disableVerticalSwipes','href','text/plain','4536676LXTvxU','scrollHeight','disabled','send_message','onclick','viewportHeight','show','appendChild','contains','abort','setItem','1065oznlhM','touchstart','impactOccurred','messageInput','user','Enter','forEach','Ошибка\x20сети','toString','emptyState','initDataUnsafe','message\x20','keydown','display','replace','success','debug_uid','modalConfirm','484178XUdRTo','random','message-bubble','offClick','min','Очистить\x20историю?','onEvent','Начнется\x20новый\x20диалог.','from','input','486568Csngpz','notificationOccurred','168yPzVoc','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','content','Действие\x20необратимо.','text','ready','addEventListener','scrollTop','HapticFeedback','remove','key','show-delete','5cqmrdg','className','getElementById','trim','modalTitle','getMinutes','search','stopPropagation','medium','function','message\x20ai','createElement','getHours','TG\x20setup\x20error:','2447731WDmEcN','modalText','floor','removeItem','timestamp','auto','querySelectorAll','setHeaderColor','parse','#050505','flex','11130340kgQTVz','shiftKey','innerHeight','clearBtn','push','typingIndicator','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','innerHTML','light','6.1','classList','ai_chat_messages','apply','add','135PdHDit','BackButton','touchend','<br>','target','sendBtn','6MDQjVE','div','Удалить?','value','message-time'];a0_0x51b9=function(){return _0x3a5752;};return a0_0x51b9();}