function a0_0xe58d(_0xdad311,_0x3d3c5f){_0xdad311=_0xdad311-0x12a;const _0x1b1bcd=a0_0x3ad8();let _0x5ec124=_0x1b1bcd[_0xdad311];return _0x5ec124;}const a0_0xb4c9ee=a0_0xe58d;(function(_0x5b895e,_0x296542){const _0x21cf67=a0_0xe58d,_0x543450=_0x5b895e();while(!![]){try{const _0x4ff056=parseInt(_0x21cf67(0x15d))/0x1+parseInt(_0x21cf67(0x137))/0x2*(-parseInt(_0x21cf67(0x142))/0x3)+parseInt(_0x21cf67(0x191))/0x4*(parseInt(_0x21cf67(0x17a))/0x5)+-parseInt(_0x21cf67(0x12e))/0x6*(parseInt(_0x21cf67(0x17c))/0x7)+parseInt(_0x21cf67(0x172))/0x8+parseInt(_0x21cf67(0x152))/0x9+-parseInt(_0x21cf67(0x160))/0xa;if(_0x4ff056===_0x296542)break;else _0x543450['push'](_0x543450['shift']());}catch(_0xaa94e0){_0x543450['push'](_0x543450['shift']());}}}(a0_0x3ad8,0x1997e));const tg=window[a0_0xb4c9ee(0x148)]?.[a0_0xb4c9ee(0x15a)],HOME_URL=a0_0xb4c9ee(0x12c);function setupTelegramBackButton(){const _0x4fae1f=a0_0xb4c9ee;if(!tg)return;try{tg[_0x4fae1f(0x187)](),tg[_0x4fae1f(0x19e)](),tg[_0x4fae1f(0x198)]?.(_0x4fae1f(0x15f));if(tg[_0x4fae1f(0x13b)]?.(_0x4fae1f(0x132)))tg['disableVerticalSwipes']?.();const _0x1d5a79=tg[_0x4fae1f(0x13f)];if(_0x1d5a79){_0x1d5a79['show']();if(typeof _0x1d5a79[_0x4fae1f(0x163)]===_0x4fae1f(0x161))try{_0x1d5a79['offClick']();}catch(_0x26fb58){}_0x1d5a79[_0x4fae1f(0x199)](()=>{const _0x5477bd=_0x4fae1f;if(tg['HapticFeedback'])tg[_0x5477bd(0x183)]['impactOccurred'](_0x5477bd(0x19b));location[_0x5477bd(0x17b)]=HOME_URL;});}}catch(_0x155597){console[_0x4fae1f(0x18d)](_0x4fae1f(0x170),_0x155597);}}(function initStableLayout(){const _0x13273c=a0_0xb4c9ee,_0x2cdf7d=(function(){let _0x5122be=!![];return function(_0xabc656,_0xc27918){const _0x5c61f2=_0x5122be?function(){const _0x30185d=a0_0xe58d;if(_0xc27918){const _0x128340=_0xc27918[_0x30185d(0x143)](_0xabc656,arguments);return _0xc27918=null,_0x128340;}}:function(){};return _0x5122be=![],_0x5c61f2;};}()),_0x1781d8=document[_0x13273c(0x14d)]('.container'),_0x49f82a=document[_0x13273c(0x147)]('inputArea'),_0x325c47=document['getElementById'](_0x13273c(0x13c)),_0x17f43f=document['getElementById']('messageInput');function _0x56ce53(){const _0x423e10=_0x13273c,_0xb5e47=_0x2cdf7d(this,function(){const _0x4a5051=a0_0xe58d;return _0xb5e47['toString']()['search']('(((.+)+)+)+$')[_0x4a5051(0x131)]()['constructor'](_0xb5e47)['search']('(((.+)+)+)+$');});_0xb5e47();if(!_0x1781d8)return;const _0x185770=tg&&tg[_0x423e10(0x169)]?tg[_0x423e10(0x169)]:window['innerHeight'];_0x1781d8['style'][_0x423e10(0x1a3)]=_0x185770+'px';if(_0x49f82a){const _0x126421=_0x49f82a[_0x423e10(0x193)];_0x325c47['style']['paddingBottom']=_0x126421+0x28+'px';}}tg?tg[_0x13273c(0x150)]('viewportChanged',({isStateStable:_0x25afeb})=>{_0x56ce53();if(_0x25afeb)requestAnimationFrame(()=>{const _0x2fa069=a0_0xe58d;_0x325c47['scrollTop']=_0x325c47[_0x2fa069(0x173)];});}):window[_0x13273c(0x13d)]('resize',_0x56ce53),_0x56ce53(),_0x17f43f&&(_0x17f43f[_0x13273c(0x13d)](_0x13273c(0x157),()=>{requestAnimationFrame(_0x56ce53);}),_0x17f43f['addEventListener'](_0x13273c(0x135),()=>{setTimeout(()=>{const _0x5bd129=a0_0xe58d;_0x325c47[_0x5bd129(0x18e)]=_0x325c47[_0x5bd129(0x173)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xb4c9ee(0x134),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xb4c9ee(0x147)](a0_0xb4c9ee(0x13c)),emptyState=document[a0_0xb4c9ee(0x147)](a0_0xb4c9ee(0x139)),messageInput=document[a0_0xb4c9ee(0x147)]('messageInput'),sendBtn=document[a0_0xb4c9ee(0x147)]('sendBtn'),clearBtn=document['getElementById'](a0_0xb4c9ee(0x17e)),modal=document[a0_0xb4c9ee(0x147)](a0_0xb4c9ee(0x178)),mTitle=document[a0_0xb4c9ee(0x147)](a0_0xb4c9ee(0x133)),mText=document[a0_0xb4c9ee(0x147)](a0_0xb4c9ee(0x12d));let modalCallback=null;async function callBackend(_0x3bbf68,_0x36ca88){const _0x47417a=a0_0xb4c9ee,_0x2062e9=tg?.['initDataUnsafe']?.[_0x47417a(0x14a)]||{},_0x3ff626=_0x2062e9['id']||localStorage[_0x47417a(0x184)]('debug_uid')||'d-'+Math[_0x47417a(0x16a)](Math['random']()*0x3b9aca00);if(!_0x2062e9['id'])localStorage[_0x47417a(0x16e)](_0x47417a(0x144),_0x3ff626);const _0x4c7288={'action':_0x3bbf68,'user_id':_0x3ff626,'user_data':{'first_name':_0x2062e9[_0x47417a(0x15b)],'username':_0x2062e9[_0x47417a(0x145)]},'init_data':tg?.[_0x47417a(0x167)]||'',..._0x36ca88},_0x5f3731=new AbortController(),_0x1d4450=setTimeout(()=>_0x5f3731[_0x47417a(0x166)](),REQUEST_TIMEOUT_MS);try{const _0x22130c=await fetch(BACKEND_URL,{'method':_0x47417a(0x12f),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x4c7288),'signal':_0x5f3731[_0x47417a(0x151)]});return clearTimeout(_0x1d4450),await _0x22130c[_0x47417a(0x162)]();}catch(_0xe3ac96){return{'success':![],'error':String(_0xe3ac96)};}}function formatTime(_0x269354){const _0x40859a=a0_0xb4c9ee,_0x2d0675=new Date(_0x269354);return String(_0x2d0675['getHours']())[_0x40859a(0x194)](0x2,'0')+':'+String(_0x2d0675[_0x40859a(0x136)]())[_0x40859a(0x194)](0x2,'0');}function createMessageElement(_0x21cdce,_0x2799ea){const _0x2b983e=a0_0xb4c9ee,_0x3b2601=document[_0x2b983e(0x14c)](_0x2b983e(0x18b));_0x3b2601[_0x2b983e(0x186)]=_0x2b983e(0x138)+_0x21cdce['role'];const _0x311c7d=document[_0x2b983e(0x14c)](_0x2b983e(0x18b));_0x311c7d[_0x2b983e(0x186)]=_0x2b983e(0x190),_0x311c7d[_0x2b983e(0x17d)]=_0x21cdce[_0x2b983e(0x156)][_0x2b983e(0x17f)](/\n/g,_0x2b983e(0x197));const _0x1af5d2=document[_0x2b983e(0x14c)](_0x2b983e(0x18b));_0x1af5d2['className']='delete-btn',_0x1af5d2[_0x2b983e(0x17d)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x1af5d2[_0x2b983e(0x176)]=_0x44b727=>{const _0x5f252d=_0x2b983e;_0x44b727[_0x5f252d(0x177)](),confirmDelete(_0x2799ea);};let _0x1f20f9;_0x311c7d['addEventListener'](_0x2b983e(0x174),()=>_0x1f20f9=setTimeout(()=>{const _0x956e79=_0x2b983e;_0x3b2601[_0x956e79(0x14f)][_0x956e79(0x164)](_0x956e79(0x196));if(tg?.[_0x956e79(0x183)])tg['HapticFeedback'][_0x956e79(0x189)](_0x956e79(0x19f));},0x1f4)),_0x311c7d['addEventListener']('touchend',()=>clearTimeout(_0x1f20f9));const _0x47a2b0=document[_0x2b983e(0x14c)](_0x2b983e(0x18b));return _0x47a2b0['className']=_0x2b983e(0x14b),_0x47a2b0[_0x2b983e(0x180)]=formatTime(_0x21cdce[_0x2b983e(0x141)]),_0x3b2601['appendChild'](_0x1af5d2),_0x3b2601['appendChild'](_0x311c7d),_0x3b2601['appendChild'](_0x47a2b0),_0x3b2601;}function createTypingIndicator(){const _0x4600a7=a0_0xb4c9ee,_0x4664f5=document['createElement'](_0x4600a7(0x18b));return _0x4664f5[_0x4600a7(0x186)]=_0x4600a7(0x195),_0x4664f5['id']=_0x4600a7(0x16d),_0x4664f5['innerHTML']=_0x4600a7(0x140),_0x4664f5;}function renderMessages(){const _0x393b2c=a0_0xb4c9ee;Array[_0x393b2c(0x15c)](chatArea['children'])[_0x393b2c(0x18a)](_0x10386e=>{const _0x314059=_0x393b2c;if(_0x10386e['id']!=='emptyState')_0x10386e[_0x314059(0x153)]();}),messages['length']>0x0?(emptyState['style'][_0x393b2c(0x1a2)]='none',messages[_0x393b2c(0x18a)]((_0xb334cf,_0x1d4c35)=>chatArea[_0x393b2c(0x149)](createMessageElement(_0xb334cf,_0x1d4c35)))):emptyState['style']['display']=_0x393b2c(0x181),requestAnimationFrame(()=>chatArea[_0x393b2c(0x18e)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x16ec54=a0_0xb4c9ee;messageInput['style'][_0x16ec54(0x1a3)]='auto',messageInput[_0x16ec54(0x158)][_0x16ec54(0x1a3)]=Math[_0x16ec54(0x19d)](messageInput[_0x16ec54(0x173)],0x78)+'px';}function updateSendButton(){const _0x5912d5=a0_0xb4c9ee,_0x1434a7=messageInput[_0x5912d5(0x16c)][_0x5912d5(0x175)]();sendBtn['disabled']=!_0x1434a7||isTyping;}async function sendMessage(){const _0x58e1da=a0_0xb4c9ee,_0xd23a2=messageInput[_0x58e1da(0x16c)]['trim']();if(!_0xd23a2||isTyping)return;if(tg?.[_0x58e1da(0x183)])tg[_0x58e1da(0x183)]['impactOccurred'](_0x58e1da(0x19b));messages['push']({'role':_0x58e1da(0x14a),'content':_0xd23a2,'timestamp':Date[_0x58e1da(0x14e)]()}),localStorage['setItem'](_0x58e1da(0x18f),JSON['stringify'](messages)),renderMessages(),messageInput[_0x58e1da(0x16c)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x58e1da(0x149)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x58e1da(0x173)];const _0x46cda6=await callBackend('send_message',{'message':_0xd23a2});isTyping=![];const _0x260aae=document[_0x58e1da(0x147)](_0x58e1da(0x16d));if(_0x260aae)_0x260aae[_0x58e1da(0x153)]();let _0x458599=_0x58e1da(0x12b);if(_0x46cda6[_0x58e1da(0x146)]){_0x458599=_0x46cda6[_0x58e1da(0x13e)]||'Пустой\x20ответ';if(tg?.[_0x58e1da(0x183)])tg[_0x58e1da(0x183)]['notificationOccurred'](_0x58e1da(0x146));}else{_0x458599=_0x46cda6[_0x58e1da(0x1a1)]||_0x58e1da(0x19a);if(tg?.[_0x58e1da(0x183)])tg[_0x58e1da(0x183)][_0x58e1da(0x192)](_0x58e1da(0x1a1));}messages['push']({'role':'ai','content':_0x458599,'timestamp':Date[_0x58e1da(0x14e)]()}),localStorage[_0x58e1da(0x16e)]('ai_chat_messages',JSON[_0x58e1da(0x19c)](messages)),renderMessages();}function confirmDelete(_0x1409aa){const _0xe89f9=a0_0xb4c9ee;if(mTitle)mTitle[_0xe89f9(0x180)]=_0xe89f9(0x18c);if(mText)mText['textContent']=_0xe89f9(0x165);modalCallback=()=>{const _0xc95f2f=_0xe89f9;messages[_0xc95f2f(0x130)](_0x1409aa,0x1),localStorage[_0xc95f2f(0x16e)](_0xc95f2f(0x18f),JSON[_0xc95f2f(0x19c)](messages)),renderMessages();},modal[_0xe89f9(0x14f)][_0xe89f9(0x164)](_0xe89f9(0x12a));}function a0_0x3ad8(){const _0x16a1e2=['replace','textContent','flex','querySelectorAll','HapticFeedback','getItem','clear_history','className','ready','click','impactOccurred','forEach','div','Удалить?','warn','scrollTop','ai_chat_messages','message-bubble','323452kNLbki','notificationOccurred','offsetHeight','padStart','message\x20ai','show-delete','<br>','setHeaderColor','onClick','Ошибка\x20сервера','light','stringify','min','expand','medium','keydown','error','display','height','show','Ошибка\x20сети','./router.html','modalText','861846YfaNzQ','POST','splice','toString','6.1','modalTitle','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','focus','getMinutes','244402ICouye','message\x20','emptyState','modalCancel','isVersionAtLeast','chatArea','addEventListener','text','BackButton','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','timestamp','3kMFtVZ','apply','debug_uid','username','success','getElementById','Telegram','appendChild','user','message-time','createElement','querySelector','now','classList','onEvent','signal','1671093ijAFnX','remove','parse','contains','content','input','style','length','WebApp','first_name','from','156621bCwbsw','target','#050505','2059300sGbIyT','function','json','offClick','add','Действие\x20необратимо.','abort','initData','key','viewportHeight','floor','Начнется\x20новый\x20диалог.','value','typingIndicator','setItem','Очистить\x20историю?','TG\x20setup\x20error:','shiftKey','1227528pVhaOt','scrollHeight','touchstart','trim','onclick','stopPropagation','confirmModal','preventDefault','5qjLieB','href','7AzGgth','innerHTML','clearBtn'];a0_0x3ad8=function(){return _0x16a1e2;};return a0_0x3ad8();}if(clearBtn)clearBtn[a0_0xb4c9ee(0x176)]=()=>{const _0x386a5e=a0_0xb4c9ee;if(!messages[_0x386a5e(0x159)])return;if(mTitle)mTitle[_0x386a5e(0x180)]=_0x386a5e(0x16f);if(mText)mText[_0x386a5e(0x180)]=_0x386a5e(0x16b);modalCallback=async()=>{const _0x5aab6e=_0x386a5e;messages=[],localStorage['removeItem'](_0x5aab6e(0x18f)),renderMessages(),callBackend(_0x5aab6e(0x185),{});},modal[_0x386a5e(0x14f)][_0x386a5e(0x164)](_0x386a5e(0x12a));};document['getElementById'](a0_0xb4c9ee(0x13a))[a0_0xb4c9ee(0x176)]=()=>modal[a0_0xb4c9ee(0x14f)]['remove'](a0_0xb4c9ee(0x12a)),document[a0_0xb4c9ee(0x147)]('modalConfirm')[a0_0xb4c9ee(0x176)]=()=>{const _0x5d5107=a0_0xb4c9ee;if(modalCallback)modalCallback();modal['classList']['remove'](_0x5d5107(0x12a));},messageInput[a0_0xb4c9ee(0x13d)](a0_0xb4c9ee(0x157),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xb4c9ee(0x13d)](a0_0xb4c9ee(0x1a0),_0x53d5a8=>{const _0xb643a2=a0_0xb4c9ee;_0x53d5a8[_0xb643a2(0x168)]==='Enter'&&!_0x53d5a8[_0xb643a2(0x171)]&&(_0x53d5a8[_0xb643a2(0x179)](),sendMessage());}),sendBtn[a0_0xb4c9ee(0x176)]=sendMessage,document['addEventListener'](a0_0xb4c9ee(0x188),_0x43e1cb=>{const _0xd7e3bf=a0_0xb4c9ee;document[_0xd7e3bf(0x182)]('.message.show-delete')['forEach'](_0x2e6d26=>{const _0x4e5e00=_0xd7e3bf;if(!_0x2e6d26[_0x4e5e00(0x155)](_0x43e1cb[_0x4e5e00(0x15e)]))_0x2e6d26[_0x4e5e00(0x14f)][_0x4e5e00(0x153)](_0x4e5e00(0x196));});});const saved=localStorage['getItem'](a0_0xb4c9ee(0x18f));if(saved)try{messages=JSON[a0_0xb4c9ee(0x154)](saved),renderMessages();}catch(a0_0x479ee9){}updateSendButton();