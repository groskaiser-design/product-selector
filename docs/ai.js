const a0_0x38ee8d=a0_0x4396;(function(_0x1dacb3,_0x43f520){const _0x5b58a8=a0_0x4396,_0x45c957=_0x1dacb3();while(!![]){try{const _0x4ddc49=-parseInt(_0x5b58a8(0x123))/0x1*(-parseInt(_0x5b58a8(0xff))/0x2)+-parseInt(_0x5b58a8(0x166))/0x3+parseInt(_0x5b58a8(0x15c))/0x4*(parseInt(_0x5b58a8(0x12d))/0x5)+-parseInt(_0x5b58a8(0x10f))/0x6+parseInt(_0x5b58a8(0xe5))/0x7+-parseInt(_0x5b58a8(0x131))/0x8+-parseInt(_0x5b58a8(0x160))/0x9;if(_0x4ddc49===_0x43f520)break;else _0x45c957['push'](_0x45c957['shift']());}catch(_0x5d781b){_0x45c957['push'](_0x45c957['shift']());}}}(a0_0x41c2,0x8c049));const tg=window[a0_0x38ee8d(0x15b)]?.[a0_0x38ee8d(0x142)],HOME_URL=a0_0x38ee8d(0xf8);function setupTelegramBackButton(){const _0x1c892b=a0_0x38ee8d,_0x216bd4=(function(){let _0x590856=!![];return function(_0xd35d50,_0x40b505){const _0x169486=_0x590856?function(){const _0x40550f=a0_0x4396;if(_0x40b505){const _0xc3de1c=_0x40b505[_0x40550f(0x14d)](_0xd35d50,arguments);return _0x40b505=null,_0xc3de1c;}}:function(){};return _0x590856=![],_0x169486;};}()),_0x5e989a=_0x216bd4(this,function(){const _0x17154c=a0_0x4396;return _0x5e989a[_0x17154c(0xe8)]()[_0x17154c(0xfa)](_0x17154c(0x10a))[_0x17154c(0xe8)]()[_0x17154c(0x135)](_0x5e989a)[_0x17154c(0xfa)](_0x17154c(0x10a));});_0x5e989a();if(!tg)return;try{tg[_0x1c892b(0x126)](),tg[_0x1c892b(0x15f)](),tg[_0x1c892b(0x140)]?.(_0x1c892b(0xec));if(tg[_0x1c892b(0x10e)]?.(_0x1c892b(0x115)))tg[_0x1c892b(0x14f)]?.();const _0x49383a=tg[_0x1c892b(0x112)];if(_0x49383a){_0x49383a[_0x1c892b(0xf5)]();if(typeof _0x49383a[_0x1c892b(0x129)]===_0x1c892b(0x103))try{_0x49383a['offClick']();}catch(_0x1a2019){}_0x49383a[_0x1c892b(0x156)](()=>{const _0x221f3f=_0x1c892b;if(tg[_0x221f3f(0x154)])tg[_0x221f3f(0x154)][_0x221f3f(0x159)](_0x221f3f(0x155));location[_0x221f3f(0x105)]=HOME_URL;});}}catch(_0x2e9b35){console[_0x1c892b(0x124)](_0x1c892b(0x130),_0x2e9b35);}}(function initStableLayout(){const _0xe721f0=a0_0x38ee8d,_0x1e8150=document['querySelector'](_0xe721f0(0xf4)),_0x462ff4=document[_0xe721f0(0x13f)](_0xe721f0(0x148)),_0x3b7ef0=document[_0xe721f0(0x13f)](_0xe721f0(0x122)),_0x212c15=document['getElementById'](_0xe721f0(0x145));function _0x3d962e(){const _0x17ad4a=_0xe721f0;if(!_0x1e8150)return;const _0x2e5a9a=tg&&tg[_0x17ad4a(0xe9)]?tg[_0x17ad4a(0xe9)]:window['innerHeight'];_0x1e8150[_0x17ad4a(0x10b)][_0x17ad4a(0x164)]=_0x2e5a9a+'px';if(_0x462ff4){const _0x5af445=_0x462ff4[_0x17ad4a(0xea)];_0x3b7ef0[_0x17ad4a(0x10b)][_0x17ad4a(0x11e)]=_0x5af445+0x28+'px';}}tg?tg['onEvent'](_0xe721f0(0xf7),({isStateStable:_0x25c826})=>{_0x3d962e();if(_0x25c826)requestAnimationFrame(()=>{const _0x36d53b=a0_0x4396;_0x3b7ef0[_0x36d53b(0x117)]=_0x3b7ef0[_0x36d53b(0x10c)];});}):window[_0xe721f0(0x108)](_0xe721f0(0x11d),_0x3d962e),_0x3d962e(),_0x212c15&&(_0x212c15[_0xe721f0(0x108)]('input',()=>{requestAnimationFrame(_0x3d962e);}),_0x212c15[_0xe721f0(0x108)]('focus',()=>{setTimeout(()=>{const _0x2af8c6=a0_0x4396;_0x3b7ef0['scrollTop']=_0x3b7ef0[_0x2af8c6(0x10c)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x38ee8d(0xf2),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x4396(_0x49f4ca,_0x275548){_0x49f4ca=_0x49f4ca-0xe4;const _0x5913f1=a0_0x41c2();let _0x456c5d=_0x5913f1[_0x49f4ca];return _0x456c5d;}const chatArea=document[a0_0x38ee8d(0x13f)](a0_0x38ee8d(0x122)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x38ee8d(0x13f)](a0_0x38ee8d(0x145)),sendBtn=document[a0_0x38ee8d(0x13f)](a0_0x38ee8d(0x11c)),clearBtn=document['getElementById'](a0_0x38ee8d(0x13b)),modal=document[a0_0x38ee8d(0x13f)](a0_0x38ee8d(0xef)),mTitle=document[a0_0x38ee8d(0x13f)](a0_0x38ee8d(0x167)),mText=document['getElementById'](a0_0x38ee8d(0x113));let modalCallback=null;async function callBackend(_0x17450e,_0x22e897){const _0x542db8=a0_0x38ee8d,_0xea04aa=tg?.[_0x542db8(0x149)]?.[_0x542db8(0x11f)]||{},_0x5d0f3c=_0xea04aa['id']||localStorage[_0x542db8(0xf3)]('debug_uid')||'d-'+Math[_0x542db8(0x165)](Math['random']()*0x3b9aca00);if(!_0xea04aa['id'])localStorage[_0x542db8(0x12b)](_0x542db8(0x161),_0x5d0f3c);const _0x1983e2={'action':_0x17450e,'user_id':_0x5d0f3c,'user_data':{'first_name':_0xea04aa[_0x542db8(0x14b)],'username':_0xea04aa[_0x542db8(0x138)]},'init_data':tg?.['initData']||'',..._0x22e897},_0x112924=new AbortController(),_0x5adb91=setTimeout(()=>_0x112924['abort'](),REQUEST_TIMEOUT_MS);try{const _0x28a124=await fetch(BACKEND_URL,{'method':_0x542db8(0x101),'headers':{'Content-Type':_0x542db8(0x128)},'body':JSON[_0x542db8(0x125)](_0x1983e2),'signal':_0x112924[_0x542db8(0x13d)]});return clearTimeout(_0x5adb91),await _0x28a124[_0x542db8(0x11a)]();}catch(_0x33b4dc){return{'success':![],'error':String(_0x33b4dc)};}}function formatTime(_0x1221b3){const _0x1f28c7=a0_0x38ee8d,_0x16f280=new Date(_0x1221b3);return String(_0x16f280[_0x1f28c7(0x157)]())[_0x1f28c7(0xe6)](0x2,'0')+':'+String(_0x16f280['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x24edd2,_0x384535){const _0x602aff=a0_0x38ee8d,_0x1fcdb2=document[_0x602aff(0x15d)](_0x602aff(0xe7));_0x1fcdb2[_0x602aff(0x151)]='message\x20'+_0x24edd2[_0x602aff(0xed)];const _0x91e5bf=document[_0x602aff(0x15d)](_0x602aff(0xe7));_0x91e5bf[_0x602aff(0x151)]=_0x602aff(0x162),_0x91e5bf[_0x602aff(0x137)]=_0x24edd2[_0x602aff(0x15a)]['replace'](/\n/g,_0x602aff(0x104));const _0x171efa=document[_0x602aff(0x15d)]('div');_0x171efa[_0x602aff(0x151)]='delete-btn',_0x171efa[_0x602aff(0x137)]=_0x602aff(0xfb),_0x171efa['onclick']=_0x2a7f12=>{const _0x317e20=_0x602aff;_0x2a7f12[_0x317e20(0x12e)](),confirmDelete(_0x384535);};let _0x4d2473;_0x91e5bf[_0x602aff(0x108)](_0x602aff(0xf6),()=>_0x4d2473=setTimeout(()=>{const _0x41d338=_0x602aff;_0x1fcdb2[_0x41d338(0x107)]['add'](_0x41d338(0x100));if(tg?.[_0x41d338(0x154)])tg[_0x41d338(0x154)]['impactOccurred'](_0x41d338(0x114));},0x1f4)),_0x91e5bf[_0x602aff(0x108)](_0x602aff(0x141),()=>clearTimeout(_0x4d2473));const _0x1c7ad6=document[_0x602aff(0x15d)](_0x602aff(0xe7));return _0x1c7ad6[_0x602aff(0x151)]='message-time',_0x1c7ad6[_0x602aff(0x111)]=formatTime(_0x24edd2[_0x602aff(0x12f)]),_0x1fcdb2[_0x602aff(0x102)](_0x171efa),_0x1fcdb2['appendChild'](_0x91e5bf),_0x1fcdb2[_0x602aff(0x102)](_0x1c7ad6),_0x1fcdb2;}function createTypingIndicator(){const _0x5637a6=a0_0x38ee8d,_0x17e5f4=document[_0x5637a6(0x15d)](_0x5637a6(0xe7));return _0x17e5f4[_0x5637a6(0x151)]=_0x5637a6(0x158),_0x17e5f4['id']=_0x5637a6(0x14c),_0x17e5f4['innerHTML']=_0x5637a6(0x13a),_0x17e5f4;}function renderMessages(){const _0x4eb4b2=a0_0x38ee8d;Array[_0x4eb4b2(0x14e)](chatArea[_0x4eb4b2(0x132)])[_0x4eb4b2(0xeb)](_0x100b4f=>{const _0x4fff48=_0x4eb4b2;if(_0x100b4f['id']!=='emptyState')_0x100b4f[_0x4fff48(0x106)]();}),messages[_0x4eb4b2(0x139)]>0x0?(emptyState['style'][_0x4eb4b2(0x116)]=_0x4eb4b2(0x11b),messages['forEach']((_0x520552,_0x10a407)=>chatArea[_0x4eb4b2(0x102)](createMessageElement(_0x520552,_0x10a407)))):emptyState[_0x4eb4b2(0x10b)][_0x4eb4b2(0x116)]=_0x4eb4b2(0xf9),requestAnimationFrame(()=>chatArea[_0x4eb4b2(0x117)]=chatArea[_0x4eb4b2(0x10c)]);}function autoResizeTextarea(){const _0x52f2d6=a0_0x38ee8d;messageInput['style']['height']='auto',messageInput['style'][_0x52f2d6(0x164)]=Math[_0x52f2d6(0x118)](messageInput['scrollHeight'],0x78)+'px';}function a0_0x41c2(){const _0xcd74eb=['div','toString','viewportHeight','offsetHeight','forEach','#050505','role','querySelectorAll','confirmModal','text','key','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','getItem','.container','show','touchstart','viewportChanged','./router.html','flex','search','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','trim','push','now','1128zwnrYv','show-delete','POST','appendChild','function','<br>','href','remove','classList','addEventListener','click','(((.+)+)+)+$','style','scrollHeight','target','isVersionAtLeast','342408dCowhV','disabled','textContent','BackButton','modalText','medium','6.1','display','scrollTop','min','notificationOccurred','json','none','sendBtn','resize','paddingBottom','user','error','Удалить?','chatArea','1165SWqKwY','warn','stringify','ready','.message.show-delete','text/plain','offClick','success','setItem','modalCancel','30mrjfLr','stopPropagation','timestamp','TG\x20setup\x20error:','2260672idZHZM','children','Действие\x20необратимо.','Ошибка\x20сервера','constructor','splice','innerHTML','username','length','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','clearBtn','ai_chat_messages','signal','shiftKey','getElementById','setHeaderColor','touchend','WebApp','input','clear_history','messageInput','Enter','Ошибка\x20сети','inputArea','initDataUnsafe','value','first_name','typingIndicator','apply','from','disableVerticalSwipes','removeItem','className','add','modalConfirm','HapticFeedback','light','onClick','getHours','message\x20ai','impactOccurred','content','Telegram','144140dufJZk','createElement','parse','expand','518940ZVceTa','debug_uid','message-bubble','Пустой\x20ответ','height','floor','2959458AXDLqr','modalTitle','onclick','7588287bCTRyl','padStart'];a0_0x41c2=function(){return _0xcd74eb;};return a0_0x41c2();}function updateSendButton(){const _0x2207a6=a0_0x38ee8d,_0x38c826=messageInput[_0x2207a6(0x14a)][_0x2207a6(0xfc)]();sendBtn[_0x2207a6(0x110)]=!_0x38c826||isTyping;}async function sendMessage(){const _0x45bd62=a0_0x38ee8d,_0x33fda7=messageInput[_0x45bd62(0x14a)][_0x45bd62(0xfc)]();if(!_0x33fda7||isTyping)return;if(tg?.[_0x45bd62(0x154)])tg['HapticFeedback'][_0x45bd62(0x159)](_0x45bd62(0x155));messages[_0x45bd62(0xfd)]({'role':_0x45bd62(0x11f),'content':_0x33fda7,'timestamp':Date[_0x45bd62(0xfe)]()}),localStorage[_0x45bd62(0x12b)](_0x45bd62(0x13c),JSON[_0x45bd62(0x125)](messages)),renderMessages(),messageInput[_0x45bd62(0x14a)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x45bd62(0x102)](createTypingIndicator()),chatArea[_0x45bd62(0x117)]=chatArea[_0x45bd62(0x10c)];const _0x39a177=await callBackend('send_message',{'message':_0x33fda7});isTyping=![];const _0x177e85=document[_0x45bd62(0x13f)](_0x45bd62(0x14c));if(_0x177e85)_0x177e85[_0x45bd62(0x106)]();let _0x3a58d1=_0x45bd62(0x147);if(_0x39a177[_0x45bd62(0x12a)]){_0x3a58d1=_0x39a177[_0x45bd62(0xf0)]||_0x45bd62(0x163);if(tg?.[_0x45bd62(0x154)])tg[_0x45bd62(0x154)][_0x45bd62(0x119)]('success');}else{_0x3a58d1=_0x39a177[_0x45bd62(0x120)]||_0x45bd62(0x134);if(tg?.[_0x45bd62(0x154)])tg['HapticFeedback'][_0x45bd62(0x119)](_0x45bd62(0x120));}messages[_0x45bd62(0xfd)]({'role':'ai','content':_0x3a58d1,'timestamp':Date[_0x45bd62(0xfe)]()}),localStorage[_0x45bd62(0x12b)]('ai_chat_messages',JSON[_0x45bd62(0x125)](messages)),renderMessages();}function confirmDelete(_0x1ab950){const _0x11090c=a0_0x38ee8d;if(mTitle)mTitle['textContent']=_0x11090c(0x121);if(mText)mText[_0x11090c(0x111)]=_0x11090c(0x133);modalCallback=()=>{const _0x1655fe=_0x11090c;messages[_0x1655fe(0x136)](_0x1ab950,0x1),localStorage[_0x1655fe(0x12b)]('ai_chat_messages',JSON[_0x1655fe(0x125)](messages)),renderMessages();},modal['classList'][_0x11090c(0x152)](_0x11090c(0xf5));}if(clearBtn)clearBtn[a0_0x38ee8d(0xe4)]=()=>{const _0x35e856=a0_0x38ee8d;if(!messages[_0x35e856(0x139)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x35e856(0x111)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x46f1c3=_0x35e856;messages=[],localStorage[_0x46f1c3(0x150)](_0x46f1c3(0x13c)),renderMessages(),callBackend(_0x46f1c3(0x144),{});},modal[_0x35e856(0x107)][_0x35e856(0x152)](_0x35e856(0xf5));};document['getElementById'](a0_0x38ee8d(0x12c))[a0_0x38ee8d(0xe4)]=()=>modal[a0_0x38ee8d(0x107)]['remove'](a0_0x38ee8d(0xf5)),document['getElementById'](a0_0x38ee8d(0x153))[a0_0x38ee8d(0xe4)]=()=>{const _0x3fb0c7=a0_0x38ee8d;if(modalCallback)modalCallback();modal[_0x3fb0c7(0x107)][_0x3fb0c7(0x106)](_0x3fb0c7(0xf5));},messageInput[a0_0x38ee8d(0x108)](a0_0x38ee8d(0x143),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x38ee8d(0x108)]('keydown',_0x3dc303=>{const _0x268d9a=a0_0x38ee8d;_0x3dc303[_0x268d9a(0xf1)]===_0x268d9a(0x146)&&!_0x3dc303[_0x268d9a(0x13e)]&&(_0x3dc303['preventDefault'](),sendMessage());}),sendBtn[a0_0x38ee8d(0xe4)]=sendMessage,document['addEventListener'](a0_0x38ee8d(0x109),_0x4f4d0d=>{const _0x252034=a0_0x38ee8d;document[_0x252034(0xee)](_0x252034(0x127))[_0x252034(0xeb)](_0x145092=>{const _0x30ade8=_0x252034;if(!_0x145092['contains'](_0x4f4d0d[_0x30ade8(0x10d)]))_0x145092[_0x30ade8(0x107)][_0x30ade8(0x106)](_0x30ade8(0x100));});});const saved=localStorage[a0_0x38ee8d(0xf3)](a0_0x38ee8d(0x13c));if(saved)try{messages=JSON[a0_0x38ee8d(0x15e)](saved),renderMessages();}catch(a0_0x504cea){}updateSendButton();