const a0_0x26c52c=a0_0x3484;function a0_0x52c5(){const _0x1e91dd=['click','impactOccurred','show','disableVerticalSwipes','typingIndicator','9XIRYZS','appendChild','error','setItem','Ошибка\x20сервера','push','preventDefault','floor','message-time','length','#050505','initDataUnsafe','querySelector','display','remove','viewportHeight','warn','initData','5SIzJpj','getMinutes','224909sjXufy','text/plain','scrollHeight','json','parse','function','toString','onclick','addEventListener','contains','3ziNoMY','message\x20ai','abort','stopPropagation','apply','role','value','BackButton','className','Telegram','messageInput','modalTitle','TG\x20setup\x20error:','debug_uid','Начнется\x20новый\x20диалог.','target','onClick','offsetHeight','random','style','modalCancel','innerHTML','paddingBottom','2472974XWSTAO','auto','getElementById','scrollTop','success','modalText','none','innerHeight','replace','delete-btn','sendBtn','height','padStart','keydown','from','512206OoyRzX','content','./router.html','modalConfirm','inputArea','textContent','resize','1237848hlYqDV','HapticFeedback','1390080jMIooy','touchstart','send_message','first_name','clearBtn','6.1','17569420Abupwh','classList','onEvent','ai_chat_messages','stringify','offClick','timestamp','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','touchend','light','createElement','forEach','querySelectorAll','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','clear_history','add','search','shiftKey','href','(((.+)+)+)+$','focus','disabled','min','message-bubble','<br>','input','expand','emptyState','div','isVersionAtLeast','933654gQAYKU','show-delete','now','getItem','Удалить?','Действие\x20необратимо.','key'];a0_0x52c5=function(){return _0x1e91dd;};return a0_0x52c5();}(function(_0x448b61,_0x26ef46){const _0x2f32ef=a0_0x3484,_0x10f5fb=_0x448b61();while(!![]){try{const _0x497ae7=-parseInt(_0x2f32ef(0x14e))/0x1+-parseInt(_0x2f32ef(0x17e))/0x2*(parseInt(_0x2f32ef(0x158))/0x3)+-parseInt(_0x2f32ef(0x187))/0x4*(parseInt(_0x2f32ef(0x14c))/0x5)+-parseInt(_0x2f32ef(0x12e))/0x6+-parseInt(_0x2f32ef(0x16f))/0x7+parseInt(_0x2f32ef(0x185))/0x8*(-parseInt(_0x2f32ef(0x13a))/0x9)+parseInt(_0x2f32ef(0x18d))/0xa;if(_0x497ae7===_0x26ef46)break;else _0x10f5fb['push'](_0x10f5fb['shift']());}catch(_0x592792){_0x10f5fb['push'](_0x10f5fb['shift']());}}}(a0_0x52c5,0x40a54));const tg=window[a0_0x26c52c(0x161)]?.['WebApp'],HOME_URL=a0_0x26c52c(0x180);function setupTelegramBackButton(){const _0x451a08=a0_0x26c52c,_0x427d2f=(function(){let _0x3a1823=!![];return function(_0x115ddc,_0x4272ee){const _0x292ab4=_0x3a1823?function(){const _0x54b2ac=a0_0x3484;if(_0x4272ee){const _0x9b5a8c=_0x4272ee[_0x54b2ac(0x15c)](_0x115ddc,arguments);return _0x4272ee=null,_0x9b5a8c;}}:function(){};return _0x3a1823=![],_0x292ab4;};}()),_0x5d0be6=_0x427d2f(this,function(){const _0xac73af=a0_0x3484;return _0x5d0be6[_0xac73af(0x154)]()[_0xac73af(0x19d)]('(((.+)+)+)+$')[_0xac73af(0x154)]()['constructor'](_0x5d0be6)[_0xac73af(0x19d)](_0xac73af(0x1a0));});_0x5d0be6();if(!tg)return;try{tg['ready'](),tg[_0x451a08(0x1a7)](),tg['setHeaderColor']?.(_0x451a08(0x144));if(tg[_0x451a08(0x12d)]?.(_0x451a08(0x18c)))tg[_0x451a08(0x138)]?.();const _0x418e1f=tg[_0x451a08(0x15f)];if(_0x418e1f){_0x418e1f['show']();if(typeof _0x418e1f[_0x451a08(0x192)]===_0x451a08(0x153))try{_0x418e1f[_0x451a08(0x192)]();}catch(_0x10a652){}_0x418e1f[_0x451a08(0x168)](()=>{const _0x555a7f=_0x451a08;if(tg[_0x555a7f(0x186)])tg[_0x555a7f(0x186)][_0x555a7f(0x136)](_0x555a7f(0x196));location[_0x555a7f(0x19f)]=HOME_URL;});}}catch(_0x1b1d75){console[_0x451a08(0x14a)](_0x451a08(0x164),_0x1b1d75);}}(function initStableLayout(){const _0x5d0adc=a0_0x26c52c,_0xaa1f6f=document[_0x5d0adc(0x146)]('.container'),_0x4038dc=document['getElementById'](_0x5d0adc(0x182)),_0xde7139=document[_0x5d0adc(0x171)]('chatArea'),_0x344b7e=document['getElementById'](_0x5d0adc(0x162));function _0x26de2c(){const _0x35882d=_0x5d0adc;if(!_0xaa1f6f)return;const _0xeaa33b=tg&&tg['viewportHeight']?tg[_0x35882d(0x149)]:window[_0x35882d(0x176)];_0xaa1f6f[_0x35882d(0x16b)]['height']=_0xeaa33b+'px';if(_0x4038dc){const _0xaf94b2=_0x4038dc[_0x35882d(0x169)];_0xde7139[_0x35882d(0x16b)][_0x35882d(0x16e)]=_0xaf94b2+0x28+'px';}}tg?tg[_0x5d0adc(0x18f)]('viewportChanged',({isStateStable:_0x4c2a40})=>{_0x26de2c();if(_0x4c2a40)requestAnimationFrame(()=>{const _0x5ab3a1=a0_0x3484;_0xde7139[_0x5ab3a1(0x172)]=_0xde7139['scrollHeight'];});}):window[_0x5d0adc(0x156)](_0x5d0adc(0x184),_0x26de2c),_0x26de2c(),_0x344b7e&&(_0x344b7e[_0x5d0adc(0x156)]('input',()=>{requestAnimationFrame(_0x26de2c);}),_0x344b7e['addEventListener'](_0x5d0adc(0x1a1),()=>{setTimeout(()=>{const _0x2d9d06=a0_0x3484;_0xde7139['scrollTop']=_0xde7139[_0x2d9d06(0x150)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x26c52c(0x194),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x26c52c(0x171)]('chatArea'),emptyState=document[a0_0x26c52c(0x171)](a0_0x26c52c(0x1a8)),messageInput=document[a0_0x26c52c(0x171)](a0_0x26c52c(0x162)),sendBtn=document[a0_0x26c52c(0x171)](a0_0x26c52c(0x179)),clearBtn=document['getElementById'](a0_0x26c52c(0x18b)),modal=document[a0_0x26c52c(0x171)]('confirmModal'),mTitle=document[a0_0x26c52c(0x171)](a0_0x26c52c(0x163)),mText=document[a0_0x26c52c(0x171)](a0_0x26c52c(0x174));let modalCallback=null;async function callBackend(_0x42449a,_0x29423c){const _0x5cde63=a0_0x26c52c,_0x5e3464=tg?.[_0x5cde63(0x145)]?.['user']||{},_0x39fd74=_0x5e3464['id']||localStorage[_0x5cde63(0x131)](_0x5cde63(0x165))||'d-'+Math[_0x5cde63(0x141)](Math[_0x5cde63(0x16a)]()*0x3b9aca00);if(!_0x5e3464['id'])localStorage[_0x5cde63(0x13d)]('debug_uid',_0x39fd74);const _0xb29979={'action':_0x42449a,'user_id':_0x39fd74,'user_data':{'first_name':_0x5e3464[_0x5cde63(0x18a)],'username':_0x5e3464['username']},'init_data':tg?.[_0x5cde63(0x14b)]||'',..._0x29423c},_0x3e1579=new AbortController(),_0x2c96b8=setTimeout(()=>_0x3e1579[_0x5cde63(0x15a)](),REQUEST_TIMEOUT_MS);try{const _0x5e28f1=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x5cde63(0x14f)},'body':JSON[_0x5cde63(0x191)](_0xb29979),'signal':_0x3e1579['signal']});return clearTimeout(_0x2c96b8),await _0x5e28f1[_0x5cde63(0x151)]();}catch(_0x3c4573){return{'success':![],'error':String(_0x3c4573)};}}function formatTime(_0x43a179){const _0x4570d3=a0_0x26c52c,_0x5ae3df=new Date(_0x43a179);return String(_0x5ae3df['getHours']())[_0x4570d3(0x17b)](0x2,'0')+':'+String(_0x5ae3df[_0x4570d3(0x14d)]())[_0x4570d3(0x17b)](0x2,'0');}function createMessageElement(_0x2dd2ce,_0x572c0b){const _0x5a8525=a0_0x26c52c,_0x1b1eb2=document[_0x5a8525(0x197)]('div');_0x1b1eb2['className']='message\x20'+_0x2dd2ce[_0x5a8525(0x15d)];const _0x32d775=document[_0x5a8525(0x197)](_0x5a8525(0x12c));_0x32d775['className']=_0x5a8525(0x1a4),_0x32d775['innerHTML']=_0x2dd2ce[_0x5a8525(0x17f)][_0x5a8525(0x177)](/\n/g,_0x5a8525(0x1a5));const _0x159ee0=document['createElement']('div');_0x159ee0[_0x5a8525(0x160)]=_0x5a8525(0x178),_0x159ee0['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x159ee0[_0x5a8525(0x155)]=_0x827bec=>{const _0x2564a7=_0x5a8525;_0x827bec[_0x2564a7(0x15b)](),confirmDelete(_0x572c0b);};let _0x2ca931;_0x32d775['addEventListener'](_0x5a8525(0x188),()=>_0x2ca931=setTimeout(()=>{const _0x4efabc=_0x5a8525;_0x1b1eb2[_0x4efabc(0x18e)][_0x4efabc(0x19c)]('show-delete');if(tg?.[_0x4efabc(0x186)])tg[_0x4efabc(0x186)][_0x4efabc(0x136)]('medium');},0x1f4)),_0x32d775['addEventListener'](_0x5a8525(0x195),()=>clearTimeout(_0x2ca931));const _0xd04a5e=document['createElement']('div');return _0xd04a5e[_0x5a8525(0x160)]=_0x5a8525(0x142),_0xd04a5e[_0x5a8525(0x183)]=formatTime(_0x2dd2ce[_0x5a8525(0x193)]),_0x1b1eb2['appendChild'](_0x159ee0),_0x1b1eb2[_0x5a8525(0x13b)](_0x32d775),_0x1b1eb2[_0x5a8525(0x13b)](_0xd04a5e),_0x1b1eb2;}function createTypingIndicator(){const _0x46340a=a0_0x26c52c,_0x54ed5d=document[_0x46340a(0x197)](_0x46340a(0x12c));return _0x54ed5d[_0x46340a(0x160)]=_0x46340a(0x159),_0x54ed5d['id']=_0x46340a(0x139),_0x54ed5d[_0x46340a(0x16d)]=_0x46340a(0x19a),_0x54ed5d;}function renderMessages(){const _0x3f6690=a0_0x26c52c;Array[_0x3f6690(0x17d)](chatArea['children'])[_0x3f6690(0x198)](_0x750a9a=>{const _0x377727=_0x3f6690;if(_0x750a9a['id']!==_0x377727(0x1a8))_0x750a9a[_0x377727(0x148)]();}),messages[_0x3f6690(0x143)]>0x0?(emptyState[_0x3f6690(0x16b)]['display']=_0x3f6690(0x175),messages[_0x3f6690(0x198)]((_0x598dd6,_0x4f5e47)=>chatArea[_0x3f6690(0x13b)](createMessageElement(_0x598dd6,_0x4f5e47)))):emptyState['style'][_0x3f6690(0x147)]='flex',requestAnimationFrame(()=>chatArea[_0x3f6690(0x172)]=chatArea[_0x3f6690(0x150)]);}function autoResizeTextarea(){const _0x2b8303=a0_0x26c52c;messageInput[_0x2b8303(0x16b)][_0x2b8303(0x17a)]=_0x2b8303(0x170),messageInput['style'][_0x2b8303(0x17a)]=Math[_0x2b8303(0x1a3)](messageInput[_0x2b8303(0x150)],0x78)+'px';}function updateSendButton(){const _0x422567=a0_0x26c52c,_0x11443e=messageInput[_0x422567(0x15e)]['trim']();sendBtn[_0x422567(0x1a2)]=!_0x11443e||isTyping;}async function sendMessage(){const _0x3601ee=a0_0x26c52c,_0x251a46=messageInput[_0x3601ee(0x15e)]['trim']();if(!_0x251a46||isTyping)return;if(tg?.[_0x3601ee(0x186)])tg[_0x3601ee(0x186)][_0x3601ee(0x136)](_0x3601ee(0x196));messages['push']({'role':'user','content':_0x251a46,'timestamp':Date['now']()}),localStorage[_0x3601ee(0x13d)](_0x3601ee(0x190),JSON['stringify'](messages)),renderMessages(),messageInput[_0x3601ee(0x15e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x3601ee(0x13b)](createTypingIndicator()),chatArea[_0x3601ee(0x172)]=chatArea[_0x3601ee(0x150)];const _0x479850=await callBackend(_0x3601ee(0x189),{'message':_0x251a46});isTyping=![];const _0x1331a4=document[_0x3601ee(0x171)]('typingIndicator');if(_0x1331a4)_0x1331a4[_0x3601ee(0x148)]();let _0x1a1e83='Ошибка\x20сети';if(_0x479850['success']){_0x1a1e83=_0x479850['text']||'Пустой\x20ответ';if(tg?.[_0x3601ee(0x186)])tg['HapticFeedback']['notificationOccurred'](_0x3601ee(0x173));}else{_0x1a1e83=_0x479850[_0x3601ee(0x13c)]||_0x3601ee(0x13e);if(tg?.[_0x3601ee(0x186)])tg[_0x3601ee(0x186)]['notificationOccurred'](_0x3601ee(0x13c));}messages[_0x3601ee(0x13f)]({'role':'ai','content':_0x1a1e83,'timestamp':Date[_0x3601ee(0x130)]()}),localStorage[_0x3601ee(0x13d)](_0x3601ee(0x190),JSON[_0x3601ee(0x191)](messages)),renderMessages();}function a0_0x3484(_0x50f321,_0x4e52fd){_0x50f321=_0x50f321-0x12c;const _0x47b93e=a0_0x52c5();let _0x4c1724=_0x47b93e[_0x50f321];return _0x4c1724;}function confirmDelete(_0x168843){const _0x454ae9=a0_0x26c52c;if(mTitle)mTitle[_0x454ae9(0x183)]=_0x454ae9(0x132);if(mText)mText[_0x454ae9(0x183)]=_0x454ae9(0x133);modalCallback=()=>{const _0xc1e83f=_0x454ae9;messages['splice'](_0x168843,0x1),localStorage[_0xc1e83f(0x13d)](_0xc1e83f(0x190),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x454ae9(0x19c)](_0x454ae9(0x137));}if(clearBtn)clearBtn['onclick']=()=>{const _0x31b58b=a0_0x26c52c;if(!messages[_0x31b58b(0x143)])return;if(mTitle)mTitle[_0x31b58b(0x183)]='Очистить\x20историю?';if(mText)mText[_0x31b58b(0x183)]=_0x31b58b(0x166);modalCallback=async()=>{const _0x15c268=_0x31b58b;messages=[],localStorage['removeItem'](_0x15c268(0x190)),renderMessages(),callBackend(_0x15c268(0x19b),{});},modal[_0x31b58b(0x18e)][_0x31b58b(0x19c)]('show');};document[a0_0x26c52c(0x171)](a0_0x26c52c(0x16c))[a0_0x26c52c(0x155)]=()=>modal[a0_0x26c52c(0x18e)][a0_0x26c52c(0x148)](a0_0x26c52c(0x137)),document[a0_0x26c52c(0x171)](a0_0x26c52c(0x181))[a0_0x26c52c(0x155)]=()=>{const _0x382fe7=a0_0x26c52c;if(modalCallback)modalCallback();modal[_0x382fe7(0x18e)][_0x382fe7(0x148)]('show');},messageInput[a0_0x26c52c(0x156)](a0_0x26c52c(0x1a6),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x26c52c(0x156)](a0_0x26c52c(0x17c),_0x246a90=>{const _0x5628fa=a0_0x26c52c;_0x246a90[_0x5628fa(0x134)]==='Enter'&&!_0x246a90[_0x5628fa(0x19e)]&&(_0x246a90[_0x5628fa(0x140)](),sendMessage());}),sendBtn[a0_0x26c52c(0x155)]=sendMessage,document[a0_0x26c52c(0x156)](a0_0x26c52c(0x135),_0x1b63be=>{const _0x89790=a0_0x26c52c;document[_0x89790(0x199)]('.message.show-delete')[_0x89790(0x198)](_0x3af0de=>{const _0x42b35d=_0x89790;if(!_0x3af0de[_0x42b35d(0x157)](_0x1b63be[_0x42b35d(0x167)]))_0x3af0de['classList'][_0x42b35d(0x148)](_0x42b35d(0x12f));});});const saved=localStorage[a0_0x26c52c(0x131)](a0_0x26c52c(0x190));if(saved)try{messages=JSON[a0_0x26c52c(0x152)](saved),renderMessages();}catch(a0_0x5431bd){}updateSendButton();