const a0_0x41211c=a0_0x1bea;(function(_0x2a238e,_0x3e5da7){const _0x2be599=a0_0x1bea,_0x1c7b3d=_0x2a238e();while(!![]){try{const _0x1c8ffb=-parseInt(_0x2be599(0x1f3))/0x1*(-parseInt(_0x2be599(0x1fb))/0x2)+parseInt(_0x2be599(0x254))/0x3+-parseInt(_0x2be599(0x25b))/0x4*(parseInt(_0x2be599(0x239))/0x5)+-parseInt(_0x2be599(0x1fd))/0x6*(-parseInt(_0x2be599(0x241))/0x7)+-parseInt(_0x2be599(0x1eb))/0x8+parseInt(_0x2be599(0x21d))/0x9*(parseInt(_0x2be599(0x20d))/0xa)+-parseInt(_0x2be599(0x211))/0xb*(parseInt(_0x2be599(0x204))/0xc);if(_0x1c8ffb===_0x3e5da7)break;else _0x1c7b3d['push'](_0x1c7b3d['shift']());}catch(_0xd837ab){_0x1c7b3d['push'](_0x1c7b3d['shift']());}}}(a0_0x485d,0xb763b));const tg=window[a0_0x41211c(0x20f)]?.[a0_0x41211c(0x1f8)],HOME_URL=a0_0x41211c(0x20c);function setupTelegramBackButton(){const _0x3a80c1=a0_0x41211c,_0x325a34=(function(){let _0x402b39=!![];return function(_0x4a4049,_0x2b51f7){const _0x4bd988=_0x402b39?function(){const _0x1e41e1=a0_0x1bea;if(_0x2b51f7){const _0x2b0a55=_0x2b51f7[_0x1e41e1(0x253)](_0x4a4049,arguments);return _0x2b51f7=null,_0x2b0a55;}}:function(){};return _0x402b39=![],_0x4bd988;};}()),_0x1d0ac4=_0x325a34(this,function(){const _0x2e7f66=a0_0x1bea;return _0x1d0ac4['toString']()[_0x2e7f66(0x210)](_0x2e7f66(0x23b))['toString']()[_0x2e7f66(0x236)](_0x1d0ac4)[_0x2e7f66(0x210)](_0x2e7f66(0x23b));});_0x1d0ac4();if(!tg)return;try{tg[_0x3a80c1(0x244)](),tg[_0x3a80c1(0x267)](),tg[_0x3a80c1(0x208)]?.(_0x3a80c1(0x223));if(tg[_0x3a80c1(0x207)]?.(_0x3a80c1(0x230)))tg[_0x3a80c1(0x233)]?.();const _0x13cd3d=tg['BackButton'];if(_0x13cd3d){_0x13cd3d[_0x3a80c1(0x242)]();if(typeof _0x13cd3d[_0x3a80c1(0x247)]===_0x3a80c1(0x24d))try{_0x13cd3d[_0x3a80c1(0x247)]();}catch(_0xe9bbb7){}_0x13cd3d[_0x3a80c1(0x25a)](()=>{const _0x25d375=_0x3a80c1;if(tg['HapticFeedback'])tg[_0x25d375(0x1e7)]['impactOccurred'](_0x25d375(0x226));location['href']=HOME_URL;});}}catch(_0x45062d){console[_0x3a80c1(0x216)](_0x3a80c1(0x259),_0x45062d);}}(function initStableLayout(){const _0x5299a7=a0_0x41211c,_0x34e42d=document[_0x5299a7(0x237)](_0x5299a7(0x231)),_0x10f185=document[_0x5299a7(0x1e8)](_0x5299a7(0x25d)),_0x54235e=document['getElementById']('chatArea'),_0x4b2659=document['getElementById'](_0x5299a7(0x24a));function _0x18ce5e(){const _0x2d4389=_0x5299a7;if(!_0x34e42d)return;const _0x28dda7=tg&&tg[_0x2d4389(0x1e4)]?tg[_0x2d4389(0x1e4)]:window['innerHeight'];_0x34e42d['style'][_0x2d4389(0x1e6)]=_0x28dda7+'px';if(_0x10f185){const _0x5bdb36=_0x10f185[_0x2d4389(0x232)];_0x54235e[_0x2d4389(0x1f9)][_0x2d4389(0x22a)]=_0x5bdb36+0x28+'px';}}tg?tg[_0x5299a7(0x23c)](_0x5299a7(0x203),({isStateStable:_0x2edfd7})=>{_0x18ce5e();if(_0x2edfd7)requestAnimationFrame(()=>{const _0x2e282f=a0_0x1bea;_0x54235e[_0x2e282f(0x257)]=_0x54235e[_0x2e282f(0x209)];});}):window[_0x5299a7(0x1f7)](_0x5299a7(0x23e),_0x18ce5e),_0x18ce5e(),_0x4b2659&&(_0x4b2659[_0x5299a7(0x1f7)](_0x5299a7(0x200),()=>{requestAnimationFrame(_0x18ce5e);}),_0x4b2659['addEventListener'](_0x5299a7(0x1f1),()=>{setTimeout(()=>{const _0x2060e9=a0_0x1bea;_0x54235e['scrollTop']=_0x54235e[_0x2060e9(0x209)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x41211c(0x1e8)](a0_0x41211c(0x20a)),emptyState=document['getElementById'](a0_0x41211c(0x264)),messageInput=document[a0_0x41211c(0x1e8)]('messageInput'),sendBtn=document[a0_0x41211c(0x1e8)]('sendBtn'),clearBtn=document[a0_0x41211c(0x1e8)](a0_0x41211c(0x222)),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0x41211c(0x1e8)](a0_0x41211c(0x25c)),mText=document[a0_0x41211c(0x1e8)](a0_0x41211c(0x205));let modalCallback=null;async function callBackend(_0x5d64e2,_0x362d1e){const _0x219e7b=a0_0x41211c,_0x93ddaa=tg?.[_0x219e7b(0x235)]?.['user']||{},_0x3f6448=_0x93ddaa['id']||localStorage[_0x219e7b(0x1f5)](_0x219e7b(0x229))||'d-'+Math[_0x219e7b(0x25e)](Math[_0x219e7b(0x220)]()*0x3b9aca00);if(!_0x93ddaa['id'])localStorage[_0x219e7b(0x1fc)](_0x219e7b(0x229),_0x3f6448);const _0x5db0ee={'action':_0x5d64e2,'user_id':_0x3f6448,'user_data':{'first_name':_0x93ddaa[_0x219e7b(0x1ff)],'username':_0x93ddaa['username']},'init_data':tg?.[_0x219e7b(0x21b)]||'',..._0x362d1e},_0x5e0bba=new AbortController(),_0xe36f8=setTimeout(()=>_0x5e0bba['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3cc315=await fetch(BACKEND_URL,{'method':_0x219e7b(0x218),'headers':{'Content-Type':_0x219e7b(0x1fa)},'body':JSON[_0x219e7b(0x1ef)](_0x5db0ee),'signal':_0x5e0bba['signal']});return clearTimeout(_0xe36f8),await _0x3cc315[_0x219e7b(0x1fe)]();}catch(_0x973cc9){return{'success':![],'error':String(_0x973cc9)};}}function a0_0x485d(){const _0x2930b8=['from','focus','forEach','8Naqslx','error','getItem','medium','addEventListener','WebApp','style','text/plain','72342OYZRqu','setItem','18dHpbhP','json','first_name','input','message\x20ai','clear_history','viewportChanged','1140qixCNr','modalText','onclick','isVersionAtLeast','setHeaderColor','scrollHeight','chatArea','Начнется\x20новый\x20диалог.','./router.html','5852310vcMyTX','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Telegram','search','21043DJusGC','content','preventDefault','className','createElement','warn','send_message','POST','none','contains','initData','ai_chat_messages','9wzBesd','classList','modalConfirm','random','getMinutes','clearBtn','#050505','shiftKey','Ошибка\x20сети','light','touchstart','push','debug_uid','paddingBottom','keydown','role','impactOccurred','length','Действие\x20необратимо.','6.1','.container','offsetHeight','disableVerticalSwipes','padStart','initDataUnsafe','constructor','querySelector','timestamp','535rBKkFQ','add','(((.+)+)+)+$','onEvent','.message.show-delete','resize','Enter','click','2432577miqmqh','show','innerHTML','ready','value','parse','offClick','Ошибка\x20сервера','replace','messageInput','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','textContent','function','<br>','div','target','now','key','apply','1531554TTeFjC','flex','auto','scrollTop','touchend','TG\x20setup\x20error:','onClick','43564jhjZRf','modalTitle','inputArea','floor','Удалить?','typingIndicator','notificationOccurred','querySelectorAll','Пустой\x20ответ','emptyState','disabled','stopPropagation','expand','remove','trim','success','viewportHeight','delete-btn','height','HapticFeedback','getElementById','text','message-bubble','2635320slCBuo','appendChild','message\x20','modalCancel','stringify'];a0_0x485d=function(){return _0x2930b8;};return a0_0x485d();}function formatTime(_0x3b4611){const _0x602e60=a0_0x41211c,_0x1d48b6=new Date(_0x3b4611);return String(_0x1d48b6['getHours']())[_0x602e60(0x234)](0x2,'0')+':'+String(_0x1d48b6[_0x602e60(0x221)]())[_0x602e60(0x234)](0x2,'0');}function createMessageElement(_0x3a84e9,_0x3bc8ad){const _0x33defd=a0_0x41211c,_0x5e5581=document[_0x33defd(0x215)](_0x33defd(0x24f));_0x5e5581[_0x33defd(0x214)]=_0x33defd(0x1ed)+_0x3a84e9[_0x33defd(0x22c)];const _0x182b46=document['createElement'](_0x33defd(0x24f));_0x182b46[_0x33defd(0x214)]=_0x33defd(0x1ea),_0x182b46[_0x33defd(0x243)]=_0x3a84e9[_0x33defd(0x212)][_0x33defd(0x249)](/\n/g,_0x33defd(0x24e));const _0x386389=document['createElement'](_0x33defd(0x24f));_0x386389[_0x33defd(0x214)]=_0x33defd(0x1e5),_0x386389['innerHTML']=_0x33defd(0x20e),_0x386389[_0x33defd(0x206)]=_0x24632a=>{const _0x8d03b1=_0x33defd;_0x24632a[_0x8d03b1(0x266)](),confirmDelete(_0x3bc8ad);};let _0x53d7cd;_0x182b46[_0x33defd(0x1f7)](_0x33defd(0x227),()=>_0x53d7cd=setTimeout(()=>{const _0x1236ce=_0x33defd;_0x5e5581[_0x1236ce(0x21e)][_0x1236ce(0x23a)]('show-delete');if(tg?.[_0x1236ce(0x1e7)])tg[_0x1236ce(0x1e7)]['impactOccurred'](_0x1236ce(0x1f6));},0x1f4)),_0x182b46[_0x33defd(0x1f7)](_0x33defd(0x258),()=>clearTimeout(_0x53d7cd));const _0x37ff81=document[_0x33defd(0x215)](_0x33defd(0x24f));return _0x37ff81[_0x33defd(0x214)]='message-time',_0x37ff81[_0x33defd(0x24c)]=formatTime(_0x3a84e9[_0x33defd(0x238)]),_0x5e5581[_0x33defd(0x1ec)](_0x386389),_0x5e5581[_0x33defd(0x1ec)](_0x182b46),_0x5e5581[_0x33defd(0x1ec)](_0x37ff81),_0x5e5581;}function createTypingIndicator(){const _0x518f26=a0_0x41211c,_0x2b4768=document[_0x518f26(0x215)]('div');return _0x2b4768['className']=_0x518f26(0x201),_0x2b4768['id']='typingIndicator',_0x2b4768[_0x518f26(0x243)]=_0x518f26(0x24b),_0x2b4768;}function renderMessages(){const _0x374a8c=a0_0x41211c;Array[_0x374a8c(0x1f0)](chatArea['children'])[_0x374a8c(0x1f2)](_0x216110=>{const _0x5411d6=_0x374a8c;if(_0x216110['id']!==_0x5411d6(0x264))_0x216110[_0x5411d6(0x268)]();}),messages[_0x374a8c(0x22e)]>0x0?(emptyState[_0x374a8c(0x1f9)]['display']=_0x374a8c(0x219),messages['forEach']((_0x5dfa3e,_0x8ed5af)=>chatArea[_0x374a8c(0x1ec)](createMessageElement(_0x5dfa3e,_0x8ed5af)))):emptyState[_0x374a8c(0x1f9)]['display']=_0x374a8c(0x255),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x279eab=a0_0x41211c;messageInput[_0x279eab(0x1f9)]['height']=_0x279eab(0x256),messageInput[_0x279eab(0x1f9)][_0x279eab(0x1e6)]=Math['min'](messageInput[_0x279eab(0x209)],0x78)+'px';}function updateSendButton(){const _0x177475=a0_0x41211c,_0x2ba43c=messageInput[_0x177475(0x245)][_0x177475(0x269)]();sendBtn[_0x177475(0x265)]=!_0x2ba43c||isTyping;}async function sendMessage(){const _0xcf3ede=a0_0x41211c,_0x41b499=messageInput['value']['trim']();if(!_0x41b499||isTyping)return;if(tg?.[_0xcf3ede(0x1e7)])tg['HapticFeedback'][_0xcf3ede(0x22d)]('light');messages[_0xcf3ede(0x228)]({'role':'user','content':_0x41b499,'timestamp':Date[_0xcf3ede(0x251)]()}),localStorage['setItem'](_0xcf3ede(0x21c),JSON[_0xcf3ede(0x1ef)](messages)),renderMessages(),messageInput[_0xcf3ede(0x245)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xcf3ede(0x1ec)](createTypingIndicator()),chatArea[_0xcf3ede(0x257)]=chatArea['scrollHeight'];const _0x55077f=await callBackend(_0xcf3ede(0x217),{'message':_0x41b499});isTyping=![];const _0x32b82c=document['getElementById'](_0xcf3ede(0x260));if(_0x32b82c)_0x32b82c[_0xcf3ede(0x268)]();let _0x40962e=_0xcf3ede(0x225);if(_0x55077f[_0xcf3ede(0x1e3)]){_0x40962e=_0x55077f[_0xcf3ede(0x1e9)]||_0xcf3ede(0x263);if(tg?.[_0xcf3ede(0x1e7)])tg[_0xcf3ede(0x1e7)][_0xcf3ede(0x261)](_0xcf3ede(0x1e3));}else{_0x40962e=_0x55077f[_0xcf3ede(0x1f4)]||_0xcf3ede(0x248);if(tg?.[_0xcf3ede(0x1e7)])tg['HapticFeedback']['notificationOccurred'](_0xcf3ede(0x1f4));}messages[_0xcf3ede(0x228)]({'role':'ai','content':_0x40962e,'timestamp':Date[_0xcf3ede(0x251)]()}),localStorage[_0xcf3ede(0x1fc)](_0xcf3ede(0x21c),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x3377cd){const _0x1deae6=a0_0x41211c;if(mTitle)mTitle[_0x1deae6(0x24c)]=_0x1deae6(0x25f);if(mText)mText[_0x1deae6(0x24c)]=_0x1deae6(0x22f);modalCallback=()=>{const _0x3d4e0e=_0x1deae6;messages['splice'](_0x3377cd,0x1),localStorage[_0x3d4e0e(0x1fc)](_0x3d4e0e(0x21c),JSON[_0x3d4e0e(0x1ef)](messages)),renderMessages();},modal['classList'][_0x1deae6(0x23a)](_0x1deae6(0x242));}if(clearBtn)clearBtn[a0_0x41211c(0x206)]=()=>{const _0x36be3e=a0_0x41211c;if(!messages[_0x36be3e(0x22e)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x36be3e(0x24c)]=_0x36be3e(0x20b);modalCallback=async()=>{const _0x1e1ca9=_0x36be3e;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x1e1ca9(0x202),{});},modal['classList'][_0x36be3e(0x23a)](_0x36be3e(0x242));};document['getElementById'](a0_0x41211c(0x1ee))[a0_0x41211c(0x206)]=()=>modal[a0_0x41211c(0x21e)]['remove']('show'),document[a0_0x41211c(0x1e8)](a0_0x41211c(0x21f))[a0_0x41211c(0x206)]=()=>{const _0x3e4087=a0_0x41211c;if(modalCallback)modalCallback();modal[_0x3e4087(0x21e)][_0x3e4087(0x268)](_0x3e4087(0x242));},messageInput[a0_0x41211c(0x1f7)](a0_0x41211c(0x200),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x41211c(0x1f7)](a0_0x41211c(0x22b),_0x88615d=>{const _0x4ad526=a0_0x41211c;_0x88615d[_0x4ad526(0x252)]===_0x4ad526(0x23f)&&!_0x88615d[_0x4ad526(0x224)]&&(_0x88615d[_0x4ad526(0x213)](),sendMessage());}),sendBtn[a0_0x41211c(0x206)]=sendMessage,document[a0_0x41211c(0x1f7)](a0_0x41211c(0x240),_0x2e984e=>{const _0x17f229=a0_0x41211c;document[_0x17f229(0x262)](_0x17f229(0x23d))[_0x17f229(0x1f2)](_0x2a5d53=>{const _0x1cced1=_0x17f229;if(!_0x2a5d53[_0x1cced1(0x21a)](_0x2e984e[_0x1cced1(0x250)]))_0x2a5d53['classList'][_0x1cced1(0x268)]('show-delete');});});const saved=localStorage[a0_0x41211c(0x1f5)](a0_0x41211c(0x21c));function a0_0x1bea(_0x538b41,_0x19e678){_0x538b41=_0x538b41-0x1e3;const _0x5aba3f=a0_0x485d();let _0x36eee5=_0x5aba3f[_0x538b41];return _0x36eee5;}if(saved)try{messages=JSON[a0_0x41211c(0x246)](saved),renderMessages();}catch(a0_0x1700bf){}updateSendButton();