const a0_0x1d6c25=a0_0x3d41;(function(_0x5e94a3,_0x3382c1){const _0xd79600=a0_0x3d41,_0x199a1a=_0x5e94a3();while(!![]){try{const _0x4797ed=parseInt(_0xd79600(0x11e))/0x1*(parseInt(_0xd79600(0x138))/0x2)+parseInt(_0xd79600(0x189))/0x3+-parseInt(_0xd79600(0x128))/0x4+-parseInt(_0xd79600(0x11b))/0x5*(parseInt(_0xd79600(0x16a))/0x6)+-parseInt(_0xd79600(0x17c))/0x7*(-parseInt(_0xd79600(0x16f))/0x8)+-parseInt(_0xd79600(0x15e))/0x9*(parseInt(_0xd79600(0x17d))/0xa)+parseInt(_0xd79600(0x114))/0xb;if(_0x4797ed===_0x3382c1)break;else _0x199a1a['push'](_0x199a1a['shift']());}catch(_0x1e8754){_0x199a1a['push'](_0x199a1a['shift']());}}}(a0_0x32e5,0x1a175));const tg=window[a0_0x1d6c25(0x169)]?.['WebApp'],HOME_URL=a0_0x1d6c25(0x143);function setupTelegramBackButton(){const _0x3512d4=a0_0x1d6c25;if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x3512d4(0x122)]?.(_0x3512d4(0x107));if(tg[_0x3512d4(0x134)]?.('6.1'))tg[_0x3512d4(0x14b)]?.();const _0x1af602=tg[_0x3512d4(0x154)];if(_0x1af602){_0x1af602[_0x3512d4(0x153)]();if(typeof _0x1af602[_0x3512d4(0x10b)]===_0x3512d4(0x173))try{_0x1af602['offClick']();}catch(_0x56ba80){}_0x1af602[_0x3512d4(0x124)](()=>{const _0x2a5d32=_0x3512d4;if(tg[_0x2a5d32(0x117)])tg[_0x2a5d32(0x117)][_0x2a5d32(0x158)](_0x2a5d32(0x129));location[_0x2a5d32(0x113)]=HOME_URL;});}}catch(_0xca9d31){console[_0x3512d4(0x16e)](_0x3512d4(0x11c),_0xca9d31);}}(function initStableLayout(){const _0x2a7dba=a0_0x1d6c25,_0x2b9cb2=(function(){let _0x1e6ca5=!![];return function(_0x10c220,_0x5570ff){const _0x5f3b5d=_0x1e6ca5?function(){const _0x54c3c4=a0_0x3d41;if(_0x5570ff){const _0x190d29=_0x5570ff[_0x54c3c4(0x162)](_0x10c220,arguments);return _0x5570ff=null,_0x190d29;}}:function(){};return _0x1e6ca5=![],_0x5f3b5d;};}()),_0x41bb0f=document['querySelector'](_0x2a7dba(0x16c)),_0x4e25fa=document[_0x2a7dba(0x155)](_0x2a7dba(0x149)),_0x19d38b=document[_0x2a7dba(0x155)](_0x2a7dba(0x146)),_0x8f39b7=document[_0x2a7dba(0x155)](_0x2a7dba(0x185));function _0x372cb1(){const _0x1625c2=_0x2a7dba,_0x48a1f7=_0x2b9cb2(this,function(){const _0x6fd3b5=a0_0x3d41;return _0x48a1f7[_0x6fd3b5(0x133)]()[_0x6fd3b5(0x13a)]('(((.+)+)+)+$')['toString']()['constructor'](_0x48a1f7)[_0x6fd3b5(0x13a)](_0x6fd3b5(0x16d));});_0x48a1f7();if(!_0x41bb0f)return;const _0x50be1e=tg&&tg[_0x1625c2(0x166)]?tg[_0x1625c2(0x166)]:window[_0x1625c2(0x11f)];_0x41bb0f[_0x1625c2(0x176)][_0x1625c2(0x177)]=_0x50be1e+'px';if(_0x4e25fa){const _0x3a7175=_0x4e25fa['offsetHeight'];_0x19d38b['style'][_0x1625c2(0x165)]=_0x3a7175+0x28+'px';}}tg?tg[_0x2a7dba(0x123)](_0x2a7dba(0x179),({isStateStable:_0x5bfcb4})=>{_0x372cb1();if(_0x5bfcb4)requestAnimationFrame(()=>{const _0x37468a=a0_0x3d41;_0x19d38b['scrollTop']=_0x19d38b[_0x37468a(0x11a)];});}):window[_0x2a7dba(0x174)](_0x2a7dba(0x178),_0x372cb1),_0x372cb1(),_0x8f39b7&&(_0x8f39b7[_0x2a7dba(0x174)](_0x2a7dba(0x10a),()=>{requestAnimationFrame(_0x372cb1);}),_0x8f39b7[_0x2a7dba(0x174)](_0x2a7dba(0x12d),()=>{setTimeout(()=>{const _0x450c2e=a0_0x3d41;_0x19d38b['scrollTop']=_0x19d38b[_0x450c2e(0x11a)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1d6c25(0x14d),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x32e5(){const _0x12064c=['children','innerHTML','input','offClick','flex','createElement','timestamp','auto','Начнется\x20новый\x20диалог.','preventDefault','Удалить?','href','3253184OOHRDa','sendBtn','floor','HapticFeedback','typingIndicator','setItem','scrollHeight','70iMOjSR','TG\x20setup\x20error:','user','161qFeBLB','innerHeight','replace','remove','setHeaderColor','onEvent','onClick','none','signal','onclick','675372QxemAl','light','now','ai_chat_messages','stopPropagation','focus','initData','initDataUnsafe','contains','Пустой\x20ответ','text/plain','toString','isVersionAtLeast','length','confirmModal','message\x20ai','2156hIdPWL','touchend','search','padStart','scrollTop','medium','Enter','trim','disabled','POST','show-delete','./router.html','div','getItem','chatArea','stringify','clearBtn','inputArea','clear_history','disableVerticalSwipes','abort','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','modalTitle','Ошибка\x20сети','Действие\x20необратимо.','username','add','show','BackButton','getElementById','querySelectorAll','delete-btn','impactOccurred','modalText','min','from','target','push','367659qGBNzW','forEach','message-time','classList','apply','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','modalCancel','paddingBottom','viewportHeight','appendChild','content','Telegram','34896DKoDAP','first_name','.container','(((.+)+)+)+$','warn','13816tQzTQT','click','notificationOccurred','touchstart','function','addEventListener','textContent','style','height','resize','viewportChanged','message-bubble','Ошибка\x20сервера','14JFuBBw','30IcKXgU','emptyState','display','value','.message.show-delete','className','modalConfirm','parse','messageInput','error','debug_uid','json','20799DEnMKC','keydown','text','shiftKey','getMinutes','#050505'];a0_0x32e5=function(){return _0x12064c;};return a0_0x32e5();}function a0_0x3d41(_0x22f7f6,_0x24c16e){_0x22f7f6=_0x22f7f6-0x104;const _0x1bd916=a0_0x32e5();let _0xfc23e8=_0x1bd916[_0x22f7f6];return _0xfc23e8;}const chatArea=document[a0_0x1d6c25(0x155)](a0_0x1d6c25(0x146)),emptyState=document[a0_0x1d6c25(0x155)]('emptyState'),messageInput=document[a0_0x1d6c25(0x155)]('messageInput'),sendBtn=document['getElementById'](a0_0x1d6c25(0x115)),clearBtn=document[a0_0x1d6c25(0x155)](a0_0x1d6c25(0x148)),modal=document['getElementById'](a0_0x1d6c25(0x136)),mTitle=document[a0_0x1d6c25(0x155)](a0_0x1d6c25(0x14e)),mText=document[a0_0x1d6c25(0x155)](a0_0x1d6c25(0x159));let modalCallback=null;async function callBackend(_0x20e079,_0x530c58){const _0x3c1c53=a0_0x1d6c25,_0x537ae5=tg?.[_0x3c1c53(0x12f)]?.[_0x3c1c53(0x11d)]||{},_0x64b89=_0x537ae5['id']||localStorage[_0x3c1c53(0x145)]('debug_uid')||'d-'+Math[_0x3c1c53(0x116)](Math['random']()*0x3b9aca00);if(!_0x537ae5['id'])localStorage[_0x3c1c53(0x119)](_0x3c1c53(0x187),_0x64b89);const _0x5c1f29={'action':_0x20e079,'user_id':_0x64b89,'user_data':{'first_name':_0x537ae5[_0x3c1c53(0x16b)],'username':_0x537ae5[_0x3c1c53(0x151)]},'init_data':tg?.[_0x3c1c53(0x12e)]||'',..._0x530c58},_0x1fa326=new AbortController(),_0x3614d1=setTimeout(()=>_0x1fa326[_0x3c1c53(0x14c)](),REQUEST_TIMEOUT_MS);try{const _0x2c99b8=await fetch(BACKEND_URL,{'method':_0x3c1c53(0x141),'headers':{'Content-Type':_0x3c1c53(0x132)},'body':JSON[_0x3c1c53(0x147)](_0x5c1f29),'signal':_0x1fa326[_0x3c1c53(0x126)]});return clearTimeout(_0x3614d1),await _0x2c99b8[_0x3c1c53(0x188)]();}catch(_0x24ccef){return{'success':![],'error':String(_0x24ccef)};}}function formatTime(_0xc8508e){const _0x5d2604=a0_0x1d6c25,_0x1264e3=new Date(_0xc8508e);return String(_0x1264e3['getHours']())['padStart'](0x2,'0')+':'+String(_0x1264e3[_0x5d2604(0x106)]())[_0x5d2604(0x13b)](0x2,'0');}function createMessageElement(_0x16906a,_0x1587d2){const _0x22f1c6=a0_0x1d6c25,_0x5bc3ff=document[_0x22f1c6(0x10d)]('div');_0x5bc3ff[_0x22f1c6(0x182)]='message\x20'+_0x16906a['role'];const _0x2f9fed=document[_0x22f1c6(0x10d)]('div');_0x2f9fed[_0x22f1c6(0x182)]=_0x22f1c6(0x17a),_0x2f9fed[_0x22f1c6(0x109)]=_0x16906a[_0x22f1c6(0x168)][_0x22f1c6(0x120)](/\n/g,'<br>');const _0x22b422=document['createElement'](_0x22f1c6(0x144));_0x22b422[_0x22f1c6(0x182)]=_0x22f1c6(0x157),_0x22b422[_0x22f1c6(0x109)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x22b422[_0x22f1c6(0x127)]=_0x423891=>{const _0x3e54df=_0x22f1c6;_0x423891[_0x3e54df(0x12c)](),confirmDelete(_0x1587d2);};let _0x1e83f3;_0x2f9fed[_0x22f1c6(0x174)](_0x22f1c6(0x172),()=>_0x1e83f3=setTimeout(()=>{const _0xd75667=_0x22f1c6;_0x5bc3ff['classList'][_0xd75667(0x152)](_0xd75667(0x142));if(tg?.[_0xd75667(0x117)])tg[_0xd75667(0x117)][_0xd75667(0x158)](_0xd75667(0x13d));},0x1f4)),_0x2f9fed[_0x22f1c6(0x174)](_0x22f1c6(0x139),()=>clearTimeout(_0x1e83f3));const _0x18977b=document[_0x22f1c6(0x10d)]('div');return _0x18977b[_0x22f1c6(0x182)]=_0x22f1c6(0x160),_0x18977b['textContent']=formatTime(_0x16906a[_0x22f1c6(0x10e)]),_0x5bc3ff[_0x22f1c6(0x167)](_0x22b422),_0x5bc3ff['appendChild'](_0x2f9fed),_0x5bc3ff[_0x22f1c6(0x167)](_0x18977b),_0x5bc3ff;}function createTypingIndicator(){const _0x1359ab=a0_0x1d6c25,_0x256a49=document['createElement']('div');return _0x256a49[_0x1359ab(0x182)]=_0x1359ab(0x137),_0x256a49['id']=_0x1359ab(0x118),_0x256a49['innerHTML']=_0x1359ab(0x163),_0x256a49;}function renderMessages(){const _0x4c955d=a0_0x1d6c25;Array[_0x4c955d(0x15b)](chatArea[_0x4c955d(0x108)])['forEach'](_0x4a8fda=>{const _0x16bb0d=_0x4c955d;if(_0x4a8fda['id']!==_0x16bb0d(0x17e))_0x4a8fda[_0x16bb0d(0x121)]();}),messages[_0x4c955d(0x135)]>0x0?(emptyState['style'][_0x4c955d(0x17f)]=_0x4c955d(0x125),messages[_0x4c955d(0x15f)]((_0x3702ff,_0x162a28)=>chatArea[_0x4c955d(0x167)](createMessageElement(_0x3702ff,_0x162a28)))):emptyState[_0x4c955d(0x176)][_0x4c955d(0x17f)]=_0x4c955d(0x10c),requestAnimationFrame(()=>chatArea[_0x4c955d(0x13c)]=chatArea[_0x4c955d(0x11a)]);}function autoResizeTextarea(){const _0x37ffe8=a0_0x1d6c25;messageInput[_0x37ffe8(0x176)][_0x37ffe8(0x177)]=_0x37ffe8(0x10f),messageInput[_0x37ffe8(0x176)][_0x37ffe8(0x177)]=Math[_0x37ffe8(0x15a)](messageInput[_0x37ffe8(0x11a)],0x78)+'px';}function updateSendButton(){const _0x92aac3=a0_0x1d6c25,_0x39e23f=messageInput['value'][_0x92aac3(0x13f)]();sendBtn[_0x92aac3(0x140)]=!_0x39e23f||isTyping;}async function sendMessage(){const _0xcec605=a0_0x1d6c25,_0x1c2830=messageInput[_0xcec605(0x180)][_0xcec605(0x13f)]();if(!_0x1c2830||isTyping)return;if(tg?.[_0xcec605(0x117)])tg[_0xcec605(0x117)]['impactOccurred']('light');messages[_0xcec605(0x15d)]({'role':_0xcec605(0x11d),'content':_0x1c2830,'timestamp':Date['now']()}),localStorage[_0xcec605(0x119)]('ai_chat_messages',JSON[_0xcec605(0x147)](messages)),renderMessages(),messageInput[_0xcec605(0x180)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xcec605(0x167)](createTypingIndicator()),chatArea[_0xcec605(0x13c)]=chatArea[_0xcec605(0x11a)];const _0x23e0ca=await callBackend('send_message',{'message':_0x1c2830});isTyping=![];const _0x26d394=document[_0xcec605(0x155)]('typingIndicator');if(_0x26d394)_0x26d394[_0xcec605(0x121)]();let _0x2b8670=_0xcec605(0x14f);if(_0x23e0ca['success']){_0x2b8670=_0x23e0ca[_0xcec605(0x104)]||_0xcec605(0x131);if(tg?.[_0xcec605(0x117)])tg[_0xcec605(0x117)]['notificationOccurred']('success');}else{_0x2b8670=_0x23e0ca[_0xcec605(0x186)]||_0xcec605(0x17b);if(tg?.[_0xcec605(0x117)])tg[_0xcec605(0x117)][_0xcec605(0x171)](_0xcec605(0x186));}messages['push']({'role':'ai','content':_0x2b8670,'timestamp':Date[_0xcec605(0x12a)]()}),localStorage['setItem'](_0xcec605(0x12b),JSON[_0xcec605(0x147)](messages)),renderMessages();}function confirmDelete(_0x1fb821){const _0x30a112=a0_0x1d6c25;if(mTitle)mTitle[_0x30a112(0x175)]=_0x30a112(0x112);if(mText)mText['textContent']=_0x30a112(0x150);modalCallback=()=>{const _0x1c4835=_0x30a112;messages['splice'](_0x1fb821,0x1),localStorage[_0x1c4835(0x119)](_0x1c4835(0x12b),JSON[_0x1c4835(0x147)](messages)),renderMessages();},modal[_0x30a112(0x161)][_0x30a112(0x152)]('show');}if(clearBtn)clearBtn[a0_0x1d6c25(0x127)]=()=>{const _0x2ec70a=a0_0x1d6c25;if(!messages[_0x2ec70a(0x135)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x2ec70a(0x175)]=_0x2ec70a(0x110);modalCallback=async()=>{const _0x601799=_0x2ec70a;messages=[],localStorage['removeItem'](_0x601799(0x12b)),renderMessages(),callBackend(_0x601799(0x14a),{});},modal[_0x2ec70a(0x161)][_0x2ec70a(0x152)](_0x2ec70a(0x153));};document[a0_0x1d6c25(0x155)](a0_0x1d6c25(0x164))[a0_0x1d6c25(0x127)]=()=>modal[a0_0x1d6c25(0x161)][a0_0x1d6c25(0x121)]('show'),document[a0_0x1d6c25(0x155)](a0_0x1d6c25(0x183))['onclick']=()=>{const _0x13a5b2=a0_0x1d6c25;if(modalCallback)modalCallback();modal[_0x13a5b2(0x161)][_0x13a5b2(0x121)]('show');},messageInput['addEventListener'](a0_0x1d6c25(0x10a),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x1d6c25(0x18a),_0x3b3740=>{const _0x1d0f56=a0_0x1d6c25;_0x3b3740['key']===_0x1d0f56(0x13e)&&!_0x3b3740[_0x1d0f56(0x105)]&&(_0x3b3740[_0x1d0f56(0x111)](),sendMessage());}),sendBtn[a0_0x1d6c25(0x127)]=sendMessage,document[a0_0x1d6c25(0x174)](a0_0x1d6c25(0x170),_0x4d61d4=>{const _0x4013fa=a0_0x1d6c25;document[_0x4013fa(0x156)](_0x4013fa(0x181))[_0x4013fa(0x15f)](_0x2f86c6=>{const _0x18df1d=_0x4013fa;if(!_0x2f86c6[_0x18df1d(0x130)](_0x4d61d4[_0x18df1d(0x15c)]))_0x2f86c6[_0x18df1d(0x161)][_0x18df1d(0x121)](_0x18df1d(0x142));});});const saved=localStorage[a0_0x1d6c25(0x145)](a0_0x1d6c25(0x12b));if(saved)try{messages=JSON[a0_0x1d6c25(0x184)](saved),renderMessages();}catch(a0_0x55c320){}updateSendButton();