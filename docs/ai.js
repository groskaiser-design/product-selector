const a0_0x43104c=a0_0xb04e;(function(_0x496a14,_0x57085d){const _0x18ee0e=a0_0xb04e,_0x1e97e5=_0x496a14();while(!![]){try{const _0x1ae3a6=parseInt(_0x18ee0e(0x173))/0x1*(-parseInt(_0x18ee0e(0x13c))/0x2)+-parseInt(_0x18ee0e(0x121))/0x3*(-parseInt(_0x18ee0e(0x15a))/0x4)+-parseInt(_0x18ee0e(0x182))/0x5+parseInt(_0x18ee0e(0x180))/0x6*(parseInt(_0x18ee0e(0x170))/0x7)+-parseInt(_0x18ee0e(0x15b))/0x8*(-parseInt(_0x18ee0e(0x14a))/0x9)+parseInt(_0x18ee0e(0x17c))/0xa*(-parseInt(_0x18ee0e(0x141))/0xb)+-parseInt(_0x18ee0e(0x148))/0xc;if(_0x1ae3a6===_0x57085d)break;else _0x1e97e5['push'](_0x1e97e5['shift']());}catch(_0x1260e8){_0x1e97e5['push'](_0x1e97e5['shift']());}}}(a0_0x1169,0x2bfc5));const tg=window[a0_0x43104c(0x14f)]?.[a0_0x43104c(0x195)],HOME_URL=a0_0x43104c(0x11c);function a0_0xb04e(_0x4159b1,_0x41fa0d){_0x4159b1=_0x4159b1-0x112;const _0x3cd140=a0_0x1169();let _0x584c27=_0x3cd140[_0x4159b1];return _0x584c27;}function setupTelegramBackButton(){const _0x5b5b90=a0_0x43104c,_0x1fc668=(function(){let _0x2bf200=!![];return function(_0x1e39e6,_0x351197){const _0x4a3a1d=_0x2bf200?function(){const _0x3edc0b=a0_0xb04e;if(_0x351197){const _0x395704=_0x351197[_0x3edc0b(0x115)](_0x1e39e6,arguments);return _0x351197=null,_0x395704;}}:function(){};return _0x2bf200=![],_0x4a3a1d;};}()),_0x7600a6=_0x1fc668(this,function(){const _0x53b255=a0_0xb04e;return _0x7600a6[_0x53b255(0x176)]()['search'](_0x53b255(0x11b))[_0x53b255(0x176)]()[_0x53b255(0x184)](_0x7600a6)[_0x53b255(0x192)](_0x53b255(0x11b));});_0x7600a6();if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x5b5b90(0x13d)]?.(_0x5b5b90(0x12b));if(tg[_0x5b5b90(0x135)]?.(_0x5b5b90(0x16d)))tg[_0x5b5b90(0x156)]?.();const _0x1e7e33=tg['BackButton'];if(_0x1e7e33){_0x1e7e33[_0x5b5b90(0x140)]();if(typeof _0x1e7e33['offClick']==='function')try{_0x1e7e33[_0x5b5b90(0x129)]();}catch(_0x45d961){}_0x1e7e33['onClick'](()=>{const _0x968eb=_0x5b5b90;if(tg[_0x968eb(0x139)])tg['HapticFeedback'][_0x968eb(0x134)]('light');location[_0x968eb(0x11d)]=HOME_URL;});}}catch(_0x5992e9){console[_0x5b5b90(0x166)]('TG\x20setup\x20error:',_0x5992e9);}}(function initStableLayout(){const _0x1b8d4c=a0_0x43104c,_0x56cc06=document['querySelector'](_0x1b8d4c(0x12e)),_0x32f900=document[_0x1b8d4c(0x18e)]('inputArea'),_0x546af9=document[_0x1b8d4c(0x18e)](_0x1b8d4c(0x146)),_0x2b97b2=document[_0x1b8d4c(0x18e)](_0x1b8d4c(0x167));function _0x268f05(){const _0x3b2adc=_0x1b8d4c;if(!_0x56cc06)return;const _0x11873f=tg&&tg[_0x3b2adc(0x137)]?tg['viewportHeight']:window[_0x3b2adc(0x152)];_0x56cc06[_0x3b2adc(0x174)][_0x3b2adc(0x183)]=_0x11873f+'px';if(_0x32f900){const _0xa6ca61=_0x32f900[_0x3b2adc(0x12d)];_0x546af9[_0x3b2adc(0x174)]['paddingBottom']=_0xa6ca61+0x28+'px';}}tg?tg[_0x1b8d4c(0x11e)](_0x1b8d4c(0x144),({isStateStable:_0x4ce595})=>{_0x268f05();if(_0x4ce595)requestAnimationFrame(()=>{const _0x46b580=a0_0xb04e;_0x546af9[_0x46b580(0x190)]=_0x546af9[_0x46b580(0x119)];});}):window[_0x1b8d4c(0x136)](_0x1b8d4c(0x13e),_0x268f05),_0x268f05(),_0x2b97b2&&(_0x2b97b2['addEventListener']('input',()=>{requestAnimationFrame(_0x268f05);}),_0x2b97b2[_0x1b8d4c(0x136)](_0x1b8d4c(0x164),()=>{setTimeout(()=>{const _0x2b037b=a0_0xb04e;_0x546af9['scrollTop']=_0x546af9[_0x2b037b(0x119)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x43104c(0x138),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x43104c(0x146)),emptyState=document[a0_0x43104c(0x18e)](a0_0x43104c(0x133)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x43104c(0x18e)](a0_0x43104c(0x15c)),clearBtn=document[a0_0x43104c(0x18e)]('clearBtn'),modal=document[a0_0x43104c(0x18e)](a0_0x43104c(0x15f)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x43104c(0x18e)](a0_0x43104c(0x158));let modalCallback=null;async function callBackend(_0x462f99,_0x57355d){const _0x395d1a=a0_0x43104c,_0x25e678=tg?.[_0x395d1a(0x147)]?.[_0x395d1a(0x114)]||{},_0xa0fffd=_0x25e678['id']||localStorage[_0x395d1a(0x18b)]('debug_uid')||'d-'+Math[_0x395d1a(0x15d)](Math[_0x395d1a(0x181)]()*0x3b9aca00);if(!_0x25e678['id'])localStorage[_0x395d1a(0x162)](_0x395d1a(0x113),_0xa0fffd);const _0x5af605={'action':_0x462f99,'user_id':_0xa0fffd,'user_data':{'first_name':_0x25e678[_0x395d1a(0x189)],'username':_0x25e678['username']},'init_data':tg?.[_0x395d1a(0x145)]||'',..._0x57355d},_0x20d627=new AbortController(),_0x5ec057=setTimeout(()=>_0x20d627[_0x395d1a(0x17d)](),REQUEST_TIMEOUT_MS);try{const _0x19af3f=await fetch(BACKEND_URL,{'method':_0x395d1a(0x117),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x5af605),'signal':_0x20d627['signal']});return clearTimeout(_0x5ec057),await _0x19af3f[_0x395d1a(0x16b)]();}catch(_0x388d36){return{'success':![],'error':String(_0x388d36)};}}function formatTime(_0x5c9c04){const _0x590b41=a0_0x43104c,_0x80efae=new Date(_0x5c9c04);return String(_0x80efae[_0x590b41(0x159)]())[_0x590b41(0x177)](0x2,'0')+':'+String(_0x80efae[_0x590b41(0x157)]())[_0x590b41(0x177)](0x2,'0');}function createMessageElement(_0xf56356,_0x10a4d6){const _0x17d383=a0_0x43104c,_0x3ca726=document['createElement']('div');_0x3ca726['className']=_0x17d383(0x163)+_0xf56356[_0x17d383(0x188)];const _0x52bceb=document[_0x17d383(0x14e)]('div');_0x52bceb[_0x17d383(0x172)]=_0x17d383(0x112),_0x52bceb[_0x17d383(0x17e)]=_0xf56356[_0x17d383(0x17f)][_0x17d383(0x16a)](/\n/g,_0x17d383(0x128));const _0x391c8d=document[_0x17d383(0x14e)](_0x17d383(0x151));_0x391c8d['className']=_0x17d383(0x194),_0x391c8d[_0x17d383(0x17e)]=_0x17d383(0x14d),_0x391c8d['onclick']=_0x143355=>{const _0x42997d=_0x17d383;_0x143355[_0x42997d(0x125)](),confirmDelete(_0x10a4d6);};let _0x4409b6;_0x52bceb[_0x17d383(0x136)](_0x17d383(0x18c),()=>_0x4409b6=setTimeout(()=>{const _0x49d97e=_0x17d383;_0x3ca726[_0x49d97e(0x12c)][_0x49d97e(0x16f)](_0x49d97e(0x197));if(tg?.[_0x49d97e(0x139)])tg[_0x49d97e(0x139)][_0x49d97e(0x134)](_0x49d97e(0x124));},0x1f4)),_0x52bceb[_0x17d383(0x136)](_0x17d383(0x14c),()=>clearTimeout(_0x4409b6));const _0x5e9abc=document[_0x17d383(0x14e)](_0x17d383(0x151));return _0x5e9abc[_0x17d383(0x172)]=_0x17d383(0x132),_0x5e9abc[_0x17d383(0x178)]=formatTime(_0xf56356[_0x17d383(0x161)]),_0x3ca726[_0x17d383(0x191)](_0x391c8d),_0x3ca726[_0x17d383(0x191)](_0x52bceb),_0x3ca726[_0x17d383(0x191)](_0x5e9abc),_0x3ca726;}function createTypingIndicator(){const _0x4eb8b2=a0_0x43104c,_0x493474=document[_0x4eb8b2(0x14e)](_0x4eb8b2(0x151));return _0x493474[_0x4eb8b2(0x172)]='message\x20ai',_0x493474['id']=_0x4eb8b2(0x13b),_0x493474[_0x4eb8b2(0x17e)]=_0x4eb8b2(0x13a),_0x493474;}function renderMessages(){const _0x53ee70=a0_0x43104c;Array[_0x53ee70(0x126)](chatArea['children'])[_0x53ee70(0x150)](_0x1482f4=>{if(_0x1482f4['id']!=='emptyState')_0x1482f4['remove']();}),messages[_0x53ee70(0x120)]>0x0?(emptyState[_0x53ee70(0x174)]['display']='none',messages['forEach']((_0x3f6d43,_0x434818)=>chatArea['appendChild'](createMessageElement(_0x3f6d43,_0x434818)))):emptyState['style'][_0x53ee70(0x127)]='flex',requestAnimationFrame(()=>chatArea[_0x53ee70(0x190)]=chatArea[_0x53ee70(0x119)]);}function autoResizeTextarea(){const _0xb39ddf=a0_0x43104c;messageInput['style'][_0xb39ddf(0x183)]=_0xb39ddf(0x169),messageInput['style'][_0xb39ddf(0x183)]=Math[_0xb39ddf(0x18d)](messageInput[_0xb39ddf(0x119)],0x78)+'px';}function updateSendButton(){const _0x55aa7d=a0_0x43104c,_0x1b987d=messageInput[_0x55aa7d(0x193)][_0x55aa7d(0x153)]();sendBtn[_0x55aa7d(0x196)]=!_0x1b987d||isTyping;}async function sendMessage(){const _0x52eb7a=a0_0x43104c,_0xad16a6=messageInput[_0x52eb7a(0x193)][_0x52eb7a(0x153)]();if(!_0xad16a6||isTyping)return;if(tg?.[_0x52eb7a(0x139)])tg['HapticFeedback'][_0x52eb7a(0x134)](_0x52eb7a(0x165));messages[_0x52eb7a(0x187)]({'role':_0x52eb7a(0x114),'content':_0xad16a6,'timestamp':Date['now']()}),localStorage[_0x52eb7a(0x162)](_0x52eb7a(0x155),JSON[_0x52eb7a(0x18f)](messages)),renderMessages(),messageInput[_0x52eb7a(0x193)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x52eb7a(0x191)](createTypingIndicator()),chatArea[_0x52eb7a(0x190)]=chatArea[_0x52eb7a(0x119)];const _0x5afded=await callBackend(_0x52eb7a(0x16e),{'message':_0xad16a6});isTyping=![];const _0x438a43=document[_0x52eb7a(0x18e)](_0x52eb7a(0x13b));if(_0x438a43)_0x438a43[_0x52eb7a(0x16c)]();let _0x573ebc=_0x52eb7a(0x116);if(_0x5afded['success']){_0x573ebc=_0x5afded[_0x52eb7a(0x149)]||_0x52eb7a(0x11f);if(tg?.[_0x52eb7a(0x139)])tg[_0x52eb7a(0x139)]['notificationOccurred'](_0x52eb7a(0x12a));}else{_0x573ebc=_0x5afded[_0x52eb7a(0x175)]||_0x52eb7a(0x123);if(tg?.['HapticFeedback'])tg[_0x52eb7a(0x139)][_0x52eb7a(0x14b)]('error');}messages[_0x52eb7a(0x187)]({'role':'ai','content':_0x573ebc,'timestamp':Date[_0x52eb7a(0x179)]()}),localStorage[_0x52eb7a(0x162)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x3e34c6){const _0x122abb=a0_0x43104c;if(mTitle)mTitle['textContent']=_0x122abb(0x168);if(mText)mText[_0x122abb(0x178)]=_0x122abb(0x160);modalCallback=()=>{const _0x32b642=_0x122abb;messages[_0x32b642(0x186)](_0x3e34c6,0x1),localStorage[_0x32b642(0x162)]('ai_chat_messages',JSON[_0x32b642(0x18f)](messages)),renderMessages();},modal['classList'][_0x122abb(0x16f)]('show');}function a0_0x1169(){const _0x79a93b=['from','display','<br>','offClick','success','#050505','classList','offsetHeight','.container','contains','onclick','clear_history','message-time','emptyState','impactOccurred','isVersionAtLeast','addEventListener','viewportHeight','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','HapticFeedback','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','typingIndicator','2RWnLGc','setHeaderColor','resize','Enter','show','815111uAOlsU','keydown','preventDefault','viewportChanged','initData','chatArea','initDataUnsafe','1567752SJvGnQ','text','9KXVkJV','notificationOccurred','touchend','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','createElement','Telegram','forEach','div','innerHeight','trim','input','ai_chat_messages','disableVerticalSwipes','getMinutes','modalText','getHours','6296qaNfys','1013744lLPwJT','sendBtn','floor','querySelectorAll','confirmModal','Действие\x20необратимо.','timestamp','setItem','message\x20','focus','light','warn','messageInput','Удалить?','auto','replace','json','remove','6.1','send_message','add','1641073JZLMKK','modalCancel','className','102320qViHbD','style','error','toString','padStart','textContent','now','target','key','10VFzbYi','abort','innerHTML','content','6ddpyiP','random','1085285NuJuZs','height','constructor','Начнется\x20новый\x20диалог.','splice','push','role','first_name','removeItem','getItem','touchstart','min','getElementById','stringify','scrollTop','appendChild','search','value','delete-btn','WebApp','disabled','show-delete','message-bubble','debug_uid','user','apply','Ошибка\x20сети','POST','shiftKey','scrollHeight','click','(((.+)+)+)+$','./router.html','href','onEvent','Пустой\x20ответ','length','654ZTwzWk','parse','Ошибка\x20сервера','medium','stopPropagation'];a0_0x1169=function(){return _0x79a93b;};return a0_0x1169();}if(clearBtn)clearBtn['onclick']=()=>{const _0x4828a9=a0_0x43104c;if(!messages[_0x4828a9(0x120)])return;if(mTitle)mTitle[_0x4828a9(0x178)]='Очистить\x20историю?';if(mText)mText[_0x4828a9(0x178)]=_0x4828a9(0x185);modalCallback=async()=>{const _0x2f0646=_0x4828a9;messages=[],localStorage[_0x2f0646(0x18a)](_0x2f0646(0x155)),renderMessages(),callBackend(_0x2f0646(0x131),{});},modal[_0x4828a9(0x12c)][_0x4828a9(0x16f)](_0x4828a9(0x140));};document[a0_0x43104c(0x18e)](a0_0x43104c(0x171))['onclick']=()=>modal['classList'][a0_0x43104c(0x16c)](a0_0x43104c(0x140)),document[a0_0x43104c(0x18e)]('modalConfirm')[a0_0x43104c(0x130)]=()=>{const _0x2a7af6=a0_0x43104c;if(modalCallback)modalCallback();modal[_0x2a7af6(0x12c)][_0x2a7af6(0x16c)]('show');},messageInput[a0_0x43104c(0x136)](a0_0x43104c(0x154),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x43104c(0x136)](a0_0x43104c(0x142),_0x5a6b5c=>{const _0x4f2c81=a0_0x43104c;_0x5a6b5c[_0x4f2c81(0x17b)]===_0x4f2c81(0x13f)&&!_0x5a6b5c[_0x4f2c81(0x118)]&&(_0x5a6b5c[_0x4f2c81(0x143)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x43104c(0x136)](a0_0x43104c(0x11a),_0x3baae1=>{const _0xf4fda=a0_0x43104c;document[_0xf4fda(0x15e)]('.message.show-delete')['forEach'](_0x1972f8=>{const _0x3d03d6=_0xf4fda;if(!_0x1972f8[_0x3d03d6(0x12f)](_0x3baae1[_0x3d03d6(0x17a)]))_0x1972f8[_0x3d03d6(0x12c)][_0x3d03d6(0x16c)](_0x3d03d6(0x197));});});const saved=localStorage[a0_0x43104c(0x18b)](a0_0x43104c(0x155));if(saved)try{messages=JSON[a0_0x43104c(0x122)](saved),renderMessages();}catch(a0_0x74c805){}updateSendButton();