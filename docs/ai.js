const a0_0x17459b=a0_0x49de;function a0_0x49de(_0x508f48,_0x34fce8){_0x508f48=_0x508f48-0x139;const _0x8e6d81=a0_0x3fb6();let _0xcbfeaf=_0x8e6d81[_0x508f48];return _0xcbfeaf;}(function(_0x3fdc67,_0x3c186b){const _0x56ca09=a0_0x49de,_0x4c4cb0=_0x3fdc67();while(!![]){try{const _0x506ce1=-parseInt(_0x56ca09(0x180))/0x1+-parseInt(_0x56ca09(0x154))/0x2*(-parseInt(_0x56ca09(0x19f))/0x3)+-parseInt(_0x56ca09(0x18d))/0x4*(-parseInt(_0x56ca09(0x1a7))/0x5)+parseInt(_0x56ca09(0x172))/0x6+parseInt(_0x56ca09(0x18e))/0x7+-parseInt(_0x56ca09(0x16d))/0x8+parseInt(_0x56ca09(0x153))/0x9*(-parseInt(_0x56ca09(0x17b))/0xa);if(_0x506ce1===_0x3c186b)break;else _0x4c4cb0['push'](_0x4c4cb0['shift']());}catch(_0x2e8f0f){_0x4c4cb0['push'](_0x4c4cb0['shift']());}}}(a0_0x3fb6,0x2a25d));const tg=window[a0_0x17459b(0x17a)]?.[a0_0x17459b(0x19a)],HOME_URL=a0_0x17459b(0x14b);function a0_0x3fb6(){const _0x4e2e91=['2302272JqvKSE','Ошибка\x20сервера','viewportHeight','clear_history','error','518256vtDKzA','ready','sendBtn','flex','disabled','querySelectorAll','message\x20ai','.container','Telegram','10PiKcQB','stopPropagation','onclick','onEvent','push','17947WNklnW','abort','touchend','<br>','key','Удалить?','focus','length','Enter','div','none','addEventListener','offsetHeight','244VOLicq','329504gKoYAp','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','getItem','modalTitle','auto','(((.+)+)+)+$','message-bubble','appendChild','TG\x20setup\x20error:','textContent','input','initDataUnsafe','WebApp','HapticFeedback','text/plain','.message.show-delete','add','66921VYsiHu','medium','impactOccurred','touchstart','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Пустой\x20ответ','modalCancel','json','11705LklApm','stringify','scrollHeight','scrollTop','splice','padStart','toString','click','shiftKey','inputArea','emptyState','classList','display','trim','parse','now','offClick','function','style','className','success','resize','contains','typingIndicator','clearBtn','value','querySelector','preventDefault','ai_chat_messages','Очистить\x20историю?','notificationOccurred','constructor','./router.html','delete-btn','Ошибка\x20сети','createElement','keydown','search','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','disableVerticalSwipes','1192374VgtKuJ','30OBlcPO','target','signal','debug_uid','remove','Начнется\x20новый\x20диалог.','min','show','setItem','modalText','light','initData','innerHTML','removeItem','getHours','text','getElementById','warn','children','paddingBottom','chatArea','first_name','setHeaderColor','show-delete','content'];a0_0x3fb6=function(){return _0x4e2e91;};return a0_0x3fb6();}function setupTelegramBackButton(){const _0x22f920=a0_0x17459b;if(!tg)return;try{tg[_0x22f920(0x173)](),tg['expand'](),tg[_0x22f920(0x16a)]?.('#050505');if(tg['isVersionAtLeast']?.('6.1'))tg[_0x22f920(0x152)]?.();const _0x55eaf2=tg['BackButton'];if(_0x55eaf2){_0x55eaf2[_0x22f920(0x15b)]();if(typeof _0x55eaf2[_0x22f920(0x13b)]===_0x22f920(0x13c))try{_0x55eaf2[_0x22f920(0x13b)]();}catch(_0x1d204a){}_0x55eaf2['onClick'](()=>{const _0x5bac88=_0x22f920;if(tg[_0x5bac88(0x19b)])tg['HapticFeedback'][_0x5bac88(0x1a1)](_0x5bac88(0x15e));location['href']=HOME_URL;});}}catch(_0xc35c86){console[_0x22f920(0x165)](_0x22f920(0x196),_0xc35c86);}}(function initStableLayout(){const _0x201479=a0_0x17459b,_0x33c71e=(function(){let _0x142455=!![];return function(_0x3732f2,_0x157d38){const _0x153ccf=_0x142455?function(){if(_0x157d38){const _0x73f19c=_0x157d38['apply'](_0x3732f2,arguments);return _0x157d38=null,_0x73f19c;}}:function(){};return _0x142455=![],_0x153ccf;};}()),_0x22c539=document[_0x201479(0x145)](_0x201479(0x179)),_0x2f737e=document['getElementById'](_0x201479(0x1b0)),_0x339813=document['getElementById'](_0x201479(0x168)),_0x42b903=document[_0x201479(0x164)]('messageInput');function _0x479386(){const _0x101c6a=_0x201479,_0x56b42f=_0x33c71e(this,function(){const _0x153d6c=a0_0x49de;return _0x56b42f['toString']()['search'](_0x153d6c(0x193))[_0x153d6c(0x1ad)]()[_0x153d6c(0x14a)](_0x56b42f)[_0x153d6c(0x150)](_0x153d6c(0x193));});_0x56b42f();if(!_0x22c539)return;const _0x157fc4=tg&&tg['viewportHeight']?tg[_0x101c6a(0x16f)]:window['innerHeight'];_0x22c539[_0x101c6a(0x13d)]['height']=_0x157fc4+'px';if(_0x2f737e){const _0x12ce8b=_0x2f737e[_0x101c6a(0x18c)];_0x339813['style'][_0x101c6a(0x167)]=_0x12ce8b+0x28+'px';}}tg?tg[_0x201479(0x17e)]('viewportChanged',({isStateStable:_0x1203a3})=>{_0x479386();if(_0x1203a3)requestAnimationFrame(()=>{const _0x8bc254=a0_0x49de;_0x339813[_0x8bc254(0x1aa)]=_0x339813[_0x8bc254(0x1a9)];});}):window['addEventListener'](_0x201479(0x140),_0x479386),_0x479386(),_0x42b903&&(_0x42b903[_0x201479(0x18b)](_0x201479(0x198),()=>{requestAnimationFrame(_0x479386);}),_0x42b903[_0x201479(0x18b)](_0x201479(0x186),()=>{setTimeout(()=>{const _0x11e4fe=a0_0x49de;_0x339813[_0x11e4fe(0x1aa)]=_0x339813[_0x11e4fe(0x1a9)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x17459b(0x18f),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x17459b(0x164)]('chatArea'),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x17459b(0x164)]('messageInput'),sendBtn=document[a0_0x17459b(0x164)](a0_0x17459b(0x174)),clearBtn=document[a0_0x17459b(0x164)](a0_0x17459b(0x143)),modal=document[a0_0x17459b(0x164)]('confirmModal'),mTitle=document['getElementById'](a0_0x17459b(0x191)),mText=document['getElementById'](a0_0x17459b(0x15d));let modalCallback=null;async function callBackend(_0x480950,_0x1f7068){const _0x4b33b5=a0_0x17459b,_0x2e9e91=tg?.[_0x4b33b5(0x199)]?.['user']||{},_0x4181c7=_0x2e9e91['id']||localStorage[_0x4b33b5(0x190)](_0x4b33b5(0x157))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x2e9e91['id'])localStorage[_0x4b33b5(0x15c)](_0x4b33b5(0x157),_0x4181c7);const _0x53a7d1={'action':_0x480950,'user_id':_0x4181c7,'user_data':{'first_name':_0x2e9e91[_0x4b33b5(0x169)],'username':_0x2e9e91['username']},'init_data':tg?.[_0x4b33b5(0x15f)]||'',..._0x1f7068},_0x199ced=new AbortController(),_0x333044=setTimeout(()=>_0x199ced[_0x4b33b5(0x181)](),REQUEST_TIMEOUT_MS);try{const _0x1832d3=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x4b33b5(0x19c)},'body':JSON['stringify'](_0x53a7d1),'signal':_0x199ced[_0x4b33b5(0x156)]});return clearTimeout(_0x333044),await _0x1832d3[_0x4b33b5(0x1a6)]();}catch(_0x2a01fe){return{'success':![],'error':String(_0x2a01fe)};}}function formatTime(_0x45d3fb){const _0x4e198d=a0_0x17459b,_0x3fc4c9=new Date(_0x45d3fb);return String(_0x3fc4c9[_0x4e198d(0x162)]())[_0x4e198d(0x1ac)](0x2,'0')+':'+String(_0x3fc4c9['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x26bd59,_0xf29e36){const _0x1af33f=a0_0x17459b,_0x5c61f0=document[_0x1af33f(0x14e)](_0x1af33f(0x189));_0x5c61f0['className']='message\x20'+_0x26bd59['role'];const _0x556087=document[_0x1af33f(0x14e)]('div');_0x556087[_0x1af33f(0x13e)]=_0x1af33f(0x194),_0x556087['innerHTML']=_0x26bd59[_0x1af33f(0x16c)]['replace'](/\n/g,_0x1af33f(0x183));const _0x4eaf61=document[_0x1af33f(0x14e)](_0x1af33f(0x189));_0x4eaf61['className']=_0x1af33f(0x14c),_0x4eaf61[_0x1af33f(0x160)]=_0x1af33f(0x1a3),_0x4eaf61[_0x1af33f(0x17d)]=_0x2bc890=>{const _0x4c393b=_0x1af33f;_0x2bc890[_0x4c393b(0x17c)](),confirmDelete(_0xf29e36);};let _0x5d186b;_0x556087[_0x1af33f(0x18b)](_0x1af33f(0x1a2),()=>_0x5d186b=setTimeout(()=>{const _0x304a4c=_0x1af33f;_0x5c61f0['classList'][_0x304a4c(0x19e)](_0x304a4c(0x16b));if(tg?.[_0x304a4c(0x19b)])tg[_0x304a4c(0x19b)][_0x304a4c(0x1a1)](_0x304a4c(0x1a0));},0x1f4)),_0x556087[_0x1af33f(0x18b)](_0x1af33f(0x182),()=>clearTimeout(_0x5d186b));const _0x44e92e=document[_0x1af33f(0x14e)](_0x1af33f(0x189));return _0x44e92e['className']='message-time',_0x44e92e[_0x1af33f(0x197)]=formatTime(_0x26bd59['timestamp']),_0x5c61f0[_0x1af33f(0x195)](_0x4eaf61),_0x5c61f0[_0x1af33f(0x195)](_0x556087),_0x5c61f0['appendChild'](_0x44e92e),_0x5c61f0;}function createTypingIndicator(){const _0x882785=a0_0x17459b,_0x51c849=document[_0x882785(0x14e)](_0x882785(0x189));return _0x51c849[_0x882785(0x13e)]=_0x882785(0x178),_0x51c849['id']=_0x882785(0x142),_0x51c849[_0x882785(0x160)]=_0x882785(0x151),_0x51c849;}function renderMessages(){const _0x1152e3=a0_0x17459b;Array['from'](chatArea[_0x1152e3(0x166)])['forEach'](_0x214f63=>{const _0x10156d=_0x1152e3;if(_0x214f63['id']!==_0x10156d(0x1b1))_0x214f63['remove']();}),messages[_0x1152e3(0x187)]>0x0?(emptyState[_0x1152e3(0x13d)][_0x1152e3(0x1b3)]=_0x1152e3(0x18a),messages['forEach']((_0xf693f8,_0x1aa8e7)=>chatArea[_0x1152e3(0x195)](createMessageElement(_0xf693f8,_0x1aa8e7)))):emptyState[_0x1152e3(0x13d)][_0x1152e3(0x1b3)]=_0x1152e3(0x175),requestAnimationFrame(()=>chatArea[_0x1152e3(0x1aa)]=chatArea[_0x1152e3(0x1a9)]);}function autoResizeTextarea(){const _0x59e9b0=a0_0x17459b;messageInput[_0x59e9b0(0x13d)]['height']=_0x59e9b0(0x192),messageInput['style']['height']=Math[_0x59e9b0(0x15a)](messageInput[_0x59e9b0(0x1a9)],0x78)+'px';}function updateSendButton(){const _0x5e2fef=a0_0x17459b,_0x2343bd=messageInput[_0x5e2fef(0x144)][_0x5e2fef(0x1b4)]();sendBtn[_0x5e2fef(0x176)]=!_0x2343bd||isTyping;}async function sendMessage(){const _0x5d3371=a0_0x17459b,_0x2d9854=messageInput[_0x5d3371(0x144)][_0x5d3371(0x1b4)]();if(!_0x2d9854||isTyping)return;if(tg?.[_0x5d3371(0x19b)])tg[_0x5d3371(0x19b)]['impactOccurred']('light');messages[_0x5d3371(0x17f)]({'role':'user','content':_0x2d9854,'timestamp':Date[_0x5d3371(0x13a)]()}),localStorage[_0x5d3371(0x15c)](_0x5d3371(0x147),JSON[_0x5d3371(0x1a8)](messages)),renderMessages(),messageInput[_0x5d3371(0x144)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5d3371(0x195)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x45e982=await callBackend('send_message',{'message':_0x2d9854});isTyping=![];const _0x270994=document[_0x5d3371(0x164)](_0x5d3371(0x142));if(_0x270994)_0x270994[_0x5d3371(0x158)]();let _0x3ce6a0=_0x5d3371(0x14d);if(_0x45e982[_0x5d3371(0x13f)]){_0x3ce6a0=_0x45e982[_0x5d3371(0x163)]||_0x5d3371(0x1a4);if(tg?.[_0x5d3371(0x19b)])tg[_0x5d3371(0x19b)][_0x5d3371(0x149)](_0x5d3371(0x13f));}else{_0x3ce6a0=_0x45e982['error']||_0x5d3371(0x16e);if(tg?.['HapticFeedback'])tg[_0x5d3371(0x19b)]['notificationOccurred'](_0x5d3371(0x171));}messages['push']({'role':'ai','content':_0x3ce6a0,'timestamp':Date[_0x5d3371(0x13a)]()}),localStorage['setItem'](_0x5d3371(0x147),JSON[_0x5d3371(0x1a8)](messages)),renderMessages();}function confirmDelete(_0x1e832a){const _0x5ea866=a0_0x17459b;if(mTitle)mTitle[_0x5ea866(0x197)]=_0x5ea866(0x185);if(mText)mText[_0x5ea866(0x197)]='Действие\x20необратимо.';modalCallback=()=>{const _0x49e670=_0x5ea866;messages[_0x49e670(0x1ab)](_0x1e832a,0x1),localStorage[_0x49e670(0x15c)](_0x49e670(0x147),JSON[_0x49e670(0x1a8)](messages)),renderMessages();},modal[_0x5ea866(0x1b2)]['add']('show');}if(clearBtn)clearBtn[a0_0x17459b(0x17d)]=()=>{const _0x30286e=a0_0x17459b;if(!messages[_0x30286e(0x187)])return;if(mTitle)mTitle[_0x30286e(0x197)]=_0x30286e(0x148);if(mText)mText[_0x30286e(0x197)]=_0x30286e(0x159);modalCallback=async()=>{const _0x2e1924=_0x30286e;messages=[],localStorage[_0x2e1924(0x161)](_0x2e1924(0x147)),renderMessages(),callBackend(_0x2e1924(0x170),{});},modal[_0x30286e(0x1b2)]['add'](_0x30286e(0x15b));};document[a0_0x17459b(0x164)](a0_0x17459b(0x1a5))[a0_0x17459b(0x17d)]=()=>modal['classList'][a0_0x17459b(0x158)]('show'),document['getElementById']('modalConfirm')[a0_0x17459b(0x17d)]=()=>{const _0x237657=a0_0x17459b;if(modalCallback)modalCallback();modal[_0x237657(0x1b2)]['remove'](_0x237657(0x15b));},messageInput['addEventListener'](a0_0x17459b(0x198),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x17459b(0x14f),_0x245d0d=>{const _0xe83855=a0_0x17459b;_0x245d0d[_0xe83855(0x184)]===_0xe83855(0x188)&&!_0x245d0d[_0xe83855(0x1af)]&&(_0x245d0d[_0xe83855(0x146)](),sendMessage());}),sendBtn[a0_0x17459b(0x17d)]=sendMessage,document[a0_0x17459b(0x18b)](a0_0x17459b(0x1ae),_0x1a77fc=>{const _0xb01744=a0_0x17459b;document[_0xb01744(0x177)](_0xb01744(0x19d))['forEach'](_0x5af7b4=>{const _0x4d86f6=_0xb01744;if(!_0x5af7b4[_0x4d86f6(0x141)](_0x1a77fc[_0x4d86f6(0x155)]))_0x5af7b4[_0x4d86f6(0x1b2)][_0x4d86f6(0x158)]('show-delete');});});const saved=localStorage[a0_0x17459b(0x190)](a0_0x17459b(0x147));if(saved)try{messages=JSON[a0_0x17459b(0x139)](saved),renderMessages();}catch(a0_0x344e34){}updateSendButton();