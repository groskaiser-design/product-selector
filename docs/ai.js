const a0_0x1e6d83=a0_0x38bf;(function(_0x527518,_0x2ee36f){const _0x41ebd9=a0_0x38bf,_0x5cb311=_0x527518();while(!![]){try{const _0x1b9a07=parseInt(_0x41ebd9(0x152))/0x1+-parseInt(_0x41ebd9(0x15c))/0x2+parseInt(_0x41ebd9(0x14d))/0x3*(-parseInt(_0x41ebd9(0x154))/0x4)+-parseInt(_0x41ebd9(0x16e))/0x5+parseInt(_0x41ebd9(0x12a))/0x6*(parseInt(_0x41ebd9(0x16b))/0x7)+-parseInt(_0x41ebd9(0x10f))/0x8+parseInt(_0x41ebd9(0x167))/0x9;if(_0x1b9a07===_0x2ee36f)break;else _0x5cb311['push'](_0x5cb311['shift']());}catch(_0xe2ee93){_0x5cb311['push'](_0x5cb311['shift']());}}}(a0_0x2c6c,0x1dfdc));const tg=window['Telegram']?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x728360=a0_0x38bf,_0x195ea2=(function(){let _0x2d9037=!![];return function(_0x543245,_0x57f4fc){const _0x51139c=_0x2d9037?function(){const _0x44074b=a0_0x38bf;if(_0x57f4fc){const _0x497e83=_0x57f4fc[_0x44074b(0x184)](_0x543245,arguments);return _0x57f4fc=null,_0x497e83;}}:function(){};return _0x2d9037=![],_0x51139c;};}()),_0x21b0b6=_0x195ea2(this,function(){const _0x413600=a0_0x38bf;return _0x21b0b6[_0x413600(0x113)]()[_0x413600(0x15a)](_0x413600(0x13d))[_0x413600(0x113)]()['constructor'](_0x21b0b6)[_0x413600(0x15a)](_0x413600(0x13d));});_0x21b0b6();if(!tg)return;try{tg[_0x728360(0x155)](),tg[_0x728360(0x144)](),tg[_0x728360(0x147)]?.(_0x728360(0x148));if(tg[_0x728360(0x13c)]?.(_0x728360(0x178)))tg['disableVerticalSwipes']?.();const _0x67d111=tg[_0x728360(0x182)];if(_0x67d111){_0x67d111[_0x728360(0x151)]();if(typeof _0x67d111['offClick']===_0x728360(0x11f))try{_0x67d111['offClick']();}catch(_0x1be635){}_0x67d111['onClick'](()=>{const _0x4bf990=_0x728360;if(tg['HapticFeedback'])tg[_0x4bf990(0x15d)][_0x4bf990(0x14c)](_0x4bf990(0x132));location[_0x4bf990(0x156)]=HOME_URL;});}}catch(_0x3eed76){console[_0x728360(0x10b)](_0x728360(0x168),_0x3eed76);}}function a0_0x2c6c(){const _0x142e8e=['notificationOccurred','impactOccurred','3IWmvpN','innerHeight','Ошибка\x20сети','resize','show','230568fZADwv','classList','684176GXqsLy','ready','href','appendChild','removeItem','Ошибка\x20сервера','search','viewportHeight','100732rCYgBp','HapticFeedback','focus','clearBtn','content','signal','forEach','now','typingIndicator','none','Удалить?','1809972uZPwfU','TG\x20setup\x20error:','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','511847WvchpV','key','text','1120955tArusc','emptyState','className','text/plain','send_message','modalCancel','push','timestamp','auto','style','6.1','click','setItem','ai_chat_messages','message-bubble','getMinutes','getItem','message-time','Пустой\x20ответ','first_name','BackButton','message\x20','apply','success','warn','show-delete','offsetHeight','error','75784DZTwpj','querySelector','parse','message\x20ai','toString','touchstart','sendBtn','children','remove','textContent','onEvent','innerHTML','chatArea','flex','stringify','div','function','Enter','.container','addEventListener','replace','value','inputArea','height','user','disabled','initDataUnsafe','12vVtuiK','medium','target','onclick','role','from','display','length','light','username','padStart','scrollHeight','getElementById','debug_uid','contains','trim','scrollTop','createElement','isVersionAtLeast','(((.+)+)+)+$','Начнется\x20новый\x20диалог.','Действие\x20необратимо.','keydown','random','.message.show-delete','touchend','expand','messageInput','modalText','setHeaderColor','#050505','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Очистить\x20историю?'];a0_0x2c6c=function(){return _0x142e8e;};return a0_0x2c6c();}(function initStableLayout(){const _0x1cd9c8=a0_0x38bf,_0x339bb1=document[_0x1cd9c8(0x110)](_0x1cd9c8(0x121)),_0x4bef3a=document['getElementById'](_0x1cd9c8(0x125)),_0x309613=document['getElementById'](_0x1cd9c8(0x11b)),_0x32ead3=document[_0x1cd9c8(0x136)](_0x1cd9c8(0x145));function _0x476898(){const _0x275810=_0x1cd9c8;if(!_0x339bb1)return;const _0x61ed45=tg&&tg[_0x275810(0x15b)]?tg[_0x275810(0x15b)]:window[_0x275810(0x14e)];_0x339bb1[_0x275810(0x177)]['height']=_0x61ed45+'px';if(_0x4bef3a){const _0x4d23f9=_0x4bef3a[_0x275810(0x10d)];_0x309613[_0x275810(0x177)]['paddingBottom']=_0x4d23f9+0x28+'px';}}tg?tg[_0x1cd9c8(0x119)]('viewportChanged',({isStateStable:_0x1697fc})=>{_0x476898();if(_0x1697fc)requestAnimationFrame(()=>{const _0x272376=a0_0x38bf;_0x309613[_0x272376(0x13a)]=_0x309613[_0x272376(0x135)];});}):window[_0x1cd9c8(0x122)](_0x1cd9c8(0x150),_0x476898),_0x476898(),_0x32ead3&&(_0x32ead3[_0x1cd9c8(0x122)]('input',()=>{requestAnimationFrame(_0x476898);}),_0x32ead3[_0x1cd9c8(0x122)](_0x1cd9c8(0x15e),()=>{setTimeout(()=>{const _0x3d0eed=a0_0x38bf;_0x309613[_0x3d0eed(0x13a)]=_0x309613[_0x3d0eed(0x135)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1e6d83(0x169),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1e6d83(0x136)](a0_0x1e6d83(0x11b)),emptyState=document[a0_0x1e6d83(0x136)](a0_0x1e6d83(0x16f)),messageInput=document[a0_0x1e6d83(0x136)](a0_0x1e6d83(0x145)),sendBtn=document[a0_0x1e6d83(0x136)](a0_0x1e6d83(0x115)),clearBtn=document[a0_0x1e6d83(0x136)](a0_0x1e6d83(0x15f)),modal=document[a0_0x1e6d83(0x136)]('confirmModal'),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x1e6d83(0x136)](a0_0x1e6d83(0x146));let modalCallback=null;async function callBackend(_0x496482,_0x2bd94e){const _0x28bc87=a0_0x1e6d83,_0x29ea38=tg?.[_0x28bc87(0x129)]?.[_0x28bc87(0x127)]||{},_0x451656=_0x29ea38['id']||localStorage[_0x28bc87(0x17e)](_0x28bc87(0x137))||'d-'+Math['floor'](Math[_0x28bc87(0x141)]()*0x3b9aca00);if(!_0x29ea38['id'])localStorage[_0x28bc87(0x17a)](_0x28bc87(0x137),_0x451656);const _0x42572e={'action':_0x496482,'user_id':_0x451656,'user_data':{'first_name':_0x29ea38[_0x28bc87(0x181)],'username':_0x29ea38[_0x28bc87(0x133)]},'init_data':tg?.['initData']||'',..._0x2bd94e},_0x26cee5=new AbortController(),_0x2501ac=setTimeout(()=>_0x26cee5['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5f2bcf=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x28bc87(0x171)},'body':JSON[_0x28bc87(0x11d)](_0x42572e),'signal':_0x26cee5[_0x28bc87(0x161)]});return clearTimeout(_0x2501ac),await _0x5f2bcf['json']();}catch(_0x51d1a9){return{'success':![],'error':String(_0x51d1a9)};}}function formatTime(_0x3c1b52){const _0x34b86a=a0_0x1e6d83,_0x4735c2=new Date(_0x3c1b52);return String(_0x4735c2['getHours']())[_0x34b86a(0x134)](0x2,'0')+':'+String(_0x4735c2[_0x34b86a(0x17d)]())[_0x34b86a(0x134)](0x2,'0');}function createMessageElement(_0x3a32dc,_0x1a1330){const _0x33d875=a0_0x1e6d83,_0x5292f2=document[_0x33d875(0x13b)]('div');_0x5292f2[_0x33d875(0x170)]=_0x33d875(0x183)+_0x3a32dc[_0x33d875(0x12e)];const _0x272c96=document[_0x33d875(0x13b)](_0x33d875(0x11e));_0x272c96[_0x33d875(0x170)]=_0x33d875(0x17c),_0x272c96[_0x33d875(0x11a)]=_0x3a32dc[_0x33d875(0x160)][_0x33d875(0x123)](/\n/g,'<br>');const _0x8a6f6f=document[_0x33d875(0x13b)](_0x33d875(0x11e));_0x8a6f6f[_0x33d875(0x170)]='delete-btn',_0x8a6f6f[_0x33d875(0x11a)]=_0x33d875(0x149),_0x8a6f6f[_0x33d875(0x12d)]=_0x27076e=>{_0x27076e['stopPropagation'](),confirmDelete(_0x1a1330);};let _0xcf4ded;_0x272c96[_0x33d875(0x122)](_0x33d875(0x114),()=>_0xcf4ded=setTimeout(()=>{const _0x197f62=_0x33d875;_0x5292f2[_0x197f62(0x153)]['add'](_0x197f62(0x10c));if(tg?.[_0x197f62(0x15d)])tg['HapticFeedback'][_0x197f62(0x14c)](_0x197f62(0x12b));},0x1f4)),_0x272c96[_0x33d875(0x122)](_0x33d875(0x143),()=>clearTimeout(_0xcf4ded));const _0x55ccee=document[_0x33d875(0x13b)](_0x33d875(0x11e));return _0x55ccee['className']=_0x33d875(0x17f),_0x55ccee[_0x33d875(0x118)]=formatTime(_0x3a32dc[_0x33d875(0x175)]),_0x5292f2[_0x33d875(0x157)](_0x8a6f6f),_0x5292f2[_0x33d875(0x157)](_0x272c96),_0x5292f2[_0x33d875(0x157)](_0x55ccee),_0x5292f2;}function createTypingIndicator(){const _0x29ac14=a0_0x1e6d83,_0x148cd3=document['createElement']('div');return _0x148cd3[_0x29ac14(0x170)]=_0x29ac14(0x112),_0x148cd3['id']=_0x29ac14(0x164),_0x148cd3['innerHTML']=_0x29ac14(0x16a),_0x148cd3;}function renderMessages(){const _0x15e479=a0_0x1e6d83;Array[_0x15e479(0x12f)](chatArea[_0x15e479(0x116)])['forEach'](_0x37a9f2=>{const _0xb51c23=_0x15e479;if(_0x37a9f2['id']!==_0xb51c23(0x16f))_0x37a9f2[_0xb51c23(0x117)]();}),messages[_0x15e479(0x131)]>0x0?(emptyState[_0x15e479(0x177)]['display']=_0x15e479(0x165),messages['forEach']((_0x21076d,_0x574d03)=>chatArea[_0x15e479(0x157)](createMessageElement(_0x21076d,_0x574d03)))):emptyState[_0x15e479(0x177)][_0x15e479(0x130)]=_0x15e479(0x11c),requestAnimationFrame(()=>chatArea[_0x15e479(0x13a)]=chatArea[_0x15e479(0x135)]);}function autoResizeTextarea(){const _0x480b06=a0_0x1e6d83;messageInput['style'][_0x480b06(0x126)]=_0x480b06(0x176),messageInput[_0x480b06(0x177)][_0x480b06(0x126)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x533a2a=a0_0x1e6d83,_0x380389=messageInput[_0x533a2a(0x124)][_0x533a2a(0x139)]();sendBtn[_0x533a2a(0x128)]=!_0x380389||isTyping;}async function sendMessage(){const _0x1cf064=a0_0x1e6d83,_0x268bfb=messageInput[_0x1cf064(0x124)]['trim']();if(!_0x268bfb||isTyping)return;if(tg?.[_0x1cf064(0x15d)])tg[_0x1cf064(0x15d)][_0x1cf064(0x14c)](_0x1cf064(0x132));messages[_0x1cf064(0x174)]({'role':_0x1cf064(0x127),'content':_0x268bfb,'timestamp':Date['now']()}),localStorage[_0x1cf064(0x17a)](_0x1cf064(0x17b),JSON['stringify'](messages)),renderMessages(),messageInput[_0x1cf064(0x124)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x1cf064(0x13a)]=chatArea[_0x1cf064(0x135)];const _0x8c815b=await callBackend(_0x1cf064(0x172),{'message':_0x268bfb});isTyping=![];const _0x1f5839=document[_0x1cf064(0x136)](_0x1cf064(0x164));if(_0x1f5839)_0x1f5839[_0x1cf064(0x117)]();let _0x53c916=_0x1cf064(0x14f);if(_0x8c815b[_0x1cf064(0x185)]){_0x53c916=_0x8c815b[_0x1cf064(0x16d)]||_0x1cf064(0x180);if(tg?.[_0x1cf064(0x15d)])tg[_0x1cf064(0x15d)][_0x1cf064(0x14b)](_0x1cf064(0x185));}else{_0x53c916=_0x8c815b[_0x1cf064(0x10e)]||_0x1cf064(0x159);if(tg?.[_0x1cf064(0x15d)])tg['HapticFeedback'][_0x1cf064(0x14b)](_0x1cf064(0x10e));}messages[_0x1cf064(0x174)]({'role':'ai','content':_0x53c916,'timestamp':Date[_0x1cf064(0x163)]()}),localStorage[_0x1cf064(0x17a)](_0x1cf064(0x17b),JSON[_0x1cf064(0x11d)](messages)),renderMessages();}function a0_0x38bf(_0x441a6d,_0x270b9b){_0x441a6d=_0x441a6d-0x10b;const _0x560d14=a0_0x2c6c();let _0x2104d3=_0x560d14[_0x441a6d];return _0x2104d3;}function confirmDelete(_0x3c44b3){const _0x10b9ba=a0_0x1e6d83;if(mTitle)mTitle[_0x10b9ba(0x118)]=_0x10b9ba(0x166);if(mText)mText['textContent']=_0x10b9ba(0x13f);modalCallback=()=>{const _0x576c77=_0x10b9ba;messages['splice'](_0x3c44b3,0x1),localStorage['setItem'](_0x576c77(0x17b),JSON[_0x576c77(0x11d)](messages)),renderMessages();},modal[_0x10b9ba(0x153)]['add'](_0x10b9ba(0x151));}if(clearBtn)clearBtn['onclick']=()=>{const _0x58bf51=a0_0x1e6d83;if(!messages[_0x58bf51(0x131)])return;if(mTitle)mTitle[_0x58bf51(0x118)]=_0x58bf51(0x14a);if(mText)mText['textContent']=_0x58bf51(0x13e);modalCallback=async()=>{const _0x4af0e3=_0x58bf51;messages=[],localStorage[_0x4af0e3(0x158)](_0x4af0e3(0x17b)),renderMessages(),callBackend('clear_history',{});},modal[_0x58bf51(0x153)]['add'](_0x58bf51(0x151));};document[a0_0x1e6d83(0x136)](a0_0x1e6d83(0x173))[a0_0x1e6d83(0x12d)]=()=>modal[a0_0x1e6d83(0x153)]['remove'](a0_0x1e6d83(0x151)),document['getElementById']('modalConfirm')[a0_0x1e6d83(0x12d)]=()=>{const _0x2c3df5=a0_0x1e6d83;if(modalCallback)modalCallback();modal[_0x2c3df5(0x153)][_0x2c3df5(0x117)](_0x2c3df5(0x151));},messageInput[a0_0x1e6d83(0x122)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1e6d83(0x122)](a0_0x1e6d83(0x140),_0x39ee4f=>{const _0x250659=a0_0x1e6d83;_0x39ee4f[_0x250659(0x16c)]===_0x250659(0x120)&&!_0x39ee4f['shiftKey']&&(_0x39ee4f['preventDefault'](),sendMessage());}),sendBtn[a0_0x1e6d83(0x12d)]=sendMessage,document[a0_0x1e6d83(0x122)](a0_0x1e6d83(0x179),_0x767ab2=>{const _0x3b80bd=a0_0x1e6d83;document['querySelectorAll'](_0x3b80bd(0x142))[_0x3b80bd(0x162)](_0x4ca5ef=>{const _0x227a30=_0x3b80bd;if(!_0x4ca5ef[_0x227a30(0x138)](_0x767ab2[_0x227a30(0x12c)]))_0x4ca5ef['classList']['remove']('show-delete');});});const saved=localStorage[a0_0x1e6d83(0x17e)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x1e6d83(0x111)](saved),renderMessages();}catch(a0_0x395857){}updateSendButton();