function a0_0x524a(_0x302a23,_0x3223ce){_0x302a23=_0x302a23-0x1d0;const _0x28d915=a0_0x21a0();let _0x3aa1d4=_0x28d915[_0x302a23];return _0x3aa1d4;}const a0_0x49d310=a0_0x524a;(function(_0x21c56f,_0x2be284){const _0x5a46e2=a0_0x524a,_0x5efbda=_0x21c56f();while(!![]){try{const _0x7f3bae=parseInt(_0x5a46e2(0x20f))/0x1+-parseInt(_0x5a46e2(0x1dd))/0x2+parseInt(_0x5a46e2(0x1ea))/0x3+parseInt(_0x5a46e2(0x22a))/0x4*(parseInt(_0x5a46e2(0x204))/0x5)+-parseInt(_0x5a46e2(0x247))/0x6*(parseInt(_0x5a46e2(0x22f))/0x7)+-parseInt(_0x5a46e2(0x238))/0x8*(parseInt(_0x5a46e2(0x227))/0x9)+-parseInt(_0x5a46e2(0x219))/0xa*(-parseInt(_0x5a46e2(0x1f6))/0xb);if(_0x7f3bae===_0x2be284)break;else _0x5efbda['push'](_0x5efbda['shift']());}catch(_0x184aec){_0x5efbda['push'](_0x5efbda['shift']());}}}(a0_0x21a0,0xcfd35));const tg=window[a0_0x49d310(0x224)]?.[a0_0x49d310(0x21f)],HOME_URL=a0_0x49d310(0x214);function setupTelegramBackButton(){const _0x45194a=a0_0x49d310;if(!tg)return;try{tg['ready'](),tg[_0x45194a(0x23c)](),tg[_0x45194a(0x218)]?.(_0x45194a(0x228));if(tg[_0x45194a(0x1e3)]?.(_0x45194a(0x22e)))tg[_0x45194a(0x1f4)]?.();const _0x5b9807=tg[_0x45194a(0x1dc)];if(_0x5b9807){_0x5b9807['show']();if(typeof _0x5b9807[_0x45194a(0x221)]===_0x45194a(0x201))try{_0x5b9807[_0x45194a(0x221)]();}catch(_0x14deaa){}_0x5b9807[_0x45194a(0x22b)](()=>{const _0x6dd30a=_0x45194a;if(tg['HapticFeedback'])tg[_0x6dd30a(0x216)][_0x6dd30a(0x223)]('light');location['href']=HOME_URL;});}}catch(_0x3c364f){console['warn'](_0x45194a(0x1d3),_0x3c364f);}}(function initStableLayout(){const _0x10bfdc=a0_0x49d310,_0x372fd1=(function(){let _0x226ae5=!![];return function(_0x5597cf,_0x44784f){const _0x4856ef=_0x226ae5?function(){const _0x1b3608=a0_0x524a;if(_0x44784f){const _0x19317e=_0x44784f[_0x1b3608(0x1d8)](_0x5597cf,arguments);return _0x44784f=null,_0x19317e;}}:function(){};return _0x226ae5=![],_0x4856ef;};}()),_0x11a739=document['querySelector'](_0x10bfdc(0x1d1)),_0xb42169=document[_0x10bfdc(0x1f5)](_0x10bfdc(0x22c)),_0x35d6ab=document['getElementById'](_0x10bfdc(0x1f8)),_0xa3a924=document[_0x10bfdc(0x1f5)](_0x10bfdc(0x23d));function _0xd6ec3b(){const _0x37634e=_0x10bfdc,_0x5aedda=_0x372fd1(this,function(){const _0x2bac98=a0_0x524a;return _0x5aedda[_0x2bac98(0x20e)]()[_0x2bac98(0x1f1)]('(((.+)+)+)+$')['toString']()[_0x2bac98(0x23b)](_0x5aedda)['search']('(((.+)+)+)+$');});_0x5aedda();if(!_0x11a739)return;const _0x30f26d=tg&&tg['viewportHeight']?tg[_0x37634e(0x244)]:window[_0x37634e(0x1da)];_0x11a739[_0x37634e(0x1df)][_0x37634e(0x230)]=_0x30f26d+'px';if(_0xb42169){const _0xa79885=_0xb42169[_0x37634e(0x21b)];_0x35d6ab[_0x37634e(0x1df)]['paddingBottom']=_0xa79885+0x28+'px';}}tg?tg[_0x10bfdc(0x21d)](_0x10bfdc(0x1eb),({isStateStable:_0x1a0eb9})=>{_0xd6ec3b();if(_0x1a0eb9)requestAnimationFrame(()=>{const _0xd43bfc=a0_0x524a;_0x35d6ab[_0xd43bfc(0x207)]=_0x35d6ab[_0xd43bfc(0x215)];});}):window[_0x10bfdc(0x20a)]('resize',_0xd6ec3b),_0xd6ec3b(),_0xa3a924&&(_0xa3a924['addEventListener'](_0x10bfdc(0x246),()=>{requestAnimationFrame(_0xd6ec3b);}),_0xa3a924[_0x10bfdc(0x20a)](_0x10bfdc(0x1ef),()=>{setTimeout(()=>{const _0x40df3a=a0_0x524a;_0x35d6ab[_0x40df3a(0x207)]=_0x35d6ab[_0x40df3a(0x215)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x49d310(0x1f5)]('chatArea'),emptyState=document['getElementById'](a0_0x49d310(0x20d)),messageInput=document[a0_0x49d310(0x1f5)](a0_0x49d310(0x23d)),sendBtn=document[a0_0x49d310(0x1f5)]('sendBtn'),clearBtn=document[a0_0x49d310(0x1f5)](a0_0x49d310(0x20c)),modal=document[a0_0x49d310(0x1f5)](a0_0x49d310(0x1e5)),mTitle=document[a0_0x49d310(0x1f5)](a0_0x49d310(0x1d2)),mText=document[a0_0x49d310(0x1f5)]('modalText');function a0_0x21a0(){const _0x111c11=['.container','modalTitle','TG\x20setup\x20error:','getHours','text','value','stringify','apply','add','innerHeight','now','BackButton','51130Vokgbz','trim','style','show','replace','from','isVersionAtLeast','min','confirmModal','key','length','send_message','debug_uid','881310TwkIqf','viewportChanged','appendChild','none','querySelectorAll','focus','Пустой\x20ответ','search','Удалить?','keydown','disableVerticalSwipes','getElementById','33gqgPCL','getItem','chatArea','modalCancel','first_name','floor','json','abort','preventDefault','clear_history','className','function','<br>','role','5hqGdHr','div','message-bubble','scrollTop','user','padStart','addEventListener','.message.show-delete','clearBtn','emptyState','toString','1134756qontES','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','display','notificationOccurred','message-time','./router.html','scrollHeight','HapticFeedback','setItem','setHeaderColor','229410NzDfrb','success','offsetHeight','createElement','onEvent','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','WebApp','shiftKey','offClick','onclick','impactOccurred','Telegram','show-delete','innerHTML','16785mFCIAQ','#050505','parse','6051720bqaguL','onClick','inputArea','Ошибка\x20сети','6.1','90517nAVciI','height','push','content','forEach','initData','classList','signal','ai_chat_messages','4936CRkPFi','remove','flex','constructor','expand','messageInput','disabled','typingIndicator','contains','textContent','username','random','viewportHeight','timestamp','input','456vGbPxP','stopPropagation','touchend'];a0_0x21a0=function(){return _0x111c11;};return a0_0x21a0();}let modalCallback=null;async function callBackend(_0x247331,_0x4acf90){const _0x31b424=a0_0x49d310,_0x198915=tg?.['initDataUnsafe']?.[_0x31b424(0x208)]||{},_0x50e0d8=_0x198915['id']||localStorage[_0x31b424(0x1f7)]('debug_uid')||'d-'+Math[_0x31b424(0x1fb)](Math[_0x31b424(0x243)]()*0x3b9aca00);if(!_0x198915['id'])localStorage[_0x31b424(0x217)](_0x31b424(0x1e9),_0x50e0d8);const _0x183001={'action':_0x247331,'user_id':_0x50e0d8,'user_data':{'first_name':_0x198915[_0x31b424(0x1fa)],'username':_0x198915[_0x31b424(0x242)]},'init_data':tg?.[_0x31b424(0x234)]||'',..._0x4acf90},_0x4c4f2d=new AbortController(),_0xf7ae6d=setTimeout(()=>_0x4c4f2d[_0x31b424(0x1fd)](),REQUEST_TIMEOUT_MS);try{const _0x520203=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x31b424(0x1d7)](_0x183001),'signal':_0x4c4f2d[_0x31b424(0x236)]});return clearTimeout(_0xf7ae6d),await _0x520203[_0x31b424(0x1fc)]();}catch(_0x608c3c){return{'success':![],'error':String(_0x608c3c)};}}function formatTime(_0xe32851){const _0x59a918=a0_0x49d310,_0x27ceaf=new Date(_0xe32851);return String(_0x27ceaf[_0x59a918(0x1d4)]())[_0x59a918(0x209)](0x2,'0')+':'+String(_0x27ceaf['getMinutes']())[_0x59a918(0x209)](0x2,'0');}function createMessageElement(_0x101b56,_0x24fdcc){const _0x483c2e=a0_0x49d310,_0x59c52b=document[_0x483c2e(0x21c)](_0x483c2e(0x205));_0x59c52b['className']='message\x20'+_0x101b56[_0x483c2e(0x203)];const _0x5ef865=document[_0x483c2e(0x21c)](_0x483c2e(0x205));_0x5ef865['className']=_0x483c2e(0x206),_0x5ef865[_0x483c2e(0x226)]=_0x101b56[_0x483c2e(0x232)][_0x483c2e(0x1e1)](/\n/g,_0x483c2e(0x202));const _0x4bdcf9=document[_0x483c2e(0x21c)](_0x483c2e(0x205));_0x4bdcf9[_0x483c2e(0x200)]='delete-btn',_0x4bdcf9['innerHTML']=_0x483c2e(0x210),_0x4bdcf9['onclick']=_0x535445=>{const _0x57e734=_0x483c2e;_0x535445[_0x57e734(0x248)](),confirmDelete(_0x24fdcc);};let _0x11feaf;_0x5ef865[_0x483c2e(0x20a)]('touchstart',()=>_0x11feaf=setTimeout(()=>{const _0x2d52d2=_0x483c2e;_0x59c52b[_0x2d52d2(0x235)][_0x2d52d2(0x1d9)]('show-delete');if(tg?.[_0x2d52d2(0x216)])tg[_0x2d52d2(0x216)][_0x2d52d2(0x223)]('medium');},0x1f4)),_0x5ef865[_0x483c2e(0x20a)](_0x483c2e(0x1d0),()=>clearTimeout(_0x11feaf));const _0x5a6e16=document[_0x483c2e(0x21c)](_0x483c2e(0x205));return _0x5a6e16['className']=_0x483c2e(0x213),_0x5a6e16[_0x483c2e(0x241)]=formatTime(_0x101b56[_0x483c2e(0x245)]),_0x59c52b[_0x483c2e(0x1ec)](_0x4bdcf9),_0x59c52b['appendChild'](_0x5ef865),_0x59c52b[_0x483c2e(0x1ec)](_0x5a6e16),_0x59c52b;}function createTypingIndicator(){const _0x468b6a=a0_0x49d310,_0x594fec=document[_0x468b6a(0x21c)](_0x468b6a(0x205));return _0x594fec['className']='message\x20ai',_0x594fec['id']='typingIndicator',_0x594fec[_0x468b6a(0x226)]=_0x468b6a(0x21e),_0x594fec;}function renderMessages(){const _0x5c33be=a0_0x49d310;Array[_0x5c33be(0x1e2)](chatArea['children'])['forEach'](_0x1817f1=>{const _0x58abcf=_0x5c33be;if(_0x1817f1['id']!==_0x58abcf(0x20d))_0x1817f1['remove']();}),messages[_0x5c33be(0x1e7)]>0x0?(emptyState[_0x5c33be(0x1df)]['display']=_0x5c33be(0x1ed),messages[_0x5c33be(0x233)]((_0x30d04e,_0x49a48e)=>chatArea[_0x5c33be(0x1ec)](createMessageElement(_0x30d04e,_0x49a48e)))):emptyState[_0x5c33be(0x1df)][_0x5c33be(0x211)]=_0x5c33be(0x23a),requestAnimationFrame(()=>chatArea[_0x5c33be(0x207)]=chatArea[_0x5c33be(0x215)]);}function autoResizeTextarea(){const _0x32cc1e=a0_0x49d310;messageInput[_0x32cc1e(0x1df)][_0x32cc1e(0x230)]='auto',messageInput[_0x32cc1e(0x1df)]['height']=Math[_0x32cc1e(0x1e4)](messageInput[_0x32cc1e(0x215)],0x78)+'px';}function updateSendButton(){const _0x3dca74=a0_0x49d310,_0x32d2c4=messageInput[_0x3dca74(0x1d6)][_0x3dca74(0x1de)]();sendBtn[_0x3dca74(0x23e)]=!_0x32d2c4||isTyping;}async function sendMessage(){const _0x197f47=a0_0x49d310,_0x466e8a=messageInput[_0x197f47(0x1d6)][_0x197f47(0x1de)]();if(!_0x466e8a||isTyping)return;if(tg?.[_0x197f47(0x216)])tg[_0x197f47(0x216)][_0x197f47(0x223)]('light');messages[_0x197f47(0x231)]({'role':_0x197f47(0x208),'content':_0x466e8a,'timestamp':Date[_0x197f47(0x1db)]()}),localStorage['setItem'](_0x197f47(0x237),JSON['stringify'](messages)),renderMessages(),messageInput[_0x197f47(0x1d6)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x197f47(0x1ec)](createTypingIndicator()),chatArea[_0x197f47(0x207)]=chatArea[_0x197f47(0x215)];const _0x1974bb=await callBackend(_0x197f47(0x1e8),{'message':_0x466e8a});isTyping=![];const _0x2868de=document[_0x197f47(0x1f5)](_0x197f47(0x23f));if(_0x2868de)_0x2868de[_0x197f47(0x239)]();let _0x2d6740=_0x197f47(0x22d);if(_0x1974bb['success']){_0x2d6740=_0x1974bb[_0x197f47(0x1d5)]||_0x197f47(0x1f0);if(tg?.['HapticFeedback'])tg[_0x197f47(0x216)][_0x197f47(0x212)](_0x197f47(0x21a));}else{_0x2d6740=_0x1974bb['error']||'Ошибка\x20сервера';if(tg?.[_0x197f47(0x216)])tg[_0x197f47(0x216)][_0x197f47(0x212)]('error');}messages[_0x197f47(0x231)]({'role':'ai','content':_0x2d6740,'timestamp':Date[_0x197f47(0x1db)]()}),localStorage[_0x197f47(0x217)]('ai_chat_messages',JSON[_0x197f47(0x1d7)](messages)),renderMessages();}function confirmDelete(_0x293ccd){const _0x3ef950=a0_0x49d310;if(mTitle)mTitle[_0x3ef950(0x241)]=_0x3ef950(0x1f2);if(mText)mText[_0x3ef950(0x241)]='Действие\x20необратимо.';modalCallback=()=>{const _0x1519c7=_0x3ef950;messages['splice'](_0x293ccd,0x1),localStorage[_0x1519c7(0x217)](_0x1519c7(0x237),JSON[_0x1519c7(0x1d7)](messages)),renderMessages();},modal[_0x3ef950(0x235)]['add'](_0x3ef950(0x1e0));}if(clearBtn)clearBtn[a0_0x49d310(0x222)]=()=>{const _0x2ce5a3=a0_0x49d310;if(!messages['length'])return;if(mTitle)mTitle[_0x2ce5a3(0x241)]='Очистить\x20историю?';if(mText)mText['textContent']='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x2f1454=_0x2ce5a3;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x2f1454(0x1ff),{});},modal[_0x2ce5a3(0x235)][_0x2ce5a3(0x1d9)](_0x2ce5a3(0x1e0));};document[a0_0x49d310(0x1f5)](a0_0x49d310(0x1f9))[a0_0x49d310(0x222)]=()=>modal['classList']['remove'](a0_0x49d310(0x1e0)),document[a0_0x49d310(0x1f5)]('modalConfirm')['onclick']=()=>{const _0x593489=a0_0x49d310;if(modalCallback)modalCallback();modal[_0x593489(0x235)]['remove'](_0x593489(0x1e0));},messageInput['addEventListener'](a0_0x49d310(0x246),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x49d310(0x1f3),_0x21b5df=>{const _0x3c0d17=a0_0x49d310;_0x21b5df[_0x3c0d17(0x1e6)]==='Enter'&&!_0x21b5df[_0x3c0d17(0x220)]&&(_0x21b5df[_0x3c0d17(0x1fe)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener']('click',_0x3efc71=>{const _0x4250ba=a0_0x49d310;document[_0x4250ba(0x1ee)](_0x4250ba(0x20b))[_0x4250ba(0x233)](_0x3a8860=>{const _0x1e20bc=_0x4250ba;if(!_0x3a8860[_0x1e20bc(0x240)](_0x3efc71['target']))_0x3a8860[_0x1e20bc(0x235)]['remove'](_0x1e20bc(0x225));});});const saved=localStorage[a0_0x49d310(0x1f7)](a0_0x49d310(0x237));if(saved)try{messages=JSON[a0_0x49d310(0x229)](saved),renderMessages();}catch(a0_0x3ebc97){}updateSendButton();