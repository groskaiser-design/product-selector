const a0_0x1a135e=a0_0x4caa;(function(_0x4a71f1,_0x351dd3){const _0x4f1527=a0_0x4caa,_0x56c171=_0x4a71f1();while(!![]){try{const _0x24b09c=parseInt(_0x4f1527(0x237))/0x1*(-parseInt(_0x4f1527(0x1c5))/0x2)+parseInt(_0x4f1527(0x1d1))/0x3*(-parseInt(_0x4f1527(0x1e4))/0x4)+parseInt(_0x4f1527(0x231))/0x5*(parseInt(_0x4f1527(0x1ec))/0x6)+parseInt(_0x4f1527(0x219))/0x7*(-parseInt(_0x4f1527(0x21b))/0x8)+-parseInt(_0x4f1527(0x204))/0x9+-parseInt(_0x4f1527(0x1f5))/0xa*(parseInt(_0x4f1527(0x21a))/0xb)+parseInt(_0x4f1527(0x235))/0xc;if(_0x24b09c===_0x351dd3)break;else _0x56c171['push'](_0x56c171['shift']());}catch(_0x54a4d7){_0x56c171['push'](_0x56c171['shift']());}}}(a0_0x3fb0,0xb542a));const tg=window[a0_0x1a135e(0x1ee)]?.[a0_0x1a135e(0x1c9)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x3e0228=a0_0x1a135e,_0x3a2346=(function(){let _0x694c93=!![];return function(_0x203ba3,_0x4f90f6){const _0x30b8bf=_0x694c93?function(){const _0x5d8bc0=a0_0x4caa;if(_0x4f90f6){const _0xe93d73=_0x4f90f6[_0x5d8bc0(0x216)](_0x203ba3,arguments);return _0x4f90f6=null,_0xe93d73;}}:function(){};return _0x694c93=![],_0x30b8bf;};}()),_0x82aa49=_0x3a2346(this,function(){const _0x5bac47=a0_0x4caa;return _0x82aa49[_0x5bac47(0x200)]()['search'](_0x5bac47(0x1e8))[_0x5bac47(0x200)]()[_0x5bac47(0x233)](_0x82aa49)[_0x5bac47(0x1c3)](_0x5bac47(0x1e8));});_0x82aa49();if(!tg)return;try{tg[_0x3e0228(0x210)](),tg['expand'](),tg[_0x3e0228(0x1d9)]?.(_0x3e0228(0x223));if(tg[_0x3e0228(0x1e0)]?.(_0x3e0228(0x22b)))tg[_0x3e0228(0x23e)]?.();const _0x345b2c=tg[_0x3e0228(0x23a)];if(_0x345b2c){_0x345b2c[_0x3e0228(0x205)]();if(typeof _0x345b2c['offClick']==='function')try{_0x345b2c[_0x3e0228(0x226)]();}catch(_0x37e0b6){}_0x345b2c[_0x3e0228(0x217)](()=>{const _0x52d04f=_0x3e0228;if(tg[_0x52d04f(0x212)])tg[_0x52d04f(0x212)][_0x52d04f(0x23b)](_0x52d04f(0x1fb));location[_0x52d04f(0x1c7)]=HOME_URL;});}}catch(_0x49381d){console[_0x3e0228(0x1bf)](_0x3e0228(0x23f),_0x49381d);}}(function initStableLayout(){const _0x52a3f1=a0_0x1a135e,_0x23281f=document['querySelector'](_0x52a3f1(0x1d7)),_0x4f3789=document[_0x52a3f1(0x1e9)](_0x52a3f1(0x1eb)),_0x3c91fb=document[_0x52a3f1(0x1e9)](_0x52a3f1(0x1ed)),_0x5c4b58=document[_0x52a3f1(0x1e9)](_0x52a3f1(0x211));function _0x261827(){const _0x3b5995=_0x52a3f1;if(!_0x23281f)return;const _0x9ff71c=tg&&tg['viewportHeight']?tg[_0x3b5995(0x1f0)]:window[_0x3b5995(0x1d2)];_0x23281f['style'][_0x3b5995(0x23c)]=_0x9ff71c+'px';if(_0x4f3789){const _0x37189a=_0x4f3789[_0x3b5995(0x1ce)];_0x3c91fb['style'][_0x3b5995(0x22d)]=_0x37189a+0x28+'px';}}tg?tg[_0x52a3f1(0x1ca)](_0x52a3f1(0x1fe),({isStateStable:_0x5253cd})=>{_0x261827();if(_0x5253cd)requestAnimationFrame(()=>{const _0x507912=a0_0x4caa;_0x3c91fb[_0x507912(0x228)]=_0x3c91fb[_0x507912(0x1c4)];});}):window[_0x52a3f1(0x220)](_0x52a3f1(0x1c8),_0x261827),_0x261827(),_0x5c4b58&&(_0x5c4b58['addEventListener'](_0x52a3f1(0x20a),()=>{requestAnimationFrame(_0x261827);}),_0x5c4b58[_0x52a3f1(0x220)](_0x52a3f1(0x1d0),()=>{setTimeout(()=>{const _0xe759b1=a0_0x4caa;_0x3c91fb[_0xe759b1(0x228)]=_0x3c91fb[_0xe759b1(0x1c4)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x4caa(_0x471623,_0x4c0c3b){_0x471623=_0x471623-0x1bc;const _0x3a6e4f=a0_0x3fb0();let _0x2c98fa=_0x3a6e4f[_0x471623];return _0x2c98fa;}const chatArea=document[a0_0x1a135e(0x1e9)](a0_0x1a135e(0x1ed)),emptyState=document[a0_0x1a135e(0x1e9)](a0_0x1a135e(0x203)),messageInput=document[a0_0x1a135e(0x1e9)](a0_0x1a135e(0x211)),sendBtn=document[a0_0x1a135e(0x1e9)]('sendBtn'),clearBtn=document[a0_0x1a135e(0x1e9)]('clearBtn'),modal=document[a0_0x1a135e(0x1e9)](a0_0x1a135e(0x1d4)),mTitle=document[a0_0x1a135e(0x1e9)](a0_0x1a135e(0x1e5)),mText=document[a0_0x1a135e(0x1e9)](a0_0x1a135e(0x1cd));function a0_0x3fb0(){const _0x1ab36f=['modalText','offsetHeight','padStart','focus','1107RWLHCm','innerHeight','Начнется\x20новый\x20диалог.','confirmModal','getMinutes','forEach','.container','user','setHeaderColor','modalCancel','POST','length','querySelectorAll','auto','push','isVersionAtLeast','children','modalConfirm','content','3764VBMWPT','modalTitle','delete-btn','message-time','(((.+)+)+)+$','getElementById','clear_history','inputArea','5993094MTYIRa','chatArea','Telegram','target','viewportHeight','notificationOccurred','disabled','flex','value','4900160VtTzMM','replace','splice','removeItem','abort','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','light','role','stringify','viewportChanged','innerHTML','toString','error','<br>','emptyState','2748492qSVRgR','show','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','Enter','signal','classList','input','trim','debug_uid','min','initData','typingIndicator','ready','messageInput','HapticFeedback','stopPropagation','text','Ошибка\x20сети','apply','onClick','Пустой\x20ответ','4711lOGqMQ','11BgrYAo','4888KpImsu','json','Очистить\x20историю?','getHours','className','addEventListener','timestamp','ai_chat_messages','#050505','click','message\x20ai','offClick','onclick','scrollTop','remove','floor','6.1','display','paddingBottom','div','createElement','style','5VROUPT','contains','constructor','setItem','19747500QGgyWf','.message.show-delete','2moKkNE','text/plain','username','BackButton','impactOccurred','height','getItem','disableVerticalSwipes','TG\x20setup\x20error:','success','now','first_name','random','warn','textContent','touchstart','send_message','search','scrollHeight','348196kpzqeu','key','href','resize','WebApp','onEvent','appendChild','from'];a0_0x3fb0=function(){return _0x1ab36f;};return a0_0x3fb0();}let modalCallback=null;async function callBackend(_0x493c92,_0x1ae6ca){const _0x4100dd=a0_0x1a135e,_0x5a10c4=tg?.['initDataUnsafe']?.[_0x4100dd(0x1d8)]||{},_0x20c630=_0x5a10c4['id']||localStorage[_0x4100dd(0x23d)](_0x4100dd(0x20c))||'d-'+Math[_0x4100dd(0x22a)](Math[_0x4100dd(0x1be)]()*0x3b9aca00);if(!_0x5a10c4['id'])localStorage[_0x4100dd(0x234)](_0x4100dd(0x20c),_0x20c630);const _0x413fe1={'action':_0x493c92,'user_id':_0x20c630,'user_data':{'first_name':_0x5a10c4[_0x4100dd(0x1bd)],'username':_0x5a10c4[_0x4100dd(0x239)]},'init_data':tg?.[_0x4100dd(0x20e)]||'',..._0x1ae6ca},_0x4e1371=new AbortController(),_0x532ea0=setTimeout(()=>_0x4e1371[_0x4100dd(0x1f9)](),REQUEST_TIMEOUT_MS);try{const _0x2ed8eb=await fetch(BACKEND_URL,{'method':_0x4100dd(0x1db),'headers':{'Content-Type':_0x4100dd(0x238)},'body':JSON[_0x4100dd(0x1fd)](_0x413fe1),'signal':_0x4e1371[_0x4100dd(0x208)]});return clearTimeout(_0x532ea0),await _0x2ed8eb[_0x4100dd(0x21c)]();}catch(_0x2a052f){return{'success':![],'error':String(_0x2a052f)};}}function formatTime(_0x2b62c8){const _0x16aa90=a0_0x1a135e,_0x5dfafb=new Date(_0x2b62c8);return String(_0x5dfafb[_0x16aa90(0x21e)]())[_0x16aa90(0x1cf)](0x2,'0')+':'+String(_0x5dfafb[_0x16aa90(0x1d5)]())['padStart'](0x2,'0');}function createMessageElement(_0x5bc9dd,_0x21000e){const _0x354102=a0_0x1a135e,_0x2332d3=document['createElement'](_0x354102(0x22e));_0x2332d3[_0x354102(0x21f)]='message\x20'+_0x5bc9dd[_0x354102(0x1fc)];const _0x5ec51b=document['createElement'](_0x354102(0x22e));_0x5ec51b[_0x354102(0x21f)]='message-bubble',_0x5ec51b[_0x354102(0x1ff)]=_0x5bc9dd[_0x354102(0x1e3)][_0x354102(0x1f6)](/\n/g,_0x354102(0x202));const _0x2184c4=document['createElement'](_0x354102(0x22e));_0x2184c4[_0x354102(0x21f)]=_0x354102(0x1e6),_0x2184c4[_0x354102(0x1ff)]=_0x354102(0x1fa),_0x2184c4[_0x354102(0x227)]=_0x3c987a=>{const _0x23599b=_0x354102;_0x3c987a[_0x23599b(0x213)](),confirmDelete(_0x21000e);};let _0x35fb9e;_0x5ec51b[_0x354102(0x220)](_0x354102(0x1c1),()=>_0x35fb9e=setTimeout(()=>{const _0x186ba1=_0x354102;_0x2332d3[_0x186ba1(0x209)]['add']('show-delete');if(tg?.[_0x186ba1(0x212)])tg[_0x186ba1(0x212)][_0x186ba1(0x23b)]('medium');},0x1f4)),_0x5ec51b[_0x354102(0x220)]('touchend',()=>clearTimeout(_0x35fb9e));const _0x2d4944=document[_0x354102(0x22f)](_0x354102(0x22e));return _0x2d4944[_0x354102(0x21f)]=_0x354102(0x1e7),_0x2d4944[_0x354102(0x1c0)]=formatTime(_0x5bc9dd[_0x354102(0x221)]),_0x2332d3['appendChild'](_0x2184c4),_0x2332d3[_0x354102(0x1cb)](_0x5ec51b),_0x2332d3[_0x354102(0x1cb)](_0x2d4944),_0x2332d3;}function createTypingIndicator(){const _0x30a4ab=a0_0x1a135e,_0x2deb4b=document['createElement'](_0x30a4ab(0x22e));return _0x2deb4b['className']=_0x30a4ab(0x225),_0x2deb4b['id']=_0x30a4ab(0x20f),_0x2deb4b['innerHTML']=_0x30a4ab(0x206),_0x2deb4b;}function renderMessages(){const _0x1408de=a0_0x1a135e;Array[_0x1408de(0x1cc)](chatArea[_0x1408de(0x1e1)])[_0x1408de(0x1d6)](_0x17c714=>{const _0x345e28=_0x1408de;if(_0x17c714['id']!==_0x345e28(0x203))_0x17c714[_0x345e28(0x229)]();}),messages[_0x1408de(0x1dc)]>0x0?(emptyState[_0x1408de(0x230)][_0x1408de(0x22c)]='none',messages[_0x1408de(0x1d6)]((_0x1cb4b7,_0x37cb49)=>chatArea[_0x1408de(0x1cb)](createMessageElement(_0x1cb4b7,_0x37cb49)))):emptyState['style'][_0x1408de(0x22c)]=_0x1408de(0x1f3),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x4664ea=a0_0x1a135e;messageInput[_0x4664ea(0x230)][_0x4664ea(0x23c)]=_0x4664ea(0x1de),messageInput[_0x4664ea(0x230)][_0x4664ea(0x23c)]=Math[_0x4664ea(0x20d)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x5b36ca=a0_0x1a135e,_0xe375ab=messageInput['value']['trim']();sendBtn[_0x5b36ca(0x1f2)]=!_0xe375ab||isTyping;}async function sendMessage(){const _0x48106d=a0_0x1a135e,_0x1c41d7=messageInput[_0x48106d(0x1f4)][_0x48106d(0x20b)]();if(!_0x1c41d7||isTyping)return;if(tg?.[_0x48106d(0x212)])tg[_0x48106d(0x212)][_0x48106d(0x23b)](_0x48106d(0x1fb));messages['push']({'role':_0x48106d(0x1d8),'content':_0x1c41d7,'timestamp':Date[_0x48106d(0x1bc)]()}),localStorage[_0x48106d(0x234)]('ai_chat_messages',JSON[_0x48106d(0x1fd)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x48106d(0x1cb)](createTypingIndicator()),chatArea[_0x48106d(0x228)]=chatArea['scrollHeight'];const _0x122af5=await callBackend(_0x48106d(0x1c2),{'message':_0x1c41d7});isTyping=![];const _0xd94943=document[_0x48106d(0x1e9)](_0x48106d(0x20f));if(_0xd94943)_0xd94943[_0x48106d(0x229)]();let _0x2d3d92=_0x48106d(0x215);if(_0x122af5[_0x48106d(0x240)]){_0x2d3d92=_0x122af5[_0x48106d(0x214)]||_0x48106d(0x218);if(tg?.[_0x48106d(0x212)])tg[_0x48106d(0x212)][_0x48106d(0x1f1)](_0x48106d(0x240));}else{_0x2d3d92=_0x122af5[_0x48106d(0x201)]||'Ошибка\x20сервера';if(tg?.[_0x48106d(0x212)])tg[_0x48106d(0x212)][_0x48106d(0x1f1)](_0x48106d(0x201));}messages[_0x48106d(0x1df)]({'role':'ai','content':_0x2d3d92,'timestamp':Date[_0x48106d(0x1bc)]()}),localStorage[_0x48106d(0x234)](_0x48106d(0x222),JSON[_0x48106d(0x1fd)](messages)),renderMessages();}function confirmDelete(_0x3ff79a){const _0x2dd096=a0_0x1a135e;if(mTitle)mTitle[_0x2dd096(0x1c0)]='Удалить?';if(mText)mText[_0x2dd096(0x1c0)]='Действие\x20необратимо.';modalCallback=()=>{const _0x4fb57c=_0x2dd096;messages[_0x4fb57c(0x1f7)](_0x3ff79a,0x1),localStorage['setItem'](_0x4fb57c(0x222),JSON[_0x4fb57c(0x1fd)](messages)),renderMessages();},modal[_0x2dd096(0x209)]['add'](_0x2dd096(0x205));}if(clearBtn)clearBtn[a0_0x1a135e(0x227)]=()=>{const _0x3a75a7=a0_0x1a135e;if(!messages[_0x3a75a7(0x1dc)])return;if(mTitle)mTitle[_0x3a75a7(0x1c0)]=_0x3a75a7(0x21d);if(mText)mText[_0x3a75a7(0x1c0)]=_0x3a75a7(0x1d3);modalCallback=async()=>{const _0x2b4f0f=_0x3a75a7;messages=[],localStorage[_0x2b4f0f(0x1f8)](_0x2b4f0f(0x222)),renderMessages(),callBackend(_0x2b4f0f(0x1ea),{});},modal[_0x3a75a7(0x209)]['add'](_0x3a75a7(0x205));};document[a0_0x1a135e(0x1e9)](a0_0x1a135e(0x1da))[a0_0x1a135e(0x227)]=()=>modal[a0_0x1a135e(0x209)]['remove'](a0_0x1a135e(0x205)),document[a0_0x1a135e(0x1e9)](a0_0x1a135e(0x1e2))[a0_0x1a135e(0x227)]=()=>{const _0x734087=a0_0x1a135e;if(modalCallback)modalCallback();modal[_0x734087(0x209)][_0x734087(0x229)](_0x734087(0x205));},messageInput[a0_0x1a135e(0x220)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x200c6a=>{const _0xb45f1e=a0_0x1a135e;_0x200c6a[_0xb45f1e(0x1c6)]===_0xb45f1e(0x207)&&!_0x200c6a['shiftKey']&&(_0x200c6a['preventDefault'](),sendMessage());}),sendBtn[a0_0x1a135e(0x227)]=sendMessage,document[a0_0x1a135e(0x220)](a0_0x1a135e(0x224),_0x2a6521=>{const _0x2f6b91=a0_0x1a135e;document[_0x2f6b91(0x1dd)](_0x2f6b91(0x236))[_0x2f6b91(0x1d6)](_0x504ea7=>{const _0x5248e9=_0x2f6b91;if(!_0x504ea7[_0x5248e9(0x232)](_0x2a6521[_0x5248e9(0x1ef)]))_0x504ea7[_0x5248e9(0x209)][_0x5248e9(0x229)]('show-delete');});});const saved=localStorage[a0_0x1a135e(0x23d)]('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x4f8f6c){}updateSendButton();