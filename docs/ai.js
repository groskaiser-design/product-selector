const a0_0x234b26=a0_0x3469;(function(_0x5b960c,_0x838e82){const _0xdfb833=a0_0x3469,_0x1ce8f0=_0x5b960c();while(!![]){try{const _0x445e2a=-parseInt(_0xdfb833(0x12e))/0x1*(-parseInt(_0xdfb833(0xf9))/0x2)+parseInt(_0xdfb833(0x14d))/0x3+-parseInt(_0xdfb833(0x11f))/0x4*(-parseInt(_0xdfb833(0x10c))/0x5)+parseInt(_0xdfb833(0x132))/0x6*(-parseInt(_0xdfb833(0x12c))/0x7)+-parseInt(_0xdfb833(0xd6))/0x8*(parseInt(_0xdfb833(0x11e))/0x9)+-parseInt(_0xdfb833(0x10b))/0xa*(parseInt(_0xdfb833(0x135))/0xb)+parseInt(_0xdfb833(0x130))/0xc*(parseInt(_0xdfb833(0xea))/0xd);if(_0x445e2a===_0x838e82)break;else _0x1ce8f0['push'](_0x1ce8f0['shift']());}catch(_0x310b5c){_0x1ce8f0['push'](_0x1ce8f0['shift']());}}}(a0_0x33b2,0xb2ccc));const tg=window[a0_0x234b26(0xd4)]?.[a0_0x234b26(0x11a)],HOME_URL=a0_0x234b26(0x133);function setupTelegramBackButton(){const _0x3cc3f6=a0_0x234b26,_0x50dab6=(function(){let _0x4b6479=!![];return function(_0xe87f58,_0x4ff1d9){const _0x24f20b=_0x4b6479?function(){if(_0x4ff1d9){const _0x485732=_0x4ff1d9['apply'](_0xe87f58,arguments);return _0x4ff1d9=null,_0x485732;}}:function(){};return _0x4b6479=![],_0x24f20b;};}()),_0x72e11a=_0x50dab6(this,function(){const _0x27b8af=a0_0x3469;return _0x72e11a['toString']()[_0x27b8af(0xdf)](_0x27b8af(0x101))[_0x27b8af(0x127)]()['constructor'](_0x72e11a)[_0x27b8af(0xdf)](_0x27b8af(0x101));});_0x72e11a();if(!tg)return;try{tg[_0x3cc3f6(0x105)](),tg[_0x3cc3f6(0x10d)](),tg[_0x3cc3f6(0xde)]?.('#050505');if(tg[_0x3cc3f6(0xf7)]?.(_0x3cc3f6(0xfe)))tg[_0x3cc3f6(0x122)]?.();const _0x853681=tg[_0x3cc3f6(0xd1)];if(_0x853681){_0x853681[_0x3cc3f6(0xfc)]();if(typeof _0x853681[_0x3cc3f6(0xd3)]===_0x3cc3f6(0x14b))try{_0x853681[_0x3cc3f6(0xd3)]();}catch(_0x281cbd){}_0x853681['onClick'](()=>{const _0x464f63=_0x3cc3f6;if(tg[_0x464f63(0x14c)])tg[_0x464f63(0x14c)][_0x464f63(0xd7)](_0x464f63(0x134));location[_0x464f63(0x131)]=HOME_URL;});}}catch(_0x5e4e1b){console[_0x3cc3f6(0x11c)](_0x3cc3f6(0x13c),_0x5e4e1b);}}(function initStableLayout(){const _0x5ae137=a0_0x234b26,_0x5df92e=document['querySelector'](_0x5ae137(0x14e)),_0x3005fe=document['getElementById'](_0x5ae137(0x116)),_0x51e6be=document[_0x5ae137(0x121)](_0x5ae137(0xfa)),_0x59c0be=document[_0x5ae137(0x121)](_0x5ae137(0xe5));function _0x4bda91(){const _0x39c7ba=_0x5ae137;if(!_0x5df92e)return;const _0xa2fbbc=tg&&tg['viewportHeight']?tg[_0x39c7ba(0x125)]:window['innerHeight'];_0x5df92e[_0x39c7ba(0x148)][_0x39c7ba(0x141)]=_0xa2fbbc+'px';if(_0x3005fe){const _0x43d6af=_0x3005fe[_0x39c7ba(0xdc)];_0x51e6be[_0x39c7ba(0x148)]['paddingBottom']=_0x43d6af+0x28+'px';}}tg?tg[_0x5ae137(0xe0)]('viewportChanged',({isStateStable:_0x2c32c0})=>{_0x4bda91();if(_0x2c32c0)requestAnimationFrame(()=>{const _0x28a7f1=a0_0x3469;_0x51e6be['scrollTop']=_0x51e6be[_0x28a7f1(0x117)];});}):window[_0x5ae137(0xd5)](_0x5ae137(0x137),_0x4bda91),_0x4bda91(),_0x59c0be&&(_0x59c0be[_0x5ae137(0xd5)]('input',()=>{requestAnimationFrame(_0x4bda91);}),_0x59c0be[_0x5ae137(0xd5)](_0x5ae137(0xe6),()=>{setTimeout(()=>{const _0x59d4f1=a0_0x3469;_0x51e6be['scrollTop']=_0x51e6be[_0x59d4f1(0x117)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x234b26(0x146),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x234b26(0x121)](a0_0x234b26(0xfa)),emptyState=document[a0_0x234b26(0x121)](a0_0x234b26(0xd8)),messageInput=document[a0_0x234b26(0x121)](a0_0x234b26(0xe5)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x234b26(0x121)](a0_0x234b26(0x13f)),modal=document[a0_0x234b26(0x121)](a0_0x234b26(0xf0)),mTitle=document[a0_0x234b26(0x121)](a0_0x234b26(0xec)),mText=document['getElementById'](a0_0x234b26(0xcf));let modalCallback=null;async function callBackend(_0x371449,_0x547f35){const _0x306b0d=a0_0x234b26,_0x542a70=tg?.[_0x306b0d(0x110)]?.[_0x306b0d(0xe2)]||{},_0x16b56e=_0x542a70['id']||localStorage[_0x306b0d(0x108)](_0x306b0d(0x143))||'d-'+Math[_0x306b0d(0xf4)](Math[_0x306b0d(0x151)]()*0x3b9aca00);if(!_0x542a70['id'])localStorage[_0x306b0d(0x111)](_0x306b0d(0x143),_0x16b56e);const _0x39bd44={'action':_0x371449,'user_id':_0x16b56e,'user_data':{'first_name':_0x542a70[_0x306b0d(0xff)],'username':_0x542a70[_0x306b0d(0x13a)]},'init_data':tg?.[_0x306b0d(0x12d)]||'',..._0x547f35},_0x36ad2a=new AbortController(),_0x4ac389=setTimeout(()=>_0x36ad2a[_0x306b0d(0xe4)](),REQUEST_TIMEOUT_MS);try{const _0x536453=await fetch(BACKEND_URL,{'method':_0x306b0d(0x129),'headers':{'Content-Type':_0x306b0d(0x149)},'body':JSON[_0x306b0d(0x12b)](_0x39bd44),'signal':_0x36ad2a[_0x306b0d(0x14a)]});return clearTimeout(_0x4ac389),await _0x536453[_0x306b0d(0xf3)]();}catch(_0x171fcf){return{'success':![],'error':String(_0x171fcf)};}}function formatTime(_0x2e0625){const _0x2e1768=a0_0x234b26,_0x276f8b=new Date(_0x2e0625);return String(_0x276f8b[_0x2e1768(0x145)]())[_0x2e1768(0x13b)](0x2,'0')+':'+String(_0x276f8b[_0x2e1768(0x120)]())[_0x2e1768(0x13b)](0x2,'0');}function createMessageElement(_0x11356c,_0x14b358){const _0x240317=a0_0x234b26,_0x46787d=document['createElement']('div');_0x46787d[_0x240317(0x100)]=_0x240317(0xe8)+_0x11356c['role'];const _0x6813d9=document[_0x240317(0x144)](_0x240317(0x13e));_0x6813d9[_0x240317(0x100)]=_0x240317(0x123),_0x6813d9[_0x240317(0x109)]=_0x11356c[_0x240317(0x103)][_0x240317(0x139)](/\n/g,_0x240317(0xf1));const _0x2229a1=document['createElement'](_0x240317(0x13e));_0x2229a1[_0x240317(0x100)]=_0x240317(0xe7),_0x2229a1[_0x240317(0x109)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x2229a1[_0x240317(0x112)]=_0x420b91=>{_0x420b91['stopPropagation'](),confirmDelete(_0x14b358);};let _0x4927a3;_0x6813d9['addEventListener'](_0x240317(0xeb),()=>_0x4927a3=setTimeout(()=>{const _0x29dc40=_0x240317;_0x46787d['classList'][_0x29dc40(0xd2)](_0x29dc40(0xd0));if(tg?.[_0x29dc40(0x14c)])tg[_0x29dc40(0x14c)]['impactOccurred'](_0x29dc40(0x147));},0x1f4)),_0x6813d9[_0x240317(0xd5)](_0x240317(0x12a),()=>clearTimeout(_0x4927a3));const _0x2483e1=document[_0x240317(0x144)](_0x240317(0x13e));return _0x2483e1[_0x240317(0x100)]=_0x240317(0x126),_0x2483e1[_0x240317(0x11b)]=formatTime(_0x11356c[_0x240317(0x13d)]),_0x46787d[_0x240317(0xed)](_0x2229a1),_0x46787d['appendChild'](_0x6813d9),_0x46787d[_0x240317(0xed)](_0x2483e1),_0x46787d;}function a0_0x3469(_0x599c1c,_0x27b1f8){_0x599c1c=_0x599c1c-0xcd;const _0x3433ce=a0_0x33b2();let _0x1048ab=_0x3433ce[_0x599c1c];return _0x1048ab;}function createTypingIndicator(){const _0x31c54b=a0_0x234b26,_0x498566=document[_0x31c54b(0x144)](_0x31c54b(0x13e));return _0x498566[_0x31c54b(0x100)]=_0x31c54b(0x118),_0x498566['id']='typingIndicator',_0x498566[_0x31c54b(0x109)]=_0x31c54b(0x153),_0x498566;}function renderMessages(){const _0x5809dd=a0_0x234b26;Array['from'](chatArea[_0x5809dd(0x114)])[_0x5809dd(0x119)](_0x312075=>{const _0x35b007=_0x5809dd;if(_0x312075['id']!==_0x35b007(0xd8))_0x312075[_0x35b007(0xe9)]();}),messages['length']>0x0?(emptyState[_0x5809dd(0x148)][_0x5809dd(0xfb)]=_0x5809dd(0x104),messages[_0x5809dd(0x119)]((_0x54851f,_0x273b23)=>chatArea[_0x5809dd(0xed)](createMessageElement(_0x54851f,_0x273b23)))):emptyState['style'][_0x5809dd(0xfb)]=_0x5809dd(0x150),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x41c7bd=a0_0x234b26;messageInput[_0x41c7bd(0x148)][_0x41c7bd(0x141)]=_0x41c7bd(0xe1),messageInput[_0x41c7bd(0x148)]['height']=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x137de6=a0_0x234b26,_0x40d6a3=messageInput[_0x137de6(0xd9)][_0x137de6(0xfd)]();sendBtn[_0x137de6(0xee)]=!_0x40d6a3||isTyping;}async function sendMessage(){const _0x55d26a=a0_0x234b26,_0x1d4f7f=messageInput[_0x55d26a(0xd9)][_0x55d26a(0xfd)]();if(!_0x1d4f7f||isTyping)return;if(tg?.[_0x55d26a(0x14c)])tg[_0x55d26a(0x14c)][_0x55d26a(0xd7)](_0x55d26a(0x134));messages['push']({'role':_0x55d26a(0xe2),'content':_0x1d4f7f,'timestamp':Date[_0x55d26a(0x124)]()}),localStorage['setItem'](_0x55d26a(0xf5),JSON[_0x55d26a(0x12b)](messages)),renderMessages(),messageInput[_0x55d26a(0xd9)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x55d26a(0xed)](createTypingIndicator()),chatArea[_0x55d26a(0x136)]=chatArea[_0x55d26a(0x117)];const _0x3d323f=await callBackend(_0x55d26a(0xda),{'message':_0x1d4f7f});isTyping=![];const _0x49bf33=document['getElementById']('typingIndicator');if(_0x49bf33)_0x49bf33[_0x55d26a(0xe9)]();let _0x14a3eb=_0x55d26a(0x113);if(_0x3d323f[_0x55d26a(0xf2)]){_0x14a3eb=_0x3d323f[_0x55d26a(0x128)]||_0x55d26a(0x10a);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x55d26a(0xcd)](_0x55d26a(0xf2));}else{_0x14a3eb=_0x3d323f['error']||_0x55d26a(0xdd);if(tg?.[_0x55d26a(0x14c)])tg[_0x55d26a(0x14c)]['notificationOccurred'](_0x55d26a(0xce));}messages['push']({'role':'ai','content':_0x14a3eb,'timestamp':Date['now']()}),localStorage['setItem'](_0x55d26a(0xf5),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x14b87b){const _0xa4cb4f=a0_0x234b26;if(mTitle)mTitle[_0xa4cb4f(0x11b)]='Удалить?';if(mText)mText[_0xa4cb4f(0x11b)]=_0xa4cb4f(0x10f);modalCallback=()=>{const _0x2079c9=_0xa4cb4f;messages[_0x2079c9(0x102)](_0x14b87b,0x1),localStorage[_0x2079c9(0x111)](_0x2079c9(0xf5),JSON[_0x2079c9(0x12b)](messages)),renderMessages();},modal[_0xa4cb4f(0x142)][_0xa4cb4f(0xd2)](_0xa4cb4f(0xfc));}function a0_0x33b2(){const _0x2e025a=['timestamp','div','clearBtn','Enter','height','classList','debug_uid','createElement','getHours','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','medium','style','text/plain','signal','function','HapticFeedback','6630fnwvCM','.container','parse','flex','random','input','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','notificationOccurred','error','modalText','show-delete','BackButton','add','offClick','Telegram','addEventListener','632136jZoyEo','impactOccurred','emptyState','value','send_message','.message.show-delete','offsetHeight','Ошибка\x20сервера','setHeaderColor','search','onEvent','auto','user','length','abort','messageInput','focus','delete-btn','message\x20','remove','2298647adRJug','touchstart','modalTitle','appendChild','disabled','keydown','confirmModal','<br>','success','json','floor','ai_chat_messages','shiftKey','isVersionAtLeast','click','2OvnQZl','chatArea','display','show','trim','6.1','first_name','className','(((.+)+)+)+$','splice','content','none','ready','removeItem','modalConfirm','getItem','innerHTML','Пустой\x20ответ','3793970uYqMYo','25HMTtdg','expand','target','Действие\x20необратимо.','initDataUnsafe','setItem','onclick','Ошибка\x20сети','children','querySelectorAll','inputArea','scrollHeight','message\x20ai','forEach','WebApp','textContent','warn','clear_history','117pSOqok','291308bhrEoJ','getMinutes','getElementById','disableVerticalSwipes','message-bubble','now','viewportHeight','message-time','toString','text','POST','touchend','stringify','644oLEKJp','initData','405843cBzFgl','Начнется\x20новый\x20диалог.','120TAvoGx','href','26178RVHbEV','./router.html','light','11sORzaK','scrollTop','resize','key','replace','username','padStart','TG\x20setup\x20error:'];a0_0x33b2=function(){return _0x2e025a;};return a0_0x33b2();}if(clearBtn)clearBtn[a0_0x234b26(0x112)]=()=>{const _0x2d3f48=a0_0x234b26;if(!messages[_0x2d3f48(0xe3)])return;if(mTitle)mTitle[_0x2d3f48(0x11b)]='Очистить\x20историю?';if(mText)mText[_0x2d3f48(0x11b)]=_0x2d3f48(0x12f);modalCallback=async()=>{const _0x1fcd66=_0x2d3f48;messages=[],localStorage[_0x1fcd66(0x106)]('ai_chat_messages'),renderMessages(),callBackend(_0x1fcd66(0x11d),{});},modal[_0x2d3f48(0x142)][_0x2d3f48(0xd2)]('show');};document[a0_0x234b26(0x121)]('modalCancel')[a0_0x234b26(0x112)]=()=>modal[a0_0x234b26(0x142)][a0_0x234b26(0xe9)]('show'),document[a0_0x234b26(0x121)](a0_0x234b26(0x107))[a0_0x234b26(0x112)]=()=>{const _0x92dd30=a0_0x234b26;if(modalCallback)modalCallback();modal[_0x92dd30(0x142)][_0x92dd30(0xe9)](_0x92dd30(0xfc));},messageInput[a0_0x234b26(0xd5)](a0_0x234b26(0x152),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x234b26(0xd5)](a0_0x234b26(0xef),_0x4d393a=>{const _0x9c0283=a0_0x234b26;_0x4d393a[_0x9c0283(0x138)]===_0x9c0283(0x140)&&!_0x4d393a[_0x9c0283(0xf6)]&&(_0x4d393a['preventDefault'](),sendMessage());}),sendBtn[a0_0x234b26(0x112)]=sendMessage,document[a0_0x234b26(0xd5)](a0_0x234b26(0xf8),_0x5d28c7=>{const _0x39dc93=a0_0x234b26;document[_0x39dc93(0x115)](_0x39dc93(0xdb))[_0x39dc93(0x119)](_0x530ce5=>{const _0x254ffa=_0x39dc93;if(!_0x530ce5['contains'](_0x5d28c7[_0x254ffa(0x10e)]))_0x530ce5[_0x254ffa(0x142)][_0x254ffa(0xe9)](_0x254ffa(0xd0));});});const saved=localStorage[a0_0x234b26(0x108)](a0_0x234b26(0xf5));if(saved)try{messages=JSON[a0_0x234b26(0x14f)](saved),renderMessages();}catch(a0_0x5746fc){}updateSendButton();