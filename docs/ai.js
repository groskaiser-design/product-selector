const a0_0x508caa=a0_0x4aff;(function(_0x3d01cc,_0x24e747){const _0x344a34=a0_0x4aff,_0x413c7b=_0x3d01cc();while(!![]){try{const _0xcac631=parseInt(_0x344a34(0x1e4))/0x1+-parseInt(_0x344a34(0x1fd))/0x2*(parseInt(_0x344a34(0x209))/0x3)+-parseInt(_0x344a34(0x235))/0x4*(parseInt(_0x344a34(0x250))/0x5)+-parseInt(_0x344a34(0x1e3))/0x6+parseInt(_0x344a34(0x24e))/0x7+parseInt(_0x344a34(0x1ec))/0x8+parseInt(_0x344a34(0x21a))/0x9;if(_0xcac631===_0x24e747)break;else _0x413c7b['push'](_0x413c7b['shift']());}catch(_0x727f22){_0x413c7b['push'](_0x413c7b['shift']());}}}(a0_0xaa19,0xc41ba));const tg=window['Telegram']?.[a0_0x508caa(0x201)],HOME_URL=a0_0x508caa(0x1df);function setupTelegramBackButton(){const _0x75e4c7=a0_0x508caa,_0x7c7da6=(function(){let _0x4f8640=!![];return function(_0x5b8a36,_0x3bc08e){const _0x8bc584=_0x4f8640?function(){const _0x41de12=a0_0x4aff;if(_0x3bc08e){const _0xf7d7c1=_0x3bc08e[_0x41de12(0x242)](_0x5b8a36,arguments);return _0x3bc08e=null,_0xf7d7c1;}}:function(){};return _0x4f8640=![],_0x8bc584;};}()),_0x44ee2d=_0x7c7da6(this,function(){const _0x5d91f2=a0_0x4aff;return _0x44ee2d[_0x5d91f2(0x1dd)]()['search'](_0x5d91f2(0x234))[_0x5d91f2(0x1dd)]()['constructor'](_0x44ee2d)[_0x5d91f2(0x200)]('(((.+)+)+)+$');});_0x44ee2d();if(!tg)return;try{tg[_0x75e4c7(0x1e2)](),tg['expand'](),tg[_0x75e4c7(0x1f3)]?.('#050505');if(tg['isVersionAtLeast']?.(_0x75e4c7(0x23f)))tg[_0x75e4c7(0x231)]?.();const _0x53f0da=tg[_0x75e4c7(0x205)];if(_0x53f0da){_0x53f0da['show']();if(typeof _0x53f0da[_0x75e4c7(0x1f8)]===_0x75e4c7(0x23c))try{_0x53f0da[_0x75e4c7(0x1f8)]();}catch(_0x555e35){}_0x53f0da[_0x75e4c7(0x208)](()=>{const _0x251d6a=_0x75e4c7;if(tg[_0x251d6a(0x230)])tg['HapticFeedback'][_0x251d6a(0x213)](_0x251d6a(0x21c));location[_0x251d6a(0x1f6)]=HOME_URL;});}}catch(_0x1cbb45){console['warn']('TG\x20setup\x20error:',_0x1cbb45);}}(function initStableLayout(){const _0x5afbb3=a0_0x508caa,_0x270f80=document[_0x5afbb3(0x1ed)](_0x5afbb3(0x219)),_0x5f6c2=document[_0x5afbb3(0x20e)](_0x5afbb3(0x214)),_0x3c8961=document[_0x5afbb3(0x20e)](_0x5afbb3(0x21b)),_0x401ebf=document['getElementById'](_0x5afbb3(0x238));function _0x53b00a(){const _0x5a3050=_0x5afbb3;if(!_0x270f80)return;const _0x5a6d3e=tg&&tg[_0x5a3050(0x1e1)]?tg['viewportHeight']:window[_0x5a3050(0x1db)];_0x270f80[_0x5a3050(0x1d6)]['height']=_0x5a6d3e+'px';if(_0x5f6c2){const _0x239c3e=_0x5f6c2[_0x5a3050(0x21e)];_0x3c8961[_0x5a3050(0x1d6)]['paddingBottom']=_0x239c3e+0x28+'px';}}tg?tg[_0x5afbb3(0x221)]('viewportChanged',({isStateStable:_0x19acba})=>{_0x53b00a();if(_0x19acba)requestAnimationFrame(()=>{const _0x3fc243=a0_0x4aff;_0x3c8961[_0x3fc243(0x226)]=_0x3c8961[_0x3fc243(0x21d)];});}):window[_0x5afbb3(0x21f)]('resize',_0x53b00a),_0x53b00a(),_0x401ebf&&(_0x401ebf[_0x5afbb3(0x21f)](_0x5afbb3(0x1fa),()=>{requestAnimationFrame(_0x53b00a);}),_0x401ebf['addEventListener'](_0x5afbb3(0x1fe),()=>{setTimeout(()=>{_0x3c8961['scrollTop']=_0x3c8961['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x508caa(0x21b)),emptyState=document[a0_0x508caa(0x20e)](a0_0x508caa(0x216)),messageInput=document[a0_0x508caa(0x20e)](a0_0x508caa(0x238)),sendBtn=document[a0_0x508caa(0x20e)]('sendBtn'),clearBtn=document[a0_0x508caa(0x20e)](a0_0x508caa(0x203)),modal=document[a0_0x508caa(0x20e)](a0_0x508caa(0x218)),mTitle=document[a0_0x508caa(0x20e)]('modalTitle'),mText=document[a0_0x508caa(0x20e)](a0_0x508caa(0x20c));let modalCallback=null;async function callBackend(_0x17500e,_0x2870f4){const _0x252ae8=a0_0x508caa,_0x59fc5e=tg?.[_0x252ae8(0x1da)]?.[_0x252ae8(0x23b)]||{},_0x183d59=_0x59fc5e['id']||localStorage['getItem'](_0x252ae8(0x247))||'d-'+Math[_0x252ae8(0x24a)](Math[_0x252ae8(0x232)]()*0x3b9aca00);if(!_0x59fc5e['id'])localStorage[_0x252ae8(0x1eb)](_0x252ae8(0x247),_0x183d59);const _0xc19d0e={'action':_0x17500e,'user_id':_0x183d59,'user_data':{'first_name':_0x59fc5e[_0x252ae8(0x240)],'username':_0x59fc5e[_0x252ae8(0x20a)]},'init_data':tg?.['initData']||'',..._0x2870f4},_0x381c68=new AbortController(),_0x395dde=setTimeout(()=>_0x381c68[_0x252ae8(0x246)](),REQUEST_TIMEOUT_MS);try{const _0x316c86=await fetch(BACKEND_URL,{'method':_0x252ae8(0x236),'headers':{'Content-Type':_0x252ae8(0x239)},'body':JSON[_0x252ae8(0x223)](_0xc19d0e),'signal':_0x381c68['signal']});return clearTimeout(_0x395dde),await _0x316c86[_0x252ae8(0x1e6)]();}catch(_0x2cdb03){return{'success':![],'error':String(_0x2cdb03)};}}function formatTime(_0x530394){const _0x40e8ee=a0_0x508caa,_0x2716c1=new Date(_0x530394);return String(_0x2716c1[_0x40e8ee(0x217)]())[_0x40e8ee(0x24b)](0x2,'0')+':'+String(_0x2716c1[_0x40e8ee(0x207)]())[_0x40e8ee(0x24b)](0x2,'0');}function createMessageElement(_0x43df6e,_0x3d5847){const _0x5c964e=a0_0x508caa,_0x2aab69=document[_0x5c964e(0x210)]('div');_0x2aab69[_0x5c964e(0x249)]=_0x5c964e(0x241)+_0x43df6e[_0x5c964e(0x1e5)];const _0x40cd3b=document[_0x5c964e(0x210)]('div');_0x40cd3b[_0x5c964e(0x249)]=_0x5c964e(0x22d),_0x40cd3b[_0x5c964e(0x1f2)]=_0x43df6e[_0x5c964e(0x1e9)]['replace'](/\n/g,'<br>');const _0x36a1f5=document[_0x5c964e(0x210)](_0x5c964e(0x206));_0x36a1f5[_0x5c964e(0x249)]=_0x5c964e(0x227),_0x36a1f5['innerHTML']=_0x5c964e(0x23a),_0x36a1f5[_0x5c964e(0x23d)]=_0x1d77c2=>{const _0x2c6452=_0x5c964e;_0x1d77c2[_0x2c6452(0x1f5)](),confirmDelete(_0x3d5847);};let _0x39499d;_0x40cd3b[_0x5c964e(0x21f)](_0x5c964e(0x1ef),()=>_0x39499d=setTimeout(()=>{const _0x3c1b8c=_0x5c964e;_0x2aab69[_0x3c1b8c(0x20d)]['add'](_0x3c1b8c(0x1f0));if(tg?.['HapticFeedback'])tg[_0x3c1b8c(0x230)]['impactOccurred'](_0x3c1b8c(0x24d));},0x1f4)),_0x40cd3b[_0x5c964e(0x21f)]('touchend',()=>clearTimeout(_0x39499d));const _0x57ef62=document[_0x5c964e(0x210)](_0x5c964e(0x206));return _0x57ef62['className']='message-time',_0x57ef62[_0x5c964e(0x1f7)]=formatTime(_0x43df6e[_0x5c964e(0x244)]),_0x2aab69[_0x5c964e(0x1d7)](_0x36a1f5),_0x2aab69[_0x5c964e(0x1d7)](_0x40cd3b),_0x2aab69[_0x5c964e(0x1d7)](_0x57ef62),_0x2aab69;}function createTypingIndicator(){const _0xca9aa4=a0_0x508caa,_0x294e3a=document[_0xca9aa4(0x210)](_0xca9aa4(0x206));return _0x294e3a[_0xca9aa4(0x249)]=_0xca9aa4(0x24f),_0x294e3a['id']=_0xca9aa4(0x1ee),_0x294e3a[_0xca9aa4(0x1f2)]=_0xca9aa4(0x1e8),_0x294e3a;}function renderMessages(){const _0x4d1ec8=a0_0x508caa;Array[_0x4d1ec8(0x215)](chatArea['children'])[_0x4d1ec8(0x1f1)](_0x492515=>{const _0x436ef5=_0x4d1ec8;if(_0x492515['id']!==_0x436ef5(0x216))_0x492515['remove']();}),messages[_0x4d1ec8(0x228)]>0x0?(emptyState['style'][_0x4d1ec8(0x1ff)]=_0x4d1ec8(0x24c),messages['forEach']((_0x2b537b,_0x305656)=>chatArea['appendChild'](createMessageElement(_0x2b537b,_0x305656)))):emptyState[_0x4d1ec8(0x1d6)]['display']=_0x4d1ec8(0x22e),requestAnimationFrame(()=>chatArea[_0x4d1ec8(0x226)]=chatArea['scrollHeight']);}function a0_0xaa19(){const _0x170c91=['random','trim','(((.+)+)+)+$','2049668uwgQLU','POST','min','messageInput','text/plain','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','user','function','onclick','modalCancel','6.1','first_name','message\x20','apply','target','timestamp','value','abort','debug_uid','height','className','floor','padStart','none','medium','2125683nhwIcZ','message\x20ai','5jeeJLo','style','appendChild','text','querySelectorAll','initDataUnsafe','innerHeight','Пустой\x20ответ','toString','Ошибка\x20сети','./router.html','keydown','viewportHeight','ready','3347310sRbEXc','766050uBAshv','role','json','success','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','content','Действие\x20необратимо.','setItem','10751224CpBPGA','querySelector','typingIndicator','touchstart','show-delete','forEach','innerHTML','setHeaderColor','Начнется\x20новый\x20диалог.','stopPropagation','href','textContent','offClick','push','input','click','error','446XPwpxQ','focus','display','search','WebApp','Удалить?','clearBtn','.message.show-delete','BackButton','div','getMinutes','onClick','13800QQpjaD','username','Очистить\x20историю?','modalText','classList','getElementById','Enter','createElement','now','modalConfirm','impactOccurred','inputArea','from','emptyState','getHours','confirmModal','.container','4371642hhzDaG','chatArea','light','scrollHeight','offsetHeight','addEventListener','shiftKey','onEvent','removeItem','stringify','notificationOccurred','clear_history','scrollTop','delete-btn','length','contains','auto','add','remove','message-bubble','flex','ai_chat_messages','HapticFeedback','disableVerticalSwipes'];a0_0xaa19=function(){return _0x170c91;};return a0_0xaa19();}function autoResizeTextarea(){const _0x70a246=a0_0x508caa;messageInput[_0x70a246(0x1d6)]['height']=_0x70a246(0x22a),messageInput[_0x70a246(0x1d6)][_0x70a246(0x248)]=Math[_0x70a246(0x237)](messageInput[_0x70a246(0x21d)],0x78)+'px';}function updateSendButton(){const _0x41b218=a0_0x508caa,_0x21c30a=messageInput[_0x41b218(0x245)][_0x41b218(0x233)]();sendBtn['disabled']=!_0x21c30a||isTyping;}function a0_0x4aff(_0x38f927,_0x5c5f31){_0x38f927=_0x38f927-0x1d6;const _0x392efd=a0_0xaa19();let _0x4744e8=_0x392efd[_0x38f927];return _0x4744e8;}async function sendMessage(){const _0x3007e5=a0_0x508caa,_0x707e11=messageInput[_0x3007e5(0x245)][_0x3007e5(0x233)]();if(!_0x707e11||isTyping)return;if(tg?.[_0x3007e5(0x230)])tg['HapticFeedback'][_0x3007e5(0x213)](_0x3007e5(0x21c));messages[_0x3007e5(0x1f9)]({'role':_0x3007e5(0x23b),'content':_0x707e11,'timestamp':Date[_0x3007e5(0x211)]()}),localStorage[_0x3007e5(0x1eb)]('ai_chat_messages',JSON[_0x3007e5(0x223)](messages)),renderMessages(),messageInput[_0x3007e5(0x245)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x3007e5(0x1d7)](createTypingIndicator()),chatArea[_0x3007e5(0x226)]=chatArea['scrollHeight'];const _0x5c47eb=await callBackend('send_message',{'message':_0x707e11});isTyping=![];const _0x46217d=document[_0x3007e5(0x20e)](_0x3007e5(0x1ee));if(_0x46217d)_0x46217d[_0x3007e5(0x22c)]();let _0x52571c=_0x3007e5(0x1de);if(_0x5c47eb['success']){_0x52571c=_0x5c47eb[_0x3007e5(0x1d8)]||_0x3007e5(0x1dc);if(tg?.[_0x3007e5(0x230)])tg['HapticFeedback'][_0x3007e5(0x224)](_0x3007e5(0x1e7));}else{_0x52571c=_0x5c47eb[_0x3007e5(0x1fc)]||'Ошибка\x20сервера';if(tg?.[_0x3007e5(0x230)])tg[_0x3007e5(0x230)][_0x3007e5(0x224)](_0x3007e5(0x1fc));}messages[_0x3007e5(0x1f9)]({'role':'ai','content':_0x52571c,'timestamp':Date['now']()}),localStorage[_0x3007e5(0x1eb)](_0x3007e5(0x22f),JSON[_0x3007e5(0x223)](messages)),renderMessages();}function confirmDelete(_0x1c196a){const _0x3598b0=a0_0x508caa;if(mTitle)mTitle['textContent']=_0x3598b0(0x202);if(mText)mText[_0x3598b0(0x1f7)]=_0x3598b0(0x1ea);modalCallback=()=>{const _0x37c7de=_0x3598b0;messages['splice'](_0x1c196a,0x1),localStorage[_0x37c7de(0x1eb)](_0x37c7de(0x22f),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x3598b0(0x22b)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0x30b045=a0_0x508caa;if(!messages[_0x30b045(0x228)])return;if(mTitle)mTitle[_0x30b045(0x1f7)]=_0x30b045(0x20b);if(mText)mText[_0x30b045(0x1f7)]=_0x30b045(0x1f4);modalCallback=async()=>{const _0x48daba=_0x30b045;messages=[],localStorage[_0x48daba(0x222)]('ai_chat_messages'),renderMessages(),callBackend(_0x48daba(0x225),{});},modal['classList'][_0x30b045(0x22b)]('show');};document[a0_0x508caa(0x20e)](a0_0x508caa(0x23e))[a0_0x508caa(0x23d)]=()=>modal[a0_0x508caa(0x20d)][a0_0x508caa(0x22c)]('show'),document[a0_0x508caa(0x20e)](a0_0x508caa(0x212))[a0_0x508caa(0x23d)]=()=>{const _0xeb113d=a0_0x508caa;if(modalCallback)modalCallback();modal[_0xeb113d(0x20d)][_0xeb113d(0x22c)]('show');},messageInput['addEventListener'](a0_0x508caa(0x1fa),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x508caa(0x1e0),_0x1e5d8d=>{const _0xede8bb=a0_0x508caa;_0x1e5d8d['key']===_0xede8bb(0x20f)&&!_0x1e5d8d[_0xede8bb(0x220)]&&(_0x1e5d8d['preventDefault'](),sendMessage());}),sendBtn[a0_0x508caa(0x23d)]=sendMessage,document['addEventListener'](a0_0x508caa(0x1fb),_0x223235=>{const _0x7190e2=a0_0x508caa;document[_0x7190e2(0x1d9)](_0x7190e2(0x204))[_0x7190e2(0x1f1)](_0x328c6b=>{const _0x40c238=_0x7190e2;if(!_0x328c6b[_0x40c238(0x229)](_0x223235[_0x40c238(0x243)]))_0x328c6b['classList']['remove'](_0x40c238(0x1f0));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x19718f){}updateSendButton();