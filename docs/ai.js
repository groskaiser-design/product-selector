const a0_0x30896e=a0_0x2ef5;function a0_0x290e(){const _0x22b847=['show-delete','createElement','innerHTML','abort','success','querySelector','username','6494LTQELR','key','disabled','POST','random','length','signal','textContent','warn','search','remove','sendBtn','display','toString','shiftKey','paddingBottom','setHeaderColor','now','message-bubble','onclick','309LzmtkO','initData','show','offClick','floor','className','6vsSfFM','expand','constructor','messageInput','stopPropagation','<br>','Действие\x20необратимо.','impactOccurred','typingIndicator','text','Очистить\x20историю?','BackButton','first_name','keydown','value','48rwyPQi','onEvent','message-time','.container','modalConfirm','role','1296747yPYNUS','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','touchstart','./router.html','confirmModal','min','modalCancel','(((.+)+)+)+$','disableVerticalSwipes','71052LgRcjJ','1357660yvJiZO','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','light','chatArea','getElementById','add','resize','classList','addEventListener','3833557INWAQL','clear_history','stringify','style','8DwPOMH','modalTitle','padStart','getItem','HapticFeedback','Ошибка\x20сети','debug_uid','onClick','5689280GmSgfa','emptyState','json','contains','inputArea','#050505','parse','scrollTop','forEach','6.1','apply','auto','Telegram','scrollHeight','ready','appendChild','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','setItem','4772ZJgWDF','offsetHeight','href','div','ai_chat_messages','.message.show-delete','innerHeight','replace','trim','notificationOccurred','message\x20','209etHULc','Пустой\x20ответ','click','Начнется\x20новый\x20диалог.','WebApp','focus','height','viewportHeight','user','send_message','error','push'];a0_0x290e=function(){return _0x22b847;};return a0_0x290e();}(function(_0x3f1bdb,_0x20c0cf){const _0xb47306=a0_0x2ef5,_0xcc6054=_0x3f1bdb();while(!![]){try{const _0x2a11eb=-parseInt(_0xb47306(0xc9))/0x1*(parseInt(_0xb47306(0xa0))/0x2)+-parseInt(_0xb47306(0xb4))/0x3*(-parseInt(_0xb47306(0x100))/0x4)+-parseInt(_0xb47306(0xd9))/0x5*(-parseInt(_0xb47306(0xba))/0x6)+parseInt(_0xb47306(0xe2))/0x7*(-parseInt(_0xb47306(0xe6))/0x8)+parseInt(_0xb47306(0xcf))/0x9+parseInt(_0xb47306(0xee))/0xa+-parseInt(_0xb47306(0x8d))/0xb*(-parseInt(_0xb47306(0xd8))/0xc);if(_0x2a11eb===_0x20c0cf)break;else _0xcc6054['push'](_0xcc6054['shift']());}catch(_0x209ee4){_0xcc6054['push'](_0xcc6054['shift']());}}}(a0_0x290e,0x7e13e));const tg=window[a0_0x30896e(0xfa)]?.[a0_0x30896e(0x91)],HOME_URL=a0_0x30896e(0xd2);function setupTelegramBackButton(){const _0x5a9aea=a0_0x30896e;if(!tg)return;try{tg[_0x5a9aea(0xfc)](),tg[_0x5a9aea(0xbb)](),tg[_0x5a9aea(0xb0)]?.(_0x5a9aea(0xf3));if(tg['isVersionAtLeast']?.(_0x5a9aea(0xf7)))tg[_0x5a9aea(0xd7)]?.();const _0x6ec665=tg[_0x5a9aea(0xc5)];if(_0x6ec665){_0x6ec665['show']();if(typeof _0x6ec665[_0x5a9aea(0xb7)]==='function')try{_0x6ec665['offClick']();}catch(_0x2fed46){}_0x6ec665[_0x5a9aea(0xed)](()=>{const _0x3c3bb3=_0x5a9aea;if(tg[_0x3c3bb3(0xea)])tg[_0x3c3bb3(0xea)][_0x3c3bb3(0xc1)](_0x3c3bb3(0xdb));location[_0x3c3bb3(0x102)]=HOME_URL;});}}catch(_0x38bdd8){console[_0x5a9aea(0xa8)]('TG\x20setup\x20error:',_0x38bdd8);}}(function initStableLayout(){const _0x2d0e6a=a0_0x30896e,_0x2b7f4a=(function(){let _0x50e369=!![];return function(_0x209ef5,_0x111361){const _0x3b5e00=_0x50e369?function(){const _0x5c2e01=a0_0x2ef5;if(_0x111361){const _0x4aa744=_0x111361[_0x5c2e01(0xf8)](_0x209ef5,arguments);return _0x111361=null,_0x4aa744;}}:function(){};return _0x50e369=![],_0x3b5e00;};}()),_0x3d32a8=document[_0x2d0e6a(0x9e)](_0x2d0e6a(0xcc)),_0x4d75cf=document[_0x2d0e6a(0xdd)](_0x2d0e6a(0xf2)),_0x585fc6=document[_0x2d0e6a(0xdd)](_0x2d0e6a(0xdc)),_0x1b7f8e=document['getElementById'](_0x2d0e6a(0xbd));function _0x286ef8(){const _0x5166c0=_0x2d0e6a,_0x2b27a7=_0x2b7f4a(this,function(){const _0x18a971=a0_0x2ef5;return _0x2b27a7['toString']()[_0x18a971(0xa9)](_0x18a971(0xd6))[_0x18a971(0xad)]()[_0x18a971(0xbc)](_0x2b27a7)[_0x18a971(0xa9)]('(((.+)+)+)+$');});_0x2b27a7();if(!_0x3d32a8)return;const _0x22e2de=tg&&tg[_0x5166c0(0x94)]?tg[_0x5166c0(0x94)]:window[_0x5166c0(0x88)];_0x3d32a8[_0x5166c0(0xe5)][_0x5166c0(0x93)]=_0x22e2de+'px';if(_0x4d75cf){const _0x3e2908=_0x4d75cf[_0x5166c0(0x101)];_0x585fc6['style'][_0x5166c0(0xaf)]=_0x3e2908+0x28+'px';}}tg?tg[_0x2d0e6a(0xca)]('viewportChanged',({isStateStable:_0x58e302})=>{_0x286ef8();if(_0x58e302)requestAnimationFrame(()=>{const _0x1ae1c4=a0_0x2ef5;_0x585fc6[_0x1ae1c4(0xf5)]=_0x585fc6['scrollHeight'];});}):window[_0x2d0e6a(0xe1)](_0x2d0e6a(0xdf),_0x286ef8),_0x286ef8(),_0x1b7f8e&&(_0x1b7f8e[_0x2d0e6a(0xe1)]('input',()=>{requestAnimationFrame(_0x286ef8);}),_0x1b7f8e[_0x2d0e6a(0xe1)](_0x2d0e6a(0x92),()=>{setTimeout(()=>{_0x585fc6['scrollTop']=_0x585fc6['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());function a0_0x2ef5(_0x37c8e9,_0x166f31){_0x37c8e9=_0x37c8e9-0x85;const _0x161168=a0_0x290e();let _0xa62081=_0x161168[_0x37c8e9];return _0xa62081;}const BACKEND_URL=a0_0x30896e(0xda),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x30896e(0xdd)](a0_0x30896e(0xdc)),emptyState=document['getElementById'](a0_0x30896e(0xef)),messageInput=document[a0_0x30896e(0xdd)](a0_0x30896e(0xbd)),sendBtn=document[a0_0x30896e(0xdd)](a0_0x30896e(0xab)),clearBtn=document[a0_0x30896e(0xdd)]('clearBtn'),modal=document[a0_0x30896e(0xdd)](a0_0x30896e(0xd3)),mTitle=document[a0_0x30896e(0xdd)](a0_0x30896e(0xe7)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x383936,_0xd8d68e){const _0x11bf79=a0_0x30896e,_0x296681=tg?.['initDataUnsafe']?.[_0x11bf79(0x95)]||{},_0x11a352=_0x296681['id']||localStorage['getItem'](_0x11bf79(0xec))||'d-'+Math[_0x11bf79(0xb8)](Math[_0x11bf79(0xa4)]()*0x3b9aca00);if(!_0x296681['id'])localStorage[_0x11bf79(0xff)]('debug_uid',_0x11a352);const _0x1a435d={'action':_0x383936,'user_id':_0x11a352,'user_data':{'first_name':_0x296681[_0x11bf79(0xc6)],'username':_0x296681[_0x11bf79(0x9f)]},'init_data':tg?.[_0x11bf79(0xb5)]||'',..._0xd8d68e},_0x3959ed=new AbortController(),_0x144641=setTimeout(()=>_0x3959ed[_0x11bf79(0x9c)](),REQUEST_TIMEOUT_MS);try{const _0x46e84f=await fetch(BACKEND_URL,{'method':_0x11bf79(0xa3),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x11bf79(0xe4)](_0x1a435d),'signal':_0x3959ed[_0x11bf79(0xa6)]});return clearTimeout(_0x144641),await _0x46e84f[_0x11bf79(0xf0)]();}catch(_0x7e60af){return{'success':![],'error':String(_0x7e60af)};}}function formatTime(_0x3f7fac){const _0x1dae4b=a0_0x30896e,_0x122bb1=new Date(_0x3f7fac);return String(_0x122bb1['getHours']())[_0x1dae4b(0xe8)](0x2,'0')+':'+String(_0x122bb1['getMinutes']())[_0x1dae4b(0xe8)](0x2,'0');}function createMessageElement(_0xb07b71,_0x27acce){const _0x3baebe=a0_0x30896e,_0x21b61a=document[_0x3baebe(0x9a)](_0x3baebe(0x85));_0x21b61a[_0x3baebe(0xb9)]=_0x3baebe(0x8c)+_0xb07b71[_0x3baebe(0xce)];const _0x3773ca=document[_0x3baebe(0x9a)]('div');_0x3773ca[_0x3baebe(0xb9)]=_0x3baebe(0xb2),_0x3773ca[_0x3baebe(0x9b)]=_0xb07b71['content'][_0x3baebe(0x89)](/\n/g,_0x3baebe(0xbf));const _0x5e8bfa=document[_0x3baebe(0x9a)](_0x3baebe(0x85));_0x5e8bfa[_0x3baebe(0xb9)]='delete-btn',_0x5e8bfa[_0x3baebe(0x9b)]=_0x3baebe(0xd0),_0x5e8bfa['onclick']=_0x1d9cac=>{const _0x178a23=_0x3baebe;_0x1d9cac[_0x178a23(0xbe)](),confirmDelete(_0x27acce);};let _0x1099ca;_0x3773ca[_0x3baebe(0xe1)](_0x3baebe(0xd1),()=>_0x1099ca=setTimeout(()=>{const _0x4274a0=_0x3baebe;_0x21b61a[_0x4274a0(0xe0)]['add'](_0x4274a0(0x99));if(tg?.[_0x4274a0(0xea)])tg[_0x4274a0(0xea)]['impactOccurred']('medium');},0x1f4)),_0x3773ca[_0x3baebe(0xe1)]('touchend',()=>clearTimeout(_0x1099ca));const _0x211482=document['createElement'](_0x3baebe(0x85));return _0x211482[_0x3baebe(0xb9)]=_0x3baebe(0xcb),_0x211482[_0x3baebe(0xa7)]=formatTime(_0xb07b71['timestamp']),_0x21b61a[_0x3baebe(0xfd)](_0x5e8bfa),_0x21b61a[_0x3baebe(0xfd)](_0x3773ca),_0x21b61a[_0x3baebe(0xfd)](_0x211482),_0x21b61a;}function createTypingIndicator(){const _0x1663a0=a0_0x30896e,_0x488863=document[_0x1663a0(0x9a)](_0x1663a0(0x85));return _0x488863['className']='message\x20ai',_0x488863['id']=_0x1663a0(0xc2),_0x488863[_0x1663a0(0x9b)]=_0x1663a0(0xfe),_0x488863;}function renderMessages(){const _0x1dd0ab=a0_0x30896e;Array['from'](chatArea['children'])[_0x1dd0ab(0xf6)](_0xad35e1=>{const _0x453609=_0x1dd0ab;if(_0xad35e1['id']!==_0x453609(0xef))_0xad35e1[_0x453609(0xaa)]();}),messages['length']>0x0?(emptyState[_0x1dd0ab(0xe5)][_0x1dd0ab(0xac)]='none',messages[_0x1dd0ab(0xf6)]((_0x36c260,_0x3c5e3e)=>chatArea[_0x1dd0ab(0xfd)](createMessageElement(_0x36c260,_0x3c5e3e)))):emptyState['style'][_0x1dd0ab(0xac)]='flex',requestAnimationFrame(()=>chatArea[_0x1dd0ab(0xf5)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x587687=a0_0x30896e;messageInput['style'][_0x587687(0x93)]=_0x587687(0xf9),messageInput[_0x587687(0xe5)][_0x587687(0x93)]=Math[_0x587687(0xd4)](messageInput[_0x587687(0xfb)],0x78)+'px';}function updateSendButton(){const _0xe1830c=a0_0x30896e,_0x21dcb1=messageInput['value'][_0xe1830c(0x8a)]();sendBtn[_0xe1830c(0xa2)]=!_0x21dcb1||isTyping;}async function sendMessage(){const _0x17c35d=a0_0x30896e,_0x5be593=messageInput['value'][_0x17c35d(0x8a)]();if(!_0x5be593||isTyping)return;if(tg?.[_0x17c35d(0xea)])tg[_0x17c35d(0xea)][_0x17c35d(0xc1)](_0x17c35d(0xdb));messages[_0x17c35d(0x98)]({'role':_0x17c35d(0x95),'content':_0x5be593,'timestamp':Date[_0x17c35d(0xb1)]()}),localStorage[_0x17c35d(0xff)](_0x17c35d(0x86),JSON[_0x17c35d(0xe4)](messages)),renderMessages(),messageInput[_0x17c35d(0xc8)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x17c35d(0xfd)](createTypingIndicator()),chatArea[_0x17c35d(0xf5)]=chatArea['scrollHeight'];const _0x982cc6=await callBackend(_0x17c35d(0x96),{'message':_0x5be593});isTyping=![];const _0x3e10ac=document[_0x17c35d(0xdd)](_0x17c35d(0xc2));if(_0x3e10ac)_0x3e10ac[_0x17c35d(0xaa)]();let _0x1011d4=_0x17c35d(0xeb);if(_0x982cc6[_0x17c35d(0x9d)]){_0x1011d4=_0x982cc6[_0x17c35d(0xc3)]||_0x17c35d(0x8e);if(tg?.[_0x17c35d(0xea)])tg[_0x17c35d(0xea)][_0x17c35d(0x8b)]('success');}else{_0x1011d4=_0x982cc6[_0x17c35d(0x97)]||'Ошибка\x20сервера';if(tg?.[_0x17c35d(0xea)])tg['HapticFeedback'][_0x17c35d(0x8b)]('error');}messages[_0x17c35d(0x98)]({'role':'ai','content':_0x1011d4,'timestamp':Date[_0x17c35d(0xb1)]()}),localStorage['setItem'](_0x17c35d(0x86),JSON[_0x17c35d(0xe4)](messages)),renderMessages();}function confirmDelete(_0x4699b7){const _0xdb2da0=a0_0x30896e;if(mTitle)mTitle[_0xdb2da0(0xa7)]='Удалить?';if(mText)mText[_0xdb2da0(0xa7)]=_0xdb2da0(0xc0);modalCallback=()=>{const _0x5eb5a7=_0xdb2da0;messages['splice'](_0x4699b7,0x1),localStorage['setItem'](_0x5eb5a7(0x86),JSON['stringify'](messages)),renderMessages();},modal[_0xdb2da0(0xe0)][_0xdb2da0(0xde)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0x40a59d=a0_0x30896e;if(!messages[_0x40a59d(0xa5)])return;if(mTitle)mTitle[_0x40a59d(0xa7)]=_0x40a59d(0xc4);if(mText)mText[_0x40a59d(0xa7)]=_0x40a59d(0x90);modalCallback=async()=>{const _0x40ff25=_0x40a59d;messages=[],localStorage['removeItem'](_0x40ff25(0x86)),renderMessages(),callBackend(_0x40ff25(0xe3),{});},modal[_0x40a59d(0xe0)][_0x40a59d(0xde)](_0x40a59d(0xb6));};document['getElementById'](a0_0x30896e(0xd5))['onclick']=()=>modal[a0_0x30896e(0xe0)]['remove'](a0_0x30896e(0xb6)),document[a0_0x30896e(0xdd)](a0_0x30896e(0xcd))[a0_0x30896e(0xb3)]=()=>{const _0x2f52f0=a0_0x30896e;if(modalCallback)modalCallback();modal[_0x2f52f0(0xe0)]['remove'](_0x2f52f0(0xb6));},messageInput[a0_0x30896e(0xe1)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x30896e(0xe1)](a0_0x30896e(0xc7),_0x1fa19a=>{const _0x57fe16=a0_0x30896e;_0x1fa19a[_0x57fe16(0xa1)]==='Enter'&&!_0x1fa19a[_0x57fe16(0xae)]&&(_0x1fa19a['preventDefault'](),sendMessage());}),sendBtn[a0_0x30896e(0xb3)]=sendMessage,document[a0_0x30896e(0xe1)](a0_0x30896e(0x8f),_0x4a2b44=>{const _0x463d7c=a0_0x30896e;document['querySelectorAll'](_0x463d7c(0x87))[_0x463d7c(0xf6)](_0x1b7905=>{const _0x35753e=_0x463d7c;if(!_0x1b7905[_0x35753e(0xf1)](_0x4a2b44['target']))_0x1b7905[_0x35753e(0xe0)][_0x35753e(0xaa)](_0x35753e(0x99));});});const saved=localStorage[a0_0x30896e(0xe9)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x30896e(0xf4)](saved),renderMessages();}catch(a0_0x2f23db){}updateSendButton();