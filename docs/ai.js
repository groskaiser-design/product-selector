const a0_0x35c6b4=a0_0x49a0;(function(_0x38fb41,_0x5208b5){const _0x886aed=a0_0x49a0,_0x14a902=_0x38fb41();while(!![]){try{const _0x44d651=parseInt(_0x886aed(0xe8))/0x1*(parseInt(_0x886aed(0xcb))/0x2)+parseInt(_0x886aed(0xe0))/0x3*(-parseInt(_0x886aed(0x14c))/0x4)+parseInt(_0x886aed(0xf8))/0x5*(-parseInt(_0x886aed(0xf6))/0x6)+parseInt(_0x886aed(0xdd))/0x7+-parseInt(_0x886aed(0xde))/0x8+-parseInt(_0x886aed(0xf4))/0x9+-parseInt(_0x886aed(0xf1))/0xa*(-parseInt(_0x886aed(0x126))/0xb);if(_0x44d651===_0x5208b5)break;else _0x14a902['push'](_0x14a902['shift']());}catch(_0x273e37){_0x14a902['push'](_0x14a902['shift']());}}}(a0_0x5a46,0x96733));const tg=window[a0_0x35c6b4(0x100)]?.[a0_0x35c6b4(0xcc)],HOME_URL=a0_0x35c6b4(0x123);function setupTelegramBackButton(){const _0x3284f=a0_0x35c6b4,_0x2a032f=(function(){let _0x2bd2d5=!![];return function(_0x2d02c9,_0x1d872e){const _0x2fc5d9=_0x2bd2d5?function(){const _0x531345=a0_0x49a0;if(_0x1d872e){const _0x12b722=_0x1d872e[_0x531345(0xd6)](_0x2d02c9,arguments);return _0x1d872e=null,_0x12b722;}}:function(){};return _0x2bd2d5=![],_0x2fc5d9;};}()),_0x5db9d3=_0x2a032f(this,function(){const _0x34343f=a0_0x49a0;return _0x5db9d3['toString']()[_0x34343f(0x114)]('(((.+)+)+)+$')[_0x34343f(0xd1)]()['constructor'](_0x5db9d3)['search'](_0x34343f(0x12f));});_0x5db9d3();if(!tg)return;try{tg[_0x3284f(0x112)](),tg[_0x3284f(0x119)](),tg['setHeaderColor']?.(_0x3284f(0xfa));if(tg['isVersionAtLeast']?.('6.1'))tg['disableVerticalSwipes']?.();const _0x4baaf2=tg[_0x3284f(0x137)];if(_0x4baaf2){_0x4baaf2[_0x3284f(0x13a)]();if(typeof _0x4baaf2[_0x3284f(0x146)]===_0x3284f(0x147))try{_0x4baaf2[_0x3284f(0x146)]();}catch(_0x5873b6){}_0x4baaf2[_0x3284f(0xeb)](()=>{const _0x177910=_0x3284f;if(tg[_0x177910(0x12a)])tg[_0x177910(0x12a)][_0x177910(0xe7)](_0x177910(0xf0));location[_0x177910(0x13b)]=HOME_URL;});}}catch(_0x14e0eb){console[_0x3284f(0x11f)](_0x3284f(0x11d),_0x14e0eb);}}(function initStableLayout(){const _0x5c5f57=a0_0x35c6b4,_0x39f760=document[_0x5c5f57(0x104)](_0x5c5f57(0x108)),_0x164aab=document[_0x5c5f57(0xf2)](_0x5c5f57(0x103)),_0x4e49eb=document[_0x5c5f57(0xf2)](_0x5c5f57(0x142)),_0xf2bd4=document['getElementById'](_0x5c5f57(0xf3));function _0x4f1a36(){const _0x2f4ba5=_0x5c5f57;if(!_0x39f760)return;const _0x320056=tg&&tg[_0x2f4ba5(0xdf)]?tg[_0x2f4ba5(0xdf)]:window[_0x2f4ba5(0x11b)];_0x39f760[_0x2f4ba5(0x121)][_0x2f4ba5(0xcf)]=_0x320056+'px';if(_0x164aab){const _0x10b057=_0x164aab[_0x2f4ba5(0x132)];_0x4e49eb[_0x2f4ba5(0x121)][_0x2f4ba5(0xd3)]=_0x10b057+0x28+'px';}}tg?tg[_0x5c5f57(0x109)](_0x5c5f57(0x10c),({isStateStable:_0x29e41c})=>{_0x4f1a36();if(_0x29e41c)requestAnimationFrame(()=>{const _0x528f42=a0_0x49a0;_0x4e49eb['scrollTop']=_0x4e49eb[_0x528f42(0xe3)];});}):window['addEventListener'](_0x5c5f57(0x135),_0x4f1a36),_0x4f1a36(),_0xf2bd4&&(_0xf2bd4[_0x5c5f57(0x11c)](_0x5c5f57(0xfc),()=>{requestAnimationFrame(_0x4f1a36);}),_0xf2bd4[_0x5c5f57(0x11c)](_0x5c5f57(0x129),()=>{setTimeout(()=>{const _0x2108a7=a0_0x49a0;_0x4e49eb[_0x2108a7(0x10e)]=_0x4e49eb[_0x2108a7(0xe3)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x35c6b4(0x142)),emptyState=document['getElementById'](a0_0x35c6b4(0x13d)),messageInput=document['getElementById'](a0_0x35c6b4(0xf3)),sendBtn=document[a0_0x35c6b4(0xf2)](a0_0x35c6b4(0x13e)),clearBtn=document[a0_0x35c6b4(0xf2)](a0_0x35c6b4(0x138)),modal=document[a0_0x35c6b4(0xf2)]('confirmModal'),mTitle=document[a0_0x35c6b4(0xf2)](a0_0x35c6b4(0xec)),mText=document[a0_0x35c6b4(0xf2)](a0_0x35c6b4(0x14b));function a0_0x5a46(){const _0x57fa97=['createElement','message-bubble','offClick','function','children','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','display','modalText','8rDmwLk','2602hsaHeo','WebApp','parse','Enter','height','getMinutes','toString','content','paddingBottom','touchstart','Удалить?','apply','push','initDataUnsafe','textContent','add','message\x20','click','4607365sjPoSk','4962520mUaVho','viewportHeight','1485291TovdTG','.message.show-delete','error','scrollHeight','text/plain','show-delete','clear_history','impactOccurred','251psegOL','setItem','Очистить\x20историю?','onClick','modalTitle','forEach','onclick','classList','light','10QfEQkU','getElementById','messageInput','2017764dFtszu','first_name','174MWuObD','innerHTML','65140siONiy','typingIndicator','#050505','length','input','disabled','className','text','Telegram','message\x20ai','abort','inputArea','querySelector','querySelectorAll','padStart','div','.container','onEvent','notificationOccurred','getHours','viewportChanged','modalCancel','scrollTop','success','role','medium','ready','Ошибка\x20сервера','search','signal','remove','Действие\x20необратимо.','Пустой\x20ответ','expand','replace','innerHeight','addEventListener','TG\x20setup\x20error:','value','warn','initData','style','stopPropagation','./router.html','user','timestamp','20284154nfumys','trim','removeItem','focus','HapticFeedback','ai_chat_messages','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','getItem','floor','(((.+)+)+)+$','stringify','username','offsetHeight','now','debug_uid','resize','preventDefault','BackButton','clearBtn','flex','show','href','appendChild','emptyState','sendBtn','send_message','Начнется\x20новый\x20диалог.','POST','chatArea','touchend'];a0_0x5a46=function(){return _0x57fa97;};return a0_0x5a46();}let modalCallback=null;async function callBackend(_0xc07683,_0x5c909f){const _0x3ecf0c=a0_0x35c6b4,_0x40d3d3=tg?.[_0x3ecf0c(0xd8)]?.[_0x3ecf0c(0x124)]||{},_0x5ad922=_0x40d3d3['id']||localStorage[_0x3ecf0c(0x12d)](_0x3ecf0c(0x134))||'d-'+Math[_0x3ecf0c(0x12e)](Math['random']()*0x3b9aca00);if(!_0x40d3d3['id'])localStorage[_0x3ecf0c(0xe9)](_0x3ecf0c(0x134),_0x5ad922);const _0x13b99c={'action':_0xc07683,'user_id':_0x5ad922,'user_data':{'first_name':_0x40d3d3[_0x3ecf0c(0xf5)],'username':_0x40d3d3[_0x3ecf0c(0x131)]},'init_data':tg?.[_0x3ecf0c(0x120)]||'',..._0x5c909f},_0x1293b9=new AbortController(),_0x4aba9c=setTimeout(()=>_0x1293b9[_0x3ecf0c(0x102)](),REQUEST_TIMEOUT_MS);try{const _0x1a70ad=await fetch(BACKEND_URL,{'method':_0x3ecf0c(0x141),'headers':{'Content-Type':_0x3ecf0c(0xe4)},'body':JSON[_0x3ecf0c(0x130)](_0x13b99c),'signal':_0x1293b9[_0x3ecf0c(0x115)]});return clearTimeout(_0x4aba9c),await _0x1a70ad['json']();}catch(_0x49f062){return{'success':![],'error':String(_0x49f062)};}}function formatTime(_0x43a41c){const _0x333617=a0_0x35c6b4,_0x17df1d=new Date(_0x43a41c);return String(_0x17df1d[_0x333617(0x10b)]())[_0x333617(0x106)](0x2,'0')+':'+String(_0x17df1d[_0x333617(0xd0)]())['padStart'](0x2,'0');}function createMessageElement(_0x3e1d2c,_0x542d34){const _0x506a3c=a0_0x35c6b4,_0xd430f9=document[_0x506a3c(0x144)](_0x506a3c(0x107));_0xd430f9[_0x506a3c(0xfe)]=_0x506a3c(0xdb)+_0x3e1d2c[_0x506a3c(0x110)];const _0x43c341=document['createElement'](_0x506a3c(0x107));_0x43c341[_0x506a3c(0xfe)]=_0x506a3c(0x145),_0x43c341[_0x506a3c(0xf7)]=_0x3e1d2c[_0x506a3c(0xd2)][_0x506a3c(0x11a)](/\n/g,'<br>');const _0x346b45=document[_0x506a3c(0x144)](_0x506a3c(0x107));_0x346b45['className']='delete-btn',_0x346b45[_0x506a3c(0xf7)]=_0x506a3c(0x12c),_0x346b45[_0x506a3c(0xee)]=_0x5d3bfc=>{const _0x20a37b=_0x506a3c;_0x5d3bfc[_0x20a37b(0x122)](),confirmDelete(_0x542d34);};let _0x5ead77;_0x43c341['addEventListener'](_0x506a3c(0xd4),()=>_0x5ead77=setTimeout(()=>{const _0x1fe078=_0x506a3c;_0xd430f9[_0x1fe078(0xef)][_0x1fe078(0xda)](_0x1fe078(0xe5));if(tg?.[_0x1fe078(0x12a)])tg[_0x1fe078(0x12a)][_0x1fe078(0xe7)](_0x1fe078(0x111));},0x1f4)),_0x43c341[_0x506a3c(0x11c)](_0x506a3c(0x143),()=>clearTimeout(_0x5ead77));const _0x2ad791=document[_0x506a3c(0x144)]('div');return _0x2ad791['className']='message-time',_0x2ad791['textContent']=formatTime(_0x3e1d2c[_0x506a3c(0x125)]),_0xd430f9[_0x506a3c(0x13c)](_0x346b45),_0xd430f9['appendChild'](_0x43c341),_0xd430f9[_0x506a3c(0x13c)](_0x2ad791),_0xd430f9;}function createTypingIndicator(){const _0x1e6e79=a0_0x35c6b4,_0x5c626d=document[_0x1e6e79(0x144)]('div');return _0x5c626d[_0x1e6e79(0xfe)]=_0x1e6e79(0x101),_0x5c626d['id']=_0x1e6e79(0xf9),_0x5c626d[_0x1e6e79(0xf7)]=_0x1e6e79(0x149),_0x5c626d;}function renderMessages(){const _0x560704=a0_0x35c6b4;Array['from'](chatArea[_0x560704(0x148)])[_0x560704(0xed)](_0x3bb1fc=>{const _0x33ac87=_0x560704;if(_0x3bb1fc['id']!==_0x33ac87(0x13d))_0x3bb1fc[_0x33ac87(0x116)]();}),messages[_0x560704(0xfb)]>0x0?(emptyState[_0x560704(0x121)][_0x560704(0x14a)]='none',messages[_0x560704(0xed)]((_0x33ff14,_0x2f7912)=>chatArea['appendChild'](createMessageElement(_0x33ff14,_0x2f7912)))):emptyState[_0x560704(0x121)][_0x560704(0x14a)]=_0x560704(0x139),requestAnimationFrame(()=>chatArea[_0x560704(0x10e)]=chatArea[_0x560704(0xe3)]);}function autoResizeTextarea(){const _0x55462b=a0_0x35c6b4;messageInput['style'][_0x55462b(0xcf)]='auto',messageInput[_0x55462b(0x121)][_0x55462b(0xcf)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function a0_0x49a0(_0x1b6915,_0xcdc45){_0x1b6915=_0x1b6915-0xcb;const _0x3ab2ae=a0_0x5a46();let _0x164443=_0x3ab2ae[_0x1b6915];return _0x164443;}function updateSendButton(){const _0x3ae3d4=a0_0x35c6b4,_0x387198=messageInput['value'][_0x3ae3d4(0x127)]();sendBtn[_0x3ae3d4(0xfd)]=!_0x387198||isTyping;}async function sendMessage(){const _0xd34bef=a0_0x35c6b4,_0x28b8f8=messageInput['value'][_0xd34bef(0x127)]();if(!_0x28b8f8||isTyping)return;if(tg?.[_0xd34bef(0x12a)])tg[_0xd34bef(0x12a)]['impactOccurred'](_0xd34bef(0xf0));messages[_0xd34bef(0xd7)]({'role':_0xd34bef(0x124),'content':_0x28b8f8,'timestamp':Date[_0xd34bef(0x133)]()}),localStorage['setItem'](_0xd34bef(0x12b),JSON['stringify'](messages)),renderMessages(),messageInput[_0xd34bef(0x11e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xd34bef(0x13c)](createTypingIndicator()),chatArea[_0xd34bef(0x10e)]=chatArea['scrollHeight'];const _0x1b5768=await callBackend(_0xd34bef(0x13f),{'message':_0x28b8f8});isTyping=![];const _0x2c4586=document[_0xd34bef(0xf2)]('typingIndicator');if(_0x2c4586)_0x2c4586[_0xd34bef(0x116)]();let _0x2ab30e='Ошибка\x20сети';if(_0x1b5768[_0xd34bef(0x10f)]){_0x2ab30e=_0x1b5768[_0xd34bef(0xff)]||_0xd34bef(0x118);if(tg?.[_0xd34bef(0x12a)])tg[_0xd34bef(0x12a)][_0xd34bef(0x10a)](_0xd34bef(0x10f));}else{_0x2ab30e=_0x1b5768['error']||_0xd34bef(0x113);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0xd34bef(0x10a)](_0xd34bef(0xe2));}messages['push']({'role':'ai','content':_0x2ab30e,'timestamp':Date['now']()}),localStorage['setItem'](_0xd34bef(0x12b),JSON[_0xd34bef(0x130)](messages)),renderMessages();}function confirmDelete(_0x984f1c){const _0x32c39f=a0_0x35c6b4;if(mTitle)mTitle[_0x32c39f(0xd9)]=_0x32c39f(0xd5);if(mText)mText[_0x32c39f(0xd9)]=_0x32c39f(0x117);modalCallback=()=>{const _0x47e84d=_0x32c39f;messages['splice'](_0x984f1c,0x1),localStorage[_0x47e84d(0xe9)]('ai_chat_messages',JSON[_0x47e84d(0x130)](messages)),renderMessages();},modal['classList'][_0x32c39f(0xda)](_0x32c39f(0x13a));}if(clearBtn)clearBtn[a0_0x35c6b4(0xee)]=()=>{const _0x1d10a6=a0_0x35c6b4;if(!messages[_0x1d10a6(0xfb)])return;if(mTitle)mTitle['textContent']=_0x1d10a6(0xea);if(mText)mText[_0x1d10a6(0xd9)]=_0x1d10a6(0x140);modalCallback=async()=>{const _0x14bb96=_0x1d10a6;messages=[],localStorage[_0x14bb96(0x128)](_0x14bb96(0x12b)),renderMessages(),callBackend(_0x14bb96(0xe6),{});},modal[_0x1d10a6(0xef)][_0x1d10a6(0xda)](_0x1d10a6(0x13a));};document[a0_0x35c6b4(0xf2)](a0_0x35c6b4(0x10d))[a0_0x35c6b4(0xee)]=()=>modal[a0_0x35c6b4(0xef)]['remove']('show'),document['getElementById']('modalConfirm')[a0_0x35c6b4(0xee)]=()=>{const _0x4a3f08=a0_0x35c6b4;if(modalCallback)modalCallback();modal[_0x4a3f08(0xef)][_0x4a3f08(0x116)](_0x4a3f08(0x13a));},messageInput[a0_0x35c6b4(0x11c)](a0_0x35c6b4(0xfc),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x35c6b4(0x11c)]('keydown',_0xcf1c7a=>{const _0x49d85e=a0_0x35c6b4;_0xcf1c7a['key']===_0x49d85e(0xce)&&!_0xcf1c7a['shiftKey']&&(_0xcf1c7a[_0x49d85e(0x136)](),sendMessage());}),sendBtn[a0_0x35c6b4(0xee)]=sendMessage,document['addEventListener'](a0_0x35c6b4(0xdc),_0x1b8a31=>{const _0x4a04b5=a0_0x35c6b4;document[_0x4a04b5(0x105)](_0x4a04b5(0xe1))[_0x4a04b5(0xed)](_0x46b86e=>{const _0x10c9b1=_0x4a04b5;if(!_0x46b86e['contains'](_0x1b8a31['target']))_0x46b86e[_0x10c9b1(0xef)][_0x10c9b1(0x116)](_0x10c9b1(0xe5));});});const saved=localStorage['getItem'](a0_0x35c6b4(0x12b));if(saved)try{messages=JSON[a0_0x35c6b4(0xcd)](saved),renderMessages();}catch(a0_0x3cc77b){}updateSendButton();