const a0_0x157ccd=a0_0x1ccb;(function(_0x2e1fcd,_0x8c1ce7){const _0x270c60=a0_0x1ccb,_0x5055f0=_0x2e1fcd();while(!![]){try{const _0x5a58e8=parseInt(_0x270c60(0x1fd))/0x1+parseInt(_0x270c60(0x224))/0x2*(parseInt(_0x270c60(0x1ff))/0x3)+-parseInt(_0x270c60(0x261))/0x4*(parseInt(_0x270c60(0x21d))/0x5)+-parseInt(_0x270c60(0x253))/0x6+parseInt(_0x270c60(0x247))/0x7*(-parseInt(_0x270c60(0x263))/0x8)+-parseInt(_0x270c60(0x1f3))/0x9+-parseInt(_0x270c60(0x24c))/0xa*(-parseInt(_0x270c60(0x245))/0xb);if(_0x5a58e8===_0x8c1ce7)break;else _0x5055f0['push'](_0x5055f0['shift']());}catch(_0x14bd69){_0x5055f0['push'](_0x5055f0['shift']());}}}(a0_0x66e0,0x34347));const tg=window[a0_0x157ccd(0x25d)]?.[a0_0x157ccd(0x219)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x512ae5=a0_0x157ccd,_0x4b0184=(function(){let _0x5039e0=!![];return function(_0x37cb8c,_0x355ea1){const _0x1085f3=_0x5039e0?function(){if(_0x355ea1){const _0x17bd4a=_0x355ea1['apply'](_0x37cb8c,arguments);return _0x355ea1=null,_0x17bd4a;}}:function(){};return _0x5039e0=![],_0x1085f3;};}()),_0x571353=_0x4b0184(this,function(){const _0x461f86=a0_0x1ccb;return _0x571353['toString']()['search'](_0x461f86(0x21c))[_0x461f86(0x240)]()['constructor'](_0x571353)[_0x461f86(0x204)]('(((.+)+)+)+$');});_0x571353();if(!tg)return;try{tg[_0x512ae5(0x24d)](),tg[_0x512ae5(0x25a)](),tg['setHeaderColor']?.(_0x512ae5(0x21e));if(tg['isVersionAtLeast']?.(_0x512ae5(0x231)))tg['disableVerticalSwipes']?.();const _0x64ff75=tg['BackButton'];if(_0x64ff75){_0x64ff75[_0x512ae5(0x202)]();if(typeof _0x64ff75[_0x512ae5(0x1f7)]==='function')try{_0x64ff75['offClick']();}catch(_0xd2a8d3){}_0x64ff75[_0x512ae5(0x1fa)](()=>{const _0x3a8781=_0x512ae5;if(tg['HapticFeedback'])tg[_0x3a8781(0x243)]['impactOccurred']('light');location[_0x3a8781(0x209)]=HOME_URL;});}}catch(_0x54c35b){console[_0x512ae5(0x1fe)](_0x512ae5(0x201),_0x54c35b);}}(function initStableLayout(){const _0x24da3d=a0_0x157ccd,_0x22797d=document[_0x24da3d(0x200)](_0x24da3d(0x1fb)),_0x5bba9d=document[_0x24da3d(0x239)](_0x24da3d(0x217)),_0x994753=document[_0x24da3d(0x239)](_0x24da3d(0x259)),_0x41c724=document['getElementById'](_0x24da3d(0x252));function _0x47e0e8(){const _0x24f63b=_0x24da3d;if(!_0x22797d)return;const _0x5c5fa8=tg&&tg[_0x24f63b(0x24e)]?tg['viewportHeight']:window[_0x24f63b(0x21a)];_0x22797d[_0x24f63b(0x23b)][_0x24f63b(0x218)]=_0x5c5fa8+'px';if(_0x5bba9d){const _0x447878=_0x5bba9d['offsetHeight'];_0x994753[_0x24f63b(0x23b)][_0x24f63b(0x20f)]=_0x447878+0x28+'px';}}tg?tg[_0x24da3d(0x242)](_0x24da3d(0x1f9),({isStateStable:_0xb6cef7})=>{_0x47e0e8();if(_0xb6cef7)requestAnimationFrame(()=>{_0x994753['scrollTop']=_0x994753['scrollHeight'];});}):window['addEventListener'](_0x24da3d(0x235),_0x47e0e8),_0x47e0e8(),_0x41c724&&(_0x41c724[_0x24da3d(0x1f6)](_0x24da3d(0x238),()=>{requestAnimationFrame(_0x47e0e8);}),_0x41c724[_0x24da3d(0x1f6)](_0x24da3d(0x23c),()=>{setTimeout(()=>{_0x994753['scrollTop']=_0x994753['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x157ccd(0x239)]('chatArea'),emptyState=document[a0_0x157ccd(0x239)](a0_0x157ccd(0x20a)),messageInput=document[a0_0x157ccd(0x239)](a0_0x157ccd(0x252)),sendBtn=document[a0_0x157ccd(0x239)](a0_0x157ccd(0x22f)),clearBtn=document[a0_0x157ccd(0x239)](a0_0x157ccd(0x25c)),modal=document['getElementById'](a0_0x157ccd(0x268)),mTitle=document[a0_0x157ccd(0x239)](a0_0x157ccd(0x215)),mText=document[a0_0x157ccd(0x239)](a0_0x157ccd(0x244));let modalCallback=null;async function callBackend(_0x2a2deb,_0x1c8f68){const _0x562ac7=a0_0x157ccd,_0x253baf=tg?.[_0x562ac7(0x226)]?.[_0x562ac7(0x21f)]||{},_0x4a2af1=_0x253baf['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x562ac7(0x220)](Math[_0x562ac7(0x25e)]()*0x3b9aca00);if(!_0x253baf['id'])localStorage[_0x562ac7(0x233)](_0x562ac7(0x246),_0x4a2af1);const _0x25a7ba={'action':_0x2a2deb,'user_id':_0x4a2af1,'user_data':{'first_name':_0x253baf['first_name'],'username':_0x253baf[_0x562ac7(0x254)]},'init_data':tg?.[_0x562ac7(0x236)]||'',..._0x1c8f68},_0x429438=new AbortController(),_0x39131e=setTimeout(()=>_0x429438[_0x562ac7(0x22e)](),REQUEST_TIMEOUT_MS);try{const _0x4e561c=await fetch(BACKEND_URL,{'method':_0x562ac7(0x25b),'headers':{'Content-Type':_0x562ac7(0x20c)},'body':JSON[_0x562ac7(0x203)](_0x25a7ba),'signal':_0x429438[_0x562ac7(0x266)]});return clearTimeout(_0x39131e),await _0x4e561c['json']();}catch(_0x1bd91f){return{'success':![],'error':String(_0x1bd91f)};}}function formatTime(_0x327a0c){const _0x39db41=a0_0x157ccd,_0x45b978=new Date(_0x327a0c);return String(_0x45b978[_0x39db41(0x22d)]())[_0x39db41(0x260)](0x2,'0')+':'+String(_0x45b978[_0x39db41(0x1f4)]())[_0x39db41(0x260)](0x2,'0');}function createMessageElement(_0x51fc4e,_0x20d82d){const _0x1486eb=a0_0x157ccd,_0x5bc4ad=document[_0x1486eb(0x265)](_0x1486eb(0x24b));_0x5bc4ad['className']=_0x1486eb(0x1f8)+_0x51fc4e['role'];const _0x56312c=document[_0x1486eb(0x265)](_0x1486eb(0x24b));_0x56312c[_0x1486eb(0x206)]='message-bubble',_0x56312c['innerHTML']=_0x51fc4e[_0x1486eb(0x237)]['replace'](/\n/g,_0x1486eb(0x251));const _0x3f8ee9=document[_0x1486eb(0x265)](_0x1486eb(0x24b));_0x3f8ee9[_0x1486eb(0x206)]='delete-btn',_0x3f8ee9[_0x1486eb(0x23f)]=_0x1486eb(0x1f2),_0x3f8ee9[_0x1486eb(0x22c)]=_0x10dea1=>{_0x10dea1['stopPropagation'](),confirmDelete(_0x20d82d);};let _0x1f0338;_0x56312c[_0x1486eb(0x1f6)](_0x1486eb(0x211),()=>_0x1f0338=setTimeout(()=>{const _0x3fc75a=_0x1486eb;_0x5bc4ad[_0x3fc75a(0x23a)][_0x3fc75a(0x22a)](_0x3fc75a(0x248));if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x3fc75a(0x20e)](_0x3fc75a(0x258));},0x1f4)),_0x56312c['addEventListener']('touchend',()=>clearTimeout(_0x1f0338));const _0x42519a=document[_0x1486eb(0x265)](_0x1486eb(0x24b));return _0x42519a[_0x1486eb(0x206)]=_0x1486eb(0x230),_0x42519a[_0x1486eb(0x1fc)]=formatTime(_0x51fc4e['timestamp']),_0x5bc4ad[_0x1486eb(0x1f1)](_0x3f8ee9),_0x5bc4ad[_0x1486eb(0x1f1)](_0x56312c),_0x5bc4ad[_0x1486eb(0x1f1)](_0x42519a),_0x5bc4ad;}function createTypingIndicator(){const _0x460085=a0_0x157ccd,_0x171938=document['createElement'](_0x460085(0x24b));return _0x171938['className']=_0x460085(0x213),_0x171938['id']='typingIndicator',_0x171938[_0x460085(0x23f)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x171938;}function renderMessages(){const _0x19e5f9=a0_0x157ccd;Array[_0x19e5f9(0x20b)](chatArea['children'])[_0x19e5f9(0x20d)](_0x5d81b5=>{const _0x448f47=_0x19e5f9;if(_0x5d81b5['id']!==_0x448f47(0x20a))_0x5d81b5['remove']();}),messages['length']>0x0?(emptyState[_0x19e5f9(0x23b)]['display']=_0x19e5f9(0x23e),messages[_0x19e5f9(0x20d)]((_0x3d0136,_0x5a1091)=>chatArea[_0x19e5f9(0x1f1)](createMessageElement(_0x3d0136,_0x5a1091)))):emptyState['style']['display']=_0x19e5f9(0x249),requestAnimationFrame(()=>chatArea[_0x19e5f9(0x262)]=chatArea[_0x19e5f9(0x1f5)]);}function a0_0x1ccb(_0x1b42cb,_0x4d65e8){_0x1b42cb=_0x1b42cb-0x1f1;const _0x4c9da4=a0_0x66e0();let _0x11680b=_0x4c9da4[_0x1b42cb];return _0x11680b;}function autoResizeTextarea(){const _0x2ecfcb=a0_0x157ccd;messageInput[_0x2ecfcb(0x23b)][_0x2ecfcb(0x218)]='auto',messageInput[_0x2ecfcb(0x23b)][_0x2ecfcb(0x218)]=Math['min'](messageInput[_0x2ecfcb(0x1f5)],0x78)+'px';}function updateSendButton(){const _0x39f3dc=a0_0x157ccd,_0x1fe1c1=messageInput['value'][_0x39f3dc(0x24f)]();sendBtn[_0x39f3dc(0x212)]=!_0x1fe1c1||isTyping;}async function sendMessage(){const _0x587812=a0_0x157ccd,_0xcdcc95=messageInput[_0x587812(0x222)]['trim']();if(!_0xcdcc95||isTyping)return;if(tg?.[_0x587812(0x243)])tg[_0x587812(0x243)][_0x587812(0x20e)]('light');messages[_0x587812(0x216)]({'role':'user','content':_0xcdcc95,'timestamp':Date[_0x587812(0x24a)]()}),localStorage[_0x587812(0x233)]('ai_chat_messages',JSON[_0x587812(0x203)](messages)),renderMessages(),messageInput[_0x587812(0x222)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x582b5d=await callBackend(_0x587812(0x22b),{'message':_0xcdcc95});isTyping=![];const _0x3c8346=document[_0x587812(0x239)](_0x587812(0x232));if(_0x3c8346)_0x3c8346[_0x587812(0x229)]();let _0x29cdd2=_0x587812(0x221);if(_0x582b5d[_0x587812(0x269)]){_0x29cdd2=_0x582b5d[_0x587812(0x26a)]||_0x587812(0x26b);if(tg?.[_0x587812(0x243)])tg['HapticFeedback']['notificationOccurred'](_0x587812(0x269));}else{_0x29cdd2=_0x582b5d[_0x587812(0x207)]||'Ошибка\x20сервера';if(tg?.[_0x587812(0x243)])tg['HapticFeedback'][_0x587812(0x208)](_0x587812(0x207));}messages[_0x587812(0x216)]({'role':'ai','content':_0x29cdd2,'timestamp':Date[_0x587812(0x24a)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x587812(0x203)](messages)),renderMessages();}function confirmDelete(_0x8d7cfe){const _0x42b298=a0_0x157ccd;if(mTitle)mTitle['textContent']=_0x42b298(0x227);if(mText)mText[_0x42b298(0x1fc)]=_0x42b298(0x228);modalCallback=()=>{const _0x1f65cd=_0x42b298;messages[_0x1f65cd(0x205)](_0x8d7cfe,0x1),localStorage[_0x1f65cd(0x233)](_0x1f65cd(0x21b),JSON['stringify'](messages)),renderMessages();},modal[_0x42b298(0x23a)]['add'](_0x42b298(0x202));}if(clearBtn)clearBtn[a0_0x157ccd(0x22c)]=()=>{const _0x329c72=a0_0x157ccd;if(!messages[_0x329c72(0x255)])return;if(mTitle)mTitle[_0x329c72(0x1fc)]=_0x329c72(0x225);if(mText)mText[_0x329c72(0x1fc)]=_0x329c72(0x256);modalCallback=async()=>{const _0x324ba3=_0x329c72;messages=[],localStorage[_0x324ba3(0x223)](_0x324ba3(0x21b)),renderMessages(),callBackend(_0x324ba3(0x250),{});},modal[_0x329c72(0x23a)]['add'](_0x329c72(0x202));};document[a0_0x157ccd(0x239)]('modalCancel')[a0_0x157ccd(0x22c)]=()=>modal[a0_0x157ccd(0x23a)][a0_0x157ccd(0x229)](a0_0x157ccd(0x202)),document['getElementById'](a0_0x157ccd(0x23d))['onclick']=()=>{const _0x1fd745=a0_0x157ccd;if(modalCallback)modalCallback();modal[_0x1fd745(0x23a)][_0x1fd745(0x229)]('show');},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x157ccd(0x1f6)](a0_0x157ccd(0x264),_0x46ab60=>{const _0x36a5ea=a0_0x157ccd;_0x46ab60[_0x36a5ea(0x214)]===_0x36a5ea(0x234)&&!_0x46ab60['shiftKey']&&(_0x46ab60['preventDefault'](),sendMessage());}),sendBtn[a0_0x157ccd(0x22c)]=sendMessage,document[a0_0x157ccd(0x1f6)](a0_0x157ccd(0x241),_0x3c74c5=>{const _0x29ab62=a0_0x157ccd;document[_0x29ab62(0x257)](_0x29ab62(0x210))[_0x29ab62(0x20d)](_0x380257=>{const _0x3dbcd8=_0x29ab62;if(!_0x380257[_0x3dbcd8(0x267)](_0x3c74c5['target']))_0x380257[_0x3dbcd8(0x23a)][_0x3dbcd8(0x229)](_0x3dbcd8(0x248));});});const saved=localStorage['getItem'](a0_0x157ccd(0x21b));function a0_0x66e0(){const _0x12a410=['.container','textContent','70870keWqEA','warn','1203wVVsxQ','querySelector','TG\x20setup\x20error:','show','stringify','search','splice','className','error','notificationOccurred','href','emptyState','from','text/plain','forEach','impactOccurred','paddingBottom','.message.show-delete','touchstart','disabled','message\x20ai','key','modalTitle','push','inputArea','height','WebApp','innerHeight','ai_chat_messages','(((.+)+)+)+$','10rUMzdS','#050505','user','floor','Ошибка\x20сети','value','removeItem','102pOgzwG','Очистить\x20историю?','initDataUnsafe','Удалить?','Действие\x20необратимо.','remove','add','send_message','onclick','getHours','abort','sendBtn','message-time','6.1','typingIndicator','setItem','Enter','resize','initData','content','input','getElementById','classList','style','focus','modalConfirm','none','innerHTML','toString','click','onEvent','HapticFeedback','modalText','12463979XGEgUU','debug_uid','2331BLAhku','show-delete','flex','now','div','10QueySv','ready','viewportHeight','trim','clear_history','<br>','messageInput','2290992ctzYNY','username','length','Начнется\x20новый\x20диалог.','querySelectorAll','medium','chatArea','expand','POST','clearBtn','Telegram','random','parse','padStart','796844AuGJIh','scrollTop','1448YyjVdM','keydown','createElement','signal','contains','confirmModal','success','text','Пустой\x20ответ','appendChild','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','1530468adjnpI','getMinutes','scrollHeight','addEventListener','offClick','message\x20','viewportChanged','onClick'];a0_0x66e0=function(){return _0x12a410;};return a0_0x66e0();}if(saved)try{messages=JSON[a0_0x157ccd(0x25f)](saved),renderMessages();}catch(a0_0x187af1){}updateSendButton();