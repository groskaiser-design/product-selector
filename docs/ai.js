const a0_0x363b3f=a0_0xf18d;(function(_0x18ea64,_0x5c026b){const _0x439a98=a0_0xf18d,_0x1c9bd5=_0x18ea64();while(!![]){try{const _0x3ad0b4=parseInt(_0x439a98(0x18d))/0x1*(parseInt(_0x439a98(0x184))/0x2)+-parseInt(_0x439a98(0x150))/0x3*(-parseInt(_0x439a98(0x14a))/0x4)+-parseInt(_0x439a98(0x1a6))/0x5*(parseInt(_0x439a98(0x15a))/0x6)+-parseInt(_0x439a98(0x177))/0x7*(-parseInt(_0x439a98(0x144))/0x8)+parseInt(_0x439a98(0x12a))/0x9*(-parseInt(_0x439a98(0x12f))/0xa)+-parseInt(_0x439a98(0x153))/0xb+-parseInt(_0x439a98(0x15c))/0xc*(-parseInt(_0x439a98(0x195))/0xd);if(_0x3ad0b4===_0x5c026b)break;else _0x1c9bd5['push'](_0x1c9bd5['shift']());}catch(_0x32b801){_0x1c9bd5['push'](_0x1c9bd5['shift']());}}}(a0_0xf5f6,0x782c0));const tg=window['Telegram']?.[a0_0x363b3f(0x1a8)],HOME_URL=a0_0x363b3f(0x136);function setupTelegramBackButton(){const _0x5e3211=a0_0x363b3f,_0x408862=(function(){let _0x10a11e=!![];return function(_0x22560b,_0x15804c){const _0x2ceb25=_0x10a11e?function(){const _0x33c55b=a0_0xf18d;if(_0x15804c){const _0x3fa740=_0x15804c[_0x33c55b(0x19c)](_0x22560b,arguments);return _0x15804c=null,_0x3fa740;}}:function(){};return _0x10a11e=![],_0x2ceb25;};}()),_0x28a0b1=_0x408862(this,function(){const _0x30790e=a0_0xf18d;return _0x28a0b1[_0x30790e(0x1a7)]()[_0x30790e(0x182)](_0x30790e(0x197))[_0x30790e(0x1a7)]()[_0x30790e(0x139)](_0x28a0b1)['search'](_0x30790e(0x197));});_0x28a0b1();if(!tg)return;try{tg[_0x5e3211(0x1a1)](),tg['expand'](),tg[_0x5e3211(0x158)]?.('#050505');if(tg[_0x5e3211(0x14b)]?.(_0x5e3211(0x16c)))tg[_0x5e3211(0x141)]?.();const _0xd7544b=tg[_0x5e3211(0x140)];if(_0xd7544b){_0xd7544b[_0x5e3211(0x1a9)]();if(typeof _0xd7544b[_0x5e3211(0x160)]===_0x5e3211(0x185))try{_0xd7544b['offClick']();}catch(_0x23fa60){}_0xd7544b[_0x5e3211(0x137)](()=>{const _0x42c0f7=_0x5e3211;if(tg['HapticFeedback'])tg[_0x42c0f7(0x157)][_0x42c0f7(0x193)](_0x42c0f7(0x161));location[_0x42c0f7(0x1b3)]=HOME_URL;});}}catch(_0x2b171d){console[_0x5e3211(0x17b)](_0x5e3211(0x1aa),_0x2b171d);}}(function initStableLayout(){const _0x1df337=a0_0x363b3f,_0xea0757=document[_0x1df337(0x14c)](_0x1df337(0x191)),_0x27495d=document['getElementById'](_0x1df337(0x1b4)),_0x415084=document[_0x1df337(0x194)](_0x1df337(0x170)),_0x5541cb=document[_0x1df337(0x194)]('messageInput');function _0x457e4d(){const _0x191e1e=_0x1df337;if(!_0xea0757)return;const _0x4821ce=tg&&tg[_0x191e1e(0x169)]?tg[_0x191e1e(0x169)]:window[_0x191e1e(0x146)];_0xea0757[_0x191e1e(0x15d)][_0x191e1e(0x156)]=_0x4821ce+'px';if(_0x27495d){const _0x2103f7=_0x27495d[_0x191e1e(0x149)];_0x415084['style'][_0x191e1e(0x155)]=_0x2103f7+0x28+'px';}}tg?tg[_0x1df337(0x129)](_0x1df337(0x13f),({isStateStable:_0x39aba1})=>{_0x457e4d();if(_0x39aba1)requestAnimationFrame(()=>{const _0x5b6b12=a0_0xf18d;_0x415084[_0x5b6b12(0x175)]=_0x415084[_0x5b6b12(0x164)];});}):window[_0x1df337(0x17e)](_0x1df337(0x17f),_0x457e4d),_0x457e4d(),_0x5541cb&&(_0x5541cb[_0x1df337(0x17e)](_0x1df337(0x19f),()=>{requestAnimationFrame(_0x457e4d);}),_0x5541cb[_0x1df337(0x17e)](_0x1df337(0x174),()=>{setTimeout(()=>{const _0x42d137=a0_0xf18d;_0x415084[_0x42d137(0x175)]=_0x415084['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x363b3f(0x18b),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x363b3f(0x194)](a0_0x363b3f(0x170)),emptyState=document[a0_0x363b3f(0x194)](a0_0x363b3f(0x199)),messageInput=document['getElementById']('messageInput'),sendBtn=document['getElementById'](a0_0x363b3f(0x1a4)),clearBtn=document[a0_0x363b3f(0x194)](a0_0x363b3f(0x12b)),modal=document[a0_0x363b3f(0x194)](a0_0x363b3f(0x178)),mTitle=document[a0_0x363b3f(0x194)](a0_0x363b3f(0x134)),mText=document[a0_0x363b3f(0x194)](a0_0x363b3f(0x1a5));let modalCallback=null;async function callBackend(_0x2db5e7,_0x3b2d90){const _0x12891d=a0_0x363b3f,_0x4ad179=tg?.[_0x12891d(0x17c)]?.[_0x12891d(0x18c)]||{},_0xf199cf=_0x4ad179['id']||localStorage[_0x12891d(0x16b)](_0x12891d(0x1b5))||'d-'+Math[_0x12891d(0x154)](Math[_0x12891d(0x131)]()*0x3b9aca00);if(!_0x4ad179['id'])localStorage[_0x12891d(0x151)](_0x12891d(0x1b5),_0xf199cf);const _0x115c06={'action':_0x2db5e7,'user_id':_0xf199cf,'user_data':{'first_name':_0x4ad179[_0x12891d(0x1ac)],'username':_0x4ad179[_0x12891d(0x147)]},'init_data':tg?.[_0x12891d(0x135)]||'',..._0x3b2d90},_0x1051b5=new AbortController(),_0x388498=setTimeout(()=>_0x1051b5['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3a5915=await fetch(BACKEND_URL,{'method':_0x12891d(0x179),'headers':{'Content-Type':_0x12891d(0x17a)},'body':JSON[_0x12891d(0x171)](_0x115c06),'signal':_0x1051b5[_0x12891d(0x196)]});return clearTimeout(_0x388498),await _0x3a5915[_0x12891d(0x1b2)]();}catch(_0x37be41){return{'success':![],'error':String(_0x37be41)};}}function formatTime(_0x2c5930){const _0x303a1d=a0_0x363b3f,_0x463689=new Date(_0x2c5930);return String(_0x463689[_0x303a1d(0x1ad)]())['padStart'](0x2,'0')+':'+String(_0x463689[_0x303a1d(0x180)]())['padStart'](0x2,'0');}function a0_0xf5f6(){const _0x41116b=['random','key','Enter','modalTitle','initData','./router.html','onClick','innerHTML','constructor','touchstart','contains','length','typingIndicator','value','viewportChanged','BackButton','disableVerticalSwipes','disabled','keydown','40VUTSnj','modalConfirm','innerHeight','username','splice','offsetHeight','8kKqANz','isVersionAtLeast','querySelector','message\x20ai','touchend','div','966099JTRGAu','setItem','className','976547PgBCyn','floor','paddingBottom','height','HapticFeedback','setHeaderColor','querySelectorAll','137226maXxuQ','trim','12mrAYjs','style','onclick','ai_chat_messages','offClick','light','show-delete','add','scrollHeight','textContent','stopPropagation','medium','now','viewportHeight','createElement','getItem','6.1','appendChild','clear_history','Удалить?','chatArea','stringify','remove','<br>','focus','scrollTop','notificationOccurred','110530tTDAte','confirmModal','POST','text/plain','warn','initDataUnsafe','Ошибка\x20сети','addEventListener','resize','getMinutes','Очистить\x20историю?','search','Пустой\x20ответ','692594DSwvOY','function','.message.show-delete','content','parse','Ошибка\x20сервера','children','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','user','1NTJjkV','none','from','send_message','.container','delete-btn','impactOccurred','getElementById','10244494oEndZA','signal','(((.+)+)+)+$','replace','emptyState','message-bubble','message\x20','apply','message-time','click','input','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','ready','error','removeItem','sendBtn','modalText','125JsbmfO','toString','WebApp','show','TG\x20setup\x20error:','push','first_name','getHours','Действие\x20необратимо.','role','preventDefault','min','json','href','inputArea','debug_uid','success','classList','onEvent','9HgJTFc','clearBtn','timestamp','modalCancel','forEach','7045750EOHHOr','display'];a0_0xf5f6=function(){return _0x41116b;};return a0_0xf5f6();}function createMessageElement(_0x56cce6,_0x41671c){const _0x517fa1=a0_0x363b3f,_0x6e8c13=document['createElement'](_0x517fa1(0x14f));_0x6e8c13[_0x517fa1(0x152)]=_0x517fa1(0x19b)+_0x56cce6[_0x517fa1(0x1af)];const _0x270d37=document[_0x517fa1(0x16a)](_0x517fa1(0x14f));_0x270d37[_0x517fa1(0x152)]=_0x517fa1(0x19a),_0x270d37[_0x517fa1(0x138)]=_0x56cce6[_0x517fa1(0x187)][_0x517fa1(0x198)](/\n/g,_0x517fa1(0x173));const _0x231b16=document['createElement'](_0x517fa1(0x14f));_0x231b16[_0x517fa1(0x152)]=_0x517fa1(0x192),_0x231b16['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x231b16[_0x517fa1(0x15e)]=_0x344fdf=>{const _0x5608f9=_0x517fa1;_0x344fdf[_0x5608f9(0x166)](),confirmDelete(_0x41671c);};let _0x558cd3;_0x270d37[_0x517fa1(0x17e)](_0x517fa1(0x13a),()=>_0x558cd3=setTimeout(()=>{const _0x17b4a1=_0x517fa1;_0x6e8c13[_0x17b4a1(0x128)]['add']('show-delete');if(tg?.[_0x17b4a1(0x157)])tg[_0x17b4a1(0x157)][_0x17b4a1(0x193)](_0x17b4a1(0x167));},0x1f4)),_0x270d37[_0x517fa1(0x17e)](_0x517fa1(0x14e),()=>clearTimeout(_0x558cd3));const _0x49db00=document[_0x517fa1(0x16a)](_0x517fa1(0x14f));return _0x49db00['className']=_0x517fa1(0x19d),_0x49db00[_0x517fa1(0x165)]=formatTime(_0x56cce6[_0x517fa1(0x12c)]),_0x6e8c13[_0x517fa1(0x16d)](_0x231b16),_0x6e8c13[_0x517fa1(0x16d)](_0x270d37),_0x6e8c13['appendChild'](_0x49db00),_0x6e8c13;}function createTypingIndicator(){const _0x41ca34=a0_0x363b3f,_0x43a016=document[_0x41ca34(0x16a)](_0x41ca34(0x14f));return _0x43a016[_0x41ca34(0x152)]=_0x41ca34(0x14d),_0x43a016['id']=_0x41ca34(0x13d),_0x43a016[_0x41ca34(0x138)]=_0x41ca34(0x1a0),_0x43a016;}function renderMessages(){const _0x49d294=a0_0x363b3f;Array[_0x49d294(0x18f)](chatArea[_0x49d294(0x18a)])[_0x49d294(0x12e)](_0x4516c0=>{const _0x5b2be7=_0x49d294;if(_0x4516c0['id']!==_0x5b2be7(0x199))_0x4516c0[_0x5b2be7(0x172)]();}),messages[_0x49d294(0x13c)]>0x0?(emptyState[_0x49d294(0x15d)][_0x49d294(0x130)]=_0x49d294(0x18e),messages[_0x49d294(0x12e)]((_0x514427,_0x16d751)=>chatArea[_0x49d294(0x16d)](createMessageElement(_0x514427,_0x16d751)))):emptyState[_0x49d294(0x15d)][_0x49d294(0x130)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x49d294(0x164)]);}function autoResizeTextarea(){const _0x1fb895=a0_0x363b3f;messageInput[_0x1fb895(0x15d)][_0x1fb895(0x156)]='auto',messageInput['style'][_0x1fb895(0x156)]=Math[_0x1fb895(0x1b1)](messageInput[_0x1fb895(0x164)],0x78)+'px';}function updateSendButton(){const _0x54255b=a0_0x363b3f,_0x2d6956=messageInput['value'][_0x54255b(0x15b)]();sendBtn[_0x54255b(0x142)]=!_0x2d6956||isTyping;}async function sendMessage(){const _0xed87ba=a0_0x363b3f,_0x5a0fbb=messageInput['value'][_0xed87ba(0x15b)]();if(!_0x5a0fbb||isTyping)return;if(tg?.[_0xed87ba(0x157)])tg['HapticFeedback'][_0xed87ba(0x193)]('light');messages[_0xed87ba(0x1ab)]({'role':_0xed87ba(0x18c),'content':_0x5a0fbb,'timestamp':Date[_0xed87ba(0x168)]()}),localStorage[_0xed87ba(0x151)](_0xed87ba(0x15f),JSON[_0xed87ba(0x171)](messages)),renderMessages(),messageInput[_0xed87ba(0x13e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0xed87ba(0x175)]=chatArea['scrollHeight'];const _0x23779b=await callBackend(_0xed87ba(0x190),{'message':_0x5a0fbb});isTyping=![];const _0x791e07=document[_0xed87ba(0x194)](_0xed87ba(0x13d));if(_0x791e07)_0x791e07[_0xed87ba(0x172)]();let _0x3102a4=_0xed87ba(0x17d);if(_0x23779b[_0xed87ba(0x1b6)]){_0x3102a4=_0x23779b['text']||_0xed87ba(0x183);if(tg?.[_0xed87ba(0x157)])tg[_0xed87ba(0x157)]['notificationOccurred'](_0xed87ba(0x1b6));}else{_0x3102a4=_0x23779b[_0xed87ba(0x1a2)]||_0xed87ba(0x189);if(tg?.['HapticFeedback'])tg[_0xed87ba(0x157)][_0xed87ba(0x176)](_0xed87ba(0x1a2));}messages[_0xed87ba(0x1ab)]({'role':'ai','content':_0x3102a4,'timestamp':Date[_0xed87ba(0x168)]()}),localStorage[_0xed87ba(0x151)]('ai_chat_messages',JSON[_0xed87ba(0x171)](messages)),renderMessages();}function a0_0xf18d(_0x83de9a,_0x5a75a2){_0x83de9a=_0x83de9a-0x128;const _0x45feda=a0_0xf5f6();let _0xf92af3=_0x45feda[_0x83de9a];return _0xf92af3;}function confirmDelete(_0x52ddcf){const _0x5dcc8e=a0_0x363b3f;if(mTitle)mTitle['textContent']=_0x5dcc8e(0x16f);if(mText)mText[_0x5dcc8e(0x165)]=_0x5dcc8e(0x1ae);modalCallback=()=>{const _0x2a929=_0x5dcc8e;messages[_0x2a929(0x148)](_0x52ddcf,0x1),localStorage[_0x2a929(0x151)](_0x2a929(0x15f),JSON[_0x2a929(0x171)](messages)),renderMessages();},modal[_0x5dcc8e(0x128)][_0x5dcc8e(0x163)](_0x5dcc8e(0x1a9));}if(clearBtn)clearBtn[a0_0x363b3f(0x15e)]=()=>{const _0x3ed51f=a0_0x363b3f;if(!messages[_0x3ed51f(0x13c)])return;if(mTitle)mTitle[_0x3ed51f(0x165)]=_0x3ed51f(0x181);if(mText)mText['textContent']='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x4193fe=_0x3ed51f;messages=[],localStorage[_0x4193fe(0x1a3)](_0x4193fe(0x15f)),renderMessages(),callBackend(_0x4193fe(0x16e),{});},modal[_0x3ed51f(0x128)][_0x3ed51f(0x163)](_0x3ed51f(0x1a9));};document[a0_0x363b3f(0x194)](a0_0x363b3f(0x12d))[a0_0x363b3f(0x15e)]=()=>modal[a0_0x363b3f(0x128)][a0_0x363b3f(0x172)](a0_0x363b3f(0x1a9)),document['getElementById'](a0_0x363b3f(0x145))[a0_0x363b3f(0x15e)]=()=>{const _0x1d9539=a0_0x363b3f;if(modalCallback)modalCallback();modal[_0x1d9539(0x128)][_0x1d9539(0x172)](_0x1d9539(0x1a9));},messageInput['addEventListener'](a0_0x363b3f(0x19f),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x363b3f(0x143),_0x384c94=>{const _0xf86b53=a0_0x363b3f;_0x384c94[_0xf86b53(0x132)]===_0xf86b53(0x133)&&!_0x384c94['shiftKey']&&(_0x384c94[_0xf86b53(0x1b0)](),sendMessage());}),sendBtn[a0_0x363b3f(0x15e)]=sendMessage,document[a0_0x363b3f(0x17e)](a0_0x363b3f(0x19e),_0x39236a=>{const _0x5c96dd=a0_0x363b3f;document[_0x5c96dd(0x159)](_0x5c96dd(0x186))[_0x5c96dd(0x12e)](_0x51156d=>{const _0x32cfb8=_0x5c96dd;if(!_0x51156d[_0x32cfb8(0x13b)](_0x39236a['target']))_0x51156d[_0x32cfb8(0x128)][_0x32cfb8(0x172)](_0x32cfb8(0x162));});});const saved=localStorage[a0_0x363b3f(0x16b)](a0_0x363b3f(0x15f));if(saved)try{messages=JSON[a0_0x363b3f(0x188)](saved),renderMessages();}catch(a0_0x1bc4ef){}updateSendButton();