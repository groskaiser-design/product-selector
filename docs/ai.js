const a0_0x4280dc=a0_0x2c8a;(function(_0x1d033a,_0x2f0f93){const _0x2c172e=a0_0x2c8a,_0x46d48f=_0x1d033a();while(!![]){try{const _0x516a9c=parseInt(_0x2c172e(0x17a))/0x1*(-parseInt(_0x2c172e(0x171))/0x2)+-parseInt(_0x2c172e(0x162))/0x3+-parseInt(_0x2c172e(0x196))/0x4+-parseInt(_0x2c172e(0x1b5))/0x5*(-parseInt(_0x2c172e(0x18c))/0x6)+-parseInt(_0x2c172e(0x186))/0x7+parseInt(_0x2c172e(0x16e))/0x8*(parseInt(_0x2c172e(0x173))/0x9)+parseInt(_0x2c172e(0x18d))/0xa*(parseInt(_0x2c172e(0x1b3))/0xb);if(_0x516a9c===_0x2f0f93)break;else _0x46d48f['push'](_0x46d48f['shift']());}catch(_0x3d2459){_0x46d48f['push'](_0x46d48f['shift']());}}}(a0_0x5aa0,0xb9389));const tg=window[a0_0x4280dc(0x16a)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x3f4b73=a0_0x4280dc;if(!tg)return;try{tg['ready'](),tg[_0x3f4b73(0x187)](),tg[_0x3f4b73(0x19f)]?.(_0x3f4b73(0x170));if(tg[_0x3f4b73(0x191)]?.(_0x3f4b73(0x164)))tg['disableVerticalSwipes']?.();const _0x2b1bf9=tg[_0x3f4b73(0x1a2)];if(_0x2b1bf9){_0x2b1bf9[_0x3f4b73(0x14b)]();if(typeof _0x2b1bf9[_0x3f4b73(0x182)]===_0x3f4b73(0x15a))try{_0x2b1bf9['offClick']();}catch(_0x445c17){}_0x2b1bf9['onClick'](()=>{const _0xd7a397=_0x3f4b73;if(tg[_0xd7a397(0x141)])tg['HapticFeedback'][_0xd7a397(0x1b8)]('light');location[_0xd7a397(0x19b)]=HOME_URL;});}}catch(_0x4e45b4){console['warn']('TG\x20setup\x20error:',_0x4e45b4);}}(function initStableLayout(){const _0xc544bf=a0_0x4280dc,_0x55a829=(function(){let _0x361574=!![];return function(_0x1206b8,_0x45173d){const _0x9af343=_0x361574?function(){const _0x5b8f84=a0_0x2c8a;if(_0x45173d){const _0x1a88ba=_0x45173d[_0x5b8f84(0x157)](_0x1206b8,arguments);return _0x45173d=null,_0x1a88ba;}}:function(){};return _0x361574=![],_0x9af343;};}()),_0x2de780=document['querySelector'](_0xc544bf(0x1b7)),_0x1a8b6b=document[_0xc544bf(0x14f)](_0xc544bf(0x145)),_0x102273=document[_0xc544bf(0x14f)](_0xc544bf(0x197)),_0x42e8b6=document['getElementById'](_0xc544bf(0x16c));function _0x3f47b1(){const _0x62753c=_0xc544bf,_0x56fca0=_0x55a829(this,function(){const _0x1efc8e=a0_0x2c8a;return _0x56fca0[_0x1efc8e(0x17e)]()[_0x1efc8e(0x154)]('(((.+)+)+)+$')['toString']()[_0x1efc8e(0x1a8)](_0x56fca0)[_0x1efc8e(0x154)]('(((.+)+)+)+$');});_0x56fca0();if(!_0x2de780)return;const _0x5d30f8=tg&&tg[_0x62753c(0x14e)]?tg[_0x62753c(0x14e)]:window[_0x62753c(0x198)];_0x2de780['style']['height']=_0x5d30f8+'px';if(_0x1a8b6b){const _0x5b5dfd=_0x1a8b6b['offsetHeight'];_0x102273['style'][_0x62753c(0x1a9)]=_0x5b5dfd+0x28+'px';}}tg?tg[_0xc544bf(0x1b6)](_0xc544bf(0x148),({isStateStable:_0x1ffafb})=>{_0x3f47b1();if(_0x1ffafb)requestAnimationFrame(()=>{const _0x430fd8=a0_0x2c8a;_0x102273[_0x430fd8(0x19c)]=_0x102273[_0x430fd8(0x166)];});}):window['addEventListener'](_0xc544bf(0x149),_0x3f47b1),_0x3f47b1(),_0x42e8b6&&(_0x42e8b6[_0xc544bf(0x1ac)](_0xc544bf(0x1af),()=>{requestAnimationFrame(_0x3f47b1);}),_0x42e8b6['addEventListener'](_0xc544bf(0x16f),()=>{setTimeout(()=>{const _0x7e07af=a0_0x2c8a;_0x102273[_0x7e07af(0x19c)]=_0x102273['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4280dc(0x150),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x5aa0(){const _0x3b663f=['toString','message-bubble','flex','show-delete','offClick','floor','.message.show-delete','setItem','9942842kpHPwv','expand','contains','className','delete-btn','role','18ehfEsQ','20ZLsazh','getItem','remove','value','isVersionAtLeast','key','keydown','modalText','POST','1712984pOSmrm','chatArea','innerHeight','Начнется\x20новый\x20диалог.','modalCancel','href','scrollTop','style','ai_chat_messages','setHeaderColor','text/plain','parse','BackButton','Действие\x20необратимо.','text','forEach','createElement','debug_uid','constructor','paddingBottom','auto','send_message','addEventListener','Ошибка\x20сервера','light','input','appendChild','typingIndicator','classList','16286996WqDihe','shiftKey','1004375nIRpQN','onEvent','.container','impactOccurred','username','stringify','first_name','HapticFeedback','error','clearBtn','push','inputArea','none','message\x20ai','viewportChanged','resize','from','show','height','content','viewportHeight','getElementById','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','success','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','signal','search','onclick','querySelectorAll','apply','display','now','function','trim','textContent','stopPropagation','Очистить\x20историю?','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','Enter','innerHTML','1278960NORIsq','emptyState','6.1','disabled','scrollHeight','confirmModal','add','message-time','Telegram','padStart','messageInput','Ошибка\x20сети','177272BqBbJt','focus','#050505','693278RagwkB','div','207AnlUNL','sendBtn','notificationOccurred','clear_history','user','timestamp','getMinutes','3zZebKK','click','Пустой\x20ответ','length'];a0_0x5aa0=function(){return _0x3b663f;};return a0_0x5aa0();}let messages=[],isTyping=![];const chatArea=document[a0_0x4280dc(0x14f)](a0_0x4280dc(0x197)),emptyState=document[a0_0x4280dc(0x14f)]('emptyState'),messageInput=document[a0_0x4280dc(0x14f)](a0_0x4280dc(0x16c)),sendBtn=document[a0_0x4280dc(0x14f)](a0_0x4280dc(0x174)),clearBtn=document[a0_0x4280dc(0x14f)](a0_0x4280dc(0x143)),modal=document['getElementById'](a0_0x4280dc(0x167)),mTitle=document[a0_0x4280dc(0x14f)]('modalTitle'),mText=document['getElementById'](a0_0x4280dc(0x194));let modalCallback=null;async function callBackend(_0x166def,_0x1e9b81){const _0x5bbb43=a0_0x4280dc,_0xd0980e=tg?.['initDataUnsafe']?.[_0x5bbb43(0x177)]||{},_0x25664a=_0xd0980e['id']||localStorage['getItem'](_0x5bbb43(0x1a7))||'d-'+Math[_0x5bbb43(0x183)](Math['random']()*0x3b9aca00);if(!_0xd0980e['id'])localStorage[_0x5bbb43(0x185)]('debug_uid',_0x25664a);const _0x2c7e45={'action':_0x166def,'user_id':_0x25664a,'user_data':{'first_name':_0xd0980e[_0x5bbb43(0x140)],'username':_0xd0980e[_0x5bbb43(0x1b9)]},'init_data':tg?.['initData']||'',..._0x1e9b81},_0x547240=new AbortController(),_0x50bece=setTimeout(()=>_0x547240['abort'](),REQUEST_TIMEOUT_MS);try{const _0x1b01fe=await fetch(BACKEND_URL,{'method':_0x5bbb43(0x195),'headers':{'Content-Type':_0x5bbb43(0x1a0)},'body':JSON['stringify'](_0x2c7e45),'signal':_0x547240[_0x5bbb43(0x153)]});return clearTimeout(_0x50bece),await _0x1b01fe['json']();}catch(_0x3c37b2){return{'success':![],'error':String(_0x3c37b2)};}}function formatTime(_0x4c3249){const _0x3e4b3e=a0_0x4280dc,_0x4c9f64=new Date(_0x4c3249);return String(_0x4c9f64['getHours']())[_0x3e4b3e(0x16b)](0x2,'0')+':'+String(_0x4c9f64[_0x3e4b3e(0x179)]())[_0x3e4b3e(0x16b)](0x2,'0');}function createMessageElement(_0x40b1cb,_0x3a876d){const _0x3bf5a0=a0_0x4280dc,_0x4b2929=document['createElement'](_0x3bf5a0(0x172));_0x4b2929['className']='message\x20'+_0x40b1cb[_0x3bf5a0(0x18b)];const _0x34bcb7=document[_0x3bf5a0(0x1a6)](_0x3bf5a0(0x172));_0x34bcb7['className']=_0x3bf5a0(0x17f),_0x34bcb7['innerHTML']=_0x40b1cb[_0x3bf5a0(0x14d)]['replace'](/\n/g,'<br>');const _0x4e45de=document[_0x3bf5a0(0x1a6)](_0x3bf5a0(0x172));_0x4e45de[_0x3bf5a0(0x189)]=_0x3bf5a0(0x18a),_0x4e45de[_0x3bf5a0(0x161)]=_0x3bf5a0(0x152),_0x4e45de[_0x3bf5a0(0x155)]=_0x30d69e=>{const _0x547142=_0x3bf5a0;_0x30d69e[_0x547142(0x15d)](),confirmDelete(_0x3a876d);};let _0x532ca1;_0x34bcb7[_0x3bf5a0(0x1ac)]('touchstart',()=>_0x532ca1=setTimeout(()=>{const _0x41c5ac=_0x3bf5a0;_0x4b2929['classList']['add']('show-delete');if(tg?.[_0x41c5ac(0x141)])tg[_0x41c5ac(0x141)][_0x41c5ac(0x1b8)]('medium');},0x1f4)),_0x34bcb7[_0x3bf5a0(0x1ac)]('touchend',()=>clearTimeout(_0x532ca1));const _0x201ad0=document[_0x3bf5a0(0x1a6)](_0x3bf5a0(0x172));return _0x201ad0[_0x3bf5a0(0x189)]=_0x3bf5a0(0x169),_0x201ad0[_0x3bf5a0(0x15c)]=formatTime(_0x40b1cb[_0x3bf5a0(0x178)]),_0x4b2929['appendChild'](_0x4e45de),_0x4b2929[_0x3bf5a0(0x1b0)](_0x34bcb7),_0x4b2929[_0x3bf5a0(0x1b0)](_0x201ad0),_0x4b2929;}function createTypingIndicator(){const _0x33ff71=a0_0x4280dc,_0x1026a0=document['createElement']('div');return _0x1026a0['className']=_0x33ff71(0x147),_0x1026a0['id']=_0x33ff71(0x1b1),_0x1026a0[_0x33ff71(0x161)]=_0x33ff71(0x15f),_0x1026a0;}function renderMessages(){const _0x66d482=a0_0x4280dc;Array[_0x66d482(0x14a)](chatArea['children'])[_0x66d482(0x1a5)](_0x213712=>{const _0x45acab=_0x66d482;if(_0x213712['id']!==_0x45acab(0x163))_0x213712[_0x45acab(0x18f)]();}),messages[_0x66d482(0x17d)]>0x0?(emptyState[_0x66d482(0x19d)][_0x66d482(0x158)]=_0x66d482(0x146),messages['forEach']((_0x35f470,_0x100346)=>chatArea[_0x66d482(0x1b0)](createMessageElement(_0x35f470,_0x100346)))):emptyState[_0x66d482(0x19d)][_0x66d482(0x158)]=_0x66d482(0x180),requestAnimationFrame(()=>chatArea[_0x66d482(0x19c)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x52a687=a0_0x4280dc;messageInput[_0x52a687(0x19d)][_0x52a687(0x14c)]=_0x52a687(0x1aa),messageInput['style'][_0x52a687(0x14c)]=Math['min'](messageInput[_0x52a687(0x166)],0x78)+'px';}function updateSendButton(){const _0x2fdb88=a0_0x4280dc,_0x376d38=messageInput[_0x2fdb88(0x190)][_0x2fdb88(0x15b)]();sendBtn[_0x2fdb88(0x165)]=!_0x376d38||isTyping;}async function sendMessage(){const _0x525dbb=a0_0x4280dc,_0x28a117=messageInput[_0x525dbb(0x190)][_0x525dbb(0x15b)]();if(!_0x28a117||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x525dbb(0x141)][_0x525dbb(0x1b8)](_0x525dbb(0x1ae));messages[_0x525dbb(0x144)]({'role':'user','content':_0x28a117,'timestamp':Date[_0x525dbb(0x159)]()}),localStorage[_0x525dbb(0x185)]('ai_chat_messages',JSON[_0x525dbb(0x1ba)](messages)),renderMessages(),messageInput[_0x525dbb(0x190)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x525dbb(0x1b0)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x525e6d=await callBackend(_0x525dbb(0x1ab),{'message':_0x28a117});isTyping=![];const _0xbe27be=document['getElementById'](_0x525dbb(0x1b1));if(_0xbe27be)_0xbe27be[_0x525dbb(0x18f)]();let _0x576c75=_0x525dbb(0x16d);if(_0x525e6d['success']){_0x576c75=_0x525e6d[_0x525dbb(0x1a4)]||_0x525dbb(0x17c);if(tg?.[_0x525dbb(0x141)])tg['HapticFeedback'][_0x525dbb(0x175)](_0x525dbb(0x151));}else{_0x576c75=_0x525e6d[_0x525dbb(0x142)]||_0x525dbb(0x1ad);if(tg?.[_0x525dbb(0x141)])tg[_0x525dbb(0x141)][_0x525dbb(0x175)](_0x525dbb(0x142));}messages[_0x525dbb(0x144)]({'role':'ai','content':_0x576c75,'timestamp':Date['now']()}),localStorage[_0x525dbb(0x185)](_0x525dbb(0x19e),JSON[_0x525dbb(0x1ba)](messages)),renderMessages();}function confirmDelete(_0x5f3767){const _0x55b8ac=a0_0x4280dc;if(mTitle)mTitle[_0x55b8ac(0x15c)]='Удалить?';if(mText)mText['textContent']=_0x55b8ac(0x1a3);modalCallback=()=>{const _0x18f377=_0x55b8ac;messages['splice'](_0x5f3767,0x1),localStorage[_0x18f377(0x185)](_0x18f377(0x19e),JSON[_0x18f377(0x1ba)](messages)),renderMessages();},modal[_0x55b8ac(0x1b2)][_0x55b8ac(0x168)](_0x55b8ac(0x14b));}if(clearBtn)clearBtn['onclick']=()=>{const _0x3d0ef3=a0_0x4280dc;if(!messages[_0x3d0ef3(0x17d)])return;if(mTitle)mTitle['textContent']=_0x3d0ef3(0x15e);if(mText)mText['textContent']=_0x3d0ef3(0x199);modalCallback=async()=>{const _0x21e4b9=_0x3d0ef3;messages=[],localStorage['removeItem'](_0x21e4b9(0x19e)),renderMessages(),callBackend(_0x21e4b9(0x176),{});},modal['classList']['add'](_0x3d0ef3(0x14b));};document[a0_0x4280dc(0x14f)](a0_0x4280dc(0x19a))[a0_0x4280dc(0x155)]=()=>modal[a0_0x4280dc(0x1b2)][a0_0x4280dc(0x18f)](a0_0x4280dc(0x14b)),document[a0_0x4280dc(0x14f)]('modalConfirm')['onclick']=()=>{const _0x59ab21=a0_0x4280dc;if(modalCallback)modalCallback();modal[_0x59ab21(0x1b2)]['remove'](_0x59ab21(0x14b));},messageInput[a0_0x4280dc(0x1ac)](a0_0x4280dc(0x1af),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4280dc(0x1ac)](a0_0x4280dc(0x193),_0x54f00e=>{const _0x452446=a0_0x4280dc;_0x54f00e[_0x452446(0x192)]===_0x452446(0x160)&&!_0x54f00e[_0x452446(0x1b4)]&&(_0x54f00e['preventDefault'](),sendMessage());}),sendBtn[a0_0x4280dc(0x155)]=sendMessage,document[a0_0x4280dc(0x1ac)](a0_0x4280dc(0x17b),_0x18b36c=>{const _0x1b2313=a0_0x4280dc;document[_0x1b2313(0x156)](_0x1b2313(0x184))[_0x1b2313(0x1a5)](_0x53592e=>{const _0x7167c0=_0x1b2313;if(!_0x53592e[_0x7167c0(0x188)](_0x18b36c['target']))_0x53592e['classList'][_0x7167c0(0x18f)](_0x7167c0(0x181));});});const saved=localStorage[a0_0x4280dc(0x18e)](a0_0x4280dc(0x19e));if(saved)try{messages=JSON[a0_0x4280dc(0x1a1)](saved),renderMessages();}catch(a0_0xcfa616){}function a0_0x2c8a(_0x463682,_0x51a4e4){_0x463682=_0x463682-0x140;const _0xece9af=a0_0x5aa0();let _0x20f3da=_0xece9af[_0x463682];return _0x20f3da;}updateSendButton();