const a0_0x1f48c8=a0_0x4ddf;(function(_0x3dc9d2,_0x38bbd4){const _0x54effb=a0_0x4ddf,_0x33e631=_0x3dc9d2();while(!![]){try{const _0x15010d=-parseInt(_0x54effb(0x1ae))/0x1+parseInt(_0x54effb(0x190))/0x2*(-parseInt(_0x54effb(0x193))/0x3)+parseInt(_0x54effb(0x149))/0x4*(parseInt(_0x54effb(0x1b7))/0x5)+-parseInt(_0x54effb(0x166))/0x6*(-parseInt(_0x54effb(0x1a6))/0x7)+-parseInt(_0x54effb(0x1ba))/0x8+parseInt(_0x54effb(0x160))/0x9+-parseInt(_0x54effb(0x186))/0xa;if(_0x15010d===_0x38bbd4)break;else _0x33e631['push'](_0x33e631['shift']());}catch(_0x19d2e1){_0x33e631['push'](_0x33e631['shift']());}}}(a0_0xc983,0x7caac));const tg=window[a0_0x1f48c8(0x14b)]?.[a0_0x1f48c8(0x16d)],HOME_URL=a0_0x1f48c8(0x18f);function setupTelegramBackButton(){const _0x174f53=a0_0x1f48c8;if(!tg)return;try{tg[_0x174f53(0x17e)](),tg[_0x174f53(0x19a)](),tg[_0x174f53(0x1a5)]?.(_0x174f53(0x140));if(tg['isVersionAtLeast']?.(_0x174f53(0x167)))tg[_0x174f53(0x1a3)]?.();const _0xe6d828=tg['BackButton'];if(_0xe6d828){_0xe6d828[_0x174f53(0x16e)]();if(typeof _0xe6d828[_0x174f53(0x16f)]==='function')try{_0xe6d828[_0x174f53(0x16f)]();}catch(_0x3fbb3f){}_0xe6d828[_0x174f53(0x189)](()=>{const _0x168a2f=_0x174f53;if(tg[_0x168a2f(0x196)])tg[_0x168a2f(0x196)]['impactOccurred']('light');location[_0x168a2f(0x1b4)]=HOME_URL;});}}catch(_0x396811){console[_0x174f53(0x14d)](_0x174f53(0x153),_0x396811);}}(function initStableLayout(){const _0x483b77=a0_0x1f48c8,_0x1d266d=(function(){let _0x26cd63=!![];return function(_0x48458a,_0x22972f){const _0x3a0695=_0x26cd63?function(){const _0x44d544=a0_0x4ddf;if(_0x22972f){const _0x11a90b=_0x22972f[_0x44d544(0x1ac)](_0x48458a,arguments);return _0x22972f=null,_0x11a90b;}}:function(){};return _0x26cd63=![],_0x3a0695;};}()),_0x460a19=document[_0x483b77(0x152)](_0x483b77(0x19d)),_0x2dcfc5=document[_0x483b77(0x17c)](_0x483b77(0x165)),_0x4c7bcc=document[_0x483b77(0x17c)](_0x483b77(0x188)),_0x166561=document[_0x483b77(0x17c)](_0x483b77(0x18a));function _0x1dd48b(){const _0xf720e6=_0x483b77,_0xbb449=_0x1d266d(this,function(){const _0x3ea90e=a0_0x4ddf;return _0xbb449['toString']()[_0x3ea90e(0x157)]('(((.+)+)+)+$')['toString']()[_0x3ea90e(0x148)](_0xbb449)[_0x3ea90e(0x157)](_0x3ea90e(0x164));});_0xbb449();if(!_0x460a19)return;const _0x2bd4dd=tg&&tg[_0xf720e6(0x182)]?tg[_0xf720e6(0x182)]:window[_0xf720e6(0x1aa)];_0x460a19[_0xf720e6(0x146)][_0xf720e6(0x181)]=_0x2bd4dd+'px';if(_0x2dcfc5){const _0x21945e=_0x2dcfc5[_0xf720e6(0x198)];_0x4c7bcc[_0xf720e6(0x146)][_0xf720e6(0x172)]=_0x21945e+0x28+'px';}}tg?tg[_0x483b77(0x195)](_0x483b77(0x15e),({isStateStable:_0x1d0980})=>{_0x1dd48b();if(_0x1d0980)requestAnimationFrame(()=>{const _0xbc9313=a0_0x4ddf;_0x4c7bcc[_0xbc9313(0x169)]=_0x4c7bcc[_0xbc9313(0x1ad)];});}):window[_0x483b77(0x18d)]('resize',_0x1dd48b),_0x1dd48b(),_0x166561&&(_0x166561[_0x483b77(0x18d)](_0x483b77(0x1a1),()=>{requestAnimationFrame(_0x1dd48b);}),_0x166561[_0x483b77(0x18d)](_0x483b77(0x1a0),()=>{setTimeout(()=>{const _0x353663=a0_0x4ddf;_0x4c7bcc[_0x353663(0x169)]=_0x4c7bcc['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1f48c8(0x187),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1f48c8(0x17c)](a0_0x1f48c8(0x188)),emptyState=document[a0_0x1f48c8(0x17c)](a0_0x1f48c8(0x1ab)),messageInput=document[a0_0x1f48c8(0x17c)]('messageInput'),sendBtn=document[a0_0x1f48c8(0x17c)](a0_0x1f48c8(0x194)),clearBtn=document[a0_0x1f48c8(0x17c)]('clearBtn'),modal=document['getElementById'](a0_0x1f48c8(0x16a)),mTitle=document[a0_0x1f48c8(0x17c)](a0_0x1f48c8(0x14a)),mText=document[a0_0x1f48c8(0x17c)](a0_0x1f48c8(0x170));let modalCallback=null;async function callBackend(_0x3ede98,_0x20f80a){const _0x4b8878=a0_0x1f48c8,_0x1969d0=tg?.[_0x4b8878(0x18b)]?.[_0x4b8878(0x18c)]||{},_0x50a1e7=_0x1969d0['id']||localStorage['getItem'](_0x4b8878(0x151))||'d-'+Math['floor'](Math[_0x4b8878(0x158)]()*0x3b9aca00);if(!_0x1969d0['id'])localStorage['setItem'](_0x4b8878(0x151),_0x50a1e7);const _0x37f8eb={'action':_0x3ede98,'user_id':_0x50a1e7,'user_data':{'first_name':_0x1969d0['first_name'],'username':_0x1969d0[_0x4b8878(0x15b)]},'init_data':tg?.[_0x4b8878(0x197)]||'',..._0x20f80a},_0x70f9af=new AbortController(),_0x544b4a=setTimeout(()=>_0x70f9af[_0x4b8878(0x15c)](),REQUEST_TIMEOUT_MS);try{const _0x14050d=await fetch(BACKEND_URL,{'method':_0x4b8878(0x163),'headers':{'Content-Type':_0x4b8878(0x14f)},'body':JSON[_0x4b8878(0x15f)](_0x37f8eb),'signal':_0x70f9af[_0x4b8878(0x1b6)]});return clearTimeout(_0x544b4a),await _0x14050d['json']();}catch(_0x2c201e){return{'success':![],'error':String(_0x2c201e)};}}function a0_0xc983(){const _0x539d2b=['add','setHeaderColor','281113MTrtFE','show-delete','click','Пустой\x20ответ','innerHeight','emptyState','apply','scrollHeight','391173exKoLU','div','trim','value','text','keydown','href','splice','signal','115bbBneJ','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','padStart','1828064dwjoBa','message\x20ai','impactOccurred','message-bubble','Действие\x20необратимо.','Начнется\x20новый\x20диалог.','shiftKey','#050505','send_message','onclick','flex','removeItem','getMinutes','style','touchend','constructor','101428DxqCMs','modalTitle','Telegram','Enter','warn','modalCancel','text/plain','appendChild','debug_uid','querySelector','TG\x20setup\x20error:','min','auto','replace','search','random','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','now','username','abort','none','viewportChanged','stringify','8785611qkPUbF','children','timestamp','POST','(((.+)+)+)+$','inputArea','114GkxHNK','6.1','from','scrollTop','confirmModal','message\x20','error','WebApp','show','offClick','modalText','modalConfirm','paddingBottom','typingIndicator','medium','Ошибка\x20сервера','Очистить\x20историю?','setItem','preventDefault','ai_chat_messages','innerHTML','success','getElementById','clear_history','ready','touchstart','stopPropagation','height','viewportHeight','textContent','forEach','className','2362680KdzGbu','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','chatArea','onClick','messageInput','initDataUnsafe','user','addEventListener','Удалить?','./router.html','4qERIWQ','createElement','classList','1433739vTvHWn','sendBtn','onEvent','HapticFeedback','initData','offsetHeight','key','expand','content','remove','.container','length','.message.show-delete','focus','input','<br>','disableVerticalSwipes'];a0_0xc983=function(){return _0x539d2b;};return a0_0xc983();}function formatTime(_0x42dc58){const _0x1df5db=a0_0x1f48c8,_0x31fd68=new Date(_0x42dc58);return String(_0x31fd68['getHours']())['padStart'](0x2,'0')+':'+String(_0x31fd68[_0x1df5db(0x145)]())[_0x1df5db(0x1b9)](0x2,'0');}function createMessageElement(_0x5333c8,_0x1600ad){const _0x25a1f0=a0_0x1f48c8,_0x4ff913=document['createElement'](_0x25a1f0(0x1af));_0x4ff913[_0x25a1f0(0x185)]=_0x25a1f0(0x16b)+_0x5333c8['role'];const _0x5aa63f=document[_0x25a1f0(0x191)](_0x25a1f0(0x1af));_0x5aa63f['className']=_0x25a1f0(0x1bd),_0x5aa63f[_0x25a1f0(0x17a)]=_0x5333c8[_0x25a1f0(0x19b)][_0x25a1f0(0x156)](/\n/g,_0x25a1f0(0x1a2));const _0x306527=document[_0x25a1f0(0x191)](_0x25a1f0(0x1af));_0x306527[_0x25a1f0(0x185)]='delete-btn',_0x306527[_0x25a1f0(0x17a)]=_0x25a1f0(0x159),_0x306527[_0x25a1f0(0x142)]=_0x3891b1=>{const _0x25cfcd=_0x25a1f0;_0x3891b1[_0x25cfcd(0x180)](),confirmDelete(_0x1600ad);};let _0x48099e;_0x5aa63f['addEventListener'](_0x25a1f0(0x17f),()=>_0x48099e=setTimeout(()=>{const _0x108dfd=_0x25a1f0;_0x4ff913[_0x108dfd(0x192)][_0x108dfd(0x1a4)]('show-delete');if(tg?.[_0x108dfd(0x196)])tg[_0x108dfd(0x196)][_0x108dfd(0x1bc)](_0x108dfd(0x174));},0x1f4)),_0x5aa63f[_0x25a1f0(0x18d)](_0x25a1f0(0x147),()=>clearTimeout(_0x48099e));const _0x20808f=document[_0x25a1f0(0x191)](_0x25a1f0(0x1af));return _0x20808f[_0x25a1f0(0x185)]='message-time',_0x20808f[_0x25a1f0(0x183)]=formatTime(_0x5333c8[_0x25a1f0(0x162)]),_0x4ff913[_0x25a1f0(0x150)](_0x306527),_0x4ff913['appendChild'](_0x5aa63f),_0x4ff913[_0x25a1f0(0x150)](_0x20808f),_0x4ff913;}function createTypingIndicator(){const _0xa20d2d=a0_0x1f48c8,_0x3dd2f2=document[_0xa20d2d(0x191)]('div');return _0x3dd2f2[_0xa20d2d(0x185)]=_0xa20d2d(0x1bb),_0x3dd2f2['id']='typingIndicator',_0x3dd2f2[_0xa20d2d(0x17a)]=_0xa20d2d(0x1b8),_0x3dd2f2;}function renderMessages(){const _0x3adaec=a0_0x1f48c8;Array[_0x3adaec(0x168)](chatArea[_0x3adaec(0x161)])[_0x3adaec(0x184)](_0x481573=>{const _0x4a8203=_0x3adaec;if(_0x481573['id']!==_0x4a8203(0x1ab))_0x481573[_0x4a8203(0x19c)]();}),messages[_0x3adaec(0x19e)]>0x0?(emptyState[_0x3adaec(0x146)]['display']=_0x3adaec(0x15d),messages[_0x3adaec(0x184)]((_0x1d9dbb,_0x56f5b3)=>chatArea[_0x3adaec(0x150)](createMessageElement(_0x1d9dbb,_0x56f5b3)))):emptyState['style']['display']=_0x3adaec(0x143),requestAnimationFrame(()=>chatArea[_0x3adaec(0x169)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0xbd80c6=a0_0x1f48c8;messageInput['style'][_0xbd80c6(0x181)]=_0xbd80c6(0x155),messageInput[_0xbd80c6(0x146)][_0xbd80c6(0x181)]=Math[_0xbd80c6(0x154)](messageInput[_0xbd80c6(0x1ad)],0x78)+'px';}function updateSendButton(){const _0x1c98ef=a0_0x1f48c8,_0x267eb9=messageInput[_0x1c98ef(0x1b1)][_0x1c98ef(0x1b0)]();sendBtn['disabled']=!_0x267eb9||isTyping;}function a0_0x4ddf(_0x43a054,_0x4fc6d1){_0x43a054=_0x43a054-0x13f;const _0x27e894=a0_0xc983();let _0x14ce34=_0x27e894[_0x43a054];return _0x14ce34;}async function sendMessage(){const _0x31c5c5=a0_0x1f48c8,_0x5a8c5a=messageInput[_0x31c5c5(0x1b1)][_0x31c5c5(0x1b0)]();if(!_0x5a8c5a||isTyping)return;if(tg?.[_0x31c5c5(0x196)])tg[_0x31c5c5(0x196)][_0x31c5c5(0x1bc)]('light');messages['push']({'role':_0x31c5c5(0x18c),'content':_0x5a8c5a,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x31c5c5(0x15f)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x31c5c5(0x150)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x31c5c5(0x1ad)];const _0x41f41b=await callBackend(_0x31c5c5(0x141),{'message':_0x5a8c5a});isTyping=![];const _0x59ff16=document[_0x31c5c5(0x17c)](_0x31c5c5(0x173));if(_0x59ff16)_0x59ff16[_0x31c5c5(0x19c)]();let _0x2c0aee='Ошибка\x20сети';if(_0x41f41b[_0x31c5c5(0x17b)]){_0x2c0aee=_0x41f41b[_0x31c5c5(0x1b2)]||_0x31c5c5(0x1a9);if(tg?.[_0x31c5c5(0x196)])tg[_0x31c5c5(0x196)]['notificationOccurred'](_0x31c5c5(0x17b));}else{_0x2c0aee=_0x41f41b[_0x31c5c5(0x16c)]||_0x31c5c5(0x175);if(tg?.[_0x31c5c5(0x196)])tg[_0x31c5c5(0x196)]['notificationOccurred'](_0x31c5c5(0x16c));}messages['push']({'role':'ai','content':_0x2c0aee,'timestamp':Date[_0x31c5c5(0x15a)]()}),localStorage[_0x31c5c5(0x177)](_0x31c5c5(0x179),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x44d646){const _0x4ba917=a0_0x1f48c8;if(mTitle)mTitle['textContent']=_0x4ba917(0x18e);if(mText)mText['textContent']=_0x4ba917(0x1be);modalCallback=()=>{const _0x1e4d94=_0x4ba917;messages[_0x1e4d94(0x1b5)](_0x44d646,0x1),localStorage[_0x1e4d94(0x177)](_0x1e4d94(0x179),JSON['stringify'](messages)),renderMessages();},modal[_0x4ba917(0x192)][_0x4ba917(0x1a4)](_0x4ba917(0x16e));}if(clearBtn)clearBtn['onclick']=()=>{const _0x5bb392=a0_0x1f48c8;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x5bb392(0x176);if(mText)mText[_0x5bb392(0x183)]=_0x5bb392(0x1bf);modalCallback=async()=>{const _0x85a127=_0x5bb392;messages=[],localStorage[_0x85a127(0x144)](_0x85a127(0x179)),renderMessages(),callBackend(_0x85a127(0x17d),{});},modal['classList']['add'](_0x5bb392(0x16e));};document[a0_0x1f48c8(0x17c)](a0_0x1f48c8(0x14e))[a0_0x1f48c8(0x142)]=()=>modal[a0_0x1f48c8(0x192)][a0_0x1f48c8(0x19c)](a0_0x1f48c8(0x16e)),document[a0_0x1f48c8(0x17c)](a0_0x1f48c8(0x171))[a0_0x1f48c8(0x142)]=()=>{const _0x49a8fd=a0_0x1f48c8;if(modalCallback)modalCallback();modal[_0x49a8fd(0x192)][_0x49a8fd(0x19c)](_0x49a8fd(0x16e));},messageInput[a0_0x1f48c8(0x18d)](a0_0x1f48c8(0x1a1),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x1f48c8(0x1b3),_0xa9d755=>{const _0x385c9=a0_0x1f48c8;_0xa9d755[_0x385c9(0x199)]===_0x385c9(0x14c)&&!_0xa9d755[_0x385c9(0x13f)]&&(_0xa9d755[_0x385c9(0x178)](),sendMessage());}),sendBtn[a0_0x1f48c8(0x142)]=sendMessage,document['addEventListener'](a0_0x1f48c8(0x1a8),_0x3fdd0e=>{const _0x24feed=a0_0x1f48c8;document['querySelectorAll'](_0x24feed(0x19f))[_0x24feed(0x184)](_0x2a3f75=>{const _0xcb1b8f=_0x24feed;if(!_0x2a3f75['contains'](_0x3fdd0e['target']))_0x2a3f75[_0xcb1b8f(0x192)][_0xcb1b8f(0x19c)](_0xcb1b8f(0x1a7));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x558043){}updateSendButton();