const a0_0x293704=a0_0x44a0;(function(_0x82876c,_0x58a62c){const _0x477263=a0_0x44a0,_0x432abc=_0x82876c();while(!![]){try{const _0x4735dd=parseInt(_0x477263(0xff))/0x1*(-parseInt(_0x477263(0x13b))/0x2)+parseInt(_0x477263(0x10b))/0x3*(-parseInt(_0x477263(0x129))/0x4)+-parseInt(_0x477263(0x107))/0x5*(parseInt(_0x477263(0x133))/0x6)+-parseInt(_0x477263(0x150))/0x7+-parseInt(_0x477263(0xf7))/0x8+parseInt(_0x477263(0x14f))/0x9*(parseInt(_0x477263(0x11f))/0xa)+parseInt(_0x477263(0xfe))/0xb*(parseInt(_0x477263(0x10a))/0xc);if(_0x4735dd===_0x58a62c)break;else _0x432abc['push'](_0x432abc['shift']());}catch(_0xd135db){_0x432abc['push'](_0x432abc['shift']());}}}(a0_0x107d,0xeb32f));const tg=window['Telegram']?.[a0_0x293704(0x16e)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x13b113=a0_0x293704,_0x637027=(function(){let _0x4e68ad=!![];return function(_0x36ae88,_0x2b01a3){const _0x51b932=_0x4e68ad?function(){if(_0x2b01a3){const _0x43068a=_0x2b01a3['apply'](_0x36ae88,arguments);return _0x2b01a3=null,_0x43068a;}}:function(){};return _0x4e68ad=![],_0x51b932;};}()),_0x5d0366=_0x637027(this,function(){const _0x565189=a0_0x44a0;return _0x5d0366[_0x565189(0x122)]()[_0x565189(0x11c)](_0x565189(0x13d))[_0x565189(0x122)]()[_0x565189(0x10e)](_0x5d0366)['search'](_0x565189(0x13d));});_0x5d0366();if(!tg)return;try{tg[_0x13b113(0x121)](),tg[_0x13b113(0x145)](),tg[_0x13b113(0xfb)]?.('#050505');if(tg['isVersionAtLeast']?.(_0x13b113(0x104)))tg[_0x13b113(0x12f)]?.();const _0x294ee4=tg[_0x13b113(0x167)];if(_0x294ee4){_0x294ee4[_0x13b113(0x120)]();if(typeof _0x294ee4[_0x13b113(0x153)]==='function')try{_0x294ee4[_0x13b113(0x153)]();}catch(_0xce5863){}_0x294ee4[_0x13b113(0x168)](()=>{const _0x3b5fa7=_0x13b113;if(tg[_0x3b5fa7(0x109)])tg[_0x3b5fa7(0x109)][_0x3b5fa7(0x131)]('light');location[_0x3b5fa7(0x134)]=HOME_URL;});}}catch(_0x2b40bb){console[_0x13b113(0x114)](_0x13b113(0x16d),_0x2b40bb);}}(function initStableLayout(){const _0x403f32=a0_0x293704,_0x5f35b1=document[_0x403f32(0x15d)]('.container'),_0x530de1=document[_0x403f32(0x10d)](_0x403f32(0x11e)),_0xf78319=document[_0x403f32(0x10d)](_0x403f32(0x143)),_0x59bd70=document[_0x403f32(0x10d)](_0x403f32(0xf5));function _0x4a47cf(){const _0x4b80fd=_0x403f32;if(!_0x5f35b1)return;const _0x43179e=tg&&tg[_0x4b80fd(0x127)]?tg[_0x4b80fd(0x127)]:window['innerHeight'];_0x5f35b1['style'][_0x4b80fd(0x14d)]=_0x43179e+'px';if(_0x530de1){const _0x2e34c8=_0x530de1[_0x4b80fd(0x13c)];_0xf78319[_0x4b80fd(0x106)][_0x4b80fd(0x156)]=_0x2e34c8+0x28+'px';}}tg?tg[_0x403f32(0x12c)](_0x403f32(0x15e),({isStateStable:_0x1dad9a})=>{_0x4a47cf();if(_0x1dad9a)requestAnimationFrame(()=>{const _0x1cf21b=a0_0x44a0;_0xf78319[_0x1cf21b(0x139)]=_0xf78319[_0x1cf21b(0x155)];});}):window[_0x403f32(0x112)](_0x403f32(0x13e),_0x4a47cf),_0x4a47cf(),_0x59bd70&&(_0x59bd70[_0x403f32(0x112)]('input',()=>{requestAnimationFrame(_0x4a47cf);}),_0x59bd70[_0x403f32(0x112)](_0x403f32(0x163),()=>{setTimeout(()=>{const _0x3d6360=a0_0x44a0;_0xf78319[_0x3d6360(0x139)]=_0xf78319[_0x3d6360(0x155)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x293704(0x10d)](a0_0x293704(0x143)),emptyState=document[a0_0x293704(0x10d)]('emptyState'),messageInput=document[a0_0x293704(0x10d)](a0_0x293704(0xf5)),sendBtn=document[a0_0x293704(0x10d)](a0_0x293704(0x140)),clearBtn=document['getElementById']('clearBtn'),modal=document['getElementById'](a0_0x293704(0x12a)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x293704(0x10d)]('modalText');let modalCallback=null;function a0_0x44a0(_0x4c2039,_0x329d7c){_0x4c2039=_0x4c2039-0xf5;const _0x3d399c=a0_0x107d();let _0x42f90d=_0x3d399c[_0x4c2039];return _0x42f90d;}async function callBackend(_0x5220b2,_0x3156d7){const _0x3f016c=a0_0x293704,_0x48be62=tg?.['initDataUnsafe']?.[_0x3f016c(0x16f)]||{},_0x130ec8=_0x48be62['id']||localStorage[_0x3f016c(0x144)](_0x3f016c(0x124))||'d-'+Math[_0x3f016c(0x16b)](Math[_0x3f016c(0x12b)]()*0x3b9aca00);if(!_0x48be62['id'])localStorage[_0x3f016c(0x100)]('debug_uid',_0x130ec8);const _0x236d98={'action':_0x5220b2,'user_id':_0x130ec8,'user_data':{'first_name':_0x48be62[_0x3f016c(0x170)],'username':_0x48be62[_0x3f016c(0xfa)]},'init_data':tg?.[_0x3f016c(0x136)]||'',..._0x3156d7},_0x2ef6cb=new AbortController(),_0xda8652=setTimeout(()=>_0x2ef6cb[_0x3f016c(0x132)](),REQUEST_TIMEOUT_MS);try{const _0x33bf9c=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x236d98),'signal':_0x2ef6cb[_0x3f016c(0x15c)]});return clearTimeout(_0xda8652),await _0x33bf9c['json']();}catch(_0x455250){return{'success':![],'error':String(_0x455250)};}}function formatTime(_0x89822){const _0x643a93=a0_0x293704,_0x1aaadf=new Date(_0x89822);return String(_0x1aaadf[_0x643a93(0x169)]())[_0x643a93(0x16c)](0x2,'0')+':'+String(_0x1aaadf[_0x643a93(0x165)]())[_0x643a93(0x16c)](0x2,'0');}function createMessageElement(_0x160fad,_0x253b38){const _0x392461=a0_0x293704,_0x3bbc56=document[_0x392461(0x113)](_0x392461(0x14b));_0x3bbc56[_0x392461(0x101)]=_0x392461(0x13f)+_0x160fad['role'];const _0x358c49=document[_0x392461(0x113)]('div');_0x358c49[_0x392461(0x101)]=_0x392461(0x110),_0x358c49[_0x392461(0x14e)]=_0x160fad[_0x392461(0x117)][_0x392461(0x151)](/\n/g,'<br>');const _0x4dafae=document[_0x392461(0x113)](_0x392461(0x14b));_0x4dafae['className']=_0x392461(0xfc),_0x4dafae[_0x392461(0x14e)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x4dafae[_0x392461(0x149)]=_0xca6894=>{const _0x5c87c1=_0x392461;_0xca6894[_0x5c87c1(0x11b)](),confirmDelete(_0x253b38);};let _0x450584;_0x358c49[_0x392461(0x112)]('touchstart',()=>_0x450584=setTimeout(()=>{const _0x18d54d=_0x392461;_0x3bbc56[_0x18d54d(0x14a)][_0x18d54d(0x157)]('show-delete');if(tg?.[_0x18d54d(0x109)])tg[_0x18d54d(0x109)][_0x18d54d(0x131)]('medium');},0x1f4)),_0x358c49[_0x392461(0x112)](_0x392461(0x128),()=>clearTimeout(_0x450584));const _0x1dc77f=document[_0x392461(0x113)](_0x392461(0x14b));return _0x1dc77f[_0x392461(0x101)]=_0x392461(0x103),_0x1dc77f[_0x392461(0x15f)]=formatTime(_0x160fad[_0x392461(0x147)]),_0x3bbc56[_0x392461(0x115)](_0x4dafae),_0x3bbc56['appendChild'](_0x358c49),_0x3bbc56['appendChild'](_0x1dc77f),_0x3bbc56;}function createTypingIndicator(){const _0x44668c=a0_0x293704,_0x22fc06=document['createElement']('div');return _0x22fc06[_0x44668c(0x101)]=_0x44668c(0x154),_0x22fc06['id']='typingIndicator',_0x22fc06[_0x44668c(0x14e)]=_0x44668c(0x11a),_0x22fc06;}function a0_0x107d(){const _0x4f8778=['debug_uid','error','input','viewportHeight','touchend','108BnBjjO','confirmModal','random','onEvent','Удалить?','display','disableVerticalSwipes','value','impactOccurred','abort','12gASQQZ','href','success','initData','notificationOccurred','Enter','scrollTop','emptyState','2ETgwxt','offsetHeight','(((.+)+)+)+$','resize','message\x20','sendBtn','typingIndicator','Пустой\x20ответ','chatArea','getItem','expand','light','timestamp','text','onclick','classList','div','auto','height','innerHTML','6975cEDqSK','11247460bWeaRu','replace','shiftKey','offClick','message\x20ai','scrollHeight','paddingBottom','add','remove','trim','now','send_message','signal','querySelector','viewportChanged','textContent','Ошибка\x20сети','contains','children','focus','removeItem','getMinutes','ai_chat_messages','BackButton','onClick','getHours','length','floor','padStart','TG\x20setup\x20error:','WebApp','user','first_name','messageInput','show-delete','7911264uhyVOx','modalCancel','preventDefault','username','setHeaderColor','delete-btn','none','44KSZiqV','1686254yIPpQw','setItem','className','Очистить\x20историю?','message-time','6.1','push','style','2495470EehUTZ','.message.show-delete','HapticFeedback','18767868rqSQAX','28164koaRjr','stringify','getElementById','constructor','min','message-bubble','Действие\x20необратимо.','addEventListener','createElement','warn','appendChild','forEach','content','splice','click','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','stopPropagation','search','disabled','inputArea','3110AvdJuQ','show','ready','toString','parse'];a0_0x107d=function(){return _0x4f8778;};return a0_0x107d();}function renderMessages(){const _0x717124=a0_0x293704;Array['from'](chatArea[_0x717124(0x162)])[_0x717124(0x116)](_0x1451cb=>{const _0x97b487=_0x717124;if(_0x1451cb['id']!==_0x97b487(0x13a))_0x1451cb[_0x97b487(0x158)]();}),messages[_0x717124(0x16a)]>0x0?(emptyState[_0x717124(0x106)][_0x717124(0x12e)]=_0x717124(0xfd),messages[_0x717124(0x116)]((_0x827539,_0x3ad6d1)=>chatArea[_0x717124(0x115)](createMessageElement(_0x827539,_0x3ad6d1)))):emptyState[_0x717124(0x106)]['display']='flex',requestAnimationFrame(()=>chatArea[_0x717124(0x139)]=chatArea[_0x717124(0x155)]);}function autoResizeTextarea(){const _0x40970e=a0_0x293704;messageInput[_0x40970e(0x106)][_0x40970e(0x14d)]=_0x40970e(0x14c),messageInput[_0x40970e(0x106)][_0x40970e(0x14d)]=Math[_0x40970e(0x10f)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x151d88=a0_0x293704,_0x33e599=messageInput[_0x151d88(0x130)][_0x151d88(0x159)]();sendBtn[_0x151d88(0x11d)]=!_0x33e599||isTyping;}async function sendMessage(){const _0x1236fd=a0_0x293704,_0x2264a0=messageInput[_0x1236fd(0x130)][_0x1236fd(0x159)]();if(!_0x2264a0||isTyping)return;if(tg?.[_0x1236fd(0x109)])tg[_0x1236fd(0x109)][_0x1236fd(0x131)](_0x1236fd(0x146));messages[_0x1236fd(0x105)]({'role':_0x1236fd(0x16f),'content':_0x2264a0,'timestamp':Date[_0x1236fd(0x15a)]()}),localStorage[_0x1236fd(0x100)](_0x1236fd(0x166),JSON[_0x1236fd(0x10c)](messages)),renderMessages(),messageInput[_0x1236fd(0x130)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1236fd(0x115)](createTypingIndicator()),chatArea[_0x1236fd(0x139)]=chatArea[_0x1236fd(0x155)];const _0x3347e4=await callBackend(_0x1236fd(0x15b),{'message':_0x2264a0});isTyping=![];const _0x2fc22e=document[_0x1236fd(0x10d)](_0x1236fd(0x141));if(_0x2fc22e)_0x2fc22e[_0x1236fd(0x158)]();let _0xe0f013=_0x1236fd(0x160);if(_0x3347e4[_0x1236fd(0x135)]){_0xe0f013=_0x3347e4[_0x1236fd(0x148)]||_0x1236fd(0x142);if(tg?.['HapticFeedback'])tg[_0x1236fd(0x109)][_0x1236fd(0x137)](_0x1236fd(0x135));}else{_0xe0f013=_0x3347e4['error']||'Ошибка\x20сервера';if(tg?.[_0x1236fd(0x109)])tg['HapticFeedback'][_0x1236fd(0x137)](_0x1236fd(0x125));}messages['push']({'role':'ai','content':_0xe0f013,'timestamp':Date[_0x1236fd(0x15a)]()}),localStorage['setItem'](_0x1236fd(0x166),JSON[_0x1236fd(0x10c)](messages)),renderMessages();}function confirmDelete(_0x410e45){const _0x1fb3e6=a0_0x293704;if(mTitle)mTitle[_0x1fb3e6(0x15f)]=_0x1fb3e6(0x12d);if(mText)mText[_0x1fb3e6(0x15f)]=_0x1fb3e6(0x111);modalCallback=()=>{const _0x372eee=_0x1fb3e6;messages[_0x372eee(0x118)](_0x410e45,0x1),localStorage[_0x372eee(0x100)](_0x372eee(0x166),JSON[_0x372eee(0x10c)](messages)),renderMessages();},modal['classList'][_0x1fb3e6(0x157)]('show');}if(clearBtn)clearBtn[a0_0x293704(0x149)]=()=>{const _0x1e8de3=a0_0x293704;if(!messages[_0x1e8de3(0x16a)])return;if(mTitle)mTitle['textContent']=_0x1e8de3(0x102);if(mText)mText[_0x1e8de3(0x15f)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x2c43ff=_0x1e8de3;messages=[],localStorage[_0x2c43ff(0x164)](_0x2c43ff(0x166)),renderMessages(),callBackend('clear_history',{});},modal[_0x1e8de3(0x14a)][_0x1e8de3(0x157)](_0x1e8de3(0x120));};document['getElementById'](a0_0x293704(0xf8))[a0_0x293704(0x149)]=()=>modal[a0_0x293704(0x14a)]['remove'](a0_0x293704(0x120)),document[a0_0x293704(0x10d)]('modalConfirm')[a0_0x293704(0x149)]=()=>{const _0x4b8863=a0_0x293704;if(modalCallback)modalCallback();modal[_0x4b8863(0x14a)][_0x4b8863(0x158)](_0x4b8863(0x120));},messageInput[a0_0x293704(0x112)](a0_0x293704(0x126),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x293704(0x112)]('keydown',_0x1b903b=>{const _0xa09ca=a0_0x293704;_0x1b903b['key']===_0xa09ca(0x138)&&!_0x1b903b[_0xa09ca(0x152)]&&(_0x1b903b[_0xa09ca(0xf9)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x293704(0x119),_0x50055c=>{const _0x1b4320=a0_0x293704;document['querySelectorAll'](_0x1b4320(0x108))[_0x1b4320(0x116)](_0x2e3155=>{const _0x4de00e=_0x1b4320;if(!_0x2e3155[_0x4de00e(0x161)](_0x50055c['target']))_0x2e3155[_0x4de00e(0x14a)][_0x4de00e(0x158)](_0x4de00e(0xf6));});});const saved=localStorage[a0_0x293704(0x144)](a0_0x293704(0x166));if(saved)try{messages=JSON[a0_0x293704(0x123)](saved),renderMessages();}catch(a0_0x46c247){}updateSendButton();