const a0_0x859430=a0_0x4279;(function(_0x54ee57,_0x391c88){const _0x1fbebb=a0_0x4279,_0x392260=_0x54ee57();while(!![]){try{const _0x2a55f4=parseInt(_0x1fbebb(0x1b7))/0x1*(parseInt(_0x1fbebb(0x1bc))/0x2)+-parseInt(_0x1fbebb(0x1c4))/0x3*(-parseInt(_0x1fbebb(0x1c2))/0x4)+-parseInt(_0x1fbebb(0x209))/0x5+-parseInt(_0x1fbebb(0x1c1))/0x6+-parseInt(_0x1fbebb(0x1fe))/0x7+-parseInt(_0x1fbebb(0x1d5))/0x8*(parseInt(_0x1fbebb(0x22b))/0x9)+-parseInt(_0x1fbebb(0x1d6))/0xa*(-parseInt(_0x1fbebb(0x1c3))/0xb);if(_0x2a55f4===_0x391c88)break;else _0x392260['push'](_0x392260['shift']());}catch(_0x3ee22d){_0x392260['push'](_0x392260['shift']());}}}(a0_0x7b82,0xc365a));const tg=window[a0_0x859430(0x1ce)]?.[a0_0x859430(0x1cb)],HOME_URL=a0_0x859430(0x1e2);function setupTelegramBackButton(){const _0x4c3c48=a0_0x859430;if(!tg)return;try{tg[_0x4c3c48(0x20d)](),tg['expand'](),tg[_0x4c3c48(0x20b)]?.(_0x4c3c48(0x221));if(tg[_0x4c3c48(0x231)]?.(_0x4c3c48(0x223)))tg['disableVerticalSwipes']?.();const _0x163ae2=tg[_0x4c3c48(0x21b)];if(_0x163ae2){_0x163ae2[_0x4c3c48(0x1ee)]();if(typeof _0x163ae2[_0x4c3c48(0x1de)]==='function')try{_0x163ae2[_0x4c3c48(0x1de)]();}catch(_0x5c6056){}_0x163ae2[_0x4c3c48(0x1d8)](()=>{const _0x4a7d9f=_0x4c3c48;if(tg[_0x4a7d9f(0x1f0)])tg[_0x4a7d9f(0x1f0)][_0x4a7d9f(0x22a)](_0x4a7d9f(0x1b3));location[_0x4a7d9f(0x1f1)]=HOME_URL;});}}catch(_0xcfb1c5){console[_0x4c3c48(0x206)](_0x4c3c48(0x21c),_0xcfb1c5);}}(function initStableLayout(){const _0x473bdf=a0_0x859430,_0x234c82=(function(){let _0x32f56c=!![];return function(_0x123607,_0x1fe221){const _0x23ceae=_0x32f56c?function(){if(_0x1fe221){const _0x1399a5=_0x1fe221['apply'](_0x123607,arguments);return _0x1fe221=null,_0x1399a5;}}:function(){};return _0x32f56c=![],_0x23ceae;};}()),_0x37eab7=document[_0x473bdf(0x1ff)](_0x473bdf(0x1c8)),_0x4b8ad5=document[_0x473bdf(0x226)](_0x473bdf(0x1db)),_0x18860d=document[_0x473bdf(0x226)](_0x473bdf(0x227)),_0x532eaf=document[_0x473bdf(0x226)]('messageInput');function _0x1b4a47(){const _0x2b6e20=_0x473bdf,_0x42d595=_0x234c82(this,function(){const _0x12b6a7=a0_0x4279;return _0x42d595[_0x12b6a7(0x22e)]()[_0x12b6a7(0x1f8)](_0x12b6a7(0x1e6))[_0x12b6a7(0x22e)]()[_0x12b6a7(0x1b9)](_0x42d595)[_0x12b6a7(0x1f8)](_0x12b6a7(0x1e6));});_0x42d595();if(!_0x37eab7)return;const _0x581dcb=tg&&tg['viewportHeight']?tg[_0x2b6e20(0x21a)]:window['innerHeight'];_0x37eab7['style'][_0x2b6e20(0x204)]=_0x581dcb+'px';if(_0x4b8ad5){const _0x32f435=_0x4b8ad5['offsetHeight'];_0x18860d[_0x2b6e20(0x1b2)]['paddingBottom']=_0x32f435+0x28+'px';}}tg?tg[_0x473bdf(0x1e4)]('viewportChanged',({isStateStable:_0x4e364c})=>{_0x1b4a47();if(_0x4e364c)requestAnimationFrame(()=>{const _0x4cd044=a0_0x4279;_0x18860d[_0x4cd044(0x1cc)]=_0x18860d[_0x4cd044(0x1dc)];});}):window[_0x473bdf(0x1b1)](_0x473bdf(0x216),_0x1b4a47),_0x1b4a47(),_0x532eaf&&(_0x532eaf[_0x473bdf(0x1b1)](_0x473bdf(0x1da),()=>{requestAnimationFrame(_0x1b4a47);}),_0x532eaf[_0x473bdf(0x1b1)](_0x473bdf(0x230),()=>{setTimeout(()=>{const _0x5ba290=a0_0x4279;_0x18860d[_0x5ba290(0x1cc)]=_0x18860d[_0x5ba290(0x1dc)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x859430(0x1b8),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x859430(0x226)](a0_0x859430(0x227)),emptyState=document[a0_0x859430(0x226)](a0_0x859430(0x20e)),messageInput=document[a0_0x859430(0x226)]('messageInput'),sendBtn=document[a0_0x859430(0x226)](a0_0x859430(0x1ae)),clearBtn=document[a0_0x859430(0x226)]('clearBtn'),modal=document['getElementById'](a0_0x859430(0x1ca)),mTitle=document[a0_0x859430(0x226)](a0_0x859430(0x1cf)),mText=document['getElementById'](a0_0x859430(0x220));function a0_0x7b82(){const _0x3abfff=['message\x20','6.1','className','typingIndicator','getElementById','chatArea','signal','Ошибка\x20сервера','impactOccurred','18EjqxSP','abort','text/plain','toString','onclick','focus','isVersionAtLeast','preventDefault','Начнется\x20новый\x20диалог.','flex','createElement','sendBtn','Удалить?','key','addEventListener','style','light','keydown','min','getMinutes','106531oWKgbc','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','constructor','remove','innerHTML','14KHMHTW','push','getHours','notificationOccurred','floor','8201382ozJAhr','102308hxuFCi','2794DQLCtw','57nzcyxY','splice','trim','replace','.container','children','confirmModal','WebApp','scrollTop','<br>','Telegram','modalTitle','none','touchstart','Ошибка\x20сети','target','classList','1339256ZxmXZs','99410SUqoPe','show-delete','onClick','modalConfirm','input','inputArea','scrollHeight','stringify','offClick','padStart','now','username','./router.html','initData','onEvent','stopPropagation','(((.+)+)+)+$','medium','message-time','Очистить\x20историю?','clear_history','textContent','div','parse','show','getItem','HapticFeedback','href','text','Действие\x20необратимо.','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','value','timestamp','touchend','search','click','Enter','user','content','length','6457388wsiUEn','querySelector','setItem','role','.message.show-delete','send_message','height','add','warn','delete-btn','POST','1660765ctVcpl','modalCancel','setHeaderColor','message-bubble','ready','emptyState','shiftKey','removeItem','appendChild','forEach','json','Пустой\x20ответ','display','resize','error','disabled','ai_chat_messages','viewportHeight','BackButton','TG\x20setup\x20error:','initDataUnsafe','message\x20ai','first_name','modalText','#050505'];a0_0x7b82=function(){return _0x3abfff;};return a0_0x7b82();}let modalCallback=null;async function callBackend(_0x40e65c,_0x2be3dc){const _0x2635b0=a0_0x859430,_0x1929ff=tg?.[_0x2635b0(0x21d)]?.['user']||{},_0x464bdd=_0x1929ff['id']||localStorage[_0x2635b0(0x1ef)]('debug_uid')||'d-'+Math[_0x2635b0(0x1c0)](Math['random']()*0x3b9aca00);if(!_0x1929ff['id'])localStorage['setItem']('debug_uid',_0x464bdd);const _0x3b0b72={'action':_0x40e65c,'user_id':_0x464bdd,'user_data':{'first_name':_0x1929ff[_0x2635b0(0x21f)],'username':_0x1929ff[_0x2635b0(0x1e1)]},'init_data':tg?.[_0x2635b0(0x1e3)]||'',..._0x2be3dc},_0x39aad8=new AbortController(),_0x198722=setTimeout(()=>_0x39aad8[_0x2635b0(0x22c)](),REQUEST_TIMEOUT_MS);try{const _0x5a0236=await fetch(BACKEND_URL,{'method':_0x2635b0(0x208),'headers':{'Content-Type':_0x2635b0(0x22d)},'body':JSON[_0x2635b0(0x1dd)](_0x3b0b72),'signal':_0x39aad8[_0x2635b0(0x228)]});return clearTimeout(_0x198722),await _0x5a0236[_0x2635b0(0x213)]();}catch(_0x131d28){return{'success':![],'error':String(_0x131d28)};}}function formatTime(_0xa918b9){const _0xf6fa7f=a0_0x859430,_0x18673c=new Date(_0xa918b9);return String(_0x18673c[_0xf6fa7f(0x1be)]())[_0xf6fa7f(0x1df)](0x2,'0')+':'+String(_0x18673c[_0xf6fa7f(0x1b6)]())[_0xf6fa7f(0x1df)](0x2,'0');}function createMessageElement(_0x3bfb0e,_0x203a25){const _0x1d1203=a0_0x859430,_0x4a35b5=document[_0x1d1203(0x1ad)]('div');_0x4a35b5[_0x1d1203(0x224)]=_0x1d1203(0x222)+_0x3bfb0e[_0x1d1203(0x201)];const _0x333ccf=document['createElement'](_0x1d1203(0x1ec));_0x333ccf[_0x1d1203(0x224)]=_0x1d1203(0x20c),_0x333ccf['innerHTML']=_0x3bfb0e[_0x1d1203(0x1fc)][_0x1d1203(0x1c7)](/\n/g,_0x1d1203(0x1cd));const _0x832d0b=document['createElement'](_0x1d1203(0x1ec));_0x832d0b['className']=_0x1d1203(0x207),_0x832d0b[_0x1d1203(0x1bb)]=_0x1d1203(0x1f4),_0x832d0b[_0x1d1203(0x22f)]=_0x7ed5a8=>{const _0x476c5b=_0x1d1203;_0x7ed5a8[_0x476c5b(0x1e5)](),confirmDelete(_0x203a25);};let _0x308f0f;_0x333ccf[_0x1d1203(0x1b1)](_0x1d1203(0x1d1),()=>_0x308f0f=setTimeout(()=>{const _0x14796c=_0x1d1203;_0x4a35b5[_0x14796c(0x1d4)][_0x14796c(0x205)](_0x14796c(0x1d7));if(tg?.[_0x14796c(0x1f0)])tg[_0x14796c(0x1f0)][_0x14796c(0x22a)](_0x14796c(0x1e7));},0x1f4)),_0x333ccf[_0x1d1203(0x1b1)](_0x1d1203(0x1f7),()=>clearTimeout(_0x308f0f));const _0x8fe26e=document['createElement'](_0x1d1203(0x1ec));return _0x8fe26e[_0x1d1203(0x224)]=_0x1d1203(0x1e8),_0x8fe26e[_0x1d1203(0x1eb)]=formatTime(_0x3bfb0e[_0x1d1203(0x1f6)]),_0x4a35b5[_0x1d1203(0x211)](_0x832d0b),_0x4a35b5['appendChild'](_0x333ccf),_0x4a35b5[_0x1d1203(0x211)](_0x8fe26e),_0x4a35b5;}function createTypingIndicator(){const _0x26b6f0=a0_0x859430,_0xc8a68c=document[_0x26b6f0(0x1ad)]('div');return _0xc8a68c[_0x26b6f0(0x224)]=_0x26b6f0(0x21e),_0xc8a68c['id']=_0x26b6f0(0x225),_0xc8a68c[_0x26b6f0(0x1bb)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0xc8a68c;}function renderMessages(){const _0x423861=a0_0x859430;Array['from'](chatArea[_0x423861(0x1c9)])[_0x423861(0x212)](_0x488e9e=>{const _0x4f35fa=_0x423861;if(_0x488e9e['id']!=='emptyState')_0x488e9e[_0x4f35fa(0x1ba)]();}),messages['length']>0x0?(emptyState['style'][_0x423861(0x215)]=_0x423861(0x1d0),messages[_0x423861(0x212)]((_0x5b6cea,_0x1c501f)=>chatArea[_0x423861(0x211)](createMessageElement(_0x5b6cea,_0x1c501f)))):emptyState['style'][_0x423861(0x215)]=_0x423861(0x1ac),requestAnimationFrame(()=>chatArea[_0x423861(0x1cc)]=chatArea[_0x423861(0x1dc)]);}function autoResizeTextarea(){const _0xa458f0=a0_0x859430;messageInput[_0xa458f0(0x1b2)]['height']='auto',messageInput[_0xa458f0(0x1b2)][_0xa458f0(0x204)]=Math[_0xa458f0(0x1b5)](messageInput[_0xa458f0(0x1dc)],0x78)+'px';}function updateSendButton(){const _0x4251e0=a0_0x859430,_0x5ebc0e=messageInput[_0x4251e0(0x1f5)][_0x4251e0(0x1c6)]();sendBtn[_0x4251e0(0x218)]=!_0x5ebc0e||isTyping;}function a0_0x4279(_0x5ea1d5,_0x56f95d){_0x5ea1d5=_0x5ea1d5-0x1ac;const _0x2bd8d9=a0_0x7b82();let _0x2956db=_0x2bd8d9[_0x5ea1d5];return _0x2956db;}async function sendMessage(){const _0x1b49cc=a0_0x859430,_0x2e2344=messageInput[_0x1b49cc(0x1f5)]['trim']();if(!_0x2e2344||isTyping)return;if(tg?.[_0x1b49cc(0x1f0)])tg[_0x1b49cc(0x1f0)][_0x1b49cc(0x22a)]('light');messages[_0x1b49cc(0x1bd)]({'role':_0x1b49cc(0x1fb),'content':_0x2e2344,'timestamp':Date[_0x1b49cc(0x1e0)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x1b49cc(0x1dd)](messages)),renderMessages(),messageInput[_0x1b49cc(0x1f5)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1b49cc(0x211)](createTypingIndicator()),chatArea[_0x1b49cc(0x1cc)]=chatArea[_0x1b49cc(0x1dc)];const _0x36636e=await callBackend(_0x1b49cc(0x203),{'message':_0x2e2344});isTyping=![];const _0x54afcd=document[_0x1b49cc(0x226)](_0x1b49cc(0x225));if(_0x54afcd)_0x54afcd[_0x1b49cc(0x1ba)]();let _0xd7b9a0=_0x1b49cc(0x1d2);if(_0x36636e['success']){_0xd7b9a0=_0x36636e[_0x1b49cc(0x1f2)]||_0x1b49cc(0x214);if(tg?.[_0x1b49cc(0x1f0)])tg[_0x1b49cc(0x1f0)][_0x1b49cc(0x1bf)]('success');}else{_0xd7b9a0=_0x36636e[_0x1b49cc(0x217)]||_0x1b49cc(0x229);if(tg?.[_0x1b49cc(0x1f0)])tg[_0x1b49cc(0x1f0)][_0x1b49cc(0x1bf)](_0x1b49cc(0x217));}messages[_0x1b49cc(0x1bd)]({'role':'ai','content':_0xd7b9a0,'timestamp':Date[_0x1b49cc(0x1e0)]()}),localStorage[_0x1b49cc(0x200)](_0x1b49cc(0x219),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x4f2ab7){const _0x12674d=a0_0x859430;if(mTitle)mTitle[_0x12674d(0x1eb)]=_0x12674d(0x1af);if(mText)mText['textContent']=_0x12674d(0x1f3);modalCallback=()=>{const _0x4a88cc=_0x12674d;messages[_0x4a88cc(0x1c5)](_0x4f2ab7,0x1),localStorage[_0x4a88cc(0x200)]('ai_chat_messages',JSON[_0x4a88cc(0x1dd)](messages)),renderMessages();},modal[_0x12674d(0x1d4)][_0x12674d(0x205)](_0x12674d(0x1ee));}if(clearBtn)clearBtn[a0_0x859430(0x22f)]=()=>{const _0x481065=a0_0x859430;if(!messages[_0x481065(0x1fd)])return;if(mTitle)mTitle[_0x481065(0x1eb)]=_0x481065(0x1e9);if(mText)mText[_0x481065(0x1eb)]=_0x481065(0x233);modalCallback=async()=>{const _0x13ff28=_0x481065;messages=[],localStorage[_0x13ff28(0x210)](_0x13ff28(0x219)),renderMessages(),callBackend(_0x13ff28(0x1ea),{});},modal[_0x481065(0x1d4)][_0x481065(0x205)](_0x481065(0x1ee));};document[a0_0x859430(0x226)](a0_0x859430(0x20a))[a0_0x859430(0x22f)]=()=>modal[a0_0x859430(0x1d4)][a0_0x859430(0x1ba)](a0_0x859430(0x1ee)),document[a0_0x859430(0x226)](a0_0x859430(0x1d9))[a0_0x859430(0x22f)]=()=>{const _0x4e90db=a0_0x859430;if(modalCallback)modalCallback();modal[_0x4e90db(0x1d4)][_0x4e90db(0x1ba)](_0x4e90db(0x1ee));},messageInput[a0_0x859430(0x1b1)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x859430(0x1b4),_0x5b46a3=>{const _0x153f06=a0_0x859430;_0x5b46a3[_0x153f06(0x1b0)]===_0x153f06(0x1fa)&&!_0x5b46a3[_0x153f06(0x20f)]&&(_0x5b46a3[_0x153f06(0x232)](),sendMessage());}),sendBtn[a0_0x859430(0x22f)]=sendMessage,document['addEventListener'](a0_0x859430(0x1f9),_0xfd4f1f=>{const _0x2a5248=a0_0x859430;document['querySelectorAll'](_0x2a5248(0x202))[_0x2a5248(0x212)](_0x5ab4cf=>{const _0x23e88a=_0x2a5248;if(!_0x5ab4cf['contains'](_0xfd4f1f[_0x23e88a(0x1d3)]))_0x5ab4cf[_0x23e88a(0x1d4)]['remove']('show-delete');});});const saved=localStorage[a0_0x859430(0x1ef)](a0_0x859430(0x219));if(saved)try{messages=JSON[a0_0x859430(0x1ed)](saved),renderMessages();}catch(a0_0x8ba960){}updateSendButton();