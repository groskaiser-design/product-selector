const a0_0x45f217=a0_0x1872;(function(_0x795db4,_0x515cc9){const _0x35dc33=a0_0x1872,_0x1c5359=_0x795db4();while(!![]){try{const _0x429288=-parseInt(_0x35dc33(0xb3))/0x1+parseInt(_0x35dc33(0xdc))/0x2*(parseInt(_0x35dc33(0x92))/0x3)+-parseInt(_0x35dc33(0xae))/0x4+parseInt(_0x35dc33(0xd9))/0x5*(-parseInt(_0x35dc33(0x97))/0x6)+parseInt(_0x35dc33(0x90))/0x7+parseInt(_0x35dc33(0x79))/0x8+parseInt(_0x35dc33(0xc9))/0x9;if(_0x429288===_0x515cc9)break;else _0x1c5359['push'](_0x1c5359['shift']());}catch(_0x10936e){_0x1c5359['push'](_0x1c5359['shift']());}}}(a0_0x5e5b,0xb7550));const tg=window[a0_0x45f217(0xad)]?.[a0_0x45f217(0x82)],HOME_URL=a0_0x45f217(0xe1);function setupTelegramBackButton(){const _0x4665e4=a0_0x45f217,_0x458c2f=(function(){let _0x5596b6=!![];return function(_0x12a6b5,_0x36b8cb){const _0x4b4df6=_0x5596b6?function(){const _0x21a9cb=a0_0x1872;if(_0x36b8cb){const _0x56e690=_0x36b8cb[_0x21a9cb(0x7f)](_0x12a6b5,arguments);return _0x36b8cb=null,_0x56e690;}}:function(){};return _0x5596b6=![],_0x4b4df6;};}()),_0x5efb20=_0x458c2f(this,function(){const _0x91e82e=a0_0x1872;return _0x5efb20['toString']()['search']('(((.+)+)+)+$')[_0x91e82e(0xa7)]()[_0x91e82e(0xc1)](_0x5efb20)[_0x91e82e(0xa6)]('(((.+)+)+)+$');});_0x5efb20();if(!tg)return;try{tg[_0x4665e4(0xd5)](),tg['expand'](),tg[_0x4665e4(0x89)]?.('#050505');if(tg[_0x4665e4(0xc2)]?.(_0x4665e4(0x6a)))tg['disableVerticalSwipes']?.();const _0xedd343=tg[_0x4665e4(0x75)];if(_0xedd343){_0xedd343[_0x4665e4(0xb8)]();if(typeof _0xedd343[_0x4665e4(0xa2)]===_0x4665e4(0xd7))try{_0xedd343[_0x4665e4(0xa2)]();}catch(_0x284321){}_0xedd343[_0x4665e4(0x9e)](()=>{const _0x231b31=_0x4665e4;if(tg['HapticFeedback'])tg[_0x231b31(0xc0)][_0x231b31(0xc8)](_0x231b31(0xcb));location['href']=HOME_URL;});}}catch(_0x48470a){console[_0x4665e4(0x7b)]('TG\x20setup\x20error:',_0x48470a);}}(function initStableLayout(){const _0x128529=a0_0x45f217,_0x2f8b04=document[_0x128529(0x86)](_0x128529(0x91)),_0x3071c6=document[_0x128529(0x9d)]('inputArea'),_0x3eaeb8=document[_0x128529(0x9d)](_0x128529(0x67)),_0x44528c=document['getElementById'](_0x128529(0xda));function _0x59b7d2(){const _0x5850c8=_0x128529;if(!_0x2f8b04)return;const _0x3e3357=tg&&tg[_0x5850c8(0xde)]?tg[_0x5850c8(0xde)]:window[_0x5850c8(0x72)];_0x2f8b04['style']['height']=_0x3e3357+'px';if(_0x3071c6){const _0x3db410=_0x3071c6[_0x5850c8(0x6c)];_0x3eaeb8[_0x5850c8(0x8d)][_0x5850c8(0xe2)]=_0x3db410+0x28+'px';}}tg?tg['onEvent'](_0x128529(0x94),({isStateStable:_0x203d3c})=>{_0x59b7d2();if(_0x203d3c)requestAnimationFrame(()=>{const _0x5a9aab=a0_0x1872;_0x3eaeb8[_0x5a9aab(0xa3)]=_0x3eaeb8[_0x5a9aab(0xbc)];});}):window[_0x128529(0xc7)]('resize',_0x59b7d2),_0x59b7d2(),_0x44528c&&(_0x44528c['addEventListener'](_0x128529(0x85),()=>{requestAnimationFrame(_0x59b7d2);}),_0x44528c[_0x128529(0xc7)](_0x128529(0xcd),()=>{setTimeout(()=>{const _0x227ec9=a0_0x1872;_0x3eaeb8[_0x227ec9(0xa3)]=_0x3eaeb8['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x45f217(0x7e),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x45f217(0x9d)](a0_0x45f217(0x67)),emptyState=document[a0_0x45f217(0x9d)](a0_0x45f217(0xaf)),messageInput=document[a0_0x45f217(0x9d)]('messageInput'),sendBtn=document[a0_0x45f217(0x9d)](a0_0x45f217(0xbd)),clearBtn=document[a0_0x45f217(0x9d)](a0_0x45f217(0x81)),modal=document[a0_0x45f217(0x9d)](a0_0x45f217(0xb5)),mTitle=document[a0_0x45f217(0x9d)](a0_0x45f217(0xb0)),mText=document[a0_0x45f217(0x9d)](a0_0x45f217(0x80));function a0_0x1872(_0x3560ae,_0x4d61c4){_0x3560ae=_0x3560ae-0x67;const _0x462b98=a0_0x5e5b();let _0x489031=_0x462b98[_0x3560ae];return _0x489031;}let modalCallback=null;async function callBackend(_0x5a0e74,_0x54f638){const _0x3be9ad=a0_0x45f217,_0x4bae60=tg?.['initDataUnsafe']?.[_0x3be9ad(0x9f)]||{},_0x2e5b97=_0x4bae60['id']||localStorage[_0x3be9ad(0x84)](_0x3be9ad(0xb2))||'d-'+Math[_0x3be9ad(0xbb)](Math[_0x3be9ad(0x9b)]()*0x3b9aca00);if(!_0x4bae60['id'])localStorage['setItem']('debug_uid',_0x2e5b97);const _0x50d537={'action':_0x5a0e74,'user_id':_0x2e5b97,'user_data':{'first_name':_0x4bae60[_0x3be9ad(0x78)],'username':_0x4bae60[_0x3be9ad(0xe0)]},'init_data':tg?.['initData']||'',..._0x54f638},_0xf3b124=new AbortController(),_0x5d1439=setTimeout(()=>_0xf3b124[_0x3be9ad(0xd4)](),REQUEST_TIMEOUT_MS);try{const _0x276499=await fetch(BACKEND_URL,{'method':_0x3be9ad(0xc5),'headers':{'Content-Type':_0x3be9ad(0x74)},'body':JSON['stringify'](_0x50d537),'signal':_0xf3b124['signal']});return clearTimeout(_0x5d1439),await _0x276499[_0x3be9ad(0x8e)]();}catch(_0x22d7d3){return{'success':![],'error':String(_0x22d7d3)};}}function formatTime(_0x49f9cb){const _0x5b82bd=a0_0x45f217,_0x4887de=new Date(_0x49f9cb);return String(_0x4887de['getHours']())['padStart'](0x2,'0')+':'+String(_0x4887de[_0x5b82bd(0xa1)]())[_0x5b82bd(0xa0)](0x2,'0');}function createMessageElement(_0x5c96e4,_0x445f8e){const _0x49f838=a0_0x45f217,_0x5aa348=document[_0x49f838(0xaa)](_0x49f838(0xd1));_0x5aa348[_0x49f838(0xb9)]=_0x49f838(0xab)+_0x5c96e4['role'];const _0x1b869f=document[_0x49f838(0xaa)](_0x49f838(0xd1));_0x1b869f[_0x49f838(0xb9)]=_0x49f838(0x88),_0x1b869f['innerHTML']=_0x5c96e4[_0x49f838(0x6d)][_0x49f838(0x6e)](/\n/g,_0x49f838(0xd6));const _0x53ba44=document[_0x49f838(0xaa)](_0x49f838(0xd1));_0x53ba44[_0x49f838(0xb9)]=_0x49f838(0x6b),_0x53ba44['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x53ba44[_0x49f838(0x8f)]=_0x2e71f4=>{const _0x2fac86=_0x49f838;_0x2e71f4[_0x2fac86(0x70)](),confirmDelete(_0x445f8e);};let _0x112803;_0x1b869f[_0x49f838(0xc7)]('touchstart',()=>_0x112803=setTimeout(()=>{const _0x524a9c=_0x49f838;_0x5aa348[_0x524a9c(0xba)][_0x524a9c(0xb1)](_0x524a9c(0x83));if(tg?.['HapticFeedback'])tg[_0x524a9c(0xc0)][_0x524a9c(0xc8)]('medium');},0x1f4)),_0x1b869f['addEventListener'](_0x49f838(0x7a),()=>clearTimeout(_0x112803));const _0x262fb4=document[_0x49f838(0xaa)](_0x49f838(0xd1));return _0x262fb4[_0x49f838(0xb9)]=_0x49f838(0x96),_0x262fb4['textContent']=formatTime(_0x5c96e4['timestamp']),_0x5aa348[_0x49f838(0x9a)](_0x53ba44),_0x5aa348[_0x49f838(0x9a)](_0x1b869f),_0x5aa348[_0x49f838(0x9a)](_0x262fb4),_0x5aa348;}function createTypingIndicator(){const _0x2d32d6=a0_0x45f217,_0x4224dc=document[_0x2d32d6(0xaa)](_0x2d32d6(0xd1));return _0x4224dc[_0x2d32d6(0xb9)]=_0x2d32d6(0xd2),_0x4224dc['id']='typingIndicator',_0x4224dc['innerHTML']=_0x2d32d6(0x73),_0x4224dc;}function renderMessages(){const _0x259e5e=a0_0x45f217;Array[_0x259e5e(0x99)](chatArea['children'])['forEach'](_0x1cb81b=>{const _0x2cf211=_0x259e5e;if(_0x1cb81b['id']!==_0x2cf211(0xaf))_0x1cb81b[_0x2cf211(0x8a)]();}),messages[_0x259e5e(0x77)]>0x0?(emptyState['style'][_0x259e5e(0xbe)]=_0x259e5e(0xc3),messages[_0x259e5e(0xdd)]((_0x4a6d46,_0x579d91)=>chatArea[_0x259e5e(0x9a)](createMessageElement(_0x4a6d46,_0x579d91)))):emptyState[_0x259e5e(0x8d)][_0x259e5e(0xbe)]=_0x259e5e(0xca),requestAnimationFrame(()=>chatArea[_0x259e5e(0xa3)]=chatArea[_0x259e5e(0xbc)]);}function autoResizeTextarea(){const _0x3096b2=a0_0x45f217;messageInput[_0x3096b2(0x8d)][_0x3096b2(0xd0)]=_0x3096b2(0xac),messageInput[_0x3096b2(0x8d)][_0x3096b2(0xd0)]=Math[_0x3096b2(0xbf)](messageInput[_0x3096b2(0xbc)],0x78)+'px';}function updateSendButton(){const _0x4ee9b9=a0_0x45f217,_0x211819=messageInput[_0x4ee9b9(0xd3)][_0x4ee9b9(0xb7)]();sendBtn['disabled']=!_0x211819||isTyping;}async function sendMessage(){const _0xba5ffa=a0_0x45f217,_0x22211b=messageInput['value'][_0xba5ffa(0xb7)]();if(!_0x22211b||isTyping)return;if(tg?.['HapticFeedback'])tg[_0xba5ffa(0xc0)][_0xba5ffa(0xc8)]('light');messages[_0xba5ffa(0xdf)]({'role':_0xba5ffa(0x9f),'content':_0x22211b,'timestamp':Date['now']()}),localStorage['setItem'](_0xba5ffa(0xa4),JSON[_0xba5ffa(0x98)](messages)),renderMessages(),messageInput[_0xba5ffa(0xd3)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xba5ffa(0x9a)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0xba5ffa(0xbc)];const _0x301c1e=await callBackend(_0xba5ffa(0x8b),{'message':_0x22211b});isTyping=![];const _0x471777=document[_0xba5ffa(0x9d)](_0xba5ffa(0x93));if(_0x471777)_0x471777[_0xba5ffa(0x8a)]();let _0x4d434c=_0xba5ffa(0xcc);if(_0x301c1e[_0xba5ffa(0x95)]){_0x4d434c=_0x301c1e['text']||_0xba5ffa(0x68);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0xba5ffa(0xb6)]('success');}else{_0x4d434c=_0x301c1e[_0xba5ffa(0xc6)]||'Ошибка\x20сервера';if(tg?.[_0xba5ffa(0xc0)])tg[_0xba5ffa(0xc0)][_0xba5ffa(0xb6)](_0xba5ffa(0xc6));}messages[_0xba5ffa(0xdf)]({'role':'ai','content':_0x4d434c,'timestamp':Date[_0xba5ffa(0xd8)]()}),localStorage[_0xba5ffa(0x7c)]('ai_chat_messages',JSON[_0xba5ffa(0x98)](messages)),renderMessages();}function confirmDelete(_0x2c8131){const _0x414aac=a0_0x45f217;if(mTitle)mTitle[_0x414aac(0x8c)]=_0x414aac(0xa9);if(mText)mText[_0x414aac(0x8c)]='Действие\x20необратимо.';modalCallback=()=>{const _0x548005=_0x414aac;messages['splice'](_0x2c8131,0x1),localStorage['setItem'](_0x548005(0xa4),JSON[_0x548005(0x98)](messages)),renderMessages();},modal[_0x414aac(0xba)][_0x414aac(0xb1)](_0x414aac(0xb8));}if(clearBtn)clearBtn[a0_0x45f217(0x8f)]=()=>{const _0x48695c=a0_0x45f217;if(!messages[_0x48695c(0x77)])return;if(mTitle)mTitle[_0x48695c(0x8c)]=_0x48695c(0x7d);if(mText)mText[_0x48695c(0x8c)]=_0x48695c(0xb4);modalCallback=async()=>{const _0x45b6af=_0x48695c;messages=[],localStorage[_0x45b6af(0xce)](_0x45b6af(0xa4)),renderMessages(),callBackend(_0x45b6af(0xc4),{});},modal[_0x48695c(0xba)][_0x48695c(0xb1)](_0x48695c(0xb8));};document[a0_0x45f217(0x9d)](a0_0x45f217(0xdb))['onclick']=()=>modal[a0_0x45f217(0xba)][a0_0x45f217(0x8a)]('show'),document[a0_0x45f217(0x9d)](a0_0x45f217(0x87))[a0_0x45f217(0x8f)]=()=>{const _0x25389d=a0_0x45f217;if(modalCallback)modalCallback();modal[_0x25389d(0xba)][_0x25389d(0x8a)](_0x25389d(0xb8));},messageInput['addEventListener'](a0_0x45f217(0x85),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x45f217(0xc7)](a0_0x45f217(0xa8),_0xcbfe79=>{const _0x354850=a0_0x45f217;_0xcbfe79[_0x354850(0x71)]==='Enter'&&!_0xcbfe79[_0x354850(0xa5)]&&(_0xcbfe79['preventDefault'](),sendMessage());}),sendBtn[a0_0x45f217(0x8f)]=sendMessage,document[a0_0x45f217(0xc7)](a0_0x45f217(0xcf),_0x3fd76e=>{const _0x3a50d8=a0_0x45f217;document[_0x3a50d8(0x9c)]('.message.show-delete')[_0x3a50d8(0xdd)](_0x57439d=>{const _0x246851=_0x3a50d8;if(!_0x57439d[_0x246851(0x6f)](_0x3fd76e[_0x246851(0x76)]))_0x57439d[_0x246851(0xba)][_0x246851(0x8a)](_0x246851(0x83));});});const saved=localStorage[a0_0x45f217(0x84)](a0_0x45f217(0xa4));if(saved)try{messages=JSON[a0_0x45f217(0x69)](saved),renderMessages();}catch(a0_0xb8e285){}updateSendButton();function a0_0x5e5b(){const _0x1c8ed5=['user','padStart','getMinutes','offClick','scrollTop','ai_chat_messages','shiftKey','search','toString','keydown','Удалить?','createElement','message\x20','auto','Telegram','5223612gmBEmn','emptyState','modalTitle','add','debug_uid','503352tqlWtZ','Начнется\x20новый\x20диалог.','confirmModal','notificationOccurred','trim','show','className','classList','floor','scrollHeight','sendBtn','display','min','HapticFeedback','constructor','isVersionAtLeast','none','clear_history','POST','error','addEventListener','impactOccurred','2555919KYbsyH','flex','light','Ошибка\x20сети','focus','removeItem','click','height','div','message\x20ai','value','abort','ready','<br>','function','now','1202295fTbhEQ','messageInput','modalCancel','449362XDMJMO','forEach','viewportHeight','push','username','./router.html','paddingBottom','chatArea','Пустой\x20ответ','parse','6.1','delete-btn','offsetHeight','content','replace','contains','stopPropagation','key','innerHeight','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','text/plain','BackButton','target','length','first_name','11860728NgsylJ','touchend','warn','setItem','Очистить\x20историю?','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','apply','modalText','clearBtn','WebApp','show-delete','getItem','input','querySelector','modalConfirm','message-bubble','setHeaderColor','remove','send_message','textContent','style','json','onclick','5665653xtkCdf','.container','3ZojtkT','typingIndicator','viewportChanged','success','message-time','6nfwLqZ','stringify','from','appendChild','random','querySelectorAll','getElementById','onClick'];a0_0x5e5b=function(){return _0x1c8ed5;};return a0_0x5e5b();}