const a0_0x126b65=a0_0xd0f7;(function(_0x8d3c5c,_0x5c1b99){const _0x18732e=a0_0xd0f7,_0x58a8c1=_0x8d3c5c();while(!![]){try{const _0x2483be=parseInt(_0x18732e(0x116))/0x1+parseInt(_0x18732e(0x14a))/0x2*(-parseInt(_0x18732e(0x15b))/0x3)+-parseInt(_0x18732e(0x158))/0x4+-parseInt(_0x18732e(0x12d))/0x5+parseInt(_0x18732e(0x117))/0x6*(-parseInt(_0x18732e(0x12a))/0x7)+parseInt(_0x18732e(0xf2))/0x8+parseInt(_0x18732e(0x129))/0x9;if(_0x2483be===_0x5c1b99)break;else _0x58a8c1['push'](_0x58a8c1['shift']());}catch(_0x54b0ea){_0x58a8c1['push'](_0x58a8c1['shift']());}}}(a0_0x1a11,0x43474));const tg=window[a0_0x126b65(0x14d)]?.['WebApp'],HOME_URL=a0_0x126b65(0x100);function setupTelegramBackButton(){const _0x366a83=a0_0x126b65,_0x2b3dca=(function(){let _0xa36bd5=!![];return function(_0x5b3f83,_0x2c5585){const _0x22fff0=_0xa36bd5?function(){const _0x26e430=a0_0xd0f7;if(_0x2c5585){const _0x548fd2=_0x2c5585[_0x26e430(0x141)](_0x5b3f83,arguments);return _0x2c5585=null,_0x548fd2;}}:function(){};return _0xa36bd5=![],_0x22fff0;};}()),_0xf143b5=_0x2b3dca(this,function(){const _0x1821f7=a0_0xd0f7;return _0xf143b5['toString']()[_0x1821f7(0xf3)](_0x1821f7(0xe9))[_0x1821f7(0x11f)]()['constructor'](_0xf143b5)[_0x1821f7(0xf3)](_0x1821f7(0xe9));});_0xf143b5();if(!tg)return;try{tg['ready'](),tg['expand'](),tg['setHeaderColor']?.('#050505');if(tg['isVersionAtLeast']?.(_0x366a83(0x110)))tg[_0x366a83(0x142)]?.();const _0x30c326=tg[_0x366a83(0x12c)];if(_0x30c326){_0x30c326[_0x366a83(0xf0)]();if(typeof _0x30c326[_0x366a83(0xff)]==='function')try{_0x30c326['offClick']();}catch(_0x50de14){}_0x30c326[_0x366a83(0xe7)](()=>{const _0x10b9b8=_0x366a83;if(tg[_0x10b9b8(0x157)])tg[_0x10b9b8(0x157)][_0x10b9b8(0x12e)]('light');location[_0x10b9b8(0x148)]=HOME_URL;});}}catch(_0x137054){console['warn'](_0x366a83(0x108),_0x137054);}}(function initStableLayout(){const _0x54f72e=a0_0x126b65,_0x402633=document[_0x54f72e(0x13b)](_0x54f72e(0xfa)),_0x50229a=document['getElementById'](_0x54f72e(0xfc)),_0x3b8950=document[_0x54f72e(0x131)](_0x54f72e(0xea)),_0x57c74c=document['getElementById'](_0x54f72e(0xe8));function _0x32e078(){const _0x5bfaea=_0x54f72e;if(!_0x402633)return;const _0x5a3bea=tg&&tg[_0x5bfaea(0xee)]?tg['viewportHeight']:window[_0x5bfaea(0x114)];_0x402633[_0x5bfaea(0x120)][_0x5bfaea(0x134)]=_0x5a3bea+'px';if(_0x50229a){const _0x3c59dc=_0x50229a[_0x5bfaea(0x14f)];_0x3b8950[_0x5bfaea(0x120)][_0x5bfaea(0x130)]=_0x3c59dc+0x28+'px';}}tg?tg[_0x54f72e(0x139)](_0x54f72e(0x140),({isStateStable:_0x430fb5})=>{_0x32e078();if(_0x430fb5)requestAnimationFrame(()=>{const _0x47988f=a0_0xd0f7;_0x3b8950['scrollTop']=_0x3b8950[_0x47988f(0x10a)];});}):window[_0x54f72e(0xfd)](_0x54f72e(0x105),_0x32e078),_0x32e078(),_0x57c74c&&(_0x57c74c['addEventListener'](_0x54f72e(0xf8),()=>{requestAnimationFrame(_0x32e078);}),_0x57c74c[_0x54f72e(0xfd)](_0x54f72e(0x135),()=>{setTimeout(()=>{const _0x1e8d9b=a0_0xd0f7;_0x3b8950['scrollTop']=_0x3b8950[_0x1e8d9b(0x10a)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x126b65(0x138),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x126b65(0x131)](a0_0x126b65(0xea)),emptyState=document[a0_0x126b65(0x131)](a0_0x126b65(0x101)),messageInput=document[a0_0x126b65(0x131)](a0_0x126b65(0xe8)),sendBtn=document[a0_0x126b65(0x131)]('sendBtn'),clearBtn=document[a0_0x126b65(0x131)](a0_0x126b65(0x115)),modal=document['getElementById']('confirmModal'),mTitle=document['getElementById'](a0_0x126b65(0x113)),mText=document['getElementById'](a0_0x126b65(0x144));let modalCallback=null;async function callBackend(_0x4ffd9a,_0x19fe50){const _0x1480df=a0_0x126b65,_0x303606=tg?.[_0x1480df(0xec)]?.[_0x1480df(0x118)]||{},_0x2106ed=_0x303606['id']||localStorage[_0x1480df(0x121)](_0x1480df(0x154))||'d-'+Math[_0x1480df(0x15d)](Math[_0x1480df(0x109)]()*0x3b9aca00);if(!_0x303606['id'])localStorage['setItem'](_0x1480df(0x154),_0x2106ed);const _0x43f836={'action':_0x4ffd9a,'user_id':_0x2106ed,'user_data':{'first_name':_0x303606[_0x1480df(0x12f)],'username':_0x303606['username']},'init_data':tg?.['initData']||'',..._0x19fe50},_0x47f471=new AbortController(),_0x21e774=setTimeout(()=>_0x47f471['abort'](),REQUEST_TIMEOUT_MS);try{const _0x1d488e=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x1480df(0x13a)},'body':JSON['stringify'](_0x43f836),'signal':_0x47f471[_0x1480df(0x145)]});return clearTimeout(_0x21e774),await _0x1d488e[_0x1480df(0x155)]();}catch(_0x3866ed){return{'success':![],'error':String(_0x3866ed)};}}function formatTime(_0x1d6c35){const _0x492f3c=a0_0x126b65,_0x3da34f=new Date(_0x1d6c35);return String(_0x3da34f[_0x492f3c(0x149)]())[_0x492f3c(0x119)](0x2,'0')+':'+String(_0x3da34f['getMinutes']())[_0x492f3c(0x119)](0x2,'0');}function createMessageElement(_0x556390,_0x5eecd2){const _0x23fb41=a0_0x126b65,_0x38a59b=document['createElement'](_0x23fb41(0x10b));_0x38a59b[_0x23fb41(0x126)]='message\x20'+_0x556390[_0x23fb41(0x11d)];const _0x6149ae=document[_0x23fb41(0x10e)](_0x23fb41(0x10b));_0x6149ae[_0x23fb41(0x126)]='message-bubble',_0x6149ae['innerHTML']=_0x556390['content'][_0x23fb41(0x123)](/\n/g,_0x23fb41(0xef));const _0x6fed79=document[_0x23fb41(0x10e)](_0x23fb41(0x10b));_0x6fed79[_0x23fb41(0x126)]=_0x23fb41(0x122),_0x6fed79['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x6fed79[_0x23fb41(0xf5)]=_0x2d84ba=>{_0x2d84ba['stopPropagation'](),confirmDelete(_0x5eecd2);};let _0x2ecbe6;_0x6149ae[_0x23fb41(0xfd)]('touchstart',()=>_0x2ecbe6=setTimeout(()=>{const _0x128f83=_0x23fb41;_0x38a59b[_0x128f83(0x137)][_0x128f83(0x13e)]('show-delete');if(tg?.[_0x128f83(0x157)])tg[_0x128f83(0x157)][_0x128f83(0x12e)](_0x128f83(0xf6));},0x1f4)),_0x6149ae[_0x23fb41(0xfd)]('touchend',()=>clearTimeout(_0x2ecbe6));const _0x36e3f7=document[_0x23fb41(0x10e)](_0x23fb41(0x10b));return _0x36e3f7['className']=_0x23fb41(0xfb),_0x36e3f7[_0x23fb41(0x14b)]=formatTime(_0x556390[_0x23fb41(0x103)]),_0x38a59b['appendChild'](_0x6fed79),_0x38a59b['appendChild'](_0x6149ae),_0x38a59b[_0x23fb41(0x15e)](_0x36e3f7),_0x38a59b;}function createTypingIndicator(){const _0x71bec=a0_0x126b65,_0x4a9a59=document[_0x71bec(0x10e)](_0x71bec(0x10b));return _0x4a9a59[_0x71bec(0x126)]=_0x71bec(0x136),_0x4a9a59['id']='typingIndicator',_0x4a9a59[_0x71bec(0x11c)]=_0x71bec(0x150),_0x4a9a59;}function renderMessages(){const _0x52e306=a0_0x126b65;Array[_0x52e306(0x106)](chatArea[_0x52e306(0xf7)])[_0x52e306(0xf4)](_0x9b8999=>{const _0x226b48=_0x52e306;if(_0x9b8999['id']!==_0x226b48(0x101))_0x9b8999[_0x226b48(0x13c)]();}),messages['length']>0x0?(emptyState[_0x52e306(0x120)][_0x52e306(0x132)]=_0x52e306(0x107),messages['forEach']((_0x563862,_0x357992)=>chatArea[_0x52e306(0x15e)](createMessageElement(_0x563862,_0x357992)))):emptyState['style']['display']=_0x52e306(0x10d),requestAnimationFrame(()=>chatArea[_0x52e306(0x151)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x336a39=a0_0x126b65;messageInput[_0x336a39(0x120)][_0x336a39(0x134)]=_0x336a39(0xed),messageInput['style'][_0x336a39(0x134)]=Math[_0x336a39(0x15c)](messageInput[_0x336a39(0x10a)],0x78)+'px';}function a0_0xd0f7(_0x460907,_0x3489ab){_0x460907=_0x460907-0xe5;const _0x3b628e=a0_0x1a11();let _0x413436=_0x3b628e[_0x460907];return _0x413436;}function updateSendButton(){const _0x51082b=a0_0x126b65,_0x55833f=messageInput[_0x51082b(0x14c)][_0x51082b(0x13d)]();sendBtn[_0x51082b(0x125)]=!_0x55833f||isTyping;}async function sendMessage(){const _0x510079=a0_0x126b65,_0x4f4c81=messageInput[_0x510079(0x14c)][_0x510079(0x13d)]();if(!_0x4f4c81||isTyping)return;if(tg?.[_0x510079(0x157)])tg['HapticFeedback']['impactOccurred'](_0x510079(0x111));messages[_0x510079(0x10f)]({'role':'user','content':_0x4f4c81,'timestamp':Date[_0x510079(0x143)]()}),localStorage[_0x510079(0x124)]('ai_chat_messages',JSON[_0x510079(0x133)](messages)),renderMessages(),messageInput[_0x510079(0x14c)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x510079(0x15e)](createTypingIndicator()),chatArea[_0x510079(0x151)]=chatArea[_0x510079(0x10a)];const _0x406d3c=await callBackend(_0x510079(0x152),{'message':_0x4f4c81});isTyping=![];const _0x1ce0b0=document['getElementById'](_0x510079(0x159));if(_0x1ce0b0)_0x1ce0b0[_0x510079(0x13c)]();let _0x15a332=_0x510079(0xfe);if(_0x406d3c[_0x510079(0xf1)]){_0x15a332=_0x406d3c[_0x510079(0x104)]||_0x510079(0x11b);if(tg?.[_0x510079(0x157)])tg[_0x510079(0x157)][_0x510079(0xe6)](_0x510079(0xf1));}else{_0x15a332=_0x406d3c[_0x510079(0x147)]||_0x510079(0x10c);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x510079(0xe6)]('error');}messages[_0x510079(0x10f)]({'role':'ai','content':_0x15a332,'timestamp':Date[_0x510079(0x143)]()}),localStorage['setItem'](_0x510079(0x12b),JSON[_0x510079(0x133)](messages)),renderMessages();}function confirmDelete(_0x24e60a){const _0x178a13=a0_0x126b65;if(mTitle)mTitle[_0x178a13(0x14b)]=_0x178a13(0x14e);if(mText)mText[_0x178a13(0x14b)]=_0x178a13(0x102);modalCallback=()=>{const _0x1dabe1=_0x178a13;messages[_0x1dabe1(0x11a)](_0x24e60a,0x1),localStorage['setItem'](_0x1dabe1(0x12b),JSON['stringify'](messages)),renderMessages();},modal[_0x178a13(0x137)][_0x178a13(0x13e)](_0x178a13(0xf0));}if(clearBtn)clearBtn[a0_0x126b65(0xf5)]=()=>{const _0x170e3e=a0_0x126b65;if(!messages[_0x170e3e(0x153)])return;if(mTitle)mTitle[_0x170e3e(0x14b)]='Очистить\x20историю?';if(mText)mText[_0x170e3e(0x14b)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x3aaba4=_0x170e3e;messages=[],localStorage[_0x3aaba4(0x13f)](_0x3aaba4(0x12b)),renderMessages(),callBackend(_0x3aaba4(0x128),{});},modal['classList'][_0x170e3e(0x13e)](_0x170e3e(0xf0));};function a0_0x1a11(){const _0x7381c6=['offsetHeight','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','scrollTop','send_message','length','debug_uid','json','Enter','HapticFeedback','986844JgolGX','typingIndicator','parse','9JczJfH','min','floor','appendChild','contains','notificationOccurred','onClick','messageInput','(((.+)+)+)+$','chatArea','show-delete','initDataUnsafe','auto','viewportHeight','<br>','show','success','1316960wvnYQh','search','forEach','onclick','medium','children','input','shiftKey','.container','message-time','inputArea','addEventListener','Ошибка\x20сети','offClick','./router.html','emptyState','Действие\x20необратимо.','timestamp','text','resize','from','none','TG\x20setup\x20error:','random','scrollHeight','div','Ошибка\x20сервера','flex','createElement','push','6.1','light','modalCancel','modalTitle','innerHeight','clearBtn','300914AEneBV','1307994siiPJc','user','padStart','splice','Пустой\x20ответ','innerHTML','role','target','toString','style','getItem','delete-btn','replace','setItem','disabled','className','modalConfirm','clear_history','8349048eyShsj','14lhdnIj','ai_chat_messages','BackButton','206310jPckdw','impactOccurred','first_name','paddingBottom','getElementById','display','stringify','height','focus','message\x20ai','classList','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','onEvent','text/plain','querySelector','remove','trim','add','removeItem','viewportChanged','apply','disableVerticalSwipes','now','modalText','signal','preventDefault','error','href','getHours','262442hSbhcg','textContent','value','Telegram','Удалить?'];a0_0x1a11=function(){return _0x7381c6;};return a0_0x1a11();}document[a0_0x126b65(0x131)](a0_0x126b65(0x112))[a0_0x126b65(0xf5)]=()=>modal[a0_0x126b65(0x137)][a0_0x126b65(0x13c)](a0_0x126b65(0xf0)),document['getElementById'](a0_0x126b65(0x127))[a0_0x126b65(0xf5)]=()=>{const _0x23b487=a0_0x126b65;if(modalCallback)modalCallback();modal[_0x23b487(0x137)][_0x23b487(0x13c)]('show');},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x126b65(0xfd)]('keydown',_0x2b3d3c=>{const _0x1635d7=a0_0x126b65;_0x2b3d3c['key']===_0x1635d7(0x156)&&!_0x2b3d3c[_0x1635d7(0xf9)]&&(_0x2b3d3c[_0x1635d7(0x146)](),sendMessage());}),sendBtn[a0_0x126b65(0xf5)]=sendMessage,document['addEventListener']('click',_0x2bc5a8=>{const _0x4ce6da=a0_0x126b65;document['querySelectorAll']('.message.show-delete')[_0x4ce6da(0xf4)](_0x46176a=>{const _0x4d34ae=_0x4ce6da;if(!_0x46176a[_0x4d34ae(0xe5)](_0x2bc5a8[_0x4d34ae(0x11e)]))_0x46176a[_0x4d34ae(0x137)][_0x4d34ae(0x13c)](_0x4d34ae(0xeb));});});const saved=localStorage['getItem'](a0_0x126b65(0x12b));if(saved)try{messages=JSON[a0_0x126b65(0x15a)](saved),renderMessages();}catch(a0_0x99d219){}updateSendButton();