const a0_0x2c18ad=a0_0xf0a0;function a0_0xf0a0(_0x53938a,_0x282125){_0x53938a=_0x53938a-0x115;const _0x2a7cf1=a0_0x5204();let _0x1c523a=_0x2a7cf1[_0x53938a];return _0x1c523a;}(function(_0x359485,_0x14bce9){const _0x43db80=a0_0xf0a0,_0x4a0e4b=_0x359485();while(!![]){try{const _0x1851b9=parseInt(_0x43db80(0x14c))/0x1*(-parseInt(_0x43db80(0x182))/0x2)+-parseInt(_0x43db80(0x13a))/0x3*(parseInt(_0x43db80(0x185))/0x4)+-parseInt(_0x43db80(0x124))/0x5*(parseInt(_0x43db80(0x186))/0x6)+parseInt(_0x43db80(0x17d))/0x7+parseInt(_0x43db80(0x165))/0x8+-parseInt(_0x43db80(0x139))/0x9*(parseInt(_0x43db80(0x13b))/0xa)+parseInt(_0x43db80(0x15b))/0xb;if(_0x1851b9===_0x14bce9)break;else _0x4a0e4b['push'](_0x4a0e4b['shift']());}catch(_0x18b5dc){_0x4a0e4b['push'](_0x4a0e4b['shift']());}}}(a0_0x5204,0xb1810));const tg=window['Telegram']?.[a0_0x2c18ad(0x142)],HOME_URL=a0_0x2c18ad(0x179);function setupTelegramBackButton(){const _0x19d42d=a0_0x2c18ad;if(!tg)return;try{tg[_0x19d42d(0x15f)](),tg[_0x19d42d(0x183)](),tg[_0x19d42d(0x161)]?.(_0x19d42d(0x122));if(tg['isVersionAtLeast']?.(_0x19d42d(0x12f)))tg[_0x19d42d(0x153)]?.();const _0x403ea3=tg['BackButton'];if(_0x403ea3){_0x403ea3[_0x19d42d(0x123)]();if(typeof _0x403ea3[_0x19d42d(0x141)]===_0x19d42d(0x164))try{_0x403ea3[_0x19d42d(0x141)]();}catch(_0x4f2b0c){}_0x403ea3[_0x19d42d(0x169)](()=>{const _0x3ac8fe=_0x19d42d;if(tg['HapticFeedback'])tg[_0x3ac8fe(0x17a)][_0x3ac8fe(0x167)](_0x3ac8fe(0x181));location[_0x3ac8fe(0x15d)]=HOME_URL;});}}catch(_0x2d569c){console['warn'](_0x19d42d(0x148),_0x2d569c);}}(function initStableLayout(){const _0xcf4a2a=a0_0x2c18ad,_0x12e083=(function(){let _0x404d03=!![];return function(_0x29681e,_0x1c8a95){const _0x54faaa=_0x404d03?function(){const _0x3fc539=a0_0xf0a0;if(_0x1c8a95){const _0x12224a=_0x1c8a95[_0x3fc539(0x194)](_0x29681e,arguments);return _0x1c8a95=null,_0x12224a;}}:function(){};return _0x404d03=![],_0x54faaa;};}()),_0x3d6ad0=document[_0xcf4a2a(0x145)](_0xcf4a2a(0x193)),_0x4440e4=document['getElementById'](_0xcf4a2a(0x131)),_0x1062e0=document[_0xcf4a2a(0x155)](_0xcf4a2a(0x157)),_0x514a2c=document[_0xcf4a2a(0x155)]('messageInput');function _0x585568(){const _0x229fff=_0xcf4a2a,_0x48ab1e=_0x12e083(this,function(){const _0xc5c2fa=a0_0xf0a0;return _0x48ab1e[_0xc5c2fa(0x11a)]()['search']('(((.+)+)+)+$')[_0xc5c2fa(0x11a)]()[_0xc5c2fa(0x17c)](_0x48ab1e)[_0xc5c2fa(0x130)](_0xc5c2fa(0x18a));});_0x48ab1e();if(!_0x3d6ad0)return;const _0x5bdb2b=tg&&tg[_0x229fff(0x16d)]?tg[_0x229fff(0x16d)]:window[_0x229fff(0x12c)];_0x3d6ad0[_0x229fff(0x17f)][_0x229fff(0x126)]=_0x5bdb2b+'px';if(_0x4440e4){const _0xc6b6bf=_0x4440e4[_0x229fff(0x18e)];_0x1062e0[_0x229fff(0x17f)][_0x229fff(0x127)]=_0xc6b6bf+0x28+'px';}}tg?tg['onEvent'](_0xcf4a2a(0x150),({isStateStable:_0x3d5185})=>{_0x585568();if(_0x3d5185)requestAnimationFrame(()=>{const _0xf9f654=a0_0xf0a0;_0x1062e0[_0xf9f654(0x115)]=_0x1062e0[_0xf9f654(0x192)];});}):window[_0xcf4a2a(0x143)](_0xcf4a2a(0x14a),_0x585568),_0x585568(),_0x514a2c&&(_0x514a2c[_0xcf4a2a(0x143)](_0xcf4a2a(0x191),()=>{requestAnimationFrame(_0x585568);}),_0x514a2c[_0xcf4a2a(0x143)](_0xcf4a2a(0x18f),()=>{setTimeout(()=>{const _0x592286=a0_0xf0a0;_0x1062e0[_0x592286(0x115)]=_0x1062e0['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2c18ad(0x190),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x2c18ad(0x157)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x2c18ad(0x155)](a0_0x2c18ad(0x11e)),sendBtn=document[a0_0x2c18ad(0x155)]('sendBtn'),clearBtn=document[a0_0x2c18ad(0x155)]('clearBtn'),modal=document[a0_0x2c18ad(0x155)](a0_0x2c18ad(0x13f)),mTitle=document[a0_0x2c18ad(0x155)](a0_0x2c18ad(0x189)),mText=document[a0_0x2c18ad(0x155)](a0_0x2c18ad(0x160));let modalCallback=null;async function callBackend(_0x5a78e7,_0x4d3e04){const _0x37397d=a0_0x2c18ad,_0x28ff4e=tg?.['initDataUnsafe']?.[_0x37397d(0x16f)]||{},_0x50314c=_0x28ff4e['id']||localStorage[_0x37397d(0x116)](_0x37397d(0x12a))||'d-'+Math['floor'](Math[_0x37397d(0x132)]()*0x3b9aca00);if(!_0x28ff4e['id'])localStorage[_0x37397d(0x12d)](_0x37397d(0x12a),_0x50314c);const _0x12c885={'action':_0x5a78e7,'user_id':_0x50314c,'user_data':{'first_name':_0x28ff4e[_0x37397d(0x15c)],'username':_0x28ff4e[_0x37397d(0x171)]},'init_data':tg?.[_0x37397d(0x172)]||'',..._0x4d3e04},_0x5cce35=new AbortController(),_0x37c137=setTimeout(()=>_0x5cce35['abort'](),REQUEST_TIMEOUT_MS);try{const _0x92a8af=await fetch(BACKEND_URL,{'method':_0x37397d(0x16a),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x37397d(0x176)](_0x12c885),'signal':_0x5cce35[_0x37397d(0x18c)]});return clearTimeout(_0x37c137),await _0x92a8af['json']();}catch(_0x2937a0){return{'success':![],'error':String(_0x2937a0)};}}function formatTime(_0x3a39ee){const _0x3e8588=a0_0x2c18ad,_0x41d8e4=new Date(_0x3a39ee);return String(_0x41d8e4[_0x3e8588(0x177)]())['padStart'](0x2,'0')+':'+String(_0x41d8e4['getMinutes']())[_0x3e8588(0x16e)](0x2,'0');}function createMessageElement(_0x5194e7,_0x3c1413){const _0x494040=a0_0x2c18ad,_0x247dd7=document[_0x494040(0x184)](_0x494040(0x15a));_0x247dd7[_0x494040(0x156)]=_0x494040(0x17e)+_0x5194e7['role'];const _0x22cdaf=document[_0x494040(0x184)](_0x494040(0x15a));_0x22cdaf[_0x494040(0x156)]=_0x494040(0x170),_0x22cdaf[_0x494040(0x129)]=_0x5194e7['content'][_0x494040(0x147)](/\n/g,_0x494040(0x151));const _0x20f659=document[_0x494040(0x184)](_0x494040(0x15a));_0x20f659[_0x494040(0x156)]=_0x494040(0x136),_0x20f659[_0x494040(0x129)]=_0x494040(0x166),_0x20f659[_0x494040(0x174)]=_0xe031f4=>{_0xe031f4['stopPropagation'](),confirmDelete(_0x3c1413);};let _0x22820c;_0x22cdaf['addEventListener'](_0x494040(0x118),()=>_0x22820c=setTimeout(()=>{const _0x1f85da=_0x494040;_0x247dd7[_0x1f85da(0x12e)][_0x1f85da(0x187)](_0x1f85da(0x11b));if(tg?.[_0x1f85da(0x17a)])tg[_0x1f85da(0x17a)]['impactOccurred'](_0x1f85da(0x180));},0x1f4)),_0x22cdaf[_0x494040(0x143)](_0x494040(0x195),()=>clearTimeout(_0x22820c));const _0x44a76a=document[_0x494040(0x184)]('div');return _0x44a76a['className']=_0x494040(0x134),_0x44a76a[_0x494040(0x121)]=formatTime(_0x5194e7[_0x494040(0x173)]),_0x247dd7['appendChild'](_0x20f659),_0x247dd7[_0x494040(0x119)](_0x22cdaf),_0x247dd7[_0x494040(0x119)](_0x44a76a),_0x247dd7;}function createTypingIndicator(){const _0x35b751=a0_0x2c18ad,_0x302519=document[_0x35b751(0x184)](_0x35b751(0x15a));return _0x302519[_0x35b751(0x156)]=_0x35b751(0x14f),_0x302519['id']=_0x35b751(0x16b),_0x302519[_0x35b751(0x129)]=_0x35b751(0x178),_0x302519;}function renderMessages(){const _0x1edd44=a0_0x2c18ad;Array[_0x1edd44(0x117)](chatArea[_0x1edd44(0x144)])[_0x1edd44(0x125)](_0x383d8a=>{const _0x2f6df2=_0x1edd44;if(_0x383d8a['id']!==_0x2f6df2(0x159))_0x383d8a[_0x2f6df2(0x18d)]();}),messages[_0x1edd44(0x14b)]>0x0?(emptyState[_0x1edd44(0x17f)][_0x1edd44(0x11f)]=_0x1edd44(0x12b),messages[_0x1edd44(0x125)]((_0xeee31a,_0x975b02)=>chatArea[_0x1edd44(0x119)](createMessageElement(_0xeee31a,_0x975b02)))):emptyState['style'][_0x1edd44(0x11f)]=_0x1edd44(0x138),requestAnimationFrame(()=>chatArea[_0x1edd44(0x115)]=chatArea[_0x1edd44(0x192)]);}function autoResizeTextarea(){const _0x1344b5=a0_0x2c18ad;messageInput[_0x1344b5(0x17f)][_0x1344b5(0x126)]=_0x1344b5(0x188),messageInput[_0x1344b5(0x17f)]['height']=Math['min'](messageInput[_0x1344b5(0x192)],0x78)+'px';}function a0_0x5204(){const _0x445fd5=['emptyState','div','22780307XrdnhZ','first_name','href','key','ready','modalText','setHeaderColor','click','Пустой\x20ответ','function','2078712VFZWVK','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','impactOccurred','modalConfirm','onClick','POST','typingIndicator','ai_chat_messages','viewportHeight','padStart','user','message-bubble','username','initData','timestamp','onclick','Ошибка\x20сервера','stringify','getHours','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','./router.html','HapticFeedback','Enter','constructor','8487416MObEAA','message\x20','style','medium','light','34atXCXV','expand','createElement','4eCyEdo','774570NyTWxV','add','auto','modalTitle','(((.+)+)+)+$','modalCancel','signal','remove','offsetHeight','focus','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','input','scrollHeight','.container','apply','touchend','scrollTop','getItem','from','touchstart','appendChild','toString','show-delete','success','push','messageInput','display','value','textContent','#050505','show','35pWZUMY','forEach','height','paddingBottom','removeItem','innerHTML','debug_uid','none','innerHeight','setItem','classList','6.1','search','inputArea','random','error','message-time','querySelectorAll','delete-btn','Ошибка\x20сети','flex','117lhNyfN','63186JNwUyJ','394120XuDtEK','parse','Очистить\x20историю?','text','confirmModal','disabled','offClick','WebApp','addEventListener','children','querySelector','.message.show-delete','replace','TG\x20setup\x20error:','send_message','resize','length','81125nQlTks','Начнется\x20новый\x20диалог.','trim','message\x20ai','viewportChanged','<br>','notificationOccurred','disableVerticalSwipes','contains','getElementById','className','chatArea','now'];a0_0x5204=function(){return _0x445fd5;};return a0_0x5204();}function updateSendButton(){const _0x355829=a0_0x2c18ad,_0x10bec1=messageInput[_0x355829(0x120)][_0x355829(0x14e)]();sendBtn[_0x355829(0x140)]=!_0x10bec1||isTyping;}async function sendMessage(){const _0x4ecd67=a0_0x2c18ad,_0x1cafa7=messageInput['value'][_0x4ecd67(0x14e)]();if(!_0x1cafa7||isTyping)return;if(tg?.[_0x4ecd67(0x17a)])tg['HapticFeedback'][_0x4ecd67(0x167)](_0x4ecd67(0x181));messages['push']({'role':_0x4ecd67(0x16f),'content':_0x1cafa7,'timestamp':Date[_0x4ecd67(0x158)]()}),localStorage[_0x4ecd67(0x12d)](_0x4ecd67(0x16c),JSON[_0x4ecd67(0x176)](messages)),renderMessages(),messageInput[_0x4ecd67(0x120)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4ecd67(0x119)](createTypingIndicator()),chatArea[_0x4ecd67(0x115)]=chatArea[_0x4ecd67(0x192)];const _0xfc48be=await callBackend(_0x4ecd67(0x149),{'message':_0x1cafa7});isTyping=![];const _0x315107=document[_0x4ecd67(0x155)](_0x4ecd67(0x16b));if(_0x315107)_0x315107[_0x4ecd67(0x18d)]();let _0x2c0c0c=_0x4ecd67(0x137);if(_0xfc48be[_0x4ecd67(0x11c)]){_0x2c0c0c=_0xfc48be[_0x4ecd67(0x13e)]||_0x4ecd67(0x163);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x4ecd67(0x152)](_0x4ecd67(0x11c));}else{_0x2c0c0c=_0xfc48be[_0x4ecd67(0x133)]||_0x4ecd67(0x175);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x4ecd67(0x152)](_0x4ecd67(0x133));}messages[_0x4ecd67(0x11d)]({'role':'ai','content':_0x2c0c0c,'timestamp':Date[_0x4ecd67(0x158)]()}),localStorage[_0x4ecd67(0x12d)](_0x4ecd67(0x16c),JSON[_0x4ecd67(0x176)](messages)),renderMessages();}function confirmDelete(_0x474d90){const _0x220fec=a0_0x2c18ad;if(mTitle)mTitle[_0x220fec(0x121)]='Удалить?';if(mText)mText[_0x220fec(0x121)]='Действие\x20необратимо.';modalCallback=()=>{const _0x240af7=_0x220fec;messages['splice'](_0x474d90,0x1),localStorage['setItem'](_0x240af7(0x16c),JSON['stringify'](messages)),renderMessages();},modal[_0x220fec(0x12e)][_0x220fec(0x187)](_0x220fec(0x123));}if(clearBtn)clearBtn[a0_0x2c18ad(0x174)]=()=>{const _0x5e1a76=a0_0x2c18ad;if(!messages[_0x5e1a76(0x14b)])return;if(mTitle)mTitle[_0x5e1a76(0x121)]=_0x5e1a76(0x13d);if(mText)mText[_0x5e1a76(0x121)]=_0x5e1a76(0x14d);modalCallback=async()=>{const _0x38762d=_0x5e1a76;messages=[],localStorage[_0x38762d(0x128)](_0x38762d(0x16c)),renderMessages(),callBackend('clear_history',{});},modal[_0x5e1a76(0x12e)][_0x5e1a76(0x187)]('show');};document[a0_0x2c18ad(0x155)](a0_0x2c18ad(0x18b))[a0_0x2c18ad(0x174)]=()=>modal[a0_0x2c18ad(0x12e)][a0_0x2c18ad(0x18d)]('show'),document['getElementById'](a0_0x2c18ad(0x168))[a0_0x2c18ad(0x174)]=()=>{const _0x211a55=a0_0x2c18ad;if(modalCallback)modalCallback();modal[_0x211a55(0x12e)][_0x211a55(0x18d)](_0x211a55(0x123));},messageInput[a0_0x2c18ad(0x143)](a0_0x2c18ad(0x191),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x204b65=>{const _0x1f9a12=a0_0x2c18ad;_0x204b65[_0x1f9a12(0x15e)]===_0x1f9a12(0x17b)&&!_0x204b65['shiftKey']&&(_0x204b65['preventDefault'](),sendMessage());}),sendBtn[a0_0x2c18ad(0x174)]=sendMessage,document[a0_0x2c18ad(0x143)](a0_0x2c18ad(0x162),_0x2211ed=>{const _0x2fcb9f=a0_0x2c18ad;document[_0x2fcb9f(0x135)](_0x2fcb9f(0x146))[_0x2fcb9f(0x125)](_0x4b8de3=>{const _0x345d4f=_0x2fcb9f;if(!_0x4b8de3[_0x345d4f(0x154)](_0x2211ed['target']))_0x4b8de3['classList'][_0x345d4f(0x18d)](_0x345d4f(0x11b));});});const saved=localStorage[a0_0x2c18ad(0x116)](a0_0x2c18ad(0x16c));if(saved)try{messages=JSON[a0_0x2c18ad(0x13c)](saved),renderMessages();}catch(a0_0xfff4a5){}updateSendButton();