const a0_0x45aed3=a0_0x14de;function a0_0x14de(_0x2ebca9,_0x1be3e5){_0x2ebca9=_0x2ebca9-0x1f1;const _0x4c6b11=a0_0x43bb();let _0x4e0cbe=_0x4c6b11[_0x2ebca9];return _0x4e0cbe;}(function(_0x5c856b,_0x3c7cd4){const _0x4bd450=a0_0x14de,_0x167c9d=_0x5c856b();while(!![]){try{const _0x3aba49=-parseInt(_0x4bd450(0x268))/0x1+parseInt(_0x4bd450(0x22b))/0x2*(parseInt(_0x4bd450(0x212))/0x3)+-parseInt(_0x4bd450(0x240))/0x4+parseInt(_0x4bd450(0x1f1))/0x5+-parseInt(_0x4bd450(0x230))/0x6+-parseInt(_0x4bd450(0x220))/0x7+parseInt(_0x4bd450(0x217))/0x8*(parseInt(_0x4bd450(0x231))/0x9);if(_0x3aba49===_0x3c7cd4)break;else _0x167c9d['push'](_0x167c9d['shift']());}catch(_0xdcff20){_0x167c9d['push'](_0x167c9d['shift']());}}}(a0_0x43bb,0x7079c));const tg=window[a0_0x45aed3(0x221)]?.[a0_0x45aed3(0x22e)],HOME_URL=a0_0x45aed3(0x20b);function setupTelegramBackButton(){const _0x7f97d4=a0_0x45aed3,_0x5c8ab0=(function(){let _0x161eb4=!![];return function(_0x5dfc2a,_0x51a896){const _0xc86b06=_0x161eb4?function(){const _0x1545d6=a0_0x14de;if(_0x51a896){const _0xfd7cbf=_0x51a896[_0x1545d6(0x1fe)](_0x5dfc2a,arguments);return _0x51a896=null,_0xfd7cbf;}}:function(){};return _0x161eb4=![],_0xc86b06;};}()),_0x2bbd69=_0x5c8ab0(this,function(){const _0x4563f2=a0_0x14de;return _0x2bbd69[_0x4563f2(0x238)]()[_0x4563f2(0x1fa)]('(((.+)+)+)+$')['toString']()[_0x4563f2(0x24a)](_0x2bbd69)[_0x4563f2(0x1fa)](_0x4563f2(0x257));});_0x2bbd69();if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x7f97d4(0x23b)]?.(_0x7f97d4(0x222));if(tg[_0x7f97d4(0x20f)]?.(_0x7f97d4(0x263)))tg[_0x7f97d4(0x265)]?.();const _0xd2b163=tg[_0x7f97d4(0x24f)];if(_0xd2b163){_0xd2b163[_0x7f97d4(0x25c)]();if(typeof _0xd2b163[_0x7f97d4(0x20d)]===_0x7f97d4(0x213))try{_0xd2b163[_0x7f97d4(0x20d)]();}catch(_0x2c4167){}_0xd2b163[_0x7f97d4(0x23a)](()=>{const _0x32f0e8=_0x7f97d4;if(tg['HapticFeedback'])tg['HapticFeedback'][_0x32f0e8(0x1f7)](_0x32f0e8(0x205));location[_0x32f0e8(0x23e)]=HOME_URL;});}}catch(_0xe69594){console[_0x7f97d4(0x262)]('TG\x20setup\x20error:',_0xe69594);}}(function initStableLayout(){const _0x2480cf=a0_0x45aed3,_0x5a9e6e=document[_0x2480cf(0x219)]('.container'),_0x2e4710=document[_0x2480cf(0x234)]('inputArea'),_0x3f7904=document[_0x2480cf(0x234)](_0x2480cf(0x235)),_0x4daebb=document[_0x2480cf(0x234)]('messageInput');function _0x3603ae(){const _0x319bd9=_0x2480cf;if(!_0x5a9e6e)return;const _0x35b726=tg&&tg['viewportHeight']?tg[_0x319bd9(0x22c)]:window[_0x319bd9(0x208)];_0x5a9e6e[_0x319bd9(0x223)][_0x319bd9(0x241)]=_0x35b726+'px';if(_0x2e4710){const _0x1f0bad=_0x2e4710[_0x319bd9(0x259)];_0x3f7904[_0x319bd9(0x223)][_0x319bd9(0x25f)]=_0x1f0bad+0x28+'px';}}tg?tg[_0x2480cf(0x225)](_0x2480cf(0x1f5),({isStateStable:_0x2028e4})=>{_0x3603ae();if(_0x2028e4)requestAnimationFrame(()=>{const _0x5a38b8=a0_0x14de;_0x3f7904[_0x5a38b8(0x1f3)]=_0x3f7904['scrollHeight'];});}):window['addEventListener'](_0x2480cf(0x261),_0x3603ae),_0x3603ae(),_0x4daebb&&(_0x4daebb[_0x2480cf(0x249)](_0x2480cf(0x24c),()=>{requestAnimationFrame(_0x3603ae);}),_0x4daebb[_0x2480cf(0x249)]('focus',()=>{setTimeout(()=>{const _0x3ab8c7=a0_0x14de;_0x3f7904[_0x3ab8c7(0x1f3)]=_0x3f7904[_0x3ab8c7(0x236)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x45aed3(0x234)]('chatArea'),emptyState=document[a0_0x45aed3(0x234)](a0_0x45aed3(0x23d)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x45aed3(0x234)](a0_0x45aed3(0x251)),clearBtn=document[a0_0x45aed3(0x234)](a0_0x45aed3(0x254)),modal=document[a0_0x45aed3(0x234)]('confirmModal'),mTitle=document[a0_0x45aed3(0x234)](a0_0x45aed3(0x214)),mText=document['getElementById'](a0_0x45aed3(0x1fc));let modalCallback=null;async function callBackend(_0x13c824,_0x448154){const _0x4bee61=a0_0x45aed3,_0xc3b7c4=tg?.[_0x4bee61(0x256)]?.[_0x4bee61(0x24e)]||{},_0x19c220=_0xc3b7c4['id']||localStorage['getItem'](_0x4bee61(0x200))||'d-'+Math[_0x4bee61(0x207)](Math[_0x4bee61(0x1fb)]()*0x3b9aca00);if(!_0xc3b7c4['id'])localStorage['setItem'](_0x4bee61(0x200),_0x19c220);const _0x5d9fe8={'action':_0x13c824,'user_id':_0x19c220,'user_data':{'first_name':_0xc3b7c4['first_name'],'username':_0xc3b7c4['username']},'init_data':tg?.[_0x4bee61(0x269)]||'',..._0x448154},_0x26bc94=new AbortController(),_0x1e3a17=setTimeout(()=>_0x26bc94['abort'](),REQUEST_TIMEOUT_MS);try{const _0x46fa36=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x4bee61(0x21d)},'body':JSON['stringify'](_0x5d9fe8),'signal':_0x26bc94[_0x4bee61(0x1fd)]});return clearTimeout(_0x1e3a17),await _0x46fa36[_0x4bee61(0x267)]();}catch(_0x326baf){return{'success':![],'error':String(_0x326baf)};}}function formatTime(_0x374bbc){const _0x61cf1f=a0_0x45aed3,_0x48b9d5=new Date(_0x374bbc);return String(_0x48b9d5[_0x61cf1f(0x209)]())['padStart'](0x2,'0')+':'+String(_0x48b9d5['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x48023d,_0x2ca1f3){const _0x1941ba=a0_0x45aed3,_0x88334c=document[_0x1941ba(0x1f9)](_0x1941ba(0x255));_0x88334c[_0x1941ba(0x25b)]=_0x1941ba(0x260)+_0x48023d[_0x1941ba(0x246)];const _0x16965b=document[_0x1941ba(0x1f9)]('div');_0x16965b['className']=_0x1941ba(0x204),_0x16965b[_0x1941ba(0x201)]=_0x48023d[_0x1941ba(0x258)][_0x1941ba(0x227)](/\n/g,'<br>');const _0x1cccb1=document[_0x1941ba(0x1f9)]('div');_0x1cccb1['className']=_0x1941ba(0x25d),_0x1cccb1['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x1cccb1['onclick']=_0x27ad3f=>{const _0x5447e5=_0x1941ba;_0x27ad3f[_0x5447e5(0x1f6)](),confirmDelete(_0x2ca1f3);};let _0x171103;_0x16965b[_0x1941ba(0x249)]('touchstart',()=>_0x171103=setTimeout(()=>{const _0x270089=_0x1941ba;_0x88334c[_0x270089(0x224)]['add']('show-delete');if(tg?.[_0x270089(0x215)])tg[_0x270089(0x215)][_0x270089(0x1f7)](_0x270089(0x20e));},0x1f4)),_0x16965b[_0x1941ba(0x249)]('touchend',()=>clearTimeout(_0x171103));const _0x5e8b6d=document[_0x1941ba(0x1f9)](_0x1941ba(0x255));return _0x5e8b6d[_0x1941ba(0x25b)]=_0x1941ba(0x22f),_0x5e8b6d[_0x1941ba(0x232)]=formatTime(_0x48023d['timestamp']),_0x88334c[_0x1941ba(0x243)](_0x1cccb1),_0x88334c[_0x1941ba(0x243)](_0x16965b),_0x88334c[_0x1941ba(0x243)](_0x5e8b6d),_0x88334c;}function createTypingIndicator(){const _0x403632=a0_0x45aed3,_0x3950bd=document['createElement'](_0x403632(0x255));return _0x3950bd['className']='message\x20ai',_0x3950bd['id']=_0x403632(0x202),_0x3950bd[_0x403632(0x201)]=_0x403632(0x244),_0x3950bd;}function renderMessages(){const _0x22a4fe=a0_0x45aed3;Array[_0x22a4fe(0x1f4)](chatArea[_0x22a4fe(0x20a)])[_0x22a4fe(0x228)](_0x229433=>{const _0x5c0a10=_0x22a4fe;if(_0x229433['id']!==_0x5c0a10(0x23d))_0x229433[_0x5c0a10(0x22a)]();}),messages[_0x22a4fe(0x206)]>0x0?(emptyState['style'][_0x22a4fe(0x24b)]=_0x22a4fe(0x21c),messages[_0x22a4fe(0x228)]((_0x5dfbd1,_0x32fef3)=>chatArea[_0x22a4fe(0x243)](createMessageElement(_0x5dfbd1,_0x32fef3)))):emptyState[_0x22a4fe(0x223)][_0x22a4fe(0x24b)]=_0x22a4fe(0x253),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x22a4fe(0x236)]);}function autoResizeTextarea(){const _0x54f698=a0_0x45aed3;messageInput['style']['height']=_0x54f698(0x1f2),messageInput[_0x54f698(0x223)][_0x54f698(0x241)]=Math[_0x54f698(0x21f)](messageInput[_0x54f698(0x236)],0x78)+'px';}function updateSendButton(){const _0x287a9c=a0_0x45aed3,_0x136fa6=messageInput[_0x287a9c(0x247)]['trim']();sendBtn[_0x287a9c(0x24d)]=!_0x136fa6||isTyping;}async function sendMessage(){const _0x1c5d8d=a0_0x45aed3,_0x2a578c=messageInput['value'][_0x1c5d8d(0x216)]();if(!_0x2a578c||isTyping)return;if(tg?.[_0x1c5d8d(0x215)])tg['HapticFeedback'][_0x1c5d8d(0x1f7)](_0x1c5d8d(0x205));messages['push']({'role':_0x1c5d8d(0x24e),'content':_0x2a578c,'timestamp':Date['now']()}),localStorage['setItem'](_0x1c5d8d(0x23c),JSON[_0x1c5d8d(0x203)](messages)),renderMessages(),messageInput[_0x1c5d8d(0x247)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1c5d8d(0x243)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x8d7ca=await callBackend('send_message',{'message':_0x2a578c});isTyping=![];const _0x279d0a=document[_0x1c5d8d(0x234)](_0x1c5d8d(0x202));if(_0x279d0a)_0x279d0a[_0x1c5d8d(0x22a)]();let _0x2a862d=_0x1c5d8d(0x21e);if(_0x8d7ca[_0x1c5d8d(0x23f)]){_0x2a862d=_0x8d7ca[_0x1c5d8d(0x226)]||_0x1c5d8d(0x245);if(tg?.[_0x1c5d8d(0x215)])tg[_0x1c5d8d(0x215)][_0x1c5d8d(0x1f8)]('success');}else{_0x2a862d=_0x8d7ca[_0x1c5d8d(0x210)]||_0x1c5d8d(0x22d);if(tg?.[_0x1c5d8d(0x215)])tg[_0x1c5d8d(0x215)][_0x1c5d8d(0x1f8)](_0x1c5d8d(0x210));}messages['push']({'role':'ai','content':_0x2a862d,'timestamp':Date['now']()}),localStorage['setItem'](_0x1c5d8d(0x23c),JSON[_0x1c5d8d(0x203)](messages)),renderMessages();}function confirmDelete(_0x1b04ab){const _0x42aca8=a0_0x45aed3;if(mTitle)mTitle[_0x42aca8(0x232)]=_0x42aca8(0x218);if(mText)mText[_0x42aca8(0x232)]=_0x42aca8(0x250);modalCallback=()=>{const _0x190bec=_0x42aca8;messages[_0x190bec(0x239)](_0x1b04ab,0x1),localStorage[_0x190bec(0x1ff)](_0x190bec(0x23c),JSON[_0x190bec(0x203)](messages)),renderMessages();},modal[_0x42aca8(0x224)][_0x42aca8(0x21a)](_0x42aca8(0x25c));}if(clearBtn)clearBtn[a0_0x45aed3(0x229)]=()=>{const _0x578afc=a0_0x45aed3;if(!messages[_0x578afc(0x206)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText['textContent']='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x2cccfa=_0x578afc;messages=[],localStorage['removeItem'](_0x2cccfa(0x23c)),renderMessages(),callBackend(_0x2cccfa(0x20c),{});},modal['classList'][_0x578afc(0x21a)](_0x578afc(0x25c));};document[a0_0x45aed3(0x234)](a0_0x45aed3(0x242))[a0_0x45aed3(0x229)]=()=>modal['classList']['remove'](a0_0x45aed3(0x25c)),document['getElementById'](a0_0x45aed3(0x237))[a0_0x45aed3(0x229)]=()=>{const _0x826d75=a0_0x45aed3;if(modalCallback)modalCallback();modal['classList'][_0x826d75(0x22a)](_0x826d75(0x25c));},messageInput[a0_0x45aed3(0x249)](a0_0x45aed3(0x24c),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x45aed3(0x249)](a0_0x45aed3(0x248),_0x36004b=>{const _0xb55250=a0_0x45aed3;_0x36004b[_0xb55250(0x25e)]===_0xb55250(0x25a)&&!_0x36004b['shiftKey']&&(_0x36004b['preventDefault'](),sendMessage());}),sendBtn[a0_0x45aed3(0x229)]=sendMessage,document[a0_0x45aed3(0x249)](a0_0x45aed3(0x211),_0x3fc328=>{const _0x1ab6b2=a0_0x45aed3;document['querySelectorAll']('.message.show-delete')[_0x1ab6b2(0x228)](_0xbfef3a=>{const _0x46434f=_0x1ab6b2;if(!_0xbfef3a[_0x46434f(0x264)](_0x3fc328[_0x46434f(0x21b)]))_0xbfef3a['classList'][_0x46434f(0x22a)](_0x46434f(0x252));});});const saved=localStorage[a0_0x45aed3(0x233)](a0_0x45aed3(0x23c));function a0_0x43bb(){const _0x31144d=['Telegram','#050505','style','classList','onEvent','text','replace','forEach','onclick','remove','287366ydIDbD','viewportHeight','Ошибка\x20сервера','WebApp','message-time','281556urHbyX','9BgMLwA','textContent','getItem','getElementById','chatArea','scrollHeight','modalConfirm','toString','splice','onClick','setHeaderColor','ai_chat_messages','emptyState','href','success','797816AFJYIQ','height','modalCancel','appendChild','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','Пустой\x20ответ','role','value','keydown','addEventListener','constructor','display','input','disabled','user','BackButton','Действие\x20необратимо.','sendBtn','show-delete','flex','clearBtn','div','initDataUnsafe','(((.+)+)+)+$','content','offsetHeight','Enter','className','show','delete-btn','key','paddingBottom','message\x20','resize','warn','6.1','contains','disableVerticalSwipes','parse','json','53394vZVfke','initData','2036260HSojxS','auto','scrollTop','from','viewportChanged','stopPropagation','impactOccurred','notificationOccurred','createElement','search','random','modalText','signal','apply','setItem','debug_uid','innerHTML','typingIndicator','stringify','message-bubble','light','length','floor','innerHeight','getHours','children','./router.html','clear_history','offClick','medium','isVersionAtLeast','error','click','6oJRGqG','function','modalTitle','HapticFeedback','trim','7810536oeaFnN','Удалить?','querySelector','add','target','none','text/plain','Ошибка\x20сети','min','6373227YtJHPz'];a0_0x43bb=function(){return _0x31144d;};return a0_0x43bb();}if(saved)try{messages=JSON[a0_0x45aed3(0x266)](saved),renderMessages();}catch(a0_0x4c2666){}updateSendButton();