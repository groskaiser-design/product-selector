const a0_0x79faed=a0_0x39ed;(function(_0x51b17a,_0x3c4058){const _0x277800=a0_0x39ed,_0x27a621=_0x51b17a();while(!![]){try{const _0x344fe5=parseInt(_0x277800(0x142))/0x1+parseInt(_0x277800(0x155))/0x2*(-parseInt(_0x277800(0x16a))/0x3)+-parseInt(_0x277800(0x189))/0x4+parseInt(_0x277800(0x11f))/0x5+-parseInt(_0x277800(0x136))/0x6+parseInt(_0x277800(0x116))/0x7+parseInt(_0x277800(0x17e))/0x8*(parseInt(_0x277800(0x132))/0x9);if(_0x344fe5===_0x3c4058)break;else _0x27a621['push'](_0x27a621['shift']());}catch(_0x10955c){_0x27a621['push'](_0x27a621['shift']());}}}(a0_0x3a63,0x8e552));const tg=window[a0_0x79faed(0x123)]?.['WebApp'],HOME_URL=a0_0x79faed(0x18d);function setupTelegramBackButton(){const _0x5f26e2=a0_0x79faed,_0x19d9a2=(function(){let _0x42f17d=!![];return function(_0x9adbd1,_0x370da4){const _0x26b961=_0x42f17d?function(){if(_0x370da4){const _0x174d58=_0x370da4['apply'](_0x9adbd1,arguments);return _0x370da4=null,_0x174d58;}}:function(){};return _0x42f17d=![],_0x26b961;};}()),_0x19ab2c=_0x19d9a2(this,function(){const _0x1763ae=a0_0x39ed;return _0x19ab2c[_0x1763ae(0x16b)]()[_0x1763ae(0x16e)]('(((.+)+)+)+$')[_0x1763ae(0x16b)]()[_0x1763ae(0x173)](_0x19ab2c)[_0x1763ae(0x16e)](_0x1763ae(0x174));});_0x19ab2c();if(!tg)return;try{tg[_0x5f26e2(0x138)](),tg[_0x5f26e2(0x145)](),tg['setHeaderColor']?.('#050505');if(tg[_0x5f26e2(0x15a)]?.(_0x5f26e2(0x17c)))tg['disableVerticalSwipes']?.();const _0x481cbc=tg[_0x5f26e2(0x11a)];if(_0x481cbc){_0x481cbc['show']();if(typeof _0x481cbc[_0x5f26e2(0x17d)]===_0x5f26e2(0x183))try{_0x481cbc['offClick']();}catch(_0x1721f9){}_0x481cbc[_0x5f26e2(0x166)](()=>{const _0x4d2132=_0x5f26e2;if(tg['HapticFeedback'])tg[_0x4d2132(0x135)][_0x4d2132(0x18e)](_0x4d2132(0x177));location['href']=HOME_URL;});}}catch(_0xbbe0bd){console[_0x5f26e2(0x172)](_0x5f26e2(0x167),_0xbbe0bd);}}(function initStableLayout(){const _0x18689f=a0_0x79faed,_0xfce34a=document[_0x18689f(0x176)](_0x18689f(0x184)),_0x38da2b=document[_0x18689f(0x128)]('inputArea'),_0x53788e=document[_0x18689f(0x128)](_0x18689f(0x13d)),_0x2b373e=document['getElementById'](_0x18689f(0x161));function _0x27f591(){const _0x27262b=_0x18689f;if(!_0xfce34a)return;const _0x408eff=tg&&tg[_0x27262b(0x117)]?tg[_0x27262b(0x117)]:window['innerHeight'];_0xfce34a[_0x27262b(0x143)]['height']=_0x408eff+'px';if(_0x38da2b){const _0x394989=_0x38da2b['offsetHeight'];_0x53788e['style'][_0x27262b(0x11d)]=_0x394989+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x2948d8})=>{_0x27f591();if(_0x2948d8)requestAnimationFrame(()=>{const _0x323de7=a0_0x39ed;_0x53788e['scrollTop']=_0x53788e[_0x323de7(0x18a)];});}):window[_0x18689f(0x151)](_0x18689f(0x12f),_0x27f591),_0x27f591(),_0x2b373e&&(_0x2b373e[_0x18689f(0x151)](_0x18689f(0x124),()=>{requestAnimationFrame(_0x27f591);}),_0x2b373e[_0x18689f(0x151)](_0x18689f(0x12e),()=>{setTimeout(()=>{const _0x15d50f=a0_0x39ed;_0x53788e[_0x15d50f(0x121)]=_0x53788e[_0x15d50f(0x18a)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x79faed(0x128)](a0_0x79faed(0x13d)),emptyState=document[a0_0x79faed(0x128)](a0_0x79faed(0x16f)),messageInput=document[a0_0x79faed(0x128)](a0_0x79faed(0x161)),sendBtn=document[a0_0x79faed(0x128)](a0_0x79faed(0x157)),clearBtn=document[a0_0x79faed(0x128)](a0_0x79faed(0x130)),modal=document[a0_0x79faed(0x128)]('confirmModal'),mTitle=document[a0_0x79faed(0x128)](a0_0x79faed(0x165)),mText=document[a0_0x79faed(0x128)](a0_0x79faed(0x154));let modalCallback=null;async function callBackend(_0x7ff515,_0x2b8199){const _0x2d3c16=a0_0x79faed,_0x596822=tg?.[_0x2d3c16(0x162)]?.[_0x2d3c16(0x147)]||{},_0x2080d1=_0x596822['id']||localStorage[_0x2d3c16(0x12d)]('debug_uid')||'d-'+Math[_0x2d3c16(0x125)](Math[_0x2d3c16(0x12a)]()*0x3b9aca00);if(!_0x596822['id'])localStorage['setItem'](_0x2d3c16(0x141),_0x2080d1);const _0x33bb95={'action':_0x7ff515,'user_id':_0x2080d1,'user_data':{'first_name':_0x596822[_0x2d3c16(0x18f)],'username':_0x596822['username']},'init_data':tg?.[_0x2d3c16(0x127)]||'',..._0x2b8199},_0x2ef73e=new AbortController(),_0x4a06f4=setTimeout(()=>_0x2ef73e[_0x2d3c16(0x17a)](),REQUEST_TIMEOUT_MS);try{const _0x31596a=await fetch(BACKEND_URL,{'method':_0x2d3c16(0x158),'headers':{'Content-Type':_0x2d3c16(0x133)},'body':JSON[_0x2d3c16(0x16c)](_0x33bb95),'signal':_0x2ef73e['signal']});return clearTimeout(_0x4a06f4),await _0x31596a[_0x2d3c16(0x169)]();}catch(_0x178da2){return{'success':![],'error':String(_0x178da2)};}}function formatTime(_0x3581ff){const _0x36d565=a0_0x79faed,_0x321d91=new Date(_0x3581ff);return String(_0x321d91[_0x36d565(0x150)]())[_0x36d565(0x18b)](0x2,'0')+':'+String(_0x321d91['getMinutes']())[_0x36d565(0x18b)](0x2,'0');}function createMessageElement(_0x13dd76,_0x335d52){const _0x3d3d6e=a0_0x79faed,_0x475b0f=document[_0x3d3d6e(0x144)](_0x3d3d6e(0x178));_0x475b0f[_0x3d3d6e(0x18c)]='message\x20'+_0x13dd76[_0x3d3d6e(0x17f)];const _0x2b1036=document[_0x3d3d6e(0x144)](_0x3d3d6e(0x178));_0x2b1036['className']=_0x3d3d6e(0x11c),_0x2b1036[_0x3d3d6e(0x170)]=_0x13dd76[_0x3d3d6e(0x186)][_0x3d3d6e(0x15e)](/\n/g,_0x3d3d6e(0x181));const _0x33b36c=document[_0x3d3d6e(0x144)](_0x3d3d6e(0x178));_0x33b36c['className']=_0x3d3d6e(0x152),_0x33b36c[_0x3d3d6e(0x170)]=_0x3d3d6e(0x11b),_0x33b36c['onclick']=_0x1d67a8=>{const _0x33e49e=_0x3d3d6e;_0x1d67a8[_0x33e49e(0x140)](),confirmDelete(_0x335d52);};let _0x118be9;_0x2b1036[_0x3d3d6e(0x151)](_0x3d3d6e(0x15c),()=>_0x118be9=setTimeout(()=>{const _0x4d441a=_0x3d3d6e;_0x475b0f[_0x4d441a(0x15b)]['add'](_0x4d441a(0x12b));if(tg?.[_0x4d441a(0x135)])tg[_0x4d441a(0x135)][_0x4d441a(0x18e)](_0x4d441a(0x160));},0x1f4)),_0x2b1036[_0x3d3d6e(0x151)](_0x3d3d6e(0x182),()=>clearTimeout(_0x118be9));const _0x5c335e=document[_0x3d3d6e(0x144)](_0x3d3d6e(0x178));return _0x5c335e['className']=_0x3d3d6e(0x16d),_0x5c335e[_0x3d3d6e(0x122)]=formatTime(_0x13dd76[_0x3d3d6e(0x180)]),_0x475b0f[_0x3d3d6e(0x168)](_0x33b36c),_0x475b0f[_0x3d3d6e(0x168)](_0x2b1036),_0x475b0f['appendChild'](_0x5c335e),_0x475b0f;}function createTypingIndicator(){const _0x56fb7e=a0_0x79faed,_0x250a7e=document[_0x56fb7e(0x144)](_0x56fb7e(0x178));return _0x250a7e[_0x56fb7e(0x18c)]=_0x56fb7e(0x146),_0x250a7e['id']=_0x56fb7e(0x156),_0x250a7e['innerHTML']=_0x56fb7e(0x171),_0x250a7e;}function a0_0x39ed(_0x47aab4,_0x1e4490){_0x47aab4=_0x47aab4-0x116;const _0x4814c0=a0_0x3a63();let _0x15c305=_0x4814c0[_0x47aab4];return _0x15c305;}function renderMessages(){const _0x21f60c=a0_0x79faed;Array[_0x21f60c(0x14b)](chatArea['children'])[_0x21f60c(0x13a)](_0x5efe5c=>{const _0x1d5d99=_0x21f60c;if(_0x5efe5c['id']!==_0x1d5d99(0x16f))_0x5efe5c[_0x1d5d99(0x13c)]();}),messages[_0x21f60c(0x15d)]>0x0?(emptyState[_0x21f60c(0x143)][_0x21f60c(0x13b)]=_0x21f60c(0x13e),messages[_0x21f60c(0x13a)]((_0x172529,_0x5acef7)=>chatArea[_0x21f60c(0x168)](createMessageElement(_0x172529,_0x5acef7)))):emptyState[_0x21f60c(0x143)]['display']='flex',requestAnimationFrame(()=>chatArea[_0x21f60c(0x121)]=chatArea[_0x21f60c(0x18a)]);}function autoResizeTextarea(){const _0x5a93ed=a0_0x79faed;messageInput[_0x5a93ed(0x143)][_0x5a93ed(0x118)]=_0x5a93ed(0x164),messageInput[_0x5a93ed(0x143)][_0x5a93ed(0x118)]=Math['min'](messageInput[_0x5a93ed(0x18a)],0x78)+'px';}function updateSendButton(){const _0xa95bbf=a0_0x79faed,_0x541f04=messageInput['value']['trim']();sendBtn[_0xa95bbf(0x139)]=!_0x541f04||isTyping;}async function sendMessage(){const _0x56bcfd=a0_0x79faed,_0x40a249=messageInput[_0x56bcfd(0x163)]['trim']();if(!_0x40a249||isTyping)return;if(tg?.[_0x56bcfd(0x135)])tg[_0x56bcfd(0x135)][_0x56bcfd(0x18e)]('light');messages[_0x56bcfd(0x159)]({'role':_0x56bcfd(0x147),'content':_0x40a249,'timestamp':Date[_0x56bcfd(0x126)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x56bcfd(0x16c)](messages)),renderMessages(),messageInput[_0x56bcfd(0x163)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x56bcfd(0x121)]=chatArea['scrollHeight'];const _0x4e9936=await callBackend(_0x56bcfd(0x137),{'message':_0x40a249});isTyping=![];const _0x1048ad=document['getElementById'](_0x56bcfd(0x156));if(_0x1048ad)_0x1048ad[_0x56bcfd(0x13c)]();let _0x5ef95e=_0x56bcfd(0x14a);if(_0x4e9936['success']){_0x5ef95e=_0x4e9936[_0x56bcfd(0x190)]||'Пустой\x20ответ';if(tg?.[_0x56bcfd(0x135)])tg['HapticFeedback']['notificationOccurred'](_0x56bcfd(0x149));}else{_0x5ef95e=_0x4e9936[_0x56bcfd(0x187)]||'Ошибка\x20сервера';if(tg?.[_0x56bcfd(0x135)])tg[_0x56bcfd(0x135)][_0x56bcfd(0x188)](_0x56bcfd(0x187));}messages[_0x56bcfd(0x159)]({'role':'ai','content':_0x5ef95e,'timestamp':Date[_0x56bcfd(0x126)]()}),localStorage[_0x56bcfd(0x120)](_0x56bcfd(0x12c),JSON[_0x56bcfd(0x16c)](messages)),renderMessages();}function confirmDelete(_0xc88aed){const _0xd5e5a0=a0_0x79faed;if(mTitle)mTitle[_0xd5e5a0(0x122)]=_0xd5e5a0(0x17b);if(mText)mText[_0xd5e5a0(0x122)]='Действие\x20необратимо.';modalCallback=()=>{const _0x1fb0c1=_0xd5e5a0;messages[_0x1fb0c1(0x131)](_0xc88aed,0x1),localStorage[_0x1fb0c1(0x120)]('ai_chat_messages',JSON[_0x1fb0c1(0x16c)](messages)),renderMessages();},modal[_0xd5e5a0(0x15b)][_0xd5e5a0(0x185)](_0xd5e5a0(0x153));}if(clearBtn)clearBtn[a0_0x79faed(0x175)]=()=>{const _0x5be27b=a0_0x79faed;if(!messages[_0x5be27b(0x15d)])return;if(mTitle)mTitle[_0x5be27b(0x122)]=_0x5be27b(0x15f);if(mText)mText[_0x5be27b(0x122)]=_0x5be27b(0x129);modalCallback=async()=>{const _0x3eabf1=_0x5be27b;messages=[],localStorage[_0x3eabf1(0x14f)]('ai_chat_messages'),renderMessages(),callBackend(_0x3eabf1(0x14e),{});},modal['classList']['add'](_0x5be27b(0x153));};document[a0_0x79faed(0x128)](a0_0x79faed(0x11e))[a0_0x79faed(0x175)]=()=>modal[a0_0x79faed(0x15b)]['remove'](a0_0x79faed(0x153)),document[a0_0x79faed(0x128)](a0_0x79faed(0x119))[a0_0x79faed(0x175)]=()=>{const _0xc1c712=a0_0x79faed;if(modalCallback)modalCallback();modal[_0xc1c712(0x15b)][_0xc1c712(0x13c)](_0xc1c712(0x153));},messageInput[a0_0x79faed(0x151)](a0_0x79faed(0x124),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x336e54=>{const _0x1c2e7f=a0_0x79faed;_0x336e54[_0x1c2e7f(0x14d)]==='Enter'&&!_0x336e54['shiftKey']&&(_0x336e54[_0x1c2e7f(0x148)](),sendMessage());}),sendBtn[a0_0x79faed(0x175)]=sendMessage,document[a0_0x79faed(0x151)](a0_0x79faed(0x13f),_0x2ad35b=>{const _0x12ac4c=a0_0x79faed;document['querySelectorAll'](_0x12ac4c(0x179))['forEach'](_0x15b5ee=>{const _0x472ded=_0x12ac4c;if(!_0x15b5ee[_0x472ded(0x134)](_0x2ad35b['target']))_0x15b5ee['classList'][_0x472ded(0x13c)](_0x472ded(0x12b));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x79faed(0x14c)](saved),renderMessages();}catch(a0_0x1e5268){}updateSendButton();function a0_0x3a63(){const _0x105280=['display','remove','chatArea','none','click','stopPropagation','debug_uid','632446bsXcmm','style','createElement','expand','message\x20ai','user','preventDefault','success','Ошибка\x20сети','from','parse','key','clear_history','removeItem','getHours','addEventListener','delete-btn','show','modalText','246890weDUmb','typingIndicator','sendBtn','POST','push','isVersionAtLeast','classList','touchstart','length','replace','Очистить\x20историю?','medium','messageInput','initDataUnsafe','value','auto','modalTitle','onClick','TG\x20setup\x20error:','appendChild','json','3BqBmOF','toString','stringify','message-time','search','emptyState','innerHTML','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','warn','constructor','(((.+)+)+)+$','onclick','querySelector','light','div','.message.show-delete','abort','Удалить?','6.1','offClick','31864SDwrll','role','timestamp','<br>','touchend','function','.container','add','content','error','notificationOccurred','2076472IvJKfP','scrollHeight','padStart','className','./router.html','impactOccurred','first_name','text','967617LDzSmK','viewportHeight','height','modalConfirm','BackButton','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','message-bubble','paddingBottom','modalCancel','2226730BxWyKU','setItem','scrollTop','textContent','Telegram','input','floor','now','initData','getElementById','Начнется\x20новый\x20диалог.','random','show-delete','ai_chat_messages','getItem','focus','resize','clearBtn','splice','1467MaKBaH','text/plain','contains','HapticFeedback','3838170ccrbUo','send_message','ready','disabled','forEach'];a0_0x3a63=function(){return _0x105280;};return a0_0x3a63();}