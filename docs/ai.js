const a0_0x361d3b=a0_0x5764;(function(_0x456dca,_0x1824e6){const _0x4ac562=a0_0x5764,_0x25895a=_0x456dca();while(!![]){try{const _0x4a56b9=-parseInt(_0x4ac562(0xf5))/0x1*(-parseInt(_0x4ac562(0x119))/0x2)+-parseInt(_0x4ac562(0x10c))/0x3*(-parseInt(_0x4ac562(0x146))/0x4)+parseInt(_0x4ac562(0x151))/0x5*(parseInt(_0x4ac562(0x11f))/0x6)+parseInt(_0x4ac562(0x12e))/0x7+-parseInt(_0x4ac562(0x13a))/0x8*(-parseInt(_0x4ac562(0x11e))/0x9)+-parseInt(_0x4ac562(0x104))/0xa*(parseInt(_0x4ac562(0x103))/0xb)+-parseInt(_0x4ac562(0x15d))/0xc*(parseInt(_0x4ac562(0x107))/0xd);if(_0x4a56b9===_0x1824e6)break;else _0x25895a['push'](_0x25895a['shift']());}catch(_0x37cc9b){_0x25895a['push'](_0x25895a['shift']());}}}(a0_0x395c,0x98bd7));const tg=window[a0_0x361d3b(0xe7)]?.[a0_0x361d3b(0x10a)],HOME_URL=a0_0x361d3b(0x101);function setupTelegramBackButton(){const _0x47a261=a0_0x361d3b,_0x48f7b1=(function(){let _0x2217a4=!![];return function(_0x407f11,_0xa08842){const _0x37bf3f=_0x2217a4?function(){const _0x295388=a0_0x5764;if(_0xa08842){const _0x5ebedc=_0xa08842[_0x295388(0x145)](_0x407f11,arguments);return _0xa08842=null,_0x5ebedc;}}:function(){};return _0x2217a4=![],_0x37bf3f;};}()),_0x1b2693=_0x48f7b1(this,function(){const _0x5e2aa3=a0_0x5764;return _0x1b2693[_0x5e2aa3(0xea)]()['search'](_0x5e2aa3(0x12c))[_0x5e2aa3(0xea)]()[_0x5e2aa3(0x112)](_0x1b2693)[_0x5e2aa3(0x15a)](_0x5e2aa3(0x12c));});_0x1b2693();if(!tg)return;try{tg[_0x47a261(0x11a)](),tg[_0x47a261(0x10f)](),tg[_0x47a261(0x137)]?.(_0x47a261(0x153));if(tg[_0x47a261(0x111)]?.('6.1'))tg[_0x47a261(0x130)]?.();const _0x32481a=tg['BackButton'];if(_0x32481a){_0x32481a['show']();if(typeof _0x32481a[_0x47a261(0x110)]===_0x47a261(0x113))try{_0x32481a[_0x47a261(0x110)]();}catch(_0x4a6f80){}_0x32481a[_0x47a261(0x132)](()=>{const _0x36a6a7=_0x47a261;if(tg[_0x36a6a7(0x143)])tg[_0x36a6a7(0x143)][_0x36a6a7(0x118)]('light');location[_0x36a6a7(0xe9)]=HOME_URL;});}}catch(_0x599142){console['warn']('TG\x20setup\x20error:',_0x599142);}}(function initStableLayout(){const _0x100869=a0_0x361d3b,_0x1cb739=document[_0x100869(0x106)]('.container'),_0x3bcf63=document[_0x100869(0x14d)](_0x100869(0x14c)),_0x2a8784=document[_0x100869(0x14d)](_0x100869(0x14a)),_0x2492b6=document['getElementById'](_0x100869(0x127));function _0x1af7a2(){const _0x2babfc=_0x100869;if(!_0x1cb739)return;const _0x37bc05=tg&&tg[_0x2babfc(0x164)]?tg[_0x2babfc(0x164)]:window['innerHeight'];_0x1cb739[_0x2babfc(0xe8)][_0x2babfc(0x152)]=_0x37bc05+'px';if(_0x3bcf63){const _0x1464a1=_0x3bcf63[_0x2babfc(0x10b)];_0x2a8784[_0x2babfc(0xe8)][_0x2babfc(0x114)]=_0x1464a1+0x28+'px';}}tg?tg[_0x100869(0x12d)](_0x100869(0xf4),({isStateStable:_0xc5565})=>{_0x1af7a2();if(_0xc5565)requestAnimationFrame(()=>{const _0x52ee6f=a0_0x5764;_0x2a8784['scrollTop']=_0x2a8784[_0x52ee6f(0x105)];});}):window['addEventListener'](_0x100869(0x122),_0x1af7a2),_0x1af7a2(),_0x2492b6&&(_0x2492b6[_0x100869(0x133)](_0x100869(0xee),()=>{requestAnimationFrame(_0x1af7a2);}),_0x2492b6[_0x100869(0x133)](_0x100869(0x144),()=>{setTimeout(()=>{const _0x29bbeb=a0_0x5764;_0x2a8784[_0x29bbeb(0x140)]=_0x2a8784[_0x29bbeb(0x105)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x395c(){const _0x446fd3=['delete-btn','resize','min','debug_uid','parse','touchstart','messageInput','initData','success','click','clear_history','(((.+)+)+)+$','onEvent','5973100mGwmXN','trim','disableVerticalSwipes','Удалить?','onClick','addEventListener','Пустой\x20ответ','modalCancel','.message.show-delete','setHeaderColor','innerHTML','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','8CrBbVD','replace','confirmModal','Действие\x20необратимо.','clearBtn','show','scrollTop','message\x20','json','HapticFeedback','focus','apply','30096BzHqLN','length','first_name','keydown','chatArea','className','inputArea','getElementById','div','onclick','role','2424690LadvSc','height','#050505','initDataUnsafe','disabled','timestamp','sendBtn','getMinutes','setItem','search','message-bubble','ai_chat_messages','4656FoEpPG','contains','remove','querySelectorAll','typingIndicator','modalTitle','textContent','viewportHeight','touchend','children','message-time','floor','now','modalConfirm','Telegram','style','href','toString','show-delete','removeItem','Ошибка\x20сети','input','emptyState','<br>','flex','message\x20ai','getItem','viewportChanged','1stZqmB','splice','stopPropagation','push','value','user','stringify','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','target','appendChild','abort','getHours','./router.html','Начнется\x20новый\x20диалог.','5211107luNSsc','10vDHCnq','scrollHeight','querySelector','118612OHMfqs','display','add','WebApp','offsetHeight','489oBcFwN','auto','error','expand','offClick','isVersionAtLeast','constructor','function','paddingBottom','from','padStart','createElement','impactOccurred','2179054uKPhzb','ready','preventDefault','classList','forEach','4503213kewQLb','12yWHkmw','text'];a0_0x395c=function(){return _0x446fd3;};return a0_0x395c();}const BACKEND_URL=a0_0x361d3b(0x139),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x361d3b(0x14d)](a0_0x361d3b(0x14a)),emptyState=document[a0_0x361d3b(0x14d)]('emptyState'),messageInput=document[a0_0x361d3b(0x14d)](a0_0x361d3b(0x127)),sendBtn=document[a0_0x361d3b(0x14d)](a0_0x361d3b(0x157)),clearBtn=document[a0_0x361d3b(0x14d)](a0_0x361d3b(0x13e)),modal=document[a0_0x361d3b(0x14d)](a0_0x361d3b(0x13c)),mTitle=document[a0_0x361d3b(0x14d)](a0_0x361d3b(0x162)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x20241d,_0x59760e){const _0x266334=a0_0x361d3b,_0x497b5d=tg?.[_0x266334(0x154)]?.[_0x266334(0xfa)]||{},_0x2aeffd=_0x497b5d['id']||localStorage['getItem'](_0x266334(0x124))||'d-'+Math[_0x266334(0x168)](Math['random']()*0x3b9aca00);if(!_0x497b5d['id'])localStorage[_0x266334(0x159)](_0x266334(0x124),_0x2aeffd);const _0x17c132={'action':_0x20241d,'user_id':_0x2aeffd,'user_data':{'first_name':_0x497b5d[_0x266334(0x148)],'username':_0x497b5d['username']},'init_data':tg?.[_0x266334(0x128)]||'',..._0x59760e},_0x4507b9=new AbortController(),_0x56eba2=setTimeout(()=>_0x4507b9[_0x266334(0xff)](),REQUEST_TIMEOUT_MS);try{const _0x4278e7=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x266334(0xfb)](_0x17c132),'signal':_0x4507b9['signal']});return clearTimeout(_0x56eba2),await _0x4278e7[_0x266334(0x142)]();}catch(_0x29292b){return{'success':![],'error':String(_0x29292b)};}}function formatTime(_0x3e06c8){const _0x45cc2b=a0_0x361d3b,_0x1f8498=new Date(_0x3e06c8);return String(_0x1f8498[_0x45cc2b(0x100)]())['padStart'](0x2,'0')+':'+String(_0x1f8498[_0x45cc2b(0x158)]())[_0x45cc2b(0x116)](0x2,'0');}function a0_0x5764(_0x1535f2,_0x47a5c0){_0x1535f2=_0x1535f2-0xe6;const _0x4930a5=a0_0x395c();let _0x207b20=_0x4930a5[_0x1535f2];return _0x207b20;}function createMessageElement(_0x4d9f16,_0x244311){const _0x2465ff=a0_0x361d3b,_0x8301d4=document['createElement']('div');_0x8301d4['className']=_0x2465ff(0x141)+_0x4d9f16[_0x2465ff(0x150)];const _0x3a5509=document['createElement'](_0x2465ff(0x14e));_0x3a5509[_0x2465ff(0x14b)]=_0x2465ff(0x15b),_0x3a5509[_0x2465ff(0x138)]=_0x4d9f16['content'][_0x2465ff(0x13b)](/\n/g,_0x2465ff(0xf0));const _0x1dfd49=document[_0x2465ff(0x117)](_0x2465ff(0x14e));_0x1dfd49[_0x2465ff(0x14b)]=_0x2465ff(0x121),_0x1dfd49[_0x2465ff(0x138)]=_0x2465ff(0xfc),_0x1dfd49['onclick']=_0x499e7c=>{const _0x85cfc9=_0x2465ff;_0x499e7c[_0x85cfc9(0xf7)](),confirmDelete(_0x244311);};let _0x1614e1;_0x3a5509['addEventListener'](_0x2465ff(0x126),()=>_0x1614e1=setTimeout(()=>{const _0xec6543=_0x2465ff;_0x8301d4['classList'][_0xec6543(0x109)](_0xec6543(0xeb));if(tg?.[_0xec6543(0x143)])tg[_0xec6543(0x143)][_0xec6543(0x118)]('medium');},0x1f4)),_0x3a5509[_0x2465ff(0x133)](_0x2465ff(0x165),()=>clearTimeout(_0x1614e1));const _0x43d55d=document[_0x2465ff(0x117)]('div');return _0x43d55d['className']=_0x2465ff(0x167),_0x43d55d[_0x2465ff(0x163)]=formatTime(_0x4d9f16[_0x2465ff(0x156)]),_0x8301d4[_0x2465ff(0xfe)](_0x1dfd49),_0x8301d4[_0x2465ff(0xfe)](_0x3a5509),_0x8301d4[_0x2465ff(0xfe)](_0x43d55d),_0x8301d4;}function createTypingIndicator(){const _0x35f9e2=a0_0x361d3b,_0x14480d=document[_0x35f9e2(0x117)](_0x35f9e2(0x14e));return _0x14480d['className']=_0x35f9e2(0xf2),_0x14480d['id']=_0x35f9e2(0x161),_0x14480d['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x14480d;}function renderMessages(){const _0x1758d9=a0_0x361d3b;Array[_0x1758d9(0x115)](chatArea[_0x1758d9(0x166)])[_0x1758d9(0x11d)](_0x2b55d8=>{const _0x2f58f4=_0x1758d9;if(_0x2b55d8['id']!==_0x2f58f4(0xef))_0x2b55d8[_0x2f58f4(0x15f)]();}),messages[_0x1758d9(0x147)]>0x0?(emptyState['style'][_0x1758d9(0x108)]='none',messages[_0x1758d9(0x11d)]((_0x86aaf7,_0x1275b4)=>chatArea[_0x1758d9(0xfe)](createMessageElement(_0x86aaf7,_0x1275b4)))):emptyState[_0x1758d9(0xe8)][_0x1758d9(0x108)]=_0x1758d9(0xf1),requestAnimationFrame(()=>chatArea[_0x1758d9(0x140)]=chatArea[_0x1758d9(0x105)]);}function autoResizeTextarea(){const _0x56d7b4=a0_0x361d3b;messageInput[_0x56d7b4(0xe8)][_0x56d7b4(0x152)]=_0x56d7b4(0x10d),messageInput['style'][_0x56d7b4(0x152)]=Math[_0x56d7b4(0x123)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x234870=a0_0x361d3b,_0xc78cef=messageInput[_0x234870(0xf9)][_0x234870(0x12f)]();sendBtn[_0x234870(0x155)]=!_0xc78cef||isTyping;}async function sendMessage(){const _0x3257cd=a0_0x361d3b,_0x35b3df=messageInput[_0x3257cd(0xf9)][_0x3257cd(0x12f)]();if(!_0x35b3df||isTyping)return;if(tg?.[_0x3257cd(0x143)])tg[_0x3257cd(0x143)][_0x3257cd(0x118)]('light');messages[_0x3257cd(0xf8)]({'role':'user','content':_0x35b3df,'timestamp':Date[_0x3257cd(0x169)]()}),localStorage[_0x3257cd(0x159)](_0x3257cd(0x15c),JSON[_0x3257cd(0xfb)](messages)),renderMessages(),messageInput[_0x3257cd(0xf9)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x3257cd(0xfe)](createTypingIndicator()),chatArea[_0x3257cd(0x140)]=chatArea[_0x3257cd(0x105)];const _0x2c0f67=await callBackend('send_message',{'message':_0x35b3df});isTyping=![];const _0x4a62de=document[_0x3257cd(0x14d)]('typingIndicator');if(_0x4a62de)_0x4a62de[_0x3257cd(0x15f)]();let _0x459a9a=_0x3257cd(0xed);if(_0x2c0f67[_0x3257cd(0x129)]){_0x459a9a=_0x2c0f67[_0x3257cd(0x120)]||_0x3257cd(0x134);if(tg?.['HapticFeedback'])tg[_0x3257cd(0x143)]['notificationOccurred']('success');}else{_0x459a9a=_0x2c0f67[_0x3257cd(0x10e)]||'Ошибка\x20сервера';if(tg?.[_0x3257cd(0x143)])tg[_0x3257cd(0x143)]['notificationOccurred']('error');}messages[_0x3257cd(0xf8)]({'role':'ai','content':_0x459a9a,'timestamp':Date[_0x3257cd(0x169)]()}),localStorage[_0x3257cd(0x159)](_0x3257cd(0x15c),JSON[_0x3257cd(0xfb)](messages)),renderMessages();}function confirmDelete(_0x31f0a8){const _0x1f0b4f=a0_0x361d3b;if(mTitle)mTitle[_0x1f0b4f(0x163)]=_0x1f0b4f(0x131);if(mText)mText['textContent']=_0x1f0b4f(0x13d);modalCallback=()=>{const _0xeeed9=_0x1f0b4f;messages[_0xeeed9(0xf6)](_0x31f0a8,0x1),localStorage[_0xeeed9(0x159)](_0xeeed9(0x15c),JSON[_0xeeed9(0xfb)](messages)),renderMessages();},modal[_0x1f0b4f(0x11c)][_0x1f0b4f(0x109)](_0x1f0b4f(0x13f));}if(clearBtn)clearBtn[a0_0x361d3b(0x14f)]=()=>{const _0x5d1abc=a0_0x361d3b;if(!messages[_0x5d1abc(0x147)])return;if(mTitle)mTitle[_0x5d1abc(0x163)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x5d1abc(0x102);modalCallback=async()=>{const _0x3794ae=_0x5d1abc;messages=[],localStorage[_0x3794ae(0xec)](_0x3794ae(0x15c)),renderMessages(),callBackend(_0x3794ae(0x12b),{});},modal[_0x5d1abc(0x11c)][_0x5d1abc(0x109)](_0x5d1abc(0x13f));};document['getElementById'](a0_0x361d3b(0x135))[a0_0x361d3b(0x14f)]=()=>modal[a0_0x361d3b(0x11c)]['remove'](a0_0x361d3b(0x13f)),document[a0_0x361d3b(0x14d)](a0_0x361d3b(0xe6))[a0_0x361d3b(0x14f)]=()=>{const _0x28df34=a0_0x361d3b;if(modalCallback)modalCallback();modal[_0x28df34(0x11c)][_0x28df34(0x15f)]('show');},messageInput['addEventListener'](a0_0x361d3b(0xee),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x361d3b(0x133)](a0_0x361d3b(0x149),_0x3ef5d8=>{const _0x35ac83=a0_0x361d3b;_0x3ef5d8['key']==='Enter'&&!_0x3ef5d8['shiftKey']&&(_0x3ef5d8[_0x35ac83(0x11b)](),sendMessage());}),sendBtn[a0_0x361d3b(0x14f)]=sendMessage,document['addEventListener'](a0_0x361d3b(0x12a),_0xe7a60d=>{const _0x665d08=a0_0x361d3b;document[_0x665d08(0x160)](_0x665d08(0x136))['forEach'](_0x1b450a=>{const _0x53549a=_0x665d08;if(!_0x1b450a[_0x53549a(0x15e)](_0xe7a60d[_0x53549a(0xfd)]))_0x1b450a[_0x53549a(0x11c)]['remove'](_0x53549a(0xeb));});});const saved=localStorage[a0_0x361d3b(0xf3)](a0_0x361d3b(0x15c));if(saved)try{messages=JSON[a0_0x361d3b(0x125)](saved),renderMessages();}catch(a0_0x2459a9){}updateSendButton();