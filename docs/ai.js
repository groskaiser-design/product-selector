function a0_0x4bf8(){const _0x293be2=['warn','div','text/plain','onClick','paddingBottom','json','ai_chat_messages','990390SzcsCJ','innerHeight','appendChild','8uJobHb','Ошибка\x20сети','forEach','abort','user','chatArea','style','now','keydown','display','1905730xMBkSP','success','send_message','#050505','textContent','addEventListener','padStart','clearBtn','44874yceYyL','HapticFeedback','initDataUnsafe','show','onclick','.container','Начнется\x20новый\x20диалог.','add','parse','notificationOccurred','debug_uid','content','isVersionAtLeast','impactOccurred','role','Ошибка\x20сервера','message\x20ai','inputArea','1490LexLSr','385052eGAcPY','remove','setItem','message-time','scrollTop','Пустой\x20ответ','touchstart','length','./router.html','setHeaderColor','medium','key','stopPropagation','push','.message.show-delete','removeItem','6362671iuGAjB','height','trim','scrollHeight','(((.+)+)+)+$','toString','classList','first_name','value','message\x20','className','focus','click','shiftKey','resize','modalConfirm','emptyState','from','initData','light','getElementById','6smDEhl','Удалить?','offClick','innerHTML','floor','none','querySelector','createElement','Telegram','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Действие\x20необратимо.','children','modalText','getItem','input','typingIndicator','getMinutes','1989774dVYBcT','stringify','username','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','search','constructor','messageInput','2341796TwpzIK','WebApp','POST','timestamp','BackButton','disabled','viewportChanged','apply','show-delete','replace','delete-btn'];a0_0x4bf8=function(){return _0x293be2;};return a0_0x4bf8();}const a0_0x434fff=a0_0x9187;(function(_0x507bd7,_0x16ebab){const _0x4447c8=a0_0x9187,_0x37a022=_0x507bd7();while(!![]){try{const _0x1cc4a4=parseInt(_0x4447c8(0x10d))/0x1+parseInt(_0x4447c8(0x143))/0x2+-parseInt(_0x4447c8(0x132))/0x3*(parseInt(_0x4447c8(0x14a))/0x4)+parseInt(_0x4447c8(0x169))/0x5+parseInt(_0x4447c8(0x15c))/0x6+-parseInt(_0x4447c8(0x11d))/0x7*(parseInt(_0x4447c8(0x15f))/0x8)+-parseInt(_0x4447c8(0xfa))/0x9*(-parseInt(_0x4447c8(0x10c))/0xa);if(_0x1cc4a4===_0x16ebab)break;else _0x37a022['push'](_0x37a022['shift']());}catch(_0x1bc6a8){_0x37a022['push'](_0x37a022['shift']());}}}(a0_0x4bf8,0x8fd9d));const tg=window[a0_0x434fff(0x13a)]?.[a0_0x434fff(0x14b)],HOME_URL=a0_0x434fff(0x115);function setupTelegramBackButton(){const _0x55cf05=a0_0x434fff,_0x3a1d6e=(function(){let _0x4eda88=!![];return function(_0x12c4e1,_0x47cbc4){const _0x2682c8=_0x4eda88?function(){const _0x5af3da=a0_0x9187;if(_0x47cbc4){const _0x514a72=_0x47cbc4[_0x5af3da(0x151)](_0x12c4e1,arguments);return _0x47cbc4=null,_0x514a72;}}:function(){};return _0x4eda88=![],_0x2682c8;};}()),_0x5424ec=_0x3a1d6e(this,function(){const _0x2b139d=a0_0x9187;return _0x5424ec[_0x2b139d(0x122)]()['search']('(((.+)+)+)+$')['toString']()[_0x2b139d(0x148)](_0x5424ec)[_0x2b139d(0x147)](_0x2b139d(0x121));});_0x5424ec();if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x55cf05(0x116)]?.(_0x55cf05(0x16c));if(tg[_0x55cf05(0x106)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x3198fd=tg[_0x55cf05(0x14e)];if(_0x3198fd){_0x3198fd['show']();if(typeof _0x3198fd[_0x55cf05(0x134)]==='function')try{_0x3198fd['offClick']();}catch(_0x5e8fcf){}_0x3198fd[_0x55cf05(0x158)](()=>{const _0x16f238=_0x55cf05;if(tg['HapticFeedback'])tg[_0x16f238(0xfb)][_0x16f238(0x107)](_0x16f238(0x130));location['href']=HOME_URL;});}}catch(_0x1f8dbe){console[_0x55cf05(0x155)]('TG\x20setup\x20error:',_0x1f8dbe);}}(function initStableLayout(){const _0x576e8a=a0_0x434fff,_0x3d71d4=document[_0x576e8a(0x138)](_0x576e8a(0xff)),_0x1094c8=document[_0x576e8a(0x131)](_0x576e8a(0x10b)),_0x50aa8c=document['getElementById'](_0x576e8a(0x164)),_0x9d6e6d=document[_0x576e8a(0x131)](_0x576e8a(0x149));function _0x15f2ec(){const _0x482576=_0x576e8a;if(!_0x3d71d4)return;const _0x4bd37c=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x482576(0x15d)];_0x3d71d4['style'][_0x482576(0x11e)]=_0x4bd37c+'px';if(_0x1094c8){const _0x49c073=_0x1094c8['offsetHeight'];_0x50aa8c['style'][_0x482576(0x159)]=_0x49c073+0x28+'px';}}tg?tg['onEvent'](_0x576e8a(0x150),({isStateStable:_0x5435b2})=>{_0x15f2ec();if(_0x5435b2)requestAnimationFrame(()=>{const _0x20880b=a0_0x9187;_0x50aa8c[_0x20880b(0x111)]=_0x50aa8c[_0x20880b(0x120)];});}):window[_0x576e8a(0x16e)](_0x576e8a(0x12b),_0x15f2ec),_0x15f2ec(),_0x9d6e6d&&(_0x9d6e6d['addEventListener'](_0x576e8a(0x140),()=>{requestAnimationFrame(_0x15f2ec);}),_0x9d6e6d['addEventListener'](_0x576e8a(0x128),()=>{setTimeout(()=>{const _0xc89cc1=a0_0x9187;_0x50aa8c[_0xc89cc1(0x111)]=_0x50aa8c[_0xc89cc1(0x120)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x434fff(0x13b),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x434fff(0x164)),emptyState=document[a0_0x434fff(0x131)](a0_0x434fff(0x12d)),messageInput=document[a0_0x434fff(0x131)](a0_0x434fff(0x149)),sendBtn=document[a0_0x434fff(0x131)]('sendBtn'),clearBtn=document[a0_0x434fff(0x131)](a0_0x434fff(0x170)),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0x434fff(0x131)]('modalTitle'),mText=document['getElementById'](a0_0x434fff(0x13e));let modalCallback=null;async function callBackend(_0x4c7416,_0x2581e3){const _0x4bd082=a0_0x434fff,_0x17b6c0=tg?.[_0x4bd082(0xfc)]?.[_0x4bd082(0x163)]||{},_0x3e1c04=_0x17b6c0['id']||localStorage[_0x4bd082(0x13f)]('debug_uid')||'d-'+Math[_0x4bd082(0x136)](Math['random']()*0x3b9aca00);if(!_0x17b6c0['id'])localStorage[_0x4bd082(0x10f)](_0x4bd082(0x104),_0x3e1c04);const _0x4d45ab={'action':_0x4c7416,'user_id':_0x3e1c04,'user_data':{'first_name':_0x17b6c0[_0x4bd082(0x124)],'username':_0x17b6c0[_0x4bd082(0x145)]},'init_data':tg?.[_0x4bd082(0x12f)]||'',..._0x2581e3},_0xffd347=new AbortController(),_0x278123=setTimeout(()=>_0xffd347[_0x4bd082(0x162)](),REQUEST_TIMEOUT_MS);try{const _0x44daa0=await fetch(BACKEND_URL,{'method':_0x4bd082(0x14c),'headers':{'Content-Type':_0x4bd082(0x157)},'body':JSON[_0x4bd082(0x144)](_0x4d45ab),'signal':_0xffd347['signal']});return clearTimeout(_0x278123),await _0x44daa0[_0x4bd082(0x15a)]();}catch(_0x2b944b){return{'success':![],'error':String(_0x2b944b)};}}function formatTime(_0x3cbef2){const _0xaf0ed1=a0_0x434fff,_0x417cfd=new Date(_0x3cbef2);return String(_0x417cfd['getHours']())[_0xaf0ed1(0x16f)](0x2,'0')+':'+String(_0x417cfd[_0xaf0ed1(0x142)]())[_0xaf0ed1(0x16f)](0x2,'0');}function createMessageElement(_0x48e6b2,_0x238322){const _0x75a61=a0_0x434fff,_0x368a3b=document['createElement'](_0x75a61(0x156));_0x368a3b[_0x75a61(0x127)]=_0x75a61(0x126)+_0x48e6b2[_0x75a61(0x108)];const _0x59ab80=document[_0x75a61(0x139)](_0x75a61(0x156));_0x59ab80['className']='message-bubble',_0x59ab80[_0x75a61(0x135)]=_0x48e6b2[_0x75a61(0x105)][_0x75a61(0x153)](/\n/g,'<br>');const _0x4d1230=document[_0x75a61(0x139)](_0x75a61(0x156));_0x4d1230['className']=_0x75a61(0x154),_0x4d1230[_0x75a61(0x135)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x4d1230['onclick']=_0x37064b=>{const _0x18f87a=_0x75a61;_0x37064b[_0x18f87a(0x119)](),confirmDelete(_0x238322);};let _0x5b7d12;_0x59ab80['addEventListener'](_0x75a61(0x113),()=>_0x5b7d12=setTimeout(()=>{const _0x3f28f5=_0x75a61;_0x368a3b['classList'][_0x3f28f5(0x101)](_0x3f28f5(0x152));if(tg?.['HapticFeedback'])tg[_0x3f28f5(0xfb)][_0x3f28f5(0x107)](_0x3f28f5(0x117));},0x1f4)),_0x59ab80['addEventListener']('touchend',()=>clearTimeout(_0x5b7d12));const _0x5017d8=document[_0x75a61(0x139)](_0x75a61(0x156));return _0x5017d8[_0x75a61(0x127)]=_0x75a61(0x110),_0x5017d8[_0x75a61(0x16d)]=formatTime(_0x48e6b2[_0x75a61(0x14d)]),_0x368a3b['appendChild'](_0x4d1230),_0x368a3b[_0x75a61(0x15e)](_0x59ab80),_0x368a3b[_0x75a61(0x15e)](_0x5017d8),_0x368a3b;}function createTypingIndicator(){const _0x2229e4=a0_0x434fff,_0x2b368d=document[_0x2229e4(0x139)]('div');return _0x2b368d[_0x2229e4(0x127)]=_0x2229e4(0x10a),_0x2b368d['id']=_0x2229e4(0x141),_0x2b368d[_0x2229e4(0x135)]=_0x2229e4(0x146),_0x2b368d;}function renderMessages(){const _0x4e04dd=a0_0x434fff;Array[_0x4e04dd(0x12e)](chatArea[_0x4e04dd(0x13d)])[_0x4e04dd(0x161)](_0x432840=>{const _0x5eebbb=_0x4e04dd;if(_0x432840['id']!==_0x5eebbb(0x12d))_0x432840[_0x5eebbb(0x10e)]();}),messages['length']>0x0?(emptyState[_0x4e04dd(0x165)][_0x4e04dd(0x168)]=_0x4e04dd(0x137),messages[_0x4e04dd(0x161)]((_0x5f2fc8,_0xf2ed42)=>chatArea[_0x4e04dd(0x15e)](createMessageElement(_0x5f2fc8,_0xf2ed42)))):emptyState['style']['display']='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x1de198=a0_0x434fff;messageInput[_0x1de198(0x165)][_0x1de198(0x11e)]='auto',messageInput[_0x1de198(0x165)][_0x1de198(0x11e)]=Math['min'](messageInput[_0x1de198(0x120)],0x78)+'px';}function updateSendButton(){const _0x13bb2b=a0_0x434fff,_0x34d349=messageInput['value'][_0x13bb2b(0x11f)]();sendBtn[_0x13bb2b(0x14f)]=!_0x34d349||isTyping;}async function sendMessage(){const _0x4ee185=a0_0x434fff,_0x2df9f8=messageInput[_0x4ee185(0x125)][_0x4ee185(0x11f)]();if(!_0x2df9f8||isTyping)return;if(tg?.[_0x4ee185(0xfb)])tg[_0x4ee185(0xfb)][_0x4ee185(0x107)](_0x4ee185(0x130));messages[_0x4ee185(0x11a)]({'role':'user','content':_0x2df9f8,'timestamp':Date[_0x4ee185(0x166)]()}),localStorage['setItem'](_0x4ee185(0x15b),JSON['stringify'](messages)),renderMessages(),messageInput[_0x4ee185(0x125)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4ee185(0x15e)](createTypingIndicator()),chatArea[_0x4ee185(0x111)]=chatArea[_0x4ee185(0x120)];const _0x46919a=await callBackend(_0x4ee185(0x16b),{'message':_0x2df9f8});isTyping=![];const _0x5f24f2=document[_0x4ee185(0x131)](_0x4ee185(0x141));if(_0x5f24f2)_0x5f24f2[_0x4ee185(0x10e)]();let _0x10e60a=_0x4ee185(0x160);if(_0x46919a[_0x4ee185(0x16a)]){_0x10e60a=_0x46919a['text']||_0x4ee185(0x112);if(tg?.[_0x4ee185(0xfb)])tg['HapticFeedback'][_0x4ee185(0x103)](_0x4ee185(0x16a));}else{_0x10e60a=_0x46919a['error']||_0x4ee185(0x109);if(tg?.[_0x4ee185(0xfb)])tg[_0x4ee185(0xfb)]['notificationOccurred']('error');}messages['push']({'role':'ai','content':_0x10e60a,'timestamp':Date['now']()}),localStorage[_0x4ee185(0x10f)](_0x4ee185(0x15b),JSON[_0x4ee185(0x144)](messages)),renderMessages();}function confirmDelete(_0x2c9939){const _0x649ffb=a0_0x434fff;if(mTitle)mTitle[_0x649ffb(0x16d)]=_0x649ffb(0x133);if(mText)mText[_0x649ffb(0x16d)]=_0x649ffb(0x13c);modalCallback=()=>{const _0x5ec62b=_0x649ffb;messages['splice'](_0x2c9939,0x1),localStorage[_0x5ec62b(0x10f)](_0x5ec62b(0x15b),JSON[_0x5ec62b(0x144)](messages)),renderMessages();},modal[_0x649ffb(0x123)][_0x649ffb(0x101)]('show');}if(clearBtn)clearBtn[a0_0x434fff(0xfe)]=()=>{const _0x4563fb=a0_0x434fff;if(!messages[_0x4563fb(0x114)])return;if(mTitle)mTitle[_0x4563fb(0x16d)]='Очистить\x20историю?';if(mText)mText[_0x4563fb(0x16d)]=_0x4563fb(0x100);modalCallback=async()=>{const _0x5db754=_0x4563fb;messages=[],localStorage[_0x5db754(0x11c)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x4563fb(0x123)]['add'](_0x4563fb(0xfd));};function a0_0x9187(_0x1b6eb2,_0x5b616c){_0x1b6eb2=_0x1b6eb2-0xfa;const _0x3e7168=a0_0x4bf8();let _0x514267=_0x3e7168[_0x1b6eb2];return _0x514267;}document[a0_0x434fff(0x131)]('modalCancel')[a0_0x434fff(0xfe)]=()=>modal[a0_0x434fff(0x123)][a0_0x434fff(0x10e)]('show'),document['getElementById'](a0_0x434fff(0x12c))[a0_0x434fff(0xfe)]=()=>{const _0x60e9fc=a0_0x434fff;if(modalCallback)modalCallback();modal[_0x60e9fc(0x123)]['remove'](_0x60e9fc(0xfd));},messageInput['addEventListener'](a0_0x434fff(0x140),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x434fff(0x16e)](a0_0x434fff(0x167),_0x3aa8be=>{const _0x23a652=a0_0x434fff;_0x3aa8be[_0x23a652(0x118)]==='Enter'&&!_0x3aa8be[_0x23a652(0x12a)]&&(_0x3aa8be['preventDefault'](),sendMessage());}),sendBtn[a0_0x434fff(0xfe)]=sendMessage,document['addEventListener'](a0_0x434fff(0x129),_0x4d1f66=>{const _0x3d1a7b=a0_0x434fff;document['querySelectorAll'](_0x3d1a7b(0x11b))['forEach'](_0x295a47=>{const _0x3b56dc=_0x3d1a7b;if(!_0x295a47['contains'](_0x4d1f66['target']))_0x295a47[_0x3b56dc(0x123)]['remove'](_0x3b56dc(0x152));});});const saved=localStorage[a0_0x434fff(0x13f)](a0_0x434fff(0x15b));if(saved)try{messages=JSON[a0_0x434fff(0x102)](saved),renderMessages();}catch(a0_0x3cf51e){}updateSendButton();