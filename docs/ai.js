const a0_0x5e3679=a0_0x2ca7;(function(_0x3bd7f7,_0x3f6844){const _0xbc99b=a0_0x2ca7,_0x39728c=_0x3bd7f7();while(!![]){try{const _0x4e8dd4=-parseInt(_0xbc99b(0xf2))/0x1*(parseInt(_0xbc99b(0x144))/0x2)+-parseInt(_0xbc99b(0x14d))/0x3*(parseInt(_0xbc99b(0x111))/0x4)+-parseInt(_0xbc99b(0x10c))/0x5*(parseInt(_0xbc99b(0x136))/0x6)+-parseInt(_0xbc99b(0x131))/0x7*(-parseInt(_0xbc99b(0x15b))/0x8)+-parseInt(_0xbc99b(0x113))/0x9*(-parseInt(_0xbc99b(0x114))/0xa)+parseInt(_0xbc99b(0x11f))/0xb*(parseInt(_0xbc99b(0xea))/0xc)+parseInt(_0xbc99b(0xeb))/0xd*(-parseInt(_0xbc99b(0x121))/0xe);if(_0x4e8dd4===_0x3f6844)break;else _0x39728c['push'](_0x39728c['shift']());}catch(_0x4d301d){_0x39728c['push'](_0x39728c['shift']());}}}(a0_0x27dc,0xb6f42));const tg=window[a0_0x5e3679(0x143)]?.[a0_0x5e3679(0x135)],HOME_URL=a0_0x5e3679(0x118);function setupTelegramBackButton(){const _0x5aaadc=a0_0x5e3679;if(!tg)return;try{tg[_0x5aaadc(0x106)](),tg['expand'](),tg[_0x5aaadc(0x133)]?.('#050505');if(tg[_0x5aaadc(0x142)]?.(_0x5aaadc(0x10a)))tg['disableVerticalSwipes']?.();const _0x3dadf8=tg['BackButton'];if(_0x3dadf8){_0x3dadf8['show']();if(typeof _0x3dadf8[_0x5aaadc(0x14f)]===_0x5aaadc(0x137))try{_0x3dadf8[_0x5aaadc(0x14f)]();}catch(_0x810e98){}_0x3dadf8[_0x5aaadc(0xe6)](()=>{const _0x3e3625=_0x5aaadc;if(tg[_0x3e3625(0xfb)])tg[_0x3e3625(0xfb)][_0x3e3625(0xe9)](_0x3e3625(0x122));location['href']=HOME_URL;});}}catch(_0x1b1cf1){console[_0x5aaadc(0x129)]('TG\x20setup\x20error:',_0x1b1cf1);}}(function initStableLayout(){const _0x54d1c9=a0_0x5e3679,_0x473509=(function(){let _0x346332=!![];return function(_0x27c404,_0x3b37a6){const _0x157b4c=_0x346332?function(){const _0x58abfe=a0_0x2ca7;if(_0x3b37a6){const _0x17e9fc=_0x3b37a6[_0x58abfe(0x14a)](_0x27c404,arguments);return _0x3b37a6=null,_0x17e9fc;}}:function(){};return _0x346332=![],_0x157b4c;};}()),_0x125a79=document['querySelector'](_0x54d1c9(0xe4)),_0x2982bf=document[_0x54d1c9(0x119)](_0x54d1c9(0xfd)),_0x4d9b5f=document[_0x54d1c9(0x119)]('chatArea'),_0x36539d=document['getElementById'](_0x54d1c9(0x117));function _0x20fd07(){const _0x1480bb=_0x54d1c9,_0x53c26d=_0x473509(this,function(){const _0xd2a643=a0_0x2ca7;return _0x53c26d['toString']()[_0xd2a643(0xf0)]('(((.+)+)+)+$')[_0xd2a643(0x12a)]()[_0xd2a643(0x12b)](_0x53c26d)['search'](_0xd2a643(0x15a));});_0x53c26d();if(!_0x125a79)return;const _0x51aa8e=tg&&tg[_0x1480bb(0xfc)]?tg[_0x1480bb(0xfc)]:window['innerHeight'];_0x125a79[_0x1480bb(0x11b)][_0x1480bb(0x13a)]=_0x51aa8e+'px';if(_0x2982bf){const _0x31a66d=_0x2982bf['offsetHeight'];_0x4d9b5f['style'][_0x1480bb(0xfe)]=_0x31a66d+0x28+'px';}}tg?tg[_0x54d1c9(0xf7)](_0x54d1c9(0x112),({isStateStable:_0x4d7661})=>{_0x20fd07();if(_0x4d7661)requestAnimationFrame(()=>{const _0x180066=a0_0x2ca7;_0x4d9b5f[_0x180066(0xfa)]=_0x4d9b5f[_0x180066(0x153)];});}):window['addEventListener'](_0x54d1c9(0xe2),_0x20fd07),_0x20fd07(),_0x36539d&&(_0x36539d['addEventListener'](_0x54d1c9(0x14c),()=>{requestAnimationFrame(_0x20fd07);}),_0x36539d[_0x54d1c9(0xef)]('focus',()=>{setTimeout(()=>{const _0x1da4e5=a0_0x2ca7;_0x4d9b5f[_0x1da4e5(0xfa)]=_0x4d9b5f[_0x1da4e5(0x153)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5e3679(0x147),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x2ca7(_0x331838,_0x693280){_0x331838=_0x331838-0xe2;const _0x26d949=a0_0x27dc();let _0x486488=_0x26d949[_0x331838];return _0x486488;}const chatArea=document[a0_0x5e3679(0x119)](a0_0x5e3679(0x12d)),emptyState=document['getElementById'](a0_0x5e3679(0x115)),messageInput=document[a0_0x5e3679(0x119)](a0_0x5e3679(0x117)),sendBtn=document[a0_0x5e3679(0x119)](a0_0x5e3679(0x151)),clearBtn=document[a0_0x5e3679(0x119)](a0_0x5e3679(0x103)),modal=document[a0_0x5e3679(0x119)]('confirmModal'),mTitle=document[a0_0x5e3679(0x119)](a0_0x5e3679(0x126)),mText=document[a0_0x5e3679(0x119)]('modalText');let modalCallback=null;async function callBackend(_0x21e627,_0x543ce9){const _0x242317=a0_0x5e3679,_0x4a1585=tg?.[_0x242317(0x11d)]?.[_0x242317(0x104)]||{},_0x14360a=_0x4a1585['id']||localStorage[_0x242317(0x145)](_0x242317(0x12c))||'d-'+Math['floor'](Math[_0x242317(0x134)]()*0x3b9aca00);if(!_0x4a1585['id'])localStorage[_0x242317(0x120)](_0x242317(0x12c),_0x14360a);const _0x1d8d33={'action':_0x21e627,'user_id':_0x14360a,'user_data':{'first_name':_0x4a1585[_0x242317(0x10f)],'username':_0x4a1585[_0x242317(0xe7)]},'init_data':tg?.[_0x242317(0xe3)]||'',..._0x543ce9},_0x27761b=new AbortController(),_0x10d73a=setTimeout(()=>_0x27761b[_0x242317(0x13b)](),REQUEST_TIMEOUT_MS);try{const _0x5af732=await fetch(BACKEND_URL,{'method':_0x242317(0x13d),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x242317(0x128)](_0x1d8d33),'signal':_0x27761b['signal']});return clearTimeout(_0x10d73a),await _0x5af732[_0x242317(0xe8)]();}catch(_0x4690d6){return{'success':![],'error':String(_0x4690d6)};}}function formatTime(_0x16417e){const _0x2c7d1b=a0_0x5e3679,_0x581e5b=new Date(_0x16417e);return String(_0x581e5b[_0x2c7d1b(0x158)]())['padStart'](0x2,'0')+':'+String(_0x581e5b['getMinutes']())[_0x2c7d1b(0x146)](0x2,'0');}function createMessageElement(_0x59c77c,_0xfa5a09){const _0x3d3b7a=a0_0x5e3679,_0x44e3b5=document[_0x3d3b7a(0x12f)](_0x3d3b7a(0x141));_0x44e3b5[_0x3d3b7a(0xf9)]='message\x20'+_0x59c77c[_0x3d3b7a(0x13c)];const _0x2e4b43=document[_0x3d3b7a(0x12f)]('div');_0x2e4b43[_0x3d3b7a(0xf9)]='message-bubble',_0x2e4b43[_0x3d3b7a(0x156)]=_0x59c77c[_0x3d3b7a(0x154)]['replace'](/\n/g,_0x3d3b7a(0x11e));const _0x209049=document[_0x3d3b7a(0x12f)](_0x3d3b7a(0x141));_0x209049[_0x3d3b7a(0xf9)]='delete-btn',_0x209049[_0x3d3b7a(0x156)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x209049[_0x3d3b7a(0x100)]=_0x2c4b59=>{const _0x436b90=_0x3d3b7a;_0x2c4b59[_0x436b90(0x155)](),confirmDelete(_0xfa5a09);};let _0x2c5242;_0x2e4b43[_0x3d3b7a(0xef)]('touchstart',()=>_0x2c5242=setTimeout(()=>{const _0x328b5c=_0x3d3b7a;_0x44e3b5[_0x328b5c(0x110)][_0x328b5c(0x132)](_0x328b5c(0x12e));if(tg?.[_0x328b5c(0xfb)])tg[_0x328b5c(0xfb)]['impactOccurred']('medium');},0x1f4)),_0x2e4b43['addEventListener'](_0x3d3b7a(0x101),()=>clearTimeout(_0x2c5242));const _0x1d7890=document[_0x3d3b7a(0x12f)](_0x3d3b7a(0x141));return _0x1d7890[_0x3d3b7a(0xf9)]=_0x3d3b7a(0x138),_0x1d7890[_0x3d3b7a(0x13e)]=formatTime(_0x59c77c[_0x3d3b7a(0x123)]),_0x44e3b5[_0x3d3b7a(0xf6)](_0x209049),_0x44e3b5['appendChild'](_0x2e4b43),_0x44e3b5['appendChild'](_0x1d7890),_0x44e3b5;}function createTypingIndicator(){const _0x26c7b9=a0_0x5e3679,_0x9fb38a=document[_0x26c7b9(0x12f)](_0x26c7b9(0x141));return _0x9fb38a[_0x26c7b9(0xf9)]=_0x26c7b9(0xf8),_0x9fb38a['id']=_0x26c7b9(0x105),_0x9fb38a[_0x26c7b9(0x156)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x9fb38a;}function renderMessages(){const _0xbc41a3=a0_0x5e3679;Array[_0xbc41a3(0xff)](chatArea[_0xbc41a3(0x10b)])[_0xbc41a3(0x14b)](_0x27ee9a=>{const _0x16c0e4=_0xbc41a3;if(_0x27ee9a['id']!==_0x16c0e4(0x115))_0x27ee9a[_0x16c0e4(0xec)]();}),messages['length']>0x0?(emptyState[_0xbc41a3(0x11b)][_0xbc41a3(0x150)]=_0xbc41a3(0x152),messages[_0xbc41a3(0x14b)]((_0x25bc4d,_0x4a24e8)=>chatArea[_0xbc41a3(0xf6)](createMessageElement(_0x25bc4d,_0x4a24e8)))):emptyState[_0xbc41a3(0x11b)]['display']=_0xbc41a3(0x13f),requestAnimationFrame(()=>chatArea[_0xbc41a3(0xfa)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x2ce55c=a0_0x5e3679;messageInput[_0x2ce55c(0x11b)][_0x2ce55c(0x13a)]=_0x2ce55c(0xed),messageInput[_0x2ce55c(0x11b)]['height']=Math['min'](messageInput[_0x2ce55c(0x153)],0x78)+'px';}function updateSendButton(){const _0x19ce7c=a0_0x5e3679,_0x9b1101=messageInput[_0x19ce7c(0xf4)][_0x19ce7c(0x124)]();sendBtn['disabled']=!_0x9b1101||isTyping;}async function sendMessage(){const _0xd4e941=a0_0x5e3679,_0x3eac1f=messageInput[_0xd4e941(0xf4)][_0xd4e941(0x124)]();if(!_0x3eac1f||isTyping)return;if(tg?.['HapticFeedback'])tg[_0xd4e941(0xfb)]['impactOccurred'](_0xd4e941(0x122));messages[_0xd4e941(0xf1)]({'role':_0xd4e941(0x104),'content':_0x3eac1f,'timestamp':Date[_0xd4e941(0x125)]()}),localStorage['setItem'](_0xd4e941(0x127),JSON[_0xd4e941(0x128)](messages)),renderMessages(),messageInput[_0xd4e941(0xf4)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xd4e941(0xf6)](createTypingIndicator()),chatArea[_0xd4e941(0xfa)]=chatArea['scrollHeight'];const _0x4d317e=await callBackend(_0xd4e941(0x109),{'message':_0x3eac1f});isTyping=![];const _0x47729d=document['getElementById'](_0xd4e941(0x105));if(_0x47729d)_0x47729d['remove']();let _0x244e8e=_0xd4e941(0x159);if(_0x4d317e[_0xd4e941(0xf3)]){_0x244e8e=_0x4d317e[_0xd4e941(0x14e)]||_0xd4e941(0x108);if(tg?.['HapticFeedback'])tg[_0xd4e941(0xfb)]['notificationOccurred'](_0xd4e941(0xf3));}else{_0x244e8e=_0x4d317e[_0xd4e941(0x157)]||_0xd4e941(0x10e);if(tg?.[_0xd4e941(0xfb)])tg[_0xd4e941(0xfb)][_0xd4e941(0x11c)]('error');}messages[_0xd4e941(0xf1)]({'role':'ai','content':_0x244e8e,'timestamp':Date[_0xd4e941(0x125)]()}),localStorage[_0xd4e941(0x120)](_0xd4e941(0x127),JSON[_0xd4e941(0x128)](messages)),renderMessages();}function confirmDelete(_0x4d020d){const _0x49a9f2=a0_0x5e3679;if(mTitle)mTitle['textContent']=_0x49a9f2(0xe5);if(mText)mText[_0x49a9f2(0x13e)]='Действие\x20необратимо.';modalCallback=()=>{const _0x460418=_0x49a9f2;messages[_0x460418(0xee)](_0x4d020d,0x1),localStorage[_0x460418(0x120)]('ai_chat_messages',JSON[_0x460418(0x128)](messages)),renderMessages();},modal[_0x49a9f2(0x110)][_0x49a9f2(0x132)](_0x49a9f2(0x148));}if(clearBtn)clearBtn[a0_0x5e3679(0x100)]=()=>{const _0x58013d=a0_0x5e3679;if(!messages['length'])return;if(mTitle)mTitle[_0x58013d(0x13e)]=_0x58013d(0x10d);if(mText)mText['textContent']=_0x58013d(0x130);modalCallback=async()=>{const _0x827116=_0x58013d;messages=[],localStorage[_0x827116(0xf5)](_0x827116(0x127)),renderMessages(),callBackend('clear_history',{});},modal[_0x58013d(0x110)][_0x58013d(0x132)](_0x58013d(0x148));};document[a0_0x5e3679(0x119)](a0_0x5e3679(0x116))[a0_0x5e3679(0x100)]=()=>modal[a0_0x5e3679(0x110)][a0_0x5e3679(0xec)](a0_0x5e3679(0x148)),document[a0_0x5e3679(0x119)]('modalConfirm')[a0_0x5e3679(0x100)]=()=>{const _0x1895b2=a0_0x5e3679;if(modalCallback)modalCallback();modal[_0x1895b2(0x110)][_0x1895b2(0xec)](_0x1895b2(0x148));},messageInput[a0_0x5e3679(0xef)](a0_0x5e3679(0x14c),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5e3679(0xef)](a0_0x5e3679(0x107),_0x13b274=>{const _0x1be848=a0_0x5e3679;_0x13b274['key']==='Enter'&&!_0x13b274['shiftKey']&&(_0x13b274[_0x1be848(0x102)](),sendMessage());}),sendBtn[a0_0x5e3679(0x100)]=sendMessage,document['addEventListener']('click',_0x22d4ff=>{const _0x23f675=a0_0x5e3679;document[_0x23f675(0x149)](_0x23f675(0x140))[_0x23f675(0x14b)](_0xdaa70c=>{const _0xc8975d=_0x23f675;if(!_0xdaa70c['contains'](_0x22d4ff[_0xc8975d(0x11a)]))_0xdaa70c[_0xc8975d(0x110)][_0xc8975d(0xec)](_0xc8975d(0x12e));});});const saved=localStorage[a0_0x5e3679(0x145)](a0_0x5e3679(0x127));if(saved)try{messages=JSON[a0_0x5e3679(0x139)](saved),renderMessages();}catch(a0_0xabb185){}updateSendButton();function a0_0x27dc(){const _0x55f018=['WebApp','4206EkwsoU','function','message-time','parse','height','abort','role','POST','textContent','flex','.message.show-delete','div','isVersionAtLeast','Telegram','20xKSFCB','getItem','padStart','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','show','querySelectorAll','apply','forEach','input','3vhcPWW','text','offClick','display','sendBtn','none','scrollHeight','content','stopPropagation','innerHTML','error','getHours','Ошибка\x20сети','(((.+)+)+)+$','32qUgMAF','resize','initData','.container','Удалить?','onClick','username','json','impactOccurred','140460MNgZEc','13eKBTNr','remove','auto','splice','addEventListener','search','push','36644Aaixtk','success','value','removeItem','appendChild','onEvent','message\x20ai','className','scrollTop','HapticFeedback','viewportHeight','inputArea','paddingBottom','from','onclick','touchend','preventDefault','clearBtn','user','typingIndicator','ready','keydown','Пустой\x20ответ','send_message','6.1','children','6470ARJxKE','Очистить\x20историю?','Ошибка\x20сервера','first_name','classList','668652RxQzkP','viewportChanged','2205hHPJnM','52490ZaAjFS','emptyState','modalCancel','messageInput','./router.html','getElementById','target','style','notificationOccurred','initDataUnsafe','<br>','715JxQUQV','setItem','7165522QfJeuP','light','timestamp','trim','now','modalTitle','ai_chat_messages','stringify','warn','toString','constructor','debug_uid','chatArea','show-delete','createElement','Начнется\x20новый\x20диалог.','1146369EPatHk','add','setHeaderColor','random'];a0_0x27dc=function(){return _0x55f018;};return a0_0x27dc();}