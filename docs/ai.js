const a0_0xc22a2f=a0_0x3b8a;(function(_0x1e1d86,_0x1394d8){const _0x37bb17=a0_0x3b8a,_0x454d2f=_0x1e1d86();while(!![]){try{const _0x3d9ab3=parseInt(_0x37bb17(0x201))/0x1+parseInt(_0x37bb17(0x207))/0x2+parseInt(_0x37bb17(0x1f5))/0x3+parseInt(_0x37bb17(0x1cf))/0x4+-parseInt(_0x37bb17(0x1ff))/0x5+-parseInt(_0x37bb17(0x212))/0x6*(parseInt(_0x37bb17(0x1bc))/0x7)+parseInt(_0x37bb17(0x1f6))/0x8*(-parseInt(_0x37bb17(0x20f))/0x9);if(_0x3d9ab3===_0x1394d8)break;else _0x454d2f['push'](_0x454d2f['shift']());}catch(_0x490055){_0x454d2f['push'](_0x454d2f['shift']());}}}(a0_0x43a4,0x4d277));const tg=window['Telegram']?.[a0_0xc22a2f(0x1cd)],HOME_URL=a0_0xc22a2f(0x1bd);function setupTelegramBackButton(){const _0x14eeb5=a0_0xc22a2f;if(!tg)return;try{tg[_0x14eeb5(0x1ae)](),tg['expand'](),tg[_0x14eeb5(0x1d4)]?.(_0x14eeb5(0x1ad));if(tg[_0x14eeb5(0x206)]?.(_0x14eeb5(0x1a5)))tg[_0x14eeb5(0x1a3)]?.();const _0x253120=tg['BackButton'];if(_0x253120){_0x253120['show']();if(typeof _0x253120[_0x14eeb5(0x209)]===_0x14eeb5(0x1d6))try{_0x253120['offClick']();}catch(_0xa8a2b7){}_0x253120[_0x14eeb5(0x1d0)](()=>{const _0x4ca7d4=_0x14eeb5;if(tg['HapticFeedback'])tg['HapticFeedback'][_0x4ca7d4(0x1a4)](_0x4ca7d4(0x1a6));location['href']=HOME_URL;});}}catch(_0x4a0b11){console['warn'](_0x14eeb5(0x1d8),_0x4a0b11);}}(function initStableLayout(){const _0x2002f9=a0_0xc22a2f,_0x502453=(function(){let _0xbb199f=!![];return function(_0x691fbc,_0x83c724){const _0x402c9b=_0xbb199f?function(){const _0x2524c2=a0_0x3b8a;if(_0x83c724){const _0x16615b=_0x83c724[_0x2524c2(0x20c)](_0x691fbc,arguments);return _0x83c724=null,_0x16615b;}}:function(){};return _0xbb199f=![],_0x402c9b;};}()),_0x2828cd=document['querySelector'](_0x2002f9(0x1a1)),_0x4478e4=document[_0x2002f9(0x20d)](_0x2002f9(0x1b3)),_0x24fcc0=document[_0x2002f9(0x20d)](_0x2002f9(0x213)),_0x456857=document[_0x2002f9(0x20d)](_0x2002f9(0x1d7));function _0x2d2521(){const _0x9dff13=_0x2002f9,_0x5aec42=_0x502453(this,function(){const _0x208e57=a0_0x3b8a;return _0x5aec42['toString']()[_0x208e57(0x1c1)]('(((.+)+)+)+$')[_0x208e57(0x1ef)]()[_0x208e57(0x1cb)](_0x5aec42)['search'](_0x208e57(0x1ba));});_0x5aec42();if(!_0x2828cd)return;const _0x6efe1=tg&&tg[_0x9dff13(0x1ce)]?tg[_0x9dff13(0x1ce)]:window[_0x9dff13(0x1e7)];_0x2828cd[_0x9dff13(0x1fc)][_0x9dff13(0x1a7)]=_0x6efe1+'px';if(_0x4478e4){const _0x26271c=_0x4478e4[_0x9dff13(0x1e2)];_0x24fcc0[_0x9dff13(0x1fc)]['paddingBottom']=_0x26271c+0x28+'px';}}tg?tg['onEvent'](_0x2002f9(0x1e1),({isStateStable:_0x1215a4})=>{_0x2d2521();if(_0x1215a4)requestAnimationFrame(()=>{const _0x281449=a0_0x3b8a;_0x24fcc0['scrollTop']=_0x24fcc0[_0x281449(0x1be)];});}):window['addEventListener'](_0x2002f9(0x1fb),_0x2d2521),_0x2d2521(),_0x456857&&(_0x456857[_0x2002f9(0x1e9)](_0x2002f9(0x1f1),()=>{requestAnimationFrame(_0x2d2521);}),_0x456857[_0x2002f9(0x1e9)](_0x2002f9(0x203),()=>{setTimeout(()=>{const _0x1e9971=a0_0x3b8a;_0x24fcc0[_0x1e9971(0x215)]=_0x24fcc0[_0x1e9971(0x1be)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xc22a2f(0x1b1),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0xc22a2f(0x213)),emptyState=document['getElementById']('emptyState'),messageInput=document['getElementById'](a0_0xc22a2f(0x1d7)),sendBtn=document[a0_0xc22a2f(0x20d)]('sendBtn'),clearBtn=document[a0_0xc22a2f(0x20d)]('clearBtn'),modal=document[a0_0xc22a2f(0x20d)](a0_0xc22a2f(0x210)),mTitle=document['getElementById'](a0_0xc22a2f(0x1fa)),mText=document[a0_0xc22a2f(0x20d)](a0_0xc22a2f(0x1c0));function a0_0x43a4(){const _0x1de7cd=['modalTitle','resize','style','removeItem','trim','397395OtpwlG','stopPropagation','372585BEkOlg','POST','focus','message\x20','getItem','isVersionAtLeast','289046DOEasn','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','offClick','text/plain','touchend','apply','getElementById','first_name','54eidqbs','confirmModal','textContent','6wtEqlz','chatArea','remove','scrollTop','Пустой\x20ответ','push','debug_uid','length','ai_chat_messages','.container','stringify','disableVerticalSwipes','impactOccurred','6.1','light','height','notificationOccurred','random','auto','innerHTML','min','#050505','ready','modalConfirm','message\x20ai','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','appendChild','inputArea','text','send_message','Ошибка\x20сети','click','value','Очистить\x20историю?','(((.+)+)+)+$','div','1658951nJspXc','./router.html','scrollHeight','display','modalText','search','replace','Начнется\x20новый\x20диалог.','typingIndicator','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','success','add','json','touchstart','role','constructor','delete-btn','WebApp','viewportHeight','969588KSHajB','onClick','<br>','error','initData','setHeaderColor','createElement','function','messageInput','TG\x20setup\x20error:','keydown','shiftKey','emptyState','show','signal','Ошибка\x20сервера','getMinutes','onclick','viewportChanged','offsetHeight','user','classList','now','from','innerHeight','username','addEventListener','timestamp','padStart','children','forEach','splice','toString','medium','input','.message.show-delete','HapticFeedback','show-delete','396660dyLDVm','345640ZPfcGW','message-bubble','setItem','className'];a0_0x43a4=function(){return _0x1de7cd;};return a0_0x43a4();}let modalCallback=null;async function callBackend(_0x5e1fae,_0x14dee2){const _0x309243=a0_0xc22a2f,_0x1efc8d=tg?.['initDataUnsafe']?.[_0x309243(0x1e3)]||{},_0x5a308d=_0x1efc8d['id']||localStorage[_0x309243(0x205)]('debug_uid')||'d-'+Math['floor'](Math[_0x309243(0x1a9)]()*0x3b9aca00);if(!_0x1efc8d['id'])localStorage[_0x309243(0x1f8)](_0x309243(0x218),_0x5a308d);const _0x454928={'action':_0x5e1fae,'user_id':_0x5a308d,'user_data':{'first_name':_0x1efc8d[_0x309243(0x20e)],'username':_0x1efc8d[_0x309243(0x1e8)]},'init_data':tg?.[_0x309243(0x1d3)]||'',..._0x14dee2},_0x11bfdf=new AbortController(),_0x15a8fa=setTimeout(()=>_0x11bfdf['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5e7d8a=await fetch(BACKEND_URL,{'method':_0x309243(0x202),'headers':{'Content-Type':_0x309243(0x20a)},'body':JSON[_0x309243(0x1a2)](_0x454928),'signal':_0x11bfdf[_0x309243(0x1dd)]});return clearTimeout(_0x15a8fa),await _0x5e7d8a[_0x309243(0x1c8)]();}catch(_0xd0ef69){return{'success':![],'error':String(_0xd0ef69)};}}function formatTime(_0x36f40d){const _0x1d52d6=a0_0xc22a2f,_0x2f65e1=new Date(_0x36f40d);return String(_0x2f65e1['getHours']())['padStart'](0x2,'0')+':'+String(_0x2f65e1[_0x1d52d6(0x1df)]())[_0x1d52d6(0x1eb)](0x2,'0');}function createMessageElement(_0x4c10a9,_0x4dd1d9){const _0x2cc11f=a0_0xc22a2f,_0x272947=document[_0x2cc11f(0x1d5)](_0x2cc11f(0x1bb));_0x272947[_0x2cc11f(0x1f9)]=_0x2cc11f(0x204)+_0x4c10a9[_0x2cc11f(0x1ca)];const _0x131461=document[_0x2cc11f(0x1d5)](_0x2cc11f(0x1bb));_0x131461['className']=_0x2cc11f(0x1f7),_0x131461[_0x2cc11f(0x1ab)]=_0x4c10a9['content'][_0x2cc11f(0x1c2)](/\n/g,_0x2cc11f(0x1d1));const _0x4bb82d=document[_0x2cc11f(0x1d5)]('div');_0x4bb82d['className']=_0x2cc11f(0x1cc),_0x4bb82d[_0x2cc11f(0x1ab)]=_0x2cc11f(0x1c5),_0x4bb82d[_0x2cc11f(0x1e0)]=_0x598861=>{const _0x49a160=_0x2cc11f;_0x598861[_0x49a160(0x200)](),confirmDelete(_0x4dd1d9);};let _0x5eac6e;_0x131461[_0x2cc11f(0x1e9)](_0x2cc11f(0x1c9),()=>_0x5eac6e=setTimeout(()=>{const _0x4642fb=_0x2cc11f;_0x272947[_0x4642fb(0x1e4)][_0x4642fb(0x1c7)](_0x4642fb(0x1f4));if(tg?.[_0x4642fb(0x1f3)])tg[_0x4642fb(0x1f3)][_0x4642fb(0x1a4)](_0x4642fb(0x1f0));},0x1f4)),_0x131461[_0x2cc11f(0x1e9)](_0x2cc11f(0x20b),()=>clearTimeout(_0x5eac6e));const _0x310955=document[_0x2cc11f(0x1d5)](_0x2cc11f(0x1bb));return _0x310955[_0x2cc11f(0x1f9)]='message-time',_0x310955['textContent']=formatTime(_0x4c10a9[_0x2cc11f(0x1ea)]),_0x272947['appendChild'](_0x4bb82d),_0x272947[_0x2cc11f(0x1b2)](_0x131461),_0x272947[_0x2cc11f(0x1b2)](_0x310955),_0x272947;}function createTypingIndicator(){const _0x310b37=a0_0xc22a2f,_0x1b1f78=document[_0x310b37(0x1d5)]('div');return _0x1b1f78[_0x310b37(0x1f9)]=_0x310b37(0x1b0),_0x1b1f78['id']=_0x310b37(0x1c4),_0x1b1f78[_0x310b37(0x1ab)]=_0x310b37(0x208),_0x1b1f78;}function a0_0x3b8a(_0x1663ca,_0x3a223e){_0x1663ca=_0x1663ca-0x1a0;const _0x1a1443=a0_0x43a4();let _0x4fe5dc=_0x1a1443[_0x1663ca];return _0x4fe5dc;}function renderMessages(){const _0x2aaaff=a0_0xc22a2f;Array[_0x2aaaff(0x1e6)](chatArea[_0x2aaaff(0x1ec)])['forEach'](_0x1f6bb3=>{const _0x461133=_0x2aaaff;if(_0x1f6bb3['id']!==_0x461133(0x1db))_0x1f6bb3['remove']();}),messages[_0x2aaaff(0x219)]>0x0?(emptyState[_0x2aaaff(0x1fc)][_0x2aaaff(0x1bf)]='none',messages['forEach']((_0x3004ec,_0x2e1eaf)=>chatArea[_0x2aaaff(0x1b2)](createMessageElement(_0x3004ec,_0x2e1eaf)))):emptyState['style'][_0x2aaaff(0x1bf)]='flex',requestAnimationFrame(()=>chatArea[_0x2aaaff(0x215)]=chatArea[_0x2aaaff(0x1be)]);}function autoResizeTextarea(){const _0x49a966=a0_0xc22a2f;messageInput[_0x49a966(0x1fc)][_0x49a966(0x1a7)]=_0x49a966(0x1aa),messageInput['style'][_0x49a966(0x1a7)]=Math[_0x49a966(0x1ac)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x3ce313=a0_0xc22a2f,_0x24292d=messageInput[_0x3ce313(0x1b8)]['trim']();sendBtn['disabled']=!_0x24292d||isTyping;}async function sendMessage(){const _0x298b8b=a0_0xc22a2f,_0x219747=messageInput['value'][_0x298b8b(0x1fe)]();if(!_0x219747||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x298b8b(0x1f3)]['impactOccurred'](_0x298b8b(0x1a6));messages[_0x298b8b(0x217)]({'role':_0x298b8b(0x1e3),'content':_0x219747,'timestamp':Date[_0x298b8b(0x1e5)]()}),localStorage['setItem'](_0x298b8b(0x1a0),JSON[_0x298b8b(0x1a2)](messages)),renderMessages(),messageInput[_0x298b8b(0x1b8)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x298b8b(0x1b2)](createTypingIndicator()),chatArea[_0x298b8b(0x215)]=chatArea[_0x298b8b(0x1be)];const _0x42a8b7=await callBackend(_0x298b8b(0x1b5),{'message':_0x219747});isTyping=![];const _0x1bcca4=document[_0x298b8b(0x20d)]('typingIndicator');if(_0x1bcca4)_0x1bcca4[_0x298b8b(0x214)]();let _0x134da4=_0x298b8b(0x1b6);if(_0x42a8b7[_0x298b8b(0x1c6)]){_0x134da4=_0x42a8b7[_0x298b8b(0x1b4)]||_0x298b8b(0x216);if(tg?.['HapticFeedback'])tg[_0x298b8b(0x1f3)][_0x298b8b(0x1a8)](_0x298b8b(0x1c6));}else{_0x134da4=_0x42a8b7[_0x298b8b(0x1d2)]||_0x298b8b(0x1de);if(tg?.[_0x298b8b(0x1f3)])tg[_0x298b8b(0x1f3)][_0x298b8b(0x1a8)](_0x298b8b(0x1d2));}messages[_0x298b8b(0x217)]({'role':'ai','content':_0x134da4,'timestamp':Date['now']()}),localStorage['setItem'](_0x298b8b(0x1a0),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x236f45){const _0xb6e72a=a0_0xc22a2f;if(mTitle)mTitle[_0xb6e72a(0x211)]='Удалить?';if(mText)mText[_0xb6e72a(0x211)]='Действие\x20необратимо.';modalCallback=()=>{const _0x51bb80=_0xb6e72a;messages[_0x51bb80(0x1ee)](_0x236f45,0x1),localStorage[_0x51bb80(0x1f8)](_0x51bb80(0x1a0),JSON[_0x51bb80(0x1a2)](messages)),renderMessages();},modal[_0xb6e72a(0x1e4)][_0xb6e72a(0x1c7)](_0xb6e72a(0x1dc));}if(clearBtn)clearBtn[a0_0xc22a2f(0x1e0)]=()=>{const _0x5aef4d=a0_0xc22a2f;if(!messages[_0x5aef4d(0x219)])return;if(mTitle)mTitle[_0x5aef4d(0x211)]=_0x5aef4d(0x1b9);if(mText)mText[_0x5aef4d(0x211)]=_0x5aef4d(0x1c3);modalCallback=async()=>{const _0x377339=_0x5aef4d;messages=[],localStorage[_0x377339(0x1fd)](_0x377339(0x1a0)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x5aef4d(0x1c7)]('show');};document[a0_0xc22a2f(0x20d)]('modalCancel')[a0_0xc22a2f(0x1e0)]=()=>modal[a0_0xc22a2f(0x1e4)][a0_0xc22a2f(0x214)](a0_0xc22a2f(0x1dc)),document[a0_0xc22a2f(0x20d)](a0_0xc22a2f(0x1af))[a0_0xc22a2f(0x1e0)]=()=>{const _0x521928=a0_0xc22a2f;if(modalCallback)modalCallback();modal[_0x521928(0x1e4)]['remove'](_0x521928(0x1dc));},messageInput[a0_0xc22a2f(0x1e9)](a0_0xc22a2f(0x1f1),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xc22a2f(0x1e9)](a0_0xc22a2f(0x1d9),_0x30993b=>{const _0x357747=a0_0xc22a2f;_0x30993b['key']==='Enter'&&!_0x30993b[_0x357747(0x1da)]&&(_0x30993b['preventDefault'](),sendMessage());}),sendBtn[a0_0xc22a2f(0x1e0)]=sendMessage,document[a0_0xc22a2f(0x1e9)](a0_0xc22a2f(0x1b7),_0x4f62fc=>{const _0x43f416=a0_0xc22a2f;document['querySelectorAll'](_0x43f416(0x1f2))[_0x43f416(0x1ed)](_0x36d28c=>{const _0x2e9198=_0x43f416;if(!_0x36d28c['contains'](_0x4f62fc['target']))_0x36d28c[_0x2e9198(0x1e4)][_0x2e9198(0x214)](_0x2e9198(0x1f4));});});const saved=localStorage[a0_0xc22a2f(0x205)]('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x2848c5){}updateSendButton();