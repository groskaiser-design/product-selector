const a0_0x27ed4e=a0_0x2bdc;(function(_0x3a3654,_0x407476){const _0x443a6f=a0_0x2bdc,_0x130aba=_0x3a3654();while(!![]){try{const _0x4f0fec=-parseInt(_0x443a6f(0x135))/0x1+-parseInt(_0x443a6f(0x191))/0x2+parseInt(_0x443a6f(0x188))/0x3*(parseInt(_0x443a6f(0x187))/0x4)+-parseInt(_0x443a6f(0x172))/0x5*(-parseInt(_0x443a6f(0x13b))/0x6)+parseInt(_0x443a6f(0x142))/0x7+parseInt(_0x443a6f(0x12a))/0x8+parseInt(_0x443a6f(0x169))/0x9*(parseInt(_0x443a6f(0x119))/0xa);if(_0x4f0fec===_0x407476)break;else _0x130aba['push'](_0x130aba['shift']());}catch(_0x4d2595){_0x130aba['push'](_0x130aba['shift']());}}}(a0_0x55cf,0xd8801));const tg=window[a0_0x27ed4e(0x163)]?.['WebApp'],HOME_URL=a0_0x27ed4e(0x193);function setupTelegramBackButton(){const _0x2da5ab=a0_0x27ed4e,_0x1031a6=(function(){let _0x400381=!![];return function(_0x2d67fd,_0xb23a7){const _0x12a9dc=_0x400381?function(){if(_0xb23a7){const _0xf19b50=_0xb23a7['apply'](_0x2d67fd,arguments);return _0xb23a7=null,_0xf19b50;}}:function(){};return _0x400381=![],_0x12a9dc;};}()),_0x106f77=_0x1031a6(this,function(){const _0x559e1d=a0_0x2bdc;return _0x106f77[_0x559e1d(0x170)]()['search'](_0x559e1d(0x162))[_0x559e1d(0x170)]()[_0x559e1d(0x14b)](_0x106f77)['search']('(((.+)+)+)+$');});_0x106f77();if(!tg)return;try{tg[_0x2da5ab(0x152)](),tg[_0x2da5ab(0x13a)](),tg[_0x2da5ab(0x175)]?.(_0x2da5ab(0x151));if(tg[_0x2da5ab(0x156)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x29ca3c=tg[_0x2da5ab(0x16a)];if(_0x29ca3c){_0x29ca3c[_0x2da5ab(0x160)]();if(typeof _0x29ca3c[_0x2da5ab(0x16e)]===_0x2da5ab(0x129))try{_0x29ca3c['offClick']();}catch(_0x1655da){}_0x29ca3c['onClick'](()=>{const _0x40ec89=_0x2da5ab;if(tg[_0x40ec89(0x12b)])tg[_0x40ec89(0x12b)][_0x40ec89(0x122)](_0x40ec89(0x136));location[_0x40ec89(0x17d)]=HOME_URL;});}}catch(_0x540b09){console[_0x2da5ab(0x148)](_0x2da5ab(0x12c),_0x540b09);}}(function initStableLayout(){const _0x2a960b=a0_0x27ed4e,_0x3969b5=document['querySelector']('.container'),_0x44830b=document[_0x2a960b(0x147)]('inputArea'),_0x412fb9=document[_0x2a960b(0x147)](_0x2a960b(0x13d)),_0x17e6ae=document[_0x2a960b(0x147)](_0x2a960b(0x155));function _0x1f7ef4(){const _0x2d24b3=_0x2a960b;if(!_0x3969b5)return;const _0x39b74c=tg&&tg[_0x2d24b3(0x189)]?tg[_0x2d24b3(0x189)]:window[_0x2d24b3(0x16b)];_0x3969b5[_0x2d24b3(0x130)][_0x2d24b3(0x167)]=_0x39b74c+'px';if(_0x44830b){const _0x38a7fd=_0x44830b[_0x2d24b3(0x11c)];_0x412fb9[_0x2d24b3(0x130)][_0x2d24b3(0x12f)]=_0x38a7fd+0x28+'px';}}tg?tg[_0x2a960b(0x158)](_0x2a960b(0x132),({isStateStable:_0x41d74e})=>{_0x1f7ef4();if(_0x41d74e)requestAnimationFrame(()=>{const _0x5bcf38=a0_0x2bdc;_0x412fb9['scrollTop']=_0x412fb9[_0x5bcf38(0x127)];});}):window['addEventListener'](_0x2a960b(0x18e),_0x1f7ef4),_0x1f7ef4(),_0x17e6ae&&(_0x17e6ae[_0x2a960b(0x146)](_0x2a960b(0x166),()=>{requestAnimationFrame(_0x1f7ef4);}),_0x17e6ae[_0x2a960b(0x146)](_0x2a960b(0x144),()=>{setTimeout(()=>{const _0x193244=a0_0x2bdc;_0x412fb9[_0x193244(0x180)]=_0x412fb9[_0x193244(0x127)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x27ed4e(0x137),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x27ed4e(0x147)](a0_0x27ed4e(0x13d)),emptyState=document['getElementById'](a0_0x27ed4e(0x139)),messageInput=document[a0_0x27ed4e(0x147)](a0_0x27ed4e(0x155)),sendBtn=document['getElementById'](a0_0x27ed4e(0x17a)),clearBtn=document[a0_0x27ed4e(0x147)](a0_0x27ed4e(0x177)),modal=document[a0_0x27ed4e(0x147)](a0_0x27ed4e(0x161)),mTitle=document[a0_0x27ed4e(0x147)]('modalTitle'),mText=document[a0_0x27ed4e(0x147)]('modalText');let modalCallback=null;async function callBackend(_0x454d1a,_0x1b3a24){const _0x43a0f3=a0_0x27ed4e,_0x51bed5=tg?.[_0x43a0f3(0x13f)]?.[_0x43a0f3(0x18f)]||{},_0xb6b553=_0x51bed5['id']||localStorage[_0x43a0f3(0x165)](_0x43a0f3(0x15b))||'d-'+Math[_0x43a0f3(0x143)](Math['random']()*0x3b9aca00);if(!_0x51bed5['id'])localStorage['setItem'](_0x43a0f3(0x15b),_0xb6b553);const _0x371945={'action':_0x454d1a,'user_id':_0xb6b553,'user_data':{'first_name':_0x51bed5['first_name'],'username':_0x51bed5[_0x43a0f3(0x179)]},'init_data':tg?.['initData']||'',..._0x1b3a24},_0x363ae9=new AbortController(),_0x293d25=setTimeout(()=>_0x363ae9['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5e0c46=await fetch(BACKEND_URL,{'method':_0x43a0f3(0x164),'headers':{'Content-Type':_0x43a0f3(0x13c)},'body':JSON[_0x43a0f3(0x140)](_0x371945),'signal':_0x363ae9[_0x43a0f3(0x15c)]});return clearTimeout(_0x293d25),await _0x5e0c46[_0x43a0f3(0x17f)]();}catch(_0x36bf5d){return{'success':![],'error':String(_0x36bf5d)};}}function formatTime(_0xd594ed){const _0x2660a9=a0_0x27ed4e,_0x23c527=new Date(_0xd594ed);return String(_0x23c527[_0x2660a9(0x145)]())['padStart'](0x2,'0')+':'+String(_0x23c527[_0x2660a9(0x16f)]())[_0x2660a9(0x150)](0x2,'0');}function createMessageElement(_0x1643c4,_0x4f1ef6){const _0x58dd5d=a0_0x27ed4e,_0x3da540=document[_0x58dd5d(0x14f)](_0x58dd5d(0x14a));_0x3da540[_0x58dd5d(0x133)]='message\x20'+_0x1643c4[_0x58dd5d(0x138)];const _0x54633c=document['createElement']('div');_0x54633c[_0x58dd5d(0x133)]=_0x58dd5d(0x183),_0x54633c[_0x58dd5d(0x14d)]=_0x1643c4[_0x58dd5d(0x12d)]['replace'](/\n/g,_0x58dd5d(0x16d));const _0x3117be=document[_0x58dd5d(0x14f)](_0x58dd5d(0x14a));_0x3117be['className']=_0x58dd5d(0x176),_0x3117be[_0x58dd5d(0x14d)]=_0x58dd5d(0x124),_0x3117be[_0x58dd5d(0x11b)]=_0x1bbf7e=>{const _0x29602e=_0x58dd5d;_0x1bbf7e[_0x29602e(0x120)](),confirmDelete(_0x4f1ef6);};let _0x1dfa52;_0x54633c[_0x58dd5d(0x146)]('touchstart',()=>_0x1dfa52=setTimeout(()=>{const _0x3f299c=_0x58dd5d;_0x3da540[_0x3f299c(0x17e)][_0x3f299c(0x11a)](_0x3f299c(0x11d));if(tg?.[_0x3f299c(0x12b)])tg[_0x3f299c(0x12b)][_0x3f299c(0x122)]('medium');},0x1f4)),_0x54633c[_0x58dd5d(0x146)](_0x58dd5d(0x15a),()=>clearTimeout(_0x1dfa52));const _0x42b838=document[_0x58dd5d(0x14f)](_0x58dd5d(0x14a));return _0x42b838[_0x58dd5d(0x133)]=_0x58dd5d(0x186),_0x42b838[_0x58dd5d(0x13e)]=formatTime(_0x1643c4[_0x58dd5d(0x173)]),_0x3da540[_0x58dd5d(0x11f)](_0x3117be),_0x3da540[_0x58dd5d(0x11f)](_0x54633c),_0x3da540[_0x58dd5d(0x11f)](_0x42b838),_0x3da540;}function createTypingIndicator(){const _0xd97a2b=a0_0x27ed4e,_0x401ca4=document[_0xd97a2b(0x14f)](_0xd97a2b(0x14a));return _0x401ca4[_0xd97a2b(0x133)]=_0xd97a2b(0x168),_0x401ca4['id']=_0xd97a2b(0x16c),_0x401ca4['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x401ca4;}function a0_0x55cf(){const _0x89719f=['offClick','getMinutes','toString','Ошибка\x20сети','80735ODjKsX','timestamp','Пустой\x20ответ','setHeaderColor','delete-btn','clearBtn','target','username','sendBtn','send_message','now','href','classList','json','scrollTop','push','display','message-bubble','forEach','text','message-time','4RaXzIM','905946KnoOGU','viewportHeight','none','Удалить?','parse','disabled','resize','user','auto','3145444YejJaZ','Очистить\x20историю?','./router.html','value','310510muCktw','add','onclick','offsetHeight','show-delete','clear_history','appendChild','stopPropagation','modalConfirm','impactOccurred','children','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','trim','error','scrollHeight','remove','function','2782752GiyLvp','HapticFeedback','TG\x20setup\x20error:','content','success','paddingBottom','style','Действие\x20необратимо.','viewportChanged','className','Ошибка\x20сервера','852161JqISgP','light','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','role','emptyState','expand','402TVGDru','text/plain','chatArea','textContent','initDataUnsafe','stringify','preventDefault','409458KveoZF','floor','focus','getHours','addEventListener','getElementById','warn','contains','div','constructor','keydown','innerHTML','setItem','createElement','padStart','#050505','ready','notificationOccurred','ai_chat_messages','messageInput','isVersionAtLeast','splice','onEvent','length','touchend','debug_uid','signal','Enter','.message.show-delete','removeItem','show','confirmModal','(((.+)+)+)+$','Telegram','POST','getItem','input','height','message\x20ai','441fMmWBq','BackButton','innerHeight','typingIndicator','<br>'];a0_0x55cf=function(){return _0x89719f;};return a0_0x55cf();}function renderMessages(){const _0x375c06=a0_0x27ed4e;Array['from'](chatArea[_0x375c06(0x123)])[_0x375c06(0x184)](_0x40641b=>{const _0x5c4dcf=_0x375c06;if(_0x40641b['id']!=='emptyState')_0x40641b[_0x5c4dcf(0x128)]();}),messages[_0x375c06(0x159)]>0x0?(emptyState[_0x375c06(0x130)]['display']=_0x375c06(0x18a),messages[_0x375c06(0x184)]((_0x1eecb9,_0x538628)=>chatArea[_0x375c06(0x11f)](createMessageElement(_0x1eecb9,_0x538628)))):emptyState[_0x375c06(0x130)][_0x375c06(0x182)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x375c06(0x127)]);}function a0_0x2bdc(_0x4149a5,_0x321ff3){_0x4149a5=_0x4149a5-0x118;const _0x4c11f1=a0_0x55cf();let _0x539ce4=_0x4c11f1[_0x4149a5];return _0x539ce4;}function autoResizeTextarea(){const _0x324371=a0_0x27ed4e;messageInput[_0x324371(0x130)][_0x324371(0x167)]=_0x324371(0x190),messageInput['style'][_0x324371(0x167)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x36add9=a0_0x27ed4e,_0x3cf1a5=messageInput[_0x36add9(0x118)][_0x36add9(0x125)]();sendBtn[_0x36add9(0x18d)]=!_0x3cf1a5||isTyping;}async function sendMessage(){const _0x21c3a6=a0_0x27ed4e,_0x183551=messageInput['value'][_0x21c3a6(0x125)]();if(!_0x183551||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x21c3a6(0x122)](_0x21c3a6(0x136));messages['push']({'role':_0x21c3a6(0x18f),'content':_0x183551,'timestamp':Date[_0x21c3a6(0x17c)]()}),localStorage[_0x21c3a6(0x14e)](_0x21c3a6(0x154),JSON[_0x21c3a6(0x140)](messages)),renderMessages(),messageInput[_0x21c3a6(0x118)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x21c3a6(0x11f)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x21c3a6(0x127)];const _0x3b9b71=await callBackend(_0x21c3a6(0x17b),{'message':_0x183551});isTyping=![];const _0x72b30e=document[_0x21c3a6(0x147)](_0x21c3a6(0x16c));if(_0x72b30e)_0x72b30e['remove']();let _0x59bca6=_0x21c3a6(0x171);if(_0x3b9b71[_0x21c3a6(0x12e)]){_0x59bca6=_0x3b9b71[_0x21c3a6(0x185)]||_0x21c3a6(0x174);if(tg?.[_0x21c3a6(0x12b)])tg['HapticFeedback']['notificationOccurred'](_0x21c3a6(0x12e));}else{_0x59bca6=_0x3b9b71['error']||_0x21c3a6(0x134);if(tg?.['HapticFeedback'])tg[_0x21c3a6(0x12b)][_0x21c3a6(0x153)](_0x21c3a6(0x126));}messages[_0x21c3a6(0x181)]({'role':'ai','content':_0x59bca6,'timestamp':Date['now']()}),localStorage[_0x21c3a6(0x14e)](_0x21c3a6(0x154),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x299d69){const _0x29ab47=a0_0x27ed4e;if(mTitle)mTitle[_0x29ab47(0x13e)]=_0x29ab47(0x18b);if(mText)mText[_0x29ab47(0x13e)]=_0x29ab47(0x131);modalCallback=()=>{const _0x390a12=_0x29ab47;messages[_0x390a12(0x157)](_0x299d69,0x1),localStorage[_0x390a12(0x14e)](_0x390a12(0x154),JSON[_0x390a12(0x140)](messages)),renderMessages();},modal[_0x29ab47(0x17e)][_0x29ab47(0x11a)](_0x29ab47(0x160));}if(clearBtn)clearBtn[a0_0x27ed4e(0x11b)]=()=>{const _0x1e030f=a0_0x27ed4e;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x1e030f(0x192);if(mText)mText[_0x1e030f(0x13e)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x103900=_0x1e030f;messages=[],localStorage[_0x103900(0x15f)](_0x103900(0x154)),renderMessages(),callBackend(_0x103900(0x11e),{});},modal[_0x1e030f(0x17e)][_0x1e030f(0x11a)](_0x1e030f(0x160));};document[a0_0x27ed4e(0x147)]('modalCancel')[a0_0x27ed4e(0x11b)]=()=>modal[a0_0x27ed4e(0x17e)]['remove']('show'),document['getElementById'](a0_0x27ed4e(0x121))[a0_0x27ed4e(0x11b)]=()=>{const _0x45c333=a0_0x27ed4e;if(modalCallback)modalCallback();modal['classList']['remove'](_0x45c333(0x160));},messageInput['addEventListener'](a0_0x27ed4e(0x166),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x27ed4e(0x14c),_0x111a96=>{const _0x240780=a0_0x27ed4e;_0x111a96['key']===_0x240780(0x15d)&&!_0x111a96['shiftKey']&&(_0x111a96[_0x240780(0x141)](),sendMessage());}),sendBtn[a0_0x27ed4e(0x11b)]=sendMessage,document[a0_0x27ed4e(0x146)]('click',_0x4b683f=>{const _0x436bab=a0_0x27ed4e;document['querySelectorAll'](_0x436bab(0x15e))[_0x436bab(0x184)](_0x4f3190=>{const _0x2fef2c=_0x436bab;if(!_0x4f3190[_0x2fef2c(0x149)](_0x4b683f[_0x2fef2c(0x178)]))_0x4f3190[_0x2fef2c(0x17e)][_0x2fef2c(0x128)]('show-delete');});});const saved=localStorage[a0_0x27ed4e(0x165)](a0_0x27ed4e(0x154));if(saved)try{messages=JSON[a0_0x27ed4e(0x18c)](saved),renderMessages();}catch(a0_0x2b335a){}updateSendButton();