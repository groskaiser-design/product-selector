const a0_0x2ebe65=a0_0x50c6;(function(_0x7cd290,_0x51a474){const _0x265f74=a0_0x50c6,_0x3caa56=_0x7cd290();while(!![]){try{const _0x5a5d7b=parseInt(_0x265f74(0xb9))/0x1+-parseInt(_0x265f74(0x7f))/0x2+-parseInt(_0x265f74(0xdd))/0x3*(-parseInt(_0x265f74(0xc5))/0x4)+-parseInt(_0x265f74(0x81))/0x5+-parseInt(_0x265f74(0xb4))/0x6+parseInt(_0x265f74(0xd5))/0x7+parseInt(_0x265f74(0xa6))/0x8;if(_0x5a5d7b===_0x51a474)break;else _0x3caa56['push'](_0x3caa56['shift']());}catch(_0x2b8949){_0x3caa56['push'](_0x3caa56['shift']());}}}(a0_0x292c,0x4536f));const tg=window[a0_0x2ebe65(0xbe)]?.[a0_0x2ebe65(0xad)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x4eca89=a0_0x2ebe65,_0x20fd47=(function(){let _0x4e141f=!![];return function(_0x3f877d,_0x1a16b2){const _0x55ac1d=_0x4e141f?function(){if(_0x1a16b2){const _0x181ca9=_0x1a16b2['apply'](_0x3f877d,arguments);return _0x1a16b2=null,_0x181ca9;}}:function(){};return _0x4e141f=![],_0x55ac1d;};}()),_0x4de900=_0x20fd47(this,function(){const _0x29ee73=a0_0x50c6;return _0x4de900['toString']()[_0x29ee73(0x98)](_0x29ee73(0x8c))[_0x29ee73(0x8d)]()[_0x29ee73(0xcd)](_0x4de900)[_0x29ee73(0x98)]('(((.+)+)+)+$');});_0x4de900();if(!tg)return;try{tg[_0x4eca89(0xed)](),tg[_0x4eca89(0x7e)](),tg[_0x4eca89(0xdf)]?.(_0x4eca89(0x9b));if(tg[_0x4eca89(0xd2)]?.(_0x4eca89(0x99)))tg['disableVerticalSwipes']?.();const _0x2f0375=tg['BackButton'];if(_0x2f0375){_0x2f0375[_0x4eca89(0xf8)]();if(typeof _0x2f0375['offClick']===_0x4eca89(0xfa))try{_0x2f0375[_0x4eca89(0xe3)]();}catch(_0x40bfdd){}_0x2f0375['onClick'](()=>{const _0x5904d5=_0x4eca89;if(tg[_0x5904d5(0xf4)])tg[_0x5904d5(0xf4)]['impactOccurred'](_0x5904d5(0x8e));location[_0x5904d5(0xb5)]=HOME_URL;});}}catch(_0x29d987){console[_0x4eca89(0xa4)](_0x4eca89(0x9d),_0x29d987);}}(function initStableLayout(){const _0x30e8d9=a0_0x2ebe65,_0x3e7348=document[_0x30e8d9(0xe5)](_0x30e8d9(0xfd)),_0x3001eb=document[_0x30e8d9(0xe7)](_0x30e8d9(0x90)),_0x26ddf7=document['getElementById']('chatArea'),_0x465342=document[_0x30e8d9(0xe7)](_0x30e8d9(0x83));function _0x11c427(){const _0x2f1c52=_0x30e8d9;if(!_0x3e7348)return;const _0x37edae=tg&&tg[_0x2f1c52(0xe9)]?tg[_0x2f1c52(0xe9)]:window[_0x2f1c52(0xc8)];_0x3e7348['style'][_0x2f1c52(0xc3)]=_0x37edae+'px';if(_0x3001eb){const _0xc192b5=_0x3001eb[_0x2f1c52(0xef)];_0x26ddf7['style'][_0x2f1c52(0x8a)]=_0xc192b5+0x28+'px';}}tg?tg[_0x30e8d9(0x96)]('viewportChanged',({isStateStable:_0x119b53})=>{_0x11c427();if(_0x119b53)requestAnimationFrame(()=>{const _0x1f4dd2=a0_0x50c6;_0x26ddf7[_0x1f4dd2(0xd0)]=_0x26ddf7[_0x1f4dd2(0xcf)];});}):window[_0x30e8d9(0xcb)]('resize',_0x11c427),_0x11c427(),_0x465342&&(_0x465342[_0x30e8d9(0xcb)]('input',()=>{requestAnimationFrame(_0x11c427);}),_0x465342[_0x30e8d9(0xcb)](_0x30e8d9(0x9f),()=>{setTimeout(()=>{const _0x4f93cf=a0_0x50c6;_0x26ddf7[_0x4f93cf(0xd0)]=_0x26ddf7[_0x4f93cf(0xcf)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2ebe65(0xa7),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2ebe65(0xe7)](a0_0x2ebe65(0xfc)),emptyState=document[a0_0x2ebe65(0xe7)]('emptyState'),messageInput=document[a0_0x2ebe65(0xe7)](a0_0x2ebe65(0x83)),sendBtn=document[a0_0x2ebe65(0xe7)](a0_0x2ebe65(0xc9)),clearBtn=document[a0_0x2ebe65(0xe7)](a0_0x2ebe65(0x8f)),modal=document[a0_0x2ebe65(0xe7)](a0_0x2ebe65(0xf7)),mTitle=document[a0_0x2ebe65(0xe7)](a0_0x2ebe65(0x97)),mText=document[a0_0x2ebe65(0xe7)](a0_0x2ebe65(0xab));let modalCallback=null;async function callBackend(_0x59cce7,_0x57ae63){const _0x3613ba=a0_0x2ebe65,_0x1e4100=tg?.[_0x3613ba(0xbf)]?.[_0x3613ba(0xb3)]||{},_0x5bbe62=_0x1e4100['id']||localStorage[_0x3613ba(0xca)](_0x3613ba(0xdc))||'d-'+Math[_0x3613ba(0x86)](Math['random']()*0x3b9aca00);if(!_0x1e4100['id'])localStorage[_0x3613ba(0xaa)](_0x3613ba(0xdc),_0x5bbe62);const _0x2d08db={'action':_0x59cce7,'user_id':_0x5bbe62,'user_data':{'first_name':_0x1e4100[_0x3613ba(0xce)],'username':_0x1e4100['username']},'init_data':tg?.[_0x3613ba(0xf1)]||'',..._0x57ae63},_0x4f2ddb=new AbortController(),_0x20a97f=setTimeout(()=>_0x4f2ddb[_0x3613ba(0xd3)](),REQUEST_TIMEOUT_MS);try{const _0x48e713=await fetch(BACKEND_URL,{'method':_0x3613ba(0xa9),'headers':{'Content-Type':_0x3613ba(0xc1)},'body':JSON[_0x3613ba(0xeb)](_0x2d08db),'signal':_0x4f2ddb[_0x3613ba(0xf6)]});return clearTimeout(_0x20a97f),await _0x48e713[_0x3613ba(0xde)]();}catch(_0x14669d){return{'success':![],'error':String(_0x14669d)};}}function formatTime(_0x108842){const _0x45b77e=a0_0x2ebe65,_0x2db77f=new Date(_0x108842);return String(_0x2db77f[_0x45b77e(0xb0)]())[_0x45b77e(0xaf)](0x2,'0')+':'+String(_0x2db77f[_0x45b77e(0xc6)]())['padStart'](0x2,'0');}function createMessageElement(_0xce5cb9,_0x5398d1){const _0x395bca=a0_0x2ebe65,_0x4f6ace=document[_0x395bca(0xbc)](_0x395bca(0x91));_0x4f6ace['className']=_0x395bca(0xd8)+_0xce5cb9['role'];const _0x48b00a=document[_0x395bca(0xbc)]('div');_0x48b00a[_0x395bca(0xb7)]=_0x395bca(0xcc),_0x48b00a[_0x395bca(0xc4)]=_0xce5cb9['content']['replace'](/\n/g,_0x395bca(0xdb));const _0x572476=document[_0x395bca(0xbc)](_0x395bca(0x91));_0x572476[_0x395bca(0xb7)]='delete-btn',_0x572476[_0x395bca(0xc4)]=_0x395bca(0xd7),_0x572476['onclick']=_0x41f630=>{const _0xcc9b5=_0x395bca;_0x41f630[_0xcc9b5(0x82)](),confirmDelete(_0x5398d1);};let _0x30613b;_0x48b00a[_0x395bca(0xcb)](_0x395bca(0x94),()=>_0x30613b=setTimeout(()=>{const _0x4f0dee=_0x395bca;_0x4f6ace[_0x4f0dee(0xf2)][_0x4f0dee(0xf9)](_0x4f0dee(0xbb));if(tg?.['HapticFeedback'])tg[_0x4f0dee(0xf4)][_0x4f0dee(0x95)](_0x4f0dee(0xae));},0x1f4)),_0x48b00a['addEventListener'](_0x395bca(0xf3),()=>clearTimeout(_0x30613b));const _0x104dd2=document[_0x395bca(0xbc)]('div');return _0x104dd2[_0x395bca(0xb7)]=_0x395bca(0xa1),_0x104dd2['textContent']=formatTime(_0xce5cb9[_0x395bca(0xd4)]),_0x4f6ace[_0x395bca(0xd6)](_0x572476),_0x4f6ace['appendChild'](_0x48b00a),_0x4f6ace['appendChild'](_0x104dd2),_0x4f6ace;}function a0_0x50c6(_0x112b1f,_0x508d13){_0x112b1f=_0x112b1f-0x7c;const _0x3f28a9=a0_0x292c();let _0x140b99=_0x3f28a9[_0x112b1f];return _0x140b99;}function createTypingIndicator(){const _0x1c7a97=a0_0x2ebe65,_0x548efc=document['createElement'](_0x1c7a97(0x91));return _0x548efc[_0x1c7a97(0xb7)]=_0x1c7a97(0xc7),_0x548efc['id']=_0x1c7a97(0xfb),_0x548efc['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x548efc;}function renderMessages(){const _0x3c6cc0=a0_0x2ebe65;Array['from'](chatArea[_0x3c6cc0(0xa5)])[_0x3c6cc0(0xa3)](_0x2a6a84=>{const _0x27fb64=_0x3c6cc0;if(_0x2a6a84['id']!==_0x27fb64(0x7d))_0x2a6a84[_0x27fb64(0xb2)]();}),messages['length']>0x0?(emptyState['style'][_0x3c6cc0(0xe0)]=_0x3c6cc0(0xf0),messages['forEach']((_0x3ff118,_0x192e80)=>chatArea[_0x3c6cc0(0xd6)](createMessageElement(_0x3ff118,_0x192e80)))):emptyState[_0x3c6cc0(0xb8)][_0x3c6cc0(0xe0)]=_0x3c6cc0(0x85),requestAnimationFrame(()=>chatArea[_0x3c6cc0(0xd0)]=chatArea[_0x3c6cc0(0xcf)]);}function a0_0x292c(){const _0x47af81=['timestamp','1126790APNiSJ','appendChild','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','message\x20','auto','send_message','<br>','debug_uid','393IvshIW','json','setHeaderColor','display','value','length','offClick','textContent','querySelector','splice','getElementById','.message.show-delete','viewportHeight','Очистить\x20историю?','stringify','trim','ready','error','offsetHeight','none','initData','classList','touchend','HapticFeedback','onclick','signal','confirmModal','show','add','function','typingIndicator','chatArea','.container','contains','emptyState','expand','1027262QVZAsq','notificationOccurred','830970dbJMNu','stopPropagation','messageInput','preventDefault','flex','floor','min','text','clear_history','paddingBottom','shiftKey','(((.+)+)+)+$','toString','light','clearBtn','inputArea','div','key','Действие\x20необратимо.','touchstart','impactOccurred','onEvent','modalTitle','search','6.1','click','#050505','Пустой\x20ответ','TG\x20setup\x20error:','Удалить?','focus','ai_chat_messages','message-time','input','forEach','warn','children','4073272lSbllu','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','removeItem','POST','setItem','modalText','keydown','WebApp','medium','padStart','getHours','Ошибка\x20сервера','remove','user','2088690vyaKHK','href','push','className','style','391235MXiEjr','now','show-delete','createElement','target','Telegram','initDataUnsafe','modalCancel','text/plain','parse','height','innerHTML','7636vuIqxQ','getMinutes','message\x20ai','innerHeight','sendBtn','getItem','addEventListener','message-bubble','constructor','first_name','scrollHeight','scrollTop','success','isVersionAtLeast','abort'];a0_0x292c=function(){return _0x47af81;};return a0_0x292c();}function autoResizeTextarea(){const _0x411219=a0_0x2ebe65;messageInput[_0x411219(0xb8)][_0x411219(0xc3)]=_0x411219(0xd9),messageInput['style'][_0x411219(0xc3)]=Math[_0x411219(0x87)](messageInput[_0x411219(0xcf)],0x78)+'px';}function updateSendButton(){const _0x53ffe1=a0_0x2ebe65,_0x2b237f=messageInput[_0x53ffe1(0xe1)][_0x53ffe1(0xec)]();sendBtn['disabled']=!_0x2b237f||isTyping;}async function sendMessage(){const _0x5d3eba=a0_0x2ebe65,_0x36eb33=messageInput[_0x5d3eba(0xe1)][_0x5d3eba(0xec)]();if(!_0x36eb33||isTyping)return;if(tg?.[_0x5d3eba(0xf4)])tg[_0x5d3eba(0xf4)][_0x5d3eba(0x95)](_0x5d3eba(0x8e));messages[_0x5d3eba(0xb6)]({'role':'user','content':_0x36eb33,'timestamp':Date[_0x5d3eba(0xba)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x5d3eba(0xeb)](messages)),renderMessages(),messageInput[_0x5d3eba(0xe1)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5d3eba(0xd6)](createTypingIndicator()),chatArea[_0x5d3eba(0xd0)]=chatArea[_0x5d3eba(0xcf)];const _0x2b5740=await callBackend(_0x5d3eba(0xda),{'message':_0x36eb33});isTyping=![];const _0x3e61c4=document[_0x5d3eba(0xe7)]('typingIndicator');if(_0x3e61c4)_0x3e61c4[_0x5d3eba(0xb2)]();let _0x551ba3='Ошибка\x20сети';if(_0x2b5740[_0x5d3eba(0xd1)]){_0x551ba3=_0x2b5740[_0x5d3eba(0x88)]||_0x5d3eba(0x9c);if(tg?.[_0x5d3eba(0xf4)])tg[_0x5d3eba(0xf4)][_0x5d3eba(0x80)](_0x5d3eba(0xd1));}else{_0x551ba3=_0x2b5740[_0x5d3eba(0xee)]||_0x5d3eba(0xb1);if(tg?.[_0x5d3eba(0xf4)])tg[_0x5d3eba(0xf4)][_0x5d3eba(0x80)](_0x5d3eba(0xee));}messages[_0x5d3eba(0xb6)]({'role':'ai','content':_0x551ba3,'timestamp':Date[_0x5d3eba(0xba)]()}),localStorage[_0x5d3eba(0xaa)](_0x5d3eba(0xa0),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x341070){const _0x37c352=a0_0x2ebe65;if(mTitle)mTitle['textContent']=_0x37c352(0x9e);if(mText)mText[_0x37c352(0xe4)]=_0x37c352(0x93);modalCallback=()=>{const _0x304afb=_0x37c352;messages[_0x304afb(0xe6)](_0x341070,0x1),localStorage[_0x304afb(0xaa)](_0x304afb(0xa0),JSON['stringify'](messages)),renderMessages();},modal[_0x37c352(0xf2)]['add'](_0x37c352(0xf8));}if(clearBtn)clearBtn[a0_0x2ebe65(0xf5)]=()=>{const _0x2174f0=a0_0x2ebe65;if(!messages[_0x2174f0(0xe2)])return;if(mTitle)mTitle[_0x2174f0(0xe4)]=_0x2174f0(0xea);if(mText)mText[_0x2174f0(0xe4)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x93a26a=_0x2174f0;messages=[],localStorage[_0x93a26a(0xa8)]('ai_chat_messages'),renderMessages(),callBackend(_0x93a26a(0x89),{});},modal[_0x2174f0(0xf2)]['add']('show');};document[a0_0x2ebe65(0xe7)](a0_0x2ebe65(0xc0))[a0_0x2ebe65(0xf5)]=()=>modal[a0_0x2ebe65(0xf2)]['remove'](a0_0x2ebe65(0xf8)),document[a0_0x2ebe65(0xe7)]('modalConfirm')[a0_0x2ebe65(0xf5)]=()=>{const _0x5d781c=a0_0x2ebe65;if(modalCallback)modalCallback();modal['classList'][_0x5d781c(0xb2)](_0x5d781c(0xf8));},messageInput[a0_0x2ebe65(0xcb)](a0_0x2ebe65(0xa2),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2ebe65(0xcb)](a0_0x2ebe65(0xac),_0x55a9b4=>{const _0x5b1828=a0_0x2ebe65;_0x55a9b4[_0x5b1828(0x92)]==='Enter'&&!_0x55a9b4[_0x5b1828(0x8b)]&&(_0x55a9b4[_0x5b1828(0x84)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x2ebe65(0xcb)](a0_0x2ebe65(0x9a),_0x35479d=>{const _0x1e1834=a0_0x2ebe65;document['querySelectorAll'](_0x1e1834(0xe8))['forEach'](_0x4463b5=>{const _0x1f6f44=_0x1e1834;if(!_0x4463b5[_0x1f6f44(0x7c)](_0x35479d[_0x1f6f44(0xbd)]))_0x4463b5['classList']['remove'](_0x1f6f44(0xbb));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x2ebe65(0xc2)](saved),renderMessages();}catch(a0_0x2f2f46){}updateSendButton();