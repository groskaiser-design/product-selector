const a0_0x487805=a0_0x170b;(function(_0x467adf,_0x35a089){const _0x3c67fe=a0_0x170b,_0x13058f=_0x467adf();while(!![]){try{const _0x50364c=parseInt(_0x3c67fe(0xed))/0x1+-parseInt(_0x3c67fe(0x149))/0x2*(-parseInt(_0x3c67fe(0x109))/0x3)+parseInt(_0x3c67fe(0x151))/0x4+-parseInt(_0x3c67fe(0x12e))/0x5*(-parseInt(_0x3c67fe(0xe4))/0x6)+-parseInt(_0x3c67fe(0xf3))/0x7+-parseInt(_0x3c67fe(0x139))/0x8*(parseInt(_0x3c67fe(0x112))/0x9)+parseInt(_0x3c67fe(0x159))/0xa;if(_0x50364c===_0x35a089)break;else _0x13058f['push'](_0x13058f['shift']());}catch(_0x58fe72){_0x13058f['push'](_0x13058f['shift']());}}}(a0_0x3aed,0x42fbf));const tg=window['Telegram']?.[a0_0x487805(0x131)],HOME_URL=a0_0x487805(0x13c);function setupTelegramBackButton(){const _0x350a5a=a0_0x487805,_0x47110e=(function(){let _0x166bf7=!![];return function(_0x422144,_0x511f1c){const _0x312e63=_0x166bf7?function(){if(_0x511f1c){const _0x1c9620=_0x511f1c['apply'](_0x422144,arguments);return _0x511f1c=null,_0x1c9620;}}:function(){};return _0x166bf7=![],_0x312e63;};}()),_0x1a7fa4=_0x47110e(this,function(){const _0x5280b1=a0_0x170b;return _0x1a7fa4[_0x5280b1(0x11e)]()[_0x5280b1(0x11f)](_0x5280b1(0x10c))['toString']()[_0x5280b1(0x145)](_0x1a7fa4)[_0x5280b1(0x11f)](_0x5280b1(0x10c));});_0x1a7fa4();if(!tg)return;try{tg[_0x350a5a(0x14e)](),tg[_0x350a5a(0xe1)](),tg['setHeaderColor']?.(_0x350a5a(0xea));if(tg[_0x350a5a(0xec)]?.('6.1'))tg[_0x350a5a(0x13a)]?.();const _0xaa3477=tg[_0x350a5a(0x10d)];if(_0xaa3477){_0xaa3477[_0x350a5a(0x11b)]();if(typeof _0xaa3477[_0x350a5a(0x129)]===_0x350a5a(0x120))try{_0xaa3477['offClick']();}catch(_0x3da212){}_0xaa3477[_0x350a5a(0xfa)](()=>{const _0x3fd3c5=_0x350a5a;if(tg[_0x3fd3c5(0xf0)])tg[_0x3fd3c5(0xf0)][_0x3fd3c5(0xfc)](_0x3fd3c5(0x100));location['href']=HOME_URL;});}}catch(_0x4fcf03){console[_0x350a5a(0x127)](_0x350a5a(0x136),_0x4fcf03);}}(function initStableLayout(){const _0x9d15e3=a0_0x487805,_0x4adba6=document['querySelector'](_0x9d15e3(0x119)),_0x2af5f0=document[_0x9d15e3(0x143)](_0x9d15e3(0x133)),_0x353070=document[_0x9d15e3(0x143)]('chatArea'),_0x42c0db=document['getElementById']('messageInput');function _0x7cf7a1(){const _0x4bb152=_0x9d15e3;if(!_0x4adba6)return;const _0x211bb6=tg&&tg[_0x4bb152(0x123)]?tg[_0x4bb152(0x123)]:window[_0x4bb152(0x132)];_0x4adba6['style'][_0x4bb152(0x148)]=_0x211bb6+'px';if(_0x2af5f0){const _0x90ce4f=_0x2af5f0[_0x4bb152(0xf6)];_0x353070[_0x4bb152(0x13e)]['paddingBottom']=_0x90ce4f+0x28+'px';}}tg?tg[_0x9d15e3(0x121)]('viewportChanged',({isStateStable:_0xc25a28})=>{_0x7cf7a1();if(_0xc25a28)requestAnimationFrame(()=>{const _0x5bd997=a0_0x170b;_0x353070['scrollTop']=_0x353070[_0x5bd997(0xe5)];});}):window[_0x9d15e3(0xf1)]('resize',_0x7cf7a1),_0x7cf7a1(),_0x42c0db&&(_0x42c0db[_0x9d15e3(0xf1)](_0x9d15e3(0x14f),()=>{requestAnimationFrame(_0x7cf7a1);}),_0x42c0db['addEventListener'](_0x9d15e3(0xe0),()=>{setTimeout(()=>{const _0x195c62=a0_0x170b;_0x353070['scrollTop']=_0x353070[_0x195c62(0xe5)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x487805(0xf4),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x487805(0x143)](a0_0x487805(0x154)),emptyState=document[a0_0x487805(0x143)](a0_0x487805(0x13d)),messageInput=document[a0_0x487805(0x143)](a0_0x487805(0x106)),sendBtn=document[a0_0x487805(0x143)](a0_0x487805(0x11c)),clearBtn=document[a0_0x487805(0x143)](a0_0x487805(0x111)),modal=document[a0_0x487805(0x143)]('confirmModal'),mTitle=document['getElementById'](a0_0x487805(0x10a)),mText=document['getElementById'](a0_0x487805(0x115));let modalCallback=null;async function callBackend(_0x42343a,_0x36156f){const _0x26a57b=a0_0x487805,_0x45a3a5=tg?.['initDataUnsafe']?.[_0x26a57b(0x135)]||{},_0x3eea63=_0x45a3a5['id']||localStorage[_0x26a57b(0x134)](_0x26a57b(0x126))||'d-'+Math['floor'](Math[_0x26a57b(0x118)]()*0x3b9aca00);if(!_0x45a3a5['id'])localStorage[_0x26a57b(0x12a)]('debug_uid',_0x3eea63);const _0x366623={'action':_0x42343a,'user_id':_0x3eea63,'user_data':{'first_name':_0x45a3a5[_0x26a57b(0x114)],'username':_0x45a3a5['username']},'init_data':tg?.[_0x26a57b(0xe6)]||'',..._0x36156f},_0xbf8c5f=new AbortController(),_0x4859b2=setTimeout(()=>_0xbf8c5f[_0x26a57b(0x13b)](),REQUEST_TIMEOUT_MS);try{const _0x3f7295=await fetch(BACKEND_URL,{'method':_0x26a57b(0x125),'headers':{'Content-Type':_0x26a57b(0xee)},'body':JSON[_0x26a57b(0xf5)](_0x366623),'signal':_0xbf8c5f[_0x26a57b(0x11d)]});return clearTimeout(_0x4859b2),await _0x3f7295['json']();}catch(_0x3b5c46){return{'success':![],'error':String(_0x3b5c46)};}}function formatTime(_0x45eaf6){const _0x2ce448=a0_0x487805,_0x4443c4=new Date(_0x45eaf6);return String(_0x4443c4[_0x2ce448(0x12f)]())['padStart'](0x2,'0')+':'+String(_0x4443c4[_0x2ce448(0x14a)]())['padStart'](0x2,'0');}function a0_0x3aed(){const _0x1a7ec6=['textContent','chatArea','createElement','Enter','none','error','1686320hOYbkH','push','focus','expand','min','contains','1839186XMdWMC','scrollHeight','initData','onclick','from','delete-btn','#050505','<br>','isVersionAtLeast','459063wsfprt','text/plain','message\x20ai','HapticFeedback','addEventListener','success','2170966HmsqGa','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','stringify','offsetHeight','Действие\x20необратимо.','.message.show-delete','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','onClick','notificationOccurred','impactOccurred','stopPropagation','auto','touchend','light','medium','replace','classList','scrollTop','text','messageInput','role','length','3CpENgr','modalTitle','Удалить?','(((.+)+)+)+$','BackButton','querySelectorAll','className','message-time','clearBtn','9WMdBCv','flex','first_name','modalText','timestamp','forEach','random','.container','appendChild','show','sendBtn','signal','toString','search','function','onEvent','div','viewportHeight','now','POST','debug_uid','warn','preventDefault','offClick','setItem','remove','content','send_message','5SdrVlS','getHours','Пустой\x20ответ','WebApp','innerHeight','inputArea','getItem','user','TG\x20setup\x20error:','shiftKey','trim','3578200UhqSKH','disableVerticalSwipes','abort','./router.html','emptyState','style','add','parse','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','target','getElementById','modalCancel','constructor','key','Очистить\x20историю?','height','131820JJqQcu','getMinutes','ai_chat_messages','innerHTML','show-delete','ready','input','value','126576MpMBnw','typingIndicator'];a0_0x3aed=function(){return _0x1a7ec6;};return a0_0x3aed();}function createMessageElement(_0x1f9c7f,_0x3e5097){const _0x3cc75d=a0_0x487805,_0x446f2e=document[_0x3cc75d(0x155)](_0x3cc75d(0x122));_0x446f2e['className']='message\x20'+_0x1f9c7f[_0x3cc75d(0x107)];const _0x5b2873=document['createElement'](_0x3cc75d(0x122));_0x5b2873['className']='message-bubble',_0x5b2873[_0x3cc75d(0x14c)]=_0x1f9c7f[_0x3cc75d(0x12c)][_0x3cc75d(0x102)](/\n/g,_0x3cc75d(0xeb));const _0x150728=document[_0x3cc75d(0x155)]('div');_0x150728[_0x3cc75d(0x10f)]=_0x3cc75d(0xe9),_0x150728[_0x3cc75d(0x14c)]=_0x3cc75d(0xf9),_0x150728[_0x3cc75d(0xe7)]=_0x55ef83=>{const _0xd8241f=_0x3cc75d;_0x55ef83[_0xd8241f(0xfd)](),confirmDelete(_0x3e5097);};let _0x98f504;_0x5b2873[_0x3cc75d(0xf1)]('touchstart',()=>_0x98f504=setTimeout(()=>{const _0x1be119=_0x3cc75d;_0x446f2e[_0x1be119(0x103)][_0x1be119(0x13f)]('show-delete');if(tg?.[_0x1be119(0xf0)])tg[_0x1be119(0xf0)]['impactOccurred'](_0x1be119(0x101));},0x1f4)),_0x5b2873[_0x3cc75d(0xf1)](_0x3cc75d(0xff),()=>clearTimeout(_0x98f504));const _0x2a3066=document['createElement']('div');return _0x2a3066[_0x3cc75d(0x10f)]=_0x3cc75d(0x110),_0x2a3066[_0x3cc75d(0x153)]=formatTime(_0x1f9c7f[_0x3cc75d(0x116)]),_0x446f2e[_0x3cc75d(0x11a)](_0x150728),_0x446f2e[_0x3cc75d(0x11a)](_0x5b2873),_0x446f2e[_0x3cc75d(0x11a)](_0x2a3066),_0x446f2e;}function createTypingIndicator(){const _0x3f3676=a0_0x487805,_0x37292a=document[_0x3f3676(0x155)](_0x3f3676(0x122));return _0x37292a[_0x3f3676(0x10f)]=_0x3f3676(0xef),_0x37292a['id']=_0x3f3676(0x152),_0x37292a[_0x3f3676(0x14c)]=_0x3f3676(0x141),_0x37292a;}function renderMessages(){const _0x1cf393=a0_0x487805;Array[_0x1cf393(0xe8)](chatArea['children'])['forEach'](_0x2858ef=>{const _0x39be41=_0x1cf393;if(_0x2858ef['id']!==_0x39be41(0x13d))_0x2858ef[_0x39be41(0x12b)]();}),messages[_0x1cf393(0x108)]>0x0?(emptyState[_0x1cf393(0x13e)]['display']=_0x1cf393(0x157),messages['forEach']((_0x13fb92,_0x477915)=>chatArea['appendChild'](createMessageElement(_0x13fb92,_0x477915)))):emptyState[_0x1cf393(0x13e)]['display']=_0x1cf393(0x113),requestAnimationFrame(()=>chatArea[_0x1cf393(0x104)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x191c4a=a0_0x487805;messageInput[_0x191c4a(0x13e)][_0x191c4a(0x148)]=_0x191c4a(0xfe),messageInput[_0x191c4a(0x13e)][_0x191c4a(0x148)]=Math[_0x191c4a(0xe2)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0xc05eee=a0_0x487805,_0x522d44=messageInput[_0xc05eee(0x150)][_0xc05eee(0x138)]();sendBtn['disabled']=!_0x522d44||isTyping;}async function sendMessage(){const _0x245323=a0_0x487805,_0x5e2fc8=messageInput[_0x245323(0x150)]['trim']();if(!_0x5e2fc8||isTyping)return;if(tg?.[_0x245323(0xf0)])tg[_0x245323(0xf0)][_0x245323(0xfc)](_0x245323(0x100));messages['push']({'role':_0x245323(0x135),'content':_0x5e2fc8,'timestamp':Date['now']()}),localStorage[_0x245323(0x12a)](_0x245323(0x14b),JSON[_0x245323(0xf5)](messages)),renderMessages(),messageInput[_0x245323(0x150)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x245323(0x11a)](createTypingIndicator()),chatArea[_0x245323(0x104)]=chatArea[_0x245323(0xe5)];const _0x5978ff=await callBackend(_0x245323(0x12d),{'message':_0x5e2fc8});isTyping=![];const _0x4697fb=document['getElementById'](_0x245323(0x152));if(_0x4697fb)_0x4697fb[_0x245323(0x12b)]();let _0x5176c1='Ошибка\x20сети';if(_0x5978ff['success']){_0x5176c1=_0x5978ff[_0x245323(0x105)]||_0x245323(0x130);if(tg?.[_0x245323(0xf0)])tg[_0x245323(0xf0)][_0x245323(0xfb)](_0x245323(0xf2));}else{_0x5176c1=_0x5978ff[_0x245323(0x158)]||'Ошибка\x20сервера';if(tg?.[_0x245323(0xf0)])tg['HapticFeedback'][_0x245323(0xfb)](_0x245323(0x158));}messages[_0x245323(0x15a)]({'role':'ai','content':_0x5176c1,'timestamp':Date[_0x245323(0x124)]()}),localStorage[_0x245323(0x12a)](_0x245323(0x14b),JSON[_0x245323(0xf5)](messages)),renderMessages();}function confirmDelete(_0x89836c){const _0x44fcac=a0_0x487805;if(mTitle)mTitle['textContent']=_0x44fcac(0x10b);if(mText)mText[_0x44fcac(0x153)]=_0x44fcac(0xf7);modalCallback=()=>{const _0x4c2a66=_0x44fcac;messages['splice'](_0x89836c,0x1),localStorage[_0x4c2a66(0x12a)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x44fcac(0x103)]['add'](_0x44fcac(0x11b));}if(clearBtn)clearBtn[a0_0x487805(0xe7)]=()=>{const _0x373da7=a0_0x487805;if(!messages['length'])return;if(mTitle)mTitle[_0x373da7(0x153)]=_0x373da7(0x147);if(mText)mText[_0x373da7(0x153)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x293ff9=_0x373da7;messages=[],localStorage['removeItem'](_0x293ff9(0x14b)),renderMessages(),callBackend('clear_history',{});},modal[_0x373da7(0x103)][_0x373da7(0x13f)](_0x373da7(0x11b));};document[a0_0x487805(0x143)](a0_0x487805(0x144))[a0_0x487805(0xe7)]=()=>modal[a0_0x487805(0x103)]['remove']('show'),document['getElementById']('modalConfirm')[a0_0x487805(0xe7)]=()=>{const _0x1ee95e=a0_0x487805;if(modalCallback)modalCallback();modal[_0x1ee95e(0x103)]['remove'](_0x1ee95e(0x11b));},messageInput['addEventListener'](a0_0x487805(0x14f),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x487805(0xf1)]('keydown',_0x4fc635=>{const _0x55b521=a0_0x487805;_0x4fc635[_0x55b521(0x146)]===_0x55b521(0x156)&&!_0x4fc635[_0x55b521(0x137)]&&(_0x4fc635[_0x55b521(0x128)](),sendMessage());}),sendBtn[a0_0x487805(0xe7)]=sendMessage,document[a0_0x487805(0xf1)]('click',_0x3e90e6=>{const _0x169159=a0_0x487805;document[_0x169159(0x10e)](_0x169159(0xf8))[_0x169159(0x117)](_0x202d44=>{const _0x1f206f=_0x169159;if(!_0x202d44[_0x1f206f(0xe3)](_0x3e90e6[_0x1f206f(0x142)]))_0x202d44[_0x1f206f(0x103)]['remove'](_0x1f206f(0x14d));});});const saved=localStorage[a0_0x487805(0x134)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x487805(0x140)](saved),renderMessages();}catch(a0_0x3c08d0){}function a0_0x170b(_0x1ec22,_0x5463a5){_0x1ec22=_0x1ec22-0xe0;const _0x552af4=a0_0x3aed();let _0x23247d=_0x552af4[_0x1ec22];return _0x23247d;}updateSendButton();