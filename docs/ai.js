const a0_0x20fbfe=a0_0x347c;(function(_0x1a38ba,_0x377f37){const _0x220e62=a0_0x347c,_0x206893=_0x1a38ba();while(!![]){try{const _0x435de1=-parseInt(_0x220e62(0x199))/0x1*(parseInt(_0x220e62(0x1d2))/0x2)+parseInt(_0x220e62(0x1e3))/0x3+-parseInt(_0x220e62(0x1c4))/0x4*(parseInt(_0x220e62(0x1ba))/0x5)+-parseInt(_0x220e62(0x170))/0x6*(-parseInt(_0x220e62(0x1b3))/0x7)+-parseInt(_0x220e62(0x19b))/0x8*(-parseInt(_0x220e62(0x1e1))/0x9)+parseInt(_0x220e62(0x16d))/0xa*(-parseInt(_0x220e62(0x182))/0xb)+-parseInt(_0x220e62(0x18d))/0xc*(-parseInt(_0x220e62(0x1b1))/0xd);if(_0x435de1===_0x377f37)break;else _0x206893['push'](_0x206893['shift']());}catch(_0x229f70){_0x206893['push'](_0x206893['shift']());}}}(a0_0x82da,0x80bbd));const tg=window['Telegram']?.[a0_0x20fbfe(0x1cc)],HOME_URL=a0_0x20fbfe(0x17c);function setupTelegramBackButton(){const _0x569d2d=a0_0x20fbfe,_0x2d371b=(function(){let _0x34ddc4=!![];return function(_0x80f45c,_0x454ea3){const _0x344c0b=_0x34ddc4?function(){const _0x3b3a16=a0_0x347c;if(_0x454ea3){const _0x255e8f=_0x454ea3[_0x3b3a16(0x1a4)](_0x80f45c,arguments);return _0x454ea3=null,_0x255e8f;}}:function(){};return _0x34ddc4=![],_0x344c0b;};}()),_0x585c33=_0x2d371b(this,function(){const _0x36ab7a=a0_0x347c;return _0x585c33[_0x36ab7a(0x168)]()['search']('(((.+)+)+)+$')[_0x36ab7a(0x168)]()[_0x36ab7a(0x19a)](_0x585c33)[_0x36ab7a(0x191)](_0x36ab7a(0x1b6));});_0x585c33();if(!tg)return;try{tg[_0x569d2d(0x1df)](),tg['expand'](),tg[_0x569d2d(0x17b)]?.(_0x569d2d(0x193));if(tg[_0x569d2d(0x1d3)]?.('6.1'))tg[_0x569d2d(0x1e6)]?.();const _0x1f399e=tg[_0x569d2d(0x1ae)];if(_0x1f399e){_0x1f399e[_0x569d2d(0x186)]();if(typeof _0x1f399e[_0x569d2d(0x19d)]==='function')try{_0x1f399e[_0x569d2d(0x19d)]();}catch(_0x7dd03d){}_0x1f399e[_0x569d2d(0x178)](()=>{const _0x1d83ae=_0x569d2d;if(tg[_0x1d83ae(0x1b7)])tg[_0x1d83ae(0x1b7)][_0x1d83ae(0x189)](_0x1d83ae(0x17f));location['href']=HOME_URL;});}}catch(_0x2f205e){console[_0x569d2d(0x192)](_0x569d2d(0x176),_0x2f205e);}}(function initStableLayout(){const _0x17ae2=a0_0x20fbfe,_0x1c74c0=document[_0x17ae2(0x18b)](_0x17ae2(0x1a0)),_0x4edd58=document[_0x17ae2(0x173)](_0x17ae2(0x1c0)),_0x3d1b82=document[_0x17ae2(0x173)](_0x17ae2(0x19f)),_0x3de2e9=document['getElementById'](_0x17ae2(0x1c6));function _0x509e5f(){const _0x2ce711=_0x17ae2;if(!_0x1c74c0)return;const _0x165d8e=tg&&tg[_0x2ce711(0x1ea)]?tg['viewportHeight']:window['innerHeight'];_0x1c74c0[_0x2ce711(0x197)][_0x2ce711(0x1e2)]=_0x165d8e+'px';if(_0x4edd58){const _0x3e22e1=_0x4edd58[_0x2ce711(0x17e)];_0x3d1b82[_0x2ce711(0x197)][_0x2ce711(0x1a5)]=_0x3e22e1+0x28+'px';}}tg?tg[_0x17ae2(0x18f)](_0x17ae2(0x1c2),({isStateStable:_0x3297a1})=>{_0x509e5f();if(_0x3297a1)requestAnimationFrame(()=>{const _0x11e2d1=a0_0x347c;_0x3d1b82[_0x11e2d1(0x19e)]=_0x3d1b82['scrollHeight'];});}):window[_0x17ae2(0x174)](_0x17ae2(0x1bd),_0x509e5f),_0x509e5f(),_0x3de2e9&&(_0x3de2e9[_0x17ae2(0x174)](_0x17ae2(0x183),()=>{requestAnimationFrame(_0x509e5f);}),_0x3de2e9[_0x17ae2(0x174)](_0x17ae2(0x1bb),()=>{setTimeout(()=>{const _0x216387=a0_0x347c;_0x3d1b82[_0x216387(0x19e)]=_0x3d1b82[_0x216387(0x184)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x20fbfe(0x1a6),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x20fbfe(0x173)](a0_0x20fbfe(0x19f)),emptyState=document[a0_0x20fbfe(0x173)]('emptyState'),messageInput=document[a0_0x20fbfe(0x173)](a0_0x20fbfe(0x1c6)),sendBtn=document[a0_0x20fbfe(0x173)](a0_0x20fbfe(0x1d5)),clearBtn=document[a0_0x20fbfe(0x173)](a0_0x20fbfe(0x187)),modal=document[a0_0x20fbfe(0x173)](a0_0x20fbfe(0x179)),mTitle=document[a0_0x20fbfe(0x173)](a0_0x20fbfe(0x1b0)),mText=document[a0_0x20fbfe(0x173)](a0_0x20fbfe(0x1bc));let modalCallback=null;async function callBackend(_0x591531,_0x1ff1c9){const _0xe94a79=a0_0x20fbfe,_0x437f80=tg?.[_0xe94a79(0x1e0)]?.[_0xe94a79(0x172)]||{},_0x1375f7=_0x437f80['id']||localStorage[_0xe94a79(0x1ad)](_0xe94a79(0x18a))||'d-'+Math[_0xe94a79(0x194)](Math['random']()*0x3b9aca00);if(!_0x437f80['id'])localStorage['setItem']('debug_uid',_0x1375f7);const _0x35f4d9={'action':_0x591531,'user_id':_0x1375f7,'user_data':{'first_name':_0x437f80[_0xe94a79(0x1d1)],'username':_0x437f80[_0xe94a79(0x1aa)]},'init_data':tg?.['initData']||'',..._0x1ff1c9},_0x11f269=new AbortController(),_0x4484ee=setTimeout(()=>_0x11f269['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3699a2=await fetch(BACKEND_URL,{'method':_0xe94a79(0x1e9),'headers':{'Content-Type':_0xe94a79(0x1b9)},'body':JSON[_0xe94a79(0x1ab)](_0x35f4d9),'signal':_0x11f269[_0xe94a79(0x1a1)]});return clearTimeout(_0x4484ee),await _0x3699a2[_0xe94a79(0x1af)]();}catch(_0x5c9373){return{'success':![],'error':String(_0x5c9373)};}}function a0_0x82da(){const _0x51755c=['sendBtn','.message.show-delete','Действие\x20необратимо.','target','send_message','Очистить\x20историю?','appendChild','replace','click','flex','ready','initDataUnsafe','18qHDVCN','height','1989822ZzaeVo','message\x20ai','value','disableVerticalSwipes','touchstart','delete-btn','POST','viewportHeight','setItem','toString','splice','modalConfirm','div','show-delete','10FjtcKh','message\x20','textContent','350178LOcxpK','trim','user','getElementById','addEventListener','classList','TG\x20setup\x20error:','message-bubble','onClick','confirmModal','Пустой\x20ответ','setHeaderColor','./router.html','min','offsetHeight','light','notificationOccurred','keydown','10957859LGPrfB','input','scrollHeight','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','show','clearBtn','Ошибка\x20сервера','impactOccurred','debug_uid','querySelector','<br>','847428zruCDd','add','onEvent','clear_history','search','warn','#050505','floor','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','getHours','style','none','4nnwSJq','constructor','966632CfQsTw','from','offClick','scrollTop','chatArea','.container','signal','auto','Начнется\x20новый\x20диалог.','apply','paddingBottom','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','createElement','querySelectorAll','timestamp','username','stringify','padStart','getItem','BackButton','json','modalTitle','117cneiXj','key','70NVtEoA','className','contains','(((.+)+)+)+$','HapticFeedback','shiftKey','text/plain','34985czuFaj','focus','modalText','resize','length','Ошибка\x20сети','inputArea','remove','viewportChanged','disabled','188KCPCkC','message-time','messageInput','innerHTML','now','touchend','ai_chat_messages','parse','WebApp','typingIndicator','push','onclick','display','first_name','135906cBlZIM','isVersionAtLeast','success'];a0_0x82da=function(){return _0x51755c;};return a0_0x82da();}function formatTime(_0xe279a6){const _0x1b5fe0=a0_0x20fbfe,_0x8ca8d0=new Date(_0xe279a6);return String(_0x8ca8d0[_0x1b5fe0(0x196)]())[_0x1b5fe0(0x1ac)](0x2,'0')+':'+String(_0x8ca8d0['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x477502,_0x175b63){const _0x1d79ca=a0_0x20fbfe,_0x564ed8=document[_0x1d79ca(0x1a7)](_0x1d79ca(0x16b));_0x564ed8[_0x1d79ca(0x1b4)]=_0x1d79ca(0x16e)+_0x477502['role'];const _0x939db2=document[_0x1d79ca(0x1a7)](_0x1d79ca(0x16b));_0x939db2['className']=_0x1d79ca(0x177),_0x939db2['innerHTML']=_0x477502['content'][_0x1d79ca(0x1dc)](/\n/g,_0x1d79ca(0x18c));const _0x228dbe=document[_0x1d79ca(0x1a7)](_0x1d79ca(0x16b));_0x228dbe[_0x1d79ca(0x1b4)]=_0x1d79ca(0x1e8),_0x228dbe[_0x1d79ca(0x1c7)]=_0x1d79ca(0x185),_0x228dbe[_0x1d79ca(0x1cf)]=_0x42d514=>{_0x42d514['stopPropagation'](),confirmDelete(_0x175b63);};let _0x29104c;_0x939db2[_0x1d79ca(0x174)](_0x1d79ca(0x1e7),()=>_0x29104c=setTimeout(()=>{const _0x4529cd=_0x1d79ca;_0x564ed8[_0x4529cd(0x175)][_0x4529cd(0x18e)](_0x4529cd(0x16c));if(tg?.['HapticFeedback'])tg[_0x4529cd(0x1b7)][_0x4529cd(0x189)]('medium');},0x1f4)),_0x939db2[_0x1d79ca(0x174)](_0x1d79ca(0x1c9),()=>clearTimeout(_0x29104c));const _0x27de1c=document[_0x1d79ca(0x1a7)](_0x1d79ca(0x16b));return _0x27de1c[_0x1d79ca(0x1b4)]=_0x1d79ca(0x1c5),_0x27de1c[_0x1d79ca(0x16f)]=formatTime(_0x477502[_0x1d79ca(0x1a9)]),_0x564ed8['appendChild'](_0x228dbe),_0x564ed8[_0x1d79ca(0x1db)](_0x939db2),_0x564ed8[_0x1d79ca(0x1db)](_0x27de1c),_0x564ed8;}function createTypingIndicator(){const _0x59773e=a0_0x20fbfe,_0x25a9e7=document[_0x59773e(0x1a7)](_0x59773e(0x16b));return _0x25a9e7['className']=_0x59773e(0x1e4),_0x25a9e7['id']=_0x59773e(0x1cd),_0x25a9e7['innerHTML']=_0x59773e(0x195),_0x25a9e7;}function renderMessages(){const _0x18a9f3=a0_0x20fbfe;Array[_0x18a9f3(0x19c)](chatArea['children'])['forEach'](_0x32b30f=>{const _0x405c3d=_0x18a9f3;if(_0x32b30f['id']!=='emptyState')_0x32b30f[_0x405c3d(0x1c1)]();}),messages[_0x18a9f3(0x1be)]>0x0?(emptyState[_0x18a9f3(0x197)]['display']=_0x18a9f3(0x198),messages['forEach']((_0x135791,_0xd67017)=>chatArea['appendChild'](createMessageElement(_0x135791,_0xd67017)))):emptyState[_0x18a9f3(0x197)][_0x18a9f3(0x1d0)]=_0x18a9f3(0x1de),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x18a9f3(0x184)]);}function a0_0x347c(_0x43a3e6,_0x43512d){_0x43a3e6=_0x43a3e6-0x167;const _0x40795c=a0_0x82da();let _0x1d1aea=_0x40795c[_0x43a3e6];return _0x1d1aea;}function autoResizeTextarea(){const _0x493cce=a0_0x20fbfe;messageInput[_0x493cce(0x197)][_0x493cce(0x1e2)]=_0x493cce(0x1a2),messageInput[_0x493cce(0x197)][_0x493cce(0x1e2)]=Math[_0x493cce(0x17d)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x54f439=a0_0x20fbfe,_0x28a8c0=messageInput[_0x54f439(0x1e5)][_0x54f439(0x171)]();sendBtn[_0x54f439(0x1c3)]=!_0x28a8c0||isTyping;}async function sendMessage(){const _0xd3f288=a0_0x20fbfe,_0x5c999d=messageInput[_0xd3f288(0x1e5)][_0xd3f288(0x171)]();if(!_0x5c999d||isTyping)return;if(tg?.[_0xd3f288(0x1b7)])tg['HapticFeedback'][_0xd3f288(0x189)](_0xd3f288(0x17f));messages[_0xd3f288(0x1ce)]({'role':_0xd3f288(0x172),'content':_0x5c999d,'timestamp':Date[_0xd3f288(0x1c8)]()}),localStorage['setItem'](_0xd3f288(0x1ca),JSON[_0xd3f288(0x1ab)](messages)),renderMessages(),messageInput[_0xd3f288(0x1e5)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xd3f288(0x1db)](createTypingIndicator()),chatArea[_0xd3f288(0x19e)]=chatArea[_0xd3f288(0x184)];const _0x7ab457=await callBackend(_0xd3f288(0x1d9),{'message':_0x5c999d});isTyping=![];const _0x22661c=document[_0xd3f288(0x173)](_0xd3f288(0x1cd));if(_0x22661c)_0x22661c[_0xd3f288(0x1c1)]();let _0xbfe888=_0xd3f288(0x1bf);if(_0x7ab457[_0xd3f288(0x1d4)]){_0xbfe888=_0x7ab457['text']||_0xd3f288(0x17a);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0xd3f288(0x180)](_0xd3f288(0x1d4));}else{_0xbfe888=_0x7ab457['error']||_0xd3f288(0x188);if(tg?.[_0xd3f288(0x1b7)])tg[_0xd3f288(0x1b7)][_0xd3f288(0x180)]('error');}messages[_0xd3f288(0x1ce)]({'role':'ai','content':_0xbfe888,'timestamp':Date[_0xd3f288(0x1c8)]()}),localStorage[_0xd3f288(0x167)](_0xd3f288(0x1ca),JSON[_0xd3f288(0x1ab)](messages)),renderMessages();}function confirmDelete(_0xb3a219){const _0x458720=a0_0x20fbfe;if(mTitle)mTitle[_0x458720(0x16f)]='Удалить?';if(mText)mText[_0x458720(0x16f)]=_0x458720(0x1d7);modalCallback=()=>{const _0xd4ccaa=_0x458720;messages[_0xd4ccaa(0x169)](_0xb3a219,0x1),localStorage['setItem'](_0xd4ccaa(0x1ca),JSON[_0xd4ccaa(0x1ab)](messages)),renderMessages();},modal['classList'][_0x458720(0x18e)](_0x458720(0x186));}if(clearBtn)clearBtn[a0_0x20fbfe(0x1cf)]=()=>{const _0x4ccfb9=a0_0x20fbfe;if(!messages['length'])return;if(mTitle)mTitle[_0x4ccfb9(0x16f)]=_0x4ccfb9(0x1da);if(mText)mText[_0x4ccfb9(0x16f)]=_0x4ccfb9(0x1a3);modalCallback=async()=>{const _0x1608e3=_0x4ccfb9;messages=[],localStorage['removeItem'](_0x1608e3(0x1ca)),renderMessages(),callBackend(_0x1608e3(0x190),{});},modal[_0x4ccfb9(0x175)]['add'](_0x4ccfb9(0x186));};document[a0_0x20fbfe(0x173)]('modalCancel')['onclick']=()=>modal['classList']['remove'](a0_0x20fbfe(0x186)),document[a0_0x20fbfe(0x173)](a0_0x20fbfe(0x16a))[a0_0x20fbfe(0x1cf)]=()=>{const _0x2e58e4=a0_0x20fbfe;if(modalCallback)modalCallback();modal[_0x2e58e4(0x175)]['remove']('show');},messageInput[a0_0x20fbfe(0x174)](a0_0x20fbfe(0x183),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x20fbfe(0x174)](a0_0x20fbfe(0x181),_0x185ab6=>{const _0x1c2f43=a0_0x20fbfe;_0x185ab6[_0x1c2f43(0x1b2)]==='Enter'&&!_0x185ab6[_0x1c2f43(0x1b8)]&&(_0x185ab6['preventDefault'](),sendMessage());}),sendBtn[a0_0x20fbfe(0x1cf)]=sendMessage,document[a0_0x20fbfe(0x174)](a0_0x20fbfe(0x1dd),_0x383858=>{const _0x1a2a35=a0_0x20fbfe;document[_0x1a2a35(0x1a8)](_0x1a2a35(0x1d6))['forEach'](_0x4e4fe0=>{const _0xb3ad22=_0x1a2a35;if(!_0x4e4fe0[_0xb3ad22(0x1b5)](_0x383858[_0xb3ad22(0x1d8)]))_0x4e4fe0[_0xb3ad22(0x175)][_0xb3ad22(0x1c1)](_0xb3ad22(0x16c));});});const saved=localStorage[a0_0x20fbfe(0x1ad)](a0_0x20fbfe(0x1ca));if(saved)try{messages=JSON[a0_0x20fbfe(0x1cb)](saved),renderMessages();}catch(a0_0x107197){}updateSendButton();