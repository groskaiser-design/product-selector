const a0_0xdb60eb=a0_0x4d60;function a0_0x6d47(){const _0x370442=['disableVerticalSwipes','className','innerHTML','medium','confirmModal','innerHeight','div','floor','abort','7640dCwWkW','content','Действие\x20необратимо.','height','href','padStart','auto','warn','onclick','value','remove','role','appendChild','random','90027YITxEF','function','.message.show-delete','(((.+)+)+)+$','scrollHeight','modalConfirm','now','82312DTaKGM','getHours','Telegram','messageInput','parse','shiftKey','message\x20ai','modalTitle','show-delete','inputArea','search','input','4qQgyAr','display','key','error','none','focus','./router.html','length','<br>','add','contains','getElementById','light','message-bubble','impactOccurred','POST','Пустой\x20ответ','onEvent','Начнется\x20новый\x20диалог.','setHeaderColor','debug_uid','clearBtn','6.1','scrollTop','TG\x20setup\x20error:','target','flex','74339JnRFGA','message\x20','text/plain','WebApp','740154ggAmCA','modalText','BackButton','trim','2777670JyuqRh','touchstart','from','viewportHeight','Ошибка\x20сервера','ai_chat_messages','initData','onClick','resize','notificationOccurred','removeItem','show','textContent','119bpahCv','expand','message-time','keydown','querySelectorAll','chatArea','createElement','typingIndicator','setItem','apply','preventDefault','success','replace','HapticFeedback','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','style','push','getMinutes','10409060XSZZfY','min','emptyState','user','.container','initDataUnsafe','addEventListener','offsetHeight','forEach','delete-btn','classList','stringify','isVersionAtLeast','timestamp','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','text','constructor','44ewriMy','viewportChanged','send_message','username','signal','Enter','offClick','#050505'];a0_0x6d47=function(){return _0x370442;};return a0_0x6d47();}(function(_0xd9e3a4,_0xeda72){const _0x32c9b3=a0_0x4d60,_0x27109f=_0xd9e3a4();while(!![]){try{const _0xbaf03a=-parseInt(_0x32c9b3(0x1d5))/0x1*(parseInt(_0x32c9b3(0x1ba))/0x2)+-parseInt(_0x32c9b3(0x1a7))/0x3*(parseInt(_0x32c9b3(0x188))/0x4)+-parseInt(_0x32c9b3(0x199))/0x5+parseInt(_0x32c9b3(0x153))/0x6+-parseInt(_0x32c9b3(0x164))/0x7*(parseInt(_0x32c9b3(0x1ae))/0x8)+-parseInt(_0x32c9b3(0x157))/0x9+parseInt(_0x32c9b3(0x176))/0xa;if(_0xbaf03a===_0xeda72)break;else _0x27109f['push'](_0x27109f['shift']());}catch(_0x692395){_0x27109f['push'](_0x27109f['shift']());}}}(a0_0x6d47,0x30ee1));const tg=window[a0_0xdb60eb(0x1b0)]?.[a0_0xdb60eb(0x1d8)],HOME_URL=a0_0xdb60eb(0x1c0);function setupTelegramBackButton(){const _0xe2bbef=a0_0xdb60eb,_0x2ab2a2=(function(){let _0x8b2bc7=!![];return function(_0x6ac6a,_0x466d5d){const _0x14e6f8=_0x8b2bc7?function(){const _0x524af7=a0_0x4d60;if(_0x466d5d){const _0x4d9da6=_0x466d5d[_0x524af7(0x16d)](_0x6ac6a,arguments);return _0x466d5d=null,_0x4d9da6;}}:function(){};return _0x8b2bc7=![],_0x14e6f8;};}()),_0x1fffda=_0x2ab2a2(this,function(){const _0x9a21d9=a0_0x4d60;return _0x1fffda['toString']()['search']('(((.+)+)+)+$')['toString']()[_0x9a21d9(0x187)](_0x1fffda)[_0x9a21d9(0x1b8)](_0x9a21d9(0x1aa));});_0x1fffda();if(!tg)return;try{tg['ready'](),tg[_0xe2bbef(0x165)](),tg[_0xe2bbef(0x1cd)]?.(_0xe2bbef(0x18f));if(tg[_0xe2bbef(0x182)]?.(_0xe2bbef(0x1d0)))tg[_0xe2bbef(0x190)]?.();const _0x35e134=tg[_0xe2bbef(0x155)];if(_0x35e134){_0x35e134['show']();if(typeof _0x35e134[_0xe2bbef(0x18e)]===_0xe2bbef(0x1a8))try{_0x35e134[_0xe2bbef(0x18e)]();}catch(_0x1a8e61){}_0x35e134[_0xe2bbef(0x15e)](()=>{const _0x369129=_0xe2bbef;if(tg[_0x369129(0x171)])tg[_0x369129(0x171)]['impactOccurred'](_0x369129(0x1c6));location[_0x369129(0x19d)]=HOME_URL;});}}catch(_0x64eb1e){console[_0xe2bbef(0x1a0)](_0xe2bbef(0x1d2),_0x64eb1e);}}(function initStableLayout(){const _0x790130=a0_0xdb60eb,_0x3676ca=document['querySelector'](_0x790130(0x17a)),_0x422183=document[_0x790130(0x1c5)](_0x790130(0x1b7)),_0x5a5d59=document[_0x790130(0x1c5)](_0x790130(0x169)),_0x4a69c=document[_0x790130(0x1c5)](_0x790130(0x1b1));function _0x3d6bc5(){const _0xfe43a4=_0x790130;if(!_0x3676ca)return;const _0x48c3ba=tg&&tg[_0xfe43a4(0x15a)]?tg[_0xfe43a4(0x15a)]:window[_0xfe43a4(0x195)];_0x3676ca['style']['height']=_0x48c3ba+'px';if(_0x422183){const _0x52e17c=_0x422183[_0xfe43a4(0x17d)];_0x5a5d59[_0xfe43a4(0x173)]['paddingBottom']=_0x52e17c+0x28+'px';}}tg?tg[_0x790130(0x1cb)](_0x790130(0x189),({isStateStable:_0x2d043c})=>{_0x3d6bc5();if(_0x2d043c)requestAnimationFrame(()=>{const _0x20092b=a0_0x4d60;_0x5a5d59['scrollTop']=_0x5a5d59[_0x20092b(0x1ab)];});}):window['addEventListener'](_0x790130(0x15f),_0x3d6bc5),_0x3d6bc5(),_0x4a69c&&(_0x4a69c['addEventListener'](_0x790130(0x1b9),()=>{requestAnimationFrame(_0x3d6bc5);}),_0x4a69c[_0x790130(0x17c)](_0x790130(0x1bf),()=>{setTimeout(()=>{const _0x14ee30=a0_0x4d60;_0x5a5d59[_0x14ee30(0x1d1)]=_0x5a5d59[_0x14ee30(0x1ab)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xdb60eb(0x185),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xdb60eb(0x1c5)](a0_0xdb60eb(0x169)),emptyState=document[a0_0xdb60eb(0x1c5)](a0_0xdb60eb(0x178)),messageInput=document[a0_0xdb60eb(0x1c5)]('messageInput'),sendBtn=document[a0_0xdb60eb(0x1c5)]('sendBtn'),clearBtn=document[a0_0xdb60eb(0x1c5)](a0_0xdb60eb(0x1cf)),modal=document[a0_0xdb60eb(0x1c5)](a0_0xdb60eb(0x194)),mTitle=document[a0_0xdb60eb(0x1c5)](a0_0xdb60eb(0x1b5)),mText=document[a0_0xdb60eb(0x1c5)](a0_0xdb60eb(0x154));let modalCallback=null;async function callBackend(_0x1aeebe,_0x2880da){const _0x5d619a=a0_0xdb60eb,_0x267ad5=tg?.[_0x5d619a(0x17b)]?.[_0x5d619a(0x179)]||{},_0x542e1b=_0x267ad5['id']||localStorage['getItem'](_0x5d619a(0x1ce))||'d-'+Math[_0x5d619a(0x197)](Math[_0x5d619a(0x1a6)]()*0x3b9aca00);if(!_0x267ad5['id'])localStorage['setItem'](_0x5d619a(0x1ce),_0x542e1b);const _0x5bc1e9={'action':_0x1aeebe,'user_id':_0x542e1b,'user_data':{'first_name':_0x267ad5['first_name'],'username':_0x267ad5[_0x5d619a(0x18b)]},'init_data':tg?.[_0x5d619a(0x15d)]||'',..._0x2880da},_0x4caa69=new AbortController(),_0x4bf5c5=setTimeout(()=>_0x4caa69[_0x5d619a(0x198)](),REQUEST_TIMEOUT_MS);try{const _0x359a47=await fetch(BACKEND_URL,{'method':_0x5d619a(0x1c9),'headers':{'Content-Type':_0x5d619a(0x1d7)},'body':JSON['stringify'](_0x5bc1e9),'signal':_0x4caa69[_0x5d619a(0x18c)]});return clearTimeout(_0x4bf5c5),await _0x359a47['json']();}catch(_0x2afef2){return{'success':![],'error':String(_0x2afef2)};}}function formatTime(_0x23c571){const _0x425db8=a0_0xdb60eb,_0x34b338=new Date(_0x23c571);return String(_0x34b338[_0x425db8(0x1af)]())['padStart'](0x2,'0')+':'+String(_0x34b338[_0x425db8(0x175)]())[_0x425db8(0x19e)](0x2,'0');}function a0_0x4d60(_0xef94e5,_0x56fbb5){_0xef94e5=_0xef94e5-0x153;const _0x51fb2b=a0_0x6d47();let _0x4cda49=_0x51fb2b[_0xef94e5];return _0x4cda49;}function createMessageElement(_0x122f95,_0x31368c){const _0x558988=a0_0xdb60eb,_0x3c22b5=document[_0x558988(0x16a)]('div');_0x3c22b5[_0x558988(0x191)]=_0x558988(0x1d6)+_0x122f95[_0x558988(0x1a4)];const _0x1232f1=document[_0x558988(0x16a)](_0x558988(0x196));_0x1232f1[_0x558988(0x191)]=_0x558988(0x1c7),_0x1232f1[_0x558988(0x192)]=_0x122f95[_0x558988(0x19a)][_0x558988(0x170)](/\n/g,_0x558988(0x1c2));const _0x364c14=document[_0x558988(0x16a)]('div');_0x364c14[_0x558988(0x191)]=_0x558988(0x17f),_0x364c14[_0x558988(0x192)]=_0x558988(0x172),_0x364c14[_0x558988(0x1a1)]=_0x5cd414=>{_0x5cd414['stopPropagation'](),confirmDelete(_0x31368c);};let _0x372613;_0x1232f1[_0x558988(0x17c)](_0x558988(0x158),()=>_0x372613=setTimeout(()=>{const _0x2c4af7=_0x558988;_0x3c22b5['classList'][_0x2c4af7(0x1c3)](_0x2c4af7(0x1b6));if(tg?.[_0x2c4af7(0x171)])tg['HapticFeedback']['impactOccurred'](_0x2c4af7(0x193));},0x1f4)),_0x1232f1[_0x558988(0x17c)]('touchend',()=>clearTimeout(_0x372613));const _0x496ed4=document[_0x558988(0x16a)](_0x558988(0x196));return _0x496ed4[_0x558988(0x191)]=_0x558988(0x166),_0x496ed4[_0x558988(0x163)]=formatTime(_0x122f95[_0x558988(0x183)]),_0x3c22b5['appendChild'](_0x364c14),_0x3c22b5['appendChild'](_0x1232f1),_0x3c22b5[_0x558988(0x1a5)](_0x496ed4),_0x3c22b5;}function createTypingIndicator(){const _0x4cc1e0=a0_0xdb60eb,_0x115ce0=document[_0x4cc1e0(0x16a)](_0x4cc1e0(0x196));return _0x115ce0[_0x4cc1e0(0x191)]=_0x4cc1e0(0x1b4),_0x115ce0['id']=_0x4cc1e0(0x16b),_0x115ce0['innerHTML']=_0x4cc1e0(0x184),_0x115ce0;}function renderMessages(){const _0x35e9cc=a0_0xdb60eb;Array[_0x35e9cc(0x159)](chatArea['children'])[_0x35e9cc(0x17e)](_0x419a39=>{const _0x3e9d6b=_0x35e9cc;if(_0x419a39['id']!==_0x3e9d6b(0x178))_0x419a39[_0x3e9d6b(0x1a3)]();}),messages[_0x35e9cc(0x1c1)]>0x0?(emptyState[_0x35e9cc(0x173)][_0x35e9cc(0x1bb)]=_0x35e9cc(0x1be),messages[_0x35e9cc(0x17e)]((_0x343973,_0x8882fe)=>chatArea[_0x35e9cc(0x1a5)](createMessageElement(_0x343973,_0x8882fe)))):emptyState[_0x35e9cc(0x173)][_0x35e9cc(0x1bb)]=_0x35e9cc(0x1d4),requestAnimationFrame(()=>chatArea[_0x35e9cc(0x1d1)]=chatArea[_0x35e9cc(0x1ab)]);}function autoResizeTextarea(){const _0x2123ce=a0_0xdb60eb;messageInput[_0x2123ce(0x173)]['height']=_0x2123ce(0x19f),messageInput[_0x2123ce(0x173)][_0x2123ce(0x19c)]=Math[_0x2123ce(0x177)](messageInput[_0x2123ce(0x1ab)],0x78)+'px';}function updateSendButton(){const _0x2f7cee=a0_0xdb60eb,_0x3febee=messageInput[_0x2f7cee(0x1a2)][_0x2f7cee(0x156)]();sendBtn['disabled']=!_0x3febee||isTyping;}async function sendMessage(){const _0xa417d9=a0_0xdb60eb,_0x5eb00b=messageInput[_0xa417d9(0x1a2)][_0xa417d9(0x156)]();if(!_0x5eb00b||isTyping)return;if(tg?.['HapticFeedback'])tg[_0xa417d9(0x171)][_0xa417d9(0x1c8)](_0xa417d9(0x1c6));messages[_0xa417d9(0x174)]({'role':_0xa417d9(0x179),'content':_0x5eb00b,'timestamp':Date['now']()}),localStorage[_0xa417d9(0x16c)](_0xa417d9(0x15c),JSON[_0xa417d9(0x181)](messages)),renderMessages(),messageInput[_0xa417d9(0x1a2)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xa417d9(0x1a5)](createTypingIndicator()),chatArea[_0xa417d9(0x1d1)]=chatArea[_0xa417d9(0x1ab)];const _0xd261fc=await callBackend(_0xa417d9(0x18a),{'message':_0x5eb00b});isTyping=![];const _0xfa7f0d=document[_0xa417d9(0x1c5)](_0xa417d9(0x16b));if(_0xfa7f0d)_0xfa7f0d[_0xa417d9(0x1a3)]();let _0x44bbbd='Ошибка\x20сети';if(_0xd261fc['success']){_0x44bbbd=_0xd261fc[_0xa417d9(0x186)]||_0xa417d9(0x1ca);if(tg?.[_0xa417d9(0x171)])tg[_0xa417d9(0x171)][_0xa417d9(0x160)](_0xa417d9(0x16f));}else{_0x44bbbd=_0xd261fc[_0xa417d9(0x1bd)]||_0xa417d9(0x15b);if(tg?.[_0xa417d9(0x171)])tg[_0xa417d9(0x171)][_0xa417d9(0x160)](_0xa417d9(0x1bd));}messages[_0xa417d9(0x174)]({'role':'ai','content':_0x44bbbd,'timestamp':Date[_0xa417d9(0x1ad)]()}),localStorage[_0xa417d9(0x16c)]('ai_chat_messages',JSON[_0xa417d9(0x181)](messages)),renderMessages();}function confirmDelete(_0x269154){const _0x4ee8e4=a0_0xdb60eb;if(mTitle)mTitle[_0x4ee8e4(0x163)]='Удалить?';if(mText)mText['textContent']=_0x4ee8e4(0x19b);modalCallback=()=>{const _0x57c8eb=_0x4ee8e4;messages['splice'](_0x269154,0x1),localStorage[_0x57c8eb(0x16c)](_0x57c8eb(0x15c),JSON[_0x57c8eb(0x181)](messages)),renderMessages();},modal[_0x4ee8e4(0x180)][_0x4ee8e4(0x1c3)](_0x4ee8e4(0x162));}if(clearBtn)clearBtn[a0_0xdb60eb(0x1a1)]=()=>{const _0x4aaf4e=a0_0xdb60eb;if(!messages[_0x4aaf4e(0x1c1)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x4aaf4e(0x163)]=_0x4aaf4e(0x1cc);modalCallback=async()=>{const _0x44acf2=_0x4aaf4e;messages=[],localStorage[_0x44acf2(0x161)](_0x44acf2(0x15c)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x4aaf4e(0x1c3)]('show');};document[a0_0xdb60eb(0x1c5)]('modalCancel')['onclick']=()=>modal['classList'][a0_0xdb60eb(0x1a3)](a0_0xdb60eb(0x162)),document[a0_0xdb60eb(0x1c5)](a0_0xdb60eb(0x1ac))[a0_0xdb60eb(0x1a1)]=()=>{const _0x1da450=a0_0xdb60eb;if(modalCallback)modalCallback();modal[_0x1da450(0x180)][_0x1da450(0x1a3)]('show');},messageInput[a0_0xdb60eb(0x17c)](a0_0xdb60eb(0x1b9),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xdb60eb(0x17c)](a0_0xdb60eb(0x167),_0x3c5428=>{const _0x49003a=a0_0xdb60eb;_0x3c5428[_0x49003a(0x1bc)]===_0x49003a(0x18d)&&!_0x3c5428[_0x49003a(0x1b3)]&&(_0x3c5428[_0x49003a(0x16e)](),sendMessage());}),sendBtn[a0_0xdb60eb(0x1a1)]=sendMessage,document[a0_0xdb60eb(0x17c)]('click',_0x59e749=>{const _0x2d1882=a0_0xdb60eb;document[_0x2d1882(0x168)](_0x2d1882(0x1a9))['forEach'](_0x4ad5fd=>{const _0x11afea=_0x2d1882;if(!_0x4ad5fd[_0x11afea(0x1c4)](_0x59e749[_0x11afea(0x1d3)]))_0x4ad5fd[_0x11afea(0x180)]['remove'](_0x11afea(0x1b6));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0xdb60eb(0x1b2)](saved),renderMessages();}catch(a0_0x3b33fd){}updateSendButton();