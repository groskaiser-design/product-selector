const a0_0x489d96=a0_0x3a9a;(function(_0x55b42f,_0x4bd6a5){const _0x51cb28=a0_0x3a9a,_0x226140=_0x55b42f();while(!![]){try{const _0x48d11b=parseInt(_0x51cb28(0xfe))/0x1*(-parseInt(_0x51cb28(0x14e))/0x2)+-parseInt(_0x51cb28(0xf8))/0x3+-parseInt(_0x51cb28(0x123))/0x4*(parseInt(_0x51cb28(0x10a))/0x5)+-parseInt(_0x51cb28(0x113))/0x6*(-parseInt(_0x51cb28(0x137))/0x7)+parseInt(_0x51cb28(0x163))/0x8*(-parseInt(_0x51cb28(0x13a))/0x9)+parseInt(_0x51cb28(0x12e))/0xa*(parseInt(_0x51cb28(0x130))/0xb)+parseInt(_0x51cb28(0x15d))/0xc;if(_0x48d11b===_0x4bd6a5)break;else _0x226140['push'](_0x226140['shift']());}catch(_0x23484f){_0x226140['push'](_0x226140['shift']());}}}(a0_0xcfb9,0x8ce33));const tg=window[a0_0x489d96(0xf3)]?.['WebApp'],HOME_URL=a0_0x489d96(0x100);function setupTelegramBackButton(){const _0x5cdb2d=a0_0x489d96;if(!tg)return;try{tg['ready'](),tg[_0x5cdb2d(0x12d)](),tg[_0x5cdb2d(0x135)]?.('#050505');if(tg[_0x5cdb2d(0x14d)]?.(_0x5cdb2d(0x10f)))tg[_0x5cdb2d(0x11a)]?.();const _0x47398c=tg['BackButton'];if(_0x47398c){_0x47398c[_0x5cdb2d(0xff)]();if(typeof _0x47398c[_0x5cdb2d(0x158)]===_0x5cdb2d(0x133))try{_0x47398c['offClick']();}catch(_0x2ddc71){}_0x47398c[_0x5cdb2d(0x11f)](()=>{const _0x3360f2=_0x5cdb2d;if(tg[_0x3360f2(0x146)])tg[_0x3360f2(0x146)][_0x3360f2(0x15f)](_0x3360f2(0x134));location[_0x3360f2(0x115)]=HOME_URL;});}}catch(_0x86283d){console[_0x5cdb2d(0x105)](_0x5cdb2d(0x142),_0x86283d);}}(function initStableLayout(){const _0x4a1c31=a0_0x489d96,_0x59d431=(function(){let _0x535226=!![];return function(_0x469865,_0x273b62){const _0x80cb86=_0x535226?function(){const _0x52e804=a0_0x3a9a;if(_0x273b62){const _0x455336=_0x273b62[_0x52e804(0xf7)](_0x469865,arguments);return _0x273b62=null,_0x455336;}}:function(){};return _0x535226=![],_0x80cb86;};}()),_0x154533=document['querySelector']('.container'),_0x9f123b=document[_0x4a1c31(0x109)]('inputArea'),_0x4d0dbd=document[_0x4a1c31(0x109)](_0x4a1c31(0x136)),_0x364a14=document['getElementById']('messageInput');function _0x37e754(){const _0x1c35bf=_0x4a1c31,_0x5d452b=_0x59d431(this,function(){const _0xc2c35c=a0_0x3a9a;return _0x5d452b[_0xc2c35c(0x149)]()[_0xc2c35c(0x119)](_0xc2c35c(0x126))['toString']()['constructor'](_0x5d452b)[_0xc2c35c(0x119)](_0xc2c35c(0x126));});_0x5d452b();if(!_0x154533)return;const _0xb3e61a=tg&&tg['viewportHeight']?tg[_0x1c35bf(0x125)]:window[_0x1c35bf(0x159)];_0x154533[_0x1c35bf(0x143)]['height']=_0xb3e61a+'px';if(_0x9f123b){const _0x300374=_0x9f123b[_0x1c35bf(0xfa)];_0x4d0dbd['style'][_0x1c35bf(0x121)]=_0x300374+0x28+'px';}}tg?tg[_0x4a1c31(0x15e)]('viewportChanged',({isStateStable:_0xc9e652})=>{_0x37e754();if(_0xc9e652)requestAnimationFrame(()=>{const _0x2fc733=a0_0x3a9a;_0x4d0dbd[_0x2fc733(0x111)]=_0x4d0dbd[_0x2fc733(0x15a)];});}):window['addEventListener'](_0x4a1c31(0x11e),_0x37e754),_0x37e754(),_0x364a14&&(_0x364a14[_0x4a1c31(0x101)](_0x4a1c31(0x118),()=>{requestAnimationFrame(_0x37e754);}),_0x364a14[_0x4a1c31(0x101)](_0x4a1c31(0x168),()=>{setTimeout(()=>{const _0x38980d=a0_0x3a9a;_0x4d0dbd[_0x38980d(0x111)]=_0x4d0dbd[_0x38980d(0x15a)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x489d96(0xf4),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x489d96(0x136)),emptyState=document[a0_0x489d96(0x109)](a0_0x489d96(0x104)),messageInput=document[a0_0x489d96(0x109)](a0_0x489d96(0x165)),sendBtn=document['getElementById'](a0_0x489d96(0xf9)),clearBtn=document[a0_0x489d96(0x109)]('clearBtn'),modal=document[a0_0x489d96(0x109)]('confirmModal'),mTitle=document[a0_0x489d96(0x109)](a0_0x489d96(0x156)),mText=document[a0_0x489d96(0x109)](a0_0x489d96(0xf6));let modalCallback=null;async function callBackend(_0x25c34d,_0x5571de){const _0x3ad170=a0_0x489d96,_0x155ea5=tg?.[_0x3ad170(0x12c)]?.[_0x3ad170(0x15b)]||{},_0x11da8f=_0x155ea5['id']||localStorage['getItem'](_0x3ad170(0x12a))||'d-'+Math['floor'](Math[_0x3ad170(0x155)]()*0x3b9aca00);if(!_0x155ea5['id'])localStorage[_0x3ad170(0x110)](_0x3ad170(0x12a),_0x11da8f);const _0xc3cb21={'action':_0x25c34d,'user_id':_0x11da8f,'user_data':{'first_name':_0x155ea5[_0x3ad170(0x107)],'username':_0x155ea5['username']},'init_data':tg?.[_0x3ad170(0x164)]||'',..._0x5571de},_0x20b898=new AbortController(),_0x4e8b89=setTimeout(()=>_0x20b898[_0x3ad170(0x102)](),REQUEST_TIMEOUT_MS);try{const _0x73e972=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x3ad170(0x129)},'body':JSON[_0x3ad170(0x167)](_0xc3cb21),'signal':_0x20b898[_0x3ad170(0x131)]});return clearTimeout(_0x4e8b89),await _0x73e972[_0x3ad170(0x14b)]();}catch(_0x36749e){return{'success':![],'error':String(_0x36749e)};}}function a0_0x3a9a(_0x11fe73,_0x34071f){_0x11fe73=_0x11fe73-0xf0;const _0x2b6733=a0_0xcfb9();let _0x32524d=_0x2b6733[_0x11fe73];return _0x32524d;}function formatTime(_0x51cf06){const _0x309d4b=a0_0x489d96,_0x606dea=new Date(_0x51cf06);return String(_0x606dea[_0x309d4b(0xf5)]())[_0x309d4b(0x152)](0x2,'0')+':'+String(_0x606dea['getMinutes']())[_0x309d4b(0x152)](0x2,'0');}function createMessageElement(_0x2018ec,_0x209e16){const _0x820e26=a0_0x489d96,_0x3cdd17=document[_0x820e26(0x14c)](_0x820e26(0x157));_0x3cdd17[_0x820e26(0x108)]=_0x820e26(0x153)+_0x2018ec[_0x820e26(0x128)];const _0x29f81a=document[_0x820e26(0x14c)](_0x820e26(0x157));_0x29f81a['className']='message-bubble',_0x29f81a[_0x820e26(0xfc)]=_0x2018ec[_0x820e26(0x15c)][_0x820e26(0xfd)](/\n/g,_0x820e26(0x147));const _0xbce434=document[_0x820e26(0x14c)](_0x820e26(0x157));_0xbce434[_0x820e26(0x108)]='delete-btn',_0xbce434['innerHTML']=_0x820e26(0x13c),_0xbce434[_0x820e26(0x151)]=_0x29a397=>{const _0x50c9ac=_0x820e26;_0x29a397[_0x50c9ac(0x127)](),confirmDelete(_0x209e16);};let _0x19a144;_0x29f81a[_0x820e26(0x101)](_0x820e26(0x150),()=>_0x19a144=setTimeout(()=>{const _0x53dbdb=_0x820e26;_0x3cdd17['classList']['add'](_0x53dbdb(0x14a));if(tg?.[_0x53dbdb(0x146)])tg[_0x53dbdb(0x146)][_0x53dbdb(0x15f)](_0x53dbdb(0xf1));},0x1f4)),_0x29f81a[_0x820e26(0x101)]('touchend',()=>clearTimeout(_0x19a144));const _0xbcba32=document['createElement'](_0x820e26(0x157));return _0xbcba32[_0x820e26(0x108)]=_0x820e26(0x120),_0xbcba32['textContent']=formatTime(_0x2018ec[_0x820e26(0x162)]),_0x3cdd17[_0x820e26(0xf2)](_0xbce434),_0x3cdd17[_0x820e26(0xf2)](_0x29f81a),_0x3cdd17['appendChild'](_0xbcba32),_0x3cdd17;}function createTypingIndicator(){const _0x2071fd=a0_0x489d96,_0x473801=document['createElement']('div');return _0x473801['className']=_0x2071fd(0x14f),_0x473801['id']='typingIndicator',_0x473801['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x473801;}function renderMessages(){const _0x1fdef2=a0_0x489d96;Array[_0x1fdef2(0x154)](chatArea[_0x1fdef2(0x13e)])[_0x1fdef2(0xfb)](_0xdb3ccd=>{const _0x5dbb13=_0x1fdef2;if(_0xdb3ccd['id']!==_0x5dbb13(0x104))_0xdb3ccd[_0x5dbb13(0x138)]();}),messages[_0x1fdef2(0x10d)]>0x0?(emptyState[_0x1fdef2(0x143)][_0x1fdef2(0x12f)]=_0x1fdef2(0x169),messages['forEach']((_0x531fbb,_0x20d474)=>chatArea[_0x1fdef2(0xf2)](createMessageElement(_0x531fbb,_0x20d474)))):emptyState[_0x1fdef2(0x143)][_0x1fdef2(0x12f)]='flex',requestAnimationFrame(()=>chatArea[_0x1fdef2(0x111)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x4b2fec=a0_0x489d96;messageInput[_0x4b2fec(0x143)][_0x4b2fec(0x139)]='auto',messageInput[_0x4b2fec(0x143)][_0x4b2fec(0x139)]=Math['min'](messageInput[_0x4b2fec(0x15a)],0x78)+'px';}function a0_0xcfb9(){const _0x3e2399=['classList','splice','input','search','disableVerticalSwipes','add','push','clear_history','resize','onClick','message-time','paddingBottom','Enter','8heLzRc','target','viewportHeight','(((.+)+)+)+$','stopPropagation','role','text/plain','debug_uid','typingIndicator','initDataUnsafe','expand','65180UpBkrX','display','121ghNpsv','signal','disabled','function','light','setHeaderColor','chatArea','7iiLLqi','remove','height','4167IANAUd','Удалить?','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','modalCancel','children','ai_chat_messages','parse','notificationOccurred','TG\x20setup\x20error:','style','.message.show-delete','success','HapticFeedback','<br>','now','toString','show-delete','json','createElement','isVersionAtLeast','380EYiFAD','message\x20ai','touchstart','onclick','padStart','message\x20','from','random','modalTitle','div','offClick','innerHeight','scrollHeight','user','content','27320652BgCAdU','onEvent','impactOccurred','value','error','timestamp','7016ywBrNH','initData','messageInput','Пустой\x20ответ','stringify','focus','none','Очистить\x20историю?','medium','appendChild','Telegram','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','getHours','modalText','apply','2272698bDrVuM','sendBtn','offsetHeight','forEach','innerHTML','replace','3122NYMLji','show','./router.html','addEventListener','abort','Начнется\x20новый\x20диалог.','emptyState','warn','click','first_name','className','getElementById','263595dBBZZz','contains','getItem','length','key','6.1','setItem','scrollTop','textContent','545346LsJcpm','trim','href'];a0_0xcfb9=function(){return _0x3e2399;};return a0_0xcfb9();}function updateSendButton(){const _0x3b4bc1=a0_0x489d96,_0x156227=messageInput[_0x3b4bc1(0x160)][_0x3b4bc1(0x114)]();sendBtn[_0x3b4bc1(0x132)]=!_0x156227||isTyping;}async function sendMessage(){const _0x5bcdc4=a0_0x489d96,_0x1012c1=messageInput[_0x5bcdc4(0x160)][_0x5bcdc4(0x114)]();if(!_0x1012c1||isTyping)return;if(tg?.[_0x5bcdc4(0x146)])tg[_0x5bcdc4(0x146)][_0x5bcdc4(0x15f)](_0x5bcdc4(0x134));messages['push']({'role':_0x5bcdc4(0x15b),'content':_0x1012c1,'timestamp':Date[_0x5bcdc4(0x148)]()}),localStorage['setItem'](_0x5bcdc4(0x13f),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5bcdc4(0xf2)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x5bcdc4(0x15a)];const _0x131f9a=await callBackend('send_message',{'message':_0x1012c1});isTyping=![];const _0x43f145=document[_0x5bcdc4(0x109)](_0x5bcdc4(0x12b));if(_0x43f145)_0x43f145[_0x5bcdc4(0x138)]();let _0x49a92c='Ошибка\x20сети';if(_0x131f9a['success']){_0x49a92c=_0x131f9a['text']||_0x5bcdc4(0x166);if(tg?.[_0x5bcdc4(0x146)])tg['HapticFeedback'][_0x5bcdc4(0x141)](_0x5bcdc4(0x145));}else{_0x49a92c=_0x131f9a[_0x5bcdc4(0x161)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg[_0x5bcdc4(0x146)][_0x5bcdc4(0x141)](_0x5bcdc4(0x161));}messages[_0x5bcdc4(0x11c)]({'role':'ai','content':_0x49a92c,'timestamp':Date[_0x5bcdc4(0x148)]()}),localStorage[_0x5bcdc4(0x110)](_0x5bcdc4(0x13f),JSON[_0x5bcdc4(0x167)](messages)),renderMessages();}function confirmDelete(_0x46c677){const _0x50f611=a0_0x489d96;if(mTitle)mTitle[_0x50f611(0x112)]=_0x50f611(0x13b);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x1d8890=_0x50f611;messages[_0x1d8890(0x117)](_0x46c677,0x1),localStorage[_0x1d8890(0x110)]('ai_chat_messages',JSON[_0x1d8890(0x167)](messages)),renderMessages();},modal[_0x50f611(0x116)][_0x50f611(0x11b)](_0x50f611(0xff));}if(clearBtn)clearBtn[a0_0x489d96(0x151)]=()=>{const _0x5cc9ed=a0_0x489d96;if(!messages[_0x5cc9ed(0x10d)])return;if(mTitle)mTitle['textContent']=_0x5cc9ed(0xf0);if(mText)mText[_0x5cc9ed(0x112)]=_0x5cc9ed(0x103);modalCallback=async()=>{const _0x5d9b73=_0x5cc9ed;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x5d9b73(0x11d),{});},modal['classList'][_0x5cc9ed(0x11b)](_0x5cc9ed(0xff));};document[a0_0x489d96(0x109)](a0_0x489d96(0x13d))['onclick']=()=>modal[a0_0x489d96(0x116)][a0_0x489d96(0x138)](a0_0x489d96(0xff)),document[a0_0x489d96(0x109)]('modalConfirm')[a0_0x489d96(0x151)]=()=>{const _0x1d2de0=a0_0x489d96;if(modalCallback)modalCallback();modal[_0x1d2de0(0x116)][_0x1d2de0(0x138)](_0x1d2de0(0xff));},messageInput[a0_0x489d96(0x101)](a0_0x489d96(0x118),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x489d96(0x101)]('keydown',_0x295bdf=>{const _0x4d46a2=a0_0x489d96;_0x295bdf[_0x4d46a2(0x10e)]===_0x4d46a2(0x122)&&!_0x295bdf['shiftKey']&&(_0x295bdf['preventDefault'](),sendMessage());}),sendBtn[a0_0x489d96(0x151)]=sendMessage,document[a0_0x489d96(0x101)](a0_0x489d96(0x106),_0x2be41b=>{const _0x326613=a0_0x489d96;document['querySelectorAll'](_0x326613(0x144))[_0x326613(0xfb)](_0x4c800b=>{const _0x1c7601=_0x326613;if(!_0x4c800b[_0x1c7601(0x10b)](_0x2be41b[_0x1c7601(0x124)]))_0x4c800b[_0x1c7601(0x116)][_0x1c7601(0x138)](_0x1c7601(0x14a));});});const saved=localStorage[a0_0x489d96(0x10c)](a0_0x489d96(0x13f));if(saved)try{messages=JSON[a0_0x489d96(0x140)](saved),renderMessages();}catch(a0_0x3283ba){}updateSendButton();