const a0_0x4b303f=a0_0x2e07;(function(_0x4c1f6b,_0x1a5817){const _0x4db3d2=a0_0x2e07,_0x39d158=_0x4c1f6b();while(!![]){try{const _0x231c72=-parseInt(_0x4db3d2(0x1aa))/0x1+-parseInt(_0x4db3d2(0x18d))/0x2+-parseInt(_0x4db3d2(0x17f))/0x3*(-parseInt(_0x4db3d2(0x1f1))/0x4)+parseInt(_0x4db3d2(0x1b5))/0x5+parseInt(_0x4db3d2(0x18a))/0x6*(-parseInt(_0x4db3d2(0x1c0))/0x7)+parseInt(_0x4db3d2(0x1ad))/0x8*(-parseInt(_0x4db3d2(0x1de))/0x9)+parseInt(_0x4db3d2(0x1a5))/0xa;if(_0x231c72===_0x1a5817)break;else _0x39d158['push'](_0x39d158['shift']());}catch(_0x59b54b){_0x39d158['push'](_0x39d158['shift']());}}}(a0_0x2bcf,0xb8836));const tg=window[a0_0x4b303f(0x1a7)]?.[a0_0x4b303f(0x1ce)],HOME_URL=a0_0x4b303f(0x1ea);function setupTelegramBackButton(){const _0xb8a1e2=a0_0x4b303f,_0x487961=(function(){let _0x93ebb6=!![];return function(_0x2f4265,_0x4ed795){const _0x47368e=_0x93ebb6?function(){if(_0x4ed795){const _0x22ea0b=_0x4ed795['apply'](_0x2f4265,arguments);return _0x4ed795=null,_0x22ea0b;}}:function(){};return _0x93ebb6=![],_0x47368e;};}()),_0x4f9a99=_0x487961(this,function(){const _0xd98340=a0_0x2e07;return _0x4f9a99[_0xd98340(0x1b0)]()['search'](_0xd98340(0x17e))[_0xd98340(0x1b0)]()[_0xd98340(0x194)](_0x4f9a99)[_0xd98340(0x1d7)]('(((.+)+)+)+$');});_0x4f9a99();if(!tg)return;try{tg[_0xb8a1e2(0x1cf)](),tg[_0xb8a1e2(0x1bd)](),tg[_0xb8a1e2(0x19f)]?.('#050505');if(tg[_0xb8a1e2(0x189)]?.('6.1'))tg[_0xb8a1e2(0x1ab)]?.();const _0x31325b=tg[_0xb8a1e2(0x1bf)];if(_0x31325b){_0x31325b[_0xb8a1e2(0x1ba)]();if(typeof _0x31325b[_0xb8a1e2(0x1be)]===_0xb8a1e2(0x173))try{_0x31325b[_0xb8a1e2(0x1be)]();}catch(_0x3bfa9c){}_0x31325b[_0xb8a1e2(0x1cd)](()=>{const _0x5a838b=_0xb8a1e2;if(tg[_0x5a838b(0x1e4)])tg[_0x5a838b(0x1e4)][_0x5a838b(0x1b6)](_0x5a838b(0x188));location[_0x5a838b(0x18c)]=HOME_URL;});}}catch(_0x3b7825){console[_0xb8a1e2(0x1d9)](_0xb8a1e2(0x17b),_0x3b7825);}}(function initStableLayout(){const _0x103d93=a0_0x4b303f,_0x368565=document[_0x103d93(0x196)](_0x103d93(0x1b8)),_0x50f3dd=document[_0x103d93(0x184)](_0x103d93(0x1cc)),_0x522261=document[_0x103d93(0x184)](_0x103d93(0x174)),_0x4276ec=document[_0x103d93(0x184)](_0x103d93(0x180));function _0x323c70(){const _0x161ad4=_0x103d93;if(!_0x368565)return;const _0xb439cd=tg&&tg['viewportHeight']?tg[_0x161ad4(0x1d3)]:window[_0x161ad4(0x1cb)];_0x368565[_0x161ad4(0x190)]['height']=_0xb439cd+'px';if(_0x50f3dd){const _0x3fb199=_0x50f3dd[_0x161ad4(0x198)];_0x522261[_0x161ad4(0x190)]['paddingBottom']=_0x3fb199+0x28+'px';}}tg?tg[_0x103d93(0x18e)](_0x103d93(0x1ee),({isStateStable:_0x3c4b3f})=>{_0x323c70();if(_0x3c4b3f)requestAnimationFrame(()=>{const _0x1021e3=a0_0x2e07;_0x522261[_0x1021e3(0x1ac)]=_0x522261[_0x1021e3(0x1df)];});}):window[_0x103d93(0x1e3)](_0x103d93(0x1f2),_0x323c70),_0x323c70(),_0x4276ec&&(_0x4276ec['addEventListener'](_0x103d93(0x176),()=>{requestAnimationFrame(_0x323c70);}),_0x4276ec[_0x103d93(0x1e3)]('focus',()=>{setTimeout(()=>{const _0x3d0d3d=a0_0x2e07;_0x522261[_0x3d0d3d(0x1ac)]=_0x522261[_0x3d0d3d(0x1df)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x2bcf(){const _0x578f2a=['constructor','content','querySelector','modalConfirm','offsetHeight','forEach','POST','success','emptyState','height','touchend','setHeaderColor','Ошибка\x20сервера','flex','preventDefault','innerHTML','textContent','7613500dxisbM','notificationOccurred','Telegram','display','modalTitle','360044yPfCEH','disableVerticalSwipes','scrollTop','1388792PqngTG','message\x20ai','children','toString','message-bubble','random','abort','appendChild','7537450EHNSsj','impactOccurred','getHours','.container','splice','show','auto','click','expand','offClick','BackButton','6620369XbYLad','send_message','modalText','user','touchstart','text/plain','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Удалить?','getItem','className','typingIndicator','innerHeight','inputArea','onClick','WebApp','ready','trim','target','stringify','viewportHeight','first_name','error','min','search','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','warn','Действие\x20необратимо.','debug_uid','message\x20','show-delete','9YiSxjV','scrollHeight','querySelectorAll','contains','onclick','addEventListener','HapticFeedback','setItem','key','Начнется\x20новый\x20диалог.','Enter','push','./router.html','clear_history','stopPropagation','initData','viewportChanged','none','ai_chat_messages','156sdzPkD','resize','add','now','sendBtn','from','function','chatArea','text','input','signal','remove','initDataUnsafe','<br>','TG\x20setup\x20error:','Очистить\x20историю?','createElement','(((.+)+)+)+$','51771npGoNI','messageInput','timestamp','padStart','Ошибка\x20сети','getElementById','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','modalCancel','role','light','isVersionAtLeast','6olLpvw','.message.show-delete','href','1413374lYjpDi','onEvent','classList','style','value','medium','div'];a0_0x2bcf=function(){return _0x578f2a;};return a0_0x2bcf();}const BACKEND_URL=a0_0x4b303f(0x1c6),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4b303f(0x184)](a0_0x4b303f(0x174)),emptyState=document[a0_0x4b303f(0x184)]('emptyState'),messageInput=document[a0_0x4b303f(0x184)](a0_0x4b303f(0x180)),sendBtn=document[a0_0x4b303f(0x184)](a0_0x4b303f(0x171)),clearBtn=document['getElementById']('clearBtn'),modal=document['getElementById']('confirmModal'),mTitle=document['getElementById'](a0_0x4b303f(0x1a9)),mText=document['getElementById'](a0_0x4b303f(0x1c2));let modalCallback=null;async function callBackend(_0x4d2e9d,_0x2f3a77){const _0x879635=a0_0x4b303f,_0x7ec8fe=tg?.[_0x879635(0x179)]?.[_0x879635(0x1c3)]||{},_0x5a271b=_0x7ec8fe['id']||localStorage['getItem'](_0x879635(0x1db))||'d-'+Math['floor'](Math[_0x879635(0x1b2)]()*0x3b9aca00);if(!_0x7ec8fe['id'])localStorage[_0x879635(0x1e5)](_0x879635(0x1db),_0x5a271b);const _0x3fc59e={'action':_0x4d2e9d,'user_id':_0x5a271b,'user_data':{'first_name':_0x7ec8fe[_0x879635(0x1d4)],'username':_0x7ec8fe['username']},'init_data':tg?.[_0x879635(0x1ed)]||'',..._0x2f3a77},_0x4e6150=new AbortController(),_0x59ee4f=setTimeout(()=>_0x4e6150[_0x879635(0x1b3)](),REQUEST_TIMEOUT_MS);try{const _0x3f435f=await fetch(BACKEND_URL,{'method':_0x879635(0x19a),'headers':{'Content-Type':_0x879635(0x1c5)},'body':JSON[_0x879635(0x1d2)](_0x3fc59e),'signal':_0x4e6150[_0x879635(0x177)]});return clearTimeout(_0x59ee4f),await _0x3f435f['json']();}catch(_0x6350e5){return{'success':![],'error':String(_0x6350e5)};}}function formatTime(_0x1d3f33){const _0x43c6f2=a0_0x4b303f,_0x41b734=new Date(_0x1d3f33);return String(_0x41b734[_0x43c6f2(0x1b7)]())[_0x43c6f2(0x182)](0x2,'0')+':'+String(_0x41b734['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x72f6ab,_0x372456){const _0x3f317c=a0_0x4b303f,_0x57594e=document[_0x3f317c(0x17d)](_0x3f317c(0x193));_0x57594e['className']=_0x3f317c(0x1dc)+_0x72f6ab[_0x3f317c(0x187)];const _0x20a694=document[_0x3f317c(0x17d)](_0x3f317c(0x193));_0x20a694[_0x3f317c(0x1c9)]=_0x3f317c(0x1b1),_0x20a694[_0x3f317c(0x1a3)]=_0x72f6ab[_0x3f317c(0x195)]['replace'](/\n/g,_0x3f317c(0x17a));const _0x94becf=document[_0x3f317c(0x17d)](_0x3f317c(0x193));_0x94becf[_0x3f317c(0x1c9)]='delete-btn',_0x94becf[_0x3f317c(0x1a3)]=_0x3f317c(0x1d8),_0x94becf[_0x3f317c(0x1e2)]=_0x40cd68=>{const _0x3af734=_0x3f317c;_0x40cd68[_0x3af734(0x1ec)](),confirmDelete(_0x372456);};let _0xfdb2af;_0x20a694['addEventListener'](_0x3f317c(0x1c4),()=>_0xfdb2af=setTimeout(()=>{const _0x3adf1a=_0x3f317c;_0x57594e[_0x3adf1a(0x18f)][_0x3adf1a(0x1f3)]('show-delete');if(tg?.[_0x3adf1a(0x1e4)])tg[_0x3adf1a(0x1e4)][_0x3adf1a(0x1b6)](_0x3adf1a(0x192));},0x1f4)),_0x20a694[_0x3f317c(0x1e3)](_0x3f317c(0x19e),()=>clearTimeout(_0xfdb2af));const _0x299b7f=document['createElement'](_0x3f317c(0x193));return _0x299b7f[_0x3f317c(0x1c9)]='message-time',_0x299b7f['textContent']=formatTime(_0x72f6ab[_0x3f317c(0x181)]),_0x57594e[_0x3f317c(0x1b4)](_0x94becf),_0x57594e[_0x3f317c(0x1b4)](_0x20a694),_0x57594e[_0x3f317c(0x1b4)](_0x299b7f),_0x57594e;}function createTypingIndicator(){const _0x26a9d2=a0_0x4b303f,_0x2cb94a=document[_0x26a9d2(0x17d)](_0x26a9d2(0x193));return _0x2cb94a['className']=_0x26a9d2(0x1ae),_0x2cb94a['id']=_0x26a9d2(0x1ca),_0x2cb94a['innerHTML']=_0x26a9d2(0x185),_0x2cb94a;}function renderMessages(){const _0x2030d9=a0_0x4b303f;Array[_0x2030d9(0x172)](chatArea[_0x2030d9(0x1af)])[_0x2030d9(0x199)](_0x3d2b85=>{const _0x3b032b=_0x2030d9;if(_0x3d2b85['id']!==_0x3b032b(0x19c))_0x3d2b85['remove']();}),messages['length']>0x0?(emptyState[_0x2030d9(0x190)][_0x2030d9(0x1a8)]=_0x2030d9(0x1ef),messages[_0x2030d9(0x199)]((_0x169261,_0x20e709)=>chatArea[_0x2030d9(0x1b4)](createMessageElement(_0x169261,_0x20e709)))):emptyState['style'][_0x2030d9(0x1a8)]=_0x2030d9(0x1a1),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x2030d9(0x1df)]);}function autoResizeTextarea(){const _0x528191=a0_0x4b303f;messageInput['style'][_0x528191(0x19d)]=_0x528191(0x1bb),messageInput[_0x528191(0x190)][_0x528191(0x19d)]=Math[_0x528191(0x1d6)](messageInput[_0x528191(0x1df)],0x78)+'px';}function updateSendButton(){const _0x31356d=a0_0x4b303f,_0x53128f=messageInput['value'][_0x31356d(0x1d0)]();sendBtn['disabled']=!_0x53128f||isTyping;}async function sendMessage(){const _0x25f211=a0_0x4b303f,_0x296caf=messageInput[_0x25f211(0x191)][_0x25f211(0x1d0)]();if(!_0x296caf||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x25f211(0x1e4)]['impactOccurred'](_0x25f211(0x188));messages['push']({'role':'user','content':_0x296caf,'timestamp':Date[_0x25f211(0x170)]()}),localStorage['setItem'](_0x25f211(0x1f0),JSON[_0x25f211(0x1d2)](messages)),renderMessages(),messageInput[_0x25f211(0x191)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x25f211(0x1b4)](createTypingIndicator()),chatArea[_0x25f211(0x1ac)]=chatArea[_0x25f211(0x1df)];const _0x3a08c6=await callBackend(_0x25f211(0x1c1),{'message':_0x296caf});isTyping=![];const _0x33ca50=document['getElementById'](_0x25f211(0x1ca));if(_0x33ca50)_0x33ca50[_0x25f211(0x178)]();let _0x533be7=_0x25f211(0x183);if(_0x3a08c6[_0x25f211(0x19b)]){_0x533be7=_0x3a08c6[_0x25f211(0x175)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg[_0x25f211(0x1e4)][_0x25f211(0x1a6)]('success');}else{_0x533be7=_0x3a08c6[_0x25f211(0x1d5)]||_0x25f211(0x1a0);if(tg?.[_0x25f211(0x1e4)])tg[_0x25f211(0x1e4)][_0x25f211(0x1a6)](_0x25f211(0x1d5));}messages[_0x25f211(0x1e9)]({'role':'ai','content':_0x533be7,'timestamp':Date[_0x25f211(0x170)]()}),localStorage[_0x25f211(0x1e5)](_0x25f211(0x1f0),JSON[_0x25f211(0x1d2)](messages)),renderMessages();}function confirmDelete(_0x208601){const _0x5269c3=a0_0x4b303f;if(mTitle)mTitle[_0x5269c3(0x1a4)]=_0x5269c3(0x1c7);if(mText)mText[_0x5269c3(0x1a4)]=_0x5269c3(0x1da);modalCallback=()=>{const _0x1643c3=_0x5269c3;messages[_0x1643c3(0x1b9)](_0x208601,0x1),localStorage[_0x1643c3(0x1e5)](_0x1643c3(0x1f0),JSON[_0x1643c3(0x1d2)](messages)),renderMessages();},modal[_0x5269c3(0x18f)][_0x5269c3(0x1f3)]('show');}if(clearBtn)clearBtn[a0_0x4b303f(0x1e2)]=()=>{const _0x20e860=a0_0x4b303f;if(!messages['length'])return;if(mTitle)mTitle[_0x20e860(0x1a4)]=_0x20e860(0x17c);if(mText)mText[_0x20e860(0x1a4)]=_0x20e860(0x1e7);modalCallback=async()=>{const _0x2cc935=_0x20e860;messages=[],localStorage['removeItem'](_0x2cc935(0x1f0)),renderMessages(),callBackend(_0x2cc935(0x1eb),{});},modal['classList'][_0x20e860(0x1f3)](_0x20e860(0x1ba));};document[a0_0x4b303f(0x184)](a0_0x4b303f(0x186))[a0_0x4b303f(0x1e2)]=()=>modal[a0_0x4b303f(0x18f)][a0_0x4b303f(0x178)](a0_0x4b303f(0x1ba)),document[a0_0x4b303f(0x184)](a0_0x4b303f(0x197))[a0_0x4b303f(0x1e2)]=()=>{const _0x50c135=a0_0x4b303f;if(modalCallback)modalCallback();modal[_0x50c135(0x18f)][_0x50c135(0x178)]('show');},messageInput['addEventListener'](a0_0x4b303f(0x176),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4b303f(0x1e3)]('keydown',_0x2cd9a3=>{const _0x2f09ad=a0_0x4b303f;_0x2cd9a3[_0x2f09ad(0x1e6)]===_0x2f09ad(0x1e8)&&!_0x2cd9a3['shiftKey']&&(_0x2cd9a3[_0x2f09ad(0x1a2)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x4b303f(0x1e3)](a0_0x4b303f(0x1bc),_0x57c06b=>{const _0x4487e7=a0_0x4b303f;document[_0x4487e7(0x1e0)](_0x4487e7(0x18b))[_0x4487e7(0x199)](_0x31ce8f=>{const _0x1dd4e4=_0x4487e7;if(!_0x31ce8f[_0x1dd4e4(0x1e1)](_0x57c06b[_0x1dd4e4(0x1d1)]))_0x31ce8f[_0x1dd4e4(0x18f)][_0x1dd4e4(0x178)](_0x1dd4e4(0x1dd));});});function a0_0x2e07(_0x4d0bd6,_0x106881){_0x4d0bd6=_0x4d0bd6-0x170;const _0x3e3eea=a0_0x2bcf();let _0x28488f=_0x3e3eea[_0x4d0bd6];return _0x28488f;}const saved=localStorage[a0_0x4b303f(0x1c8)](a0_0x4b303f(0x1f0));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x12c1ac){}updateSendButton();