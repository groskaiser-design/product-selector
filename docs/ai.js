const a0_0x413627=a0_0x1b43;(function(_0x2d619a,_0x4cbb92){const _0x8c5cd=a0_0x1b43,_0x54c512=_0x2d619a();while(!![]){try{const _0x46a6fe=-parseInt(_0x8c5cd(0x136))/0x1+parseInt(_0x8c5cd(0x107))/0x2*(parseInt(_0x8c5cd(0x10c))/0x3)+parseInt(_0x8c5cd(0x128))/0x4+parseInt(_0x8c5cd(0x121))/0x5+-parseInt(_0x8c5cd(0x13c))/0x6+-parseInt(_0x8c5cd(0xfb))/0x7*(-parseInt(_0x8c5cd(0x157))/0x8)+-parseInt(_0x8c5cd(0x15f))/0x9;if(_0x46a6fe===_0x4cbb92)break;else _0x54c512['push'](_0x54c512['shift']());}catch(_0x46ef42){_0x54c512['push'](_0x54c512['shift']());}}}(a0_0x40b8,0x75d1e));const tg=window[a0_0x413627(0x106)]?.[a0_0x413627(0x16b)],HOME_URL=a0_0x413627(0x14b);function setupTelegramBackButton(){const _0x3e43b9=a0_0x413627,_0x5a1456=(function(){let _0x19a457=!![];return function(_0x187403,_0x58b712){const _0x1e044a=_0x19a457?function(){if(_0x58b712){const _0x15fd9d=_0x58b712['apply'](_0x187403,arguments);return _0x58b712=null,_0x15fd9d;}}:function(){};return _0x19a457=![],_0x1e044a;};}()),_0x4c547c=_0x5a1456(this,function(){const _0x42d696=a0_0x1b43;return _0x4c547c[_0x42d696(0x12a)]()[_0x42d696(0x10e)](_0x42d696(0x13a))[_0x42d696(0x12a)]()[_0x42d696(0x123)](_0x4c547c)[_0x42d696(0x10e)](_0x42d696(0x13a));});_0x4c547c();if(!tg)return;try{tg[_0x3e43b9(0x12e)](),tg[_0x3e43b9(0x10b)](),tg[_0x3e43b9(0x140)]?.(_0x3e43b9(0x16c));if(tg[_0x3e43b9(0x153)]?.('6.1'))tg[_0x3e43b9(0x11d)]?.();const _0x3f0380=tg[_0x3e43b9(0x167)];if(_0x3f0380){_0x3f0380[_0x3e43b9(0x109)]();if(typeof _0x3f0380[_0x3e43b9(0x14d)]===_0x3e43b9(0x155))try{_0x3f0380[_0x3e43b9(0x14d)]();}catch(_0x439f3e){}_0x3f0380[_0x3e43b9(0x16e)](()=>{const _0x108953=_0x3e43b9;if(tg[_0x108953(0xfd)])tg[_0x108953(0xfd)]['impactOccurred'](_0x108953(0x104));location[_0x108953(0x12c)]=HOME_URL;});}}catch(_0x261bfd){console[_0x3e43b9(0x169)](_0x3e43b9(0x11c),_0x261bfd);}}(function initStableLayout(){const _0x586443=a0_0x413627,_0x2715df=document[_0x586443(0x10d)](_0x586443(0x150)),_0x280396=document[_0x586443(0x102)]('inputArea'),_0x2840af=document[_0x586443(0x102)](_0x586443(0x149)),_0x11b795=document[_0x586443(0x102)](_0x586443(0x145));function _0x3ef2fc(){const _0x4ff7aa=_0x586443;if(!_0x2715df)return;const _0x11a3a8=tg&&tg[_0x4ff7aa(0x124)]?tg['viewportHeight']:window[_0x4ff7aa(0x10f)];_0x2715df[_0x4ff7aa(0x14c)]['height']=_0x11a3a8+'px';if(_0x280396){const _0x1b478b=_0x280396[_0x4ff7aa(0x133)];_0x2840af[_0x4ff7aa(0x14c)]['paddingBottom']=_0x1b478b+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0xb45721})=>{_0x3ef2fc();if(_0xb45721)requestAnimationFrame(()=>{_0x2840af['scrollTop']=_0x2840af['scrollHeight'];});}):window[_0x586443(0x13e)](_0x586443(0x16f),_0x3ef2fc),_0x3ef2fc(),_0x11b795&&(_0x11b795[_0x586443(0x13e)](_0x586443(0x16a),()=>{requestAnimationFrame(_0x3ef2fc);}),_0x11b795[_0x586443(0x13e)]('focus',()=>{setTimeout(()=>{const _0x1e8dc6=a0_0x1b43;_0x2840af[_0x1e8dc6(0x119)]=_0x2840af['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x413627(0x11b),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x413627(0x102)](a0_0x413627(0x149)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x413627(0x102)](a0_0x413627(0x145)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x413627(0x102)]('clearBtn'),modal=document['getElementById'](a0_0x413627(0x13d)),mTitle=document[a0_0x413627(0x102)](a0_0x413627(0x11a)),mText=document[a0_0x413627(0x102)](a0_0x413627(0x16d));let modalCallback=null;async function callBackend(_0x30b3f9,_0xbb1cd3){const _0x46d0b6=a0_0x413627,_0xec8dd7=tg?.[_0x46d0b6(0xfa)]?.[_0x46d0b6(0x162)]||{},_0x222fb0=_0xec8dd7['id']||localStorage[_0x46d0b6(0x12f)](_0x46d0b6(0x12d))||'d-'+Math[_0x46d0b6(0x125)](Math['random']()*0x3b9aca00);if(!_0xec8dd7['id'])localStorage[_0x46d0b6(0x132)](_0x46d0b6(0x12d),_0x222fb0);const _0x25e101={'action':_0x30b3f9,'user_id':_0x222fb0,'user_data':{'first_name':_0xec8dd7['first_name'],'username':_0xec8dd7[_0x46d0b6(0x139)]},'init_data':tg?.[_0x46d0b6(0x13b)]||'',..._0xbb1cd3},_0x268505=new AbortController(),_0x21612b=setTimeout(()=>_0x268505[_0x46d0b6(0x152)](),REQUEST_TIMEOUT_MS);try{const _0x263cfc=await fetch(BACKEND_URL,{'method':_0x46d0b6(0x163),'headers':{'Content-Type':_0x46d0b6(0x115)},'body':JSON[_0x46d0b6(0x130)](_0x25e101),'signal':_0x268505[_0x46d0b6(0x170)]});return clearTimeout(_0x21612b),await _0x263cfc['json']();}catch(_0x1a73d8){return{'success':![],'error':String(_0x1a73d8)};}}function formatTime(_0x3f7e1f){const _0x2a14b7=a0_0x413627,_0x9a8d05=new Date(_0x3f7e1f);return String(_0x9a8d05['getHours']())[_0x2a14b7(0x15c)](0x2,'0')+':'+String(_0x9a8d05[_0x2a14b7(0x15a)]())[_0x2a14b7(0x15c)](0x2,'0');}function createMessageElement(_0xe1e172,_0x42a1f2){const _0x548349=a0_0x413627,_0xe5f56=document[_0x548349(0x143)](_0x548349(0xf9));_0xe5f56[_0x548349(0x134)]=_0x548349(0x138)+_0xe1e172[_0x548349(0x154)];const _0x16f683=document['createElement'](_0x548349(0xf9));_0x16f683[_0x548349(0x134)]=_0x548349(0x118),_0x16f683[_0x548349(0xf8)]=_0xe1e172[_0x548349(0x108)]['replace'](/\n/g,'<br>');const _0x554ee7=document[_0x548349(0x143)]('div');_0x554ee7['className']=_0x548349(0x111),_0x554ee7[_0x548349(0xf8)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x554ee7[_0x548349(0x103)]=_0x3fcea4=>{_0x3fcea4['stopPropagation'](),confirmDelete(_0x42a1f2);};let _0x4bc548;_0x16f683[_0x548349(0x13e)](_0x548349(0x164),()=>_0x4bc548=setTimeout(()=>{const _0x3d1078=_0x548349;_0xe5f56[_0x3d1078(0x14e)][_0x3d1078(0x159)](_0x3d1078(0x12b));if(tg?.[_0x3d1078(0xfd)])tg[_0x3d1078(0xfd)][_0x3d1078(0x131)](_0x3d1078(0xfc));},0x1f4)),_0x16f683[_0x548349(0x13e)](_0x548349(0x127),()=>clearTimeout(_0x4bc548));const _0x2e70fa=document[_0x548349(0x143)]('div');return _0x2e70fa[_0x548349(0x134)]=_0x548349(0x101),_0x2e70fa['textContent']=formatTime(_0xe1e172[_0x548349(0x14a)]),_0xe5f56['appendChild'](_0x554ee7),_0xe5f56[_0x548349(0x161)](_0x16f683),_0xe5f56[_0x548349(0x161)](_0x2e70fa),_0xe5f56;}function createTypingIndicator(){const _0x2d4f8e=a0_0x413627,_0x2b9a38=document[_0x2d4f8e(0x143)]('div');return _0x2b9a38[_0x2d4f8e(0x134)]=_0x2d4f8e(0x116),_0x2b9a38['id']=_0x2d4f8e(0x147),_0x2b9a38[_0x2d4f8e(0xf8)]=_0x2d4f8e(0x126),_0x2b9a38;}function renderMessages(){const _0x127eaa=a0_0x413627;Array[_0x127eaa(0x13f)](chatArea[_0x127eaa(0x165)])[_0x127eaa(0x158)](_0x516722=>{const _0x188113=_0x127eaa;if(_0x516722['id']!==_0x188113(0x117))_0x516722['remove']();}),messages[_0x127eaa(0x11f)]>0x0?(emptyState['style'][_0x127eaa(0x151)]=_0x127eaa(0x15e),messages['forEach']((_0x1836e7,_0x3b7acd)=>chatArea[_0x127eaa(0x161)](createMessageElement(_0x1836e7,_0x3b7acd)))):emptyState[_0x127eaa(0x14c)][_0x127eaa(0x151)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x4a5eb8=a0_0x413627;messageInput[_0x4a5eb8(0x14c)][_0x4a5eb8(0x113)]='auto',messageInput['style'][_0x4a5eb8(0x113)]=Math['min'](messageInput[_0x4a5eb8(0x114)],0x78)+'px';}function updateSendButton(){const _0x2fb39e=a0_0x413627,_0x266119=messageInput['value'][_0x2fb39e(0x15b)]();sendBtn[_0x2fb39e(0xfe)]=!_0x266119||isTyping;}function a0_0x1b43(_0x3e87ce,_0x4ebe52){_0x3e87ce=_0x3e87ce-0xf5;const _0x57e424=a0_0x40b8();let _0x41a3fb=_0x57e424[_0x3e87ce];return _0x41a3fb;}async function sendMessage(){const _0xae6ba6=a0_0x413627,_0x14b1b7=messageInput['value'][_0xae6ba6(0x15b)]();if(!_0x14b1b7||isTyping)return;if(tg?.[_0xae6ba6(0xfd)])tg[_0xae6ba6(0xfd)]['impactOccurred'](_0xae6ba6(0x104));messages[_0xae6ba6(0x160)]({'role':_0xae6ba6(0x162),'content':_0x14b1b7,'timestamp':Date[_0xae6ba6(0x110)]()}),localStorage[_0xae6ba6(0x132)](_0xae6ba6(0x156),JSON[_0xae6ba6(0x130)](messages)),renderMessages(),messageInput[_0xae6ba6(0x120)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xae6ba6(0x161)](createTypingIndicator()),chatArea[_0xae6ba6(0x119)]=chatArea[_0xae6ba6(0x114)];const _0x5cb5c5=await callBackend(_0xae6ba6(0xff),{'message':_0x14b1b7});isTyping=![];const _0xce6268=document[_0xae6ba6(0x102)](_0xae6ba6(0x147));if(_0xce6268)_0xce6268[_0xae6ba6(0xf7)]();let _0xd4cd46=_0xae6ba6(0x11e);if(_0x5cb5c5[_0xae6ba6(0x105)]){_0xd4cd46=_0x5cb5c5[_0xae6ba6(0x100)]||'Пустой\x20ответ';if(tg?.[_0xae6ba6(0xfd)])tg['HapticFeedback']['notificationOccurred'](_0xae6ba6(0x105));}else{_0xd4cd46=_0x5cb5c5[_0xae6ba6(0x129)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg[_0xae6ba6(0xfd)][_0xae6ba6(0x10a)](_0xae6ba6(0x129));}messages[_0xae6ba6(0x160)]({'role':'ai','content':_0xd4cd46,'timestamp':Date[_0xae6ba6(0x110)]()}),localStorage[_0xae6ba6(0x132)](_0xae6ba6(0x156),JSON[_0xae6ba6(0x130)](messages)),renderMessages();}function confirmDelete(_0x35404e){const _0x11e40d=a0_0x413627;if(mTitle)mTitle[_0x11e40d(0x144)]=_0x11e40d(0x135);if(mText)mText[_0x11e40d(0x144)]='Действие\x20необратимо.';modalCallback=()=>{const _0x424c90=_0x11e40d;messages[_0x424c90(0xf6)](_0x35404e,0x1),localStorage[_0x424c90(0x132)](_0x424c90(0x156),JSON['stringify'](messages)),renderMessages();},modal[_0x11e40d(0x14e)][_0x11e40d(0x159)](_0x11e40d(0x109));}if(clearBtn)clearBtn['onclick']=()=>{const _0x3f9875=a0_0x413627;if(!messages[_0x3f9875(0x11f)])return;if(mTitle)mTitle[_0x3f9875(0x144)]=_0x3f9875(0x137);if(mText)mText[_0x3f9875(0x144)]=_0x3f9875(0x15d);modalCallback=async()=>{const _0x497057=_0x3f9875;messages=[],localStorage[_0x497057(0x148)](_0x497057(0x156)),renderMessages(),callBackend(_0x497057(0x168),{});},modal[_0x3f9875(0x14e)][_0x3f9875(0x159)]('show');};document[a0_0x413627(0x102)](a0_0x413627(0x141))['onclick']=()=>modal['classList'][a0_0x413627(0xf7)](a0_0x413627(0x109)),document[a0_0x413627(0x102)]('modalConfirm')[a0_0x413627(0x103)]=()=>{const _0x31802a=a0_0x413627;if(modalCallback)modalCallback();modal['classList'][_0x31802a(0xf7)]('show');},messageInput[a0_0x413627(0x13e)](a0_0x413627(0x16a),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x413627(0x166),_0x2909b1=>{const _0x3fdadb=a0_0x413627;_0x2909b1['key']===_0x3fdadb(0x142)&&!_0x2909b1[_0x3fdadb(0x122)]&&(_0x2909b1['preventDefault'](),sendMessage());}),sendBtn[a0_0x413627(0x103)]=sendMessage,document['addEventListener']('click',_0x5b4b88=>{const _0x38aad5=a0_0x413627;document[_0x38aad5(0x112)]('.message.show-delete')[_0x38aad5(0x158)](_0x150416=>{const _0x26a18a=_0x38aad5;if(!_0x150416[_0x26a18a(0x146)](_0x5b4b88[_0x26a18a(0x14f)]))_0x150416[_0x26a18a(0x14e)][_0x26a18a(0xf7)](_0x26a18a(0x12b));});});const saved=localStorage['getItem'](a0_0x413627(0x156));if(saved)try{messages=JSON[a0_0x413627(0xf5)](saved),renderMessages();}catch(a0_0x5894ef){}function a0_0x40b8(){const _0x463eed=['querySelectorAll','height','scrollHeight','text/plain','message\x20ai','emptyState','message-bubble','scrollTop','modalTitle','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','TG\x20setup\x20error:','disableVerticalSwipes','Ошибка\x20сети','length','value','2692940ljVOTQ','shiftKey','constructor','viewportHeight','floor','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','touchend','2420340TUZdSF','error','toString','show-delete','href','debug_uid','ready','getItem','stringify','impactOccurred','setItem','offsetHeight','className','Удалить?','122675SnlOhe','Очистить\x20историю?','message\x20','username','(((.+)+)+)+$','initData','2820468UvaDIH','confirmModal','addEventListener','from','setHeaderColor','modalCancel','Enter','createElement','textContent','messageInput','contains','typingIndicator','removeItem','chatArea','timestamp','./router.html','style','offClick','classList','target','.container','display','abort','isVersionAtLeast','role','function','ai_chat_messages','184568SPgyug','forEach','add','getMinutes','trim','padStart','Начнется\x20новый\x20диалог.','none','9791883vxlWFq','push','appendChild','user','POST','touchstart','children','keydown','BackButton','clear_history','warn','input','WebApp','#050505','modalText','onClick','resize','signal','parse','splice','remove','innerHTML','div','initDataUnsafe','266BAYkCm','medium','HapticFeedback','disabled','send_message','text','message-time','getElementById','onclick','light','success','Telegram','6AhAbns','content','show','notificationOccurred','expand','142959kvNPuX','querySelector','search','innerHeight','now','delete-btn'];a0_0x40b8=function(){return _0x463eed;};return a0_0x40b8();}updateSendButton();