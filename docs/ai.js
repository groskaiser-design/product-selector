const a0_0x5ccacd=a0_0x267b;(function(_0x878d79,_0x370eec){const _0x57f196=a0_0x267b,_0x4a0cd2=_0x878d79();while(!![]){try{const _0x6e69f3=parseInt(_0x57f196(0x166))/0x1+parseInt(_0x57f196(0x109))/0x2*(-parseInt(_0x57f196(0x108))/0x3)+-parseInt(_0x57f196(0x143))/0x4+-parseInt(_0x57f196(0x10b))/0x5*(parseInt(_0x57f196(0x16f))/0x6)+parseInt(_0x57f196(0x15d))/0x7+-parseInt(_0x57f196(0x128))/0x8*(parseInt(_0x57f196(0x114))/0x9)+parseInt(_0x57f196(0x14f))/0xa*(parseInt(_0x57f196(0x122))/0xb);if(_0x6e69f3===_0x370eec)break;else _0x4a0cd2['push'](_0x4a0cd2['shift']());}catch(_0xf5d96d){_0x4a0cd2['push'](_0x4a0cd2['shift']());}}}(a0_0x30a6,0xa8bdc));const tg=window[a0_0x5ccacd(0x161)]?.[a0_0x5ccacd(0x142)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x24e507=a0_0x5ccacd,_0x2bcd13=(function(){let _0x34d7a6=!![];return function(_0x5de350,_0x2e2d88){const _0x475fe7=_0x34d7a6?function(){if(_0x2e2d88){const _0x2d1c11=_0x2e2d88['apply'](_0x5de350,arguments);return _0x2e2d88=null,_0x2d1c11;}}:function(){};return _0x34d7a6=![],_0x475fe7;};}()),_0x215c2d=_0x2bcd13(this,function(){const _0xb08be1=a0_0x267b;return _0x215c2d[_0xb08be1(0x14e)]()[_0xb08be1(0x11a)](_0xb08be1(0x101))[_0xb08be1(0x14e)]()[_0xb08be1(0x10c)](_0x215c2d)[_0xb08be1(0x11a)](_0xb08be1(0x101));});_0x215c2d();if(!tg)return;try{tg[_0x24e507(0x164)](),tg['expand'](),tg[_0x24e507(0x117)]?.('#050505');if(tg[_0x24e507(0x134)]?.(_0x24e507(0x170)))tg[_0x24e507(0x159)]?.();const _0x3ddac0=tg[_0x24e507(0x113)];if(_0x3ddac0){_0x3ddac0[_0x24e507(0x144)]();if(typeof _0x3ddac0[_0x24e507(0x177)]===_0x24e507(0x11f))try{_0x3ddac0[_0x24e507(0x177)]();}catch(_0xd5953d){}_0x3ddac0[_0x24e507(0x16e)](()=>{const _0x5278c3=_0x24e507;if(tg['HapticFeedback'])tg[_0x5278c3(0x111)][_0x5278c3(0x121)](_0x5278c3(0x147));location[_0x5278c3(0x169)]=HOME_URL;});}}catch(_0x102ef3){console['warn'](_0x24e507(0x141),_0x102ef3);}}(function initStableLayout(){const _0x13f3fc=a0_0x5ccacd,_0xd72912=document['querySelector'](_0x13f3fc(0x12f)),_0x5edb29=document[_0x13f3fc(0x152)](_0x13f3fc(0x11c)),_0x2221c9=document[_0x13f3fc(0x152)](_0x13f3fc(0x120)),_0x475143=document[_0x13f3fc(0x152)]('messageInput');function _0x543536(){const _0x145c30=_0x13f3fc;if(!_0xd72912)return;const _0x3725c9=tg&&tg[_0x145c30(0x165)]?tg[_0x145c30(0x165)]:window['innerHeight'];_0xd72912[_0x145c30(0x16a)][_0x145c30(0x17c)]=_0x3725c9+'px';if(_0x5edb29){const _0x549b7c=_0x5edb29[_0x145c30(0x146)];_0x2221c9[_0x145c30(0x16a)]['paddingBottom']=_0x549b7c+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x3eae2f})=>{_0x543536();if(_0x3eae2f)requestAnimationFrame(()=>{const _0x271649=a0_0x267b;_0x2221c9[_0x271649(0x107)]=_0x2221c9[_0x271649(0x119)];});}):window[_0x13f3fc(0x126)]('resize',_0x543536),_0x543536(),_0x475143&&(_0x475143[_0x13f3fc(0x126)](_0x13f3fc(0x102),()=>{requestAnimationFrame(_0x543536);}),_0x475143[_0x13f3fc(0x126)]('focus',()=>{setTimeout(()=>{const _0x5c8017=a0_0x267b;_0x2221c9[_0x5c8017(0x107)]=_0x2221c9[_0x5c8017(0x119)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5ccacd(0x12c),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5ccacd(0x152)](a0_0x5ccacd(0x120)),emptyState=document['getElementById'](a0_0x5ccacd(0x125)),messageInput=document[a0_0x5ccacd(0x152)](a0_0x5ccacd(0x151)),sendBtn=document[a0_0x5ccacd(0x152)]('sendBtn'),clearBtn=document['getElementById'](a0_0x5ccacd(0x10a)),modal=document[a0_0x5ccacd(0x152)](a0_0x5ccacd(0x105)),mTitle=document[a0_0x5ccacd(0x152)]('modalTitle'),mText=document[a0_0x5ccacd(0x152)](a0_0x5ccacd(0x154));let modalCallback=null;async function callBackend(_0x490a2a,_0x21fc79){const _0x268195=a0_0x5ccacd,_0x3f1fc4=tg?.[_0x268195(0x160)]?.[_0x268195(0x132)]||{},_0x2a8e91=_0x3f1fc4['id']||localStorage[_0x268195(0x138)](_0x268195(0x15c))||'d-'+Math[_0x268195(0x17a)](Math[_0x268195(0x106)]()*0x3b9aca00);if(!_0x3f1fc4['id'])localStorage[_0x268195(0x130)]('debug_uid',_0x2a8e91);const _0xe4906={'action':_0x490a2a,'user_id':_0x2a8e91,'user_data':{'first_name':_0x3f1fc4[_0x268195(0x11e)],'username':_0x3f1fc4['username']},'init_data':tg?.[_0x268195(0x168)]||'',..._0x21fc79},_0x4de2e5=new AbortController(),_0x2d726b=setTimeout(()=>_0x4de2e5[_0x268195(0x14b)](),REQUEST_TIMEOUT_MS);try{const _0x58df3c=await fetch(BACKEND_URL,{'method':_0x268195(0x11d),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0xe4906),'signal':_0x4de2e5[_0x268195(0x13f)]});return clearTimeout(_0x2d726b),await _0x58df3c[_0x268195(0x171)]();}catch(_0x1dac1f){return{'success':![],'error':String(_0x1dac1f)};}}function formatTime(_0x217a4a){const _0x545275=a0_0x5ccacd,_0x2e6ee8=new Date(_0x217a4a);return String(_0x2e6ee8[_0x545275(0x10f)]())[_0x545275(0x140)](0x2,'0')+':'+String(_0x2e6ee8['getMinutes']())[_0x545275(0x140)](0x2,'0');}function createMessageElement(_0x2b5f13,_0x4e7fc4){const _0xbc2903=a0_0x5ccacd,_0x553315=document['createElement'](_0xbc2903(0x178));_0x553315[_0xbc2903(0x14d)]=_0xbc2903(0x137)+_0x2b5f13[_0xbc2903(0x149)];const _0x38900c=document['createElement'](_0xbc2903(0x178));_0x38900c[_0xbc2903(0x14d)]=_0xbc2903(0x123),_0x38900c[_0xbc2903(0x100)]=_0x2b5f13[_0xbc2903(0x112)]['replace'](/\n/g,_0xbc2903(0x173));const _0x2ad610=document[_0xbc2903(0x124)]('div');_0x2ad610[_0xbc2903(0x14d)]=_0xbc2903(0x12d),_0x2ad610['innerHTML']=_0xbc2903(0x155),_0x2ad610[_0xbc2903(0x15e)]=_0x4bc35d=>{_0x4bc35d['stopPropagation'](),confirmDelete(_0x4e7fc4);};let _0x51419b;_0x38900c[_0xbc2903(0x126)](_0xbc2903(0x181),()=>_0x51419b=setTimeout(()=>{const _0x283ba7=_0xbc2903;_0x553315['classList'][_0x283ba7(0x172)](_0x283ba7(0x167));if(tg?.[_0x283ba7(0x111)])tg[_0x283ba7(0x111)][_0x283ba7(0x121)]('medium');},0x1f4)),_0x38900c[_0xbc2903(0x126)](_0xbc2903(0x16d),()=>clearTimeout(_0x51419b));const _0x1564f0=document[_0xbc2903(0x124)](_0xbc2903(0x178));return _0x1564f0[_0xbc2903(0x14d)]=_0xbc2903(0x12a),_0x1564f0['textContent']=formatTime(_0x2b5f13[_0xbc2903(0x156)]),_0x553315[_0xbc2903(0x153)](_0x2ad610),_0x553315[_0xbc2903(0x153)](_0x38900c),_0x553315[_0xbc2903(0x153)](_0x1564f0),_0x553315;}function createTypingIndicator(){const _0x5587bb=a0_0x5ccacd,_0x28e160=document[_0x5587bb(0x124)](_0x5587bb(0x178));return _0x28e160['className']=_0x5587bb(0x118),_0x28e160['id']='typingIndicator',_0x28e160['innerHTML']=_0x5587bb(0x13e),_0x28e160;}function a0_0x267b(_0x2194c2,_0xdbd7e4){_0x2194c2=_0x2194c2-0x100;const _0x55d6c9=a0_0x30a6();let _0x9fc36a=_0x55d6c9[_0x2194c2];return _0x9fc36a;}function renderMessages(){const _0x2dd751=a0_0x5ccacd;Array[_0x2dd751(0x150)](chatArea[_0x2dd751(0x110)])[_0x2dd751(0x10e)](_0x378582=>{const _0x2eebdc=_0x2dd751;if(_0x378582['id']!=='emptyState')_0x378582[_0x2eebdc(0x174)]();}),messages[_0x2dd751(0x103)]>0x0?(emptyState[_0x2dd751(0x16a)][_0x2dd751(0x14a)]=_0x2dd751(0x176),messages['forEach']((_0x7c50d8,_0x441adf)=>chatArea['appendChild'](createMessageElement(_0x7c50d8,_0x441adf)))):emptyState[_0x2dd751(0x16a)]['display']=_0x2dd751(0x15b),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x509f4e=a0_0x5ccacd;messageInput[_0x509f4e(0x16a)][_0x509f4e(0x17c)]='auto',messageInput['style'][_0x509f4e(0x17c)]=Math[_0x509f4e(0x17f)](messageInput[_0x509f4e(0x119)],0x78)+'px';}function updateSendButton(){const _0x21c57e=a0_0x5ccacd,_0x5008c3=messageInput['value'][_0x21c57e(0x115)]();sendBtn[_0x21c57e(0x17b)]=!_0x5008c3||isTyping;}async function sendMessage(){const _0x2cebd2=a0_0x5ccacd,_0x40e9ce=messageInput[_0x2cebd2(0x135)][_0x2cebd2(0x115)]();if(!_0x40e9ce||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2cebd2(0x111)][_0x2cebd2(0x121)](_0x2cebd2(0x147));messages['push']({'role':_0x2cebd2(0x132),'content':_0x40e9ce,'timestamp':Date[_0x2cebd2(0x12e)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x2cebd2(0x17d)](messages)),renderMessages(),messageInput[_0x2cebd2(0x135)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x2cebd2(0x107)]=chatArea[_0x2cebd2(0x119)];const _0x505feb=await callBackend(_0x2cebd2(0x175),{'message':_0x40e9ce});isTyping=![];const _0x395501=document[_0x2cebd2(0x152)](_0x2cebd2(0x162));if(_0x395501)_0x395501['remove']();let _0x234290=_0x2cebd2(0x10d);if(_0x505feb[_0x2cebd2(0x16c)]){_0x234290=_0x505feb['text']||_0x2cebd2(0x145);if(tg?.[_0x2cebd2(0x111)])tg[_0x2cebd2(0x111)][_0x2cebd2(0x131)](_0x2cebd2(0x16c));}else{_0x234290=_0x505feb['error']||_0x2cebd2(0x179);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x2cebd2(0x131)](_0x2cebd2(0x136));}messages[_0x2cebd2(0x139)]({'role':'ai','content':_0x234290,'timestamp':Date[_0x2cebd2(0x12e)]()}),localStorage[_0x2cebd2(0x130)](_0x2cebd2(0x163),JSON[_0x2cebd2(0x17d)](messages)),renderMessages();}function a0_0x30a6(){const _0x4803f6=['Действие\x20необратимо.','Начнется\x20новый\x20диалог.','Удалить?','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','signal','padStart','TG\x20setup\x20error:','WebApp','4590376phhDLt','show','Пустой\x20ответ','offsetHeight','light','Enter','role','display','abort','removeItem','className','toString','10uGUjHl','from','messageInput','getElementById','appendChild','modalText','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','timestamp','keydown','key','disableVerticalSwipes','textContent','flex','debug_uid','3487337OmffMe','onclick','modalConfirm','initDataUnsafe','Telegram','typingIndicator','ai_chat_messages','ready','viewportHeight','568484ThOche','show-delete','initData','href','style','classList','success','touchend','onClick','2153958TyGSYW','6.1','json','add','<br>','remove','send_message','none','offClick','div','Ошибка\x20сервера','floor','disabled','height','stringify','Очистить\x20историю?','min','shiftKey','touchstart','innerHTML','(((.+)+)+)+$','input','length','target','confirmModal','random','scrollTop','98985ewsppx','12JDaVAD','clearBtn','15cvQZtG','constructor','Ошибка\x20сети','forEach','getHours','children','HapticFeedback','content','BackButton','81bWhIbo','trim','preventDefault','setHeaderColor','message\x20ai','scrollHeight','search','parse','inputArea','POST','first_name','function','chatArea','impactOccurred','30780783EdDPEH','message-bubble','createElement','emptyState','addEventListener','contains','667752ZRlHuQ','click','message-time','modalCancel','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','delete-btn','now','.container','setItem','notificationOccurred','user','.message.show-delete','isVersionAtLeast','value','error','message\x20','getItem','push','clear_history'];a0_0x30a6=function(){return _0x4803f6;};return a0_0x30a6();}function confirmDelete(_0x29929b){const _0x4ea79f=a0_0x5ccacd;if(mTitle)mTitle[_0x4ea79f(0x15a)]=_0x4ea79f(0x13d);if(mText)mText[_0x4ea79f(0x15a)]=_0x4ea79f(0x13b);modalCallback=()=>{const _0xe8f6af=_0x4ea79f;messages['splice'](_0x29929b,0x1),localStorage[_0xe8f6af(0x130)](_0xe8f6af(0x163),JSON[_0xe8f6af(0x17d)](messages)),renderMessages();},modal[_0x4ea79f(0x16b)][_0x4ea79f(0x172)]('show');}if(clearBtn)clearBtn[a0_0x5ccacd(0x15e)]=()=>{const _0x4df470=a0_0x5ccacd;if(!messages[_0x4df470(0x103)])return;if(mTitle)mTitle[_0x4df470(0x15a)]=_0x4df470(0x17e);if(mText)mText[_0x4df470(0x15a)]=_0x4df470(0x13c);modalCallback=async()=>{const _0xd31f6b=_0x4df470;messages=[],localStorage[_0xd31f6b(0x14c)]('ai_chat_messages'),renderMessages(),callBackend(_0xd31f6b(0x13a),{});},modal['classList'][_0x4df470(0x172)](_0x4df470(0x144));};document['getElementById'](a0_0x5ccacd(0x12b))[a0_0x5ccacd(0x15e)]=()=>modal['classList'][a0_0x5ccacd(0x174)](a0_0x5ccacd(0x144)),document[a0_0x5ccacd(0x152)](a0_0x5ccacd(0x15f))['onclick']=()=>{const _0x1a7b08=a0_0x5ccacd;if(modalCallback)modalCallback();modal[_0x1a7b08(0x16b)][_0x1a7b08(0x174)]('show');},messageInput[a0_0x5ccacd(0x126)](a0_0x5ccacd(0x102),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5ccacd(0x126)](a0_0x5ccacd(0x157),_0x5b9559=>{const _0x129ed1=a0_0x5ccacd;_0x5b9559[_0x129ed1(0x158)]===_0x129ed1(0x148)&&!_0x5b9559[_0x129ed1(0x180)]&&(_0x5b9559[_0x129ed1(0x116)](),sendMessage());}),sendBtn[a0_0x5ccacd(0x15e)]=sendMessage,document['addEventListener'](a0_0x5ccacd(0x129),_0x4c3251=>{const _0x57e137=a0_0x5ccacd;document['querySelectorAll'](_0x57e137(0x133))[_0x57e137(0x10e)](_0x4b7613=>{const _0x183325=_0x57e137;if(!_0x4b7613[_0x183325(0x127)](_0x4c3251[_0x183325(0x104)]))_0x4b7613[_0x183325(0x16b)][_0x183325(0x174)](_0x183325(0x167));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x5ccacd(0x11b)](saved),renderMessages();}catch(a0_0x5a7b55){}updateSendButton();