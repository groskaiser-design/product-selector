const a0_0x1ff6a4=a0_0x30a5;function a0_0xc1f6(){const _0x266762=['scrollTop','chatArea','disabled','addEventListener','textContent','sendBtn','6.1','984358FBLYsX','Пустой\x20ответ','getItem','./router.html','Удалить?','onclick','.message.show-delete','7UaDoia','debug_uid','getMinutes','54071190cpiDBl','classList','ai_chat_messages','<br>','now','setHeaderColor','key','stringify','expand','random','appendChild','style','auto','1673046JyHmsg','stopPropagation','onEvent','keydown','getElementById','value','role','function','text','click','querySelector','WebApp','parse','target','Очистить\x20историю?','forEach','726oIgnnp','json','flex','message\x20ai','constructor','ready','viewportChanged','querySelectorAll','scrollHeight','(((.+)+)+)+$','54045TLvPWQ','notificationOccurred','shiftKey','3012860xIQqhp','#050505','createElement','add','initData','user','display','input','abort','TG\x20setup\x20error:','success','toString','POST','impactOccurred','error','replace','Ошибка\x20сервера','confirmModal','message\x20','modalCancel','search','from','HapticFeedback','padStart','push','remove','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','show','height','href','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','5472872suPMTF','preventDefault','isVersionAtLeast','13899128TrnfeN','floor','div','send_message','timestamp','removeItem','splice','messageInput','touchend','clearBtn','inputArea','offClick','children','Enter','apply','modalTitle','contains','trim','.container','onClick','Начнется\x20новый\x20диалог.','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','innerHTML','viewportHeight','username','3irIROR','min','typingIndicator','light','touchstart','emptyState','disableVerticalSwipes','setItem','medium','text/plain','offsetHeight','Ошибка\x20сети','className','first_name'];a0_0xc1f6=function(){return _0x266762;};return a0_0xc1f6();}(function(_0x3e18c3,_0x1416e0){const _0x2ab90c=a0_0x30a5,_0x4605ba=_0x3e18c3();while(!![]){try{const _0x25d9ae=-parseInt(_0x2ab90c(0x16b))/0x1+-parseInt(_0x2ab90c(0x11b))/0x2*(parseInt(_0x2ab90c(0x156))/0x3)+-parseInt(_0x2ab90c(0x13a))/0x4+parseInt(_0x2ab90c(0x118))/0x5*(parseInt(_0x2ab90c(0x10e))/0x6)+parseInt(_0x2ab90c(0xee))/0x7*(-parseInt(_0x2ab90c(0x13d))/0x8)+-parseInt(_0x2ab90c(0xfe))/0x9+parseInt(_0x2ab90c(0xf1))/0xa;if(_0x25d9ae===_0x1416e0)break;else _0x4605ba['push'](_0x4605ba['shift']());}catch(_0x99d414){_0x4605ba['push'](_0x4605ba['shift']());}}}(a0_0xc1f6,0xe3b6d));const tg=window['Telegram']?.[a0_0x1ff6a4(0x109)],HOME_URL=a0_0x1ff6a4(0xea);function setupTelegramBackButton(){const _0x3871ce=a0_0x1ff6a4,_0x3b2f33=(function(){let _0x36e897=!![];return function(_0x23c1ef,_0x1a2b4e){const _0x464dc0=_0x36e897?function(){const _0x174241=a0_0x30a5;if(_0x1a2b4e){const _0x47cfa2=_0x1a2b4e[_0x174241(0x14b)](_0x23c1ef,arguments);return _0x1a2b4e=null,_0x47cfa2;}}:function(){};return _0x36e897=![],_0x464dc0;};}()),_0x4ebf23=_0x3b2f33(this,function(){const _0xbf4ab4=a0_0x30a5;return _0x4ebf23[_0xbf4ab4(0x126)]()[_0xbf4ab4(0x12f)](_0xbf4ab4(0x117))[_0xbf4ab4(0x126)]()[_0xbf4ab4(0x112)](_0x4ebf23)[_0xbf4ab4(0x12f)](_0xbf4ab4(0x117));});_0x4ebf23();if(!tg)return;try{tg[_0x3871ce(0x113)](),tg[_0x3871ce(0xf9)](),tg[_0x3871ce(0xf6)]?.(_0x3871ce(0x11c));if(tg[_0x3871ce(0x13c)]?.(_0x3871ce(0x16a)))tg[_0x3871ce(0x15c)]?.();const _0x199cab=tg['BackButton'];if(_0x199cab){_0x199cab[_0x3871ce(0x136)]();if(typeof _0x199cab[_0x3871ce(0x148)]===_0x3871ce(0x105))try{_0x199cab[_0x3871ce(0x148)]();}catch(_0x46e3bb){}_0x199cab[_0x3871ce(0x150)](()=>{const _0x3250c2=_0x3871ce;if(tg['HapticFeedback'])tg[_0x3250c2(0x131)][_0x3250c2(0x128)](_0x3250c2(0x159));location[_0x3250c2(0x138)]=HOME_URL;});}}catch(_0x24a50e){console['warn'](_0x3871ce(0x124),_0x24a50e);}}(function initStableLayout(){const _0x29a793=a0_0x1ff6a4,_0x270424=document[_0x29a793(0x108)](_0x29a793(0x14f)),_0x457d99=document[_0x29a793(0x102)](_0x29a793(0x147)),_0x43fe3f=document[_0x29a793(0x102)](_0x29a793(0x165)),_0x4dd770=document[_0x29a793(0x102)]('messageInput');function _0x442893(){const _0x1ec6ba=_0x29a793;if(!_0x270424)return;const _0x3829d7=tg&&tg[_0x1ec6ba(0x154)]?tg[_0x1ec6ba(0x154)]:window['innerHeight'];_0x270424[_0x1ec6ba(0xfc)][_0x1ec6ba(0x137)]=_0x3829d7+'px';if(_0x457d99){const _0x307bdb=_0x457d99[_0x1ec6ba(0x160)];_0x43fe3f['style']['paddingBottom']=_0x307bdb+0x28+'px';}}tg?tg[_0x29a793(0x100)](_0x29a793(0x114),({isStateStable:_0x404001})=>{_0x442893();if(_0x404001)requestAnimationFrame(()=>{const _0x53ae09=a0_0x30a5;_0x43fe3f[_0x53ae09(0x164)]=_0x43fe3f[_0x53ae09(0x116)];});}):window[_0x29a793(0x167)]('resize',_0x442893),_0x442893(),_0x4dd770&&(_0x4dd770[_0x29a793(0x167)](_0x29a793(0x122),()=>{requestAnimationFrame(_0x442893);}),_0x4dd770['addEventListener']('focus',()=>{setTimeout(()=>{const _0x100b2f=a0_0x30a5;_0x43fe3f[_0x100b2f(0x164)]=_0x43fe3f['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1ff6a4(0x135),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x30a5(_0x1fcd4b,_0x573803){_0x1fcd4b=_0x1fcd4b-0xe8;const _0x3a5c96=a0_0xc1f6();let _0x112f07=_0x3a5c96[_0x1fcd4b];return _0x112f07;}const chatArea=document['getElementById'](a0_0x1ff6a4(0x165)),emptyState=document['getElementById'](a0_0x1ff6a4(0x15b)),messageInput=document['getElementById'](a0_0x1ff6a4(0x144)),sendBtn=document['getElementById'](a0_0x1ff6a4(0x169)),clearBtn=document[a0_0x1ff6a4(0x102)](a0_0x1ff6a4(0x146)),modal=document[a0_0x1ff6a4(0x102)](a0_0x1ff6a4(0x12c)),mTitle=document[a0_0x1ff6a4(0x102)](a0_0x1ff6a4(0x14c)),mText=document[a0_0x1ff6a4(0x102)]('modalText');let modalCallback=null;async function callBackend(_0x43b1f6,_0x261140){const _0x3a5d8d=a0_0x1ff6a4,_0x392377=tg?.['initDataUnsafe']?.[_0x3a5d8d(0x120)]||{},_0x71c94d=_0x392377['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x3a5d8d(0x13e)](Math[_0x3a5d8d(0xfa)]()*0x3b9aca00);if(!_0x392377['id'])localStorage['setItem'](_0x3a5d8d(0xef),_0x71c94d);const _0x1762cf={'action':_0x43b1f6,'user_id':_0x71c94d,'user_data':{'first_name':_0x392377[_0x3a5d8d(0x163)],'username':_0x392377[_0x3a5d8d(0x155)]},'init_data':tg?.[_0x3a5d8d(0x11f)]||'',..._0x261140},_0x26519d=new AbortController(),_0x4a33e0=setTimeout(()=>_0x26519d[_0x3a5d8d(0x123)](),REQUEST_TIMEOUT_MS);try{const _0x573e2b=await fetch(BACKEND_URL,{'method':_0x3a5d8d(0x127),'headers':{'Content-Type':_0x3a5d8d(0x15f)},'body':JSON['stringify'](_0x1762cf),'signal':_0x26519d['signal']});return clearTimeout(_0x4a33e0),await _0x573e2b[_0x3a5d8d(0x10f)]();}catch(_0x2f415a){return{'success':![],'error':String(_0x2f415a)};}}function formatTime(_0x211a62){const _0x3a2a79=a0_0x1ff6a4,_0x5cb044=new Date(_0x211a62);return String(_0x5cb044['getHours']())[_0x3a2a79(0x132)](0x2,'0')+':'+String(_0x5cb044[_0x3a2a79(0xf0)]())['padStart'](0x2,'0');}function createMessageElement(_0x1abd12,_0x59c852){const _0x629c68=a0_0x1ff6a4,_0x4a6b2d=document[_0x629c68(0x11d)](_0x629c68(0x13f));_0x4a6b2d[_0x629c68(0x162)]=_0x629c68(0x12d)+_0x1abd12[_0x629c68(0x104)];const _0x46b85d=document[_0x629c68(0x11d)](_0x629c68(0x13f));_0x46b85d['className']='message-bubble',_0x46b85d[_0x629c68(0x153)]=_0x1abd12['content'][_0x629c68(0x12a)](/\n/g,_0x629c68(0xf4));const _0xc86e43=document[_0x629c68(0x11d)](_0x629c68(0x13f));_0xc86e43['className']='delete-btn',_0xc86e43[_0x629c68(0x153)]=_0x629c68(0x152),_0xc86e43[_0x629c68(0xec)]=_0x4ed15d=>{const _0x2e7ed6=_0x629c68;_0x4ed15d[_0x2e7ed6(0xff)](),confirmDelete(_0x59c852);};let _0x255331;_0x46b85d[_0x629c68(0x167)](_0x629c68(0x15a),()=>_0x255331=setTimeout(()=>{const _0x299900=_0x629c68;_0x4a6b2d[_0x299900(0xf2)][_0x299900(0x11e)]('show-delete');if(tg?.[_0x299900(0x131)])tg[_0x299900(0x131)]['impactOccurred'](_0x299900(0x15e));},0x1f4)),_0x46b85d[_0x629c68(0x167)](_0x629c68(0x145),()=>clearTimeout(_0x255331));const _0x2da25b=document[_0x629c68(0x11d)](_0x629c68(0x13f));return _0x2da25b[_0x629c68(0x162)]='message-time',_0x2da25b[_0x629c68(0x168)]=formatTime(_0x1abd12[_0x629c68(0x141)]),_0x4a6b2d['appendChild'](_0xc86e43),_0x4a6b2d[_0x629c68(0xfb)](_0x46b85d),_0x4a6b2d['appendChild'](_0x2da25b),_0x4a6b2d;}function createTypingIndicator(){const _0x4bc747=a0_0x1ff6a4,_0x4a7c1f=document[_0x4bc747(0x11d)](_0x4bc747(0x13f));return _0x4a7c1f[_0x4bc747(0x162)]=_0x4bc747(0x111),_0x4a7c1f['id']='typingIndicator',_0x4a7c1f[_0x4bc747(0x153)]=_0x4bc747(0x139),_0x4a7c1f;}function renderMessages(){const _0x55a4d6=a0_0x1ff6a4;Array[_0x55a4d6(0x130)](chatArea[_0x55a4d6(0x149)])['forEach'](_0x33ca53=>{const _0x353131=_0x55a4d6;if(_0x33ca53['id']!==_0x353131(0x15b))_0x33ca53[_0x353131(0x134)]();}),messages['length']>0x0?(emptyState[_0x55a4d6(0xfc)][_0x55a4d6(0x121)]='none',messages[_0x55a4d6(0x10d)]((_0x2ca511,_0x28070c)=>chatArea[_0x55a4d6(0xfb)](createMessageElement(_0x2ca511,_0x28070c)))):emptyState[_0x55a4d6(0xfc)][_0x55a4d6(0x121)]=_0x55a4d6(0x110),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x55a4d6(0x116)]);}function autoResizeTextarea(){const _0x2d1248=a0_0x1ff6a4;messageInput[_0x2d1248(0xfc)][_0x2d1248(0x137)]=_0x2d1248(0xfd),messageInput[_0x2d1248(0xfc)]['height']=Math[_0x2d1248(0x157)](messageInput[_0x2d1248(0x116)],0x78)+'px';}function updateSendButton(){const _0x23273f=a0_0x1ff6a4,_0x35d18c=messageInput[_0x23273f(0x103)]['trim']();sendBtn[_0x23273f(0x166)]=!_0x35d18c||isTyping;}async function sendMessage(){const _0x57e84c=a0_0x1ff6a4,_0x312b0b=messageInput[_0x57e84c(0x103)][_0x57e84c(0x14e)]();if(!_0x312b0b||isTyping)return;if(tg?.[_0x57e84c(0x131)])tg['HapticFeedback']['impactOccurred']('light');messages[_0x57e84c(0x133)]({'role':_0x57e84c(0x120),'content':_0x312b0b,'timestamp':Date[_0x57e84c(0xf5)]()}),localStorage['setItem'](_0x57e84c(0xf3),JSON['stringify'](messages)),renderMessages(),messageInput[_0x57e84c(0x103)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x57e84c(0x164)]=chatArea[_0x57e84c(0x116)];const _0x5ceb1f=await callBackend(_0x57e84c(0x140),{'message':_0x312b0b});isTyping=![];const _0x53aed8=document[_0x57e84c(0x102)](_0x57e84c(0x158));if(_0x53aed8)_0x53aed8[_0x57e84c(0x134)]();let _0x325452=_0x57e84c(0x161);if(_0x5ceb1f['success']){_0x325452=_0x5ceb1f[_0x57e84c(0x106)]||_0x57e84c(0xe8);if(tg?.[_0x57e84c(0x131)])tg['HapticFeedback']['notificationOccurred'](_0x57e84c(0x125));}else{_0x325452=_0x5ceb1f[_0x57e84c(0x129)]||_0x57e84c(0x12b);if(tg?.[_0x57e84c(0x131)])tg['HapticFeedback'][_0x57e84c(0x119)](_0x57e84c(0x129));}messages[_0x57e84c(0x133)]({'role':'ai','content':_0x325452,'timestamp':Date[_0x57e84c(0xf5)]()}),localStorage['setItem'](_0x57e84c(0xf3),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x4f41a9){const _0x529232=a0_0x1ff6a4;if(mTitle)mTitle['textContent']=_0x529232(0xeb);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x1c20af=_0x529232;messages[_0x1c20af(0x143)](_0x4f41a9,0x1),localStorage[_0x1c20af(0x15d)](_0x1c20af(0xf3),JSON[_0x1c20af(0xf8)](messages)),renderMessages();},modal[_0x529232(0xf2)][_0x529232(0x11e)](_0x529232(0x136));}if(clearBtn)clearBtn['onclick']=()=>{const _0x5251e2=a0_0x1ff6a4;if(!messages['length'])return;if(mTitle)mTitle[_0x5251e2(0x168)]=_0x5251e2(0x10c);if(mText)mText[_0x5251e2(0x168)]=_0x5251e2(0x151);modalCallback=async()=>{const _0x44d31e=_0x5251e2;messages=[],localStorage[_0x44d31e(0x142)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal['classList']['add'](_0x5251e2(0x136));};document[a0_0x1ff6a4(0x102)](a0_0x1ff6a4(0x12e))[a0_0x1ff6a4(0xec)]=()=>modal['classList']['remove']('show'),document[a0_0x1ff6a4(0x102)]('modalConfirm')[a0_0x1ff6a4(0xec)]=()=>{const _0x53c685=a0_0x1ff6a4;if(modalCallback)modalCallback();modal[_0x53c685(0xf2)][_0x53c685(0x134)](_0x53c685(0x136));},messageInput[a0_0x1ff6a4(0x167)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1ff6a4(0x167)](a0_0x1ff6a4(0x101),_0x4b97e2=>{const _0x429ea6=a0_0x1ff6a4;_0x4b97e2[_0x429ea6(0xf7)]===_0x429ea6(0x14a)&&!_0x4b97e2[_0x429ea6(0x11a)]&&(_0x4b97e2[_0x429ea6(0x13b)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x1ff6a4(0x167)](a0_0x1ff6a4(0x107),_0x13e4ab=>{const _0x11b856=a0_0x1ff6a4;document[_0x11b856(0x115)](_0x11b856(0xed))[_0x11b856(0x10d)](_0x247c67=>{const _0x2bede2=_0x11b856;if(!_0x247c67[_0x2bede2(0x14d)](_0x13e4ab[_0x2bede2(0x10b)]))_0x247c67[_0x2bede2(0xf2)][_0x2bede2(0x134)]('show-delete');});});const saved=localStorage[a0_0x1ff6a4(0xe9)](a0_0x1ff6a4(0xf3));if(saved)try{messages=JSON[a0_0x1ff6a4(0x10a)](saved),renderMessages();}catch(a0_0x512fe1){}updateSendButton();