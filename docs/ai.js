const a0_0x3c7746=a0_0x5019;(function(_0x261662,_0x164421){const _0x2b579c=a0_0x5019,_0x3c13bb=_0x261662();while(!![]){try{const _0x5d5643=-parseInt(_0x2b579c(0x194))/0x1*(-parseInt(_0x2b579c(0x1ea))/0x2)+-parseInt(_0x2b579c(0x1a9))/0x3+-parseInt(_0x2b579c(0x190))/0x4*(parseInt(_0x2b579c(0x179))/0x5)+parseInt(_0x2b579c(0x1dc))/0x6*(parseInt(_0x2b579c(0x1d8))/0x7)+parseInt(_0x2b579c(0x1ad))/0x8+-parseInt(_0x2b579c(0x1f4))/0x9*(-parseInt(_0x2b579c(0x1c0))/0xa)+parseInt(_0x2b579c(0x1ca))/0xb;if(_0x5d5643===_0x164421)break;else _0x3c13bb['push'](_0x3c13bb['shift']());}catch(_0x4b9728){_0x3c13bb['push'](_0x3c13bb['shift']());}}}(a0_0x30c6,0xab0b3));const tg=window[a0_0x3c7746(0x17f)]?.[a0_0x3c7746(0x1db)],HOME_URL=a0_0x3c7746(0x1c3);function setupTelegramBackButton(){const _0x201bd6=a0_0x3c7746;if(!tg)return;try{tg['ready'](),tg[_0x201bd6(0x18b)](),tg[_0x201bd6(0x1c4)]?.('#050505');if(tg[_0x201bd6(0x183)]?.(_0x201bd6(0x1a2)))tg[_0x201bd6(0x178)]?.();const _0x45192c=tg[_0x201bd6(0x184)];if(_0x45192c){_0x45192c[_0x201bd6(0x1d6)]();if(typeof _0x45192c[_0x201bd6(0x1a6)]==='function')try{_0x45192c[_0x201bd6(0x1a6)]();}catch(_0x2ed2b0){}_0x45192c[_0x201bd6(0x1b6)](()=>{const _0x30d7ea=_0x201bd6;if(tg[_0x30d7ea(0x1b3)])tg[_0x30d7ea(0x1b3)][_0x30d7ea(0x17d)](_0x30d7ea(0x19d));location[_0x30d7ea(0x1b9)]=HOME_URL;});}}catch(_0x420a8e){console['warn'](_0x201bd6(0x1d5),_0x420a8e);}}(function initStableLayout(){const _0x172696=a0_0x3c7746,_0x239366=(function(){let _0x53f5a2=!![];return function(_0x2b904d,_0x4e2862){const _0x2f13ad=_0x53f5a2?function(){const _0x1ccfa1=a0_0x5019;if(_0x4e2862){const _0x9370ec=_0x4e2862[_0x1ccfa1(0x192)](_0x2b904d,arguments);return _0x4e2862=null,_0x9370ec;}}:function(){};return _0x53f5a2=![],_0x2f13ad;};}()),_0x118d68=document[_0x172696(0x1ee)]('.container'),_0x544456=document['getElementById'](_0x172696(0x1e0)),_0x4aaf9a=document[_0x172696(0x1ac)](_0x172696(0x1e9)),_0x40c87e=document[_0x172696(0x1ac)](_0x172696(0x1a5));function _0x47acb2(){const _0xc6e328=_0x172696,_0x381e4d=_0x239366(this,function(){const _0x197e00=a0_0x5019;return _0x381e4d[_0x197e00(0x1e2)]()[_0x197e00(0x1a1)]('(((.+)+)+)+$')[_0x197e00(0x1e2)]()[_0x197e00(0x197)](_0x381e4d)[_0x197e00(0x1a1)](_0x197e00(0x1ab));});_0x381e4d();if(!_0x118d68)return;const _0x12bae0=tg&&tg[_0xc6e328(0x1c7)]?tg[_0xc6e328(0x1c7)]:window[_0xc6e328(0x1cb)];_0x118d68['style'][_0xc6e328(0x1d2)]=_0x12bae0+'px';if(_0x544456){const _0x36e6ac=_0x544456[_0xc6e328(0x1ef)];_0x4aaf9a['style'][_0xc6e328(0x1b8)]=_0x36e6ac+0x28+'px';}}tg?tg[_0x172696(0x19c)]('viewportChanged',({isStateStable:_0x1a439d})=>{_0x47acb2();if(_0x1a439d)requestAnimationFrame(()=>{const _0x543ac9=a0_0x5019;_0x4aaf9a[_0x543ac9(0x1e8)]=_0x4aaf9a['scrollHeight'];});}):window[_0x172696(0x1cd)]('resize',_0x47acb2),_0x47acb2(),_0x40c87e&&(_0x40c87e[_0x172696(0x1cd)](_0x172696(0x1bd),()=>{requestAnimationFrame(_0x47acb2);}),_0x40c87e[_0x172696(0x1cd)](_0x172696(0x175),()=>{setTimeout(()=>{const _0x3935e7=a0_0x5019;_0x4aaf9a[_0x3935e7(0x1e8)]=_0x4aaf9a['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3c7746(0x182),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x5019(_0x54023c,_0x1d2498){_0x54023c=_0x54023c-0x175;const _0x725c1e=a0_0x30c6();let _0x1842fe=_0x725c1e[_0x54023c];return _0x1842fe;}const chatArea=document['getElementById']('chatArea'),emptyState=document[a0_0x3c7746(0x1ac)](a0_0x3c7746(0x1ba)),messageInput=document[a0_0x3c7746(0x1ac)](a0_0x3c7746(0x1a5)),sendBtn=document[a0_0x3c7746(0x1ac)](a0_0x3c7746(0x1e5)),clearBtn=document[a0_0x3c7746(0x1ac)](a0_0x3c7746(0x17c)),modal=document[a0_0x3c7746(0x1ac)](a0_0x3c7746(0x180)),mTitle=document[a0_0x3c7746(0x1ac)](a0_0x3c7746(0x191)),mText=document['getElementById'](a0_0x3c7746(0x1be));let modalCallback=null;async function callBackend(_0x56d659,_0x35aa49){const _0x4ad6a0=a0_0x3c7746,_0x3a709d=tg?.[_0x4ad6a0(0x17b)]?.[_0x4ad6a0(0x195)]||{},_0x2b6c75=_0x3a709d['id']||localStorage[_0x4ad6a0(0x1c9)](_0x4ad6a0(0x1d9))||'d-'+Math[_0x4ad6a0(0x1b1)](Math[_0x4ad6a0(0x1b0)]()*0x3b9aca00);if(!_0x3a709d['id'])localStorage[_0x4ad6a0(0x1d1)](_0x4ad6a0(0x1d9),_0x2b6c75);const _0x31cd40={'action':_0x56d659,'user_id':_0x2b6c75,'user_data':{'first_name':_0x3a709d[_0x4ad6a0(0x1aa)],'username':_0x3a709d[_0x4ad6a0(0x185)]},'init_data':tg?.[_0x4ad6a0(0x1a4)]||'',..._0x35aa49},_0x2ab8f6=new AbortController(),_0x1f569a=setTimeout(()=>_0x2ab8f6[_0x4ad6a0(0x1d7)](),REQUEST_TIMEOUT_MS);try{const _0x365523=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x4ad6a0(0x17a)},'body':JSON[_0x4ad6a0(0x1c2)](_0x31cd40),'signal':_0x2ab8f6[_0x4ad6a0(0x1d0)]});return clearTimeout(_0x1f569a),await _0x365523[_0x4ad6a0(0x1ec)]();}catch(_0x337ea8){return{'success':![],'error':String(_0x337ea8)};}}function formatTime(_0x5990a6){const _0x3985c2=a0_0x3c7746,_0x354c2a=new Date(_0x5990a6);return String(_0x354c2a['getHours']())[_0x3985c2(0x186)](0x2,'0')+':'+String(_0x354c2a[_0x3985c2(0x1af)]())[_0x3985c2(0x186)](0x2,'0');}function createMessageElement(_0x5a79ae,_0x4079cf){const _0x42056d=a0_0x3c7746,_0x18882f=document[_0x42056d(0x193)](_0x42056d(0x1e1));_0x18882f[_0x42056d(0x1c8)]=_0x42056d(0x18a)+_0x5a79ae[_0x42056d(0x1a3)];const _0x1d9676=document[_0x42056d(0x193)]('div');_0x1d9676['className']=_0x42056d(0x1de),_0x1d9676[_0x42056d(0x1a8)]=_0x5a79ae[_0x42056d(0x18e)][_0x42056d(0x176)](/\n/g,_0x42056d(0x19b));const _0x53278f=document[_0x42056d(0x193)]('div');_0x53278f[_0x42056d(0x1c8)]=_0x42056d(0x19f),_0x53278f[_0x42056d(0x1a8)]=_0x42056d(0x1cf),_0x53278f[_0x42056d(0x199)]=_0x47e4f6=>{const _0x4fd4ab=_0x42056d;_0x47e4f6[_0x4fd4ab(0x18f)](),confirmDelete(_0x4079cf);};let _0x3b2fe5;_0x1d9676['addEventListener'](_0x42056d(0x1f3),()=>_0x3b2fe5=setTimeout(()=>{const _0x584d73=_0x42056d;_0x18882f[_0x584d73(0x1eb)][_0x584d73(0x1e7)]('show-delete');if(tg?.[_0x584d73(0x1b3)])tg['HapticFeedback'][_0x584d73(0x17d)](_0x584d73(0x1a0));},0x1f4)),_0x1d9676[_0x42056d(0x1cd)]('touchend',()=>clearTimeout(_0x3b2fe5));const _0x5342b6=document[_0x42056d(0x193)](_0x42056d(0x1e1));return _0x5342b6['className']=_0x42056d(0x1c1),_0x5342b6['textContent']=formatTime(_0x5a79ae[_0x42056d(0x1f0)]),_0x18882f[_0x42056d(0x198)](_0x53278f),_0x18882f['appendChild'](_0x1d9676),_0x18882f[_0x42056d(0x198)](_0x5342b6),_0x18882f;}function createTypingIndicator(){const _0x226048=a0_0x3c7746,_0x33a7ec=document[_0x226048(0x193)](_0x226048(0x1e1));return _0x33a7ec[_0x226048(0x1c8)]=_0x226048(0x1e4),_0x33a7ec['id']=_0x226048(0x1ce),_0x33a7ec[_0x226048(0x1a8)]=_0x226048(0x18c),_0x33a7ec;}function renderMessages(){const _0x35bc7c=a0_0x3c7746;Array[_0x35bc7c(0x1f5)](chatArea[_0x35bc7c(0x1ed)])[_0x35bc7c(0x1b7)](_0x27a410=>{const _0x43f347=_0x35bc7c;if(_0x27a410['id']!==_0x43f347(0x1ba))_0x27a410['remove']();}),messages['length']>0x0?(emptyState[_0x35bc7c(0x188)][_0x35bc7c(0x17e)]=_0x35bc7c(0x1f2),messages[_0x35bc7c(0x1b7)]((_0x3edf2b,_0x2b1ef0)=>chatArea[_0x35bc7c(0x198)](createMessageElement(_0x3edf2b,_0x2b1ef0)))):emptyState[_0x35bc7c(0x188)][_0x35bc7c(0x17e)]=_0x35bc7c(0x1b2),requestAnimationFrame(()=>chatArea[_0x35bc7c(0x1e8)]=chatArea[_0x35bc7c(0x1f1)]);}function a0_0x30c6(){const _0x56ad37=['Удалить?','focus','replace','ai_chat_messages','disableVerticalSwipes','3545tiETur','text/plain','initDataUnsafe','clearBtn','impactOccurred','display','Telegram','confirmModal','value','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','isVersionAtLeast','BackButton','username','padStart','preventDefault','style','text','message\x20','expand','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','success','content','stopPropagation','6300AJWacB','modalTitle','apply','createElement','2XQZNrW','user','target','constructor','appendChild','onclick','textContent','<br>','onEvent','light','click','delete-btn','medium','search','6.1','role','initData','messageInput','offClick','Ошибка\x20сервера','innerHTML','3266058JPNmyb','first_name','(((.+)+)+)+$','getElementById','2113016bFCnHR','notificationOccurred','getMinutes','random','floor','flex','HapticFeedback','contains','remove','onClick','forEach','paddingBottom','href','emptyState','push','show-delete','input','modalText','Enter','431270csECML','message-time','stringify','./router.html','setHeaderColor','shiftKey','now','viewportHeight','className','getItem','15243822LsMsbr','innerHeight','.message.show-delete','addEventListener','typingIndicator','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','signal','setItem','height','Очистить\x20историю?','Пустой\x20ответ','TG\x20setup\x20error:','show','abort','28YEvfxf','debug_uid','Начнется\x20новый\x20диалог.','WebApp','1410432PpWoXM','querySelectorAll','message-bubble','error','inputArea','div','toString','splice','message\x20ai','sendBtn','parse','add','scrollTop','chatArea','186358gVEMjp','classList','json','children','querySelector','offsetHeight','timestamp','scrollHeight','none','touchstart','27LGjOVa','from','trim'];a0_0x30c6=function(){return _0x56ad37;};return a0_0x30c6();}function autoResizeTextarea(){const _0x5ce39a=a0_0x3c7746;messageInput[_0x5ce39a(0x188)][_0x5ce39a(0x1d2)]='auto',messageInput['style'][_0x5ce39a(0x1d2)]=Math['min'](messageInput[_0x5ce39a(0x1f1)],0x78)+'px';}function updateSendButton(){const _0x4cd07a=a0_0x3c7746,_0x5eb705=messageInput[_0x4cd07a(0x181)][_0x4cd07a(0x1f6)]();sendBtn['disabled']=!_0x5eb705||isTyping;}async function sendMessage(){const _0x3a4b1d=a0_0x3c7746,_0x3e1789=messageInput['value'][_0x3a4b1d(0x1f6)]();if(!_0x3e1789||isTyping)return;if(tg?.[_0x3a4b1d(0x1b3)])tg[_0x3a4b1d(0x1b3)][_0x3a4b1d(0x17d)](_0x3a4b1d(0x19d));messages[_0x3a4b1d(0x1bb)]({'role':_0x3a4b1d(0x195),'content':_0x3e1789,'timestamp':Date[_0x3a4b1d(0x1c6)]()}),localStorage[_0x3a4b1d(0x1d1)](_0x3a4b1d(0x177),JSON[_0x3a4b1d(0x1c2)](messages)),renderMessages(),messageInput[_0x3a4b1d(0x181)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x3a4b1d(0x1e8)]=chatArea[_0x3a4b1d(0x1f1)];const _0x2dac48=await callBackend('send_message',{'message':_0x3e1789});isTyping=![];const _0x3c6379=document[_0x3a4b1d(0x1ac)](_0x3a4b1d(0x1ce));if(_0x3c6379)_0x3c6379[_0x3a4b1d(0x1b5)]();let _0x219ff3='Ошибка\x20сети';if(_0x2dac48['success']){_0x219ff3=_0x2dac48[_0x3a4b1d(0x189)]||_0x3a4b1d(0x1d4);if(tg?.[_0x3a4b1d(0x1b3)])tg[_0x3a4b1d(0x1b3)][_0x3a4b1d(0x1ae)](_0x3a4b1d(0x18d));}else{_0x219ff3=_0x2dac48[_0x3a4b1d(0x1df)]||_0x3a4b1d(0x1a7);if(tg?.['HapticFeedback'])tg[_0x3a4b1d(0x1b3)][_0x3a4b1d(0x1ae)]('error');}messages[_0x3a4b1d(0x1bb)]({'role':'ai','content':_0x219ff3,'timestamp':Date['now']()}),localStorage[_0x3a4b1d(0x1d1)](_0x3a4b1d(0x177),JSON[_0x3a4b1d(0x1c2)](messages)),renderMessages();}function confirmDelete(_0x29e519){const _0x3d5b3a=a0_0x3c7746;if(mTitle)mTitle[_0x3d5b3a(0x19a)]=_0x3d5b3a(0x1f7);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x3f189e=_0x3d5b3a;messages[_0x3f189e(0x1e3)](_0x29e519,0x1),localStorage[_0x3f189e(0x1d1)](_0x3f189e(0x177),JSON['stringify'](messages)),renderMessages();},modal[_0x3d5b3a(0x1eb)]['add'](_0x3d5b3a(0x1d6));}if(clearBtn)clearBtn['onclick']=()=>{const _0x5eca0f=a0_0x3c7746;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x5eca0f(0x1d3);if(mText)mText[_0x5eca0f(0x19a)]=_0x5eca0f(0x1da);modalCallback=async()=>{messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x5eca0f(0x1eb)][_0x5eca0f(0x1e7)]('show');};document['getElementById']('modalCancel')[a0_0x3c7746(0x199)]=()=>modal[a0_0x3c7746(0x1eb)][a0_0x3c7746(0x1b5)](a0_0x3c7746(0x1d6)),document['getElementById']('modalConfirm')[a0_0x3c7746(0x199)]=()=>{const _0x3fe824=a0_0x3c7746;if(modalCallback)modalCallback();modal[_0x3fe824(0x1eb)][_0x3fe824(0x1b5)]('show');},messageInput[a0_0x3c7746(0x1cd)](a0_0x3c7746(0x1bd),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x1e1078=>{const _0x187e9c=a0_0x3c7746;_0x1e1078['key']===_0x187e9c(0x1bf)&&!_0x1e1078[_0x187e9c(0x1c5)]&&(_0x1e1078[_0x187e9c(0x187)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x3c7746(0x1cd)](a0_0x3c7746(0x19e),_0xf229da=>{const _0x571ee1=a0_0x3c7746;document[_0x571ee1(0x1dd)](_0x571ee1(0x1cc))[_0x571ee1(0x1b7)](_0x342b62=>{const _0x1237bd=_0x571ee1;if(!_0x342b62[_0x1237bd(0x1b4)](_0xf229da[_0x1237bd(0x196)]))_0x342b62[_0x1237bd(0x1eb)][_0x1237bd(0x1b5)](_0x1237bd(0x1bc));});});const saved=localStorage[a0_0x3c7746(0x1c9)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x3c7746(0x1e6)](saved),renderMessages();}catch(a0_0x39bb2f){}updateSendButton();