function a0_0x4ba8(){const _0x58bdc3=['focus','debug_uid','offClick','search','489912uMeLEN','1566MNKhvz','message\x20ai','modalText','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','none','Удалить?','stringify','forEach','getItem','HapticFeedback','div','57976nfvCAq','key','inputArea','modalCancel','first_name','contains','send_message','min','scrollHeight','click','POST','children','isVersionAtLeast','apply','ready','style','classList','touchend','light','setHeaderColor','warn','impactOccurred','#050505','stopPropagation','input','TG\x20setup\x20error:','4BIFkic','viewportChanged','innerHTML','Ошибка\x20сервера','value','replace','show','getHours','keydown','<br>','add','.container','createElement','random','removeItem','Telegram','disabled','height','notificationOccurred','clear_history','href','expand','getMinutes','14640240dBRiwN','querySelector','medium','5714505nfjSsw','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','auto','display','message\x20','flex','now','floor','modalTitle','show-delete','Действие\x20необратимо.','Ошибка\x20сети','shiftKey','message-time','success','trim','role','error','className','addEventListener','onclick','confirmModal','onEvent','messageInput','length','delete-btn','textContent','clearBtn','paddingBottom','padStart','abort','modalConfirm','viewportHeight','292950LgaToa','user','offsetHeight','emptyState','Очистить\x20историю?','push','target','remove','386rYlTEH','ai_chat_messages','4349723phuBhm','WebApp','6.1','resize','getElementById','text','parse','setItem','message-bubble','typingIndicator','toString','Пустой\x20ответ','6843wlqQdo','timestamp','appendChild','querySelectorAll','initDataUnsafe','json','./router.html','scrollTop','(((.+)+)+)+$','chatArea'];a0_0x4ba8=function(){return _0x58bdc3;};return a0_0x4ba8();}const a0_0x5349a6=a0_0x146c;(function(_0x166245,_0xce94e6){const _0x3cb2c1=a0_0x146c,_0x4f37a6=_0x166245();while(!![]){try{const _0x47bdc1=-parseInt(_0x3cb2c1(0x1ca))/0x1+-parseInt(_0x3cb2c1(0x234))/0x2*(parseInt(_0x3cb2c1(0x1bc))/0x3)+-parseInt(_0x3cb2c1(0x1f0))/0x4*(-parseInt(_0x3cb2c1(0x20a))/0x5)+parseInt(_0x3cb2c1(0x22c))/0x6+parseInt(_0x3cb2c1(0x236))/0x7+parseInt(_0x3cb2c1(0x1d6))/0x8*(parseInt(_0x3cb2c1(0x1cb))/0x9)+-parseInt(_0x3cb2c1(0x207))/0xa;if(_0x47bdc1===_0xce94e6)break;else _0x4f37a6['push'](_0x4f37a6['shift']());}catch(_0x55e555){_0x4f37a6['push'](_0x4f37a6['shift']());}}}(a0_0x4ba8,0xa5ff4));const tg=window[a0_0x5349a6(0x1ff)]?.[a0_0x5349a6(0x237)],HOME_URL=a0_0x5349a6(0x1c2);function setupTelegramBackButton(){const _0x47aa9a=a0_0x5349a6;if(!tg)return;try{tg[_0x47aa9a(0x1e4)](),tg[_0x47aa9a(0x205)](),tg[_0x47aa9a(0x1e9)]?.(_0x47aa9a(0x1ec));if(tg[_0x47aa9a(0x1e2)]?.(_0x47aa9a(0x238)))tg['disableVerticalSwipes']?.();const _0x2921e1=tg['BackButton'];if(_0x2921e1){_0x2921e1['show']();if(typeof _0x2921e1[_0x47aa9a(0x1c8)]==='function')try{_0x2921e1[_0x47aa9a(0x1c8)]();}catch(_0x5e96c6){}_0x2921e1['onClick'](()=>{const _0x442cea=_0x47aa9a;if(tg['HapticFeedback'])tg[_0x442cea(0x1d4)][_0x442cea(0x1eb)]('light');location[_0x442cea(0x204)]=HOME_URL;});}}catch(_0x152751){console[_0x47aa9a(0x1ea)](_0x47aa9a(0x1ef),_0x152751);}}(function initStableLayout(){const _0x372b17=a0_0x5349a6,_0xb015e8=(function(){let _0x31faee=!![];return function(_0x3a18fe,_0x39b665){const _0xe23de8=_0x31faee?function(){const _0x4df6ae=a0_0x146c;if(_0x39b665){const _0x4226d0=_0x39b665[_0x4df6ae(0x1e3)](_0x3a18fe,arguments);return _0x39b665=null,_0x4226d0;}}:function(){};return _0x31faee=![],_0xe23de8;};}()),_0x472034=document[_0x372b17(0x208)](_0x372b17(0x1fb)),_0x156178=document[_0x372b17(0x1b4)](_0x372b17(0x1d8)),_0x2912a6=document['getElementById'](_0x372b17(0x1c5)),_0x5b4369=document[_0x372b17(0x1b4)](_0x372b17(0x222));function _0x1a7f09(){const _0xad5bb7=_0x372b17,_0x366e13=_0xb015e8(this,function(){const _0x43c60c=a0_0x146c;return _0x366e13[_0x43c60c(0x1ba)]()[_0x43c60c(0x1c9)](_0x43c60c(0x1c4))[_0x43c60c(0x1ba)]()['constructor'](_0x366e13)[_0x43c60c(0x1c9)]('(((.+)+)+)+$');});_0x366e13();if(!_0x472034)return;const _0x195271=tg&&tg['viewportHeight']?tg[_0xad5bb7(0x22b)]:window['innerHeight'];_0x472034[_0xad5bb7(0x1e5)]['height']=_0x195271+'px';if(_0x156178){const _0x1c115e=_0x156178[_0xad5bb7(0x22e)];_0x2912a6[_0xad5bb7(0x1e5)][_0xad5bb7(0x227)]=_0x1c115e+0x28+'px';}}tg?tg[_0x372b17(0x221)](_0x372b17(0x1f1),({isStateStable:_0x3bc511})=>{_0x1a7f09();if(_0x3bc511)requestAnimationFrame(()=>{const _0x257839=a0_0x146c;_0x2912a6[_0x257839(0x1c3)]=_0x2912a6[_0x257839(0x1de)];});}):window['addEventListener'](_0x372b17(0x239),_0x1a7f09),_0x1a7f09(),_0x5b4369&&(_0x5b4369[_0x372b17(0x21e)](_0x372b17(0x1ee),()=>{requestAnimationFrame(_0x1a7f09);}),_0x5b4369[_0x372b17(0x21e)](_0x372b17(0x1c6),()=>{setTimeout(()=>{const _0x3d1127=a0_0x146c;_0x2912a6[_0x3d1127(0x1c3)]=_0x2912a6[_0x3d1127(0x1de)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5349a6(0x1ce),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5349a6(0x1b4)]('chatArea'),emptyState=document[a0_0x5349a6(0x1b4)](a0_0x5349a6(0x22f)),messageInput=document['getElementById'](a0_0x5349a6(0x222)),sendBtn=document[a0_0x5349a6(0x1b4)]('sendBtn'),clearBtn=document[a0_0x5349a6(0x1b4)](a0_0x5349a6(0x226)),modal=document[a0_0x5349a6(0x1b4)](a0_0x5349a6(0x220)),mTitle=document[a0_0x5349a6(0x1b4)](a0_0x5349a6(0x213)),mText=document[a0_0x5349a6(0x1b4)](a0_0x5349a6(0x1cd));let modalCallback=null;async function callBackend(_0x3e36ef,_0x181c51){const _0x37dd95=a0_0x5349a6,_0xb835ab=tg?.[_0x37dd95(0x1c0)]?.[_0x37dd95(0x22d)]||{},_0x4b476a=_0xb835ab['id']||localStorage[_0x37dd95(0x1d3)](_0x37dd95(0x1c7))||'d-'+Math[_0x37dd95(0x212)](Math[_0x37dd95(0x1fd)]()*0x3b9aca00);if(!_0xb835ab['id'])localStorage[_0x37dd95(0x1b7)]('debug_uid',_0x4b476a);const _0x2fb7e6={'action':_0x3e36ef,'user_id':_0x4b476a,'user_data':{'first_name':_0xb835ab[_0x37dd95(0x1da)],'username':_0xb835ab['username']},'init_data':tg?.['initData']||'',..._0x181c51},_0x37fcf6=new AbortController(),_0x2a936b=setTimeout(()=>_0x37fcf6[_0x37dd95(0x229)](),REQUEST_TIMEOUT_MS);try{const _0x3d934f=await fetch(BACKEND_URL,{'method':_0x37dd95(0x1e0),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x37dd95(0x1d1)](_0x2fb7e6),'signal':_0x37fcf6['signal']});return clearTimeout(_0x2a936b),await _0x3d934f[_0x37dd95(0x1c1)]();}catch(_0x35f4ba){return{'success':![],'error':String(_0x35f4ba)};}}function formatTime(_0x7a2660){const _0x1612ac=a0_0x5349a6,_0x248151=new Date(_0x7a2660);return String(_0x248151[_0x1612ac(0x1f7)]())[_0x1612ac(0x228)](0x2,'0')+':'+String(_0x248151[_0x1612ac(0x206)]())[_0x1612ac(0x228)](0x2,'0');}function a0_0x146c(_0x5cf996,_0xd3d9f6){_0x5cf996=_0x5cf996-0x1b4;const _0x20803b=a0_0x4ba8();let _0x37c7d1=_0x20803b[_0x5cf996];return _0x37c7d1;}function createMessageElement(_0x24531c,_0x318d76){const _0x5ee026=a0_0x5349a6,_0xdee2a0=document[_0x5ee026(0x1fc)](_0x5ee026(0x1d5));_0xdee2a0['className']=_0x5ee026(0x20f)+_0x24531c[_0x5ee026(0x21b)];const _0x14a749=document[_0x5ee026(0x1fc)](_0x5ee026(0x1d5));_0x14a749[_0x5ee026(0x21d)]=_0x5ee026(0x1b8),_0x14a749[_0x5ee026(0x1f2)]=_0x24531c['content'][_0x5ee026(0x1f5)](/\n/g,_0x5ee026(0x1f9));const _0xd45b53=document[_0x5ee026(0x1fc)](_0x5ee026(0x1d5));_0xd45b53[_0x5ee026(0x21d)]=_0x5ee026(0x224),_0xd45b53[_0x5ee026(0x1f2)]=_0x5ee026(0x20b),_0xd45b53[_0x5ee026(0x21f)]=_0x2b155e=>{const _0x5c4091=_0x5ee026;_0x2b155e[_0x5c4091(0x1ed)](),confirmDelete(_0x318d76);};let _0x307ffd;_0x14a749[_0x5ee026(0x21e)]('touchstart',()=>_0x307ffd=setTimeout(()=>{const _0x2fe9b9=_0x5ee026;_0xdee2a0[_0x2fe9b9(0x1e6)]['add'](_0x2fe9b9(0x214));if(tg?.[_0x2fe9b9(0x1d4)])tg[_0x2fe9b9(0x1d4)][_0x2fe9b9(0x1eb)](_0x2fe9b9(0x209));},0x1f4)),_0x14a749['addEventListener'](_0x5ee026(0x1e7),()=>clearTimeout(_0x307ffd));const _0x5932f0=document[_0x5ee026(0x1fc)](_0x5ee026(0x1d5));return _0x5932f0[_0x5ee026(0x21d)]=_0x5ee026(0x218),_0x5932f0[_0x5ee026(0x225)]=formatTime(_0x24531c[_0x5ee026(0x1bd)]),_0xdee2a0[_0x5ee026(0x1be)](_0xd45b53),_0xdee2a0[_0x5ee026(0x1be)](_0x14a749),_0xdee2a0[_0x5ee026(0x1be)](_0x5932f0),_0xdee2a0;}function createTypingIndicator(){const _0x350a01=a0_0x5349a6,_0x4d993b=document[_0x350a01(0x1fc)]('div');return _0x4d993b['className']=_0x350a01(0x1cc),_0x4d993b['id']='typingIndicator',_0x4d993b[_0x350a01(0x1f2)]=_0x350a01(0x20c),_0x4d993b;}function renderMessages(){const _0x23619e=a0_0x5349a6;Array['from'](chatArea[_0x23619e(0x1e1)])[_0x23619e(0x1d2)](_0x4df3f0=>{const _0x3c5a3a=_0x23619e;if(_0x4df3f0['id']!==_0x3c5a3a(0x22f))_0x4df3f0['remove']();}),messages[_0x23619e(0x223)]>0x0?(emptyState['style'][_0x23619e(0x20e)]=_0x23619e(0x1cf),messages['forEach']((_0x108a71,_0x507a9a)=>chatArea[_0x23619e(0x1be)](createMessageElement(_0x108a71,_0x507a9a)))):emptyState[_0x23619e(0x1e5)]['display']=_0x23619e(0x210),requestAnimationFrame(()=>chatArea[_0x23619e(0x1c3)]=chatArea[_0x23619e(0x1de)]);}function autoResizeTextarea(){const _0x265831=a0_0x5349a6;messageInput[_0x265831(0x1e5)][_0x265831(0x201)]=_0x265831(0x20d),messageInput[_0x265831(0x1e5)]['height']=Math[_0x265831(0x1dd)](messageInput[_0x265831(0x1de)],0x78)+'px';}function updateSendButton(){const _0x3feb0a=a0_0x5349a6,_0x409e01=messageInput[_0x3feb0a(0x1f4)][_0x3feb0a(0x21a)]();sendBtn[_0x3feb0a(0x200)]=!_0x409e01||isTyping;}async function sendMessage(){const _0x375fd5=a0_0x5349a6,_0xda3220=messageInput[_0x375fd5(0x1f4)][_0x375fd5(0x21a)]();if(!_0xda3220||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x375fd5(0x1d4)][_0x375fd5(0x1eb)](_0x375fd5(0x1e8));messages[_0x375fd5(0x231)]({'role':_0x375fd5(0x22d),'content':_0xda3220,'timestamp':Date[_0x375fd5(0x211)]()}),localStorage[_0x375fd5(0x1b7)](_0x375fd5(0x235),JSON[_0x375fd5(0x1d1)](messages)),renderMessages(),messageInput[_0x375fd5(0x1f4)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0xe90f21=await callBackend(_0x375fd5(0x1dc),{'message':_0xda3220});isTyping=![];const _0x1c247b=document[_0x375fd5(0x1b4)](_0x375fd5(0x1b9));if(_0x1c247b)_0x1c247b[_0x375fd5(0x233)]();let _0x4c76f4=_0x375fd5(0x216);if(_0xe90f21['success']){_0x4c76f4=_0xe90f21[_0x375fd5(0x1b5)]||_0x375fd5(0x1bb);if(tg?.[_0x375fd5(0x1d4)])tg[_0x375fd5(0x1d4)][_0x375fd5(0x202)](_0x375fd5(0x219));}else{_0x4c76f4=_0xe90f21[_0x375fd5(0x21c)]||_0x375fd5(0x1f3);if(tg?.[_0x375fd5(0x1d4)])tg[_0x375fd5(0x1d4)][_0x375fd5(0x202)]('error');}messages[_0x375fd5(0x231)]({'role':'ai','content':_0x4c76f4,'timestamp':Date[_0x375fd5(0x211)]()}),localStorage['setItem'](_0x375fd5(0x235),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x4a0ecf){const _0x352c61=a0_0x5349a6;if(mTitle)mTitle[_0x352c61(0x225)]=_0x352c61(0x1d0);if(mText)mText[_0x352c61(0x225)]=_0x352c61(0x215);modalCallback=()=>{const _0x3293a3=_0x352c61;messages['splice'](_0x4a0ecf,0x1),localStorage[_0x3293a3(0x1b7)](_0x3293a3(0x235),JSON[_0x3293a3(0x1d1)](messages)),renderMessages();},modal[_0x352c61(0x1e6)]['add'](_0x352c61(0x1f6));}if(clearBtn)clearBtn['onclick']=()=>{const _0x42074e=a0_0x5349a6;if(!messages[_0x42074e(0x223)])return;if(mTitle)mTitle[_0x42074e(0x225)]=_0x42074e(0x230);if(mText)mText[_0x42074e(0x225)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x52cb56=_0x42074e;messages=[],localStorage[_0x52cb56(0x1fe)]('ai_chat_messages'),renderMessages(),callBackend(_0x52cb56(0x203),{});},modal[_0x42074e(0x1e6)][_0x42074e(0x1fa)]('show');};document['getElementById'](a0_0x5349a6(0x1d9))[a0_0x5349a6(0x21f)]=()=>modal['classList'][a0_0x5349a6(0x233)]('show'),document['getElementById'](a0_0x5349a6(0x22a))[a0_0x5349a6(0x21f)]=()=>{const _0x5bc4ab=a0_0x5349a6;if(modalCallback)modalCallback();modal[_0x5bc4ab(0x1e6)][_0x5bc4ab(0x233)](_0x5bc4ab(0x1f6));},messageInput['addEventListener'](a0_0x5349a6(0x1ee),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x5349a6(0x1f8),_0x211db1=>{const _0x10a3ee=a0_0x5349a6;_0x211db1[_0x10a3ee(0x1d7)]==='Enter'&&!_0x211db1[_0x10a3ee(0x217)]&&(_0x211db1['preventDefault'](),sendMessage());}),sendBtn[a0_0x5349a6(0x21f)]=sendMessage,document[a0_0x5349a6(0x21e)](a0_0x5349a6(0x1df),_0xb5eed0=>{const _0x3c2c54=a0_0x5349a6;document[_0x3c2c54(0x1bf)]('.message.show-delete')[_0x3c2c54(0x1d2)](_0x2ee4d9=>{const _0x15d432=_0x3c2c54;if(!_0x2ee4d9[_0x15d432(0x1db)](_0xb5eed0[_0x15d432(0x232)]))_0x2ee4d9[_0x15d432(0x1e6)][_0x15d432(0x233)](_0x15d432(0x214));});});const saved=localStorage[a0_0x5349a6(0x1d3)](a0_0x5349a6(0x235));if(saved)try{messages=JSON[a0_0x5349a6(0x1b6)](saved),renderMessages();}catch(a0_0x41cd62){}updateSendButton();