const a0_0x4430a0=a0_0x5676;(function(_0x17b56b,_0xf4222d){const _0x390a13=a0_0x5676,_0x2e7559=_0x17b56b();while(!![]){try{const _0x2b0877=-parseInt(_0x390a13(0x198))/0x1*(parseInt(_0x390a13(0x177))/0x2)+parseInt(_0x390a13(0x17f))/0x3+-parseInt(_0x390a13(0x184))/0x4+-parseInt(_0x390a13(0x17e))/0x5+-parseInt(_0x390a13(0x1ec))/0x6+parseInt(_0x390a13(0x173))/0x7+parseInt(_0x390a13(0x18e))/0x8;if(_0x2b0877===_0xf4222d)break;else _0x2e7559['push'](_0x2e7559['shift']());}catch(_0x2e35f7){_0x2e7559['push'](_0x2e7559['shift']());}}}(a0_0x2172,0x360d2));const tg=window[a0_0x4430a0(0x16f)]?.['WebApp'],HOME_URL=a0_0x4430a0(0x1ac);function setupTelegramBackButton(){const _0x44b830=a0_0x4430a0,_0x511f66=(function(){let _0xb1f9e4=!![];return function(_0x39de8e,_0x24a036){const _0x50ce1f=_0xb1f9e4?function(){const _0x3fc92d=a0_0x5676;if(_0x24a036){const _0x25bacf=_0x24a036[_0x3fc92d(0x174)](_0x39de8e,arguments);return _0x24a036=null,_0x25bacf;}}:function(){};return _0xb1f9e4=![],_0x50ce1f;};}()),_0x2319e3=_0x511f66(this,function(){const _0xc2edfc=a0_0x5676;return _0x2319e3[_0xc2edfc(0x1b7)]()['search'](_0xc2edfc(0x1bd))[_0xc2edfc(0x1b7)]()[_0xc2edfc(0x1bf)](_0x2319e3)[_0xc2edfc(0x1a8)](_0xc2edfc(0x1bd));});_0x2319e3();if(!tg)return;try{tg[_0x44b830(0x1e9)](),tg[_0x44b830(0x19e)](),tg[_0x44b830(0x1d8)]?.('#050505');if(tg[_0x44b830(0x194)]?.(_0x44b830(0x1db)))tg['disableVerticalSwipes']?.();const _0x3d199e=tg[_0x44b830(0x18b)];if(_0x3d199e){_0x3d199e[_0x44b830(0x1c5)]();if(typeof _0x3d199e[_0x44b830(0x172)]===_0x44b830(0x186))try{_0x3d199e[_0x44b830(0x172)]();}catch(_0x4a88db){}_0x3d199e[_0x44b830(0x1c9)](()=>{const _0x43ee8a=_0x44b830;if(tg[_0x43ee8a(0x1bc)])tg[_0x43ee8a(0x1bc)][_0x43ee8a(0x1b4)](_0x43ee8a(0x1e3));location[_0x43ee8a(0x1a0)]=HOME_URL;});}}catch(_0x314c1f){console[_0x44b830(0x1af)]('TG\x20setup\x20error:',_0x314c1f);}}(function initStableLayout(){const _0x469339=a0_0x4430a0,_0x430f8a=document[_0x469339(0x1cd)](_0x469339(0x17c)),_0x3f7fb8=document[_0x469339(0x18c)](_0x469339(0x170)),_0x10908e=document['getElementById'](_0x469339(0x1e0)),_0x499f9a=document[_0x469339(0x18c)]('messageInput');function _0x3808a7(){const _0x26b6b=_0x469339;if(!_0x430f8a)return;const _0x378625=tg&&tg[_0x26b6b(0x1b9)]?tg[_0x26b6b(0x1b9)]:window[_0x26b6b(0x1cf)];_0x430f8a['style'][_0x26b6b(0x183)]=_0x378625+'px';if(_0x3f7fb8){const _0x304842=_0x3f7fb8[_0x26b6b(0x17b)];_0x10908e['style'][_0x26b6b(0x175)]=_0x304842+0x28+'px';}}tg?tg[_0x469339(0x1be)]('viewportChanged',({isStateStable:_0x3d5486})=>{_0x3808a7();if(_0x3d5486)requestAnimationFrame(()=>{_0x10908e['scrollTop']=_0x10908e['scrollHeight'];});}):window[_0x469339(0x1b6)](_0x469339(0x1e8),_0x3808a7),_0x3808a7(),_0x499f9a&&(_0x499f9a[_0x469339(0x1b6)]('input',()=>{requestAnimationFrame(_0x3808a7);}),_0x499f9a[_0x469339(0x1b6)]('focus',()=>{setTimeout(()=>{const _0x2e6ffa=a0_0x5676;_0x10908e[_0x2e6ffa(0x1d6)]=_0x10908e[_0x2e6ffa(0x1d7)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4430a0(0x18c)](a0_0x4430a0(0x1e0)),emptyState=document[a0_0x4430a0(0x18c)]('emptyState'),messageInput=document[a0_0x4430a0(0x18c)]('messageInput'),sendBtn=document[a0_0x4430a0(0x18c)](a0_0x4430a0(0x19c)),clearBtn=document[a0_0x4430a0(0x18c)](a0_0x4430a0(0x181)),modal=document['getElementById'](a0_0x4430a0(0x188)),mTitle=document[a0_0x4430a0(0x18c)](a0_0x4430a0(0x1cb)),mText=document[a0_0x4430a0(0x18c)](a0_0x4430a0(0x1ae));let modalCallback=null;async function callBackend(_0x44822e,_0x4076c2){const _0x4c09a4=a0_0x4430a0,_0x524b74=tg?.[_0x4c09a4(0x16e)]?.[_0x4c09a4(0x1b8)]||{},_0x5edc04=_0x524b74['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x4c09a4(0x171)](Math[_0x4c09a4(0x1df)]()*0x3b9aca00);if(!_0x524b74['id'])localStorage[_0x4c09a4(0x1e2)](_0x4c09a4(0x1dd),_0x5edc04);const _0x5a36cf={'action':_0x44822e,'user_id':_0x5edc04,'user_data':{'first_name':_0x524b74[_0x4c09a4(0x1ba)],'username':_0x524b74[_0x4c09a4(0x1c6)]},'init_data':tg?.['initData']||'',..._0x4076c2},_0x347ccb=new AbortController(),_0x4d1fae=setTimeout(()=>_0x347ccb[_0x4c09a4(0x16c)](),REQUEST_TIMEOUT_MS);try{const _0x17efd5=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x4c09a4(0x18a)},'body':JSON[_0x4c09a4(0x1eb)](_0x5a36cf),'signal':_0x347ccb[_0x4c09a4(0x185)]});return clearTimeout(_0x4d1fae),await _0x17efd5[_0x4c09a4(0x19b)]();}catch(_0x1655fd){return{'success':![],'error':String(_0x1655fd)};}}function formatTime(_0x30c25a){const _0x1984f0=a0_0x4430a0,_0x63d56b=new Date(_0x30c25a);return String(_0x63d56b[_0x1984f0(0x1c8)]())[_0x1984f0(0x1d0)](0x2,'0')+':'+String(_0x63d56b[_0x1984f0(0x1b0)]())[_0x1984f0(0x1d0)](0x2,'0');}function createMessageElement(_0x2e8291,_0xbebcb){const _0x1d243a=a0_0x4430a0,_0x1c87c1=document['createElement'](_0x1d243a(0x17d));_0x1c87c1[_0x1d243a(0x19d)]=_0x1d243a(0x1ed)+_0x2e8291[_0x1d243a(0x191)];const _0x26e94e=document[_0x1d243a(0x1e7)](_0x1d243a(0x17d));_0x26e94e['className']=_0x1d243a(0x1aa),_0x26e94e[_0x1d243a(0x1a9)]=_0x2e8291[_0x1d243a(0x182)][_0x1d243a(0x176)](/\n/g,'<br>');const _0x1b90b0=document[_0x1d243a(0x1e7)](_0x1d243a(0x17d));_0x1b90b0[_0x1d243a(0x19d)]=_0x1d243a(0x193),_0x1b90b0[_0x1d243a(0x1a9)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x1b90b0['onclick']=_0x4f98b5=>{_0x4f98b5['stopPropagation'](),confirmDelete(_0xbebcb);};let _0x4c03b1;_0x26e94e[_0x1d243a(0x1b6)](_0x1d243a(0x1ea),()=>_0x4c03b1=setTimeout(()=>{const _0x5d80ab=_0x1d243a;_0x1c87c1[_0x5d80ab(0x1d2)][_0x5d80ab(0x1e5)]('show-delete');if(tg?.[_0x5d80ab(0x1bc)])tg[_0x5d80ab(0x1bc)][_0x5d80ab(0x1b4)](_0x5d80ab(0x1c4));},0x1f4)),_0x26e94e[_0x1d243a(0x1b6)](_0x1d243a(0x199),()=>clearTimeout(_0x4c03b1));const _0x3bdc52=document['createElement']('div');return _0x3bdc52[_0x1d243a(0x19d)]=_0x1d243a(0x1a7),_0x3bdc52['textContent']=formatTime(_0x2e8291[_0x1d243a(0x1a6)]),_0x1c87c1[_0x1d243a(0x190)](_0x1b90b0),_0x1c87c1[_0x1d243a(0x190)](_0x26e94e),_0x1c87c1[_0x1d243a(0x190)](_0x3bdc52),_0x1c87c1;}function createTypingIndicator(){const _0x35ef0e=a0_0x4430a0,_0x876aea=document[_0x35ef0e(0x1e7)](_0x35ef0e(0x17d));return _0x876aea[_0x35ef0e(0x19d)]=_0x35ef0e(0x1de),_0x876aea['id']='typingIndicator',_0x876aea[_0x35ef0e(0x1a9)]=_0x35ef0e(0x179),_0x876aea;}function renderMessages(){const _0x55e20d=a0_0x4430a0;Array['from'](chatArea[_0x55e20d(0x1d3)])[_0x55e20d(0x1a2)](_0x2c8579=>{const _0x136372=_0x55e20d;if(_0x2c8579['id']!==_0x136372(0x1ee))_0x2c8579['remove']();}),messages[_0x55e20d(0x196)]>0x0?(emptyState[_0x55e20d(0x1a1)][_0x55e20d(0x18f)]=_0x55e20d(0x1b1),messages[_0x55e20d(0x1a2)]((_0x53842a,_0x98780c)=>chatArea[_0x55e20d(0x190)](createMessageElement(_0x53842a,_0x98780c)))):emptyState[_0x55e20d(0x1a1)]['display']=_0x55e20d(0x1e6),requestAnimationFrame(()=>chatArea[_0x55e20d(0x1d6)]=chatArea[_0x55e20d(0x1d7)]);}function autoResizeTextarea(){const _0x13e639=a0_0x4430a0;messageInput[_0x13e639(0x1a1)][_0x13e639(0x183)]=_0x13e639(0x192),messageInput[_0x13e639(0x1a1)][_0x13e639(0x183)]=Math[_0x13e639(0x18d)](messageInput[_0x13e639(0x1d7)],0x78)+'px';}function updateSendButton(){const _0x539d1b=a0_0x4430a0,_0x403a69=messageInput[_0x539d1b(0x1ef)][_0x539d1b(0x17a)]();sendBtn[_0x539d1b(0x178)]=!_0x403a69||isTyping;}async function sendMessage(){const _0x1d155b=a0_0x4430a0,_0xfed6ec=messageInput['value'][_0x1d155b(0x17a)]();if(!_0xfed6ec||isTyping)return;if(tg?.[_0x1d155b(0x1bc)])tg[_0x1d155b(0x1bc)]['impactOccurred'](_0x1d155b(0x1e3));messages[_0x1d155b(0x1a4)]({'role':_0x1d155b(0x1b8),'content':_0xfed6ec,'timestamp':Date[_0x1d155b(0x1d5)]()}),localStorage['setItem'](_0x1d155b(0x180),JSON[_0x1d155b(0x1eb)](messages)),renderMessages(),messageInput[_0x1d155b(0x1ef)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1d155b(0x190)](createTypingIndicator()),chatArea[_0x1d155b(0x1d6)]=chatArea[_0x1d155b(0x1d7)];const _0x18ad4c=await callBackend('send_message',{'message':_0xfed6ec});isTyping=![];const _0x58437d=document[_0x1d155b(0x18c)](_0x1d155b(0x1ce));if(_0x58437d)_0x58437d['remove']();let _0x14089f=_0x1d155b(0x1b2);if(_0x18ad4c['success']){_0x14089f=_0x18ad4c[_0x1d155b(0x16b)]||_0x1d155b(0x1b3);if(tg?.[_0x1d155b(0x1bc)])tg['HapticFeedback'][_0x1d155b(0x1cc)](_0x1d155b(0x16d));}else{_0x14089f=_0x18ad4c[_0x1d155b(0x19f)]||_0x1d155b(0x1da);if(tg?.[_0x1d155b(0x1bc)])tg[_0x1d155b(0x1bc)][_0x1d155b(0x1cc)]('error');}messages[_0x1d155b(0x1a4)]({'role':'ai','content':_0x14089f,'timestamp':Date[_0x1d155b(0x1d5)]()}),localStorage[_0x1d155b(0x1e2)](_0x1d155b(0x180),JSON[_0x1d155b(0x1eb)](messages)),renderMessages();}function confirmDelete(_0x39a0c0){const _0x396f6c=a0_0x4430a0;if(mTitle)mTitle[_0x396f6c(0x1c3)]=_0x396f6c(0x1c2);if(mText)mText[_0x396f6c(0x1c3)]=_0x396f6c(0x1d4);modalCallback=()=>{const _0x3b90e5=_0x396f6c;messages[_0x3b90e5(0x1ad)](_0x39a0c0,0x1),localStorage['setItem'](_0x3b90e5(0x180),JSON[_0x3b90e5(0x1eb)](messages)),renderMessages();},modal[_0x396f6c(0x1d2)][_0x396f6c(0x1e5)](_0x396f6c(0x1c5));}function a0_0x2172(){const _0x2bf73b=['first_name','target','HapticFeedback','(((.+)+)+)+$','onEvent','constructor','Начнется\x20новый\x20диалог.','remove','Удалить?','textContent','medium','show','username','onclick','getHours','onClick','querySelectorAll','modalTitle','notificationOccurred','querySelector','typingIndicator','innerHeight','padStart','parse','classList','children','Действие\x20необратимо.','now','scrollTop','scrollHeight','setHeaderColor','input','Ошибка\x20сервера','6.1','.message.show-delete','debug_uid','message\x20ai','random','chatArea','getItem','setItem','light','show-delete','add','flex','createElement','resize','ready','touchstart','stringify','1537416YXKPex','message\x20','emptyState','value','text','abort','success','initDataUnsafe','Telegram','inputArea','floor','offClick','1717828ziLfFd','apply','paddingBottom','replace','8vfeLmh','disabled','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','trim','offsetHeight','.container','div','380045xcZakp','746250QWmtRN','ai_chat_messages','clearBtn','content','height','973804izPBjC','signal','function','modalConfirm','confirmModal','shiftKey','text/plain','BackButton','getElementById','min','4580640vmIIqK','display','appendChild','role','auto','delete-btn','isVersionAtLeast','preventDefault','length','Enter','67411JArnLo','touchend','clear_history','json','sendBtn','className','expand','error','href','style','forEach','click','push','removeItem','timestamp','message-time','search','innerHTML','message-bubble','modalCancel','./router.html','splice','modalText','warn','getMinutes','none','Ошибка\x20сети','Пустой\x20ответ','impactOccurred','Очистить\x20историю?','addEventListener','toString','user','viewportHeight'];a0_0x2172=function(){return _0x2bf73b;};return a0_0x2172();}if(clearBtn)clearBtn[a0_0x4430a0(0x1c7)]=()=>{const _0x330818=a0_0x4430a0;if(!messages[_0x330818(0x196)])return;if(mTitle)mTitle['textContent']=_0x330818(0x1b5);if(mText)mText[_0x330818(0x1c3)]=_0x330818(0x1c0);modalCallback=async()=>{const _0x5976fc=_0x330818;messages=[],localStorage[_0x5976fc(0x1a5)](_0x5976fc(0x180)),renderMessages(),callBackend(_0x5976fc(0x19a),{});},modal[_0x330818(0x1d2)][_0x330818(0x1e5)](_0x330818(0x1c5));};document[a0_0x4430a0(0x18c)](a0_0x4430a0(0x1ab))['onclick']=()=>modal[a0_0x4430a0(0x1d2)][a0_0x4430a0(0x1c1)](a0_0x4430a0(0x1c5)),document['getElementById'](a0_0x4430a0(0x187))[a0_0x4430a0(0x1c7)]=()=>{const _0x351cda=a0_0x4430a0;if(modalCallback)modalCallback();modal[_0x351cda(0x1d2)][_0x351cda(0x1c1)](_0x351cda(0x1c5));},messageInput[a0_0x4430a0(0x1b6)](a0_0x4430a0(0x1d9),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4430a0(0x1b6)]('keydown',_0x2fa8fc=>{const _0x42df3f=a0_0x4430a0;_0x2fa8fc['key']===_0x42df3f(0x197)&&!_0x2fa8fc[_0x42df3f(0x189)]&&(_0x2fa8fc[_0x42df3f(0x195)](),sendMessage());}),sendBtn[a0_0x4430a0(0x1c7)]=sendMessage,document['addEventListener'](a0_0x4430a0(0x1a3),_0x5cb144=>{const _0x38f135=a0_0x4430a0;document[_0x38f135(0x1ca)](_0x38f135(0x1dc))['forEach'](_0x5c3566=>{const _0x19f27a=_0x38f135;if(!_0x5c3566['contains'](_0x5cb144[_0x19f27a(0x1bb)]))_0x5c3566[_0x19f27a(0x1d2)][_0x19f27a(0x1c1)](_0x19f27a(0x1e4));});});function a0_0x5676(_0x52031b,_0x225cc8){_0x52031b=_0x52031b-0x16b;const _0x5b6949=a0_0x2172();let _0x503354=_0x5b6949[_0x52031b];return _0x503354;}const saved=localStorage[a0_0x4430a0(0x1e1)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x4430a0(0x1d1)](saved),renderMessages();}catch(a0_0x3af5d1){}updateSendButton();