const a0_0x112cb7=a0_0x58fd;(function(_0x172fca,_0x166d93){const _0x2b0428=a0_0x58fd,_0x4af433=_0x172fca();while(!![]){try{const _0x140196=-parseInt(_0x2b0428(0x131))/0x1*(parseInt(_0x2b0428(0x157))/0x2)+parseInt(_0x2b0428(0x15a))/0x3+parseInt(_0x2b0428(0x160))/0x4*(parseInt(_0x2b0428(0x14b))/0x5)+parseInt(_0x2b0428(0x189))/0x6*(parseInt(_0x2b0428(0x150))/0x7)+parseInt(_0x2b0428(0x16c))/0x8+-parseInt(_0x2b0428(0x196))/0x9+-parseInt(_0x2b0428(0x166))/0xa*(-parseInt(_0x2b0428(0x18d))/0xb);if(_0x140196===_0x166d93)break;else _0x4af433['push'](_0x4af433['shift']());}catch(_0x530b09){_0x4af433['push'](_0x4af433['shift']());}}}(a0_0x384d,0xe6ff1));const tg=window[a0_0x112cb7(0x158)]?.['WebApp'],HOME_URL=a0_0x112cb7(0x17e);function setupTelegramBackButton(){const _0x4c5e81=a0_0x112cb7;if(!tg)return;try{tg[_0x4c5e81(0x181)](),tg[_0x4c5e81(0x120)](),tg[_0x4c5e81(0x142)]?.(_0x4c5e81(0x13b));if(tg[_0x4c5e81(0x15b)]?.(_0x4c5e81(0x17b)))tg['disableVerticalSwipes']?.();const _0x4dcf89=tg[_0x4c5e81(0x14e)];if(_0x4dcf89){_0x4dcf89[_0x4c5e81(0x173)]();if(typeof _0x4dcf89[_0x4c5e81(0x197)]==='function')try{_0x4dcf89[_0x4c5e81(0x197)]();}catch(_0x2fa0af){}_0x4dcf89[_0x4c5e81(0x135)](()=>{const _0x438d4e=_0x4c5e81;if(tg[_0x438d4e(0x194)])tg[_0x438d4e(0x194)][_0x438d4e(0x141)](_0x438d4e(0x121));location[_0x438d4e(0x18e)]=HOME_URL;});}}catch(_0x5af6a0){console[_0x4c5e81(0x171)](_0x4c5e81(0x125),_0x5af6a0);}}function a0_0x384d(){const _0x8b0cbe=['sendBtn','parse','(((.+)+)+)+$','className','message-bubble','2779632BWasXv','height','trim','touchend','random','warn','POST','show','message\x20','emptyState','success','Удалить?','notificationOccurred','disabled','onclick','6.1','modalConfirm','remove','./router.html','Начнется\x20новый\x20диалог.','typingIndicator','ready','toString','text','classList','preventDefault','forEach','<br>','auto','18KRZOFe','Enter','content','children','12461603JYAZzc','href','push','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','scrollTop','querySelector','clearBtn','HapticFeedback','viewportHeight','13575780sdrlcr','offClick','add','initData','getItem','removeItem','stringify','innerHTML','expand','light','input','messageInput','search','TG\x20setup\x20error:','addEventListener','debug_uid','appendChild','div','scrollHeight','json','querySelectorAll','constructor','style','username','Ошибка\x20сети','194981fLpCjx','clear_history','message\x20ai','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','onClick','stopPropagation','resize','min','createElement','medium','#050505','delete-btn','chatArea','target','text/plain','padStart','impactOccurred','setHeaderColor','signal','contains','send_message','timestamp','show-delete','getElementById','role','message-time','50225bUBTWT','setItem','splice','BackButton','initDataUnsafe','1774073ZJarJQ','flex','getMinutes','value','user','display','textContent','18BDZRhh','Telegram','length','2018883YDbBwP','isVersionAtLeast','error','viewportChanged','key','Очистить\x20историю?','516TFAnUC','none','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','modalCancel','ai_chat_messages','floor','10ioKvlh'];a0_0x384d=function(){return _0x8b0cbe;};return a0_0x384d();}(function initStableLayout(){const _0x442edd=a0_0x112cb7,_0x41f024=(function(){let _0x17f854=!![];return function(_0x199c6c,_0xd9b9f1){const _0x3d87bc=_0x17f854?function(){if(_0xd9b9f1){const _0x1dbfad=_0xd9b9f1['apply'](_0x199c6c,arguments);return _0xd9b9f1=null,_0x1dbfad;}}:function(){};return _0x17f854=![],_0x3d87bc;};}()),_0x27de2b=document[_0x442edd(0x192)]('.container'),_0xb72b1b=document[_0x442edd(0x148)]('inputArea'),_0x5ccf7b=document[_0x442edd(0x148)](_0x442edd(0x13d)),_0x3d651c=document[_0x442edd(0x148)](_0x442edd(0x123));function _0x9fe9c1(){const _0x4ea29e=_0x442edd,_0x4859e1=_0x41f024(this,function(){const _0x54c765=a0_0x58fd;return _0x4859e1[_0x54c765(0x182)]()['search'](_0x54c765(0x169))[_0x54c765(0x182)]()[_0x54c765(0x12d)](_0x4859e1)[_0x54c765(0x124)]('(((.+)+)+)+$');});_0x4859e1();if(!_0x27de2b)return;const _0x28a58e=tg&&tg[_0x4ea29e(0x195)]?tg[_0x4ea29e(0x195)]:window['innerHeight'];_0x27de2b['style'][_0x4ea29e(0x16d)]=_0x28a58e+'px';if(_0xb72b1b){const _0x4c5360=_0xb72b1b['offsetHeight'];_0x5ccf7b['style']['paddingBottom']=_0x4c5360+0x28+'px';}}tg?tg['onEvent'](_0x442edd(0x15d),({isStateStable:_0x458731})=>{_0x9fe9c1();if(_0x458731)requestAnimationFrame(()=>{const _0xe6136d=a0_0x58fd;_0x5ccf7b[_0xe6136d(0x191)]=_0x5ccf7b[_0xe6136d(0x12a)];});}):window[_0x442edd(0x126)](_0x442edd(0x137),_0x9fe9c1),_0x9fe9c1(),_0x3d651c&&(_0x3d651c[_0x442edd(0x126)](_0x442edd(0x122),()=>{requestAnimationFrame(_0x9fe9c1);}),_0x3d651c[_0x442edd(0x126)]('focus',()=>{setTimeout(()=>{const _0x4c1baa=a0_0x58fd;_0x5ccf7b[_0x4c1baa(0x191)]=_0x5ccf7b[_0x4c1baa(0x12a)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x112cb7(0x162),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x58fd(_0x46f7c4,_0x9671f7){_0x46f7c4=_0x46f7c4-0x11e;const _0x465839=a0_0x384d();let _0x4b6e66=_0x465839[_0x46f7c4];return _0x4b6e66;}const chatArea=document['getElementById'](a0_0x112cb7(0x13d)),emptyState=document[a0_0x112cb7(0x148)](a0_0x112cb7(0x175)),messageInput=document[a0_0x112cb7(0x148)]('messageInput'),sendBtn=document[a0_0x112cb7(0x148)](a0_0x112cb7(0x167)),clearBtn=document[a0_0x112cb7(0x148)](a0_0x112cb7(0x193)),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0x112cb7(0x148)]('modalTitle'),mText=document[a0_0x112cb7(0x148)]('modalText');let modalCallback=null;async function callBackend(_0x59abaa,_0x326c1e){const _0xab52f3=a0_0x112cb7,_0x256f2e=tg?.[_0xab52f3(0x14f)]?.[_0xab52f3(0x154)]||{},_0x3ad885=_0x256f2e['id']||localStorage[_0xab52f3(0x19a)](_0xab52f3(0x127))||'d-'+Math[_0xab52f3(0x165)](Math[_0xab52f3(0x170)]()*0x3b9aca00);if(!_0x256f2e['id'])localStorage[_0xab52f3(0x14c)](_0xab52f3(0x127),_0x3ad885);const _0x28cab0={'action':_0x59abaa,'user_id':_0x3ad885,'user_data':{'first_name':_0x256f2e['first_name'],'username':_0x256f2e[_0xab52f3(0x12f)]},'init_data':tg?.[_0xab52f3(0x199)]||'',..._0x326c1e},_0x21e3bd=new AbortController(),_0x45e45e=setTimeout(()=>_0x21e3bd['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3ba60c=await fetch(BACKEND_URL,{'method':_0xab52f3(0x172),'headers':{'Content-Type':_0xab52f3(0x13f)},'body':JSON[_0xab52f3(0x11e)](_0x28cab0),'signal':_0x21e3bd[_0xab52f3(0x143)]});return clearTimeout(_0x45e45e),await _0x3ba60c[_0xab52f3(0x12b)]();}catch(_0x305737){return{'success':![],'error':String(_0x305737)};}}function formatTime(_0x56afd0){const _0x3aa178=a0_0x112cb7,_0x409854=new Date(_0x56afd0);return String(_0x409854['getHours']())[_0x3aa178(0x140)](0x2,'0')+':'+String(_0x409854[_0x3aa178(0x152)]())[_0x3aa178(0x140)](0x2,'0');}function createMessageElement(_0x18c56e,_0x580afa){const _0x32c2a4=a0_0x112cb7,_0x31ecc4=document[_0x32c2a4(0x139)](_0x32c2a4(0x129));_0x31ecc4[_0x32c2a4(0x16a)]=_0x32c2a4(0x174)+_0x18c56e[_0x32c2a4(0x149)];const _0x4b0465=document[_0x32c2a4(0x139)](_0x32c2a4(0x129));_0x4b0465['className']=_0x32c2a4(0x16b),_0x4b0465['innerHTML']=_0x18c56e[_0x32c2a4(0x18b)]['replace'](/\n/g,_0x32c2a4(0x187));const _0x5c9558=document['createElement']('div');_0x5c9558[_0x32c2a4(0x16a)]=_0x32c2a4(0x13c),_0x5c9558[_0x32c2a4(0x11f)]=_0x32c2a4(0x190),_0x5c9558[_0x32c2a4(0x17a)]=_0x13ac71=>{const _0x35c404=_0x32c2a4;_0x13ac71[_0x35c404(0x136)](),confirmDelete(_0x580afa);};let _0x296ed2;_0x4b0465['addEventListener']('touchstart',()=>_0x296ed2=setTimeout(()=>{const _0x454493=_0x32c2a4;_0x31ecc4[_0x454493(0x184)][_0x454493(0x198)](_0x454493(0x147));if(tg?.[_0x454493(0x194)])tg[_0x454493(0x194)][_0x454493(0x141)](_0x454493(0x13a));},0x1f4)),_0x4b0465[_0x32c2a4(0x126)](_0x32c2a4(0x16f),()=>clearTimeout(_0x296ed2));const _0x40b0d8=document[_0x32c2a4(0x139)](_0x32c2a4(0x129));return _0x40b0d8['className']=_0x32c2a4(0x14a),_0x40b0d8[_0x32c2a4(0x156)]=formatTime(_0x18c56e[_0x32c2a4(0x146)]),_0x31ecc4['appendChild'](_0x5c9558),_0x31ecc4[_0x32c2a4(0x128)](_0x4b0465),_0x31ecc4[_0x32c2a4(0x128)](_0x40b0d8),_0x31ecc4;}function createTypingIndicator(){const _0x1cadbb=a0_0x112cb7,_0x2159b6=document[_0x1cadbb(0x139)](_0x1cadbb(0x129));return _0x2159b6['className']=_0x1cadbb(0x133),_0x2159b6['id']=_0x1cadbb(0x180),_0x2159b6['innerHTML']=_0x1cadbb(0x134),_0x2159b6;}function renderMessages(){const _0xf0d023=a0_0x112cb7;Array['from'](chatArea[_0xf0d023(0x18c)])['forEach'](_0x278395=>{const _0x34bb07=_0xf0d023;if(_0x278395['id']!==_0x34bb07(0x175))_0x278395[_0x34bb07(0x17d)]();}),messages[_0xf0d023(0x159)]>0x0?(emptyState[_0xf0d023(0x12e)][_0xf0d023(0x155)]=_0xf0d023(0x161),messages[_0xf0d023(0x186)]((_0x13412e,_0x3a81f3)=>chatArea[_0xf0d023(0x128)](createMessageElement(_0x13412e,_0x3a81f3)))):emptyState[_0xf0d023(0x12e)][_0xf0d023(0x155)]=_0xf0d023(0x151),requestAnimationFrame(()=>chatArea[_0xf0d023(0x191)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x469a7e=a0_0x112cb7;messageInput[_0x469a7e(0x12e)][_0x469a7e(0x16d)]=_0x469a7e(0x188),messageInput['style']['height']=Math[_0x469a7e(0x138)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x4feca3=a0_0x112cb7,_0x13a0a1=messageInput[_0x4feca3(0x153)][_0x4feca3(0x16e)]();sendBtn[_0x4feca3(0x179)]=!_0x13a0a1||isTyping;}async function sendMessage(){const _0x49b0af=a0_0x112cb7,_0x4082f2=messageInput[_0x49b0af(0x153)][_0x49b0af(0x16e)]();if(!_0x4082f2||isTyping)return;if(tg?.[_0x49b0af(0x194)])tg[_0x49b0af(0x194)][_0x49b0af(0x141)](_0x49b0af(0x121));messages[_0x49b0af(0x18f)]({'role':_0x49b0af(0x154),'content':_0x4082f2,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x49b0af(0x11e)](messages)),renderMessages(),messageInput[_0x49b0af(0x153)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x49b0af(0x191)]=chatArea[_0x49b0af(0x12a)];const _0x5d5858=await callBackend(_0x49b0af(0x145),{'message':_0x4082f2});isTyping=![];const _0x418f98=document[_0x49b0af(0x148)](_0x49b0af(0x180));if(_0x418f98)_0x418f98[_0x49b0af(0x17d)]();let _0xd50750=_0x49b0af(0x130);if(_0x5d5858[_0x49b0af(0x176)]){_0xd50750=_0x5d5858[_0x49b0af(0x183)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x49b0af(0x178)]('success');}else{_0xd50750=_0x5d5858[_0x49b0af(0x15c)]||'Ошибка\x20сервера';if(tg?.[_0x49b0af(0x194)])tg['HapticFeedback']['notificationOccurred'](_0x49b0af(0x15c));}messages[_0x49b0af(0x18f)]({'role':'ai','content':_0xd50750,'timestamp':Date['now']()}),localStorage['setItem'](_0x49b0af(0x164),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0xff9262){const _0x4646de=a0_0x112cb7;if(mTitle)mTitle['textContent']=_0x4646de(0x177);if(mText)mText[_0x4646de(0x156)]='Действие\x20необратимо.';modalCallback=()=>{const _0x43f340=_0x4646de;messages[_0x43f340(0x14d)](_0xff9262,0x1),localStorage[_0x43f340(0x14c)](_0x43f340(0x164),JSON[_0x43f340(0x11e)](messages)),renderMessages();},modal[_0x4646de(0x184)][_0x4646de(0x198)](_0x4646de(0x173));}if(clearBtn)clearBtn['onclick']=()=>{const _0x9fbfe8=a0_0x112cb7;if(!messages[_0x9fbfe8(0x159)])return;if(mTitle)mTitle[_0x9fbfe8(0x156)]=_0x9fbfe8(0x15f);if(mText)mText[_0x9fbfe8(0x156)]=_0x9fbfe8(0x17f);modalCallback=async()=>{const _0xa85b1c=_0x9fbfe8;messages=[],localStorage[_0xa85b1c(0x19b)]('ai_chat_messages'),renderMessages(),callBackend(_0xa85b1c(0x132),{});},modal[_0x9fbfe8(0x184)]['add'](_0x9fbfe8(0x173));};document[a0_0x112cb7(0x148)](a0_0x112cb7(0x163))['onclick']=()=>modal[a0_0x112cb7(0x184)][a0_0x112cb7(0x17d)]('show'),document['getElementById'](a0_0x112cb7(0x17c))[a0_0x112cb7(0x17a)]=()=>{const _0xf3b5ad=a0_0x112cb7;if(modalCallback)modalCallback();modal[_0xf3b5ad(0x184)]['remove'](_0xf3b5ad(0x173));},messageInput[a0_0x112cb7(0x126)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x112cb7(0x126)]('keydown',_0x216e05=>{const _0x5ee37b=a0_0x112cb7;_0x216e05[_0x5ee37b(0x15e)]===_0x5ee37b(0x18a)&&!_0x216e05['shiftKey']&&(_0x216e05[_0x5ee37b(0x185)](),sendMessage());}),sendBtn[a0_0x112cb7(0x17a)]=sendMessage,document[a0_0x112cb7(0x126)]('click',_0x386b2a=>{const _0x2490cc=a0_0x112cb7;document[_0x2490cc(0x12c)]('.message.show-delete')[_0x2490cc(0x186)](_0xe867b4=>{const _0x6516e9=_0x2490cc;if(!_0xe867b4[_0x6516e9(0x144)](_0x386b2a[_0x6516e9(0x13e)]))_0xe867b4[_0x6516e9(0x184)][_0x6516e9(0x17d)](_0x6516e9(0x147));});});const saved=localStorage[a0_0x112cb7(0x19a)](a0_0x112cb7(0x164));if(saved)try{messages=JSON[a0_0x112cb7(0x168)](saved),renderMessages();}catch(a0_0x18fbf8){}updateSendButton();