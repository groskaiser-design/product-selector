const a0_0x452f09=a0_0x28fa;(function(_0x37050f,_0x58b3b5){const _0x3f11ba=a0_0x28fa,_0x32db48=_0x37050f();while(!![]){try{const _0x2e231f=-parseInt(_0x3f11ba(0x1cc))/0x1+parseInt(_0x3f11ba(0x210))/0x2+parseInt(_0x3f11ba(0x1c7))/0x3*(parseInt(_0x3f11ba(0x1d3))/0x4)+-parseInt(_0x3f11ba(0x1fa))/0x5*(-parseInt(_0x3f11ba(0x20c))/0x6)+-parseInt(_0x3f11ba(0x22f))/0x7+-parseInt(_0x3f11ba(0x1dc))/0x8*(-parseInt(_0x3f11ba(0x1f8))/0x9)+-parseInt(_0x3f11ba(0x1d9))/0xa*(-parseInt(_0x3f11ba(0x233))/0xb);if(_0x2e231f===_0x58b3b5)break;else _0x32db48['push'](_0x32db48['shift']());}catch(_0x5a7ca9){_0x32db48['push'](_0x32db48['shift']());}}}(a0_0xd52e,0xbcbe7));const tg=window[a0_0x452f09(0x218)]?.[a0_0x452f09(0x1c4)],HOME_URL=a0_0x452f09(0x1fb);function setupTelegramBackButton(){const _0x46187f=a0_0x452f09,_0x36465b=(function(){let _0x10d73f=!![];return function(_0x3a2434,_0x56e8f3){const _0x5edbee=_0x10d73f?function(){const _0x4acba4=a0_0x28fa;if(_0x56e8f3){const _0x4c8f45=_0x56e8f3[_0x4acba4(0x1cb)](_0x3a2434,arguments);return _0x56e8f3=null,_0x4c8f45;}}:function(){};return _0x10d73f=![],_0x5edbee;};}()),_0x20fbfc=_0x36465b(this,function(){const _0x271e45=a0_0x28fa;return _0x20fbfc[_0x271e45(0x22a)]()[_0x271e45(0x1f2)]('(((.+)+)+)+$')['toString']()[_0x271e45(0x1e1)](_0x20fbfc)['search'](_0x271e45(0x21f));});_0x20fbfc();if(!tg)return;try{tg[_0x46187f(0x1c2)](),tg[_0x46187f(0x1ef)](),tg[_0x46187f(0x217)]?.(_0x46187f(0x1d6));if(tg[_0x46187f(0x1bd)]?.(_0x46187f(0x1de)))tg[_0x46187f(0x23b)]?.();const _0x10c1aa=tg[_0x46187f(0x1f3)];if(_0x10c1aa){_0x10c1aa['show']();if(typeof _0x10c1aa[_0x46187f(0x1fc)]===_0x46187f(0x235))try{_0x10c1aa['offClick']();}catch(_0x2fce1f){}_0x10c1aa['onClick'](()=>{const _0xdef420=_0x46187f;if(tg[_0xdef420(0x1bc)])tg[_0xdef420(0x1bc)][_0xdef420(0x209)](_0xdef420(0x1ea));location['href']=HOME_URL;});}}catch(_0x4ada34){console[_0x46187f(0x229)](_0x46187f(0x214),_0x4ada34);}}(function initStableLayout(){const _0x2e273d=a0_0x452f09,_0x46b15c=document[_0x2e273d(0x225)](_0x2e273d(0x215)),_0x4b32cd=document[_0x2e273d(0x211)](_0x2e273d(0x237)),_0x40b3ca=document[_0x2e273d(0x211)](_0x2e273d(0x1e7)),_0x3d25ad=document[_0x2e273d(0x211)](_0x2e273d(0x1f4));function _0xade646(){const _0x41b113=_0x2e273d;if(!_0x46b15c)return;const _0xc659f0=tg&&tg[_0x41b113(0x1e6)]?tg['viewportHeight']:window['innerHeight'];_0x46b15c[_0x41b113(0x238)][_0x41b113(0x1ca)]=_0xc659f0+'px';if(_0x4b32cd){const _0x3cc8cd=_0x4b32cd[_0x41b113(0x205)];_0x40b3ca[_0x41b113(0x238)]['paddingBottom']=_0x3cc8cd+0x28+'px';}}tg?tg[_0x2e273d(0x20d)](_0x2e273d(0x212),({isStateStable:_0xad6242})=>{_0xade646();if(_0xad6242)requestAnimationFrame(()=>{const _0x5c98c8=a0_0x28fa;_0x40b3ca[_0x5c98c8(0x22e)]=_0x40b3ca[_0x5c98c8(0x242)];});}):window[_0x2e273d(0x1e8)](_0x2e273d(0x1c3),_0xade646),_0xade646(),_0x3d25ad&&(_0x3d25ad[_0x2e273d(0x1e8)](_0x2e273d(0x1eb),()=>{requestAnimationFrame(_0xade646);}),_0x3d25ad['addEventListener']('focus',()=>{setTimeout(()=>{const _0x4e1e22=a0_0x28fa;_0x40b3ca[_0x4e1e22(0x22e)]=_0x40b3ca[_0x4e1e22(0x242)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x452f09(0x1ff),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x452f09(0x211)]('chatArea'),emptyState=document[a0_0x452f09(0x211)](a0_0x452f09(0x22c)),messageInput=document[a0_0x452f09(0x211)](a0_0x452f09(0x1f4)),sendBtn=document['getElementById'](a0_0x452f09(0x22d)),clearBtn=document[a0_0x452f09(0x211)](a0_0x452f09(0x1e2)),modal=document['getElementById'](a0_0x452f09(0x1c1)),mTitle=document[a0_0x452f09(0x211)](a0_0x452f09(0x1f9)),mText=document[a0_0x452f09(0x211)]('modalText');let modalCallback=null;function a0_0x28fa(_0x42b54f,_0x123f08){_0x42b54f=_0x42b54f-0x1bc;const _0x303676=a0_0xd52e();let _0x32a010=_0x303676[_0x42b54f];return _0x32a010;}async function callBackend(_0x2e5e28,_0x231feb){const _0x231c68=a0_0x452f09,_0x5ddd81=tg?.[_0x231c68(0x223)]?.['user']||{},_0x46ff78=_0x5ddd81['id']||localStorage['getItem'](_0x231c68(0x1d0))||'d-'+Math['floor'](Math[_0x231c68(0x1d7)]()*0x3b9aca00);if(!_0x5ddd81['id'])localStorage[_0x231c68(0x1d1)](_0x231c68(0x1d0),_0x46ff78);const _0x72e721={'action':_0x2e5e28,'user_id':_0x46ff78,'user_data':{'first_name':_0x5ddd81[_0x231c68(0x1f6)],'username':_0x5ddd81['username']},'init_data':tg?.[_0x231c68(0x1e0)]||'',..._0x231feb},_0x5482b4=new AbortController(),_0x299c70=setTimeout(()=>_0x5482b4[_0x231c68(0x1d8)](),REQUEST_TIMEOUT_MS);try{const _0x363333=await fetch(BACKEND_URL,{'method':_0x231c68(0x231),'headers':{'Content-Type':_0x231c68(0x208)},'body':JSON['stringify'](_0x72e721),'signal':_0x5482b4[_0x231c68(0x207)]});return clearTimeout(_0x299c70),await _0x363333[_0x231c68(0x21d)]();}catch(_0x25f038){return{'success':![],'error':String(_0x25f038)};}}function formatTime(_0x34e7f3){const _0x124691=a0_0x452f09,_0x4ebd93=new Date(_0x34e7f3);return String(_0x4ebd93[_0x124691(0x1ed)]())[_0x124691(0x1bf)](0x2,'0')+':'+String(_0x4ebd93[_0x124691(0x1d2)]())[_0x124691(0x1bf)](0x2,'0');}function createMessageElement(_0x3efef9,_0x4209eb){const _0x423640=a0_0x452f09,_0xe31da4=document[_0x423640(0x20b)](_0x423640(0x201));_0xe31da4['className']=_0x423640(0x1f5)+_0x3efef9[_0x423640(0x22b)];const _0x412111=document[_0x423640(0x20b)](_0x423640(0x201));_0x412111['className']=_0x423640(0x232),_0x412111[_0x423640(0x23d)]=_0x3efef9[_0x423640(0x202)][_0x423640(0x1e5)](/\n/g,_0x423640(0x23c));const _0x190b63=document[_0x423640(0x20b)](_0x423640(0x201));_0x190b63[_0x423640(0x1fd)]=_0x423640(0x200),_0x190b63[_0x423640(0x23d)]=_0x423640(0x1dd),_0x190b63[_0x423640(0x1df)]=_0x4c42c3=>{const _0x4c2e06=_0x423640;_0x4c42c3[_0x4c2e06(0x1f0)](),confirmDelete(_0x4209eb);};let _0x103cc4;_0x412111[_0x423640(0x1e8)](_0x423640(0x21c),()=>_0x103cc4=setTimeout(()=>{const _0x5c0dfa=_0x423640;_0xe31da4[_0x5c0dfa(0x1d5)][_0x5c0dfa(0x20f)](_0x5c0dfa(0x23f));if(tg?.[_0x5c0dfa(0x1bc)])tg[_0x5c0dfa(0x1bc)][_0x5c0dfa(0x209)]('medium');},0x1f4)),_0x412111['addEventListener']('touchend',()=>clearTimeout(_0x103cc4));const _0x2810a7=document['createElement'](_0x423640(0x201));return _0x2810a7[_0x423640(0x1fd)]=_0x423640(0x1be),_0x2810a7[_0x423640(0x1cf)]=formatTime(_0x3efef9['timestamp']),_0xe31da4['appendChild'](_0x190b63),_0xe31da4['appendChild'](_0x412111),_0xe31da4[_0x423640(0x213)](_0x2810a7),_0xe31da4;}function createTypingIndicator(){const _0x2fef89=a0_0x452f09,_0x31986a=document[_0x2fef89(0x20b)]('div');return _0x31986a[_0x2fef89(0x1fd)]=_0x2fef89(0x1c9),_0x31986a['id']='typingIndicator',_0x31986a[_0x2fef89(0x23d)]=_0x2fef89(0x1db),_0x31986a;}function renderMessages(){const _0x4fde35=a0_0x452f09;Array['from'](chatArea[_0x4fde35(0x234)])[_0x4fde35(0x1d4)](_0x3fe6d8=>{const _0x33521b=_0x4fde35;if(_0x3fe6d8['id']!==_0x33521b(0x22c))_0x3fe6d8['remove']();}),messages[_0x4fde35(0x228)]>0x0?(emptyState['style'][_0x4fde35(0x204)]=_0x4fde35(0x1ec),messages[_0x4fde35(0x1d4)]((_0x39e8f8,_0x277fe9)=>chatArea[_0x4fde35(0x213)](createMessageElement(_0x39e8f8,_0x277fe9)))):emptyState[_0x4fde35(0x238)][_0x4fde35(0x204)]=_0x4fde35(0x226),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x4fde35(0x242)]);}function autoResizeTextarea(){const _0x3bcd70=a0_0x452f09;messageInput[_0x3bcd70(0x238)][_0x3bcd70(0x1ca)]=_0x3bcd70(0x1ee),messageInput[_0x3bcd70(0x238)][_0x3bcd70(0x1ca)]=Math[_0x3bcd70(0x222)](messageInput[_0x3bcd70(0x242)],0x78)+'px';}function updateSendButton(){const _0x74e1c3=a0_0x452f09,_0x2e79ae=messageInput[_0x74e1c3(0x1da)][_0x74e1c3(0x1f1)]();sendBtn[_0x74e1c3(0x1c0)]=!_0x2e79ae||isTyping;}function a0_0xd52e(){const _0x36db35=['getHours','auto','expand','stopPropagation','trim','search','BackButton','messageInput','message\x20','first_name','Ошибка\x20сети','13167FBknOO','modalTitle','5tZvIwb','./router.html','offClick','className','getItem','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','delete-btn','div','content','parse','display','offsetHeight','Удалить?','signal','text/plain','impactOccurred','user','createElement','649746Nzcqoe','onEvent','text','add','277022HtlWva','getElementById','viewportChanged','appendChild','TG\x20setup\x20error:','.container','keydown','setHeaderColor','Telegram','Начнется\x20новый\x20диалог.','removeItem','click','touchstart','json','send_message','(((.+)+)+)+$','contains','querySelectorAll','min','initDataUnsafe','typingIndicator','querySelector','flex','success','length','warn','toString','role','emptyState','sendBtn','scrollTop','3911362eeVuaI','Enter','POST','message-bubble','2653684SkDIfR','children','function','splice','inputArea','style','Ошибка\x20сервера','stringify','disableVerticalSwipes','<br>','innerHTML','remove','show-delete','Очистить\x20историю?','now','scrollHeight','HapticFeedback','isVersionAtLeast','message-time','padStart','disabled','confirmModal','ready','resize','WebApp','.message.show-delete','push','168usmjOe','key','message\x20ai','height','apply','1171539eDIPPp','show','ai_chat_messages','textContent','debug_uid','setItem','getMinutes','15044FAijUL','forEach','classList','#050505','random','abort','50zMtFFp','value','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','4592FrXWDM','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','6.1','onclick','initData','constructor','clearBtn','modalCancel','preventDefault','replace','viewportHeight','chatArea','addEventListener','error','light','input','none'];a0_0xd52e=function(){return _0x36db35;};return a0_0xd52e();}async function sendMessage(){const _0xf878f8=a0_0x452f09,_0x55c937=messageInput[_0xf878f8(0x1da)]['trim']();if(!_0x55c937||isTyping)return;if(tg?.[_0xf878f8(0x1bc)])tg['HapticFeedback']['impactOccurred'](_0xf878f8(0x1ea));messages[_0xf878f8(0x1c6)]({'role':_0xf878f8(0x20a),'content':_0x55c937,'timestamp':Date[_0xf878f8(0x241)]()}),localStorage[_0xf878f8(0x1d1)](_0xf878f8(0x1ce),JSON[_0xf878f8(0x23a)](messages)),renderMessages(),messageInput[_0xf878f8(0x1da)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0xf878f8(0x22e)]=chatArea[_0xf878f8(0x242)];const _0x462444=await callBackend(_0xf878f8(0x21e),{'message':_0x55c937});isTyping=![];const _0x58c524=document[_0xf878f8(0x211)](_0xf878f8(0x224));if(_0x58c524)_0x58c524[_0xf878f8(0x23e)]();let _0x320c6b=_0xf878f8(0x1f7);if(_0x462444[_0xf878f8(0x227)]){_0x320c6b=_0x462444[_0xf878f8(0x20e)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred'](_0xf878f8(0x227));}else{_0x320c6b=_0x462444[_0xf878f8(0x1e9)]||_0xf878f8(0x239);if(tg?.[_0xf878f8(0x1bc)])tg[_0xf878f8(0x1bc)]['notificationOccurred'](_0xf878f8(0x1e9));}messages['push']({'role':'ai','content':_0x320c6b,'timestamp':Date[_0xf878f8(0x241)]()}),localStorage[_0xf878f8(0x1d1)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x2bf349){const _0x2cd461=a0_0x452f09;if(mTitle)mTitle[_0x2cd461(0x1cf)]=_0x2cd461(0x206);if(mText)mText[_0x2cd461(0x1cf)]='Действие\x20необратимо.';modalCallback=()=>{const _0x21a352=_0x2cd461;messages[_0x21a352(0x236)](_0x2bf349,0x1),localStorage[_0x21a352(0x1d1)](_0x21a352(0x1ce),JSON[_0x21a352(0x23a)](messages)),renderMessages();},modal['classList'][_0x2cd461(0x20f)](_0x2cd461(0x1cd));}if(clearBtn)clearBtn[a0_0x452f09(0x1df)]=()=>{const _0x5c6c79=a0_0x452f09;if(!messages[_0x5c6c79(0x228)])return;if(mTitle)mTitle['textContent']=_0x5c6c79(0x240);if(mText)mText[_0x5c6c79(0x1cf)]=_0x5c6c79(0x219);modalCallback=async()=>{const _0x3bb267=_0x5c6c79;messages=[],localStorage[_0x3bb267(0x21a)](_0x3bb267(0x1ce)),renderMessages(),callBackend('clear_history',{});},modal[_0x5c6c79(0x1d5)][_0x5c6c79(0x20f)](_0x5c6c79(0x1cd));};document[a0_0x452f09(0x211)](a0_0x452f09(0x1e3))[a0_0x452f09(0x1df)]=()=>modal[a0_0x452f09(0x1d5)][a0_0x452f09(0x23e)](a0_0x452f09(0x1cd)),document['getElementById']('modalConfirm')[a0_0x452f09(0x1df)]=()=>{const _0x2d464e=a0_0x452f09;if(modalCallback)modalCallback();modal[_0x2d464e(0x1d5)][_0x2d464e(0x23e)](_0x2d464e(0x1cd));},messageInput[a0_0x452f09(0x1e8)](a0_0x452f09(0x1eb),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x452f09(0x1e8)](a0_0x452f09(0x216),_0x88d181=>{const _0x24fdab=a0_0x452f09;_0x88d181[_0x24fdab(0x1c8)]===_0x24fdab(0x230)&&!_0x88d181['shiftKey']&&(_0x88d181[_0x24fdab(0x1e4)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x452f09(0x1e8)](a0_0x452f09(0x21b),_0xd72b7e=>{const _0x2c320e=a0_0x452f09;document[_0x2c320e(0x221)](_0x2c320e(0x1c5))[_0x2c320e(0x1d4)](_0x173509=>{const _0x3186aa=_0x2c320e;if(!_0x173509[_0x3186aa(0x220)](_0xd72b7e['target']))_0x173509[_0x3186aa(0x1d5)][_0x3186aa(0x23e)]('show-delete');});});const saved=localStorage[a0_0x452f09(0x1fe)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x452f09(0x203)](saved),renderMessages();}catch(a0_0xbbc22d){}updateSendButton();