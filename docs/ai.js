const a0_0x1317e4=a0_0x1f47;(function(_0x3ef74e,_0x281151){const _0xd37371=a0_0x1f47,_0x55ef28=_0x3ef74e();while(!![]){try{const _0x220453=-parseInt(_0xd37371(0x1b8))/0x1*(parseInt(_0xd37371(0x1a5))/0x2)+parseInt(_0xd37371(0x1c5))/0x3*(parseInt(_0xd37371(0x18c))/0x4)+parseInt(_0xd37371(0x1b6))/0x5*(-parseInt(_0xd37371(0x191))/0x6)+-parseInt(_0xd37371(0x1e7))/0x7+parseInt(_0xd37371(0x18d))/0x8*(parseInt(_0xd37371(0x1c4))/0x9)+-parseInt(_0xd37371(0x195))/0xa*(parseInt(_0xd37371(0x18f))/0xb)+parseInt(_0xd37371(0x1f4))/0xc;if(_0x220453===_0x281151)break;else _0x55ef28['push'](_0x55ef28['shift']());}catch(_0x4de443){_0x55ef28['push'](_0x55ef28['shift']());}}}(a0_0xc7fb,0xc6784));const tg=window[a0_0x1317e4(0x1e5)]?.[a0_0x1317e4(0x1a1)],HOME_URL=a0_0x1317e4(0x193);function setupTelegramBackButton(){const _0x5febdb=a0_0x1317e4;if(!tg)return;try{tg[_0x5febdb(0x1f1)](),tg[_0x5febdb(0x1c6)](),tg[_0x5febdb(0x1a2)]?.(_0x5febdb(0x1e2));if(tg[_0x5febdb(0x1c1)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x578539=tg['BackButton'];if(_0x578539){_0x578539[_0x5febdb(0x1c2)]();if(typeof _0x578539[_0x5febdb(0x1f8)]==='function')try{_0x578539[_0x5febdb(0x1f8)]();}catch(_0x320a16){}_0x578539[_0x5febdb(0x1dc)](()=>{const _0x3a2798=_0x5febdb;if(tg[_0x3a2798(0x1fc)])tg[_0x3a2798(0x1fc)][_0x3a2798(0x19b)](_0x3a2798(0x1e1));location['href']=HOME_URL;});}}catch(_0x34dbd5){console[_0x5febdb(0x1b2)](_0x5febdb(0x1fb),_0x34dbd5);}}(function initStableLayout(){const _0x431cfe=a0_0x1317e4,_0x332b70=(function(){let _0x2c336c=!![];return function(_0x3494e5,_0x40c8e4){const _0xd02cf1=_0x2c336c?function(){const _0x37638c=a0_0x1f47;if(_0x40c8e4){const _0x29e1c1=_0x40c8e4[_0x37638c(0x197)](_0x3494e5,arguments);return _0x40c8e4=null,_0x29e1c1;}}:function(){};return _0x2c336c=![],_0xd02cf1;};}()),_0x291d8e=document['querySelector'](_0x431cfe(0x1af)),_0x3fc9e8=document[_0x431cfe(0x189)](_0x431cfe(0x1f7)),_0x4bfad2=document[_0x431cfe(0x189)](_0x431cfe(0x1d7)),_0x1284f8=document['getElementById'](_0x431cfe(0x1ee));function _0x3967b8(){const _0x576290=_0x431cfe,_0x4ff084=_0x332b70(this,function(){const _0x4fb869=a0_0x1f47;return _0x4ff084[_0x4fb869(0x1f5)]()[_0x4fb869(0x1bc)]('(((.+)+)+)+$')[_0x4fb869(0x1f5)]()[_0x4fb869(0x1ec)](_0x4ff084)[_0x4fb869(0x1bc)](_0x4fb869(0x1cb));});_0x4ff084();if(!_0x291d8e)return;const _0x2ee76c=tg&&tg[_0x576290(0x194)]?tg[_0x576290(0x194)]:window['innerHeight'];_0x291d8e[_0x576290(0x190)][_0x576290(0x1a3)]=_0x2ee76c+'px';if(_0x3fc9e8){const _0x15326e=_0x3fc9e8[_0x576290(0x1c0)];_0x4bfad2['style']['paddingBottom']=_0x15326e+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x5e2279})=>{_0x3967b8();if(_0x5e2279)requestAnimationFrame(()=>{const _0x22f960=a0_0x1f47;_0x4bfad2['scrollTop']=_0x4bfad2[_0x22f960(0x1dd)];});}):window[_0x431cfe(0x19d)](_0x431cfe(0x1b3),_0x3967b8),_0x3967b8(),_0x1284f8&&(_0x1284f8[_0x431cfe(0x19d)](_0x431cfe(0x18a),()=>{requestAnimationFrame(_0x3967b8);}),_0x1284f8[_0x431cfe(0x19d)]('focus',()=>{setTimeout(()=>{const _0x5abf36=a0_0x1f47;_0x4bfad2[_0x5abf36(0x188)]=_0x4bfad2[_0x5abf36(0x1dd)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1317e4(0x189)]('chatArea'),emptyState=document[a0_0x1317e4(0x189)](a0_0x1317e4(0x1a8)),messageInput=document[a0_0x1317e4(0x189)](a0_0x1317e4(0x1ee)),sendBtn=document[a0_0x1317e4(0x189)](a0_0x1317e4(0x1b4)),clearBtn=document[a0_0x1317e4(0x189)](a0_0x1317e4(0x19e)),modal=document['getElementById'](a0_0x1317e4(0x1fd)),mTitle=document['getElementById']('modalTitle'),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x3db510,_0xd9f026){const _0x16f0f3=a0_0x1317e4,_0x46482f=tg?.[_0x16f0f3(0x192)]?.[_0x16f0f3(0x201)]||{},_0x40cf43=_0x46482f['id']||localStorage[_0x16f0f3(0x196)](_0x16f0f3(0x1aa))||'d-'+Math[_0x16f0f3(0x1eb)](Math[_0x16f0f3(0x1fe)]()*0x3b9aca00);if(!_0x46482f['id'])localStorage[_0x16f0f3(0x1c8)](_0x16f0f3(0x1aa),_0x40cf43);const _0x2d0f68={'action':_0x3db510,'user_id':_0x40cf43,'user_data':{'first_name':_0x46482f[_0x16f0f3(0x19f)],'username':_0x46482f[_0x16f0f3(0x18e)]},'init_data':tg?.[_0x16f0f3(0x1be)]||'',..._0xd9f026},_0x5c57f3=new AbortController(),_0x2b1769=setTimeout(()=>_0x5c57f3['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5d4f87=await fetch(BACKEND_URL,{'method':_0x16f0f3(0x1ff),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x16f0f3(0x1e9)](_0x2d0f68),'signal':_0x5c57f3[_0x16f0f3(0x203)]});return clearTimeout(_0x2b1769),await _0x5d4f87[_0x16f0f3(0x198)]();}catch(_0x46c17f){return{'success':![],'error':String(_0x46c17f)};}}function formatTime(_0x498a56){const _0x2cc325=a0_0x1317e4,_0x558b68=new Date(_0x498a56);return String(_0x558b68[_0x2cc325(0x1bd)]())[_0x2cc325(0x1df)](0x2,'0')+':'+String(_0x558b68[_0x2cc325(0x1cd)]())[_0x2cc325(0x1df)](0x2,'0');}function createMessageElement(_0x271329,_0x30cd50){const _0x4674b0=a0_0x1317e4,_0x212731=document[_0x4674b0(0x1d2)](_0x4674b0(0x1e6));_0x212731['className']=_0x4674b0(0x1f9)+_0x271329[_0x4674b0(0x1a7)];const _0x177508=document[_0x4674b0(0x1d2)](_0x4674b0(0x1e6));_0x177508[_0x4674b0(0x1ad)]=_0x4674b0(0x1db),_0x177508[_0x4674b0(0x199)]=_0x271329['content'][_0x4674b0(0x1da)](/\n/g,_0x4674b0(0x1cc));const _0x3d2900=document[_0x4674b0(0x1d2)](_0x4674b0(0x1e6));_0x3d2900['className']=_0x4674b0(0x1bb),_0x3d2900['innerHTML']=_0x4674b0(0x1a0),_0x3d2900[_0x4674b0(0x1a6)]=_0x483183=>{const _0x253868=_0x4674b0;_0x483183[_0x253868(0x202)](),confirmDelete(_0x30cd50);};let _0x4fb8cd;_0x177508[_0x4674b0(0x19d)]('touchstart',()=>_0x4fb8cd=setTimeout(()=>{const _0x2c4bb1=_0x4674b0;_0x212731[_0x2c4bb1(0x1d9)][_0x2c4bb1(0x1a9)]('show-delete');if(tg?.[_0x2c4bb1(0x1fc)])tg[_0x2c4bb1(0x1fc)][_0x2c4bb1(0x19b)](_0x2c4bb1(0x1d3));},0x1f4)),_0x177508[_0x4674b0(0x19d)](_0x4674b0(0x1d8),()=>clearTimeout(_0x4fb8cd));const _0x310683=document[_0x4674b0(0x1d2)](_0x4674b0(0x1e6));return _0x310683['className']='message-time',_0x310683[_0x4674b0(0x19a)]=formatTime(_0x271329[_0x4674b0(0x1ea)]),_0x212731[_0x4674b0(0x1f2)](_0x3d2900),_0x212731['appendChild'](_0x177508),_0x212731[_0x4674b0(0x1f2)](_0x310683),_0x212731;}function createTypingIndicator(){const _0x55dc8b=a0_0x1317e4,_0x40f17c=document[_0x55dc8b(0x1d2)]('div');return _0x40f17c[_0x55dc8b(0x1ad)]='message\x20ai',_0x40f17c['id']=_0x55dc8b(0x1e3),_0x40f17c[_0x55dc8b(0x199)]=_0x55dc8b(0x1bf),_0x40f17c;}function renderMessages(){const _0x3e59e0=a0_0x1317e4;Array[_0x3e59e0(0x204)](chatArea['children'])['forEach'](_0x466a89=>{const _0x2fbf06=_0x3e59e0;if(_0x466a89['id']!==_0x2fbf06(0x1a8))_0x466a89[_0x2fbf06(0x1ce)]();}),messages[_0x3e59e0(0x200)]>0x0?(emptyState['style'][_0x3e59e0(0x1d4)]=_0x3e59e0(0x1fa),messages[_0x3e59e0(0x1ab)]((_0x115e66,_0x32bf4f)=>chatArea['appendChild'](createMessageElement(_0x115e66,_0x32bf4f)))):emptyState[_0x3e59e0(0x190)][_0x3e59e0(0x1d4)]=_0x3e59e0(0x1d1),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x3e59e0(0x1dd)]);}function autoResizeTextarea(){const _0x2124a3=a0_0x1317e4;messageInput['style'][_0x2124a3(0x1a3)]=_0x2124a3(0x1b5),messageInput[_0x2124a3(0x190)][_0x2124a3(0x1a3)]=Math[_0x2124a3(0x1d6)](messageInput[_0x2124a3(0x1dd)],0x78)+'px';}function updateSendButton(){const _0x565448=a0_0x1317e4,_0x3979a7=messageInput['value'][_0x565448(0x1a4)]();sendBtn[_0x565448(0x1c9)]=!_0x3979a7||isTyping;}async function sendMessage(){const _0xa5fe07=a0_0x1317e4,_0x599781=messageInput['value'][_0xa5fe07(0x1a4)]();if(!_0x599781||isTyping)return;if(tg?.[_0xa5fe07(0x1fc)])tg['HapticFeedback']['impactOccurred']('light');messages['push']({'role':_0xa5fe07(0x201),'content':_0x599781,'timestamp':Date['now']()}),localStorage[_0xa5fe07(0x1c8)]('ai_chat_messages',JSON[_0xa5fe07(0x1e9)](messages)),renderMessages(),messageInput[_0xa5fe07(0x1ac)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0xa5fe07(0x188)]=chatArea[_0xa5fe07(0x1dd)];const _0x47ebc3=await callBackend(_0xa5fe07(0x1d0),{'message':_0x599781});isTyping=![];const _0x4b8249=document[_0xa5fe07(0x189)](_0xa5fe07(0x1e3));if(_0x4b8249)_0x4b8249[_0xa5fe07(0x1ce)]();let _0x17dc02=_0xa5fe07(0x1ca);if(_0x47ebc3[_0xa5fe07(0x1c7)]){_0x17dc02=_0x47ebc3[_0xa5fe07(0x1d5)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0xa5fe07(0x1e8)](_0xa5fe07(0x1c7));}else{_0x17dc02=_0x47ebc3['error']||_0xa5fe07(0x1f0);if(tg?.[_0xa5fe07(0x1fc)])tg[_0xa5fe07(0x1fc)][_0xa5fe07(0x1e8)](_0xa5fe07(0x1f6));}messages['push']({'role':'ai','content':_0x17dc02,'timestamp':Date[_0xa5fe07(0x1de)]()}),localStorage[_0xa5fe07(0x1c8)](_0xa5fe07(0x1b0),JSON[_0xa5fe07(0x1e9)](messages)),renderMessages();}function confirmDelete(_0x2e29a5){const _0x5b3458=a0_0x1317e4;if(mTitle)mTitle[_0x5b3458(0x19a)]=_0x5b3458(0x1e4);if(mText)mText[_0x5b3458(0x19a)]=_0x5b3458(0x1ba);modalCallback=()=>{const _0xf91b4=_0x5b3458;messages[_0xf91b4(0x1ed)](_0x2e29a5,0x1),localStorage[_0xf91b4(0x1c8)](_0xf91b4(0x1b0),JSON['stringify'](messages)),renderMessages();},modal[_0x5b3458(0x1d9)]['add'](_0x5b3458(0x1c2));}if(clearBtn)clearBtn['onclick']=()=>{const _0x28a243=a0_0x1317e4;if(!messages['length'])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x28a243(0x19a)]=_0x28a243(0x1b9);modalCallback=async()=>{const _0x373ae1=_0x28a243;messages=[],localStorage[_0x373ae1(0x1c3)](_0x373ae1(0x1b0)),renderMessages(),callBackend(_0x373ae1(0x1b1),{});},modal[_0x28a243(0x1d9)][_0x28a243(0x1a9)](_0x28a243(0x1c2));};document['getElementById']('modalCancel')[a0_0x1317e4(0x1a6)]=()=>modal[a0_0x1317e4(0x1d9)][a0_0x1317e4(0x1ce)]('show'),document['getElementById']('modalConfirm')['onclick']=()=>{const _0x13a645=a0_0x1317e4;if(modalCallback)modalCallback();modal[_0x13a645(0x1d9)][_0x13a645(0x1ce)](_0x13a645(0x1c2));},messageInput[a0_0x1317e4(0x19d)](a0_0x1317e4(0x18a),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1317e4(0x19d)](a0_0x1317e4(0x1ef),_0x45e46d=>{const _0x3a428f=a0_0x1317e4;_0x45e46d[_0x3a428f(0x18b)]==='Enter'&&!_0x45e46d[_0x3a428f(0x1cf)]&&(_0x45e46d[_0x3a428f(0x205)](),sendMessage());}),sendBtn[a0_0x1317e4(0x1a6)]=sendMessage,document['addEventListener'](a0_0x1317e4(0x1ae),_0x9f606=>{const _0x24177a=a0_0x1317e4;document['querySelectorAll'](_0x24177a(0x1f3))['forEach'](_0x171df5=>{const _0x5ce1b3=_0x24177a;if(!_0x171df5[_0x5ce1b3(0x1e0)](_0x9f606[_0x5ce1b3(0x1b7)]))_0x171df5[_0x5ce1b3(0x1d9)]['remove'](_0x5ce1b3(0x19c));});});function a0_0xc7fb(){const _0x215c85=['show','removeItem','2709YqXfNZ','2517tzRMis','expand','success','setItem','disabled','Ошибка\x20сети','(((.+)+)+)+$','<br>','getMinutes','remove','shiftKey','send_message','flex','createElement','medium','display','text','min','chatArea','touchend','classList','replace','message-bubble','onClick','scrollHeight','now','padStart','contains','light','#050505','typingIndicator','Удалить?','Telegram','div','3578309FFWLSq','notificationOccurred','stringify','timestamp','floor','constructor','splice','messageInput','keydown','Ошибка\x20сервера','ready','appendChild','.message.show-delete','23753412eydNNw','toString','error','inputArea','offClick','message\x20','none','TG\x20setup\x20error:','HapticFeedback','confirmModal','random','POST','length','user','stopPropagation','signal','from','preventDefault','scrollTop','getElementById','input','key','2336UVWMAJ','24280HSmJCm','username','11LHGwOm','style','78180HEWgog','initDataUnsafe','./router.html','viewportHeight','8385830LNzwyY','getItem','apply','json','innerHTML','textContent','impactOccurred','show-delete','addEventListener','clearBtn','first_name','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','WebApp','setHeaderColor','height','trim','4cHQIyD','onclick','role','emptyState','add','debug_uid','forEach','value','className','click','.container','ai_chat_messages','clear_history','warn','resize','sendBtn','auto','345thepdt','target','160595xnPOfg','Начнется\x20новый\x20диалог.','Действие\x20необратимо.','delete-btn','search','getHours','initData','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','offsetHeight','isVersionAtLeast'];a0_0xc7fb=function(){return _0x215c85;};return a0_0xc7fb();}const saved=localStorage['getItem']('ai_chat_messages');function a0_0x1f47(_0x495255,_0x2ad336){_0x495255=_0x495255-0x188;const _0x1bb213=a0_0xc7fb();let _0x4ca2ec=_0x1bb213[_0x495255];return _0x4ca2ec;}if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x3149e7){}updateSendButton();