const a0_0x3bccf7=a0_0x1438;(function(_0x12b549,_0x4545f1){const _0x275e2b=a0_0x1438,_0x4b3a8c=_0x12b549();while(!![]){try{const _0x4d28bd=-parseInt(_0x275e2b(0x18b))/0x1*(parseInt(_0x275e2b(0x1d4))/0x2)+parseInt(_0x275e2b(0x1d8))/0x3+parseInt(_0x275e2b(0x1c2))/0x4+parseInt(_0x275e2b(0x1d2))/0x5+-parseInt(_0x275e2b(0x1ec))/0x6+-parseInt(_0x275e2b(0x184))/0x7*(parseInt(_0x275e2b(0x1af))/0x8)+-parseInt(_0x275e2b(0x1a7))/0x9;if(_0x4d28bd===_0x4545f1)break;else _0x4b3a8c['push'](_0x4b3a8c['shift']());}catch(_0x53ee0e){_0x4b3a8c['push'](_0x4b3a8c['shift']());}}}(a0_0x59e2,0x3e39c));const tg=window[a0_0x3bccf7(0x1e6)]?.[a0_0x3bccf7(0x1d3)],HOME_URL=a0_0x3bccf7(0x1ce);function setupTelegramBackButton(){const _0x45beec=a0_0x3bccf7;if(!tg)return;try{tg[_0x45beec(0x1e3)](),tg['expand'](),tg[_0x45beec(0x1e2)]?.(_0x45beec(0x1dd));if(tg['isVersionAtLeast']?.(_0x45beec(0x1bd)))tg['disableVerticalSwipes']?.();const _0x524628=tg[_0x45beec(0x17e)];if(_0x524628){_0x524628['show']();if(typeof _0x524628['offClick']===_0x45beec(0x1e1))try{_0x524628['offClick']();}catch(_0x2f8479){}_0x524628[_0x45beec(0x1e7)](()=>{const _0x4980c1=_0x45beec;if(tg['HapticFeedback'])tg[_0x4980c1(0x196)][_0x4980c1(0x1a6)](_0x4980c1(0x1bf));location['href']=HOME_URL;});}}catch(_0x4080f6){console[_0x45beec(0x193)]('TG\x20setup\x20error:',_0x4080f6);}}(function initStableLayout(){const _0x193c6e=a0_0x3bccf7,_0x507c77=(function(){let _0x47a08f=!![];return function(_0x286d68,_0xa43609){const _0x521da7=_0x47a08f?function(){const _0x3ec1f1=a0_0x1438;if(_0xa43609){const _0x160d05=_0xa43609[_0x3ec1f1(0x1ef)](_0x286d68,arguments);return _0xa43609=null,_0x160d05;}}:function(){};return _0x47a08f=![],_0x521da7;};}()),_0x16a6de=document['querySelector']('.container'),_0x1cf8b0=document[_0x193c6e(0x1a5)]('inputArea'),_0x4d0a9b=document[_0x193c6e(0x1a5)]('chatArea'),_0x3ef73c=document[_0x193c6e(0x1a5)](_0x193c6e(0x1c0));function _0x2c4fd5(){const _0x3932ae=_0x193c6e,_0x53823e=_0x507c77(this,function(){const _0x3f3b9c=a0_0x1438;return _0x53823e['toString']()[_0x3f3b9c(0x18d)]('(((.+)+)+)+$')[_0x3f3b9c(0x1ea)]()['constructor'](_0x53823e)['search'](_0x3f3b9c(0x1bc));});_0x53823e();if(!_0x16a6de)return;const _0x407575=tg&&tg[_0x3932ae(0x195)]?tg['viewportHeight']:window[_0x3932ae(0x17a)];_0x16a6de[_0x3932ae(0x1c9)]['height']=_0x407575+'px';if(_0x1cf8b0){const _0x4d150c=_0x1cf8b0[_0x3932ae(0x188)];_0x4d0a9b[_0x3932ae(0x1c9)]['paddingBottom']=_0x4d150c+0x28+'px';}}tg?tg[_0x193c6e(0x1ae)](_0x193c6e(0x1ac),({isStateStable:_0x55e10f})=>{_0x2c4fd5();if(_0x55e10f)requestAnimationFrame(()=>{const _0x4d6049=a0_0x1438;_0x4d0a9b['scrollTop']=_0x4d0a9b[_0x4d6049(0x1dc)];});}):window[_0x193c6e(0x18a)](_0x193c6e(0x1ab),_0x2c4fd5),_0x2c4fd5(),_0x3ef73c&&(_0x3ef73c[_0x193c6e(0x18a)](_0x193c6e(0x1b0),()=>{requestAnimationFrame(_0x2c4fd5);}),_0x3ef73c[_0x193c6e(0x18a)](_0x193c6e(0x17f),()=>{setTimeout(()=>{const _0x6d25e3=a0_0x1438;_0x4d0a9b[_0x6d25e3(0x173)]=_0x4d0a9b[_0x6d25e3(0x1dc)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x1438(_0x126014,_0x5e8c63){_0x126014=_0x126014-0x173;const _0x169481=a0_0x59e2();let _0x3d9b28=_0x169481[_0x126014];return _0x3d9b28;}const BACKEND_URL=a0_0x3bccf7(0x1c1),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3bccf7(0x1a5)](a0_0x3bccf7(0x1b5)),emptyState=document[a0_0x3bccf7(0x1a5)](a0_0x3bccf7(0x1f1)),messageInput=document[a0_0x3bccf7(0x1a5)]('messageInput'),sendBtn=document['getElementById'](a0_0x3bccf7(0x1d7)),clearBtn=document[a0_0x3bccf7(0x1a5)](a0_0x3bccf7(0x1d1)),modal=document[a0_0x3bccf7(0x1a5)](a0_0x3bccf7(0x1c5)),mTitle=document['getElementById'](a0_0x3bccf7(0x1c3)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x589ce8,_0x345e74){const _0xf8728f=a0_0x3bccf7,_0x39d926=tg?.[_0xf8728f(0x1ed)]?.['user']||{},_0x219081=_0x39d926['id']||localStorage[_0xf8728f(0x1cc)]('debug_uid')||'d-'+Math[_0xf8728f(0x1bb)](Math[_0xf8728f(0x1be)]()*0x3b9aca00);if(!_0x39d926['id'])localStorage[_0xf8728f(0x1d6)](_0xf8728f(0x17d),_0x219081);const _0x26fa66={'action':_0x589ce8,'user_id':_0x219081,'user_data':{'first_name':_0x39d926[_0xf8728f(0x1ee)],'username':_0x39d926['username']},'init_data':tg?.[_0xf8728f(0x1e0)]||'',..._0x345e74},_0x1058a2=new AbortController(),_0x33e5d1=setTimeout(()=>_0x1058a2[_0xf8728f(0x1aa)](),REQUEST_TIMEOUT_MS);try{const _0x49a55a=await fetch(BACKEND_URL,{'method':_0xf8728f(0x1a3),'headers':{'Content-Type':_0xf8728f(0x1c7)},'body':JSON[_0xf8728f(0x1e4)](_0x26fa66),'signal':_0x1058a2['signal']});return clearTimeout(_0x33e5d1),await _0x49a55a[_0xf8728f(0x1a9)]();}catch(_0x19de99){return{'success':![],'error':String(_0x19de99)};}}function formatTime(_0x7b5b40){const _0x93efdc=a0_0x3bccf7,_0x2772e8=new Date(_0x7b5b40);return String(_0x2772e8['getHours']())[_0x93efdc(0x19c)](0x2,'0')+':'+String(_0x2772e8[_0x93efdc(0x190)]())[_0x93efdc(0x19c)](0x2,'0');}function createMessageElement(_0x3bbe19,_0x4bb475){const _0x165e5f=a0_0x3bccf7,_0x482e30=document[_0x165e5f(0x1a2)](_0x165e5f(0x1b4));_0x482e30[_0x165e5f(0x1b9)]=_0x165e5f(0x199)+_0x3bbe19[_0x165e5f(0x1df)];const _0x5062ca=document[_0x165e5f(0x1a2)]('div');_0x5062ca[_0x165e5f(0x1b9)]=_0x165e5f(0x1c8),_0x5062ca['innerHTML']=_0x3bbe19[_0x165e5f(0x1ba)][_0x165e5f(0x191)](/\n/g,_0x165e5f(0x1b2));const _0x47754a=document[_0x165e5f(0x1a2)](_0x165e5f(0x1b4));_0x47754a['className']=_0x165e5f(0x175),_0x47754a[_0x165e5f(0x1eb)]=_0x165e5f(0x1ca),_0x47754a[_0x165e5f(0x197)]=_0x321473=>{_0x321473['stopPropagation'](),confirmDelete(_0x4bb475);};let _0x565b03;_0x5062ca[_0x165e5f(0x18a)](_0x165e5f(0x19a),()=>_0x565b03=setTimeout(()=>{const _0x525d25=_0x165e5f;_0x482e30['classList']['add']('show-delete');if(tg?.[_0x525d25(0x196)])tg[_0x525d25(0x196)]['impactOccurred'](_0x525d25(0x1cb));},0x1f4)),_0x5062ca[_0x165e5f(0x18a)]('touchend',()=>clearTimeout(_0x565b03));const _0x5cd250=document[_0x165e5f(0x1a2)]('div');return _0x5cd250[_0x165e5f(0x1b9)]='message-time',_0x5cd250['textContent']=formatTime(_0x3bbe19[_0x165e5f(0x18f)]),_0x482e30[_0x165e5f(0x1c4)](_0x47754a),_0x482e30[_0x165e5f(0x1c4)](_0x5062ca),_0x482e30[_0x165e5f(0x1c4)](_0x5cd250),_0x482e30;}function createTypingIndicator(){const _0x149b57=a0_0x3bccf7,_0x2a5bed=document['createElement'](_0x149b57(0x1b4));return _0x2a5bed[_0x149b57(0x1b9)]=_0x149b57(0x1cf),_0x2a5bed['id']=_0x149b57(0x1a1),_0x2a5bed[_0x149b57(0x1eb)]=_0x149b57(0x1d0),_0x2a5bed;}function renderMessages(){const _0x2abe8a=a0_0x3bccf7;Array[_0x2abe8a(0x1e5)](chatArea[_0x2abe8a(0x178)])[_0x2abe8a(0x198)](_0x8c6947=>{const _0x522eba=_0x2abe8a;if(_0x8c6947['id']!==_0x522eba(0x1f1))_0x8c6947[_0x522eba(0x1b6)]();}),messages['length']>0x0?(emptyState[_0x2abe8a(0x1c9)][_0x2abe8a(0x1da)]=_0x2abe8a(0x1de),messages['forEach']((_0x4c8be4,_0x544240)=>chatArea['appendChild'](createMessageElement(_0x4c8be4,_0x544240)))):emptyState['style']['display']='flex',requestAnimationFrame(()=>chatArea[_0x2abe8a(0x173)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x330bb6=a0_0x3bccf7;messageInput['style'][_0x330bb6(0x19e)]=_0x330bb6(0x183),messageInput[_0x330bb6(0x1c9)][_0x330bb6(0x19e)]=Math[_0x330bb6(0x1e9)](messageInput[_0x330bb6(0x1dc)],0x78)+'px';}function a0_0x59e2(){const _0x151342=['forEach','message\x20','touchstart','Начнется\x20новый\x20диалог.','padStart','splice','height','textContent','.message.show-delete','typingIndicator','createElement','POST','Очистить\x20историю?','getElementById','impactOccurred','2091285wQIceL','Удалить?','json','abort','resize','viewportChanged','length','onEvent','159400VyhDun','input','now','<br>','push','div','chatArea','remove','keydown','Enter','className','content','floor','(((.+)+)+)+$','6.1','random','light','messageInput','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','1718876UunxsW','modalTitle','appendChild','confirmModal','user','text/plain','message-bubble','style','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','medium','getItem','Ошибка\x20сети','./router.html','message\x20ai','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','clearBtn','623705QTpOOv','WebApp','4OgkuDA','Ошибка\x20сервера','setItem','sendBtn','1377672fgpkfw','add','display','disabled','scrollHeight','#050505','none','role','initData','function','setHeaderColor','ready','stringify','from','Telegram','onClick','value','min','toString','innerHTML','1273788uLHjiL','initDataUnsafe','first_name','apply','clear_history','emptyState','scrollTop','show-delete','delete-btn','parse','show','children','Пустой\x20ответ','innerHeight','notificationOccurred','modalConfirm','debug_uid','BackButton','focus','contains','text','send_message','auto','49fLZeFl','preventDefault','trim','error','offsetHeight','classList','addEventListener','87335FpapZL','Действие\x20необратимо.','search','modalCancel','timestamp','getMinutes','replace','removeItem','warn','ai_chat_messages','viewportHeight','HapticFeedback','onclick'];a0_0x59e2=function(){return _0x151342;};return a0_0x59e2();}function updateSendButton(){const _0x294589=a0_0x3bccf7,_0x169585=messageInput[_0x294589(0x1e8)][_0x294589(0x186)]();sendBtn[_0x294589(0x1db)]=!_0x169585||isTyping;}async function sendMessage(){const _0x37278b=a0_0x3bccf7,_0x58be4b=messageInput[_0x37278b(0x1e8)]['trim']();if(!_0x58be4b||isTyping)return;if(tg?.[_0x37278b(0x196)])tg['HapticFeedback']['impactOccurred'](_0x37278b(0x1bf));messages[_0x37278b(0x1b3)]({'role':_0x37278b(0x1c6),'content':_0x58be4b,'timestamp':Date[_0x37278b(0x1b1)]()}),localStorage['setItem'](_0x37278b(0x194),JSON[_0x37278b(0x1e4)](messages)),renderMessages(),messageInput[_0x37278b(0x1e8)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x37278b(0x1c4)](createTypingIndicator()),chatArea[_0x37278b(0x173)]=chatArea[_0x37278b(0x1dc)];const _0x2a95e5=await callBackend(_0x37278b(0x182),{'message':_0x58be4b});isTyping=![];const _0x3fab27=document[_0x37278b(0x1a5)](_0x37278b(0x1a1));if(_0x3fab27)_0x3fab27['remove']();let _0x433e3a=_0x37278b(0x1cd);if(_0x2a95e5['success']){_0x433e3a=_0x2a95e5[_0x37278b(0x181)]||_0x37278b(0x179);if(tg?.['HapticFeedback'])tg[_0x37278b(0x196)][_0x37278b(0x17b)]('success');}else{_0x433e3a=_0x2a95e5['error']||_0x37278b(0x1d5);if(tg?.['HapticFeedback'])tg[_0x37278b(0x196)]['notificationOccurred'](_0x37278b(0x187));}messages['push']({'role':'ai','content':_0x433e3a,'timestamp':Date[_0x37278b(0x1b1)]()}),localStorage['setItem'](_0x37278b(0x194),JSON[_0x37278b(0x1e4)](messages)),renderMessages();}function confirmDelete(_0x369425){const _0x43cc5a=a0_0x3bccf7;if(mTitle)mTitle['textContent']=_0x43cc5a(0x1a8);if(mText)mText['textContent']=_0x43cc5a(0x18c);modalCallback=()=>{const _0x59e6bb=_0x43cc5a;messages[_0x59e6bb(0x19d)](_0x369425,0x1),localStorage[_0x59e6bb(0x1d6)]('ai_chat_messages',JSON[_0x59e6bb(0x1e4)](messages)),renderMessages();},modal[_0x43cc5a(0x189)][_0x43cc5a(0x1d9)]('show');}if(clearBtn)clearBtn[a0_0x3bccf7(0x197)]=()=>{const _0x1d5eb6=a0_0x3bccf7;if(!messages[_0x1d5eb6(0x1ad)])return;if(mTitle)mTitle[_0x1d5eb6(0x19f)]=_0x1d5eb6(0x1a4);if(mText)mText['textContent']=_0x1d5eb6(0x19b);modalCallback=async()=>{const _0x30670e=_0x1d5eb6;messages=[],localStorage[_0x30670e(0x192)]('ai_chat_messages'),renderMessages(),callBackend(_0x30670e(0x1f0),{});},modal[_0x1d5eb6(0x189)][_0x1d5eb6(0x1d9)]('show');};document[a0_0x3bccf7(0x1a5)](a0_0x3bccf7(0x18e))[a0_0x3bccf7(0x197)]=()=>modal[a0_0x3bccf7(0x189)][a0_0x3bccf7(0x1b6)](a0_0x3bccf7(0x177)),document[a0_0x3bccf7(0x1a5)](a0_0x3bccf7(0x17c))[a0_0x3bccf7(0x197)]=()=>{const _0xe5b080=a0_0x3bccf7;if(modalCallback)modalCallback();modal[_0xe5b080(0x189)][_0xe5b080(0x1b6)](_0xe5b080(0x177));},messageInput[a0_0x3bccf7(0x18a)](a0_0x3bccf7(0x1b0),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3bccf7(0x18a)](a0_0x3bccf7(0x1b7),_0x12bce2=>{const _0x1842ec=a0_0x3bccf7;_0x12bce2['key']===_0x1842ec(0x1b8)&&!_0x12bce2['shiftKey']&&(_0x12bce2[_0x1842ec(0x185)](),sendMessage());}),sendBtn[a0_0x3bccf7(0x197)]=sendMessage,document['addEventListener']('click',_0x96c9f9=>{const _0xe7bb6b=a0_0x3bccf7;document['querySelectorAll'](_0xe7bb6b(0x1a0))[_0xe7bb6b(0x198)](_0xe079c4=>{const _0x47eb0b=_0xe7bb6b;if(!_0xe079c4[_0x47eb0b(0x180)](_0x96c9f9['target']))_0xe079c4[_0x47eb0b(0x189)]['remove'](_0x47eb0b(0x174));});});const saved=localStorage[a0_0x3bccf7(0x1cc)](a0_0x3bccf7(0x194));if(saved)try{messages=JSON[a0_0x3bccf7(0x176)](saved),renderMessages();}catch(a0_0x28f8d2){}updateSendButton();