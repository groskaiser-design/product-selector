const a0_0x476032=a0_0x2e0b;(function(_0x35eff2,_0x125a4c){const _0x113656=a0_0x2e0b,_0x477fb7=_0x35eff2();while(!![]){try{const _0x58dd38=parseInt(_0x113656(0x94))/0x1+-parseInt(_0x113656(0xd1))/0x2+parseInt(_0x113656(0x97))/0x3+-parseInt(_0x113656(0x92))/0x4+parseInt(_0x113656(0xd6))/0x5*(parseInt(_0x113656(0xa3))/0x6)+parseInt(_0x113656(0xd5))/0x7+parseInt(_0x113656(0xb1))/0x8*(-parseInt(_0x113656(0xf0))/0x9);if(_0x58dd38===_0x125a4c)break;else _0x477fb7['push'](_0x477fb7['shift']());}catch(_0x55b253){_0x477fb7['push'](_0x477fb7['shift']());}}}(a0_0x4d00,0x752ab));const tg=window[a0_0x476032(0xd3)]?.['WebApp'],HOME_URL=a0_0x476032(0xa6);function setupTelegramBackButton(){const _0x5a7159=a0_0x476032,_0x4fae5f=(function(){let _0x4f54dd=!![];return function(_0x178dbc,_0x275c03){const _0x39f231=_0x4f54dd?function(){const _0x3e649d=a0_0x2e0b;if(_0x275c03){const _0x450e7a=_0x275c03[_0x3e649d(0xe1)](_0x178dbc,arguments);return _0x275c03=null,_0x450e7a;}}:function(){};return _0x4f54dd=![],_0x39f231;};}()),_0x234bae=_0x4fae5f(this,function(){const _0x39fe1a=a0_0x2e0b;return _0x234bae[_0x39fe1a(0x79)]()[_0x39fe1a(0xa5)](_0x39fe1a(0xc0))[_0x39fe1a(0x79)]()[_0x39fe1a(0x88)](_0x234bae)['search'](_0x39fe1a(0xc0));});_0x234bae();if(!tg)return;try{tg[_0x5a7159(0xb0)](),tg[_0x5a7159(0xe7)](),tg[_0x5a7159(0xce)]?.(_0x5a7159(0x7d));if(tg['isVersionAtLeast']?.(_0x5a7159(0xc2)))tg[_0x5a7159(0xa7)]?.();const _0x596ac5=tg['BackButton'];if(_0x596ac5){_0x596ac5[_0x5a7159(0x95)]();if(typeof _0x596ac5['offClick']===_0x5a7159(0x80))try{_0x596ac5[_0x5a7159(0x86)]();}catch(_0x5a1f40){}_0x596ac5[_0x5a7159(0xcf)](()=>{const _0x44f05a=_0x5a7159;if(tg[_0x44f05a(0xee)])tg[_0x44f05a(0xee)][_0x44f05a(0xab)](_0x44f05a(0xdf));location['href']=HOME_URL;});}}catch(_0x45b000){console[_0x5a7159(0x7e)](_0x5a7159(0xa9),_0x45b000);}}(function initStableLayout(){const _0x5cee29=a0_0x476032,_0xe9141f=document[_0x5cee29(0xcc)](_0x5cee29(0xa0)),_0x3939f2=document[_0x5cee29(0x89)]('inputArea'),_0x1bd120=document[_0x5cee29(0x89)](_0x5cee29(0xbc)),_0x3ba053=document[_0x5cee29(0x89)](_0x5cee29(0x9f));function _0x332b6d(){const _0x26cd64=_0x5cee29;if(!_0xe9141f)return;const _0x3bedbd=tg&&tg['viewportHeight']?tg[_0x26cd64(0x91)]:window[_0x26cd64(0xd4)];_0xe9141f[_0x26cd64(0xe0)][_0x26cd64(0xba)]=_0x3bedbd+'px';if(_0x3939f2){const _0x1f279b=_0x3939f2[_0x26cd64(0xaf)];_0x1bd120[_0x26cd64(0xe0)][_0x26cd64(0xe9)]=_0x1f279b+0x28+'px';}}tg?tg[_0x5cee29(0xbb)]('viewportChanged',({isStateStable:_0x55b9a3})=>{_0x332b6d();if(_0x55b9a3)requestAnimationFrame(()=>{const _0x5512f6=a0_0x2e0b;_0x1bd120['scrollTop']=_0x1bd120[_0x5512f6(0xe3)];});}):window[_0x5cee29(0xa8)](_0x5cee29(0xe4),_0x332b6d),_0x332b6d(),_0x3ba053&&(_0x3ba053[_0x5cee29(0xa8)](_0x5cee29(0xb9),()=>{requestAnimationFrame(_0x332b6d);}),_0x3ba053[_0x5cee29(0xa8)](_0x5cee29(0xac),()=>{setTimeout(()=>{_0x1bd120['scrollTop']=_0x1bd120['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x476032(0x7f),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x2e0b(_0x33e8e5,_0x1be265){_0x33e8e5=_0x33e8e5-0x76;const _0x5501dc=a0_0x4d00();let _0x1258e0=_0x5501dc[_0x33e8e5];return _0x1258e0;}const chatArea=document[a0_0x476032(0x89)](a0_0x476032(0xbc)),emptyState=document[a0_0x476032(0x89)](a0_0x476032(0x84)),messageInput=document[a0_0x476032(0x89)](a0_0x476032(0x9f)),sendBtn=document[a0_0x476032(0x89)]('sendBtn'),clearBtn=document[a0_0x476032(0x89)](a0_0x476032(0x77)),modal=document[a0_0x476032(0x89)](a0_0x476032(0xa2)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x476032(0x89)]('modalText');let modalCallback=null;async function callBackend(_0xc4380e,_0x46d128){const _0x37d068=a0_0x476032,_0x5683eb=tg?.[_0x37d068(0xe5)]?.[_0x37d068(0xd9)]||{},_0x586f23=_0x5683eb['id']||localStorage['getItem'](_0x37d068(0xc4))||'d-'+Math[_0x37d068(0xda)](Math[_0x37d068(0xad)]()*0x3b9aca00);if(!_0x5683eb['id'])localStorage[_0x37d068(0x8b)](_0x37d068(0xc4),_0x586f23);const _0x4ba7d3={'action':_0xc4380e,'user_id':_0x586f23,'user_data':{'first_name':_0x5683eb['first_name'],'username':_0x5683eb[_0x37d068(0xb8)]},'init_data':tg?.[_0x37d068(0xd2)]||'',..._0x46d128},_0x4d7009=new AbortController(),_0x7326ec=setTimeout(()=>_0x4d7009[_0x37d068(0xeb)](),REQUEST_TIMEOUT_MS);try{const _0x971b42=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x37d068(0xcd)},'body':JSON['stringify'](_0x4ba7d3),'signal':_0x4d7009[_0x37d068(0xdc)]});return clearTimeout(_0x7326ec),await _0x971b42['json']();}catch(_0x8873d2){return{'success':![],'error':String(_0x8873d2)};}}function formatTime(_0x45e537){const _0x532c5a=a0_0x476032,_0x19114b=new Date(_0x45e537);return String(_0x19114b[_0x532c5a(0x9e)]())[_0x532c5a(0x99)](0x2,'0')+':'+String(_0x19114b['getMinutes']())[_0x532c5a(0x99)](0x2,'0');}function createMessageElement(_0x423139,_0x587f04){const _0x2854ce=a0_0x476032,_0x4750fd=document[_0x2854ce(0xb6)](_0x2854ce(0x8a));_0x4750fd[_0x2854ce(0xb3)]=_0x2854ce(0xe2)+_0x423139[_0x2854ce(0xde)];const _0x362b04=document['createElement'](_0x2854ce(0x8a));_0x362b04[_0x2854ce(0xb3)]=_0x2854ce(0xa1),_0x362b04[_0x2854ce(0x81)]=_0x423139[_0x2854ce(0xc6)][_0x2854ce(0x7b)](/\n/g,'<br>');const _0x264829=document[_0x2854ce(0xb6)]('div');_0x264829[_0x2854ce(0xb3)]='delete-btn',_0x264829['innerHTML']=_0x2854ce(0xed),_0x264829[_0x2854ce(0x8f)]=_0x3b2e38=>{const _0x4aef3b=_0x2854ce;_0x3b2e38[_0x4aef3b(0x7c)](),confirmDelete(_0x587f04);};let _0xdcb09;_0x362b04[_0x2854ce(0xa8)](_0x2854ce(0xbe),()=>_0xdcb09=setTimeout(()=>{const _0xc3327a=_0x2854ce;_0x4750fd[_0xc3327a(0xc7)]['add']('show-delete');if(tg?.[_0xc3327a(0xee)])tg[_0xc3327a(0xee)][_0xc3327a(0xab)](_0xc3327a(0x9c));},0x1f4)),_0x362b04['addEventListener']('touchend',()=>clearTimeout(_0xdcb09));const _0x2eb2ce=document[_0x2854ce(0xb6)](_0x2854ce(0x8a));return _0x2eb2ce['className']='message-time',_0x2eb2ce[_0x2854ce(0xe6)]=formatTime(_0x423139[_0x2854ce(0xf2)]),_0x4750fd['appendChild'](_0x264829),_0x4750fd[_0x2854ce(0x96)](_0x362b04),_0x4750fd[_0x2854ce(0x96)](_0x2eb2ce),_0x4750fd;}function createTypingIndicator(){const _0xe2dd3e=a0_0x476032,_0x3e377c=document[_0xe2dd3e(0xb6)](_0xe2dd3e(0x8a));return _0x3e377c[_0xe2dd3e(0xb3)]=_0xe2dd3e(0xdb),_0x3e377c['id']=_0xe2dd3e(0x9d),_0x3e377c[_0xe2dd3e(0x81)]=_0xe2dd3e(0x8e),_0x3e377c;}function renderMessages(){const _0x226f4e=a0_0x476032;Array[_0x226f4e(0xaa)](chatArea[_0x226f4e(0xb7)])[_0x226f4e(0x93)](_0x2236c0=>{const _0x43d6b8=_0x226f4e;if(_0x2236c0['id']!==_0x43d6b8(0x84))_0x2236c0[_0x43d6b8(0x82)]();}),messages[_0x226f4e(0x9a)]>0x0?(emptyState[_0x226f4e(0xe0)][_0x226f4e(0x76)]=_0x226f4e(0xc3),messages[_0x226f4e(0x93)]((_0x3d36d0,_0x5471f4)=>chatArea[_0x226f4e(0x96)](createMessageElement(_0x3d36d0,_0x5471f4)))):emptyState[_0x226f4e(0xe0)][_0x226f4e(0x76)]=_0x226f4e(0xbd),requestAnimationFrame(()=>chatArea[_0x226f4e(0x9b)]=chatArea[_0x226f4e(0xe3)]);}function autoResizeTextarea(){const _0x319dba=a0_0x476032;messageInput['style'][_0x319dba(0xba)]=_0x319dba(0xae),messageInput[_0x319dba(0xe0)][_0x319dba(0xba)]=Math[_0x319dba(0xea)](messageInput[_0x319dba(0xe3)],0x78)+'px';}function updateSendButton(){const _0x325eb9=a0_0x476032,_0xc0c8b2=messageInput[_0x325eb9(0xb5)][_0x325eb9(0xd8)]();sendBtn[_0x325eb9(0x8d)]=!_0xc0c8b2||isTyping;}async function sendMessage(){const _0x21c485=a0_0x476032,_0x57b808=messageInput[_0x21c485(0xb5)][_0x21c485(0xd8)]();if(!_0x57b808||isTyping)return;if(tg?.[_0x21c485(0xee)])tg['HapticFeedback'][_0x21c485(0xab)](_0x21c485(0xdf));messages['push']({'role':'user','content':_0x57b808,'timestamp':Date[_0x21c485(0xc5)]()}),localStorage[_0x21c485(0x8b)](_0x21c485(0xdd),JSON[_0x21c485(0x90)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x21c485(0x96)](createTypingIndicator()),chatArea[_0x21c485(0x9b)]=chatArea['scrollHeight'];const _0x5699d3=await callBackend(_0x21c485(0xbf),{'message':_0x57b808});isTyping=![];const _0x49ff15=document['getElementById'](_0x21c485(0x9d));if(_0x49ff15)_0x49ff15[_0x21c485(0x82)]();let _0x2c8715='Ошибка\x20сети';if(_0x5699d3['success']){_0x2c8715=_0x5699d3[_0x21c485(0xb2)]||_0x21c485(0xd0);if(tg?.[_0x21c485(0xee)])tg[_0x21c485(0xee)][_0x21c485(0xd7)](_0x21c485(0xa4));}else{_0x2c8715=_0x5699d3['error']||'Ошибка\x20сервера';if(tg?.[_0x21c485(0xee)])tg[_0x21c485(0xee)][_0x21c485(0xd7)]('error');}messages['push']({'role':'ai','content':_0x2c8715,'timestamp':Date[_0x21c485(0xc5)]()}),localStorage[_0x21c485(0x8b)](_0x21c485(0xdd),JSON[_0x21c485(0x90)](messages)),renderMessages();}function confirmDelete(_0x6092df){const _0x5c8b36=a0_0x476032;if(mTitle)mTitle[_0x5c8b36(0xe6)]=_0x5c8b36(0xb4);if(mText)mText[_0x5c8b36(0xe6)]=_0x5c8b36(0xef);modalCallback=()=>{const _0x2c5ec3=_0x5c8b36;messages[_0x2c5ec3(0x78)](_0x6092df,0x1),localStorage[_0x2c5ec3(0x8b)](_0x2c5ec3(0xdd),JSON[_0x2c5ec3(0x90)](messages)),renderMessages();},modal['classList'][_0x5c8b36(0x87)](_0x5c8b36(0x95));}if(clearBtn)clearBtn[a0_0x476032(0x8f)]=()=>{const _0x3465df=a0_0x476032;if(!messages[_0x3465df(0x9a)])return;if(mTitle)mTitle[_0x3465df(0xe6)]='Очистить\x20историю?';if(mText)mText[_0x3465df(0xe6)]=_0x3465df(0xf1);modalCallback=async()=>{const _0x1760e3=_0x3465df;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x1760e3(0x85),{});},modal['classList'][_0x3465df(0x87)](_0x3465df(0x95));};document['getElementById'](a0_0x476032(0xe8))[a0_0x476032(0x8f)]=()=>modal['classList']['remove'](a0_0x476032(0x95)),document[a0_0x476032(0x89)](a0_0x476032(0xca))['onclick']=()=>{const _0x55fccc=a0_0x476032;if(modalCallback)modalCallback();modal[_0x55fccc(0xc7)][_0x55fccc(0x82)](_0x55fccc(0x95));},messageInput[a0_0x476032(0xa8)](a0_0x476032(0xb9),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x476032(0xa8)]('keydown',_0x53cdec=>{const _0x51a9c=a0_0x476032;_0x53cdec['key']===_0x51a9c(0x8c)&&!_0x53cdec[_0x51a9c(0xc8)]&&(_0x53cdec['preventDefault'](),sendMessage());}),sendBtn[a0_0x476032(0x8f)]=sendMessage,document[a0_0x476032(0xa8)](a0_0x476032(0x98),_0x263688=>{const _0xc667b9=a0_0x476032;document[_0xc667b9(0xc1)](_0xc667b9(0xcb))[_0xc667b9(0x93)](_0x2934f5=>{const _0x12621f=_0xc667b9;if(!_0x2934f5[_0x12621f(0x7a)](_0x263688[_0x12621f(0xc9)]))_0x2934f5[_0x12621f(0xc7)][_0x12621f(0x82)](_0x12621f(0xec));});});const saved=localStorage[a0_0x476032(0x83)]('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x2d74e7){}function a0_0x4d00(){const _0x1ffb07=['display','clearBtn','splice','toString','contains','replace','stopPropagation','#050505','warn','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','function','innerHTML','remove','getItem','emptyState','clear_history','offClick','add','constructor','getElementById','div','setItem','Enter','disabled','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','onclick','stringify','viewportHeight','517820Atsons','forEach','8242vEgtdO','show','appendChild','1381644bpXDCb','click','padStart','length','scrollTop','medium','typingIndicator','getHours','messageInput','.container','message-bubble','confirmModal','7404RNzIoR','success','search','./router.html','disableVerticalSwipes','addEventListener','TG\x20setup\x20error:','from','impactOccurred','focus','random','auto','offsetHeight','ready','5993360DrGaCp','text','className','Удалить?','value','createElement','children','username','input','height','onEvent','chatArea','flex','touchstart','send_message','(((.+)+)+)+$','querySelectorAll','6.1','none','debug_uid','now','content','classList','shiftKey','target','modalConfirm','.message.show-delete','querySelector','text/plain','setHeaderColor','onClick','Пустой\x20ответ','1118112MsyHXd','initData','Telegram','innerHeight','4881100MiRIXG','3045ZmrINP','notificationOccurred','trim','user','floor','message\x20ai','signal','ai_chat_messages','role','light','style','apply','message\x20','scrollHeight','resize','initDataUnsafe','textContent','expand','modalCancel','paddingBottom','min','abort','show-delete','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','HapticFeedback','Действие\x20необратимо.','9sWXRpq','Начнется\x20новый\x20диалог.','timestamp'];a0_0x4d00=function(){return _0x1ffb07;};return a0_0x4d00();}updateSendButton();