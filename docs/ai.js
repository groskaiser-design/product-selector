function a0_0x30e2(_0x67f717,_0x313203){_0x67f717=_0x67f717-0x1dc;const _0x42c6f3=a0_0x2ac1();let _0x55eeb8=_0x42c6f3[_0x67f717];return _0x55eeb8;}const a0_0x24ff31=a0_0x30e2;(function(_0x2f692a,_0x7e8742){const _0x25d78f=a0_0x30e2,_0x2acf52=_0x2f692a();while(!![]){try{const _0x452f00=parseInt(_0x25d78f(0x226))/0x1+-parseInt(_0x25d78f(0x204))/0x2*(parseInt(_0x25d78f(0x233))/0x3)+parseInt(_0x25d78f(0x1f4))/0x4+parseInt(_0x25d78f(0x228))/0x5+-parseInt(_0x25d78f(0x246))/0x6+-parseInt(_0x25d78f(0x1f1))/0x7*(-parseInt(_0x25d78f(0x248))/0x8)+-parseInt(_0x25d78f(0x231))/0x9*(-parseInt(_0x25d78f(0x1eb))/0xa);if(_0x452f00===_0x7e8742)break;else _0x2acf52['push'](_0x2acf52['shift']());}catch(_0x2a023e){_0x2acf52['push'](_0x2acf52['shift']());}}}(a0_0x2ac1,0x6a2bb));const tg=window[a0_0x24ff31(0x1e5)]?.['WebApp'],HOME_URL=a0_0x24ff31(0x221);function setupTelegramBackButton(){const _0x16d39e=a0_0x24ff31;if(!tg)return;try{tg['ready'](),tg[_0x16d39e(0x239)](),tg[_0x16d39e(0x247)]?.(_0x16d39e(0x20e));if(tg[_0x16d39e(0x22c)]?.(_0x16d39e(0x257)))tg[_0x16d39e(0x222)]?.();const _0x599c67=tg[_0x16d39e(0x22a)];if(_0x599c67){_0x599c67[_0x16d39e(0x1f3)]();if(typeof _0x599c67['offClick']==='function')try{_0x599c67['offClick']();}catch(_0xfe04b2){}_0x599c67[_0x16d39e(0x206)](()=>{const _0x2424c6=_0x16d39e;if(tg['HapticFeedback'])tg['HapticFeedback']['impactOccurred'](_0x2424c6(0x210));location[_0x2424c6(0x201)]=HOME_URL;});}}catch(_0x33c917){console[_0x16d39e(0x24b)]('TG\x20setup\x20error:',_0x33c917);}}function a0_0x2ac1(){const _0x45a281=['user','div','signal','parse','trim','createElement','viewportHeight','medium','min','6.1','key','replace','style','delete-btn','padStart','getElementById','<br>','search','show-delete','onEvent','innerHTML','Telegram','.message.show-delete','messageInput','textContent','getItem','value','60MDlbRj','disabled','none','scrollHeight','modalCancel','touchstart','28SMWwfo','querySelector','show','912656nMpbos','innerHeight','offsetHeight','notificationOccurred','content','first_name','message-time','text','apply','addEventListener','remove','Ошибка\x20сервера','modalTitle','href','impactOccurred','contains','254974jXuqVj','abort','onClick','(((.+)+)+)+$','classList','success','touchend','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','target','display','#050505','onclick','light','getMinutes','toString','Очистить\x20историю?','shiftKey','error','flex','initDataUnsafe','timestamp','className','height','Действие\x20необратимо.','modalConfirm','splice','modalText','now','appendChild','./router.html','disableVerticalSwipes','message\x20ai','scrollTop','message\x20','91447azSyCM','HapticFeedback','797670hMSdLz','emptyState','BackButton','setItem','isVersionAtLeast','length','removeItem','constructor','inputArea','619470tbCrST','keydown','12CvBHca','auto','push','input','text/plain','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','expand','add','stringify','Начнется\x20новый\x20диалог.','Удалить?','forEach','from','random','ai_chat_messages','chatArea','typingIndicator','Пустой\x20ответ','role','2892204wfBtdK','setHeaderColor','1069464NCNPXP','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','debug_uid','warn','paddingBottom','children'];a0_0x2ac1=function(){return _0x45a281;};return a0_0x2ac1();}(function initStableLayout(){const _0x3abed7=a0_0x24ff31,_0x3d394e=(function(){let _0x5405b0=!![];return function(_0x2ec0eb,_0x101b3b){const _0x17d170=_0x5405b0?function(){const _0x39444d=a0_0x30e2;if(_0x101b3b){const _0x59ba91=_0x101b3b[_0x39444d(0x1fc)](_0x2ec0eb,arguments);return _0x101b3b=null,_0x59ba91;}}:function(){};return _0x5405b0=![],_0x17d170;};}()),_0x536314=document[_0x3abed7(0x1f2)]('.container'),_0x59dd4f=document['getElementById'](_0x3abed7(0x230)),_0x4ea30a=document[_0x3abed7(0x1df)](_0x3abed7(0x242)),_0x4dadc4=document[_0x3abed7(0x1df)](_0x3abed7(0x1e7));function _0x121bac(){const _0x1d3a69=_0x3abed7,_0x4a8a00=_0x3d394e(this,function(){const _0x3bdfce=a0_0x30e2;return _0x4a8a00['toString']()[_0x3bdfce(0x1e1)](_0x3bdfce(0x207))[_0x3bdfce(0x212)]()[_0x3bdfce(0x22f)](_0x4a8a00)[_0x3bdfce(0x1e1)](_0x3bdfce(0x207));});_0x4a8a00();if(!_0x536314)return;const _0x4d7240=tg&&tg[_0x1d3a69(0x254)]?tg[_0x1d3a69(0x254)]:window[_0x1d3a69(0x1f5)];_0x536314[_0x1d3a69(0x1dc)][_0x1d3a69(0x21a)]=_0x4d7240+'px';if(_0x59dd4f){const _0x32e107=_0x59dd4f[_0x1d3a69(0x1f6)];_0x4ea30a['style'][_0x1d3a69(0x24c)]=_0x32e107+0x28+'px';}}tg?tg[_0x3abed7(0x1e3)]('viewportChanged',({isStateStable:_0x10487f})=>{_0x121bac();if(_0x10487f)requestAnimationFrame(()=>{const _0x276e83=a0_0x30e2;_0x4ea30a[_0x276e83(0x224)]=_0x4ea30a['scrollHeight'];});}):window[_0x3abed7(0x1fd)]('resize',_0x121bac),_0x121bac(),_0x4dadc4&&(_0x4dadc4[_0x3abed7(0x1fd)](_0x3abed7(0x236),()=>{requestAnimationFrame(_0x121bac);}),_0x4dadc4[_0x3abed7(0x1fd)]('focus',()=>{setTimeout(()=>{const _0x5b0ac4=a0_0x30e2;_0x4ea30a[_0x5b0ac4(0x224)]=_0x4ea30a[_0x5b0ac4(0x1ee)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x24ff31(0x238),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x24ff31(0x1df)]('chatArea'),emptyState=document[a0_0x24ff31(0x1df)](a0_0x24ff31(0x229)),messageInput=document[a0_0x24ff31(0x1df)](a0_0x24ff31(0x1e7)),sendBtn=document[a0_0x24ff31(0x1df)]('sendBtn'),clearBtn=document[a0_0x24ff31(0x1df)]('clearBtn'),modal=document[a0_0x24ff31(0x1df)]('confirmModal'),mTitle=document[a0_0x24ff31(0x1df)](a0_0x24ff31(0x200)),mText=document['getElementById'](a0_0x24ff31(0x21e));let modalCallback=null;async function callBackend(_0x27b300,_0x25f7a7){const _0x43f259=a0_0x24ff31,_0x41972e=tg?.[_0x43f259(0x217)]?.[_0x43f259(0x24e)]||{},_0x3d4530=_0x41972e['id']||localStorage[_0x43f259(0x1e9)](_0x43f259(0x24a))||'d-'+Math['floor'](Math[_0x43f259(0x240)]()*0x3b9aca00);if(!_0x41972e['id'])localStorage[_0x43f259(0x22b)](_0x43f259(0x24a),_0x3d4530);const _0x1d967b={'action':_0x27b300,'user_id':_0x3d4530,'user_data':{'first_name':_0x41972e[_0x43f259(0x1f9)],'username':_0x41972e['username']},'init_data':tg?.['initData']||'',..._0x25f7a7},_0x11cb3d=new AbortController(),_0x3083e4=setTimeout(()=>_0x11cb3d[_0x43f259(0x205)](),REQUEST_TIMEOUT_MS);try{const _0x1cf852=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x43f259(0x237)},'body':JSON[_0x43f259(0x23b)](_0x1d967b),'signal':_0x11cb3d[_0x43f259(0x250)]});return clearTimeout(_0x3083e4),await _0x1cf852['json']();}catch(_0x4aba7b){return{'success':![],'error':String(_0x4aba7b)};}}function formatTime(_0x1e1ad0){const _0x4d961a=a0_0x24ff31,_0x4b21c6=new Date(_0x1e1ad0);return String(_0x4b21c6['getHours']())[_0x4d961a(0x1de)](0x2,'0')+':'+String(_0x4b21c6[_0x4d961a(0x211)]())['padStart'](0x2,'0');}function createMessageElement(_0x2a739f,_0x577e5d){const _0x4bfd3e=a0_0x24ff31,_0x633c23=document[_0x4bfd3e(0x253)](_0x4bfd3e(0x24f));_0x633c23['className']=_0x4bfd3e(0x225)+_0x2a739f[_0x4bfd3e(0x245)];const _0x1ebcfc=document[_0x4bfd3e(0x253)](_0x4bfd3e(0x24f));_0x1ebcfc[_0x4bfd3e(0x219)]='message-bubble',_0x1ebcfc[_0x4bfd3e(0x1e4)]=_0x2a739f[_0x4bfd3e(0x1f8)][_0x4bfd3e(0x259)](/\n/g,_0x4bfd3e(0x1e0));const _0x26f176=document[_0x4bfd3e(0x253)](_0x4bfd3e(0x24f));_0x26f176[_0x4bfd3e(0x219)]=_0x4bfd3e(0x1dd),_0x26f176[_0x4bfd3e(0x1e4)]=_0x4bfd3e(0x20b),_0x26f176['onclick']=_0x3dd00b=>{_0x3dd00b['stopPropagation'](),confirmDelete(_0x577e5d);};let _0x319f38;_0x1ebcfc['addEventListener'](_0x4bfd3e(0x1f0),()=>_0x319f38=setTimeout(()=>{const _0x5d1e45=_0x4bfd3e;_0x633c23['classList'][_0x5d1e45(0x23a)](_0x5d1e45(0x1e2));if(tg?.[_0x5d1e45(0x227)])tg[_0x5d1e45(0x227)][_0x5d1e45(0x202)](_0x5d1e45(0x255));},0x1f4)),_0x1ebcfc[_0x4bfd3e(0x1fd)](_0x4bfd3e(0x20a),()=>clearTimeout(_0x319f38));const _0x6f5c0a=document[_0x4bfd3e(0x253)](_0x4bfd3e(0x24f));return _0x6f5c0a[_0x4bfd3e(0x219)]=_0x4bfd3e(0x1fa),_0x6f5c0a[_0x4bfd3e(0x1e8)]=formatTime(_0x2a739f[_0x4bfd3e(0x218)]),_0x633c23[_0x4bfd3e(0x220)](_0x26f176),_0x633c23[_0x4bfd3e(0x220)](_0x1ebcfc),_0x633c23[_0x4bfd3e(0x220)](_0x6f5c0a),_0x633c23;}function createTypingIndicator(){const _0x5d7ad6=a0_0x24ff31,_0x3a4304=document[_0x5d7ad6(0x253)](_0x5d7ad6(0x24f));return _0x3a4304[_0x5d7ad6(0x219)]=_0x5d7ad6(0x223),_0x3a4304['id']=_0x5d7ad6(0x243),_0x3a4304[_0x5d7ad6(0x1e4)]=_0x5d7ad6(0x249),_0x3a4304;}function renderMessages(){const _0x2f4fd3=a0_0x24ff31;Array[_0x2f4fd3(0x23f)](chatArea[_0x2f4fd3(0x24d)])['forEach'](_0x479cfc=>{const _0xe897e8=_0x2f4fd3;if(_0x479cfc['id']!==_0xe897e8(0x229))_0x479cfc['remove']();}),messages[_0x2f4fd3(0x22d)]>0x0?(emptyState[_0x2f4fd3(0x1dc)][_0x2f4fd3(0x20d)]=_0x2f4fd3(0x1ed),messages[_0x2f4fd3(0x23e)]((_0x43c82d,_0x456c66)=>chatArea[_0x2f4fd3(0x220)](createMessageElement(_0x43c82d,_0x456c66)))):emptyState[_0x2f4fd3(0x1dc)][_0x2f4fd3(0x20d)]=_0x2f4fd3(0x216),requestAnimationFrame(()=>chatArea[_0x2f4fd3(0x224)]=chatArea[_0x2f4fd3(0x1ee)]);}function autoResizeTextarea(){const _0x533443=a0_0x24ff31;messageInput[_0x533443(0x1dc)][_0x533443(0x21a)]=_0x533443(0x234),messageInput[_0x533443(0x1dc)][_0x533443(0x21a)]=Math[_0x533443(0x256)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x46d23e=a0_0x24ff31,_0x33a62c=messageInput['value'][_0x46d23e(0x252)]();sendBtn[_0x46d23e(0x1ec)]=!_0x33a62c||isTyping;}async function sendMessage(){const _0x182102=a0_0x24ff31,_0xcbaa24=messageInput[_0x182102(0x1ea)][_0x182102(0x252)]();if(!_0xcbaa24||isTyping)return;if(tg?.[_0x182102(0x227)])tg[_0x182102(0x227)][_0x182102(0x202)](_0x182102(0x210));messages[_0x182102(0x235)]({'role':_0x182102(0x24e),'content':_0xcbaa24,'timestamp':Date[_0x182102(0x21f)]()}),localStorage[_0x182102(0x22b)](_0x182102(0x241),JSON[_0x182102(0x23b)](messages)),renderMessages(),messageInput[_0x182102(0x1ea)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x182102(0x220)](createTypingIndicator()),chatArea[_0x182102(0x224)]=chatArea[_0x182102(0x1ee)];const _0x3b3d81=await callBackend('send_message',{'message':_0xcbaa24});isTyping=![];const _0x564a17=document['getElementById'](_0x182102(0x243));if(_0x564a17)_0x564a17[_0x182102(0x1fe)]();let _0x46f5b6='Ошибка\x20сети';if(_0x3b3d81[_0x182102(0x209)]){_0x46f5b6=_0x3b3d81[_0x182102(0x1fb)]||_0x182102(0x244);if(tg?.[_0x182102(0x227)])tg[_0x182102(0x227)]['notificationOccurred'](_0x182102(0x209));}else{_0x46f5b6=_0x3b3d81[_0x182102(0x215)]||_0x182102(0x1ff);if(tg?.[_0x182102(0x227)])tg[_0x182102(0x227)][_0x182102(0x1f7)]('error');}messages[_0x182102(0x235)]({'role':'ai','content':_0x46f5b6,'timestamp':Date[_0x182102(0x21f)]()}),localStorage[_0x182102(0x22b)]('ai_chat_messages',JSON[_0x182102(0x23b)](messages)),renderMessages();}function confirmDelete(_0x76ea76){const _0x3da78c=a0_0x24ff31;if(mTitle)mTitle['textContent']=_0x3da78c(0x23d);if(mText)mText[_0x3da78c(0x1e8)]=_0x3da78c(0x21b);modalCallback=()=>{const _0x38b3c9=_0x3da78c;messages[_0x38b3c9(0x21d)](_0x76ea76,0x1),localStorage[_0x38b3c9(0x22b)](_0x38b3c9(0x241),JSON[_0x38b3c9(0x23b)](messages)),renderMessages();},modal[_0x3da78c(0x208)][_0x3da78c(0x23a)](_0x3da78c(0x1f3));}if(clearBtn)clearBtn[a0_0x24ff31(0x20f)]=()=>{const _0x55b762=a0_0x24ff31;if(!messages[_0x55b762(0x22d)])return;if(mTitle)mTitle['textContent']=_0x55b762(0x213);if(mText)mText['textContent']=_0x55b762(0x23c);modalCallback=async()=>{const _0x428797=_0x55b762;messages=[],localStorage[_0x428797(0x22e)](_0x428797(0x241)),renderMessages(),callBackend('clear_history',{});},modal[_0x55b762(0x208)]['add']('show');};document['getElementById'](a0_0x24ff31(0x1ef))[a0_0x24ff31(0x20f)]=()=>modal[a0_0x24ff31(0x208)][a0_0x24ff31(0x1fe)](a0_0x24ff31(0x1f3)),document[a0_0x24ff31(0x1df)](a0_0x24ff31(0x21c))[a0_0x24ff31(0x20f)]=()=>{const _0x5b68cc=a0_0x24ff31;if(modalCallback)modalCallback();modal[_0x5b68cc(0x208)][_0x5b68cc(0x1fe)]('show');},messageInput[a0_0x24ff31(0x1fd)](a0_0x24ff31(0x236),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x24ff31(0x1fd)](a0_0x24ff31(0x232),_0x36b200=>{const _0x59e2a1=a0_0x24ff31;_0x36b200[_0x59e2a1(0x258)]==='Enter'&&!_0x36b200[_0x59e2a1(0x214)]&&(_0x36b200['preventDefault'](),sendMessage());}),sendBtn[a0_0x24ff31(0x20f)]=sendMessage,document[a0_0x24ff31(0x1fd)]('click',_0x93d2dc=>{const _0x4a7cfc=a0_0x24ff31;document['querySelectorAll'](_0x4a7cfc(0x1e6))[_0x4a7cfc(0x23e)](_0x60e510=>{const _0x5bbf53=_0x4a7cfc;if(!_0x60e510[_0x5bbf53(0x203)](_0x93d2dc[_0x5bbf53(0x20c)]))_0x60e510['classList']['remove'](_0x5bbf53(0x1e2));});});const saved=localStorage[a0_0x24ff31(0x1e9)](a0_0x24ff31(0x241));if(saved)try{messages=JSON[a0_0x24ff31(0x251)](saved),renderMessages();}catch(a0_0x49efeb){}updateSendButton();