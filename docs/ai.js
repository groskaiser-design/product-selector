const a0_0x12d36c=a0_0x440f;(function(_0x517acb,_0x41a1f9){const _0x17de5f=a0_0x440f,_0x173dcf=_0x517acb();while(!![]){try{const _0x1c0bad=-parseInt(_0x17de5f(0xb9))/0x1+parseInt(_0x17de5f(0xaa))/0x2+parseInt(_0x17de5f(0x87))/0x3+-parseInt(_0x17de5f(0xb7))/0x4*(parseInt(_0x17de5f(0xae))/0x5)+parseInt(_0x17de5f(0xd2))/0x6*(parseInt(_0x17de5f(0xa7))/0x7)+parseInt(_0x17de5f(0xd6))/0x8+-parseInt(_0x17de5f(0xb2))/0x9;if(_0x1c0bad===_0x41a1f9)break;else _0x173dcf['push'](_0x173dcf['shift']());}catch(_0x43f077){_0x173dcf['push'](_0x173dcf['shift']());}}}(a0_0x2cf6,0xc5974));const tg=window['Telegram']?.[a0_0x12d36c(0x86)],HOME_URL=a0_0x12d36c(0x99);function setupTelegramBackButton(){const _0x491ef6=a0_0x12d36c;if(!tg)return;try{tg[_0x491ef6(0xd5)](),tg['expand'](),tg[_0x491ef6(0x84)]?.(_0x491ef6(0xe0));if(tg[_0x491ef6(0xb5)]?.(_0x491ef6(0xbf)))tg[_0x491ef6(0xdf)]?.();const _0x59590c=tg['BackButton'];if(_0x59590c){_0x59590c[_0x491ef6(0xac)]();if(typeof _0x59590c['offClick']===_0x491ef6(0xba))try{_0x59590c[_0x491ef6(0xda)]();}catch(_0x22fc89){}_0x59590c[_0x491ef6(0x88)](()=>{const _0x102525=_0x491ef6;if(tg[_0x102525(0xb3)])tg[_0x102525(0xb3)]['impactOccurred'](_0x102525(0xbc));location[_0x102525(0xc2)]=HOME_URL;});}}catch(_0x175386){console[_0x491ef6(0xe3)](_0x491ef6(0xd1),_0x175386);}}(function initStableLayout(){const _0x2d216a=a0_0x12d36c,_0x43fb75=(function(){let _0x490749=!![];return function(_0x5c3b9a,_0x5d942d){const _0x13092d=_0x490749?function(){const _0x3e01b4=a0_0x440f;if(_0x5d942d){const _0x5c401a=_0x5d942d[_0x3e01b4(0xf0)](_0x5c3b9a,arguments);return _0x5d942d=null,_0x5c401a;}}:function(){};return _0x490749=![],_0x13092d;};}()),_0x4fdb78=document[_0x2d216a(0xbb)](_0x2d216a(0x98)),_0x2345c2=document['getElementById'](_0x2d216a(0xf3)),_0x308292=document[_0x2d216a(0x7c)]('chatArea'),_0x51eacf=document['getElementById'](_0x2d216a(0xa9));function _0x193da2(){const _0x47a886=_0x2d216a,_0x293f4d=_0x43fb75(this,function(){const _0x4c26a5=a0_0x440f;return _0x293f4d[_0x4c26a5(0xca)]()[_0x4c26a5(0x8e)](_0x4c26a5(0x77))[_0x4c26a5(0xca)]()[_0x4c26a5(0xc5)](_0x293f4d)[_0x4c26a5(0x8e)]('(((.+)+)+)+$');});_0x293f4d();if(!_0x4fdb78)return;const _0x17efe7=tg&&tg[_0x47a886(0xe2)]?tg[_0x47a886(0xe2)]:window[_0x47a886(0xe4)];_0x4fdb78[_0x47a886(0xe5)][_0x47a886(0xe1)]=_0x17efe7+'px';if(_0x2345c2){const _0x14dd62=_0x2345c2[_0x47a886(0xb1)];_0x308292[_0x47a886(0xe5)]['paddingBottom']=_0x14dd62+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x2d5858})=>{_0x193da2();if(_0x2d5858)requestAnimationFrame(()=>{const _0x89e46d=a0_0x440f;_0x308292['scrollTop']=_0x308292[_0x89e46d(0xf1)];});}):window[_0x2d216a(0xec)](_0x2d216a(0xaf),_0x193da2),_0x193da2(),_0x51eacf&&(_0x51eacf[_0x2d216a(0xec)](_0x2d216a(0xc9),()=>{requestAnimationFrame(_0x193da2);}),_0x51eacf['addEventListener'](_0x2d216a(0xdc),()=>{setTimeout(()=>{const _0x3db936=a0_0x440f;_0x308292[_0x3db936(0x79)]=_0x308292['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x12d36c(0x85),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x12d36c(0x7a)),emptyState=document[a0_0x12d36c(0x7c)]('emptyState'),messageInput=document['getElementById'](a0_0x12d36c(0xa9)),sendBtn=document[a0_0x12d36c(0x7c)]('sendBtn'),clearBtn=document[a0_0x12d36c(0x7c)]('clearBtn'),modal=document['getElementById'](a0_0x12d36c(0xea)),mTitle=document[a0_0x12d36c(0x7c)]('modalTitle'),mText=document['getElementById'](a0_0x12d36c(0xe9));let modalCallback=null;async function callBackend(_0x150986,_0x8f3d64){const _0x3b5962=a0_0x12d36c,_0x50079f=tg?.['initDataUnsafe']?.['user']||{},_0x5c9cf6=_0x50079f['id']||localStorage[_0x3b5962(0xd4)]('debug_uid')||'d-'+Math['floor'](Math[_0x3b5962(0xab)]()*0x3b9aca00);if(!_0x50079f['id'])localStorage[_0x3b5962(0x8f)](_0x3b5962(0xd9),_0x5c9cf6);const _0x2fe948={'action':_0x150986,'user_id':_0x5c9cf6,'user_data':{'first_name':_0x50079f[_0x3b5962(0xa8)],'username':_0x50079f[_0x3b5962(0x93)]},'init_data':tg?.[_0x3b5962(0x90)]||'',..._0x8f3d64},_0x5f248e=new AbortController(),_0xffd132=setTimeout(()=>_0x5f248e['abort'](),REQUEST_TIMEOUT_MS);try{const _0x4975f7=await fetch(BACKEND_URL,{'method':_0x3b5962(0xbd),'headers':{'Content-Type':_0x3b5962(0x9a)},'body':JSON['stringify'](_0x2fe948),'signal':_0x5f248e[_0x3b5962(0xdd)]});return clearTimeout(_0xffd132),await _0x4975f7[_0x3b5962(0x9f)]();}catch(_0x5d5caf){return{'success':![],'error':String(_0x5d5caf)};}}function formatTime(_0x3e2125){const _0x2dd215=a0_0x12d36c,_0x5cf16d=new Date(_0x3e2125);return String(_0x5cf16d[_0x2dd215(0xb8)]())[_0x2dd215(0x8b)](0x2,'0')+':'+String(_0x5cf16d[_0x2dd215(0xe6)]())[_0x2dd215(0x8b)](0x2,'0');}function createMessageElement(_0x236703,_0x58894c){const _0x5427bc=a0_0x12d36c,_0x208eb4=document[_0x5427bc(0x9d)]('div');_0x208eb4[_0x5427bc(0x92)]='message\x20'+_0x236703[_0x5427bc(0x83)];const _0x2c1822=document[_0x5427bc(0x9d)](_0x5427bc(0xcb));_0x2c1822[_0x5427bc(0x92)]=_0x5427bc(0x78),_0x2c1822[_0x5427bc(0xa5)]=_0x236703[_0x5427bc(0xc4)][_0x5427bc(0xbe)](/\n/g,'<br>');const _0x6160b6=document['createElement']('div');_0x6160b6[_0x5427bc(0x92)]=_0x5427bc(0x8a),_0x6160b6[_0x5427bc(0xa5)]=_0x5427bc(0xf2),_0x6160b6[_0x5427bc(0xde)]=_0x50c51d=>{const _0x516086=_0x5427bc;_0x50c51d[_0x516086(0x7b)](),confirmDelete(_0x58894c);};let _0x220bd5;_0x2c1822[_0x5427bc(0xec)](_0x5427bc(0x7f),()=>_0x220bd5=setTimeout(()=>{const _0x4add3b=_0x5427bc;_0x208eb4[_0x4add3b(0xad)][_0x4add3b(0x97)](_0x4add3b(0x82));if(tg?.[_0x4add3b(0xb3)])tg[_0x4add3b(0xb3)][_0x4add3b(0xc8)]('medium');},0x1f4)),_0x2c1822['addEventListener'](_0x5427bc(0x81),()=>clearTimeout(_0x220bd5));const _0x5b53d7=document[_0x5427bc(0x9d)]('div');return _0x5b53d7[_0x5427bc(0x92)]=_0x5427bc(0x89),_0x5b53d7[_0x5427bc(0xcf)]=formatTime(_0x236703[_0x5427bc(0xcd)]),_0x208eb4[_0x5427bc(0xed)](_0x6160b6),_0x208eb4[_0x5427bc(0xed)](_0x2c1822),_0x208eb4['appendChild'](_0x5b53d7),_0x208eb4;}function createTypingIndicator(){const _0xa47d7e=a0_0x12d36c,_0x503cb5=document[_0xa47d7e(0x9d)](_0xa47d7e(0xcb));return _0x503cb5[_0xa47d7e(0x92)]=_0xa47d7e(0xd3),_0x503cb5['id']=_0xa47d7e(0xc3),_0x503cb5[_0xa47d7e(0xa5)]=_0xa47d7e(0xa3),_0x503cb5;}function renderMessages(){const _0x8e654f=a0_0x12d36c;Array[_0x8e654f(0xc6)](chatArea[_0x8e654f(0xa6)])[_0x8e654f(0x8d)](_0x75cf47=>{const _0x271cfc=_0x8e654f;if(_0x75cf47['id']!==_0x271cfc(0xa2))_0x75cf47[_0x271cfc(0x80)]();}),messages['length']>0x0?(emptyState[_0x8e654f(0xe5)][_0x8e654f(0xce)]=_0x8e654f(0x8c),messages[_0x8e654f(0x8d)]((_0x101f71,_0x115870)=>chatArea[_0x8e654f(0xed)](createMessageElement(_0x101f71,_0x115870)))):emptyState[_0x8e654f(0xe5)][_0x8e654f(0xce)]=_0x8e654f(0x9e),requestAnimationFrame(()=>chatArea[_0x8e654f(0x79)]=chatArea[_0x8e654f(0xf1)]);}function autoResizeTextarea(){const _0x1a0c8f=a0_0x12d36c;messageInput[_0x1a0c8f(0xe5)][_0x1a0c8f(0xe1)]=_0x1a0c8f(0xd8),messageInput[_0x1a0c8f(0xe5)][_0x1a0c8f(0xe1)]=Math[_0x1a0c8f(0xb4)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x4adc91=a0_0x12d36c,_0x272ca1=messageInput[_0x4adc91(0x7e)][_0x4adc91(0xb6)]();sendBtn[_0x4adc91(0x96)]=!_0x272ca1||isTyping;}async function sendMessage(){const _0x48ae3b=a0_0x12d36c,_0x2f8323=messageInput[_0x48ae3b(0x7e)][_0x48ae3b(0xb6)]();if(!_0x2f8323||isTyping)return;if(tg?.[_0x48ae3b(0xb3)])tg[_0x48ae3b(0xb3)]['impactOccurred'](_0x48ae3b(0xbc));messages[_0x48ae3b(0x94)]({'role':_0x48ae3b(0x91),'content':_0x2f8323,'timestamp':Date[_0x48ae3b(0x9b)]()}),localStorage[_0x48ae3b(0x8f)]('ai_chat_messages',JSON[_0x48ae3b(0xef)](messages)),renderMessages(),messageInput[_0x48ae3b(0x7e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x48ae3b(0xed)](createTypingIndicator()),chatArea[_0x48ae3b(0x79)]=chatArea[_0x48ae3b(0xf1)];const _0x50962d=await callBackend('send_message',{'message':_0x2f8323});isTyping=![];const _0x531d17=document[_0x48ae3b(0x7c)](_0x48ae3b(0xc3));if(_0x531d17)_0x531d17[_0x48ae3b(0x80)]();let _0x2bedaf='Ошибка\x20сети';if(_0x50962d['success']){_0x2bedaf=_0x50962d[_0x48ae3b(0x9c)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg[_0x48ae3b(0xb3)]['notificationOccurred'](_0x48ae3b(0xcc));}else{_0x2bedaf=_0x50962d['error']||'Ошибка\x20сервера';if(tg?.[_0x48ae3b(0xb3)])tg[_0x48ae3b(0xb3)]['notificationOccurred']('error');}messages['push']({'role':'ai','content':_0x2bedaf,'timestamp':Date[_0x48ae3b(0x9b)]()}),localStorage[_0x48ae3b(0x8f)](_0x48ae3b(0xa1),JSON['stringify'](messages)),renderMessages();}function a0_0x440f(_0x187300,_0x1212c2){_0x187300=_0x187300-0x77;const _0x1f7e4d=a0_0x2cf6();let _0x1c32b5=_0x1f7e4d[_0x187300];return _0x1c32b5;}function confirmDelete(_0x328d6c){const _0x7cbe54=a0_0x12d36c;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x7cbe54(0xcf)]=_0x7cbe54(0xe7);modalCallback=()=>{const _0x5a6a8c=_0x7cbe54;messages[_0x5a6a8c(0xc7)](_0x328d6c,0x1),localStorage[_0x5a6a8c(0x8f)](_0x5a6a8c(0xa1),JSON['stringify'](messages)),renderMessages();},modal[_0x7cbe54(0xad)][_0x7cbe54(0x97)](_0x7cbe54(0xac));}if(clearBtn)clearBtn[a0_0x12d36c(0xde)]=()=>{const _0xcb3e0=a0_0x12d36c;if(!messages[_0xcb3e0(0xd0)])return;if(mTitle)mTitle['textContent']=_0xcb3e0(0xee);if(mText)mText[_0xcb3e0(0xcf)]=_0xcb3e0(0x7d);modalCallback=async()=>{const _0x25c860=_0xcb3e0;messages=[],localStorage['removeItem'](_0x25c860(0xa1)),renderMessages(),callBackend(_0x25c860(0xc1),{});},modal[_0xcb3e0(0xad)][_0xcb3e0(0x97)](_0xcb3e0(0xac));};function a0_0x2cf6(){const _0x59e181=['apply','scrollHeight','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','inputArea','(((.+)+)+)+$','message-bubble','scrollTop','chatArea','stopPropagation','getElementById','Начнется\x20новый\x20диалог.','value','touchstart','remove','touchend','show-delete','role','setHeaderColor','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','WebApp','2073876ZSewkS','onClick','message-time','delete-btn','padStart','none','forEach','search','setItem','initData','user','className','username','push','.message.show-delete','disabled','add','.container','./router.html','text/plain','now','text','createElement','flex','json','shiftKey','ai_chat_messages','emptyState','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','preventDefault','innerHTML','children','1352757BwahSb','first_name','messageInput','1898860MvPKPt','random','show','classList','5POyKjW','resize','keydown','offsetHeight','13491108CThMJR','HapticFeedback','min','isVersionAtLeast','trim','2839924NIzwcv','getHours','640353GDdxSc','function','querySelector','light','POST','replace','6.1','target','clear_history','href','typingIndicator','content','constructor','from','splice','impactOccurred','input','toString','div','success','timestamp','display','textContent','length','TG\x20setup\x20error:','42tFTcKL','message\x20ai','getItem','ready','5321592vjcDLO','key','auto','debug_uid','offClick','querySelectorAll','focus','signal','onclick','disableVerticalSwipes','#050505','height','viewportHeight','warn','innerHeight','style','getMinutes','Действие\x20необратимо.','modalCancel','modalText','confirmModal','contains','addEventListener','appendChild','Очистить\x20историю?','stringify'];a0_0x2cf6=function(){return _0x59e181;};return a0_0x2cf6();}document['getElementById'](a0_0x12d36c(0xe8))[a0_0x12d36c(0xde)]=()=>modal[a0_0x12d36c(0xad)][a0_0x12d36c(0x80)]('show'),document['getElementById']('modalConfirm')['onclick']=()=>{const _0x133792=a0_0x12d36c;if(modalCallback)modalCallback();modal['classList'][_0x133792(0x80)]('show');},messageInput[a0_0x12d36c(0xec)](a0_0x12d36c(0xc9),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x12d36c(0xec)](a0_0x12d36c(0xb0),_0x52ed38=>{const _0x583e5e=a0_0x12d36c;_0x52ed38[_0x583e5e(0xd7)]==='Enter'&&!_0x52ed38[_0x583e5e(0xa0)]&&(_0x52ed38[_0x583e5e(0xa4)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x12d36c(0xec)]('click',_0x122122=>{const _0x3a276d=a0_0x12d36c;document[_0x3a276d(0xdb)](_0x3a276d(0x95))['forEach'](_0x163cf0=>{const _0x5da3f2=_0x3a276d;if(!_0x163cf0[_0x5da3f2(0xeb)](_0x122122[_0x5da3f2(0xc0)]))_0x163cf0['classList'][_0x5da3f2(0x80)](_0x5da3f2(0x82));});});const saved=localStorage[a0_0x12d36c(0xd4)](a0_0x12d36c(0xa1));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x3a1b52){}updateSendButton();