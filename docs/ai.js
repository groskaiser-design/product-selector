const a0_0x138afd=a0_0x3c39;(function(_0x1a9cfe,_0x5abcae){const _0x5d3537=a0_0x3c39,_0x2bff66=_0x1a9cfe();while(!![]){try{const _0x41e188=parseInt(_0x5d3537(0x162))/0x1*(-parseInt(_0x5d3537(0x170))/0x2)+parseInt(_0x5d3537(0x1bf))/0x3+parseInt(_0x5d3537(0x191))/0x4+-parseInt(_0x5d3537(0x1c3))/0x5+-parseInt(_0x5d3537(0x15f))/0x6*(-parseInt(_0x5d3537(0x1aa))/0x7)+parseInt(_0x5d3537(0x196))/0x8+-parseInt(_0x5d3537(0x1ac))/0x9*(parseInt(_0x5d3537(0x166))/0xa);if(_0x41e188===_0x5abcae)break;else _0x2bff66['push'](_0x2bff66['shift']());}catch(_0x1ad5ba){_0x2bff66['push'](_0x2bff66['shift']());}}}(a0_0x18b9,0x589e3));const tg=window[a0_0x138afd(0x1cb)]?.[a0_0x138afd(0x1a5)],HOME_URL=a0_0x138afd(0x17d);function setupTelegramBackButton(){const _0x3c5f4f=a0_0x138afd;if(!tg)return;try{tg[_0x3c5f4f(0x1a9)](),tg[_0x3c5f4f(0x1a2)](),tg[_0x3c5f4f(0x183)]?.(_0x3c5f4f(0x198));if(tg[_0x3c5f4f(0x18d)]?.(_0x3c5f4f(0x182)))tg[_0x3c5f4f(0x1b4)]?.();const _0x1e8012=tg['BackButton'];if(_0x1e8012){_0x1e8012[_0x3c5f4f(0x14d)]();if(typeof _0x1e8012[_0x3c5f4f(0x18e)]==='function')try{_0x1e8012[_0x3c5f4f(0x18e)]();}catch(_0x2355f9){}_0x1e8012[_0x3c5f4f(0x1c9)](()=>{const _0x3245e0=_0x3c5f4f;if(tg[_0x3245e0(0x1bb)])tg['HapticFeedback'][_0x3245e0(0x190)](_0x3245e0(0x18a));location[_0x3245e0(0x168)]=HOME_URL;});}}catch(_0x1912f){console[_0x3c5f4f(0x172)](_0x3c5f4f(0x1c4),_0x1912f);}}(function initStableLayout(){const _0x36ff0b=a0_0x138afd,_0x3b5657=(function(){let _0x56c921=!![];return function(_0x3825f1,_0x58b022){const _0x588d92=_0x56c921?function(){const _0x555491=a0_0x3c39;if(_0x58b022){const _0xd5bfd4=_0x58b022[_0x555491(0x1ab)](_0x3825f1,arguments);return _0x58b022=null,_0xd5bfd4;}}:function(){};return _0x56c921=![],_0x588d92;};}()),_0x26fcd0=document[_0x36ff0b(0x1ca)](_0x36ff0b(0x148)),_0x23dbbc=document[_0x36ff0b(0x150)](_0x36ff0b(0x14a)),_0x7512b1=document[_0x36ff0b(0x150)](_0x36ff0b(0x19b)),_0x1b3ce7=document[_0x36ff0b(0x150)](_0x36ff0b(0x1b1));function _0x19d28f(){const _0x3e3d29=_0x36ff0b,_0x34b94d=_0x3b5657(this,function(){const _0x5e4c2f=a0_0x3c39;return _0x34b94d['toString']()[_0x5e4c2f(0x1ae)]('(((.+)+)+)+$')['toString']()['constructor'](_0x34b94d)[_0x5e4c2f(0x1ae)](_0x5e4c2f(0x1af));});_0x34b94d();if(!_0x26fcd0)return;const _0x22a584=tg&&tg[_0x3e3d29(0x15d)]?tg[_0x3e3d29(0x15d)]:window['innerHeight'];_0x26fcd0['style']['height']=_0x22a584+'px';if(_0x23dbbc){const _0x40ca30=_0x23dbbc[_0x3e3d29(0x177)];_0x7512b1['style'][_0x3e3d29(0x1b7)]=_0x40ca30+0x28+'px';}}tg?tg[_0x36ff0b(0x19e)](_0x36ff0b(0x197),({isStateStable:_0x5277a0})=>{_0x19d28f();if(_0x5277a0)requestAnimationFrame(()=>{const _0x4a41fe=a0_0x3c39;_0x7512b1['scrollTop']=_0x7512b1[_0x4a41fe(0x186)];});}):window[_0x36ff0b(0x149)](_0x36ff0b(0x18b),_0x19d28f),_0x19d28f(),_0x1b3ce7&&(_0x1b3ce7['addEventListener'](_0x36ff0b(0x194),()=>{requestAnimationFrame(_0x19d28f);}),_0x1b3ce7[_0x36ff0b(0x149)](_0x36ff0b(0x167),()=>{setTimeout(()=>{const _0x5a8635=a0_0x3c39;_0x7512b1[_0x5a8635(0x1c0)]=_0x7512b1[_0x5a8635(0x186)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x138afd(0x150)](a0_0x138afd(0x19b)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x138afd(0x150)](a0_0x138afd(0x1b1)),sendBtn=document[a0_0x138afd(0x150)](a0_0x138afd(0x1b3)),clearBtn=document[a0_0x138afd(0x150)](a0_0x138afd(0x153)),modal=document[a0_0x138afd(0x150)](a0_0x138afd(0x151)),mTitle=document['getElementById'](a0_0x138afd(0x15a)),mText=document[a0_0x138afd(0x150)](a0_0x138afd(0x192));let modalCallback=null;async function callBackend(_0x1c2a7d,_0x411d91){const _0x129a5f=a0_0x138afd,_0xaa3494=tg?.[_0x129a5f(0x1cc)]?.[_0x129a5f(0x1bd)]||{},_0xdb8611=_0xaa3494['id']||localStorage[_0x129a5f(0x18c)](_0x129a5f(0x15c))||'d-'+Math[_0x129a5f(0x16c)](Math[_0x129a5f(0x1a4)]()*0x3b9aca00);if(!_0xaa3494['id'])localStorage[_0x129a5f(0x14c)](_0x129a5f(0x15c),_0xdb8611);const _0x1b20bf={'action':_0x1c2a7d,'user_id':_0xdb8611,'user_data':{'first_name':_0xaa3494[_0x129a5f(0x1b5)],'username':_0xaa3494[_0x129a5f(0x1ad)]},'init_data':tg?.[_0x129a5f(0x17c)]||'',..._0x411d91},_0xfdce6b=new AbortController(),_0x3825b8=setTimeout(()=>_0xfdce6b['abort'](),REQUEST_TIMEOUT_MS);try{const _0x6d41db=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x129a5f(0x19d)},'body':JSON[_0x129a5f(0x16f)](_0x1b20bf),'signal':_0xfdce6b['signal']});return clearTimeout(_0x3825b8),await _0x6d41db['json']();}catch(_0xdf8d49){return{'success':![],'error':String(_0xdf8d49)};}}function formatTime(_0x550b84){const _0x5e3b3f=a0_0x138afd,_0x2249e4=new Date(_0x550b84);return String(_0x2249e4['getHours']())[_0x5e3b3f(0x1a3)](0x2,'0')+':'+String(_0x2249e4[_0x5e3b3f(0x176)]())[_0x5e3b3f(0x1a3)](0x2,'0');}function createMessageElement(_0x37e93d,_0x2c4a72){const _0x5ec66b=a0_0x138afd,_0x4437b6=document['createElement'](_0x5ec66b(0x156));_0x4437b6[_0x5ec66b(0x178)]=_0x5ec66b(0x1ba)+_0x37e93d[_0x5ec66b(0x199)];const _0x2748d5=document[_0x5ec66b(0x173)](_0x5ec66b(0x156));_0x2748d5[_0x5ec66b(0x178)]=_0x5ec66b(0x1c8),_0x2748d5[_0x5ec66b(0x164)]=_0x37e93d[_0x5ec66b(0x1bc)]['replace'](/\n/g,_0x5ec66b(0x195));const _0x4a2baa=document[_0x5ec66b(0x173)]('div');_0x4a2baa[_0x5ec66b(0x178)]=_0x5ec66b(0x160),_0x4a2baa[_0x5ec66b(0x164)]=_0x5ec66b(0x14f),_0x4a2baa[_0x5ec66b(0x155)]=_0x11b216=>{const _0x5a6144=_0x5ec66b;_0x11b216[_0x5a6144(0x19a)](),confirmDelete(_0x2c4a72);};let _0x5b3ccd;_0x2748d5['addEventListener'](_0x5ec66b(0x14b),()=>_0x5b3ccd=setTimeout(()=>{const _0x51dee3=_0x5ec66b;_0x4437b6['classList'][_0x51dee3(0x1b9)]('show-delete');if(tg?.['HapticFeedback'])tg['HapticFeedback']['impactOccurred'](_0x51dee3(0x179));},0x1f4)),_0x2748d5[_0x5ec66b(0x149)](_0x5ec66b(0x17e),()=>clearTimeout(_0x5b3ccd));const _0xca5591=document[_0x5ec66b(0x173)]('div');return _0xca5591[_0x5ec66b(0x178)]=_0x5ec66b(0x1a7),_0xca5591[_0x5ec66b(0x157)]=formatTime(_0x37e93d[_0x5ec66b(0x174)]),_0x4437b6['appendChild'](_0x4a2baa),_0x4437b6['appendChild'](_0x2748d5),_0x4437b6['appendChild'](_0xca5591),_0x4437b6;}function createTypingIndicator(){const _0x5bf813=a0_0x138afd,_0x88b53b=document[_0x5bf813(0x173)](_0x5bf813(0x156));return _0x88b53b['className']='message\x20ai',_0x88b53b['id']=_0x5bf813(0x1b0),_0x88b53b[_0x5bf813(0x164)]=_0x5bf813(0x189),_0x88b53b;}function a0_0x3c39(_0x19b3a4,_0x375e15){_0x19b3a4=_0x19b3a4-0x148;const _0x16809b=a0_0x18b9();let _0xb8497d=_0x16809b[_0x19b3a4];return _0xb8497d;}function renderMessages(){const _0x44b690=a0_0x138afd;Array[_0x44b690(0x1a8)](chatArea['children'])[_0x44b690(0x181)](_0x2c942a=>{const _0x22f0e3=_0x44b690;if(_0x2c942a['id']!==_0x22f0e3(0x1c7))_0x2c942a[_0x22f0e3(0x175)]();}),messages[_0x44b690(0x1c1)]>0x0?(emptyState[_0x44b690(0x17f)][_0x44b690(0x187)]=_0x44b690(0x17a),messages[_0x44b690(0x181)]((_0x5b2351,_0xd040e4)=>chatArea[_0x44b690(0x1c5)](createMessageElement(_0x5b2351,_0xd040e4)))):emptyState['style'][_0x44b690(0x187)]=_0x44b690(0x1b2),requestAnimationFrame(()=>chatArea[_0x44b690(0x1c0)]=chatArea[_0x44b690(0x186)]);}function autoResizeTextarea(){const _0xf176c7=a0_0x138afd;messageInput[_0xf176c7(0x17f)][_0xf176c7(0x17b)]=_0xf176c7(0x1c6),messageInput[_0xf176c7(0x17f)]['height']=Math[_0xf176c7(0x193)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x48ed16=a0_0x138afd,_0x39455d=messageInput[_0x48ed16(0x15b)]['trim']();sendBtn[_0x48ed16(0x161)]=!_0x39455d||isTyping;}async function sendMessage(){const _0x4b1400=a0_0x138afd,_0x28cd9b=messageInput['value'][_0x4b1400(0x16d)]();if(!_0x28cd9b||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x4b1400(0x1bb)][_0x4b1400(0x190)](_0x4b1400(0x18a));messages[_0x4b1400(0x184)]({'role':'user','content':_0x28cd9b,'timestamp':Date[_0x4b1400(0x1a1)]()}),localStorage[_0x4b1400(0x14c)]('ai_chat_messages',JSON[_0x4b1400(0x16f)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4b1400(0x1c5)](createTypingIndicator()),chatArea[_0x4b1400(0x1c0)]=chatArea[_0x4b1400(0x186)];const _0x5d9856=await callBackend(_0x4b1400(0x1be),{'message':_0x28cd9b});isTyping=![];const _0xe69e05=document['getElementById'](_0x4b1400(0x1b0));if(_0xe69e05)_0xe69e05[_0x4b1400(0x175)]();let _0x53cff0='Ошибка\x20сети';if(_0x5d9856[_0x4b1400(0x1a6)]){_0x53cff0=_0x5d9856['text']||_0x4b1400(0x16e);if(tg?.[_0x4b1400(0x1bb)])tg['HapticFeedback'][_0x4b1400(0x1a0)](_0x4b1400(0x1a6));}else{_0x53cff0=_0x5d9856[_0x4b1400(0x19f)]||_0x4b1400(0x152);if(tg?.['HapticFeedback'])tg[_0x4b1400(0x1bb)]['notificationOccurred'](_0x4b1400(0x19f));}messages['push']({'role':'ai','content':_0x53cff0,'timestamp':Date['now']()}),localStorage[_0x4b1400(0x14c)](_0x4b1400(0x14e),JSON[_0x4b1400(0x16f)](messages)),renderMessages();}function confirmDelete(_0x59dee0){const _0x4e31af=a0_0x138afd;if(mTitle)mTitle['textContent']=_0x4e31af(0x165);if(mText)mText[_0x4e31af(0x157)]='Действие\x20необратимо.';modalCallback=()=>{const _0x3e71fd=_0x4e31af;messages[_0x3e71fd(0x16a)](_0x59dee0,0x1),localStorage['setItem'](_0x3e71fd(0x14e),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x4e31af(0x1b9)](_0x4e31af(0x14d));}if(clearBtn)clearBtn[a0_0x138afd(0x155)]=()=>{const _0x18d8d3=a0_0x138afd;if(!messages[_0x18d8d3(0x1c1)])return;if(mTitle)mTitle[_0x18d8d3(0x157)]='Очистить\x20историю?';if(mText)mText[_0x18d8d3(0x157)]=_0x18d8d3(0x185);modalCallback=async()=>{const _0x340b91=_0x18d8d3;messages=[],localStorage[_0x340b91(0x19c)](_0x340b91(0x14e)),renderMessages(),callBackend(_0x340b91(0x180),{});},modal['classList'][_0x18d8d3(0x1b9)](_0x18d8d3(0x14d));};document['getElementById']('modalCancel')['onclick']=()=>modal['classList'][a0_0x138afd(0x175)]('show'),document[a0_0x138afd(0x150)](a0_0x138afd(0x154))[a0_0x138afd(0x155)]=()=>{const _0x113757=a0_0x138afd;if(modalCallback)modalCallback();modal[_0x113757(0x16b)]['remove'](_0x113757(0x14d));},messageInput[a0_0x138afd(0x149)](a0_0x138afd(0x194),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x138afd(0x149)](a0_0x138afd(0x188),_0x48511c=>{const _0x5acebe=a0_0x138afd;_0x48511c[_0x5acebe(0x158)]==='Enter'&&!_0x48511c[_0x5acebe(0x18f)]&&(_0x48511c[_0x5acebe(0x169)](),sendMessage());}),sendBtn[a0_0x138afd(0x155)]=sendMessage,document[a0_0x138afd(0x149)](a0_0x138afd(0x15e),_0x462f07=>{const _0x278e4f=a0_0x138afd;document[_0x278e4f(0x1b6)](_0x278e4f(0x1c2))['forEach'](_0xeb5173=>{const _0xd62792=_0x278e4f;if(!_0xeb5173[_0xd62792(0x171)](_0x462f07[_0xd62792(0x1b8)]))_0xeb5173['classList'][_0xd62792(0x175)](_0xd62792(0x163));});});const saved=localStorage[a0_0x138afd(0x18c)](a0_0x138afd(0x14e));if(saved)try{messages=JSON[a0_0x138afd(0x159)](saved),renderMessages();}catch(a0_0x3d8a0b){}updateSendButton();function a0_0x18b9(){const _0x491639=['padStart','random','WebApp','success','message-time','from','ready','7QSdDgI','apply','9KtucPk','username','search','(((.+)+)+)+$','typingIndicator','messageInput','flex','sendBtn','disableVerticalSwipes','first_name','querySelectorAll','paddingBottom','target','add','message\x20','HapticFeedback','content','user','send_message','1851327VqkycA','scrollTop','length','.message.show-delete','881555cTUrLA','TG\x20setup\x20error:','appendChild','auto','emptyState','message-bubble','onClick','querySelector','Telegram','initDataUnsafe','.container','addEventListener','inputArea','touchstart','setItem','show','ai_chat_messages','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','getElementById','confirmModal','Ошибка\x20сервера','clearBtn','modalConfirm','onclick','div','textContent','key','parse','modalTitle','value','debug_uid','viewportHeight','click','378426GfzOXT','delete-btn','disabled','13HFQfTx','show-delete','innerHTML','Удалить?','2915390wmqNGM','focus','href','preventDefault','splice','classList','floor','trim','Пустой\x20ответ','stringify','69302pWXlIF','contains','warn','createElement','timestamp','remove','getMinutes','offsetHeight','className','medium','none','height','initData','./router.html','touchend','style','clear_history','forEach','6.1','setHeaderColor','push','Начнется\x20новый\x20диалог.','scrollHeight','display','keydown','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','light','resize','getItem','isVersionAtLeast','offClick','shiftKey','impactOccurred','1405264fPQCRs','modalText','min','input','<br>','1998368nnQaTh','viewportChanged','#050505','role','stopPropagation','chatArea','removeItem','text/plain','onEvent','error','notificationOccurred','now','expand'];a0_0x18b9=function(){return _0x491639;};return a0_0x18b9();}