const a0_0x34a638=a0_0x41d9;(function(_0x9b8f6,_0xb96d23){const _0x3cad2e=a0_0x41d9,_0x2cee0a=_0x9b8f6();while(!![]){try{const _0xefb098=-parseInt(_0x3cad2e(0x15d))/0x1*(parseInt(_0x3cad2e(0x163))/0x2)+parseInt(_0x3cad2e(0x178))/0x3+parseInt(_0x3cad2e(0x133))/0x4*(-parseInt(_0x3cad2e(0x137))/0x5)+-parseInt(_0x3cad2e(0x154))/0x6*(parseInt(_0x3cad2e(0x12c))/0x7)+parseInt(_0x3cad2e(0x113))/0x8*(parseInt(_0x3cad2e(0x17d))/0x9)+-parseInt(_0x3cad2e(0x14d))/0xa*(-parseInt(_0x3cad2e(0x172))/0xb)+-parseInt(_0x3cad2e(0x118))/0xc*(-parseInt(_0x3cad2e(0x126))/0xd);if(_0xefb098===_0xb96d23)break;else _0x2cee0a['push'](_0x2cee0a['shift']());}catch(_0x289253){_0x2cee0a['push'](_0x2cee0a['shift']());}}}(a0_0x484b,0x22483));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x34a638(0x189);function setupTelegramBackButton(){const _0x4b6b37=a0_0x34a638;if(!tg)return;try{tg[_0x4b6b37(0x134)](),tg[_0x4b6b37(0x179)](),tg[_0x4b6b37(0x147)]?.(_0x4b6b37(0x10f));if(tg['isVersionAtLeast']?.('6.1'))tg[_0x4b6b37(0x13b)]?.();const _0x192d27=tg[_0x4b6b37(0x110)];if(_0x192d27){_0x192d27[_0x4b6b37(0x146)]();if(typeof _0x192d27[_0x4b6b37(0x181)]==='function')try{_0x192d27[_0x4b6b37(0x181)]();}catch(_0x12bda7){}_0x192d27[_0x4b6b37(0x121)](()=>{const _0x181358=_0x4b6b37;if(tg['HapticFeedback'])tg[_0x181358(0x17b)]['impactOccurred'](_0x181358(0x13f));location[_0x181358(0x14f)]=HOME_URL;});}}catch(_0x281d60){console['warn']('TG\x20setup\x20error:',_0x281d60);}}(function initStableLayout(){const _0x4858bd=a0_0x34a638,_0x46bc2e=(function(){let _0x32e072=!![];return function(_0x38cd58,_0x16e729){const _0x465677=_0x32e072?function(){const _0x420270=a0_0x41d9;if(_0x16e729){const _0x1abdf9=_0x16e729[_0x420270(0x13d)](_0x38cd58,arguments);return _0x16e729=null,_0x1abdf9;}}:function(){};return _0x32e072=![],_0x465677;};}()),_0x1c1f7f=document[_0x4858bd(0x186)]('.container'),_0x45c075=document[_0x4858bd(0x14e)](_0x4858bd(0x153)),_0x4ae07d=document['getElementById'](_0x4858bd(0x18b)),_0x39255f=document[_0x4858bd(0x14e)](_0x4858bd(0x109));function _0x3b6aa6(){const _0x66022c=_0x4858bd,_0x1518ce=_0x46bc2e(this,function(){const _0x1d8944=a0_0x41d9;return _0x1518ce[_0x1d8944(0x17f)]()[_0x1d8944(0x13a)]('(((.+)+)+)+$')[_0x1d8944(0x17f)]()[_0x1d8944(0x185)](_0x1518ce)['search'](_0x1d8944(0x161));});_0x1518ce();if(!_0x1c1f7f)return;const _0x439f76=tg&&tg[_0x66022c(0x184)]?tg['viewportHeight']:window[_0x66022c(0x156)];_0x1c1f7f[_0x66022c(0x17e)]['height']=_0x439f76+'px';if(_0x45c075){const _0x5eb30e=_0x45c075[_0x66022c(0x148)];_0x4ae07d[_0x66022c(0x17e)][_0x66022c(0x16d)]=_0x5eb30e+0x28+'px';}}tg?tg[_0x4858bd(0x12d)]('viewportChanged',({isStateStable:_0x386614})=>{_0x3b6aa6();if(_0x386614)requestAnimationFrame(()=>{const _0x4a23f2=a0_0x41d9;_0x4ae07d[_0x4a23f2(0x180)]=_0x4ae07d['scrollHeight'];});}):window[_0x4858bd(0x16e)](_0x4858bd(0x175),_0x3b6aa6),_0x3b6aa6(),_0x39255f&&(_0x39255f[_0x4858bd(0x16e)](_0x4858bd(0x15b),()=>{requestAnimationFrame(_0x3b6aa6);}),_0x39255f['addEventListener'](_0x4858bd(0x15e),()=>{setTimeout(()=>{const _0x1a1eba=a0_0x41d9;_0x4ae07d[_0x1a1eba(0x180)]=_0x4ae07d[_0x1a1eba(0x169)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x34a638(0x171),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x34a638(0x18b)),emptyState=document[a0_0x34a638(0x14e)]('emptyState'),messageInput=document[a0_0x34a638(0x14e)](a0_0x34a638(0x109)),sendBtn=document['getElementById'](a0_0x34a638(0x130)),clearBtn=document[a0_0x34a638(0x14e)](a0_0x34a638(0x136)),modal=document[a0_0x34a638(0x14e)](a0_0x34a638(0x108)),mTitle=document[a0_0x34a638(0x14e)](a0_0x34a638(0x13c)),mText=document['getElementById'](a0_0x34a638(0x10d));let modalCallback=null;function a0_0x484b(){const _0x2696a1=['138IxCtnp','keydown','replace','POST','Enter','createElement','scrollHeight','<br>','stopPropagation','touchstart','paddingBottom','addEventListener','role','padStart','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','2764322ymZali','key','value','resize','modalCancel','success','260031farxZL','expand','target','HapticFeedback','shiftKey','9IuJGMY','style','toString','scrollTop','offClick','setItem','min','viewportHeight','constructor','querySelector','classList','disabled','./router.html','innerHTML','chatArea','getMinutes','confirmModal','messageInput','error','message\x20ai','initData','modalText','parse','#050505','BackButton','height','auto','1217192AgoDYa','Начнется\x20новый\x20диалог.','abort','display','onclick','13044nWQrkk','json','getHours','className','forEach','impactOccurred','Удалить?','emptyState','content','onClick','message-time','length','.message.show-delete','username','260dPwMLz','textContent','trim','stringify','signal','remove','41461pdJpir','onEvent','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','floor','sendBtn','initDataUnsafe','debug_uid','8CEqKur','ready','getItem','clearBtn','364415jhhcUY','push','user','search','disableVerticalSwipes','modalTitle','apply','add','light','send_message','message-bubble','appendChild','click','notificationOccurred','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','show','setHeaderColor','offsetHeight','Пустой\x20ответ','splice','medium','now','10BrFwwp','getElementById','href','touchend','typingIndicator','message\x20','inputArea','84TlOXqz','div','innerHeight','removeItem','clear_history','Действие\x20необратимо.','none','input','ai_chat_messages','2069rHouSc','focus','Ошибка\x20сервера','text','(((.+)+)+)+$','delete-btn'];a0_0x484b=function(){return _0x2696a1;};return a0_0x484b();}function a0_0x41d9(_0xe22fa7,_0x21f437){_0xe22fa7=_0xe22fa7-0x108;const _0x16b16e=a0_0x484b();let _0x2aab2b=_0x16b16e[_0xe22fa7];return _0x2aab2b;}async function callBackend(_0x55514d,_0xe3f748){const _0x534af1=a0_0x34a638,_0x2e6772=tg?.[_0x534af1(0x131)]?.['user']||{},_0x2c65cb=_0x2e6772['id']||localStorage[_0x534af1(0x135)](_0x534af1(0x132))||'d-'+Math[_0x534af1(0x12f)](Math['random']()*0x3b9aca00);if(!_0x2e6772['id'])localStorage[_0x534af1(0x182)](_0x534af1(0x132),_0x2c65cb);const _0x3fe88a={'action':_0x55514d,'user_id':_0x2c65cb,'user_data':{'first_name':_0x2e6772['first_name'],'username':_0x2e6772[_0x534af1(0x125)]},'init_data':tg?.[_0x534af1(0x10c)]||'',..._0xe3f748},_0x239c86=new AbortController(),_0x54505f=setTimeout(()=>_0x239c86[_0x534af1(0x115)](),REQUEST_TIMEOUT_MS);try{const _0x1dae7e=await fetch(BACKEND_URL,{'method':_0x534af1(0x166),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x3fe88a),'signal':_0x239c86[_0x534af1(0x12a)]});return clearTimeout(_0x54505f),await _0x1dae7e[_0x534af1(0x119)]();}catch(_0x863b43){return{'success':![],'error':String(_0x863b43)};}}function formatTime(_0x4e9fb5){const _0x5b0a61=a0_0x34a638,_0x1f3bf0=new Date(_0x4e9fb5);return String(_0x1f3bf0[_0x5b0a61(0x11a)]())[_0x5b0a61(0x170)](0x2,'0')+':'+String(_0x1f3bf0[_0x5b0a61(0x18c)]())['padStart'](0x2,'0');}function createMessageElement(_0x3d6725,_0x14aa1c){const _0x307383=a0_0x34a638,_0x42b28d=document[_0x307383(0x168)](_0x307383(0x155));_0x42b28d[_0x307383(0x11b)]=_0x307383(0x152)+_0x3d6725[_0x307383(0x16f)];const _0x3285d1=document['createElement'](_0x307383(0x155));_0x3285d1[_0x307383(0x11b)]=_0x307383(0x141),_0x3285d1[_0x307383(0x18a)]=_0x3d6725[_0x307383(0x120)][_0x307383(0x165)](/\n/g,_0x307383(0x16a));const _0xd51baf=document['createElement'](_0x307383(0x155));_0xd51baf[_0x307383(0x11b)]=_0x307383(0x162),_0xd51baf[_0x307383(0x18a)]=_0x307383(0x145),_0xd51baf['onclick']=_0x13517f=>{const _0x1750b3=_0x307383;_0x13517f[_0x1750b3(0x16b)](),confirmDelete(_0x14aa1c);};let _0x4ea8fc;_0x3285d1['addEventListener'](_0x307383(0x16c),()=>_0x4ea8fc=setTimeout(()=>{const _0x367ec2=_0x307383;_0x42b28d[_0x367ec2(0x187)][_0x367ec2(0x13e)]('show-delete');if(tg?.[_0x367ec2(0x17b)])tg[_0x367ec2(0x17b)][_0x367ec2(0x11d)](_0x367ec2(0x14b));},0x1f4)),_0x3285d1[_0x307383(0x16e)](_0x307383(0x150),()=>clearTimeout(_0x4ea8fc));const _0x57f862=document[_0x307383(0x168)](_0x307383(0x155));return _0x57f862[_0x307383(0x11b)]=_0x307383(0x122),_0x57f862[_0x307383(0x127)]=formatTime(_0x3d6725['timestamp']),_0x42b28d['appendChild'](_0xd51baf),_0x42b28d[_0x307383(0x142)](_0x3285d1),_0x42b28d['appendChild'](_0x57f862),_0x42b28d;}function createTypingIndicator(){const _0x33023d=a0_0x34a638,_0x45cc8a=document['createElement'](_0x33023d(0x155));return _0x45cc8a[_0x33023d(0x11b)]=_0x33023d(0x10b),_0x45cc8a['id']=_0x33023d(0x151),_0x45cc8a[_0x33023d(0x18a)]=_0x33023d(0x12e),_0x45cc8a;}function renderMessages(){const _0x80d845=a0_0x34a638;Array['from'](chatArea['children'])[_0x80d845(0x11c)](_0x33ddfc=>{const _0x2cf8f7=_0x80d845;if(_0x33ddfc['id']!==_0x2cf8f7(0x11f))_0x33ddfc[_0x2cf8f7(0x12b)]();}),messages[_0x80d845(0x123)]>0x0?(emptyState['style'][_0x80d845(0x116)]=_0x80d845(0x15a),messages[_0x80d845(0x11c)]((_0x5b5b5f,_0x57c444)=>chatArea[_0x80d845(0x142)](createMessageElement(_0x5b5b5f,_0x57c444)))):emptyState[_0x80d845(0x17e)]['display']='flex',requestAnimationFrame(()=>chatArea[_0x80d845(0x180)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x53ee98=a0_0x34a638;messageInput[_0x53ee98(0x17e)][_0x53ee98(0x111)]=_0x53ee98(0x112),messageInput[_0x53ee98(0x17e)]['height']=Math[_0x53ee98(0x183)](messageInput[_0x53ee98(0x169)],0x78)+'px';}function updateSendButton(){const _0x148977=a0_0x34a638,_0x5bf167=messageInput['value'][_0x148977(0x128)]();sendBtn[_0x148977(0x188)]=!_0x5bf167||isTyping;}async function sendMessage(){const _0xa48831=a0_0x34a638,_0x29de70=messageInput['value'][_0xa48831(0x128)]();if(!_0x29de70||isTyping)return;if(tg?.[_0xa48831(0x17b)])tg[_0xa48831(0x17b)][_0xa48831(0x11d)](_0xa48831(0x13f));messages[_0xa48831(0x138)]({'role':_0xa48831(0x139),'content':_0x29de70,'timestamp':Date[_0xa48831(0x14c)]()}),localStorage[_0xa48831(0x182)](_0xa48831(0x15c),JSON[_0xa48831(0x129)](messages)),renderMessages(),messageInput[_0xa48831(0x174)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0xa48831(0x180)]=chatArea[_0xa48831(0x169)];const _0x1e1dea=await callBackend(_0xa48831(0x140),{'message':_0x29de70});isTyping=![];const _0x259206=document['getElementById']('typingIndicator');if(_0x259206)_0x259206[_0xa48831(0x12b)]();let _0x7ab8ad='Ошибка\x20сети';if(_0x1e1dea[_0xa48831(0x177)]){_0x7ab8ad=_0x1e1dea[_0xa48831(0x160)]||_0xa48831(0x149);if(tg?.[_0xa48831(0x17b)])tg['HapticFeedback']['notificationOccurred']('success');}else{_0x7ab8ad=_0x1e1dea[_0xa48831(0x10a)]||_0xa48831(0x15f);if(tg?.[_0xa48831(0x17b)])tg['HapticFeedback'][_0xa48831(0x144)](_0xa48831(0x10a));}messages[_0xa48831(0x138)]({'role':'ai','content':_0x7ab8ad,'timestamp':Date[_0xa48831(0x14c)]()}),localStorage['setItem'](_0xa48831(0x15c),JSON[_0xa48831(0x129)](messages)),renderMessages();}function confirmDelete(_0x3a594f){const _0x144bd0=a0_0x34a638;if(mTitle)mTitle[_0x144bd0(0x127)]=_0x144bd0(0x11e);if(mText)mText['textContent']=_0x144bd0(0x159);modalCallback=()=>{const _0x5a12fb=_0x144bd0;messages[_0x5a12fb(0x14a)](_0x3a594f,0x1),localStorage[_0x5a12fb(0x182)](_0x5a12fb(0x15c),JSON[_0x5a12fb(0x129)](messages)),renderMessages();},modal[_0x144bd0(0x187)][_0x144bd0(0x13e)](_0x144bd0(0x146));}if(clearBtn)clearBtn[a0_0x34a638(0x117)]=()=>{const _0x1ba16a=a0_0x34a638;if(!messages[_0x1ba16a(0x123)])return;if(mTitle)mTitle[_0x1ba16a(0x127)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x1ba16a(0x114);modalCallback=async()=>{const _0x2a1d6f=_0x1ba16a;messages=[],localStorage[_0x2a1d6f(0x157)](_0x2a1d6f(0x15c)),renderMessages(),callBackend(_0x2a1d6f(0x158),{});},modal[_0x1ba16a(0x187)][_0x1ba16a(0x13e)](_0x1ba16a(0x146));};document[a0_0x34a638(0x14e)](a0_0x34a638(0x176))['onclick']=()=>modal[a0_0x34a638(0x187)][a0_0x34a638(0x12b)]('show'),document[a0_0x34a638(0x14e)]('modalConfirm')['onclick']=()=>{const _0x5c1013=a0_0x34a638;if(modalCallback)modalCallback();modal[_0x5c1013(0x187)]['remove']('show');},messageInput[a0_0x34a638(0x16e)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x34a638(0x16e)](a0_0x34a638(0x164),_0x235cee=>{const _0x39258a=a0_0x34a638;_0x235cee[_0x39258a(0x173)]===_0x39258a(0x167)&&!_0x235cee[_0x39258a(0x17c)]&&(_0x235cee['preventDefault'](),sendMessage());}),sendBtn[a0_0x34a638(0x117)]=sendMessage,document[a0_0x34a638(0x16e)](a0_0x34a638(0x143),_0x2fad83=>{const _0x3588b8=a0_0x34a638;document['querySelectorAll'](_0x3588b8(0x124))[_0x3588b8(0x11c)](_0x2305b8=>{const _0x329236=_0x3588b8;if(!_0x2305b8['contains'](_0x2fad83[_0x329236(0x17a)]))_0x2305b8[_0x329236(0x187)][_0x329236(0x12b)]('show-delete');});});const saved=localStorage['getItem'](a0_0x34a638(0x15c));if(saved)try{messages=JSON[a0_0x34a638(0x10e)](saved),renderMessages();}catch(a0_0x5b0973){}updateSendButton();