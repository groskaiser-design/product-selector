const a0_0x3bfb8c=a0_0x1705;(function(_0x5e0bd5,_0x27a5d9){const _0x50e0d6=a0_0x1705,_0x4f679f=_0x5e0bd5();while(!![]){try{const _0x4281a0=parseInt(_0x50e0d6(0x18e))/0x1+-parseInt(_0x50e0d6(0x1bc))/0x2+parseInt(_0x50e0d6(0x1b1))/0x3+parseInt(_0x50e0d6(0x16d))/0x4*(-parseInt(_0x50e0d6(0x1ca))/0x5)+parseInt(_0x50e0d6(0x1dd))/0x6*(parseInt(_0x50e0d6(0x1d4))/0x7)+parseInt(_0x50e0d6(0x17c))/0x8*(-parseInt(_0x50e0d6(0x1b4))/0x9)+parseInt(_0x50e0d6(0x188))/0xa;if(_0x4281a0===_0x27a5d9)break;else _0x4f679f['push'](_0x4f679f['shift']());}catch(_0x377870){_0x4f679f['push'](_0x4f679f['shift']());}}}(a0_0x5fa5,0x74346));const tg=window[a0_0x3bfb8c(0x177)]?.[a0_0x3bfb8c(0x19f)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x38a140=a0_0x3bfb8c,_0x202145=(function(){let _0x5258ef=!![];return function(_0x5b5fad,_0x50913a){const _0x10e38e=_0x5258ef?function(){const _0x30bddb=a0_0x1705;if(_0x50913a){const _0x48732d=_0x50913a[_0x30bddb(0x1ea)](_0x5b5fad,arguments);return _0x50913a=null,_0x48732d;}}:function(){};return _0x5258ef=![],_0x10e38e;};}()),_0x319427=_0x202145(this,function(){const _0x29d396=a0_0x1705;return _0x319427[_0x29d396(0x1be)]()[_0x29d396(0x1d1)](_0x29d396(0x1a8))[_0x29d396(0x1be)]()[_0x29d396(0x17d)](_0x319427)[_0x29d396(0x1d1)]('(((.+)+)+)+$');});_0x319427();if(!tg)return;try{tg[_0x38a140(0x186)](),tg[_0x38a140(0x176)](),tg[_0x38a140(0x1b8)]?.(_0x38a140(0x187));if(tg[_0x38a140(0x1e1)]?.(_0x38a140(0x190)))tg[_0x38a140(0x1cf)]?.();const _0x160082=tg[_0x38a140(0x1df)];if(_0x160082){_0x160082[_0x38a140(0x1c0)]();if(typeof _0x160082[_0x38a140(0x1a0)]===_0x38a140(0x17a))try{_0x160082[_0x38a140(0x1a0)]();}catch(_0xeded74){}_0x160082['onClick'](()=>{const _0x3cd79d=_0x38a140;if(tg['HapticFeedback'])tg['HapticFeedback'][_0x3cd79d(0x17f)](_0x3cd79d(0x18f));location[_0x3cd79d(0x1b6)]=HOME_URL;});}}catch(_0x1de97c){console[_0x38a140(0x1a9)](_0x38a140(0x1d9),_0x1de97c);}}function a0_0x5fa5(){const _0xc8743e=['createElement','1918gntECW','message-time','div','contains','POST','TG\x20setup\x20error:','children','send_message','debug_uid','17418sbRXcr','touchstart','BackButton','padStart','isVersionAtLeast','setItem','<br>','display','getElementById','style','.container','Ошибка\x20сети','.message.show-delete','apply','abort','messageInput','notificationOccurred','height','Пустой\x20ответ','chatArea','92msELbu','error','classList','inputArea','user','trim','stringify','textContent','floor','expand','Telegram','push','length','function','show-delete','412752hAuKEm','constructor','splice','impactOccurred','scrollHeight','success','modalText','clear_history','keydown','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','ready','#050505','16550920OKVBgi','value','typingIndicator','ai_chat_messages','getMinutes','clearBtn','117196emWwiF','light','6.1','emptyState','message\x20','touchend','HapticFeedback','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','forEach','flex','focus','content','innerHTML','sendBtn','json','initDataUnsafe','username','WebApp','offClick','message-bubble','addEventListener','initData','onEvent','now','paddingBottom','key','(((.+)+)+)+$','warn','modalConfirm','remove','none','replace','getHours','scrollTop','timestamp','1334379FdUIAb','parse','viewportChanged','153ZPfgFv','modalCancel','href','appendChild','setHeaderColor','Enter','input','role','1863836zXoYMw','first_name','toString','querySelector','show','Начнется\x20новый\x20диалог.','auto','Ошибка\x20сервера','viewportHeight','onclick','disabled','from','text','offsetHeight','158155Xelqif','stopPropagation','random','add','message\x20ai','disableVerticalSwipes','getItem','search','className'];a0_0x5fa5=function(){return _0xc8743e;};return a0_0x5fa5();}(function initStableLayout(){const _0x26f0f1=a0_0x3bfb8c,_0x279a72=document[_0x26f0f1(0x1bf)](_0x26f0f1(0x1e7)),_0x5b2fb1=document[_0x26f0f1(0x1e5)](_0x26f0f1(0x170)),_0x23b623=document['getElementById'](_0x26f0f1(0x16c)),_0x5b03d2=document[_0x26f0f1(0x1e5)](_0x26f0f1(0x1ec));function _0x16b571(){const _0x460d27=_0x26f0f1;if(!_0x279a72)return;const _0x28233a=tg&&tg[_0x460d27(0x1c4)]?tg[_0x460d27(0x1c4)]:window['innerHeight'];_0x279a72[_0x460d27(0x1e6)][_0x460d27(0x16a)]=_0x28233a+'px';if(_0x5b2fb1){const _0x15cb34=_0x5b2fb1[_0x460d27(0x1c9)];_0x23b623[_0x460d27(0x1e6)][_0x460d27(0x1a6)]=_0x15cb34+0x28+'px';}}tg?tg[_0x26f0f1(0x1a4)](_0x26f0f1(0x1b3),({isStateStable:_0x364fb6})=>{_0x16b571();if(_0x364fb6)requestAnimationFrame(()=>{const _0x5597cf=a0_0x1705;_0x23b623[_0x5597cf(0x1af)]=_0x23b623[_0x5597cf(0x180)];});}):window[_0x26f0f1(0x1a2)]('resize',_0x16b571),_0x16b571(),_0x5b03d2&&(_0x5b03d2[_0x26f0f1(0x1a2)](_0x26f0f1(0x1ba),()=>{requestAnimationFrame(_0x16b571);}),_0x5b03d2[_0x26f0f1(0x1a2)](_0x26f0f1(0x198),()=>{setTimeout(()=>{const _0x4c5bd8=a0_0x1705;_0x23b623['scrollTop']=_0x23b623[_0x4c5bd8(0x180)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x1705(_0x8f96bf,_0x369013){_0x8f96bf=_0x8f96bf-0x16a;const _0x439dc3=a0_0x5fa5();let _0x148093=_0x439dc3[_0x8f96bf];return _0x148093;}const BACKEND_URL=a0_0x3bfb8c(0x185),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x3bfb8c(0x16c)),emptyState=document['getElementById'](a0_0x3bfb8c(0x191)),messageInput=document['getElementById'](a0_0x3bfb8c(0x1ec)),sendBtn=document[a0_0x3bfb8c(0x1e5)](a0_0x3bfb8c(0x19b)),clearBtn=document[a0_0x3bfb8c(0x1e5)](a0_0x3bfb8c(0x18d)),modal=document[a0_0x3bfb8c(0x1e5)]('confirmModal'),mTitle=document[a0_0x3bfb8c(0x1e5)]('modalTitle'),mText=document[a0_0x3bfb8c(0x1e5)](a0_0x3bfb8c(0x182));let modalCallback=null;async function callBackend(_0x4e33ef,_0x35afe8){const _0x16e90c=a0_0x3bfb8c,_0x19d42c=tg?.[_0x16e90c(0x19d)]?.[_0x16e90c(0x171)]||{},_0x1a1c48=_0x19d42c['id']||localStorage[_0x16e90c(0x1d0)](_0x16e90c(0x1dc))||'d-'+Math[_0x16e90c(0x175)](Math[_0x16e90c(0x1cc)]()*0x3b9aca00);if(!_0x19d42c['id'])localStorage[_0x16e90c(0x1e2)](_0x16e90c(0x1dc),_0x1a1c48);const _0xb77df7={'action':_0x4e33ef,'user_id':_0x1a1c48,'user_data':{'first_name':_0x19d42c[_0x16e90c(0x1bd)],'username':_0x19d42c[_0x16e90c(0x19e)]},'init_data':tg?.[_0x16e90c(0x1a3)]||'',..._0x35afe8},_0x7057b0=new AbortController(),_0x319917=setTimeout(()=>_0x7057b0[_0x16e90c(0x1eb)](),REQUEST_TIMEOUT_MS);try{const _0x3ab7fc=await fetch(BACKEND_URL,{'method':_0x16e90c(0x1d8),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x16e90c(0x173)](_0xb77df7),'signal':_0x7057b0['signal']});return clearTimeout(_0x319917),await _0x3ab7fc[_0x16e90c(0x19c)]();}catch(_0x149685){return{'success':![],'error':String(_0x149685)};}}function formatTime(_0x29e1a1){const _0x14e7c3=a0_0x3bfb8c,_0x195900=new Date(_0x29e1a1);return String(_0x195900[_0x14e7c3(0x1ae)]())[_0x14e7c3(0x1e0)](0x2,'0')+':'+String(_0x195900[_0x14e7c3(0x18c)]())['padStart'](0x2,'0');}function createMessageElement(_0xf371cf,_0x2381a9){const _0x315c10=a0_0x3bfb8c,_0x53a73b=document[_0x315c10(0x1d3)](_0x315c10(0x1d6));_0x53a73b['className']=_0x315c10(0x192)+_0xf371cf[_0x315c10(0x1bb)];const _0x5b5fde=document['createElement']('div');_0x5b5fde['className']=_0x315c10(0x1a1),_0x5b5fde[_0x315c10(0x19a)]=_0xf371cf[_0x315c10(0x199)][_0x315c10(0x1ad)](/\n/g,_0x315c10(0x1e3));const _0x173ff2=document[_0x315c10(0x1d3)]('div');_0x173ff2[_0x315c10(0x1d2)]='delete-btn',_0x173ff2[_0x315c10(0x19a)]=_0x315c10(0x195),_0x173ff2[_0x315c10(0x1c5)]=_0x31e63b=>{const _0x354290=_0x315c10;_0x31e63b[_0x354290(0x1cb)](),confirmDelete(_0x2381a9);};let _0x5f12cb;_0x5b5fde[_0x315c10(0x1a2)](_0x315c10(0x1de),()=>_0x5f12cb=setTimeout(()=>{const _0x36c27d=_0x315c10;_0x53a73b[_0x36c27d(0x16f)][_0x36c27d(0x1cd)](_0x36c27d(0x17b));if(tg?.[_0x36c27d(0x194)])tg['HapticFeedback'][_0x36c27d(0x17f)]('medium');},0x1f4)),_0x5b5fde['addEventListener'](_0x315c10(0x193),()=>clearTimeout(_0x5f12cb));const _0x436f96=document['createElement'](_0x315c10(0x1d6));return _0x436f96[_0x315c10(0x1d2)]=_0x315c10(0x1d5),_0x436f96[_0x315c10(0x174)]=formatTime(_0xf371cf[_0x315c10(0x1b0)]),_0x53a73b[_0x315c10(0x1b7)](_0x173ff2),_0x53a73b[_0x315c10(0x1b7)](_0x5b5fde),_0x53a73b[_0x315c10(0x1b7)](_0x436f96),_0x53a73b;}function createTypingIndicator(){const _0xf7921e=a0_0x3bfb8c,_0x361318=document[_0xf7921e(0x1d3)](_0xf7921e(0x1d6));return _0x361318[_0xf7921e(0x1d2)]=_0xf7921e(0x1ce),_0x361318['id']=_0xf7921e(0x18a),_0x361318[_0xf7921e(0x19a)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x361318;}function renderMessages(){const _0x50525f=a0_0x3bfb8c;Array[_0x50525f(0x1c7)](chatArea[_0x50525f(0x1da)])['forEach'](_0x3d302f=>{const _0x435b48=_0x50525f;if(_0x3d302f['id']!==_0x435b48(0x191))_0x3d302f[_0x435b48(0x1ab)]();}),messages[_0x50525f(0x179)]>0x0?(emptyState['style']['display']=_0x50525f(0x1ac),messages[_0x50525f(0x196)]((_0x470995,_0x1d5c91)=>chatArea[_0x50525f(0x1b7)](createMessageElement(_0x470995,_0x1d5c91)))):emptyState[_0x50525f(0x1e6)][_0x50525f(0x1e4)]=_0x50525f(0x197),requestAnimationFrame(()=>chatArea[_0x50525f(0x1af)]=chatArea[_0x50525f(0x180)]);}function autoResizeTextarea(){const _0xeafb43=a0_0x3bfb8c;messageInput[_0xeafb43(0x1e6)]['height']=_0xeafb43(0x1c2),messageInput['style']['height']=Math['min'](messageInput[_0xeafb43(0x180)],0x78)+'px';}function updateSendButton(){const _0x25a5eb=a0_0x3bfb8c,_0x2ac8b9=messageInput['value'][_0x25a5eb(0x172)]();sendBtn[_0x25a5eb(0x1c6)]=!_0x2ac8b9||isTyping;}async function sendMessage(){const _0x509483=a0_0x3bfb8c,_0x5e9471=messageInput[_0x509483(0x189)][_0x509483(0x172)]();if(!_0x5e9471||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x509483(0x194)][_0x509483(0x17f)](_0x509483(0x18f));messages[_0x509483(0x178)]({'role':_0x509483(0x171),'content':_0x5e9471,'timestamp':Date[_0x509483(0x1a5)]()}),localStorage['setItem'](_0x509483(0x18b),JSON[_0x509483(0x173)](messages)),renderMessages(),messageInput[_0x509483(0x189)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x509483(0x1b7)](createTypingIndicator()),chatArea[_0x509483(0x1af)]=chatArea[_0x509483(0x180)];const _0x1f5c75=await callBackend(_0x509483(0x1db),{'message':_0x5e9471});isTyping=![];const _0x533509=document['getElementById'](_0x509483(0x18a));if(_0x533509)_0x533509['remove']();let _0x28b180=_0x509483(0x1e8);if(_0x1f5c75[_0x509483(0x181)]){_0x28b180=_0x1f5c75[_0x509483(0x1c8)]||_0x509483(0x16b);if(tg?.[_0x509483(0x194)])tg[_0x509483(0x194)][_0x509483(0x1ed)]('success');}else{_0x28b180=_0x1f5c75[_0x509483(0x16e)]||_0x509483(0x1c3);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x509483(0x1ed)](_0x509483(0x16e));}messages['push']({'role':'ai','content':_0x28b180,'timestamp':Date['now']()}),localStorage[_0x509483(0x1e2)](_0x509483(0x18b),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x53da75){const _0x12c4f1=a0_0x3bfb8c;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x12c4f1(0x174)]='Действие\x20необратимо.';modalCallback=()=>{const _0x250f0a=_0x12c4f1;messages[_0x250f0a(0x17e)](_0x53da75,0x1),localStorage[_0x250f0a(0x1e2)](_0x250f0a(0x18b),JSON['stringify'](messages)),renderMessages();},modal['classList']['add'](_0x12c4f1(0x1c0));}if(clearBtn)clearBtn[a0_0x3bfb8c(0x1c5)]=()=>{const _0x245086=a0_0x3bfb8c;if(!messages[_0x245086(0x179)])return;if(mTitle)mTitle[_0x245086(0x174)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x245086(0x1c1);modalCallback=async()=>{const _0x181ad7=_0x245086;messages=[],localStorage['removeItem'](_0x181ad7(0x18b)),renderMessages(),callBackend(_0x181ad7(0x183),{});},modal[_0x245086(0x16f)]['add'](_0x245086(0x1c0));};document['getElementById'](a0_0x3bfb8c(0x1b5))['onclick']=()=>modal[a0_0x3bfb8c(0x16f)][a0_0x3bfb8c(0x1ab)](a0_0x3bfb8c(0x1c0)),document[a0_0x3bfb8c(0x1e5)](a0_0x3bfb8c(0x1aa))[a0_0x3bfb8c(0x1c5)]=()=>{const _0x74d2c8=a0_0x3bfb8c;if(modalCallback)modalCallback();modal['classList'][_0x74d2c8(0x1ab)]('show');},messageInput['addEventListener'](a0_0x3bfb8c(0x1ba),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3bfb8c(0x1a2)](a0_0x3bfb8c(0x184),_0x2887ff=>{const _0x39364a=a0_0x3bfb8c;_0x2887ff[_0x39364a(0x1a7)]===_0x39364a(0x1b9)&&!_0x2887ff['shiftKey']&&(_0x2887ff['preventDefault'](),sendMessage());}),sendBtn[a0_0x3bfb8c(0x1c5)]=sendMessage,document[a0_0x3bfb8c(0x1a2)]('click',_0x1f01fe=>{const _0x3f8c68=a0_0x3bfb8c;document['querySelectorAll'](_0x3f8c68(0x1e9))[_0x3f8c68(0x196)](_0x2173eb=>{const _0x3d6490=_0x3f8c68;if(!_0x2173eb[_0x3d6490(0x1d7)](_0x1f01fe['target']))_0x2173eb[_0x3d6490(0x16f)][_0x3d6490(0x1ab)](_0x3d6490(0x17b));});});const saved=localStorage[a0_0x3bfb8c(0x1d0)](a0_0x3bfb8c(0x18b));if(saved)try{messages=JSON[a0_0x3bfb8c(0x1b2)](saved),renderMessages();}catch(a0_0x1e5468){}updateSendButton();