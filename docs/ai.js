const a0_0x47ad4c=a0_0x90fc;(function(_0xe9caa6,_0x499c6c){const _0x5ab2ec=a0_0x90fc,_0x371671=_0xe9caa6();while(!![]){try{const _0x1eb31e=-parseInt(_0x5ab2ec(0x1b1))/0x1*(parseInt(_0x5ab2ec(0x195))/0x2)+parseInt(_0x5ab2ec(0x1a6))/0x3+parseInt(_0x5ab2ec(0x17c))/0x4*(parseInt(_0x5ab2ec(0x1c0))/0x5)+-parseInt(_0x5ab2ec(0x1ca))/0x6+parseInt(_0x5ab2ec(0x165))/0x7*(parseInt(_0x5ab2ec(0x167))/0x8)+-parseInt(_0x5ab2ec(0x178))/0x9+-parseInt(_0x5ab2ec(0x1bd))/0xa*(-parseInt(_0x5ab2ec(0x1e3))/0xb);if(_0x1eb31e===_0x499c6c)break;else _0x371671['push'](_0x371671['shift']());}catch(_0x56d964){_0x371671['push'](_0x371671['shift']());}}}(a0_0x52ec,0x3960a));const tg=window[a0_0x47ad4c(0x18d)]?.[a0_0x47ad4c(0x1bc)],HOME_URL=a0_0x47ad4c(0x1ae);function setupTelegramBackButton(){const _0x3676ef=a0_0x47ad4c,_0x1d07e8=(function(){let _0x4ebd51=!![];return function(_0x46f810,_0x4b494f){const _0x228849=_0x4ebd51?function(){const _0x5b6d8a=a0_0x90fc;if(_0x4b494f){const _0x521538=_0x4b494f[_0x5b6d8a(0x1d9)](_0x46f810,arguments);return _0x4b494f=null,_0x521538;}}:function(){};return _0x4ebd51=![],_0x228849;};}()),_0x1bc4a9=_0x1d07e8(this,function(){const _0xeb2baa=a0_0x90fc;return _0x1bc4a9['toString']()['search'](_0xeb2baa(0x171))['toString']()[_0xeb2baa(0x17a)](_0x1bc4a9)[_0xeb2baa(0x1be)](_0xeb2baa(0x171));});_0x1bc4a9();if(!tg)return;try{tg[_0x3676ef(0x169)](),tg[_0x3676ef(0x163)](),tg[_0x3676ef(0x1bb)]?.(_0x3676ef(0x1d4));if(tg[_0x3676ef(0x18b)]?.('6.1'))tg[_0x3676ef(0x162)]?.();const _0x219a9a=tg['BackButton'];if(_0x219a9a){_0x219a9a[_0x3676ef(0x16f)]();if(typeof _0x219a9a[_0x3676ef(0x18f)]==='function')try{_0x219a9a['offClick']();}catch(_0x55c41e){}_0x219a9a[_0x3676ef(0x1d3)](()=>{const _0x1726b2=_0x3676ef;if(tg[_0x1726b2(0x19b)])tg[_0x1726b2(0x19b)][_0x1726b2(0x1b0)](_0x1726b2(0x1b5));location[_0x1726b2(0x16a)]=HOME_URL;});}}catch(_0x4e3ede){console[_0x3676ef(0x1b3)]('TG\x20setup\x20error:',_0x4e3ede);}}(function initStableLayout(){const _0xfb6810=a0_0x47ad4c,_0x93ce20=document[_0xfb6810(0x1b4)](_0xfb6810(0x186)),_0x2714c9=document[_0xfb6810(0x188)](_0xfb6810(0x1c1)),_0x173a20=document[_0xfb6810(0x188)](_0xfb6810(0x1a0)),_0x304623=document['getElementById']('messageInput');function _0xa7a357(){const _0x131796=_0xfb6810;if(!_0x93ce20)return;const _0xc66edd=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x131796(0x183)];_0x93ce20[_0x131796(0x1ce)][_0x131796(0x18a)]=_0xc66edd+'px';if(_0x2714c9){const _0xf89d1e=_0x2714c9[_0x131796(0x1ad)];_0x173a20[_0x131796(0x1ce)][_0x131796(0x168)]=_0xf89d1e+0x28+'px';}}tg?tg[_0xfb6810(0x1a5)](_0xfb6810(0x18c),({isStateStable:_0x3c9500})=>{_0xa7a357();if(_0x3c9500)requestAnimationFrame(()=>{_0x173a20['scrollTop']=_0x173a20['scrollHeight'];});}):window['addEventListener'](_0xfb6810(0x1d5),_0xa7a357),_0xa7a357(),_0x304623&&(_0x304623[_0xfb6810(0x174)](_0xfb6810(0x185),()=>{requestAnimationFrame(_0xa7a357);}),_0x304623['addEventListener'](_0xfb6810(0x1c7),()=>{setTimeout(()=>{const _0x36cf6e=a0_0x90fc;_0x173a20[_0x36cf6e(0x19f)]=_0x173a20[_0x36cf6e(0x1e1)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x90fc(_0x521e4e,_0x284cb4){_0x521e4e=_0x521e4e-0x162;const _0x540b33=a0_0x52ec();let _0x3740ae=_0x540b33[_0x521e4e];return _0x3740ae;}const chatArea=document[a0_0x47ad4c(0x188)](a0_0x47ad4c(0x1a0)),emptyState=document['getElementById'](a0_0x47ad4c(0x1d2)),messageInput=document['getElementById'](a0_0x47ad4c(0x1a3)),sendBtn=document[a0_0x47ad4c(0x188)]('sendBtn'),clearBtn=document['getElementById'](a0_0x47ad4c(0x187)),modal=document[a0_0x47ad4c(0x188)](a0_0x47ad4c(0x189)),mTitle=document[a0_0x47ad4c(0x188)](a0_0x47ad4c(0x1bf)),mText=document['getElementById'](a0_0x47ad4c(0x1d6));let modalCallback=null;async function callBackend(_0x2d0ea3,_0x35c952){const _0x289c39=a0_0x47ad4c,_0x4c05f7=tg?.[_0x289c39(0x1dc)]?.[_0x289c39(0x16e)]||{},_0x5cbb24=_0x4c05f7['id']||localStorage[_0x289c39(0x1e2)](_0x289c39(0x1c3))||'d-'+Math[_0x289c39(0x1ba)](Math[_0x289c39(0x182)]()*0x3b9aca00);if(!_0x4c05f7['id'])localStorage['setItem'](_0x289c39(0x1c3),_0x5cbb24);const _0x3b551c={'action':_0x2d0ea3,'user_id':_0x5cbb24,'user_data':{'first_name':_0x4c05f7[_0x289c39(0x193)],'username':_0x4c05f7[_0x289c39(0x179)]},'init_data':tg?.[_0x289c39(0x1df)]||'',..._0x35c952},_0x34ef10=new AbortController(),_0x42b1f1=setTimeout(()=>_0x34ef10[_0x289c39(0x1de)](),REQUEST_TIMEOUT_MS);try{const _0x569de1=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x289c39(0x1a1)},'body':JSON[_0x289c39(0x1c9)](_0x3b551c),'signal':_0x34ef10[_0x289c39(0x1ab)]});return clearTimeout(_0x42b1f1),await _0x569de1[_0x289c39(0x166)]();}catch(_0x5d1e25){return{'success':![],'error':String(_0x5d1e25)};}}function formatTime(_0xfb7260){const _0x3b525c=a0_0x47ad4c,_0x995229=new Date(_0xfb7260);return String(_0x995229[_0x3b525c(0x199)]())[_0x3b525c(0x1a8)](0x2,'0')+':'+String(_0x995229[_0x3b525c(0x19e)]())[_0x3b525c(0x1a8)](0x2,'0');}function createMessageElement(_0x526f07,_0x4e243e){const _0xd1eb5e=a0_0x47ad4c,_0x238267=document[_0xd1eb5e(0x1ac)]('div');_0x238267['className']=_0xd1eb5e(0x1e0)+_0x526f07[_0xd1eb5e(0x1e5)];const _0x8abd88=document[_0xd1eb5e(0x1ac)](_0xd1eb5e(0x1c6));_0x8abd88[_0xd1eb5e(0x1c2)]='message-bubble',_0x8abd88['innerHTML']=_0x526f07[_0xd1eb5e(0x1c8)]['replace'](/\n/g,_0xd1eb5e(0x196));const _0x4e39f7=document[_0xd1eb5e(0x1ac)](_0xd1eb5e(0x1c6));_0x4e39f7[_0xd1eb5e(0x1c2)]=_0xd1eb5e(0x17f),_0x4e39f7[_0xd1eb5e(0x191)]=_0xd1eb5e(0x1af),_0x4e39f7['onclick']=_0x59623a=>{const _0x1a994e=_0xd1eb5e;_0x59623a[_0x1a994e(0x1d7)](),confirmDelete(_0x4e243e);};let _0x15709e;_0x8abd88[_0xd1eb5e(0x174)](_0xd1eb5e(0x198),()=>_0x15709e=setTimeout(()=>{const _0x401ceb=_0xd1eb5e;_0x238267[_0x401ceb(0x1e4)][_0x401ceb(0x16d)](_0x401ceb(0x1d8));if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x401ceb(0x1b0)](_0x401ceb(0x18e));},0x1f4)),_0x8abd88[_0xd1eb5e(0x174)](_0xd1eb5e(0x175),()=>clearTimeout(_0x15709e));const _0x337c5b=document['createElement'](_0xd1eb5e(0x1c6));return _0x337c5b[_0xd1eb5e(0x1c2)]=_0xd1eb5e(0x19c),_0x337c5b[_0xd1eb5e(0x1cc)]=formatTime(_0x526f07[_0xd1eb5e(0x1db)]),_0x238267[_0xd1eb5e(0x1a7)](_0x4e39f7),_0x238267['appendChild'](_0x8abd88),_0x238267[_0xd1eb5e(0x1a7)](_0x337c5b),_0x238267;}function createTypingIndicator(){const _0x29e929=a0_0x47ad4c,_0x12dad9=document[_0x29e929(0x1ac)](_0x29e929(0x1c6));return _0x12dad9[_0x29e929(0x1c2)]=_0x29e929(0x1b8),_0x12dad9['id']=_0x29e929(0x1cb),_0x12dad9[_0x29e929(0x191)]=_0x29e929(0x17e),_0x12dad9;}function a0_0x52ec(){const _0x43ddc4=['initDataUnsafe','parse','abort','initData','message\x20','scrollHeight','getItem','683331rpcwCm','classList','role','modalCancel','disableVerticalSwipes','expand','flex','105jJPbMF','json','241872pVSkzp','paddingBottom','ready','href','length','Начнется\x20новый\x20диалог.','add','user','show','click','(((.+)+)+)+$','trim','push','addEventListener','touchend','ai_chat_messages','keydown','2766456QSBSwU','username','constructor','Ошибка\x20сети','582652UefkAK','now','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','delete-btn','.message.show-delete','Очистить\x20историю?','random','innerHeight','target','input','.container','clearBtn','getElementById','confirmModal','height','isVersionAtLeast','viewportChanged','Telegram','medium','offClick','splice','innerHTML','onclick','first_name','Пустой\x20ответ','2tMiJDl','<br>','from','touchstart','getHours','querySelectorAll','HapticFeedback','message-time','contains','getMinutes','scrollTop','chatArea','text/plain','preventDefault','messageInput','notificationOccurred','onEvent','788940aMDWCo','appendChild','padStart','text','remove','signal','createElement','offsetHeight','./router.html','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','impactOccurred','377267ZGWIoE','send_message','warn','querySelector','light','error','forEach','message\x20ai','value','floor','setHeaderColor','WebApp','70hqlnuY','search','modalTitle','5tDSPWp','inputArea','className','debug_uid','setItem','display','div','focus','content','stringify','2263986PNCdAQ','typingIndicator','textContent','Удалить?','style','min','Действие\x20необратимо.','success','emptyState','onClick','#050505','resize','modalText','stopPropagation','show-delete','apply','children','timestamp'];a0_0x52ec=function(){return _0x43ddc4;};return a0_0x52ec();}function renderMessages(){const _0x218ab1=a0_0x47ad4c;Array[_0x218ab1(0x197)](chatArea[_0x218ab1(0x1da)])[_0x218ab1(0x1b7)](_0xf34f75=>{const _0x32b63e=_0x218ab1;if(_0xf34f75['id']!==_0x32b63e(0x1d2))_0xf34f75[_0x32b63e(0x1aa)]();}),messages['length']>0x0?(emptyState[_0x218ab1(0x1ce)][_0x218ab1(0x1c5)]='none',messages['forEach']((_0x740bd7,_0x3892cc)=>chatArea['appendChild'](createMessageElement(_0x740bd7,_0x3892cc)))):emptyState[_0x218ab1(0x1ce)][_0x218ab1(0x1c5)]=_0x218ab1(0x164),requestAnimationFrame(()=>chatArea[_0x218ab1(0x19f)]=chatArea[_0x218ab1(0x1e1)]);}function autoResizeTextarea(){const _0x42263e=a0_0x47ad4c;messageInput[_0x42263e(0x1ce)][_0x42263e(0x18a)]='auto',messageInput[_0x42263e(0x1ce)][_0x42263e(0x18a)]=Math[_0x42263e(0x1cf)](messageInput[_0x42263e(0x1e1)],0x78)+'px';}function updateSendButton(){const _0x39766c=a0_0x47ad4c,_0x374cb1=messageInput[_0x39766c(0x1b9)][_0x39766c(0x172)]();sendBtn['disabled']=!_0x374cb1||isTyping;}async function sendMessage(){const _0x164a37=a0_0x47ad4c,_0x20631d=messageInput[_0x164a37(0x1b9)][_0x164a37(0x172)]();if(!_0x20631d||isTyping)return;if(tg?.[_0x164a37(0x19b)])tg[_0x164a37(0x19b)]['impactOccurred'](_0x164a37(0x1b5));messages[_0x164a37(0x173)]({'role':'user','content':_0x20631d,'timestamp':Date['now']()}),localStorage[_0x164a37(0x1c4)](_0x164a37(0x176),JSON[_0x164a37(0x1c9)](messages)),renderMessages(),messageInput[_0x164a37(0x1b9)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x164a37(0x19f)]=chatArea[_0x164a37(0x1e1)];const _0x44ebb7=await callBackend(_0x164a37(0x1b2),{'message':_0x20631d});isTyping=![];const _0x3ac6e0=document[_0x164a37(0x188)]('typingIndicator');if(_0x3ac6e0)_0x3ac6e0[_0x164a37(0x1aa)]();let _0x4749ba=_0x164a37(0x17b);if(_0x44ebb7[_0x164a37(0x1d1)]){_0x4749ba=_0x44ebb7[_0x164a37(0x1a9)]||_0x164a37(0x194);if(tg?.[_0x164a37(0x19b)])tg[_0x164a37(0x19b)][_0x164a37(0x1a4)](_0x164a37(0x1d1));}else{_0x4749ba=_0x44ebb7[_0x164a37(0x1b6)]||'Ошибка\x20сервера';if(tg?.[_0x164a37(0x19b)])tg[_0x164a37(0x19b)][_0x164a37(0x1a4)](_0x164a37(0x1b6));}messages['push']({'role':'ai','content':_0x4749ba,'timestamp':Date[_0x164a37(0x17d)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x164a37(0x1c9)](messages)),renderMessages();}function confirmDelete(_0x128516){const _0x51c6f9=a0_0x47ad4c;if(mTitle)mTitle['textContent']=_0x51c6f9(0x1cd);if(mText)mText[_0x51c6f9(0x1cc)]=_0x51c6f9(0x1d0);modalCallback=()=>{const _0x18418d=_0x51c6f9;messages[_0x18418d(0x190)](_0x128516,0x1),localStorage['setItem'](_0x18418d(0x176),JSON[_0x18418d(0x1c9)](messages)),renderMessages();},modal[_0x51c6f9(0x1e4)]['add'](_0x51c6f9(0x16f));}if(clearBtn)clearBtn[a0_0x47ad4c(0x192)]=()=>{const _0x1040e2=a0_0x47ad4c;if(!messages[_0x1040e2(0x16b)])return;if(mTitle)mTitle['textContent']=_0x1040e2(0x181);if(mText)mText[_0x1040e2(0x1cc)]=_0x1040e2(0x16c);modalCallback=async()=>{const _0x4f41ba=_0x1040e2;messages=[],localStorage['removeItem'](_0x4f41ba(0x176)),renderMessages(),callBackend('clear_history',{});},modal[_0x1040e2(0x1e4)][_0x1040e2(0x16d)](_0x1040e2(0x16f));};document[a0_0x47ad4c(0x188)](a0_0x47ad4c(0x1e6))['onclick']=()=>modal[a0_0x47ad4c(0x1e4)][a0_0x47ad4c(0x1aa)](a0_0x47ad4c(0x16f)),document['getElementById']('modalConfirm')[a0_0x47ad4c(0x192)]=()=>{const _0x1396dd=a0_0x47ad4c;if(modalCallback)modalCallback();modal['classList'][_0x1396dd(0x1aa)]('show');},messageInput['addEventListener'](a0_0x47ad4c(0x185),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x47ad4c(0x174)](a0_0x47ad4c(0x177),_0x46a14c=>{const _0x2b61a6=a0_0x47ad4c;_0x46a14c['key']==='Enter'&&!_0x46a14c['shiftKey']&&(_0x46a14c[_0x2b61a6(0x1a2)](),sendMessage());}),sendBtn[a0_0x47ad4c(0x192)]=sendMessage,document['addEventListener'](a0_0x47ad4c(0x170),_0x3e2b58=>{const _0x16a384=a0_0x47ad4c;document[_0x16a384(0x19a)](_0x16a384(0x180))[_0x16a384(0x1b7)](_0x47bae7=>{const _0x550337=_0x16a384;if(!_0x47bae7[_0x550337(0x19d)](_0x3e2b58[_0x550337(0x184)]))_0x47bae7[_0x550337(0x1e4)][_0x550337(0x1aa)](_0x550337(0x1d8));});});const saved=localStorage[a0_0x47ad4c(0x1e2)](a0_0x47ad4c(0x176));if(saved)try{messages=JSON[a0_0x47ad4c(0x1dd)](saved),renderMessages();}catch(a0_0x4d91b9){}updateSendButton();