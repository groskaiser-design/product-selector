const a0_0x5651af=a0_0x32f0;(function(_0x131656,_0x15a2d6){const _0x547699=a0_0x32f0,_0x557899=_0x131656();while(!![]){try{const _0x5e544f=-parseInt(_0x547699(0x192))/0x1+-parseInt(_0x547699(0x184))/0x2*(parseInt(_0x547699(0x18b))/0x3)+-parseInt(_0x547699(0x13e))/0x4*(-parseInt(_0x547699(0x141))/0x5)+parseInt(_0x547699(0x1aa))/0x6+-parseInt(_0x547699(0x196))/0x7*(parseInt(_0x547699(0x13b))/0x8)+parseInt(_0x547699(0x1a2))/0x9+parseInt(_0x547699(0x168))/0xa;if(_0x5e544f===_0x15a2d6)break;else _0x557899['push'](_0x557899['shift']());}catch(_0x533496){_0x557899['push'](_0x557899['shift']());}}}(a0_0x5f56,0xa5e57));const tg=window[a0_0x5651af(0x17f)]?.[a0_0x5651af(0x19f)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x25f5dd=a0_0x5651af;if(!tg)return;try{tg['ready'](),tg[_0x25f5dd(0x1a5)](),tg[_0x25f5dd(0x167)]?.(_0x25f5dd(0x1ae));if(tg[_0x25f5dd(0x13c)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x758524=tg['BackButton'];if(_0x758524){_0x758524[_0x25f5dd(0x171)]();if(typeof _0x758524['offClick']===_0x25f5dd(0x154))try{_0x758524[_0x25f5dd(0x1a1)]();}catch(_0x5cad3d){}_0x758524[_0x25f5dd(0x180)](()=>{const _0x2896df=_0x25f5dd;if(tg[_0x2896df(0x197)])tg['HapticFeedback'][_0x2896df(0x15e)]('light');location[_0x2896df(0x15f)]=HOME_URL;});}}catch(_0xdb258a){console[_0x25f5dd(0x15c)]('TG\x20setup\x20error:',_0xdb258a);}}(function initStableLayout(){const _0x350a97=a0_0x5651af,_0x38aa9b=(function(){let _0x5210ef=!![];return function(_0x13add1,_0x4f3bcf){const _0x22ecf7=_0x5210ef?function(){if(_0x4f3bcf){const _0x340067=_0x4f3bcf['apply'](_0x13add1,arguments);return _0x4f3bcf=null,_0x340067;}}:function(){};return _0x5210ef=![],_0x22ecf7;};}()),_0x459abf=document[_0x350a97(0x142)]('.container'),_0x56d05c=document['getElementById'](_0x350a97(0x17c)),_0x7005e2=document[_0x350a97(0x16e)](_0x350a97(0x173)),_0xf8d9e=document[_0x350a97(0x16e)](_0x350a97(0x1a7));function _0x515155(){const _0x274f84=_0x350a97,_0x3c3ef0=_0x38aa9b(this,function(){const _0xd95d38=a0_0x32f0;return _0x3c3ef0[_0xd95d38(0x1a4)]()[_0xd95d38(0x19d)](_0xd95d38(0x182))[_0xd95d38(0x1a4)]()[_0xd95d38(0x153)](_0x3c3ef0)['search'](_0xd95d38(0x182));});_0x3c3ef0();if(!_0x459abf)return;const _0x14a4d7=tg&&tg['viewportHeight']?tg[_0x274f84(0x145)]:window[_0x274f84(0x1ab)];_0x459abf[_0x274f84(0x169)][_0x274f84(0x177)]=_0x14a4d7+'px';if(_0x56d05c){const _0x267c7c=_0x56d05c[_0x274f84(0x151)];_0x7005e2[_0x274f84(0x169)][_0x274f84(0x134)]=_0x267c7c+0x28+'px';}}tg?tg[_0x350a97(0x166)](_0x350a97(0x194),({isStateStable:_0x242082})=>{_0x515155();if(_0x242082)requestAnimationFrame(()=>{const _0x2855ed=a0_0x32f0;_0x7005e2[_0x2855ed(0x198)]=_0x7005e2['scrollHeight'];});}):window[_0x350a97(0x163)](_0x350a97(0x15b),_0x515155),_0x515155(),_0xf8d9e&&(_0xf8d9e[_0x350a97(0x163)](_0x350a97(0x18c),()=>{requestAnimationFrame(_0x515155);}),_0xf8d9e[_0x350a97(0x163)](_0x350a97(0x174),()=>{setTimeout(()=>{const _0x4262fc=a0_0x32f0;_0x7005e2['scrollTop']=_0x7005e2[_0x4262fc(0x183)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x32f0(_0x4fd5c1,_0x125e75){_0x4fd5c1=_0x4fd5c1-0x132;const _0x7c9c11=a0_0x5f56();let _0x2f78b=_0x7c9c11[_0x4fd5c1];return _0x2f78b;}const BACKEND_URL=a0_0x5651af(0x16d),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5651af(0x16e)](a0_0x5651af(0x173)),emptyState=document[a0_0x5651af(0x16e)]('emptyState'),messageInput=document[a0_0x5651af(0x16e)](a0_0x5651af(0x1a7)),sendBtn=document['getElementById'](a0_0x5651af(0x150)),clearBtn=document[a0_0x5651af(0x16e)](a0_0x5651af(0x18f)),modal=document[a0_0x5651af(0x16e)](a0_0x5651af(0x19e)),mTitle=document[a0_0x5651af(0x16e)](a0_0x5651af(0x14e)),mText=document[a0_0x5651af(0x16e)](a0_0x5651af(0x176));let modalCallback=null;async function callBackend(_0x3dc8bf,_0x4ead34){const _0x30a306=a0_0x5651af,_0x1a3af2=tg?.[_0x30a306(0x170)]?.['user']||{},_0x520558=_0x1a3af2['id']||localStorage['getItem'](_0x30a306(0x13a))||'d-'+Math[_0x30a306(0x190)](Math['random']()*0x3b9aca00);if(!_0x1a3af2['id'])localStorage[_0x30a306(0x13d)](_0x30a306(0x13a),_0x520558);const _0x570f0d={'action':_0x3dc8bf,'user_id':_0x520558,'user_data':{'first_name':_0x1a3af2[_0x30a306(0x18d)],'username':_0x1a3af2[_0x30a306(0x181)]},'init_data':tg?.[_0x30a306(0x138)]||'',..._0x4ead34},_0x30127a=new AbortController(),_0x12be66=setTimeout(()=>_0x30127a[_0x30a306(0x193)](),REQUEST_TIMEOUT_MS);try{const _0x3b379a=await fetch(BACKEND_URL,{'method':_0x30a306(0x152),'headers':{'Content-Type':_0x30a306(0x19a)},'body':JSON[_0x30a306(0x160)](_0x570f0d),'signal':_0x30127a['signal']});return clearTimeout(_0x12be66),await _0x3b379a['json']();}catch(_0x588dc7){return{'success':![],'error':String(_0x588dc7)};}}function formatTime(_0x7e3919){const _0x3748ea=a0_0x5651af,_0x35c382=new Date(_0x7e3919);return String(_0x35c382['getHours']())[_0x3748ea(0x1a6)](0x2,'0')+':'+String(_0x35c382[_0x3748ea(0x175)]())[_0x3748ea(0x1a6)](0x2,'0');}function createMessageElement(_0x1886dd,_0x3951a5){const _0x2a6a7f=a0_0x5651af,_0xd09891=document[_0x2a6a7f(0x17b)](_0x2a6a7f(0x188));_0xd09891[_0x2a6a7f(0x140)]=_0x2a6a7f(0x144)+_0x1886dd[_0x2a6a7f(0x1ac)];const _0xa3f913=document[_0x2a6a7f(0x17b)](_0x2a6a7f(0x188));_0xa3f913[_0x2a6a7f(0x140)]='message-bubble',_0xa3f913[_0x2a6a7f(0x135)]=_0x1886dd[_0x2a6a7f(0x19b)][_0x2a6a7f(0x191)](/\n/g,_0x2a6a7f(0x16c));const _0x287301=document[_0x2a6a7f(0x17b)](_0x2a6a7f(0x188));_0x287301['className']=_0x2a6a7f(0x164),_0x287301[_0x2a6a7f(0x135)]=_0x2a6a7f(0x19c),_0x287301['onclick']=_0x250349=>{const _0x15dbc7=_0x2a6a7f;_0x250349[_0x15dbc7(0x199)](),confirmDelete(_0x3951a5);};let _0x119afc;_0xa3f913[_0x2a6a7f(0x163)]('touchstart',()=>_0x119afc=setTimeout(()=>{const _0xcd795c=_0x2a6a7f;_0xd09891[_0xcd795c(0x16a)][_0xcd795c(0x132)](_0xcd795c(0x156));if(tg?.[_0xcd795c(0x197)])tg[_0xcd795c(0x197)]['impactOccurred'](_0xcd795c(0x161));},0x1f4)),_0xa3f913[_0x2a6a7f(0x163)](_0x2a6a7f(0x155),()=>clearTimeout(_0x119afc));const _0x10c73f=document['createElement']('div');return _0x10c73f[_0x2a6a7f(0x140)]='message-time',_0x10c73f[_0x2a6a7f(0x146)]=formatTime(_0x1886dd[_0x2a6a7f(0x172)]),_0xd09891[_0x2a6a7f(0x15d)](_0x287301),_0xd09891[_0x2a6a7f(0x15d)](_0xa3f913),_0xd09891['appendChild'](_0x10c73f),_0xd09891;}function createTypingIndicator(){const _0x36141d=a0_0x5651af,_0x39833d=document[_0x36141d(0x17b)]('div');return _0x39833d[_0x36141d(0x140)]='message\x20ai',_0x39833d['id']=_0x36141d(0x15a),_0x39833d[_0x36141d(0x135)]=_0x36141d(0x189),_0x39833d;}function renderMessages(){const _0x5ef6e5=a0_0x5651af;Array[_0x5ef6e5(0x17a)](chatArea[_0x5ef6e5(0x18a)])[_0x5ef6e5(0x14c)](_0x3360b1=>{const _0x47f128=_0x5ef6e5;if(_0x3360b1['id']!==_0x47f128(0x14a))_0x3360b1[_0x47f128(0x165)]();}),messages[_0x5ef6e5(0x1ad)]>0x0?(emptyState[_0x5ef6e5(0x169)][_0x5ef6e5(0x14b)]=_0x5ef6e5(0x178),messages['forEach']((_0x3d1c48,_0x2cd38a)=>chatArea[_0x5ef6e5(0x15d)](createMessageElement(_0x3d1c48,_0x2cd38a)))):emptyState[_0x5ef6e5(0x169)][_0x5ef6e5(0x14b)]='flex',requestAnimationFrame(()=>chatArea[_0x5ef6e5(0x198)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x2f76a3=a0_0x5651af;messageInput['style'][_0x2f76a3(0x177)]=_0x2f76a3(0x1af),messageInput[_0x2f76a3(0x169)][_0x2f76a3(0x177)]=Math[_0x2f76a3(0x159)](messageInput[_0x2f76a3(0x183)],0x78)+'px';}function a0_0x5f56(){const _0x2a0d36=['href','stringify','medium','preventDefault','addEventListener','delete-btn','remove','onEvent','setHeaderColor','14186800fRkLNC','style','classList','onclick','<br>','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','getElementById','contains','initDataUnsafe','show','timestamp','chatArea','focus','getMinutes','modalText','height','none','removeItem','from','createElement','inputArea','success','modalConfirm','Telegram','onClick','username','(((.+)+)+)+$','scrollHeight','2liWBxm','send_message','trim','value','div','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','children','2102250UEnslX','input','first_name','user','clearBtn','floor','replace','992438cOsSvi','abort','viewportChanged','ai_chat_messages','7tCELTR','HapticFeedback','scrollTop','stopPropagation','text/plain','content','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','search','confirmModal','WebApp','target','offClick','4600854svRRNv','Ошибка\x20сети','toString','expand','padStart','messageInput','push','Ошибка\x20сервера','3086178eOnMeU','innerHeight','role','length','#050505','auto','add','key','paddingBottom','innerHTML','error','querySelectorAll','initData','text','debug_uid','7418528HRiJzh','isVersionAtLeast','setItem','8lFiwrK','splice','className','2139415RsYZur','querySelector','Пустой\x20ответ','message\x20','viewportHeight','textContent','now','disabled','getItem','emptyState','display','forEach','shiftKey','modalTitle','notificationOccurred','sendBtn','offsetHeight','POST','constructor','function','touchend','show-delete','Enter','light','min','typingIndicator','resize','warn','appendChild','impactOccurred'];a0_0x5f56=function(){return _0x2a0d36;};return a0_0x5f56();}function updateSendButton(){const _0x199392=a0_0x5651af,_0x21aa22=messageInput[_0x199392(0x187)][_0x199392(0x186)]();sendBtn[_0x199392(0x148)]=!_0x21aa22||isTyping;}async function sendMessage(){const _0x5b0caa=a0_0x5651af,_0x34e8ae=messageInput['value'][_0x5b0caa(0x186)]();if(!_0x34e8ae||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x5b0caa(0x197)][_0x5b0caa(0x15e)](_0x5b0caa(0x158));messages[_0x5b0caa(0x1a8)]({'role':_0x5b0caa(0x18e),'content':_0x34e8ae,'timestamp':Date[_0x5b0caa(0x147)]()}),localStorage[_0x5b0caa(0x13d)]('ai_chat_messages',JSON[_0x5b0caa(0x160)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5b0caa(0x15d)](createTypingIndicator()),chatArea[_0x5b0caa(0x198)]=chatArea[_0x5b0caa(0x183)];const _0x2b3f12=await callBackend(_0x5b0caa(0x185),{'message':_0x34e8ae});isTyping=![];const _0x5b83c4=document[_0x5b0caa(0x16e)](_0x5b0caa(0x15a));if(_0x5b83c4)_0x5b83c4[_0x5b0caa(0x165)]();let _0x52bb95=_0x5b0caa(0x1a3);if(_0x2b3f12[_0x5b0caa(0x17d)]){_0x52bb95=_0x2b3f12[_0x5b0caa(0x139)]||_0x5b0caa(0x143);if(tg?.[_0x5b0caa(0x197)])tg[_0x5b0caa(0x197)][_0x5b0caa(0x14f)]('success');}else{_0x52bb95=_0x2b3f12[_0x5b0caa(0x136)]||_0x5b0caa(0x1a9);if(tg?.[_0x5b0caa(0x197)])tg[_0x5b0caa(0x197)]['notificationOccurred']('error');}messages[_0x5b0caa(0x1a8)]({'role':'ai','content':_0x52bb95,'timestamp':Date['now']()}),localStorage['setItem'](_0x5b0caa(0x195),JSON[_0x5b0caa(0x160)](messages)),renderMessages();}function confirmDelete(_0x1096f5){const _0x28737a=a0_0x5651af;if(mTitle)mTitle[_0x28737a(0x146)]='Удалить?';if(mText)mText[_0x28737a(0x146)]='Действие\x20необратимо.';modalCallback=()=>{const _0x5cc2b7=_0x28737a;messages[_0x5cc2b7(0x13f)](_0x1096f5,0x1),localStorage[_0x5cc2b7(0x13d)](_0x5cc2b7(0x195),JSON['stringify'](messages)),renderMessages();},modal[_0x28737a(0x16a)][_0x28737a(0x132)](_0x28737a(0x171));}if(clearBtn)clearBtn[a0_0x5651af(0x16b)]=()=>{const _0x4c80cf=a0_0x5651af;if(!messages[_0x4c80cf(0x1ad)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x4c80cf(0x146)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0xc5e37a=_0x4c80cf;messages=[],localStorage[_0xc5e37a(0x179)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x4c80cf(0x16a)][_0x4c80cf(0x132)]('show');};document['getElementById']('modalCancel')[a0_0x5651af(0x16b)]=()=>modal['classList'][a0_0x5651af(0x165)](a0_0x5651af(0x171)),document[a0_0x5651af(0x16e)](a0_0x5651af(0x17e))[a0_0x5651af(0x16b)]=()=>{const _0x2d074f=a0_0x5651af;if(modalCallback)modalCallback();modal[_0x2d074f(0x16a)][_0x2d074f(0x165)](_0x2d074f(0x171));},messageInput[a0_0x5651af(0x163)](a0_0x5651af(0x18c),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5651af(0x163)]('keydown',_0x9bf40=>{const _0x189350=a0_0x5651af;_0x9bf40[_0x189350(0x133)]===_0x189350(0x157)&&!_0x9bf40[_0x189350(0x14d)]&&(_0x9bf40[_0x189350(0x162)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener']('click',_0x348150=>{const _0x5563e5=a0_0x5651af;document[_0x5563e5(0x137)]('.message.show-delete')['forEach'](_0x14261c=>{const _0x572261=_0x5563e5;if(!_0x14261c[_0x572261(0x16f)](_0x348150[_0x572261(0x1a0)]))_0x14261c[_0x572261(0x16a)][_0x572261(0x165)](_0x572261(0x156));});});const saved=localStorage[a0_0x5651af(0x149)]('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x4015ff){}updateSendButton();