const a0_0x3b3b2d=a0_0x57b3;(function(_0x1c5a3d,_0x42848c){const _0x196a5a=a0_0x57b3,_0x432e38=_0x1c5a3d();while(!![]){try{const _0x2b9589=-parseInt(_0x196a5a(0xdc))/0x1+-parseInt(_0x196a5a(0xd0))/0x2+parseInt(_0x196a5a(0xae))/0x3+-parseInt(_0x196a5a(0xd7))/0x4+-parseInt(_0x196a5a(0xc3))/0x5+-parseInt(_0x196a5a(0xee))/0x6+parseInt(_0x196a5a(0xbe))/0x7*(parseInt(_0x196a5a(0xb0))/0x8);if(_0x2b9589===_0x42848c)break;else _0x432e38['push'](_0x432e38['shift']());}catch(_0x4f79b4){_0x432e38['push'](_0x432e38['shift']());}}}(a0_0x128e,0x267b9));const tg=window[a0_0x3b3b2d(0x93)]?.[a0_0x3b3b2d(0xb4)],HOME_URL=a0_0x3b3b2d(0xe9);function setupTelegramBackButton(){const _0x304b30=a0_0x3b3b2d;if(!tg)return;try{tg[_0x304b30(0xbd)](),tg[_0x304b30(0xe3)](),tg[_0x304b30(0xa5)]?.('#050505');if(tg[_0x304b30(0xc9)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x4acad8=tg[_0x304b30(0xca)];if(_0x4acad8){_0x4acad8['show']();if(typeof _0x4acad8['offClick']===_0x304b30(0xbb))try{_0x4acad8[_0x304b30(0xb7)]();}catch(_0x12b49c){}_0x4acad8[_0x304b30(0x91)](()=>{const _0x9fc775=_0x304b30;if(tg['HapticFeedback'])tg[_0x9fc775(0xa4)]['impactOccurred'](_0x9fc775(0xd2));location['href']=HOME_URL;});}}catch(_0x23d404){console[_0x304b30(0x102)]('TG\x20setup\x20error:',_0x23d404);}}(function initStableLayout(){const _0x4059bc=a0_0x3b3b2d,_0x2d5483=(function(){let _0x49ee24=!![];return function(_0x1051eb,_0x19c2ac){const _0x3e659b=_0x49ee24?function(){const _0x60a855=a0_0x57b3;if(_0x19c2ac){const _0x307ede=_0x19c2ac[_0x60a855(0xd3)](_0x1051eb,arguments);return _0x19c2ac=null,_0x307ede;}}:function(){};return _0x49ee24=![],_0x3e659b;};}()),_0x450cbe=document['querySelector']('.container'),_0x2d93a5=document['getElementById'](_0x4059bc(0xb3)),_0x9dd632=document[_0x4059bc(0xf7)](_0x4059bc(0xf6)),_0x169361=document['getElementById'](_0x4059bc(0xa3));function _0x228b43(){const _0x2628d2=_0x4059bc,_0x48a0f9=_0x2d5483(this,function(){const _0xbaa42e=a0_0x57b3;return _0x48a0f9['toString']()[_0xbaa42e(0xfc)](_0xbaa42e(0x105))[_0xbaa42e(0x104)]()[_0xbaa42e(0xb1)](_0x48a0f9)[_0xbaa42e(0xfc)](_0xbaa42e(0x105));});_0x48a0f9();if(!_0x450cbe)return;const _0x2c5053=tg&&tg[_0x2628d2(0x94)]?tg[_0x2628d2(0x94)]:window[_0x2628d2(0xb5)];_0x450cbe[_0x2628d2(0xf5)][_0x2628d2(0x99)]=_0x2c5053+'px';if(_0x2d93a5){const _0x2b536c=_0x2d93a5[_0x2628d2(0xa1)];_0x9dd632[_0x2628d2(0xf5)][_0x2628d2(0x98)]=_0x2b536c+0x28+'px';}}tg?tg[_0x4059bc(0xbf)](_0x4059bc(0xf2),({isStateStable:_0x5518e0})=>{_0x228b43();if(_0x5518e0)requestAnimationFrame(()=>{_0x9dd632['scrollTop']=_0x9dd632['scrollHeight'];});}):window[_0x4059bc(0x107)](_0x4059bc(0xc5),_0x228b43),_0x228b43(),_0x169361&&(_0x169361[_0x4059bc(0x107)](_0x4059bc(0xc6),()=>{requestAnimationFrame(_0x228b43);}),_0x169361[_0x4059bc(0x107)](_0x4059bc(0x97),()=>{setTimeout(()=>{const _0x3a327d=a0_0x57b3;_0x9dd632[_0x3a327d(0xfa)]=_0x9dd632['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3b3b2d(0xde),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x57b3(_0x417dcd,_0x5f33b7){_0x417dcd=_0x417dcd-0x91;const _0x222e00=a0_0x128e();let _0x275852=_0x222e00[_0x417dcd];return _0x275852;}const chatArea=document[a0_0x3b3b2d(0xf7)](a0_0x3b3b2d(0xf6)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x3b3b2d(0xf7)](a0_0x3b3b2d(0xa3)),sendBtn=document[a0_0x3b3b2d(0xf7)](a0_0x3b3b2d(0x95)),clearBtn=document['getElementById'](a0_0x3b3b2d(0xcc)),modal=document[a0_0x3b3b2d(0xf7)](a0_0x3b3b2d(0xe8)),mTitle=document[a0_0x3b3b2d(0xf7)]('modalTitle'),mText=document[a0_0x3b3b2d(0xf7)]('modalText');let modalCallback=null;async function callBackend(_0x51cd88,_0x129ee2){const _0x5a0638=a0_0x3b3b2d,_0x5b6413=tg?.[_0x5a0638(0xb6)]?.[_0x5a0638(0x9f)]||{},_0x2d1dcd=_0x5b6413['id']||localStorage[_0x5a0638(0xb9)]('debug_uid')||'d-'+Math[_0x5a0638(0xb8)](Math[_0x5a0638(0xaf)]()*0x3b9aca00);if(!_0x5b6413['id'])localStorage[_0x5a0638(0xfd)](_0x5a0638(0x96),_0x2d1dcd);const _0x1e8e63={'action':_0x51cd88,'user_id':_0x2d1dcd,'user_data':{'first_name':_0x5b6413['first_name'],'username':_0x5b6413['username']},'init_data':tg?.[_0x5a0638(0x92)]||'',..._0x129ee2},_0x3e0343=new AbortController(),_0x567d8f=setTimeout(()=>_0x3e0343[_0x5a0638(0xce)](),REQUEST_TIMEOUT_MS);try{const _0x21a28e=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x5a0638(0xec)},'body':JSON['stringify'](_0x1e8e63),'signal':_0x3e0343['signal']});return clearTimeout(_0x567d8f),await _0x21a28e[_0x5a0638(0x108)]();}catch(_0x179dfa){return{'success':![],'error':String(_0x179dfa)};}}function formatTime(_0x4d288c){const _0x4c880a=a0_0x3b3b2d,_0x4ae215=new Date(_0x4d288c);return String(_0x4ae215[_0x4c880a(0x9e)]())[_0x4c880a(0xe1)](0x2,'0')+':'+String(_0x4ae215['getMinutes']())[_0x4c880a(0xe1)](0x2,'0');}function a0_0x128e(){const _0x76c6fa=['offClick','floor','getItem','scrollHeight','function','Начнется\x20новый\x20диалог.','ready','4725945yuIAHR','onEvent','message\x20ai','keydown','classList','1356655lXIVIs','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','resize','input','div','trim','isVersionAtLeast','BackButton','message\x20','clearBtn','Пустой\x20ответ','abort','notificationOccurred','185136raLteQ','medium','light','apply','emptyState','delete-btn','innerHTML','99044kvabkp','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','now','.message.show-delete','impactOccurred','83033NpBXrm','message-time','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','stringify','Ошибка\x20сети','padStart','text','expand','none','Действие\x20необратимо.','error','modalCancel','confirmModal','./router.html','createElement','Ошибка\x20сервера','text/plain','from','1604574DRHzGl','success','ai_chat_messages','modalConfirm','viewportChanged','show-delete','message-bubble','style','chatArea','getElementById','content','click','scrollTop','show','search','setItem','replace','min','display','stopPropagation','warn','onclick','toString','(((.+)+)+)+$','value','addEventListener','json','onClick','initData','Telegram','viewportHeight','sendBtn','debug_uid','focus','paddingBottom','height','Enter','length','textContent','push','getHours','user','remove','offsetHeight','Удалить?','messageInput','HapticFeedback','setHeaderColor','clear_history','role','className','appendChild','<br>','contains','auto','forEach','664836SZfdYq','random','8xmwoKO','constructor','add','inputArea','WebApp','innerHeight','initDataUnsafe'];a0_0x128e=function(){return _0x76c6fa;};return a0_0x128e();}function createMessageElement(_0x5909e2,_0x162828){const _0x34c3c6=a0_0x3b3b2d,_0x33d99b=document[_0x34c3c6(0xea)](_0x34c3c6(0xc7));_0x33d99b[_0x34c3c6(0xa8)]=_0x34c3c6(0xcb)+_0x5909e2[_0x34c3c6(0xa7)];const _0x5134ed=document[_0x34c3c6(0xea)]('div');_0x5134ed['className']=_0x34c3c6(0xf4),_0x5134ed['innerHTML']=_0x5909e2[_0x34c3c6(0xf8)][_0x34c3c6(0xfe)](/\n/g,_0x34c3c6(0xaa));const _0xbe6b5b=document[_0x34c3c6(0xea)]('div');_0xbe6b5b['className']=_0x34c3c6(0xd5),_0xbe6b5b['innerHTML']=_0x34c3c6(0xc4),_0xbe6b5b[_0x34c3c6(0x103)]=_0x490424=>{const _0x34cbea=_0x34c3c6;_0x490424[_0x34cbea(0x101)](),confirmDelete(_0x162828);};let _0xf3e5e;_0x5134ed[_0x34c3c6(0x107)]('touchstart',()=>_0xf3e5e=setTimeout(()=>{const _0x2f7f89=_0x34c3c6;_0x33d99b['classList'][_0x2f7f89(0xb2)](_0x2f7f89(0xf3));if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x2f7f89(0xdb)](_0x2f7f89(0xd1));},0x1f4)),_0x5134ed['addEventListener']('touchend',()=>clearTimeout(_0xf3e5e));const _0x1e12a6=document[_0x34c3c6(0xea)]('div');return _0x1e12a6[_0x34c3c6(0xa8)]=_0x34c3c6(0xdd),_0x1e12a6[_0x34c3c6(0x9c)]=formatTime(_0x5909e2['timestamp']),_0x33d99b[_0x34c3c6(0xa9)](_0xbe6b5b),_0x33d99b['appendChild'](_0x5134ed),_0x33d99b[_0x34c3c6(0xa9)](_0x1e12a6),_0x33d99b;}function createTypingIndicator(){const _0x3ca596=a0_0x3b3b2d,_0x1b2fc3=document[_0x3ca596(0xea)]('div');return _0x1b2fc3['className']=_0x3ca596(0xc0),_0x1b2fc3['id']='typingIndicator',_0x1b2fc3[_0x3ca596(0xd6)]=_0x3ca596(0xd8),_0x1b2fc3;}function renderMessages(){const _0x2fe3ec=a0_0x3b3b2d;Array[_0x2fe3ec(0xed)](chatArea['children'])[_0x2fe3ec(0xad)](_0x5ce6ca=>{const _0x1ce48b=_0x2fe3ec;if(_0x5ce6ca['id']!==_0x1ce48b(0xd4))_0x5ce6ca[_0x1ce48b(0xa0)]();}),messages[_0x2fe3ec(0x9b)]>0x0?(emptyState['style']['display']=_0x2fe3ec(0xe4),messages[_0x2fe3ec(0xad)]((_0x13f1de,_0x3e510d)=>chatArea['appendChild'](createMessageElement(_0x13f1de,_0x3e510d)))):emptyState[_0x2fe3ec(0xf5)][_0x2fe3ec(0x100)]='flex',requestAnimationFrame(()=>chatArea[_0x2fe3ec(0xfa)]=chatArea[_0x2fe3ec(0xba)]);}function autoResizeTextarea(){const _0x2750ed=a0_0x3b3b2d;messageInput[_0x2750ed(0xf5)][_0x2750ed(0x99)]=_0x2750ed(0xac),messageInput['style']['height']=Math[_0x2750ed(0xff)](messageInput[_0x2750ed(0xba)],0x78)+'px';}function updateSendButton(){const _0x37aa1c=a0_0x3b3b2d,_0x20eb00=messageInput[_0x37aa1c(0x106)][_0x37aa1c(0xc8)]();sendBtn['disabled']=!_0x20eb00||isTyping;}async function sendMessage(){const _0x53fb18=a0_0x3b3b2d,_0x526a79=messageInput['value'][_0x53fb18(0xc8)]();if(!_0x526a79||isTyping)return;if(tg?.[_0x53fb18(0xa4)])tg['HapticFeedback'][_0x53fb18(0xdb)](_0x53fb18(0xd2));messages[_0x53fb18(0x9d)]({'role':'user','content':_0x526a79,'timestamp':Date[_0x53fb18(0xd9)]()}),localStorage[_0x53fb18(0xfd)](_0x53fb18(0xf0),JSON[_0x53fb18(0xdf)](messages)),renderMessages(),messageInput[_0x53fb18(0x106)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x53fb18(0xa9)](createTypingIndicator()),chatArea[_0x53fb18(0xfa)]=chatArea[_0x53fb18(0xba)];const _0x22f0be=await callBackend('send_message',{'message':_0x526a79});isTyping=![];const _0x1cc7df=document[_0x53fb18(0xf7)]('typingIndicator');if(_0x1cc7df)_0x1cc7df[_0x53fb18(0xa0)]();let _0x39c76c=_0x53fb18(0xe0);if(_0x22f0be[_0x53fb18(0xef)]){_0x39c76c=_0x22f0be[_0x53fb18(0xe2)]||_0x53fb18(0xcd);if(tg?.[_0x53fb18(0xa4)])tg[_0x53fb18(0xa4)][_0x53fb18(0xcf)](_0x53fb18(0xef));}else{_0x39c76c=_0x22f0be[_0x53fb18(0xe6)]||_0x53fb18(0xeb);if(tg?.['HapticFeedback'])tg[_0x53fb18(0xa4)][_0x53fb18(0xcf)]('error');}messages[_0x53fb18(0x9d)]({'role':'ai','content':_0x39c76c,'timestamp':Date[_0x53fb18(0xd9)]()}),localStorage[_0x53fb18(0xfd)](_0x53fb18(0xf0),JSON[_0x53fb18(0xdf)](messages)),renderMessages();}function confirmDelete(_0x3144b0){const _0x539663=a0_0x3b3b2d;if(mTitle)mTitle[_0x539663(0x9c)]=_0x539663(0xa2);if(mText)mText['textContent']=_0x539663(0xe5);modalCallback=()=>{const _0x13badc=_0x539663;messages['splice'](_0x3144b0,0x1),localStorage[_0x13badc(0xfd)](_0x13badc(0xf0),JSON['stringify'](messages)),renderMessages();},modal[_0x539663(0xc2)][_0x539663(0xb2)](_0x539663(0xfb));}if(clearBtn)clearBtn['onclick']=()=>{const _0xad0be3=a0_0x3b3b2d;if(!messages[_0xad0be3(0x9b)])return;if(mTitle)mTitle[_0xad0be3(0x9c)]='Очистить\x20историю?';if(mText)mText[_0xad0be3(0x9c)]=_0xad0be3(0xbc);modalCallback=async()=>{const _0x200792=_0xad0be3;messages=[],localStorage['removeItem'](_0x200792(0xf0)),renderMessages(),callBackend(_0x200792(0xa6),{});},modal[_0xad0be3(0xc2)][_0xad0be3(0xb2)](_0xad0be3(0xfb));};document[a0_0x3b3b2d(0xf7)](a0_0x3b3b2d(0xe7))[a0_0x3b3b2d(0x103)]=()=>modal[a0_0x3b3b2d(0xc2)][a0_0x3b3b2d(0xa0)]('show'),document[a0_0x3b3b2d(0xf7)](a0_0x3b3b2d(0xf1))[a0_0x3b3b2d(0x103)]=()=>{const _0x339d2d=a0_0x3b3b2d;if(modalCallback)modalCallback();modal[_0x339d2d(0xc2)]['remove']('show');},messageInput[a0_0x3b3b2d(0x107)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3b3b2d(0x107)](a0_0x3b3b2d(0xc1),_0x2bb065=>{const _0x55ddd6=a0_0x3b3b2d;_0x2bb065['key']===_0x55ddd6(0x9a)&&!_0x2bb065['shiftKey']&&(_0x2bb065['preventDefault'](),sendMessage());}),sendBtn[a0_0x3b3b2d(0x103)]=sendMessage,document['addEventListener'](a0_0x3b3b2d(0xf9),_0x503591=>{const _0x245d05=a0_0x3b3b2d;document['querySelectorAll'](_0x245d05(0xda))[_0x245d05(0xad)](_0x2e7723=>{const _0x1b3fef=_0x245d05;if(!_0x2e7723[_0x1b3fef(0xab)](_0x503591['target']))_0x2e7723[_0x1b3fef(0xc2)]['remove'](_0x1b3fef(0xf3));});});const saved=localStorage[a0_0x3b3b2d(0xb9)](a0_0x3b3b2d(0xf0));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x98be5e){}updateSendButton();