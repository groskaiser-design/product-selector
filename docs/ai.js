const a0_0x2ecfca=a0_0x36c8;(function(_0x3b739c,_0x39da50){const _0x204546=a0_0x36c8,_0x8a54e1=_0x3b739c();while(!![]){try{const _0x4f3c61=parseInt(_0x204546(0x1fc))/0x1+-parseInt(_0x204546(0x227))/0x2*(-parseInt(_0x204546(0x214))/0x3)+parseInt(_0x204546(0x1c6))/0x4*(parseInt(_0x204546(0x21e))/0x5)+parseInt(_0x204546(0x215))/0x6+parseInt(_0x204546(0x207))/0x7*(parseInt(_0x204546(0x1fd))/0x8)+-parseInt(_0x204546(0x239))/0x9+-parseInt(_0x204546(0x20e))/0xa*(parseInt(_0x204546(0x232))/0xb);if(_0x4f3c61===_0x39da50)break;else _0x8a54e1['push'](_0x8a54e1['shift']());}catch(_0x49cec5){_0x8a54e1['push'](_0x8a54e1['shift']());}}}(a0_0x7966,0x59aea));const tg=window[a0_0x2ecfca(0x203)]?.[a0_0x2ecfca(0x1cb)],HOME_URL=a0_0x2ecfca(0x1d5);function setupTelegramBackButton(){const _0x16c0c1=a0_0x2ecfca;if(!tg)return;try{tg[_0x16c0c1(0x1cc)](),tg[_0x16c0c1(0x1f9)](),tg[_0x16c0c1(0x1f0)]?.(_0x16c0c1(0x1fa));if(tg[_0x16c0c1(0x1ec)]?.(_0x16c0c1(0x234)))tg['disableVerticalSwipes']?.();const _0x1e925b=tg[_0x16c0c1(0x1ca)];if(_0x1e925b){_0x1e925b['show']();if(typeof _0x1e925b['offClick']===_0x16c0c1(0x201))try{_0x1e925b['offClick']();}catch(_0x5d0473){}_0x1e925b['onClick'](()=>{const _0x1da599=_0x16c0c1;if(tg[_0x1da599(0x1da)])tg[_0x1da599(0x1da)][_0x1da599(0x1f2)](_0x1da599(0x241));location[_0x1da599(0x1f1)]=HOME_URL;});}}catch(_0x33b42d){console[_0x16c0c1(0x23f)](_0x16c0c1(0x218),_0x33b42d);}}(function initStableLayout(){const _0x546e4a=a0_0x2ecfca,_0x5b1dad=(function(){let _0x57763b=!![];return function(_0x5da815,_0x17d4c0){const _0x4fa7c8=_0x57763b?function(){const _0x58fa7b=a0_0x36c8;if(_0x17d4c0){const _0x29f896=_0x17d4c0[_0x58fa7b(0x1e4)](_0x5da815,arguments);return _0x17d4c0=null,_0x29f896;}}:function(){};return _0x57763b=![],_0x4fa7c8;};}()),_0x540bed=document[_0x546e4a(0x1d7)]('.container'),_0x3ce39b=document['getElementById'](_0x546e4a(0x21d)),_0x7bc607=document['getElementById'](_0x546e4a(0x1eb)),_0x41f9d4=document[_0x546e4a(0x20f)](_0x546e4a(0x20c));function _0x1b3dbd(){const _0x3f1ed5=_0x546e4a,_0x310727=_0x5b1dad(this,function(){const _0x45c6e1=a0_0x36c8;return _0x310727['toString']()[_0x45c6e1(0x20a)](_0x45c6e1(0x1ff))['toString']()[_0x45c6e1(0x1ea)](_0x310727)['search'](_0x45c6e1(0x1ff));});_0x310727();if(!_0x540bed)return;const _0x197029=tg&&tg['viewportHeight']?tg[_0x3f1ed5(0x1c9)]:window[_0x3f1ed5(0x1c3)];_0x540bed[_0x3f1ed5(0x1fb)][_0x3f1ed5(0x20d)]=_0x197029+'px';if(_0x3ce39b){const _0x5e3edf=_0x3ce39b[_0x3f1ed5(0x233)];_0x7bc607[_0x3f1ed5(0x1fb)]['paddingBottom']=_0x5e3edf+0x28+'px';}}tg?tg[_0x546e4a(0x1bf)](_0x546e4a(0x1cf),({isStateStable:_0x1dbbb6})=>{_0x1b3dbd();if(_0x1dbbb6)requestAnimationFrame(()=>{const _0x55a85e=a0_0x36c8;_0x7bc607['scrollTop']=_0x7bc607[_0x55a85e(0x1c4)];});}):window[_0x546e4a(0x1d2)](_0x546e4a(0x1f5),_0x1b3dbd),_0x1b3dbd(),_0x41f9d4&&(_0x41f9d4[_0x546e4a(0x1d2)]('input',()=>{requestAnimationFrame(_0x1b3dbd);}),_0x41f9d4['addEventListener'](_0x546e4a(0x200),()=>{setTimeout(()=>{const _0x43936b=a0_0x36c8;_0x7bc607[_0x43936b(0x1dc)]=_0x7bc607[_0x43936b(0x1c4)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2ecfca(0x1de),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x36c8(_0x1c6f8a,_0x330a65){_0x1c6f8a=_0x1c6f8a-0x1be;const _0x25fa98=a0_0x7966();let _0x132517=_0x25fa98[_0x1c6f8a];return _0x132517;}let messages=[],isTyping=![];const chatArea=document[a0_0x2ecfca(0x20f)](a0_0x2ecfca(0x1eb)),emptyState=document[a0_0x2ecfca(0x20f)]('emptyState'),messageInput=document['getElementById'](a0_0x2ecfca(0x20c)),sendBtn=document[a0_0x2ecfca(0x20f)](a0_0x2ecfca(0x228)),clearBtn=document['getElementById'](a0_0x2ecfca(0x1d1)),modal=document[a0_0x2ecfca(0x20f)](a0_0x2ecfca(0x217)),mTitle=document['getElementById'](a0_0x2ecfca(0x1e5)),mText=document[a0_0x2ecfca(0x20f)](a0_0x2ecfca(0x22d));let modalCallback=null;async function callBackend(_0x1a0e66,_0x343078){const _0x459d41=a0_0x2ecfca,_0x3c2efb=tg?.[_0x459d41(0x1ef)]?.['user']||{},_0x98476c=_0x3c2efb['id']||localStorage[_0x459d41(0x1d6)](_0x459d41(0x209))||'d-'+Math[_0x459d41(0x1f6)](Math[_0x459d41(0x206)]()*0x3b9aca00);if(!_0x3c2efb['id'])localStorage['setItem'](_0x459d41(0x209),_0x98476c);const _0x4e16a0={'action':_0x1a0e66,'user_id':_0x98476c,'user_data':{'first_name':_0x3c2efb['first_name'],'username':_0x3c2efb[_0x459d41(0x1c2)]},'init_data':tg?.[_0x459d41(0x1c8)]||'',..._0x343078},_0x4fa963=new AbortController(),_0x3792d0=setTimeout(()=>_0x4fa963[_0x459d41(0x1c7)](),REQUEST_TIMEOUT_MS);try{const _0x84f73c=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x459d41(0x224)},'body':JSON[_0x459d41(0x1df)](_0x4e16a0),'signal':_0x4fa963[_0x459d41(0x22c)]});return clearTimeout(_0x3792d0),await _0x84f73c['json']();}catch(_0x4a0225){return{'success':![],'error':String(_0x4a0225)};}}function formatTime(_0x2d9e90){const _0xbfb10f=a0_0x2ecfca,_0x22f2a6=new Date(_0x2d9e90);return String(_0x22f2a6[_0xbfb10f(0x210)]())[_0xbfb10f(0x1f3)](0x2,'0')+':'+String(_0x22f2a6[_0xbfb10f(0x1d0)]())[_0xbfb10f(0x1f3)](0x2,'0');}function createMessageElement(_0x1c4f83,_0x2ccaa6){const _0x1eed28=a0_0x2ecfca,_0x2abcc1=document[_0x1eed28(0x235)](_0x1eed28(0x1e1));_0x2abcc1['className']='message\x20'+_0x1c4f83[_0x1eed28(0x222)];const _0x2806eb=document[_0x1eed28(0x235)](_0x1eed28(0x1e1));_0x2806eb[_0x1eed28(0x1f8)]=_0x1eed28(0x213),_0x2806eb[_0x1eed28(0x1c5)]=_0x1c4f83[_0x1eed28(0x211)]['replace'](/\n/g,'<br>');const _0x1891ed=document[_0x1eed28(0x235)](_0x1eed28(0x1e1));_0x1891ed[_0x1eed28(0x1f8)]='delete-btn',_0x1891ed[_0x1eed28(0x1c5)]=_0x1eed28(0x23d),_0x1891ed[_0x1eed28(0x230)]=_0x3c2de1=>{const _0x11041b=_0x1eed28;_0x3c2de1[_0x11041b(0x204)](),confirmDelete(_0x2ccaa6);};let _0x3b3b60;_0x2806eb['addEventListener'](_0x1eed28(0x1c1),()=>_0x3b3b60=setTimeout(()=>{const _0x101254=_0x1eed28;_0x2abcc1[_0x101254(0x1f4)]['add'](_0x101254(0x21c));if(tg?.[_0x101254(0x1da)])tg['HapticFeedback'][_0x101254(0x1f2)](_0x101254(0x1e7));},0x1f4)),_0x2806eb[_0x1eed28(0x1d2)](_0x1eed28(0x1fe),()=>clearTimeout(_0x3b3b60));const _0x29120c=document[_0x1eed28(0x235)](_0x1eed28(0x1e1));return _0x29120c[_0x1eed28(0x1f8)]=_0x1eed28(0x22b),_0x29120c[_0x1eed28(0x237)]=formatTime(_0x1c4f83[_0x1eed28(0x1d9)]),_0x2abcc1[_0x1eed28(0x236)](_0x1891ed),_0x2abcc1[_0x1eed28(0x236)](_0x2806eb),_0x2abcc1[_0x1eed28(0x236)](_0x29120c),_0x2abcc1;}function createTypingIndicator(){const _0x5ce1f0=a0_0x2ecfca,_0x15e919=document[_0x5ce1f0(0x235)](_0x5ce1f0(0x1e1));return _0x15e919[_0x5ce1f0(0x1f8)]=_0x5ce1f0(0x23a),_0x15e919['id']=_0x5ce1f0(0x1e2),_0x15e919['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x15e919;}function renderMessages(){const _0x468a78=a0_0x2ecfca;Array[_0x468a78(0x1db)](chatArea[_0x468a78(0x238)])[_0x468a78(0x202)](_0x1e9e9b=>{const _0x257f91=_0x468a78;if(_0x1e9e9b['id']!==_0x257f91(0x219))_0x1e9e9b[_0x257f91(0x20b)]();}),messages['length']>0x0?(emptyState[_0x468a78(0x1fb)][_0x468a78(0x1e9)]=_0x468a78(0x1e0),messages['forEach']((_0x85e3a2,_0x3ffabe)=>chatArea[_0x468a78(0x236)](createMessageElement(_0x85e3a2,_0x3ffabe)))):emptyState[_0x468a78(0x1fb)][_0x468a78(0x1e9)]=_0x468a78(0x21a),requestAnimationFrame(()=>chatArea[_0x468a78(0x1dc)]=chatArea[_0x468a78(0x1c4)]);}function a0_0x7966(){const _0x22ef5a=['messageInput','height','2099170AsFpgs','getElementById','getHours','content','now','message-bubble','2001oeXSTt','2180160XWoInd','splice','confirmModal','TG\x20setup\x20error:','emptyState','flex','success','show-delete','inputArea','2335ftPSqo','parse','modalCancel','removeItem','role','shiftKey','text/plain','Ошибка\x20сервера','preventDefault','2098wuxVop','sendBtn','clear_history','trim','message-time','signal','modalText','Очистить\x20историю?','input','onclick','value','77gETurZ','offsetHeight','6.1','createElement','appendChild','textContent','children','5581341QDGHtK','message\x20ai','length','push','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','min','warn','auto','light','ai_chat_messages','Удалить?','onEvent','add','touchstart','username','innerHeight','scrollHeight','innerHTML','3104huZnWI','abort','initData','viewportHeight','BackButton','WebApp','ready','keydown','notificationOccurred','viewportChanged','getMinutes','clearBtn','addEventListener','.message.show-delete','Начнется\x20новый\x20диалог.','./router.html','getItem','querySelector','error','timestamp','HapticFeedback','from','scrollTop','setItem','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','stringify','none','div','typingIndicator','key','apply','modalTitle','contains','medium','send_message','display','constructor','chatArea','isVersionAtLeast','text','querySelectorAll','initDataUnsafe','setHeaderColor','href','impactOccurred','padStart','classList','resize','floor','show','className','expand','#050505','style','437669gMIRhS','2375208TQGhPN','touchend','(((.+)+)+)+$','focus','function','forEach','Telegram','stopPropagation','modalConfirm','random','14TWdmZK','Пустой\x20ответ','debug_uid','search','remove'];a0_0x7966=function(){return _0x22ef5a;};return a0_0x7966();}function autoResizeTextarea(){const _0x1f3709=a0_0x2ecfca;messageInput[_0x1f3709(0x1fb)]['height']=_0x1f3709(0x240),messageInput[_0x1f3709(0x1fb)][_0x1f3709(0x20d)]=Math[_0x1f3709(0x23e)](messageInput[_0x1f3709(0x1c4)],0x78)+'px';}function updateSendButton(){const _0x299bbe=a0_0x2ecfca,_0x348407=messageInput['value'][_0x299bbe(0x22a)]();sendBtn['disabled']=!_0x348407||isTyping;}async function sendMessage(){const _0x4204d7=a0_0x2ecfca,_0x22a917=messageInput[_0x4204d7(0x231)][_0x4204d7(0x22a)]();if(!_0x22a917||isTyping)return;if(tg?.[_0x4204d7(0x1da)])tg[_0x4204d7(0x1da)][_0x4204d7(0x1f2)](_0x4204d7(0x241));messages['push']({'role':'user','content':_0x22a917,'timestamp':Date[_0x4204d7(0x212)]()}),localStorage[_0x4204d7(0x1dd)]('ai_chat_messages',JSON[_0x4204d7(0x1df)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4204d7(0x236)](createTypingIndicator()),chatArea[_0x4204d7(0x1dc)]=chatArea[_0x4204d7(0x1c4)];const _0x243a34=await callBackend(_0x4204d7(0x1e8),{'message':_0x22a917});isTyping=![];const _0x561734=document[_0x4204d7(0x20f)](_0x4204d7(0x1e2));if(_0x561734)_0x561734[_0x4204d7(0x20b)]();let _0x1ebd86='Ошибка\x20сети';if(_0x243a34[_0x4204d7(0x21b)]){_0x1ebd86=_0x243a34[_0x4204d7(0x1ed)]||_0x4204d7(0x208);if(tg?.[_0x4204d7(0x1da)])tg[_0x4204d7(0x1da)]['notificationOccurred'](_0x4204d7(0x21b));}else{_0x1ebd86=_0x243a34[_0x4204d7(0x1d8)]||_0x4204d7(0x225);if(tg?.[_0x4204d7(0x1da)])tg[_0x4204d7(0x1da)][_0x4204d7(0x1ce)]('error');}messages[_0x4204d7(0x23c)]({'role':'ai','content':_0x1ebd86,'timestamp':Date['now']()}),localStorage[_0x4204d7(0x1dd)](_0x4204d7(0x242),JSON[_0x4204d7(0x1df)](messages)),renderMessages();}function confirmDelete(_0xe4b508){const _0xd6d48e=a0_0x2ecfca;if(mTitle)mTitle[_0xd6d48e(0x237)]=_0xd6d48e(0x1be);if(mText)mText[_0xd6d48e(0x237)]='Действие\x20необратимо.';modalCallback=()=>{const _0x2d98b4=_0xd6d48e;messages[_0x2d98b4(0x216)](_0xe4b508,0x1),localStorage['setItem'](_0x2d98b4(0x242),JSON[_0x2d98b4(0x1df)](messages)),renderMessages();},modal[_0xd6d48e(0x1f4)]['add'](_0xd6d48e(0x1f7));}if(clearBtn)clearBtn[a0_0x2ecfca(0x230)]=()=>{const _0xb370ef=a0_0x2ecfca;if(!messages[_0xb370ef(0x23b)])return;if(mTitle)mTitle[_0xb370ef(0x237)]=_0xb370ef(0x22e);if(mText)mText[_0xb370ef(0x237)]=_0xb370ef(0x1d4);modalCallback=async()=>{const _0x32ea73=_0xb370ef;messages=[],localStorage[_0x32ea73(0x221)](_0x32ea73(0x242)),renderMessages(),callBackend(_0x32ea73(0x229),{});},modal[_0xb370ef(0x1f4)][_0xb370ef(0x1c0)](_0xb370ef(0x1f7));};document['getElementById'](a0_0x2ecfca(0x220))[a0_0x2ecfca(0x230)]=()=>modal[a0_0x2ecfca(0x1f4)][a0_0x2ecfca(0x20b)](a0_0x2ecfca(0x1f7)),document['getElementById'](a0_0x2ecfca(0x205))[a0_0x2ecfca(0x230)]=()=>{const _0xba268a=a0_0x2ecfca;if(modalCallback)modalCallback();modal[_0xba268a(0x1f4)]['remove']('show');},messageInput[a0_0x2ecfca(0x1d2)](a0_0x2ecfca(0x22f),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2ecfca(0x1d2)](a0_0x2ecfca(0x1cd),_0x27fba7=>{const _0xc3c745=a0_0x2ecfca;_0x27fba7[_0xc3c745(0x1e3)]==='Enter'&&!_0x27fba7[_0xc3c745(0x223)]&&(_0x27fba7[_0xc3c745(0x226)](),sendMessage());}),sendBtn[a0_0x2ecfca(0x230)]=sendMessage,document[a0_0x2ecfca(0x1d2)]('click',_0x3574fe=>{const _0x56cca8=a0_0x2ecfca;document[_0x56cca8(0x1ee)](_0x56cca8(0x1d3))[_0x56cca8(0x202)](_0x21524c=>{const _0x17b69b=_0x56cca8;if(!_0x21524c[_0x17b69b(0x1e6)](_0x3574fe['target']))_0x21524c[_0x17b69b(0x1f4)][_0x17b69b(0x20b)](_0x17b69b(0x21c));});});const saved=localStorage[a0_0x2ecfca(0x1d6)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x2ecfca(0x21f)](saved),renderMessages();}catch(a0_0x5133e6){}updateSendButton();