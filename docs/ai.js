const a0_0x2e8d62=a0_0x201f;(function(_0x44c291,_0xf8bf3e){const _0x306455=a0_0x201f,_0x42c166=_0x44c291();while(!![]){try{const _0x3b4df2=-parseInt(_0x306455(0x142))/0x1+-parseInt(_0x306455(0x123))/0x2*(parseInt(_0x306455(0x147))/0x3)+-parseInt(_0x306455(0x18f))/0x4*(parseInt(_0x306455(0x139))/0x5)+-parseInt(_0x306455(0x14d))/0x6*(parseInt(_0x306455(0x13e))/0x7)+parseInt(_0x306455(0x135))/0x8*(parseInt(_0x306455(0x12e))/0x9)+parseInt(_0x306455(0x16a))/0xa*(-parseInt(_0x306455(0x11c))/0xb)+-parseInt(_0x306455(0x13c))/0xc*(-parseInt(_0x306455(0x121))/0xd);if(_0x3b4df2===_0xf8bf3e)break;else _0x42c166['push'](_0x42c166['shift']());}catch(_0x4dcf30){_0x42c166['push'](_0x42c166['shift']());}}}(a0_0x1cae,0xe6221));const tg=window[a0_0x2e8d62(0x16b)]?.['WebApp'],HOME_URL=a0_0x2e8d62(0x12d);function setupTelegramBackButton(){const _0x13a0ac=a0_0x2e8d62,_0x4d8c33=(function(){let _0x32db49=!![];return function(_0x2e5ada,_0x50a2df){const _0x249a8b=_0x32db49?function(){const _0x48b13f=a0_0x201f;if(_0x50a2df){const _0xdc263c=_0x50a2df[_0x48b13f(0x170)](_0x2e5ada,arguments);return _0x50a2df=null,_0xdc263c;}}:function(){};return _0x32db49=![],_0x249a8b;};}()),_0x1b1cc1=_0x4d8c33(this,function(){const _0x185bcd=a0_0x201f;return _0x1b1cc1[_0x185bcd(0x176)]()[_0x185bcd(0x14c)](_0x185bcd(0x16e))[_0x185bcd(0x176)]()[_0x185bcd(0x18b)](_0x1b1cc1)[_0x185bcd(0x14c)](_0x185bcd(0x16e));});_0x1b1cc1();if(!tg)return;try{tg[_0x13a0ac(0x173)](),tg[_0x13a0ac(0x12b)](),tg[_0x13a0ac(0x167)]?.(_0x13a0ac(0x166));if(tg[_0x13a0ac(0x15e)]?.(_0x13a0ac(0x192)))tg[_0x13a0ac(0x15d)]?.();const _0x14f0be=tg['BackButton'];if(_0x14f0be){_0x14f0be[_0x13a0ac(0x187)]();if(typeof _0x14f0be[_0x13a0ac(0x10e)]===_0x13a0ac(0x116))try{_0x14f0be['offClick']();}catch(_0x513745){}_0x14f0be['onClick'](()=>{const _0x4117a1=_0x13a0ac;if(tg['HapticFeedback'])tg['HapticFeedback'][_0x4117a1(0x15a)](_0x4117a1(0x111));location[_0x4117a1(0x11a)]=HOME_URL;});}}catch(_0x36ecfb){console[_0x13a0ac(0x169)]('TG\x20setup\x20error:',_0x36ecfb);}}(function initStableLayout(){const _0x4b5e88=a0_0x2e8d62,_0x2d0aca=document[_0x4b5e88(0x18e)](_0x4b5e88(0x14a)),_0x2785da=document['getElementById'](_0x4b5e88(0x144)),_0x2c1054=document[_0x4b5e88(0x12c)](_0x4b5e88(0x128)),_0x25eb0d=document['getElementById'](_0x4b5e88(0x12a));function _0x17c088(){const _0x169d04=_0x4b5e88;if(!_0x2d0aca)return;const _0x2c8a69=tg&&tg[_0x169d04(0x163)]?tg['viewportHeight']:window[_0x169d04(0x13f)];_0x2d0aca[_0x169d04(0x150)][_0x169d04(0x15f)]=_0x2c8a69+'px';if(_0x2785da){const _0x22fc71=_0x2785da[_0x169d04(0x164)];_0x2c1054[_0x169d04(0x150)][_0x169d04(0x193)]=_0x22fc71+0x28+'px';}}tg?tg[_0x4b5e88(0x177)](_0x4b5e88(0x132),({isStateStable:_0x84ee44})=>{_0x17c088();if(_0x84ee44)requestAnimationFrame(()=>{const _0x4d3958=a0_0x201f;_0x2c1054[_0x4d3958(0x117)]=_0x2c1054[_0x4d3958(0x156)];});}):window[_0x4b5e88(0x162)](_0x4b5e88(0x113),_0x17c088),_0x17c088(),_0x25eb0d&&(_0x25eb0d[_0x4b5e88(0x162)]('input',()=>{requestAnimationFrame(_0x17c088);}),_0x25eb0d[_0x4b5e88(0x162)]('focus',()=>{setTimeout(()=>{const _0x373da8=a0_0x201f;_0x2c1054[_0x373da8(0x117)]=_0x2c1054[_0x373da8(0x156)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2e8d62(0x12c)](a0_0x2e8d62(0x128)),emptyState=document[a0_0x2e8d62(0x12c)]('emptyState'),messageInput=document[a0_0x2e8d62(0x12c)](a0_0x2e8d62(0x12a)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document['getElementById'](a0_0x2e8d62(0x18a)),modal=document[a0_0x2e8d62(0x12c)]('confirmModal'),mTitle=document[a0_0x2e8d62(0x12c)]('modalTitle'),mText=document['getElementById'](a0_0x2e8d62(0x13d));let modalCallback=null;async function callBackend(_0x2dbdbf,_0xeff1fe){const _0x57d023=a0_0x2e8d62,_0x19f1d1=tg?.[_0x57d023(0x140)]?.[_0x57d023(0x11b)]||{},_0x42e7cd=_0x19f1d1['id']||localStorage[_0x57d023(0x115)](_0x57d023(0x16f))||'d-'+Math[_0x57d023(0x181)](Math['random']()*0x3b9aca00);if(!_0x19f1d1['id'])localStorage['setItem']('debug_uid',_0x42e7cd);const _0x451f30={'action':_0x2dbdbf,'user_id':_0x42e7cd,'user_data':{'first_name':_0x19f1d1[_0x57d023(0x186)],'username':_0x19f1d1[_0x57d023(0x190)]},'init_data':tg?.[_0x57d023(0x17b)]||'',..._0xeff1fe},_0x124fe4=new AbortController(),_0x235fe5=setTimeout(()=>_0x124fe4['abort'](),REQUEST_TIMEOUT_MS);try{const _0x2f59d1=await fetch(BACKEND_URL,{'method':_0x57d023(0x130),'headers':{'Content-Type':_0x57d023(0x120)},'body':JSON[_0x57d023(0x148)](_0x451f30),'signal':_0x124fe4[_0x57d023(0x158)]});return clearTimeout(_0x235fe5),await _0x2f59d1[_0x57d023(0x178)]();}catch(_0x3e6fc5){return{'success':![],'error':String(_0x3e6fc5)};}}function formatTime(_0x3ac725){const _0x1f1a8d=a0_0x2e8d62,_0x5134c5=new Date(_0x3ac725);return String(_0x5134c5[_0x1f1a8d(0x179)]())[_0x1f1a8d(0x18c)](0x2,'0')+':'+String(_0x5134c5[_0x1f1a8d(0x159)]())[_0x1f1a8d(0x18c)](0x2,'0');}function createMessageElement(_0x4a0cbc,_0x581820){const _0x3c149d=a0_0x2e8d62,_0x512d2a=document[_0x3c149d(0x143)](_0x3c149d(0x12f));_0x512d2a[_0x3c149d(0x133)]=_0x3c149d(0x14e)+_0x4a0cbc['role'];const _0x4fc175=document['createElement']('div');_0x4fc175['className']=_0x3c149d(0x118),_0x4fc175[_0x3c149d(0x191)]=_0x4a0cbc['content'][_0x3c149d(0x11f)](/\n/g,_0x3c149d(0x154));const _0x41b384=document[_0x3c149d(0x143)]('div');_0x41b384[_0x3c149d(0x133)]=_0x3c149d(0x17f),_0x41b384[_0x3c149d(0x191)]=_0x3c149d(0x14b),_0x41b384['onclick']=_0x567912=>{const _0x5039f1=_0x3c149d;_0x567912[_0x5039f1(0x10d)](),confirmDelete(_0x581820);};let _0x3a9bc5;_0x4fc175[_0x3c149d(0x162)](_0x3c149d(0x136),()=>_0x3a9bc5=setTimeout(()=>{const _0x9cc3ec=_0x3c149d;_0x512d2a[_0x9cc3ec(0x149)][_0x9cc3ec(0x14f)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x9cc3ec(0x168)][_0x9cc3ec(0x15a)](_0x9cc3ec(0x16c));},0x1f4)),_0x4fc175[_0x3c149d(0x162)](_0x3c149d(0x125),()=>clearTimeout(_0x3a9bc5));const _0x27bcb2=document[_0x3c149d(0x143)](_0x3c149d(0x12f));return _0x27bcb2[_0x3c149d(0x133)]=_0x3c149d(0x15b),_0x27bcb2['textContent']=formatTime(_0x4a0cbc['timestamp']),_0x512d2a[_0x3c149d(0x174)](_0x41b384),_0x512d2a[_0x3c149d(0x174)](_0x4fc175),_0x512d2a[_0x3c149d(0x174)](_0x27bcb2),_0x512d2a;}function a0_0x1cae(){const _0x708cae=['modalConfirm','contains','first_name','show','value','success','clearBtn','constructor','padStart','show-delete','querySelector','86444vmSiYs','username','innerHTML','6.1','paddingBottom','stopPropagation','offClick','typingIndicator','Ошибка\x20сети','light','forEach','resize','Пустой\x20ответ','getItem','function','scrollTop','message-bubble','key','href','user','1936cLiBkg','Удалить?','send_message','replace','text/plain','13KuKDsD','input','642388MQxGip','click','touchend','remove','onclick','chatArea','none','messageInput','expand','getElementById','./router.html','999MFEHlN','div','POST','Ошибка\x20сервера','viewportChanged','className','setItem','86328TuopPD','touchstart','from','keydown','215ezyMKt','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','children','45284556TXQQNd','modalText','208803iAeIUH','innerHeight','initDataUnsafe','notificationOccurred','376300iaRmik','createElement','inputArea','trim','removeItem','3BuYNui','stringify','classList','.container','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','search','204RxzIYK','message\x20','add','style','display','length','modalCancel','<br>','disabled','scrollHeight','error','signal','getMinutes','impactOccurred','message-time','querySelectorAll','disableVerticalSwipes','isVersionAtLeast','height','now','min','addEventListener','viewportHeight','offsetHeight','Очистить\x20историю?','#050505','setHeaderColor','HapticFeedback','warn','78860mMoJau','Telegram','medium','flex','(((.+)+)+)+$','debug_uid','apply','target','Enter','ready','appendChild','shiftKey','toString','onEvent','json','getHours','parse','initData','auto','push','ai_chat_messages','delete-btn','emptyState','floor','Начнется\x20новый\x20диалог.','textContent'];a0_0x1cae=function(){return _0x708cae;};return a0_0x1cae();}function createTypingIndicator(){const _0x5daa69=a0_0x2e8d62,_0xccfbc3=document[_0x5daa69(0x143)](_0x5daa69(0x12f));return _0xccfbc3[_0x5daa69(0x133)]='message\x20ai',_0xccfbc3['id']=_0x5daa69(0x10f),_0xccfbc3[_0x5daa69(0x191)]=_0x5daa69(0x13a),_0xccfbc3;}function renderMessages(){const _0x3075c5=a0_0x2e8d62;Array[_0x3075c5(0x137)](chatArea[_0x3075c5(0x13b)])[_0x3075c5(0x112)](_0x211bed=>{const _0x67d5c7=_0x3075c5;if(_0x211bed['id']!==_0x67d5c7(0x180))_0x211bed[_0x67d5c7(0x126)]();}),messages[_0x3075c5(0x152)]>0x0?(emptyState[_0x3075c5(0x150)][_0x3075c5(0x151)]=_0x3075c5(0x129),messages[_0x3075c5(0x112)]((_0x4e9d2c,_0x5b3354)=>chatArea[_0x3075c5(0x174)](createMessageElement(_0x4e9d2c,_0x5b3354)))):emptyState[_0x3075c5(0x150)]['display']=_0x3075c5(0x16d),requestAnimationFrame(()=>chatArea[_0x3075c5(0x117)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x1edf36=a0_0x2e8d62;messageInput[_0x1edf36(0x150)][_0x1edf36(0x15f)]=_0x1edf36(0x17c),messageInput[_0x1edf36(0x150)]['height']=Math[_0x1edf36(0x161)](messageInput[_0x1edf36(0x156)],0x78)+'px';}function updateSendButton(){const _0x3871d1=a0_0x2e8d62,_0x58147c=messageInput[_0x3871d1(0x188)]['trim']();sendBtn[_0x3871d1(0x155)]=!_0x58147c||isTyping;}async function sendMessage(){const _0x2be9ba=a0_0x2e8d62,_0x792a1a=messageInput[_0x2be9ba(0x188)][_0x2be9ba(0x145)]();if(!_0x792a1a||isTyping)return;if(tg?.[_0x2be9ba(0x168)])tg[_0x2be9ba(0x168)][_0x2be9ba(0x15a)]('light');messages[_0x2be9ba(0x17d)]({'role':_0x2be9ba(0x11b),'content':_0x792a1a,'timestamp':Date[_0x2be9ba(0x160)]()}),localStorage[_0x2be9ba(0x134)](_0x2be9ba(0x17e),JSON['stringify'](messages)),renderMessages(),messageInput[_0x2be9ba(0x188)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2be9ba(0x174)](createTypingIndicator()),chatArea[_0x2be9ba(0x117)]=chatArea['scrollHeight'];const _0x14b70d=await callBackend(_0x2be9ba(0x11e),{'message':_0x792a1a});isTyping=![];const _0x19f4f6=document[_0x2be9ba(0x12c)]('typingIndicator');if(_0x19f4f6)_0x19f4f6[_0x2be9ba(0x126)]();let _0x964853=_0x2be9ba(0x110);if(_0x14b70d[_0x2be9ba(0x189)]){_0x964853=_0x14b70d['text']||_0x2be9ba(0x114);if(tg?.[_0x2be9ba(0x168)])tg[_0x2be9ba(0x168)][_0x2be9ba(0x141)](_0x2be9ba(0x189));}else{_0x964853=_0x14b70d[_0x2be9ba(0x157)]||_0x2be9ba(0x131);if(tg?.[_0x2be9ba(0x168)])tg[_0x2be9ba(0x168)][_0x2be9ba(0x141)](_0x2be9ba(0x157));}messages[_0x2be9ba(0x17d)]({'role':'ai','content':_0x964853,'timestamp':Date['now']()}),localStorage[_0x2be9ba(0x134)](_0x2be9ba(0x17e),JSON[_0x2be9ba(0x148)](messages)),renderMessages();}function a0_0x201f(_0xf7f928,_0x50ae0c){_0xf7f928=_0xf7f928-0x10d;const _0x599527=a0_0x1cae();let _0x29e663=_0x599527[_0xf7f928];return _0x29e663;}function confirmDelete(_0x4004f3){const _0x2418c2=a0_0x2e8d62;if(mTitle)mTitle[_0x2418c2(0x183)]=_0x2418c2(0x11d);if(mText)mText[_0x2418c2(0x183)]='Действие\x20необратимо.';modalCallback=()=>{const _0x303c73=_0x2418c2;messages['splice'](_0x4004f3,0x1),localStorage[_0x303c73(0x134)]('ai_chat_messages',JSON[_0x303c73(0x148)](messages)),renderMessages();},modal[_0x2418c2(0x149)]['add']('show');}if(clearBtn)clearBtn[a0_0x2e8d62(0x127)]=()=>{const _0x2ccb91=a0_0x2e8d62;if(!messages[_0x2ccb91(0x152)])return;if(mTitle)mTitle[_0x2ccb91(0x183)]=_0x2ccb91(0x165);if(mText)mText[_0x2ccb91(0x183)]=_0x2ccb91(0x182);modalCallback=async()=>{const _0x151204=_0x2ccb91;messages=[],localStorage[_0x151204(0x146)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x2ccb91(0x149)][_0x2ccb91(0x14f)](_0x2ccb91(0x187));};document[a0_0x2e8d62(0x12c)](a0_0x2e8d62(0x153))[a0_0x2e8d62(0x127)]=()=>modal['classList']['remove'](a0_0x2e8d62(0x187)),document['getElementById'](a0_0x2e8d62(0x184))[a0_0x2e8d62(0x127)]=()=>{const _0x31db1f=a0_0x2e8d62;if(modalCallback)modalCallback();modal[_0x31db1f(0x149)][_0x31db1f(0x126)](_0x31db1f(0x187));},messageInput[a0_0x2e8d62(0x162)](a0_0x2e8d62(0x122),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2e8d62(0x162)](a0_0x2e8d62(0x138),_0x601d81=>{const _0x3141b0=a0_0x2e8d62;_0x601d81[_0x3141b0(0x119)]===_0x3141b0(0x172)&&!_0x601d81[_0x3141b0(0x175)]&&(_0x601d81['preventDefault'](),sendMessage());}),sendBtn[a0_0x2e8d62(0x127)]=sendMessage,document[a0_0x2e8d62(0x162)](a0_0x2e8d62(0x124),_0x4acdc3=>{const _0x23c4c0=a0_0x2e8d62;document[_0x23c4c0(0x15c)]('.message.show-delete')[_0x23c4c0(0x112)](_0x412f48=>{const _0x573b27=_0x23c4c0;if(!_0x412f48[_0x573b27(0x185)](_0x4acdc3[_0x573b27(0x171)]))_0x412f48[_0x573b27(0x149)]['remove'](_0x573b27(0x18d));});});const saved=localStorage['getItem'](a0_0x2e8d62(0x17e));if(saved)try{messages=JSON[a0_0x2e8d62(0x17a)](saved),renderMessages();}catch(a0_0x425f3d){}updateSendButton();