const a0_0x1d646c=a0_0x271c;(function(_0x50f834,_0x48705e){const _0x3023a3=a0_0x271c,_0xd31146=_0x50f834();while(!![]){try{const _0x1b2ebd=-parseInt(_0x3023a3(0x220))/0x1+parseInt(_0x3023a3(0x248))/0x2*(-parseInt(_0x3023a3(0x22d))/0x3)+-parseInt(_0x3023a3(0x24c))/0x4+parseInt(_0x3023a3(0x1ed))/0x5*(-parseInt(_0x3023a3(0x1fc))/0x6)+parseInt(_0x3023a3(0x251))/0x7*(parseInt(_0x3023a3(0x205))/0x8)+-parseInt(_0x3023a3(0x244))/0x9+parseInt(_0x3023a3(0x213))/0xa*(parseInt(_0x3023a3(0x253))/0xb);if(_0x1b2ebd===_0x48705e)break;else _0xd31146['push'](_0xd31146['shift']());}catch(_0x1faf7b){_0xd31146['push'](_0xd31146['shift']());}}}(a0_0x23f1,0xa3080));const tg=window['Telegram']?.[a0_0x1d646c(0x1fd)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x42fb88=a0_0x1d646c,_0x21e4d8=(function(){let _0x5684ea=!![];return function(_0x2c3f87,_0x5b6401){const _0x271a9e=_0x5684ea?function(){const _0x2d5762=a0_0x271c;if(_0x5b6401){const _0x14375f=_0x5b6401[_0x2d5762(0x25b)](_0x2c3f87,arguments);return _0x5b6401=null,_0x14375f;}}:function(){};return _0x5684ea=![],_0x271a9e;};}()),_0xe8d1b2=_0x21e4d8(this,function(){const _0x10f43d=a0_0x271c;return _0xe8d1b2[_0x10f43d(0x1e5)]()[_0x10f43d(0x223)]('(((.+)+)+)+$')[_0x10f43d(0x1e5)]()[_0x10f43d(0x240)](_0xe8d1b2)[_0x10f43d(0x223)](_0x10f43d(0x1ea));});_0xe8d1b2();if(!tg)return;try{tg[_0x42fb88(0x241)](),tg[_0x42fb88(0x216)](),tg['setHeaderColor']?.(_0x42fb88(0x23f));if(tg[_0x42fb88(0x20b)]?.(_0x42fb88(0x235)))tg[_0x42fb88(0x24b)]?.();const _0x221ee8=tg[_0x42fb88(0x211)];if(_0x221ee8){_0x221ee8[_0x42fb88(0x239)]();if(typeof _0x221ee8[_0x42fb88(0x1f4)]===_0x42fb88(0x225))try{_0x221ee8['offClick']();}catch(_0x1ab39b){}_0x221ee8[_0x42fb88(0x212)](()=>{const _0xcb22fa=_0x42fb88;if(tg[_0xcb22fa(0x206)])tg[_0xcb22fa(0x206)]['impactOccurred'](_0xcb22fa(0x1f3));location[_0xcb22fa(0x1e8)]=HOME_URL;});}}catch(_0x311528){console['warn'](_0x42fb88(0x1f9),_0x311528);}}(function initStableLayout(){const _0x10a77b=a0_0x1d646c,_0x3df931=document['querySelector'](_0x10a77b(0x24e)),_0x3e3423=document[_0x10a77b(0x201)](_0x10a77b(0x1fe)),_0x4e82ca=document['getElementById'](_0x10a77b(0x231)),_0x4a602a=document[_0x10a77b(0x201)](_0x10a77b(0x22e));function _0x28454d(){const _0x2712e4=_0x10a77b;if(!_0x3df931)return;const _0x1b4097=tg&&tg[_0x2712e4(0x229)]?tg[_0x2712e4(0x229)]:window[_0x2712e4(0x1e3)];_0x3df931[_0x2712e4(0x20c)][_0x2712e4(0x22b)]=_0x1b4097+'px';if(_0x3e3423){const _0x5d2263=_0x3e3423[_0x2712e4(0x214)];_0x4e82ca[_0x2712e4(0x20c)][_0x2712e4(0x23d)]=_0x5d2263+0x28+'px';}}tg?tg[_0x10a77b(0x209)]('viewportChanged',({isStateStable:_0x1cdcc0})=>{_0x28454d();if(_0x1cdcc0)requestAnimationFrame(()=>{const _0x16c44a=a0_0x271c;_0x4e82ca[_0x16c44a(0x203)]=_0x4e82ca['scrollHeight'];});}):window[_0x10a77b(0x21b)](_0x10a77b(0x1e2),_0x28454d),_0x28454d(),_0x4a602a&&(_0x4a602a[_0x10a77b(0x21b)]('input',()=>{requestAnimationFrame(_0x28454d);}),_0x4a602a['addEventListener']('focus',()=>{setTimeout(()=>{const _0x388742=a0_0x271c;_0x4e82ca[_0x388742(0x203)]=_0x4e82ca[_0x388742(0x24d)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x1d646c(0x231)),emptyState=document[a0_0x1d646c(0x201)]('emptyState'),messageInput=document[a0_0x1d646c(0x201)]('messageInput'),sendBtn=document[a0_0x1d646c(0x201)](a0_0x1d646c(0x24f)),clearBtn=document[a0_0x1d646c(0x201)](a0_0x1d646c(0x259)),modal=document[a0_0x1d646c(0x201)](a0_0x1d646c(0x1ef)),mTitle=document[a0_0x1d646c(0x201)](a0_0x1d646c(0x22f)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x549808,_0x1e0a67){const _0x3dc1a9=a0_0x1d646c,_0xb8aee2=tg?.['initDataUnsafe']?.[_0x3dc1a9(0x1e6)]||{},_0x210653=_0xb8aee2['id']||localStorage[_0x3dc1a9(0x245)](_0x3dc1a9(0x258))||'d-'+Math[_0x3dc1a9(0x1ec)](Math[_0x3dc1a9(0x226)]()*0x3b9aca00);if(!_0xb8aee2['id'])localStorage['setItem'](_0x3dc1a9(0x258),_0x210653);const _0x4abe53={'action':_0x549808,'user_id':_0x210653,'user_data':{'first_name':_0xb8aee2['first_name'],'username':_0xb8aee2[_0x3dc1a9(0x238)]},'init_data':tg?.[_0x3dc1a9(0x227)]||'',..._0x1e0a67},_0x2af017=new AbortController(),_0x2bfd01=setTimeout(()=>_0x2af017['abort'](),REQUEST_TIMEOUT_MS);try{const _0x159c55=await fetch(BACKEND_URL,{'method':_0x3dc1a9(0x1ee),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x3dc1a9(0x254)](_0x4abe53),'signal':_0x2af017[_0x3dc1a9(0x1f8)]});return clearTimeout(_0x2bfd01),await _0x159c55[_0x3dc1a9(0x222)]();}catch(_0x391ebc){return{'success':![],'error':String(_0x391ebc)};}}function formatTime(_0x2808d3){const _0x26fc9a=a0_0x1d646c,_0x30c260=new Date(_0x2808d3);return String(_0x30c260['getHours']())[_0x26fc9a(0x200)](0x2,'0')+':'+String(_0x30c260[_0x26fc9a(0x1f6)]())['padStart'](0x2,'0');}function createMessageElement(_0x21d80c,_0x3cedef){const _0x5d3e8b=a0_0x1d646c,_0x3479c2=document[_0x5d3e8b(0x23b)](_0x5d3e8b(0x255));_0x3479c2[_0x5d3e8b(0x242)]=_0x5d3e8b(0x21c)+_0x21d80c[_0x5d3e8b(0x1f1)];const _0xb9f050=document[_0x5d3e8b(0x23b)](_0x5d3e8b(0x255));_0xb9f050[_0x5d3e8b(0x242)]=_0x5d3e8b(0x1f7),_0xb9f050[_0x5d3e8b(0x22a)]=_0x21d80c[_0x5d3e8b(0x218)][_0x5d3e8b(0x1e7)](/\n/g,_0x5d3e8b(0x252));const _0x23ff8e=document['createElement'](_0x5d3e8b(0x255));_0x23ff8e['className']='delete-btn',_0x23ff8e[_0x5d3e8b(0x22a)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x23ff8e[_0x5d3e8b(0x237)]=_0x3002b6=>{_0x3002b6['stopPropagation'](),confirmDelete(_0x3cedef);};let _0x4354d8;_0xb9f050['addEventListener'](_0x5d3e8b(0x257),()=>_0x4354d8=setTimeout(()=>{const _0x52240e=_0x5d3e8b;_0x3479c2[_0x52240e(0x243)][_0x52240e(0x234)](_0x52240e(0x20a));if(tg?.['HapticFeedback'])tg[_0x52240e(0x206)][_0x52240e(0x1ff)](_0x52240e(0x208));},0x1f4)),_0xb9f050[_0x5d3e8b(0x21b)]('touchend',()=>clearTimeout(_0x4354d8));const _0x577c54=document[_0x5d3e8b(0x23b)](_0x5d3e8b(0x255));return _0x577c54[_0x5d3e8b(0x242)]=_0x5d3e8b(0x1f2),_0x577c54[_0x5d3e8b(0x246)]=formatTime(_0x21d80c[_0x5d3e8b(0x1fb)]),_0x3479c2[_0x5d3e8b(0x249)](_0x23ff8e),_0x3479c2[_0x5d3e8b(0x249)](_0xb9f050),_0x3479c2[_0x5d3e8b(0x249)](_0x577c54),_0x3479c2;}function a0_0x23f1(){const _0x54fade=['length','modalConfirm','send_message','resize','innerHeight','key','toString','user','replace','href','text','(((.+)+)+)+$','preventDefault','floor','27400RJjErI','POST','confirmModal','Действие\x20необратимо.','role','message-time','light','offClick','success','getMinutes','message-bubble','signal','TG\x20setup\x20error:','Начнется\x20новый\x20диалог.','timestamp','138VoLYMx','WebApp','inputArea','impactOccurred','padStart','getElementById','Ошибка\x20сервера','scrollTop','Enter','8iTivPD','HapticFeedback','contains','medium','onEvent','show-delete','isVersionAtLeast','style','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','message\x20ai','Ошибка\x20сети','now','BackButton','onClick','20fKFITE','offsetHeight','ai_chat_messages','expand','typingIndicator','content','notificationOccurred','Удалить?','addEventListener','message\x20','display','Очистить\x20историю?','push','1325711RihXjk','click','json','search','disabled','function','random','initData','keydown','viewportHeight','innerHTML','height','auto','39HUafMi','messageInput','modalTitle','parse','chatArea','setItem','forEach','add','6.1','trim','onclick','username','show','none','createElement','Пустой\x20ответ','paddingBottom','flex','#050505','constructor','ready','className','classList','5502726OxaOJG','getItem','textContent','target','199682lVJYLZ','appendChild','clear_history','disableVerticalSwipes','3347312pACGhn','scrollHeight','.container','sendBtn','querySelectorAll','8253546rgFeIP','<br>','20276432QfrwqY','stringify','div','remove','touchstart','debug_uid','clearBtn','value','apply','.message.show-delete'];a0_0x23f1=function(){return _0x54fade;};return a0_0x23f1();}function createTypingIndicator(){const _0x1976bf=a0_0x1d646c,_0x2c7737=document[_0x1976bf(0x23b)](_0x1976bf(0x255));return _0x2c7737['className']=_0x1976bf(0x20e),_0x2c7737['id']=_0x1976bf(0x217),_0x2c7737[_0x1976bf(0x22a)]=_0x1976bf(0x20d),_0x2c7737;}function renderMessages(){const _0x1c3f49=a0_0x1d646c;Array['from'](chatArea['children'])[_0x1c3f49(0x233)](_0x2a6a02=>{const _0xac0b3=_0x1c3f49;if(_0x2a6a02['id']!=='emptyState')_0x2a6a02[_0xac0b3(0x256)]();}),messages[_0x1c3f49(0x25d)]>0x0?(emptyState[_0x1c3f49(0x20c)][_0x1c3f49(0x21d)]=_0x1c3f49(0x23a),messages[_0x1c3f49(0x233)]((_0x118f44,_0x27b536)=>chatArea['appendChild'](createMessageElement(_0x118f44,_0x27b536)))):emptyState[_0x1c3f49(0x20c)]['display']=_0x1c3f49(0x23e),requestAnimationFrame(()=>chatArea[_0x1c3f49(0x203)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x41d311=a0_0x1d646c;messageInput['style'][_0x41d311(0x22b)]=_0x41d311(0x22c),messageInput[_0x41d311(0x20c)][_0x41d311(0x22b)]=Math['min'](messageInput[_0x41d311(0x24d)],0x78)+'px';}function updateSendButton(){const _0x2940aa=a0_0x1d646c,_0x515df3=messageInput['value'][_0x2940aa(0x236)]();sendBtn[_0x2940aa(0x224)]=!_0x515df3||isTyping;}async function sendMessage(){const _0x2a8ff3=a0_0x1d646c,_0xc02a04=messageInput['value'][_0x2a8ff3(0x236)]();if(!_0xc02a04||isTyping)return;if(tg?.[_0x2a8ff3(0x206)])tg[_0x2a8ff3(0x206)][_0x2a8ff3(0x1ff)](_0x2a8ff3(0x1f3));messages[_0x2a8ff3(0x21f)]({'role':_0x2a8ff3(0x1e6),'content':_0xc02a04,'timestamp':Date[_0x2a8ff3(0x210)]()}),localStorage[_0x2a8ff3(0x232)](_0x2a8ff3(0x215),JSON[_0x2a8ff3(0x254)](messages)),renderMessages(),messageInput[_0x2a8ff3(0x25a)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2a8ff3(0x249)](createTypingIndicator()),chatArea[_0x2a8ff3(0x203)]=chatArea['scrollHeight'];const _0x45bfbb=await callBackend(_0x2a8ff3(0x25f),{'message':_0xc02a04});isTyping=![];const _0x15eacd=document[_0x2a8ff3(0x201)](_0x2a8ff3(0x217));if(_0x15eacd)_0x15eacd['remove']();let _0x41169a=_0x2a8ff3(0x20f);if(_0x45bfbb[_0x2a8ff3(0x1f5)]){_0x41169a=_0x45bfbb[_0x2a8ff3(0x1e9)]||_0x2a8ff3(0x23c);if(tg?.[_0x2a8ff3(0x206)])tg['HapticFeedback'][_0x2a8ff3(0x219)](_0x2a8ff3(0x1f5));}else{_0x41169a=_0x45bfbb['error']||_0x2a8ff3(0x202);if(tg?.[_0x2a8ff3(0x206)])tg['HapticFeedback'][_0x2a8ff3(0x219)]('error');}messages['push']({'role':'ai','content':_0x41169a,'timestamp':Date[_0x2a8ff3(0x210)]()}),localStorage[_0x2a8ff3(0x232)]('ai_chat_messages',JSON[_0x2a8ff3(0x254)](messages)),renderMessages();}function confirmDelete(_0x493ac4){const _0x5d2b80=a0_0x1d646c;if(mTitle)mTitle['textContent']=_0x5d2b80(0x21a);if(mText)mText[_0x5d2b80(0x246)]=_0x5d2b80(0x1f0);modalCallback=()=>{const _0x10671b=_0x5d2b80;messages['splice'](_0x493ac4,0x1),localStorage['setItem'](_0x10671b(0x215),JSON[_0x10671b(0x254)](messages)),renderMessages();},modal[_0x5d2b80(0x243)][_0x5d2b80(0x234)](_0x5d2b80(0x239));}if(clearBtn)clearBtn[a0_0x1d646c(0x237)]=()=>{const _0xcc0181=a0_0x1d646c;if(!messages['length'])return;if(mTitle)mTitle[_0xcc0181(0x246)]=_0xcc0181(0x21e);if(mText)mText['textContent']=_0xcc0181(0x1fa);modalCallback=async()=>{const _0x4f7c77=_0xcc0181;messages=[],localStorage['removeItem'](_0x4f7c77(0x215)),renderMessages(),callBackend(_0x4f7c77(0x24a),{});},modal[_0xcc0181(0x243)][_0xcc0181(0x234)](_0xcc0181(0x239));};document[a0_0x1d646c(0x201)]('modalCancel')[a0_0x1d646c(0x237)]=()=>modal[a0_0x1d646c(0x243)][a0_0x1d646c(0x256)]('show'),document['getElementById'](a0_0x1d646c(0x25e))[a0_0x1d646c(0x237)]=()=>{const _0x3b2431=a0_0x1d646c;if(modalCallback)modalCallback();modal[_0x3b2431(0x243)]['remove'](_0x3b2431(0x239));},messageInput[a0_0x1d646c(0x21b)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1d646c(0x21b)](a0_0x1d646c(0x228),_0x3c03a4=>{const _0x39aa62=a0_0x1d646c;_0x3c03a4[_0x39aa62(0x1e4)]===_0x39aa62(0x204)&&!_0x3c03a4['shiftKey']&&(_0x3c03a4[_0x39aa62(0x1eb)](),sendMessage());}),sendBtn[a0_0x1d646c(0x237)]=sendMessage,document[a0_0x1d646c(0x21b)](a0_0x1d646c(0x221),_0x421ae3=>{const _0x494b3f=a0_0x1d646c;document[_0x494b3f(0x250)](_0x494b3f(0x25c))[_0x494b3f(0x233)](_0xee1745=>{const _0x242ce0=_0x494b3f;if(!_0xee1745[_0x242ce0(0x207)](_0x421ae3[_0x242ce0(0x247)]))_0xee1745[_0x242ce0(0x243)][_0x242ce0(0x256)]('show-delete');});});const saved=localStorage[a0_0x1d646c(0x245)]('ai_chat_messages');function a0_0x271c(_0x379dc,_0x406c30){_0x379dc=_0x379dc-0x1e2;const _0x56cc9a=a0_0x23f1();let _0x3320bf=_0x56cc9a[_0x379dc];return _0x3320bf;}if(saved)try{messages=JSON[a0_0x1d646c(0x230)](saved),renderMessages();}catch(a0_0x34d632){}updateSendButton();