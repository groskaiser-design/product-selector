const a0_0x69673a=a0_0x3b5c;(function(_0x1b54e5,_0x557ffd){const _0x24d5d1=a0_0x3b5c,_0x589236=_0x1b54e5();while(!![]){try{const _0x54deb1=-parseInt(_0x24d5d1(0xc7))/0x1+parseInt(_0x24d5d1(0xda))/0x2+-parseInt(_0x24d5d1(0xfb))/0x3+-parseInt(_0x24d5d1(0xd4))/0x4*(parseInt(_0x24d5d1(0xf9))/0x5)+-parseInt(_0x24d5d1(0xee))/0x6*(-parseInt(_0x24d5d1(0xce))/0x7)+-parseInt(_0x24d5d1(0xc8))/0x8+-parseInt(_0x24d5d1(0xf8))/0x9*(-parseInt(_0x24d5d1(0xbe))/0xa);if(_0x54deb1===_0x557ffd)break;else _0x589236['push'](_0x589236['shift']());}catch(_0x2ae21d){_0x589236['push'](_0x589236['shift']());}}}(a0_0x1141,0xce4ea));const tg=window[a0_0x69673a(0xc0)]?.[a0_0x69673a(0xd7)],HOME_URL=a0_0x69673a(0xb1);function setupTelegramBackButton(){const _0xce3289=a0_0x69673a,_0x14419a=(function(){let _0x1c727f=!![];return function(_0x4fd326,_0x59857a){const _0x300c65=_0x1c727f?function(){const _0x358cd6=a0_0x3b5c;if(_0x59857a){const _0x322b81=_0x59857a[_0x358cd6(0xf4)](_0x4fd326,arguments);return _0x59857a=null,_0x322b81;}}:function(){};return _0x1c727f=![],_0x300c65;};}()),_0x1d0f3e=_0x14419a(this,function(){const _0x57fdb6=a0_0x3b5c;return _0x1d0f3e[_0x57fdb6(0xe3)]()[_0x57fdb6(0xbc)](_0x57fdb6(0xb6))[_0x57fdb6(0xe3)]()[_0x57fdb6(0xd1)](_0x1d0f3e)[_0x57fdb6(0xbc)]('(((.+)+)+)+$');});_0x1d0f3e();if(!tg)return;try{tg[_0xce3289(0x11e)](),tg[_0xce3289(0x129)](),tg[_0xce3289(0xef)]?.(_0xce3289(0x11f));if(tg['isVersionAtLeast']?.(_0xce3289(0x10a)))tg[_0xce3289(0xe0)]?.();const _0x3e569f=tg[_0xce3289(0xb3)];if(_0x3e569f){_0x3e569f[_0xce3289(0x116)]();if(typeof _0x3e569f['offClick']===_0xce3289(0xfd))try{_0x3e569f[_0xce3289(0x11b)]();}catch(_0x523362){}_0x3e569f[_0xce3289(0xb8)](()=>{const _0x4fde7b=_0xce3289;if(tg[_0x4fde7b(0xb9)])tg['HapticFeedback'][_0x4fde7b(0xfc)](_0x4fde7b(0xc3));location[_0x4fde7b(0x117)]=HOME_URL;});}}catch(_0x518b1f){console[_0xce3289(0x102)](_0xce3289(0x109),_0x518b1f);}}(function initStableLayout(){const _0x2483bd=a0_0x69673a,_0xce6cdd=document['querySelector'](_0x2483bd(0x107)),_0x600abe=document[_0x2483bd(0xc4)]('inputArea'),_0x273ac3=document['getElementById']('chatArea'),_0x1ed24a=document['getElementById']('messageInput');function _0x25f8b3(){const _0x1149d6=_0x2483bd;if(!_0xce6cdd)return;const _0x20ba8e=tg&&tg[_0x1149d6(0x10f)]?tg['viewportHeight']:window['innerHeight'];_0xce6cdd[_0x1149d6(0x106)][_0x1149d6(0xc9)]=_0x20ba8e+'px';if(_0x600abe){const _0x4f35af=_0x600abe[_0x1149d6(0x12e)];_0x273ac3[_0x1149d6(0x106)][_0x1149d6(0xd5)]=_0x4f35af+0x28+'px';}}tg?tg[_0x2483bd(0x112)](_0x2483bd(0xc5),({isStateStable:_0x3bb8fc})=>{_0x25f8b3();if(_0x3bb8fc)requestAnimationFrame(()=>{const _0x18d4fd=a0_0x3b5c;_0x273ac3[_0x18d4fd(0xeb)]=_0x273ac3[_0x18d4fd(0xca)];});}):window['addEventListener'](_0x2483bd(0xe7),_0x25f8b3),_0x25f8b3(),_0x1ed24a&&(_0x1ed24a[_0x2483bd(0xea)](_0x2483bd(0x12c),()=>{requestAnimationFrame(_0x25f8b3);}),_0x1ed24a[_0x2483bd(0xea)](_0x2483bd(0xf0),()=>{setTimeout(()=>{const _0x57c46a=a0_0x3b5c;_0x273ac3[_0x57c46a(0xeb)]=_0x273ac3[_0x57c46a(0xca)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x69673a(0xba),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x69673a(0xc4)](a0_0x69673a(0xbf)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x69673a(0xc4)]('messageInput'),sendBtn=document[a0_0x69673a(0xc4)]('sendBtn'),clearBtn=document[a0_0x69673a(0xc4)]('clearBtn'),modal=document[a0_0x69673a(0xc4)](a0_0x69673a(0x122)),mTitle=document[a0_0x69673a(0xc4)](a0_0x69673a(0xd8)),mText=document[a0_0x69673a(0xc4)](a0_0x69673a(0xf7));let modalCallback=null;async function callBackend(_0x3945e5,_0x4eecc1){const _0x52f870=a0_0x69673a,_0x553da8=tg?.[_0x52f870(0x11d)]?.[_0x52f870(0xe9)]||{},_0x2206a5=_0x553da8['id']||localStorage[_0x52f870(0x126)](_0x52f870(0x10b))||'d-'+Math[_0x52f870(0x125)](Math[_0x52f870(0x10e)]()*0x3b9aca00);if(!_0x553da8['id'])localStorage[_0x52f870(0x105)](_0x52f870(0x10b),_0x2206a5);const _0x4790eb={'action':_0x3945e5,'user_id':_0x2206a5,'user_data':{'first_name':_0x553da8[_0x52f870(0xf5)],'username':_0x553da8[_0x52f870(0xe5)]},'init_data':tg?.[_0x52f870(0x103)]||'',..._0x4eecc1},_0x9e95b0=new AbortController(),_0xe84156=setTimeout(()=>_0x9e95b0[_0x52f870(0xe8)](),REQUEST_TIMEOUT_MS);try{const _0x57355f=await fetch(BACKEND_URL,{'method':_0x52f870(0xb4),'headers':{'Content-Type':_0x52f870(0xf1)},'body':JSON[_0x52f870(0x104)](_0x4790eb),'signal':_0x9e95b0[_0x52f870(0x119)]});return clearTimeout(_0xe84156),await _0x57355f['json']();}catch(_0x4a2211){return{'success':![],'error':String(_0x4a2211)};}}function formatTime(_0x45405d){const _0x14fe9a=a0_0x69673a,_0x5143f8=new Date(_0x45405d);return String(_0x5143f8[_0x14fe9a(0x101)]())[_0x14fe9a(0x110)](0x2,'0')+':'+String(_0x5143f8[_0x14fe9a(0x10c)]())[_0x14fe9a(0x110)](0x2,'0');}function a0_0x3b5c(_0x411080,_0x5df48b){_0x411080=_0x411080-0xac;const _0x319176=a0_0x1141();let _0xdc8d41=_0x319176[_0x411080];return _0xdc8d41;}function createMessageElement(_0x452f9e,_0x2a6e04){const _0x106ded=a0_0x69673a,_0x12edaf=document['createElement'](_0x106ded(0x114));_0x12edaf[_0x106ded(0xac)]=_0x106ded(0x12b)+_0x452f9e[_0x106ded(0xae)];const _0x448437=document[_0x106ded(0xed)](_0x106ded(0x114));_0x448437[_0x106ded(0xac)]=_0x106ded(0xcf),_0x448437[_0x106ded(0xfe)]=_0x452f9e[_0x106ded(0xdc)]['replace'](/\n/g,_0x106ded(0xbd));const _0x3a5f6f=document['createElement'](_0x106ded(0x114));_0x3a5f6f[_0x106ded(0xac)]=_0x106ded(0x124),_0x3a5f6f[_0x106ded(0xfe)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x3a5f6f['onclick']=_0x31c002=>{_0x31c002['stopPropagation'](),confirmDelete(_0x2a6e04);};let _0x855715;_0x448437[_0x106ded(0xea)](_0x106ded(0xd0),()=>_0x855715=setTimeout(()=>{const _0xe97485=_0x106ded;_0x12edaf[_0xe97485(0xb0)][_0xe97485(0xaf)]('show-delete');if(tg?.[_0xe97485(0xb9)])tg[_0xe97485(0xb9)][_0xe97485(0xfc)](_0xe97485(0xb7));},0x1f4)),_0x448437[_0x106ded(0xea)](_0x106ded(0xcc),()=>clearTimeout(_0x855715));const _0x3f779e=document['createElement'](_0x106ded(0x114));return _0x3f779e['className']=_0x106ded(0xb5),_0x3f779e[_0x106ded(0xb2)]=formatTime(_0x452f9e[_0x106ded(0xe1)]),_0x12edaf[_0x106ded(0x120)](_0x3a5f6f),_0x12edaf[_0x106ded(0x120)](_0x448437),_0x12edaf[_0x106ded(0x120)](_0x3f779e),_0x12edaf;}function createTypingIndicator(){const _0x3b6a79=a0_0x69673a,_0x2be934=document['createElement'](_0x3b6a79(0x114));return _0x2be934[_0x3b6a79(0xac)]=_0x3b6a79(0x12a),_0x2be934['id']=_0x3b6a79(0xfa),_0x2be934[_0x3b6a79(0xfe)]=_0x3b6a79(0xcd),_0x2be934;}function renderMessages(){const _0x383310=a0_0x69673a;Array[_0x383310(0xec)](chatArea[_0x383310(0xe2)])['forEach'](_0x5a8ab5=>{const _0x4ea5b0=_0x383310;if(_0x5a8ab5['id']!==_0x4ea5b0(0xd2))_0x5a8ab5[_0x4ea5b0(0xde)]();}),messages[_0x383310(0xe4)]>0x0?(emptyState[_0x383310(0x106)][_0x383310(0xc2)]=_0x383310(0x121),messages[_0x383310(0xdd)]((_0x523883,_0x16fc71)=>chatArea['appendChild'](createMessageElement(_0x523883,_0x16fc71)))):emptyState[_0x383310(0x106)][_0x383310(0xc2)]=_0x383310(0xc1),requestAnimationFrame(()=>chatArea[_0x383310(0xeb)]=chatArea[_0x383310(0xca)]);}function autoResizeTextarea(){const _0x52dc2a=a0_0x69673a;messageInput[_0x52dc2a(0x106)]['height']=_0x52dc2a(0x11c),messageInput[_0x52dc2a(0x106)][_0x52dc2a(0xc9)]=Math[_0x52dc2a(0xd3)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x5f1503=a0_0x69673a,_0x196064=messageInput['value'][_0x5f1503(0x111)]();sendBtn[_0x5f1503(0xbb)]=!_0x196064||isTyping;}function a0_0x1141(){const _0x180848=['notificationOccurred','apply','first_name','value','modalText','288JBRzfV','45765LKYqmD','typingIndicator','2640780Auavsf','impactOccurred','function','innerHTML','parse','key','getHours','warn','initData','stringify','setItem','style','.container','splice','TG\x20setup\x20error:','6.1','debug_uid','getMinutes','.message.show-delete','random','viewportHeight','padStart','trim','onEvent','success','div','Действие\x20необратимо.','show','href','Удалить?','signal','modalCancel','offClick','auto','initDataUnsafe','ready','#050505','appendChild','none','confirmModal','send_message','delete-btn','floor','getItem','shiftKey','modalConfirm','expand','message\x20ai','message\x20','input','ai_chat_messages','offsetHeight','className','contains','role','add','classList','./router.html','textContent','BackButton','POST','message-time','(((.+)+)+)+$','medium','onClick','HapticFeedback','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','disabled','search','<br>','1074340ySXIdT','chatArea','Telegram','flex','display','light','getElementById','viewportChanged','onclick','657824JPsRJa','12695184taEPNR','height','scrollHeight','now','touchend','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','75131ISDGsC','message-bubble','touchstart','constructor','emptyState','min','72EXRwRT','paddingBottom','clear_history','WebApp','modalTitle','Очистить\x20историю?','1114706uqZiVg','push','content','forEach','remove','show-delete','disableVerticalSwipes','timestamp','children','toString','length','username','Ошибка\x20сервера','resize','abort','user','addEventListener','scrollTop','from','createElement','78IQPfwt','setHeaderColor','focus','text/plain','text'];a0_0x1141=function(){return _0x180848;};return a0_0x1141();}async function sendMessage(){const _0x581487=a0_0x69673a,_0x1c4c93=messageInput[_0x581487(0xf6)][_0x581487(0x111)]();if(!_0x1c4c93||isTyping)return;if(tg?.[_0x581487(0xb9)])tg['HapticFeedback'][_0x581487(0xfc)](_0x581487(0xc3));messages[_0x581487(0xdb)]({'role':_0x581487(0xe9),'content':_0x1c4c93,'timestamp':Date[_0x581487(0xcb)]()}),localStorage['setItem'](_0x581487(0x12d),JSON[_0x581487(0x104)](messages)),renderMessages(),messageInput[_0x581487(0xf6)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x581487(0x120)](createTypingIndicator()),chatArea[_0x581487(0xeb)]=chatArea[_0x581487(0xca)];const _0x33f45f=await callBackend(_0x581487(0x123),{'message':_0x1c4c93});isTyping=![];const _0x1fe4a5=document['getElementById']('typingIndicator');if(_0x1fe4a5)_0x1fe4a5[_0x581487(0xde)]();let _0x538e47='Ошибка\x20сети';if(_0x33f45f[_0x581487(0x113)]){_0x538e47=_0x33f45f[_0x581487(0xf2)]||'Пустой\x20ответ';if(tg?.[_0x581487(0xb9)])tg[_0x581487(0xb9)][_0x581487(0xf3)]('success');}else{_0x538e47=_0x33f45f['error']||_0x581487(0xe6);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x581487(0xf3)]('error');}messages['push']({'role':'ai','content':_0x538e47,'timestamp':Date[_0x581487(0xcb)]()}),localStorage['setItem'](_0x581487(0x12d),JSON[_0x581487(0x104)](messages)),renderMessages();}function confirmDelete(_0x22928f){const _0x52b885=a0_0x69673a;if(mTitle)mTitle[_0x52b885(0xb2)]=_0x52b885(0x118);if(mText)mText[_0x52b885(0xb2)]=_0x52b885(0x115);modalCallback=()=>{const _0x1cf586=_0x52b885;messages[_0x1cf586(0x108)](_0x22928f,0x1),localStorage['setItem'](_0x1cf586(0x12d),JSON[_0x1cf586(0x104)](messages)),renderMessages();},modal[_0x52b885(0xb0)]['add'](_0x52b885(0x116));}if(clearBtn)clearBtn[a0_0x69673a(0xc6)]=()=>{const _0x5a1389=a0_0x69673a;if(!messages[_0x5a1389(0xe4)])return;if(mTitle)mTitle[_0x5a1389(0xb2)]=_0x5a1389(0xd9);if(mText)mText['textContent']='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x507908=_0x5a1389;messages=[],localStorage['removeItem'](_0x507908(0x12d)),renderMessages(),callBackend(_0x507908(0xd6),{});},modal[_0x5a1389(0xb0)][_0x5a1389(0xaf)]('show');};document[a0_0x69673a(0xc4)](a0_0x69673a(0x11a))['onclick']=()=>modal['classList']['remove'](a0_0x69673a(0x116)),document[a0_0x69673a(0xc4)](a0_0x69673a(0x128))['onclick']=()=>{const _0x19fe6a=a0_0x69673a;if(modalCallback)modalCallback();modal[_0x19fe6a(0xb0)][_0x19fe6a(0xde)]('show');},messageInput['addEventListener'](a0_0x69673a(0x12c),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x57683d=>{const _0x5141d7=a0_0x69673a;_0x57683d[_0x5141d7(0x100)]==='Enter'&&!_0x57683d[_0x5141d7(0x127)]&&(_0x57683d['preventDefault'](),sendMessage());}),sendBtn[a0_0x69673a(0xc6)]=sendMessage,document['addEventListener']('click',_0x35b17e=>{const _0x20a556=a0_0x69673a;document['querySelectorAll'](_0x20a556(0x10d))[_0x20a556(0xdd)](_0x16e085=>{const _0x2be481=_0x20a556;if(!_0x16e085[_0x2be481(0xad)](_0x35b17e['target']))_0x16e085['classList'][_0x2be481(0xde)](_0x2be481(0xdf));});});const saved=localStorage[a0_0x69673a(0x126)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x69673a(0xff)](saved),renderMessages();}catch(a0_0x548b76){}updateSendButton();