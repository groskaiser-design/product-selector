const a0_0x26d197=a0_0x8112;(function(_0x32e194,_0x2a66ee){const _0x5937be=a0_0x8112,_0x22b334=_0x32e194();while(!![]){try{const _0x36056f=parseInt(_0x5937be(0x19d))/0x1*(parseInt(_0x5937be(0x1cc))/0x2)+-parseInt(_0x5937be(0x187))/0x3+-parseInt(_0x5937be(0x1b3))/0x4+parseInt(_0x5937be(0x1b9))/0x5+parseInt(_0x5937be(0x179))/0x6+-parseInt(_0x5937be(0x19b))/0x7*(-parseInt(_0x5937be(0x17e))/0x8)+-parseInt(_0x5937be(0x19f))/0x9*(parseInt(_0x5937be(0x1ba))/0xa);if(_0x36056f===_0x2a66ee)break;else _0x22b334['push'](_0x22b334['shift']());}catch(_0xe7c8df){_0x22b334['push'](_0x22b334['shift']());}}}(a0_0x1524,0xaf35e));const tg=window[a0_0x26d197(0x1cd)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x4de805=a0_0x26d197,_0x4636bb=(function(){let _0xe7924e=!![];return function(_0x441519,_0x5aedc2){const _0x343d48=_0xe7924e?function(){const _0x2c4ee9=a0_0x8112;if(_0x5aedc2){const _0x173184=_0x5aedc2[_0x2c4ee9(0x18a)](_0x441519,arguments);return _0x5aedc2=null,_0x173184;}}:function(){};return _0xe7924e=![],_0x343d48;};}()),_0x8e874f=_0x4636bb(this,function(){const _0x23eadf=a0_0x8112;return _0x8e874f['toString']()['search']('(((.+)+)+)+$')[_0x23eadf(0x1d8)]()['constructor'](_0x8e874f)[_0x23eadf(0x1b4)]('(((.+)+)+)+$');});_0x8e874f();if(!tg)return;try{tg[_0x4de805(0x1b8)](),tg[_0x4de805(0x163)](),tg[_0x4de805(0x173)]?.(_0x4de805(0x1bc));if(tg[_0x4de805(0x1a7)]?.(_0x4de805(0x18c)))tg[_0x4de805(0x164)]?.();const _0x78282c=tg[_0x4de805(0x161)];if(_0x78282c){_0x78282c[_0x4de805(0x193)]();if(typeof _0x78282c[_0x4de805(0x18d)]===_0x4de805(0x160))try{_0x78282c[_0x4de805(0x18d)]();}catch(_0x38330f){}_0x78282c['onClick'](()=>{const _0x6bb9c=_0x4de805;if(tg[_0x6bb9c(0x17c)])tg[_0x6bb9c(0x17c)][_0x6bb9c(0x167)](_0x6bb9c(0x176));location[_0x6bb9c(0x1af)]=HOME_URL;});}}catch(_0xb97d1e){console[_0x4de805(0x1c6)](_0x4de805(0x1b5),_0xb97d1e);}}(function initStableLayout(){const _0x7b52=a0_0x26d197,_0x1dc6b5=document[_0x7b52(0x1c7)](_0x7b52(0x1b7)),_0x5f335e=document[_0x7b52(0x172)]('inputArea'),_0x1d9d56=document[_0x7b52(0x172)](_0x7b52(0x1c1)),_0x34d46f=document[_0x7b52(0x172)](_0x7b52(0x1c9));function _0x597670(){const _0x14745e=_0x7b52;if(!_0x1dc6b5)return;const _0x41a9b4=tg&&tg['viewportHeight']?tg[_0x14745e(0x181)]:window[_0x14745e(0x1aa)];_0x1dc6b5[_0x14745e(0x165)][_0x14745e(0x1c3)]=_0x41a9b4+'px';if(_0x5f335e){const _0x2b2c0e=_0x5f335e[_0x14745e(0x184)];_0x1d9d56[_0x14745e(0x165)][_0x14745e(0x1d0)]=_0x2b2c0e+0x28+'px';}}tg?tg[_0x7b52(0x1bd)](_0x7b52(0x1b1),({isStateStable:_0x373f07})=>{_0x597670();if(_0x373f07)requestAnimationFrame(()=>{const _0x136cc7=a0_0x8112;_0x1d9d56['scrollTop']=_0x1d9d56[_0x136cc7(0x1cf)];});}):window[_0x7b52(0x1b2)](_0x7b52(0x178),_0x597670),_0x597670(),_0x34d46f&&(_0x34d46f['addEventListener']('input',()=>{requestAnimationFrame(_0x597670);}),_0x34d46f['addEventListener']('focus',()=>{setTimeout(()=>{const _0x2ca085=a0_0x8112;_0x1d9d56['scrollTop']=_0x1d9d56[_0x2ca085(0x1cf)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x8112(_0x3fafac,_0x4f6e80){_0x3fafac=_0x3fafac-0x158;const _0x379a11=a0_0x1524();let _0x2ed8a6=_0x379a11[_0x3fafac];return _0x2ed8a6;}function a0_0x1524(){const _0x1c13ca=['clearBtn','offsetHeight','username','confirmModal','1866924pgcjPU','classList','textContent','apply','querySelectorAll','6.1','offClick','now','<br>','modalTitle','message-bubble','signal','show','children','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','debug_uid','error','className','setItem','role','1071LNiGkW','scrollTop','4UNroed','text/plain','2871uYgWoW','initData','message-time','success','removeItem','disabled','touchstart','stringify','isVersionAtLeast','POST','parse','innerHeight','first_name','div','Enter','text','href','value','viewportChanged','addEventListener','1856156IKATOH','search','TG\x20setup\x20error:','target','.container','ready','1247135qMJVIW','15220ToZEBX','Удалить?','#050505','onEvent','key','click','getMinutes','chatArea','emptyState','height','contains','onclick','warn','querySelector','touchend','messageInput','flex','createElement','263324vGpHWo','Telegram','shiftKey','scrollHeight','paddingBottom','floor','message\x20','Начнется\x20новый\x20диалог.','forEach','modalText','timestamp','from','toString','.message.show-delete','preventDefault','display','sendBtn','medium','innerHTML','splice','show-delete','function','BackButton','random','expand','disableVerticalSwipes','style','initDataUnsafe','impactOccurred','padStart','json','notificationOccurred','stopPropagation','getItem','appendChild','user','length','Действие\x20необратимо.','remove','getElementById','setHeaderColor','auto','typingIndicator','light','ai_chat_messages','resize','8489520cGhKyS','add','Очистить\x20историю?','HapticFeedback','send_message','5152xJmtAb','trim','Пустой\x20ответ','viewportHeight','keydown'];a0_0x1524=function(){return _0x1c13ca;};return a0_0x1524();}const chatArea=document[a0_0x26d197(0x172)]('chatArea'),emptyState=document[a0_0x26d197(0x172)](a0_0x26d197(0x1c2)),messageInput=document[a0_0x26d197(0x172)](a0_0x26d197(0x1c9)),sendBtn=document[a0_0x26d197(0x172)](a0_0x26d197(0x15b)),clearBtn=document[a0_0x26d197(0x172)](a0_0x26d197(0x183)),modal=document['getElementById'](a0_0x26d197(0x186)),mTitle=document[a0_0x26d197(0x172)](a0_0x26d197(0x190)),mText=document[a0_0x26d197(0x172)](a0_0x26d197(0x1d5));let modalCallback=null;async function callBackend(_0x370595,_0x49c8e5){const _0x115a05=a0_0x26d197,_0x4d3eb4=tg?.[_0x115a05(0x166)]?.[_0x115a05(0x16e)]||{},_0x920da=_0x4d3eb4['id']||localStorage[_0x115a05(0x16c)](_0x115a05(0x196))||'d-'+Math[_0x115a05(0x1d1)](Math[_0x115a05(0x162)]()*0x3b9aca00);if(!_0x4d3eb4['id'])localStorage[_0x115a05(0x199)](_0x115a05(0x196),_0x920da);const _0x40cbac={'action':_0x370595,'user_id':_0x920da,'user_data':{'first_name':_0x4d3eb4[_0x115a05(0x1ab)],'username':_0x4d3eb4[_0x115a05(0x185)]},'init_data':tg?.[_0x115a05(0x1a0)]||'',..._0x49c8e5},_0x3f0a51=new AbortController(),_0x2d8458=setTimeout(()=>_0x3f0a51['abort'](),REQUEST_TIMEOUT_MS);try{const _0x2c1c21=await fetch(BACKEND_URL,{'method':_0x115a05(0x1a8),'headers':{'Content-Type':_0x115a05(0x19e)},'body':JSON[_0x115a05(0x1a6)](_0x40cbac),'signal':_0x3f0a51[_0x115a05(0x192)]});return clearTimeout(_0x2d8458),await _0x2c1c21[_0x115a05(0x169)]();}catch(_0x568575){return{'success':![],'error':String(_0x568575)};}}function formatTime(_0xe85827){const _0x3d9c04=a0_0x26d197,_0x590829=new Date(_0xe85827);return String(_0x590829['getHours']())[_0x3d9c04(0x168)](0x2,'0')+':'+String(_0x590829[_0x3d9c04(0x1c0)]())[_0x3d9c04(0x168)](0x2,'0');}function createMessageElement(_0x317fe2,_0x1a27f9){const _0x5ee9a1=a0_0x26d197,_0x353e75=document[_0x5ee9a1(0x1cb)](_0x5ee9a1(0x1ac));_0x353e75['className']=_0x5ee9a1(0x1d2)+_0x317fe2[_0x5ee9a1(0x19a)];const _0x3b53e6=document[_0x5ee9a1(0x1cb)](_0x5ee9a1(0x1ac));_0x3b53e6[_0x5ee9a1(0x198)]=_0x5ee9a1(0x191),_0x3b53e6[_0x5ee9a1(0x15d)]=_0x317fe2['content']['replace'](/\n/g,_0x5ee9a1(0x18f));const _0x5d6b7c=document[_0x5ee9a1(0x1cb)](_0x5ee9a1(0x1ac));_0x5d6b7c[_0x5ee9a1(0x198)]='delete-btn',_0x5d6b7c[_0x5ee9a1(0x15d)]=_0x5ee9a1(0x195),_0x5d6b7c[_0x5ee9a1(0x1c5)]=_0x240ae2=>{const _0x956a69=_0x5ee9a1;_0x240ae2[_0x956a69(0x16b)](),confirmDelete(_0x1a27f9);};let _0x464a7a;_0x3b53e6[_0x5ee9a1(0x1b2)](_0x5ee9a1(0x1a5),()=>_0x464a7a=setTimeout(()=>{const _0x28af4f=_0x5ee9a1;_0x353e75[_0x28af4f(0x188)]['add']('show-delete');if(tg?.[_0x28af4f(0x17c)])tg[_0x28af4f(0x17c)][_0x28af4f(0x167)](_0x28af4f(0x15c));},0x1f4)),_0x3b53e6[_0x5ee9a1(0x1b2)](_0x5ee9a1(0x1c8),()=>clearTimeout(_0x464a7a));const _0x5353ba=document[_0x5ee9a1(0x1cb)](_0x5ee9a1(0x1ac));return _0x5353ba[_0x5ee9a1(0x198)]=_0x5ee9a1(0x1a1),_0x5353ba['textContent']=formatTime(_0x317fe2[_0x5ee9a1(0x1d6)]),_0x353e75[_0x5ee9a1(0x16d)](_0x5d6b7c),_0x353e75[_0x5ee9a1(0x16d)](_0x3b53e6),_0x353e75['appendChild'](_0x5353ba),_0x353e75;}function createTypingIndicator(){const _0x5899b9=a0_0x26d197,_0x364f6a=document[_0x5899b9(0x1cb)]('div');return _0x364f6a['className']='message\x20ai',_0x364f6a['id']=_0x5899b9(0x175),_0x364f6a[_0x5899b9(0x15d)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x364f6a;}function renderMessages(){const _0x303142=a0_0x26d197;Array[_0x303142(0x1d7)](chatArea[_0x303142(0x194)])[_0x303142(0x1d4)](_0x50b0bc=>{const _0x104c1a=_0x303142;if(_0x50b0bc['id']!==_0x104c1a(0x1c2))_0x50b0bc[_0x104c1a(0x171)]();}),messages['length']>0x0?(emptyState[_0x303142(0x165)][_0x303142(0x15a)]='none',messages[_0x303142(0x1d4)]((_0x32b8fd,_0x291572)=>chatArea[_0x303142(0x16d)](createMessageElement(_0x32b8fd,_0x291572)))):emptyState[_0x303142(0x165)][_0x303142(0x15a)]=_0x303142(0x1ca),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x303142(0x1cf)]);}function autoResizeTextarea(){const _0x405ad9=a0_0x26d197;messageInput[_0x405ad9(0x165)]['height']=_0x405ad9(0x174),messageInput['style'][_0x405ad9(0x1c3)]=Math['min'](messageInput[_0x405ad9(0x1cf)],0x78)+'px';}function updateSendButton(){const _0x41f57c=a0_0x26d197,_0x170797=messageInput[_0x41f57c(0x1b0)]['trim']();sendBtn[_0x41f57c(0x1a4)]=!_0x170797||isTyping;}async function sendMessage(){const _0x2d244c=a0_0x26d197,_0x38edb2=messageInput[_0x2d244c(0x1b0)][_0x2d244c(0x17f)]();if(!_0x38edb2||isTyping)return;if(tg?.[_0x2d244c(0x17c)])tg[_0x2d244c(0x17c)][_0x2d244c(0x167)](_0x2d244c(0x176));messages['push']({'role':_0x2d244c(0x16e),'content':_0x38edb2,'timestamp':Date[_0x2d244c(0x18e)]()}),localStorage[_0x2d244c(0x199)](_0x2d244c(0x177),JSON[_0x2d244c(0x1a6)](messages)),renderMessages(),messageInput[_0x2d244c(0x1b0)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2d244c(0x16d)](createTypingIndicator()),chatArea[_0x2d244c(0x19c)]=chatArea['scrollHeight'];const _0x9da940=await callBackend(_0x2d244c(0x17d),{'message':_0x38edb2});isTyping=![];const _0x37d804=document[_0x2d244c(0x172)]('typingIndicator');if(_0x37d804)_0x37d804[_0x2d244c(0x171)]();let _0x329a6c='Ошибка\x20сети';if(_0x9da940[_0x2d244c(0x1a2)]){_0x329a6c=_0x9da940[_0x2d244c(0x1ae)]||_0x2d244c(0x180);if(tg?.[_0x2d244c(0x17c)])tg[_0x2d244c(0x17c)][_0x2d244c(0x16a)]('success');}else{_0x329a6c=_0x9da940[_0x2d244c(0x197)]||'Ошибка\x20сервера';if(tg?.[_0x2d244c(0x17c)])tg[_0x2d244c(0x17c)]['notificationOccurred'](_0x2d244c(0x197));}messages['push']({'role':'ai','content':_0x329a6c,'timestamp':Date[_0x2d244c(0x18e)]()}),localStorage[_0x2d244c(0x199)](_0x2d244c(0x177),JSON[_0x2d244c(0x1a6)](messages)),renderMessages();}function confirmDelete(_0x146904){const _0x2b43b6=a0_0x26d197;if(mTitle)mTitle[_0x2b43b6(0x189)]=_0x2b43b6(0x1bb);if(mText)mText['textContent']=_0x2b43b6(0x170);modalCallback=()=>{const _0x1ba6e7=_0x2b43b6;messages[_0x1ba6e7(0x15e)](_0x146904,0x1),localStorage[_0x1ba6e7(0x199)](_0x1ba6e7(0x177),JSON[_0x1ba6e7(0x1a6)](messages)),renderMessages();},modal['classList'][_0x2b43b6(0x17a)]('show');}if(clearBtn)clearBtn[a0_0x26d197(0x1c5)]=()=>{const _0x3a0559=a0_0x26d197;if(!messages[_0x3a0559(0x16f)])return;if(mTitle)mTitle['textContent']=_0x3a0559(0x17b);if(mText)mText[_0x3a0559(0x189)]=_0x3a0559(0x1d3);modalCallback=async()=>{const _0x43f326=_0x3a0559;messages=[],localStorage[_0x43f326(0x1a3)](_0x43f326(0x177)),renderMessages(),callBackend('clear_history',{});},modal[_0x3a0559(0x188)]['add']('show');};document[a0_0x26d197(0x172)]('modalCancel')[a0_0x26d197(0x1c5)]=()=>modal['classList']['remove'](a0_0x26d197(0x193)),document[a0_0x26d197(0x172)]('modalConfirm')[a0_0x26d197(0x1c5)]=()=>{const _0x5e79c1=a0_0x26d197;if(modalCallback)modalCallback();modal[_0x5e79c1(0x188)]['remove'](_0x5e79c1(0x193));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x26d197(0x1b2)](a0_0x26d197(0x182),_0x45921a=>{const _0x58c8fe=a0_0x26d197;_0x45921a[_0x58c8fe(0x1be)]===_0x58c8fe(0x1ad)&&!_0x45921a[_0x58c8fe(0x1ce)]&&(_0x45921a[_0x58c8fe(0x159)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x26d197(0x1b2)](a0_0x26d197(0x1bf),_0x24439b=>{const _0x3c7734=a0_0x26d197;document[_0x3c7734(0x18b)](_0x3c7734(0x158))[_0x3c7734(0x1d4)](_0x5ad22c=>{const _0x23604d=_0x3c7734;if(!_0x5ad22c[_0x23604d(0x1c4)](_0x24439b[_0x23604d(0x1b6)]))_0x5ad22c['classList'][_0x23604d(0x171)](_0x23604d(0x15f));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x26d197(0x1a9)](saved),renderMessages();}catch(a0_0x5c03a5){}updateSendButton();