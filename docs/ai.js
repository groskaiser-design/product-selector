const a0_0x207ae2=a0_0xa3b6;(function(_0x1e1426,_0x102a38){const _0x4d905d=a0_0xa3b6,_0x5aab39=_0x1e1426();while(!![]){try{const _0x12bec9=parseInt(_0x4d905d(0x1c9))/0x1+parseInt(_0x4d905d(0x1a2))/0x2*(parseInt(_0x4d905d(0x187))/0x3)+parseInt(_0x4d905d(0x18d))/0x4+parseInt(_0x4d905d(0x1c7))/0x5+parseInt(_0x4d905d(0x16f))/0x6*(parseInt(_0x4d905d(0x196))/0x7)+parseInt(_0x4d905d(0x1c1))/0x8+-parseInt(_0x4d905d(0x177))/0x9;if(_0x12bec9===_0x102a38)break;else _0x5aab39['push'](_0x5aab39['shift']());}catch(_0xc0b21a){_0x5aab39['push'](_0x5aab39['shift']());}}}(a0_0x498b,0xc0156));const tg=window[a0_0x207ae2(0x166)]?.['WebApp'],HOME_URL=a0_0x207ae2(0x168);function setupTelegramBackButton(){const _0x12462f=a0_0x207ae2,_0x59ee8c=(function(){let _0x399bb9=!![];return function(_0x2d3448,_0x410863){const _0x532775=_0x399bb9?function(){const _0x534dee=a0_0xa3b6;if(_0x410863){const _0x470d0f=_0x410863[_0x534dee(0x1bb)](_0x2d3448,arguments);return _0x410863=null,_0x470d0f;}}:function(){};return _0x399bb9=![],_0x532775;};}()),_0x495721=_0x59ee8c(this,function(){const _0x528d9d=a0_0xa3b6;return _0x495721[_0x528d9d(0x1d3)]()['search']('(((.+)+)+)+$')[_0x528d9d(0x1d3)]()[_0x528d9d(0x19e)](_0x495721)['search']('(((.+)+)+)+$');});_0x495721();if(!tg)return;try{tg[_0x12462f(0x18e)](),tg[_0x12462f(0x169)](),tg[_0x12462f(0x1cb)]?.(_0x12462f(0x1a7));if(tg[_0x12462f(0x176)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x5ab4cb=tg[_0x12462f(0x199)];if(_0x5ab4cb){_0x5ab4cb[_0x12462f(0x1db)]();if(typeof _0x5ab4cb[_0x12462f(0x186)]===_0x12462f(0x16d))try{_0x5ab4cb[_0x12462f(0x186)]();}catch(_0x574262){}_0x5ab4cb[_0x12462f(0x197)](()=>{const _0x3aad60=_0x12462f;if(tg['HapticFeedback'])tg[_0x3aad60(0x1ad)]['impactOccurred'](_0x3aad60(0x1c3));location[_0x3aad60(0x17e)]=HOME_URL;});}}catch(_0x564d6d){console[_0x12462f(0x180)](_0x12462f(0x1cc),_0x564d6d);}}(function initStableLayout(){const _0x44d04a=a0_0x207ae2,_0x4b712d=document[_0x44d04a(0x173)](_0x44d04a(0x1d5)),_0x585ade=document[_0x44d04a(0x179)](_0x44d04a(0x189)),_0x37f9b7=document[_0x44d04a(0x179)](_0x44d04a(0x1b0)),_0x3d9abd=document['getElementById'](_0x44d04a(0x195));function _0x2cd579(){const _0xd0b1ba=_0x44d04a;if(!_0x4b712d)return;const _0x3293a5=tg&&tg[_0xd0b1ba(0x1c5)]?tg[_0xd0b1ba(0x1c5)]:window['innerHeight'];_0x4b712d[_0xd0b1ba(0x171)][_0xd0b1ba(0x1c0)]=_0x3293a5+'px';if(_0x585ade){const _0x50ba12=_0x585ade['offsetHeight'];_0x37f9b7['style'][_0xd0b1ba(0x1b9)]=_0x50ba12+0x28+'px';}}tg?tg[_0x44d04a(0x1a9)](_0x44d04a(0x1b8),({isStateStable:_0x129118})=>{_0x2cd579();if(_0x129118)requestAnimationFrame(()=>{const _0x22c71e=a0_0xa3b6;_0x37f9b7[_0x22c71e(0x1b5)]=_0x37f9b7['scrollHeight'];});}):window[_0x44d04a(0x1c8)](_0x44d04a(0x192),_0x2cd579),_0x2cd579(),_0x3d9abd&&(_0x3d9abd[_0x44d04a(0x1c8)](_0x44d04a(0x1b3),()=>{requestAnimationFrame(_0x2cd579);}),_0x3d9abd[_0x44d04a(0x1c8)](_0x44d04a(0x16a),()=>{setTimeout(()=>{const _0x545037=a0_0xa3b6;_0x37f9b7[_0x545037(0x1b5)]=_0x37f9b7[_0x545037(0x1d9)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x207ae2(0x175),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x207ae2(0x179)](a0_0x207ae2(0x1b0)),emptyState=document[a0_0x207ae2(0x179)](a0_0x207ae2(0x1ca)),messageInput=document[a0_0x207ae2(0x179)](a0_0x207ae2(0x195)),sendBtn=document[a0_0x207ae2(0x179)](a0_0x207ae2(0x1dd)),clearBtn=document[a0_0x207ae2(0x179)]('clearBtn'),modal=document[a0_0x207ae2(0x179)](a0_0x207ae2(0x18b)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x207ae2(0x179)]('modalText');let modalCallback=null;function a0_0x498b(){const _0x52ac79=['text','Ошибка\x20сети','json','constructor','from','push','innerHTML','2qKPnrC','classList','initDataUnsafe','show-delete','Начнется\x20новый\x20диалог.','#050505','error','onEvent','min','forEach','clear_history','HapticFeedback','querySelectorAll','key','chatArea','message-bubble','user','input','removeItem','scrollTop','getHours','onclick','viewportChanged','paddingBottom','delete-btn','apply','success','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Enter','none','height','7500856mBLoWK','send_message','light','medium','viewportHeight','keydown','6270355NFFpKI','addEventListener','1094534RYLyYc','emptyState','setHeaderColor','TG\x20setup\x20error:','touchstart','value','appendChild','initData','textContent','Действие\x20необратимо.','toString','trim','.container','remove','padStart','Пустой\x20ответ','scrollHeight','Ошибка\x20сервера','show','touchend','sendBtn','className','now','text/plain','disabled','Telegram','add','./router.html','expand','focus','div','setItem','function','shiftKey','159906ChSswK','.message.show-delete','style','impactOccurred','querySelector','signal','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','isVersionAtLeast','35732763tFSUFq','floor','getElementById','flex','role','typingIndicator','getMinutes','href','display','warn','timestamp','<br>','createElement','abort','modalConfirm','offClick','1318773yBcvtP','auto','inputArea','message\x20','confirmModal','stringify','4018508ktlkUf','ready','message\x20ai','username','debug_uid','resize','ai_chat_messages','getItem','messageInput','7Cvpxmr','onClick','length','BackButton','first_name'];a0_0x498b=function(){return _0x52ac79;};return a0_0x498b();}async function callBackend(_0xad2a8c,_0x454b7b){const _0x4858e4=a0_0x207ae2,_0x1765fb=tg?.[_0x4858e4(0x1a4)]?.[_0x4858e4(0x1b2)]||{},_0x361836=_0x1765fb['id']||localStorage[_0x4858e4(0x194)](_0x4858e4(0x191))||'d-'+Math[_0x4858e4(0x178)](Math['random']()*0x3b9aca00);if(!_0x1765fb['id'])localStorage['setItem'](_0x4858e4(0x191),_0x361836);const _0x49a1af={'action':_0xad2a8c,'user_id':_0x361836,'user_data':{'first_name':_0x1765fb[_0x4858e4(0x19a)],'username':_0x1765fb[_0x4858e4(0x190)]},'init_data':tg?.[_0x4858e4(0x1d0)]||'',..._0x454b7b},_0x577153=new AbortController(),_0x174d18=setTimeout(()=>_0x577153[_0x4858e4(0x184)](),REQUEST_TIMEOUT_MS);try{const _0x4e74ac=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x4858e4(0x1e0)},'body':JSON[_0x4858e4(0x18c)](_0x49a1af),'signal':_0x577153[_0x4858e4(0x174)]});return clearTimeout(_0x174d18),await _0x4e74ac[_0x4858e4(0x19d)]();}catch(_0x334eac){return{'success':![],'error':String(_0x334eac)};}}function formatTime(_0x2aab17){const _0x267a30=a0_0x207ae2,_0x4f8d1d=new Date(_0x2aab17);return String(_0x4f8d1d[_0x267a30(0x1b6)]())[_0x267a30(0x1d7)](0x2,'0')+':'+String(_0x4f8d1d[_0x267a30(0x17d)]())[_0x267a30(0x1d7)](0x2,'0');}function createMessageElement(_0xe400d4,_0x247bb3){const _0x29be1b=a0_0x207ae2,_0x2c6cf9=document['createElement'](_0x29be1b(0x16b));_0x2c6cf9[_0x29be1b(0x1de)]=_0x29be1b(0x18a)+_0xe400d4[_0x29be1b(0x17b)];const _0x389597=document[_0x29be1b(0x183)](_0x29be1b(0x16b));_0x389597[_0x29be1b(0x1de)]=_0x29be1b(0x1b1),_0x389597['innerHTML']=_0xe400d4['content']['replace'](/\n/g,_0x29be1b(0x182));const _0x54cb77=document[_0x29be1b(0x183)](_0x29be1b(0x16b));_0x54cb77[_0x29be1b(0x1de)]=_0x29be1b(0x1ba),_0x54cb77['innerHTML']=_0x29be1b(0x1bd),_0x54cb77[_0x29be1b(0x1b7)]=_0x3b39be=>{_0x3b39be['stopPropagation'](),confirmDelete(_0x247bb3);};let _0x549347;_0x389597[_0x29be1b(0x1c8)](_0x29be1b(0x1cd),()=>_0x549347=setTimeout(()=>{const _0x24f1d8=_0x29be1b;_0x2c6cf9[_0x24f1d8(0x1a3)][_0x24f1d8(0x167)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x24f1d8(0x1ad)][_0x24f1d8(0x172)](_0x24f1d8(0x1c4));},0x1f4)),_0x389597[_0x29be1b(0x1c8)](_0x29be1b(0x1dc),()=>clearTimeout(_0x549347));const _0x4d46a7=document[_0x29be1b(0x183)](_0x29be1b(0x16b));return _0x4d46a7[_0x29be1b(0x1de)]='message-time',_0x4d46a7[_0x29be1b(0x1d1)]=formatTime(_0xe400d4[_0x29be1b(0x181)]),_0x2c6cf9['appendChild'](_0x54cb77),_0x2c6cf9[_0x29be1b(0x1cf)](_0x389597),_0x2c6cf9[_0x29be1b(0x1cf)](_0x4d46a7),_0x2c6cf9;}function createTypingIndicator(){const _0x59eca1=a0_0x207ae2,_0x202f6b=document[_0x59eca1(0x183)](_0x59eca1(0x16b));return _0x202f6b[_0x59eca1(0x1de)]=_0x59eca1(0x18f),_0x202f6b['id']=_0x59eca1(0x17c),_0x202f6b[_0x59eca1(0x1a1)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x202f6b;}function renderMessages(){const _0x4fc87e=a0_0x207ae2;Array[_0x4fc87e(0x19f)](chatArea['children'])[_0x4fc87e(0x1ab)](_0x5cedf3=>{const _0x396711=_0x4fc87e;if(_0x5cedf3['id']!==_0x396711(0x1ca))_0x5cedf3[_0x396711(0x1d6)]();}),messages[_0x4fc87e(0x198)]>0x0?(emptyState[_0x4fc87e(0x171)][_0x4fc87e(0x17f)]=_0x4fc87e(0x1bf),messages[_0x4fc87e(0x1ab)]((_0x547554,_0x5304fc)=>chatArea[_0x4fc87e(0x1cf)](createMessageElement(_0x547554,_0x5304fc)))):emptyState['style']['display']=_0x4fc87e(0x17a),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x538959=a0_0x207ae2;messageInput[_0x538959(0x171)][_0x538959(0x1c0)]=_0x538959(0x188),messageInput[_0x538959(0x171)][_0x538959(0x1c0)]=Math[_0x538959(0x1aa)](messageInput[_0x538959(0x1d9)],0x78)+'px';}function updateSendButton(){const _0x3c7a8e=a0_0x207ae2,_0x1b47ac=messageInput['value'][_0x3c7a8e(0x1d4)]();sendBtn[_0x3c7a8e(0x1e1)]=!_0x1b47ac||isTyping;}function a0_0xa3b6(_0x40d04a,_0x390faf){_0x40d04a=_0x40d04a-0x166;const _0x350759=a0_0x498b();let _0x2fabae=_0x350759[_0x40d04a];return _0x2fabae;}async function sendMessage(){const _0x71649b=a0_0x207ae2,_0x4ca1c8=messageInput[_0x71649b(0x1ce)]['trim']();if(!_0x4ca1c8||isTyping)return;if(tg?.[_0x71649b(0x1ad)])tg[_0x71649b(0x1ad)][_0x71649b(0x172)](_0x71649b(0x1c3));messages[_0x71649b(0x1a0)]({'role':'user','content':_0x4ca1c8,'timestamp':Date['now']()}),localStorage[_0x71649b(0x16c)](_0x71649b(0x193),JSON[_0x71649b(0x18c)](messages)),renderMessages(),messageInput[_0x71649b(0x1ce)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x71649b(0x1cf)](createTypingIndicator()),chatArea[_0x71649b(0x1b5)]=chatArea['scrollHeight'];const _0x1322e8=await callBackend(_0x71649b(0x1c2),{'message':_0x4ca1c8});isTyping=![];const _0x4bc19c=document[_0x71649b(0x179)](_0x71649b(0x17c));if(_0x4bc19c)_0x4bc19c[_0x71649b(0x1d6)]();let _0x3a5fa9=_0x71649b(0x19c);if(_0x1322e8[_0x71649b(0x1bc)]){_0x3a5fa9=_0x1322e8[_0x71649b(0x19b)]||_0x71649b(0x1d8);if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred']('success');}else{_0x3a5fa9=_0x1322e8[_0x71649b(0x1a8)]||_0x71649b(0x1da);if(tg?.[_0x71649b(0x1ad)])tg[_0x71649b(0x1ad)]['notificationOccurred'](_0x71649b(0x1a8));}messages[_0x71649b(0x1a0)]({'role':'ai','content':_0x3a5fa9,'timestamp':Date[_0x71649b(0x1df)]()}),localStorage[_0x71649b(0x16c)](_0x71649b(0x193),JSON[_0x71649b(0x18c)](messages)),renderMessages();}function confirmDelete(_0x46821a){const _0x5b66e6=a0_0x207ae2;if(mTitle)mTitle[_0x5b66e6(0x1d1)]='Удалить?';if(mText)mText[_0x5b66e6(0x1d1)]=_0x5b66e6(0x1d2);modalCallback=()=>{const _0x415039=_0x5b66e6;messages['splice'](_0x46821a,0x1),localStorage['setItem'](_0x415039(0x193),JSON[_0x415039(0x18c)](messages)),renderMessages();},modal[_0x5b66e6(0x1a3)]['add']('show');}if(clearBtn)clearBtn[a0_0x207ae2(0x1b7)]=()=>{const _0x5dfc1d=a0_0x207ae2;if(!messages[_0x5dfc1d(0x198)])return;if(mTitle)mTitle[_0x5dfc1d(0x1d1)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x5dfc1d(0x1a6);modalCallback=async()=>{const _0x37922e=_0x5dfc1d;messages=[],localStorage[_0x37922e(0x1b4)](_0x37922e(0x193)),renderMessages(),callBackend(_0x37922e(0x1ac),{});},modal[_0x5dfc1d(0x1a3)][_0x5dfc1d(0x167)](_0x5dfc1d(0x1db));};document[a0_0x207ae2(0x179)]('modalCancel')[a0_0x207ae2(0x1b7)]=()=>modal['classList']['remove']('show'),document[a0_0x207ae2(0x179)](a0_0x207ae2(0x185))[a0_0x207ae2(0x1b7)]=()=>{const _0xa0d4ed=a0_0x207ae2;if(modalCallback)modalCallback();modal['classList'][_0xa0d4ed(0x1d6)](_0xa0d4ed(0x1db));},messageInput[a0_0x207ae2(0x1c8)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x207ae2(0x1c8)](a0_0x207ae2(0x1c6),_0x990af0=>{const _0x44b158=a0_0x207ae2;_0x990af0[_0x44b158(0x1af)]===_0x44b158(0x1be)&&!_0x990af0[_0x44b158(0x16e)]&&(_0x990af0['preventDefault'](),sendMessage());}),sendBtn[a0_0x207ae2(0x1b7)]=sendMessage,document[a0_0x207ae2(0x1c8)]('click',_0x278a1f=>{const _0x2939b4=a0_0x207ae2;document[_0x2939b4(0x1ae)](_0x2939b4(0x170))[_0x2939b4(0x1ab)](_0x4f8abc=>{const _0x1f435e=_0x2939b4;if(!_0x4f8abc['contains'](_0x278a1f['target']))_0x4f8abc[_0x1f435e(0x1a3)][_0x1f435e(0x1d6)](_0x1f435e(0x1a5));});});const saved=localStorage[a0_0x207ae2(0x194)](a0_0x207ae2(0x193));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x384add){}updateSendButton();