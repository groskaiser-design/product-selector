const a0_0x29e7c2=a0_0x356a;(function(_0x293ba5,_0x2891a7){const _0x302a71=a0_0x356a,_0xe4c1a2=_0x293ba5();while(!![]){try{const _0x350bcf=-parseInt(_0x302a71(0x190))/0x1+parseInt(_0x302a71(0x172))/0x2*(parseInt(_0x302a71(0x13d))/0x3)+-parseInt(_0x302a71(0x169))/0x4+parseInt(_0x302a71(0x122))/0x5*(-parseInt(_0x302a71(0x18e))/0x6)+parseInt(_0x302a71(0x150))/0x7+parseInt(_0x302a71(0x11b))/0x8+parseInt(_0x302a71(0x16e))/0x9;if(_0x350bcf===_0x2891a7)break;else _0xe4c1a2['push'](_0xe4c1a2['shift']());}catch(_0x58fd25){_0xe4c1a2['push'](_0xe4c1a2['shift']());}}}(a0_0x59e2,0xdf429));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x29e7c2(0x117);function setupTelegramBackButton(){const _0x43cccf=a0_0x29e7c2,_0x3cc100=(function(){let _0x2917=!![];return function(_0x10ac6c,_0x49d1e1){const _0x89feda=_0x2917?function(){const _0x3429c4=a0_0x356a;if(_0x49d1e1){const _0x23f059=_0x49d1e1[_0x3429c4(0x156)](_0x10ac6c,arguments);return _0x49d1e1=null,_0x23f059;}}:function(){};return _0x2917=![],_0x89feda;};}()),_0x46b1ec=_0x3cc100(this,function(){const _0x38a7b2=a0_0x356a;return _0x46b1ec[_0x38a7b2(0x118)]()[_0x38a7b2(0x132)](_0x38a7b2(0x142))[_0x38a7b2(0x118)]()['constructor'](_0x46b1ec)[_0x38a7b2(0x132)](_0x38a7b2(0x142));});_0x46b1ec();if(!tg)return;try{tg['ready'](),tg[_0x43cccf(0x16a)](),tg[_0x43cccf(0x15f)]?.('#050505');if(tg['isVersionAtLeast']?.(_0x43cccf(0x147)))tg['disableVerticalSwipes']?.();const _0x421f7c=tg[_0x43cccf(0x149)];if(_0x421f7c){_0x421f7c[_0x43cccf(0x18d)]();if(typeof _0x421f7c[_0x43cccf(0x151)]==='function')try{_0x421f7c[_0x43cccf(0x151)]();}catch(_0x52ea15){}_0x421f7c[_0x43cccf(0x191)](()=>{const _0x4b93a9=_0x43cccf;if(tg[_0x4b93a9(0x177)])tg[_0x4b93a9(0x177)]['impactOccurred'](_0x4b93a9(0x141));location[_0x4b93a9(0x163)]=HOME_URL;});}}catch(_0x16511b){console['warn'](_0x43cccf(0x13f),_0x16511b);}}(function initStableLayout(){const _0x3b902b=a0_0x29e7c2,_0x5b5f88=document[_0x3b902b(0x192)](_0x3b902b(0x14e)),_0x15eda0=document['getElementById']('inputArea'),_0x17df14=document[_0x3b902b(0x17b)]('chatArea'),_0x2b947a=document[_0x3b902b(0x17b)]('messageInput');function _0x5ef205(){const _0x326064=_0x3b902b;if(!_0x5b5f88)return;const _0x4acd03=tg&&tg[_0x326064(0x173)]?tg[_0x326064(0x173)]:window[_0x326064(0x166)];_0x5b5f88[_0x326064(0x188)][_0x326064(0x18c)]=_0x4acd03+'px';if(_0x15eda0){const _0x248ef9=_0x15eda0[_0x326064(0x159)];_0x17df14[_0x326064(0x188)][_0x326064(0x13b)]=_0x248ef9+0x28+'px';}}tg?tg[_0x3b902b(0x18f)](_0x3b902b(0x12b),({isStateStable:_0x120987})=>{_0x5ef205();if(_0x120987)requestAnimationFrame(()=>{const _0x13fa52=a0_0x356a;_0x17df14[_0x13fa52(0x16b)]=_0x17df14['scrollHeight'];});}):window[_0x3b902b(0x125)](_0x3b902b(0x152),_0x5ef205),_0x5ef205(),_0x2b947a&&(_0x2b947a[_0x3b902b(0x125)](_0x3b902b(0x174),()=>{requestAnimationFrame(_0x5ef205);}),_0x2b947a[_0x3b902b(0x125)](_0x3b902b(0x12a),()=>{setTimeout(()=>{const _0x3dabd3=a0_0x356a;_0x17df14[_0x3dabd3(0x16b)]=_0x17df14['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x29e7c2(0x17e),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x59e2(){const _0x5c423f=['Действие\x20необратимо.','error','8601201YiziJR','onclick','textContent','now','405956zahuEN','viewportHeight','input','medium','first_name','HapticFeedback','clearBtn','target','div','getElementById','splice','touchstart','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','notificationOccurred','preventDefault','signal','min','timestamp','text','className','message-time','classList','style','Удалить?','flex','setItem','height','show','3318oypZEk','onEvent','695283BIWVZD','onClick','querySelector','messageInput','./router.html','toString','key','click','5528264vAQVVq','typingIndicator','message\x20ai','from','innerHTML','forEach','debug_uid','11670KtSFXj','length','remove','addEventListener','success','modalConfirm','message-bubble','getMinutes','focus','viewportChanged','add','POST','value','display','ai_chat_messages','json','search','delete-btn','touchend','<br>','Enter','initData','children','modalCancel','random','paddingBottom','abort','9HbCTTH','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','TG\x20setup\x20error:','replace','light','(((.+)+)+)+$','stopPropagation','user','createElement','impactOccurred','6.1','removeItem','BackButton','push','scrollHeight','getHours','initDataUnsafe','.container','show-delete','6610317TUvttS','offClick','resize','.message.show-delete','modalText','send_message','apply','message\x20','Очистить\x20историю?','offsetHeight','appendChild','stringify','floor','content','chatArea','setHeaderColor','trim','Начнется\x20новый\x20диалог.','emptyState','href','Ошибка\x20сети','contains','innerHeight','Ошибка\x20сервера','querySelectorAll','1198116vHGAGs','expand','scrollTop'];a0_0x59e2=function(){return _0x5c423f;};return a0_0x59e2();}const chatArea=document[a0_0x29e7c2(0x17b)](a0_0x29e7c2(0x15e)),emptyState=document[a0_0x29e7c2(0x17b)]('emptyState'),messageInput=document['getElementById'](a0_0x29e7c2(0x193)),sendBtn=document[a0_0x29e7c2(0x17b)]('sendBtn'),clearBtn=document['getElementById'](a0_0x29e7c2(0x178)),modal=document[a0_0x29e7c2(0x17b)]('confirmModal'),mTitle=document['getElementById']('modalTitle'),mText=document['getElementById'](a0_0x29e7c2(0x154));function a0_0x356a(_0x230c4f,_0x59cf46){_0x230c4f=_0x230c4f-0x117;const _0x31cb70=a0_0x59e2();let _0x503c34=_0x31cb70[_0x230c4f];return _0x503c34;}let modalCallback=null;async function callBackend(_0x1b8638,_0x4f65de){const _0x34e8be=a0_0x29e7c2,_0x389c2b=tg?.[_0x34e8be(0x14d)]?.[_0x34e8be(0x144)]||{},_0x2eab20=_0x389c2b['id']||localStorage['getItem'](_0x34e8be(0x121))||'d-'+Math[_0x34e8be(0x15c)](Math[_0x34e8be(0x13a)]()*0x3b9aca00);if(!_0x389c2b['id'])localStorage[_0x34e8be(0x18b)](_0x34e8be(0x121),_0x2eab20);const _0x43cf18={'action':_0x1b8638,'user_id':_0x2eab20,'user_data':{'first_name':_0x389c2b[_0x34e8be(0x176)],'username':_0x389c2b['username']},'init_data':tg?.[_0x34e8be(0x137)]||'',..._0x4f65de},_0x3f4c48=new AbortController(),_0x460e59=setTimeout(()=>_0x3f4c48[_0x34e8be(0x13c)](),REQUEST_TIMEOUT_MS);try{const _0x551d2d=await fetch(BACKEND_URL,{'method':_0x34e8be(0x12d),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x43cf18),'signal':_0x3f4c48[_0x34e8be(0x181)]});return clearTimeout(_0x460e59),await _0x551d2d[_0x34e8be(0x131)]();}catch(_0x4ff9fc){return{'success':![],'error':String(_0x4ff9fc)};}}function formatTime(_0x556f26){const _0x2bf52a=a0_0x29e7c2,_0x49d36e=new Date(_0x556f26);return String(_0x49d36e[_0x2bf52a(0x14c)]())['padStart'](0x2,'0')+':'+String(_0x49d36e[_0x2bf52a(0x129)]())['padStart'](0x2,'0');}function createMessageElement(_0x38a82a,_0x3a07a1){const _0x44733b=a0_0x29e7c2,_0x43198e=document[_0x44733b(0x145)](_0x44733b(0x17a));_0x43198e[_0x44733b(0x185)]=_0x44733b(0x157)+_0x38a82a['role'];const _0xe76f04=document['createElement'](_0x44733b(0x17a));_0xe76f04[_0x44733b(0x185)]=_0x44733b(0x128),_0xe76f04[_0x44733b(0x11f)]=_0x38a82a[_0x44733b(0x15d)][_0x44733b(0x140)](/\n/g,_0x44733b(0x135));const _0x1756b9=document[_0x44733b(0x145)](_0x44733b(0x17a));_0x1756b9[_0x44733b(0x185)]=_0x44733b(0x133),_0x1756b9[_0x44733b(0x11f)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x1756b9[_0x44733b(0x16f)]=_0x4f010c=>{const _0x52838d=_0x44733b;_0x4f010c[_0x52838d(0x143)](),confirmDelete(_0x3a07a1);};let _0x2a6120;_0xe76f04[_0x44733b(0x125)](_0x44733b(0x17d),()=>_0x2a6120=setTimeout(()=>{const _0x4dffa0=_0x44733b;_0x43198e[_0x4dffa0(0x187)][_0x4dffa0(0x12c)]('show-delete');if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x4dffa0(0x146)](_0x4dffa0(0x175));},0x1f4)),_0xe76f04[_0x44733b(0x125)](_0x44733b(0x134),()=>clearTimeout(_0x2a6120));const _0x3a71a1=document[_0x44733b(0x145)](_0x44733b(0x17a));return _0x3a71a1[_0x44733b(0x185)]=_0x44733b(0x186),_0x3a71a1['textContent']=formatTime(_0x38a82a[_0x44733b(0x183)]),_0x43198e['appendChild'](_0x1756b9),_0x43198e[_0x44733b(0x15a)](_0xe76f04),_0x43198e[_0x44733b(0x15a)](_0x3a71a1),_0x43198e;}function createTypingIndicator(){const _0x232e07=a0_0x29e7c2,_0x427d4c=document[_0x232e07(0x145)](_0x232e07(0x17a));return _0x427d4c['className']=_0x232e07(0x11d),_0x427d4c['id']=_0x232e07(0x11c),_0x427d4c[_0x232e07(0x11f)]=_0x232e07(0x13e),_0x427d4c;}function renderMessages(){const _0x1c2495=a0_0x29e7c2;Array[_0x1c2495(0x11e)](chatArea[_0x1c2495(0x138)])[_0x1c2495(0x120)](_0x17958e=>{const _0x4be275=_0x1c2495;if(_0x17958e['id']!==_0x4be275(0x162))_0x17958e[_0x4be275(0x124)]();}),messages[_0x1c2495(0x123)]>0x0?(emptyState[_0x1c2495(0x188)][_0x1c2495(0x12f)]='none',messages[_0x1c2495(0x120)]((_0x4ebea7,_0x4f6983)=>chatArea[_0x1c2495(0x15a)](createMessageElement(_0x4ebea7,_0x4f6983)))):emptyState['style']['display']=_0x1c2495(0x18a),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x1c2495(0x14b)]);}function autoResizeTextarea(){const _0x592005=a0_0x29e7c2;messageInput[_0x592005(0x188)][_0x592005(0x18c)]='auto',messageInput['style']['height']=Math[_0x592005(0x182)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x19f9a8=a0_0x29e7c2,_0x53bc6a=messageInput['value'][_0x19f9a8(0x160)]();sendBtn['disabled']=!_0x53bc6a||isTyping;}async function sendMessage(){const _0x490226=a0_0x29e7c2,_0x128574=messageInput[_0x490226(0x12e)][_0x490226(0x160)]();if(!_0x128574||isTyping)return;if(tg?.[_0x490226(0x177)])tg[_0x490226(0x177)][_0x490226(0x146)](_0x490226(0x141));messages['push']({'role':_0x490226(0x144),'content':_0x128574,'timestamp':Date[_0x490226(0x171)]()}),localStorage[_0x490226(0x18b)](_0x490226(0x130),JSON['stringify'](messages)),renderMessages(),messageInput[_0x490226(0x12e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x490226(0x15a)](createTypingIndicator()),chatArea[_0x490226(0x16b)]=chatArea['scrollHeight'];const _0x1fa729=await callBackend(_0x490226(0x155),{'message':_0x128574});isTyping=![];const _0x43a38c=document[_0x490226(0x17b)]('typingIndicator');if(_0x43a38c)_0x43a38c[_0x490226(0x124)]();let _0x1c8b19=_0x490226(0x164);if(_0x1fa729[_0x490226(0x126)]){_0x1c8b19=_0x1fa729[_0x490226(0x184)]||'Пустой\x20ответ';if(tg?.[_0x490226(0x177)])tg['HapticFeedback'][_0x490226(0x17f)](_0x490226(0x126));}else{_0x1c8b19=_0x1fa729[_0x490226(0x16d)]||_0x490226(0x167);if(tg?.[_0x490226(0x177)])tg[_0x490226(0x177)]['notificationOccurred'](_0x490226(0x16d));}messages[_0x490226(0x14a)]({'role':'ai','content':_0x1c8b19,'timestamp':Date['now']()}),localStorage[_0x490226(0x18b)](_0x490226(0x130),JSON[_0x490226(0x15b)](messages)),renderMessages();}function confirmDelete(_0x50c96d){const _0x270601=a0_0x29e7c2;if(mTitle)mTitle[_0x270601(0x170)]=_0x270601(0x189);if(mText)mText['textContent']=_0x270601(0x16c);modalCallback=()=>{const _0x14604c=_0x270601;messages[_0x14604c(0x17c)](_0x50c96d,0x1),localStorage[_0x14604c(0x18b)]('ai_chat_messages',JSON[_0x14604c(0x15b)](messages)),renderMessages();},modal[_0x270601(0x187)][_0x270601(0x12c)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0x7f2d7d=a0_0x29e7c2;if(!messages[_0x7f2d7d(0x123)])return;if(mTitle)mTitle['textContent']=_0x7f2d7d(0x158);if(mText)mText[_0x7f2d7d(0x170)]=_0x7f2d7d(0x161);modalCallback=async()=>{const _0x216a39=_0x7f2d7d;messages=[],localStorage[_0x216a39(0x148)](_0x216a39(0x130)),renderMessages(),callBackend('clear_history',{});},modal[_0x7f2d7d(0x187)]['add'](_0x7f2d7d(0x18d));};document[a0_0x29e7c2(0x17b)](a0_0x29e7c2(0x139))[a0_0x29e7c2(0x16f)]=()=>modal['classList'][a0_0x29e7c2(0x124)](a0_0x29e7c2(0x18d)),document[a0_0x29e7c2(0x17b)](a0_0x29e7c2(0x127))['onclick']=()=>{if(modalCallback)modalCallback();modal['classList']['remove']('show');},messageInput[a0_0x29e7c2(0x125)](a0_0x29e7c2(0x174),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x29e7c2(0x125)]('keydown',_0x42cba7=>{const _0x248d14=a0_0x29e7c2;_0x42cba7[_0x248d14(0x119)]===_0x248d14(0x136)&&!_0x42cba7['shiftKey']&&(_0x42cba7[_0x248d14(0x180)](),sendMessage());}),sendBtn[a0_0x29e7c2(0x16f)]=sendMessage,document[a0_0x29e7c2(0x125)](a0_0x29e7c2(0x11a),_0x1cbe36=>{const _0x352666=a0_0x29e7c2;document[_0x352666(0x168)](_0x352666(0x153))[_0x352666(0x120)](_0x285566=>{const _0x6de19e=_0x352666;if(!_0x285566[_0x6de19e(0x165)](_0x1cbe36[_0x6de19e(0x179)]))_0x285566[_0x6de19e(0x187)][_0x6de19e(0x124)](_0x6de19e(0x14f));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x1e5885){}updateSendButton();