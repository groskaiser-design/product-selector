const a0_0x2aec87=a0_0x512a;(function(_0x520d4b,_0x13d448){const _0x3eb0ba=a0_0x512a,_0x7cedd9=_0x520d4b();while(!![]){try{const _0x5c4fd7=-parseInt(_0x3eb0ba(0xe6))/0x1+-parseInt(_0x3eb0ba(0x7b))/0x2*(-parseInt(_0x3eb0ba(0xa7))/0x3)+-parseInt(_0x3eb0ba(0xed))/0x4*(-parseInt(_0x3eb0ba(0xa1))/0x5)+-parseInt(_0x3eb0ba(0xec))/0x6*(parseInt(_0x3eb0ba(0xa8))/0x7)+-parseInt(_0x3eb0ba(0xad))/0x8*(-parseInt(_0x3eb0ba(0xa3))/0x9)+parseInt(_0x3eb0ba(0xf0))/0xa*(-parseInt(_0x3eb0ba(0xaa))/0xb)+-parseInt(_0x3eb0ba(0xc3))/0xc*(parseInt(_0x3eb0ba(0x9e))/0xd);if(_0x5c4fd7===_0x13d448)break;else _0x7cedd9['push'](_0x7cedd9['shift']());}catch(_0x143d95){_0x7cedd9['push'](_0x7cedd9['shift']());}}}(a0_0x378d,0x5c2de));const tg=window['Telegram']?.[a0_0x2aec87(0x72)],HOME_URL=a0_0x2aec87(0xd5);function setupTelegramBackButton(){const _0x26a890=a0_0x2aec87;if(!tg)return;try{tg[_0x26a890(0xe0)](),tg['expand'](),tg[_0x26a890(0xe2)]?.('#050505');if(tg[_0x26a890(0xb7)]?.(_0x26a890(0xd9)))tg[_0x26a890(0xd0)]?.();const _0x2086c0=tg[_0x26a890(0xdf)];if(_0x2086c0){_0x2086c0[_0x26a890(0xa2)]();if(typeof _0x2086c0[_0x26a890(0xc6)]==='function')try{_0x2086c0[_0x26a890(0xc6)]();}catch(_0x373cf4){}_0x2086c0[_0x26a890(0x97)](()=>{const _0xea3d46=_0x26a890;if(tg[_0xea3d46(0x78)])tg[_0xea3d46(0x78)][_0xea3d46(0xb3)](_0xea3d46(0x79));location['href']=HOME_URL;});}}catch(_0x46e53e){console[_0x26a890(0xc4)](_0x26a890(0xb4),_0x46e53e);}}(function initStableLayout(){const _0x3c5f05=a0_0x2aec87,_0x13cfe3=(function(){let _0x360eef=!![];return function(_0x2e9362,_0x302299){const _0x1266dc=_0x360eef?function(){if(_0x302299){const _0x29fd10=_0x302299['apply'](_0x2e9362,arguments);return _0x302299=null,_0x29fd10;}}:function(){};return _0x360eef=![],_0x1266dc;};}()),_0x5ba3cf=document['querySelector'](_0x3c5f05(0xdb)),_0x47e89b=document[_0x3c5f05(0xae)](_0x3c5f05(0x71)),_0x4f9c98=document['getElementById'](_0x3c5f05(0x6d)),_0x6b1371=document[_0x3c5f05(0xae)](_0x3c5f05(0xea));function _0x49bbb7(){const _0x521cc3=_0x3c5f05,_0x508e6c=_0x13cfe3(this,function(){const _0x25d748=a0_0x512a;return _0x508e6c['toString']()[_0x25d748(0xdd)](_0x25d748(0x9f))[_0x25d748(0xab)]()[_0x25d748(0x8b)](_0x508e6c)['search']('(((.+)+)+)+$');});_0x508e6c();if(!_0x5ba3cf)return;const _0x2625a4=tg&&tg[_0x521cc3(0xe3)]?tg[_0x521cc3(0xe3)]:window[_0x521cc3(0xcb)];_0x5ba3cf['style'][_0x521cc3(0xc5)]=_0x2625a4+'px';if(_0x47e89b){const _0x3fe902=_0x47e89b[_0x521cc3(0x6a)];_0x4f9c98[_0x521cc3(0x92)][_0x521cc3(0xeb)]=_0x3fe902+0x28+'px';}}tg?tg['onEvent'](_0x3c5f05(0x6e),({isStateStable:_0x30e40e})=>{_0x49bbb7();if(_0x30e40e)requestAnimationFrame(()=>{const _0x42cddb=a0_0x512a;_0x4f9c98['scrollTop']=_0x4f9c98[_0x42cddb(0xb1)];});}):window[_0x3c5f05(0x95)](_0x3c5f05(0xba),_0x49bbb7),_0x49bbb7(),_0x6b1371&&(_0x6b1371['addEventListener']('input',()=>{requestAnimationFrame(_0x49bbb7);}),_0x6b1371[_0x3c5f05(0x95)](_0x3c5f05(0x93),()=>{setTimeout(()=>{const _0x18cf4a=a0_0x512a;_0x4f9c98[_0x18cf4a(0xa6)]=_0x4f9c98[_0x18cf4a(0xb1)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2aec87(0xdc),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2aec87(0xae)]('chatArea'),emptyState=document['getElementById'](a0_0x2aec87(0xe9)),messageInput=document[a0_0x2aec87(0xae)]('messageInput'),sendBtn=document['getElementById'](a0_0x2aec87(0xd3)),clearBtn=document[a0_0x2aec87(0xae)](a0_0x2aec87(0x80)),modal=document[a0_0x2aec87(0xae)](a0_0x2aec87(0x69)),mTitle=document[a0_0x2aec87(0xae)](a0_0x2aec87(0x7a)),mText=document[a0_0x2aec87(0xae)](a0_0x2aec87(0x73));let modalCallback=null;async function callBackend(_0x32ffe9,_0x4938c0){const _0x3deb30=a0_0x2aec87,_0x7abf1a=tg?.['initDataUnsafe']?.[_0x3deb30(0xd6)]||{},_0x501bb3=_0x7abf1a['id']||localStorage[_0x3deb30(0xd4)](_0x3deb30(0xbf))||'d-'+Math[_0x3deb30(0xca)](Math[_0x3deb30(0x84)]()*0x3b9aca00);if(!_0x7abf1a['id'])localStorage[_0x3deb30(0x76)]('debug_uid',_0x501bb3);const _0x24c7c4={'action':_0x32ffe9,'user_id':_0x501bb3,'user_data':{'first_name':_0x7abf1a[_0x3deb30(0x7c)],'username':_0x7abf1a[_0x3deb30(0x82)]},'init_data':tg?.[_0x3deb30(0x70)]||'',..._0x4938c0},_0x454546=new AbortController(),_0x400136=setTimeout(()=>_0x454546[_0x3deb30(0xc7)](),REQUEST_TIMEOUT_MS);try{const _0x1ac1cc=await fetch(BACKEND_URL,{'method':_0x3deb30(0x74),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x3deb30(0x7d)](_0x24c7c4),'signal':_0x454546[_0x3deb30(0xa0)]});return clearTimeout(_0x400136),await _0x1ac1cc[_0x3deb30(0xbd)]();}catch(_0xe51e84){return{'success':![],'error':String(_0xe51e84)};}}function formatTime(_0x4e7b9c){const _0x5d06d8=a0_0x2aec87,_0x21883e=new Date(_0x4e7b9c);return String(_0x21883e[_0x5d06d8(0x6f)]())[_0x5d06d8(0x94)](0x2,'0')+':'+String(_0x21883e[_0x5d06d8(0x77)]())[_0x5d06d8(0x94)](0x2,'0');}function createMessageElement(_0x47c7b1,_0x334861){const _0x5c2f05=a0_0x2aec87,_0x3d8b5f=document['createElement'](_0x5c2f05(0xb2));_0x3d8b5f['className']=_0x5c2f05(0xd8)+_0x47c7b1[_0x5c2f05(0xc9)];const _0x3c6d56=document[_0x5c2f05(0xf1)](_0x5c2f05(0xb2));_0x3c6d56[_0x5c2f05(0xb9)]=_0x5c2f05(0x6c),_0x3c6d56[_0x5c2f05(0x75)]=_0x47c7b1[_0x5c2f05(0x9d)][_0x5c2f05(0xe7)](/\n/g,_0x5c2f05(0xb0));const _0x204852=document[_0x5c2f05(0xf1)](_0x5c2f05(0xb2));_0x204852['className']='delete-btn',_0x204852[_0x5c2f05(0x75)]=_0x5c2f05(0x83),_0x204852[_0x5c2f05(0xb5)]=_0x5f4284=>{const _0x43b4bb=_0x5c2f05;_0x5f4284[_0x43b4bb(0xb6)](),confirmDelete(_0x334861);};let _0x4e5623;_0x3c6d56[_0x5c2f05(0x95)](_0x5c2f05(0x8f),()=>_0x4e5623=setTimeout(()=>{const _0x4f3847=_0x5c2f05;_0x3d8b5f['classList'][_0x4f3847(0x8d)]('show-delete');if(tg?.[_0x4f3847(0x78)])tg['HapticFeedback'][_0x4f3847(0xb3)]('medium');},0x1f4)),_0x3c6d56[_0x5c2f05(0x95)](_0x5c2f05(0xb8),()=>clearTimeout(_0x4e5623));const _0x16fb7b=document[_0x5c2f05(0xf1)](_0x5c2f05(0xb2));return _0x16fb7b[_0x5c2f05(0xb9)]=_0x5c2f05(0x89),_0x16fb7b[_0x5c2f05(0xcf)]=formatTime(_0x47c7b1[_0x5c2f05(0xc0)]),_0x3d8b5f[_0x5c2f05(0x96)](_0x204852),_0x3d8b5f[_0x5c2f05(0x96)](_0x3c6d56),_0x3d8b5f[_0x5c2f05(0x96)](_0x16fb7b),_0x3d8b5f;}function createTypingIndicator(){const _0x1bd3c3=a0_0x2aec87,_0x2c4ffc=document[_0x1bd3c3(0xf1)](_0x1bd3c3(0xb2));return _0x2c4ffc[_0x1bd3c3(0xb9)]=_0x1bd3c3(0x9a),_0x2c4ffc['id']='typingIndicator',_0x2c4ffc[_0x1bd3c3(0x75)]=_0x1bd3c3(0x85),_0x2c4ffc;}function renderMessages(){const _0x57c923=a0_0x2aec87;Array[_0x57c923(0xe1)](chatArea[_0x57c923(0x81)])[_0x57c923(0xd1)](_0x1f76a1=>{const _0xd53cd6=_0x57c923;if(_0x1f76a1['id']!==_0xd53cd6(0xe9))_0x1f76a1[_0xd53cd6(0xde)]();}),messages['length']>0x0?(emptyState[_0x57c923(0x92)]['display']=_0x57c923(0xac),messages[_0x57c923(0xd1)]((_0x24b040,_0x57cf76)=>chatArea['appendChild'](createMessageElement(_0x24b040,_0x57cf76)))):emptyState[_0x57c923(0x92)]['display']=_0x57c923(0x9c),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x57c923(0xb1)]);}function autoResizeTextarea(){const _0x13cba9=a0_0x2aec87;messageInput[_0x13cba9(0x92)][_0x13cba9(0xc5)]=_0x13cba9(0x8c),messageInput[_0x13cba9(0x92)][_0x13cba9(0xc5)]=Math['min'](messageInput[_0x13cba9(0xb1)],0x78)+'px';}function a0_0x512a(_0xa925b4,_0x220109){_0xa925b4=_0xa925b4-0x69;const _0x20cfbd=a0_0x378d();let _0x17fd69=_0x20cfbd[_0xa925b4];return _0x17fd69;}function updateSendButton(){const _0x11fd2a=a0_0x2aec87,_0x1020ab=messageInput[_0x11fd2a(0x99)]['trim']();sendBtn['disabled']=!_0x1020ab||isTyping;}async function sendMessage(){const _0x411d9f=a0_0x2aec87,_0x30fec9=messageInput[_0x411d9f(0x99)][_0x411d9f(0xe8)]();if(!_0x30fec9||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x411d9f(0x78)]['impactOccurred'](_0x411d9f(0x79));messages['push']({'role':_0x411d9f(0xd6),'content':_0x30fec9,'timestamp':Date[_0x411d9f(0xc8)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x411d9f(0x7d)](messages)),renderMessages(),messageInput[_0x411d9f(0x99)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x411d9f(0x96)](createTypingIndicator()),chatArea[_0x411d9f(0xa6)]=chatArea[_0x411d9f(0xb1)];const _0x42005c=await callBackend(_0x411d9f(0xbe),{'message':_0x30fec9});isTyping=![];const _0x196b46=document['getElementById'](_0x411d9f(0x98));if(_0x196b46)_0x196b46['remove']();let _0x5e6dc3=_0x411d9f(0xc1);if(_0x42005c[_0x411d9f(0x7f)]){_0x5e6dc3=_0x42005c[_0x411d9f(0xe5)]||_0x411d9f(0xda);if(tg?.[_0x411d9f(0x78)])tg['HapticFeedback'][_0x411d9f(0xf2)](_0x411d9f(0x7f));}else{_0x5e6dc3=_0x42005c[_0x411d9f(0x88)]||_0x411d9f(0x8a);if(tg?.[_0x411d9f(0x78)])tg[_0x411d9f(0x78)][_0x411d9f(0xf2)]('error');}messages[_0x411d9f(0xa4)]({'role':'ai','content':_0x5e6dc3,'timestamp':Date[_0x411d9f(0xc8)]()}),localStorage[_0x411d9f(0x76)]('ai_chat_messages',JSON[_0x411d9f(0x7d)](messages)),renderMessages();}function confirmDelete(_0x50efc8){const _0x164d9e=a0_0x2aec87;if(mTitle)mTitle[_0x164d9e(0xcf)]=_0x164d9e(0x6b);if(mText)mText[_0x164d9e(0xcf)]=_0x164d9e(0xcc);modalCallback=()=>{const _0x42bfd6=_0x164d9e;messages[_0x42bfd6(0x9b)](_0x50efc8,0x1),localStorage[_0x42bfd6(0x76)]('ai_chat_messages',JSON[_0x42bfd6(0x7d)](messages)),renderMessages();},modal[_0x164d9e(0x91)]['add'](_0x164d9e(0xa2));}if(clearBtn)clearBtn['onclick']=()=>{const _0x1328c0=a0_0x2aec87;if(!messages[_0x1328c0(0xef)])return;if(mTitle)mTitle[_0x1328c0(0xcf)]=_0x1328c0(0xc2);if(mText)mText[_0x1328c0(0xcf)]=_0x1328c0(0xbc);modalCallback=async()=>{const _0x1e078a=_0x1328c0;messages=[],localStorage[_0x1e078a(0xa5)]('ai_chat_messages'),renderMessages(),callBackend(_0x1e078a(0xaf),{});},modal[_0x1328c0(0x91)][_0x1328c0(0x8d)]('show');};document[a0_0x2aec87(0xae)](a0_0x2aec87(0x87))[a0_0x2aec87(0xb5)]=()=>modal['classList']['remove'](a0_0x2aec87(0xa2)),document[a0_0x2aec87(0xae)](a0_0x2aec87(0x90))[a0_0x2aec87(0xb5)]=()=>{const _0x4b0525=a0_0x2aec87;if(modalCallback)modalCallback();modal[_0x4b0525(0x91)]['remove'](_0x4b0525(0xa2));},messageInput['addEventListener'](a0_0x2aec87(0x8e),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x2aec87(0xd2),_0x4c5424=>{const _0xffcdc8=a0_0x2aec87;_0x4c5424[_0xffcdc8(0xce)]===_0xffcdc8(0x7e)&&!_0x4c5424[_0xffcdc8(0xd7)]&&(_0x4c5424['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x2aec87(0x95)](a0_0x2aec87(0x86),_0x29683e=>{const _0x1d32af=a0_0x2aec87;document['querySelectorAll'](_0x1d32af(0xee))['forEach'](_0xa08b11=>{const _0x5aae04=_0x1d32af;if(!_0xa08b11[_0x5aae04(0xe4)](_0x29683e['target']))_0xa08b11[_0x5aae04(0x91)]['remove'](_0x5aae04(0xa9));});});const saved=localStorage[a0_0x2aec87(0xd4)](a0_0x2aec87(0xbb));if(saved)try{messages=JSON[a0_0x2aec87(0xcd)](saved),renderMessages();}catch(a0_0xbe1ed5){}updateSendButton();function a0_0x378d(){const _0x5e6681=['8lLXQez','getElementById','clear_history','<br>','scrollHeight','div','impactOccurred','TG\x20setup\x20error:','onclick','stopPropagation','isVersionAtLeast','touchend','className','resize','ai_chat_messages','Начнется\x20новый\x20диалог.','json','send_message','debug_uid','timestamp','Ошибка\x20сети','Очистить\x20историю?','1080FPpWxb','warn','height','offClick','abort','now','role','floor','innerHeight','Действие\x20необратимо.','parse','key','textContent','disableVerticalSwipes','forEach','keydown','sendBtn','getItem','./router.html','user','shiftKey','message\x20','6.1','Пустой\x20ответ','.container','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','search','remove','BackButton','ready','from','setHeaderColor','viewportHeight','contains','text','17410nASzRh','replace','trim','emptyState','messageInput','paddingBottom','6zITWrh','20AxcjAQ','.message.show-delete','length','99440OwYYts','createElement','notificationOccurred','confirmModal','offsetHeight','Удалить?','message-bubble','chatArea','viewportChanged','getHours','initData','inputArea','WebApp','modalText','POST','innerHTML','setItem','getMinutes','HapticFeedback','light','modalTitle','62tVKgEi','first_name','stringify','Enter','success','clearBtn','children','username','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','random','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','click','modalCancel','error','message-time','Ошибка\x20сервера','constructor','auto','add','input','touchstart','modalConfirm','classList','style','focus','padStart','addEventListener','appendChild','onClick','typingIndicator','value','message\x20ai','splice','flex','content','89999edrPuN','(((.+)+)+)+$','signal','555265QghGpy','show','4597029ZXsnEl','push','removeItem','scrollTop','27819bXcmNN','468825XJhTHi','show-delete','297aQrQkZ','toString','none'];a0_0x378d=function(){return _0x5e6681;};return a0_0x378d();}