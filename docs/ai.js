const a0_0x5aa146=a0_0x4af9;(function(_0x2fabc6,_0x1fc4bd){const _0x2ebd19=a0_0x4af9,_0x32cde3=_0x2fabc6();while(!![]){try{const _0x43d899=-parseInt(_0x2ebd19(0x134))/0x1+parseInt(_0x2ebd19(0x17e))/0x2+parseInt(_0x2ebd19(0x17c))/0x3+-parseInt(_0x2ebd19(0x185))/0x4+parseInt(_0x2ebd19(0x141))/0x5*(-parseInt(_0x2ebd19(0x130))/0x6)+-parseInt(_0x2ebd19(0x192))/0x7*(parseInt(_0x2ebd19(0x158))/0x8)+parseInt(_0x2ebd19(0x12b))/0x9;if(_0x43d899===_0x1fc4bd)break;else _0x32cde3['push'](_0x32cde3['shift']());}catch(_0x4a9acc){_0x32cde3['push'](_0x32cde3['shift']());}}}(a0_0x53fa,0x650f2));const tg=window['Telegram']?.[a0_0x5aa146(0x196)],HOME_URL=a0_0x5aa146(0x181);function setupTelegramBackButton(){const _0x4c51ee=a0_0x5aa146,_0x4730af=(function(){let _0x1a2d57=!![];return function(_0x2102c7,_0x8cde28){const _0x17995b=_0x1a2d57?function(){const _0x4c5521=a0_0x4af9;if(_0x8cde28){const _0x4de43f=_0x8cde28[_0x4c5521(0x18d)](_0x2102c7,arguments);return _0x8cde28=null,_0x4de43f;}}:function(){};return _0x1a2d57=![],_0x17995b;};}()),_0x3dba57=_0x4730af(this,function(){const _0x5e1254=a0_0x4af9;return _0x3dba57[_0x5e1254(0x142)]()[_0x5e1254(0x146)](_0x5e1254(0x149))[_0x5e1254(0x142)]()['constructor'](_0x3dba57)['search'](_0x5e1254(0x149));});_0x3dba57();if(!tg)return;try{tg[_0x4c51ee(0x19b)](),tg['expand'](),tg[_0x4c51ee(0x13c)]?.(_0x4c51ee(0x150));if(tg[_0x4c51ee(0x15f)]?.(_0x4c51ee(0x14a)))tg['disableVerticalSwipes']?.();const _0x2a16d0=tg[_0x4c51ee(0x17a)];if(_0x2a16d0){_0x2a16d0[_0x4c51ee(0x163)]();if(typeof _0x2a16d0[_0x4c51ee(0x13a)]===_0x4c51ee(0x153))try{_0x2a16d0[_0x4c51ee(0x13a)]();}catch(_0x6c2ff3){}_0x2a16d0[_0x4c51ee(0x167)](()=>{const _0x30e5c7=_0x4c51ee;if(tg[_0x30e5c7(0x165)])tg['HapticFeedback']['impactOccurred']('light');location['href']=HOME_URL;});}}catch(_0x42c359){console[_0x4c51ee(0x174)]('TG\x20setup\x20error:',_0x42c359);}}(function initStableLayout(){const _0x2946d5=a0_0x5aa146,_0x2e1f4e=document[_0x2946d5(0x16f)](_0x2946d5(0x14f)),_0x5407e1=document[_0x2946d5(0x16b)](_0x2946d5(0x162)),_0x3bc30c=document[_0x2946d5(0x16b)](_0x2946d5(0x19f)),_0x4244d9=document['getElementById'](_0x2946d5(0x18e));function _0x335cfc(){const _0x388034=_0x2946d5;if(!_0x2e1f4e)return;const _0x4e5c1e=tg&&tg[_0x388034(0x176)]?tg[_0x388034(0x176)]:window['innerHeight'];_0x2e1f4e[_0x388034(0x168)]['height']=_0x4e5c1e+'px';if(_0x5407e1){const _0x590247=_0x5407e1[_0x388034(0x139)];_0x3bc30c[_0x388034(0x168)][_0x388034(0x19c)]=_0x590247+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x5421d6})=>{_0x335cfc();if(_0x5421d6)requestAnimationFrame(()=>{const _0x50d27c=a0_0x4af9;_0x3bc30c[_0x50d27c(0x164)]=_0x3bc30c['scrollHeight'];});}):window[_0x2946d5(0x189)]('resize',_0x335cfc),_0x335cfc(),_0x4244d9&&(_0x4244d9[_0x2946d5(0x189)](_0x2946d5(0x147),()=>{requestAnimationFrame(_0x335cfc);}),_0x4244d9['addEventListener'](_0x2946d5(0x199),()=>{setTimeout(()=>{const _0x1f16c0=a0_0x4af9;_0x3bc30c['scrollTop']=_0x3bc30c[_0x1f16c0(0x18c)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5aa146(0x133),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x5aa146(0x19f)),emptyState=document[a0_0x5aa146(0x16b)](a0_0x5aa146(0x1a1)),messageInput=document['getElementById'](a0_0x5aa146(0x18e)),sendBtn=document[a0_0x5aa146(0x16b)](a0_0x5aa146(0x169)),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0x5aa146(0x16b)]('confirmModal'),mTitle=document[a0_0x5aa146(0x16b)](a0_0x5aa146(0x136)),mText=document[a0_0x5aa146(0x16b)]('modalText');function a0_0x4af9(_0x408769,_0x2c7458){_0x408769=_0x408769-0x128;const _0x45017b=a0_0x53fa();let _0x4727c4=_0x45017b[_0x408769];return _0x4727c4;}let modalCallback=null;async function callBackend(_0x1607d4,_0x345a3b){const _0x5a2d7e=a0_0x5aa146,_0x103319=tg?.[_0x5a2d7e(0x131)]?.[_0x5a2d7e(0x182)]||{},_0x1ea126=_0x103319['id']||localStorage['getItem'](_0x5a2d7e(0x12c))||'d-'+Math[_0x5a2d7e(0x170)](Math[_0x5a2d7e(0x144)]()*0x3b9aca00);if(!_0x103319['id'])localStorage['setItem']('debug_uid',_0x1ea126);const _0x63e500={'action':_0x1607d4,'user_id':_0x1ea126,'user_data':{'first_name':_0x103319[_0x5a2d7e(0x151)],'username':_0x103319[_0x5a2d7e(0x198)]},'init_data':tg?.['initData']||'',..._0x345a3b},_0x528eb9=new AbortController(),_0x130ebb=setTimeout(()=>_0x528eb9['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3ec3c1=await fetch(BACKEND_URL,{'method':_0x5a2d7e(0x12d),'headers':{'Content-Type':_0x5a2d7e(0x17b)},'body':JSON[_0x5a2d7e(0x14c)](_0x63e500),'signal':_0x528eb9[_0x5a2d7e(0x129)]});return clearTimeout(_0x130ebb),await _0x3ec3c1['json']();}catch(_0x15df0a){return{'success':![],'error':String(_0x15df0a)};}}function formatTime(_0x29fcff){const _0x13f7fe=a0_0x5aa146,_0xd023eb=new Date(_0x29fcff);return String(_0xd023eb['getHours']())[_0x13f7fe(0x194)](0x2,'0')+':'+String(_0xd023eb[_0x13f7fe(0x166)]())[_0x13f7fe(0x194)](0x2,'0');}function createMessageElement(_0x3bf607,_0x3bf3a5){const _0x503309=a0_0x5aa146,_0x4f425c=document[_0x503309(0x19d)](_0x503309(0x15e));_0x4f425c['className']='message\x20'+_0x3bf607[_0x503309(0x14e)];const _0x4a8634=document[_0x503309(0x19d)]('div');_0x4a8634['className']=_0x503309(0x172),_0x4a8634[_0x503309(0x183)]=_0x3bf607['content'][_0x503309(0x15d)](/\n/g,'<br>');const _0x24497a=document[_0x503309(0x19d)](_0x503309(0x15e));_0x24497a[_0x503309(0x171)]=_0x503309(0x1a2),_0x24497a[_0x503309(0x183)]=_0x503309(0x157),_0x24497a[_0x503309(0x154)]=_0x41fe2c=>{const _0x4b7802=_0x503309;_0x41fe2c[_0x4b7802(0x138)](),confirmDelete(_0x3bf3a5);};let _0x3df361;_0x4a8634[_0x503309(0x189)](_0x503309(0x19a),()=>_0x3df361=setTimeout(()=>{const _0x38d804=_0x503309;_0x4f425c[_0x38d804(0x12a)][_0x38d804(0x177)](_0x38d804(0x135));if(tg?.[_0x38d804(0x165)])tg[_0x38d804(0x165)][_0x38d804(0x16c)](_0x38d804(0x186));},0x1f4)),_0x4a8634[_0x503309(0x189)](_0x503309(0x161),()=>clearTimeout(_0x3df361));const _0x41d102=document[_0x503309(0x19d)](_0x503309(0x15e));return _0x41d102[_0x503309(0x171)]=_0x503309(0x190),_0x41d102[_0x503309(0x187)]=formatTime(_0x3bf607[_0x503309(0x195)]),_0x4f425c[_0x503309(0x16a)](_0x24497a),_0x4f425c[_0x503309(0x16a)](_0x4a8634),_0x4f425c[_0x503309(0x16a)](_0x41d102),_0x4f425c;}function createTypingIndicator(){const _0x1f541d=a0_0x5aa146,_0x5e0ac5=document[_0x1f541d(0x19d)](_0x1f541d(0x15e));return _0x5e0ac5[_0x1f541d(0x171)]=_0x1f541d(0x13e),_0x5e0ac5['id']=_0x1f541d(0x15c),_0x5e0ac5[_0x1f541d(0x183)]=_0x1f541d(0x179),_0x5e0ac5;}function renderMessages(){const _0x1f4512=a0_0x5aa146;Array[_0x1f4512(0x193)](chatArea[_0x1f4512(0x175)])[_0x1f4512(0x191)](_0x41074a=>{const _0x188a72=_0x1f4512;if(_0x41074a['id']!==_0x188a72(0x1a1))_0x41074a['remove']();}),messages[_0x1f4512(0x16e)]>0x0?(emptyState['style']['display']=_0x1f4512(0x173),messages[_0x1f4512(0x191)]((_0x573c64,_0x444d25)=>chatArea[_0x1f4512(0x16a)](createMessageElement(_0x573c64,_0x444d25)))):emptyState[_0x1f4512(0x168)][_0x1f4512(0x128)]=_0x1f4512(0x137),requestAnimationFrame(()=>chatArea[_0x1f4512(0x164)]=chatArea[_0x1f4512(0x18c)]);}function a0_0x53fa(){const _0x12344e=['Начнется\x20новый\x20диалог.','auto','typingIndicator','replace','div','isVersionAtLeast','keydown','touchend','inputArea','show','scrollTop','HapticFeedback','getMinutes','onClick','style','sendBtn','appendChild','getElementById','impactOccurred','preventDefault','length','querySelector','floor','className','message-bubble','none','warn','children','viewportHeight','add','click','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','BackButton','text/plain','1339350MBmvwv','shiftKey','286564qAsYOL','notificationOccurred','Ошибка\x20сервера','./router.html','user','innerHTML','setItem','2669712HnvIRp','medium','textContent','Ошибка\x20сети','addEventListener','Enter','min','scrollHeight','apply','messageInput','value','message-time','forEach','21MdDGbv','from','padStart','timestamp','WebApp','push','username','focus','touchstart','ready','paddingBottom','createElement','Действие\x20необратимо.','chatArea','.message.show-delete','emptyState','delete-btn','display','signal','classList','13478868odGeeo','debug_uid','POST','clear_history','height','330hDmVmE','initDataUnsafe','error','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','130277EDfXwx','show-delete','modalTitle','flex','stopPropagation','offsetHeight','offClick','light','setHeaderColor','remove','message\x20ai','key','trim','57985xFqbef','toString','target','random','ai_chat_messages','search','input','text','(((.+)+)+)+$','6.1','modalCancel','stringify','send_message','role','.container','#050505','first_name','parse','function','onclick','now','removeItem','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','634416pXZZZS','Удалить?'];a0_0x53fa=function(){return _0x12344e;};return a0_0x53fa();}function autoResizeTextarea(){const _0x373beb=a0_0x5aa146;messageInput['style'][_0x373beb(0x12f)]=_0x373beb(0x15b),messageInput['style'][_0x373beb(0x12f)]=Math[_0x373beb(0x18b)](messageInput[_0x373beb(0x18c)],0x78)+'px';}function updateSendButton(){const _0x4b8e67=a0_0x5aa146,_0x55f0e3=messageInput[_0x4b8e67(0x18f)][_0x4b8e67(0x140)]();sendBtn['disabled']=!_0x55f0e3||isTyping;}async function sendMessage(){const _0x1bcc55=a0_0x5aa146,_0x260c7b=messageInput[_0x1bcc55(0x18f)][_0x1bcc55(0x140)]();if(!_0x260c7b||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x1bcc55(0x165)]['impactOccurred'](_0x1bcc55(0x13b));messages[_0x1bcc55(0x197)]({'role':_0x1bcc55(0x182),'content':_0x260c7b,'timestamp':Date[_0x1bcc55(0x155)]()}),localStorage[_0x1bcc55(0x184)](_0x1bcc55(0x145),JSON['stringify'](messages)),renderMessages(),messageInput[_0x1bcc55(0x18f)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1bcc55(0x16a)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x1bcc55(0x18c)];const _0x25a31d=await callBackend(_0x1bcc55(0x14d),{'message':_0x260c7b});isTyping=![];const _0x106358=document[_0x1bcc55(0x16b)](_0x1bcc55(0x15c));if(_0x106358)_0x106358[_0x1bcc55(0x13d)]();let _0x4e1ae2=_0x1bcc55(0x188);if(_0x25a31d['success']){_0x4e1ae2=_0x25a31d[_0x1bcc55(0x148)]||'Пустой\x20ответ';if(tg?.[_0x1bcc55(0x165)])tg[_0x1bcc55(0x165)][_0x1bcc55(0x17f)]('success');}else{_0x4e1ae2=_0x25a31d[_0x1bcc55(0x132)]||_0x1bcc55(0x180);if(tg?.[_0x1bcc55(0x165)])tg[_0x1bcc55(0x165)]['notificationOccurred'](_0x1bcc55(0x132));}messages[_0x1bcc55(0x197)]({'role':'ai','content':_0x4e1ae2,'timestamp':Date[_0x1bcc55(0x155)]()}),localStorage['setItem'](_0x1bcc55(0x145),JSON[_0x1bcc55(0x14c)](messages)),renderMessages();}function confirmDelete(_0x5e818a){const _0x3c357c=a0_0x5aa146;if(mTitle)mTitle[_0x3c357c(0x187)]=_0x3c357c(0x159);if(mText)mText[_0x3c357c(0x187)]=_0x3c357c(0x19e);modalCallback=()=>{const _0x4e0f66=_0x3c357c;messages['splice'](_0x5e818a,0x1),localStorage[_0x4e0f66(0x184)](_0x4e0f66(0x145),JSON[_0x4e0f66(0x14c)](messages)),renderMessages();},modal[_0x3c357c(0x12a)][_0x3c357c(0x177)](_0x3c357c(0x163));}if(clearBtn)clearBtn[a0_0x5aa146(0x154)]=()=>{const _0x4e1a22=a0_0x5aa146;if(!messages[_0x4e1a22(0x16e)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x4e1a22(0x187)]=_0x4e1a22(0x15a);modalCallback=async()=>{const _0x325fab=_0x4e1a22;messages=[],localStorage[_0x325fab(0x156)](_0x325fab(0x145)),renderMessages(),callBackend(_0x325fab(0x12e),{});},modal[_0x4e1a22(0x12a)][_0x4e1a22(0x177)](_0x4e1a22(0x163));};document[a0_0x5aa146(0x16b)](a0_0x5aa146(0x14b))[a0_0x5aa146(0x154)]=()=>modal[a0_0x5aa146(0x12a)][a0_0x5aa146(0x13d)](a0_0x5aa146(0x163)),document[a0_0x5aa146(0x16b)]('modalConfirm')[a0_0x5aa146(0x154)]=()=>{const _0x3c4b72=a0_0x5aa146;if(modalCallback)modalCallback();modal[_0x3c4b72(0x12a)][_0x3c4b72(0x13d)](_0x3c4b72(0x163));},messageInput[a0_0x5aa146(0x189)](a0_0x5aa146(0x147),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5aa146(0x189)](a0_0x5aa146(0x160),_0x2f8351=>{const _0x3b1165=a0_0x5aa146;_0x2f8351[_0x3b1165(0x13f)]===_0x3b1165(0x18a)&&!_0x2f8351[_0x3b1165(0x17d)]&&(_0x2f8351[_0x3b1165(0x16d)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x5aa146(0x189)](a0_0x5aa146(0x178),_0x8ac4a9=>{const _0x1df668=a0_0x5aa146;document['querySelectorAll'](_0x1df668(0x1a0))[_0x1df668(0x191)](_0x5c3268=>{const _0x89b8b2=_0x1df668;if(!_0x5c3268['contains'](_0x8ac4a9[_0x89b8b2(0x143)]))_0x5c3268[_0x89b8b2(0x12a)][_0x89b8b2(0x13d)](_0x89b8b2(0x135));});});const saved=localStorage['getItem'](a0_0x5aa146(0x145));if(saved)try{messages=JSON[a0_0x5aa146(0x152)](saved),renderMessages();}catch(a0_0x82633f){}updateSendButton();