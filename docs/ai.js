const a0_0x3571e4=a0_0x1e16;(function(_0x2f7764,_0x314766){const _0x2198a9=a0_0x1e16,_0x51dd57=_0x2f7764();while(!![]){try{const _0x3794e9=-parseInt(_0x2198a9(0x111))/0x1*(parseInt(_0x2198a9(0x14d))/0x2)+parseInt(_0x2198a9(0x148))/0x3*(parseInt(_0x2198a9(0x13a))/0x4)+parseInt(_0x2198a9(0x142))/0x5*(-parseInt(_0x2198a9(0x11e))/0x6)+-parseInt(_0x2198a9(0x146))/0x7+parseInt(_0x2198a9(0x144))/0x8*(parseInt(_0x2198a9(0x10d))/0x9)+-parseInt(_0x2198a9(0x128))/0xa+parseInt(_0x2198a9(0xfc))/0xb;if(_0x3794e9===_0x314766)break;else _0x51dd57['push'](_0x51dd57['shift']());}catch(_0x34a1de){_0x51dd57['push'](_0x51dd57['shift']());}}}(a0_0x3b08,0x1bfaa));const tg=window[a0_0x3571e4(0x118)]?.[a0_0x3571e4(0x16c)],HOME_URL=a0_0x3571e4(0x16f);function a0_0x1e16(_0x5d98d4,_0x1ec77d){_0x5d98d4=_0x5d98d4-0xfb;const _0x49efd7=a0_0x3b08();let _0x1850ce=_0x49efd7[_0x5d98d4];return _0x1850ce;}function setupTelegramBackButton(){const _0x40061d=a0_0x3571e4,_0x3b9fe8=(function(){let _0x58eac6=!![];return function(_0x3c3d6b,_0x4fbfd8){const _0x3be89a=_0x58eac6?function(){const _0x4f36e8=a0_0x1e16;if(_0x4fbfd8){const _0x33573=_0x4fbfd8[_0x4f36e8(0x126)](_0x3c3d6b,arguments);return _0x4fbfd8=null,_0x33573;}}:function(){};return _0x58eac6=![],_0x3be89a;};}()),_0x1cfd42=_0x3b9fe8(this,function(){const _0x12e11c=a0_0x1e16;return _0x1cfd42[_0x12e11c(0x13b)]()[_0x12e11c(0x173)](_0x12e11c(0x12c))[_0x12e11c(0x13b)]()[_0x12e11c(0x178)](_0x1cfd42)['search'](_0x12e11c(0x12c));});_0x1cfd42();if(!tg)return;try{tg[_0x40061d(0x176)](),tg[_0x40061d(0x160)](),tg[_0x40061d(0x172)]?.('#050505');if(tg[_0x40061d(0x161)]?.(_0x40061d(0x16a)))tg[_0x40061d(0x16b)]?.();const _0x1f9d3c=tg[_0x40061d(0x145)];if(_0x1f9d3c){_0x1f9d3c[_0x40061d(0x132)]();if(typeof _0x1f9d3c['offClick']==='function')try{_0x1f9d3c[_0x40061d(0x165)]();}catch(_0x5538ef){}_0x1f9d3c[_0x40061d(0x170)](()=>{const _0x55b2cd=_0x40061d;if(tg[_0x55b2cd(0x121)])tg[_0x55b2cd(0x121)][_0x55b2cd(0x135)](_0x55b2cd(0x105));location[_0x55b2cd(0x102)]=HOME_URL;});}}catch(_0x23f222){console[_0x40061d(0x104)]('TG\x20setup\x20error:',_0x23f222);}}(function initStableLayout(){const _0x4d22ea=a0_0x3571e4,_0x19d9af=document[_0x4d22ea(0x167)](_0x4d22ea(0x131)),_0x4d284f=document[_0x4d22ea(0x164)](_0x4d22ea(0x175)),_0x5e8aaa=document[_0x4d22ea(0x164)](_0x4d22ea(0x163)),_0x5826dc=document['getElementById'](_0x4d22ea(0x153));function _0x506d66(){const _0x119466=_0x4d22ea;if(!_0x19d9af)return;const _0x1779ea=tg&&tg[_0x119466(0x115)]?tg[_0x119466(0x115)]:window[_0x119466(0x17c)];_0x19d9af[_0x119466(0xfb)]['height']=_0x1779ea+'px';if(_0x4d284f){const _0x117a9b=_0x4d284f[_0x119466(0x103)];_0x5e8aaa[_0x119466(0xfb)][_0x119466(0x13e)]=_0x117a9b+0x28+'px';}}tg?tg[_0x4d22ea(0x17a)]('viewportChanged',({isStateStable:_0x3ecdd0})=>{_0x506d66();if(_0x3ecdd0)requestAnimationFrame(()=>{const _0x2c67e9=a0_0x1e16;_0x5e8aaa[_0x2c67e9(0x14f)]=_0x5e8aaa[_0x2c67e9(0x10b)];});}):window[_0x4d22ea(0x12b)](_0x4d22ea(0x140),_0x506d66),_0x506d66(),_0x5826dc&&(_0x5826dc[_0x4d22ea(0x12b)](_0x4d22ea(0x130),()=>{requestAnimationFrame(_0x506d66);}),_0x5826dc[_0x4d22ea(0x12b)](_0x4d22ea(0x162),()=>{setTimeout(()=>{const _0x3e1bf6=a0_0x1e16;_0x5e8aaa[_0x3e1bf6(0x14f)]=_0x5e8aaa[_0x3e1bf6(0x10b)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3571e4(0x15b),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3571e4(0x164)](a0_0x3571e4(0x163)),emptyState=document[a0_0x3571e4(0x164)](a0_0x3571e4(0x108)),messageInput=document[a0_0x3571e4(0x164)](a0_0x3571e4(0x153)),sendBtn=document[a0_0x3571e4(0x164)](a0_0x3571e4(0x124)),clearBtn=document[a0_0x3571e4(0x164)](a0_0x3571e4(0x168)),modal=document[a0_0x3571e4(0x164)](a0_0x3571e4(0x166)),mTitle=document[a0_0x3571e4(0x164)]('modalTitle'),mText=document[a0_0x3571e4(0x164)](a0_0x3571e4(0x147));let modalCallback=null;async function callBackend(_0x3602a7,_0xd141fc){const _0x42586a=a0_0x3571e4,_0x3c1284=tg?.[_0x42586a(0x179)]?.[_0x42586a(0x12a)]||{},_0xcdd4c5=_0x3c1284['id']||localStorage['getItem'](_0x42586a(0x109))||'d-'+Math[_0x42586a(0x12f)](Math['random']()*0x3b9aca00);if(!_0x3c1284['id'])localStorage[_0x42586a(0x15c)](_0x42586a(0x109),_0xcdd4c5);const _0x35b936={'action':_0x3602a7,'user_id':_0xcdd4c5,'user_data':{'first_name':_0x3c1284[_0x42586a(0x151)],'username':_0x3c1284[_0x42586a(0x112)]},'init_data':tg?.[_0x42586a(0x13d)]||'',..._0xd141fc},_0x3b807b=new AbortController(),_0x3ed592=setTimeout(()=>_0x3b807b[_0x42586a(0x17b)](),REQUEST_TIMEOUT_MS);try{const _0x3e58c5=await fetch(BACKEND_URL,{'method':_0x42586a(0x123),'headers':{'Content-Type':_0x42586a(0x139)},'body':JSON[_0x42586a(0x11d)](_0x35b936),'signal':_0x3b807b['signal']});return clearTimeout(_0x3ed592),await _0x3e58c5[_0x42586a(0x15d)]();}catch(_0x344fd8){return{'success':![],'error':String(_0x344fd8)};}}function formatTime(_0x563976){const _0x33004c=a0_0x3571e4,_0x28e8f1=new Date(_0x563976);return String(_0x28e8f1[_0x33004c(0x13f)]())[_0x33004c(0x149)](0x2,'0')+':'+String(_0x28e8f1[_0x33004c(0x16e)]())['padStart'](0x2,'0');}function createMessageElement(_0x3f94f3,_0x1237a8){const _0x1d2ed0=a0_0x3571e4,_0x4d2002=document[_0x1d2ed0(0x16d)](_0x1d2ed0(0x11a));_0x4d2002[_0x1d2ed0(0x11b)]=_0x1d2ed0(0x174)+_0x3f94f3[_0x1d2ed0(0x14a)];const _0x4d0707=document[_0x1d2ed0(0x16d)](_0x1d2ed0(0x11a));_0x4d0707[_0x1d2ed0(0x11b)]='message-bubble',_0x4d0707[_0x1d2ed0(0x158)]=_0x3f94f3[_0x1d2ed0(0x154)]['replace'](/\n/g,_0x1d2ed0(0x116));const _0x3960a2=document[_0x1d2ed0(0x16d)]('div');_0x3960a2[_0x1d2ed0(0x11b)]='delete-btn',_0x3960a2[_0x1d2ed0(0x158)]=_0x1d2ed0(0xfe),_0x3960a2[_0x1d2ed0(0x107)]=_0x204f6a=>{const _0xf8f6a5=_0x1d2ed0;_0x204f6a[_0xf8f6a5(0x120)](),confirmDelete(_0x1237a8);};let _0x68b917;_0x4d0707[_0x1d2ed0(0x12b)](_0x1d2ed0(0x13c),()=>_0x68b917=setTimeout(()=>{const _0x110018=_0x1d2ed0;_0x4d2002[_0x110018(0x12e)][_0x110018(0x138)]('show-delete');if(tg?.[_0x110018(0x121)])tg[_0x110018(0x121)][_0x110018(0x135)]('medium');},0x1f4)),_0x4d0707[_0x1d2ed0(0x12b)](_0x1d2ed0(0x11c),()=>clearTimeout(_0x68b917));const _0x2b0edd=document[_0x1d2ed0(0x16d)]('div');return _0x2b0edd['className']=_0x1d2ed0(0x152),_0x2b0edd[_0x1d2ed0(0x171)]=formatTime(_0x3f94f3['timestamp']),_0x4d2002[_0x1d2ed0(0xff)](_0x3960a2),_0x4d2002[_0x1d2ed0(0xff)](_0x4d0707),_0x4d2002[_0x1d2ed0(0xff)](_0x2b0edd),_0x4d2002;}function createTypingIndicator(){const _0x4ba1e9=a0_0x3571e4,_0x4a4c3e=document['createElement'](_0x4ba1e9(0x11a));return _0x4a4c3e[_0x4ba1e9(0x11b)]=_0x4ba1e9(0xfd),_0x4a4c3e['id']=_0x4ba1e9(0x14c),_0x4a4c3e['innerHTML']=_0x4ba1e9(0x134),_0x4a4c3e;}function renderMessages(){const _0x14f7aa=a0_0x3571e4;Array['from'](chatArea[_0x14f7aa(0x14b)])[_0x14f7aa(0x113)](_0x234ff8=>{const _0x4936e3=_0x14f7aa;if(_0x234ff8['id']!=='emptyState')_0x234ff8[_0x4936e3(0x129)]();}),messages['length']>0x0?(emptyState[_0x14f7aa(0xfb)][_0x14f7aa(0x15f)]='none',messages[_0x14f7aa(0x113)]((_0x357a92,_0x4222c6)=>chatArea[_0x14f7aa(0xff)](createMessageElement(_0x357a92,_0x4222c6)))):emptyState['style'][_0x14f7aa(0x15f)]='flex',requestAnimationFrame(()=>chatArea[_0x14f7aa(0x14f)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0xa513d3=a0_0x3571e4;messageInput[_0xa513d3(0xfb)][_0xa513d3(0x10e)]=_0xa513d3(0x10c),messageInput['style']['height']=Math['min'](messageInput[_0xa513d3(0x10b)],0x78)+'px';}function a0_0x3b08(){const _0xccab4c=['push','constructor','initDataUnsafe','onEvent','abort','innerHeight','style','3778467DRbvYp','message\x20ai','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','appendChild','send_message','disabled','href','offsetHeight','warn','light','Ошибка\x20сети','onclick','emptyState','debug_uid','querySelectorAll','scrollHeight','auto','1278pOngBT','height','splice','Действие\x20необратимо.','1fgeXWb','username','forEach','preventDefault','viewportHeight','<br>','key','Telegram','modalCancel','div','className','touchend','stringify','126oHtLiI','shiftKey','stopPropagation','HapticFeedback','ai_chat_messages','POST','sendBtn','Ошибка\x20сервера','apply','notificationOccurred','72480RlXkSY','remove','user','addEventListener','(((.+)+)+)+$','Удалить?','classList','floor','input','.container','show','length','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','impactOccurred','getItem','trim','add','text/plain','4iVlCKL','toString','touchstart','initData','paddingBottom','getHours','resize','success','51645sDLeeI','now','2264cQzhUi','BackButton','1050784wSeVDV','modalText','317157LGEPBR','padStart','role','children','typingIndicator','1062NUnDon','Начнется\x20новый\x20диалог.','scrollTop','target','first_name','message-time','messageInput','content','modalConfirm','click','error','innerHTML','Пустой\x20ответ','value','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','setItem','json','show-delete','display','expand','isVersionAtLeast','focus','chatArea','getElementById','offClick','confirmModal','querySelector','clearBtn','Очистить\x20историю?','6.1','disableVerticalSwipes','WebApp','createElement','getMinutes','./router.html','onClick','textContent','setHeaderColor','search','message\x20','inputArea','ready'];a0_0x3b08=function(){return _0xccab4c;};return a0_0x3b08();}function updateSendButton(){const _0xc3228d=a0_0x3571e4,_0x1517db=messageInput[_0xc3228d(0x15a)][_0xc3228d(0x137)]();sendBtn[_0xc3228d(0x101)]=!_0x1517db||isTyping;}async function sendMessage(){const _0x3675a8=a0_0x3571e4,_0x44aae1=messageInput[_0x3675a8(0x15a)]['trim']();if(!_0x44aae1||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x3675a8(0x121)][_0x3675a8(0x135)](_0x3675a8(0x105));messages[_0x3675a8(0x177)]({'role':_0x3675a8(0x12a),'content':_0x44aae1,'timestamp':Date[_0x3675a8(0x143)]()}),localStorage[_0x3675a8(0x15c)](_0x3675a8(0x122),JSON[_0x3675a8(0x11d)](messages)),renderMessages(),messageInput[_0x3675a8(0x15a)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x3675a8(0xff)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x3675a8(0x10b)];const _0xaef7e9=await callBackend(_0x3675a8(0x100),{'message':_0x44aae1});isTyping=![];const _0x146482=document[_0x3675a8(0x164)](_0x3675a8(0x14c));if(_0x146482)_0x146482['remove']();let _0x4efed0=_0x3675a8(0x106);if(_0xaef7e9[_0x3675a8(0x141)]){_0x4efed0=_0xaef7e9['text']||_0x3675a8(0x159);if(tg?.[_0x3675a8(0x121)])tg[_0x3675a8(0x121)]['notificationOccurred'](_0x3675a8(0x141));}else{_0x4efed0=_0xaef7e9[_0x3675a8(0x157)]||_0x3675a8(0x125);if(tg?.[_0x3675a8(0x121)])tg[_0x3675a8(0x121)][_0x3675a8(0x127)](_0x3675a8(0x157));}messages[_0x3675a8(0x177)]({'role':'ai','content':_0x4efed0,'timestamp':Date[_0x3675a8(0x143)]()}),localStorage[_0x3675a8(0x15c)](_0x3675a8(0x122),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x17ecdb){const _0x3342c0=a0_0x3571e4;if(mTitle)mTitle[_0x3342c0(0x171)]=_0x3342c0(0x12d);if(mText)mText[_0x3342c0(0x171)]=_0x3342c0(0x110);modalCallback=()=>{const _0x282b68=_0x3342c0;messages[_0x282b68(0x10f)](_0x17ecdb,0x1),localStorage[_0x282b68(0x15c)](_0x282b68(0x122),JSON['stringify'](messages)),renderMessages();},modal[_0x3342c0(0x12e)][_0x3342c0(0x138)]('show');}if(clearBtn)clearBtn[a0_0x3571e4(0x107)]=()=>{const _0x5b4d55=a0_0x3571e4;if(!messages[_0x5b4d55(0x133)])return;if(mTitle)mTitle['textContent']=_0x5b4d55(0x169);if(mText)mText['textContent']=_0x5b4d55(0x14e);modalCallback=async()=>{messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x5b4d55(0x12e)]['add'](_0x5b4d55(0x132));};document[a0_0x3571e4(0x164)](a0_0x3571e4(0x119))[a0_0x3571e4(0x107)]=()=>modal['classList']['remove'](a0_0x3571e4(0x132)),document['getElementById'](a0_0x3571e4(0x155))[a0_0x3571e4(0x107)]=()=>{const _0x2fe410=a0_0x3571e4;if(modalCallback)modalCallback();modal[_0x2fe410(0x12e)]['remove'](_0x2fe410(0x132));},messageInput[a0_0x3571e4(0x12b)](a0_0x3571e4(0x130),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3571e4(0x12b)]('keydown',_0x3d75f1=>{const _0x3b3ea0=a0_0x3571e4;_0x3d75f1[_0x3b3ea0(0x117)]==='Enter'&&!_0x3d75f1[_0x3b3ea0(0x11f)]&&(_0x3d75f1[_0x3b3ea0(0x114)](),sendMessage());}),sendBtn[a0_0x3571e4(0x107)]=sendMessage,document[a0_0x3571e4(0x12b)](a0_0x3571e4(0x156),_0x333ed8=>{const _0x3faae1=a0_0x3571e4;document[_0x3faae1(0x10a)]('.message.show-delete')[_0x3faae1(0x113)](_0x5af527=>{const _0x4b4b45=_0x3faae1;if(!_0x5af527['contains'](_0x333ed8[_0x4b4b45(0x150)]))_0x5af527[_0x4b4b45(0x12e)][_0x4b4b45(0x129)](_0x4b4b45(0x15e));});});const saved=localStorage[a0_0x3571e4(0x136)](a0_0x3571e4(0x122));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x437c0e){}updateSendButton();