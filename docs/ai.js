const a0_0x3fedcd=a0_0x2f74;(function(_0x16b46a,_0x3a5b20){const _0x5f37f7=a0_0x2f74,_0x8c913e=_0x16b46a();while(!![]){try{const _0x2f2058=parseInt(_0x5f37f7(0x193))/0x1*(-parseInt(_0x5f37f7(0x1e3))/0x2)+parseInt(_0x5f37f7(0x1ca))/0x3*(-parseInt(_0x5f37f7(0x1e4))/0x4)+parseInt(_0x5f37f7(0x194))/0x5+parseInt(_0x5f37f7(0x16a))/0x6+parseInt(_0x5f37f7(0x198))/0x7*(parseInt(_0x5f37f7(0x1b7))/0x8)+parseInt(_0x5f37f7(0x192))/0x9*(parseInt(_0x5f37f7(0x17d))/0xa)+-parseInt(_0x5f37f7(0x1d1))/0xb;if(_0x2f2058===_0x3a5b20)break;else _0x8c913e['push'](_0x8c913e['shift']());}catch(_0x449b1f){_0x8c913e['push'](_0x8c913e['shift']());}}}(a0_0x4df0,0x54bd4));const tg=window[a0_0x3fedcd(0x18c)]?.[a0_0x3fedcd(0x171)],HOME_URL=a0_0x3fedcd(0x184);function setupTelegramBackButton(){const _0xd72cd1=a0_0x3fedcd,_0x13353f=(function(){let _0x2e9c64=!![];return function(_0x683a3b,_0x4bd7a9){const _0x39e2f7=_0x2e9c64?function(){const _0xcf25dd=a0_0x2f74;if(_0x4bd7a9){const _0x35a68c=_0x4bd7a9[_0xcf25dd(0x18d)](_0x683a3b,arguments);return _0x4bd7a9=null,_0x35a68c;}}:function(){};return _0x2e9c64=![],_0x39e2f7;};}()),_0x1504a4=_0x13353f(this,function(){const _0x3fd4c7=a0_0x2f74;return _0x1504a4[_0x3fd4c7(0x1ad)]()[_0x3fd4c7(0x19a)](_0x3fd4c7(0x1d2))[_0x3fd4c7(0x1ad)]()[_0x3fd4c7(0x1dc)](_0x1504a4)[_0x3fd4c7(0x19a)](_0x3fd4c7(0x1d2));});_0x1504a4();if(!tg)return;try{tg[_0xd72cd1(0x19d)](),tg[_0xd72cd1(0x1cf)](),tg[_0xd72cd1(0x1be)]?.(_0xd72cd1(0x1e5));if(tg['isVersionAtLeast']?.(_0xd72cd1(0x197)))tg[_0xd72cd1(0x175)]?.();const _0xb099a2=tg[_0xd72cd1(0x187)];if(_0xb099a2){_0xb099a2[_0xd72cd1(0x178)]();if(typeof _0xb099a2[_0xd72cd1(0x1d9)]===_0xd72cd1(0x1df))try{_0xb099a2[_0xd72cd1(0x1d9)]();}catch(_0x4e18e8){}_0xb099a2[_0xd72cd1(0x190)](()=>{const _0x407114=_0xd72cd1;if(tg[_0x407114(0x163)])tg[_0x407114(0x163)]['impactOccurred']('light');location['href']=HOME_URL;});}}catch(_0x2df818){console[_0xd72cd1(0x1c8)](_0xd72cd1(0x1bb),_0x2df818);}}function a0_0x2f74(_0x2b2501,_0x14d07b){_0x2b2501=_0x2b2501-0x161;const _0x554aad=a0_0x4df0();let _0x23d431=_0x554aad[_0x2b2501];return _0x23d431;}(function initStableLayout(){const _0x13129f=a0_0x3fedcd,_0x262697=document['querySelector']('.container'),_0x5354af=document[_0x13129f(0x19f)]('inputArea'),_0x4d1f72=document[_0x13129f(0x19f)](_0x13129f(0x1e2)),_0x3530b5=document[_0x13129f(0x19f)]('messageInput');function _0x1185d5(){const _0x31e399=_0x13129f;if(!_0x262697)return;const _0x2bc7d7=tg&&tg[_0x31e399(0x1d0)]?tg[_0x31e399(0x1d0)]:window['innerHeight'];_0x262697[_0x31e399(0x1a0)][_0x31e399(0x16b)]=_0x2bc7d7+'px';if(_0x5354af){const _0x135a15=_0x5354af[_0x31e399(0x1b3)];_0x4d1f72[_0x31e399(0x1a0)][_0x31e399(0x1b6)]=_0x135a15+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x37f78d})=>{_0x1185d5();if(_0x37f78d)requestAnimationFrame(()=>{const _0x23c54f=a0_0x2f74;_0x4d1f72[_0x23c54f(0x1a8)]=_0x4d1f72[_0x23c54f(0x17f)];});}):window[_0x13129f(0x1a6)](_0x13129f(0x1c5),_0x1185d5),_0x1185d5(),_0x3530b5&&(_0x3530b5['addEventListener']('input',()=>{requestAnimationFrame(_0x1185d5);}),_0x3530b5[_0x13129f(0x1a6)](_0x13129f(0x1ba),()=>{setTimeout(()=>{const _0x511214=a0_0x2f74;_0x4d1f72['scrollTop']=_0x4d1f72[_0x511214(0x17f)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3fedcd(0x199),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3fedcd(0x19f)](a0_0x3fedcd(0x1e2)),emptyState=document[a0_0x3fedcd(0x19f)](a0_0x3fedcd(0x1b1)),messageInput=document[a0_0x3fedcd(0x19f)]('messageInput'),sendBtn=document['getElementById'](a0_0x3fedcd(0x166)),clearBtn=document[a0_0x3fedcd(0x19f)](a0_0x3fedcd(0x1b2)),modal=document['getElementById'](a0_0x3fedcd(0x1b8)),mTitle=document[a0_0x3fedcd(0x19f)]('modalTitle'),mText=document['getElementById'](a0_0x3fedcd(0x1c9));let modalCallback=null;async function callBackend(_0x5c0483,_0x1552db){const _0xfda6f0=a0_0x3fedcd,_0x300795=tg?.[_0xfda6f0(0x16e)]?.['user']||{},_0x4c3dcc=_0x300795['id']||localStorage[_0xfda6f0(0x16f)](_0xfda6f0(0x1ac))||'d-'+Math[_0xfda6f0(0x181)](Math[_0xfda6f0(0x1c6)]()*0x3b9aca00);if(!_0x300795['id'])localStorage[_0xfda6f0(0x180)](_0xfda6f0(0x1ac),_0x4c3dcc);const _0x48fbc9={'action':_0x5c0483,'user_id':_0x4c3dcc,'user_data':{'first_name':_0x300795[_0xfda6f0(0x167)],'username':_0x300795[_0xfda6f0(0x1e1)]},'init_data':tg?.['initData']||'',..._0x1552db},_0x44db95=new AbortController(),_0x2360a1=setTimeout(()=>_0x44db95[_0xfda6f0(0x1d5)](),REQUEST_TIMEOUT_MS);try{const _0x2ce91d=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0xfda6f0(0x1d7)},'body':JSON[_0xfda6f0(0x1c1)](_0x48fbc9),'signal':_0x44db95[_0xfda6f0(0x185)]});return clearTimeout(_0x2360a1),await _0x2ce91d[_0xfda6f0(0x170)]();}catch(_0x2a079a){return{'success':![],'error':String(_0x2a079a)};}}function a0_0x4df0(){const _0x532b70=['min','5226790FnscgZ','modalConfirm','scrollHeight','setItem','floor','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','show-delete','./router.html','signal','padStart','BackButton','disabled','auto','className','Удалить?','Telegram','apply','createElement','removeItem','onClick','textContent','9wpALmr','208pHOShz','2801025HBzCcK','value','Очистить\x20историю?','6.1','7JfudWM','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','search','ai_chat_messages','push','ready','appendChild','getElementById','style','modalCancel','touchstart','click','replace','shiftKey','addEventListener','notificationOccurred','scrollTop','from','text','Пустой\x20ответ','debug_uid','toString','message\x20ai','error','touchend','emptyState','clearBtn','offsetHeight','innerHTML','preventDefault','paddingBottom','5464544RHTjVY','confirmModal','trim','focus','TG\x20setup\x20error:','role','Ошибка\x20сервера','setHeaderColor','impactOccurred','.message.show-delete','stringify','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','clear_history','onclick','resize','random','medium','warn','modalText','1918479GkIJlu','remove','length','Enter','send_message','expand','viewportHeight','8777483pqilor','(((.+)+)+)+$','children','add','abort','querySelectorAll','text/plain','div','offClick','parse','forEach','constructor','display','target','function','getHours','username','chatArea','1454cCvnRF','4PiqVJg','#050505','getMinutes','timestamp','HapticFeedback','now','message\x20','sendBtn','first_name','input','splice','1018812KEuGFr','height','classList','contains','initDataUnsafe','getItem','json','WebApp','flex','message-time','keydown','disableVerticalSwipes','delete-btn','message-bubble','show','success','none','typingIndicator'];a0_0x4df0=function(){return _0x532b70;};return a0_0x4df0();}function formatTime(_0x29ec5f){const _0x96e80f=a0_0x3fedcd,_0x47e407=new Date(_0x29ec5f);return String(_0x47e407[_0x96e80f(0x1e0)]())[_0x96e80f(0x186)](0x2,'0')+':'+String(_0x47e407[_0x96e80f(0x161)]())[_0x96e80f(0x186)](0x2,'0');}function createMessageElement(_0x229deb,_0x5e1014){const _0x2f7e26=a0_0x3fedcd,_0x3e1971=document[_0x2f7e26(0x18e)](_0x2f7e26(0x1d8));_0x3e1971[_0x2f7e26(0x18a)]=_0x2f7e26(0x165)+_0x229deb[_0x2f7e26(0x1bc)];const _0x6db70=document[_0x2f7e26(0x18e)](_0x2f7e26(0x1d8));_0x6db70['className']=_0x2f7e26(0x177),_0x6db70[_0x2f7e26(0x1b4)]=_0x229deb['content'][_0x2f7e26(0x1a4)](/\n/g,'<br>');const _0x4a1ff3=document[_0x2f7e26(0x18e)](_0x2f7e26(0x1d8));_0x4a1ff3[_0x2f7e26(0x18a)]=_0x2f7e26(0x176),_0x4a1ff3[_0x2f7e26(0x1b4)]=_0x2f7e26(0x1c2),_0x4a1ff3[_0x2f7e26(0x1c4)]=_0x31a971=>{_0x31a971['stopPropagation'](),confirmDelete(_0x5e1014);};let _0x8c5ce;_0x6db70[_0x2f7e26(0x1a6)](_0x2f7e26(0x1a2),()=>_0x8c5ce=setTimeout(()=>{const _0x15ed36=_0x2f7e26;_0x3e1971[_0x15ed36(0x16c)]['add']('show-delete');if(tg?.[_0x15ed36(0x163)])tg[_0x15ed36(0x163)][_0x15ed36(0x1bf)](_0x15ed36(0x1c7));},0x1f4)),_0x6db70[_0x2f7e26(0x1a6)](_0x2f7e26(0x1b0),()=>clearTimeout(_0x8c5ce));const _0x12940a=document[_0x2f7e26(0x18e)]('div');return _0x12940a[_0x2f7e26(0x18a)]=_0x2f7e26(0x173),_0x12940a[_0x2f7e26(0x191)]=formatTime(_0x229deb[_0x2f7e26(0x162)]),_0x3e1971[_0x2f7e26(0x19e)](_0x4a1ff3),_0x3e1971[_0x2f7e26(0x19e)](_0x6db70),_0x3e1971[_0x2f7e26(0x19e)](_0x12940a),_0x3e1971;}function createTypingIndicator(){const _0x6586d2=a0_0x3fedcd,_0x25d8a7=document[_0x6586d2(0x18e)](_0x6586d2(0x1d8));return _0x25d8a7[_0x6586d2(0x18a)]=_0x6586d2(0x1ae),_0x25d8a7['id']=_0x6586d2(0x17b),_0x25d8a7[_0x6586d2(0x1b4)]=_0x6586d2(0x182),_0x25d8a7;}function renderMessages(){const _0x4a8c5b=a0_0x3fedcd;Array[_0x4a8c5b(0x1a9)](chatArea[_0x4a8c5b(0x1d3)])[_0x4a8c5b(0x1db)](_0x44c661=>{if(_0x44c661['id']!=='emptyState')_0x44c661['remove']();}),messages['length']>0x0?(emptyState['style'][_0x4a8c5b(0x1dd)]=_0x4a8c5b(0x17a),messages[_0x4a8c5b(0x1db)]((_0x25849c,_0x4c8a17)=>chatArea[_0x4a8c5b(0x19e)](createMessageElement(_0x25849c,_0x4c8a17)))):emptyState[_0x4a8c5b(0x1a0)][_0x4a8c5b(0x1dd)]=_0x4a8c5b(0x172),requestAnimationFrame(()=>chatArea[_0x4a8c5b(0x1a8)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0xe8e6e8=a0_0x3fedcd;messageInput[_0xe8e6e8(0x1a0)][_0xe8e6e8(0x16b)]=_0xe8e6e8(0x189),messageInput[_0xe8e6e8(0x1a0)][_0xe8e6e8(0x16b)]=Math[_0xe8e6e8(0x17c)](messageInput[_0xe8e6e8(0x17f)],0x78)+'px';}function updateSendButton(){const _0x32513b=a0_0x3fedcd,_0xd275e1=messageInput['value'][_0x32513b(0x1b9)]();sendBtn[_0x32513b(0x188)]=!_0xd275e1||isTyping;}async function sendMessage(){const _0x2e00c1=a0_0x3fedcd,_0x57ed9f=messageInput[_0x2e00c1(0x195)][_0x2e00c1(0x1b9)]();if(!_0x57ed9f||isTyping)return;if(tg?.[_0x2e00c1(0x163)])tg[_0x2e00c1(0x163)][_0x2e00c1(0x1bf)]('light');messages[_0x2e00c1(0x19c)]({'role':'user','content':_0x57ed9f,'timestamp':Date[_0x2e00c1(0x164)]()}),localStorage[_0x2e00c1(0x180)](_0x2e00c1(0x19b),JSON[_0x2e00c1(0x1c1)](messages)),renderMessages(),messageInput[_0x2e00c1(0x195)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2e00c1(0x19e)](createTypingIndicator()),chatArea[_0x2e00c1(0x1a8)]=chatArea[_0x2e00c1(0x17f)];const _0xeae48e=await callBackend(_0x2e00c1(0x1ce),{'message':_0x57ed9f});isTyping=![];const _0x108182=document[_0x2e00c1(0x19f)](_0x2e00c1(0x17b));if(_0x108182)_0x108182[_0x2e00c1(0x1cb)]();let _0x2bf128='Ошибка\x20сети';if(_0xeae48e[_0x2e00c1(0x179)]){_0x2bf128=_0xeae48e[_0x2e00c1(0x1aa)]||_0x2e00c1(0x1ab);if(tg?.[_0x2e00c1(0x163)])tg[_0x2e00c1(0x163)][_0x2e00c1(0x1a7)](_0x2e00c1(0x179));}else{_0x2bf128=_0xeae48e[_0x2e00c1(0x1af)]||_0x2e00c1(0x1bd);if(tg?.[_0x2e00c1(0x163)])tg['HapticFeedback'][_0x2e00c1(0x1a7)](_0x2e00c1(0x1af));}messages[_0x2e00c1(0x19c)]({'role':'ai','content':_0x2bf128,'timestamp':Date[_0x2e00c1(0x164)]()}),localStorage['setItem'](_0x2e00c1(0x19b),JSON[_0x2e00c1(0x1c1)](messages)),renderMessages();}function confirmDelete(_0x3acbbd){const _0x3f3894=a0_0x3fedcd;if(mTitle)mTitle[_0x3f3894(0x191)]=_0x3f3894(0x18b);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x55603d=_0x3f3894;messages[_0x55603d(0x169)](_0x3acbbd,0x1),localStorage[_0x55603d(0x180)](_0x55603d(0x19b),JSON['stringify'](messages)),renderMessages();},modal['classList']['add'](_0x3f3894(0x178));}if(clearBtn)clearBtn[a0_0x3fedcd(0x1c4)]=()=>{const _0x3d6175=a0_0x3fedcd;if(!messages[_0x3d6175(0x1cc)])return;if(mTitle)mTitle[_0x3d6175(0x191)]=_0x3d6175(0x196);if(mText)mText[_0x3d6175(0x191)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x4e56c2=_0x3d6175;messages=[],localStorage[_0x4e56c2(0x18f)](_0x4e56c2(0x19b)),renderMessages(),callBackend(_0x4e56c2(0x1c3),{});},modal['classList'][_0x3d6175(0x1d4)](_0x3d6175(0x178));};document['getElementById'](a0_0x3fedcd(0x1a1))[a0_0x3fedcd(0x1c4)]=()=>modal['classList'][a0_0x3fedcd(0x1cb)](a0_0x3fedcd(0x178)),document[a0_0x3fedcd(0x19f)](a0_0x3fedcd(0x17e))[a0_0x3fedcd(0x1c4)]=()=>{const _0x47058e=a0_0x3fedcd;if(modalCallback)modalCallback();modal[_0x47058e(0x16c)][_0x47058e(0x1cb)]('show');},messageInput[a0_0x3fedcd(0x1a6)](a0_0x3fedcd(0x168),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3fedcd(0x1a6)](a0_0x3fedcd(0x174),_0x31d3a2=>{const _0x2bf682=a0_0x3fedcd;_0x31d3a2['key']===_0x2bf682(0x1cd)&&!_0x31d3a2[_0x2bf682(0x1a5)]&&(_0x31d3a2[_0x2bf682(0x1b5)](),sendMessage());}),sendBtn[a0_0x3fedcd(0x1c4)]=sendMessage,document['addEventListener'](a0_0x3fedcd(0x1a3),_0x3ad26f=>{const _0x9bc7c8=a0_0x3fedcd;document[_0x9bc7c8(0x1d6)](_0x9bc7c8(0x1c0))[_0x9bc7c8(0x1db)](_0x552e20=>{const _0x511a77=_0x9bc7c8;if(!_0x552e20[_0x511a77(0x16d)](_0x3ad26f[_0x511a77(0x1de)]))_0x552e20['classList'][_0x511a77(0x1cb)](_0x511a77(0x183));});});const saved=localStorage['getItem'](a0_0x3fedcd(0x19b));if(saved)try{messages=JSON[a0_0x3fedcd(0x1da)](saved),renderMessages();}catch(a0_0xd8c6e6){}updateSendButton();