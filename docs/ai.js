const a0_0x4a2da2=a0_0x222e;(function(_0x149b67,_0x1537c8){const _0x462c10=a0_0x222e,_0x4de250=_0x149b67();while(!![]){try{const _0x9dabc4=-parseInt(_0x462c10(0xc5))/0x1*(-parseInt(_0x462c10(0xad))/0x2)+-parseInt(_0x462c10(0xa1))/0x3+-parseInt(_0x462c10(0xe5))/0x4+parseInt(_0x462c10(0xc9))/0x5*(parseInt(_0x462c10(0xd7))/0x6)+parseInt(_0x462c10(0xdf))/0x7*(-parseInt(_0x462c10(0xec))/0x8)+-parseInt(_0x462c10(0x98))/0x9+parseInt(_0x462c10(0x107))/0xa;if(_0x9dabc4===_0x1537c8)break;else _0x4de250['push'](_0x4de250['shift']());}catch(_0x5091ee){_0x4de250['push'](_0x4de250['shift']());}}}(a0_0x5e46,0x68952));const tg=window[a0_0x4a2da2(0xcf)]?.['WebApp'],HOME_URL=a0_0x4a2da2(0x108);function a0_0x5e46(){const _0x3733eb=['innerHTML','toString','viewportHeight','1590900tykXMu','forEach','light','initDataUnsafe','replace','div','chatArea','impactOccurred','confirmModal','(((.+)+)+)+$','show-delete','getElementById','4uIksGG','input','send_message','modalTitle','scrollHeight','constructor','message-bubble','messageInput','height','flex','apply','shiftKey','appendChild','function','min','disabled','touchstart','viewportChanged','value','setItem','click','padStart','clear_history','getHours','131884uTrmPY','offClick','now','.container','1911485YKQAFd','POST','display','target','disableVerticalSwipes','floor','Telegram','Действие\x20необратимо.','paddingBottom','text/plain','auto','ai_chat_messages','#050505','random','6rgbRbi','onEvent','contains','error','debug_uid','json','medium','content','2797711vnCFZK','createElement','querySelectorAll','addEventListener','sendBtn','Ошибка\x20сервера','3189548yhcAFe','onClick','modalConfirm','onclick','innerHeight','add','initData','8LVhhHF','expand','push','typingIndicator','show','username','search','Очистить\x20историю?','offsetHeight','Enter','removeItem','success','stopPropagation','trim','key','length','user','ready','Пустой\x20ответ','Начнется\x20новый\x20диалог.','remove','textContent','from','6.1','message\x20','style','clearBtn','21140880RfpUbf','./router.html','notificationOccurred','.message.show-delete','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','message-time','Ошибка\x20сети','isVersionAtLeast','warn','setHeaderColor','none','BackButton','first_name','querySelector','stringify','abort','className','splice','5439807qqSJnz','classList','text','scrollTop','HapticFeedback','getItem'];a0_0x5e46=function(){return _0x3733eb;};return a0_0x5e46();}function setupTelegramBackButton(){const _0x3c5e05=a0_0x4a2da2;if(!tg)return;try{tg[_0x3c5e05(0xfd)](),tg[_0x3c5e05(0xed)](),tg[_0x3c5e05(0x110)]?.(_0x3c5e05(0xd5));if(tg[_0x3c5e05(0x10e)]?.(_0x3c5e05(0x103)))tg[_0x3c5e05(0xcd)]?.();const _0x5606a0=tg[_0x3c5e05(0x112)];if(_0x5606a0){_0x5606a0[_0x3c5e05(0xf0)]();if(typeof _0x5606a0[_0x3c5e05(0xc6)]===_0x3c5e05(0xba))try{_0x5606a0['offClick']();}catch(_0xfee8fd){}_0x5606a0[_0x3c5e05(0xe6)](()=>{const _0x282a93=_0x3c5e05;if(tg[_0x282a93(0x9c)])tg[_0x282a93(0x9c)]['impactOccurred']('light');location['href']=HOME_URL;});}}catch(_0x2a1f7d){console[_0x3c5e05(0x10f)]('TG\x20setup\x20error:',_0x2a1f7d);}}(function initStableLayout(){const _0x5aa073=a0_0x4a2da2,_0x46893d=(function(){let _0x58cd0d=!![];return function(_0x29d08f,_0x418223){const _0x3be2e4=_0x58cd0d?function(){const _0x404a50=a0_0x222e;if(_0x418223){const _0x53e976=_0x418223[_0x404a50(0xb7)](_0x29d08f,arguments);return _0x418223=null,_0x53e976;}}:function(){};return _0x58cd0d=![],_0x3be2e4;};}()),_0x31dfa3=document[_0x5aa073(0x93)](_0x5aa073(0xc8)),_0x5c8cf4=document[_0x5aa073(0xac)]('inputArea'),_0x40effc=document[_0x5aa073(0xac)]('chatArea'),_0x2b30c8=document[_0x5aa073(0xac)](_0x5aa073(0xb4));function _0x571fb4(){const _0x5d36a1=_0x5aa073,_0x2462b7=_0x46893d(this,function(){const _0x4750c5=a0_0x222e;return _0x2462b7[_0x4750c5(0x9f)]()[_0x4750c5(0xf2)](_0x4750c5(0xaa))[_0x4750c5(0x9f)]()[_0x4750c5(0xb2)](_0x2462b7)[_0x4750c5(0xf2)]('(((.+)+)+)+$');});_0x2462b7();if(!_0x31dfa3)return;const _0x4dd92f=tg&&tg[_0x5d36a1(0xa0)]?tg[_0x5d36a1(0xa0)]:window[_0x5d36a1(0xe9)];_0x31dfa3[_0x5d36a1(0x105)][_0x5d36a1(0xb5)]=_0x4dd92f+'px';if(_0x5c8cf4){const _0x35408e=_0x5c8cf4[_0x5d36a1(0xf4)];_0x40effc[_0x5d36a1(0x105)][_0x5d36a1(0xd1)]=_0x35408e+0x28+'px';}}tg?tg[_0x5aa073(0xd8)](_0x5aa073(0xbe),({isStateStable:_0x5cb54e})=>{_0x571fb4();if(_0x5cb54e)requestAnimationFrame(()=>{const _0x3a4d66=a0_0x222e;_0x40effc['scrollTop']=_0x40effc[_0x3a4d66(0xb1)];});}):window[_0x5aa073(0xe2)]('resize',_0x571fb4),_0x571fb4(),_0x2b30c8&&(_0x2b30c8[_0x5aa073(0xe2)](_0x5aa073(0xae),()=>{requestAnimationFrame(_0x571fb4);}),_0x2b30c8[_0x5aa073(0xe2)]('focus',()=>{setTimeout(()=>{const _0x5ec44e=a0_0x222e;_0x40effc[_0x5ec44e(0x9b)]=_0x40effc['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4a2da2(0xac)](a0_0x4a2da2(0xa7)),emptyState=document[a0_0x4a2da2(0xac)]('emptyState'),messageInput=document[a0_0x4a2da2(0xac)]('messageInput'),sendBtn=document[a0_0x4a2da2(0xac)](a0_0x4a2da2(0xe3)),clearBtn=document[a0_0x4a2da2(0xac)](a0_0x4a2da2(0x106)),modal=document['getElementById'](a0_0x4a2da2(0xa9)),mTitle=document['getElementById'](a0_0x4a2da2(0xb0)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x232f66,_0x1c5609){const _0x4aad1c=a0_0x4a2da2,_0x51bcf0=tg?.[_0x4aad1c(0xa4)]?.[_0x4aad1c(0xfc)]||{},_0x4c9ce9=_0x51bcf0['id']||localStorage[_0x4aad1c(0x9d)](_0x4aad1c(0xdb))||'d-'+Math[_0x4aad1c(0xce)](Math[_0x4aad1c(0xd6)]()*0x3b9aca00);if(!_0x51bcf0['id'])localStorage[_0x4aad1c(0xc0)](_0x4aad1c(0xdb),_0x4c9ce9);const _0x226ce8={'action':_0x232f66,'user_id':_0x4c9ce9,'user_data':{'first_name':_0x51bcf0[_0x4aad1c(0x113)],'username':_0x51bcf0[_0x4aad1c(0xf1)]},'init_data':tg?.[_0x4aad1c(0xeb)]||'',..._0x1c5609},_0x4a44db=new AbortController(),_0x5d41ce=setTimeout(()=>_0x4a44db[_0x4aad1c(0x95)](),REQUEST_TIMEOUT_MS);try{const _0x10f075=await fetch(BACKEND_URL,{'method':_0x4aad1c(0xca),'headers':{'Content-Type':_0x4aad1c(0xd2)},'body':JSON[_0x4aad1c(0x94)](_0x226ce8),'signal':_0x4a44db['signal']});return clearTimeout(_0x5d41ce),await _0x10f075[_0x4aad1c(0xdc)]();}catch(_0x2917a8){return{'success':![],'error':String(_0x2917a8)};}}function formatTime(_0x4c2621){const _0x35262e=a0_0x4a2da2,_0x4d4341=new Date(_0x4c2621);return String(_0x4d4341[_0x35262e(0xc4)]())[_0x35262e(0xc2)](0x2,'0')+':'+String(_0x4d4341['getMinutes']())[_0x35262e(0xc2)](0x2,'0');}function createMessageElement(_0x2922d5,_0xd43026){const _0x46eab4=a0_0x4a2da2,_0x1e045b=document[_0x46eab4(0xe0)]('div');_0x1e045b[_0x46eab4(0x96)]=_0x46eab4(0x104)+_0x2922d5['role'];const _0x2ae476=document[_0x46eab4(0xe0)](_0x46eab4(0xa6));_0x2ae476[_0x46eab4(0x96)]=_0x46eab4(0xb3),_0x2ae476['innerHTML']=_0x2922d5[_0x46eab4(0xde)][_0x46eab4(0xa5)](/\n/g,'<br>');const _0x389de8=document[_0x46eab4(0xe0)](_0x46eab4(0xa6));_0x389de8[_0x46eab4(0x96)]='delete-btn',_0x389de8[_0x46eab4(0x9e)]=_0x46eab4(0x10b),_0x389de8[_0x46eab4(0xe8)]=_0x27d879=>{const _0x288234=_0x46eab4;_0x27d879[_0x288234(0xf8)](),confirmDelete(_0xd43026);};let _0x2fca41;_0x2ae476[_0x46eab4(0xe2)](_0x46eab4(0xbd),()=>_0x2fca41=setTimeout(()=>{const _0x426843=_0x46eab4;_0x1e045b['classList'][_0x426843(0xea)](_0x426843(0xab));if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x426843(0xa8)](_0x426843(0xdd));},0x1f4)),_0x2ae476[_0x46eab4(0xe2)]('touchend',()=>clearTimeout(_0x2fca41));const _0x2c01d5=document['createElement'](_0x46eab4(0xa6));return _0x2c01d5[_0x46eab4(0x96)]=_0x46eab4(0x10c),_0x2c01d5[_0x46eab4(0x101)]=formatTime(_0x2922d5['timestamp']),_0x1e045b['appendChild'](_0x389de8),_0x1e045b[_0x46eab4(0xb9)](_0x2ae476),_0x1e045b[_0x46eab4(0xb9)](_0x2c01d5),_0x1e045b;}function createTypingIndicator(){const _0x4878e4=a0_0x4a2da2,_0x2765a6=document['createElement']('div');return _0x2765a6[_0x4878e4(0x96)]='message\x20ai',_0x2765a6['id']=_0x4878e4(0xef),_0x2765a6[_0x4878e4(0x9e)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x2765a6;}function renderMessages(){const _0x21935d=a0_0x4a2da2;Array[_0x21935d(0x102)](chatArea['children'])['forEach'](_0x29058e=>{if(_0x29058e['id']!=='emptyState')_0x29058e['remove']();}),messages[_0x21935d(0xfb)]>0x0?(emptyState[_0x21935d(0x105)][_0x21935d(0xcb)]=_0x21935d(0x111),messages['forEach']((_0x2c52f4,_0x236f9f)=>chatArea[_0x21935d(0xb9)](createMessageElement(_0x2c52f4,_0x236f9f)))):emptyState[_0x21935d(0x105)]['display']=_0x21935d(0xb6),requestAnimationFrame(()=>chatArea[_0x21935d(0x9b)]=chatArea[_0x21935d(0xb1)]);}function autoResizeTextarea(){const _0x38b7b6=a0_0x4a2da2;messageInput[_0x38b7b6(0x105)][_0x38b7b6(0xb5)]=_0x38b7b6(0xd3),messageInput[_0x38b7b6(0x105)]['height']=Math[_0x38b7b6(0xbb)](messageInput['scrollHeight'],0x78)+'px';}function a0_0x222e(_0x93411a,_0x500f18){_0x93411a=_0x93411a-0x93;const _0x27c9f1=a0_0x5e46();let _0x2856d6=_0x27c9f1[_0x93411a];return _0x2856d6;}function updateSendButton(){const _0xbb68af=a0_0x4a2da2,_0x38a0d1=messageInput[_0xbb68af(0xbf)]['trim']();sendBtn[_0xbb68af(0xbc)]=!_0x38a0d1||isTyping;}async function sendMessage(){const _0x51707a=a0_0x4a2da2,_0x27eea8=messageInput[_0x51707a(0xbf)][_0x51707a(0xf9)]();if(!_0x27eea8||isTyping)return;if(tg?.[_0x51707a(0x9c)])tg['HapticFeedback'][_0x51707a(0xa8)](_0x51707a(0xa3));messages[_0x51707a(0xee)]({'role':'user','content':_0x27eea8,'timestamp':Date[_0x51707a(0xc7)]()}),localStorage['setItem'](_0x51707a(0xd4),JSON[_0x51707a(0x94)](messages)),renderMessages(),messageInput[_0x51707a(0xbf)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x51707a(0xb9)](createTypingIndicator()),chatArea[_0x51707a(0x9b)]=chatArea[_0x51707a(0xb1)];const _0x65a268=await callBackend(_0x51707a(0xaf),{'message':_0x27eea8});isTyping=![];const _0xc8ac1f=document[_0x51707a(0xac)](_0x51707a(0xef));if(_0xc8ac1f)_0xc8ac1f[_0x51707a(0x100)]();let _0x24b0ca=_0x51707a(0x10d);if(_0x65a268[_0x51707a(0xf7)]){_0x24b0ca=_0x65a268[_0x51707a(0x9a)]||_0x51707a(0xfe);if(tg?.[_0x51707a(0x9c)])tg[_0x51707a(0x9c)][_0x51707a(0x109)](_0x51707a(0xf7));}else{_0x24b0ca=_0x65a268['error']||_0x51707a(0xe4);if(tg?.['HapticFeedback'])tg[_0x51707a(0x9c)][_0x51707a(0x109)](_0x51707a(0xda));}messages[_0x51707a(0xee)]({'role':'ai','content':_0x24b0ca,'timestamp':Date[_0x51707a(0xc7)]()}),localStorage[_0x51707a(0xc0)](_0x51707a(0xd4),JSON[_0x51707a(0x94)](messages)),renderMessages();}function confirmDelete(_0x1530ea){const _0x1f84cc=a0_0x4a2da2;if(mTitle)mTitle[_0x1f84cc(0x101)]='Удалить?';if(mText)mText[_0x1f84cc(0x101)]=_0x1f84cc(0xd0);modalCallback=()=>{const _0x315fd7=_0x1f84cc;messages[_0x315fd7(0x97)](_0x1530ea,0x1),localStorage[_0x315fd7(0xc0)](_0x315fd7(0xd4),JSON[_0x315fd7(0x94)](messages)),renderMessages();},modal['classList'][_0x1f84cc(0xea)](_0x1f84cc(0xf0));}if(clearBtn)clearBtn[a0_0x4a2da2(0xe8)]=()=>{const _0x50550b=a0_0x4a2da2;if(!messages['length'])return;if(mTitle)mTitle[_0x50550b(0x101)]=_0x50550b(0xf3);if(mText)mText[_0x50550b(0x101)]=_0x50550b(0xff);modalCallback=async()=>{const _0x39d610=_0x50550b;messages=[],localStorage[_0x39d610(0xf6)](_0x39d610(0xd4)),renderMessages(),callBackend(_0x39d610(0xc3),{});},modal[_0x50550b(0x99)]['add']('show');};document[a0_0x4a2da2(0xac)]('modalCancel')[a0_0x4a2da2(0xe8)]=()=>modal[a0_0x4a2da2(0x99)][a0_0x4a2da2(0x100)](a0_0x4a2da2(0xf0)),document[a0_0x4a2da2(0xac)](a0_0x4a2da2(0xe7))['onclick']=()=>{const _0x16d1b4=a0_0x4a2da2;if(modalCallback)modalCallback();modal[_0x16d1b4(0x99)][_0x16d1b4(0x100)](_0x16d1b4(0xf0));},messageInput[a0_0x4a2da2(0xe2)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x2cac71=>{const _0x403b18=a0_0x4a2da2;_0x2cac71[_0x403b18(0xfa)]===_0x403b18(0xf5)&&!_0x2cac71[_0x403b18(0xb8)]&&(_0x2cac71['preventDefault'](),sendMessage());}),sendBtn[a0_0x4a2da2(0xe8)]=sendMessage,document[a0_0x4a2da2(0xe2)](a0_0x4a2da2(0xc1),_0xe6962d=>{const _0x3ad254=a0_0x4a2da2;document[_0x3ad254(0xe1)](_0x3ad254(0x10a))[_0x3ad254(0xa2)](_0xdcf899=>{const _0x182f87=_0x3ad254;if(!_0xdcf899[_0x182f87(0xd9)](_0xe6962d[_0x182f87(0xcc)]))_0xdcf899[_0x182f87(0x99)][_0x182f87(0x100)]('show-delete');});});const saved=localStorage[a0_0x4a2da2(0x9d)](a0_0x4a2da2(0xd4));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x579264){}updateSendButton();