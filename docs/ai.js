const a0_0x5ae011=a0_0x4d16;(function(_0x2407a4,_0x574a3a){const _0xea33dd=a0_0x4d16,_0x1f2fe1=_0x2407a4();while(!![]){try{const _0x380e05=parseInt(_0xea33dd(0x109))/0x1*(parseInt(_0xea33dd(0x98))/0x2)+-parseInt(_0xea33dd(0xb8))/0x3*(-parseInt(_0xea33dd(0xa1))/0x4)+parseInt(_0xea33dd(0x100))/0x5*(-parseInt(_0xea33dd(0xd8))/0x6)+-parseInt(_0xea33dd(0x9a))/0x7*(parseInt(_0xea33dd(0x9f))/0x8)+parseInt(_0xea33dd(0xd1))/0x9*(-parseInt(_0xea33dd(0x93))/0xa)+parseInt(_0xea33dd(0xc9))/0xb*(parseInt(_0xea33dd(0xee))/0xc)+parseInt(_0xea33dd(0xb3))/0xd;if(_0x380e05===_0x574a3a)break;else _0x1f2fe1['push'](_0x1f2fe1['shift']());}catch(_0x58a77e){_0x1f2fe1['push'](_0x1f2fe1['shift']());}}}(a0_0x4bb1,0x86ec0));const tg=window[a0_0x5ae011(0x10d)]?.[a0_0x5ae011(0xe3)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x1a1fc6=a0_0x5ae011,_0x4ae839=(function(){let _0x11552c=!![];return function(_0x5ba36a,_0x236771){const _0x3fd3f0=_0x11552c?function(){if(_0x236771){const _0xc98ebc=_0x236771['apply'](_0x5ba36a,arguments);return _0x236771=null,_0xc98ebc;}}:function(){};return _0x11552c=![],_0x3fd3f0;};}()),_0x54548b=_0x4ae839(this,function(){const _0x4dc41b=a0_0x4d16;return _0x54548b['toString']()[_0x4dc41b(0xb4)]('(((.+)+)+)+$')[_0x4dc41b(0xb9)]()[_0x4dc41b(0xe7)](_0x54548b)['search'](_0x4dc41b(0xde));});_0x54548b();if(!tg)return;try{tg[_0x1a1fc6(0xe5)](),tg[_0x1a1fc6(0xff)](),tg[_0x1a1fc6(0xcc)]?.(_0x1a1fc6(0xa9));if(tg[_0x1a1fc6(0xdd)]?.(_0x1a1fc6(0x102)))tg[_0x1a1fc6(0x106)]?.();const _0x37cbb8=tg['BackButton'];if(_0x37cbb8){_0x37cbb8[_0x1a1fc6(0xa2)]();if(typeof _0x37cbb8['offClick']==='function')try{_0x37cbb8[_0x1a1fc6(0x10e)]();}catch(_0xd37994){}_0x37cbb8[_0x1a1fc6(0xf9)](()=>{const _0x363418=_0x1a1fc6;if(tg['HapticFeedback'])tg[_0x363418(0xa8)]['impactOccurred'](_0x363418(0xfa));location['href']=HOME_URL;});}}catch(_0x253440){console[_0x1a1fc6(0xa7)](_0x1a1fc6(0x9b),_0x253440);}}(function initStableLayout(){const _0x19d7d9=a0_0x5ae011,_0x5e06f8=document['querySelector'](_0x19d7d9(0xc3)),_0x3a3cc3=document[_0x19d7d9(0xfb)](_0x19d7d9(0xcf)),_0x3466c7=document[_0x19d7d9(0xfb)](_0x19d7d9(0xc2)),_0x58231c=document['getElementById'](_0x19d7d9(0xe4));function _0x5291d9(){const _0x5f57ea=_0x19d7d9;if(!_0x5e06f8)return;const _0x155589=tg&&tg[_0x5f57ea(0x10b)]?tg[_0x5f57ea(0x10b)]:window[_0x5f57ea(0xdc)];_0x5e06f8[_0x5f57ea(0xbd)][_0x5f57ea(0xf1)]=_0x155589+'px';if(_0x3a3cc3){const _0x4ac3f5=_0x3a3cc3[_0x5f57ea(0xa3)];_0x3466c7['style']['paddingBottom']=_0x4ac3f5+0x28+'px';}}tg?tg[_0x19d7d9(0xc6)](_0x19d7d9(0xa5),({isStateStable:_0x331ce9})=>{_0x5291d9();if(_0x331ce9)requestAnimationFrame(()=>{const _0x3cf581=a0_0x4d16;_0x3466c7['scrollTop']=_0x3466c7[_0x3cf581(0xc5)];});}):window[_0x19d7d9(0xd0)](_0x19d7d9(0xba),_0x5291d9),_0x5291d9(),_0x58231c&&(_0x58231c[_0x19d7d9(0xd0)](_0x19d7d9(0xea),()=>{requestAnimationFrame(_0x5291d9);}),_0x58231c[_0x19d7d9(0xd0)]('focus',()=>{setTimeout(()=>{const _0x5a2e4d=a0_0x4d16;_0x3466c7[_0x5a2e4d(0x97)]=_0x3466c7[_0x5a2e4d(0xc5)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5ae011(0xfb)](a0_0x5ae011(0xc2)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x5ae011(0xfb)](a0_0x5ae011(0xe4)),sendBtn=document[a0_0x5ae011(0xfb)](a0_0x5ae011(0xf8)),clearBtn=document['getElementById'](a0_0x5ae011(0x105)),modal=document[a0_0x5ae011(0xfb)](a0_0x5ae011(0xec)),mTitle=document['getElementById'](a0_0x5ae011(0xd9)),mText=document['getElementById'](a0_0x5ae011(0x99));let modalCallback=null;async function callBackend(_0x171ad2,_0x5663be){const _0x29090=a0_0x5ae011,_0x12945c=tg?.[_0x29090(0xbc)]?.[_0x29090(0xe2)]||{},_0xc8679=_0x12945c['id']||localStorage[_0x29090(0x90)]('debug_uid')||'d-'+Math['floor'](Math[_0x29090(0xb0)]()*0x3b9aca00);if(!_0x12945c['id'])localStorage['setItem'](_0x29090(0xdb),_0xc8679);const _0x13192a={'action':_0x171ad2,'user_id':_0xc8679,'user_data':{'first_name':_0x12945c[_0x29090(0xd5)],'username':_0x12945c['username']},'init_data':tg?.['initData']||'',..._0x5663be},_0x1db1c8=new AbortController(),_0x320016=setTimeout(()=>_0x1db1c8[_0x29090(0xce)](),REQUEST_TIMEOUT_MS);try{const _0x6f582d=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x29090(0x95)},'body':JSON[_0x29090(0xe9)](_0x13192a),'signal':_0x1db1c8[_0x29090(0x94)]});return clearTimeout(_0x320016),await _0x6f582d['json']();}catch(_0x542b1e){return{'success':![],'error':String(_0x542b1e)};}}function formatTime(_0x14d904){const _0x55b50e=a0_0x5ae011,_0x217c8e=new Date(_0x14d904);return String(_0x217c8e[_0x55b50e(0xb6)]())['padStart'](0x2,'0')+':'+String(_0x217c8e[_0x55b50e(0x92)]())[_0x55b50e(0xc4)](0x2,'0');}function createMessageElement(_0x53a421,_0x19c6e1){const _0x1d6c9d=a0_0x5ae011,_0x128a9f=document[_0x1d6c9d(0xa6)](_0x1d6c9d(0xfe));_0x128a9f[_0x1d6c9d(0x9d)]='message\x20'+_0x53a421[_0x1d6c9d(0xac)];const _0x2c3941=document['createElement'](_0x1d6c9d(0xfe));_0x2c3941[_0x1d6c9d(0x9d)]=_0x1d6c9d(0x10a),_0x2c3941[_0x1d6c9d(0x108)]=_0x53a421[_0x1d6c9d(0xe1)][_0x1d6c9d(0xef)](/\n/g,_0x1d6c9d(0xaa));const _0x26e3c8=document[_0x1d6c9d(0xa6)](_0x1d6c9d(0xfe));_0x26e3c8[_0x1d6c9d(0x9d)]='delete-btn',_0x26e3c8['innerHTML']=_0x1d6c9d(0xb5),_0x26e3c8[_0x1d6c9d(0xa4)]=_0xa3d7b2=>{const _0x4cd09b=_0x1d6c9d;_0xa3d7b2[_0x4cd09b(0xf4)](),confirmDelete(_0x19c6e1);};let _0x4b8ac9;_0x2c3941[_0x1d6c9d(0xd0)](_0x1d6c9d(0xbe),()=>_0x4b8ac9=setTimeout(()=>{const _0x3233c4=_0x1d6c9d;_0x128a9f['classList'][_0x3233c4(0xf6)](_0x3233c4(0x103));if(tg?.['HapticFeedback'])tg[_0x3233c4(0xa8)][_0x3233c4(0xc8)](_0x3233c4(0xd4));},0x1f4)),_0x2c3941[_0x1d6c9d(0xd0)](_0x1d6c9d(0x107),()=>clearTimeout(_0x4b8ac9));const _0x3cf9ca=document['createElement'](_0x1d6c9d(0xfe));return _0x3cf9ca[_0x1d6c9d(0x9d)]=_0x1d6c9d(0xbf),_0x3cf9ca[_0x1d6c9d(0xb2)]=formatTime(_0x53a421[_0x1d6c9d(0xe0)]),_0x128a9f[_0x1d6c9d(0x104)](_0x26e3c8),_0x128a9f[_0x1d6c9d(0x104)](_0x2c3941),_0x128a9f[_0x1d6c9d(0x104)](_0x3cf9ca),_0x128a9f;}function createTypingIndicator(){const _0x2ef64f=a0_0x5ae011,_0x4888cb=document[_0x2ef64f(0xa6)]('div');return _0x4888cb[_0x2ef64f(0x9d)]=_0x2ef64f(0x91),_0x4888cb['id']=_0x2ef64f(0xbb),_0x4888cb[_0x2ef64f(0x108)]=_0x2ef64f(0x9e),_0x4888cb;}function renderMessages(){const _0x26719c=a0_0x5ae011;Array['from'](chatArea[_0x26719c(0xe8)])[_0x26719c(0xca)](_0x59bb98=>{const _0x2dc0d2=_0x26719c;if(_0x59bb98['id']!=='emptyState')_0x59bb98[_0x2dc0d2(0xe6)]();}),messages[_0x26719c(0xfd)]>0x0?(emptyState[_0x26719c(0xbd)][_0x26719c(0xc1)]=_0x26719c(0xcd),messages[_0x26719c(0xca)]((_0x200c57,_0x559fbf)=>chatArea['appendChild'](createMessageElement(_0x200c57,_0x559fbf)))):emptyState[_0x26719c(0xbd)][_0x26719c(0xc1)]=_0x26719c(0xa0),requestAnimationFrame(()=>chatArea[_0x26719c(0x97)]=chatArea['scrollHeight']);}function a0_0x4d16(_0x397573,_0x26ca07){_0x397573=_0x397573-0x8f;const _0x4493f1=a0_0x4bb1();let _0x2a476e=_0x4493f1[_0x397573];return _0x2a476e;}function autoResizeTextarea(){const _0x421e0d=a0_0x5ae011;messageInput[_0x421e0d(0xbd)][_0x421e0d(0xf1)]=_0x421e0d(0xae),messageInput['style'][_0x421e0d(0xf1)]=Math[_0x421e0d(0x8f)](messageInput[_0x421e0d(0xc5)],0x78)+'px';}function updateSendButton(){const _0x3fde42=a0_0x5ae011,_0x40ce22=messageInput[_0x3fde42(0xf5)][_0x3fde42(0xfc)]();sendBtn[_0x3fde42(0xc7)]=!_0x40ce22||isTyping;}async function sendMessage(){const _0x19ed58=a0_0x5ae011,_0x3a9173=messageInput['value'][_0x19ed58(0xfc)]();if(!_0x3a9173||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x19ed58(0xc8)](_0x19ed58(0xfa));messages[_0x19ed58(0xf3)]({'role':_0x19ed58(0xe2),'content':_0x3a9173,'timestamp':Date['now']()}),localStorage[_0x19ed58(0x9c)](_0x19ed58(0xd6),JSON[_0x19ed58(0xe9)](messages)),renderMessages(),messageInput[_0x19ed58(0xf5)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x19ed58(0x104)](createTypingIndicator()),chatArea[_0x19ed58(0x97)]=chatArea['scrollHeight'];const _0x15985a=await callBackend('send_message',{'message':_0x3a9173});isTyping=![];const _0x64c1e9=document[_0x19ed58(0xfb)](_0x19ed58(0xbb));if(_0x64c1e9)_0x64c1e9['remove']();let _0x326d16='Ошибка\x20сети';if(_0x15985a['success']){_0x326d16=_0x15985a['text']||'Пустой\x20ответ';if(tg?.[_0x19ed58(0xa8)])tg[_0x19ed58(0xa8)][_0x19ed58(0xdf)](_0x19ed58(0x101));}else{_0x326d16=_0x15985a[_0x19ed58(0xb1)]||'Ошибка\x20сервера';if(tg?.[_0x19ed58(0xa8)])tg[_0x19ed58(0xa8)][_0x19ed58(0xdf)](_0x19ed58(0xb1));}messages['push']({'role':'ai','content':_0x326d16,'timestamp':Date[_0x19ed58(0xd3)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x19ed58(0xe9)](messages)),renderMessages();}function confirmDelete(_0x4ef835){const _0x1fcdd7=a0_0x5ae011;if(mTitle)mTitle['textContent']=_0x1fcdd7(0xd2);if(mText)mText[_0x1fcdd7(0xb2)]='Действие\x20необратимо.';modalCallback=()=>{const _0x18a80c=_0x1fcdd7;messages[_0x18a80c(0xf7)](_0x4ef835,0x1),localStorage[_0x18a80c(0x9c)](_0x18a80c(0xd6),JSON[_0x18a80c(0xe9)](messages)),renderMessages();},modal[_0x1fcdd7(0x10c)][_0x1fcdd7(0xf6)](_0x1fcdd7(0xa2));}if(clearBtn)clearBtn[a0_0x5ae011(0xa4)]=()=>{const _0xa4c2e7=a0_0x5ae011;if(!messages[_0xa4c2e7(0xfd)])return;if(mTitle)mTitle[_0xa4c2e7(0xb2)]='Очистить\x20историю?';if(mText)mText[_0xa4c2e7(0xb2)]=_0xa4c2e7(0xb7);modalCallback=async()=>{const _0x384338=_0xa4c2e7;messages=[],localStorage[_0x384338(0xed)](_0x384338(0xd6)),renderMessages(),callBackend(_0x384338(0xab),{});},modal[_0xa4c2e7(0x10c)][_0xa4c2e7(0xf6)](_0xa4c2e7(0xa2));};document[a0_0x5ae011(0xfb)](a0_0x5ae011(0xad))[a0_0x5ae011(0xa4)]=()=>modal[a0_0x5ae011(0x10c)][a0_0x5ae011(0xe6)](a0_0x5ae011(0xa2)),document[a0_0x5ae011(0xfb)](a0_0x5ae011(0xd7))[a0_0x5ae011(0xa4)]=()=>{const _0x906659=a0_0x5ae011;if(modalCallback)modalCallback();modal[_0x906659(0x10c)][_0x906659(0xe6)]('show');},messageInput['addEventListener'](a0_0x5ae011(0xea),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x5ae011(0xeb),_0x3f4069=>{const _0x136b42=a0_0x5ae011;_0x3f4069['key']==='Enter'&&!_0x3f4069[_0x136b42(0xf0)]&&(_0x3f4069[_0x136b42(0xf2)](),sendMessage());}),sendBtn[a0_0x5ae011(0xa4)]=sendMessage,document[a0_0x5ae011(0xd0)](a0_0x5ae011(0xcb),_0x124183=>{const _0x1b86ed=a0_0x5ae011;document[_0x1b86ed(0x96)](_0x1b86ed(0xaf))[_0x1b86ed(0xca)](_0x265873=>{const _0x15a02f=_0x1b86ed;if(!_0x265873[_0x15a02f(0xda)](_0x124183[_0x15a02f(0xc0)]))_0x265873[_0x15a02f(0x10c)][_0x15a02f(0xe6)](_0x15a02f(0x103));});});function a0_0x4bb1(){const _0x386f0c=['length','div','expand','70voAatU','success','6.1','show-delete','appendChild','clearBtn','disableVerticalSwipes','touchend','innerHTML','13Rwpmpf','message-bubble','viewportHeight','classList','Telegram','offClick','min','getItem','message\x20ai','getMinutes','40270OxrsoL','signal','text/plain','querySelectorAll','scrollTop','101144JhZRGE','modalText','5039377GMyZxQ','TG\x20setup\x20error:','setItem','className','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','8enZFYt','flex','24SvesgW','show','offsetHeight','onclick','viewportChanged','createElement','warn','HapticFeedback','#050505','<br>','clear_history','role','modalCancel','auto','.message.show-delete','random','error','textContent','4222673lvlhEx','search','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','getHours','Начнется\x20новый\x20диалог.','72669tAWvwS','toString','resize','typingIndicator','initDataUnsafe','style','touchstart','message-time','target','display','chatArea','.container','padStart','scrollHeight','onEvent','disabled','impactOccurred','11dneWHL','forEach','click','setHeaderColor','none','abort','inputArea','addEventListener','1251lfUefK','Удалить?','now','medium','first_name','ai_chat_messages','modalConfirm','5016jXZukh','modalTitle','contains','debug_uid','innerHeight','isVersionAtLeast','(((.+)+)+)+$','notificationOccurred','timestamp','content','user','WebApp','messageInput','ready','remove','constructor','children','stringify','input','keydown','confirmModal','removeItem','8596956LoXJXc','replace','shiftKey','height','preventDefault','push','stopPropagation','value','add','splice','sendBtn','onClick','light','getElementById','trim'];a0_0x4bb1=function(){return _0x386f0c;};return a0_0x4bb1();}const saved=localStorage[a0_0x5ae011(0x90)](a0_0x5ae011(0xd6));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x6c3119){}updateSendButton();