const a0_0xc33a3b=a0_0x8da5;(function(_0x1deb8b,_0x2bac0c){const _0xe99d51=a0_0x8da5,_0x52343a=_0x1deb8b();while(!![]){try{const _0x18738f=-parseInt(_0xe99d51(0x182))/0x1+-parseInt(_0xe99d51(0x17a))/0x2+-parseInt(_0xe99d51(0x174))/0x3+parseInt(_0xe99d51(0x1ad))/0x4*(parseInt(_0xe99d51(0x197))/0x5)+parseInt(_0xe99d51(0x18a))/0x6+-parseInt(_0xe99d51(0x1bb))/0x7+parseInt(_0xe99d51(0x14d))/0x8;if(_0x18738f===_0x2bac0c)break;else _0x52343a['push'](_0x52343a['shift']());}catch(_0x4a9a61){_0x52343a['push'](_0x52343a['shift']());}}}(a0_0x5a58,0xcb77d));const tg=window[a0_0xc33a3b(0x14f)]?.[a0_0xc33a3b(0x1af)],HOME_URL=a0_0xc33a3b(0x17e);function setupTelegramBackButton(){const _0x2198b3=a0_0xc33a3b,_0x2d68e5=(function(){let _0x17dfee=!![];return function(_0x2b22ba,_0xc56bfe){const _0x2b3285=_0x17dfee?function(){const _0x541815=a0_0x8da5;if(_0xc56bfe){const _0x56f547=_0xc56bfe[_0x541815(0x1a5)](_0x2b22ba,arguments);return _0xc56bfe=null,_0x56f547;}}:function(){};return _0x17dfee=![],_0x2b3285;};}()),_0x2ea219=_0x2d68e5(this,function(){const _0x5b8c58=a0_0x8da5;return _0x2ea219[_0x5b8c58(0x162)]()[_0x5b8c58(0x16c)]('(((.+)+)+)+$')['toString']()['constructor'](_0x2ea219)['search'](_0x5b8c58(0x1a2));});_0x2ea219();if(!tg)return;try{tg['ready'](),tg[_0x2198b3(0x181)](),tg[_0x2198b3(0x1b1)]?.('#050505');if(tg['isVersionAtLeast']?.('6.1'))tg['disableVerticalSwipes']?.();const _0x534f6a=tg['BackButton'];if(_0x534f6a){_0x534f6a[_0x2198b3(0x19b)]();if(typeof _0x534f6a[_0x2198b3(0x18c)]===_0x2198b3(0x171))try{_0x534f6a[_0x2198b3(0x18c)]();}catch(_0x586dd0){}_0x534f6a['onClick'](()=>{const _0x1d2012=_0x2198b3;if(tg[_0x1d2012(0x198)])tg['HapticFeedback'][_0x1d2012(0x1c0)]('light');location[_0x1d2012(0x1bd)]=HOME_URL;});}}catch(_0x486220){console[_0x2198b3(0x1bc)](_0x2198b3(0x160),_0x486220);}}(function initStableLayout(){const _0x223da0=a0_0xc33a3b,_0x483081=document[_0x223da0(0x1a9)](_0x223da0(0x1c1)),_0x148792=document['getElementById']('inputArea'),_0x4ddcd1=document[_0x223da0(0x1a0)](_0x223da0(0x172)),_0x25641b=document[_0x223da0(0x1a0)]('messageInput');function _0x153ce0(){const _0x3c4446=_0x223da0;if(!_0x483081)return;const _0x1c4a33=tg&&tg[_0x3c4446(0x176)]?tg[_0x3c4446(0x176)]:window[_0x3c4446(0x15c)];_0x483081[_0x3c4446(0x17b)][_0x3c4446(0x16f)]=_0x1c4a33+'px';if(_0x148792){const _0x17fa30=_0x148792[_0x3c4446(0x186)];_0x4ddcd1[_0x3c4446(0x17b)][_0x3c4446(0x156)]=_0x17fa30+0x28+'px';}}tg?tg['onEvent'](_0x223da0(0x199),({isStateStable:_0x5b0aa0})=>{_0x153ce0();if(_0x5b0aa0)requestAnimationFrame(()=>{_0x4ddcd1['scrollTop']=_0x4ddcd1['scrollHeight'];});}):window[_0x223da0(0x157)]('resize',_0x153ce0),_0x153ce0(),_0x25641b&&(_0x25641b[_0x223da0(0x157)]('input',()=>{requestAnimationFrame(_0x153ce0);}),_0x25641b[_0x223da0(0x157)]('focus',()=>{setTimeout(()=>{const _0x5c2dff=a0_0x8da5;_0x4ddcd1[_0x5c2dff(0x159)]=_0x4ddcd1[_0x5c2dff(0x1b6)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;function a0_0x5a58(){const _0x236f2b=['onclick','touchend','TG\x20setup\x20error:','message\x20','toString','none','username','show-delete','emptyState','first_name','remove','setItem','error','Удалить?','search','flex','initData','height','modalTitle','function','chatArea','modalCancel','1272366qDyEGk','Действие\x20необратимо.','viewportHeight','<br>','getItem','keydown','1811616AhzuqV','style','forEach','sendBtn','./router.html','padStart','ai_chat_messages','expand','1025116kOkKOB','floor','value','modalConfirm','offsetHeight','modalText','now','children','2127480AbQfOu','delete-btn','offClick','Ошибка\x20сервера','display','createElement','clear_history','appendChild','getHours','signal','messageInput','debug_uid','success','23185JTbmMP','HapticFeedback','viewportChanged','div','show','stopPropagation','POST','shiftKey','target','getElementById','click','(((.+)+)+)+$','confirmModal','trim','apply','Ошибка\x20сети','role','.message.show-delete','querySelector','stringify','splice','input','1128CNNqoy','medium','WebApp','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','setHeaderColor','preventDefault','clearBtn','from','touchstart','scrollHeight','contains','key','Очистить\x20историю?','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','6962130hsDeMu','warn','href','getMinutes','auto','impactOccurred','.container','classList','notificationOccurred','push','send_message','Enter','innerHTML','20166616JNPoxJ','add','Telegram','removeItem','light','json','timestamp','length','typingIndicator','paddingBottom','addEventListener','textContent','scrollTop','className','message-time','innerHeight','Пустой\x20ответ'];a0_0x5a58=function(){return _0x236f2b;};return a0_0x5a58();}function a0_0x8da5(_0x2e287d,_0x6a0200){_0x2e287d=_0x2e287d-0x148;const _0x415fed=a0_0x5a58();let _0x43a582=_0x415fed[_0x2e287d];return _0x43a582;}let messages=[],isTyping=![];const chatArea=document['getElementById']('chatArea'),emptyState=document[a0_0xc33a3b(0x1a0)](a0_0xc33a3b(0x166)),messageInput=document[a0_0xc33a3b(0x1a0)](a0_0xc33a3b(0x194)),sendBtn=document['getElementById'](a0_0xc33a3b(0x17d)),clearBtn=document[a0_0xc33a3b(0x1a0)](a0_0xc33a3b(0x1b3)),modal=document['getElementById'](a0_0xc33a3b(0x1a3)),mTitle=document['getElementById'](a0_0xc33a3b(0x170)),mText=document[a0_0xc33a3b(0x1a0)](a0_0xc33a3b(0x187));let modalCallback=null;async function callBackend(_0x1630d5,_0x507066){const _0x49c980=a0_0xc33a3b,_0x1a1434=tg?.['initDataUnsafe']?.['user']||{},_0x4dc207=_0x1a1434['id']||localStorage[_0x49c980(0x178)](_0x49c980(0x195))||'d-'+Math[_0x49c980(0x183)](Math['random']()*0x3b9aca00);if(!_0x1a1434['id'])localStorage[_0x49c980(0x169)](_0x49c980(0x195),_0x4dc207);const _0x1be5a4={'action':_0x1630d5,'user_id':_0x4dc207,'user_data':{'first_name':_0x1a1434[_0x49c980(0x167)],'username':_0x1a1434[_0x49c980(0x164)]},'init_data':tg?.[_0x49c980(0x16e)]||'',..._0x507066},_0x35b60b=new AbortController(),_0x3a09b2=setTimeout(()=>_0x35b60b['abort'](),REQUEST_TIMEOUT_MS);try{const _0xf5fe02=await fetch(BACKEND_URL,{'method':_0x49c980(0x19d),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x49c980(0x1aa)](_0x1be5a4),'signal':_0x35b60b[_0x49c980(0x193)]});return clearTimeout(_0x3a09b2),await _0xf5fe02[_0x49c980(0x152)]();}catch(_0x34f6ce){return{'success':![],'error':String(_0x34f6ce)};}}function formatTime(_0x81b345){const _0x2317b6=a0_0xc33a3b,_0x1dc0e1=new Date(_0x81b345);return String(_0x1dc0e1[_0x2317b6(0x192)]())[_0x2317b6(0x17f)](0x2,'0')+':'+String(_0x1dc0e1[_0x2317b6(0x1be)]())[_0x2317b6(0x17f)](0x2,'0');}function createMessageElement(_0xdea098,_0x43d3f2){const _0x240319=a0_0xc33a3b,_0x145b8e=document['createElement'](_0x240319(0x19a));_0x145b8e[_0x240319(0x15a)]=_0x240319(0x161)+_0xdea098[_0x240319(0x1a7)];const _0xa071d3=document[_0x240319(0x18f)]('div');_0xa071d3[_0x240319(0x15a)]='message-bubble',_0xa071d3[_0x240319(0x14c)]=_0xdea098['content']['replace'](/\n/g,_0x240319(0x177));const _0x5a33d6=document[_0x240319(0x18f)](_0x240319(0x19a));_0x5a33d6[_0x240319(0x15a)]=_0x240319(0x18b),_0x5a33d6[_0x240319(0x14c)]=_0x240319(0x1b0),_0x5a33d6[_0x240319(0x15e)]=_0x170bd0=>{const _0x3472f1=_0x240319;_0x170bd0[_0x3472f1(0x19c)](),confirmDelete(_0x43d3f2);};let _0x22952a;_0xa071d3[_0x240319(0x157)](_0x240319(0x1b5),()=>_0x22952a=setTimeout(()=>{const _0x49a083=_0x240319;_0x145b8e['classList'][_0x49a083(0x14e)](_0x49a083(0x165));if(tg?.['HapticFeedback'])tg[_0x49a083(0x198)][_0x49a083(0x1c0)](_0x49a083(0x1ae));},0x1f4)),_0xa071d3[_0x240319(0x157)](_0x240319(0x15f),()=>clearTimeout(_0x22952a));const _0x224bc9=document['createElement'](_0x240319(0x19a));return _0x224bc9[_0x240319(0x15a)]=_0x240319(0x15b),_0x224bc9['textContent']=formatTime(_0xdea098[_0x240319(0x153)]),_0x145b8e['appendChild'](_0x5a33d6),_0x145b8e['appendChild'](_0xa071d3),_0x145b8e['appendChild'](_0x224bc9),_0x145b8e;}function createTypingIndicator(){const _0x55fcba=a0_0xc33a3b,_0x4e7b4b=document[_0x55fcba(0x18f)](_0x55fcba(0x19a));return _0x4e7b4b[_0x55fcba(0x15a)]='message\x20ai',_0x4e7b4b['id']=_0x55fcba(0x155),_0x4e7b4b[_0x55fcba(0x14c)]=_0x55fcba(0x1ba),_0x4e7b4b;}function renderMessages(){const _0x23a95b=a0_0xc33a3b;Array[_0x23a95b(0x1b4)](chatArea[_0x23a95b(0x189)])[_0x23a95b(0x17c)](_0x16499c=>{const _0x55745f=_0x23a95b;if(_0x16499c['id']!==_0x55745f(0x166))_0x16499c[_0x55745f(0x168)]();}),messages['length']>0x0?(emptyState[_0x23a95b(0x17b)]['display']=_0x23a95b(0x163),messages[_0x23a95b(0x17c)]((_0x868c52,_0x201935)=>chatArea[_0x23a95b(0x191)](createMessageElement(_0x868c52,_0x201935)))):emptyState[_0x23a95b(0x17b)][_0x23a95b(0x18e)]=_0x23a95b(0x16d),requestAnimationFrame(()=>chatArea[_0x23a95b(0x159)]=chatArea[_0x23a95b(0x1b6)]);}function autoResizeTextarea(){const _0x369975=a0_0xc33a3b;messageInput['style'][_0x369975(0x16f)]=_0x369975(0x1bf),messageInput['style'][_0x369975(0x16f)]=Math['min'](messageInput[_0x369975(0x1b6)],0x78)+'px';}function updateSendButton(){const _0x3a7bad=a0_0xc33a3b,_0x2a19bb=messageInput[_0x3a7bad(0x184)]['trim']();sendBtn['disabled']=!_0x2a19bb||isTyping;}async function sendMessage(){const _0x671c69=a0_0xc33a3b,_0x8a2281=messageInput['value'][_0x671c69(0x1a4)]();if(!_0x8a2281||isTyping)return;if(tg?.[_0x671c69(0x198)])tg[_0x671c69(0x198)][_0x671c69(0x1c0)](_0x671c69(0x151));messages[_0x671c69(0x149)]({'role':'user','content':_0x8a2281,'timestamp':Date[_0x671c69(0x188)]()}),localStorage['setItem'](_0x671c69(0x180),JSON[_0x671c69(0x1aa)](messages)),renderMessages(),messageInput[_0x671c69(0x184)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x671c69(0x159)]=chatArea['scrollHeight'];const _0x21d69f=await callBackend(_0x671c69(0x14a),{'message':_0x8a2281});isTyping=![];const _0x1ba6f4=document[_0x671c69(0x1a0)](_0x671c69(0x155));if(_0x1ba6f4)_0x1ba6f4['remove']();let _0x3155f8=_0x671c69(0x1a6);if(_0x21d69f[_0x671c69(0x196)]){_0x3155f8=_0x21d69f['text']||_0x671c69(0x15d);if(tg?.[_0x671c69(0x198)])tg['HapticFeedback'][_0x671c69(0x148)](_0x671c69(0x196));}else{_0x3155f8=_0x21d69f['error']||_0x671c69(0x18d);if(tg?.[_0x671c69(0x198)])tg[_0x671c69(0x198)]['notificationOccurred'](_0x671c69(0x16a));}messages[_0x671c69(0x149)]({'role':'ai','content':_0x3155f8,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x671c69(0x1aa)](messages)),renderMessages();}function confirmDelete(_0x4761dc){const _0xd1e222=a0_0xc33a3b;if(mTitle)mTitle[_0xd1e222(0x158)]=_0xd1e222(0x16b);if(mText)mText[_0xd1e222(0x158)]=_0xd1e222(0x175);modalCallback=()=>{const _0x2e34f9=_0xd1e222;messages[_0x2e34f9(0x1ab)](_0x4761dc,0x1),localStorage[_0x2e34f9(0x169)](_0x2e34f9(0x180),JSON[_0x2e34f9(0x1aa)](messages)),renderMessages();},modal[_0xd1e222(0x1c2)][_0xd1e222(0x14e)](_0xd1e222(0x19b));}if(clearBtn)clearBtn[a0_0xc33a3b(0x15e)]=()=>{const _0x8bf27b=a0_0xc33a3b;if(!messages[_0x8bf27b(0x154)])return;if(mTitle)mTitle[_0x8bf27b(0x158)]=_0x8bf27b(0x1b9);if(mText)mText[_0x8bf27b(0x158)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x5a12b0=_0x8bf27b;messages=[],localStorage[_0x5a12b0(0x150)]('ai_chat_messages'),renderMessages(),callBackend(_0x5a12b0(0x190),{});},modal[_0x8bf27b(0x1c2)]['add'](_0x8bf27b(0x19b));};document[a0_0xc33a3b(0x1a0)](a0_0xc33a3b(0x173))['onclick']=()=>modal['classList'][a0_0xc33a3b(0x168)](a0_0xc33a3b(0x19b)),document['getElementById'](a0_0xc33a3b(0x185))[a0_0xc33a3b(0x15e)]=()=>{const _0x3cd900=a0_0xc33a3b;if(modalCallback)modalCallback();modal[_0x3cd900(0x1c2)][_0x3cd900(0x168)](_0x3cd900(0x19b));},messageInput['addEventListener'](a0_0xc33a3b(0x1ac),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0xc33a3b(0x179),_0x13af63=>{const _0x25786f=a0_0xc33a3b;_0x13af63[_0x25786f(0x1b8)]===_0x25786f(0x14b)&&!_0x13af63[_0x25786f(0x19e)]&&(_0x13af63[_0x25786f(0x1b2)](),sendMessage());}),sendBtn[a0_0xc33a3b(0x15e)]=sendMessage,document[a0_0xc33a3b(0x157)](a0_0xc33a3b(0x1a1),_0x384463=>{const _0x290a05=a0_0xc33a3b;document['querySelectorAll'](_0x290a05(0x1a8))[_0x290a05(0x17c)](_0x443c61=>{const _0x25d95c=_0x290a05;if(!_0x443c61[_0x25d95c(0x1b7)](_0x384463[_0x25d95c(0x19f)]))_0x443c61[_0x25d95c(0x1c2)][_0x25d95c(0x168)](_0x25d95c(0x165));});});const saved=localStorage[a0_0xc33a3b(0x178)](a0_0xc33a3b(0x180));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x25aa80){}updateSendButton();