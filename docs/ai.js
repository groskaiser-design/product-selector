function a0_0x37b6(_0x4d91e0,_0x792e38){_0x4d91e0=_0x4d91e0-0x1d9;const _0x596fc0=a0_0x4231();let _0x5642a5=_0x596fc0[_0x4d91e0];return _0x5642a5;}const a0_0x551dd6=a0_0x37b6;(function(_0xc27692,_0x16f24b){const _0x4c52d1=a0_0x37b6,_0xab024a=_0xc27692();while(!![]){try{const _0x519bf6=parseInt(_0x4c52d1(0x22e))/0x1*(-parseInt(_0x4c52d1(0x1dd))/0x2)+parseInt(_0x4c52d1(0x251))/0x3*(parseInt(_0x4c52d1(0x21b))/0x4)+parseInt(_0x4c52d1(0x20d))/0x5+-parseInt(_0x4c52d1(0x209))/0x6+-parseInt(_0x4c52d1(0x1ff))/0x7*(-parseInt(_0x4c52d1(0x218))/0x8)+-parseInt(_0x4c52d1(0x200))/0x9*(parseInt(_0x4c52d1(0x22f))/0xa)+parseInt(_0x4c52d1(0x206))/0xb;if(_0x519bf6===_0x16f24b)break;else _0xab024a['push'](_0xab024a['shift']());}catch(_0x117f05){_0xab024a['push'](_0xab024a['shift']());}}}(a0_0x4231,0x7b904));const tg=window[a0_0x551dd6(0x245)]?.['WebApp'],HOME_URL=a0_0x551dd6(0x233);function setupTelegramBackButton(){const _0x3da1e2=a0_0x551dd6,_0x2fef14=(function(){let _0x4ac8bd=!![];return function(_0x37920f,_0xfe40bb){const _0x412a5e=_0x4ac8bd?function(){const _0x3881a5=a0_0x37b6;if(_0xfe40bb){const _0x5b2526=_0xfe40bb[_0x3881a5(0x20c)](_0x37920f,arguments);return _0xfe40bb=null,_0x5b2526;}}:function(){};return _0x4ac8bd=![],_0x412a5e;};}()),_0x350347=_0x2fef14(this,function(){const _0x45d547=a0_0x37b6;return _0x350347['toString']()['search']('(((.+)+)+)+$')[_0x45d547(0x254)]()['constructor'](_0x350347)[_0x45d547(0x24a)]('(((.+)+)+)+$');});_0x350347();if(!tg)return;try{tg[_0x3da1e2(0x238)](),tg[_0x3da1e2(0x239)](),tg[_0x3da1e2(0x23e)]?.(_0x3da1e2(0x1f9));if(tg[_0x3da1e2(0x21d)]?.('6.1'))tg[_0x3da1e2(0x230)]?.();const _0x79ab04=tg[_0x3da1e2(0x1de)];if(_0x79ab04){_0x79ab04[_0x3da1e2(0x1dc)]();if(typeof _0x79ab04[_0x3da1e2(0x247)]===_0x3da1e2(0x203))try{_0x79ab04[_0x3da1e2(0x247)]();}catch(_0x1a1abd){}_0x79ab04['onClick'](()=>{const _0xbfb5f3=_0x3da1e2;if(tg[_0xbfb5f3(0x24b)])tg[_0xbfb5f3(0x24b)][_0xbfb5f3(0x1ef)]('light');location[_0xbfb5f3(0x20b)]=HOME_URL;});}}catch(_0x4eaf8a){console[_0x3da1e2(0x20a)](_0x3da1e2(0x24c),_0x4eaf8a);}}(function initStableLayout(){const _0x5a3e5b=a0_0x551dd6,_0xcd9d74=document['querySelector'](_0x5a3e5b(0x20e)),_0x2d32d3=document['getElementById'](_0x5a3e5b(0x237)),_0x5844a2=document['getElementById']('chatArea'),_0x1d77f0=document['getElementById'](_0x5a3e5b(0x236));function _0x36a5b2(){const _0x1cdd77=_0x5a3e5b;if(!_0xcd9d74)return;const _0x4ab148=tg&&tg[_0x1cdd77(0x1ed)]?tg[_0x1cdd77(0x1ed)]:window[_0x1cdd77(0x253)];_0xcd9d74[_0x1cdd77(0x1f3)][_0x1cdd77(0x241)]=_0x4ab148+'px';if(_0x2d32d3){const _0xe5bece=_0x2d32d3[_0x1cdd77(0x240)];_0x5844a2[_0x1cdd77(0x1f3)][_0x1cdd77(0x256)]=_0xe5bece+0x28+'px';}}tg?tg[_0x5a3e5b(0x23d)](_0x5a3e5b(0x1e5),({isStateStable:_0x12939b})=>{_0x36a5b2();if(_0x12939b)requestAnimationFrame(()=>{const _0x3adefe=a0_0x37b6;_0x5844a2[_0x3adefe(0x1e9)]=_0x5844a2[_0x3adefe(0x1f4)];});}):window['addEventListener'](_0x5a3e5b(0x252),_0x36a5b2),_0x36a5b2(),_0x1d77f0&&(_0x1d77f0[_0x5a3e5b(0x234)](_0x5a3e5b(0x23c),()=>{requestAnimationFrame(_0x36a5b2);}),_0x1d77f0[_0x5a3e5b(0x234)](_0x5a3e5b(0x24e),()=>{setTimeout(()=>{_0x5844a2['scrollTop']=_0x5844a2['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x551dd6(0x1db)](a0_0x551dd6(0x205)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x551dd6(0x1db)](a0_0x551dd6(0x236)),sendBtn=document[a0_0x551dd6(0x1db)]('sendBtn'),clearBtn=document[a0_0x551dd6(0x1db)](a0_0x551dd6(0x248)),modal=document[a0_0x551dd6(0x1db)]('confirmModal'),mTitle=document[a0_0x551dd6(0x1db)]('modalTitle'),mText=document[a0_0x551dd6(0x1db)](a0_0x551dd6(0x1d9));let modalCallback=null;async function callBackend(_0x429625,_0x1e1737){const _0x216507=a0_0x551dd6,_0x1d537f=tg?.[_0x216507(0x1f7)]?.[_0x216507(0x215)]||{},_0x368ca7=_0x1d537f['id']||localStorage[_0x216507(0x202)](_0x216507(0x228))||'d-'+Math[_0x216507(0x223)](Math[_0x216507(0x21c)]()*0x3b9aca00);if(!_0x1d537f['id'])localStorage['setItem'](_0x216507(0x228),_0x368ca7);const _0x5b89d8={'action':_0x429625,'user_id':_0x368ca7,'user_data':{'first_name':_0x1d537f[_0x216507(0x219)],'username':_0x1d537f[_0x216507(0x20f)]},'init_data':tg?.[_0x216507(0x1f0)]||'',..._0x1e1737},_0x5dbf4f=new AbortController(),_0x18e855=setTimeout(()=>_0x5dbf4f[_0x216507(0x226)](),REQUEST_TIMEOUT_MS);try{const _0x4023f8=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x216507(0x224)},'body':JSON[_0x216507(0x1e4)](_0x5b89d8),'signal':_0x5dbf4f[_0x216507(0x1e3)]});return clearTimeout(_0x18e855),await _0x4023f8['json']();}catch(_0x592b01){return{'success':![],'error':String(_0x592b01)};}}function formatTime(_0x57d568){const _0x209e3b=a0_0x551dd6,_0xc39afa=new Date(_0x57d568);return String(_0xc39afa[_0x209e3b(0x244)]())['padStart'](0x2,'0')+':'+String(_0xc39afa[_0x209e3b(0x1e6)]())[_0x209e3b(0x22c)](0x2,'0');}function createMessageElement(_0x555e62,_0x711b27){const _0xa389d4=a0_0x551dd6,_0x4613a5=document['createElement']('div');_0x4613a5[_0xa389d4(0x1e0)]=_0xa389d4(0x235)+_0x555e62[_0xa389d4(0x22b)];const _0x456f21=document['createElement'](_0xa389d4(0x214));_0x456f21[_0xa389d4(0x1e0)]=_0xa389d4(0x23b),_0x456f21[_0xa389d4(0x225)]=_0x555e62['content']['replace'](/\n/g,'<br>');const _0x14aa85=document['createElement'](_0xa389d4(0x214));_0x14aa85['className']=_0xa389d4(0x246),_0x14aa85[_0xa389d4(0x225)]=_0xa389d4(0x227),_0x14aa85[_0xa389d4(0x1fe)]=_0x49642e=>{const _0x13cbad=_0xa389d4;_0x49642e[_0x13cbad(0x1eb)](),confirmDelete(_0x711b27);};let _0x17bd7a;_0x456f21[_0xa389d4(0x234)](_0xa389d4(0x21e),()=>_0x17bd7a=setTimeout(()=>{const _0x2ebe68=_0xa389d4;_0x4613a5[_0x2ebe68(0x1ea)][_0x2ebe68(0x23f)](_0x2ebe68(0x242));if(tg?.['HapticFeedback'])tg[_0x2ebe68(0x24b)][_0x2ebe68(0x1ef)]('medium');},0x1f4)),_0x456f21['addEventListener'](_0xa389d4(0x212),()=>clearTimeout(_0x17bd7a));const _0x7bfe21=document[_0xa389d4(0x231)]('div');return _0x7bfe21[_0xa389d4(0x1e0)]=_0xa389d4(0x1da),_0x7bfe21[_0xa389d4(0x22d)]=formatTime(_0x555e62[_0xa389d4(0x24f)]),_0x4613a5['appendChild'](_0x14aa85),_0x4613a5[_0xa389d4(0x229)](_0x456f21),_0x4613a5[_0xa389d4(0x229)](_0x7bfe21),_0x4613a5;}function createTypingIndicator(){const _0x184d6f=a0_0x551dd6,_0x12fb14=document[_0x184d6f(0x231)](_0x184d6f(0x214));return _0x12fb14[_0x184d6f(0x1e0)]=_0x184d6f(0x204),_0x12fb14['id']='typingIndicator',_0x12fb14[_0x184d6f(0x225)]=_0x184d6f(0x1e2),_0x12fb14;}function renderMessages(){const _0x3774a4=a0_0x551dd6;Array[_0x3774a4(0x1f1)](chatArea[_0x3774a4(0x250)])['forEach'](_0x37a4d2=>{const _0x35556c=_0x3774a4;if(_0x37a4d2['id']!=='emptyState')_0x37a4d2[_0x35556c(0x21f)]();}),messages[_0x3774a4(0x1f5)]>0x0?(emptyState['style'][_0x3774a4(0x210)]=_0x3774a4(0x1f8),messages['forEach']((_0x30e421,_0x3ac29b)=>chatArea[_0x3774a4(0x229)](createMessageElement(_0x30e421,_0x3ac29b)))):emptyState[_0x3774a4(0x1f3)][_0x3774a4(0x210)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x3774a4(0x1f4)]);}function autoResizeTextarea(){const _0x4ad9c8=a0_0x551dd6;messageInput['style'][_0x4ad9c8(0x241)]=_0x4ad9c8(0x201),messageInput[_0x4ad9c8(0x1f3)][_0x4ad9c8(0x241)]=Math[_0x4ad9c8(0x216)](messageInput[_0x4ad9c8(0x1f4)],0x78)+'px';}function updateSendButton(){const _0xaa0dfe=a0_0x551dd6,_0x2ae624=messageInput[_0xaa0dfe(0x222)][_0xaa0dfe(0x1e1)]();sendBtn[_0xaa0dfe(0x1fc)]=!_0x2ae624||isTyping;}async function sendMessage(){const _0x1da045=a0_0x551dd6,_0x4826be=messageInput[_0x1da045(0x222)][_0x1da045(0x1e1)]();if(!_0x4826be||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x1da045(0x24b)][_0x1da045(0x1ef)]('light');messages['push']({'role':_0x1da045(0x215),'content':_0x4826be,'timestamp':Date[_0x1da045(0x208)]()}),localStorage[_0x1da045(0x243)](_0x1da045(0x221),JSON[_0x1da045(0x1e4)](messages)),renderMessages(),messageInput[_0x1da045(0x222)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1da045(0x229)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x1da045(0x1f4)];const _0x4141b8=await callBackend(_0x1da045(0x1e8),{'message':_0x4826be});isTyping=![];const _0x41d120=document[_0x1da045(0x1db)]('typingIndicator');if(_0x41d120)_0x41d120[_0x1da045(0x21f)]();let _0xe0f732=_0x1da045(0x1fd);if(_0x4141b8[_0x1da045(0x24d)]){_0xe0f732=_0x4141b8[_0x1da045(0x211)]||_0x1da045(0x207);if(tg?.[_0x1da045(0x24b)])tg['HapticFeedback']['notificationOccurred'](_0x1da045(0x24d));}else{_0xe0f732=_0x4141b8[_0x1da045(0x1df)]||_0x1da045(0x1ee);if(tg?.[_0x1da045(0x24b)])tg[_0x1da045(0x24b)][_0x1da045(0x249)](_0x1da045(0x1df));}messages[_0x1da045(0x255)]({'role':'ai','content':_0xe0f732,'timestamp':Date['now']()}),localStorage[_0x1da045(0x243)](_0x1da045(0x221),JSON[_0x1da045(0x1e4)](messages)),renderMessages();}function confirmDelete(_0x33f48b){const _0x53fd71=a0_0x551dd6;if(mTitle)mTitle[_0x53fd71(0x22d)]='Удалить?';if(mText)mText[_0x53fd71(0x22d)]=_0x53fd71(0x232);modalCallback=()=>{const _0x132dec=_0x53fd71;messages['splice'](_0x33f48b,0x1),localStorage['setItem'](_0x132dec(0x221),JSON[_0x132dec(0x1e4)](messages)),renderMessages();},modal[_0x53fd71(0x1ea)]['add'](_0x53fd71(0x1dc));}if(clearBtn)clearBtn[a0_0x551dd6(0x1fe)]=()=>{const _0x1b0624=a0_0x551dd6;if(!messages[_0x1b0624(0x1f5)])return;if(mTitle)mTitle[_0x1b0624(0x22d)]='Очистить\x20историю?';if(mText)mText[_0x1b0624(0x22d)]=_0x1b0624(0x23a);modalCallback=async()=>{const _0x364379=_0x1b0624;messages=[],localStorage[_0x364379(0x1f6)]('ai_chat_messages'),renderMessages(),callBackend(_0x364379(0x1fb),{});},modal[_0x1b0624(0x1ea)]['add'](_0x1b0624(0x1dc));};document[a0_0x551dd6(0x1db)](a0_0x551dd6(0x21a))[a0_0x551dd6(0x1fe)]=()=>modal[a0_0x551dd6(0x1ea)][a0_0x551dd6(0x21f)](a0_0x551dd6(0x1dc)),document['getElementById']('modalConfirm')['onclick']=()=>{const _0x214f2d=a0_0x551dd6;if(modalCallback)modalCallback();modal[_0x214f2d(0x1ea)]['remove'](_0x214f2d(0x1dc));},messageInput[a0_0x551dd6(0x234)](a0_0x551dd6(0x23c),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x551dd6(0x234)]('keydown',_0x3d5cf5=>{const _0x57bdbd=a0_0x551dd6;_0x3d5cf5[_0x57bdbd(0x213)]===_0x57bdbd(0x22a)&&!_0x3d5cf5[_0x57bdbd(0x217)]&&(_0x3d5cf5['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x551dd6(0x234)](a0_0x551dd6(0x1e7),_0x193b2e=>{const _0x264603=a0_0x551dd6;document[_0x264603(0x220)](_0x264603(0x1ec))['forEach'](_0x49e46d=>{const _0x265224=_0x264603;if(!_0x49e46d[_0x265224(0x1fa)](_0x193b2e['target']))_0x49e46d['classList'][_0x265224(0x21f)]('show-delete');});});const saved=localStorage[a0_0x551dd6(0x202)](a0_0x551dd6(0x221));if(saved)try{messages=JSON[a0_0x551dd6(0x1f2)](saved),renderMessages();}catch(a0_0x323727){}function a0_0x4231(){const _0x85275d=['text/plain','innerHTML','abort','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','debug_uid','appendChild','Enter','role','padStart','textContent','27484BQMjVd','80JgBSZe','disableVerticalSwipes','createElement','Действие\x20необратимо.','./router.html','addEventListener','message\x20','messageInput','inputArea','ready','expand','Начнется\x20новый\x20диалог.','message-bubble','input','onEvent','setHeaderColor','add','offsetHeight','height','show-delete','setItem','getHours','Telegram','delete-btn','offClick','clearBtn','notificationOccurred','search','HapticFeedback','TG\x20setup\x20error:','success','focus','timestamp','children','94533MnmrmY','resize','innerHeight','toString','push','paddingBottom','modalText','message-time','getElementById','show','4ypKnbd','BackButton','error','className','trim','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','signal','stringify','viewportChanged','getMinutes','click','send_message','scrollTop','classList','stopPropagation','.message.show-delete','viewportHeight','Ошибка\x20сервера','impactOccurred','initData','from','parse','style','scrollHeight','length','removeItem','initDataUnsafe','none','#050505','contains','clear_history','disabled','Ошибка\x20сети','onclick','231nhLmUz','575496xqgvpG','auto','getItem','function','message\x20ai','chatArea','2758866QpVMEE','Пустой\x20ответ','now','346704iGZEdi','warn','href','apply','1082910Yagttb','.container','username','display','text','touchend','key','div','user','min','shiftKey','153096ZMtHKh','first_name','modalCancel','4hCIDyu','random','isVersionAtLeast','touchstart','remove','querySelectorAll','ai_chat_messages','value','floor'];a0_0x4231=function(){return _0x85275d;};return a0_0x4231();}updateSendButton();