const a0_0x3ba1ab=a0_0x2115;(function(_0x3f240c,_0x1c4cc9){const _0xae2df2=a0_0x2115,_0x10ac19=_0x3f240c();while(!![]){try{const _0x718c9f=-parseInt(_0xae2df2(0x1a5))/0x1*(-parseInt(_0xae2df2(0x177))/0x2)+parseInt(_0xae2df2(0x1af))/0x3*(-parseInt(_0xae2df2(0x1ae))/0x4)+parseInt(_0xae2df2(0x1c3))/0x5*(-parseInt(_0xae2df2(0x1a8))/0x6)+parseInt(_0xae2df2(0x1b0))/0x7+-parseInt(_0xae2df2(0x187))/0x8+-parseInt(_0xae2df2(0x1a4))/0x9+parseInt(_0xae2df2(0x19b))/0xa;if(_0x718c9f===_0x1c4cc9)break;else _0x10ac19['push'](_0x10ac19['shift']());}catch(_0x1aa18c){_0x10ac19['push'](_0x10ac19['shift']());}}}(a0_0x2cd8,0x88375));const tg=window[a0_0x3ba1ab(0x1ba)]?.[a0_0x3ba1ab(0x1e2)],HOME_URL=a0_0x3ba1ab(0x197);function setupTelegramBackButton(){const _0x20c3cf=a0_0x3ba1ab,_0x1ec724=(function(){let _0x458cef=!![];return function(_0x52e640,_0x566273){const _0x990eca=_0x458cef?function(){if(_0x566273){const _0x19ea2c=_0x566273['apply'](_0x52e640,arguments);return _0x566273=null,_0x19ea2c;}}:function(){};return _0x458cef=![],_0x990eca;};}()),_0x402019=_0x1ec724(this,function(){const _0x22df32=a0_0x2115;return _0x402019[_0x22df32(0x186)]()[_0x22df32(0x1ee)](_0x22df32(0x1bd))['toString']()[_0x22df32(0x1dd)](_0x402019)[_0x22df32(0x1ee)](_0x22df32(0x1bd));});_0x402019();if(!tg)return;try{tg[_0x20c3cf(0x18a)](),tg[_0x20c3cf(0x181)](),tg[_0x20c3cf(0x19e)]?.(_0x20c3cf(0x191));if(tg['isVersionAtLeast']?.(_0x20c3cf(0x1c9)))tg[_0x20c3cf(0x1df)]?.();const _0x3f7d23=tg['BackButton'];if(_0x3f7d23){_0x3f7d23[_0x20c3cf(0x1a3)]();if(typeof _0x3f7d23['offClick']===_0x20c3cf(0x190))try{_0x3f7d23[_0x20c3cf(0x1d0)]();}catch(_0x46abae){}_0x3f7d23[_0x20c3cf(0x18c)](()=>{const _0x221e00=_0x20c3cf;if(tg[_0x221e00(0x1f5)])tg[_0x221e00(0x1f5)][_0x221e00(0x1b8)](_0x221e00(0x1e1));location[_0x221e00(0x17f)]=HOME_URL;});}}catch(_0x577b37){console[_0x20c3cf(0x1e0)](_0x20c3cf(0x18f),_0x577b37);}}(function initStableLayout(){const _0x40f7bf=a0_0x3ba1ab,_0x2c423b=document[_0x40f7bf(0x1b4)](_0x40f7bf(0x1db)),_0x47cfd6=document[_0x40f7bf(0x194)](_0x40f7bf(0x182)),_0x5dd26b=document[_0x40f7bf(0x194)]('chatArea'),_0x3e7ef2=document[_0x40f7bf(0x194)](_0x40f7bf(0x1e7));function _0x342d53(){const _0x81cb26=_0x40f7bf;if(!_0x2c423b)return;const _0x1b36de=tg&&tg[_0x81cb26(0x17e)]?tg[_0x81cb26(0x17e)]:window['innerHeight'];_0x2c423b['style']['height']=_0x1b36de+'px';if(_0x47cfd6){const _0x531502=_0x47cfd6[_0x81cb26(0x1ec)];_0x5dd26b[_0x81cb26(0x185)][_0x81cb26(0x1cb)]=_0x531502+0x28+'px';}}tg?tg[_0x40f7bf(0x1ea)]('viewportChanged',({isStateStable:_0x210efe})=>{_0x342d53();if(_0x210efe)requestAnimationFrame(()=>{const _0x39b338=a0_0x2115;_0x5dd26b[_0x39b338(0x18d)]=_0x5dd26b['scrollHeight'];});}):window[_0x40f7bf(0x1a2)](_0x40f7bf(0x1c2),_0x342d53),_0x342d53(),_0x3e7ef2&&(_0x3e7ef2['addEventListener']('input',()=>{requestAnimationFrame(_0x342d53);}),_0x3e7ef2[_0x40f7bf(0x1a2)](_0x40f7bf(0x1cd),()=>{setTimeout(()=>{const _0x33ce59=a0_0x2115;_0x5dd26b[_0x33ce59(0x18d)]=_0x5dd26b[_0x33ce59(0x18b)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x2cd8(){const _0x2ce5f8=['remove','constructor','none','disableVerticalSwipes','warn','light','WebApp','value','Enter','send_message','POST','messageInput','trim','success','onEvent','typingIndicator','offsetHeight','click','search','children','first_name','random','add','display','getHours','HapticFeedback','851248PsLVnR','auto','Удалить?','length','show-delete','getMinutes','message-bubble','viewportHeight','href','emptyState','expand','inputArea','getItem','classList','style','toString','1091168phRrNM','textContent','querySelectorAll','ready','scrollHeight','onClick','scrollTop','abort','TG\x20setup\x20error:','function','#050505','initDataUnsafe','floor','getElementById','createElement','confirmModal','./router.html','touchend','json','Пустой\x20ответ','11580460cGDBad','min','forEach','setHeaderColor','target','clearBtn','sendBtn','addEventListener','show','1618497TPrZSv','1yivFDA','user','padStart','209262OMSMmE','stringify','Начнется\x20новый\x20диалог.','setItem','Очистить\x20историю?','onclick','435732FccHTg','21rZBlpZ','3300885pKVGMG','notificationOccurred','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','push','querySelector','now','removeItem','delete-btn','impactOccurred','contains','Telegram','message-time','div','(((.+)+)+)+$','innerHTML','timestamp','ai_chat_messages','role','resize','60CjnUPl','text','disabled','Действие\x20необратимо.','className','error','6.1','modalConfirm','paddingBottom','stopPropagation','focus','appendChild','parse','offClick','input','Ошибка\x20сервера','from','message\x20','key','debug_uid','flex','modalCancel','content','.message.show-delete','.container'];a0_0x2cd8=function(){return _0x2ce5f8;};return a0_0x2cd8();}const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;function a0_0x2115(_0x6f4b30,_0x398da5){_0x6f4b30=_0x6f4b30-0x177;const _0x362c85=a0_0x2cd8();let _0xedd618=_0x362c85[_0x6f4b30];return _0xedd618;}let messages=[],isTyping=![];const chatArea=document['getElementById']('chatArea'),emptyState=document[a0_0x3ba1ab(0x194)]('emptyState'),messageInput=document['getElementById'](a0_0x3ba1ab(0x1e7)),sendBtn=document[a0_0x3ba1ab(0x194)](a0_0x3ba1ab(0x1a1)),clearBtn=document[a0_0x3ba1ab(0x194)](a0_0x3ba1ab(0x1a0)),modal=document[a0_0x3ba1ab(0x194)](a0_0x3ba1ab(0x196)),mTitle=document['getElementById']('modalTitle'),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x2ca971,_0x4bdc87){const _0x974eb8=a0_0x3ba1ab,_0x27f97e=tg?.[_0x974eb8(0x192)]?.['user']||{},_0x20c86c=_0x27f97e['id']||localStorage['getItem'](_0x974eb8(0x1d6))||'d-'+Math[_0x974eb8(0x193)](Math[_0x974eb8(0x1f1)]()*0x3b9aca00);if(!_0x27f97e['id'])localStorage[_0x974eb8(0x1ab)](_0x974eb8(0x1d6),_0x20c86c);const _0x593292={'action':_0x2ca971,'user_id':_0x20c86c,'user_data':{'first_name':_0x27f97e[_0x974eb8(0x1f0)],'username':_0x27f97e['username']},'init_data':tg?.['initData']||'',..._0x4bdc87},_0x112442=new AbortController(),_0x2c879c=setTimeout(()=>_0x112442[_0x974eb8(0x18e)](),REQUEST_TIMEOUT_MS);try{const _0x2f7fa9=await fetch(BACKEND_URL,{'method':_0x974eb8(0x1e6),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x593292),'signal':_0x112442['signal']});return clearTimeout(_0x2c879c),await _0x2f7fa9[_0x974eb8(0x199)]();}catch(_0x29ce50){return{'success':![],'error':String(_0x29ce50)};}}function formatTime(_0x651528){const _0x3861c7=a0_0x3ba1ab,_0x493734=new Date(_0x651528);return String(_0x493734[_0x3861c7(0x1f4)]())[_0x3861c7(0x1a7)](0x2,'0')+':'+String(_0x493734[_0x3861c7(0x17c)]())[_0x3861c7(0x1a7)](0x2,'0');}function createMessageElement(_0x1e2028,_0x2b5983){const _0x5b877c=a0_0x3ba1ab,_0x26ec08=document[_0x5b877c(0x195)](_0x5b877c(0x1bc));_0x26ec08[_0x5b877c(0x1c7)]=_0x5b877c(0x1d4)+_0x1e2028[_0x5b877c(0x1c1)];const _0x440379=document[_0x5b877c(0x195)]('div');_0x440379[_0x5b877c(0x1c7)]=_0x5b877c(0x17d),_0x440379[_0x5b877c(0x1be)]=_0x1e2028[_0x5b877c(0x1d9)]['replace'](/\n/g,'<br>');const _0x297aa7=document[_0x5b877c(0x195)](_0x5b877c(0x1bc));_0x297aa7[_0x5b877c(0x1c7)]=_0x5b877c(0x1b7),_0x297aa7[_0x5b877c(0x1be)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x297aa7['onclick']=_0x46d00a=>{const _0x3e9d51=_0x5b877c;_0x46d00a[_0x3e9d51(0x1cc)](),confirmDelete(_0x2b5983);};let _0x16e0e5;_0x440379[_0x5b877c(0x1a2)]('touchstart',()=>_0x16e0e5=setTimeout(()=>{const _0x142830=_0x5b877c;_0x26ec08['classList'][_0x142830(0x1f2)](_0x142830(0x17b));if(tg?.[_0x142830(0x1f5)])tg[_0x142830(0x1f5)][_0x142830(0x1b8)]('medium');},0x1f4)),_0x440379['addEventListener'](_0x5b877c(0x198),()=>clearTimeout(_0x16e0e5));const _0x21587b=document[_0x5b877c(0x195)](_0x5b877c(0x1bc));return _0x21587b[_0x5b877c(0x1c7)]=_0x5b877c(0x1bb),_0x21587b['textContent']=formatTime(_0x1e2028[_0x5b877c(0x1bf)]),_0x26ec08[_0x5b877c(0x1ce)](_0x297aa7),_0x26ec08[_0x5b877c(0x1ce)](_0x440379),_0x26ec08[_0x5b877c(0x1ce)](_0x21587b),_0x26ec08;}function createTypingIndicator(){const _0x256057=a0_0x3ba1ab,_0x3a96b6=document[_0x256057(0x195)]('div');return _0x3a96b6['className']='message\x20ai',_0x3a96b6['id']=_0x256057(0x1eb),_0x3a96b6[_0x256057(0x1be)]=_0x256057(0x1b2),_0x3a96b6;}function renderMessages(){const _0xb3183f=a0_0x3ba1ab;Array[_0xb3183f(0x1d3)](chatArea[_0xb3183f(0x1ef)])['forEach'](_0x144456=>{const _0xb5017e=_0xb3183f;if(_0x144456['id']!==_0xb5017e(0x180))_0x144456[_0xb5017e(0x1dc)]();}),messages['length']>0x0?(emptyState[_0xb3183f(0x185)][_0xb3183f(0x1f3)]=_0xb3183f(0x1de),messages[_0xb3183f(0x19d)]((_0x339cb7,_0x100bc3)=>chatArea[_0xb3183f(0x1ce)](createMessageElement(_0x339cb7,_0x100bc3)))):emptyState[_0xb3183f(0x185)][_0xb3183f(0x1f3)]=_0xb3183f(0x1d7),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0xb3183f(0x18b)]);}function autoResizeTextarea(){const _0x2ae227=a0_0x3ba1ab;messageInput[_0x2ae227(0x185)]['height']=_0x2ae227(0x178),messageInput[_0x2ae227(0x185)]['height']=Math[_0x2ae227(0x19c)](messageInput[_0x2ae227(0x18b)],0x78)+'px';}function updateSendButton(){const _0x56c993=a0_0x3ba1ab,_0x29e51d=messageInput[_0x56c993(0x1e3)][_0x56c993(0x1e8)]();sendBtn[_0x56c993(0x1c5)]=!_0x29e51d||isTyping;}async function sendMessage(){const _0xdb8bd2=a0_0x3ba1ab,_0x58af7d=messageInput[_0xdb8bd2(0x1e3)][_0xdb8bd2(0x1e8)]();if(!_0x58af7d||isTyping)return;if(tg?.['HapticFeedback'])tg[_0xdb8bd2(0x1f5)][_0xdb8bd2(0x1b8)]('light');messages[_0xdb8bd2(0x1b3)]({'role':_0xdb8bd2(0x1a6),'content':_0x58af7d,'timestamp':Date[_0xdb8bd2(0x1b5)]()}),localStorage[_0xdb8bd2(0x1ab)](_0xdb8bd2(0x1c0),JSON[_0xdb8bd2(0x1a9)](messages)),renderMessages(),messageInput[_0xdb8bd2(0x1e3)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xdb8bd2(0x1ce)](createTypingIndicator()),chatArea[_0xdb8bd2(0x18d)]=chatArea[_0xdb8bd2(0x18b)];const _0x4c6ee8=await callBackend(_0xdb8bd2(0x1e5),{'message':_0x58af7d});isTyping=![];const _0x597afa=document[_0xdb8bd2(0x194)]('typingIndicator');if(_0x597afa)_0x597afa['remove']();let _0x391bec='Ошибка\x20сети';if(_0x4c6ee8[_0xdb8bd2(0x1e9)]){_0x391bec=_0x4c6ee8[_0xdb8bd2(0x1c4)]||_0xdb8bd2(0x19a);if(tg?.[_0xdb8bd2(0x1f5)])tg[_0xdb8bd2(0x1f5)][_0xdb8bd2(0x1b1)](_0xdb8bd2(0x1e9));}else{_0x391bec=_0x4c6ee8[_0xdb8bd2(0x1c8)]||_0xdb8bd2(0x1d2);if(tg?.[_0xdb8bd2(0x1f5)])tg[_0xdb8bd2(0x1f5)][_0xdb8bd2(0x1b1)]('error');}messages[_0xdb8bd2(0x1b3)]({'role':'ai','content':_0x391bec,'timestamp':Date[_0xdb8bd2(0x1b5)]()}),localStorage[_0xdb8bd2(0x1ab)](_0xdb8bd2(0x1c0),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x29beef){const _0x2526f0=a0_0x3ba1ab;if(mTitle)mTitle['textContent']=_0x2526f0(0x179);if(mText)mText[_0x2526f0(0x188)]=_0x2526f0(0x1c6);modalCallback=()=>{const _0x17cabf=_0x2526f0;messages['splice'](_0x29beef,0x1),localStorage[_0x17cabf(0x1ab)](_0x17cabf(0x1c0),JSON[_0x17cabf(0x1a9)](messages)),renderMessages();},modal[_0x2526f0(0x184)][_0x2526f0(0x1f2)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0xadf2f6=a0_0x3ba1ab;if(!messages[_0xadf2f6(0x17a)])return;if(mTitle)mTitle[_0xadf2f6(0x188)]=_0xadf2f6(0x1ac);if(mText)mText[_0xadf2f6(0x188)]=_0xadf2f6(0x1aa);modalCallback=async()=>{const _0x5d6a23=_0xadf2f6;messages=[],localStorage[_0x5d6a23(0x1b6)](_0x5d6a23(0x1c0)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0xadf2f6(0x1f2)](_0xadf2f6(0x1a3));};document[a0_0x3ba1ab(0x194)](a0_0x3ba1ab(0x1d8))[a0_0x3ba1ab(0x1ad)]=()=>modal['classList'][a0_0x3ba1ab(0x1dc)]('show'),document[a0_0x3ba1ab(0x194)](a0_0x3ba1ab(0x1ca))['onclick']=()=>{const _0x5ebae0=a0_0x3ba1ab;if(modalCallback)modalCallback();modal['classList'][_0x5ebae0(0x1dc)]('show');},messageInput[a0_0x3ba1ab(0x1a2)](a0_0x3ba1ab(0x1d1),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3ba1ab(0x1a2)]('keydown',_0x585475=>{const _0x19dfaf=a0_0x3ba1ab;_0x585475[_0x19dfaf(0x1d5)]===_0x19dfaf(0x1e4)&&!_0x585475['shiftKey']&&(_0x585475['preventDefault'](),sendMessage());}),sendBtn[a0_0x3ba1ab(0x1ad)]=sendMessage,document[a0_0x3ba1ab(0x1a2)](a0_0x3ba1ab(0x1ed),_0x12c195=>{const _0x1b42e0=a0_0x3ba1ab;document[_0x1b42e0(0x189)](_0x1b42e0(0x1da))[_0x1b42e0(0x19d)](_0x55d389=>{const _0xa4dc95=_0x1b42e0;if(!_0x55d389[_0xa4dc95(0x1b9)](_0x12c195[_0xa4dc95(0x19f)]))_0x55d389[_0xa4dc95(0x184)]['remove'](_0xa4dc95(0x17b));});});const saved=localStorage[a0_0x3ba1ab(0x183)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x3ba1ab(0x1cf)](saved),renderMessages();}catch(a0_0x5809d9){}updateSendButton();