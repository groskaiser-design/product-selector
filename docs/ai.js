const a0_0x4fa442=a0_0x299b;(function(_0x588b8a,_0x259fab){const _0x1c385a=a0_0x299b,_0x1221c2=_0x588b8a();while(!![]){try{const _0x1529ff=-parseInt(_0x1c385a(0x1ab))/0x1*(parseInt(_0x1c385a(0x19a))/0x2)+parseInt(_0x1c385a(0x1c6))/0x3*(parseInt(_0x1c385a(0x1e8))/0x4)+-parseInt(_0x1c385a(0x1d7))/0x5+-parseInt(_0x1c385a(0x198))/0x6+-parseInt(_0x1c385a(0x17b))/0x7*(-parseInt(_0x1c385a(0x170))/0x8)+-parseInt(_0x1c385a(0x187))/0x9+parseInt(_0x1c385a(0x1ea))/0xa;if(_0x1529ff===_0x259fab)break;else _0x1221c2['push'](_0x1221c2['shift']());}catch(_0x735fb4){_0x1221c2['push'](_0x1221c2['shift']());}}}(a0_0x59e4,0xb9897));const tg=window[a0_0x4fa442(0x19b)]?.[a0_0x4fa442(0x1c3)],HOME_URL=a0_0x4fa442(0x1bd);function setupTelegramBackButton(){const _0xca0fc2=a0_0x4fa442;if(!tg)return;try{tg[_0xca0fc2(0x1b5)](),tg['expand'](),tg[_0xca0fc2(0x175)]?.(_0xca0fc2(0x1a7));if(tg[_0xca0fc2(0x1de)]?.(_0xca0fc2(0x1df)))tg[_0xca0fc2(0x1c5)]?.();const _0x52d37e=tg[_0xca0fc2(0x1d9)];if(_0x52d37e){_0x52d37e[_0xca0fc2(0x199)]();if(typeof _0x52d37e[_0xca0fc2(0x1ce)]==='function')try{_0x52d37e[_0xca0fc2(0x1ce)]();}catch(_0x3a540a){}_0x52d37e[_0xca0fc2(0x1b6)](()=>{const _0x895cec=_0xca0fc2;if(tg[_0x895cec(0x178)])tg['HapticFeedback']['impactOccurred'](_0x895cec(0x1c8));location['href']=HOME_URL;});}}catch(_0x4e4141){console['warn']('TG\x20setup\x20error:',_0x4e4141);}}(function initStableLayout(){const _0xaf96aa=a0_0x4fa442,_0x43fc05=(function(){let _0x508a8a=!![];return function(_0x335448,_0x447346){const _0x53886f=_0x508a8a?function(){const _0x14a0ec=a0_0x299b;if(_0x447346){const _0x49fd73=_0x447346[_0x14a0ec(0x1b3)](_0x335448,arguments);return _0x447346=null,_0x49fd73;}}:function(){};return _0x508a8a=![],_0x53886f;};}()),_0x3b94a0=document['querySelector']('.container'),_0x5ab378=document[_0xaf96aa(0x1d0)](_0xaf96aa(0x1bc)),_0x2b716c=document[_0xaf96aa(0x1d0)](_0xaf96aa(0x1af)),_0x582571=document[_0xaf96aa(0x1d0)](_0xaf96aa(0x183));function _0x2c13d4(){const _0xf8ca33=_0xaf96aa,_0x5dd7e6=_0x43fc05(this,function(){const _0x4c3c86=a0_0x299b;return _0x5dd7e6['toString']()[_0x4c3c86(0x1e3)](_0x4c3c86(0x16c))[_0x4c3c86(0x1c9)]()[_0x4c3c86(0x173)](_0x5dd7e6)[_0x4c3c86(0x1e3)](_0x4c3c86(0x16c));});_0x5dd7e6();if(!_0x3b94a0)return;const _0x5732f3=tg&&tg[_0xf8ca33(0x1ca)]?tg[_0xf8ca33(0x1ca)]:window[_0xf8ca33(0x1cc)];_0x3b94a0[_0xf8ca33(0x171)]['height']=_0x5732f3+'px';if(_0x5ab378){const _0x54e403=_0x5ab378[_0xf8ca33(0x1c1)];_0x2b716c[_0xf8ca33(0x171)][_0xf8ca33(0x189)]=_0x54e403+0x28+'px';}}tg?tg[_0xaf96aa(0x174)](_0xaf96aa(0x1e0),({isStateStable:_0x203c7e})=>{_0x2c13d4();if(_0x203c7e)requestAnimationFrame(()=>{const _0x43dd0c=a0_0x299b;_0x2b716c['scrollTop']=_0x2b716c[_0x43dd0c(0x19c)];});}):window[_0xaf96aa(0x1e4)](_0xaf96aa(0x1c0),_0x2c13d4),_0x2c13d4(),_0x582571&&(_0x582571[_0xaf96aa(0x1e4)](_0xaf96aa(0x196),()=>{requestAnimationFrame(_0x2c13d4);}),_0x582571[_0xaf96aa(0x1e4)](_0xaf96aa(0x192),()=>{setTimeout(()=>{const _0x174ce8=a0_0x299b;_0x2b716c[_0x174ce8(0x1da)]=_0x2b716c[_0x174ce8(0x19c)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4fa442(0x1e9),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4fa442(0x1d0)](a0_0x4fa442(0x1af)),emptyState=document['getElementById'](a0_0x4fa442(0x18c)),messageInput=document[a0_0x4fa442(0x1d0)](a0_0x4fa442(0x183)),sendBtn=document[a0_0x4fa442(0x1d0)](a0_0x4fa442(0x1aa)),clearBtn=document['getElementById'](a0_0x4fa442(0x1e7)),modal=document[a0_0x4fa442(0x1d0)](a0_0x4fa442(0x176)),mTitle=document[a0_0x4fa442(0x1d0)]('modalTitle'),mText=document[a0_0x4fa442(0x1d0)](a0_0x4fa442(0x1b8));let modalCallback=null;async function callBackend(_0x25ef2e,_0x2c57fe){const _0x4104d9=a0_0x4fa442,_0x25d0a6=tg?.[_0x4104d9(0x18d)]?.['user']||{},_0x5c73bb=_0x25d0a6['id']||localStorage[_0x4104d9(0x1a3)]('debug_uid')||'d-'+Math[_0x4104d9(0x16f)](Math[_0x4104d9(0x1d3)]()*0x3b9aca00);if(!_0x25d0a6['id'])localStorage['setItem'](_0x4104d9(0x1e1),_0x5c73bb);const _0x1f1939={'action':_0x25ef2e,'user_id':_0x5c73bb,'user_data':{'first_name':_0x25d0a6[_0x4104d9(0x17d)],'username':_0x25d0a6['username']},'init_data':tg?.[_0x4104d9(0x1a5)]||'',..._0x2c57fe},_0x115276=new AbortController(),_0x52f1a0=setTimeout(()=>_0x115276[_0x4104d9(0x1c4)](),REQUEST_TIMEOUT_MS);try{const _0x3a4566=await fetch(BACKEND_URL,{'method':_0x4104d9(0x181),'headers':{'Content-Type':_0x4104d9(0x17f)},'body':JSON[_0x4104d9(0x1d8)](_0x1f1939),'signal':_0x115276[_0x4104d9(0x18e)]});return clearTimeout(_0x52f1a0),await _0x3a4566[_0x4104d9(0x19d)]();}catch(_0x1051fa){return{'success':![],'error':String(_0x1051fa)};}}function a0_0x299b(_0x3c47dc,_0x220746){_0x3c47dc=_0x3c47dc-0x16b;const _0x2773fe=a0_0x59e4();let _0x125f8a=_0x2773fe[_0x3c47dc];return _0x125f8a;}function formatTime(_0x3724ce){const _0x327349=a0_0x4fa442,_0x3bbefa=new Date(_0x3724ce);return String(_0x3bbefa[_0x327349(0x19f)]())[_0x327349(0x1ad)](0x2,'0')+':'+String(_0x3bbefa[_0x327349(0x1ba)]())[_0x327349(0x1ad)](0x2,'0');}function createMessageElement(_0x20a484,_0xabde8a){const _0x2458c5=a0_0x4fa442,_0x5f5633=document[_0x2458c5(0x1e5)](_0x2458c5(0x194));_0x5f5633[_0x2458c5(0x1a8)]='message\x20'+_0x20a484[_0x2458c5(0x16d)];const _0x4a4868=document[_0x2458c5(0x1e5)]('div');_0x4a4868[_0x2458c5(0x1a8)]=_0x2458c5(0x1b0),_0x4a4868[_0x2458c5(0x185)]=_0x20a484['content'][_0x2458c5(0x1b1)](/\n/g,_0x2458c5(0x18b));const _0x3d1425=document[_0x2458c5(0x1e5)]('div');_0x3d1425[_0x2458c5(0x1a8)]=_0x2458c5(0x179),_0x3d1425['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x3d1425[_0x2458c5(0x1db)]=_0x4e127d=>{const _0x14ba1d=_0x2458c5;_0x4e127d[_0x14ba1d(0x195)](),confirmDelete(_0xabde8a);};let _0x162d7d;_0x4a4868['addEventListener'](_0x2458c5(0x1b2),()=>_0x162d7d=setTimeout(()=>{const _0x32b96d=_0x2458c5;_0x5f5633[_0x32b96d(0x1dc)][_0x32b96d(0x1eb)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x32b96d(0x178)][_0x32b96d(0x1cf)](_0x32b96d(0x180));},0x1f4)),_0x4a4868[_0x2458c5(0x1e4)](_0x2458c5(0x1ae),()=>clearTimeout(_0x162d7d));const _0x37c6f7=document['createElement']('div');return _0x37c6f7[_0x2458c5(0x1a8)]=_0x2458c5(0x1bf),_0x37c6f7[_0x2458c5(0x1bb)]=formatTime(_0x20a484[_0x2458c5(0x1d4)]),_0x5f5633[_0x2458c5(0x172)](_0x3d1425),_0x5f5633[_0x2458c5(0x172)](_0x4a4868),_0x5f5633[_0x2458c5(0x172)](_0x37c6f7),_0x5f5633;}function createTypingIndicator(){const _0x5d1f5f=a0_0x4fa442,_0x99b280=document[_0x5d1f5f(0x1e5)](_0x5d1f5f(0x194));return _0x99b280['className']=_0x5d1f5f(0x1e6),_0x99b280['id']=_0x5d1f5f(0x1a2),_0x99b280[_0x5d1f5f(0x185)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x99b280;}function renderMessages(){const _0x4c838d=a0_0x4fa442;Array[_0x4c838d(0x191)](chatArea[_0x4c838d(0x1ac)])[_0x4c838d(0x18f)](_0x2f1d36=>{const _0x305dd6=_0x4c838d;if(_0x2f1d36['id']!==_0x305dd6(0x18c))_0x2f1d36[_0x305dd6(0x1c2)]();}),messages[_0x4c838d(0x1c7)]>0x0?(emptyState[_0x4c838d(0x171)][_0x4c838d(0x1cd)]=_0x4c838d(0x1d2),messages['forEach']((_0x3b0508,_0x4eb8a5)=>chatArea[_0x4c838d(0x172)](createMessageElement(_0x3b0508,_0x4eb8a5)))):emptyState[_0x4c838d(0x171)]['display']='flex',requestAnimationFrame(()=>chatArea[_0x4c838d(0x1da)]=chatArea[_0x4c838d(0x19c)]);}function autoResizeTextarea(){const _0x303b5a=a0_0x4fa442;messageInput[_0x303b5a(0x171)][_0x303b5a(0x184)]=_0x303b5a(0x182),messageInput[_0x303b5a(0x171)][_0x303b5a(0x184)]=Math[_0x303b5a(0x17a)](messageInput[_0x303b5a(0x19c)],0x78)+'px';}function updateSendButton(){const _0x4a1645=a0_0x4fa442,_0x471f19=messageInput[_0x4a1645(0x1a1)][_0x4a1645(0x17c)]();sendBtn[_0x4a1645(0x1dd)]=!_0x471f19||isTyping;}async function sendMessage(){const _0x259ccb=a0_0x4fa442,_0x5857e5=messageInput['value'][_0x259ccb(0x17c)]();if(!_0x5857e5||isTyping)return;if(tg?.[_0x259ccb(0x178)])tg[_0x259ccb(0x178)][_0x259ccb(0x1cf)]('light');messages[_0x259ccb(0x1d5)]({'role':'user','content':_0x5857e5,'timestamp':Date[_0x259ccb(0x193)]()}),localStorage['setItem'](_0x259ccb(0x190),JSON[_0x259ccb(0x1d8)](messages)),renderMessages(),messageInput[_0x259ccb(0x1a1)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x259ccb(0x172)](createTypingIndicator()),chatArea[_0x259ccb(0x1da)]=chatArea[_0x259ccb(0x19c)];const _0x32a7d1=await callBackend(_0x259ccb(0x16b),{'message':_0x5857e5});isTyping=![];const _0x22afe9=document['getElementById'](_0x259ccb(0x1a2));if(_0x22afe9)_0x22afe9[_0x259ccb(0x1c2)]();let _0x2aa364='Ошибка\x20сети';if(_0x32a7d1['success']){_0x2aa364=_0x32a7d1['text']||_0x259ccb(0x1a4);if(tg?.[_0x259ccb(0x178)])tg[_0x259ccb(0x178)][_0x259ccb(0x1d6)](_0x259ccb(0x1b7));}else{_0x2aa364=_0x32a7d1[_0x259ccb(0x19e)]||_0x259ccb(0x1be);if(tg?.[_0x259ccb(0x178)])tg[_0x259ccb(0x178)]['notificationOccurred']('error');}messages['push']({'role':'ai','content':_0x2aa364,'timestamp':Date[_0x259ccb(0x193)]()}),localStorage['setItem'](_0x259ccb(0x190),JSON[_0x259ccb(0x1d8)](messages)),renderMessages();}function confirmDelete(_0xe8a025){const _0x1c2f2e=a0_0x4fa442;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x1c2f2e(0x1bb)]=_0x1c2f2e(0x186);modalCallback=()=>{const _0x4c9f2d=_0x1c2f2e;messages['splice'](_0xe8a025,0x1),localStorage[_0x4c9f2d(0x1e2)](_0x4c9f2d(0x190),JSON[_0x4c9f2d(0x1d8)](messages)),renderMessages();},modal['classList'][_0x1c2f2e(0x1eb)]('show');}if(clearBtn)clearBtn[a0_0x4fa442(0x1db)]=()=>{const _0x5c9e82=a0_0x4fa442;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x5c9e82(0x1a0);if(mText)mText[_0x5c9e82(0x1bb)]=_0x5c9e82(0x1a9);modalCallback=async()=>{const _0xfdf8b3=_0x5c9e82;messages=[],localStorage[_0xfdf8b3(0x18a)](_0xfdf8b3(0x190)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x5c9e82(0x1eb)](_0x5c9e82(0x199));};function a0_0x59e4(){const _0x3ac03c=['resize','offsetHeight','remove','WebApp','abort','disableVerticalSwipes','2663532KfOXgE','length','light','toString','viewportHeight','shiftKey','innerHeight','display','offClick','impactOccurred','getElementById','modalCancel','none','random','timestamp','push','notificationOccurred','5013670ENwLLN','stringify','BackButton','scrollTop','onclick','classList','disabled','isVersionAtLeast','6.1','viewportChanged','debug_uid','setItem','search','addEventListener','createElement','message\x20ai','clearBtn','4tzZbrE','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','15638220mrFwio','add','send_message','(((.+)+)+)+$','role','contains','floor','1272wxwKPR','style','appendChild','constructor','onEvent','setHeaderColor','confirmModal','querySelectorAll','HapticFeedback','delete-btn','min','49644oySzoM','trim','first_name','click','text/plain','medium','POST','auto','messageInput','height','innerHTML','Действие\x20необратимо.','12296682gTxxTK','show-delete','paddingBottom','removeItem','<br>','emptyState','initDataUnsafe','signal','forEach','ai_chat_messages','from','focus','now','div','stopPropagation','input','parse','306318DMLsAK','show','79850VoyPSS','Telegram','scrollHeight','json','error','getHours','Очистить\x20историю?','value','typingIndicator','getItem','Пустой\x20ответ','initData','key','#050505','className','Начнется\x20новый\x20диалог.','sendBtn','10TZXzBr','children','padStart','touchend','chatArea','message-bubble','replace','touchstart','apply','Enter','ready','onClick','success','modalText','target','getMinutes','textContent','inputArea','./router.html','Ошибка\x20сервера','message-time'];a0_0x59e4=function(){return _0x3ac03c;};return a0_0x59e4();}document[a0_0x4fa442(0x1d0)](a0_0x4fa442(0x1d1))[a0_0x4fa442(0x1db)]=()=>modal['classList'][a0_0x4fa442(0x1c2)]('show'),document[a0_0x4fa442(0x1d0)]('modalConfirm')['onclick']=()=>{const _0x4b5bf7=a0_0x4fa442;if(modalCallback)modalCallback();modal[_0x4b5bf7(0x1dc)][_0x4b5bf7(0x1c2)](_0x4b5bf7(0x199));},messageInput[a0_0x4fa442(0x1e4)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x3b7d9e=>{const _0x597381=a0_0x4fa442;_0x3b7d9e[_0x597381(0x1a6)]===_0x597381(0x1b4)&&!_0x3b7d9e[_0x597381(0x1cb)]&&(_0x3b7d9e['preventDefault'](),sendMessage());}),sendBtn[a0_0x4fa442(0x1db)]=sendMessage,document[a0_0x4fa442(0x1e4)](a0_0x4fa442(0x17e),_0x39546b=>{const _0x2c7ee3=a0_0x4fa442;document[_0x2c7ee3(0x177)]('.message.show-delete')[_0x2c7ee3(0x18f)](_0x2e3c28=>{const _0xa43442=_0x2c7ee3;if(!_0x2e3c28[_0xa43442(0x16e)](_0x39546b[_0xa43442(0x1b9)]))_0x2e3c28['classList'][_0xa43442(0x1c2)](_0xa43442(0x188));});});const saved=localStorage[a0_0x4fa442(0x1a3)](a0_0x4fa442(0x190));if(saved)try{messages=JSON[a0_0x4fa442(0x197)](saved),renderMessages();}catch(a0_0x1e81ff){}updateSendButton();