const a0_0x414292=a0_0x4ad2;(function(_0xdee1f0,_0x4d9e09){const _0x11bfac=a0_0x4ad2,_0x58a9a4=_0xdee1f0();while(!![]){try{const _0x18725f=-parseInt(_0x11bfac(0x14d))/0x1*(-parseInt(_0x11bfac(0x152))/0x2)+-parseInt(_0x11bfac(0x167))/0x3*(parseInt(_0x11bfac(0x13f))/0x4)+parseInt(_0x11bfac(0x11d))/0x5+-parseInt(_0x11bfac(0x164))/0x6*(-parseInt(_0x11bfac(0x125))/0x7)+-parseInt(_0x11bfac(0x16a))/0x8+parseInt(_0x11bfac(0x158))/0x9*(parseInt(_0x11bfac(0x13d))/0xa)+-parseInt(_0x11bfac(0x182))/0xb*(-parseInt(_0x11bfac(0x147))/0xc);if(_0x18725f===_0x4d9e09)break;else _0x58a9a4['push'](_0x58a9a4['shift']());}catch(_0x19b938){_0x58a9a4['push'](_0x58a9a4['shift']());}}}(a0_0x2378,0xa7e2e));const tg=window[a0_0x414292(0x14b)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x562d21=a0_0x414292,_0x584008=(function(){let _0x243d78=!![];return function(_0x2c923c,_0x2fe556){const _0x2c0c04=_0x243d78?function(){const _0x2be498=a0_0x4ad2;if(_0x2fe556){const _0x29a195=_0x2fe556[_0x2be498(0x18b)](_0x2c923c,arguments);return _0x2fe556=null,_0x29a195;}}:function(){};return _0x243d78=![],_0x2c0c04;};}()),_0x52b4c7=_0x584008(this,function(){const _0x4bf90e=a0_0x4ad2;return _0x52b4c7[_0x4bf90e(0x11b)]()[_0x4bf90e(0x11c)](_0x4bf90e(0x18f))[_0x4bf90e(0x11b)]()[_0x4bf90e(0x14e)](_0x52b4c7)[_0x4bf90e(0x11c)](_0x4bf90e(0x18f));});_0x52b4c7();if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x562d21(0x15e)]?.(_0x562d21(0x155));if(tg[_0x562d21(0x179)]?.(_0x562d21(0x12b)))tg[_0x562d21(0x18a)]?.();const _0xa1479=tg[_0x562d21(0x171)];if(_0xa1479){_0xa1479['show']();if(typeof _0xa1479[_0x562d21(0x17b)]===_0x562d21(0x121))try{_0xa1479[_0x562d21(0x17b)]();}catch(_0x29859a){}_0xa1479['onClick'](()=>{const _0x884557=_0x562d21;if(tg[_0x884557(0x178)])tg['HapticFeedback']['impactOccurred'](_0x884557(0x195));location[_0x884557(0x14a)]=HOME_URL;});}}catch(_0x4e3c77){console['warn'](_0x562d21(0x192),_0x4e3c77);}}(function initStableLayout(){const _0x292809=a0_0x414292,_0x2aeffb=document[_0x292809(0x177)](_0x292809(0x130)),_0x51b224=document[_0x292809(0x16f)](_0x292809(0x18e)),_0x2d8b90=document['getElementById'](_0x292809(0x14c)),_0x381fcf=document['getElementById'](_0x292809(0x189));function _0x375a83(){const _0x291b50=_0x292809;if(!_0x2aeffb)return;const _0x2bf29c=tg&&tg[_0x291b50(0x181)]?tg['viewportHeight']:window[_0x291b50(0x186)];_0x2aeffb[_0x291b50(0x157)][_0x291b50(0x141)]=_0x2bf29c+'px';if(_0x51b224){const _0x40c41d=_0x51b224[_0x291b50(0x196)];_0x2d8b90['style'][_0x291b50(0x16e)]=_0x40c41d+0x28+'px';}}tg?tg[_0x292809(0x166)]('viewportChanged',({isStateStable:_0x24a7aa})=>{_0x375a83();if(_0x24a7aa)requestAnimationFrame(()=>{const _0x19e015=a0_0x4ad2;_0x2d8b90[_0x19e015(0x16d)]=_0x2d8b90[_0x19e015(0x183)];});}):window[_0x292809(0x12a)](_0x292809(0x135),_0x375a83),_0x375a83(),_0x381fcf&&(_0x381fcf[_0x292809(0x12a)](_0x292809(0x160),()=>{requestAnimationFrame(_0x375a83);}),_0x381fcf['addEventListener'](_0x292809(0x13b),()=>{setTimeout(()=>{const _0x13b16e=a0_0x4ad2;_0x2d8b90[_0x13b16e(0x16d)]=_0x2d8b90[_0x13b16e(0x183)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x414292(0x153),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x414292(0x16f)]('chatArea'),emptyState=document['getElementById'](a0_0x414292(0x148)),messageInput=document[a0_0x414292(0x16f)]('messageInput'),sendBtn=document[a0_0x414292(0x16f)](a0_0x414292(0x165)),clearBtn=document[a0_0x414292(0x16f)](a0_0x414292(0x159)),modal=document[a0_0x414292(0x16f)](a0_0x414292(0x169)),mTitle=document['getElementById'](a0_0x414292(0x174)),mText=document['getElementById'](a0_0x414292(0x193));let modalCallback=null;async function callBackend(_0x1e6e8d,_0xb0bf97){const _0x5cdb24=a0_0x414292,_0x162a18=tg?.[_0x5cdb24(0x16c)]?.[_0x5cdb24(0x12d)]||{},_0x253217=_0x162a18['id']||localStorage[_0x5cdb24(0x15a)](_0x5cdb24(0x17c))||'d-'+Math['floor'](Math[_0x5cdb24(0x132)]()*0x3b9aca00);if(!_0x162a18['id'])localStorage[_0x5cdb24(0x129)]('debug_uid',_0x253217);const _0x13b1e6={'action':_0x1e6e8d,'user_id':_0x253217,'user_data':{'first_name':_0x162a18['first_name'],'username':_0x162a18['username']},'init_data':tg?.['initData']||'',..._0xb0bf97},_0x9a9d80=new AbortController(),_0x59d951=setTimeout(()=>_0x9a9d80[_0x5cdb24(0x134)](),REQUEST_TIMEOUT_MS);try{const _0x430642=await fetch(BACKEND_URL,{'method':_0x5cdb24(0x17a),'headers':{'Content-Type':_0x5cdb24(0x127)},'body':JSON[_0x5cdb24(0x118)](_0x13b1e6),'signal':_0x9a9d80[_0x5cdb24(0x15f)]});return clearTimeout(_0x59d951),await _0x430642[_0x5cdb24(0x18d)]();}catch(_0x4959cc){return{'success':![],'error':String(_0x4959cc)};}}function formatTime(_0x556044){const _0xffaa88=a0_0x414292,_0x33564d=new Date(_0x556044);return String(_0x33564d[_0xffaa88(0x190)]())[_0xffaa88(0x145)](0x2,'0')+':'+String(_0x33564d['getMinutes']())[_0xffaa88(0x145)](0x2,'0');}function createMessageElement(_0x4a0b46,_0x170ca4){const _0x439fd1=a0_0x414292,_0x35cccf=document[_0x439fd1(0x137)](_0x439fd1(0x15c));_0x35cccf[_0x439fd1(0x156)]='message\x20'+_0x4a0b46['role'];const _0x19e25b=document['createElement'](_0x439fd1(0x15c));_0x19e25b['className']=_0x439fd1(0x17f),_0x19e25b['innerHTML']=_0x4a0b46['content'][_0x439fd1(0x11a)](/\n/g,_0x439fd1(0x13e));const _0xabfab8=document[_0x439fd1(0x137)](_0x439fd1(0x15c));_0xabfab8[_0x439fd1(0x156)]=_0x439fd1(0x173),_0xabfab8[_0x439fd1(0x151)]=_0x439fd1(0x185),_0xabfab8[_0x439fd1(0x126)]=_0x4cea5f=>{const _0x50a11e=_0x439fd1;_0x4cea5f[_0x50a11e(0x15b)](),confirmDelete(_0x170ca4);};let _0x214a35;_0x19e25b[_0x439fd1(0x12a)](_0x439fd1(0x119),()=>_0x214a35=setTimeout(()=>{const _0x2c9c4d=_0x439fd1;_0x35cccf[_0x2c9c4d(0x170)][_0x2c9c4d(0x138)](_0x2c9c4d(0x180));if(tg?.[_0x2c9c4d(0x178)])tg['HapticFeedback'][_0x2c9c4d(0x128)]('medium');},0x1f4)),_0x19e25b[_0x439fd1(0x12a)](_0x439fd1(0x143),()=>clearTimeout(_0x214a35));const _0x4bded6=document[_0x439fd1(0x137)](_0x439fd1(0x15c));return _0x4bded6['className']=_0x439fd1(0x15d),_0x4bded6[_0x439fd1(0x149)]=formatTime(_0x4a0b46['timestamp']),_0x35cccf['appendChild'](_0xabfab8),_0x35cccf['appendChild'](_0x19e25b),_0x35cccf[_0x439fd1(0x168)](_0x4bded6),_0x35cccf;}function createTypingIndicator(){const _0x2390d7=a0_0x414292,_0x48c910=document[_0x2390d7(0x137)](_0x2390d7(0x15c));return _0x48c910['className']=_0x2390d7(0x123),_0x48c910['id']='typingIndicator',_0x48c910[_0x2390d7(0x151)]=_0x2390d7(0x18c),_0x48c910;}function renderMessages(){const _0x23d363=a0_0x414292;Array[_0x23d363(0x139)](chatArea[_0x23d363(0x197)])[_0x23d363(0x124)](_0x4c3c3e=>{const _0xf457cd=_0x23d363;if(_0x4c3c3e['id']!==_0xf457cd(0x148))_0x4c3c3e['remove']();}),messages['length']>0x0?(emptyState[_0x23d363(0x157)][_0x23d363(0x144)]=_0x23d363(0x172),messages[_0x23d363(0x124)]((_0x55b3d1,_0x17f696)=>chatArea[_0x23d363(0x168)](createMessageElement(_0x55b3d1,_0x17f696)))):emptyState[_0x23d363(0x157)][_0x23d363(0x144)]=_0x23d363(0x131),requestAnimationFrame(()=>chatArea[_0x23d363(0x16d)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x140cdd=a0_0x414292;messageInput['style'][_0x140cdd(0x141)]=_0x140cdd(0x17e),messageInput[_0x140cdd(0x157)][_0x140cdd(0x141)]=Math[_0x140cdd(0x176)](messageInput[_0x140cdd(0x183)],0x78)+'px';}function updateSendButton(){const _0x18e2f9=a0_0x414292,_0x533078=messageInput['value'][_0x18e2f9(0x162)]();sendBtn[_0x18e2f9(0x150)]=!_0x533078||isTyping;}async function sendMessage(){const _0x110c62=a0_0x414292,_0x41e112=messageInput[_0x110c62(0x16b)]['trim']();if(!_0x41e112||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x110c62(0x178)][_0x110c62(0x128)](_0x110c62(0x195));messages[_0x110c62(0x146)]({'role':_0x110c62(0x12d),'content':_0x41e112,'timestamp':Date[_0x110c62(0x194)]()}),localStorage[_0x110c62(0x129)](_0x110c62(0x12c),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x110c62(0x183)];const _0x5ae471=await callBackend(_0x110c62(0x17d),{'message':_0x41e112});isTyping=![];const _0x5d4bdb=document[_0x110c62(0x16f)](_0x110c62(0x163));if(_0x5d4bdb)_0x5d4bdb['remove']();let _0x138b5c=_0x110c62(0x12f);if(_0x5ae471[_0x110c62(0x11e)]){_0x138b5c=_0x5ae471['text']||'Пустой\x20ответ';if(tg?.[_0x110c62(0x178)])tg[_0x110c62(0x178)][_0x110c62(0x13c)](_0x110c62(0x11e));}else{_0x138b5c=_0x5ae471[_0x110c62(0x122)]||'Ошибка\x20сервера';if(tg?.[_0x110c62(0x178)])tg[_0x110c62(0x178)][_0x110c62(0x13c)](_0x110c62(0x122));}messages[_0x110c62(0x146)]({'role':'ai','content':_0x138b5c,'timestamp':Date[_0x110c62(0x194)]()}),localStorage[_0x110c62(0x129)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x133eac){const _0x50d646=a0_0x414292;if(mTitle)mTitle[_0x50d646(0x149)]=_0x50d646(0x175);if(mText)mText[_0x50d646(0x149)]=_0x50d646(0x14f);modalCallback=()=>{const _0x2ecf9c=_0x50d646;messages[_0x2ecf9c(0x12e)](_0x133eac,0x1),localStorage[_0x2ecf9c(0x129)]('ai_chat_messages',JSON[_0x2ecf9c(0x118)](messages)),renderMessages();},modal[_0x50d646(0x170)][_0x50d646(0x138)](_0x50d646(0x11f));}if(clearBtn)clearBtn[a0_0x414292(0x126)]=()=>{const _0x1cd1bc=a0_0x414292;if(!messages[_0x1cd1bc(0x142)])return;if(mTitle)mTitle[_0x1cd1bc(0x149)]=_0x1cd1bc(0x154);if(mText)mText['textContent']=_0x1cd1bc(0x188);modalCallback=async()=>{const _0x23bc3e=_0x1cd1bc;messages=[],localStorage['removeItem'](_0x23bc3e(0x12c)),renderMessages(),callBackend(_0x23bc3e(0x13a),{});},modal[_0x1cd1bc(0x170)]['add']('show');};function a0_0x2378(){const _0x316586=['addEventListener','6.1','ai_chat_messages','user','splice','Ошибка\x20сети','.container','flex','random','remove','abort','resize','target','createElement','add','from','clear_history','focus','notificationOccurred','60qVZFag','<br>','981668NttdJw','keydown','height','length','touchend','display','padStart','push','5244192SQFSYr','emptyState','textContent','href','Telegram','chatArea','98IGKEzz','constructor','Действие\x20необратимо.','disabled','innerHTML','1754LVVjHo','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Очистить\x20историю?','#050505','className','style','25389zMdQss','clearBtn','getItem','stopPropagation','div','message-time','setHeaderColor','signal','input','modalConfirm','trim','typingIndicator','16632FvLtUq','sendBtn','onEvent','3ckvtSp','appendChild','confirmModal','8284624LGEmro','value','initDataUnsafe','scrollTop','paddingBottom','getElementById','classList','BackButton','none','delete-btn','modalTitle','Удалить?','min','querySelector','HapticFeedback','isVersionAtLeast','POST','offClick','debug_uid','send_message','auto','message-bubble','show-delete','viewportHeight','11efLeRG','scrollHeight','key','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','innerHeight','preventDefault','Начнется\x20новый\x20диалог.','messageInput','disableVerticalSwipes','apply','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','json','inputArea','(((.+)+)+)+$','getHours','click','TG\x20setup\x20error:','modalText','now','light','offsetHeight','children','contains','Enter','stringify','touchstart','replace','toString','search','310865MVFhnh','success','show','querySelectorAll','function','error','message\x20ai','forEach','3451UFiREq','onclick','text/plain','impactOccurred','setItem'];a0_0x2378=function(){return _0x316586;};return a0_0x2378();}document['getElementById']('modalCancel')[a0_0x414292(0x126)]=()=>modal[a0_0x414292(0x170)]['remove'](a0_0x414292(0x11f)),document[a0_0x414292(0x16f)](a0_0x414292(0x161))['onclick']=()=>{const _0xda2c4=a0_0x414292;if(modalCallback)modalCallback();modal[_0xda2c4(0x170)]['remove'](_0xda2c4(0x11f));},messageInput[a0_0x414292(0x12a)](a0_0x414292(0x160),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x414292(0x12a)](a0_0x414292(0x140),_0x377246=>{const _0x3ddd88=a0_0x414292;_0x377246[_0x3ddd88(0x184)]===_0x3ddd88(0x117)&&!_0x377246['shiftKey']&&(_0x377246[_0x3ddd88(0x187)](),sendMessage());}),sendBtn[a0_0x414292(0x126)]=sendMessage,document[a0_0x414292(0x12a)](a0_0x414292(0x191),_0x28de73=>{const _0x3a9287=a0_0x414292;document[_0x3a9287(0x120)]('.message.show-delete')[_0x3a9287(0x124)](_0x4a3418=>{const _0xfdf59c=_0x3a9287;if(!_0x4a3418[_0xfdf59c(0x116)](_0x28de73[_0xfdf59c(0x136)]))_0x4a3418['classList'][_0xfdf59c(0x133)](_0xfdf59c(0x180));});});const saved=localStorage[a0_0x414292(0x15a)](a0_0x414292(0x12c));function a0_0x4ad2(_0x28ed4d,_0x39956e){_0x28ed4d=_0x28ed4d-0x116;const _0x59378b=a0_0x2378();let _0x59d93c=_0x59378b[_0x28ed4d];return _0x59d93c;}if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x11e9ae){}updateSendButton();