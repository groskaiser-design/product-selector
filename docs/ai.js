const a0_0x19e1c5=a0_0x5dc5;(function(_0x55cdbd,_0x56d45a){const _0x532836=a0_0x5dc5,_0x322119=_0x55cdbd();while(!![]){try{const _0x339faf=parseInt(_0x532836(0x1f1))/0x1*(parseInt(_0x532836(0x1ff))/0x2)+parseInt(_0x532836(0x1ed))/0x3*(-parseInt(_0x532836(0x22a))/0x4)+parseInt(_0x532836(0x242))/0x5+parseInt(_0x532836(0x1d1))/0x6*(-parseInt(_0x532836(0x229))/0x7)+parseInt(_0x532836(0x231))/0x8*(-parseInt(_0x532836(0x1e8))/0x9)+parseInt(_0x532836(0x21e))/0xa*(-parseInt(_0x532836(0x228))/0xb)+parseInt(_0x532836(0x22b))/0xc;if(_0x339faf===_0x56d45a)break;else _0x322119['push'](_0x322119['shift']());}catch(_0x16efdc){_0x322119['push'](_0x322119['shift']());}}}(a0_0xb84f,0x57bbb));const tg=window[a0_0x19e1c5(0x218)]?.[a0_0x19e1c5(0x236)],HOME_URL=a0_0x19e1c5(0x1f0);function setupTelegramBackButton(){const _0x3447d9=a0_0x19e1c5,_0x48a53d=(function(){let _0x123539=!![];return function(_0x3c00e7,_0x27d637){const _0x4b7d9b=_0x123539?function(){if(_0x27d637){const _0x180066=_0x27d637['apply'](_0x3c00e7,arguments);return _0x27d637=null,_0x180066;}}:function(){};return _0x123539=![],_0x4b7d9b;};}()),_0x2ea8bf=_0x48a53d(this,function(){const _0x51ddc1=a0_0x5dc5;return _0x2ea8bf[_0x51ddc1(0x233)]()[_0x51ddc1(0x21f)](_0x51ddc1(0x20c))['toString']()['constructor'](_0x2ea8bf)[_0x51ddc1(0x21f)](_0x51ddc1(0x20c));});_0x2ea8bf();if(!tg)return;try{tg[_0x3447d9(0x244)](),tg[_0x3447d9(0x1ec)](),tg[_0x3447d9(0x1f5)]?.(_0x3447d9(0x22c));if(tg[_0x3447d9(0x1eb)]?.(_0x3447d9(0x230)))tg[_0x3447d9(0x1e9)]?.();const _0x594f50=tg[_0x3447d9(0x1fe)];if(_0x594f50){_0x594f50[_0x3447d9(0x1dc)]();if(typeof _0x594f50[_0x3447d9(0x1da)]===_0x3447d9(0x213))try{_0x594f50[_0x3447d9(0x1da)]();}catch(_0x451fce){}_0x594f50[_0x3447d9(0x247)](()=>{const _0x400d72=_0x3447d9;if(tg[_0x400d72(0x240)])tg['HapticFeedback'][_0x400d72(0x24a)]('light');location['href']=HOME_URL;});}}catch(_0x407814){console[_0x3447d9(0x1fc)](_0x3447d9(0x219),_0x407814);}}(function initStableLayout(){const _0xb132a2=a0_0x19e1c5,_0xa43323=document['querySelector'](_0xb132a2(0x220)),_0x5b2e15=document[_0xb132a2(0x1ee)]('inputArea'),_0x4cc78c=document[_0xb132a2(0x1ee)](_0xb132a2(0x215)),_0x4acf5b=document['getElementById']('messageInput');function _0x12db25(){const _0x4ac822=_0xb132a2;if(!_0xa43323)return;const _0x5ee5f7=tg&&tg[_0x4ac822(0x23d)]?tg[_0x4ac822(0x23d)]:window['innerHeight'];_0xa43323['style'][_0x4ac822(0x1de)]=_0x5ee5f7+'px';if(_0x5b2e15){const _0x1e43e3=_0x5b2e15[_0x4ac822(0x200)];_0x4cc78c[_0x4ac822(0x212)]['paddingBottom']=_0x1e43e3+0x28+'px';}}tg?tg[_0xb132a2(0x216)](_0xb132a2(0x21b),({isStateStable:_0x5e3ae2})=>{_0x12db25();if(_0x5e3ae2)requestAnimationFrame(()=>{const _0x5a8ce1=a0_0x5dc5;_0x4cc78c[_0x5a8ce1(0x1d3)]=_0x4cc78c[_0x5a8ce1(0x20f)];});}):window[_0xb132a2(0x23f)](_0xb132a2(0x23c),_0x12db25),_0x12db25(),_0x4acf5b&&(_0x4acf5b[_0xb132a2(0x23f)]('input',()=>{requestAnimationFrame(_0x12db25);}),_0x4acf5b[_0xb132a2(0x23f)](_0xb132a2(0x235),()=>{setTimeout(()=>{const _0x169227=a0_0x5dc5;_0x4cc78c[_0x169227(0x1d3)]=_0x4cc78c[_0x169227(0x20f)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x19e1c5(0x1ef),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0xb84f(){const _0x59ac71=['stringify','target','user','getItem','children','ai_chat_messages','value','keydown','8712LkPdbY','disableVerticalSwipes','innerHTML','isVersionAtLeast','expand','24vQLcNK','getElementById','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','./router.html','1owwKXD','appendChild','delete-btn','splice','setHeaderColor','click','removeItem','add','medium','querySelectorAll','touchstart','warn','from','BackButton','426908RWBkLg','offsetHeight','Пустой\x20ответ','error','message\x20','modalConfirm','display','text','send_message','Очистить\x20историю?','createElement','timestamp','clear_history','(((.+)+)+)+$','push','Удалить?','scrollHeight','textContent','typingIndicator','style','function','text/plain','chatArea','onEvent','Действие\x20необратимо.','Telegram','TG\x20setup\x20error:','padStart','viewportChanged','confirmModal','message-time','126370dTNlnJ','search','.container','remove','debug_uid','initDataUnsafe','success','random','setItem','now','121fEJfsl','3637221hNcilF','304156bvWsVP','16055052QGCxtm','#050505','stopPropagation','modalTitle','signal','6.1','3896QpvKrF','auto','toString','POST','focus','WebApp','flex','Ошибка\x20сети','length','preventDefault','min','resize','viewportHeight','div','addEventListener','HapticFeedback','json','2731590RvNiRK','Ошибка\x20сервера','ready','emptyState','Начнется\x20новый\x20диалог.','onClick','touchend','show-delete','impactOccurred','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','trim','classList','clearBtn','6dzQJPT','contains','scrollTop','onclick','forEach','light','notificationOccurred','replace','shiftKey','offClick','sendBtn','show','className','height','key'];a0_0xb84f=function(){return _0x59ac71;};return a0_0xb84f();}const chatArea=document['getElementById'](a0_0x19e1c5(0x215)),emptyState=document[a0_0x19e1c5(0x1ee)](a0_0x19e1c5(0x245)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x19e1c5(0x1ee)](a0_0x19e1c5(0x1db)),clearBtn=document[a0_0x19e1c5(0x1ee)](a0_0x19e1c5(0x1d0)),modal=document['getElementById'](a0_0x19e1c5(0x21c)),mTitle=document[a0_0x19e1c5(0x1ee)](a0_0x19e1c5(0x22e)),mText=document['getElementById']('modalText');function a0_0x5dc5(_0x1f953c,_0x202c34){_0x1f953c=_0x1f953c-0x1ce;const _0x4bd48c=a0_0xb84f();let _0xa80964=_0x4bd48c[_0x1f953c];return _0xa80964;}let modalCallback=null;async function callBackend(_0x18e13d,_0x110c5b){const _0x5e9914=a0_0x19e1c5,_0x54b129=tg?.[_0x5e9914(0x223)]?.['user']||{},_0x2637b2=_0x54b129['id']||localStorage[_0x5e9914(0x1e3)](_0x5e9914(0x222))||'d-'+Math['floor'](Math[_0x5e9914(0x225)]()*0x3b9aca00);if(!_0x54b129['id'])localStorage[_0x5e9914(0x226)](_0x5e9914(0x222),_0x2637b2);const _0x1d5241={'action':_0x18e13d,'user_id':_0x2637b2,'user_data':{'first_name':_0x54b129['first_name'],'username':_0x54b129['username']},'init_data':tg?.['initData']||'',..._0x110c5b},_0x8bb1ec=new AbortController(),_0x2f209d=setTimeout(()=>_0x8bb1ec['abort'](),REQUEST_TIMEOUT_MS);try{const _0x34f62a=await fetch(BACKEND_URL,{'method':_0x5e9914(0x234),'headers':{'Content-Type':_0x5e9914(0x214)},'body':JSON[_0x5e9914(0x1e0)](_0x1d5241),'signal':_0x8bb1ec[_0x5e9914(0x22f)]});return clearTimeout(_0x2f209d),await _0x34f62a[_0x5e9914(0x241)]();}catch(_0x371062){return{'success':![],'error':String(_0x371062)};}}function formatTime(_0xfe979f){const _0x339c4=a0_0x19e1c5,_0x59a2bc=new Date(_0xfe979f);return String(_0x59a2bc['getHours']())[_0x339c4(0x21a)](0x2,'0')+':'+String(_0x59a2bc['getMinutes']())[_0x339c4(0x21a)](0x2,'0');}function createMessageElement(_0x22f3f2,_0x28ce1f){const _0x337e47=a0_0x19e1c5,_0x5e9248=document[_0x337e47(0x209)]('div');_0x5e9248[_0x337e47(0x1dd)]=_0x337e47(0x203)+_0x22f3f2['role'];const _0xa0dd3d=document['createElement'](_0x337e47(0x23e));_0xa0dd3d[_0x337e47(0x1dd)]='message-bubble',_0xa0dd3d[_0x337e47(0x1ea)]=_0x22f3f2['content'][_0x337e47(0x1d8)](/\n/g,'<br>');const _0x132069=document[_0x337e47(0x209)](_0x337e47(0x23e));_0x132069[_0x337e47(0x1dd)]=_0x337e47(0x1f3),_0x132069[_0x337e47(0x1ea)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x132069[_0x337e47(0x1d4)]=_0x29c4e8=>{const _0x4f4f50=_0x337e47;_0x29c4e8[_0x4f4f50(0x22d)](),confirmDelete(_0x28ce1f);};let _0x2e6d21;_0xa0dd3d[_0x337e47(0x23f)](_0x337e47(0x1fb),()=>_0x2e6d21=setTimeout(()=>{const _0x53e2ce=_0x337e47;_0x5e9248[_0x53e2ce(0x1cf)][_0x53e2ce(0x1f8)](_0x53e2ce(0x249));if(tg?.[_0x53e2ce(0x240)])tg[_0x53e2ce(0x240)][_0x53e2ce(0x24a)](_0x53e2ce(0x1f9));},0x1f4)),_0xa0dd3d[_0x337e47(0x23f)](_0x337e47(0x248),()=>clearTimeout(_0x2e6d21));const _0x199e07=document[_0x337e47(0x209)](_0x337e47(0x23e));return _0x199e07[_0x337e47(0x1dd)]=_0x337e47(0x21d),_0x199e07[_0x337e47(0x210)]=formatTime(_0x22f3f2[_0x337e47(0x20a)]),_0x5e9248[_0x337e47(0x1f2)](_0x132069),_0x5e9248[_0x337e47(0x1f2)](_0xa0dd3d),_0x5e9248[_0x337e47(0x1f2)](_0x199e07),_0x5e9248;}function createTypingIndicator(){const _0x8b1c1=a0_0x19e1c5,_0x28eae3=document[_0x8b1c1(0x209)](_0x8b1c1(0x23e));return _0x28eae3[_0x8b1c1(0x1dd)]='message\x20ai',_0x28eae3['id']=_0x8b1c1(0x211),_0x28eae3[_0x8b1c1(0x1ea)]=_0x8b1c1(0x24b),_0x28eae3;}function renderMessages(){const _0x338354=a0_0x19e1c5;Array[_0x338354(0x1fd)](chatArea[_0x338354(0x1e4)])[_0x338354(0x1d5)](_0x2b92c0=>{const _0x919918=_0x338354;if(_0x2b92c0['id']!==_0x919918(0x245))_0x2b92c0[_0x919918(0x221)]();}),messages[_0x338354(0x239)]>0x0?(emptyState[_0x338354(0x212)][_0x338354(0x205)]='none',messages[_0x338354(0x1d5)]((_0x2131ce,_0x149f96)=>chatArea[_0x338354(0x1f2)](createMessageElement(_0x2131ce,_0x149f96)))):emptyState[_0x338354(0x212)]['display']=_0x338354(0x237),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x338354(0x20f)]);}function autoResizeTextarea(){const _0x3dcde6=a0_0x19e1c5;messageInput[_0x3dcde6(0x212)][_0x3dcde6(0x1de)]=_0x3dcde6(0x232),messageInput[_0x3dcde6(0x212)][_0x3dcde6(0x1de)]=Math[_0x3dcde6(0x23b)](messageInput[_0x3dcde6(0x20f)],0x78)+'px';}function updateSendButton(){const _0x48a6d5=a0_0x19e1c5,_0x2d057a=messageInput['value'][_0x48a6d5(0x1ce)]();sendBtn['disabled']=!_0x2d057a||isTyping;}async function sendMessage(){const _0x40dfe3=a0_0x19e1c5,_0x3ef1ca=messageInput[_0x40dfe3(0x1e6)][_0x40dfe3(0x1ce)]();if(!_0x3ef1ca||isTyping)return;if(tg?.[_0x40dfe3(0x240)])tg[_0x40dfe3(0x240)][_0x40dfe3(0x24a)](_0x40dfe3(0x1d6));messages[_0x40dfe3(0x20d)]({'role':_0x40dfe3(0x1e2),'content':_0x3ef1ca,'timestamp':Date['now']()}),localStorage[_0x40dfe3(0x226)](_0x40dfe3(0x1e5),JSON[_0x40dfe3(0x1e0)](messages)),renderMessages(),messageInput[_0x40dfe3(0x1e6)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x40dfe3(0x1f2)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x1cd8ec=await callBackend(_0x40dfe3(0x207),{'message':_0x3ef1ca});isTyping=![];const _0x29a9fe=document[_0x40dfe3(0x1ee)]('typingIndicator');if(_0x29a9fe)_0x29a9fe['remove']();let _0x58179f=_0x40dfe3(0x238);if(_0x1cd8ec[_0x40dfe3(0x224)]){_0x58179f=_0x1cd8ec[_0x40dfe3(0x206)]||_0x40dfe3(0x201);if(tg?.[_0x40dfe3(0x240)])tg[_0x40dfe3(0x240)][_0x40dfe3(0x1d7)]('success');}else{_0x58179f=_0x1cd8ec[_0x40dfe3(0x202)]||_0x40dfe3(0x243);if(tg?.[_0x40dfe3(0x240)])tg[_0x40dfe3(0x240)]['notificationOccurred'](_0x40dfe3(0x202));}messages[_0x40dfe3(0x20d)]({'role':'ai','content':_0x58179f,'timestamp':Date[_0x40dfe3(0x227)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x40dfe3(0x1e0)](messages)),renderMessages();}function confirmDelete(_0x505d58){const _0x4baa84=a0_0x19e1c5;if(mTitle)mTitle[_0x4baa84(0x210)]=_0x4baa84(0x20e);if(mText)mText[_0x4baa84(0x210)]=_0x4baa84(0x217);modalCallback=()=>{const _0x58e051=_0x4baa84;messages[_0x58e051(0x1f4)](_0x505d58,0x1),localStorage[_0x58e051(0x226)](_0x58e051(0x1e5),JSON[_0x58e051(0x1e0)](messages)),renderMessages();},modal[_0x4baa84(0x1cf)][_0x4baa84(0x1f8)](_0x4baa84(0x1dc));}if(clearBtn)clearBtn['onclick']=()=>{const _0x280558=a0_0x19e1c5;if(!messages[_0x280558(0x239)])return;if(mTitle)mTitle[_0x280558(0x210)]=_0x280558(0x208);if(mText)mText[_0x280558(0x210)]=_0x280558(0x246);modalCallback=async()=>{const _0x2ee165=_0x280558;messages=[],localStorage[_0x2ee165(0x1f7)](_0x2ee165(0x1e5)),renderMessages(),callBackend(_0x2ee165(0x20b),{});},modal['classList']['add']('show');};document['getElementById']('modalCancel')[a0_0x19e1c5(0x1d4)]=()=>modal[a0_0x19e1c5(0x1cf)][a0_0x19e1c5(0x221)]('show'),document[a0_0x19e1c5(0x1ee)](a0_0x19e1c5(0x204))['onclick']=()=>{const _0x2f8922=a0_0x19e1c5;if(modalCallback)modalCallback();modal[_0x2f8922(0x1cf)][_0x2f8922(0x221)](_0x2f8922(0x1dc));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x19e1c5(0x23f)](a0_0x19e1c5(0x1e7),_0x18f9b3=>{const _0x544ce8=a0_0x19e1c5;_0x18f9b3[_0x544ce8(0x1df)]==='Enter'&&!_0x18f9b3[_0x544ce8(0x1d9)]&&(_0x18f9b3[_0x544ce8(0x23a)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x19e1c5(0x23f)](a0_0x19e1c5(0x1f6),_0x325da6=>{const _0x2dd0b6=a0_0x19e1c5;document[_0x2dd0b6(0x1fa)]('.message.show-delete')[_0x2dd0b6(0x1d5)](_0xcaa0b1=>{const _0x31eeae=_0x2dd0b6;if(!_0xcaa0b1[_0x31eeae(0x1d2)](_0x325da6[_0x31eeae(0x1e1)]))_0xcaa0b1[_0x31eeae(0x1cf)]['remove'](_0x31eeae(0x249));});});const saved=localStorage['getItem'](a0_0x19e1c5(0x1e5));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x37a4a9){}updateSendButton();