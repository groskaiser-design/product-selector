const a0_0x22ff5a=a0_0x3b14;(function(_0x145495,_0x2e4b9d){const _0x4bd58f=a0_0x3b14,_0xdc5ac=_0x145495();while(!![]){try{const _0x23c930=-parseInt(_0x4bd58f(0x13c))/0x1*(-parseInt(_0x4bd58f(0x138))/0x2)+parseInt(_0x4bd58f(0x12e))/0x3+-parseInt(_0x4bd58f(0xe6))/0x4+-parseInt(_0x4bd58f(0xd4))/0x5+-parseInt(_0x4bd58f(0x117))/0x6+-parseInt(_0x4bd58f(0xc2))/0x7+parseInt(_0x4bd58f(0x128))/0x8*(parseInt(_0x4bd58f(0xf2))/0x9);if(_0x23c930===_0x2e4b9d)break;else _0xdc5ac['push'](_0xdc5ac['shift']());}catch(_0x8777d4){_0xdc5ac['push'](_0xdc5ac['shift']());}}}(a0_0x48d9,0xde139));const tg=window[a0_0x22ff5a(0x133)]?.[a0_0x22ff5a(0xc9)],HOME_URL=a0_0x22ff5a(0xc3);function setupTelegramBackButton(){const _0x45c600=a0_0x22ff5a,_0x2ae4cc=(function(){let _0x3188cb=!![];return function(_0x57608f,_0x1273b1){const _0x4c1b61=_0x3188cb?function(){const _0x50ef7c=a0_0x3b14;if(_0x1273b1){const _0x128346=_0x1273b1[_0x50ef7c(0xce)](_0x57608f,arguments);return _0x1273b1=null,_0x128346;}}:function(){};return _0x3188cb=![],_0x4c1b61;};}()),_0x5f328f=_0x2ae4cc(this,function(){const _0x46ea4a=a0_0x3b14;return _0x5f328f[_0x46ea4a(0xdd)]()['search']('(((.+)+)+)+$')[_0x46ea4a(0xdd)]()[_0x46ea4a(0x129)](_0x5f328f)[_0x46ea4a(0x118)]('(((.+)+)+)+$');});_0x5f328f();if(!tg)return;try{tg[_0x45c600(0x105)](),tg[_0x45c600(0x130)](),tg[_0x45c600(0x111)]?.(_0x45c600(0x136));if(tg[_0x45c600(0xc1)]?.(_0x45c600(0x13b)))tg[_0x45c600(0x116)]?.();const _0x3b73c2=tg['BackButton'];if(_0x3b73c2){_0x3b73c2[_0x45c600(0xbc)]();if(typeof _0x3b73c2['offClick']===_0x45c600(0xe9))try{_0x3b73c2['offClick']();}catch(_0x40b86d){}_0x3b73c2['onClick'](()=>{const _0x46eb07=_0x45c600;if(tg['HapticFeedback'])tg[_0x46eb07(0x10b)][_0x46eb07(0x119)](_0x46eb07(0x121));location[_0x46eb07(0x112)]=HOME_URL;});}}catch(_0x30b0c0){console['warn'](_0x45c600(0xf4),_0x30b0c0);}}function a0_0x3b14(_0x4a8ef0,_0x2183c4){_0x4a8ef0=_0x4a8ef0-0xba;const _0x302ad9=a0_0x48d9();let _0x1611f1=_0x302ad9[_0x4a8ef0];return _0x1611f1;}(function initStableLayout(){const _0x536676=a0_0x22ff5a,_0x1a867d=document['querySelector'](_0x536676(0xcc)),_0x15b804=document[_0x536676(0x103)]('inputArea'),_0x2fe167=document[_0x536676(0x103)](_0x536676(0xe2)),_0x464907=document[_0x536676(0x103)](_0x536676(0xd3));function _0xde75fb(){const _0x38f785=_0x536676;if(!_0x1a867d)return;const _0x5a6025=tg&&tg[_0x38f785(0xdc)]?tg[_0x38f785(0xdc)]:window[_0x38f785(0x123)];_0x1a867d[_0x38f785(0xe1)][_0x38f785(0x109)]=_0x5a6025+'px';if(_0x15b804){const _0xf5bb67=_0x15b804[_0x38f785(0xbb)];_0x2fe167[_0x38f785(0xe1)][_0x38f785(0x126)]=_0xf5bb67+0x28+'px';}}tg?tg[_0x536676(0x122)]('viewportChanged',({isStateStable:_0x3ff3d0})=>{_0xde75fb();if(_0x3ff3d0)requestAnimationFrame(()=>{const _0x413b0c=a0_0x3b14;_0x2fe167[_0x413b0c(0xf0)]=_0x2fe167['scrollHeight'];});}):window[_0x536676(0xfd)]('resize',_0xde75fb),_0xde75fb(),_0x464907&&(_0x464907[_0x536676(0xfd)](_0x536676(0xe7),()=>{requestAnimationFrame(_0xde75fb);}),_0x464907[_0x536676(0xfd)](_0x536676(0x127),()=>{setTimeout(()=>{const _0x155f94=a0_0x3b14;_0x2fe167['scrollTop']=_0x2fe167[_0x155f94(0x11f)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x22ff5a(0xe2)),emptyState=document[a0_0x22ff5a(0x103)](a0_0x22ff5a(0x137)),messageInput=document[a0_0x22ff5a(0x103)]('messageInput'),sendBtn=document[a0_0x22ff5a(0x103)](a0_0x22ff5a(0xf8)),clearBtn=document[a0_0x22ff5a(0x103)](a0_0x22ff5a(0x139)),modal=document[a0_0x22ff5a(0x103)](a0_0x22ff5a(0xd7)),mTitle=document[a0_0x22ff5a(0x103)](a0_0x22ff5a(0xe5)),mText=document[a0_0x22ff5a(0x103)](a0_0x22ff5a(0xd9));let modalCallback=null;async function callBackend(_0x58b6d2,_0x41af79){const _0x4af85a=a0_0x22ff5a,_0x397098=tg?.[_0x4af85a(0x104)]?.[_0x4af85a(0x11b)]||{},_0x3320ba=_0x397098['id']||localStorage[_0x4af85a(0xd2)](_0x4af85a(0x10e))||'d-'+Math[_0x4af85a(0xed)](Math[_0x4af85a(0x102)]()*0x3b9aca00);if(!_0x397098['id'])localStorage[_0x4af85a(0xf1)](_0x4af85a(0x10e),_0x3320ba);const _0x52f44f={'action':_0x58b6d2,'user_id':_0x3320ba,'user_data':{'first_name':_0x397098[_0x4af85a(0x11d)],'username':_0x397098[_0x4af85a(0x113)]},'init_data':tg?.[_0x4af85a(0x13a)]||'',..._0x41af79},_0x46a16d=new AbortController(),_0xe42cd5=setTimeout(()=>_0x46a16d[_0x4af85a(0xfa)](),REQUEST_TIMEOUT_MS);try{const _0x54a0be=await fetch(BACKEND_URL,{'method':_0x4af85a(0x134),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x4af85a(0xc5)](_0x52f44f),'signal':_0x46a16d[_0x4af85a(0x120)]});return clearTimeout(_0xe42cd5),await _0x54a0be[_0x4af85a(0xdf)]();}catch(_0x59c588){return{'success':![],'error':String(_0x59c588)};}}function formatTime(_0x440c3a){const _0x280136=a0_0x22ff5a,_0xd0f893=new Date(_0x440c3a);return String(_0xd0f893[_0x280136(0xf7)]())[_0x280136(0xf9)](0x2,'0')+':'+String(_0xd0f893[_0x280136(0xc7)]())[_0x280136(0xf9)](0x2,'0');}function createMessageElement(_0x27ecb3,_0x6b70a0){const _0x5d5e6a=a0_0x22ff5a,_0xa8e299=document[_0x5d5e6a(0xd5)](_0x5d5e6a(0x114));_0xa8e299[_0x5d5e6a(0xe4)]=_0x5d5e6a(0x10d)+_0x27ecb3[_0x5d5e6a(0xf6)];const _0x15d1e0=document[_0x5d5e6a(0xd5)](_0x5d5e6a(0x114));_0x15d1e0[_0x5d5e6a(0xe4)]=_0x5d5e6a(0xf5),_0x15d1e0[_0x5d5e6a(0xf3)]=_0x27ecb3[_0x5d5e6a(0x12c)]['replace'](/\n/g,_0x5d5e6a(0x10f));const _0x561bff=document[_0x5d5e6a(0xd5)]('div');_0x561bff[_0x5d5e6a(0xe4)]=_0x5d5e6a(0xfc),_0x561bff[_0x5d5e6a(0xf3)]=_0x5d5e6a(0xc4),_0x561bff[_0x5d5e6a(0x11e)]=_0x38b64f=>{const _0x445e6c=_0x5d5e6a;_0x38b64f[_0x445e6c(0xde)](),confirmDelete(_0x6b70a0);};let _0x157131;_0x15d1e0[_0x5d5e6a(0xfd)](_0x5d5e6a(0x10c),()=>_0x157131=setTimeout(()=>{const _0x27adf8=_0x5d5e6a;_0xa8e299[_0x27adf8(0xe8)][_0x27adf8(0xe3)](_0x27adf8(0x12b));if(tg?.['HapticFeedback'])tg[_0x27adf8(0x10b)]['impactOccurred']('medium');},0x1f4)),_0x15d1e0[_0x5d5e6a(0xfd)](_0x5d5e6a(0x12f),()=>clearTimeout(_0x157131));const _0x3a09e8=document[_0x5d5e6a(0xd5)]('div');return _0x3a09e8[_0x5d5e6a(0xe4)]=_0x5d5e6a(0x11c),_0x3a09e8[_0x5d5e6a(0xd0)]=formatTime(_0x27ecb3['timestamp']),_0xa8e299[_0x5d5e6a(0x115)](_0x561bff),_0xa8e299[_0x5d5e6a(0x115)](_0x15d1e0),_0xa8e299[_0x5d5e6a(0x115)](_0x3a09e8),_0xa8e299;}function createTypingIndicator(){const _0x32eb92=a0_0x22ff5a,_0x41131c=document[_0x32eb92(0xd5)](_0x32eb92(0x114));return _0x41131c['className']='message\x20ai',_0x41131c['id']=_0x32eb92(0x124),_0x41131c[_0x32eb92(0xf3)]=_0x32eb92(0xbe),_0x41131c;}function renderMessages(){const _0x56692e=a0_0x22ff5a;Array['from'](chatArea[_0x56692e(0xbd)])[_0x56692e(0xfb)](_0x2831a9=>{const _0x24351c=_0x56692e;if(_0x2831a9['id']!==_0x24351c(0x137))_0x2831a9['remove']();}),messages[_0x56692e(0xcd)]>0x0?(emptyState[_0x56692e(0xe1)][_0x56692e(0xeb)]=_0x56692e(0xdb),messages[_0x56692e(0xfb)]((_0x5c604d,_0xe18e76)=>chatArea[_0x56692e(0x115)](createMessageElement(_0x5c604d,_0xe18e76)))):emptyState[_0x56692e(0xe1)][_0x56692e(0xeb)]=_0x56692e(0x132),requestAnimationFrame(()=>chatArea[_0x56692e(0xf0)]=chatArea[_0x56692e(0x11f)]);}function autoResizeTextarea(){const _0xa01fe4=a0_0x22ff5a;messageInput[_0xa01fe4(0xe1)][_0xa01fe4(0x109)]=_0xa01fe4(0x10a),messageInput['style']['height']=Math[_0xa01fe4(0xff)](messageInput[_0xa01fe4(0x11f)],0x78)+'px';}function updateSendButton(){const _0x129cac=a0_0x22ff5a,_0x31d017=messageInput[_0x129cac(0xcf)][_0x129cac(0xd1)]();sendBtn[_0x129cac(0xc6)]=!_0x31d017||isTyping;}async function sendMessage(){const _0x380c37=a0_0x22ff5a,_0x3de358=messageInput[_0x380c37(0xcf)][_0x380c37(0xd1)]();if(!_0x3de358||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x380c37(0x10b)][_0x380c37(0x119)]('light');messages[_0x380c37(0xfe)]({'role':_0x380c37(0x11b),'content':_0x3de358,'timestamp':Date[_0x380c37(0x12d)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x380c37(0xc5)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x380c37(0x115)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x380c37(0x11f)];const _0x582083=await callBackend(_0x380c37(0xec),{'message':_0x3de358});isTyping=![];const _0x56576b=document[_0x380c37(0x103)](_0x380c37(0x124));if(_0x56576b)_0x56576b[_0x380c37(0xd6)]();let _0x23eb34=_0x380c37(0xea);if(_0x582083['success']){_0x23eb34=_0x582083[_0x380c37(0x131)]||'Пустой\x20ответ';if(tg?.[_0x380c37(0x10b)])tg[_0x380c37(0x10b)][_0x380c37(0x107)](_0x380c37(0x135));}else{_0x23eb34=_0x582083[_0x380c37(0xba)]||_0x380c37(0xd8);if(tg?.[_0x380c37(0x10b)])tg[_0x380c37(0x10b)][_0x380c37(0x107)]('error');}messages[_0x380c37(0xfe)]({'role':'ai','content':_0x23eb34,'timestamp':Date[_0x380c37(0x12d)]()}),localStorage[_0x380c37(0xf1)](_0x380c37(0x11a),JSON[_0x380c37(0xc5)](messages)),renderMessages();}function confirmDelete(_0x38eeb5){const _0x43a479=a0_0x22ff5a;if(mTitle)mTitle[_0x43a479(0xd0)]=_0x43a479(0xda);if(mText)mText[_0x43a479(0xd0)]=_0x43a479(0xc0);modalCallback=()=>{const _0x27d64a=_0x43a479;messages['splice'](_0x38eeb5,0x1),localStorage[_0x27d64a(0xf1)](_0x27d64a(0x11a),JSON['stringify'](messages)),renderMessages();},modal[_0x43a479(0xe8)][_0x43a479(0xe3)](_0x43a479(0xbc));}if(clearBtn)clearBtn[a0_0x22ff5a(0x11e)]=()=>{const _0x1b304b=a0_0x22ff5a;if(!messages['length'])return;if(mTitle)mTitle[_0x1b304b(0xd0)]=_0x1b304b(0xef);if(mText)mText[_0x1b304b(0xd0)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x49f39b=_0x1b304b;messages=[],localStorage[_0x49f39b(0x108)]('ai_chat_messages'),renderMessages(),callBackend(_0x49f39b(0xc8),{});},modal[_0x1b304b(0xe8)]['add'](_0x1b304b(0xbc));};function a0_0x48d9(){const _0x3c9344=['text','flex','Telegram','POST','success','#050505','emptyState','4OBQmCm','clearBtn','initData','6.1','877592MDqSYQ','error','offsetHeight','show','children','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','parse','Действие\x20необратимо.','isVersionAtLeast','11259864PpLwkE','./router.html','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','stringify','disabled','getMinutes','clear_history','WebApp','shiftKey','modalConfirm','.container','length','apply','value','textContent','trim','getItem','messageInput','1729275MztqDV','createElement','remove','confirmModal','Ошибка\x20сервера','modalText','Удалить?','none','viewportHeight','toString','stopPropagation','json','modalCancel','style','chatArea','add','className','modalTitle','1161532heNGmJ','input','classList','function','Ошибка\x20сети','display','send_message','floor','.message.show-delete','Очистить\x20историю?','scrollTop','setItem','9mZFqfw','innerHTML','TG\x20setup\x20error:','message-bubble','role','getHours','sendBtn','padStart','abort','forEach','delete-btn','addEventListener','push','min','target','preventDefault','random','getElementById','initDataUnsafe','ready','key','notificationOccurred','removeItem','height','auto','HapticFeedback','touchstart','message\x20','debug_uid','<br>','Enter','setHeaderColor','href','username','div','appendChild','disableVerticalSwipes','3420456mNhXzd','search','impactOccurred','ai_chat_messages','user','message-time','first_name','onclick','scrollHeight','signal','light','onEvent','innerHeight','typingIndicator','click','paddingBottom','focus','9442144QeniQA','constructor','keydown','show-delete','content','now','2367117ojyIsL','touchend','expand'];a0_0x48d9=function(){return _0x3c9344;};return a0_0x48d9();}document[a0_0x22ff5a(0x103)](a0_0x22ff5a(0xe0))[a0_0x22ff5a(0x11e)]=()=>modal['classList']['remove'](a0_0x22ff5a(0xbc)),document[a0_0x22ff5a(0x103)](a0_0x22ff5a(0xcb))['onclick']=()=>{const _0x4c5c7b=a0_0x22ff5a;if(modalCallback)modalCallback();modal['classList'][_0x4c5c7b(0xd6)](_0x4c5c7b(0xbc));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x22ff5a(0x12a),_0x402e5e=>{const _0x5a24f3=a0_0x22ff5a;_0x402e5e[_0x5a24f3(0x106)]===_0x5a24f3(0x110)&&!_0x402e5e[_0x5a24f3(0xca)]&&(_0x402e5e[_0x5a24f3(0x101)](),sendMessage());}),sendBtn[a0_0x22ff5a(0x11e)]=sendMessage,document['addEventListener'](a0_0x22ff5a(0x125),_0x374d7c=>{const _0x2fb517=a0_0x22ff5a;document['querySelectorAll'](_0x2fb517(0xee))['forEach'](_0x4bf2aa=>{const _0x4fe266=_0x2fb517;if(!_0x4bf2aa['contains'](_0x374d7c[_0x4fe266(0x100)]))_0x4bf2aa[_0x4fe266(0xe8)][_0x4fe266(0xd6)](_0x4fe266(0x12b));});});const saved=localStorage[a0_0x22ff5a(0xd2)](a0_0x22ff5a(0x11a));if(saved)try{messages=JSON[a0_0x22ff5a(0xbf)](saved),renderMessages();}catch(a0_0x26cf5a){}updateSendButton();