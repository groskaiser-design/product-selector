const a0_0x33b9b5=a0_0x33d4;(function(_0x1d2739,_0x33e2f3){const _0x17e0d0=a0_0x33d4,_0x114be5=_0x1d2739();while(!![]){try{const _0x749c98=parseInt(_0x17e0d0(0x1c0))/0x1*(-parseInt(_0x17e0d0(0x226))/0x2)+-parseInt(_0x17e0d0(0x22a))/0x3*(parseInt(_0x17e0d0(0x1cf))/0x4)+parseInt(_0x17e0d0(0x19e))/0x5+-parseInt(_0x17e0d0(0x1d8))/0x6*(-parseInt(_0x17e0d0(0x214))/0x7)+-parseInt(_0x17e0d0(0x1ca))/0x8*(-parseInt(_0x17e0d0(0x21c))/0x9)+-parseInt(_0x17e0d0(0x1e9))/0xa*(-parseInt(_0x17e0d0(0x1b8))/0xb)+parseInt(_0x17e0d0(0x1c2))/0xc*(parseInt(_0x17e0d0(0x1bc))/0xd);if(_0x749c98===_0x33e2f3)break;else _0x114be5['push'](_0x114be5['shift']());}catch(_0x391d57){_0x114be5['push'](_0x114be5['shift']());}}}(a0_0x5336,0x506d5));const tg=window[a0_0x33b9b5(0x1e4)]?.[a0_0x33b9b5(0x1cb)],HOME_URL=a0_0x33b9b5(0x1ab);function setupTelegramBackButton(){const _0x42ff57=a0_0x33b9b5,_0x21451b=(function(){let _0x13825c=!![];return function(_0x1f390f,_0x26035a){const _0x26b55c=_0x13825c?function(){const _0x4076d0=a0_0x33d4;if(_0x26035a){const _0xff3e5d=_0x26035a[_0x4076d0(0x1a1)](_0x1f390f,arguments);return _0x26035a=null,_0xff3e5d;}}:function(){};return _0x13825c=![],_0x26b55c;};}()),_0x4b6013=_0x21451b(this,function(){const _0x5c046b=a0_0x33d4;return _0x4b6013['toString']()[_0x5c046b(0x1d1)](_0x5c046b(0x1c1))[_0x5c046b(0x1de)]()[_0x5c046b(0x1da)](_0x4b6013)['search'](_0x5c046b(0x1c1));});_0x4b6013();if(!tg)return;try{tg[_0x42ff57(0x1e5)](),tg[_0x42ff57(0x1bb)](),tg['setHeaderColor']?.(_0x42ff57(0x1ff));if(tg[_0x42ff57(0x205)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x3e8634=tg[_0x42ff57(0x1b2)];if(_0x3e8634){_0x3e8634[_0x42ff57(0x20f)]();if(typeof _0x3e8634[_0x42ff57(0x1e8)]===_0x42ff57(0x1ba))try{_0x3e8634[_0x42ff57(0x1e8)]();}catch(_0x15ec0a){}_0x3e8634[_0x42ff57(0x1e6)](()=>{const _0xc5a668=_0x42ff57;if(tg['HapticFeedback'])tg[_0xc5a668(0x1b0)]['impactOccurred'](_0xc5a668(0x1aa));location[_0xc5a668(0x1a2)]=HOME_URL;});}}catch(_0x440024){console[_0x42ff57(0x1ee)]('TG\x20setup\x20error:',_0x440024);}}(function initStableLayout(){const _0x30a44f=a0_0x33b9b5,_0x3267db=document[_0x30a44f(0x1a4)](_0x30a44f(0x200)),_0x57848e=document['getElementById']('inputArea'),_0x11ff5b=document[_0x30a44f(0x1df)](_0x30a44f(0x1bd)),_0x3b9752=document[_0x30a44f(0x1df)]('messageInput');function _0x33b2db(){const _0x25a14e=_0x30a44f;if(!_0x3267db)return;const _0x14c6e4=tg&&tg[_0x25a14e(0x225)]?tg[_0x25a14e(0x225)]:window[_0x25a14e(0x1db)];_0x3267db[_0x25a14e(0x1dc)][_0x25a14e(0x1c8)]=_0x14c6e4+'px';if(_0x57848e){const _0x283183=_0x57848e[_0x25a14e(0x1a9)];_0x11ff5b[_0x25a14e(0x1dc)][_0x25a14e(0x1b7)]=_0x283183+0x28+'px';}}tg?tg['onEvent'](_0x30a44f(0x1d0),({isStateStable:_0x4405f3})=>{_0x33b2db();if(_0x4405f3)requestAnimationFrame(()=>{const _0x4ea20b=a0_0x33d4;_0x11ff5b[_0x4ea20b(0x1f8)]=_0x11ff5b[_0x4ea20b(0x1e3)];});}):window[_0x30a44f(0x1f5)](_0x30a44f(0x1d5),_0x33b2db),_0x33b2db(),_0x3b9752&&(_0x3b9752['addEventListener'](_0x30a44f(0x1ec),()=>{requestAnimationFrame(_0x33b2db);}),_0x3b9752[_0x30a44f(0x1f5)](_0x30a44f(0x1d7),()=>{setTimeout(()=>{const _0x15e7c2=a0_0x33d4;_0x11ff5b[_0x15e7c2(0x1f8)]=_0x11ff5b[_0x15e7c2(0x1e3)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x33b9b5(0x224),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x33b9b5(0x1df)](a0_0x33b9b5(0x1bd)),emptyState=document[a0_0x33b9b5(0x1df)](a0_0x33b9b5(0x1fc)),messageInput=document[a0_0x33b9b5(0x1df)](a0_0x33b9b5(0x1c6)),sendBtn=document[a0_0x33b9b5(0x1df)](a0_0x33b9b5(0x1e7)),clearBtn=document['getElementById'](a0_0x33b9b5(0x1b5)),modal=document[a0_0x33b9b5(0x1df)]('confirmModal'),mTitle=document[a0_0x33b9b5(0x1df)](a0_0x33b9b5(0x1af)),mText=document['getElementById'](a0_0x33b9b5(0x1a8));let modalCallback=null;async function callBackend(_0x2902d5,_0x44fee6){const _0x4b0f04=a0_0x33b9b5,_0x348b2c=tg?.[_0x4b0f04(0x1d9)]?.[_0x4b0f04(0x1a0)]||{},_0x5d8307=_0x348b2c['id']||localStorage[_0x4b0f04(0x1b3)]('debug_uid')||'d-'+Math[_0x4b0f04(0x1f1)](Math[_0x4b0f04(0x1fd)]()*0x3b9aca00);if(!_0x348b2c['id'])localStorage[_0x4b0f04(0x1a6)](_0x4b0f04(0x210),_0x5d8307);const _0x363a6f={'action':_0x2902d5,'user_id':_0x5d8307,'user_data':{'first_name':_0x348b2c[_0x4b0f04(0x228)],'username':_0x348b2c[_0x4b0f04(0x21e)]},'init_data':tg?.[_0x4b0f04(0x1f4)]||'',..._0x44fee6},_0x5e3ebc=new AbortController(),_0x50b5ef=setTimeout(()=>_0x5e3ebc[_0x4b0f04(0x20c)](),REQUEST_TIMEOUT_MS);try{const _0x12b599=await fetch(BACKEND_URL,{'method':_0x4b0f04(0x21f),'headers':{'Content-Type':_0x4b0f04(0x1be)},'body':JSON['stringify'](_0x363a6f),'signal':_0x5e3ebc[_0x4b0f04(0x218)]});return clearTimeout(_0x50b5ef),await _0x12b599['json']();}catch(_0x2b3df4){return{'success':![],'error':String(_0x2b3df4)};}}function formatTime(_0x23c0e3){const _0x42a1a5=a0_0x33b9b5,_0x529d3c=new Date(_0x23c0e3);return String(_0x529d3c[_0x42a1a5(0x1ea)]())[_0x42a1a5(0x1b6)](0x2,'0')+':'+String(_0x529d3c[_0x42a1a5(0x217)]())[_0x42a1a5(0x1b6)](0x2,'0');}function createMessageElement(_0x5abdf2,_0x567a20){const _0x555d49=a0_0x33b9b5,_0x15cab5=document[_0x555d49(0x1d3)]('div');_0x15cab5[_0x555d49(0x216)]='message\x20'+_0x5abdf2[_0x555d49(0x222)];const _0x35eb78=document[_0x555d49(0x1d3)]('div');_0x35eb78[_0x555d49(0x216)]=_0x555d49(0x21a),_0x35eb78[_0x555d49(0x213)]=_0x5abdf2['content'][_0x555d49(0x1e1)](/\n/g,'<br>');const _0x10392c=document[_0x555d49(0x1d3)]('div');_0x10392c['className']=_0x555d49(0x204),_0x10392c['innerHTML']=_0x555d49(0x208),_0x10392c[_0x555d49(0x1cd)]=_0x190849=>{const _0x2d06ee=_0x555d49;_0x190849[_0x2d06ee(0x1b4)](),confirmDelete(_0x567a20);};let _0x257bff;_0x35eb78[_0x555d49(0x1f5)](_0x555d49(0x1ac),()=>_0x257bff=setTimeout(()=>{const _0x59fbf0=_0x555d49;_0x15cab5[_0x59fbf0(0x1fa)]['add'](_0x59fbf0(0x1ae));if(tg?.[_0x59fbf0(0x1b0)])tg['HapticFeedback']['impactOccurred'](_0x59fbf0(0x1a3));},0x1f4)),_0x35eb78[_0x555d49(0x1f5)](_0x555d49(0x1b9),()=>clearTimeout(_0x257bff));const _0x25edc6=document[_0x555d49(0x1d3)]('div');return _0x25edc6['className']=_0x555d49(0x1c7),_0x25edc6['textContent']=formatTime(_0x5abdf2[_0x555d49(0x203)]),_0x15cab5['appendChild'](_0x10392c),_0x15cab5['appendChild'](_0x35eb78),_0x15cab5['appendChild'](_0x25edc6),_0x15cab5;}function createTypingIndicator(){const _0x11ef34=a0_0x33b9b5,_0xa6093d=document[_0x11ef34(0x1d3)](_0x11ef34(0x211));return _0xa6093d[_0x11ef34(0x216)]=_0x11ef34(0x1e2),_0xa6093d['id']=_0x11ef34(0x207),_0xa6093d[_0x11ef34(0x213)]=_0x11ef34(0x19f),_0xa6093d;}function renderMessages(){const _0xd8e7ef=a0_0x33b9b5;Array[_0xd8e7ef(0x202)](chatArea[_0xd8e7ef(0x1c3)])[_0xd8e7ef(0x1f7)](_0xac46ff=>{const _0x50abbd=_0xd8e7ef;if(_0xac46ff['id']!==_0x50abbd(0x1fc))_0xac46ff[_0x50abbd(0x1fe)]();}),messages[_0xd8e7ef(0x1d2)]>0x0?(emptyState[_0xd8e7ef(0x1dc)][_0xd8e7ef(0x1ce)]=_0xd8e7ef(0x20a),messages['forEach']((_0x2da05c,_0x1b39ff)=>chatArea[_0xd8e7ef(0x1f0)](createMessageElement(_0x2da05c,_0x1b39ff)))):emptyState[_0xd8e7ef(0x1dc)][_0xd8e7ef(0x1ce)]=_0xd8e7ef(0x1b1),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0xd8e7ef(0x1e3)]);}function autoResizeTextarea(){const _0x114297=a0_0x33b9b5;messageInput[_0x114297(0x1dc)]['height']=_0x114297(0x1ed),messageInput[_0x114297(0x1dc)][_0x114297(0x1c8)]=Math[_0x114297(0x1e0)](messageInput[_0x114297(0x1e3)],0x78)+'px';}function updateSendButton(){const _0x4f6a23=a0_0x33b9b5,_0x183f89=messageInput[_0x4f6a23(0x1f2)][_0x4f6a23(0x1a7)]();sendBtn['disabled']=!_0x183f89||isTyping;}async function sendMessage(){const _0x5f5c97=a0_0x33b9b5,_0x1f961e=messageInput[_0x5f5c97(0x1f2)]['trim']();if(!_0x1f961e||isTyping)return;if(tg?.[_0x5f5c97(0x1b0)])tg[_0x5f5c97(0x1b0)]['impactOccurred'](_0x5f5c97(0x1aa));messages[_0x5f5c97(0x215)]({'role':_0x5f5c97(0x1a0),'content':_0x1f961e,'timestamp':Date[_0x5f5c97(0x1f9)]()}),localStorage[_0x5f5c97(0x1a6)](_0x5f5c97(0x212),JSON[_0x5f5c97(0x20b)](messages)),renderMessages(),messageInput[_0x5f5c97(0x1f2)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x5f5c97(0x1e3)];const _0x55fc2b=await callBackend(_0x5f5c97(0x223),{'message':_0x1f961e});isTyping=![];const _0x1c2625=document[_0x5f5c97(0x1df)](_0x5f5c97(0x207));if(_0x1c2625)_0x1c2625[_0x5f5c97(0x1fe)]();let _0x180c49=_0x5f5c97(0x227);if(_0x55fc2b[_0x5f5c97(0x221)]){_0x180c49=_0x55fc2b['text']||_0x5f5c97(0x220);if(tg?.[_0x5f5c97(0x1b0)])tg[_0x5f5c97(0x1b0)][_0x5f5c97(0x1eb)](_0x5f5c97(0x221));}else{_0x180c49=_0x55fc2b[_0x5f5c97(0x1f3)]||_0x5f5c97(0x1bf);if(tg?.[_0x5f5c97(0x1b0)])tg['HapticFeedback'][_0x5f5c97(0x1eb)](_0x5f5c97(0x1f3));}messages[_0x5f5c97(0x215)]({'role':'ai','content':_0x180c49,'timestamp':Date['now']()}),localStorage['setItem'](_0x5f5c97(0x212),JSON[_0x5f5c97(0x20b)](messages)),renderMessages();}function confirmDelete(_0x1a9930){const _0x23ef20=a0_0x33b9b5;if(mTitle)mTitle[_0x23ef20(0x20e)]=_0x23ef20(0x1d4);if(mText)mText['textContent']=_0x23ef20(0x21b);modalCallback=()=>{const _0x3c41b0=_0x23ef20;messages[_0x3c41b0(0x1ad)](_0x1a9930,0x1),localStorage[_0x3c41b0(0x1a6)]('ai_chat_messages',JSON[_0x3c41b0(0x20b)](messages)),renderMessages();},modal[_0x23ef20(0x1fa)][_0x23ef20(0x20d)](_0x23ef20(0x20f));}if(clearBtn)clearBtn[a0_0x33b9b5(0x1cd)]=()=>{const _0x5b1ccb=a0_0x33b9b5;if(!messages[_0x5b1ccb(0x1d2)])return;if(mTitle)mTitle[_0x5b1ccb(0x20e)]=_0x5b1ccb(0x1d6);if(mText)mText[_0x5b1ccb(0x20e)]=_0x5b1ccb(0x1dd);modalCallback=async()=>{const _0x410832=_0x5b1ccb;messages=[],localStorage[_0x410832(0x219)]('ai_chat_messages'),renderMessages(),callBackend(_0x410832(0x201),{});},modal['classList'][_0x5b1ccb(0x20d)]('show');};document[a0_0x33b9b5(0x1df)](a0_0x33b9b5(0x209))[a0_0x33b9b5(0x1cd)]=()=>modal[a0_0x33b9b5(0x1fa)][a0_0x33b9b5(0x1fe)]('show'),document[a0_0x33b9b5(0x1df)](a0_0x33b9b5(0x1cc))['onclick']=()=>{const _0x2ac5b0=a0_0x33b9b5;if(modalCallback)modalCallback();modal[_0x2ac5b0(0x1fa)][_0x2ac5b0(0x1fe)](_0x2ac5b0(0x20f));},messageInput[a0_0x33b9b5(0x1f5)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x33b9b5(0x229),_0x6df74f=>{const _0x4a0704=a0_0x33b9b5;_0x6df74f[_0x4a0704(0x1ef)]==='Enter'&&!_0x6df74f[_0x4a0704(0x1fb)]&&(_0x6df74f[_0x4a0704(0x1c4)](),sendMessage());}),sendBtn[a0_0x33b9b5(0x1cd)]=sendMessage,document[a0_0x33b9b5(0x1f5)](a0_0x33b9b5(0x1f6),_0x475fdc=>{const _0x411c77=a0_0x33b9b5;document[_0x411c77(0x21d)](_0x411c77(0x1c5))[_0x411c77(0x1f7)](_0x48fcf5=>{const _0x3970dc=_0x411c77;if(!_0x48fcf5[_0x3970dc(0x1c9)](_0x475fdc[_0x3970dc(0x206)]))_0x48fcf5[_0x3970dc(0x1fa)][_0x3970dc(0x1fe)](_0x3970dc(0x1ae));});});const saved=localStorage[a0_0x33b9b5(0x1b3)]('ai_chat_messages');function a0_0x5336(){const _0x42145f=['https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','viewportHeight','140896eLOiLS','Ошибка\x20сети','first_name','keydown','39DvEevy','1668130ADsmKT','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','user','apply','href','medium','querySelector','parse','setItem','trim','modalText','offsetHeight','light','./router.html','touchstart','splice','show-delete','modalTitle','HapticFeedback','flex','BackButton','getItem','stopPropagation','clearBtn','padStart','paddingBottom','21109lwnBen','touchend','function','expand','182soAaLX','chatArea','text/plain','Ошибка\x20сервера','8vsecCQ','(((.+)+)+)+$','417324ktNoKi','children','preventDefault','.message.show-delete','messageInput','message-time','height','contains','73288UQQKHW','WebApp','modalConfirm','onclick','display','129196acRyWM','viewportChanged','search','length','createElement','Удалить?','resize','Очистить\x20историю?','focus','305070iWQocO','initDataUnsafe','constructor','innerHeight','style','Начнется\x20новый\x20диалог.','toString','getElementById','min','replace','message\x20ai','scrollHeight','Telegram','ready','onClick','sendBtn','offClick','790XIaoRC','getHours','notificationOccurred','input','auto','warn','key','appendChild','floor','value','error','initData','addEventListener','click','forEach','scrollTop','now','classList','shiftKey','emptyState','random','remove','#050505','.container','clear_history','from','timestamp','delete-btn','isVersionAtLeast','target','typingIndicator','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','modalCancel','none','stringify','abort','add','textContent','show','debug_uid','div','ai_chat_messages','innerHTML','28iZqRCO','push','className','getMinutes','signal','removeItem','message-bubble','Действие\x20необратимо.','135SpImXJ','querySelectorAll','username','POST','Пустой\x20ответ','success','role','send_message'];a0_0x5336=function(){return _0x42145f;};return a0_0x5336();}function a0_0x33d4(_0x542c4a,_0x56b8d1){_0x542c4a=_0x542c4a-0x19e;const _0x417d80=a0_0x5336();let _0x372053=_0x417d80[_0x542c4a];return _0x372053;}if(saved)try{messages=JSON[a0_0x33b9b5(0x1a5)](saved),renderMessages();}catch(a0_0x266fb2){}updateSendButton();