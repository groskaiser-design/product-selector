const a0_0xb8092c=a0_0x285b;(function(_0x31343e,_0x4e8107){const _0x4363d9=a0_0x285b,_0x4d8887=_0x31343e();while(!![]){try{const _0x1f697f=-parseInt(_0x4363d9(0x109))/0x1*(parseInt(_0x4363d9(0xe1))/0x2)+parseInt(_0x4363d9(0xf2))/0x3*(parseInt(_0x4363d9(0x14f))/0x4)+parseInt(_0x4363d9(0x150))/0x5*(-parseInt(_0x4363d9(0xe7))/0x6)+parseInt(_0x4363d9(0xe2))/0x7*(parseInt(_0x4363d9(0x12b))/0x8)+parseInt(_0x4363d9(0x12f))/0x9*(parseInt(_0x4363d9(0xda))/0xa)+parseInt(_0x4363d9(0x112))/0xb+-parseInt(_0x4363d9(0x11f))/0xc*(-parseInt(_0x4363d9(0x134))/0xd);if(_0x1f697f===_0x4e8107)break;else _0x4d8887['push'](_0x4d8887['shift']());}catch(_0x575869){_0x4d8887['push'](_0x4d8887['shift']());}}}(a0_0x1324,0x2b378));const tg=window[a0_0xb8092c(0x102)]?.[a0_0xb8092c(0xfc)],HOME_URL=a0_0xb8092c(0x144);function setupTelegramBackButton(){const _0x3fdeec=a0_0xb8092c;if(!tg)return;try{tg[_0x3fdeec(0x12d)](),tg[_0x3fdeec(0xe0)](),tg[_0x3fdeec(0xf1)]?.('#050505');if(tg[_0x3fdeec(0xf7)]?.(_0x3fdeec(0x10a)))tg['disableVerticalSwipes']?.();const _0xe774c3=tg['BackButton'];if(_0xe774c3){_0xe774c3['show']();if(typeof _0xe774c3[_0x3fdeec(0xfa)]===_0x3fdeec(0x125))try{_0xe774c3[_0x3fdeec(0xfa)]();}catch(_0x1ad425){}_0xe774c3[_0x3fdeec(0x136)](()=>{const _0x1be197=_0x3fdeec;if(tg[_0x1be197(0x126)])tg[_0x1be197(0x126)][_0x1be197(0x11d)](_0x1be197(0x154));location[_0x1be197(0x105)]=HOME_URL;});}}catch(_0x517409){console[_0x3fdeec(0x11c)]('TG\x20setup\x20error:',_0x517409);}}function a0_0x1324(){const _0x1eb906=['17586RMxwBY','now','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','scrollTop','delete-btn','104eXrTme','style','onClick','success','message-bubble','onclick','getMinutes','getElementById','touchstart','padStart','auto','typingIndicator','input','trim','stopPropagation','click','./router.html','abort','min','first_name','toString','message\x20ai','search','modalText','length','debug_uid','Enter','8nJNRhf','25DQPYHs','signal','offsetHeight','viewportHeight','light','forEach','Удалить?','random','display','target','addEventListener','1100fetUVz','chatArea','from','touchend','focus','parse','expand','8KlOZcb','1211721QiPePq','innerHeight','apply','Начнется\x20новый\x20диалог.','className','392010ItMhzo','children','constructor','show','onEvent','.container','emptyState','textContent','createElement','username','setHeaderColor','1176HkcXuO','inputArea','modalTitle','resize','modalCancel','isVersionAtLeast','appendChild','text/plain','offClick','paddingBottom','WebApp','value','contains','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','preventDefault','modalConfirm','Telegram','stringify','splice','href','add','json','error','86861jnUHIr','6.1','classList','disabled','message\x20','Действие\x20необратимо.','height','Пустой\x20ответ','confirmModal','1439724pIgZAx','innerHTML','getHours','push','medium','setItem','replace','floor','none','div','warn','impactOccurred','keydown','497136YbYAio','removeItem','(((.+)+)+)+$','initDataUnsafe','flex','text','function','HapticFeedback','remove','user','scrollHeight','show-delete','8CdNBqE','querySelectorAll','ready','ai_chat_messages'];a0_0x1324=function(){return _0x1eb906;};return a0_0x1324();}(function initStableLayout(){const _0x4536a6=a0_0xb8092c,_0x4426e7=(function(){let _0x467623=!![];return function(_0x12d5c4,_0x5734f2){const _0x2f54de=_0x467623?function(){const _0x5ea644=a0_0x285b;if(_0x5734f2){const _0x1fc0f0=_0x5734f2[_0x5ea644(0xe4)](_0x12d5c4,arguments);return _0x5734f2=null,_0x1fc0f0;}}:function(){};return _0x467623=![],_0x2f54de;};}()),_0x304295=document['querySelector'](_0x4536a6(0xec)),_0x5e623d=document['getElementById'](_0x4536a6(0xf3)),_0x581317=document[_0x4536a6(0x13b)](_0x4536a6(0xdb)),_0xee2b27=document['getElementById']('messageInput');function _0x5c18a3(){const _0x23570c=_0x4536a6,_0x2e385b=_0x4426e7(this,function(){const _0x510d13=a0_0x285b;return _0x2e385b['toString']()[_0x510d13(0x14a)](_0x510d13(0x121))[_0x510d13(0x148)]()[_0x510d13(0xe9)](_0x2e385b)[_0x510d13(0x14a)](_0x510d13(0x121));});_0x2e385b();if(!_0x304295)return;const _0x775640=tg&&tg[_0x23570c(0x153)]?tg[_0x23570c(0x153)]:window[_0x23570c(0xe3)];_0x304295[_0x23570c(0x135)][_0x23570c(0x10f)]=_0x775640+'px';if(_0x5e623d){const _0x4f83e6=_0x5e623d[_0x23570c(0x152)];_0x581317['style'][_0x23570c(0xfb)]=_0x4f83e6+0x28+'px';}}tg?tg[_0x4536a6(0xeb)]('viewportChanged',({isStateStable:_0x35f843})=>{_0x5c18a3();if(_0x35f843)requestAnimationFrame(()=>{const _0xf9fadd=a0_0x285b;_0x581317[_0xf9fadd(0x132)]=_0x581317[_0xf9fadd(0x129)];});}):window['addEventListener'](_0x4536a6(0xf5),_0x5c18a3),_0x5c18a3(),_0xee2b27&&(_0xee2b27[_0x4536a6(0xd9)](_0x4536a6(0x140),()=>{requestAnimationFrame(_0x5c18a3);}),_0xee2b27[_0x4536a6(0xd9)](_0x4536a6(0xde),()=>{setTimeout(()=>{const _0x41e555=a0_0x285b;_0x581317['scrollTop']=_0x581317[_0x41e555(0x129)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xb8092c(0x131),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xb8092c(0x13b)]('chatArea'),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0xb8092c(0x13b)]('messageInput'),sendBtn=document[a0_0xb8092c(0x13b)]('sendBtn'),clearBtn=document[a0_0xb8092c(0x13b)]('clearBtn'),modal=document[a0_0xb8092c(0x13b)](a0_0xb8092c(0x111)),mTitle=document[a0_0xb8092c(0x13b)](a0_0xb8092c(0xf4)),mText=document[a0_0xb8092c(0x13b)](a0_0xb8092c(0x14b));let modalCallback=null;async function callBackend(_0x2e577c,_0x106e4a){const _0x21e72a=a0_0xb8092c,_0x2b1708=tg?.[_0x21e72a(0x122)]?.[_0x21e72a(0x128)]||{},_0x49c85b=_0x2b1708['id']||localStorage['getItem'](_0x21e72a(0x14d))||'d-'+Math[_0x21e72a(0x119)](Math[_0x21e72a(0x157)]()*0x3b9aca00);if(!_0x2b1708['id'])localStorage[_0x21e72a(0x117)](_0x21e72a(0x14d),_0x49c85b);const _0x42e33f={'action':_0x2e577c,'user_id':_0x49c85b,'user_data':{'first_name':_0x2b1708[_0x21e72a(0x147)],'username':_0x2b1708[_0x21e72a(0xf0)]},'init_data':tg?.['initData']||'',..._0x106e4a},_0x535d96=new AbortController(),_0x3684b8=setTimeout(()=>_0x535d96[_0x21e72a(0x145)](),REQUEST_TIMEOUT_MS);try{const _0x270a9a=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x21e72a(0xf9)},'body':JSON['stringify'](_0x42e33f),'signal':_0x535d96[_0x21e72a(0x151)]});return clearTimeout(_0x3684b8),await _0x270a9a[_0x21e72a(0x107)]();}catch(_0x2c36ca){return{'success':![],'error':String(_0x2c36ca)};}}function formatTime(_0x4a2afe){const _0x3000c6=a0_0xb8092c,_0x8242f3=new Date(_0x4a2afe);return String(_0x8242f3[_0x3000c6(0x114)]())[_0x3000c6(0x13d)](0x2,'0')+':'+String(_0x8242f3[_0x3000c6(0x13a)]())[_0x3000c6(0x13d)](0x2,'0');}function createMessageElement(_0x3b8103,_0x563e39){const _0x1e7031=a0_0xb8092c,_0x4f7635=document[_0x1e7031(0xef)](_0x1e7031(0x11b));_0x4f7635['className']=_0x1e7031(0x10d)+_0x3b8103['role'];const _0x2c62e7=document['createElement']('div');_0x2c62e7[_0x1e7031(0xe6)]=_0x1e7031(0x138),_0x2c62e7[_0x1e7031(0x113)]=_0x3b8103['content'][_0x1e7031(0x118)](/\n/g,'<br>');const _0x1e037b=document[_0x1e7031(0xef)]('div');_0x1e037b[_0x1e7031(0xe6)]=_0x1e7031(0x133),_0x1e037b[_0x1e7031(0x113)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x1e037b[_0x1e7031(0x139)]=_0x2c348d=>{const _0x8e674b=_0x1e7031;_0x2c348d[_0x8e674b(0x142)](),confirmDelete(_0x563e39);};let _0x4b9b63;_0x2c62e7[_0x1e7031(0xd9)](_0x1e7031(0x13c),()=>_0x4b9b63=setTimeout(()=>{const _0x22c69c=_0x1e7031;_0x4f7635['classList']['add'](_0x22c69c(0x12a));if(tg?.[_0x22c69c(0x126)])tg[_0x22c69c(0x126)][_0x22c69c(0x11d)](_0x22c69c(0x116));},0x1f4)),_0x2c62e7['addEventListener'](_0x1e7031(0xdd),()=>clearTimeout(_0x4b9b63));const _0x41c86a=document[_0x1e7031(0xef)]('div');return _0x41c86a[_0x1e7031(0xe6)]='message-time',_0x41c86a[_0x1e7031(0xee)]=formatTime(_0x3b8103['timestamp']),_0x4f7635[_0x1e7031(0xf8)](_0x1e037b),_0x4f7635[_0x1e7031(0xf8)](_0x2c62e7),_0x4f7635[_0x1e7031(0xf8)](_0x41c86a),_0x4f7635;}function createTypingIndicator(){const _0x3b17e0=a0_0xb8092c,_0x730670=document['createElement']('div');return _0x730670['className']=_0x3b17e0(0x149),_0x730670['id']=_0x3b17e0(0x13f),_0x730670['innerHTML']=_0x3b17e0(0xff),_0x730670;}function renderMessages(){const _0x195cda=a0_0xb8092c;Array[_0x195cda(0xdc)](chatArea[_0x195cda(0xe8)])[_0x195cda(0x155)](_0xe5fcb0=>{const _0x3a572d=_0x195cda;if(_0xe5fcb0['id']!==_0x3a572d(0xed))_0xe5fcb0[_0x3a572d(0x127)]();}),messages[_0x195cda(0x14c)]>0x0?(emptyState['style'][_0x195cda(0xd7)]=_0x195cda(0x11a),messages['forEach']((_0x14eca5,_0x37e428)=>chatArea[_0x195cda(0xf8)](createMessageElement(_0x14eca5,_0x37e428)))):emptyState[_0x195cda(0x135)][_0x195cda(0xd7)]=_0x195cda(0x123),requestAnimationFrame(()=>chatArea[_0x195cda(0x132)]=chatArea[_0x195cda(0x129)]);}function autoResizeTextarea(){const _0x3aa4ac=a0_0xb8092c;messageInput['style'][_0x3aa4ac(0x10f)]=_0x3aa4ac(0x13e),messageInput[_0x3aa4ac(0x135)][_0x3aa4ac(0x10f)]=Math[_0x3aa4ac(0x146)](messageInput[_0x3aa4ac(0x129)],0x78)+'px';}function updateSendButton(){const _0x5e35da=a0_0xb8092c,_0x5c8a25=messageInput[_0x5e35da(0xfd)][_0x5e35da(0x141)]();sendBtn[_0x5e35da(0x10c)]=!_0x5c8a25||isTyping;}function a0_0x285b(_0x36f7dc,_0x126551){_0x36f7dc=_0x36f7dc-0xd7;const _0x1712c3=a0_0x1324();let _0x47ab4a=_0x1712c3[_0x36f7dc];return _0x47ab4a;}async function sendMessage(){const _0x53d9f6=a0_0xb8092c,_0x44ccd7=messageInput[_0x53d9f6(0xfd)][_0x53d9f6(0x141)]();if(!_0x44ccd7||isTyping)return;if(tg?.[_0x53d9f6(0x126)])tg['HapticFeedback']['impactOccurred']('light');messages[_0x53d9f6(0x115)]({'role':'user','content':_0x44ccd7,'timestamp':Date[_0x53d9f6(0x130)]()}),localStorage['setItem'](_0x53d9f6(0x12e),JSON[_0x53d9f6(0x103)](messages)),renderMessages(),messageInput[_0x53d9f6(0xfd)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x53d9f6(0xf8)](createTypingIndicator()),chatArea[_0x53d9f6(0x132)]=chatArea[_0x53d9f6(0x129)];const _0x3c1c1e=await callBackend('send_message',{'message':_0x44ccd7});isTyping=![];const _0x159860=document['getElementById'](_0x53d9f6(0x13f));if(_0x159860)_0x159860[_0x53d9f6(0x127)]();let _0x1058a5='Ошибка\x20сети';if(_0x3c1c1e[_0x53d9f6(0x137)]){_0x1058a5=_0x3c1c1e[_0x53d9f6(0x124)]||_0x53d9f6(0x110);if(tg?.[_0x53d9f6(0x126)])tg[_0x53d9f6(0x126)]['notificationOccurred'](_0x53d9f6(0x137));}else{_0x1058a5=_0x3c1c1e[_0x53d9f6(0x108)]||'Ошибка\x20сервера';if(tg?.[_0x53d9f6(0x126)])tg[_0x53d9f6(0x126)]['notificationOccurred'](_0x53d9f6(0x108));}messages['push']({'role':'ai','content':_0x1058a5,'timestamp':Date[_0x53d9f6(0x130)]()}),localStorage['setItem'](_0x53d9f6(0x12e),JSON[_0x53d9f6(0x103)](messages)),renderMessages();}function confirmDelete(_0x1c71b0){const _0x1a267c=a0_0xb8092c;if(mTitle)mTitle[_0x1a267c(0xee)]=_0x1a267c(0x156);if(mText)mText[_0x1a267c(0xee)]=_0x1a267c(0x10e);modalCallback=()=>{const _0x3dd55a=_0x1a267c;messages[_0x3dd55a(0x104)](_0x1c71b0,0x1),localStorage[_0x3dd55a(0x117)](_0x3dd55a(0x12e),JSON[_0x3dd55a(0x103)](messages)),renderMessages();},modal['classList']['add'](_0x1a267c(0xea));}if(clearBtn)clearBtn[a0_0xb8092c(0x139)]=()=>{const _0x495cfb=a0_0xb8092c;if(!messages['length'])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText['textContent']=_0x495cfb(0xe5);modalCallback=async()=>{const _0xa96e3b=_0x495cfb;messages=[],localStorage[_0xa96e3b(0x120)](_0xa96e3b(0x12e)),renderMessages(),callBackend('clear_history',{});},modal[_0x495cfb(0x10b)][_0x495cfb(0x106)](_0x495cfb(0xea));};document['getElementById'](a0_0xb8092c(0xf6))[a0_0xb8092c(0x139)]=()=>modal['classList']['remove']('show'),document[a0_0xb8092c(0x13b)](a0_0xb8092c(0x101))[a0_0xb8092c(0x139)]=()=>{const _0x581a1a=a0_0xb8092c;if(modalCallback)modalCallback();modal[_0x581a1a(0x10b)][_0x581a1a(0x127)](_0x581a1a(0xea));},messageInput[a0_0xb8092c(0xd9)](a0_0xb8092c(0x140),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0xb8092c(0x11e),_0x442c17=>{const _0x36a36c=a0_0xb8092c;_0x442c17['key']===_0x36a36c(0x14e)&&!_0x442c17['shiftKey']&&(_0x442c17[_0x36a36c(0x100)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0xb8092c(0xd9)](a0_0xb8092c(0x143),_0x5b65d0=>{const _0x1bfe77=a0_0xb8092c;document[_0x1bfe77(0x12c)]('.message.show-delete')['forEach'](_0x3f2efe=>{const _0x29fb4b=_0x1bfe77;if(!_0x3f2efe[_0x29fb4b(0xfe)](_0x5b65d0[_0x29fb4b(0xd8)]))_0x3f2efe[_0x29fb4b(0x10b)][_0x29fb4b(0x127)](_0x29fb4b(0x12a));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0xb8092c(0xdf)](saved),renderMessages();}catch(a0_0x45517a){}updateSendButton();