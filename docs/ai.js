const a0_0x4e4443=a0_0x303e;(function(_0x85425f,_0x4c1d31){const _0x49f15e=a0_0x303e,_0x42d345=_0x85425f();while(!![]){try{const _0x1f1695=-parseInt(_0x49f15e(0x143))/0x1+parseInt(_0x49f15e(0x144))/0x2*(parseInt(_0x49f15e(0x150))/0x3)+-parseInt(_0x49f15e(0x139))/0x4+parseInt(_0x49f15e(0x18d))/0x5*(-parseInt(_0x49f15e(0x13f))/0x6)+parseInt(_0x49f15e(0x129))/0x7*(parseInt(_0x49f15e(0x140))/0x8)+-parseInt(_0x49f15e(0x15f))/0x9+-parseInt(_0x49f15e(0x137))/0xa*(-parseInt(_0x49f15e(0x173))/0xb);if(_0x1f1695===_0x4c1d31)break;else _0x42d345['push'](_0x42d345['shift']());}catch(_0x2f25dd){_0x42d345['push'](_0x42d345['shift']());}}}(a0_0x3c11,0x38d37));const tg=window[a0_0x4e4443(0x125)]?.[a0_0x4e4443(0x1a3)],HOME_URL=a0_0x4e4443(0x197);function setupTelegramBackButton(){const _0x339150=a0_0x4e4443,_0xd12d78=(function(){let _0x527a7b=!![];return function(_0x187174,_0x11abed){const _0x7b97a9=_0x527a7b?function(){const _0x47fafe=a0_0x303e;if(_0x11abed){const _0x19ac54=_0x11abed[_0x47fafe(0x198)](_0x187174,arguments);return _0x11abed=null,_0x19ac54;}}:function(){};return _0x527a7b=![],_0x7b97a9;};}()),_0x1a4dea=_0xd12d78(this,function(){const _0x47b6b7=a0_0x303e;return _0x1a4dea[_0x47b6b7(0x146)]()['search'](_0x47b6b7(0x152))['toString']()[_0x47b6b7(0x1a0)](_0x1a4dea)[_0x47b6b7(0x133)](_0x47b6b7(0x152));});_0x1a4dea();if(!tg)return;try{tg['ready'](),tg[_0x339150(0x15c)](),tg[_0x339150(0x18f)]?.('#050505');if(tg[_0x339150(0x14a)]?.('6.1'))tg[_0x339150(0x15e)]?.();const _0x37df48=tg[_0x339150(0x16b)];if(_0x37df48){_0x37df48[_0x339150(0x14b)]();if(typeof _0x37df48[_0x339150(0x174)]===_0x339150(0x128))try{_0x37df48[_0x339150(0x174)]();}catch(_0x522264){}_0x37df48['onClick'](()=>{const _0x760e9b=_0x339150;if(tg['HapticFeedback'])tg[_0x760e9b(0x12d)][_0x760e9b(0x14d)](_0x760e9b(0x17a));location[_0x760e9b(0x16d)]=HOME_URL;});}}catch(_0x5f3224){console[_0x339150(0x16a)]('TG\x20setup\x20error:',_0x5f3224);}}(function initStableLayout(){const _0x46cfae=a0_0x4e4443,_0x50ad89=document[_0x46cfae(0x13e)](_0x46cfae(0x14c)),_0x30f682=document[_0x46cfae(0x135)]('inputArea'),_0x2f1052=document['getElementById'](_0x46cfae(0x1a7)),_0x16825e=document['getElementById'](_0x46cfae(0x1a1));function _0x234a17(){const _0x565a02=_0x46cfae;if(!_0x50ad89)return;const _0x5cd9b9=tg&&tg['viewportHeight']?tg[_0x565a02(0x17c)]:window[_0x565a02(0x149)];_0x50ad89['style'][_0x565a02(0x131)]=_0x5cd9b9+'px';if(_0x30f682){const _0x10ea5d=_0x30f682[_0x565a02(0x17b)];_0x2f1052['style']['paddingBottom']=_0x10ea5d+0x28+'px';}}tg?tg['onEvent'](_0x46cfae(0x169),({isStateStable:_0x42ac3a})=>{_0x234a17();if(_0x42ac3a)requestAnimationFrame(()=>{const _0x580f24=a0_0x303e;_0x2f1052['scrollTop']=_0x2f1052[_0x580f24(0x123)];});}):window[_0x46cfae(0x177)](_0x46cfae(0x153),_0x234a17),_0x234a17(),_0x16825e&&(_0x16825e[_0x46cfae(0x177)](_0x46cfae(0x163),()=>{requestAnimationFrame(_0x234a17);}),_0x16825e[_0x46cfae(0x177)](_0x46cfae(0x164),()=>{setTimeout(()=>{const _0x3d5f17=a0_0x303e;_0x2f1052[_0x3d5f17(0x16f)]=_0x2f1052['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4e4443(0x13a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x4e4443(0x1a7)),emptyState=document['getElementById'](a0_0x4e4443(0x189)),messageInput=document[a0_0x4e4443(0x135)]('messageInput'),sendBtn=document[a0_0x4e4443(0x135)](a0_0x4e4443(0x161)),clearBtn=document[a0_0x4e4443(0x135)]('clearBtn'),modal=document['getElementById'](a0_0x4e4443(0x170)),mTitle=document['getElementById'](a0_0x4e4443(0x180)),mText=document[a0_0x4e4443(0x135)]('modalText');let modalCallback=null;function a0_0x303e(_0x10970c,_0x28520c){_0x10970c=_0x10970c-0x123;const _0x355f78=a0_0x3c11();let _0x1bb598=_0x355f78[_0x10970c];return _0x1bb598;}async function callBackend(_0x3c2c39,_0x11a636){const _0x5c9241=a0_0x4e4443,_0x31ac40=tg?.[_0x5c9241(0x183)]?.[_0x5c9241(0x134)]||{},_0x280a29=_0x31ac40['id']||localStorage[_0x5c9241(0x193)](_0x5c9241(0x162))||'d-'+Math[_0x5c9241(0x18a)](Math[_0x5c9241(0x166)]()*0x3b9aca00);if(!_0x31ac40['id'])localStorage['setItem'](_0x5c9241(0x162),_0x280a29);const _0x3823a0={'action':_0x3c2c39,'user_id':_0x280a29,'user_data':{'first_name':_0x31ac40[_0x5c9241(0x19a)],'username':_0x31ac40[_0x5c9241(0x15b)]},'init_data':tg?.[_0x5c9241(0x151)]||'',..._0x11a636},_0x5e6ac5=new AbortController(),_0x36c313=setTimeout(()=>_0x5e6ac5['abort'](),REQUEST_TIMEOUT_MS);try{const _0x1cf8a2=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x5c9241(0x176)},'body':JSON['stringify'](_0x3823a0),'signal':_0x5e6ac5[_0x5c9241(0x185)]});return clearTimeout(_0x36c313),await _0x1cf8a2[_0x5c9241(0x19d)]();}catch(_0x319e40){return{'success':![],'error':String(_0x319e40)};}}function formatTime(_0x20fd37){const _0x415c7c=a0_0x4e4443,_0x4c7318=new Date(_0x20fd37);return String(_0x4c7318['getHours']())['padStart'](0x2,'0')+':'+String(_0x4c7318[_0x415c7c(0x171)]())[_0x415c7c(0x1a8)](0x2,'0');}function createMessageElement(_0x455a4b,_0x595a98){const _0x235606=a0_0x4e4443,_0x3659c3=document['createElement']('div');_0x3659c3[_0x235606(0x19b)]=_0x235606(0x196)+_0x455a4b[_0x235606(0x155)];const _0x450737=document['createElement'](_0x235606(0x126));_0x450737[_0x235606(0x19b)]=_0x235606(0x142),_0x450737['innerHTML']=_0x455a4b[_0x235606(0x156)]['replace'](/\n/g,_0x235606(0x130));const _0xf1837e=document[_0x235606(0x19e)](_0x235606(0x126));_0xf1837e[_0x235606(0x19b)]=_0x235606(0x13d),_0xf1837e[_0x235606(0x17d)]=_0x235606(0x132),_0xf1837e[_0x235606(0x19f)]=_0x4f82f0=>{const _0x1396f6=_0x235606;_0x4f82f0[_0x1396f6(0x136)](),confirmDelete(_0x595a98);};let _0x55ebfb;_0x450737[_0x235606(0x177)](_0x235606(0x18b),()=>_0x55ebfb=setTimeout(()=>{const _0x1a9698=_0x235606;_0x3659c3[_0x1a9698(0x1a5)][_0x1a9698(0x195)](_0x1a9698(0x145));if(tg?.['HapticFeedback'])tg[_0x1a9698(0x12d)][_0x1a9698(0x14d)](_0x1a9698(0x194));},0x1f4)),_0x450737[_0x235606(0x177)](_0x235606(0x148),()=>clearTimeout(_0x55ebfb));const _0x4a990d=document[_0x235606(0x19e)](_0x235606(0x126));return _0x4a990d[_0x235606(0x19b)]=_0x235606(0x18c),_0x4a990d[_0x235606(0x191)]=formatTime(_0x455a4b[_0x235606(0x127)]),_0x3659c3['appendChild'](_0xf1837e),_0x3659c3['appendChild'](_0x450737),_0x3659c3[_0x235606(0x1a4)](_0x4a990d),_0x3659c3;}function createTypingIndicator(){const _0x1fffa8=a0_0x4e4443,_0x1cc791=document[_0x1fffa8(0x19e)](_0x1fffa8(0x126));return _0x1cc791[_0x1fffa8(0x19b)]=_0x1fffa8(0x172),_0x1cc791['id']=_0x1fffa8(0x179),_0x1cc791['innerHTML']=_0x1fffa8(0x184),_0x1cc791;}function renderMessages(){const _0x338eb9=a0_0x4e4443;Array['from'](chatArea[_0x338eb9(0x1a6)])['forEach'](_0x387a7e=>{const _0x1323e6=_0x338eb9;if(_0x387a7e['id']!==_0x1323e6(0x189))_0x387a7e[_0x1323e6(0x186)]();}),messages[_0x338eb9(0x138)]>0x0?(emptyState[_0x338eb9(0x154)][_0x338eb9(0x167)]=_0x338eb9(0x15a),messages[_0x338eb9(0x160)]((_0x48314a,_0x3fcf50)=>chatArea['appendChild'](createMessageElement(_0x48314a,_0x3fcf50)))):emptyState[_0x338eb9(0x154)][_0x338eb9(0x167)]=_0x338eb9(0x147),requestAnimationFrame(()=>chatArea[_0x338eb9(0x16f)]=chatArea[_0x338eb9(0x123)]);}function autoResizeTextarea(){const _0x592ff3=a0_0x4e4443;messageInput[_0x592ff3(0x154)]['height']=_0x592ff3(0x17f),messageInput[_0x592ff3(0x154)][_0x592ff3(0x131)]=Math[_0x592ff3(0x12b)](messageInput[_0x592ff3(0x123)],0x78)+'px';}function updateSendButton(){const _0x227ff7=a0_0x4e4443,_0x3a1616=messageInput[_0x227ff7(0x124)][_0x227ff7(0x190)]();sendBtn[_0x227ff7(0x12c)]=!_0x3a1616||isTyping;}async function sendMessage(){const _0x2518be=a0_0x4e4443,_0x310a2c=messageInput[_0x2518be(0x124)]['trim']();if(!_0x310a2c||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2518be(0x12d)]['impactOccurred']('light');messages['push']({'role':_0x2518be(0x134),'content':_0x310a2c,'timestamp':Date['now']()}),localStorage[_0x2518be(0x12e)](_0x2518be(0x141),JSON['stringify'](messages)),renderMessages(),messageInput[_0x2518be(0x124)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2518be(0x1a4)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x2518be(0x123)];const _0x1cb159=await callBackend(_0x2518be(0x192),{'message':_0x310a2c});isTyping=![];const _0x20b2d4=document[_0x2518be(0x135)](_0x2518be(0x179));if(_0x20b2d4)_0x20b2d4[_0x2518be(0x186)]();let _0x322e8d=_0x2518be(0x187);if(_0x1cb159[_0x2518be(0x16e)]){_0x322e8d=_0x1cb159[_0x2518be(0x159)]||'Пустой\x20ответ';if(tg?.[_0x2518be(0x12d)])tg[_0x2518be(0x12d)][_0x2518be(0x16c)]('success');}else{_0x322e8d=_0x1cb159[_0x2518be(0x13b)]||_0x2518be(0x199);if(tg?.[_0x2518be(0x12d)])tg['HapticFeedback'][_0x2518be(0x16c)]('error');}messages[_0x2518be(0x182)]({'role':'ai','content':_0x322e8d,'timestamp':Date['now']()}),localStorage['setItem'](_0x2518be(0x141),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x1deaf3){const _0x43b9d8=a0_0x4e4443;if(mTitle)mTitle[_0x43b9d8(0x191)]=_0x43b9d8(0x15d);if(mText)mText[_0x43b9d8(0x191)]='Действие\x20необратимо.';modalCallback=()=>{const _0x14375a=_0x43b9d8;messages[_0x14375a(0x181)](_0x1deaf3,0x1),localStorage[_0x14375a(0x12e)](_0x14375a(0x141),JSON[_0x14375a(0x12a)](messages)),renderMessages();},modal[_0x43b9d8(0x1a5)][_0x43b9d8(0x195)](_0x43b9d8(0x14b));}if(clearBtn)clearBtn[a0_0x4e4443(0x19f)]=()=>{const _0x58b1d3=a0_0x4e4443;if(!messages[_0x58b1d3(0x138)])return;if(mTitle)mTitle[_0x58b1d3(0x191)]=_0x58b1d3(0x12f);if(mText)mText[_0x58b1d3(0x191)]=_0x58b1d3(0x168);modalCallback=async()=>{const _0x1a54c2=_0x58b1d3;messages=[],localStorage[_0x1a54c2(0x1a2)]('ai_chat_messages'),renderMessages(),callBackend(_0x1a54c2(0x158),{});},modal[_0x58b1d3(0x1a5)][_0x58b1d3(0x195)](_0x58b1d3(0x14b));};document[a0_0x4e4443(0x135)](a0_0x4e4443(0x14e))['onclick']=()=>modal['classList'][a0_0x4e4443(0x186)](a0_0x4e4443(0x14b)),document['getElementById'](a0_0x4e4443(0x165))['onclick']=()=>{const _0x1f7152=a0_0x4e4443;if(modalCallback)modalCallback();modal[_0x1f7152(0x1a5)][_0x1f7152(0x186)](_0x1f7152(0x14b));},messageInput[a0_0x4e4443(0x177)](a0_0x4e4443(0x163),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4e4443(0x177)](a0_0x4e4443(0x188),_0x495c19=>{const _0x101670=a0_0x4e4443;_0x495c19['key']===_0x101670(0x19c)&&!_0x495c19[_0x101670(0x14f)]&&(_0x495c19[_0x101670(0x18e)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x4e4443(0x177)](a0_0x4e4443(0x178),_0x1b69ce=>{const _0x34c407=a0_0x4e4443;document[_0x34c407(0x13c)](_0x34c407(0x157))['forEach'](_0x314271=>{const _0x270c19=_0x34c407;if(!_0x314271[_0x270c19(0x175)](_0x1b69ce['target']))_0x314271['classList'][_0x270c19(0x186)](_0x270c19(0x145));});});const saved=localStorage[a0_0x4e4443(0x193)](a0_0x4e4443(0x141));function a0_0x3c11(){const _0x582bd1=['modalConfirm','random','display','Начнется\x20новый\x20диалог.','viewportChanged','warn','BackButton','notificationOccurred','href','success','scrollTop','confirmModal','getMinutes','message\x20ai','11mTPVpS','offClick','contains','text/plain','addEventListener','click','typingIndicator','light','offsetHeight','viewportHeight','innerHTML','parse','auto','modalTitle','splice','push','initDataUnsafe','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','signal','remove','Ошибка\x20сети','keydown','emptyState','floor','touchstart','message-time','4175qHBOWU','preventDefault','setHeaderColor','trim','textContent','send_message','getItem','medium','add','message\x20','./router.html','apply','Ошибка\x20сервера','first_name','className','Enter','json','createElement','onclick','constructor','messageInput','removeItem','WebApp','appendChild','classList','children','chatArea','padStart','scrollHeight','value','Telegram','div','timestamp','function','27097FdqzPU','stringify','min','disabled','HapticFeedback','setItem','Очистить\x20историю?','<br>','height','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','search','user','getElementById','stopPropagation','10156780ccKVFp','length','327920umeUHS','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','error','querySelectorAll','delete-btn','querySelector','3138eVVBgT','104EzqdQD','ai_chat_messages','message-bubble','296185OlfGWE','54ViZaea','show-delete','toString','flex','touchend','innerHeight','isVersionAtLeast','show','.container','impactOccurred','modalCancel','shiftKey','31869ZZhtCF','initData','(((.+)+)+)+$','resize','style','role','content','.message.show-delete','clear_history','text','none','username','expand','Удалить?','disableVerticalSwipes','2746737dRnvKz','forEach','sendBtn','debug_uid','input','focus'];a0_0x3c11=function(){return _0x582bd1;};return a0_0x3c11();}if(saved)try{messages=JSON[a0_0x4e4443(0x17e)](saved),renderMessages();}catch(a0_0x29db48){}updateSendButton();