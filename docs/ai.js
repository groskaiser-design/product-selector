const a0_0x3edc5d=a0_0x1d23;function a0_0x1d23(_0x5cd6d4,_0x4192a0){_0x5cd6d4=_0x5cd6d4-0x98;const _0xa90624=a0_0xbdea();let _0x22d33a=_0xa90624[_0x5cd6d4];return _0x22d33a;}(function(_0x13c162,_0x30fafd){const _0x504a2d=a0_0x1d23,_0x1c3e27=_0x13c162();while(!![]){try{const _0x4df902=parseInt(_0x504a2d(0xfa))/0x1+parseInt(_0x504a2d(0xf2))/0x2+parseInt(_0x504a2d(0xd1))/0x3+parseInt(_0x504a2d(0x9a))/0x4+parseInt(_0x504a2d(0xbc))/0x5*(parseInt(_0x504a2d(0x10e))/0x6)+parseInt(_0x504a2d(0xcd))/0x7+-parseInt(_0x504a2d(0xff))/0x8;if(_0x4df902===_0x30fafd)break;else _0x1c3e27['push'](_0x1c3e27['shift']());}catch(_0x4a8cd6){_0x1c3e27['push'](_0x1c3e27['shift']());}}}(a0_0xbdea,0xd9d16));const tg=window[a0_0x3edc5d(0xfc)]?.['WebApp'],HOME_URL=a0_0x3edc5d(0x9f);function setupTelegramBackButton(){const _0x4ebb19=a0_0x3edc5d;if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x4ebb19(0xb4)]?.('#050505');if(tg[_0x4ebb19(0xe6)]?.(_0x4ebb19(0x109)))tg[_0x4ebb19(0xcf)]?.();const _0xdab907=tg[_0x4ebb19(0xbb)];if(_0xdab907){_0xdab907[_0x4ebb19(0xa5)]();if(typeof _0xdab907['offClick']===_0x4ebb19(0x9e))try{_0xdab907[_0x4ebb19(0xae)]();}catch(_0x4c47ba){}_0xdab907[_0x4ebb19(0xcc)](()=>{const _0x1150f8=_0x4ebb19;if(tg[_0x1150f8(0xca)])tg[_0x1150f8(0xca)][_0x1150f8(0xa4)](_0x1150f8(0x10d));location[_0x1150f8(0xc2)]=HOME_URL;});}}catch(_0x2e946d){console[_0x4ebb19(0xed)](_0x4ebb19(0xe3),_0x2e946d);}}(function initStableLayout(){const _0x4103e8=a0_0x3edc5d,_0x3fbe54=(function(){let _0x2306bc=!![];return function(_0x2c3ce2,_0x1cf126){const _0x84f695=_0x2306bc?function(){if(_0x1cf126){const _0x306260=_0x1cf126['apply'](_0x2c3ce2,arguments);return _0x1cf126=null,_0x306260;}}:function(){};return _0x2306bc=![],_0x84f695;};}()),_0x11605d=document[_0x4103e8(0xf4)]('.container'),_0x54e70b=document[_0x4103e8(0xaa)](_0x4103e8(0xf0)),_0x1bd097=document['getElementById'](_0x4103e8(0xa2)),_0x490a72=document[_0x4103e8(0xaa)](_0x4103e8(0xd2));function _0xba2576(){const _0x22c4e6=_0x4103e8,_0x8f1f1f=_0x3fbe54(this,function(){const _0x3f3809=a0_0x1d23;return _0x8f1f1f['toString']()[_0x3f3809(0xdf)](_0x3f3809(0xbf))[_0x3f3809(0xb8)]()['constructor'](_0x8f1f1f)[_0x3f3809(0xdf)](_0x3f3809(0xbf));});_0x8f1f1f();if(!_0x11605d)return;const _0x4745ec=tg&&tg['viewportHeight']?tg[_0x22c4e6(0xb6)]:window[_0x22c4e6(0xad)];_0x11605d[_0x22c4e6(0xab)][_0x22c4e6(0xa7)]=_0x4745ec+'px';if(_0x54e70b){const _0xf35429=_0x54e70b['offsetHeight'];_0x1bd097[_0x22c4e6(0xab)][_0x22c4e6(0xc3)]=_0xf35429+0x28+'px';}}tg?tg['onEvent'](_0x4103e8(0xe5),({isStateStable:_0x735ca3})=>{_0xba2576();if(_0x735ca3)requestAnimationFrame(()=>{const _0x1b71c5=a0_0x1d23;_0x1bd097[_0x1b71c5(0x10a)]=_0x1bd097[_0x1b71c5(0x103)];});}):window['addEventListener'](_0x4103e8(0xfd),_0xba2576),_0xba2576(),_0x490a72&&(_0x490a72[_0x4103e8(0x10f)](_0x4103e8(0xa9),()=>{requestAnimationFrame(_0xba2576);}),_0x490a72[_0x4103e8(0x10f)](_0x4103e8(0xf9),()=>{setTimeout(()=>{const _0x232c56=a0_0x1d23;_0x1bd097['scrollTop']=_0x1bd097[_0x232c56(0x103)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3edc5d(0xaa)]('chatArea'),emptyState=document[a0_0x3edc5d(0xaa)](a0_0x3edc5d(0xd6)),messageInput=document[a0_0x3edc5d(0xaa)](a0_0x3edc5d(0xd2)),sendBtn=document[a0_0x3edc5d(0xaa)](a0_0x3edc5d(0xb5)),clearBtn=document[a0_0x3edc5d(0xaa)](a0_0x3edc5d(0xf7)),modal=document[a0_0x3edc5d(0xaa)](a0_0x3edc5d(0xe2)),mTitle=document['getElementById'](a0_0x3edc5d(0xe4)),mText=document[a0_0x3edc5d(0xaa)](a0_0x3edc5d(0xc9));let modalCallback=null;async function callBackend(_0x486fe8,_0x553742){const _0x1aa7cc=a0_0x3edc5d,_0x744de0=tg?.[_0x1aa7cc(0xb0)]?.[_0x1aa7cc(0x104)]||{},_0xf3d114=_0x744de0['id']||localStorage[_0x1aa7cc(0xb7)](_0x1aa7cc(0xf8))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x744de0['id'])localStorage[_0x1aa7cc(0xe7)](_0x1aa7cc(0xf8),_0xf3d114);const _0x398f8c={'action':_0x486fe8,'user_id':_0xf3d114,'user_data':{'first_name':_0x744de0[_0x1aa7cc(0xd3)],'username':_0x744de0[_0x1aa7cc(0xd4)]},'init_data':tg?.[_0x1aa7cc(0x9b)]||'',..._0x553742},_0x5a70a8=new AbortController(),_0x53183c=setTimeout(()=>_0x5a70a8[_0x1aa7cc(0xe0)](),REQUEST_TIMEOUT_MS);try{const _0x37504b=await fetch(BACKEND_URL,{'method':_0x1aa7cc(0x100),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x1aa7cc(0xc0)](_0x398f8c),'signal':_0x5a70a8[_0x1aa7cc(0xb3)]});return clearTimeout(_0x53183c),await _0x37504b['json']();}catch(_0xd22288){return{'success':![],'error':String(_0xd22288)};}}function formatTime(_0x5a3529){const _0x1a68c3=a0_0x3edc5d,_0x55bafe=new Date(_0x5a3529);return String(_0x55bafe[_0x1a68c3(0xc4)]())[_0x1a68c3(0x101)](0x2,'0')+':'+String(_0x55bafe[_0x1a68c3(0x102)]())[_0x1a68c3(0x101)](0x2,'0');}function createMessageElement(_0x305cfb,_0x24371a){const _0x32a76a=a0_0x3edc5d,_0x2a2fbe=document[_0x32a76a(0xe8)](_0x32a76a(0xf1));_0x2a2fbe['className']=_0x32a76a(0xea)+_0x305cfb['role'];const _0x3f9288=document[_0x32a76a(0xe8)]('div');_0x3f9288[_0x32a76a(0xa6)]='message-bubble',_0x3f9288['innerHTML']=_0x305cfb[_0x32a76a(0x9d)][_0x32a76a(0x106)](/\n/g,_0x32a76a(0xb1));const _0x2171c2=document['createElement'](_0x32a76a(0xf1));_0x2171c2[_0x32a76a(0xa6)]=_0x32a76a(0xc8),_0x2171c2[_0x32a76a(0xee)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x2171c2[_0x32a76a(0xce)]=_0x592b9c=>{_0x592b9c['stopPropagation'](),confirmDelete(_0x24371a);};let _0x16054e;_0x3f9288[_0x32a76a(0x10f)]('touchstart',()=>_0x16054e=setTimeout(()=>{const _0x534dc7=_0x32a76a;_0x2a2fbe[_0x534dc7(0xa3)][_0x534dc7(0x10b)](_0x534dc7(0x99));if(tg?.['HapticFeedback'])tg[_0x534dc7(0xca)][_0x534dc7(0xa4)](_0x534dc7(0xd5));},0x1f4)),_0x3f9288['addEventListener'](_0x32a76a(0xba),()=>clearTimeout(_0x16054e));const _0x1dec48=document[_0x32a76a(0xe8)](_0x32a76a(0xf1));return _0x1dec48[_0x32a76a(0xa6)]=_0x32a76a(0xc5),_0x1dec48['textContent']=formatTime(_0x305cfb['timestamp']),_0x2a2fbe['appendChild'](_0x2171c2),_0x2a2fbe[_0x32a76a(0xc1)](_0x3f9288),_0x2a2fbe[_0x32a76a(0xc1)](_0x1dec48),_0x2a2fbe;}function createTypingIndicator(){const _0x9d935d=a0_0x3edc5d,_0x2579af=document[_0x9d935d(0xe8)]('div');return _0x2579af['className']='message\x20ai',_0x2579af['id']=_0x9d935d(0xd7),_0x2579af[_0x9d935d(0xee)]=_0x9d935d(0xb9),_0x2579af;}function renderMessages(){const _0x4317a1=a0_0x3edc5d;Array[_0x4317a1(0xe9)](chatArea[_0x4317a1(0xa1)])[_0x4317a1(0xfb)](_0xb900da=>{const _0x4527ae=_0x4317a1;if(_0xb900da['id']!==_0x4527ae(0xd6))_0xb900da[_0x4527ae(0xdc)]();}),messages[_0x4317a1(0x105)]>0x0?(emptyState['style']['display']=_0x4317a1(0xaf),messages[_0x4317a1(0xfb)]((_0x202b3b,_0x431f21)=>chatArea['appendChild'](createMessageElement(_0x202b3b,_0x431f21)))):emptyState[_0x4317a1(0xab)]['display']='flex',requestAnimationFrame(()=>chatArea[_0x4317a1(0x10a)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x43c7d5=a0_0x3edc5d;messageInput[_0x43c7d5(0xab)][_0x43c7d5(0xa7)]=_0x43c7d5(0xf5),messageInput[_0x43c7d5(0xab)][_0x43c7d5(0xa7)]=Math[_0x43c7d5(0x10c)](messageInput[_0x43c7d5(0x103)],0x78)+'px';}function updateSendButton(){const _0x42af41=a0_0x3edc5d,_0x13335a=messageInput[_0x42af41(0xc7)][_0x42af41(0xfe)]();sendBtn[_0x42af41(0xd9)]=!_0x13335a||isTyping;}function a0_0xbdea(){const _0x5cd2c4=['viewportChanged','isVersionAtLeast','setItem','createElement','from','message\x20','modalConfirm','Enter','warn','innerHTML','error','inputArea','div','975922SLjUyq','Действие\x20необратимо.','querySelector','auto','textContent','clearBtn','debug_uid','focus','404245tsRuWt','forEach','Telegram','resize','trim','34058616PkfGdO','POST','padStart','getMinutes','scrollHeight','user','length','replace','target','now','6.1','scrollTop','add','min','light','4770FpfCvh','addEventListener','preventDefault','show-delete','3646312SFonrv','initData','Удалить?','content','function','./router.html','clear_history','children','chatArea','classList','impactOccurred','show','className','height','ai_chat_messages','input','getElementById','style','splice','innerHeight','offClick','none','initDataUnsafe','<br>','key','signal','setHeaderColor','sendBtn','viewportHeight','getItem','toString','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','touchend','BackButton','2485lkoguB','removeItem','push','(((.+)+)+)+$','stringify','appendChild','href','paddingBottom','getHours','message-time','Ошибка\x20сети','value','delete-btn','modalText','HapticFeedback','send_message','onClick','9392488nkmOpf','onclick','disableVerticalSwipes','Очистить\x20историю?','4826478rjNCTE','messageInput','first_name','username','medium','emptyState','typingIndicator','.message.show-delete','disabled','text','notificationOccurred','remove','shiftKey','keydown','search','abort','success','confirmModal','TG\x20setup\x20error:','modalTitle'];a0_0xbdea=function(){return _0x5cd2c4;};return a0_0xbdea();}async function sendMessage(){const _0x172002=a0_0x3edc5d,_0xfe12f0=messageInput['value'][_0x172002(0xfe)]();if(!_0xfe12f0||isTyping)return;if(tg?.[_0x172002(0xca)])tg['HapticFeedback'][_0x172002(0xa4)](_0x172002(0x10d));messages['push']({'role':_0x172002(0x104),'content':_0xfe12f0,'timestamp':Date[_0x172002(0x108)]()}),localStorage[_0x172002(0xe7)](_0x172002(0xa8),JSON[_0x172002(0xc0)](messages)),renderMessages(),messageInput[_0x172002(0xc7)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x172002(0xc1)](createTypingIndicator()),chatArea[_0x172002(0x10a)]=chatArea[_0x172002(0x103)];const _0x230b6a=await callBackend(_0x172002(0xcb),{'message':_0xfe12f0});isTyping=![];const _0x106bd7=document[_0x172002(0xaa)]('typingIndicator');if(_0x106bd7)_0x106bd7[_0x172002(0xdc)]();let _0x26fa4d=_0x172002(0xc6);if(_0x230b6a[_0x172002(0xe1)]){_0x26fa4d=_0x230b6a[_0x172002(0xda)]||'Пустой\x20ответ';if(tg?.[_0x172002(0xca)])tg['HapticFeedback'][_0x172002(0xdb)]('success');}else{_0x26fa4d=_0x230b6a[_0x172002(0xef)]||'Ошибка\x20сервера';if(tg?.[_0x172002(0xca)])tg[_0x172002(0xca)][_0x172002(0xdb)](_0x172002(0xef));}messages[_0x172002(0xbe)]({'role':'ai','content':_0x26fa4d,'timestamp':Date[_0x172002(0x108)]()}),localStorage['setItem'](_0x172002(0xa8),JSON[_0x172002(0xc0)](messages)),renderMessages();}function confirmDelete(_0x56aa67){const _0x37de8e=a0_0x3edc5d;if(mTitle)mTitle['textContent']=_0x37de8e(0x9c);if(mText)mText[_0x37de8e(0xf6)]=_0x37de8e(0xf3);modalCallback=()=>{const _0x411af2=_0x37de8e;messages[_0x411af2(0xac)](_0x56aa67,0x1),localStorage[_0x411af2(0xe7)](_0x411af2(0xa8),JSON[_0x411af2(0xc0)](messages)),renderMessages();},modal[_0x37de8e(0xa3)][_0x37de8e(0x10b)]('show');}if(clearBtn)clearBtn[a0_0x3edc5d(0xce)]=()=>{const _0x1eb68d=a0_0x3edc5d;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x1eb68d(0xd0);if(mText)mText['textContent']='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x505488=_0x1eb68d;messages=[],localStorage[_0x505488(0xbd)](_0x505488(0xa8)),renderMessages(),callBackend(_0x505488(0xa0),{});},modal[_0x1eb68d(0xa3)][_0x1eb68d(0x10b)](_0x1eb68d(0xa5));};document[a0_0x3edc5d(0xaa)]('modalCancel')[a0_0x3edc5d(0xce)]=()=>modal['classList'][a0_0x3edc5d(0xdc)](a0_0x3edc5d(0xa5)),document[a0_0x3edc5d(0xaa)](a0_0x3edc5d(0xeb))[a0_0x3edc5d(0xce)]=()=>{const _0x49a707=a0_0x3edc5d;if(modalCallback)modalCallback();modal[_0x49a707(0xa3)][_0x49a707(0xdc)](_0x49a707(0xa5));},messageInput[a0_0x3edc5d(0x10f)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3edc5d(0x10f)](a0_0x3edc5d(0xde),_0x4d1e36=>{const _0x211857=a0_0x3edc5d;_0x4d1e36[_0x211857(0xb2)]===_0x211857(0xec)&&!_0x4d1e36[_0x211857(0xdd)]&&(_0x4d1e36[_0x211857(0x98)](),sendMessage());}),sendBtn[a0_0x3edc5d(0xce)]=sendMessage,document[a0_0x3edc5d(0x10f)]('click',_0x3ade6b=>{const _0x11b8cc=a0_0x3edc5d;document['querySelectorAll'](_0x11b8cc(0xd8))[_0x11b8cc(0xfb)](_0x5207ac=>{const _0x12401e=_0x11b8cc;if(!_0x5207ac['contains'](_0x3ade6b[_0x12401e(0x107)]))_0x5207ac[_0x12401e(0xa3)][_0x12401e(0xdc)](_0x12401e(0x99));});});const saved=localStorage[a0_0x3edc5d(0xb7)](a0_0x3edc5d(0xa8));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x520457){}updateSendButton();