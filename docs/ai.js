const a0_0x5f0ae9=a0_0x1bfb;(function(_0x1ef617,_0x29f21e){const _0x23e07e=a0_0x1bfb,_0x31d1ce=_0x1ef617();while(!![]){try{const _0x56e306=-parseInt(_0x23e07e(0x10a))/0x1*(-parseInt(_0x23e07e(0xd0))/0x2)+-parseInt(_0x23e07e(0xf4))/0x3*(parseInt(_0x23e07e(0xd2))/0x4)+-parseInt(_0x23e07e(0xb0))/0x5+parseInt(_0x23e07e(0xb2))/0x6+-parseInt(_0x23e07e(0xb1))/0x7+-parseInt(_0x23e07e(0xf3))/0x8*(parseInt(_0x23e07e(0x112))/0x9)+parseInt(_0x23e07e(0x105))/0xa;if(_0x56e306===_0x29f21e)break;else _0x31d1ce['push'](_0x31d1ce['shift']());}catch(_0x53e5bd){_0x31d1ce['push'](_0x31d1ce['shift']());}}}(a0_0x5d44,0xc9420));const tg=window[a0_0x5f0ae9(0x111)]?.[a0_0x5f0ae9(0xe0)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x2c91d9=a0_0x5f0ae9;if(!tg)return;try{tg[_0x2c91d9(0xa1)](),tg[_0x2c91d9(0xbe)](),tg['setHeaderColor']?.('#050505');if(tg['isVersionAtLeast']?.(_0x2c91d9(0xfd)))tg[_0x2c91d9(0xa3)]?.();const _0x4bacad=tg[_0x2c91d9(0xde)];if(_0x4bacad){_0x4bacad[_0x2c91d9(0xfb)]();if(typeof _0x4bacad[_0x2c91d9(0x108)]===_0x2c91d9(0xcd))try{_0x4bacad[_0x2c91d9(0x108)]();}catch(_0x36043a){}_0x4bacad['onClick'](()=>{const _0xad21c7=_0x2c91d9;if(tg[_0xad21c7(0x109)])tg[_0xad21c7(0x109)][_0xad21c7(0xb9)](_0xad21c7(0xa9));location[_0xad21c7(0xba)]=HOME_URL;});}}catch(_0x307cb2){console['warn']('TG\x20setup\x20error:',_0x307cb2);}}(function initStableLayout(){const _0x2f9cd6=a0_0x5f0ae9,_0xae1f4c=(function(){let _0x57dd4f=!![];return function(_0x495f53,_0x599092){const _0x5fb979=_0x57dd4f?function(){const _0x564b81=a0_0x1bfb;if(_0x599092){const _0x15575a=_0x599092[_0x564b81(0x9f)](_0x495f53,arguments);return _0x599092=null,_0x15575a;}}:function(){};return _0x57dd4f=![],_0x5fb979;};}()),_0x5c6fcf=document[_0x2f9cd6(0xf7)](_0x2f9cd6(0xfe)),_0x415a62=document[_0x2f9cd6(0xe8)]('inputArea'),_0xf2c09f=document[_0x2f9cd6(0xe8)]('chatArea'),_0x5fc27e=document['getElementById'](_0x2f9cd6(0xd7));function _0x35cf48(){const _0x19bad3=_0x2f9cd6,_0x555ed4=_0xae1f4c(this,function(){const _0x28ef2a=a0_0x1bfb;return _0x555ed4['toString']()['search'](_0x28ef2a(0xd3))[_0x28ef2a(0xf0)]()[_0x28ef2a(0x115)](_0x555ed4)['search']('(((.+)+)+)+$');});_0x555ed4();if(!_0x5c6fcf)return;const _0x32040b=tg&&tg['viewportHeight']?tg[_0x19bad3(0xcc)]:window[_0x19bad3(0x9d)];_0x5c6fcf[_0x19bad3(0xef)][_0x19bad3(0xa6)]=_0x32040b+'px';if(_0x415a62){const _0x302c18=_0x415a62[_0x19bad3(0xad)];_0xf2c09f[_0x19bad3(0xef)][_0x19bad3(0xf2)]=_0x302c18+0x28+'px';}}tg?tg[_0x2f9cd6(0xa7)]('viewportChanged',({isStateStable:_0x528aa5})=>{_0x35cf48();if(_0x528aa5)requestAnimationFrame(()=>{const _0x4e6ad2=a0_0x1bfb;_0xf2c09f[_0x4e6ad2(0x9a)]=_0xf2c09f[_0x4e6ad2(0xb5)];});}):window[_0x2f9cd6(0xbf)](_0x2f9cd6(0xe1),_0x35cf48),_0x35cf48(),_0x5fc27e&&(_0x5fc27e[_0x2f9cd6(0xbf)](_0x2f9cd6(0xf1),()=>{requestAnimationFrame(_0x35cf48);}),_0x5fc27e['addEventListener'](_0x2f9cd6(0xe3),()=>{setTimeout(()=>{const _0x33fd86=a0_0x1bfb;_0xf2c09f[_0x33fd86(0x9a)]=_0xf2c09f['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5f0ae9(0xd4),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5f0ae9(0xe8)]('chatArea'),emptyState=document['getElementById'](a0_0x5f0ae9(0xe4)),messageInput=document[a0_0x5f0ae9(0xe8)](a0_0x5f0ae9(0xd7)),sendBtn=document['getElementById'](a0_0x5f0ae9(0xc9)),clearBtn=document[a0_0x5f0ae9(0xe8)](a0_0x5f0ae9(0xd5)),modal=document[a0_0x5f0ae9(0xe8)](a0_0x5f0ae9(0xca)),mTitle=document[a0_0x5f0ae9(0xe8)]('modalTitle'),mText=document[a0_0x5f0ae9(0xe8)](a0_0x5f0ae9(0xa5));let modalCallback=null;function a0_0x5d44(){const _0x49086a=['forEach','messageInput','createElement','now','initData','Пустой\x20ответ','send_message','initDataUnsafe','BackButton','flex','WebApp','resize','textContent','focus','emptyState','Начнется\x20новый\x20диалог.','setItem','show-delete','getElementById','notificationOccurred','role','none','splice','shiftKey','abort','style','toString','input','paddingBottom','200cvCdOy','3iuwJwH','typingIndicator','display','querySelector','padStart','appendChild','getHours','show','message\x20ai','6.1','.container','clear_history','random','keydown','user','modalCancel','text','22812720cpKlUO','first_name','length','offClick','HapticFeedback','4xutbBy','error','children','target','Enter','getItem','Ошибка\x20сервера','Telegram','268740ChiJGX','classList','preventDefault','constructor','innerHTML','removeItem','scrollTop','contains','touchend','innerHeight','push','apply','replace','ready','ai_chat_messages','disableVerticalSwipes','auto','modalText','height','onEvent','medium','light','message-time','modalConfirm','div','offsetHeight','message-bubble','<br>','6652415poAdlE','8484301QgEngt','3697146QswKIU','key','username','scrollHeight','remove','onclick','disabled','impactOccurred','href','min','success','getMinutes','expand','addEventListener','debug_uid','stringify','value','timestamp','json','touchstart','Удалить?','stopPropagation','from','sendBtn','confirmModal','delete-btn','viewportHeight','function','className','floor','804448hCfEyc','.message.show-delete','1571924EBgKqv','(((.+)+)+)+$','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','clearBtn'];a0_0x5d44=function(){return _0x49086a;};return a0_0x5d44();}async function callBackend(_0x3a7e50,_0x4f653a){const _0x18ffcc=a0_0x5f0ae9,_0x25693a=tg?.[_0x18ffcc(0xdd)]?.[_0x18ffcc(0x102)]||{},_0x44a6fd=_0x25693a['id']||localStorage[_0x18ffcc(0x10f)](_0x18ffcc(0xc0))||'d-'+Math[_0x18ffcc(0xcf)](Math[_0x18ffcc(0x100)]()*0x3b9aca00);if(!_0x25693a['id'])localStorage[_0x18ffcc(0xe6)](_0x18ffcc(0xc0),_0x44a6fd);const _0x2a5bfc={'action':_0x3a7e50,'user_id':_0x44a6fd,'user_data':{'first_name':_0x25693a[_0x18ffcc(0x106)],'username':_0x25693a[_0x18ffcc(0xb4)]},'init_data':tg?.[_0x18ffcc(0xda)]||'',..._0x4f653a},_0xb69f10=new AbortController(),_0xb5d5fd=setTimeout(()=>_0xb69f10[_0x18ffcc(0xee)](),REQUEST_TIMEOUT_MS);try{const _0x19654d=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x18ffcc(0xc1)](_0x2a5bfc),'signal':_0xb69f10['signal']});return clearTimeout(_0xb5d5fd),await _0x19654d[_0x18ffcc(0xc4)]();}catch(_0x1b78d2){return{'success':![],'error':String(_0x1b78d2)};}}function formatTime(_0x5b29c3){const _0xdb1d7a=a0_0x5f0ae9,_0x21d9a0=new Date(_0x5b29c3);return String(_0x21d9a0[_0xdb1d7a(0xfa)]())[_0xdb1d7a(0xf8)](0x2,'0')+':'+String(_0x21d9a0[_0xdb1d7a(0xbd)]())[_0xdb1d7a(0xf8)](0x2,'0');}function createMessageElement(_0x34676b,_0x22c892){const _0x22dc81=a0_0x5f0ae9,_0xeb28f6=document['createElement'](_0x22dc81(0xac));_0xeb28f6[_0x22dc81(0xce)]='message\x20'+_0x34676b[_0x22dc81(0xea)];const _0x1ba712=document[_0x22dc81(0xd8)](_0x22dc81(0xac));_0x1ba712[_0x22dc81(0xce)]=_0x22dc81(0xae),_0x1ba712['innerHTML']=_0x34676b['content'][_0x22dc81(0xa0)](/\n/g,_0x22dc81(0xaf));const _0x316117=document[_0x22dc81(0xd8)]('div');_0x316117[_0x22dc81(0xce)]=_0x22dc81(0xcb),_0x316117[_0x22dc81(0x116)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x316117[_0x22dc81(0xb7)]=_0x6dfbd=>{const _0x5d5161=_0x22dc81;_0x6dfbd[_0x5d5161(0xc7)](),confirmDelete(_0x22c892);};let _0x51e48c;_0x1ba712[_0x22dc81(0xbf)](_0x22dc81(0xc5),()=>_0x51e48c=setTimeout(()=>{const _0x3d053b=_0x22dc81;_0xeb28f6[_0x3d053b(0x113)]['add'](_0x3d053b(0xe7));if(tg?.[_0x3d053b(0x109)])tg[_0x3d053b(0x109)][_0x3d053b(0xb9)](_0x3d053b(0xa8));},0x1f4)),_0x1ba712[_0x22dc81(0xbf)](_0x22dc81(0x9c),()=>clearTimeout(_0x51e48c));const _0x15f416=document[_0x22dc81(0xd8)](_0x22dc81(0xac));return _0x15f416['className']=_0x22dc81(0xaa),_0x15f416[_0x22dc81(0xe2)]=formatTime(_0x34676b[_0x22dc81(0xc3)]),_0xeb28f6[_0x22dc81(0xf9)](_0x316117),_0xeb28f6[_0x22dc81(0xf9)](_0x1ba712),_0xeb28f6[_0x22dc81(0xf9)](_0x15f416),_0xeb28f6;}function createTypingIndicator(){const _0x4ca658=a0_0x5f0ae9,_0x5343a6=document[_0x4ca658(0xd8)](_0x4ca658(0xac));return _0x5343a6[_0x4ca658(0xce)]=_0x4ca658(0xfc),_0x5343a6['id']='typingIndicator',_0x5343a6[_0x4ca658(0x116)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x5343a6;}function renderMessages(){const _0x442c0a=a0_0x5f0ae9;Array[_0x442c0a(0xc8)](chatArea[_0x442c0a(0x10c)])['forEach'](_0x26d86b=>{const _0x2be38b=_0x442c0a;if(_0x26d86b['id']!==_0x2be38b(0xe4))_0x26d86b[_0x2be38b(0xb6)]();}),messages[_0x442c0a(0x107)]>0x0?(emptyState[_0x442c0a(0xef)][_0x442c0a(0xf6)]=_0x442c0a(0xeb),messages[_0x442c0a(0xd6)]((_0x3d351c,_0x57a7fa)=>chatArea[_0x442c0a(0xf9)](createMessageElement(_0x3d351c,_0x57a7fa)))):emptyState['style']['display']=_0x442c0a(0xdf),requestAnimationFrame(()=>chatArea[_0x442c0a(0x9a)]=chatArea[_0x442c0a(0xb5)]);}function autoResizeTextarea(){const _0x6efa3b=a0_0x5f0ae9;messageInput['style'][_0x6efa3b(0xa6)]=_0x6efa3b(0xa4),messageInput[_0x6efa3b(0xef)][_0x6efa3b(0xa6)]=Math[_0x6efa3b(0xbb)](messageInput[_0x6efa3b(0xb5)],0x78)+'px';}function a0_0x1bfb(_0x355c20,_0x5e1066){_0x355c20=_0x355c20-0x9a;const _0x10d071=a0_0x5d44();let _0x3d3791=_0x10d071[_0x355c20];return _0x3d3791;}function updateSendButton(){const _0xed868d=a0_0x5f0ae9,_0x5474cf=messageInput[_0xed868d(0xc2)]['trim']();sendBtn[_0xed868d(0xb8)]=!_0x5474cf||isTyping;}async function sendMessage(){const _0x37fd5f=a0_0x5f0ae9,_0x1743d2=messageInput[_0x37fd5f(0xc2)]['trim']();if(!_0x1743d2||isTyping)return;if(tg?.[_0x37fd5f(0x109)])tg[_0x37fd5f(0x109)]['impactOccurred'](_0x37fd5f(0xa9));messages[_0x37fd5f(0x9e)]({'role':_0x37fd5f(0x102),'content':_0x1743d2,'timestamp':Date[_0x37fd5f(0xd9)]()}),localStorage['setItem'](_0x37fd5f(0xa2),JSON['stringify'](messages)),renderMessages(),messageInput[_0x37fd5f(0xc2)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x37fd5f(0xf9)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x37fd5f(0xb5)];const _0x56b1b9=await callBackend(_0x37fd5f(0xdc),{'message':_0x1743d2});isTyping=![];const _0x2bb59d=document[_0x37fd5f(0xe8)](_0x37fd5f(0xf5));if(_0x2bb59d)_0x2bb59d[_0x37fd5f(0xb6)]();let _0x436614='Ошибка\x20сети';if(_0x56b1b9[_0x37fd5f(0xbc)]){_0x436614=_0x56b1b9[_0x37fd5f(0x104)]||_0x37fd5f(0xdb);if(tg?.[_0x37fd5f(0x109)])tg[_0x37fd5f(0x109)][_0x37fd5f(0xe9)](_0x37fd5f(0xbc));}else{_0x436614=_0x56b1b9[_0x37fd5f(0x10b)]||_0x37fd5f(0x110);if(tg?.[_0x37fd5f(0x109)])tg[_0x37fd5f(0x109)][_0x37fd5f(0xe9)](_0x37fd5f(0x10b));}messages[_0x37fd5f(0x9e)]({'role':'ai','content':_0x436614,'timestamp':Date['now']()}),localStorage[_0x37fd5f(0xe6)]('ai_chat_messages',JSON[_0x37fd5f(0xc1)](messages)),renderMessages();}function confirmDelete(_0x3956c0){const _0x5509d2=a0_0x5f0ae9;if(mTitle)mTitle[_0x5509d2(0xe2)]=_0x5509d2(0xc6);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x917a2c=_0x5509d2;messages[_0x917a2c(0xec)](_0x3956c0,0x1),localStorage[_0x917a2c(0xe6)]('ai_chat_messages',JSON[_0x917a2c(0xc1)](messages)),renderMessages();},modal['classList']['add'](_0x5509d2(0xfb));}if(clearBtn)clearBtn[a0_0x5f0ae9(0xb7)]=()=>{const _0x1c32f1=a0_0x5f0ae9;if(!messages[_0x1c32f1(0x107)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText['textContent']=_0x1c32f1(0xe5);modalCallback=async()=>{const _0x12cb5a=_0x1c32f1;messages=[],localStorage[_0x12cb5a(0x117)](_0x12cb5a(0xa2)),renderMessages(),callBackend(_0x12cb5a(0xff),{});},modal[_0x1c32f1(0x113)]['add'](_0x1c32f1(0xfb));};document['getElementById'](a0_0x5f0ae9(0x103))['onclick']=()=>modal[a0_0x5f0ae9(0x113)][a0_0x5f0ae9(0xb6)](a0_0x5f0ae9(0xfb)),document[a0_0x5f0ae9(0xe8)](a0_0x5f0ae9(0xab))[a0_0x5f0ae9(0xb7)]=()=>{const _0x1e477c=a0_0x5f0ae9;if(modalCallback)modalCallback();modal[_0x1e477c(0x113)][_0x1e477c(0xb6)](_0x1e477c(0xfb));},messageInput[a0_0x5f0ae9(0xbf)](a0_0x5f0ae9(0xf1),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5f0ae9(0xbf)](a0_0x5f0ae9(0x101),_0x224fe4=>{const _0x42a447=a0_0x5f0ae9;_0x224fe4[_0x42a447(0xb3)]===_0x42a447(0x10e)&&!_0x224fe4[_0x42a447(0xed)]&&(_0x224fe4[_0x42a447(0x114)](),sendMessage());}),sendBtn[a0_0x5f0ae9(0xb7)]=sendMessage,document['addEventListener']('click',_0x150b94=>{const _0x3a387e=a0_0x5f0ae9;document['querySelectorAll'](_0x3a387e(0xd1))[_0x3a387e(0xd6)](_0x4da403=>{const _0x25274c=_0x3a387e;if(!_0x4da403[_0x25274c(0x9b)](_0x150b94[_0x25274c(0x10d)]))_0x4da403[_0x25274c(0x113)][_0x25274c(0xb6)](_0x25274c(0xe7));});});const saved=localStorage['getItem'](a0_0x5f0ae9(0xa2));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x167ccd){}updateSendButton();