const a0_0x4d98a8=a0_0x1b52;(function(_0x67b5ad,_0x2b8484){const _0x1f70b4=a0_0x1b52,_0x497099=_0x67b5ad();while(!![]){try{const _0x7e967c=-parseInt(_0x1f70b4(0x1e6))/0x1*(-parseInt(_0x1f70b4(0x176))/0x2)+parseInt(_0x1f70b4(0x1a9))/0x3*(parseInt(_0x1f70b4(0x185))/0x4)+parseInt(_0x1f70b4(0x19f))/0x5*(parseInt(_0x1f70b4(0x1d0))/0x6)+parseInt(_0x1f70b4(0x1ed))/0x7+-parseInt(_0x1f70b4(0x1c0))/0x8*(parseInt(_0x1f70b4(0x1c3))/0x9)+parseInt(_0x1f70b4(0x1f0))/0xa*(parseInt(_0x1f70b4(0x1a4))/0xb)+-parseInt(_0x1f70b4(0x1a5))/0xc*(parseInt(_0x1f70b4(0x1dd))/0xd);if(_0x7e967c===_0x2b8484)break;else _0x497099['push'](_0x497099['shift']());}catch(_0x2db058){_0x497099['push'](_0x497099['shift']());}}}(a0_0x33d5,0xa6afd));const tg=window[a0_0x4d98a8(0x16b)]?.[a0_0x4d98a8(0x182)],HOME_URL=a0_0x4d98a8(0x1e7);function setupTelegramBackButton(){const _0x74d1ea=a0_0x4d98a8,_0x2f67c1=(function(){let _0x3de155=!![];return function(_0x3838eb,_0x4134aa){const _0x24107d=_0x3de155?function(){const _0x421c3d=a0_0x1b52;if(_0x4134aa){const _0x54c2d7=_0x4134aa[_0x421c3d(0x1e8)](_0x3838eb,arguments);return _0x4134aa=null,_0x54c2d7;}}:function(){};return _0x3de155=![],_0x24107d;};}()),_0xe0ed47=_0x2f67c1(this,function(){const _0x24a847=a0_0x1b52;return _0xe0ed47[_0x24a847(0x1b5)]()['search']('(((.+)+)+)+$')['toString']()[_0x24a847(0x1ef)](_0xe0ed47)[_0x24a847(0x190)](_0x24a847(0x198));});_0xe0ed47();if(!tg)return;try{tg[_0x74d1ea(0x1c1)](),tg[_0x74d1ea(0x1b8)](),tg['setHeaderColor']?.(_0x74d1ea(0x1d4));if(tg[_0x74d1ea(0x1e2)]?.(_0x74d1ea(0x1df)))tg['disableVerticalSwipes']?.();const _0x5bd890=tg[_0x74d1ea(0x1b0)];if(_0x5bd890){_0x5bd890['show']();if(typeof _0x5bd890[_0x74d1ea(0x1b9)]===_0x74d1ea(0x170))try{_0x5bd890[_0x74d1ea(0x1b9)]();}catch(_0x28eb5a){}_0x5bd890['onClick'](()=>{const _0x4593b1=_0x74d1ea;if(tg[_0x4593b1(0x183)])tg[_0x4593b1(0x183)][_0x4593b1(0x1ea)]('light');location[_0x4593b1(0x179)]=HOME_URL;});}}catch(_0x3855d5){console[_0x74d1ea(0x18c)](_0x74d1ea(0x1de),_0x3855d5);}}(function initStableLayout(){const _0x13969c=a0_0x4d98a8,_0x583a65=document[_0x13969c(0x17d)](_0x13969c(0x1e3)),_0x18d5d0=document[_0x13969c(0x1b3)](_0x13969c(0x19a)),_0x406891=document[_0x13969c(0x1b3)](_0x13969c(0x1d6)),_0x20315e=document[_0x13969c(0x1b3)](_0x13969c(0x171));function _0xa44a06(){const _0x37b66f=_0x13969c;if(!_0x583a65)return;const _0x53937a=tg&&tg[_0x37b66f(0x177)]?tg['viewportHeight']:window[_0x37b66f(0x1cb)];_0x583a65[_0x37b66f(0x1e1)]['height']=_0x53937a+'px';if(_0x18d5d0){const _0x328a9b=_0x18d5d0[_0x37b66f(0x1af)];_0x406891[_0x37b66f(0x1e1)]['paddingBottom']=_0x328a9b+0x28+'px';}}tg?tg[_0x13969c(0x175)](_0x13969c(0x1bd),({isStateStable:_0x4a0d9a})=>{_0xa44a06();if(_0x4a0d9a)requestAnimationFrame(()=>{const _0x30dddb=a0_0x1b52;_0x406891['scrollTop']=_0x406891[_0x30dddb(0x1a2)];});}):window[_0x13969c(0x194)](_0x13969c(0x1dc),_0xa44a06),_0xa44a06(),_0x20315e&&(_0x20315e['addEventListener'](_0x13969c(0x1aa),()=>{requestAnimationFrame(_0xa44a06);}),_0x20315e[_0x13969c(0x194)](_0x13969c(0x192),()=>{setTimeout(()=>{const _0x174454=a0_0x1b52;_0x406891[_0x174454(0x16e)]=_0x406891[_0x174454(0x1a2)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4d98a8(0x1be),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4d98a8(0x1b3)]('chatArea'),emptyState=document['getElementById'](a0_0x4d98a8(0x1ab)),messageInput=document['getElementById'](a0_0x4d98a8(0x171)),sendBtn=document['getElementById'](a0_0x4d98a8(0x1d8)),clearBtn=document['getElementById'](a0_0x4d98a8(0x167)),modal=document[a0_0x4d98a8(0x1b3)](a0_0x4d98a8(0x17f)),mTitle=document[a0_0x4d98a8(0x1b3)](a0_0x4d98a8(0x180)),mText=document['getElementById'](a0_0x4d98a8(0x1c5));let modalCallback=null;async function callBackend(_0x30ab96,_0x573bf7){const _0x5bd609=a0_0x4d98a8,_0x4442c0=tg?.[_0x5bd609(0x191)]?.[_0x5bd609(0x1d5)]||{},_0x5724b6=_0x4442c0['id']||localStorage['getItem'](_0x5bd609(0x173))||'d-'+Math['floor'](Math[_0x5bd609(0x1e5)]()*0x3b9aca00);if(!_0x4442c0['id'])localStorage['setItem'](_0x5bd609(0x173),_0x5724b6);const _0x208b1b={'action':_0x30ab96,'user_id':_0x5724b6,'user_data':{'first_name':_0x4442c0[_0x5bd609(0x17c)],'username':_0x4442c0[_0x5bd609(0x1d7)]},'init_data':tg?.[_0x5bd609(0x19e)]||'',..._0x573bf7},_0x26665c=new AbortController(),_0x28afc1=setTimeout(()=>_0x26665c['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3c6814=await fetch(BACKEND_URL,{'method':_0x5bd609(0x1e0),'headers':{'Content-Type':_0x5bd609(0x19d)},'body':JSON[_0x5bd609(0x166)](_0x208b1b),'signal':_0x26665c[_0x5bd609(0x1bc)]});return clearTimeout(_0x28afc1),await _0x3c6814['json']();}catch(_0x1af14c){return{'success':![],'error':String(_0x1af14c)};}}function formatTime(_0x172ed0){const _0xfc552c=a0_0x4d98a8,_0x2bc33c=new Date(_0x172ed0);return String(_0x2bc33c['getHours']())[_0xfc552c(0x189)](0x2,'0')+':'+String(_0x2bc33c['getMinutes']())[_0xfc552c(0x189)](0x2,'0');}function createMessageElement(_0x152237,_0x2a3fa7){const _0x1d09d5=a0_0x4d98a8,_0x4618ba=document[_0x1d09d5(0x1a8)](_0x1d09d5(0x17a));_0x4618ba[_0x1d09d5(0x193)]=_0x1d09d5(0x17b)+_0x152237[_0x1d09d5(0x1d2)];const _0x40e905=document[_0x1d09d5(0x1a8)](_0x1d09d5(0x17a));_0x40e905[_0x1d09d5(0x193)]=_0x1d09d5(0x1d9),_0x40e905['innerHTML']=_0x152237[_0x1d09d5(0x172)][_0x1d09d5(0x165)](/\n/g,_0x1d09d5(0x16d));const _0x1ba46c=document[_0x1d09d5(0x1a8)](_0x1d09d5(0x17a));_0x1ba46c[_0x1d09d5(0x193)]=_0x1d09d5(0x1bf),_0x1ba46c[_0x1d09d5(0x1db)]=_0x1d09d5(0x197),_0x1ba46c[_0x1d09d5(0x187)]=_0x44624e=>{_0x44624e['stopPropagation'](),confirmDelete(_0x2a3fa7);};let _0x585162;_0x40e905['addEventListener'](_0x1d09d5(0x188),()=>_0x585162=setTimeout(()=>{const _0x1f7eab=_0x1d09d5;_0x4618ba['classList'][_0x1f7eab(0x195)]('show-delete');if(tg?.[_0x1f7eab(0x183)])tg[_0x1f7eab(0x183)][_0x1f7eab(0x1ea)]('medium');},0x1f4)),_0x40e905[_0x1d09d5(0x194)](_0x1d09d5(0x19c),()=>clearTimeout(_0x585162));const _0x268d10=document[_0x1d09d5(0x1a8)](_0x1d09d5(0x17a));return _0x268d10['className']=_0x1d09d5(0x1a6),_0x268d10[_0x1d09d5(0x16f)]=formatTime(_0x152237[_0x1d09d5(0x16a)]),_0x4618ba[_0x1d09d5(0x1b7)](_0x1ba46c),_0x4618ba[_0x1d09d5(0x1b7)](_0x40e905),_0x4618ba[_0x1d09d5(0x1b7)](_0x268d10),_0x4618ba;}function createTypingIndicator(){const _0x18a9d2=a0_0x4d98a8,_0x973786=document[_0x18a9d2(0x1a8)](_0x18a9d2(0x17a));return _0x973786[_0x18a9d2(0x193)]=_0x18a9d2(0x1d3),_0x973786['id']=_0x18a9d2(0x181),_0x973786[_0x18a9d2(0x1db)]=_0x18a9d2(0x1ad),_0x973786;}function renderMessages(){const _0xacc77=a0_0x4d98a8;Array[_0xacc77(0x1bb)](chatArea[_0xacc77(0x1e9)])[_0xacc77(0x1ec)](_0x3b79cd=>{const _0x1a5f2e=_0xacc77;if(_0x3b79cd['id']!==_0x1a5f2e(0x1ab))_0x3b79cd['remove']();}),messages['length']>0x0?(emptyState['style'][_0xacc77(0x1da)]='none',messages['forEach']((_0x421459,_0x5b6326)=>chatArea[_0xacc77(0x1b7)](createMessageElement(_0x421459,_0x5b6326)))):emptyState[_0xacc77(0x1e1)]['display']=_0xacc77(0x18a),requestAnimationFrame(()=>chatArea[_0xacc77(0x16e)]=chatArea[_0xacc77(0x1a2)]);}function autoResizeTextarea(){const _0x459dd6=a0_0x4d98a8;messageInput[_0x459dd6(0x1e1)][_0x459dd6(0x1c7)]=_0x459dd6(0x1c6),messageInput['style']['height']=Math[_0x459dd6(0x1c8)](messageInput[_0x459dd6(0x1a2)],0x78)+'px';}function updateSendButton(){const _0x42e2cf=a0_0x4d98a8,_0x2cb79b=messageInput[_0x42e2cf(0x184)][_0x42e2cf(0x1ca)]();sendBtn['disabled']=!_0x2cb79b||isTyping;}async function sendMessage(){const _0x2f7953=a0_0x4d98a8,_0x2d4dca=messageInput[_0x2f7953(0x184)]['trim']();if(!_0x2d4dca||isTyping)return;if(tg?.[_0x2f7953(0x183)])tg[_0x2f7953(0x183)]['impactOccurred'](_0x2f7953(0x1ae));messages['push']({'role':_0x2f7953(0x1d5),'content':_0x2d4dca,'timestamp':Date[_0x2f7953(0x1c4)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x2f7953(0x166)](messages)),renderMessages(),messageInput[_0x2f7953(0x184)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2f7953(0x1b7)](createTypingIndicator()),chatArea[_0x2f7953(0x16e)]=chatArea['scrollHeight'];const _0x36bd19=await callBackend('send_message',{'message':_0x2d4dca});isTyping=![];const _0x5e345d=document[_0x2f7953(0x1b3)](_0x2f7953(0x181));if(_0x5e345d)_0x5e345d['remove']();let _0x48c002=_0x2f7953(0x1c2);if(_0x36bd19[_0x2f7953(0x174)]){_0x48c002=_0x36bd19[_0x2f7953(0x18e)]||_0x2f7953(0x1e4);if(tg?.[_0x2f7953(0x183)])tg['HapticFeedback'][_0x2f7953(0x168)](_0x2f7953(0x174));}else{_0x48c002=_0x36bd19[_0x2f7953(0x1b6)]||_0x2f7953(0x1ce);if(tg?.['HapticFeedback'])tg[_0x2f7953(0x183)][_0x2f7953(0x168)]('error');}messages[_0x2f7953(0x169)]({'role':'ai','content':_0x48c002,'timestamp':Date[_0x2f7953(0x1c4)]()}),localStorage[_0x2f7953(0x1ac)](_0x2f7953(0x1ba),JSON[_0x2f7953(0x166)](messages)),renderMessages();}function confirmDelete(_0x293933){const _0x32c676=a0_0x4d98a8;if(mTitle)mTitle[_0x32c676(0x16f)]=_0x32c676(0x1b1);if(mText)mText['textContent']=_0x32c676(0x16c);modalCallback=()=>{const _0x4c86e1=_0x32c676;messages[_0x4c86e1(0x18f)](_0x293933,0x1),localStorage[_0x4c86e1(0x1ac)]('ai_chat_messages',JSON[_0x4c86e1(0x166)](messages)),renderMessages();},modal[_0x32c676(0x186)]['add'](_0x32c676(0x199));}if(clearBtn)clearBtn[a0_0x4d98a8(0x187)]=()=>{const _0x3c706d=a0_0x4d98a8;if(!messages[_0x3c706d(0x18d)])return;if(mTitle)mTitle[_0x3c706d(0x16f)]=_0x3c706d(0x1cd);if(mText)mText['textContent']=_0x3c706d(0x18b);modalCallback=async()=>{const _0x1f8f7b=_0x3c706d;messages=[],localStorage[_0x1f8f7b(0x1cf)](_0x1f8f7b(0x1ba)),renderMessages(),callBackend(_0x1f8f7b(0x1a0),{});},modal[_0x3c706d(0x186)][_0x3c706d(0x195)](_0x3c706d(0x199));};function a0_0x1b52(_0x4ea114,_0x5ecc5a){_0x4ea114=_0x4ea114-0x165;const _0x5e6dd4=a0_0x33d5();let _0x5933c6=_0x5e6dd4[_0x4ea114];return _0x5933c6;}document[a0_0x4d98a8(0x1b3)](a0_0x4d98a8(0x1a3))[a0_0x4d98a8(0x187)]=()=>modal['classList']['remove'](a0_0x4d98a8(0x199)),document[a0_0x4d98a8(0x1b3)](a0_0x4d98a8(0x1eb))['onclick']=()=>{const _0x1aa142=a0_0x4d98a8;if(modalCallback)modalCallback();modal[_0x1aa142(0x186)][_0x1aa142(0x1b2)](_0x1aa142(0x199));},messageInput['addEventListener'](a0_0x4d98a8(0x1aa),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4d98a8(0x194)](a0_0x4d98a8(0x1d1),_0x5acfa7=>{const _0x153830=a0_0x4d98a8;_0x5acfa7[_0x153830(0x17e)]===_0x153830(0x196)&&!_0x5acfa7[_0x153830(0x1ee)]&&(_0x5acfa7[_0x153830(0x1a1)](),sendMessage());}),sendBtn[a0_0x4d98a8(0x187)]=sendMessage,document[a0_0x4d98a8(0x194)]('click',_0x38a924=>{const _0x12162e=a0_0x4d98a8;document[_0x12162e(0x1b4)](_0x12162e(0x1a7))[_0x12162e(0x1ec)](_0x3631a2=>{const _0x530ffb=_0x12162e;if(!_0x3631a2[_0x530ffb(0x1c9)](_0x38a924[_0x530ffb(0x19b)]))_0x3631a2[_0x530ffb(0x186)][_0x530ffb(0x1b2)](_0x530ffb(0x178));});});const saved=localStorage[a0_0x4d98a8(0x1cc)]('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x4b9b80){}function a0_0x33d5(){const _0x5365d=['min','contains','trim','innerHeight','getItem','Очистить\x20историю?','Ошибка\x20сервера','removeItem','243234OLyuxq','keydown','role','message\x20ai','#050505','user','chatArea','username','sendBtn','message-bubble','display','innerHTML','resize','4212377OndgBP','TG\x20setup\x20error:','6.1','POST','style','isVersionAtLeast','.container','Пустой\x20ответ','random','1264jgWpeJ','./router.html','apply','children','impactOccurred','modalConfirm','forEach','8653337dtlWRq','shiftKey','constructor','1200sqnOwo','replace','stringify','clearBtn','notificationOccurred','push','timestamp','Telegram','Действие\x20необратимо.','<br>','scrollTop','textContent','function','messageInput','content','debug_uid','success','onEvent','316kNbPKe','viewportHeight','show-delete','href','div','message\x20','first_name','querySelector','key','confirmModal','modalTitle','typingIndicator','WebApp','HapticFeedback','value','3457796ktBPIm','classList','onclick','touchstart','padStart','flex','Начнется\x20новый\x20диалог.','warn','length','text','splice','search','initDataUnsafe','focus','className','addEventListener','add','Enter','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','(((.+)+)+)+$','show','inputArea','target','touchend','text/plain','initData','165pIlizD','clear_history','preventDefault','scrollHeight','modalCancel','96129sKNNPt','132jNAZvO','message-time','.message.show-delete','createElement','3cpqOFQ','input','emptyState','setItem','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','light','offsetHeight','BackButton','Удалить?','remove','getElementById','querySelectorAll','toString','error','appendChild','expand','offClick','ai_chat_messages','from','signal','viewportChanged','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','delete-btn','270616NEfXTn','ready','Ошибка\x20сети','117ZWgTMm','now','modalText','auto','height'];a0_0x33d5=function(){return _0x5365d;};return a0_0x33d5();}updateSendButton();