const a0_0x762d60=a0_0x1a73;(function(_0x6a56fe,_0x449c1a){const _0x1f0ee9=a0_0x1a73,_0x266adb=_0x6a56fe();while(!![]){try{const _0x1866c7=parseInt(_0x1f0ee9(0xe5))/0x1+-parseInt(_0x1f0ee9(0xf1))/0x2*(-parseInt(_0x1f0ee9(0xb7))/0x3)+-parseInt(_0x1f0ee9(0xe8))/0x4*(-parseInt(_0x1f0ee9(0xb3))/0x5)+parseInt(_0x1f0ee9(0xf4))/0x6*(parseInt(_0x1f0ee9(0xf8))/0x7)+-parseInt(_0x1f0ee9(0x9e))/0x8+-parseInt(_0x1f0ee9(0x84))/0x9+-parseInt(_0x1f0ee9(0xb6))/0xa*(parseInt(_0x1f0ee9(0x91))/0xb);if(_0x1866c7===_0x449c1a)break;else _0x266adb['push'](_0x266adb['shift']());}catch(_0x56c33e){_0x266adb['push'](_0x266adb['shift']());}}}(a0_0x3f5b,0xd0580));const tg=window[a0_0x762d60(0x8f)]?.['WebApp'],HOME_URL=a0_0x762d60(0x8a);function setupTelegramBackButton(){const _0x587ec2=a0_0x762d60;if(!tg)return;try{tg[_0x587ec2(0xfd)](),tg[_0x587ec2(0xa8)](),tg[_0x587ec2(0xc2)]?.(_0x587ec2(0xbc));if(tg[_0x587ec2(0xbf)]?.(_0x587ec2(0x102)))tg[_0x587ec2(0xfc)]?.();const _0x221f4f=tg[_0x587ec2(0x87)];if(_0x221f4f){_0x221f4f[_0x587ec2(0xe4)]();if(typeof _0x221f4f['offClick']===_0x587ec2(0x104))try{_0x221f4f[_0x587ec2(0xcf)]();}catch(_0x5427c5){}_0x221f4f[_0x587ec2(0xa9)](()=>{const _0x5430ef=_0x587ec2;if(tg['HapticFeedback'])tg[_0x5430ef(0x8b)][_0x5430ef(0xea)]('light');location[_0x5430ef(0x86)]=HOME_URL;});}}catch(_0x2dcc40){console[_0x587ec2(0xba)](_0x587ec2(0xad),_0x2dcc40);}}(function initStableLayout(){const _0x3d5dc0=a0_0x762d60,_0x57dcfe=(function(){let _0x2e1ab6=!![];return function(_0x24de97,_0xb098cf){const _0x37389e=_0x2e1ab6?function(){const _0x37b978=a0_0x1a73;if(_0xb098cf){const _0x5a8ed4=_0xb098cf[_0x37b978(0x9a)](_0x24de97,arguments);return _0xb098cf=null,_0x5a8ed4;}}:function(){};return _0x2e1ab6=![],_0x37389e;};}()),_0x49149e=document['querySelector'](_0x3d5dc0(0x9d)),_0x19a673=document['getElementById'](_0x3d5dc0(0xc8)),_0x255a1d=document['getElementById'](_0x3d5dc0(0xd5)),_0x4d7362=document[_0x3d5dc0(0xc3)](_0x3d5dc0(0xa6));function _0x375c3d(){const _0x3bd6a6=_0x3d5dc0,_0xca4db7=_0x57dcfe(this,function(){const _0xdc40aa=a0_0x1a73;return _0xca4db7[_0xdc40aa(0x82)]()[_0xdc40aa(0xf7)]('(((.+)+)+)+$')[_0xdc40aa(0x82)]()[_0xdc40aa(0xf0)](_0xca4db7)[_0xdc40aa(0xf7)]('(((.+)+)+)+$');});_0xca4db7();if(!_0x49149e)return;const _0x2f20ff=tg&&tg[_0x3bd6a6(0xdc)]?tg[_0x3bd6a6(0xdc)]:window[_0x3bd6a6(0xc5)];_0x49149e[_0x3bd6a6(0xf9)][_0x3bd6a6(0xd9)]=_0x2f20ff+'px';if(_0x19a673){const _0x4d3286=_0x19a673['offsetHeight'];_0x255a1d[_0x3bd6a6(0xf9)][_0x3bd6a6(0xff)]=_0x4d3286+0x28+'px';}}tg?tg[_0x3d5dc0(0xe1)](_0x3d5dc0(0xca),({isStateStable:_0x55ba89})=>{_0x375c3d();if(_0x55ba89)requestAnimationFrame(()=>{const _0x136056=a0_0x1a73;_0x255a1d[_0x136056(0xdb)]=_0x255a1d['scrollHeight'];});}):window['addEventListener'](_0x3d5dc0(0x94),_0x375c3d),_0x375c3d(),_0x4d7362&&(_0x4d7362[_0x3d5dc0(0x92)](_0x3d5dc0(0x105),()=>{requestAnimationFrame(_0x375c3d);}),_0x4d7362['addEventListener'](_0x3d5dc0(0xbb),()=>{setTimeout(()=>{const _0x454973=a0_0x1a73;_0x255a1d[_0x454973(0xdb)]=_0x255a1d[_0x454973(0xcb)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;function a0_0x3f5b(){const _0x398e4e=['getHours','6.1','ai_chat_messages','function','input','confirmModal','toString','push','3781899ncnUVN','disabled','href','BackButton','Ошибка\x20сети','shiftKey','./router.html','HapticFeedback','keydown','user','textContent','Telegram','Пустой\x20ответ','33XQRsRp','addEventListener','stringify','resize','timestamp','getItem','now','flex','target','apply','value','add','.container','10212472dYRSca','key','text/plain','text','none','success','send_message','clearBtn','messageInput','modalTitle','expand','onClick','notificationOccurred','children','<br>','TG\x20setup\x20error:','remove','medium','Ошибка\x20сервера','message-bubble','initData','5305ZcLzDA','createElement','removeItem','2642320nrEoPJ','12wLNrcq','first_name','typingIndicator','warn','focus','#050505','classList','Начнется\x20новый\x20диалог.','isVersionAtLeast','random','username','setHeaderColor','getElementById','click','innerHeight','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','setItem','inputArea','json','viewportChanged','scrollHeight','querySelectorAll','innerHTML','from','offClick','touchend','parse','div','Действие\x20необратимо.','forEach','chatArea','preventDefault','delete-btn','min','height','Удалить?','scrollTop','viewportHeight','message-time','clear_history','onclick','trim','onEvent','modalText','initDataUnsafe','show','586137vyjcBl','getMinutes','padStart','4476iojDZu','appendChild','impactOccurred','modalCancel','className','error','sendBtn','emptyState','constructor','549680UVCJBF','Enter','debug_uid','12xPbvKO','length','message\x20','search','1645301eKUdyx','style','.message.show-delete','touchstart','disableVerticalSwipes','ready','floor','paddingBottom','Очистить\x20историю?'];a0_0x3f5b=function(){return _0x398e4e;};return a0_0x3f5b();}let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x762d60(0xd5)),emptyState=document[a0_0x762d60(0xc3)](a0_0x762d60(0xef)),messageInput=document[a0_0x762d60(0xc3)](a0_0x762d60(0xa6)),sendBtn=document['getElementById'](a0_0x762d60(0xee)),clearBtn=document['getElementById'](a0_0x762d60(0xa5)),modal=document['getElementById'](a0_0x762d60(0x106)),mTitle=document['getElementById'](a0_0x762d60(0xa7)),mText=document['getElementById'](a0_0x762d60(0xe2));let modalCallback=null;async function callBackend(_0x26cce1,_0x2da12a){const _0x1cc1e6=a0_0x762d60,_0xa67542=tg?.[_0x1cc1e6(0xe3)]?.['user']||{},_0x12c51a=_0xa67542['id']||localStorage[_0x1cc1e6(0x96)](_0x1cc1e6(0xf3))||'d-'+Math[_0x1cc1e6(0xfe)](Math[_0x1cc1e6(0xc0)]()*0x3b9aca00);if(!_0xa67542['id'])localStorage[_0x1cc1e6(0xc7)](_0x1cc1e6(0xf3),_0x12c51a);const _0x47f563={'action':_0x26cce1,'user_id':_0x12c51a,'user_data':{'first_name':_0xa67542[_0x1cc1e6(0xb8)],'username':_0xa67542[_0x1cc1e6(0xc1)]},'init_data':tg?.[_0x1cc1e6(0xb2)]||'',..._0x2da12a},_0x166738=new AbortController(),_0x2be280=setTimeout(()=>_0x166738['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5236d6=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x1cc1e6(0xa0)},'body':JSON[_0x1cc1e6(0x93)](_0x47f563),'signal':_0x166738['signal']});return clearTimeout(_0x2be280),await _0x5236d6[_0x1cc1e6(0xc9)]();}catch(_0x5d3ee7){return{'success':![],'error':String(_0x5d3ee7)};}}function formatTime(_0x5296b6){const _0x4ed1de=a0_0x762d60,_0x37777d=new Date(_0x5296b6);return String(_0x37777d[_0x4ed1de(0x101)]())[_0x4ed1de(0xe7)](0x2,'0')+':'+String(_0x37777d[_0x4ed1de(0xe6)]())[_0x4ed1de(0xe7)](0x2,'0');}function createMessageElement(_0xbfca84,_0x3bdf05){const _0x12edfd=a0_0x762d60,_0x453cdd=document[_0x12edfd(0xb4)](_0x12edfd(0xd2));_0x453cdd[_0x12edfd(0xec)]=_0x12edfd(0xf6)+_0xbfca84['role'];const _0x15288c=document[_0x12edfd(0xb4)](_0x12edfd(0xd2));_0x15288c[_0x12edfd(0xec)]=_0x12edfd(0xb1),_0x15288c[_0x12edfd(0xcd)]=_0xbfca84['content']['replace'](/\n/g,_0x12edfd(0xac));const _0x3b2ad6=document[_0x12edfd(0xb4)]('div');_0x3b2ad6[_0x12edfd(0xec)]=_0x12edfd(0xd7),_0x3b2ad6[_0x12edfd(0xcd)]=_0x12edfd(0xc6),_0x3b2ad6['onclick']=_0x5c50ca=>{_0x5c50ca['stopPropagation'](),confirmDelete(_0x3bdf05);};let _0x5df642;_0x15288c[_0x12edfd(0x92)](_0x12edfd(0xfb),()=>_0x5df642=setTimeout(()=>{const _0x3c2595=_0x12edfd;_0x453cdd[_0x3c2595(0xbd)][_0x3c2595(0x9c)]('show-delete');if(tg?.[_0x3c2595(0x8b)])tg[_0x3c2595(0x8b)][_0x3c2595(0xea)](_0x3c2595(0xaf));},0x1f4)),_0x15288c[_0x12edfd(0x92)](_0x12edfd(0xd0),()=>clearTimeout(_0x5df642));const _0x1d612f=document[_0x12edfd(0xb4)](_0x12edfd(0xd2));return _0x1d612f['className']=_0x12edfd(0xdd),_0x1d612f[_0x12edfd(0x8e)]=formatTime(_0xbfca84[_0x12edfd(0x95)]),_0x453cdd['appendChild'](_0x3b2ad6),_0x453cdd[_0x12edfd(0xe9)](_0x15288c),_0x453cdd['appendChild'](_0x1d612f),_0x453cdd;}function createTypingIndicator(){const _0xdcc3e2=a0_0x762d60,_0x10a572=document[_0xdcc3e2(0xb4)](_0xdcc3e2(0xd2));return _0x10a572[_0xdcc3e2(0xec)]='message\x20ai',_0x10a572['id']=_0xdcc3e2(0xb9),_0x10a572['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x10a572;}function renderMessages(){const _0x2b18fd=a0_0x762d60;Array[_0x2b18fd(0xce)](chatArea[_0x2b18fd(0xab)])['forEach'](_0x4635ca=>{const _0x1f8582=_0x2b18fd;if(_0x4635ca['id']!==_0x1f8582(0xef))_0x4635ca[_0x1f8582(0xae)]();}),messages[_0x2b18fd(0xf5)]>0x0?(emptyState[_0x2b18fd(0xf9)]['display']=_0x2b18fd(0xa2),messages[_0x2b18fd(0xd4)]((_0xff196c,_0x572405)=>chatArea[_0x2b18fd(0xe9)](createMessageElement(_0xff196c,_0x572405)))):emptyState['style']['display']=_0x2b18fd(0x98),requestAnimationFrame(()=>chatArea[_0x2b18fd(0xdb)]=chatArea[_0x2b18fd(0xcb)]);}function autoResizeTextarea(){const _0x127ccc=a0_0x762d60;messageInput[_0x127ccc(0xf9)][_0x127ccc(0xd9)]='auto',messageInput[_0x127ccc(0xf9)][_0x127ccc(0xd9)]=Math[_0x127ccc(0xd8)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x38bfb6=a0_0x762d60,_0x3f7454=messageInput['value']['trim']();sendBtn[_0x38bfb6(0x85)]=!_0x3f7454||isTyping;}async function sendMessage(){const _0x561bd3=a0_0x762d60,_0x34db23=messageInput[_0x561bd3(0x9b)][_0x561bd3(0xe0)]();if(!_0x34db23||isTyping)return;if(tg?.[_0x561bd3(0x8b)])tg['HapticFeedback'][_0x561bd3(0xea)]('light');messages[_0x561bd3(0x83)]({'role':_0x561bd3(0x8d),'content':_0x34db23,'timestamp':Date[_0x561bd3(0x97)]()}),localStorage['setItem'](_0x561bd3(0x103),JSON[_0x561bd3(0x93)](messages)),renderMessages(),messageInput[_0x561bd3(0x9b)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x561bd3(0xe9)](createTypingIndicator()),chatArea[_0x561bd3(0xdb)]=chatArea[_0x561bd3(0xcb)];const _0x31687a=await callBackend(_0x561bd3(0xa4),{'message':_0x34db23});isTyping=![];const _0x5b9725=document[_0x561bd3(0xc3)](_0x561bd3(0xb9));if(_0x5b9725)_0x5b9725[_0x561bd3(0xae)]();let _0x2b28b4=_0x561bd3(0x88);if(_0x31687a[_0x561bd3(0xa3)]){_0x2b28b4=_0x31687a[_0x561bd3(0xa1)]||_0x561bd3(0x90);if(tg?.[_0x561bd3(0x8b)])tg[_0x561bd3(0x8b)][_0x561bd3(0xaa)]('success');}else{_0x2b28b4=_0x31687a[_0x561bd3(0xed)]||_0x561bd3(0xb0);if(tg?.[_0x561bd3(0x8b)])tg[_0x561bd3(0x8b)][_0x561bd3(0xaa)](_0x561bd3(0xed));}messages[_0x561bd3(0x83)]({'role':'ai','content':_0x2b28b4,'timestamp':Date[_0x561bd3(0x97)]()}),localStorage['setItem'](_0x561bd3(0x103),JSON[_0x561bd3(0x93)](messages)),renderMessages();}function confirmDelete(_0x377505){const _0x28d911=a0_0x762d60;if(mTitle)mTitle[_0x28d911(0x8e)]=_0x28d911(0xda);if(mText)mText[_0x28d911(0x8e)]=_0x28d911(0xd3);modalCallback=()=>{const _0x3d0788=_0x28d911;messages['splice'](_0x377505,0x1),localStorage[_0x3d0788(0xc7)](_0x3d0788(0x103),JSON[_0x3d0788(0x93)](messages)),renderMessages();},modal[_0x28d911(0xbd)][_0x28d911(0x9c)](_0x28d911(0xe4));}if(clearBtn)clearBtn['onclick']=()=>{const _0x3d58d4=a0_0x762d60;if(!messages[_0x3d58d4(0xf5)])return;if(mTitle)mTitle[_0x3d58d4(0x8e)]=_0x3d58d4(0x100);if(mText)mText[_0x3d58d4(0x8e)]=_0x3d58d4(0xbe);modalCallback=async()=>{const _0x284029=_0x3d58d4;messages=[],localStorage[_0x284029(0xb5)](_0x284029(0x103)),renderMessages(),callBackend(_0x284029(0xde),{});},modal[_0x3d58d4(0xbd)][_0x3d58d4(0x9c)](_0x3d58d4(0xe4));};function a0_0x1a73(_0x214702,_0x461a05){_0x214702=_0x214702-0x82;const _0x22ecd0=a0_0x3f5b();let _0x18583c=_0x22ecd0[_0x214702];return _0x18583c;}document[a0_0x762d60(0xc3)](a0_0x762d60(0xeb))[a0_0x762d60(0xdf)]=()=>modal[a0_0x762d60(0xbd)][a0_0x762d60(0xae)](a0_0x762d60(0xe4)),document[a0_0x762d60(0xc3)]('modalConfirm')[a0_0x762d60(0xdf)]=()=>{const _0x5d8ed1=a0_0x762d60;if(modalCallback)modalCallback();modal['classList'][_0x5d8ed1(0xae)]('show');},messageInput[a0_0x762d60(0x92)](a0_0x762d60(0x105),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x762d60(0x8c),_0x56186f=>{const _0x36cf87=a0_0x762d60;_0x56186f[_0x36cf87(0x9f)]===_0x36cf87(0xf2)&&!_0x56186f[_0x36cf87(0x89)]&&(_0x56186f[_0x36cf87(0xd6)](),sendMessage());}),sendBtn[a0_0x762d60(0xdf)]=sendMessage,document[a0_0x762d60(0x92)](a0_0x762d60(0xc4),_0x3c8890=>{const _0x2caf9f=a0_0x762d60;document[_0x2caf9f(0xcc)](_0x2caf9f(0xfa))[_0x2caf9f(0xd4)](_0x36de6b=>{const _0x272a06=_0x2caf9f;if(!_0x36de6b['contains'](_0x3c8890[_0x272a06(0x99)]))_0x36de6b['classList'][_0x272a06(0xae)]('show-delete');});});const saved=localStorage['getItem'](a0_0x762d60(0x103));if(saved)try{messages=JSON[a0_0x762d60(0xd1)](saved),renderMessages();}catch(a0_0x3b38da){}updateSendButton();