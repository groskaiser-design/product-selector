const a0_0x3291c1=a0_0x4d53;(function(_0x16ce56,_0x356a0a){const _0x27ba3f=a0_0x4d53,_0x7ad38e=_0x16ce56();while(!![]){try{const _0x489f1c=-parseInt(_0x27ba3f(0xee))/0x1*(parseInt(_0x27ba3f(0x96))/0x2)+parseInt(_0x27ba3f(0x7a))/0x3+-parseInt(_0x27ba3f(0xdc))/0x4*(parseInt(_0x27ba3f(0xcd))/0x5)+-parseInt(_0x27ba3f(0x88))/0x6*(-parseInt(_0x27ba3f(0x100))/0x7)+parseInt(_0x27ba3f(0xe2))/0x8*(-parseInt(_0x27ba3f(0xba))/0x9)+-parseInt(_0x27ba3f(0xde))/0xa*(parseInt(_0x27ba3f(0xd3))/0xb)+parseInt(_0x27ba3f(0xe4))/0xc;if(_0x489f1c===_0x356a0a)break;else _0x7ad38e['push'](_0x7ad38e['shift']());}catch(_0x2c7c40){_0x7ad38e['push'](_0x7ad38e['shift']());}}}(a0_0x6985,0xb875d));const tg=window[a0_0x3291c1(0xa7)]?.[a0_0x3291c1(0xca)],HOME_URL=a0_0x3291c1(0xc1);function setupTelegramBackButton(){const _0x511b73=a0_0x3291c1;if(!tg)return;try{tg[_0x511b73(0xa4)](),tg[_0x511b73(0x82)](),tg[_0x511b73(0xfd)]?.(_0x511b73(0xb2));if(tg[_0x511b73(0xaf)]?.(_0x511b73(0x93)))tg['disableVerticalSwipes']?.();const _0x4370ef=tg['BackButton'];if(_0x4370ef){_0x4370ef[_0x511b73(0xb3)]();if(typeof _0x4370ef['offClick']==='function')try{_0x4370ef[_0x511b73(0xc5)]();}catch(_0x57fdd3){}_0x4370ef[_0x511b73(0x92)](()=>{const _0x2d4d9e=_0x511b73;if(tg[_0x2d4d9e(0x8a)])tg['HapticFeedback'][_0x2d4d9e(0xf7)]('light');location[_0x2d4d9e(0x8f)]=HOME_URL;});}}catch(_0x3084c9){console[_0x511b73(0xc3)](_0x511b73(0xd4),_0x3084c9);}}(function initStableLayout(){const _0x41a73d=a0_0x3291c1,_0x488f01=(function(){let _0x28c4f5=!![];return function(_0x111530,_0x4cf2ec){const _0x48065e=_0x28c4f5?function(){const _0x1f5ddc=a0_0x4d53;if(_0x4cf2ec){const _0x25c06d=_0x4cf2ec[_0x1f5ddc(0xf5)](_0x111530,arguments);return _0x4cf2ec=null,_0x25c06d;}}:function(){};return _0x28c4f5=![],_0x48065e;};}()),_0x4ebcab=document[_0x41a73d(0xdd)](_0x41a73d(0xa9)),_0xb597dc=document[_0x41a73d(0xdb)](_0x41a73d(0x84)),_0x2f1c12=document['getElementById'](_0x41a73d(0x102)),_0x1ead8d=document['getElementById'](_0x41a73d(0x8c));function _0x4c433a(){const _0x44d2f5=_0x41a73d,_0x3b5f53=_0x488f01(this,function(){const _0x559f66=a0_0x4d53;return _0x3b5f53['toString']()[_0x559f66(0xd0)](_0x559f66(0xae))[_0x559f66(0xda)]()[_0x559f66(0xf3)](_0x3b5f53)[_0x559f66(0xd0)](_0x559f66(0xae));});_0x3b5f53();if(!_0x4ebcab)return;const _0x2938ac=tg&&tg[_0x44d2f5(0x7e)]?tg[_0x44d2f5(0x7e)]:window['innerHeight'];_0x4ebcab[_0x44d2f5(0xfb)][_0x44d2f5(0xdf)]=_0x2938ac+'px';if(_0xb597dc){const _0xc7bda4=_0xb597dc[_0x44d2f5(0xf6)];_0x2f1c12[_0x44d2f5(0xfb)][_0x44d2f5(0xa8)]=_0xc7bda4+0x28+'px';}}tg?tg[_0x41a73d(0xf1)]('viewportChanged',({isStateStable:_0x34a62c})=>{_0x4c433a();if(_0x34a62c)requestAnimationFrame(()=>{const _0x1f7a69=a0_0x4d53;_0x2f1c12[_0x1f7a69(0x8b)]=_0x2f1c12[_0x1f7a69(0x9e)];});}):window['addEventListener']('resize',_0x4c433a),_0x4c433a(),_0x1ead8d&&(_0x1ead8d['addEventListener'](_0x41a73d(0xd8),()=>{requestAnimationFrame(_0x4c433a);}),_0x1ead8d['addEventListener'](_0x41a73d(0xf2),()=>{setTimeout(()=>{const _0x38e1bd=a0_0x4d53;_0x2f1c12['scrollTop']=_0x2f1c12[_0x38e1bd(0x9e)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3291c1(0xcf),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById']('chatArea'),emptyState=document[a0_0x3291c1(0xdb)]('emptyState'),messageInput=document[a0_0x3291c1(0xdb)](a0_0x3291c1(0x8c)),sendBtn=document['getElementById'](a0_0x3291c1(0xe0)),clearBtn=document[a0_0x3291c1(0xdb)](a0_0x3291c1(0xc0)),modal=document['getElementById'](a0_0x3291c1(0x81)),mTitle=document[a0_0x3291c1(0xdb)]('modalTitle'),mText=document[a0_0x3291c1(0xdb)](a0_0x3291c1(0x98));let modalCallback=null;async function callBackend(_0x20ae86,_0x5dad26){const _0x16e887=a0_0x3291c1,_0x2ed008=tg?.[_0x16e887(0x89)]?.['user']||{},_0x932779=_0x2ed008['id']||localStorage['getItem'](_0x16e887(0xd7))||'d-'+Math[_0x16e887(0xe5)](Math['random']()*0x3b9aca00);if(!_0x2ed008['id'])localStorage[_0x16e887(0x91)](_0x16e887(0xd7),_0x932779);const _0x29b919={'action':_0x20ae86,'user_id':_0x932779,'user_data':{'first_name':_0x2ed008[_0x16e887(0xe1)],'username':_0x2ed008[_0x16e887(0xcc)]},'init_data':tg?.[_0x16e887(0xa2)]||'',..._0x5dad26},_0x27029f=new AbortController(),_0x3c2fc8=setTimeout(()=>_0x27029f[_0x16e887(0xef)](),REQUEST_TIMEOUT_MS);try{const _0x5c75d5=await fetch(BACKEND_URL,{'method':_0x16e887(0xce),'headers':{'Content-Type':_0x16e887(0xff)},'body':JSON[_0x16e887(0x9d)](_0x29b919),'signal':_0x27029f[_0x16e887(0xf9)]});return clearTimeout(_0x3c2fc8),await _0x5c75d5[_0x16e887(0xec)]();}catch(_0x24494d){return{'success':![],'error':String(_0x24494d)};}}function formatTime(_0x477743){const _0x4f6c9e=a0_0x3291c1,_0x40a537=new Date(_0x477743);return String(_0x40a537[_0x4f6c9e(0xc6)]())['padStart'](0x2,'0')+':'+String(_0x40a537[_0x4f6c9e(0xf4)]())[_0x4f6c9e(0x9c)](0x2,'0');}function createMessageElement(_0x1c7147,_0x56dbd8){const _0x424804=a0_0x3291c1,_0x545b77=document[_0x424804(0x80)](_0x424804(0xeb));_0x545b77['className']=_0x424804(0x8e)+_0x1c7147[_0x424804(0xb1)];const _0x2d71bb=document[_0x424804(0x80)](_0x424804(0xeb));_0x2d71bb[_0x424804(0xb7)]=_0x424804(0x7d),_0x2d71bb[_0x424804(0xe7)]=_0x1c7147[_0x424804(0xc7)][_0x424804(0xea)](/\n/g,_0x424804(0xc8));const _0x464f5c=document[_0x424804(0x80)](_0x424804(0xeb));_0x464f5c[_0x424804(0xb7)]=_0x424804(0x9f),_0x464f5c[_0x424804(0xe7)]=_0x424804(0xa0),_0x464f5c['onclick']=_0x3b0f86=>{const _0x1df20a=_0x424804;_0x3b0f86[_0x1df20a(0xbd)](),confirmDelete(_0x56dbd8);};let _0x36760f;_0x2d71bb[_0x424804(0xe8)](_0x424804(0x94),()=>_0x36760f=setTimeout(()=>{const _0x17fd56=_0x424804;_0x545b77[_0x17fd56(0x9a)][_0x17fd56(0xac)](_0x17fd56(0x95));if(tg?.[_0x17fd56(0x8a)])tg[_0x17fd56(0x8a)][_0x17fd56(0xf7)](_0x17fd56(0x85));},0x1f4)),_0x2d71bb[_0x424804(0xe8)]('touchend',()=>clearTimeout(_0x36760f));const _0x53482d=document[_0x424804(0x80)]('div');return _0x53482d['className']=_0x424804(0xd9),_0x53482d[_0x424804(0xed)]=formatTime(_0x1c7147[_0x424804(0xe6)]),_0x545b77[_0x424804(0xf0)](_0x464f5c),_0x545b77[_0x424804(0xf0)](_0x2d71bb),_0x545b77[_0x424804(0xf0)](_0x53482d),_0x545b77;}function createTypingIndicator(){const _0x3b069e=a0_0x3291c1,_0x2f465a=document['createElement']('div');return _0x2f465a[_0x3b069e(0xb7)]=_0x3b069e(0xd1),_0x2f465a['id']='typingIndicator',_0x2f465a[_0x3b069e(0xe7)]=_0x3b069e(0xbe),_0x2f465a;}function renderMessages(){const _0x29fb75=a0_0x3291c1;Array['from'](chatArea[_0x29fb75(0x7b)])[_0x29fb75(0xa1)](_0x427ed3=>{const _0xab2573=_0x29fb75;if(_0x427ed3['id']!==_0xab2573(0xd5))_0x427ed3[_0xab2573(0xfc)]();}),messages[_0x29fb75(0xa6)]>0x0?(emptyState[_0x29fb75(0xfb)]['display']=_0x29fb75(0xa3),messages['forEach']((_0x56b816,_0x486fe2)=>chatArea[_0x29fb75(0xf0)](createMessageElement(_0x56b816,_0x486fe2)))):emptyState[_0x29fb75(0xfb)][_0x29fb75(0xb9)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x29fb75(0x9e)]);}function autoResizeTextarea(){const _0x11aef5=a0_0x3291c1;messageInput[_0x11aef5(0xfb)]['height']=_0x11aef5(0xfe),messageInput['style'][_0x11aef5(0xdf)]=Math[_0x11aef5(0x7c)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x3260ab=a0_0x3291c1,_0x1fca72=messageInput[_0x3260ab(0x97)][_0x3260ab(0xa5)]();sendBtn['disabled']=!_0x1fca72||isTyping;}async function sendMessage(){const _0x1c3ceb=a0_0x3291c1,_0x4ed49b=messageInput[_0x1c3ceb(0x97)]['trim']();if(!_0x4ed49b||isTyping)return;if(tg?.[_0x1c3ceb(0x8a)])tg['HapticFeedback'][_0x1c3ceb(0xf7)](_0x1c3ceb(0x83));messages['push']({'role':'user','content':_0x4ed49b,'timestamp':Date[_0x1c3ceb(0xb8)]()}),localStorage['setItem'](_0x1c3ceb(0xd6),JSON[_0x1c3ceb(0x9d)](messages)),renderMessages(),messageInput[_0x1c3ceb(0x97)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1c3ceb(0xf0)](createTypingIndicator()),chatArea[_0x1c3ceb(0x8b)]=chatArea[_0x1c3ceb(0x9e)];const _0x332c91=await callBackend(_0x1c3ceb(0xcb),{'message':_0x4ed49b});isTyping=![];const _0x219c04=document[_0x1c3ceb(0xdb)](_0x1c3ceb(0x86));if(_0x219c04)_0x219c04['remove']();let _0x3261db=_0x1c3ceb(0xc2);if(_0x332c91[_0x1c3ceb(0xe9)]){_0x3261db=_0x332c91[_0x1c3ceb(0x9b)]||_0x1c3ceb(0x79);if(tg?.[_0x1c3ceb(0x8a)])tg['HapticFeedback'][_0x1c3ceb(0xb4)]('success');}else{_0x3261db=_0x332c91[_0x1c3ceb(0xbb)]||_0x1c3ceb(0xc9);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x1c3ceb(0xb4)](_0x1c3ceb(0xbb));}messages['push']({'role':'ai','content':_0x3261db,'timestamp':Date[_0x1c3ceb(0xb8)]()}),localStorage[_0x1c3ceb(0x91)](_0x1c3ceb(0xd6),JSON[_0x1c3ceb(0x9d)](messages)),renderMessages();}function a0_0x6985(){const _0x437f63=['createElement','confirmModal','expand','light','inputArea','medium','typingIndicator','getItem','1212dkXAAc','initDataUnsafe','HapticFeedback','scrollTop','messageInput','onclick','message\x20','href','preventDefault','setItem','onClick','6.1','touchstart','show-delete','403838AIOSlS','value','modalText','Очистить\x20историю?','classList','text','padStart','stringify','scrollHeight','delete-btn','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','forEach','initData','none','ready','trim','length','Telegram','paddingBottom','.container','querySelectorAll','Удалить?','add','Начнется\x20новый\x20диалог.','(((.+)+)+)+$','isVersionAtLeast','modalCancel','role','#050505','show','notificationOccurred','splice','keydown','className','now','display','674712rhtKaT','error','contains','stopPropagation','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','target','clearBtn','./router.html','Ошибка\x20сети','warn','.message.show-delete','offClick','getHours','content','<br>','Ошибка\x20сервера','WebApp','send_message','username','2071735OkONak','POST','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','search','message\x20ai','Действие\x20необратимо.','188782lBsneT','TG\x20setup\x20error:','emptyState','ai_chat_messages','debug_uid','input','message-time','toString','getElementById','4ylzsrU','querySelector','60BZrnQw','height','sendBtn','first_name','128ReemZw','parse','21069876AKOkJL','floor','timestamp','innerHTML','addEventListener','success','replace','div','json','textContent','4zeMYVI','abort','appendChild','onEvent','focus','constructor','getMinutes','apply','offsetHeight','impactOccurred','click','signal','key','style','remove','setHeaderColor','auto','text/plain','50141JwRRfR','modalConfirm','chatArea','Пустой\x20ответ','231849hzAFrV','children','min','message-bubble','viewportHeight','clear_history'];a0_0x6985=function(){return _0x437f63;};return a0_0x6985();}function confirmDelete(_0x27d310){const _0x381608=a0_0x3291c1;if(mTitle)mTitle['textContent']=_0x381608(0xab);if(mText)mText['textContent']=_0x381608(0xd2);modalCallback=()=>{const _0x5b508a=_0x381608;messages[_0x5b508a(0xb5)](_0x27d310,0x1),localStorage['setItem'](_0x5b508a(0xd6),JSON[_0x5b508a(0x9d)](messages)),renderMessages();},modal['classList']['add']('show');}if(clearBtn)clearBtn[a0_0x3291c1(0x8d)]=()=>{const _0x4f146c=a0_0x3291c1;if(!messages[_0x4f146c(0xa6)])return;if(mTitle)mTitle[_0x4f146c(0xed)]=_0x4f146c(0x99);if(mText)mText[_0x4f146c(0xed)]=_0x4f146c(0xad);modalCallback=async()=>{const _0x2a1c6d=_0x4f146c;messages=[],localStorage['removeItem'](_0x2a1c6d(0xd6)),renderMessages(),callBackend(_0x2a1c6d(0x7f),{});},modal['classList']['add'](_0x4f146c(0xb3));};function a0_0x4d53(_0x1c14b0,_0x1896a4){_0x1c14b0=_0x1c14b0-0x79;const _0x9ba13b=a0_0x6985();let _0x4c060c=_0x9ba13b[_0x1c14b0];return _0x4c060c;}document['getElementById'](a0_0x3291c1(0xb0))[a0_0x3291c1(0x8d)]=()=>modal[a0_0x3291c1(0x9a)][a0_0x3291c1(0xfc)](a0_0x3291c1(0xb3)),document['getElementById'](a0_0x3291c1(0x101))['onclick']=()=>{const _0x26ad14=a0_0x3291c1;if(modalCallback)modalCallback();modal[_0x26ad14(0x9a)][_0x26ad14(0xfc)](_0x26ad14(0xb3));},messageInput[a0_0x3291c1(0xe8)](a0_0x3291c1(0xd8),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3291c1(0xe8)](a0_0x3291c1(0xb6),_0x46352a=>{const _0x34a78a=a0_0x3291c1;_0x46352a[_0x34a78a(0xfa)]==='Enter'&&!_0x46352a['shiftKey']&&(_0x46352a[_0x34a78a(0x90)](),sendMessage());}),sendBtn[a0_0x3291c1(0x8d)]=sendMessage,document[a0_0x3291c1(0xe8)](a0_0x3291c1(0xf8),_0x46f950=>{const _0x417470=a0_0x3291c1;document[_0x417470(0xaa)](_0x417470(0xc4))[_0x417470(0xa1)](_0x508519=>{const _0x22d12e=_0x417470;if(!_0x508519[_0x22d12e(0xbc)](_0x46f950[_0x22d12e(0xbf)]))_0x508519[_0x22d12e(0x9a)][_0x22d12e(0xfc)](_0x22d12e(0x95));});});const saved=localStorage[a0_0x3291c1(0x87)](a0_0x3291c1(0xd6));if(saved)try{messages=JSON[a0_0x3291c1(0xe3)](saved),renderMessages();}catch(a0_0x3b538a){}updateSendButton();