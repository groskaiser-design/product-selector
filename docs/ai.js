const a0_0x797368=a0_0x2144;(function(_0x324a3f,_0x413e3f){const _0x5dad29=a0_0x2144,_0x47013c=_0x324a3f();while(!![]){try{const _0x2ac3db=-parseInt(_0x5dad29(0xfe))/0x1+-parseInt(_0x5dad29(0x123))/0x2+parseInt(_0x5dad29(0xa7))/0x3+parseInt(_0x5dad29(0xf1))/0x4+parseInt(_0x5dad29(0xc8))/0x5+-parseInt(_0x5dad29(0xd1))/0x6*(parseInt(_0x5dad29(0xee))/0x7)+parseInt(_0x5dad29(0xca))/0x8*(parseInt(_0x5dad29(0xe6))/0x9);if(_0x2ac3db===_0x413e3f)break;else _0x47013c['push'](_0x47013c['shift']());}catch(_0x49d51d){_0x47013c['push'](_0x47013c['shift']());}}}(a0_0x57a8,0xa06f4));const tg=window[a0_0x797368(0xab)]?.[a0_0x797368(0xfc)],HOME_URL=a0_0x797368(0x122);function setupTelegramBackButton(){const _0x1d472b=a0_0x797368,_0xe05500=(function(){let _0x4f3b1a=!![];return function(_0x110cfe,_0x573e17){const _0x2b13d0=_0x4f3b1a?function(){const _0x3bd3e9=a0_0x2144;if(_0x573e17){const _0x5902f8=_0x573e17[_0x3bd3e9(0xf8)](_0x110cfe,arguments);return _0x573e17=null,_0x5902f8;}}:function(){};return _0x4f3b1a=![],_0x2b13d0;};}()),_0x27ba81=_0xe05500(this,function(){const _0x5f4329=a0_0x2144;return _0x27ba81[_0x5f4329(0xd2)]()[_0x5f4329(0xd0)](_0x5f4329(0xbd))[_0x5f4329(0xd2)]()[_0x5f4329(0xeb)](_0x27ba81)[_0x5f4329(0xd0)](_0x5f4329(0xbd));});_0x27ba81();if(!tg)return;try{tg['ready'](),tg[_0x1d472b(0x11e)](),tg[_0x1d472b(0x103)]?.(_0x1d472b(0xaf));if(tg['isVersionAtLeast']?.(_0x1d472b(0x118)))tg[_0x1d472b(0xd4)]?.();const _0x96fca1=tg[_0x1d472b(0xfd)];if(_0x96fca1){_0x96fca1[_0x1d472b(0xce)]();if(typeof _0x96fca1[_0x1d472b(0xbf)]===_0x1d472b(0xd7))try{_0x96fca1[_0x1d472b(0xbf)]();}catch(_0x383bc4){}_0x96fca1[_0x1d472b(0x114)](()=>{const _0x3f40a9=_0x1d472b;if(tg[_0x3f40a9(0xcd)])tg[_0x3f40a9(0xcd)][_0x3f40a9(0xfb)](_0x3f40a9(0xd8));location[_0x3f40a9(0xb2)]=HOME_URL;});}}catch(_0x125e88){console['warn']('TG\x20setup\x20error:',_0x125e88);}}(function initStableLayout(){const _0x2ce2a9=a0_0x797368,_0x7764a8=document[_0x2ce2a9(0xf4)](_0x2ce2a9(0x106)),_0x3e299c=document['getElementById'](_0x2ce2a9(0xc7)),_0x28d087=document[_0x2ce2a9(0x11c)](_0x2ce2a9(0xc5)),_0x22f662=document[_0x2ce2a9(0x11c)]('messageInput');function _0x237bfc(){const _0x2c49da=_0x2ce2a9;if(!_0x7764a8)return;const _0x180fb3=tg&&tg[_0x2c49da(0xff)]?tg['viewportHeight']:window[_0x2c49da(0xb8)];_0x7764a8[_0x2c49da(0xb4)]['height']=_0x180fb3+'px';if(_0x3e299c){const _0x3138a7=_0x3e299c[_0x2c49da(0x104)];_0x28d087[_0x2c49da(0xb4)]['paddingBottom']=_0x3138a7+0x28+'px';}}tg?tg['onEvent'](_0x2ce2a9(0x127),({isStateStable:_0x1263c2})=>{_0x237bfc();if(_0x1263c2)requestAnimationFrame(()=>{const _0x54de6f=a0_0x2144;_0x28d087[_0x54de6f(0xd5)]=_0x28d087[_0x54de6f(0xa5)];});}):window[_0x2ce2a9(0xdf)](_0x2ce2a9(0xe4),_0x237bfc),_0x237bfc(),_0x22f662&&(_0x22f662['addEventListener']('input',()=>{requestAnimationFrame(_0x237bfc);}),_0x22f662['addEventListener'](_0x2ce2a9(0x107),()=>{setTimeout(()=>{const _0x741ba6=a0_0x2144;_0x28d087[_0x741ba6(0xd5)]=_0x28d087[_0x741ba6(0xa5)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;function a0_0x2144(_0x2efba9,_0x12f176){_0x2efba9=_0x2efba9-0xa5;const _0x4076f1=a0_0x57a8();let _0x471fc1=_0x4076f1[_0x2efba9];return _0x471fc1;}let messages=[],isTyping=![];const chatArea=document[a0_0x797368(0x11c)](a0_0x797368(0xc5)),emptyState=document[a0_0x797368(0x11c)]('emptyState'),messageInput=document[a0_0x797368(0x11c)](a0_0x797368(0xcb)),sendBtn=document[a0_0x797368(0x11c)](a0_0x797368(0xe3)),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0x797368(0x11c)](a0_0x797368(0x10a)),mTitle=document[a0_0x797368(0x11c)](a0_0x797368(0xf5)),mText=document[a0_0x797368(0x11c)](a0_0x797368(0xcc));let modalCallback=null;async function callBackend(_0x2ef6d6,_0x2fbdbe){const _0x188230=a0_0x797368,_0x400c59=tg?.[_0x188230(0xb7)]?.['user']||{},_0x8f3ad9=_0x400c59['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x188230(0xdd)](Math[_0x188230(0xbe)]()*0x3b9aca00);if(!_0x400c59['id'])localStorage[_0x188230(0x110)](_0x188230(0x120),_0x8f3ad9);const _0x215d3e={'action':_0x2ef6d6,'user_id':_0x8f3ad9,'user_data':{'first_name':_0x400c59[_0x188230(0x116)],'username':_0x400c59['username']},'init_data':tg?.[_0x188230(0x115)]||'',..._0x2fbdbe},_0x1e4f91=new AbortController(),_0x265e74=setTimeout(()=>_0x1e4f91['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5f1b96=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x188230(0xc3)},'body':JSON[_0x188230(0x119)](_0x215d3e),'signal':_0x1e4f91[_0x188230(0xc4)]});return clearTimeout(_0x265e74),await _0x5f1b96[_0x188230(0xe9)]();}catch(_0x2d044a){return{'success':![],'error':String(_0x2d044a)};}}function formatTime(_0xa3f855){const _0x2948ce=a0_0x797368,_0x7b6f85=new Date(_0xa3f855);return String(_0x7b6f85[_0x2948ce(0x10c)]())['padStart'](0x2,'0')+':'+String(_0x7b6f85[_0x2948ce(0xc9)]())['padStart'](0x2,'0');}function createMessageElement(_0x56687d,_0x502ca5){const _0xce72a5=a0_0x797368,_0x400781=document[_0xce72a5(0xf7)](_0xce72a5(0xba));_0x400781[_0xce72a5(0xde)]=_0xce72a5(0xcf)+_0x56687d[_0xce72a5(0x126)];const _0x22efa2=document[_0xce72a5(0xf7)](_0xce72a5(0xba));_0x22efa2[_0xce72a5(0xde)]=_0xce72a5(0xd3),_0x22efa2[_0xce72a5(0xad)]=_0x56687d[_0xce72a5(0xea)][_0xce72a5(0xd9)](/\n/g,_0xce72a5(0xd6));const _0x297d35=document[_0xce72a5(0xf7)](_0xce72a5(0xba));_0x297d35[_0xce72a5(0xde)]=_0xce72a5(0xe1),_0x297d35[_0xce72a5(0xad)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x297d35[_0xce72a5(0xf2)]=_0x109ee6=>{const _0x365edc=_0xce72a5;_0x109ee6[_0x365edc(0xbc)](),confirmDelete(_0x502ca5);};let _0x4a6d16;_0x22efa2[_0xce72a5(0xdf)](_0xce72a5(0x105),()=>_0x4a6d16=setTimeout(()=>{const _0x53f04c=_0xce72a5;_0x400781['classList'][_0x53f04c(0xb0)](_0x53f04c(0x11b));if(tg?.[_0x53f04c(0xcd)])tg[_0x53f04c(0xcd)]['impactOccurred'](_0x53f04c(0xed));},0x1f4)),_0x22efa2[_0xce72a5(0xdf)](_0xce72a5(0xc0),()=>clearTimeout(_0x4a6d16));const _0x20308a=document[_0xce72a5(0xf7)]('div');return _0x20308a[_0xce72a5(0xde)]=_0xce72a5(0xa9),_0x20308a[_0xce72a5(0xb5)]=formatTime(_0x56687d[_0xce72a5(0xc2)]),_0x400781['appendChild'](_0x297d35),_0x400781[_0xce72a5(0x101)](_0x22efa2),_0x400781['appendChild'](_0x20308a),_0x400781;}function createTypingIndicator(){const _0x11be7b=a0_0x797368,_0x5166c0=document[_0x11be7b(0xf7)](_0x11be7b(0xba));return _0x5166c0[_0x11be7b(0xde)]='message\x20ai',_0x5166c0['id']=_0x11be7b(0x100),_0x5166c0[_0x11be7b(0xad)]=_0x11be7b(0x113),_0x5166c0;}function renderMessages(){const _0x43403b=a0_0x797368;Array[_0x43403b(0xdc)](chatArea[_0x43403b(0xec)])[_0x43403b(0xe2)](_0x5135d9=>{const _0x585fd4=_0x43403b;if(_0x5135d9['id']!==_0x585fd4(0xda))_0x5135d9[_0x585fd4(0xe7)]();}),messages[_0x43403b(0xf0)]>0x0?(emptyState[_0x43403b(0xb4)][_0x43403b(0x111)]=_0x43403b(0x121),messages[_0x43403b(0xe2)]((_0x3a7d6d,_0x44e9d0)=>chatArea[_0x43403b(0x101)](createMessageElement(_0x3a7d6d,_0x44e9d0)))):emptyState[_0x43403b(0xb4)][_0x43403b(0x111)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x8c5861=a0_0x797368;messageInput[_0x8c5861(0xb4)][_0x8c5861(0xf9)]=_0x8c5861(0xa6),messageInput[_0x8c5861(0xb4)][_0x8c5861(0xf9)]=Math[_0x8c5861(0x10e)](messageInput[_0x8c5861(0xa5)],0x78)+'px';}function updateSendButton(){const _0x2734a8=a0_0x797368,_0x35bacb=messageInput[_0x2734a8(0xe0)][_0x2734a8(0x10f)]();sendBtn['disabled']=!_0x35bacb||isTyping;}async function sendMessage(){const _0x4b9ce7=a0_0x797368,_0x778d59=messageInput[_0x4b9ce7(0xe0)][_0x4b9ce7(0x10f)]();if(!_0x778d59||isTyping)return;if(tg?.[_0x4b9ce7(0xcd)])tg[_0x4b9ce7(0xcd)][_0x4b9ce7(0xfb)](_0x4b9ce7(0xd8));messages['push']({'role':_0x4b9ce7(0xb3),'content':_0x778d59,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x4b9ce7(0x119)](messages)),renderMessages(),messageInput[_0x4b9ce7(0xe0)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4b9ce7(0x101)](createTypingIndicator()),chatArea[_0x4b9ce7(0xd5)]=chatArea[_0x4b9ce7(0xa5)];const _0x219205=await callBackend(_0x4b9ce7(0xb1),{'message':_0x778d59});isTyping=![];const _0x917a64=document[_0x4b9ce7(0x11c)]('typingIndicator');if(_0x917a64)_0x917a64['remove']();let _0x589c78=_0x4b9ce7(0xe5);if(_0x219205['success']){_0x589c78=_0x219205[_0x4b9ce7(0x112)]||_0x4b9ce7(0xa8);if(tg?.[_0x4b9ce7(0xcd)])tg[_0x4b9ce7(0xcd)][_0x4b9ce7(0xfa)](_0x4b9ce7(0x124));}else{_0x589c78=_0x219205[_0x4b9ce7(0xbb)]||_0x4b9ce7(0x11f);if(tg?.[_0x4b9ce7(0xcd)])tg[_0x4b9ce7(0xcd)][_0x4b9ce7(0xfa)]('error');}messages[_0x4b9ce7(0x125)]({'role':'ai','content':_0x589c78,'timestamp':Date[_0x4b9ce7(0x108)]()}),localStorage[_0x4b9ce7(0x110)](_0x4b9ce7(0xb6),JSON[_0x4b9ce7(0x119)](messages)),renderMessages();}function confirmDelete(_0x4d5a47){const _0xe2c21a=a0_0x797368;if(mTitle)mTitle[_0xe2c21a(0xb5)]=_0xe2c21a(0xef);if(mText)mText[_0xe2c21a(0xb5)]=_0xe2c21a(0x117);modalCallback=()=>{const _0x563f00=_0xe2c21a;messages[_0x563f00(0xc1)](_0x4d5a47,0x1),localStorage[_0x563f00(0x110)](_0x563f00(0xb6),JSON[_0x563f00(0x119)](messages)),renderMessages();},modal[_0xe2c21a(0xdb)][_0xe2c21a(0xb0)]('show');}if(clearBtn)clearBtn[a0_0x797368(0xf2)]=()=>{const _0x12b5e0=a0_0x797368;if(!messages['length'])return;if(mTitle)mTitle[_0x12b5e0(0xb5)]=_0x12b5e0(0x10d);if(mText)mText['textContent']=_0x12b5e0(0xac);modalCallback=async()=>{const _0x30b0e1=_0x12b5e0;messages=[],localStorage[_0x30b0e1(0x10b)](_0x30b0e1(0xb6)),renderMessages(),callBackend(_0x30b0e1(0x11d),{});},modal[_0x12b5e0(0xdb)]['add']('show');};document[a0_0x797368(0x11c)](a0_0x797368(0xe8))[a0_0x797368(0xf2)]=()=>modal['classList']['remove']('show'),document[a0_0x797368(0x11c)]('modalConfirm')[a0_0x797368(0xf2)]=()=>{const _0x51ed98=a0_0x797368;if(modalCallback)modalCallback();modal['classList'][_0x51ed98(0xe7)](_0x51ed98(0xce));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x797368(0xdf)]('keydown',_0x354864=>{const _0x481ef1=a0_0x797368;_0x354864[_0x481ef1(0x109)]===_0x481ef1(0xf3)&&!_0x354864[_0x481ef1(0xc6)]&&(_0x354864['preventDefault'](),sendMessage());}),sendBtn[a0_0x797368(0xf2)]=sendMessage,document[a0_0x797368(0xdf)](a0_0x797368(0xae),_0xca6e68=>{const _0x3a7673=a0_0x797368;document[_0x3a7673(0x11a)](_0x3a7673(0x102))[_0x3a7673(0xe2)](_0x2c9869=>{const _0x778551=_0x3a7673;if(!_0x2c9869[_0x778551(0xb9)](_0xca6e68['target']))_0x2c9869[_0x778551(0xdb)][_0x778551(0xe7)](_0x778551(0x11b));});});const saved=localStorage[a0_0x797368(0xf6)](a0_0x797368(0xb6));if(saved)try{messages=JSON[a0_0x797368(0xaa)](saved),renderMessages();}catch(a0_0x116921){}updateSendButton();function a0_0x57a8(){const _0x18ba8a=['focus','now','key','confirmModal','removeItem','getHours','Очистить\x20историю?','min','trim','setItem','display','text','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','onClick','initData','first_name','Действие\x20необратимо.','6.1','stringify','querySelectorAll','show-delete','getElementById','clear_history','expand','Ошибка\x20сервера','debug_uid','none','./router.html','1804248mHwNyJ','success','push','role','viewportChanged','scrollHeight','auto','1861155yOYeSK','Пустой\x20ответ','message-time','parse','Telegram','Начнется\x20новый\x20диалог.','innerHTML','click','#050505','add','send_message','href','user','style','textContent','ai_chat_messages','initDataUnsafe','innerHeight','contains','div','error','stopPropagation','(((.+)+)+)+$','random','offClick','touchend','splice','timestamp','text/plain','signal','chatArea','shiftKey','inputArea','6430465OQzZRZ','getMinutes','8590208gmLXTT','messageInput','modalText','HapticFeedback','show','message\x20','search','6NKqUSe','toString','message-bubble','disableVerticalSwipes','scrollTop','<br>','function','light','replace','emptyState','classList','from','floor','className','addEventListener','value','delete-btn','forEach','sendBtn','resize','Ошибка\x20сети','9LRwMdw','remove','modalCancel','json','content','constructor','children','medium','8888089jEhnxv','Удалить?','length','3122308uhQOzZ','onclick','Enter','querySelector','modalTitle','getItem','createElement','apply','height','notificationOccurred','impactOccurred','WebApp','BackButton','931840WPnCHv','viewportHeight','typingIndicator','appendChild','.message.show-delete','setHeaderColor','offsetHeight','touchstart','.container'];a0_0x57a8=function(){return _0x18ba8a;};return a0_0x57a8();}