const a0_0x4b4f8a=a0_0x355c;(function(_0x20db4c,_0x2060e3){const _0x535408=a0_0x355c,_0x334027=_0x20db4c();while(!![]){try{const _0x4c70e4=parseInt(_0x535408(0x131))/0x1*(-parseInt(_0x535408(0x171))/0x2)+parseInt(_0x535408(0x176))/0x3*(parseInt(_0x535408(0x184))/0x4)+-parseInt(_0x535408(0x14a))/0x5+parseInt(_0x535408(0x18a))/0x6+-parseInt(_0x535408(0x142))/0x7*(parseInt(_0x535408(0x155))/0x8)+-parseInt(_0x535408(0x14e))/0x9+parseInt(_0x535408(0x175))/0xa*(parseInt(_0x535408(0x130))/0xb);if(_0x4c70e4===_0x2060e3)break;else _0x334027['push'](_0x334027['shift']());}catch(_0x4103e9){_0x334027['push'](_0x334027['shift']());}}}(a0_0x43c9,0x557b4));const tg=window[a0_0x4b4f8a(0x153)]?.[a0_0x4b4f8a(0x1b1)],HOME_URL=a0_0x4b4f8a(0x166);function setupTelegramBackButton(){const _0x4af9e8=a0_0x4b4f8a,_0x4b7b3a=(function(){let _0x1bf636=!![];return function(_0x29bd55,_0x2b6e75){const _0x3b62a0=_0x1bf636?function(){if(_0x2b6e75){const _0x437c96=_0x2b6e75['apply'](_0x29bd55,arguments);return _0x2b6e75=null,_0x437c96;}}:function(){};return _0x1bf636=![],_0x3b62a0;};}()),_0x2596fe=_0x4b7b3a(this,function(){const _0xa27bb5=a0_0x355c;return _0x2596fe[_0xa27bb5(0x185)]()[_0xa27bb5(0x161)](_0xa27bb5(0x169))['toString']()[_0xa27bb5(0x187)](_0x2596fe)[_0xa27bb5(0x161)](_0xa27bb5(0x169));});_0x2596fe();if(!tg)return;try{tg[_0x4af9e8(0x164)](),tg[_0x4af9e8(0x13a)](),tg[_0x4af9e8(0x1a1)]?.(_0x4af9e8(0x14c));if(tg[_0x4af9e8(0x139)]?.(_0x4af9e8(0x183)))tg[_0x4af9e8(0x141)]?.();const _0x293218=tg[_0x4af9e8(0x17e)];if(_0x293218){_0x293218[_0x4af9e8(0x18c)]();if(typeof _0x293218[_0x4af9e8(0x190)]===_0x4af9e8(0x17b))try{_0x293218[_0x4af9e8(0x190)]();}catch(_0x1a4450){}_0x293218[_0x4af9e8(0x196)](()=>{const _0x437b3e=_0x4af9e8;if(tg[_0x437b3e(0x167)])tg[_0x437b3e(0x167)][_0x437b3e(0x1b6)](_0x437b3e(0x13d));location[_0x437b3e(0x1ab)]=HOME_URL;});}}catch(_0x83ffbb){console[_0x4af9e8(0x188)](_0x4af9e8(0x138),_0x83ffbb);}}(function initStableLayout(){const _0x5bb8b5=a0_0x4b4f8a,_0x48ab35=document['querySelector'](_0x5bb8b5(0x19e)),_0x707438=document[_0x5bb8b5(0x145)]('inputArea'),_0x208612=document[_0x5bb8b5(0x145)](_0x5bb8b5(0x12e)),_0x5def03=document[_0x5bb8b5(0x145)](_0x5bb8b5(0x16b));function _0x193b00(){const _0x431223=_0x5bb8b5;if(!_0x48ab35)return;const _0x15587a=tg&&tg[_0x431223(0x195)]?tg[_0x431223(0x195)]:window[_0x431223(0x17d)];_0x48ab35[_0x431223(0x18f)][_0x431223(0x19f)]=_0x15587a+'px';if(_0x707438){const _0x41d9cb=_0x707438[_0x431223(0x147)];_0x208612[_0x431223(0x18f)][_0x431223(0x186)]=_0x41d9cb+0x28+'px';}}tg?tg[_0x5bb8b5(0x1a9)](_0x5bb8b5(0x1a6),({isStateStable:_0x32af41})=>{_0x193b00();if(_0x32af41)requestAnimationFrame(()=>{const _0x17ff68=a0_0x355c;_0x208612[_0x17ff68(0x1a7)]=_0x208612[_0x17ff68(0x18d)];});}):window[_0x5bb8b5(0x143)](_0x5bb8b5(0x15e),_0x193b00),_0x193b00(),_0x5def03&&(_0x5def03[_0x5bb8b5(0x143)](_0x5bb8b5(0x15f),()=>{requestAnimationFrame(_0x193b00);}),_0x5def03[_0x5bb8b5(0x143)](_0x5bb8b5(0x198),()=>{setTimeout(()=>{const _0x40e7b0=a0_0x355c;_0x208612[_0x40e7b0(0x1a7)]=_0x208612[_0x40e7b0(0x18d)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x43c9(){const _0x4d061=['532469OlvmPh','typingIndicator','Пустой\x20ответ','length','floor','message-bubble','setItem','TG\x20setup\x20error:','isVersionAtLeast','expand','div','success','light','parse','getMinutes','forEach','disableVerticalSwipes','21553ftkAMU','addEventListener','classList','getElementById','medium','offsetHeight','appendChild','stopPropagation','46315ejmHzw','error','#050505','replace','3773295YBpDaB','removeItem','text/plain','clearBtn','getItem','Telegram','padStart','520iCZAAH','signal','<br>','target','Удалить?','notificationOccurred','first_name','show-delete','touchstart','resize','input','className','search','Ошибка\x20сервера','clear_history','ready','initDataUnsafe','./router.html','HapticFeedback','confirmModal','(((.+)+)+)+$','timestamp','messageInput','username','disabled','user','modalTitle','trim','2YMOznA','ai_chat_messages','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','display','250BADfQZ','117SGabca','textContent','value','keydown','shiftKey','function','initData','innerHeight','BackButton','text','modalText','click','.message.show-delete','6.1','7220CyqcUg','toString','paddingBottom','constructor','warn','stringify','1358304smiuWQ','innerHTML','show','scrollHeight','content','style','offClick','now','getHours','add','delete-btn','viewportHeight','onClick','from','focus','touchend','none','onclick','preventDefault','Действие\x20необратимо.','.container','height','POST','setHeaderColor','remove','abort','role','Ошибка\x20сети','viewportChanged','scrollTop','key','onEvent','createElement','href','Очистить\x20историю?','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','debug_uid','message\x20ai','min','WebApp','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','json','send_message','push','impactOccurred','Начнется\x20новый\x20диалог.','Enter','chatArea','emptyState','534369SLBUcG'];a0_0x43c9=function(){return _0x4d061;};return a0_0x43c9();}const BACKEND_URL=a0_0x4b4f8a(0x173),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x355c(_0x561a26,_0x2f15e7){_0x561a26=_0x561a26-0x12d;const _0x40d204=a0_0x43c9();let _0x32448b=_0x40d204[_0x561a26];return _0x32448b;}const chatArea=document[a0_0x4b4f8a(0x145)](a0_0x4b4f8a(0x12e)),emptyState=document['getElementById'](a0_0x4b4f8a(0x12f)),messageInput=document[a0_0x4b4f8a(0x145)](a0_0x4b4f8a(0x16b)),sendBtn=document[a0_0x4b4f8a(0x145)]('sendBtn'),clearBtn=document[a0_0x4b4f8a(0x145)](a0_0x4b4f8a(0x151)),modal=document['getElementById'](a0_0x4b4f8a(0x168)),mTitle=document['getElementById'](a0_0x4b4f8a(0x16f)),mText=document['getElementById'](a0_0x4b4f8a(0x180));let modalCallback=null;async function callBackend(_0x494a84,_0xb32fb1){const _0x474392=a0_0x4b4f8a,_0xff7963=tg?.[_0x474392(0x165)]?.[_0x474392(0x16e)]||{},_0x4d5440=_0xff7963['id']||localStorage['getItem'](_0x474392(0x1ae))||'d-'+Math[_0x474392(0x135)](Math['random']()*0x3b9aca00);if(!_0xff7963['id'])localStorage[_0x474392(0x137)](_0x474392(0x1ae),_0x4d5440);const _0x2661fd={'action':_0x494a84,'user_id':_0x4d5440,'user_data':{'first_name':_0xff7963[_0x474392(0x15b)],'username':_0xff7963[_0x474392(0x16c)]},'init_data':tg?.[_0x474392(0x17c)]||'',..._0xb32fb1},_0x405448=new AbortController(),_0x1abcb0=setTimeout(()=>_0x405448[_0x474392(0x1a3)](),REQUEST_TIMEOUT_MS);try{const _0x1e67b9=await fetch(BACKEND_URL,{'method':_0x474392(0x1a0),'headers':{'Content-Type':_0x474392(0x150)},'body':JSON[_0x474392(0x189)](_0x2661fd),'signal':_0x405448[_0x474392(0x156)]});return clearTimeout(_0x1abcb0),await _0x1e67b9[_0x474392(0x1b3)]();}catch(_0x354f2d){return{'success':![],'error':String(_0x354f2d)};}}function formatTime(_0x1f211b){const _0x21e981=a0_0x4b4f8a,_0x1db65f=new Date(_0x1f211b);return String(_0x1db65f[_0x21e981(0x192)]())[_0x21e981(0x154)](0x2,'0')+':'+String(_0x1db65f[_0x21e981(0x13f)]())['padStart'](0x2,'0');}function createMessageElement(_0x102f33,_0x38fe1a){const _0x1536b2=a0_0x4b4f8a,_0x24b36f=document['createElement']('div');_0x24b36f[_0x1536b2(0x160)]='message\x20'+_0x102f33[_0x1536b2(0x1a4)];const _0x396a36=document[_0x1536b2(0x1aa)]('div');_0x396a36[_0x1536b2(0x160)]=_0x1536b2(0x136),_0x396a36[_0x1536b2(0x18b)]=_0x102f33[_0x1536b2(0x18e)][_0x1536b2(0x14d)](/\n/g,_0x1536b2(0x157));const _0x27bd9b=document['createElement'](_0x1536b2(0x13b));_0x27bd9b[_0x1536b2(0x160)]=_0x1536b2(0x194),_0x27bd9b[_0x1536b2(0x18b)]=_0x1536b2(0x1ad),_0x27bd9b['onclick']=_0x17ff42=>{const _0x400f98=_0x1536b2;_0x17ff42[_0x400f98(0x149)](),confirmDelete(_0x38fe1a);};let _0x32a0a2;_0x396a36['addEventListener'](_0x1536b2(0x15d),()=>_0x32a0a2=setTimeout(()=>{const _0x52da64=_0x1536b2;_0x24b36f[_0x52da64(0x144)][_0x52da64(0x193)](_0x52da64(0x15c));if(tg?.['HapticFeedback'])tg[_0x52da64(0x167)][_0x52da64(0x1b6)](_0x52da64(0x146));},0x1f4)),_0x396a36[_0x1536b2(0x143)](_0x1536b2(0x199),()=>clearTimeout(_0x32a0a2));const _0x3bf250=document[_0x1536b2(0x1aa)](_0x1536b2(0x13b));return _0x3bf250[_0x1536b2(0x160)]='message-time',_0x3bf250[_0x1536b2(0x177)]=formatTime(_0x102f33[_0x1536b2(0x16a)]),_0x24b36f[_0x1536b2(0x148)](_0x27bd9b),_0x24b36f[_0x1536b2(0x148)](_0x396a36),_0x24b36f[_0x1536b2(0x148)](_0x3bf250),_0x24b36f;}function createTypingIndicator(){const _0x4615c0=a0_0x4b4f8a,_0xba672c=document[_0x4615c0(0x1aa)](_0x4615c0(0x13b));return _0xba672c['className']=_0x4615c0(0x1af),_0xba672c['id']=_0x4615c0(0x132),_0xba672c['innerHTML']=_0x4615c0(0x1b2),_0xba672c;}function renderMessages(){const _0x10daa1=a0_0x4b4f8a;Array[_0x10daa1(0x197)](chatArea['children'])[_0x10daa1(0x140)](_0x40c262=>{const _0x212c39=_0x10daa1;if(_0x40c262['id']!=='emptyState')_0x40c262[_0x212c39(0x1a2)]();}),messages[_0x10daa1(0x134)]>0x0?(emptyState[_0x10daa1(0x18f)][_0x10daa1(0x174)]=_0x10daa1(0x19a),messages[_0x10daa1(0x140)]((_0x29da19,_0x50f8b5)=>chatArea['appendChild'](createMessageElement(_0x29da19,_0x50f8b5)))):emptyState[_0x10daa1(0x18f)][_0x10daa1(0x174)]='flex',requestAnimationFrame(()=>chatArea[_0x10daa1(0x1a7)]=chatArea[_0x10daa1(0x18d)]);}function autoResizeTextarea(){const _0x16356f=a0_0x4b4f8a;messageInput[_0x16356f(0x18f)][_0x16356f(0x19f)]='auto',messageInput[_0x16356f(0x18f)]['height']=Math[_0x16356f(0x1b0)](messageInput[_0x16356f(0x18d)],0x78)+'px';}function updateSendButton(){const _0x39160c=a0_0x4b4f8a,_0x1ac5b1=messageInput[_0x39160c(0x178)][_0x39160c(0x170)]();sendBtn[_0x39160c(0x16d)]=!_0x1ac5b1||isTyping;}async function sendMessage(){const _0x46c42d=a0_0x4b4f8a,_0x40050f=messageInput[_0x46c42d(0x178)][_0x46c42d(0x170)]();if(!_0x40050f||isTyping)return;if(tg?.[_0x46c42d(0x167)])tg[_0x46c42d(0x167)]['impactOccurred'](_0x46c42d(0x13d));messages[_0x46c42d(0x1b5)]({'role':_0x46c42d(0x16e),'content':_0x40050f,'timestamp':Date[_0x46c42d(0x191)]()}),localStorage[_0x46c42d(0x137)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0x46c42d(0x178)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x46c42d(0x148)](createTypingIndicator()),chatArea[_0x46c42d(0x1a7)]=chatArea[_0x46c42d(0x18d)];const _0xb661ad=await callBackend(_0x46c42d(0x1b4),{'message':_0x40050f});isTyping=![];const _0x39ea60=document['getElementById'](_0x46c42d(0x132));if(_0x39ea60)_0x39ea60[_0x46c42d(0x1a2)]();let _0x3b01e7=_0x46c42d(0x1a5);if(_0xb661ad[_0x46c42d(0x13c)]){_0x3b01e7=_0xb661ad[_0x46c42d(0x17f)]||_0x46c42d(0x133);if(tg?.[_0x46c42d(0x167)])tg['HapticFeedback'][_0x46c42d(0x15a)]('success');}else{_0x3b01e7=_0xb661ad['error']||_0x46c42d(0x162);if(tg?.[_0x46c42d(0x167)])tg['HapticFeedback'][_0x46c42d(0x15a)](_0x46c42d(0x14b));}messages['push']({'role':'ai','content':_0x3b01e7,'timestamp':Date['now']()}),localStorage[_0x46c42d(0x137)](_0x46c42d(0x172),JSON[_0x46c42d(0x189)](messages)),renderMessages();}function confirmDelete(_0x232edc){const _0x2a2170=a0_0x4b4f8a;if(mTitle)mTitle[_0x2a2170(0x177)]=_0x2a2170(0x159);if(mText)mText['textContent']=_0x2a2170(0x19d);modalCallback=()=>{const _0xc63b09=_0x2a2170;messages['splice'](_0x232edc,0x1),localStorage[_0xc63b09(0x137)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x2a2170(0x144)][_0x2a2170(0x193)](_0x2a2170(0x18c));}if(clearBtn)clearBtn[a0_0x4b4f8a(0x19b)]=()=>{const _0x7db98d=a0_0x4b4f8a;if(!messages['length'])return;if(mTitle)mTitle[_0x7db98d(0x177)]=_0x7db98d(0x1ac);if(mText)mText[_0x7db98d(0x177)]=_0x7db98d(0x1b7);modalCallback=async()=>{const _0x574268=_0x7db98d;messages=[],localStorage[_0x574268(0x14f)]('ai_chat_messages'),renderMessages(),callBackend(_0x574268(0x163),{});},modal[_0x7db98d(0x144)][_0x7db98d(0x193)](_0x7db98d(0x18c));};document['getElementById']('modalCancel')[a0_0x4b4f8a(0x19b)]=()=>modal['classList'][a0_0x4b4f8a(0x1a2)](a0_0x4b4f8a(0x18c)),document[a0_0x4b4f8a(0x145)]('modalConfirm')[a0_0x4b4f8a(0x19b)]=()=>{const _0x3292a9=a0_0x4b4f8a;if(modalCallback)modalCallback();modal[_0x3292a9(0x144)]['remove'](_0x3292a9(0x18c));},messageInput[a0_0x4b4f8a(0x143)](a0_0x4b4f8a(0x15f),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4b4f8a(0x143)](a0_0x4b4f8a(0x179),_0x53ce28=>{const _0x2058d1=a0_0x4b4f8a;_0x53ce28[_0x2058d1(0x1a8)]===_0x2058d1(0x12d)&&!_0x53ce28[_0x2058d1(0x17a)]&&(_0x53ce28[_0x2058d1(0x19c)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x4b4f8a(0x181),_0x1f5be7=>{const _0x7e4a08=a0_0x4b4f8a;document['querySelectorAll'](_0x7e4a08(0x182))[_0x7e4a08(0x140)](_0x1bc462=>{const _0xae4bcc=_0x7e4a08;if(!_0x1bc462['contains'](_0x1f5be7[_0xae4bcc(0x158)]))_0x1bc462['classList'][_0xae4bcc(0x1a2)](_0xae4bcc(0x15c));});});const saved=localStorage[a0_0x4b4f8a(0x152)](a0_0x4b4f8a(0x172));if(saved)try{messages=JSON[a0_0x4b4f8a(0x13e)](saved),renderMessages();}catch(a0_0x3dc7b8){}updateSendButton();