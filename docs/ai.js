const a0_0x170e7b=a0_0x35f9;(function(_0x123b4c,_0x1ea7af){const _0x3a075b=a0_0x35f9,_0x446b0d=_0x123b4c();while(!![]){try{const _0x1905be=-parseInt(_0x3a075b(0xc0))/0x1*(parseInt(_0x3a075b(0xf7))/0x2)+-parseInt(_0x3a075b(0xfa))/0x3*(-parseInt(_0x3a075b(0x82))/0x4)+parseInt(_0x3a075b(0xe7))/0x5+parseInt(_0x3a075b(0xea))/0x6+-parseInt(_0x3a075b(0xe9))/0x7+-parseInt(_0x3a075b(0x95))/0x8*(parseInt(_0x3a075b(0xa2))/0x9)+-parseInt(_0x3a075b(0xcd))/0xa*(-parseInt(_0x3a075b(0xfc))/0xb);if(_0x1905be===_0x1ea7af)break;else _0x446b0d['push'](_0x446b0d['shift']());}catch(_0x1d9eb8){_0x446b0d['push'](_0x446b0d['shift']());}}}(a0_0x26dd,0x6c98a));const tg=window[a0_0x170e7b(0xf1)]?.[a0_0x170e7b(0xac)],HOME_URL=a0_0x170e7b(0xfd);function setupTelegramBackButton(){const _0x1b0866=a0_0x170e7b,_0x11d5e3=(function(){let _0x5277cf=!![];return function(_0xe726c9,_0x327956){const _0x275c30=_0x5277cf?function(){const _0x48e4e1=a0_0x35f9;if(_0x327956){const _0x5baffb=_0x327956[_0x48e4e1(0xe8)](_0xe726c9,arguments);return _0x327956=null,_0x5baffb;}}:function(){};return _0x5277cf=![],_0x275c30;};}()),_0x52dd1e=_0x11d5e3(this,function(){const _0x3e9a9d=a0_0x35f9;return _0x52dd1e[_0x3e9a9d(0xed)]()[_0x3e9a9d(0xc3)]('(((.+)+)+)+$')[_0x3e9a9d(0xed)]()['constructor'](_0x52dd1e)[_0x3e9a9d(0xc3)](_0x3e9a9d(0xbe));});_0x52dd1e();if(!tg)return;try{tg[_0x1b0866(0xa7)](),tg['expand'](),tg[_0x1b0866(0x96)]?.(_0x1b0866(0xb3));if(tg[_0x1b0866(0xc8)]?.(_0x1b0866(0xab)))tg['disableVerticalSwipes']?.();const _0x3440a0=tg['BackButton'];if(_0x3440a0){_0x3440a0[_0x1b0866(0x85)]();if(typeof _0x3440a0['offClick']===_0x1b0866(0xa3))try{_0x3440a0[_0x1b0866(0x8c)]();}catch(_0x16a9b7){}_0x3440a0[_0x1b0866(0xda)](()=>{const _0x164668=_0x1b0866;if(tg[_0x164668(0xbb)])tg[_0x164668(0xbb)][_0x164668(0x9d)](_0x164668(0xa1));location[_0x164668(0xd6)]=HOME_URL;});}}catch(_0x5fbc47){console[_0x1b0866(0x8a)](_0x1b0866(0xa8),_0x5fbc47);}}(function initStableLayout(){const _0x1acbc2=a0_0x170e7b,_0x36f5ba=document[_0x1acbc2(0xe0)](_0x1acbc2(0xb7)),_0x16a0fb=document[_0x1acbc2(0x8e)](_0x1acbc2(0xdd)),_0x1f7cbc=document[_0x1acbc2(0x8e)](_0x1acbc2(0xb5)),_0x5f3744=document[_0x1acbc2(0x8e)](_0x1acbc2(0xd0));function _0x4ac966(){const _0x277101=_0x1acbc2;if(!_0x36f5ba)return;const _0x1136c4=tg&&tg[_0x277101(0xd9)]?tg[_0x277101(0xd9)]:window[_0x277101(0xc9)];_0x36f5ba[_0x277101(0xca)][_0x277101(0x92)]=_0x1136c4+'px';if(_0x16a0fb){const _0x2a159c=_0x16a0fb['offsetHeight'];_0x1f7cbc['style'][_0x277101(0xc2)]=_0x2a159c+0x28+'px';}}tg?tg[_0x1acbc2(0xae)](_0x1acbc2(0xe5),({isStateStable:_0xd4edc})=>{_0x4ac966();if(_0xd4edc)requestAnimationFrame(()=>{const _0x1f3fed=a0_0x35f9;_0x1f7cbc['scrollTop']=_0x1f7cbc[_0x1f3fed(0xc1)];});}):window[_0x1acbc2(0xaa)](_0x1acbc2(0x91),_0x4ac966),_0x4ac966(),_0x5f3744&&(_0x5f3744[_0x1acbc2(0xaa)](_0x1acbc2(0xc6),()=>{requestAnimationFrame(_0x4ac966);}),_0x5f3744['addEventListener'](_0x1acbc2(0x7f),()=>{setTimeout(()=>{const _0x201dbf=a0_0x35f9;_0x1f7cbc[_0x201dbf(0xc7)]=_0x1f7cbc[_0x201dbf(0xc1)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x170e7b(0x8e)](a0_0x170e7b(0xb5)),emptyState=document[a0_0x170e7b(0x8e)](a0_0x170e7b(0x8d)),messageInput=document[a0_0x170e7b(0x8e)](a0_0x170e7b(0xd0)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document['getElementById'](a0_0x170e7b(0xee)),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0x170e7b(0x8e)](a0_0x170e7b(0x8b)),mText=document['getElementById'](a0_0x170e7b(0xd5));function a0_0x26dd(){const _0x5b2713=['delete-btn','warn','modalTitle','offClick','emptyState','getElementById','replace','modalCancel','resize','height','click','div','56iuDhHe','setHeaderColor','message-bubble','key','stringify','ai_chat_messages','show-delete','auto','impactOccurred','timestamp','now','value','light','455481VpFpTW','function','getMinutes','notificationOccurred','content','ready','TG\x20setup\x20error:','from','addEventListener','6.1','WebApp','push','onEvent','text/plain','signal','padStart','appendChild','#050505','debug_uid','chatArea','getHours','.container','className','Пустой\x20ответ','Действие\x20необратимо.','HapticFeedback','send_message','error','(((.+)+)+)+$','querySelectorAll','13lmuTpE','scrollHeight','paddingBottom','search','classList','preventDefault','input','scrollTop','isVersionAtLeast','innerHeight','style','forEach','random','7946570xKhTAn','stopPropagation','remove','messageInput','abort','message\x20','medium','innerHTML','modalText','href','Начнется\x20новый\x20диалог.','success','viewportHeight','onClick','initData','clear_history','inputArea','POST','trim','querySelector','flex','disabled','min','Enter','viewportChanged','getItem','1264600TtOnIj','apply','4185790ndkECm','3889956plCHrk','onclick','removeItem','toString','clearBtn','touchstart','splice','Telegram','length','textContent','user','username','.message.show-delete','116728fDgkAv','add','display','672UXEWyZ','setItem','11JInQnq','./router.html','focus','<br>','message\x20ai','8212kDSwma','none','text','show','shiftKey','createElement','typingIndicator'];a0_0x26dd=function(){return _0x5b2713;};return a0_0x26dd();}let modalCallback=null;async function callBackend(_0x39c040,_0x6716ff){const _0x140810=a0_0x170e7b,_0x400087=tg?.['initDataUnsafe']?.[_0x140810(0xf4)]||{},_0x46a50d=_0x400087['id']||localStorage['getItem'](_0x140810(0xb4))||'d-'+Math['floor'](Math[_0x140810(0xcc)]()*0x3b9aca00);if(!_0x400087['id'])localStorage[_0x140810(0xfb)]('debug_uid',_0x46a50d);const _0x1237de={'action':_0x39c040,'user_id':_0x46a50d,'user_data':{'first_name':_0x400087['first_name'],'username':_0x400087[_0x140810(0xf5)]},'init_data':tg?.[_0x140810(0xdb)]||'',..._0x6716ff},_0x2b473a=new AbortController(),_0x2439ee=setTimeout(()=>_0x2b473a[_0x140810(0xd1)](),REQUEST_TIMEOUT_MS);try{const _0x3ef7fa=await fetch(BACKEND_URL,{'method':_0x140810(0xde),'headers':{'Content-Type':_0x140810(0xaf)},'body':JSON['stringify'](_0x1237de),'signal':_0x2b473a[_0x140810(0xb0)]});return clearTimeout(_0x2439ee),await _0x3ef7fa['json']();}catch(_0x483e14){return{'success':![],'error':String(_0x483e14)};}}function formatTime(_0x47e079){const _0x1fd116=a0_0x170e7b,_0x365996=new Date(_0x47e079);return String(_0x365996[_0x1fd116(0xb6)]())[_0x1fd116(0xb1)](0x2,'0')+':'+String(_0x365996[_0x1fd116(0xa4)]())[_0x1fd116(0xb1)](0x2,'0');}function a0_0x35f9(_0x4c9a21,_0x38256d){_0x4c9a21=_0x4c9a21-0x7f;const _0x4e41d5=a0_0x26dd();let _0x4f3c0c=_0x4e41d5[_0x4c9a21];return _0x4f3c0c;}function createMessageElement(_0xc49fb1,_0x3fbd7b){const _0x2f3e21=a0_0x170e7b,_0x2592df=document[_0x2f3e21(0x87)](_0x2f3e21(0x94));_0x2592df['className']=_0x2f3e21(0xd2)+_0xc49fb1['role'];const _0x1c42f=document[_0x2f3e21(0x87)](_0x2f3e21(0x94));_0x1c42f[_0x2f3e21(0xb8)]=_0x2f3e21(0x97),_0x1c42f['innerHTML']=_0xc49fb1[_0x2f3e21(0xa6)][_0x2f3e21(0x8f)](/\n/g,_0x2f3e21(0x80));const _0x77c07f=document[_0x2f3e21(0x87)](_0x2f3e21(0x94));_0x77c07f[_0x2f3e21(0xb8)]=_0x2f3e21(0x89),_0x77c07f[_0x2f3e21(0xd4)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x77c07f['onclick']=_0x12f75e=>{const _0x1c9480=_0x2f3e21;_0x12f75e[_0x1c9480(0xce)](),confirmDelete(_0x3fbd7b);};let _0x5a403f;_0x1c42f[_0x2f3e21(0xaa)](_0x2f3e21(0xef),()=>_0x5a403f=setTimeout(()=>{const _0x2698a0=_0x2f3e21;_0x2592df[_0x2698a0(0xc4)]['add'](_0x2698a0(0x9b));if(tg?.[_0x2698a0(0xbb)])tg[_0x2698a0(0xbb)][_0x2698a0(0x9d)](_0x2698a0(0xd3));},0x1f4)),_0x1c42f[_0x2f3e21(0xaa)]('touchend',()=>clearTimeout(_0x5a403f));const _0x2ec1f5=document[_0x2f3e21(0x87)]('div');return _0x2ec1f5[_0x2f3e21(0xb8)]='message-time',_0x2ec1f5['textContent']=formatTime(_0xc49fb1[_0x2f3e21(0x9e)]),_0x2592df['appendChild'](_0x77c07f),_0x2592df[_0x2f3e21(0xb2)](_0x1c42f),_0x2592df[_0x2f3e21(0xb2)](_0x2ec1f5),_0x2592df;}function createTypingIndicator(){const _0x5a6186=a0_0x170e7b,_0x498573=document[_0x5a6186(0x87)](_0x5a6186(0x94));return _0x498573[_0x5a6186(0xb8)]=_0x5a6186(0x81),_0x498573['id']=_0x5a6186(0x88),_0x498573[_0x5a6186(0xd4)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x498573;}function renderMessages(){const _0x5d5741=a0_0x170e7b;Array[_0x5d5741(0xa9)](chatArea['children'])['forEach'](_0x346283=>{const _0x543a8d=_0x5d5741;if(_0x346283['id']!==_0x543a8d(0x8d))_0x346283['remove']();}),messages[_0x5d5741(0xf2)]>0x0?(emptyState[_0x5d5741(0xca)][_0x5d5741(0xf9)]=_0x5d5741(0x83),messages[_0x5d5741(0xcb)]((_0x3001c3,_0x79e9dc)=>chatArea[_0x5d5741(0xb2)](createMessageElement(_0x3001c3,_0x79e9dc)))):emptyState[_0x5d5741(0xca)][_0x5d5741(0xf9)]=_0x5d5741(0xe1),requestAnimationFrame(()=>chatArea[_0x5d5741(0xc7)]=chatArea[_0x5d5741(0xc1)]);}function autoResizeTextarea(){const _0x443008=a0_0x170e7b;messageInput[_0x443008(0xca)]['height']=_0x443008(0x9c),messageInput['style'][_0x443008(0x92)]=Math[_0x443008(0xe3)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x1d3dbb=a0_0x170e7b,_0x119afd=messageInput[_0x1d3dbb(0xa0)][_0x1d3dbb(0xdf)]();sendBtn[_0x1d3dbb(0xe2)]=!_0x119afd||isTyping;}async function sendMessage(){const _0x430a70=a0_0x170e7b,_0x5cea73=messageInput[_0x430a70(0xa0)][_0x430a70(0xdf)]();if(!_0x5cea73||isTyping)return;if(tg?.[_0x430a70(0xbb)])tg[_0x430a70(0xbb)][_0x430a70(0x9d)](_0x430a70(0xa1));messages[_0x430a70(0xad)]({'role':_0x430a70(0xf4),'content':_0x5cea73,'timestamp':Date['now']()}),localStorage[_0x430a70(0xfb)](_0x430a70(0x9a),JSON[_0x430a70(0x99)](messages)),renderMessages(),messageInput[_0x430a70(0xa0)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x430a70(0xb2)](createTypingIndicator()),chatArea[_0x430a70(0xc7)]=chatArea[_0x430a70(0xc1)];const _0xb1b2c4=await callBackend(_0x430a70(0xbc),{'message':_0x5cea73});isTyping=![];const _0x185389=document[_0x430a70(0x8e)](_0x430a70(0x88));if(_0x185389)_0x185389[_0x430a70(0xcf)]();let _0x59bd3e='Ошибка\x20сети';if(_0xb1b2c4[_0x430a70(0xd8)]){_0x59bd3e=_0xb1b2c4[_0x430a70(0x84)]||_0x430a70(0xb9);if(tg?.[_0x430a70(0xbb)])tg[_0x430a70(0xbb)]['notificationOccurred'](_0x430a70(0xd8));}else{_0x59bd3e=_0xb1b2c4['error']||'Ошибка\x20сервера';if(tg?.[_0x430a70(0xbb)])tg[_0x430a70(0xbb)][_0x430a70(0xa5)](_0x430a70(0xbd));}messages[_0x430a70(0xad)]({'role':'ai','content':_0x59bd3e,'timestamp':Date[_0x430a70(0x9f)]()}),localStorage[_0x430a70(0xfb)](_0x430a70(0x9a),JSON[_0x430a70(0x99)](messages)),renderMessages();}function confirmDelete(_0xc499b7){const _0x562032=a0_0x170e7b;if(mTitle)mTitle[_0x562032(0xf3)]='Удалить?';if(mText)mText[_0x562032(0xf3)]=_0x562032(0xba);modalCallback=()=>{const _0x234772=_0x562032;messages[_0x234772(0xf0)](_0xc499b7,0x1),localStorage[_0x234772(0xfb)]('ai_chat_messages',JSON[_0x234772(0x99)](messages)),renderMessages();},modal[_0x562032(0xc4)][_0x562032(0xf8)]('show');}if(clearBtn)clearBtn[a0_0x170e7b(0xeb)]=()=>{const _0x25b053=a0_0x170e7b;if(!messages[_0x25b053(0xf2)])return;if(mTitle)mTitle[_0x25b053(0xf3)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x25b053(0xd7);modalCallback=async()=>{const _0x4b306a=_0x25b053;messages=[],localStorage[_0x4b306a(0xec)](_0x4b306a(0x9a)),renderMessages(),callBackend(_0x4b306a(0xdc),{});},modal[_0x25b053(0xc4)][_0x25b053(0xf8)](_0x25b053(0x85));};document[a0_0x170e7b(0x8e)](a0_0x170e7b(0x90))[a0_0x170e7b(0xeb)]=()=>modal[a0_0x170e7b(0xc4)][a0_0x170e7b(0xcf)](a0_0x170e7b(0x85)),document['getElementById']('modalConfirm')[a0_0x170e7b(0xeb)]=()=>{const _0x530c74=a0_0x170e7b;if(modalCallback)modalCallback();modal[_0x530c74(0xc4)][_0x530c74(0xcf)](_0x530c74(0x85));},messageInput[a0_0x170e7b(0xaa)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x3ad7e6=>{const _0x1a28af=a0_0x170e7b;_0x3ad7e6[_0x1a28af(0x98)]===_0x1a28af(0xe4)&&!_0x3ad7e6[_0x1a28af(0x86)]&&(_0x3ad7e6[_0x1a28af(0xc5)](),sendMessage());}),sendBtn[a0_0x170e7b(0xeb)]=sendMessage,document[a0_0x170e7b(0xaa)](a0_0x170e7b(0x93),_0xfd7d3b=>{const _0x555852=a0_0x170e7b;document[_0x555852(0xbf)](_0x555852(0xf6))[_0x555852(0xcb)](_0x5df358=>{const _0x27c3e5=_0x555852;if(!_0x5df358['contains'](_0xfd7d3b['target']))_0x5df358[_0x27c3e5(0xc4)]['remove']('show-delete');});});const saved=localStorage[a0_0x170e7b(0xe6)](a0_0x170e7b(0x9a));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x2b3087){}updateSendButton();