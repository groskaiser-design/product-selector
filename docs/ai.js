const a0_0x1abced=a0_0x3611;function a0_0x3611(_0x259233,_0x5a8f3e){_0x259233=_0x259233-0x129;const _0x504675=a0_0x59ae();let _0x537e0a=_0x504675[_0x259233];return _0x537e0a;}(function(_0xfc4076,_0x339fd3){const _0x1d5934=a0_0x3611,_0x24472a=_0xfc4076();while(!![]){try{const _0x5c68c2=parseInt(_0x1d5934(0x18c))/0x1*(-parseInt(_0x1d5934(0x188))/0x2)+parseInt(_0x1d5934(0x17b))/0x3+parseInt(_0x1d5934(0x17e))/0x4+parseInt(_0x1d5934(0x194))/0x5*(parseInt(_0x1d5934(0x12a))/0x6)+-parseInt(_0x1d5934(0x196))/0x7+parseInt(_0x1d5934(0x138))/0x8+parseInt(_0x1d5934(0x171))/0x9*(parseInt(_0x1d5934(0x146))/0xa);if(_0x5c68c2===_0x339fd3)break;else _0x24472a['push'](_0x24472a['shift']());}catch(_0x3266d8){_0x24472a['push'](_0x24472a['shift']());}}}(a0_0x59ae,0x715f4));const tg=window['Telegram']?.[a0_0x1abced(0x198)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x18586c=a0_0x1abced,_0x46f91f=(function(){let _0x4bbd6b=!![];return function(_0x196ad1,_0x4ff1e8){const _0x2a0462=_0x4bbd6b?function(){const _0xfe59cb=a0_0x3611;if(_0x4ff1e8){const _0x5e930e=_0x4ff1e8[_0xfe59cb(0x164)](_0x196ad1,arguments);return _0x4ff1e8=null,_0x5e930e;}}:function(){};return _0x4bbd6b=![],_0x2a0462;};}()),_0x1dc6f7=_0x46f91f(this,function(){const _0x16ec49=a0_0x3611;return _0x1dc6f7[_0x16ec49(0x191)]()[_0x16ec49(0x13a)](_0x16ec49(0x17d))[_0x16ec49(0x191)]()[_0x16ec49(0x161)](_0x1dc6f7)['search'](_0x16ec49(0x17d));});_0x1dc6f7();if(!tg)return;try{tg['ready'](),tg[_0x18586c(0x12b)](),tg['setHeaderColor']?.(_0x18586c(0x19f));if(tg[_0x18586c(0x174)]?.(_0x18586c(0x162)))tg[_0x18586c(0x133)]?.();const _0x303bd4=tg['BackButton'];if(_0x303bd4){_0x303bd4[_0x18586c(0x18a)]();if(typeof _0x303bd4[_0x18586c(0x16e)]==='function')try{_0x303bd4['offClick']();}catch(_0x31cc74){}_0x303bd4['onClick'](()=>{const _0x2be1f9=_0x18586c;if(tg[_0x2be1f9(0x141)])tg[_0x2be1f9(0x141)]['impactOccurred'](_0x2be1f9(0x136));location[_0x2be1f9(0x156)]=HOME_URL;});}}catch(_0x211317){console['warn'](_0x18586c(0x189),_0x211317);}}(function initStableLayout(){const _0x2ecc83=a0_0x1abced,_0x2fd883=document[_0x2ecc83(0x131)]('.container'),_0x51f867=document[_0x2ecc83(0x1a1)](_0x2ecc83(0x15f)),_0x501520=document[_0x2ecc83(0x1a1)]('chatArea'),_0x27b9c2=document[_0x2ecc83(0x1a1)](_0x2ecc83(0x12d));function _0xee8ecd(){const _0x86b277=_0x2ecc83;if(!_0x2fd883)return;const _0x119348=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x86b277(0x155)];_0x2fd883[_0x86b277(0x176)][_0x86b277(0x154)]=_0x119348+'px';if(_0x51f867){const _0x1fba8f=_0x51f867['offsetHeight'];_0x501520[_0x86b277(0x176)][_0x86b277(0x12e)]=_0x1fba8f+0x28+'px';}}tg?tg[_0x2ecc83(0x19d)](_0x2ecc83(0x148),({isStateStable:_0x5ce038})=>{_0xee8ecd();if(_0x5ce038)requestAnimationFrame(()=>{const _0x14619e=a0_0x3611;_0x501520[_0x14619e(0x16f)]=_0x501520[_0x14619e(0x16a)];});}):window[_0x2ecc83(0x186)](_0x2ecc83(0x172),_0xee8ecd),_0xee8ecd(),_0x27b9c2&&(_0x27b9c2[_0x2ecc83(0x186)](_0x2ecc83(0x18b),()=>{requestAnimationFrame(_0xee8ecd);}),_0x27b9c2[_0x2ecc83(0x186)](_0x2ecc83(0x179),()=>{setTimeout(()=>{const _0x3821b8=a0_0x3611;_0x501520[_0x3821b8(0x16f)]=_0x501520[_0x3821b8(0x16a)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1abced(0x19c),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1abced(0x1a1)]('chatArea'),emptyState=document[a0_0x1abced(0x1a1)](a0_0x1abced(0x12f)),messageInput=document[a0_0x1abced(0x1a1)](a0_0x1abced(0x12d)),sendBtn=document[a0_0x1abced(0x1a1)](a0_0x1abced(0x153)),clearBtn=document[a0_0x1abced(0x1a1)](a0_0x1abced(0x178)),modal=document[a0_0x1abced(0x1a1)]('confirmModal'),mTitle=document[a0_0x1abced(0x1a1)](a0_0x1abced(0x14d)),mText=document[a0_0x1abced(0x1a1)](a0_0x1abced(0x165));function a0_0x59ae(){const _0x10c8c3=['onclick','touchstart','value','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','onEvent','debug_uid','#050505','notificationOccurred','getElementById','removeItem','stringify','message\x20','trim','12NbMipG','expand','length','messageInput','paddingBottom','emptyState','Пустой\x20ответ','querySelector','abort','disableVerticalSwipes','shiftKey','delete-btn','light','username','1498416LeEMwK','random','search','remove','classList','className','getHours','impactOccurred','initData','HapticFeedback','role','children','div','padStart','10qCVwNi','forEach','viewportChanged','target','Enter','touchend','medium','modalTitle','now','auto','send_message','message-bubble','text','sendBtn','height','innerHeight','href','preventDefault','innerHTML','ai_chat_messages','signal','clear_history','Очистить\x20историю?','.message.show-delete','getItem','inputArea','textContent','constructor','6.1','typingIndicator','apply','modalText','timestamp','createElement','initDataUnsafe','floor','scrollHeight','add','Ошибка\x20сети','Начнется\x20новый\x20диалог.','offClick','scrollTop','display','12964662eKdHdl','resize','key','isVersionAtLeast','success','style','modalCancel','clearBtn','focus','message\x20ai','121323SWNgVL','error','(((.+)+)+)+$','1284332dsHrMB','flex','replace','message-time','push','POST','content','appendChild','addEventListener','Удалить?','2062mPfciK','TG\x20setup\x20error:','show','input','673mCXbce','contains','user','getMinutes','Ошибка\x20сервера','toString','keydown','none','82695oKKbmv','min','6049309toLMDY','setItem','WebApp'];a0_0x59ae=function(){return _0x10c8c3;};return a0_0x59ae();}let modalCallback=null;async function callBackend(_0x18bde3,_0x348f2a){const _0x459cd0=a0_0x1abced,_0x480ddb=tg?.[_0x459cd0(0x168)]?.[_0x459cd0(0x18e)]||{},_0x4027d1=_0x480ddb['id']||localStorage[_0x459cd0(0x15e)](_0x459cd0(0x19e))||'d-'+Math[_0x459cd0(0x169)](Math[_0x459cd0(0x139)]()*0x3b9aca00);if(!_0x480ddb['id'])localStorage[_0x459cd0(0x197)](_0x459cd0(0x19e),_0x4027d1);const _0x3463b9={'action':_0x18bde3,'user_id':_0x4027d1,'user_data':{'first_name':_0x480ddb['first_name'],'username':_0x480ddb[_0x459cd0(0x137)]},'init_data':tg?.[_0x459cd0(0x140)]||'',..._0x348f2a},_0x408bb0=new AbortController(),_0x422be6=setTimeout(()=>_0x408bb0[_0x459cd0(0x132)](),REQUEST_TIMEOUT_MS);try{const _0x3dca04=await fetch(BACKEND_URL,{'method':_0x459cd0(0x183),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x459cd0(0x1a3)](_0x3463b9),'signal':_0x408bb0[_0x459cd0(0x15a)]});return clearTimeout(_0x422be6),await _0x3dca04['json']();}catch(_0x22a722){return{'success':![],'error':String(_0x22a722)};}}function formatTime(_0x3db4a9){const _0x17adc2=a0_0x1abced,_0x587f21=new Date(_0x3db4a9);return String(_0x587f21[_0x17adc2(0x13e)]())[_0x17adc2(0x145)](0x2,'0')+':'+String(_0x587f21[_0x17adc2(0x18f)]())[_0x17adc2(0x145)](0x2,'0');}function createMessageElement(_0x30347f,_0x1a3ff4){const _0x52b578=a0_0x1abced,_0x5c7044=document[_0x52b578(0x167)](_0x52b578(0x144));_0x5c7044[_0x52b578(0x13d)]=_0x52b578(0x1a4)+_0x30347f[_0x52b578(0x142)];const _0x23dcfb=document[_0x52b578(0x167)]('div');_0x23dcfb['className']=_0x52b578(0x151),_0x23dcfb[_0x52b578(0x158)]=_0x30347f[_0x52b578(0x184)][_0x52b578(0x180)](/\n/g,'<br>');const _0x27c4a7=document[_0x52b578(0x167)]('div');_0x27c4a7[_0x52b578(0x13d)]=_0x52b578(0x135),_0x27c4a7[_0x52b578(0x158)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x27c4a7[_0x52b578(0x199)]=_0x2f2aa7=>{_0x2f2aa7['stopPropagation'](),confirmDelete(_0x1a3ff4);};let _0x4d8e8e;_0x23dcfb[_0x52b578(0x186)](_0x52b578(0x19a),()=>_0x4d8e8e=setTimeout(()=>{const _0x53b4e6=_0x52b578;_0x5c7044['classList'][_0x53b4e6(0x16b)]('show-delete');if(tg?.[_0x53b4e6(0x141)])tg[_0x53b4e6(0x141)][_0x53b4e6(0x13f)](_0x53b4e6(0x14c));},0x1f4)),_0x23dcfb[_0x52b578(0x186)](_0x52b578(0x14b),()=>clearTimeout(_0x4d8e8e));const _0xc377b0=document[_0x52b578(0x167)](_0x52b578(0x144));return _0xc377b0[_0x52b578(0x13d)]=_0x52b578(0x181),_0xc377b0[_0x52b578(0x160)]=formatTime(_0x30347f[_0x52b578(0x166)]),_0x5c7044[_0x52b578(0x185)](_0x27c4a7),_0x5c7044[_0x52b578(0x185)](_0x23dcfb),_0x5c7044['appendChild'](_0xc377b0),_0x5c7044;}function createTypingIndicator(){const _0x3c56be=a0_0x1abced,_0x3305a0=document[_0x3c56be(0x167)](_0x3c56be(0x144));return _0x3305a0[_0x3c56be(0x13d)]=_0x3c56be(0x17a),_0x3305a0['id']=_0x3c56be(0x163),_0x3305a0[_0x3c56be(0x158)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x3305a0;}function renderMessages(){const _0x3293d0=a0_0x1abced;Array['from'](chatArea[_0x3293d0(0x143)])['forEach'](_0x2d4b87=>{if(_0x2d4b87['id']!=='emptyState')_0x2d4b87['remove']();}),messages['length']>0x0?(emptyState[_0x3293d0(0x176)][_0x3293d0(0x170)]=_0x3293d0(0x193),messages[_0x3293d0(0x147)]((_0x45b32f,_0x511f83)=>chatArea['appendChild'](createMessageElement(_0x45b32f,_0x511f83)))):emptyState[_0x3293d0(0x176)][_0x3293d0(0x170)]=_0x3293d0(0x17f),requestAnimationFrame(()=>chatArea[_0x3293d0(0x16f)]=chatArea[_0x3293d0(0x16a)]);}function autoResizeTextarea(){const _0x5368ff=a0_0x1abced;messageInput[_0x5368ff(0x176)][_0x5368ff(0x154)]=_0x5368ff(0x14f),messageInput[_0x5368ff(0x176)][_0x5368ff(0x154)]=Math[_0x5368ff(0x195)](messageInput[_0x5368ff(0x16a)],0x78)+'px';}function updateSendButton(){const _0x58b2b6=a0_0x1abced,_0x343c3d=messageInput[_0x58b2b6(0x19b)][_0x58b2b6(0x129)]();sendBtn['disabled']=!_0x343c3d||isTyping;}async function sendMessage(){const _0x4ddbd5=a0_0x1abced,_0x5e684d=messageInput[_0x4ddbd5(0x19b)][_0x4ddbd5(0x129)]();if(!_0x5e684d||isTyping)return;if(tg?.[_0x4ddbd5(0x141)])tg['HapticFeedback'][_0x4ddbd5(0x13f)](_0x4ddbd5(0x136));messages[_0x4ddbd5(0x182)]({'role':'user','content':_0x5e684d,'timestamp':Date[_0x4ddbd5(0x14e)]()}),localStorage[_0x4ddbd5(0x197)](_0x4ddbd5(0x159),JSON[_0x4ddbd5(0x1a3)](messages)),renderMessages(),messageInput[_0x4ddbd5(0x19b)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x4ddbd5(0x16f)]=chatArea[_0x4ddbd5(0x16a)];const _0x4246d8=await callBackend(_0x4ddbd5(0x150),{'message':_0x5e684d});isTyping=![];const _0x47efbb=document[_0x4ddbd5(0x1a1)](_0x4ddbd5(0x163));if(_0x47efbb)_0x47efbb[_0x4ddbd5(0x13b)]();let _0x18e23d=_0x4ddbd5(0x16c);if(_0x4246d8[_0x4ddbd5(0x175)]){_0x18e23d=_0x4246d8[_0x4ddbd5(0x152)]||_0x4ddbd5(0x130);if(tg?.[_0x4ddbd5(0x141)])tg[_0x4ddbd5(0x141)][_0x4ddbd5(0x1a0)](_0x4ddbd5(0x175));}else{_0x18e23d=_0x4246d8[_0x4ddbd5(0x17c)]||_0x4ddbd5(0x190);if(tg?.['HapticFeedback'])tg[_0x4ddbd5(0x141)][_0x4ddbd5(0x1a0)](_0x4ddbd5(0x17c));}messages[_0x4ddbd5(0x182)]({'role':'ai','content':_0x18e23d,'timestamp':Date['now']()}),localStorage[_0x4ddbd5(0x197)](_0x4ddbd5(0x159),JSON[_0x4ddbd5(0x1a3)](messages)),renderMessages();}function confirmDelete(_0x466731){const _0x4976ee=a0_0x1abced;if(mTitle)mTitle['textContent']=_0x4976ee(0x187);if(mText)mText[_0x4976ee(0x160)]='Действие\x20необратимо.';modalCallback=()=>{const _0x3dd609=_0x4976ee;messages['splice'](_0x466731,0x1),localStorage[_0x3dd609(0x197)](_0x3dd609(0x159),JSON[_0x3dd609(0x1a3)](messages)),renderMessages();},modal['classList']['add'](_0x4976ee(0x18a));}if(clearBtn)clearBtn[a0_0x1abced(0x199)]=()=>{const _0x45f934=a0_0x1abced;if(!messages[_0x45f934(0x12c)])return;if(mTitle)mTitle[_0x45f934(0x160)]=_0x45f934(0x15c);if(mText)mText[_0x45f934(0x160)]=_0x45f934(0x16d);modalCallback=async()=>{const _0x2dff3b=_0x45f934;messages=[],localStorage[_0x2dff3b(0x1a2)](_0x2dff3b(0x159)),renderMessages(),callBackend(_0x2dff3b(0x15b),{});},modal['classList'][_0x45f934(0x16b)](_0x45f934(0x18a));};document['getElementById'](a0_0x1abced(0x177))['onclick']=()=>modal['classList']['remove'](a0_0x1abced(0x18a)),document[a0_0x1abced(0x1a1)]('modalConfirm')['onclick']=()=>{const _0x47f3ba=a0_0x1abced;if(modalCallback)modalCallback();modal[_0x47f3ba(0x13c)][_0x47f3ba(0x13b)](_0x47f3ba(0x18a));},messageInput[a0_0x1abced(0x186)](a0_0x1abced(0x18b),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1abced(0x186)](a0_0x1abced(0x192),_0x4f85dc=>{const _0x50038c=a0_0x1abced;_0x4f85dc[_0x50038c(0x173)]===_0x50038c(0x14a)&&!_0x4f85dc[_0x50038c(0x134)]&&(_0x4f85dc[_0x50038c(0x157)](),sendMessage());}),sendBtn[a0_0x1abced(0x199)]=sendMessage,document[a0_0x1abced(0x186)]('click',_0x102072=>{const _0x4358d9=a0_0x1abced;document['querySelectorAll'](_0x4358d9(0x15d))[_0x4358d9(0x147)](_0x2368a3=>{const _0x1001a0=_0x4358d9;if(!_0x2368a3[_0x1001a0(0x18d)](_0x102072[_0x1001a0(0x149)]))_0x2368a3['classList'][_0x1001a0(0x13b)]('show-delete');});});const saved=localStorage[a0_0x1abced(0x15e)](a0_0x1abced(0x159));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x251ab2){}updateSendButton();