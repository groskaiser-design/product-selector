const a0_0xe8c590=a0_0x597b;(function(_0x19cce8,_0x33d33a){const _0x40b814=a0_0x597b,_0x7ca8fe=_0x19cce8();while(!![]){try{const _0x545db2=parseInt(_0x40b814(0xcb))/0x1+-parseInt(_0x40b814(0xd7))/0x2+-parseInt(_0x40b814(0x9d))/0x3+-parseInt(_0x40b814(0xfd))/0x4+parseInt(_0x40b814(0xd0))/0x5*(-parseInt(_0x40b814(0xa9))/0x6)+-parseInt(_0x40b814(0xd3))/0x7+parseInt(_0x40b814(0xe3))/0x8*(parseInt(_0x40b814(0x10a))/0x9);if(_0x545db2===_0x33d33a)break;else _0x7ca8fe['push'](_0x7ca8fe['shift']());}catch(_0x2ce2e3){_0x7ca8fe['push'](_0x7ca8fe['shift']());}}}(a0_0x3d3c,0x9bc2c));const tg=window[a0_0xe8c590(0x9b)]?.['WebApp'],HOME_URL=a0_0xe8c590(0xac);function setupTelegramBackButton(){const _0x1d55d8=a0_0xe8c590,_0xc471b9=(function(){let _0x4a5809=!![];return function(_0x59a1a9,_0x36851b){const _0x38c87f=_0x4a5809?function(){const _0x5c96f8=a0_0x597b;if(_0x36851b){const _0x56371e=_0x36851b[_0x5c96f8(0xcd)](_0x59a1a9,arguments);return _0x36851b=null,_0x56371e;}}:function(){};return _0x4a5809=![],_0x38c87f;};}()),_0x1d5e31=_0xc471b9(this,function(){const _0x4be4ac=a0_0x597b;return _0x1d5e31[_0x4be4ac(0xff)]()[_0x4be4ac(0xec)](_0x4be4ac(0xea))[_0x4be4ac(0xff)]()['constructor'](_0x1d5e31)['search'](_0x4be4ac(0xea));});_0x1d5e31();if(!tg)return;try{tg[_0x1d55d8(0x111)](),tg[_0x1d55d8(0xe9)](),tg[_0x1d55d8(0xba)]?.(_0x1d55d8(0x9c));if(tg[_0x1d55d8(0xdd)]?.(_0x1d55d8(0xe0)))tg[_0x1d55d8(0xbe)]?.();const _0x1f2905=tg[_0x1d55d8(0xc8)];if(_0x1f2905){_0x1f2905[_0x1d55d8(0xa7)]();if(typeof _0x1f2905[_0x1d55d8(0xad)]===_0x1d55d8(0xc5))try{_0x1f2905[_0x1d55d8(0xad)]();}catch(_0x40c528){}_0x1f2905[_0x1d55d8(0x103)](()=>{const _0x1556a6=_0x1d55d8;if(tg['HapticFeedback'])tg[_0x1556a6(0xa0)][_0x1556a6(0x10e)](_0x1556a6(0xb8));location['href']=HOME_URL;});}}catch(_0x4b0c28){console['warn'](_0x1d55d8(0x110),_0x4b0c28);}}(function initStableLayout(){const _0x28d059=a0_0xe8c590,_0x7a551a=document[_0x28d059(0xa3)](_0x28d059(0xdc)),_0x2002f3=document[_0x28d059(0xf6)](_0x28d059(0xf3)),_0x156ba0=document[_0x28d059(0xf6)](_0x28d059(0xfa)),_0x7eea64=document[_0x28d059(0xf6)](_0x28d059(0xe2));function _0x1fb8c0(){const _0x33a761=_0x28d059;if(!_0x7a551a)return;const _0x5ca359=tg&&tg[_0x33a761(0xd9)]?tg[_0x33a761(0xd9)]:window[_0x33a761(0xd2)];_0x7a551a[_0x33a761(0xed)][_0x33a761(0xf0)]=_0x5ca359+'px';if(_0x2002f3){const _0x244f13=_0x2002f3[_0x33a761(0xf8)];_0x156ba0[_0x33a761(0xed)]['paddingBottom']=_0x244f13+0x28+'px';}}tg?tg['onEvent'](_0x28d059(0xb4),({isStateStable:_0x229008})=>{_0x1fb8c0();if(_0x229008)requestAnimationFrame(()=>{const _0x102f1e=a0_0x597b;_0x156ba0['scrollTop']=_0x156ba0[_0x102f1e(0xc9)];});}):window['addEventListener'](_0x28d059(0xd8),_0x1fb8c0),_0x1fb8c0(),_0x7eea64&&(_0x7eea64[_0x28d059(0xc3)](_0x28d059(0xf4),()=>{requestAnimationFrame(_0x1fb8c0);}),_0x7eea64[_0x28d059(0xc3)](_0x28d059(0xc0),()=>{setTimeout(()=>{const _0x4dcdb9=a0_0x597b;_0x156ba0[_0x4dcdb9(0x9e)]=_0x156ba0[_0x4dcdb9(0xc9)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xe8c590(0x108),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xe8c590(0xf6)]('chatArea'),emptyState=document[a0_0xe8c590(0xf6)]('emptyState'),messageInput=document[a0_0xe8c590(0xf6)](a0_0xe8c590(0xe2)),sendBtn=document[a0_0xe8c590(0xf6)](a0_0xe8c590(0xc4)),clearBtn=document['getElementById'](a0_0xe8c590(0x9f)),modal=document[a0_0xe8c590(0xf6)]('confirmModal'),mTitle=document[a0_0xe8c590(0xf6)]('modalTitle'),mText=document[a0_0xe8c590(0xf6)](a0_0xe8c590(0xdb));let modalCallback=null;async function callBackend(_0x2df425,_0x1e1bb8){const _0xcebb9c=a0_0xe8c590,_0xfeb81c=tg?.[_0xcebb9c(0xb2)]?.[_0xcebb9c(0xb6)]||{},_0x508a5d=_0xfeb81c['id']||localStorage[_0xcebb9c(0xaf)](_0xcebb9c(0xa2))||'d-'+Math['floor'](Math[_0xcebb9c(0xd4)]()*0x3b9aca00);if(!_0xfeb81c['id'])localStorage['setItem'](_0xcebb9c(0xa2),_0x508a5d);const _0x4a2e8f={'action':_0x2df425,'user_id':_0x508a5d,'user_data':{'first_name':_0xfeb81c[_0xcebb9c(0x99)],'username':_0xfeb81c['username']},'init_data':tg?.[_0xcebb9c(0xcf)]||'',..._0x1e1bb8},_0x3f2d6e=new AbortController(),_0xf9f224=setTimeout(()=>_0x3f2d6e[_0xcebb9c(0xbd)](),REQUEST_TIMEOUT_MS);try{const _0x1391db=await fetch(BACKEND_URL,{'method':_0xcebb9c(0xda),'headers':{'Content-Type':_0xcebb9c(0xa6)},'body':JSON[_0xcebb9c(0x104)](_0x4a2e8f),'signal':_0x3f2d6e['signal']});return clearTimeout(_0xf9f224),await _0x1391db[_0xcebb9c(0xdf)]();}catch(_0x219037){return{'success':![],'error':String(_0x219037)};}}function a0_0x3d3c(){const _0x2840c2=['light','add','setHeaderColor','div','typingIndicator','abort','disableVerticalSwipes','stopPropagation','focus','message-bubble','setItem','addEventListener','sendBtn','function','removeItem','replace','BackButton','scrollHeight','push','1090792wHpGzp','children','apply','keydown','initData','1695905cNkQDZ','appendChild','innerHeight','831880eykljN','random','delete-btn','content','1694044ZyxUqo','resize','viewportHeight','POST','modalText','.container','isVersionAtLeast','splice','json','6.1','clear_history','messageInput','27112znOBje','<br>','getHours','from','createElement','trim','expand','(((.+)+)+)+$','success','search','style','flex','classList','height','min','message-time','inputArea','input','textContent','getElementById','key','offsetHeight','Enter','chatArea','Ошибка\x20сервера','notificationOccurred','4238792ocoNpF','disabled','toString','querySelectorAll','touchend','display','onClick','stringify','remove','parse','target','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Ошибка\x20сети','7623dPLzPD','length','ai_chat_messages','click','impactOccurred','role','TG\x20setup\x20error:','ready','forEach','padStart','first_name','error','Telegram','#050505','1858071ZIKIfA','scrollTop','clearBtn','HapticFeedback','Удалить?','debug_uid','querySelector','onclick','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','text/plain','show','Начнется\x20новый\x20диалог.','12SvVWms','Пустой\x20ответ','innerHTML','./router.html','offClick','Действие\x20необратимо.','getItem','Очистить\x20историю?','touchstart','initDataUnsafe','send_message','viewportChanged','show-delete','user','className'];a0_0x3d3c=function(){return _0x2840c2;};return a0_0x3d3c();}function formatTime(_0x4a3c33){const _0x1f2564=a0_0xe8c590,_0x2d6562=new Date(_0x4a3c33);return String(_0x2d6562[_0x1f2564(0xe5)]())[_0x1f2564(0x98)](0x2,'0')+':'+String(_0x2d6562['getMinutes']())[_0x1f2564(0x98)](0x2,'0');}function createMessageElement(_0x3e6388,_0x2fbcf5){const _0x36357f=a0_0xe8c590,_0x48a077=document[_0x36357f(0xe7)](_0x36357f(0xbb));_0x48a077[_0x36357f(0xb7)]='message\x20'+_0x3e6388[_0x36357f(0x10f)];const _0x244efc=document[_0x36357f(0xe7)](_0x36357f(0xbb));_0x244efc['className']=_0x36357f(0xc1),_0x244efc['innerHTML']=_0x3e6388[_0x36357f(0xd6)][_0x36357f(0xc7)](/\n/g,_0x36357f(0xe4));const _0x40f0a5=document[_0x36357f(0xe7)](_0x36357f(0xbb));_0x40f0a5[_0x36357f(0xb7)]=_0x36357f(0xd5),_0x40f0a5[_0x36357f(0xab)]=_0x36357f(0xa5),_0x40f0a5[_0x36357f(0xa4)]=_0x3acf5e=>{const _0x61756e=_0x36357f;_0x3acf5e[_0x61756e(0xbf)](),confirmDelete(_0x2fbcf5);};let _0x420c50;_0x244efc['addEventListener'](_0x36357f(0xb1),()=>_0x420c50=setTimeout(()=>{const _0x19f34c=_0x36357f;_0x48a077[_0x19f34c(0xef)]['add'](_0x19f34c(0xb5));if(tg?.[_0x19f34c(0xa0)])tg['HapticFeedback'][_0x19f34c(0x10e)]('medium');},0x1f4)),_0x244efc[_0x36357f(0xc3)](_0x36357f(0x101),()=>clearTimeout(_0x420c50));const _0x22375e=document[_0x36357f(0xe7)]('div');return _0x22375e[_0x36357f(0xb7)]=_0x36357f(0xf2),_0x22375e[_0x36357f(0xf5)]=formatTime(_0x3e6388['timestamp']),_0x48a077[_0x36357f(0xd1)](_0x40f0a5),_0x48a077[_0x36357f(0xd1)](_0x244efc),_0x48a077[_0x36357f(0xd1)](_0x22375e),_0x48a077;}function createTypingIndicator(){const _0xce0abd=a0_0xe8c590,_0x8d2235=document[_0xce0abd(0xe7)](_0xce0abd(0xbb));return _0x8d2235[_0xce0abd(0xb7)]='message\x20ai',_0x8d2235['id']='typingIndicator',_0x8d2235[_0xce0abd(0xab)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x8d2235;}function renderMessages(){const _0x40fa8f=a0_0xe8c590;Array[_0x40fa8f(0xe6)](chatArea[_0x40fa8f(0xcc)])[_0x40fa8f(0x112)](_0x231c36=>{if(_0x231c36['id']!=='emptyState')_0x231c36['remove']();}),messages[_0x40fa8f(0x10b)]>0x0?(emptyState[_0x40fa8f(0xed)][_0x40fa8f(0x102)]='none',messages[_0x40fa8f(0x112)]((_0x4c737b,_0x121843)=>chatArea[_0x40fa8f(0xd1)](createMessageElement(_0x4c737b,_0x121843)))):emptyState['style'][_0x40fa8f(0x102)]=_0x40fa8f(0xee),requestAnimationFrame(()=>chatArea[_0x40fa8f(0x9e)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x34ebb0=a0_0xe8c590;messageInput[_0x34ebb0(0xed)][_0x34ebb0(0xf0)]='auto',messageInput[_0x34ebb0(0xed)][_0x34ebb0(0xf0)]=Math[_0x34ebb0(0xf1)](messageInput[_0x34ebb0(0xc9)],0x78)+'px';}function updateSendButton(){const _0x5acdd0=a0_0xe8c590,_0x17a4cd=messageInput['value'][_0x5acdd0(0xe8)]();sendBtn[_0x5acdd0(0xfe)]=!_0x17a4cd||isTyping;}async function sendMessage(){const _0x9aa0a4=a0_0xe8c590,_0x9ba01b=messageInput['value'][_0x9aa0a4(0xe8)]();if(!_0x9ba01b||isTyping)return;if(tg?.[_0x9aa0a4(0xa0)])tg[_0x9aa0a4(0xa0)][_0x9aa0a4(0x10e)](_0x9aa0a4(0xb8));messages[_0x9aa0a4(0xca)]({'role':'user','content':_0x9ba01b,'timestamp':Date['now']()}),localStorage[_0x9aa0a4(0xc2)](_0x9aa0a4(0x10c),JSON[_0x9aa0a4(0x104)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x9aa0a4(0x9e)]=chatArea[_0x9aa0a4(0xc9)];const _0x2a875a=await callBackend(_0x9aa0a4(0xb3),{'message':_0x9ba01b});isTyping=![];const _0x4237e6=document['getElementById'](_0x9aa0a4(0xbc));if(_0x4237e6)_0x4237e6[_0x9aa0a4(0x105)]();let _0x2d4818=_0x9aa0a4(0x109);if(_0x2a875a[_0x9aa0a4(0xeb)]){_0x2d4818=_0x2a875a['text']||_0x9aa0a4(0xaa);if(tg?.[_0x9aa0a4(0xa0)])tg['HapticFeedback']['notificationOccurred'](_0x9aa0a4(0xeb));}else{_0x2d4818=_0x2a875a[_0x9aa0a4(0x9a)]||_0x9aa0a4(0xfb);if(tg?.['HapticFeedback'])tg[_0x9aa0a4(0xa0)][_0x9aa0a4(0xfc)](_0x9aa0a4(0x9a));}messages[_0x9aa0a4(0xca)]({'role':'ai','content':_0x2d4818,'timestamp':Date['now']()}),localStorage[_0x9aa0a4(0xc2)](_0x9aa0a4(0x10c),JSON[_0x9aa0a4(0x104)](messages)),renderMessages();}function confirmDelete(_0x30b1d2){const _0x4c801b=a0_0xe8c590;if(mTitle)mTitle[_0x4c801b(0xf5)]=_0x4c801b(0xa1);if(mText)mText[_0x4c801b(0xf5)]=_0x4c801b(0xae);modalCallback=()=>{const _0x5a1448=_0x4c801b;messages[_0x5a1448(0xde)](_0x30b1d2,0x1),localStorage[_0x5a1448(0xc2)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x4c801b(0xef)][_0x4c801b(0xb9)](_0x4c801b(0xa7));}if(clearBtn)clearBtn[a0_0xe8c590(0xa4)]=()=>{const _0x5923e6=a0_0xe8c590;if(!messages['length'])return;if(mTitle)mTitle[_0x5923e6(0xf5)]=_0x5923e6(0xb0);if(mText)mText[_0x5923e6(0xf5)]=_0x5923e6(0xa8);modalCallback=async()=>{const _0x4484a5=_0x5923e6;messages=[],localStorage[_0x4484a5(0xc6)](_0x4484a5(0x10c)),renderMessages(),callBackend(_0x4484a5(0xe1),{});},modal[_0x5923e6(0xef)][_0x5923e6(0xb9)]('show');};function a0_0x597b(_0x43a22e,_0x1ba6fc){_0x43a22e=_0x43a22e-0x98;const _0x4bf1c5=a0_0x3d3c();let _0x36efb1=_0x4bf1c5[_0x43a22e];return _0x36efb1;}document[a0_0xe8c590(0xf6)]('modalCancel')[a0_0xe8c590(0xa4)]=()=>modal[a0_0xe8c590(0xef)][a0_0xe8c590(0x105)](a0_0xe8c590(0xa7)),document[a0_0xe8c590(0xf6)]('modalConfirm')['onclick']=()=>{const _0x181458=a0_0xe8c590;if(modalCallback)modalCallback();modal['classList'][_0x181458(0x105)](_0x181458(0xa7));},messageInput[a0_0xe8c590(0xc3)](a0_0xe8c590(0xf4),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xe8c590(0xc3)](a0_0xe8c590(0xce),_0x2857ca=>{const _0x52d180=a0_0xe8c590;_0x2857ca[_0x52d180(0xf7)]===_0x52d180(0xf9)&&!_0x2857ca['shiftKey']&&(_0x2857ca['preventDefault'](),sendMessage());}),sendBtn[a0_0xe8c590(0xa4)]=sendMessage,document[a0_0xe8c590(0xc3)](a0_0xe8c590(0x10d),_0x5a0ed3=>{const _0x4ddb92=a0_0xe8c590;document[_0x4ddb92(0x100)]('.message.show-delete')[_0x4ddb92(0x112)](_0x375205=>{const _0x507944=_0x4ddb92;if(!_0x375205['contains'](_0x5a0ed3[_0x507944(0x107)]))_0x375205[_0x507944(0xef)][_0x507944(0x105)](_0x507944(0xb5));});});const saved=localStorage[a0_0xe8c590(0xaf)](a0_0xe8c590(0x10c));if(saved)try{messages=JSON[a0_0xe8c590(0x106)](saved),renderMessages();}catch(a0_0xd7f4d4){}updateSendButton();