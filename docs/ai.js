const a0_0x5abebb=a0_0x3fcb;(function(_0x5ac4c2,_0x5caa25){const _0x2a9a1c=a0_0x3fcb,_0x18ab22=_0x5ac4c2();while(!![]){try{const _0x4ea942=-parseInt(_0x2a9a1c(0x1be))/0x1+parseInt(_0x2a9a1c(0x1d9))/0x2*(parseInt(_0x2a9a1c(0x186))/0x3)+-parseInt(_0x2a9a1c(0x1c5))/0x4+-parseInt(_0x2a9a1c(0x1f7))/0x5+-parseInt(_0x2a9a1c(0x189))/0x6*(-parseInt(_0x2a9a1c(0x1f4))/0x7)+parseInt(_0x2a9a1c(0x1a2))/0x8+-parseInt(_0x2a9a1c(0x1e9))/0x9*(parseInt(_0x2a9a1c(0x1c7))/0xa);if(_0x4ea942===_0x5caa25)break;else _0x18ab22['push'](_0x18ab22['shift']());}catch(_0xb3fa85){_0x18ab22['push'](_0x18ab22['shift']());}}}(a0_0x540b,0x36249));const tg=window[a0_0x5abebb(0x18d)]?.[a0_0x5abebb(0x193)],HOME_URL=a0_0x5abebb(0x1b9);function setupTelegramBackButton(){const _0x44603f=a0_0x5abebb;if(!tg)return;try{tg[_0x44603f(0x1da)](),tg[_0x44603f(0x181)](),tg[_0x44603f(0x1bb)]?.('#050505');if(tg[_0x44603f(0x1ab)]?.(_0x44603f(0x1c2)))tg[_0x44603f(0x1b8)]?.();const _0x113bbb=tg[_0x44603f(0x194)];if(_0x113bbb){_0x113bbb[_0x44603f(0x1d3)]();if(typeof _0x113bbb[_0x44603f(0x1fb)]==='function')try{_0x113bbb[_0x44603f(0x1fb)]();}catch(_0x3fb193){}_0x113bbb[_0x44603f(0x1e8)](()=>{const _0x120579=_0x44603f;if(tg[_0x120579(0x1d5)])tg[_0x120579(0x1d5)][_0x120579(0x1b4)](_0x120579(0x18f));location['href']=HOME_URL;});}}catch(_0x408315){console[_0x44603f(0x1dd)](_0x44603f(0x19e),_0x408315);}}(function initStableLayout(){const _0x23c06c=a0_0x5abebb,_0x2c19e7=(function(){let _0x5f05b6=!![];return function(_0x34f4d8,_0x2a7918){const _0x35bff9=_0x5f05b6?function(){const _0x17e970=a0_0x3fcb;if(_0x2a7918){const _0x1cd82f=_0x2a7918[_0x17e970(0x19f)](_0x34f4d8,arguments);return _0x2a7918=null,_0x1cd82f;}}:function(){};return _0x5f05b6=![],_0x35bff9;};}()),_0x6f6547=document[_0x23c06c(0x1f1)](_0x23c06c(0x1e1)),_0x3b684e=document[_0x23c06c(0x1ec)](_0x23c06c(0x1db)),_0x20f713=document[_0x23c06c(0x1ec)](_0x23c06c(0x1af)),_0x49f46a=document[_0x23c06c(0x1ec)](_0x23c06c(0x1e0));function _0x18fbd5(){const _0x3b7e6a=_0x23c06c,_0x10062f=_0x2c19e7(this,function(){const _0x1fcc6f=a0_0x3fcb;return _0x10062f['toString']()[_0x1fcc6f(0x1a3)](_0x1fcc6f(0x1e3))[_0x1fcc6f(0x185)]()[_0x1fcc6f(0x1d8)](_0x10062f)[_0x1fcc6f(0x1a3)](_0x1fcc6f(0x1e3));});_0x10062f();if(!_0x6f6547)return;const _0x433987=tg&&tg[_0x3b7e6a(0x1a4)]?tg[_0x3b7e6a(0x1a4)]:window[_0x3b7e6a(0x1e6)];_0x6f6547['style'][_0x3b7e6a(0x1e4)]=_0x433987+'px';if(_0x3b684e){const _0x4f1717=_0x3b684e[_0x3b7e6a(0x1a7)];_0x20f713[_0x3b7e6a(0x18e)]['paddingBottom']=_0x4f1717+0x28+'px';}}tg?tg[_0x23c06c(0x1c4)]('viewportChanged',({isStateStable:_0x5e77bc})=>{_0x18fbd5();if(_0x5e77bc)requestAnimationFrame(()=>{const _0x514654=a0_0x3fcb;_0x20f713[_0x514654(0x188)]=_0x20f713[_0x514654(0x1f8)];});}):window[_0x23c06c(0x1d4)](_0x23c06c(0x187),_0x18fbd5),_0x18fbd5(),_0x49f46a&&(_0x49f46a[_0x23c06c(0x1d4)](_0x23c06c(0x195),()=>{requestAnimationFrame(_0x18fbd5);}),_0x49f46a[_0x23c06c(0x1d4)](_0x23c06c(0x18c),()=>{setTimeout(()=>{const _0x49fd8a=a0_0x3fcb;_0x20f713[_0x49fd8a(0x188)]=_0x20f713['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5abebb(0x1b5),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x3fcb(_0x277d7f,_0x3e8d19){_0x277d7f=_0x277d7f-0x181;const _0x664e80=a0_0x540b();let _0x245982=_0x664e80[_0x277d7f];return _0x245982;}function a0_0x540b(){const _0x380df1=['stringify','value','WebApp','BackButton','input','setItem','modalConfirm','confirmModal','contains','message-time','preventDefault','className','appendChild','TG\x20setup\x20error:','apply','children','notificationOccurred','1778784bzNifK','search','viewportHeight','textContent','padStart','offsetHeight','emptyState','classList','splice','isVersionAtLeast','.message.show-delete','remove','role','chatArea','push','querySelectorAll','debug_uid','removeItem','impactOccurred','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','json','shiftKey','disableVerticalSwipes','./router.html','POST','setHeaderColor','delete-btn','content','123428fdTlRN','initData','typingIndicator','ai_chat_messages','6.1','send_message','onEvent','816800cxnFrF','Начнется\x20новый\x20диалог.','439910dlgoys','Enter','abort','Пустой\x20ответ','touchend','replace','message\x20','now','touchstart','length','clear_history','Удалить?','show','addEventListener','HapticFeedback','modalTitle','target','constructor','94BShyzA','ready','inputArea','show-delete','warn','success','from','messageInput','.container','message-bubble','(((.+)+)+)+$','height','text/plain','innerHeight','add','onClick','9OQjXwP','username','onclick','getElementById','<br>','auto','flex','error','querySelector','sendBtn','innerHTML','1120749biAQEX','createElement','forEach','1635035PiiDtg','scrollHeight','getMinutes','user','offClick','Действие\x20необратимо.','display','signal','Ошибка\x20сервера','message\x20ai','expand','first_name','Очистить\x20историю?','trim','toString','24117Wvjyms','resize','scrollTop','12xZCUQF','parse','div','focus','Telegram','style','light','getItem'];a0_0x540b=function(){return _0x380df1;};return a0_0x540b();}const chatArea=document[a0_0x5abebb(0x1ec)](a0_0x5abebb(0x1af)),emptyState=document[a0_0x5abebb(0x1ec)](a0_0x5abebb(0x1a8)),messageInput=document[a0_0x5abebb(0x1ec)](a0_0x5abebb(0x1e0)),sendBtn=document[a0_0x5abebb(0x1ec)](a0_0x5abebb(0x1f2)),clearBtn=document['getElementById']('clearBtn'),modal=document['getElementById'](a0_0x5abebb(0x198)),mTitle=document[a0_0x5abebb(0x1ec)](a0_0x5abebb(0x1d6)),mText=document[a0_0x5abebb(0x1ec)]('modalText');let modalCallback=null;async function callBackend(_0x3bbddb,_0x2e1cf2){const _0x2224fe=a0_0x5abebb,_0xee5412=tg?.['initDataUnsafe']?.['user']||{},_0x43e813=_0xee5412['id']||localStorage[_0x2224fe(0x190)](_0x2224fe(0x1b2))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0xee5412['id'])localStorage[_0x2224fe(0x196)](_0x2224fe(0x1b2),_0x43e813);const _0x25f92e={'action':_0x3bbddb,'user_id':_0x43e813,'user_data':{'first_name':_0xee5412[_0x2224fe(0x182)],'username':_0xee5412[_0x2224fe(0x1ea)]},'init_data':tg?.[_0x2224fe(0x1bf)]||'',..._0x2e1cf2},_0x3bd4df=new AbortController(),_0x353d9a=setTimeout(()=>_0x3bd4df[_0x2224fe(0x1c9)](),REQUEST_TIMEOUT_MS);try{const _0x17f092=await fetch(BACKEND_URL,{'method':_0x2224fe(0x1ba),'headers':{'Content-Type':_0x2224fe(0x1e5)},'body':JSON[_0x2224fe(0x191)](_0x25f92e),'signal':_0x3bd4df[_0x2224fe(0x1fe)]});return clearTimeout(_0x353d9a),await _0x17f092[_0x2224fe(0x1b6)]();}catch(_0x3a3e25){return{'success':![],'error':String(_0x3a3e25)};}}function formatTime(_0x1e02a4){const _0x11bbb7=a0_0x5abebb,_0xb15576=new Date(_0x1e02a4);return String(_0xb15576['getHours']())[_0x11bbb7(0x1a6)](0x2,'0')+':'+String(_0xb15576[_0x11bbb7(0x1f9)]())[_0x11bbb7(0x1a6)](0x2,'0');}function createMessageElement(_0x22996e,_0x423ff6){const _0x33c75d=a0_0x5abebb,_0x76d0cd=document[_0x33c75d(0x1f5)](_0x33c75d(0x18b));_0x76d0cd[_0x33c75d(0x19c)]=_0x33c75d(0x1cd)+_0x22996e[_0x33c75d(0x1ae)];const _0x3afe71=document[_0x33c75d(0x1f5)]('div');_0x3afe71['className']=_0x33c75d(0x1e2),_0x3afe71[_0x33c75d(0x1f3)]=_0x22996e[_0x33c75d(0x1bd)][_0x33c75d(0x1cc)](/\n/g,_0x33c75d(0x1ed));const _0x3c0122=document[_0x33c75d(0x1f5)](_0x33c75d(0x18b));_0x3c0122[_0x33c75d(0x19c)]=_0x33c75d(0x1bc),_0x3c0122[_0x33c75d(0x1f3)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x3c0122[_0x33c75d(0x1eb)]=_0xcdc69b=>{_0xcdc69b['stopPropagation'](),confirmDelete(_0x423ff6);};let _0x15a6de;_0x3afe71['addEventListener'](_0x33c75d(0x1cf),()=>_0x15a6de=setTimeout(()=>{const _0x49a364=_0x33c75d;_0x76d0cd[_0x49a364(0x1a9)][_0x49a364(0x1e7)](_0x49a364(0x1dc));if(tg?.['HapticFeedback'])tg[_0x49a364(0x1d5)][_0x49a364(0x1b4)]('medium');},0x1f4)),_0x3afe71[_0x33c75d(0x1d4)](_0x33c75d(0x1cb),()=>clearTimeout(_0x15a6de));const _0x3b3542=document['createElement'](_0x33c75d(0x18b));return _0x3b3542['className']=_0x33c75d(0x19a),_0x3b3542[_0x33c75d(0x1a5)]=formatTime(_0x22996e['timestamp']),_0x76d0cd['appendChild'](_0x3c0122),_0x76d0cd[_0x33c75d(0x19d)](_0x3afe71),_0x76d0cd[_0x33c75d(0x19d)](_0x3b3542),_0x76d0cd;}function createTypingIndicator(){const _0x53c157=a0_0x5abebb,_0x3eb5dd=document[_0x53c157(0x1f5)](_0x53c157(0x18b));return _0x3eb5dd[_0x53c157(0x19c)]=_0x53c157(0x200),_0x3eb5dd['id']=_0x53c157(0x1c0),_0x3eb5dd['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x3eb5dd;}function renderMessages(){const _0x2251b7=a0_0x5abebb;Array[_0x2251b7(0x1df)](chatArea[_0x2251b7(0x1a0)])['forEach'](_0x5bca45=>{const _0x554a85=_0x2251b7;if(_0x5bca45['id']!==_0x554a85(0x1a8))_0x5bca45[_0x554a85(0x1ad)]();}),messages[_0x2251b7(0x1d0)]>0x0?(emptyState['style']['display']='none',messages['forEach']((_0x180d52,_0x1537ba)=>chatArea[_0x2251b7(0x19d)](createMessageElement(_0x180d52,_0x1537ba)))):emptyState[_0x2251b7(0x18e)][_0x2251b7(0x1fd)]=_0x2251b7(0x1ef),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x2a88d4=a0_0x5abebb;messageInput[_0x2a88d4(0x18e)][_0x2a88d4(0x1e4)]=_0x2a88d4(0x1ee),messageInput[_0x2a88d4(0x18e)]['height']=Math['min'](messageInput[_0x2a88d4(0x1f8)],0x78)+'px';}function updateSendButton(){const _0x34c160=a0_0x5abebb,_0x58751a=messageInput[_0x34c160(0x192)][_0x34c160(0x184)]();sendBtn['disabled']=!_0x58751a||isTyping;}async function sendMessage(){const _0x5bbed5=a0_0x5abebb,_0x108eb2=messageInput[_0x5bbed5(0x192)][_0x5bbed5(0x184)]();if(!_0x108eb2||isTyping)return;if(tg?.[_0x5bbed5(0x1d5)])tg[_0x5bbed5(0x1d5)][_0x5bbed5(0x1b4)](_0x5bbed5(0x18f));messages[_0x5bbed5(0x1b0)]({'role':_0x5bbed5(0x1fa),'content':_0x108eb2,'timestamp':Date[_0x5bbed5(0x1ce)]()}),localStorage[_0x5bbed5(0x196)](_0x5bbed5(0x1c1),JSON[_0x5bbed5(0x191)](messages)),renderMessages(),messageInput[_0x5bbed5(0x192)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5bbed5(0x19d)](createTypingIndicator()),chatArea[_0x5bbed5(0x188)]=chatArea[_0x5bbed5(0x1f8)];const _0x229385=await callBackend(_0x5bbed5(0x1c3),{'message':_0x108eb2});isTyping=![];const _0x42bbd9=document[_0x5bbed5(0x1ec)](_0x5bbed5(0x1c0));if(_0x42bbd9)_0x42bbd9['remove']();let _0x4c5ce7='Ошибка\x20сети';if(_0x229385[_0x5bbed5(0x1de)]){_0x4c5ce7=_0x229385['text']||_0x5bbed5(0x1ca);if(tg?.[_0x5bbed5(0x1d5)])tg[_0x5bbed5(0x1d5)][_0x5bbed5(0x1a1)](_0x5bbed5(0x1de));}else{_0x4c5ce7=_0x229385[_0x5bbed5(0x1f0)]||_0x5bbed5(0x1ff);if(tg?.[_0x5bbed5(0x1d5)])tg[_0x5bbed5(0x1d5)][_0x5bbed5(0x1a1)](_0x5bbed5(0x1f0));}messages[_0x5bbed5(0x1b0)]({'role':'ai','content':_0x4c5ce7,'timestamp':Date[_0x5bbed5(0x1ce)]()}),localStorage[_0x5bbed5(0x196)]('ai_chat_messages',JSON[_0x5bbed5(0x191)](messages)),renderMessages();}function confirmDelete(_0x3a45ac){const _0x419453=a0_0x5abebb;if(mTitle)mTitle[_0x419453(0x1a5)]=_0x419453(0x1d2);if(mText)mText['textContent']=_0x419453(0x1fc);modalCallback=()=>{const _0x3ae5fd=_0x419453;messages[_0x3ae5fd(0x1aa)](_0x3a45ac,0x1),localStorage[_0x3ae5fd(0x196)](_0x3ae5fd(0x1c1),JSON['stringify'](messages)),renderMessages();},modal[_0x419453(0x1a9)][_0x419453(0x1e7)]('show');}if(clearBtn)clearBtn['onclick']=()=>{const _0x58a225=a0_0x5abebb;if(!messages['length'])return;if(mTitle)mTitle[_0x58a225(0x1a5)]=_0x58a225(0x183);if(mText)mText['textContent']=_0x58a225(0x1c6);modalCallback=async()=>{const _0x37b59a=_0x58a225;messages=[],localStorage[_0x37b59a(0x1b3)](_0x37b59a(0x1c1)),renderMessages(),callBackend(_0x37b59a(0x1d1),{});},modal[_0x58a225(0x1a9)][_0x58a225(0x1e7)](_0x58a225(0x1d3));};document[a0_0x5abebb(0x1ec)]('modalCancel')[a0_0x5abebb(0x1eb)]=()=>modal[a0_0x5abebb(0x1a9)][a0_0x5abebb(0x1ad)]('show'),document[a0_0x5abebb(0x1ec)](a0_0x5abebb(0x197))[a0_0x5abebb(0x1eb)]=()=>{const _0x350c2d=a0_0x5abebb;if(modalCallback)modalCallback();modal['classList'][_0x350c2d(0x1ad)]('show');},messageInput['addEventListener'](a0_0x5abebb(0x195),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5abebb(0x1d4)]('keydown',_0x1e2621=>{const _0x37c85e=a0_0x5abebb;_0x1e2621['key']===_0x37c85e(0x1c8)&&!_0x1e2621[_0x37c85e(0x1b7)]&&(_0x1e2621[_0x37c85e(0x19b)](),sendMessage());}),sendBtn[a0_0x5abebb(0x1eb)]=sendMessage,document[a0_0x5abebb(0x1d4)]('click',_0x22c806=>{const _0x3f71f3=a0_0x5abebb;document[_0x3f71f3(0x1b1)](_0x3f71f3(0x1ac))[_0x3f71f3(0x1f6)](_0x2e9b68=>{const _0x351180=_0x3f71f3;if(!_0x2e9b68[_0x351180(0x199)](_0x22c806[_0x351180(0x1d7)]))_0x2e9b68[_0x351180(0x1a9)]['remove'](_0x351180(0x1dc));});});const saved=localStorage[a0_0x5abebb(0x190)](a0_0x5abebb(0x1c1));if(saved)try{messages=JSON[a0_0x5abebb(0x18a)](saved),renderMessages();}catch(a0_0x2e4f33){}updateSendButton();