const a0_0x1ec9f5=a0_0x228f;(function(_0xa4a0f8,_0x4f5795){const _0xd37e94=a0_0x228f,_0x4d8dd1=_0xa4a0f8();while(!![]){try{const _0x17ea20=-parseInt(_0xd37e94(0x100))/0x1*(-parseInt(_0xd37e94(0x124))/0x2)+parseInt(_0xd37e94(0x13c))/0x3+-parseInt(_0xd37e94(0x10f))/0x4*(parseInt(_0xd37e94(0x132))/0x5)+parseInt(_0xd37e94(0xe8))/0x6+parseInt(_0xd37e94(0x13e))/0x7*(-parseInt(_0xd37e94(0x15f))/0x8)+-parseInt(_0xd37e94(0x139))/0x9+-parseInt(_0xd37e94(0xec))/0xa*(parseInt(_0xd37e94(0x157))/0xb);if(_0x17ea20===_0x4f5795)break;else _0x4d8dd1['push'](_0x4d8dd1['shift']());}catch(_0x1a4878){_0x4d8dd1['push'](_0x4d8dd1['shift']());}}}(a0_0x21a9,0xa48a6));const tg=window[a0_0x1ec9f5(0xed)]?.[a0_0x1ec9f5(0x15d)],HOME_URL=a0_0x1ec9f5(0x162);function a0_0x228f(_0x6b1e37,_0x106d61){_0x6b1e37=_0x6b1e37-0xe4;const _0x1dc5ad=a0_0x21a9();let _0x2a77c4=_0x1dc5ad[_0x6b1e37];return _0x2a77c4;}function setupTelegramBackButton(){const _0x5d32a0=a0_0x1ec9f5;if(!tg)return;try{tg['ready'](),tg[_0x5d32a0(0x111)](),tg[_0x5d32a0(0x152)]?.(_0x5d32a0(0x143));if(tg[_0x5d32a0(0x14f)]?.(_0x5d32a0(0x153)))tg[_0x5d32a0(0xf3)]?.();const _0x2c94f5=tg[_0x5d32a0(0x136)];if(_0x2c94f5){_0x2c94f5[_0x5d32a0(0x11b)]();if(typeof _0x2c94f5['offClick']===_0x5d32a0(0x104))try{_0x2c94f5[_0x5d32a0(0x156)]();}catch(_0x59ebc6){}_0x2c94f5[_0x5d32a0(0x135)](()=>{const _0x3cb96c=_0x5d32a0;if(tg[_0x3cb96c(0x11c)])tg[_0x3cb96c(0x11c)][_0x3cb96c(0x130)](_0x3cb96c(0xe6));location[_0x3cb96c(0x147)]=HOME_URL;});}}catch(_0x240276){console[_0x5d32a0(0x14a)](_0x5d32a0(0x110),_0x240276);}}(function initStableLayout(){const _0x28433a=a0_0x1ec9f5,_0xc31bfd=(function(){let _0x37f507=!![];return function(_0x1d9730,_0x588669){const _0x22bc1a=_0x37f507?function(){const _0xb79a06=a0_0x228f;if(_0x588669){const _0x14f863=_0x588669[_0xb79a06(0x118)](_0x1d9730,arguments);return _0x588669=null,_0x14f863;}}:function(){};return _0x37f507=![],_0x22bc1a;};}()),_0x18860b=document[_0x28433a(0xf2)]('.container'),_0x2ccbe5=document[_0x28433a(0x108)](_0x28433a(0x114)),_0x19dce5=document['getElementById']('chatArea'),_0x444dbc=document[_0x28433a(0x108)](_0x28433a(0xf4));function _0x2c8a44(){const _0x60aa19=_0x28433a,_0x3108d0=_0xc31bfd(this,function(){const _0x2073a8=a0_0x228f;return _0x3108d0['toString']()['search'](_0x2073a8(0x149))['toString']()[_0x2073a8(0x142)](_0x3108d0)[_0x2073a8(0x12d)]('(((.+)+)+)+$');});_0x3108d0();if(!_0x18860b)return;const _0x45d369=tg&&tg[_0x60aa19(0x10e)]?tg[_0x60aa19(0x10e)]:window['innerHeight'];_0x18860b[_0x60aa19(0x165)][_0x60aa19(0x12c)]=_0x45d369+'px';if(_0x2ccbe5){const _0x5693fd=_0x2ccbe5[_0x60aa19(0x107)];_0x19dce5[_0x60aa19(0x165)][_0x60aa19(0x138)]=_0x5693fd+0x28+'px';}}tg?tg[_0x28433a(0x151)]('viewportChanged',({isStateStable:_0x4875bd})=>{_0x2c8a44();if(_0x4875bd)requestAnimationFrame(()=>{const _0x3e5c30=a0_0x228f;_0x19dce5[_0x3e5c30(0x12f)]=_0x19dce5['scrollHeight'];});}):window[_0x28433a(0xfe)](_0x28433a(0xe5),_0x2c8a44),_0x2c8a44(),_0x444dbc&&(_0x444dbc[_0x28433a(0xfe)](_0x28433a(0xf5),()=>{requestAnimationFrame(_0x2c8a44);}),_0x444dbc['addEventListener']('focus',()=>{setTimeout(()=>{const _0xf35d45=a0_0x228f;_0x19dce5['scrollTop']=_0x19dce5[_0xf35d45(0xfc)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1ec9f5(0x10b),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x21a9(){const _0x3adaa4=['./router.html','add','classList','style','emptyState','Очистить\x20историю?','sendBtn','resize','light','ai_chat_messages','5692548LjGgqz','message-time','getHours','className','1085460jOCKAB','Telegram','clear_history','disabled','role','div','querySelector','disableVerticalSwipes','messageInput','input','trim','shiftKey','text','chatArea','min','stopPropagation','scrollHeight','createElement','addEventListener','innerHTML','2747bWpvAi','abort','key','forEach','function','message\x20','push','offsetHeight','getElementById','initData','stringify','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Удалить?','content','viewportHeight','8VODUqt','TG\x20setup\x20error:','expand','querySelectorAll','textContent','inputArea','parse','none','show-delete','apply','Начнется\x20новый\x20диалог.','remove','show','HapticFeedback','now','modalText','.message.show-delete','Ошибка\x20сети','json','clearBtn','touchend','662SBlrlE','success','children','Пустой\x20ответ','typingIndicator','first_name','debug_uid','getMinutes','height','search','getItem','scrollTop','impactOccurred','POST','2975230bjqLTq','length','target','onClick','BackButton','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','paddingBottom','758223vjWfjy','setItem','removeItem','2002860gWnozU','modalCancel','840574phPZfM','user','Enter','click','constructor','#050505','preventDefault','contains','modalConfirm','href','appendChild','(((.+)+)+)+$','warn','message\x20ai','timestamp','touchstart','display','isVersionAtLeast','floor','onEvent','setHeaderColor','6.1','username','confirmModal','offClick','22DufJbt','Действие\x20необратимо.','keydown','send_message','padStart','from','WebApp','onclick','24VvQUPZ','Ошибка\x20сервера','random'];a0_0x21a9=function(){return _0x3adaa4;};return a0_0x21a9();}let messages=[],isTyping=![];const chatArea=document[a0_0x1ec9f5(0x108)](a0_0x1ec9f5(0xf9)),emptyState=document[a0_0x1ec9f5(0x108)](a0_0x1ec9f5(0x166)),messageInput=document[a0_0x1ec9f5(0x108)]('messageInput'),sendBtn=document[a0_0x1ec9f5(0x108)](a0_0x1ec9f5(0xe4)),clearBtn=document[a0_0x1ec9f5(0x108)](a0_0x1ec9f5(0x122)),modal=document[a0_0x1ec9f5(0x108)](a0_0x1ec9f5(0x155)),mTitle=document[a0_0x1ec9f5(0x108)]('modalTitle'),mText=document[a0_0x1ec9f5(0x108)](a0_0x1ec9f5(0x11e));let modalCallback=null;async function callBackend(_0x369fbb,_0x43bdf3){const _0x4f1ac5=a0_0x1ec9f5,_0x290a6e=tg?.['initDataUnsafe']?.[_0x4f1ac5(0x13f)]||{},_0x42022f=_0x290a6e['id']||localStorage[_0x4f1ac5(0x12e)](_0x4f1ac5(0x12a))||'d-'+Math[_0x4f1ac5(0x150)](Math[_0x4f1ac5(0x161)]()*0x3b9aca00);if(!_0x290a6e['id'])localStorage[_0x4f1ac5(0x13a)](_0x4f1ac5(0x12a),_0x42022f);const _0x2c0f99={'action':_0x369fbb,'user_id':_0x42022f,'user_data':{'first_name':_0x290a6e[_0x4f1ac5(0x129)],'username':_0x290a6e[_0x4f1ac5(0x154)]},'init_data':tg?.[_0x4f1ac5(0x109)]||'',..._0x43bdf3},_0x54f82b=new AbortController(),_0x71c4b9=setTimeout(()=>_0x54f82b[_0x4f1ac5(0x101)](),REQUEST_TIMEOUT_MS);try{const _0x979545=await fetch(BACKEND_URL,{'method':_0x4f1ac5(0x131),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x4f1ac5(0x10a)](_0x2c0f99),'signal':_0x54f82b['signal']});return clearTimeout(_0x71c4b9),await _0x979545[_0x4f1ac5(0x121)]();}catch(_0x3e642b){return{'success':![],'error':String(_0x3e642b)};}}function formatTime(_0x58bac2){const _0x22c84a=a0_0x1ec9f5,_0x25a692=new Date(_0x58bac2);return String(_0x25a692[_0x22c84a(0xea)]())[_0x22c84a(0x15b)](0x2,'0')+':'+String(_0x25a692[_0x22c84a(0x12b)]())[_0x22c84a(0x15b)](0x2,'0');}function createMessageElement(_0x2ae09f,_0x398968){const _0x264c3b=a0_0x1ec9f5,_0x4cc8bd=document[_0x264c3b(0xfd)](_0x264c3b(0xf1));_0x4cc8bd[_0x264c3b(0xeb)]=_0x264c3b(0x105)+_0x2ae09f[_0x264c3b(0xf0)];const _0x8c5a3c=document['createElement'](_0x264c3b(0xf1));_0x8c5a3c['className']='message-bubble',_0x8c5a3c[_0x264c3b(0xff)]=_0x2ae09f[_0x264c3b(0x10d)]['replace'](/\n/g,'<br>');const _0xeee0b3=document[_0x264c3b(0xfd)](_0x264c3b(0xf1));_0xeee0b3[_0x264c3b(0xeb)]='delete-btn',_0xeee0b3[_0x264c3b(0xff)]=_0x264c3b(0x137),_0xeee0b3[_0x264c3b(0x15e)]=_0x3eb1f9=>{const _0x5a675a=_0x264c3b;_0x3eb1f9[_0x5a675a(0xfb)](),confirmDelete(_0x398968);};let _0x4864d4;_0x8c5a3c[_0x264c3b(0xfe)](_0x264c3b(0x14d),()=>_0x4864d4=setTimeout(()=>{const _0x384659=_0x264c3b;_0x4cc8bd[_0x384659(0x164)][_0x384659(0x163)](_0x384659(0x117));if(tg?.[_0x384659(0x11c)])tg[_0x384659(0x11c)][_0x384659(0x130)]('medium');},0x1f4)),_0x8c5a3c[_0x264c3b(0xfe)](_0x264c3b(0x123),()=>clearTimeout(_0x4864d4));const _0x12d40e=document[_0x264c3b(0xfd)](_0x264c3b(0xf1));return _0x12d40e[_0x264c3b(0xeb)]=_0x264c3b(0xe9),_0x12d40e['textContent']=formatTime(_0x2ae09f[_0x264c3b(0x14c)]),_0x4cc8bd[_0x264c3b(0x148)](_0xeee0b3),_0x4cc8bd[_0x264c3b(0x148)](_0x8c5a3c),_0x4cc8bd[_0x264c3b(0x148)](_0x12d40e),_0x4cc8bd;}function createTypingIndicator(){const _0x11ff66=a0_0x1ec9f5,_0x25ff9b=document['createElement'](_0x11ff66(0xf1));return _0x25ff9b[_0x11ff66(0xeb)]=_0x11ff66(0x14b),_0x25ff9b['id']=_0x11ff66(0x128),_0x25ff9b[_0x11ff66(0xff)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x25ff9b;}function renderMessages(){const _0x12a1ca=a0_0x1ec9f5;Array[_0x12a1ca(0x15c)](chatArea[_0x12a1ca(0x126)])[_0x12a1ca(0x103)](_0x579127=>{const _0x4a0676=_0x12a1ca;if(_0x579127['id']!==_0x4a0676(0x166))_0x579127[_0x4a0676(0x11a)]();}),messages[_0x12a1ca(0x133)]>0x0?(emptyState[_0x12a1ca(0x165)][_0x12a1ca(0x14e)]=_0x12a1ca(0x116),messages[_0x12a1ca(0x103)]((_0x4979fd,_0x4261ec)=>chatArea[_0x12a1ca(0x148)](createMessageElement(_0x4979fd,_0x4261ec)))):emptyState[_0x12a1ca(0x165)][_0x12a1ca(0x14e)]='flex',requestAnimationFrame(()=>chatArea[_0x12a1ca(0x12f)]=chatArea[_0x12a1ca(0xfc)]);}function autoResizeTextarea(){const _0x5106e2=a0_0x1ec9f5;messageInput[_0x5106e2(0x165)]['height']='auto',messageInput[_0x5106e2(0x165)][_0x5106e2(0x12c)]=Math[_0x5106e2(0xfa)](messageInput[_0x5106e2(0xfc)],0x78)+'px';}function updateSendButton(){const _0x1ec7e0=a0_0x1ec9f5,_0x174b74=messageInput['value']['trim']();sendBtn[_0x1ec7e0(0xef)]=!_0x174b74||isTyping;}async function sendMessage(){const _0x105e9b=a0_0x1ec9f5,_0x9e017f=messageInput['value'][_0x105e9b(0xf6)]();if(!_0x9e017f||isTyping)return;if(tg?.[_0x105e9b(0x11c)])tg[_0x105e9b(0x11c)][_0x105e9b(0x130)](_0x105e9b(0xe6));messages['push']({'role':_0x105e9b(0x13f),'content':_0x9e017f,'timestamp':Date[_0x105e9b(0x11d)]()}),localStorage[_0x105e9b(0x13a)](_0x105e9b(0xe7),JSON[_0x105e9b(0x10a)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x105e9b(0x12f)]=chatArea[_0x105e9b(0xfc)];const _0x4a4503=await callBackend(_0x105e9b(0x15a),{'message':_0x9e017f});isTyping=![];const _0x1a9492=document['getElementById'](_0x105e9b(0x128));if(_0x1a9492)_0x1a9492['remove']();let _0x462c2a=_0x105e9b(0x120);if(_0x4a4503[_0x105e9b(0x125)]){_0x462c2a=_0x4a4503[_0x105e9b(0xf8)]||_0x105e9b(0x127);if(tg?.[_0x105e9b(0x11c)])tg[_0x105e9b(0x11c)]['notificationOccurred'](_0x105e9b(0x125));}else{_0x462c2a=_0x4a4503['error']||_0x105e9b(0x160);if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred']('error');}messages[_0x105e9b(0x106)]({'role':'ai','content':_0x462c2a,'timestamp':Date['now']()}),localStorage[_0x105e9b(0x13a)](_0x105e9b(0xe7),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x5d67c7){const _0x3cefc8=a0_0x1ec9f5;if(mTitle)mTitle['textContent']=_0x3cefc8(0x10c);if(mText)mText[_0x3cefc8(0x113)]=_0x3cefc8(0x158);modalCallback=()=>{messages['splice'](_0x5d67c7,0x1),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x3cefc8(0x163)]('show');}if(clearBtn)clearBtn[a0_0x1ec9f5(0x15e)]=()=>{const _0x51d483=a0_0x1ec9f5;if(!messages[_0x51d483(0x133)])return;if(mTitle)mTitle[_0x51d483(0x113)]=_0x51d483(0x167);if(mText)mText['textContent']=_0x51d483(0x119);modalCallback=async()=>{const _0x4a5c8c=_0x51d483;messages=[],localStorage[_0x4a5c8c(0x13b)](_0x4a5c8c(0xe7)),renderMessages(),callBackend(_0x4a5c8c(0xee),{});},modal['classList']['add']('show');};document[a0_0x1ec9f5(0x108)](a0_0x1ec9f5(0x13d))[a0_0x1ec9f5(0x15e)]=()=>modal[a0_0x1ec9f5(0x164)]['remove'](a0_0x1ec9f5(0x11b)),document[a0_0x1ec9f5(0x108)](a0_0x1ec9f5(0x146))[a0_0x1ec9f5(0x15e)]=()=>{const _0x57cee8=a0_0x1ec9f5;if(modalCallback)modalCallback();modal[_0x57cee8(0x164)][_0x57cee8(0x11a)](_0x57cee8(0x11b));},messageInput[a0_0x1ec9f5(0xfe)](a0_0x1ec9f5(0xf5),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1ec9f5(0xfe)](a0_0x1ec9f5(0x159),_0x376d14=>{const _0x40aa4c=a0_0x1ec9f5;_0x376d14[_0x40aa4c(0x102)]===_0x40aa4c(0x140)&&!_0x376d14[_0x40aa4c(0xf7)]&&(_0x376d14[_0x40aa4c(0x144)](),sendMessage());}),sendBtn[a0_0x1ec9f5(0x15e)]=sendMessage,document[a0_0x1ec9f5(0xfe)](a0_0x1ec9f5(0x141),_0x229dc8=>{const _0x4d5f84=a0_0x1ec9f5;document[_0x4d5f84(0x112)](_0x4d5f84(0x11f))['forEach'](_0x11beb3=>{const _0x412c87=_0x4d5f84;if(!_0x11beb3[_0x412c87(0x145)](_0x229dc8[_0x412c87(0x134)]))_0x11beb3[_0x412c87(0x164)][_0x412c87(0x11a)](_0x412c87(0x117));});});const saved=localStorage[a0_0x1ec9f5(0x12e)](a0_0x1ec9f5(0xe7));if(saved)try{messages=JSON[a0_0x1ec9f5(0x115)](saved),renderMessages();}catch(a0_0x2030a1){}updateSendButton();