const a0_0x5a5a2f=a0_0x121b;(function(_0x13ad63,_0x59d969){const _0x381285=a0_0x121b,_0x523031=_0x13ad63();while(!![]){try{const _0x337861=parseInt(_0x381285(0x175))/0x1*(parseInt(_0x381285(0x1ed))/0x2)+-parseInt(_0x381285(0x1ad))/0x3*(parseInt(_0x381285(0x1ca))/0x4)+-parseInt(_0x381285(0x1e8))/0x5+parseInt(_0x381285(0x1a6))/0x6+parseInt(_0x381285(0x1c2))/0x7*(-parseInt(_0x381285(0x195))/0x8)+parseInt(_0x381285(0x179))/0x9*(parseInt(_0x381285(0x1cf))/0xa)+parseInt(_0x381285(0x19a))/0xb*(-parseInt(_0x381285(0x17b))/0xc);if(_0x337861===_0x59d969)break;else _0x523031['push'](_0x523031['shift']());}catch(_0x4fe009){_0x523031['push'](_0x523031['shift']());}}}(a0_0x4b6f,0x6f2ca));const tg=window[a0_0x5a5a2f(0x1a9)]?.['WebApp'],HOME_URL=a0_0x5a5a2f(0x19c);function setupTelegramBackButton(){const _0x508e20=a0_0x5a5a2f;if(!tg)return;try{tg[_0x508e20(0x1e1)](),tg[_0x508e20(0x1ea)](),tg['setHeaderColor']?.('#050505');if(tg[_0x508e20(0x1d4)]?.(_0x508e20(0x1d9)))tg['disableVerticalSwipes']?.();const _0x5c8bf2=tg[_0x508e20(0x186)];if(_0x5c8bf2){_0x5c8bf2[_0x508e20(0x1d3)]();if(typeof _0x5c8bf2[_0x508e20(0x1ac)]===_0x508e20(0x1ce))try{_0x5c8bf2['offClick']();}catch(_0x942700){}_0x5c8bf2[_0x508e20(0x1c0)](()=>{const _0x1e9905=_0x508e20;if(tg[_0x1e9905(0x1af)])tg[_0x1e9905(0x1af)][_0x1e9905(0x1d5)](_0x1e9905(0x19e));location[_0x1e9905(0x1db)]=HOME_URL;});}}catch(_0x2989f8){console['warn'](_0x508e20(0x1cc),_0x2989f8);}}(function initStableLayout(){const _0x3f9af5=a0_0x5a5a2f,_0x1d6b12=(function(){let _0x47f79f=!![];return function(_0x1ebc63,_0x520049){const _0x3a93ae=_0x47f79f?function(){if(_0x520049){const _0x58a971=_0x520049['apply'](_0x1ebc63,arguments);return _0x520049=null,_0x58a971;}}:function(){};return _0x47f79f=![],_0x3a93ae;};}()),_0x4d2190=document[_0x3f9af5(0x1b7)](_0x3f9af5(0x1b9)),_0x5d2818=document[_0x3f9af5(0x1a8)](_0x3f9af5(0x19d)),_0x27b1ed=document[_0x3f9af5(0x1a8)](_0x3f9af5(0x1c7)),_0x2406f0=document[_0x3f9af5(0x1a8)]('messageInput');function _0x580872(){const _0x302b0a=_0x3f9af5,_0x1e9c6a=_0x1d6b12(this,function(){const _0x20381e=a0_0x121b;return _0x1e9c6a[_0x20381e(0x18f)]()[_0x20381e(0x1c3)](_0x20381e(0x1d7))[_0x20381e(0x18f)]()[_0x20381e(0x1b0)](_0x1e9c6a)[_0x20381e(0x1c3)](_0x20381e(0x1d7));});_0x1e9c6a();if(!_0x4d2190)return;const _0x2ac3d8=tg&&tg[_0x302b0a(0x1d6)]?tg[_0x302b0a(0x1d6)]:window[_0x302b0a(0x1a2)];_0x4d2190[_0x302b0a(0x180)][_0x302b0a(0x1f1)]=_0x2ac3d8+'px';if(_0x5d2818){const _0x45cf95=_0x5d2818['offsetHeight'];_0x27b1ed[_0x302b0a(0x180)]['paddingBottom']=_0x45cf95+0x28+'px';}}tg?tg[_0x3f9af5(0x17c)]('viewportChanged',({isStateStable:_0x34a569})=>{_0x580872();if(_0x34a569)requestAnimationFrame(()=>{const _0x272733=a0_0x121b;_0x27b1ed[_0x272733(0x187)]=_0x27b1ed['scrollHeight'];});}):window[_0x3f9af5(0x192)]('resize',_0x580872),_0x580872(),_0x2406f0&&(_0x2406f0[_0x3f9af5(0x192)](_0x3f9af5(0x1e7),()=>{requestAnimationFrame(_0x580872);}),_0x2406f0[_0x3f9af5(0x192)](_0x3f9af5(0x1eb),()=>{setTimeout(()=>{const _0x23f905=a0_0x121b;_0x27b1ed['scrollTop']=_0x27b1ed[_0x23f905(0x173)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x121b(_0x345279,_0x111d52){_0x345279=_0x345279-0x172;const _0x150842=a0_0x4b6f();let _0x1d9ef2=_0x150842[_0x345279];return _0x1d9ef2;}const BACKEND_URL=a0_0x5a5a2f(0x1df),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5a5a2f(0x1a8)](a0_0x5a5a2f(0x1c7)),emptyState=document[a0_0x5a5a2f(0x1a8)]('emptyState'),messageInput=document[a0_0x5a5a2f(0x1a8)](a0_0x5a5a2f(0x176)),sendBtn=document['getElementById'](a0_0x5a5a2f(0x185)),clearBtn=document[a0_0x5a5a2f(0x1a8)]('clearBtn'),modal=document[a0_0x5a5a2f(0x1a8)](a0_0x5a5a2f(0x1e3)),mTitle=document[a0_0x5a5a2f(0x1a8)](a0_0x5a5a2f(0x183)),mText=document[a0_0x5a5a2f(0x1a8)](a0_0x5a5a2f(0x172));let modalCallback=null;function a0_0x4b6f(){const _0x49118d=['first_name','offClick','57MlcqYi','none','HapticFeedback','constructor','shiftKey','value','touchend','success','abort','content','querySelector','text/plain','.container','preventDefault','now','notificationOccurred','modalConfirm','emptyState','initDataUnsafe','onClick','modalCancel','539966MyIIfH','search','auto','Ошибка\x20сети','padStart','chatArea','className','contains','25060uFtGtv','Ошибка\x20сервера','TG\x20setup\x20error:','stringify','function','406930BpuclF','textContent','error','message\x20','show','isVersionAtLeast','impactOccurred','viewportHeight','(((.+)+)+)+$','querySelectorAll','6.1','Enter','href','onclick','add','createElement','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','getHours','ready','trim','confirmModal','push','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','Пустой\x20ответ','input','946970YMKvHy','target','expand','focus','delete-btn','1323330YprVfN','username','classList','children','height','setItem','splice','modalText','scrollHeight','innerHTML','1ETONgx','messageInput','message-bubble','remove','117tRNrpg','div','996144hlmxmE','onEvent','Действие\x20необратимо.','touchstart','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','style','getItem','typingIndicator','modalTitle','show-delete','sendBtn','BackButton','scrollTop','<br>','message-time','signal','ai_chat_messages','floor','Очистить\x20историю?','replace','toString','random','POST','addEventListener','key','flex','32dZlRcX','min','appendChild','.message.show-delete','initData','121LoThmR','Удалить?','./router.html','inputArea','light','user','click','message\x20ai','innerHeight','length','disabled','parse','4768854KhenIa','forEach','getElementById','Telegram','display'];a0_0x4b6f=function(){return _0x49118d;};return a0_0x4b6f();}async function callBackend(_0x23c487,_0x41af85){const _0x5e6256=a0_0x5a5a2f,_0x151a71=tg?.[_0x5e6256(0x1bf)]?.[_0x5e6256(0x19f)]||{},_0x5d3d5f=_0x151a71['id']||localStorage[_0x5e6256(0x181)]('debug_uid')||'d-'+Math[_0x5e6256(0x18c)](Math[_0x5e6256(0x190)]()*0x3b9aca00);if(!_0x151a71['id'])localStorage[_0x5e6256(0x1f2)]('debug_uid',_0x5d3d5f);const _0x28ac6b={'action':_0x23c487,'user_id':_0x5d3d5f,'user_data':{'first_name':_0x151a71[_0x5e6256(0x1ab)],'username':_0x151a71[_0x5e6256(0x1ee)]},'init_data':tg?.[_0x5e6256(0x199)]||'',..._0x41af85},_0x4f63a6=new AbortController(),_0x36bea3=setTimeout(()=>_0x4f63a6[_0x5e6256(0x1b5)](),REQUEST_TIMEOUT_MS);try{const _0x272b06=await fetch(BACKEND_URL,{'method':_0x5e6256(0x191),'headers':{'Content-Type':_0x5e6256(0x1b8)},'body':JSON[_0x5e6256(0x1cd)](_0x28ac6b),'signal':_0x4f63a6[_0x5e6256(0x18a)]});return clearTimeout(_0x36bea3),await _0x272b06['json']();}catch(_0x1266d5){return{'success':![],'error':String(_0x1266d5)};}}function formatTime(_0x5b0c3b){const _0x220c55=a0_0x5a5a2f,_0x402d2b=new Date(_0x5b0c3b);return String(_0x402d2b[_0x220c55(0x1e0)]())[_0x220c55(0x1c6)](0x2,'0')+':'+String(_0x402d2b['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0xf743ba,_0x345069){const _0x5c7cc3=a0_0x5a5a2f,_0x208997=document[_0x5c7cc3(0x1de)](_0x5c7cc3(0x17a));_0x208997[_0x5c7cc3(0x1c8)]=_0x5c7cc3(0x1d2)+_0xf743ba['role'];const _0x24574b=document['createElement'](_0x5c7cc3(0x17a));_0x24574b[_0x5c7cc3(0x1c8)]=_0x5c7cc3(0x177),_0x24574b[_0x5c7cc3(0x174)]=_0xf743ba[_0x5c7cc3(0x1b6)][_0x5c7cc3(0x18e)](/\n/g,_0x5c7cc3(0x188));const _0x4e55ca=document[_0x5c7cc3(0x1de)](_0x5c7cc3(0x17a));_0x4e55ca[_0x5c7cc3(0x1c8)]=_0x5c7cc3(0x1ec),_0x4e55ca[_0x5c7cc3(0x174)]=_0x5c7cc3(0x17f),_0x4e55ca['onclick']=_0x493b46=>{_0x493b46['stopPropagation'](),confirmDelete(_0x345069);};let _0x5462a4;_0x24574b[_0x5c7cc3(0x192)](_0x5c7cc3(0x17e),()=>_0x5462a4=setTimeout(()=>{const _0xc44229=_0x5c7cc3;_0x208997['classList'][_0xc44229(0x1dd)](_0xc44229(0x184));if(tg?.[_0xc44229(0x1af)])tg[_0xc44229(0x1af)][_0xc44229(0x1d5)]('medium');},0x1f4)),_0x24574b[_0x5c7cc3(0x192)](_0x5c7cc3(0x1b3),()=>clearTimeout(_0x5462a4));const _0x1ec865=document[_0x5c7cc3(0x1de)](_0x5c7cc3(0x17a));return _0x1ec865[_0x5c7cc3(0x1c8)]=_0x5c7cc3(0x189),_0x1ec865[_0x5c7cc3(0x1d0)]=formatTime(_0xf743ba['timestamp']),_0x208997[_0x5c7cc3(0x197)](_0x4e55ca),_0x208997[_0x5c7cc3(0x197)](_0x24574b),_0x208997[_0x5c7cc3(0x197)](_0x1ec865),_0x208997;}function createTypingIndicator(){const _0x48c674=a0_0x5a5a2f,_0xe8512f=document['createElement']('div');return _0xe8512f[_0x48c674(0x1c8)]=_0x48c674(0x1a1),_0xe8512f['id']=_0x48c674(0x182),_0xe8512f[_0x48c674(0x174)]=_0x48c674(0x1e5),_0xe8512f;}function renderMessages(){const _0x308671=a0_0x5a5a2f;Array['from'](chatArea[_0x308671(0x1f0)])[_0x308671(0x1a7)](_0x45007e=>{const _0x5f3c9d=_0x308671;if(_0x45007e['id']!==_0x5f3c9d(0x1be))_0x45007e[_0x5f3c9d(0x178)]();}),messages[_0x308671(0x1a3)]>0x0?(emptyState[_0x308671(0x180)][_0x308671(0x1aa)]=_0x308671(0x1ae),messages[_0x308671(0x1a7)]((_0x2cf66e,_0x38fa74)=>chatArea[_0x308671(0x197)](createMessageElement(_0x2cf66e,_0x38fa74)))):emptyState[_0x308671(0x180)][_0x308671(0x1aa)]=_0x308671(0x194),requestAnimationFrame(()=>chatArea[_0x308671(0x187)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x1bf728=a0_0x5a5a2f;messageInput['style'][_0x1bf728(0x1f1)]=_0x1bf728(0x1c4),messageInput['style'][_0x1bf728(0x1f1)]=Math[_0x1bf728(0x196)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x313183=a0_0x5a5a2f,_0x1470f7=messageInput[_0x313183(0x1b2)][_0x313183(0x1e2)]();sendBtn[_0x313183(0x1a4)]=!_0x1470f7||isTyping;}async function sendMessage(){const _0x495bce=a0_0x5a5a2f,_0x4244ec=messageInput[_0x495bce(0x1b2)][_0x495bce(0x1e2)]();if(!_0x4244ec||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x495bce(0x1af)][_0x495bce(0x1d5)]('light');messages['push']({'role':_0x495bce(0x19f),'content':_0x4244ec,'timestamp':Date['now']()}),localStorage[_0x495bce(0x1f2)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0x495bce(0x1b2)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x495bce(0x187)]=chatArea[_0x495bce(0x173)];const _0x5c3574=await callBackend('send_message',{'message':_0x4244ec});isTyping=![];const _0x4113ae=document[_0x495bce(0x1a8)](_0x495bce(0x182));if(_0x4113ae)_0x4113ae[_0x495bce(0x178)]();let _0x2f0a9b=_0x495bce(0x1c5);if(_0x5c3574[_0x495bce(0x1b4)]){_0x2f0a9b=_0x5c3574['text']||_0x495bce(0x1e6);if(tg?.['HapticFeedback'])tg[_0x495bce(0x1af)][_0x495bce(0x1bc)](_0x495bce(0x1b4));}else{_0x2f0a9b=_0x5c3574[_0x495bce(0x1d1)]||_0x495bce(0x1cb);if(tg?.[_0x495bce(0x1af)])tg[_0x495bce(0x1af)][_0x495bce(0x1bc)](_0x495bce(0x1d1));}messages[_0x495bce(0x1e4)]({'role':'ai','content':_0x2f0a9b,'timestamp':Date[_0x495bce(0x1bb)]()}),localStorage['setItem'](_0x495bce(0x18b),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x4cd65f){const _0x2ca5ab=a0_0x5a5a2f;if(mTitle)mTitle[_0x2ca5ab(0x1d0)]=_0x2ca5ab(0x19b);if(mText)mText[_0x2ca5ab(0x1d0)]=_0x2ca5ab(0x17d);modalCallback=()=>{const _0x16673d=_0x2ca5ab;messages[_0x16673d(0x1f3)](_0x4cd65f,0x1),localStorage[_0x16673d(0x1f2)](_0x16673d(0x18b),JSON[_0x16673d(0x1cd)](messages)),renderMessages();},modal[_0x2ca5ab(0x1ef)][_0x2ca5ab(0x1dd)](_0x2ca5ab(0x1d3));}if(clearBtn)clearBtn[a0_0x5a5a2f(0x1dc)]=()=>{const _0x1951aa=a0_0x5a5a2f;if(!messages[_0x1951aa(0x1a3)])return;if(mTitle)mTitle['textContent']=_0x1951aa(0x18d);if(mText)mText[_0x1951aa(0x1d0)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x4feea4=_0x1951aa;messages=[],localStorage['removeItem'](_0x4feea4(0x18b)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x1951aa(0x1dd)](_0x1951aa(0x1d3));};document[a0_0x5a5a2f(0x1a8)](a0_0x5a5a2f(0x1c1))[a0_0x5a5a2f(0x1dc)]=()=>modal[a0_0x5a5a2f(0x1ef)][a0_0x5a5a2f(0x178)](a0_0x5a5a2f(0x1d3)),document[a0_0x5a5a2f(0x1a8)](a0_0x5a5a2f(0x1bd))[a0_0x5a5a2f(0x1dc)]=()=>{const _0x54311b=a0_0x5a5a2f;if(modalCallback)modalCallback();modal[_0x54311b(0x1ef)][_0x54311b(0x178)](_0x54311b(0x1d3));},messageInput['addEventListener'](a0_0x5a5a2f(0x1e7),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x453e53=>{const _0x352ae2=a0_0x5a5a2f;_0x453e53[_0x352ae2(0x193)]===_0x352ae2(0x1da)&&!_0x453e53[_0x352ae2(0x1b1)]&&(_0x453e53[_0x352ae2(0x1ba)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x5a5a2f(0x192)](a0_0x5a5a2f(0x1a0),_0xe84845=>{const _0x21a0e3=a0_0x5a5a2f;document[_0x21a0e3(0x1d8)](_0x21a0e3(0x198))[_0x21a0e3(0x1a7)](_0x2a356e=>{const _0x3f9c48=_0x21a0e3;if(!_0x2a356e[_0x3f9c48(0x1c9)](_0xe84845[_0x3f9c48(0x1e9)]))_0x2a356e['classList'][_0x3f9c48(0x178)]('show-delete');});});const saved=localStorage[a0_0x5a5a2f(0x181)](a0_0x5a5a2f(0x18b));if(saved)try{messages=JSON[a0_0x5a5a2f(0x1a5)](saved),renderMessages();}catch(a0_0x17cb6c){}updateSendButton();