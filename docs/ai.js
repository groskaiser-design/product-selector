const a0_0x15938f=a0_0x4a89;(function(_0x4c306b,_0x841933){const _0x47a97c=a0_0x4a89,_0x2e448e=_0x4c306b();while(!![]){try{const _0x5ee12=-parseInt(_0x47a97c(0x19f))/0x1+parseInt(_0x47a97c(0x164))/0x2*(parseInt(_0x47a97c(0x168))/0x3)+parseInt(_0x47a97c(0x1a0))/0x4+-parseInt(_0x47a97c(0x158))/0x5+parseInt(_0x47a97c(0x165))/0x6+-parseInt(_0x47a97c(0x149))/0x7*(-parseInt(_0x47a97c(0x14f))/0x8)+parseInt(_0x47a97c(0x135))/0x9*(-parseInt(_0x47a97c(0x194))/0xa);if(_0x5ee12===_0x841933)break;else _0x2e448e['push'](_0x2e448e['shift']());}catch(_0xf8cafb){_0x2e448e['push'](_0x2e448e['shift']());}}}(a0_0x7f18,0xe4655));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x15938f(0x190);function setupTelegramBackButton(){const _0x58ddab=a0_0x15938f;if(!tg)return;try{tg['ready'](),tg[_0x58ddab(0x197)](),tg[_0x58ddab(0x142)]?.('#050505');if(tg[_0x58ddab(0x137)]?.(_0x58ddab(0x162)))tg[_0x58ddab(0x18a)]?.();const _0x4f3ec1=tg['BackButton'];if(_0x4f3ec1){_0x4f3ec1[_0x58ddab(0x195)]();if(typeof _0x4f3ec1[_0x58ddab(0x154)]===_0x58ddab(0x12f))try{_0x4f3ec1[_0x58ddab(0x154)]();}catch(_0x48a870){}_0x4f3ec1[_0x58ddab(0x130)](()=>{const _0x57e6dc=_0x58ddab;if(tg[_0x57e6dc(0x198)])tg[_0x57e6dc(0x198)][_0x57e6dc(0x13b)]('light');location['href']=HOME_URL;});}}catch(_0x104de6){console[_0x58ddab(0x182)]('TG\x20setup\x20error:',_0x104de6);}}(function initStableLayout(){const _0x38f1d5=a0_0x15938f,_0x2af625=(function(){let _0x347072=!![];return function(_0x1cdf1d,_0x5640f8){const _0xb0d170=_0x347072?function(){const _0x555492=a0_0x4a89;if(_0x5640f8){const _0x5861dd=_0x5640f8[_0x555492(0x139)](_0x1cdf1d,arguments);return _0x5640f8=null,_0x5861dd;}}:function(){};return _0x347072=![],_0xb0d170;};}()),_0x408879=document[_0x38f1d5(0x177)](_0x38f1d5(0x16c)),_0x300dc1=document[_0x38f1d5(0x193)](_0x38f1d5(0x156)),_0x55415e=document[_0x38f1d5(0x193)](_0x38f1d5(0x134)),_0xffe7c8=document['getElementById']('messageInput');function _0x2a1e9b(){const _0x4cda83=_0x38f1d5,_0x573eef=_0x2af625(this,function(){const _0x3ee122=a0_0x4a89;return _0x573eef[_0x3ee122(0x196)]()[_0x3ee122(0x14e)](_0x3ee122(0x18c))[_0x3ee122(0x196)]()[_0x3ee122(0x181)](_0x573eef)[_0x3ee122(0x14e)](_0x3ee122(0x18c));});_0x573eef();if(!_0x408879)return;const _0x4d7ce9=tg&&tg[_0x4cda83(0x138)]?tg[_0x4cda83(0x138)]:window[_0x4cda83(0x184)];_0x408879[_0x4cda83(0x16b)]['height']=_0x4d7ce9+'px';if(_0x300dc1){const _0x5f27eb=_0x300dc1[_0x4cda83(0x17a)];_0x55415e[_0x4cda83(0x16b)]['paddingBottom']=_0x5f27eb+0x28+'px';}}tg?tg[_0x38f1d5(0x16a)](_0x38f1d5(0x17f),({isStateStable:_0x59fdc3})=>{_0x2a1e9b();if(_0x59fdc3)requestAnimationFrame(()=>{const _0x48050a=a0_0x4a89;_0x55415e[_0x48050a(0x191)]=_0x55415e[_0x48050a(0x18d)];});}):window[_0x38f1d5(0x12e)]('resize',_0x2a1e9b),_0x2a1e9b(),_0xffe7c8&&(_0xffe7c8[_0x38f1d5(0x12e)](_0x38f1d5(0x174),()=>{requestAnimationFrame(_0x2a1e9b);}),_0xffe7c8[_0x38f1d5(0x12e)]('focus',()=>{setTimeout(()=>{const _0x22b906=a0_0x4a89;_0x55415e['scrollTop']=_0x55415e[_0x22b906(0x18d)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x15938f(0x15b),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x15938f(0x134)),emptyState=document[a0_0x15938f(0x193)](a0_0x15938f(0x144)),messageInput=document['getElementById'](a0_0x15938f(0x141)),sendBtn=document['getElementById'](a0_0x15938f(0x151)),clearBtn=document[a0_0x15938f(0x193)](a0_0x15938f(0x185)),modal=document['getElementById'](a0_0x15938f(0x175)),mTitle=document[a0_0x15938f(0x193)](a0_0x15938f(0x14b)),mText=document[a0_0x15938f(0x193)](a0_0x15938f(0x171));let modalCallback=null;async function callBackend(_0x14acbd,_0x29799e){const _0x3e4cc4=a0_0x15938f,_0x14fc94=tg?.['initDataUnsafe']?.[_0x3e4cc4(0x126)]||{},_0x3943b7=_0x14fc94['id']||localStorage['getItem'](_0x3e4cc4(0x146))||'d-'+Math[_0x3e4cc4(0x17b)](Math['random']()*0x3b9aca00);if(!_0x14fc94['id'])localStorage[_0x3e4cc4(0x19a)](_0x3e4cc4(0x146),_0x3943b7);const _0x25f018={'action':_0x14acbd,'user_id':_0x3943b7,'user_data':{'first_name':_0x14fc94[_0x3e4cc4(0x15e)],'username':_0x14fc94['username']},'init_data':tg?.[_0x3e4cc4(0x17e)]||'',..._0x29799e},_0x157972=new AbortController(),_0x1579bc=setTimeout(()=>_0x157972[_0x3e4cc4(0x169)](),REQUEST_TIMEOUT_MS);try{const _0x31e426=await fetch(BACKEND_URL,{'method':_0x3e4cc4(0x136),'headers':{'Content-Type':_0x3e4cc4(0x13e)},'body':JSON[_0x3e4cc4(0x16d)](_0x25f018),'signal':_0x157972['signal']});return clearTimeout(_0x1579bc),await _0x31e426[_0x3e4cc4(0x12c)]();}catch(_0x47d97d){return{'success':![],'error':String(_0x47d97d)};}}function formatTime(_0x26ea2d){const _0x28d040=a0_0x15938f,_0x12cc76=new Date(_0x26ea2d);return String(_0x12cc76[_0x28d040(0x153)]())[_0x28d040(0x180)](0x2,'0')+':'+String(_0x12cc76[_0x28d040(0x163)]())[_0x28d040(0x180)](0x2,'0');}function createMessageElement(_0x1e1cf3,_0x175a85){const _0x4378a6=a0_0x15938f,_0x4a371b=document['createElement']('div');_0x4a371b[_0x4378a6(0x140)]=_0x4378a6(0x16e)+_0x1e1cf3[_0x4378a6(0x17d)];const _0xf43911=document['createElement']('div');_0xf43911[_0x4378a6(0x140)]=_0x4378a6(0x18b),_0xf43911[_0x4378a6(0x14d)]=_0x1e1cf3[_0x4378a6(0x14a)][_0x4378a6(0x187)](/\n/g,'<br>');const _0x209135=document[_0x4378a6(0x155)]('div');_0x209135[_0x4378a6(0x140)]=_0x4378a6(0x133),_0x209135['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x209135[_0x4378a6(0x189)]=_0xe5faca=>{const _0x5bf515=_0x4378a6;_0xe5faca[_0x5bf515(0x159)](),confirmDelete(_0x175a85);};let _0x4ba819;_0xf43911[_0x4378a6(0x12e)](_0x4378a6(0x125),()=>_0x4ba819=setTimeout(()=>{const _0x41b74a=_0x4378a6;_0x4a371b[_0x41b74a(0x15a)][_0x41b74a(0x13a)](_0x41b74a(0x19c));if(tg?.[_0x41b74a(0x198)])tg[_0x41b74a(0x198)][_0x41b74a(0x13b)](_0x41b74a(0x167));},0x1f4)),_0xf43911['addEventListener'](_0x4378a6(0x15c),()=>clearTimeout(_0x4ba819));const _0x3cc861=document['createElement'](_0x4378a6(0x176));return _0x3cc861[_0x4378a6(0x140)]=_0x4378a6(0x161),_0x3cc861[_0x4378a6(0x13f)]=formatTime(_0x1e1cf3[_0x4378a6(0x148)]),_0x4a371b[_0x4378a6(0x178)](_0x209135),_0x4a371b['appendChild'](_0xf43911),_0x4a371b[_0x4378a6(0x178)](_0x3cc861),_0x4a371b;}function createTypingIndicator(){const _0x3ce3bb=a0_0x15938f,_0x44b8a9=document[_0x3ce3bb(0x155)](_0x3ce3bb(0x176));return _0x44b8a9[_0x3ce3bb(0x140)]=_0x3ce3bb(0x170),_0x44b8a9['id']=_0x3ce3bb(0x166),_0x44b8a9[_0x3ce3bb(0x14d)]=_0x3ce3bb(0x188),_0x44b8a9;}function renderMessages(){const _0x24d9e2=a0_0x15938f;Array[_0x24d9e2(0x19e)](chatArea[_0x24d9e2(0x13d)])[_0x24d9e2(0x19b)](_0x55f0ce=>{const _0x56f1a4=_0x24d9e2;if(_0x55f0ce['id']!==_0x56f1a4(0x144))_0x55f0ce[_0x56f1a4(0x172)]();}),messages[_0x24d9e2(0x192)]>0x0?(emptyState[_0x24d9e2(0x16b)]['display']=_0x24d9e2(0x17c),messages[_0x24d9e2(0x19b)]((_0x3f4f8b,_0xb13f65)=>chatArea[_0x24d9e2(0x178)](createMessageElement(_0x3f4f8b,_0xb13f65)))):emptyState[_0x24d9e2(0x16b)][_0x24d9e2(0x179)]='flex',requestAnimationFrame(()=>chatArea[_0x24d9e2(0x191)]=chatArea[_0x24d9e2(0x18d)]);}function autoResizeTextarea(){const _0x13f491=a0_0x15938f;messageInput[_0x13f491(0x16b)][_0x13f491(0x160)]=_0x13f491(0x128),messageInput['style'][_0x13f491(0x160)]=Math['min'](messageInput[_0x13f491(0x18d)],0x78)+'px';}function updateSendButton(){const _0x54d9b2=a0_0x15938f,_0x359cc4=messageInput[_0x54d9b2(0x186)][_0x54d9b2(0x147)]();sendBtn['disabled']=!_0x359cc4||isTyping;}async function sendMessage(){const _0x50ee3c=a0_0x15938f,_0x2392d1=messageInput[_0x50ee3c(0x186)][_0x50ee3c(0x147)]();if(!_0x2392d1||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x50ee3c(0x198)][_0x50ee3c(0x13b)](_0x50ee3c(0x129));messages['push']({'role':_0x50ee3c(0x126),'content':_0x2392d1,'timestamp':Date[_0x50ee3c(0x150)]()}),localStorage[_0x50ee3c(0x19a)](_0x50ee3c(0x183),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x50ee3c(0x178)](createTypingIndicator()),chatArea[_0x50ee3c(0x191)]=chatArea[_0x50ee3c(0x18d)];const _0x339311=await callBackend(_0x50ee3c(0x13c),{'message':_0x2392d1});isTyping=![];const _0x546496=document[_0x50ee3c(0x193)](_0x50ee3c(0x166));if(_0x546496)_0x546496[_0x50ee3c(0x172)]();let _0x3e5aa4='Ошибка\x20сети';if(_0x339311[_0x50ee3c(0x12a)]){_0x3e5aa4=_0x339311[_0x50ee3c(0x145)]||_0x50ee3c(0x14c);if(tg?.[_0x50ee3c(0x198)])tg['HapticFeedback'][_0x50ee3c(0x18e)](_0x50ee3c(0x12a));}else{_0x3e5aa4=_0x339311['error']||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg[_0x50ee3c(0x198)][_0x50ee3c(0x18e)](_0x50ee3c(0x18f));}messages[_0x50ee3c(0x16f)]({'role':'ai','content':_0x3e5aa4,'timestamp':Date[_0x50ee3c(0x150)]()}),localStorage[_0x50ee3c(0x19a)]('ai_chat_messages',JSON[_0x50ee3c(0x16d)](messages)),renderMessages();}function a0_0x4a89(_0x34d64f,_0x26f60c){_0x34d64f=_0x34d64f-0x125;const _0x19f381=a0_0x7f18();let _0x21c50b=_0x19f381[_0x34d64f];return _0x21c50b;}function confirmDelete(_0x9586dc){const _0x2baaf9=a0_0x15938f;if(mTitle)mTitle[_0x2baaf9(0x13f)]='Удалить?';if(mText)mText[_0x2baaf9(0x13f)]=_0x2baaf9(0x173);modalCallback=()=>{const _0x2a4e5e=_0x2baaf9;messages['splice'](_0x9586dc,0x1),localStorage[_0x2a4e5e(0x19a)]('ai_chat_messages',JSON[_0x2a4e5e(0x16d)](messages)),renderMessages();},modal[_0x2baaf9(0x15a)][_0x2baaf9(0x13a)]('show');}if(clearBtn)clearBtn[a0_0x15938f(0x189)]=()=>{const _0x5a1894=a0_0x15938f;if(!messages[_0x5a1894(0x192)])return;if(mTitle)mTitle[_0x5a1894(0x13f)]=_0x5a1894(0x15d);if(mText)mText[_0x5a1894(0x13f)]=_0x5a1894(0x132);modalCallback=async()=>{const _0x32ae52=_0x5a1894;messages=[],localStorage['removeItem'](_0x32ae52(0x183)),renderMessages(),callBackend(_0x32ae52(0x157),{});},modal[_0x5a1894(0x15a)][_0x5a1894(0x13a)]('show');};document[a0_0x15938f(0x193)](a0_0x15938f(0x199))[a0_0x15938f(0x189)]=()=>modal['classList'][a0_0x15938f(0x172)](a0_0x15938f(0x195)),document[a0_0x15938f(0x193)](a0_0x15938f(0x152))[a0_0x15938f(0x189)]=()=>{const _0x26af5c=a0_0x15938f;if(modalCallback)modalCallback();modal[_0x26af5c(0x15a)][_0x26af5c(0x172)](_0x26af5c(0x195));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x15938f(0x12e)](a0_0x15938f(0x19d),_0x2a4e44=>{const _0x134a77=a0_0x15938f;_0x2a4e44['key']===_0x134a77(0x12b)&&!_0x2a4e44[_0x134a77(0x131)]&&(_0x2a4e44[_0x134a77(0x127)](),sendMessage());}),sendBtn[a0_0x15938f(0x189)]=sendMessage,document[a0_0x15938f(0x12e)](a0_0x15938f(0x15f),_0x122cb4=>{const _0x3a98f5=a0_0x15938f;document[_0x3a98f5(0x12d)]('.message.show-delete')[_0x3a98f5(0x19b)](_0x9df963=>{const _0x4d096f=_0x3a98f5;if(!_0x9df963['contains'](_0x122cb4['target']))_0x9df963[_0x4d096f(0x15a)][_0x4d096f(0x172)](_0x4d096f(0x19c));});});function a0_0x7f18(){const _0x592ffc=['18xxxItC','2192034PIWbcm','typingIndicator','medium','422337wmmnZP','abort','onEvent','style','.container','stringify','message\x20','push','message\x20ai','modalText','remove','Действие\x20необратимо.','input','confirmModal','div','querySelector','appendChild','display','offsetHeight','floor','none','role','initData','viewportChanged','padStart','constructor','warn','ai_chat_messages','innerHeight','clearBtn','value','replace','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','onclick','disableVerticalSwipes','message-bubble','(((.+)+)+)+$','scrollHeight','notificationOccurred','error','./router.html','scrollTop','length','getElementById','10oesWjs','show','toString','expand','HapticFeedback','modalCancel','setItem','forEach','show-delete','keydown','from','196274aLBVJU','146248oWcxWP','getItem','touchstart','user','preventDefault','auto','light','success','Enter','json','querySelectorAll','addEventListener','function','onClick','shiftKey','Начнется\x20новый\x20диалог.','delete-btn','chatArea','9139869gAtPVu','POST','isVersionAtLeast','viewportHeight','apply','add','impactOccurred','send_message','children','text/plain','textContent','className','messageInput','setHeaderColor','parse','emptyState','text','debug_uid','trim','timestamp','309596PQzUrk','content','modalTitle','Пустой\x20ответ','innerHTML','search','136Tfierk','now','sendBtn','modalConfirm','getHours','offClick','createElement','inputArea','clear_history','1367320ebvylg','stopPropagation','classList','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','touchend','Очистить\x20историю?','first_name','click','height','message-time','6.1','getMinutes'];a0_0x7f18=function(){return _0x592ffc;};return a0_0x7f18();}const saved=localStorage[a0_0x15938f(0x1a1)](a0_0x15938f(0x183));if(saved)try{messages=JSON[a0_0x15938f(0x143)](saved),renderMessages();}catch(a0_0x18d7e0){}updateSendButton();