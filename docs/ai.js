const a0_0x2aa6ee=a0_0x4d18;(function(_0x144b2c,_0x3d73b5){const _0x591048=a0_0x4d18,_0x634444=_0x144b2c();while(!![]){try{const _0x4c620b=parseInt(_0x591048(0x179))/0x1+parseInt(_0x591048(0x1b4))/0x2*(-parseInt(_0x591048(0x157))/0x3)+-parseInt(_0x591048(0x168))/0x4*(parseInt(_0x591048(0x198))/0x5)+parseInt(_0x591048(0x155))/0x6*(-parseInt(_0x591048(0x192))/0x7)+parseInt(_0x591048(0x1ad))/0x8+parseInt(_0x591048(0x166))/0x9+-parseInt(_0x591048(0x19a))/0xa*(-parseInt(_0x591048(0x1c5))/0xb);if(_0x4c620b===_0x3d73b5)break;else _0x634444['push'](_0x634444['shift']());}catch(_0x55049d){_0x634444['push'](_0x634444['shift']());}}}(a0_0x4669,0xb0f48));function a0_0x4669(){const _0x2c935b=['random','scrollHeight','expand','href','ai_chat_messages','light','disableVerticalSwipes','user','preventDefault','click','HapticFeedback','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','28CmIGSE','createElement','success','min','scrollTop','ready','5OXDuOo','json','20660blpNPQ','padStart','viewportHeight','delete-btn','none','floor','disabled','send_message','stringify','signal','function','offClick','show-delete','getMinutes','message-time','isVersionAtLeast','POST','length','message\x20','10884760YUzCVZ','Начнется\x20новый\x20диалог.','6.1','modalTitle','offsetHeight','onClick','div','820678VNxMgq','children','innerHTML','timestamp','emptyState','(((.+)+)+)+$','auto','value','notificationOccurred','splice','Очистить\x20историю?','touchstart','getElementById','querySelector','chatArea','clearBtn','text','2893kkJJlA','error','onclick','apply','key','getHours','style','show','typingIndicator','debug_uid','search','Действие\x20необратимо.','Telegram','./router.html','height','Enter','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','input','setHeaderColor','display','toString','first_name','warn','impactOccurred','constructor','BackButton','textContent','214692TknDIy','abort','6fDdLZB','add','#050505','now','message\x20ai','className','initData','querySelectorAll','contains','viewportChanged','role','username','target','messageInput','forEach','4087863rkAzSk','medium','4160564mvEzWk','initDataUnsafe','clear_history','remove','addEventListener','paddingBottom','resize','getItem','sendBtn','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','innerHeight','classList','text/plain','parse','setItem','shiftKey','.container','370595yVkXGw','trim','content','appendChild','WebApp','onEvent','Ошибка\x20сервера','removeItem','stopPropagation','modalCancel','touchend','push','Ошибка\x20сети'];a0_0x4669=function(){return _0x2c935b;};return a0_0x4669();}const tg=window[a0_0x2aa6ee(0x1d1)]?.[a0_0x2aa6ee(0x17d)],HOME_URL=a0_0x2aa6ee(0x1d2);function setupTelegramBackButton(){const _0x2888b3=a0_0x2aa6ee;if(!tg)return;try{tg[_0x2888b3(0x197)](),tg[_0x2888b3(0x188)](),tg[_0x2888b3(0x1d7)]?.(_0x2888b3(0x159));if(tg[_0x2888b3(0x1a9)]?.(_0x2888b3(0x1af)))tg[_0x2888b3(0x18c)]?.();const _0x5e9d01=tg[_0x2888b3(0x1de)];if(_0x5e9d01){_0x5e9d01[_0x2888b3(0x1cc)]();if(typeof _0x5e9d01[_0x2888b3(0x1a5)]===_0x2888b3(0x1a4))try{_0x5e9d01[_0x2888b3(0x1a5)]();}catch(_0x391955){}_0x5e9d01[_0x2888b3(0x1b2)](()=>{const _0x3d60f1=_0x2888b3;if(tg[_0x3d60f1(0x190)])tg[_0x3d60f1(0x190)][_0x3d60f1(0x1dc)](_0x3d60f1(0x18b));location[_0x3d60f1(0x189)]=HOME_URL;});}}catch(_0x53ccc0){console[_0x2888b3(0x1db)]('TG\x20setup\x20error:',_0x53ccc0);}}(function initStableLayout(){const _0x4065e9=a0_0x2aa6ee,_0x11ab8f=(function(){let _0x403647=!![];return function(_0x2f2638,_0xe396de){const _0x5851fa=_0x403647?function(){const _0x4af60e=a0_0x4d18;if(_0xe396de){const _0x4e4df9=_0xe396de[_0x4af60e(0x1c8)](_0x2f2638,arguments);return _0xe396de=null,_0x4e4df9;}}:function(){};return _0x403647=![],_0x5851fa;};}()),_0x35e34a=document[_0x4065e9(0x1c1)](_0x4065e9(0x178)),_0xbff200=document[_0x4065e9(0x1c0)]('inputArea'),_0x1348a5=document['getElementById'](_0x4065e9(0x1c2)),_0x847921=document[_0x4065e9(0x1c0)](_0x4065e9(0x164));function _0x46b5ef(){const _0x432c05=_0x4065e9,_0x325b29=_0x11ab8f(this,function(){const _0x269c78=a0_0x4d18;return _0x325b29[_0x269c78(0x1d9)]()[_0x269c78(0x1cf)](_0x269c78(0x1b9))['toString']()[_0x269c78(0x1dd)](_0x325b29)[_0x269c78(0x1cf)](_0x269c78(0x1b9));});_0x325b29();if(!_0x35e34a)return;const _0x2aa962=tg&&tg[_0x432c05(0x19c)]?tg['viewportHeight']:window[_0x432c05(0x172)];_0x35e34a[_0x432c05(0x1cb)][_0x432c05(0x1d3)]=_0x2aa962+'px';if(_0xbff200){const _0x4c97d9=_0xbff200[_0x432c05(0x1b1)];_0x1348a5[_0x432c05(0x1cb)][_0x432c05(0x16d)]=_0x4c97d9+0x28+'px';}}tg?tg[_0x4065e9(0x17e)](_0x4065e9(0x160),({isStateStable:_0xbdd730})=>{_0x46b5ef();if(_0xbdd730)requestAnimationFrame(()=>{const _0x224b86=a0_0x4d18;_0x1348a5[_0x224b86(0x196)]=_0x1348a5[_0x224b86(0x187)];});}):window[_0x4065e9(0x16c)](_0x4065e9(0x16e),_0x46b5ef),_0x46b5ef(),_0x847921&&(_0x847921[_0x4065e9(0x16c)]('input',()=>{requestAnimationFrame(_0x46b5ef);}),_0x847921['addEventListener']('focus',()=>{setTimeout(()=>{const _0x5ee196=a0_0x4d18;_0x1348a5[_0x5ee196(0x196)]=_0x1348a5[_0x5ee196(0x187)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2aa6ee(0x1d5),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2aa6ee(0x1c0)](a0_0x2aa6ee(0x1c2)),emptyState=document[a0_0x2aa6ee(0x1c0)](a0_0x2aa6ee(0x1b8)),messageInput=document[a0_0x2aa6ee(0x1c0)](a0_0x2aa6ee(0x164)),sendBtn=document[a0_0x2aa6ee(0x1c0)](a0_0x2aa6ee(0x170)),clearBtn=document[a0_0x2aa6ee(0x1c0)](a0_0x2aa6ee(0x1c3)),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0x2aa6ee(0x1c0)](a0_0x2aa6ee(0x1b0)),mText=document[a0_0x2aa6ee(0x1c0)]('modalText');let modalCallback=null;async function callBackend(_0x41be15,_0x33cf53){const _0x1e563c=a0_0x2aa6ee,_0x81b049=tg?.[_0x1e563c(0x169)]?.[_0x1e563c(0x18d)]||{},_0xe3557e=_0x81b049['id']||localStorage[_0x1e563c(0x16f)](_0x1e563c(0x1ce))||'d-'+Math[_0x1e563c(0x19f)](Math[_0x1e563c(0x186)]()*0x3b9aca00);if(!_0x81b049['id'])localStorage[_0x1e563c(0x176)](_0x1e563c(0x1ce),_0xe3557e);const _0x8ecfa8={'action':_0x41be15,'user_id':_0xe3557e,'user_data':{'first_name':_0x81b049[_0x1e563c(0x1da)],'username':_0x81b049[_0x1e563c(0x162)]},'init_data':tg?.[_0x1e563c(0x15d)]||'',..._0x33cf53},_0x1fff72=new AbortController(),_0x5a4db9=setTimeout(()=>_0x1fff72[_0x1e563c(0x156)](),REQUEST_TIMEOUT_MS);try{const _0x4ca839=await fetch(BACKEND_URL,{'method':_0x1e563c(0x1aa),'headers':{'Content-Type':_0x1e563c(0x174)},'body':JSON[_0x1e563c(0x1a2)](_0x8ecfa8),'signal':_0x1fff72[_0x1e563c(0x1a3)]});return clearTimeout(_0x5a4db9),await _0x4ca839[_0x1e563c(0x199)]();}catch(_0x5def4b){return{'success':![],'error':String(_0x5def4b)};}}function formatTime(_0x5c0968){const _0x46a714=a0_0x2aa6ee,_0x46d726=new Date(_0x5c0968);return String(_0x46d726[_0x46a714(0x1ca)]())[_0x46a714(0x19b)](0x2,'0')+':'+String(_0x46d726[_0x46a714(0x1a7)]())[_0x46a714(0x19b)](0x2,'0');}function createMessageElement(_0x4add6a,_0x50bff5){const _0x2d0045=a0_0x2aa6ee,_0x18b82d=document[_0x2d0045(0x193)]('div');_0x18b82d[_0x2d0045(0x15c)]=_0x2d0045(0x1ac)+_0x4add6a[_0x2d0045(0x161)];const _0x54dc0e=document[_0x2d0045(0x193)](_0x2d0045(0x1b3));_0x54dc0e[_0x2d0045(0x15c)]='message-bubble',_0x54dc0e['innerHTML']=_0x4add6a[_0x2d0045(0x17b)]['replace'](/\n/g,'<br>');const _0xc21d33=document[_0x2d0045(0x193)](_0x2d0045(0x1b3));_0xc21d33[_0x2d0045(0x15c)]=_0x2d0045(0x19d),_0xc21d33[_0x2d0045(0x1b6)]=_0x2d0045(0x191),_0xc21d33['onclick']=_0x3bf508=>{const _0x40f5e2=_0x2d0045;_0x3bf508[_0x40f5e2(0x181)](),confirmDelete(_0x50bff5);};let _0x2dbcd1;_0x54dc0e[_0x2d0045(0x16c)](_0x2d0045(0x1bf),()=>_0x2dbcd1=setTimeout(()=>{const _0x438a55=_0x2d0045;_0x18b82d[_0x438a55(0x173)][_0x438a55(0x158)](_0x438a55(0x1a6));if(tg?.[_0x438a55(0x190)])tg[_0x438a55(0x190)][_0x438a55(0x1dc)](_0x438a55(0x167));},0x1f4)),_0x54dc0e[_0x2d0045(0x16c)](_0x2d0045(0x183),()=>clearTimeout(_0x2dbcd1));const _0x437bfa=document[_0x2d0045(0x193)](_0x2d0045(0x1b3));return _0x437bfa[_0x2d0045(0x15c)]=_0x2d0045(0x1a8),_0x437bfa[_0x2d0045(0x154)]=formatTime(_0x4add6a[_0x2d0045(0x1b7)]),_0x18b82d['appendChild'](_0xc21d33),_0x18b82d[_0x2d0045(0x17c)](_0x54dc0e),_0x18b82d['appendChild'](_0x437bfa),_0x18b82d;}function createTypingIndicator(){const _0x5dffff=a0_0x2aa6ee,_0x39f97d=document[_0x5dffff(0x193)]('div');return _0x39f97d[_0x5dffff(0x15c)]=_0x5dffff(0x15b),_0x39f97d['id']=_0x5dffff(0x1cd),_0x39f97d[_0x5dffff(0x1b6)]=_0x5dffff(0x171),_0x39f97d;}function renderMessages(){const _0x1cb079=a0_0x2aa6ee;Array['from'](chatArea[_0x1cb079(0x1b5)])['forEach'](_0x1e297c=>{const _0x142a64=_0x1cb079;if(_0x1e297c['id']!==_0x142a64(0x1b8))_0x1e297c[_0x142a64(0x16b)]();}),messages['length']>0x0?(emptyState[_0x1cb079(0x1cb)][_0x1cb079(0x1d8)]=_0x1cb079(0x19e),messages[_0x1cb079(0x165)]((_0x116f20,_0x195b03)=>chatArea['appendChild'](createMessageElement(_0x116f20,_0x195b03)))):emptyState[_0x1cb079(0x1cb)][_0x1cb079(0x1d8)]='flex',requestAnimationFrame(()=>chatArea[_0x1cb079(0x196)]=chatArea[_0x1cb079(0x187)]);}function autoResizeTextarea(){const _0x360860=a0_0x2aa6ee;messageInput['style'][_0x360860(0x1d3)]=_0x360860(0x1ba),messageInput[_0x360860(0x1cb)][_0x360860(0x1d3)]=Math[_0x360860(0x195)](messageInput[_0x360860(0x187)],0x78)+'px';}function updateSendButton(){const _0x23ac17=a0_0x2aa6ee,_0x510232=messageInput[_0x23ac17(0x1bb)][_0x23ac17(0x17a)]();sendBtn[_0x23ac17(0x1a0)]=!_0x510232||isTyping;}async function sendMessage(){const _0x292f70=a0_0x2aa6ee,_0x385873=messageInput[_0x292f70(0x1bb)][_0x292f70(0x17a)]();if(!_0x385873||isTyping)return;if(tg?.[_0x292f70(0x190)])tg[_0x292f70(0x190)]['impactOccurred']('light');messages[_0x292f70(0x184)]({'role':_0x292f70(0x18d),'content':_0x385873,'timestamp':Date[_0x292f70(0x15a)]()}),localStorage[_0x292f70(0x176)](_0x292f70(0x18a),JSON[_0x292f70(0x1a2)](messages)),renderMessages(),messageInput[_0x292f70(0x1bb)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x292f70(0x187)];const _0x26b144=await callBackend(_0x292f70(0x1a1),{'message':_0x385873});isTyping=![];const _0x5634a8=document[_0x292f70(0x1c0)]('typingIndicator');if(_0x5634a8)_0x5634a8['remove']();let _0xed0971=_0x292f70(0x185);if(_0x26b144[_0x292f70(0x194)]){_0xed0971=_0x26b144[_0x292f70(0x1c4)]||'Пустой\x20ответ';if(tg?.[_0x292f70(0x190)])tg['HapticFeedback'][_0x292f70(0x1bc)](_0x292f70(0x194));}else{_0xed0971=_0x26b144[_0x292f70(0x1c6)]||_0x292f70(0x17f);if(tg?.[_0x292f70(0x190)])tg[_0x292f70(0x190)][_0x292f70(0x1bc)](_0x292f70(0x1c6));}messages[_0x292f70(0x184)]({'role':'ai','content':_0xed0971,'timestamp':Date[_0x292f70(0x15a)]()}),localStorage[_0x292f70(0x176)](_0x292f70(0x18a),JSON[_0x292f70(0x1a2)](messages)),renderMessages();}function confirmDelete(_0x30163e){const _0x2c886c=a0_0x2aa6ee;if(mTitle)mTitle[_0x2c886c(0x154)]='Удалить?';if(mText)mText['textContent']=_0x2c886c(0x1d0);modalCallback=()=>{const _0x142339=_0x2c886c;messages[_0x142339(0x1bd)](_0x30163e,0x1),localStorage[_0x142339(0x176)](_0x142339(0x18a),JSON[_0x142339(0x1a2)](messages)),renderMessages();},modal[_0x2c886c(0x173)]['add']('show');}if(clearBtn)clearBtn[a0_0x2aa6ee(0x1c7)]=()=>{const _0x406e45=a0_0x2aa6ee;if(!messages[_0x406e45(0x1ab)])return;if(mTitle)mTitle['textContent']=_0x406e45(0x1be);if(mText)mText[_0x406e45(0x154)]=_0x406e45(0x1ae);modalCallback=async()=>{const _0x458959=_0x406e45;messages=[],localStorage[_0x458959(0x180)](_0x458959(0x18a)),renderMessages(),callBackend(_0x458959(0x16a),{});},modal[_0x406e45(0x173)][_0x406e45(0x158)](_0x406e45(0x1cc));};document[a0_0x2aa6ee(0x1c0)](a0_0x2aa6ee(0x182))[a0_0x2aa6ee(0x1c7)]=()=>modal[a0_0x2aa6ee(0x173)]['remove'](a0_0x2aa6ee(0x1cc)),document['getElementById']('modalConfirm')['onclick']=()=>{const _0xd55e58=a0_0x2aa6ee;if(modalCallback)modalCallback();modal[_0xd55e58(0x173)][_0xd55e58(0x16b)](_0xd55e58(0x1cc));},messageInput['addEventListener'](a0_0x2aa6ee(0x1d6),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2aa6ee(0x16c)]('keydown',_0x37df10=>{const _0xf4d540=a0_0x2aa6ee;_0x37df10[_0xf4d540(0x1c9)]===_0xf4d540(0x1d4)&&!_0x37df10[_0xf4d540(0x177)]&&(_0x37df10[_0xf4d540(0x18e)](),sendMessage());}),sendBtn[a0_0x2aa6ee(0x1c7)]=sendMessage,document['addEventListener'](a0_0x2aa6ee(0x18f),_0xcdf3b4=>{const _0x2a4cb3=a0_0x2aa6ee;document[_0x2a4cb3(0x15e)]('.message.show-delete')[_0x2a4cb3(0x165)](_0x4bdba8=>{const _0x40efa2=_0x2a4cb3;if(!_0x4bdba8[_0x40efa2(0x15f)](_0xcdf3b4[_0x40efa2(0x163)]))_0x4bdba8[_0x40efa2(0x173)][_0x40efa2(0x16b)](_0x40efa2(0x1a6));});});function a0_0x4d18(_0x50fd7a,_0x3d323d){_0x50fd7a=_0x50fd7a-0x154;const _0x215d48=a0_0x4669();let _0x13717a=_0x215d48[_0x50fd7a];return _0x13717a;}const saved=localStorage[a0_0x2aa6ee(0x16f)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x2aa6ee(0x175)](saved),renderMessages();}catch(a0_0xbd42ed){}updateSendButton();