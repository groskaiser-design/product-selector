const a0_0x4f61b6=a0_0x7203;(function(_0x203885,_0xf54548){const _0x58d009=a0_0x7203,_0x2543fd=_0x203885();while(!![]){try{const _0x4f7642=-parseInt(_0x58d009(0x26e))/0x1*(-parseInt(_0x58d009(0x234))/0x2)+parseInt(_0x58d009(0x1fd))/0x3+parseInt(_0x58d009(0x214))/0x4*(-parseInt(_0x58d009(0x267))/0x5)+-parseInt(_0x58d009(0x239))/0x6+parseInt(_0x58d009(0x24d))/0x7*(-parseInt(_0x58d009(0x271))/0x8)+parseInt(_0x58d009(0x247))/0x9+-parseInt(_0x58d009(0x1f4))/0xa*(-parseInt(_0x58d009(0x212))/0xb);if(_0x4f7642===_0xf54548)break;else _0x2543fd['push'](_0x2543fd['shift']());}catch(_0x5c5d25){_0x2543fd['push'](_0x2543fd['shift']());}}}(a0_0x5202,0xb1d3f));const tg=window[a0_0x4f61b6(0x268)]?.['WebApp'],HOME_URL=a0_0x4f61b6(0x211);function setupTelegramBackButton(){const _0x1e53ac=a0_0x4f61b6;if(!tg)return;try{tg['ready'](),tg[_0x1e53ac(0x25e)](),tg['setHeaderColor']?.('#050505');if(tg[_0x1e53ac(0x237)]?.(_0x1e53ac(0x220)))tg[_0x1e53ac(0x21a)]?.();const _0x3ea8c8=tg[_0x1e53ac(0x241)];if(_0x3ea8c8){_0x3ea8c8[_0x1e53ac(0x235)]();if(typeof _0x3ea8c8[_0x1e53ac(0x266)]==='function')try{_0x3ea8c8['offClick']();}catch(_0x36b4f3){}_0x3ea8c8[_0x1e53ac(0x223)](()=>{const _0xdf3097=_0x1e53ac;if(tg['HapticFeedback'])tg[_0xdf3097(0x20f)]['impactOccurred']('light');location[_0xdf3097(0x242)]=HOME_URL;});}}catch(_0xdd579a){console['warn']('TG\x20setup\x20error:',_0xdd579a);}}(function initStableLayout(){const _0x49f920=a0_0x4f61b6,_0x370cc6=(function(){let _0x2f6824=!![];return function(_0x353c4c,_0x1d19e){const _0x1e36d4=_0x2f6824?function(){if(_0x1d19e){const _0x568a32=_0x1d19e['apply'](_0x353c4c,arguments);return _0x1d19e=null,_0x568a32;}}:function(){};return _0x2f6824=![],_0x1e36d4;};}()),_0x1dd6e6=document[_0x49f920(0x201)]('.container'),_0x3447b9=document['getElementById']('inputArea'),_0x269cfa=document[_0x49f920(0x246)]('chatArea'),_0x597f55=document[_0x49f920(0x246)]('messageInput');function _0x44beeb(){const _0x27ccbf=_0x49f920,_0x360e03=_0x370cc6(this,function(){const _0x3bd099=a0_0x7203;return _0x360e03[_0x3bd099(0x20e)]()[_0x3bd099(0x1f6)](_0x3bd099(0x20c))[_0x3bd099(0x20e)]()['constructor'](_0x360e03)[_0x3bd099(0x1f6)](_0x3bd099(0x20c));});_0x360e03();if(!_0x1dd6e6)return;const _0x5ce7b0=tg&&tg[_0x27ccbf(0x26b)]?tg[_0x27ccbf(0x26b)]:window['innerHeight'];_0x1dd6e6['style'][_0x27ccbf(0x1ff)]=_0x5ce7b0+'px';if(_0x3447b9){const _0x1401d3=_0x3447b9[_0x27ccbf(0x1fb)];_0x269cfa['style'][_0x27ccbf(0x1f5)]=_0x1401d3+0x28+'px';}}tg?tg[_0x49f920(0x252)]('viewportChanged',({isStateStable:_0x514672})=>{_0x44beeb();if(_0x514672)requestAnimationFrame(()=>{const _0x2a119f=a0_0x7203;_0x269cfa['scrollTop']=_0x269cfa[_0x2a119f(0x219)];});}):window[_0x49f920(0x210)](_0x49f920(0x238),_0x44beeb),_0x44beeb(),_0x597f55&&(_0x597f55[_0x49f920(0x210)]('input',()=>{requestAnimationFrame(_0x44beeb);}),_0x597f55[_0x49f920(0x210)](_0x49f920(0x22c),()=>{setTimeout(()=>{const _0x310106=a0_0x7203;_0x269cfa[_0x310106(0x22b)]=_0x269cfa['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4f61b6(0x204),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x7203(_0x1bf140,_0x15a0a9){_0x1bf140=_0x1bf140-0x1f3;const _0x28a4c6=a0_0x5202();let _0x26c9f3=_0x28a4c6[_0x1bf140];return _0x26c9f3;}const chatArea=document[a0_0x4f61b6(0x246)](a0_0x4f61b6(0x251)),emptyState=document[a0_0x4f61b6(0x246)](a0_0x4f61b6(0x205)),messageInput=document[a0_0x4f61b6(0x246)](a0_0x4f61b6(0x26d)),sendBtn=document[a0_0x4f61b6(0x246)]('sendBtn'),clearBtn=document[a0_0x4f61b6(0x246)](a0_0x4f61b6(0x24e)),modal=document[a0_0x4f61b6(0x246)](a0_0x4f61b6(0x25f)),mTitle=document[a0_0x4f61b6(0x246)](a0_0x4f61b6(0x222)),mText=document[a0_0x4f61b6(0x246)](a0_0x4f61b6(0x249));let modalCallback=null;async function callBackend(_0x285188,_0x414070){const _0x3480e7=a0_0x4f61b6,_0x357f6e=tg?.[_0x3480e7(0x244)]?.[_0x3480e7(0x26a)]||{},_0x27e4d0=_0x357f6e['id']||localStorage['getItem'](_0x3480e7(0x25d))||'d-'+Math[_0x3480e7(0x25a)](Math[_0x3480e7(0x245)]()*0x3b9aca00);if(!_0x357f6e['id'])localStorage[_0x3480e7(0x227)](_0x3480e7(0x25d),_0x27e4d0);const _0x535cff={'action':_0x285188,'user_id':_0x27e4d0,'user_data':{'first_name':_0x357f6e[_0x3480e7(0x22d)],'username':_0x357f6e['username']},'init_data':tg?.[_0x3480e7(0x224)]||'',..._0x414070},_0x5975d6=new AbortController(),_0x40dc6d=setTimeout(()=>_0x5975d6[_0x3480e7(0x1fc)](),REQUEST_TIMEOUT_MS);try{const _0x4d4625=await fetch(BACKEND_URL,{'method':_0x3480e7(0x265),'headers':{'Content-Type':_0x3480e7(0x21f)},'body':JSON[_0x3480e7(0x259)](_0x535cff),'signal':_0x5975d6['signal']});return clearTimeout(_0x40dc6d),await _0x4d4625[_0x3480e7(0x20b)]();}catch(_0x318a63){return{'success':![],'error':String(_0x318a63)};}}function a0_0x5202(){const _0x42792a=['chatArea','onEvent','add','forEach','send_message','<br>','message-time','text','stringify','floor','length','click','debug_uid','expand','confirmModal','querySelectorAll','delete-btn','.message.show-delete','className','Действие\x20необратимо.','POST','offClick','1306735MfatZA','Telegram','remove','user','viewportHeight','Удалить?','messageInput','34PsVYrb','padStart','replace','9304PJXcck','div','626250NQmXBG','paddingBottom','search','role','modalCancel','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','touchend','offsetHeight','abort','222099dFoQHm','splice','height','success','querySelector','Начнется\x20новый\x20диалог.','ai_chat_messages','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','emptyState','children','from','Enter','Пустой\x20ответ','removeItem','json','(((.+)+)+)+$','stopPropagation','toString','HapticFeedback','addEventListener','./router.html','77nwrtwS','content','20YqqEio','none','disabled','appendChild','textContent','scrollHeight','disableVerticalSwipes','min','getMinutes','classList','parse','text/plain','6.1','innerHTML','modalTitle','onClick','initData','contains','timestamp','setItem','typingIndicator','error','getHours','scrollTop','focus','first_name','notificationOccurred','onclick','keydown','flex','Ошибка\x20сети','preventDefault','83642bxQWyR','show','impactOccurred','isVersionAtLeast','resize','588354SXbSva','push','message\x20','light','shiftKey','style','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','value','BackButton','href','auto','initDataUnsafe','random','getElementById','4479714cNErGf','createElement','modalText','now','Очистить\x20историю?','message-bubble','1799gQzNoL','clearBtn','display','trim'];a0_0x5202=function(){return _0x42792a;};return a0_0x5202();}function formatTime(_0x54a788){const _0x2a8611=a0_0x4f61b6,_0x426ebb=new Date(_0x54a788);return String(_0x426ebb[_0x2a8611(0x22a)]())[_0x2a8611(0x26f)](0x2,'0')+':'+String(_0x426ebb[_0x2a8611(0x21c)]())[_0x2a8611(0x26f)](0x2,'0');}function createMessageElement(_0x4e8d9f,_0x58fa62){const _0x181128=a0_0x4f61b6,_0x59544a=document[_0x181128(0x248)](_0x181128(0x1f3));_0x59544a['className']=_0x181128(0x23b)+_0x4e8d9f[_0x181128(0x1f7)];const _0xfaa64b=document[_0x181128(0x248)](_0x181128(0x1f3));_0xfaa64b['className']=_0x181128(0x24c),_0xfaa64b[_0x181128(0x221)]=_0x4e8d9f[_0x181128(0x213)][_0x181128(0x270)](/\n/g,_0x181128(0x256));const _0x9d9796=document[_0x181128(0x248)](_0x181128(0x1f3));_0x9d9796['className']=_0x181128(0x261),_0x9d9796[_0x181128(0x221)]=_0x181128(0x23f),_0x9d9796[_0x181128(0x22f)]=_0x53d9ff=>{const _0x4807c6=_0x181128;_0x53d9ff[_0x4807c6(0x20d)](),confirmDelete(_0x58fa62);};let _0x5c4207;_0xfaa64b[_0x181128(0x210)]('touchstart',()=>_0x5c4207=setTimeout(()=>{const _0x343477=_0x181128;_0x59544a[_0x343477(0x21d)][_0x343477(0x253)]('show-delete');if(tg?.[_0x343477(0x20f)])tg[_0x343477(0x20f)][_0x343477(0x236)]('medium');},0x1f4)),_0xfaa64b[_0x181128(0x210)](_0x181128(0x1fa),()=>clearTimeout(_0x5c4207));const _0x4c6ef5=document['createElement'](_0x181128(0x1f3));return _0x4c6ef5[_0x181128(0x263)]=_0x181128(0x257),_0x4c6ef5[_0x181128(0x218)]=formatTime(_0x4e8d9f[_0x181128(0x226)]),_0x59544a[_0x181128(0x217)](_0x9d9796),_0x59544a['appendChild'](_0xfaa64b),_0x59544a[_0x181128(0x217)](_0x4c6ef5),_0x59544a;}function createTypingIndicator(){const _0x8f3626=a0_0x4f61b6,_0x5b0e86=document['createElement'](_0x8f3626(0x1f3));return _0x5b0e86[_0x8f3626(0x263)]='message\x20ai',_0x5b0e86['id']='typingIndicator',_0x5b0e86[_0x8f3626(0x221)]=_0x8f3626(0x1f9),_0x5b0e86;}function renderMessages(){const _0x3cd4d6=a0_0x4f61b6;Array[_0x3cd4d6(0x207)](chatArea[_0x3cd4d6(0x206)])[_0x3cd4d6(0x254)](_0x52fc3a=>{if(_0x52fc3a['id']!=='emptyState')_0x52fc3a['remove']();}),messages[_0x3cd4d6(0x25b)]>0x0?(emptyState[_0x3cd4d6(0x23e)][_0x3cd4d6(0x24f)]=_0x3cd4d6(0x215),messages['forEach']((_0x451b62,_0x3dc1ad)=>chatArea['appendChild'](createMessageElement(_0x451b62,_0x3dc1ad)))):emptyState[_0x3cd4d6(0x23e)]['display']=_0x3cd4d6(0x231),requestAnimationFrame(()=>chatArea[_0x3cd4d6(0x22b)]=chatArea[_0x3cd4d6(0x219)]);}function autoResizeTextarea(){const _0x59c37e=a0_0x4f61b6;messageInput[_0x59c37e(0x23e)]['height']=_0x59c37e(0x243),messageInput[_0x59c37e(0x23e)]['height']=Math[_0x59c37e(0x21b)](messageInput[_0x59c37e(0x219)],0x78)+'px';}function updateSendButton(){const _0x5ce042=a0_0x4f61b6,_0x2134f0=messageInput[_0x5ce042(0x240)][_0x5ce042(0x250)]();sendBtn[_0x5ce042(0x216)]=!_0x2134f0||isTyping;}async function sendMessage(){const _0x23f7dc=a0_0x4f61b6,_0x20e66b=messageInput[_0x23f7dc(0x240)][_0x23f7dc(0x250)]();if(!_0x20e66b||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x23f7dc(0x236)](_0x23f7dc(0x23c));messages[_0x23f7dc(0x23a)]({'role':_0x23f7dc(0x26a),'content':_0x20e66b,'timestamp':Date[_0x23f7dc(0x24a)]()}),localStorage[_0x23f7dc(0x227)](_0x23f7dc(0x203),JSON[_0x23f7dc(0x259)](messages)),renderMessages(),messageInput[_0x23f7dc(0x240)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x23f7dc(0x217)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x23f7dc(0x219)];const _0x24bc29=await callBackend(_0x23f7dc(0x255),{'message':_0x20e66b});isTyping=![];const _0x509c37=document['getElementById'](_0x23f7dc(0x228));if(_0x509c37)_0x509c37[_0x23f7dc(0x269)]();let _0x4ac8d0=_0x23f7dc(0x232);if(_0x24bc29[_0x23f7dc(0x200)]){_0x4ac8d0=_0x24bc29[_0x23f7dc(0x258)]||_0x23f7dc(0x209);if(tg?.[_0x23f7dc(0x20f)])tg['HapticFeedback'][_0x23f7dc(0x22e)](_0x23f7dc(0x200));}else{_0x4ac8d0=_0x24bc29[_0x23f7dc(0x229)]||'Ошибка\x20сервера';if(tg?.[_0x23f7dc(0x20f)])tg[_0x23f7dc(0x20f)][_0x23f7dc(0x22e)](_0x23f7dc(0x229));}messages[_0x23f7dc(0x23a)]({'role':'ai','content':_0x4ac8d0,'timestamp':Date[_0x23f7dc(0x24a)]()}),localStorage[_0x23f7dc(0x227)](_0x23f7dc(0x203),JSON[_0x23f7dc(0x259)](messages)),renderMessages();}function confirmDelete(_0x5b7347){const _0x3a364c=a0_0x4f61b6;if(mTitle)mTitle[_0x3a364c(0x218)]=_0x3a364c(0x26c);if(mText)mText[_0x3a364c(0x218)]=_0x3a364c(0x264);modalCallback=()=>{const _0x258554=_0x3a364c;messages[_0x258554(0x1fe)](_0x5b7347,0x1),localStorage[_0x258554(0x227)](_0x258554(0x203),JSON[_0x258554(0x259)](messages)),renderMessages();},modal[_0x3a364c(0x21d)][_0x3a364c(0x253)](_0x3a364c(0x235));}if(clearBtn)clearBtn[a0_0x4f61b6(0x22f)]=()=>{const _0x5ace4c=a0_0x4f61b6;if(!messages[_0x5ace4c(0x25b)])return;if(mTitle)mTitle['textContent']=_0x5ace4c(0x24b);if(mText)mText[_0x5ace4c(0x218)]=_0x5ace4c(0x202);modalCallback=async()=>{const _0x31a9b4=_0x5ace4c;messages=[],localStorage[_0x31a9b4(0x20a)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x5ace4c(0x253)]('show');};document[a0_0x4f61b6(0x246)](a0_0x4f61b6(0x1f8))[a0_0x4f61b6(0x22f)]=()=>modal['classList'][a0_0x4f61b6(0x269)](a0_0x4f61b6(0x235)),document['getElementById']('modalConfirm')['onclick']=()=>{if(modalCallback)modalCallback();modal['classList']['remove']('show');},messageInput[a0_0x4f61b6(0x210)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4f61b6(0x210)](a0_0x4f61b6(0x230),_0x312f64=>{const _0x6f94ba=a0_0x4f61b6;_0x312f64['key']===_0x6f94ba(0x208)&&!_0x312f64[_0x6f94ba(0x23d)]&&(_0x312f64[_0x6f94ba(0x233)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x4f61b6(0x210)](a0_0x4f61b6(0x25c),_0x2dea26=>{const _0xdc2aa1=a0_0x4f61b6;document[_0xdc2aa1(0x260)](_0xdc2aa1(0x262))[_0xdc2aa1(0x254)](_0x197661=>{const _0x3489c0=_0xdc2aa1;if(!_0x197661[_0x3489c0(0x225)](_0x2dea26['target']))_0x197661[_0x3489c0(0x21d)]['remove']('show-delete');});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x4f61b6(0x21e)](saved),renderMessages();}catch(a0_0x4b8e5b){}updateSendButton();