const a0_0x1c5163=a0_0x3319;(function(_0x3abcc9,_0x1635d7){const _0x4e25a9=a0_0x3319,_0x42ef76=_0x3abcc9();while(!![]){try{const _0x30363c=-parseInt(_0x4e25a9(0xa2))/0x1*(parseInt(_0x4e25a9(0xd4))/0x2)+-parseInt(_0x4e25a9(0xa3))/0x3+parseInt(_0x4e25a9(0xb1))/0x4*(parseInt(_0x4e25a9(0xcc))/0x5)+parseInt(_0x4e25a9(0xca))/0x6+parseInt(_0x4e25a9(0x9c))/0x7*(parseInt(_0x4e25a9(0xf0))/0x8)+-parseInt(_0x4e25a9(0xd8))/0x9*(-parseInt(_0x4e25a9(0xc1))/0xa)+parseInt(_0x4e25a9(0xb7))/0xb*(-parseInt(_0x4e25a9(0xfc))/0xc);if(_0x30363c===_0x1635d7)break;else _0x42ef76['push'](_0x42ef76['shift']());}catch(_0x1a5282){_0x42ef76['push'](_0x42ef76['shift']());}}}(a0_0x2a11,0x1ea20));const tg=window[a0_0x1c5163(0xa1)]?.[a0_0x1c5163(0xab)],HOME_URL=a0_0x1c5163(0x81);function setupTelegramBackButton(){const _0x395843=a0_0x1c5163;if(!tg)return;try{tg['ready'](),tg[_0x395843(0x7a)](),tg[_0x395843(0x9a)]?.(_0x395843(0x7c));if(tg[_0x395843(0xf8)]?.(_0x395843(0x87)))tg['disableVerticalSwipes']?.();const _0x41c604=tg[_0x395843(0x94)];if(_0x41c604){_0x41c604['show']();if(typeof _0x41c604[_0x395843(0xd2)]==='function')try{_0x41c604[_0x395843(0xd2)]();}catch(_0x8d6d7){}_0x41c604[_0x395843(0x88)](()=>{const _0x57fbbb=_0x395843;if(tg[_0x57fbbb(0xe3)])tg['HapticFeedback'][_0x57fbbb(0xe7)]('light');location[_0x57fbbb(0x95)]=HOME_URL;});}}catch(_0xcbbf4c){console['warn']('TG\x20setup\x20error:',_0xcbbf4c);}}(function initStableLayout(){const _0x4f5b53=a0_0x1c5163,_0x44bff8=(function(){let _0x42d1b4=!![];return function(_0x2dcc9f,_0x33f6dc){const _0x5625ba=_0x42d1b4?function(){const _0x11ccf2=a0_0x3319;if(_0x33f6dc){const _0x18430c=_0x33f6dc[_0x11ccf2(0x86)](_0x2dcc9f,arguments);return _0x33f6dc=null,_0x18430c;}}:function(){};return _0x42d1b4=![],_0x5625ba;};}()),_0x4e2979=document[_0x4f5b53(0xd6)](_0x4f5b53(0xb2)),_0x29909d=document[_0x4f5b53(0xe5)](_0x4f5b53(0xc6)),_0x101208=document[_0x4f5b53(0xe5)](_0x4f5b53(0xe8)),_0x109f10=document[_0x4f5b53(0xe5)](_0x4f5b53(0xd9));function _0x5088e7(){const _0x44ae64=_0x4f5b53,_0x3b01b0=_0x44bff8(this,function(){const _0x47cc69=a0_0x3319;return _0x3b01b0[_0x47cc69(0xdf)]()[_0x47cc69(0xc5)](_0x47cc69(0xc9))[_0x47cc69(0xdf)]()[_0x47cc69(0x91)](_0x3b01b0)['search'](_0x47cc69(0xc9));});_0x3b01b0();if(!_0x4e2979)return;const _0x2bc6a2=tg&&tg[_0x44ae64(0xf3)]?tg['viewportHeight']:window[_0x44ae64(0xbf)];_0x4e2979[_0x44ae64(0xa8)][_0x44ae64(0xc7)]=_0x2bc6a2+'px';if(_0x29909d){const _0x3eb1db=_0x29909d[_0x44ae64(0x7b)];_0x101208[_0x44ae64(0xa8)][_0x44ae64(0xd5)]=_0x3eb1db+0x28+'px';}}tg?tg[_0x4f5b53(0xf1)](_0x4f5b53(0xd0),({isStateStable:_0x20869b})=>{_0x5088e7();if(_0x20869b)requestAnimationFrame(()=>{const _0x4d33df=a0_0x3319;_0x101208[_0x4d33df(0xe1)]=_0x101208[_0x4d33df(0xe0)];});}):window['addEventListener']('resize',_0x5088e7),_0x5088e7(),_0x109f10&&(_0x109f10[_0x4f5b53(0x8a)]('input',()=>{requestAnimationFrame(_0x5088e7);}),_0x109f10[_0x4f5b53(0x8a)]('focus',()=>{setTimeout(()=>{const _0x302a97=a0_0x3319;_0x101208['scrollTop']=_0x101208[_0x302a97(0xe0)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1c5163(0x9d),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1c5163(0xe5)]('chatArea'),emptyState=document[a0_0x1c5163(0xe5)](a0_0x1c5163(0x96)),messageInput=document[a0_0x1c5163(0xe5)](a0_0x1c5163(0xd9)),sendBtn=document['getElementById'](a0_0x1c5163(0x99)),clearBtn=document[a0_0x1c5163(0xe5)](a0_0x1c5163(0xaa)),modal=document['getElementById'](a0_0x1c5163(0xe4)),mTitle=document[a0_0x1c5163(0xe5)]('modalTitle'),mText=document[a0_0x1c5163(0xe5)](a0_0x1c5163(0x9e));let modalCallback=null;async function callBackend(_0x313e06,_0x4d3713){const _0x50e7dd=a0_0x1c5163,_0x5bb79f=tg?.[_0x50e7dd(0xa0)]?.[_0x50e7dd(0xba)]||{},_0x40625b=_0x5bb79f['id']||localStorage[_0x50e7dd(0xdc)](_0x50e7dd(0xa9))||'d-'+Math['floor'](Math[_0x50e7dd(0x100)]()*0x3b9aca00);if(!_0x5bb79f['id'])localStorage[_0x50e7dd(0xc2)]('debug_uid',_0x40625b);const _0x2e7328={'action':_0x313e06,'user_id':_0x40625b,'user_data':{'first_name':_0x5bb79f[_0x50e7dd(0xff)],'username':_0x5bb79f[_0x50e7dd(0xb3)]},'init_data':tg?.['initData']||'',..._0x4d3713},_0x14ad9d=new AbortController(),_0x546187=setTimeout(()=>_0x14ad9d['abort'](),REQUEST_TIMEOUT_MS);try{const _0x408009=await fetch(BACKEND_URL,{'method':_0x50e7dd(0xc3),'headers':{'Content-Type':_0x50e7dd(0x7e)},'body':JSON[_0x50e7dd(0xa5)](_0x2e7328),'signal':_0x14ad9d[_0x50e7dd(0xb8)]});return clearTimeout(_0x546187),await _0x408009[_0x50e7dd(0xea)]();}catch(_0x4f69b0){return{'success':![],'error':String(_0x4f69b0)};}}function formatTime(_0x3c8ac9){const _0x294970=a0_0x1c5163,_0xfb011=new Date(_0x3c8ac9);return String(_0xfb011[_0x294970(0xd3)]())[_0x294970(0x85)](0x2,'0')+':'+String(_0xfb011[_0x294970(0x8b)]())['padStart'](0x2,'0');}function createMessageElement(_0x3155ce,_0x22ba13){const _0x2fa2d4=a0_0x1c5163,_0x1ecf39=document[_0x2fa2d4(0xb9)]('div');_0x1ecf39[_0x2fa2d4(0xc8)]=_0x2fa2d4(0xf9)+_0x3155ce[_0x2fa2d4(0xad)];const _0x3ce668=document['createElement'](_0x2fa2d4(0x9f));_0x3ce668['className']='message-bubble',_0x3ce668[_0x2fa2d4(0xa7)]=_0x3155ce['content'][_0x2fa2d4(0xf4)](/\n/g,_0x2fa2d4(0xf6));const _0x1910e7=document[_0x2fa2d4(0xb9)](_0x2fa2d4(0x9f));_0x1910e7[_0x2fa2d4(0xc8)]=_0x2fa2d4(0x92),_0x1910e7['innerHTML']=_0x2fa2d4(0xb5),_0x1910e7['onclick']=_0xa4b577=>{const _0x452135=_0x2fa2d4;_0xa4b577[_0x452135(0xde)](),confirmDelete(_0x22ba13);};let _0x55c680;_0x3ce668[_0x2fa2d4(0x8a)](_0x2fa2d4(0xac),()=>_0x55c680=setTimeout(()=>{const _0x15c30f=_0x2fa2d4;_0x1ecf39[_0x15c30f(0xd1)][_0x15c30f(0x82)](_0x15c30f(0xd7));if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x15c30f(0xe7)](_0x15c30f(0xa6));},0x1f4)),_0x3ce668['addEventListener'](_0x2fa2d4(0xdd),()=>clearTimeout(_0x55c680));const _0x43cfef=document[_0x2fa2d4(0xb9)](_0x2fa2d4(0x9f));return _0x43cfef[_0x2fa2d4(0xc8)]='message-time',_0x43cfef['textContent']=formatTime(_0x3155ce[_0x2fa2d4(0xbc)]),_0x1ecf39[_0x2fa2d4(0xbd)](_0x1910e7),_0x1ecf39['appendChild'](_0x3ce668),_0x1ecf39[_0x2fa2d4(0xbd)](_0x43cfef),_0x1ecf39;}function a0_0x3319(_0x4b7456,_0x5a4f29){_0x4b7456=_0x4b7456-0x7a;const _0x1e3bfc=a0_0x2a11();let _0x49ecd6=_0x1e3bfc[_0x4b7456];return _0x49ecd6;}function createTypingIndicator(){const _0x1ad9bb=a0_0x1c5163,_0x301bf0=document[_0x1ad9bb(0xb9)]('div');return _0x301bf0['className']=_0x1ad9bb(0x9b),_0x301bf0['id']=_0x1ad9bb(0xb6),_0x301bf0['innerHTML']=_0x1ad9bb(0xc0),_0x301bf0;}function renderMessages(){const _0x1a126d=a0_0x1c5163;Array[_0x1a126d(0x7d)](chatArea[_0x1a126d(0xae)])[_0x1a126d(0x97)](_0xf87743=>{const _0x8e29d=_0x1a126d;if(_0xf87743['id']!==_0x8e29d(0x96))_0xf87743[_0x8e29d(0x90)]();}),messages[_0x1a126d(0xef)]>0x0?(emptyState[_0x1a126d(0xa8)]['display']=_0x1a126d(0x7f),messages[_0x1a126d(0x97)]((_0x41c465,_0x3100b2)=>chatArea[_0x1a126d(0xbd)](createMessageElement(_0x41c465,_0x3100b2)))):emptyState[_0x1a126d(0xa8)][_0x1a126d(0x93)]=_0x1a126d(0x84),requestAnimationFrame(()=>chatArea[_0x1a126d(0xe1)]=chatArea[_0x1a126d(0xe0)]);}function autoResizeTextarea(){const _0xabe0ef=a0_0x1c5163;messageInput[_0xabe0ef(0xa8)][_0xabe0ef(0xc7)]=_0xabe0ef(0xb4),messageInput[_0xabe0ef(0xa8)]['height']=Math[_0xabe0ef(0x80)](messageInput[_0xabe0ef(0xe0)],0x78)+'px';}function updateSendButton(){const _0x56821a=a0_0x1c5163,_0x315abb=messageInput[_0x56821a(0xaf)][_0x56821a(0xc4)]();sendBtn['disabled']=!_0x315abb||isTyping;}async function sendMessage(){const _0x87fc9c=a0_0x1c5163,_0x5158dd=messageInput['value']['trim']();if(!_0x5158dd||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x87fc9c(0xe3)][_0x87fc9c(0xe7)]('light');messages[_0x87fc9c(0xcd)]({'role':_0x87fc9c(0xba),'content':_0x5158dd,'timestamp':Date[_0x87fc9c(0xee)]()}),localStorage[_0x87fc9c(0xc2)](_0x87fc9c(0xbe),JSON[_0x87fc9c(0xa5)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x87fc9c(0xe1)]=chatArea['scrollHeight'];const _0x46f6fd=await callBackend(_0x87fc9c(0xf5),{'message':_0x5158dd});isTyping=![];const _0x150bb0=document[_0x87fc9c(0xe5)](_0x87fc9c(0xb6));if(_0x150bb0)_0x150bb0[_0x87fc9c(0x90)]();let _0x13c9d7=_0x87fc9c(0x83);if(_0x46f6fd[_0x87fc9c(0xfd)]){_0x13c9d7=_0x46f6fd[_0x87fc9c(0xa4)]||_0x87fc9c(0xe2);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x87fc9c(0xcf)](_0x87fc9c(0xfd));}else{_0x13c9d7=_0x46f6fd[_0x87fc9c(0xeb)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x87fc9c(0xcf)]('error');}messages[_0x87fc9c(0xcd)]({'role':'ai','content':_0x13c9d7,'timestamp':Date[_0x87fc9c(0xee)]()}),localStorage[_0x87fc9c(0xc2)](_0x87fc9c(0xbe),JSON[_0x87fc9c(0xa5)](messages)),renderMessages();}function a0_0x2a11(){const _0xf8dd2=['createElement','user','Удалить?','timestamp','appendChild','ai_chat_messages','innerHeight','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','2320hHBCFB','setItem','POST','trim','search','inputArea','height','className','(((.+)+)+)+$','515556mrrJif','onclick','390pNgHGT','push','splice','notificationOccurred','viewportChanged','classList','offClick','getHours','35824esErfd','paddingBottom','querySelector','show-delete','8199SKvdNY','messageInput','.message.show-delete','input','getItem','touchend','stopPropagation','toString','scrollHeight','scrollTop','Пустой\x20ответ','HapticFeedback','confirmModal','getElementById','Действие\x20необратимо.','impactOccurred','chatArea','shiftKey','json','error','target','keydown','now','length','2704FCraHb','onEvent','parse','viewportHeight','replace','send_message','<br>','textContent','isVersionAtLeast','message\x20','preventDefault','removeItem','24IxvjRZ','success','Enter','first_name','random','expand','offsetHeight','#050505','from','text/plain','none','min','./router.html','add','Ошибка\x20сети','flex','padStart','apply','6.1','onClick','clear_history','addEventListener','getMinutes','show','modalConfirm','Очистить\x20историю?','key','remove','constructor','delete-btn','display','BackButton','href','emptyState','forEach','click','sendBtn','setHeaderColor','message\x20ai','4438dNAaul','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','modalText','div','initDataUnsafe','Telegram','3pyXIoU','86664oLDrAU','text','stringify','medium','innerHTML','style','debug_uid','clearBtn','WebApp','touchstart','role','children','value','Начнется\x20новый\x20диалог.','2572vqohTz','.container','username','auto','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','typingIndicator','1944954aqervU','signal'];a0_0x2a11=function(){return _0xf8dd2;};return a0_0x2a11();}function confirmDelete(_0x529c9d){const _0x31fd4f=a0_0x1c5163;if(mTitle)mTitle[_0x31fd4f(0xf7)]=_0x31fd4f(0xbb);if(mText)mText[_0x31fd4f(0xf7)]=_0x31fd4f(0xe6);modalCallback=()=>{const _0x16dcc6=_0x31fd4f;messages[_0x16dcc6(0xce)](_0x529c9d,0x1),localStorage[_0x16dcc6(0xc2)](_0x16dcc6(0xbe),JSON[_0x16dcc6(0xa5)](messages)),renderMessages();},modal['classList'][_0x31fd4f(0x82)](_0x31fd4f(0x8c));}if(clearBtn)clearBtn['onclick']=()=>{const _0x8e0bf2=a0_0x1c5163;if(!messages[_0x8e0bf2(0xef)])return;if(mTitle)mTitle['textContent']=_0x8e0bf2(0x8e);if(mText)mText['textContent']=_0x8e0bf2(0xb0);modalCallback=async()=>{const _0x1d59ed=_0x8e0bf2;messages=[],localStorage[_0x1d59ed(0xfb)](_0x1d59ed(0xbe)),renderMessages(),callBackend(_0x1d59ed(0x89),{});},modal['classList'][_0x8e0bf2(0x82)](_0x8e0bf2(0x8c));};document[a0_0x1c5163(0xe5)]('modalCancel')[a0_0x1c5163(0xcb)]=()=>modal[a0_0x1c5163(0xd1)]['remove'](a0_0x1c5163(0x8c)),document[a0_0x1c5163(0xe5)](a0_0x1c5163(0x8d))[a0_0x1c5163(0xcb)]=()=>{const _0x1e4fa0=a0_0x1c5163;if(modalCallback)modalCallback();modal[_0x1e4fa0(0xd1)][_0x1e4fa0(0x90)](_0x1e4fa0(0x8c));},messageInput[a0_0x1c5163(0x8a)](a0_0x1c5163(0xdb),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1c5163(0x8a)](a0_0x1c5163(0xed),_0xbf6d2b=>{const _0x2957d1=a0_0x1c5163;_0xbf6d2b[_0x2957d1(0x8f)]===_0x2957d1(0xfe)&&!_0xbf6d2b[_0x2957d1(0xe9)]&&(_0xbf6d2b[_0x2957d1(0xfa)](),sendMessage());}),sendBtn[a0_0x1c5163(0xcb)]=sendMessage,document[a0_0x1c5163(0x8a)](a0_0x1c5163(0x98),_0x444a96=>{const _0x5dab2c=a0_0x1c5163;document['querySelectorAll'](_0x5dab2c(0xda))['forEach'](_0x1f71f3=>{const _0x227bcf=_0x5dab2c;if(!_0x1f71f3['contains'](_0x444a96[_0x227bcf(0xec)]))_0x1f71f3[_0x227bcf(0xd1)][_0x227bcf(0x90)](_0x227bcf(0xd7));});});const saved=localStorage[a0_0x1c5163(0xdc)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x1c5163(0xf2)](saved),renderMessages();}catch(a0_0x29da7a){}updateSendButton();