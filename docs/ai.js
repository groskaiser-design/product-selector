const a0_0x385a9e=a0_0x4346;(function(_0x15c1d8,_0x1eddfb){const _0xd8ca23=a0_0x4346,_0x1c9c3b=_0x15c1d8();while(!![]){try{const _0xd8e3f1=parseInt(_0xd8ca23(0xb7))/0x1*(parseInt(_0xd8ca23(0xee))/0x2)+parseInt(_0xd8ca23(0xc8))/0x3*(-parseInt(_0xd8ca23(0xe6))/0x4)+parseInt(_0xd8ca23(0x102))/0x5*(-parseInt(_0xd8ca23(0xf4))/0x6)+parseInt(_0xd8ca23(0x11d))/0x7*(-parseInt(_0xd8ca23(0xd5))/0x8)+-parseInt(_0xd8ca23(0xbd))/0x9+-parseInt(_0xd8ca23(0xab))/0xa*(parseInt(_0xd8ca23(0xc1))/0xb)+parseInt(_0xd8ca23(0xf9))/0xc;if(_0xd8e3f1===_0x1eddfb)break;else _0x1c9c3b['push'](_0x1c9c3b['shift']());}catch(_0x44eddd){_0x1c9c3b['push'](_0x1c9c3b['shift']());}}}(a0_0x2e90,0x2ecff));function a0_0x2e90(){const _0x252eba=['sendBtn','touchend','height','none','key','initData','click','resize','48207YhQyui','modalCancel','viewportHeight','classList','removeItem','POST','3427227mLaJel','disableVerticalSwipes','keydown','text','55hqRFuD','getMinutes','Удалить?','(((.+)+)+)+$','querySelector','ready','success','31998pJOTIb','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','paddingBottom','show-delete','random','auto','notificationOccurred','constructor','trim','delete-btn','search','preventDefault','message\x20','464TOygGw','HapticFeedback','setItem','now','Ошибка\x20сервера','message-time','shiftKey','forEach','confirmModal','debug_uid','setHeaderColor','onClick','stringify','error','onEvent','parse','Ошибка\x20сети','72nAsItY','Начнется\x20новый\x20диалог.','getItem','padStart','json','Действие\x20необратимо.','className','touchstart','4XfcRLt','min','div','offsetHeight','add','toString','205224CwSFEX','medium','splice','signal','input','18917412mIAlYe','text/plain','appendChild','BackButton','isVersionAtLeast','flex','getElementById','querySelectorAll','push','50gfJPoG','contains','href','#050505','username','role','abort','show','textContent','light','offClick','innerHeight','Пустой\x20ответ','messageInput','emptyState','expand','chatArea','replace','value','Telegram','function','addEventListener','scrollHeight','scrollTop','warn','impactOccurred','modalTitle','45934WZMoRA','from','display','viewportChanged','createElement','user','length','initDataUnsafe','remove','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','innerHTML','style','ai_chat_messages','modalConfirm','371390ZPrTiR','getHours','onclick','typingIndicator'];a0_0x2e90=function(){return _0x252eba;};return a0_0x2e90();}const tg=window[a0_0x385a9e(0x115)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x147b4b=a0_0x385a9e;if(!tg)return;try{tg[_0x147b4b(0xc6)](),tg[_0x147b4b(0x111)](),tg[_0x147b4b(0xdf)]?.(_0x147b4b(0x105));if(tg[_0x147b4b(0xfd)]?.('6.1'))tg[_0x147b4b(0xbe)]?.();const _0x19e4c4=tg[_0x147b4b(0xfc)];if(_0x19e4c4){_0x19e4c4[_0x147b4b(0x109)]();if(typeof _0x19e4c4[_0x147b4b(0x10c)]===_0x147b4b(0x116))try{_0x19e4c4['offClick']();}catch(_0x477a80){}_0x19e4c4[_0x147b4b(0xe0)](()=>{const _0x10766e=_0x147b4b;if(tg[_0x10766e(0xd6)])tg[_0x10766e(0xd6)][_0x10766e(0x11b)](_0x10766e(0x10b));location[_0x10766e(0x104)]=HOME_URL;});}}catch(_0x44982a){console[_0x147b4b(0x11a)]('TG\x20setup\x20error:',_0x44982a);}}(function initStableLayout(){const _0x25acf1=a0_0x385a9e,_0x4a5022=(function(){let _0x7e8a6b=!![];return function(_0x23a43c,_0x1cecd7){const _0x1efe61=_0x7e8a6b?function(){if(_0x1cecd7){const _0x1ac47f=_0x1cecd7['apply'](_0x23a43c,arguments);return _0x1cecd7=null,_0x1ac47f;}}:function(){};return _0x7e8a6b=![],_0x1efe61;};}()),_0x5c2935=document[_0x25acf1(0xc5)]('.container'),_0xd5e954=document[_0x25acf1(0xff)]('inputArea'),_0x2c9c76=document[_0x25acf1(0xff)]('chatArea'),_0x2b96b3=document[_0x25acf1(0xff)](_0x25acf1(0x10f));function _0x4f3d4d(){const _0x5b34e3=_0x25acf1,_0x1ea625=_0x4a5022(this,function(){const _0x27a19d=a0_0x4346;return _0x1ea625[_0x27a19d(0xf3)]()[_0x27a19d(0xd2)](_0x27a19d(0xc4))[_0x27a19d(0xf3)]()[_0x27a19d(0xcf)](_0x1ea625)['search'](_0x27a19d(0xc4));});_0x1ea625();if(!_0x5c2935)return;const _0x42133b=tg&&tg['viewportHeight']?tg[_0x5b34e3(0xb9)]:window[_0x5b34e3(0x10d)];_0x5c2935[_0x5b34e3(0xa8)][_0x5b34e3(0xb1)]=_0x42133b+'px';if(_0xd5e954){const _0x2fbc0f=_0xd5e954[_0x5b34e3(0xf1)];_0x2c9c76['style'][_0x5b34e3(0xca)]=_0x2fbc0f+0x28+'px';}}tg?tg[_0x25acf1(0xe3)](_0x25acf1(0x120),({isStateStable:_0x130dcb})=>{_0x4f3d4d();if(_0x130dcb)requestAnimationFrame(()=>{const _0x1f22bf=a0_0x4346;_0x2c9c76['scrollTop']=_0x2c9c76[_0x1f22bf(0x118)];});}):window['addEventListener'](_0x25acf1(0xb6),_0x4f3d4d),_0x4f3d4d(),_0x2b96b3&&(_0x2b96b3['addEventListener']('input',()=>{requestAnimationFrame(_0x4f3d4d);}),_0x2b96b3[_0x25acf1(0x117)]('focus',()=>{setTimeout(()=>{const _0x47651c=a0_0x4346;_0x2c9c76[_0x47651c(0x119)]=_0x2c9c76[_0x47651c(0x118)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x385a9e(0xff)](a0_0x385a9e(0x112)),emptyState=document[a0_0x385a9e(0xff)](a0_0x385a9e(0x110)),messageInput=document[a0_0x385a9e(0xff)]('messageInput'),sendBtn=document['getElementById'](a0_0x385a9e(0xaf)),clearBtn=document[a0_0x385a9e(0xff)]('clearBtn'),modal=document[a0_0x385a9e(0xff)](a0_0x385a9e(0xdd)),mTitle=document[a0_0x385a9e(0xff)](a0_0x385a9e(0x11c)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x1f32c6,_0x5f36c2){const _0x5878d9=a0_0x385a9e,_0x3e96d0=tg?.[_0x5878d9(0x124)]?.[_0x5878d9(0x122)]||{},_0x5800ec=_0x3e96d0['id']||localStorage[_0x5878d9(0xe8)]('debug_uid')||'d-'+Math['floor'](Math[_0x5878d9(0xcc)]()*0x3b9aca00);if(!_0x3e96d0['id'])localStorage[_0x5878d9(0xd7)](_0x5878d9(0xde),_0x5800ec);const _0x16da57={'action':_0x1f32c6,'user_id':_0x5800ec,'user_data':{'first_name':_0x3e96d0['first_name'],'username':_0x3e96d0[_0x5878d9(0x106)]},'init_data':tg?.[_0x5878d9(0xb4)]||'',..._0x5f36c2},_0x4502e5=new AbortController(),_0x193787=setTimeout(()=>_0x4502e5[_0x5878d9(0x108)](),REQUEST_TIMEOUT_MS);try{const _0x234489=await fetch(BACKEND_URL,{'method':_0x5878d9(0xbc),'headers':{'Content-Type':_0x5878d9(0xfa)},'body':JSON[_0x5878d9(0xe1)](_0x16da57),'signal':_0x4502e5[_0x5878d9(0xf7)]});return clearTimeout(_0x193787),await _0x234489[_0x5878d9(0xea)]();}catch(_0x851d37){return{'success':![],'error':String(_0x851d37)};}}function formatTime(_0x109e0a){const _0x3f3eca=a0_0x385a9e,_0x970a8c=new Date(_0x109e0a);return String(_0x970a8c[_0x3f3eca(0xac)]())[_0x3f3eca(0xe9)](0x2,'0')+':'+String(_0x970a8c[_0x3f3eca(0xc2)]())[_0x3f3eca(0xe9)](0x2,'0');}function createMessageElement(_0x373e22,_0x198fcc){const _0x3907b1=a0_0x385a9e,_0x4ab71a=document[_0x3907b1(0x121)](_0x3907b1(0xf0));_0x4ab71a[_0x3907b1(0xec)]=_0x3907b1(0xd4)+_0x373e22[_0x3907b1(0x107)];const _0x205209=document[_0x3907b1(0x121)]('div');_0x205209[_0x3907b1(0xec)]='message-bubble',_0x205209['innerHTML']=_0x373e22['content'][_0x3907b1(0x113)](/\n/g,'<br>');const _0x2957a3=document[_0x3907b1(0x121)](_0x3907b1(0xf0));_0x2957a3[_0x3907b1(0xec)]=_0x3907b1(0xd1),_0x2957a3[_0x3907b1(0xa7)]=_0x3907b1(0xc9),_0x2957a3[_0x3907b1(0xad)]=_0x5be163=>{_0x5be163['stopPropagation'](),confirmDelete(_0x198fcc);};let _0x19d04b;_0x205209[_0x3907b1(0x117)](_0x3907b1(0xed),()=>_0x19d04b=setTimeout(()=>{const _0x8b324=_0x3907b1;_0x4ab71a['classList']['add']('show-delete');if(tg?.['HapticFeedback'])tg[_0x8b324(0xd6)][_0x8b324(0x11b)](_0x8b324(0xf5));},0x1f4)),_0x205209[_0x3907b1(0x117)](_0x3907b1(0xb0),()=>clearTimeout(_0x19d04b));const _0x8e8bde=document[_0x3907b1(0x121)](_0x3907b1(0xf0));return _0x8e8bde['className']=_0x3907b1(0xda),_0x8e8bde[_0x3907b1(0x10a)]=formatTime(_0x373e22['timestamp']),_0x4ab71a['appendChild'](_0x2957a3),_0x4ab71a[_0x3907b1(0xfb)](_0x205209),_0x4ab71a[_0x3907b1(0xfb)](_0x8e8bde),_0x4ab71a;}function createTypingIndicator(){const _0x5ec783=a0_0x385a9e,_0x4cc2d7=document[_0x5ec783(0x121)](_0x5ec783(0xf0));return _0x4cc2d7[_0x5ec783(0xec)]='message\x20ai',_0x4cc2d7['id']=_0x5ec783(0xae),_0x4cc2d7[_0x5ec783(0xa7)]=_0x5ec783(0xa6),_0x4cc2d7;}function renderMessages(){const _0x3d49b1=a0_0x385a9e;Array[_0x3d49b1(0x11e)](chatArea['children'])['forEach'](_0x2ce45c=>{const _0x3d29c8=_0x3d49b1;if(_0x2ce45c['id']!==_0x3d29c8(0x110))_0x2ce45c[_0x3d29c8(0xa5)]();}),messages[_0x3d49b1(0x123)]>0x0?(emptyState[_0x3d49b1(0xa8)][_0x3d49b1(0x11f)]=_0x3d49b1(0xb2),messages[_0x3d49b1(0xdc)]((_0x513182,_0x53aeed)=>chatArea[_0x3d49b1(0xfb)](createMessageElement(_0x513182,_0x53aeed)))):emptyState[_0x3d49b1(0xa8)][_0x3d49b1(0x11f)]=_0x3d49b1(0xfe),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x3d5096=a0_0x385a9e;messageInput[_0x3d5096(0xa8)][_0x3d5096(0xb1)]=_0x3d5096(0xcd),messageInput[_0x3d5096(0xa8)][_0x3d5096(0xb1)]=Math[_0x3d5096(0xef)](messageInput[_0x3d5096(0x118)],0x78)+'px';}function updateSendButton(){const _0x58eeee=a0_0x385a9e,_0x26a9fb=messageInput[_0x58eeee(0x114)][_0x58eeee(0xd0)]();sendBtn['disabled']=!_0x26a9fb||isTyping;}async function sendMessage(){const _0x48423c=a0_0x385a9e,_0x4f249a=messageInput[_0x48423c(0x114)][_0x48423c(0xd0)]();if(!_0x4f249a||isTyping)return;if(tg?.[_0x48423c(0xd6)])tg[_0x48423c(0xd6)][_0x48423c(0x11b)](_0x48423c(0x10b));messages['push']({'role':_0x48423c(0x122),'content':_0x4f249a,'timestamp':Date['now']()}),localStorage['setItem'](_0x48423c(0xa9),JSON[_0x48423c(0xe1)](messages)),renderMessages(),messageInput[_0x48423c(0x114)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x48423c(0xfb)](createTypingIndicator()),chatArea[_0x48423c(0x119)]=chatArea[_0x48423c(0x118)];const _0xb53ee9=await callBackend('send_message',{'message':_0x4f249a});isTyping=![];const _0x895061=document[_0x48423c(0xff)](_0x48423c(0xae));if(_0x895061)_0x895061[_0x48423c(0xa5)]();let _0x59908e=_0x48423c(0xe5);if(_0xb53ee9[_0x48423c(0xc7)]){_0x59908e=_0xb53ee9[_0x48423c(0xc0)]||_0x48423c(0x10e);if(tg?.[_0x48423c(0xd6)])tg[_0x48423c(0xd6)][_0x48423c(0xce)](_0x48423c(0xc7));}else{_0x59908e=_0xb53ee9[_0x48423c(0xe2)]||_0x48423c(0xd9);if(tg?.['HapticFeedback'])tg[_0x48423c(0xd6)]['notificationOccurred'](_0x48423c(0xe2));}messages[_0x48423c(0x101)]({'role':'ai','content':_0x59908e,'timestamp':Date[_0x48423c(0xd8)]()}),localStorage['setItem'](_0x48423c(0xa9),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x71b7ff){const _0x3de65d=a0_0x385a9e;if(mTitle)mTitle[_0x3de65d(0x10a)]=_0x3de65d(0xc3);if(mText)mText[_0x3de65d(0x10a)]=_0x3de65d(0xeb);modalCallback=()=>{const _0x285565=_0x3de65d;messages[_0x285565(0xf6)](_0x71b7ff,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x285565(0xe1)](messages)),renderMessages();},modal['classList'][_0x3de65d(0xf2)](_0x3de65d(0x109));}function a0_0x4346(_0x3a86cd,_0x22fc26){_0x3a86cd=_0x3a86cd-0xa5;const _0x949d50=a0_0x2e90();let _0x14b98c=_0x949d50[_0x3a86cd];return _0x14b98c;}if(clearBtn)clearBtn[a0_0x385a9e(0xad)]=()=>{const _0x41f117=a0_0x385a9e;if(!messages[_0x41f117(0x123)])return;if(mTitle)mTitle[_0x41f117(0x10a)]='Очистить\x20историю?';if(mText)mText[_0x41f117(0x10a)]=_0x41f117(0xe7);modalCallback=async()=>{const _0x584ec1=_0x41f117;messages=[],localStorage[_0x584ec1(0xbb)](_0x584ec1(0xa9)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x41f117(0xf2)](_0x41f117(0x109));};document[a0_0x385a9e(0xff)](a0_0x385a9e(0xb8))['onclick']=()=>modal[a0_0x385a9e(0xba)][a0_0x385a9e(0xa5)](a0_0x385a9e(0x109)),document[a0_0x385a9e(0xff)](a0_0x385a9e(0xaa))[a0_0x385a9e(0xad)]=()=>{const _0x1036aa=a0_0x385a9e;if(modalCallback)modalCallback();modal[_0x1036aa(0xba)][_0x1036aa(0xa5)](_0x1036aa(0x109));},messageInput['addEventListener'](a0_0x385a9e(0xf8),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x385a9e(0x117)](a0_0x385a9e(0xbf),_0x37941d=>{const _0x29190b=a0_0x385a9e;_0x37941d[_0x29190b(0xb3)]==='Enter'&&!_0x37941d[_0x29190b(0xdb)]&&(_0x37941d[_0x29190b(0xd3)](),sendMessage());}),sendBtn[a0_0x385a9e(0xad)]=sendMessage,document[a0_0x385a9e(0x117)](a0_0x385a9e(0xb5),_0x57da2e=>{const _0x2936cc=a0_0x385a9e;document[_0x2936cc(0x100)]('.message.show-delete')[_0x2936cc(0xdc)](_0xcc4df6=>{const _0x1e7788=_0x2936cc;if(!_0xcc4df6[_0x1e7788(0x103)](_0x57da2e['target']))_0xcc4df6[_0x1e7788(0xba)]['remove'](_0x1e7788(0xcb));});});const saved=localStorage[a0_0x385a9e(0xe8)](a0_0x385a9e(0xa9));if(saved)try{messages=JSON[a0_0x385a9e(0xe4)](saved),renderMessages();}catch(a0_0x2b92d0){}updateSendButton();