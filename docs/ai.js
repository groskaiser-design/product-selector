const a0_0x2bc9ce=a0_0x4759;function a0_0x31db(){const _0x28f586=['timestamp','getMinutes','stopPropagation','text','disableVerticalSwipes','splice','search','ai_chat_messages','Ошибка\x20сервера','2071538krubld','error','textContent','176212jRvCiy','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','scrollHeight','getHours','ready','function','send_message','success','sendBtn','scrollTop','value','show','Telegram','auto','className','onClick','remove','contains','Удалить?','min','floor','onclick','isVersionAtLeast','padStart','querySelectorAll','offClick','impactOccurred','expand','6.1','990903wTcQPq','input','key','classList','createElement','Начнется\x20новый\x20диалог.','./router.html','random','#050505','viewportHeight','querySelector','json','onEvent','resize','Пустой\x20ответ','emptyState','message\x20ai','1414446FUclpZ','stringify','height','preventDefault','viewportChanged','<br>','messageInput','parse','shiftKey','replace','getItem','add','constructor','flex','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','(((.+)+)+)+$','show-delete','click','Действие\x20необратимо.','setItem','6067860dHlZjM','warn','message\x20','removeItem','first_name','target','display','push','trim','addEventListener','modalCancel','clearBtn','toString','text/plain','getElementById','.message.show-delete','medium','notificationOccurred','innerHeight','Ошибка\x20сети','style','1283544jvnWvV','innerHTML','typingIndicator','61822SGjamf','Enter','now','touchstart','65uXReFa','initDataUnsafe','9lFLbvE','chatArea','focus','appendChild','user','Очистить\x20историю?','setHeaderColor','HapticFeedback','disabled','length','light','confirmModal','forEach','abort','19hONkxw','paddingBottom','div','BackButton'];a0_0x31db=function(){return _0x28f586;};return a0_0x31db();}function a0_0x4759(_0x39cbf9,_0x1745f9){_0x39cbf9=_0x39cbf9-0xfa;const _0x46b3d6=a0_0x31db();let _0x6be5e=_0x46b3d6[_0x39cbf9];return _0x6be5e;}(function(_0x1993d3,_0x393750){const _0x431e64=a0_0x4759,_0x58f4e3=_0x1993d3();while(!![]){try{const _0x5d3ebc=-parseInt(_0x431e64(0x164))/0x1*(-parseInt(_0x431e64(0x150))/0x2)+-parseInt(_0x431e64(0x113))/0x3+-parseInt(_0x431e64(0x174))/0x4*(-parseInt(_0x431e64(0x154))/0x5)+parseInt(_0x431e64(0x124))/0x6+-parseInt(_0x431e64(0x171))/0x7+-parseInt(_0x431e64(0x14d))/0x8*(-parseInt(_0x431e64(0x156))/0x9)+-parseInt(_0x431e64(0x138))/0xa;if(_0x5d3ebc===_0x393750)break;else _0x58f4e3['push'](_0x58f4e3['shift']());}catch(_0x534328){_0x58f4e3['push'](_0x58f4e3['shift']());}}}(a0_0x31db,0x4ee59));const tg=window[a0_0x2bc9ce(0x102)]?.['WebApp'],HOME_URL=a0_0x2bc9ce(0x119);function setupTelegramBackButton(){const _0x167f51=a0_0x2bc9ce,_0x91f6ff=(function(){let _0x989956=!![];return function(_0x1a9d7a,_0x16dba2){const _0x14e51a=_0x989956?function(){if(_0x16dba2){const _0x526c74=_0x16dba2['apply'](_0x1a9d7a,arguments);return _0x16dba2=null,_0x526c74;}}:function(){};return _0x989956=![],_0x14e51a;};}()),_0x45efb6=_0x91f6ff(this,function(){const _0x3645c9=a0_0x4759;return _0x45efb6['toString']()[_0x3645c9(0x16e)](_0x3645c9(0x133))[_0x3645c9(0x144)]()[_0x3645c9(0x130)](_0x45efb6)[_0x3645c9(0x16e)]('(((.+)+)+)+$');});_0x45efb6();if(!tg)return;try{tg[_0x167f51(0xfa)](),tg[_0x167f51(0x111)](),tg[_0x167f51(0x15c)]?.(_0x167f51(0x11b));if(tg[_0x167f51(0x10c)]?.(_0x167f51(0x112)))tg[_0x167f51(0x16c)]?.();const _0x48ed12=tg[_0x167f51(0x167)];if(_0x48ed12){_0x48ed12[_0x167f51(0x101)]();if(typeof _0x48ed12['offClick']===_0x167f51(0xfb))try{_0x48ed12[_0x167f51(0x10f)]();}catch(_0x56422d){}_0x48ed12[_0x167f51(0x105)](()=>{const _0x19d5d3=_0x167f51;if(tg[_0x19d5d3(0x15d)])tg[_0x19d5d3(0x15d)][_0x19d5d3(0x110)](_0x19d5d3(0x160));location['href']=HOME_URL;});}}catch(_0x3ccc4e){console[_0x167f51(0x139)]('TG\x20setup\x20error:',_0x3ccc4e);}}(function initStableLayout(){const _0x5d316f=a0_0x2bc9ce,_0x4d4b75=document[_0x5d316f(0x11d)]('.container'),_0x1b9507=document[_0x5d316f(0x146)]('inputArea'),_0x6d35c2=document[_0x5d316f(0x146)](_0x5d316f(0x157)),_0x1b7bab=document[_0x5d316f(0x146)](_0x5d316f(0x12a));function _0x530cef(){const _0x5af7a1=_0x5d316f;if(!_0x4d4b75)return;const _0x129dae=tg&&tg['viewportHeight']?tg[_0x5af7a1(0x11c)]:window[_0x5af7a1(0x14a)];_0x4d4b75[_0x5af7a1(0x14c)][_0x5af7a1(0x126)]=_0x129dae+'px';if(_0x1b9507){const _0xbf2822=_0x1b9507['offsetHeight'];_0x6d35c2[_0x5af7a1(0x14c)][_0x5af7a1(0x165)]=_0xbf2822+0x28+'px';}}tg?tg[_0x5d316f(0x11f)](_0x5d316f(0x128),({isStateStable:_0xaf3d7f})=>{_0x530cef();if(_0xaf3d7f)requestAnimationFrame(()=>{const _0x13fbcc=a0_0x4759;_0x6d35c2[_0x13fbcc(0xff)]=_0x6d35c2[_0x13fbcc(0x176)];});}):window['addEventListener'](_0x5d316f(0x120),_0x530cef),_0x530cef(),_0x1b7bab&&(_0x1b7bab['addEventListener'](_0x5d316f(0x114),()=>{requestAnimationFrame(_0x530cef);}),_0x1b7bab[_0x5d316f(0x141)](_0x5d316f(0x158),()=>{setTimeout(()=>{const _0x2cfe88=a0_0x4759;_0x6d35c2[_0x2cfe88(0xff)]=_0x6d35c2[_0x2cfe88(0x176)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2bc9ce(0x146)]('chatArea'),emptyState=document[a0_0x2bc9ce(0x146)](a0_0x2bc9ce(0x122)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x2bc9ce(0x146)](a0_0x2bc9ce(0xfe)),clearBtn=document[a0_0x2bc9ce(0x146)](a0_0x2bc9ce(0x143)),modal=document[a0_0x2bc9ce(0x146)](a0_0x2bc9ce(0x161)),mTitle=document[a0_0x2bc9ce(0x146)]('modalTitle'),mText=document[a0_0x2bc9ce(0x146)]('modalText');let modalCallback=null;async function callBackend(_0x3d7b98,_0x40ec81){const _0x469c72=a0_0x2bc9ce,_0x1da14b=tg?.[_0x469c72(0x155)]?.['user']||{},_0x5ee513=_0x1da14b['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x469c72(0x10a)](Math[_0x469c72(0x11a)]()*0x3b9aca00);if(!_0x1da14b['id'])localStorage[_0x469c72(0x137)]('debug_uid',_0x5ee513);const _0x2c228d={'action':_0x3d7b98,'user_id':_0x5ee513,'user_data':{'first_name':_0x1da14b[_0x469c72(0x13c)],'username':_0x1da14b['username']},'init_data':tg?.['initData']||'',..._0x40ec81},_0x41f7f5=new AbortController(),_0xe92c81=setTimeout(()=>_0x41f7f5[_0x469c72(0x163)](),REQUEST_TIMEOUT_MS);try{const _0x4be17f=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x469c72(0x145)},'body':JSON[_0x469c72(0x125)](_0x2c228d),'signal':_0x41f7f5['signal']});return clearTimeout(_0xe92c81),await _0x4be17f[_0x469c72(0x11e)]();}catch(_0x20f016){return{'success':![],'error':String(_0x20f016)};}}function formatTime(_0x495817){const _0x5248e1=a0_0x2bc9ce,_0x318cec=new Date(_0x495817);return String(_0x318cec[_0x5248e1(0x177)]())[_0x5248e1(0x10d)](0x2,'0')+':'+String(_0x318cec[_0x5248e1(0x169)]())[_0x5248e1(0x10d)](0x2,'0');}function createMessageElement(_0x25f1c0,_0x5023db){const _0x421dff=a0_0x2bc9ce,_0x524a79=document['createElement'](_0x421dff(0x166));_0x524a79[_0x421dff(0x104)]=_0x421dff(0x13a)+_0x25f1c0['role'];const _0x57c6db=document['createElement']('div');_0x57c6db[_0x421dff(0x104)]='message-bubble',_0x57c6db[_0x421dff(0x14e)]=_0x25f1c0['content'][_0x421dff(0x12d)](/\n/g,_0x421dff(0x129));const _0x45ab62=document[_0x421dff(0x117)]('div');_0x45ab62[_0x421dff(0x104)]='delete-btn',_0x45ab62[_0x421dff(0x14e)]=_0x421dff(0x132),_0x45ab62['onclick']=_0x155dce=>{const _0x42e61e=_0x421dff;_0x155dce[_0x42e61e(0x16a)](),confirmDelete(_0x5023db);};let _0x1623af;_0x57c6db['addEventListener'](_0x421dff(0x153),()=>_0x1623af=setTimeout(()=>{const _0x34b4ac=_0x421dff;_0x524a79[_0x34b4ac(0x116)]['add'](_0x34b4ac(0x134));if(tg?.[_0x34b4ac(0x15d)])tg[_0x34b4ac(0x15d)]['impactOccurred'](_0x34b4ac(0x148));},0x1f4)),_0x57c6db[_0x421dff(0x141)]('touchend',()=>clearTimeout(_0x1623af));const _0x38c1bb=document[_0x421dff(0x117)](_0x421dff(0x166));return _0x38c1bb[_0x421dff(0x104)]='message-time',_0x38c1bb[_0x421dff(0x173)]=formatTime(_0x25f1c0[_0x421dff(0x168)]),_0x524a79[_0x421dff(0x159)](_0x45ab62),_0x524a79[_0x421dff(0x159)](_0x57c6db),_0x524a79['appendChild'](_0x38c1bb),_0x524a79;}function createTypingIndicator(){const _0x1a867f=a0_0x2bc9ce,_0x5f137a=document['createElement'](_0x1a867f(0x166));return _0x5f137a[_0x1a867f(0x104)]=_0x1a867f(0x123),_0x5f137a['id']='typingIndicator',_0x5f137a[_0x1a867f(0x14e)]=_0x1a867f(0x175),_0x5f137a;}function renderMessages(){const _0x6edaeb=a0_0x2bc9ce;Array['from'](chatArea['children'])[_0x6edaeb(0x162)](_0x2dd3ac=>{const _0x508a5d=_0x6edaeb;if(_0x2dd3ac['id']!==_0x508a5d(0x122))_0x2dd3ac[_0x508a5d(0x106)]();}),messages[_0x6edaeb(0x15f)]>0x0?(emptyState[_0x6edaeb(0x14c)][_0x6edaeb(0x13e)]='none',messages['forEach']((_0x2a78eb,_0x237931)=>chatArea[_0x6edaeb(0x159)](createMessageElement(_0x2a78eb,_0x237931)))):emptyState['style'][_0x6edaeb(0x13e)]=_0x6edaeb(0x131),requestAnimationFrame(()=>chatArea[_0x6edaeb(0xff)]=chatArea[_0x6edaeb(0x176)]);}function autoResizeTextarea(){const _0x15d5de=a0_0x2bc9ce;messageInput[_0x15d5de(0x14c)]['height']=_0x15d5de(0x103),messageInput[_0x15d5de(0x14c)][_0x15d5de(0x126)]=Math[_0x15d5de(0x109)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x2020b6=a0_0x2bc9ce,_0x16bf6b=messageInput[_0x2020b6(0x100)][_0x2020b6(0x140)]();sendBtn[_0x2020b6(0x15e)]=!_0x16bf6b||isTyping;}async function sendMessage(){const _0x4340fd=a0_0x2bc9ce,_0x4f7bb2=messageInput[_0x4340fd(0x100)]['trim']();if(!_0x4f7bb2||isTyping)return;if(tg?.[_0x4340fd(0x15d)])tg[_0x4340fd(0x15d)][_0x4340fd(0x110)](_0x4340fd(0x160));messages[_0x4340fd(0x13f)]({'role':_0x4340fd(0x15a),'content':_0x4f7bb2,'timestamp':Date[_0x4340fd(0x152)]()}),localStorage['setItem'](_0x4340fd(0x16f),JSON[_0x4340fd(0x125)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4340fd(0x159)](createTypingIndicator()),chatArea[_0x4340fd(0xff)]=chatArea[_0x4340fd(0x176)];const _0x5bd2ab=await callBackend(_0x4340fd(0xfc),{'message':_0x4f7bb2});isTyping=![];const _0x2657ff=document['getElementById'](_0x4340fd(0x14f));if(_0x2657ff)_0x2657ff[_0x4340fd(0x106)]();let _0x377fd7=_0x4340fd(0x14b);if(_0x5bd2ab[_0x4340fd(0xfd)]){_0x377fd7=_0x5bd2ab[_0x4340fd(0x16b)]||_0x4340fd(0x121);if(tg?.[_0x4340fd(0x15d)])tg[_0x4340fd(0x15d)][_0x4340fd(0x149)]('success');}else{_0x377fd7=_0x5bd2ab[_0x4340fd(0x172)]||_0x4340fd(0x170);if(tg?.['HapticFeedback'])tg[_0x4340fd(0x15d)][_0x4340fd(0x149)](_0x4340fd(0x172));}messages[_0x4340fd(0x13f)]({'role':'ai','content':_0x377fd7,'timestamp':Date[_0x4340fd(0x152)]()}),localStorage['setItem'](_0x4340fd(0x16f),JSON[_0x4340fd(0x125)](messages)),renderMessages();}function confirmDelete(_0x1b6d13){const _0x11b31a=a0_0x2bc9ce;if(mTitle)mTitle['textContent']=_0x11b31a(0x108);if(mText)mText[_0x11b31a(0x173)]=_0x11b31a(0x136);modalCallback=()=>{const _0x2af2a4=_0x11b31a;messages[_0x2af2a4(0x16d)](_0x1b6d13,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x2af2a4(0x125)](messages)),renderMessages();},modal[_0x11b31a(0x116)][_0x11b31a(0x12f)](_0x11b31a(0x101));}if(clearBtn)clearBtn[a0_0x2bc9ce(0x10b)]=()=>{const _0x40dc16=a0_0x2bc9ce;if(!messages[_0x40dc16(0x15f)])return;if(mTitle)mTitle[_0x40dc16(0x173)]=_0x40dc16(0x15b);if(mText)mText[_0x40dc16(0x173)]=_0x40dc16(0x118);modalCallback=async()=>{const _0x41e778=_0x40dc16;messages=[],localStorage[_0x41e778(0x13b)](_0x41e778(0x16f)),renderMessages(),callBackend('clear_history',{});},modal[_0x40dc16(0x116)][_0x40dc16(0x12f)](_0x40dc16(0x101));};document[a0_0x2bc9ce(0x146)](a0_0x2bc9ce(0x142))[a0_0x2bc9ce(0x10b)]=()=>modal[a0_0x2bc9ce(0x116)][a0_0x2bc9ce(0x106)](a0_0x2bc9ce(0x101)),document[a0_0x2bc9ce(0x146)]('modalConfirm')['onclick']=()=>{const _0x2c7758=a0_0x2bc9ce;if(modalCallback)modalCallback();modal[_0x2c7758(0x116)][_0x2c7758(0x106)](_0x2c7758(0x101));},messageInput[a0_0x2bc9ce(0x141)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x4c689a=>{const _0x33446d=a0_0x2bc9ce;_0x4c689a[_0x33446d(0x115)]===_0x33446d(0x151)&&!_0x4c689a[_0x33446d(0x12c)]&&(_0x4c689a[_0x33446d(0x127)](),sendMessage());}),sendBtn[a0_0x2bc9ce(0x10b)]=sendMessage,document['addEventListener'](a0_0x2bc9ce(0x135),_0x56e288=>{const _0x44b8c0=a0_0x2bc9ce;document[_0x44b8c0(0x10e)](_0x44b8c0(0x147))[_0x44b8c0(0x162)](_0x32ac99=>{const _0x55ecf4=_0x44b8c0;if(!_0x32ac99[_0x55ecf4(0x107)](_0x56e288[_0x55ecf4(0x13d)]))_0x32ac99[_0x55ecf4(0x116)]['remove'](_0x55ecf4(0x134));});});const saved=localStorage[a0_0x2bc9ce(0x12e)](a0_0x2bc9ce(0x16f));if(saved)try{messages=JSON[a0_0x2bc9ce(0x12b)](saved),renderMessages();}catch(a0_0x47a787){}updateSendButton();