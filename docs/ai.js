const a0_0x8a70b2=a0_0x4ff8;(function(_0x19f65d,_0x1e480d){const _0x41d168=a0_0x4ff8,_0x2936a9=_0x19f65d();while(!![]){try{const _0x204f0a=-parseInt(_0x41d168(0x186))/0x1*(parseInt(_0x41d168(0x1e4))/0x2)+-parseInt(_0x41d168(0x1c5))/0x3*(parseInt(_0x41d168(0x173))/0x4)+parseInt(_0x41d168(0x1ad))/0x5+parseInt(_0x41d168(0x1a7))/0x6*(-parseInt(_0x41d168(0x1ed))/0x7)+parseInt(_0x41d168(0x1ab))/0x8+-parseInt(_0x41d168(0x1ba))/0x9*(parseInt(_0x41d168(0x1d7))/0xa)+parseInt(_0x41d168(0x183))/0xb*(parseInt(_0x41d168(0x1a8))/0xc);if(_0x204f0a===_0x1e480d)break;else _0x2936a9['push'](_0x2936a9['shift']());}catch(_0x506f98){_0x2936a9['push'](_0x2936a9['shift']());}}}(a0_0x354a,0xe4c8f));const tg=window[a0_0x8a70b2(0x172)]?.[a0_0x8a70b2(0x1cf)],HOME_URL=a0_0x8a70b2(0x1ef);function setupTelegramBackButton(){const _0x2355d5=a0_0x8a70b2;if(!tg)return;try{tg[_0x2355d5(0x18f)](),tg[_0x2355d5(0x1e9)](),tg[_0x2355d5(0x1e2)]?.(_0x2355d5(0x1a0));if(tg[_0x2355d5(0x1d9)]?.(_0x2355d5(0x17a)))tg[_0x2355d5(0x19f)]?.();const _0x196465=tg[_0x2355d5(0x1c2)];if(_0x196465){_0x196465[_0x2355d5(0x1f0)]();if(typeof _0x196465[_0x2355d5(0x177)]===_0x2355d5(0x1d5))try{_0x196465[_0x2355d5(0x177)]();}catch(_0x459ccf){}_0x196465[_0x2355d5(0x1ae)](()=>{const _0x4f67b4=_0x2355d5;if(tg[_0x4f67b4(0x1bf)])tg[_0x4f67b4(0x1bf)][_0x4f67b4(0x199)](_0x4f67b4(0x1e0));location['href']=HOME_URL;});}}catch(_0x29917a){console['warn']('TG\x20setup\x20error:',_0x29917a);}}(function initStableLayout(){const _0x19ee5b=a0_0x8a70b2,_0x3b733e=(function(){let _0x119659=!![];return function(_0xa72d67,_0x55a457){const _0xcb7df7=_0x119659?function(){if(_0x55a457){const _0x10a058=_0x55a457['apply'](_0xa72d67,arguments);return _0x55a457=null,_0x10a058;}}:function(){};return _0x119659=![],_0xcb7df7;};}()),_0x83591c=document['querySelector'](_0x19ee5b(0x179)),_0x5b8925=document['getElementById'](_0x19ee5b(0x1d4)),_0x42abf3=document[_0x19ee5b(0x1c1)]('chatArea'),_0x169bb2=document[_0x19ee5b(0x1c1)](_0x19ee5b(0x1e5));function _0xb347eb(){const _0x4a7557=_0x19ee5b,_0x432649=_0x3b733e(this,function(){const _0x3d50bc=a0_0x4ff8;return _0x432649['toString']()[_0x3d50bc(0x1a5)]('(((.+)+)+)+$')[_0x3d50bc(0x18e)]()['constructor'](_0x432649)[_0x3d50bc(0x1a5)](_0x3d50bc(0x190));});_0x432649();if(!_0x83591c)return;const _0x5cd5a9=tg&&tg[_0x4a7557(0x1cb)]?tg[_0x4a7557(0x1cb)]:window[_0x4a7557(0x1b5)];_0x83591c[_0x4a7557(0x1b3)][_0x4a7557(0x1b1)]=_0x5cd5a9+'px';if(_0x5b8925){const _0x298070=_0x5b8925[_0x4a7557(0x1bb)];_0x42abf3[_0x4a7557(0x1b3)][_0x4a7557(0x1a6)]=_0x298070+0x28+'px';}}tg?tg[_0x19ee5b(0x180)](_0x19ee5b(0x19a),({isStateStable:_0x2bfccc})=>{_0xb347eb();if(_0x2bfccc)requestAnimationFrame(()=>{const _0x4ea11d=a0_0x4ff8;_0x42abf3[_0x4ea11d(0x198)]=_0x42abf3[_0x4ea11d(0x178)];});}):window[_0x19ee5b(0x185)](_0x19ee5b(0x19c),_0xb347eb),_0xb347eb(),_0x169bb2&&(_0x169bb2[_0x19ee5b(0x185)](_0x19ee5b(0x18d),()=>{requestAnimationFrame(_0xb347eb);}),_0x169bb2[_0x19ee5b(0x185)](_0x19ee5b(0x182),()=>{setTimeout(()=>{const _0x482155=a0_0x4ff8;_0x42abf3['scrollTop']=_0x42abf3[_0x482155(0x178)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x8a70b2(0x1a9),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x354a(){const _0x4175a0=['debug_uid','typingIndicator','modalCancel','12710223DUSkzl','offsetHeight','removeItem','json','Ошибка\x20сети','HapticFeedback','modalText','getElementById','BackButton','querySelectorAll','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','36zbweiP','success','remove','role','getHours','replace','viewportHeight','innerHTML','notificationOccurred','Пустой\x20ответ','WebApp','initData','ai_chat_messages','now','random','inputArea','function','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','10HKjsIr','getItem','isVersionAtLeast','chatArea','Действие\x20необратимо.','abort','target','setItem','medium','light','first_name','setHeaderColor','<br>','122MMFTNr','messageInput','auto','length','preventDefault','expand','textContent','message-time','onclick','119mZPUtW','floor','./router.html','show','timestamp','parse','from','contains','display','Telegram','495888qyMjVk','key','message\x20ai','none','offClick','scrollHeight','.container','6.1','Ошибка\x20сервера','min','trim','getMinutes','sendBtn','onEvent','content','focus','84997RnSYKh','error','addEventListener','3981WEMbbo','push','text/plain','classList','user','keydown','className','input','toString','ready','(((.+)+)+)+$','initDataUnsafe','message-bubble','show-delete','value','confirmModal','emptyState','stringify','scrollTop','impactOccurred','viewportChanged','forEach','resize','add','touchend','disableVerticalSwipes','#050505','Enter','appendChild','div','createElement','search','paddingBottom','495870bEeJdD','5556bWWgVm','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','stopPropagation','8008528XpbOaW','message\x20','4530765hWPrhi','onClick','Начнется\x20новый\x20диалог.','.message.show-delete','height','text','style','shiftKey','innerHeight','Очистить\x20историю?'];a0_0x354a=function(){return _0x4175a0;};return a0_0x354a();}const chatArea=document[a0_0x8a70b2(0x1c1)](a0_0x8a70b2(0x1da)),emptyState=document['getElementById'](a0_0x8a70b2(0x196)),messageInput=document[a0_0x8a70b2(0x1c1)](a0_0x8a70b2(0x1e5)),sendBtn=document[a0_0x8a70b2(0x1c1)](a0_0x8a70b2(0x17f)),clearBtn=document[a0_0x8a70b2(0x1c1)]('clearBtn'),modal=document[a0_0x8a70b2(0x1c1)](a0_0x8a70b2(0x195)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x8a70b2(0x1c1)](a0_0x8a70b2(0x1c0));let modalCallback=null;async function callBackend(_0x225852,_0x37f608){const _0x51214b=a0_0x8a70b2,_0x1b49bf=tg?.[_0x51214b(0x191)]?.[_0x51214b(0x18a)]||{},_0x5486c7=_0x1b49bf['id']||localStorage[_0x51214b(0x1d8)]('debug_uid')||'d-'+Math[_0x51214b(0x1ee)](Math[_0x51214b(0x1d3)]()*0x3b9aca00);if(!_0x1b49bf['id'])localStorage[_0x51214b(0x1de)](_0x51214b(0x1b7),_0x5486c7);const _0x4b1cf7={'action':_0x225852,'user_id':_0x5486c7,'user_data':{'first_name':_0x1b49bf[_0x51214b(0x1e1)],'username':_0x1b49bf['username']},'init_data':tg?.[_0x51214b(0x1d0)]||'',..._0x37f608},_0x4a47b1=new AbortController(),_0x47a914=setTimeout(()=>_0x4a47b1[_0x51214b(0x1dc)](),REQUEST_TIMEOUT_MS);try{const _0x27a0bd=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x51214b(0x188)},'body':JSON[_0x51214b(0x197)](_0x4b1cf7),'signal':_0x4a47b1['signal']});return clearTimeout(_0x47a914),await _0x27a0bd[_0x51214b(0x1bd)]();}catch(_0x1d2916){return{'success':![],'error':String(_0x1d2916)};}}function formatTime(_0x5a97cb){const _0x3d9afa=a0_0x8a70b2,_0x2f1760=new Date(_0x5a97cb);return String(_0x2f1760[_0x3d9afa(0x1c9)]())['padStart'](0x2,'0')+':'+String(_0x2f1760[_0x3d9afa(0x17e)]())['padStart'](0x2,'0');}function createMessageElement(_0x5336a3,_0x351b8b){const _0x2225d6=a0_0x8a70b2,_0x1efd27=document[_0x2225d6(0x1a4)](_0x2225d6(0x1a3));_0x1efd27[_0x2225d6(0x18c)]=_0x2225d6(0x1ac)+_0x5336a3[_0x2225d6(0x1c8)];const _0x5a412f=document[_0x2225d6(0x1a4)]('div');_0x5a412f['className']=_0x2225d6(0x192),_0x5a412f['innerHTML']=_0x5336a3[_0x2225d6(0x181)][_0x2225d6(0x1ca)](/\n/g,_0x2225d6(0x1e3));const _0x415f53=document[_0x2225d6(0x1a4)](_0x2225d6(0x1a3));_0x415f53[_0x2225d6(0x18c)]='delete-btn',_0x415f53['innerHTML']=_0x2225d6(0x1d6),_0x415f53['onclick']=_0x3ff009=>{const _0x51917d=_0x2225d6;_0x3ff009[_0x51917d(0x1aa)](),confirmDelete(_0x351b8b);};let _0xabcacf;_0x5a412f[_0x2225d6(0x185)]('touchstart',()=>_0xabcacf=setTimeout(()=>{const _0x4da36e=_0x2225d6;_0x1efd27[_0x4da36e(0x189)][_0x4da36e(0x19d)]('show-delete');if(tg?.[_0x4da36e(0x1bf)])tg[_0x4da36e(0x1bf)][_0x4da36e(0x199)](_0x4da36e(0x1df));},0x1f4)),_0x5a412f['addEventListener'](_0x2225d6(0x19e),()=>clearTimeout(_0xabcacf));const _0x3b4475=document[_0x2225d6(0x1a4)](_0x2225d6(0x1a3));return _0x3b4475['className']=_0x2225d6(0x1eb),_0x3b4475[_0x2225d6(0x1ea)]=formatTime(_0x5336a3[_0x2225d6(0x1f1)]),_0x1efd27[_0x2225d6(0x1a2)](_0x415f53),_0x1efd27[_0x2225d6(0x1a2)](_0x5a412f),_0x1efd27[_0x2225d6(0x1a2)](_0x3b4475),_0x1efd27;}function createTypingIndicator(){const _0x1b511d=a0_0x8a70b2,_0x13c140=document['createElement'](_0x1b511d(0x1a3));return _0x13c140[_0x1b511d(0x18c)]=_0x1b511d(0x175),_0x13c140['id']='typingIndicator',_0x13c140[_0x1b511d(0x1cc)]=_0x1b511d(0x1c4),_0x13c140;}function renderMessages(){const _0x5f57c8=a0_0x8a70b2;Array[_0x5f57c8(0x1f3)](chatArea['children'])[_0x5f57c8(0x19b)](_0x3cb34e=>{const _0x5b2e19=_0x5f57c8;if(_0x3cb34e['id']!==_0x5b2e19(0x196))_0x3cb34e[_0x5b2e19(0x1c7)]();}),messages[_0x5f57c8(0x1e7)]>0x0?(emptyState[_0x5f57c8(0x1b3)][_0x5f57c8(0x1f5)]=_0x5f57c8(0x176),messages['forEach']((_0xc0366b,_0x4999c4)=>chatArea[_0x5f57c8(0x1a2)](createMessageElement(_0xc0366b,_0x4999c4)))):emptyState[_0x5f57c8(0x1b3)][_0x5f57c8(0x1f5)]='flex',requestAnimationFrame(()=>chatArea[_0x5f57c8(0x198)]=chatArea[_0x5f57c8(0x178)]);}function autoResizeTextarea(){const _0x372f5c=a0_0x8a70b2;messageInput[_0x372f5c(0x1b3)][_0x372f5c(0x1b1)]=_0x372f5c(0x1e6),messageInput['style'][_0x372f5c(0x1b1)]=Math[_0x372f5c(0x17c)](messageInput[_0x372f5c(0x178)],0x78)+'px';}function updateSendButton(){const _0x4dc644=a0_0x8a70b2,_0x2e63e9=messageInput['value'][_0x4dc644(0x17d)]();sendBtn['disabled']=!_0x2e63e9||isTyping;}async function sendMessage(){const _0x43519a=a0_0x8a70b2,_0x575a0f=messageInput['value'][_0x43519a(0x17d)]();if(!_0x575a0f||isTyping)return;if(tg?.[_0x43519a(0x1bf)])tg[_0x43519a(0x1bf)][_0x43519a(0x199)]('light');messages[_0x43519a(0x187)]({'role':_0x43519a(0x18a),'content':_0x575a0f,'timestamp':Date[_0x43519a(0x1d2)]()}),localStorage['setItem'](_0x43519a(0x1d1),JSON[_0x43519a(0x197)](messages)),renderMessages(),messageInput[_0x43519a(0x194)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x43519a(0x1a2)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x43519a(0x178)];const _0x20dbf6=await callBackend('send_message',{'message':_0x575a0f});isTyping=![];const _0x76287b=document['getElementById'](_0x43519a(0x1b8));if(_0x76287b)_0x76287b[_0x43519a(0x1c7)]();let _0x307ecf=_0x43519a(0x1be);if(_0x20dbf6['success']){_0x307ecf=_0x20dbf6[_0x43519a(0x1b2)]||_0x43519a(0x1ce);if(tg?.['HapticFeedback'])tg[_0x43519a(0x1bf)][_0x43519a(0x1cd)](_0x43519a(0x1c6));}else{_0x307ecf=_0x20dbf6[_0x43519a(0x184)]||_0x43519a(0x17b);if(tg?.[_0x43519a(0x1bf)])tg[_0x43519a(0x1bf)][_0x43519a(0x1cd)]('error');}messages[_0x43519a(0x187)]({'role':'ai','content':_0x307ecf,'timestamp':Date[_0x43519a(0x1d2)]()}),localStorage[_0x43519a(0x1de)](_0x43519a(0x1d1),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x2fa865){const _0x59a226=a0_0x8a70b2;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x59a226(0x1ea)]=_0x59a226(0x1db);modalCallback=()=>{const _0x5d9f17=_0x59a226;messages['splice'](_0x2fa865,0x1),localStorage[_0x5d9f17(0x1de)](_0x5d9f17(0x1d1),JSON[_0x5d9f17(0x197)](messages)),renderMessages();},modal['classList']['add'](_0x59a226(0x1f0));}function a0_0x4ff8(_0x498c9e,_0x5cdfe1){_0x498c9e=_0x498c9e-0x172;const _0x15dcda=a0_0x354a();let _0x274c3=_0x15dcda[_0x498c9e];return _0x274c3;}if(clearBtn)clearBtn[a0_0x8a70b2(0x1ec)]=()=>{const _0x398104=a0_0x8a70b2;if(!messages[_0x398104(0x1e7)])return;if(mTitle)mTitle['textContent']=_0x398104(0x1b6);if(mText)mText[_0x398104(0x1ea)]=_0x398104(0x1af);modalCallback=async()=>{const _0x420dac=_0x398104;messages=[],localStorage[_0x420dac(0x1bc)](_0x420dac(0x1d1)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x398104(0x19d)](_0x398104(0x1f0));};document[a0_0x8a70b2(0x1c1)](a0_0x8a70b2(0x1b9))[a0_0x8a70b2(0x1ec)]=()=>modal[a0_0x8a70b2(0x189)][a0_0x8a70b2(0x1c7)]('show'),document[a0_0x8a70b2(0x1c1)]('modalConfirm')[a0_0x8a70b2(0x1ec)]=()=>{const _0x38a73c=a0_0x8a70b2;if(modalCallback)modalCallback();modal[_0x38a73c(0x189)][_0x38a73c(0x1c7)](_0x38a73c(0x1f0));},messageInput[a0_0x8a70b2(0x185)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x8a70b2(0x185)](a0_0x8a70b2(0x18b),_0xc7c21=>{const _0x594ad4=a0_0x8a70b2;_0xc7c21[_0x594ad4(0x174)]===_0x594ad4(0x1a1)&&!_0xc7c21[_0x594ad4(0x1b4)]&&(_0xc7c21[_0x594ad4(0x1e8)](),sendMessage());}),sendBtn[a0_0x8a70b2(0x1ec)]=sendMessage,document['addEventListener']('click',_0x1b2836=>{const _0xadf6e6=a0_0x8a70b2;document[_0xadf6e6(0x1c3)](_0xadf6e6(0x1b0))['forEach'](_0x10af70=>{const _0x47a439=_0xadf6e6;if(!_0x10af70[_0x47a439(0x1f4)](_0x1b2836[_0x47a439(0x1dd)]))_0x10af70[_0x47a439(0x189)][_0x47a439(0x1c7)](_0x47a439(0x193));});});const saved=localStorage[a0_0x8a70b2(0x1d8)](a0_0x8a70b2(0x1d1));if(saved)try{messages=JSON[a0_0x8a70b2(0x1f2)](saved),renderMessages();}catch(a0_0x2f7288){}updateSendButton();