const a0_0x3d5aee=a0_0x4525;(function(_0x1c41e8,_0x8feb0e){const _0x2002f8=a0_0x4525,_0x2ab2fe=_0x1c41e8();while(!![]){try{const _0x6e58b8=parseInt(_0x2002f8(0xf2))/0x1+-parseInt(_0x2002f8(0xb0))/0x2*(-parseInt(_0x2002f8(0x94))/0x3)+-parseInt(_0x2002f8(0x97))/0x4*(-parseInt(_0x2002f8(0xc3))/0x5)+parseInt(_0x2002f8(0xd1))/0x6+parseInt(_0x2002f8(0x91))/0x7+parseInt(_0x2002f8(0xaa))/0x8+parseInt(_0x2002f8(0xdd))/0x9*(-parseInt(_0x2002f8(0xe9))/0xa);if(_0x6e58b8===_0x8feb0e)break;else _0x2ab2fe['push'](_0x2ab2fe['shift']());}catch(_0x460bd6){_0x2ab2fe['push'](_0x2ab2fe['shift']());}}}(a0_0x52d3,0xd98c7));const tg=window[a0_0x3d5aee(0xcc)]?.['WebApp'],HOME_URL=a0_0x3d5aee(0xb2);function setupTelegramBackButton(){const _0x471120=a0_0x3d5aee;if(!tg)return;try{tg[_0x471120(0xad)](),tg[_0x471120(0xe6)](),tg[_0x471120(0x87)]?.(_0x471120(0xb6));if(tg['isVersionAtLeast']?.(_0x471120(0xed)))tg[_0x471120(0xcd)]?.();const _0x2ebc02=tg[_0x471120(0xd9)];if(_0x2ebc02){_0x2ebc02[_0x471120(0xe2)]();if(typeof _0x2ebc02[_0x471120(0xc4)]===_0x471120(0xbe))try{_0x2ebc02['offClick']();}catch(_0x2153a5){}_0x2ebc02['onClick'](()=>{const _0x1609fd=_0x471120;if(tg[_0x1609fd(0xfb)])tg['HapticFeedback'][_0x1609fd(0xc6)](_0x1609fd(0x88));location[_0x1609fd(0xe1)]=HOME_URL;});}}catch(_0x5b5c19){console[_0x471120(0xee)](_0x471120(0xc0),_0x5b5c19);}}function a0_0x52d3(){const _0x3df104=['resize','paddingBottom','339fCJqCi','padStart','medium','461492CgfMYE','random','scrollHeight','innerHTML','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','modalText','length','input','add','chatArea','viewportHeight','text/plain','error','querySelector','json','remove','message\x20ai','floor','emptyState','6019048MQJmLG','display','value','ready','now','search','9934vWkfAq','flex','./router.html','stopPropagation','POST','classList','#050505','ai_chat_messages','push','height','touchstart','onclick','createElement','scrollTop','function','first_name','TG\x20setup\x20error:','toString','getMinutes','50ptZClR','offClick','Очистить\x20историю?','impactOccurred','className','auto','textContent','forEach','getItem','Telegram','disableVerticalSwipes','offsetHeight','initData','Ошибка\x20сервера','2228178dRafGe','text','sendBtn','content','.container','Ошибка\x20сети','send_message','timestamp','BackButton','trim','(((.+)+)+)+$','viewportChanged','19770057YHZAZp','message-bubble','getElementById','addEventListener','href','show','user','touchend','confirmModal','expand','style','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','20vSEbgf','div','contains','apply','6.1','warn','setItem','messageInput','modalCancel','1690652ITSCrj','focus','message\x20','appendChild','onEvent','clear_history','Удалить?','innerHeight','typingIndicator','HapticFeedback','stringify','Действие\x20необратимо.','click','querySelectorAll','message-time','initDataUnsafe','setHeaderColor','light','target','notificationOccurred','modalTitle','getHours','show-delete','Пустой\x20ответ','abort','debug_uid','5285196nDzSyW'];a0_0x52d3=function(){return _0x3df104;};return a0_0x52d3();}(function initStableLayout(){const _0x43b246=a0_0x3d5aee,_0x5647db=(function(){let _0x28db3a=!![];return function(_0x3e077b,_0x3e6309){const _0x2c147a=_0x28db3a?function(){const _0x4d8b75=a0_0x4525;if(_0x3e6309){const _0x526a02=_0x3e6309[_0x4d8b75(0xec)](_0x3e077b,arguments);return _0x3e6309=null,_0x526a02;}}:function(){};return _0x28db3a=![],_0x2c147a;};}()),_0x2b9997=document[_0x43b246(0xa4)](_0x43b246(0xd5)),_0x150ebd=document[_0x43b246(0xdf)]('inputArea'),_0x1da120=document['getElementById'](_0x43b246(0xa0)),_0x415baf=document[_0x43b246(0xdf)](_0x43b246(0xf0));function _0x27c2ab(){const _0xafab2a=_0x43b246,_0x35e6d4=_0x5647db(this,function(){const _0x395d68=a0_0x4525;return _0x35e6d4[_0x395d68(0xc1)]()[_0x395d68(0xaf)](_0x395d68(0xdb))[_0x395d68(0xc1)]()['constructor'](_0x35e6d4)['search'](_0x395d68(0xdb));});_0x35e6d4();if(!_0x2b9997)return;const _0x531c42=tg&&tg['viewportHeight']?tg[_0xafab2a(0xa1)]:window[_0xafab2a(0xf9)];_0x2b9997['style'][_0xafab2a(0xb9)]=_0x531c42+'px';if(_0x150ebd){const _0x2f705c=_0x150ebd[_0xafab2a(0xce)];_0x1da120[_0xafab2a(0xe7)][_0xafab2a(0x93)]=_0x2f705c+0x28+'px';}}tg?tg[_0x43b246(0xf6)](_0x43b246(0xdc),({isStateStable:_0x25bf70})=>{_0x27c2ab();if(_0x25bf70)requestAnimationFrame(()=>{const _0x5a40b7=a0_0x4525;_0x1da120['scrollTop']=_0x1da120[_0x5a40b7(0x99)];});}):window[_0x43b246(0xe0)](_0x43b246(0x92),_0x27c2ab),_0x27c2ab(),_0x415baf&&(_0x415baf['addEventListener'](_0x43b246(0x9e),()=>{requestAnimationFrame(_0x27c2ab);}),_0x415baf[_0x43b246(0xe0)](_0x43b246(0xf3),()=>{setTimeout(()=>{const _0x50c6a5=a0_0x4525;_0x1da120['scrollTop']=_0x1da120[_0x50c6a5(0x99)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3d5aee(0xe8),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x3d5aee(0xa0)),emptyState=document['getElementById'](a0_0x3d5aee(0xa9)),messageInput=document['getElementById'](a0_0x3d5aee(0xf0)),sendBtn=document[a0_0x3d5aee(0xdf)](a0_0x3d5aee(0xd3)),clearBtn=document[a0_0x3d5aee(0xdf)]('clearBtn'),modal=document[a0_0x3d5aee(0xdf)](a0_0x3d5aee(0xe5)),mTitle=document[a0_0x3d5aee(0xdf)](a0_0x3d5aee(0x8b)),mText=document[a0_0x3d5aee(0xdf)](a0_0x3d5aee(0x9c));let modalCallback=null;async function callBackend(_0x1a0c17,_0x1082eb){const _0x16b52d=a0_0x3d5aee,_0x532f9c=tg?.[_0x16b52d(0x86)]?.['user']||{},_0x304e4c=_0x532f9c['id']||localStorage[_0x16b52d(0xcb)](_0x16b52d(0x90))||'d-'+Math[_0x16b52d(0xa8)](Math[_0x16b52d(0x98)]()*0x3b9aca00);if(!_0x532f9c['id'])localStorage['setItem'](_0x16b52d(0x90),_0x304e4c);const _0x9e175e={'action':_0x1a0c17,'user_id':_0x304e4c,'user_data':{'first_name':_0x532f9c[_0x16b52d(0xbf)],'username':_0x532f9c['username']},'init_data':tg?.[_0x16b52d(0xcf)]||'',..._0x1082eb},_0x56e8bc=new AbortController(),_0x3f9590=setTimeout(()=>_0x56e8bc[_0x16b52d(0x8f)](),REQUEST_TIMEOUT_MS);try{const _0x549072=await fetch(BACKEND_URL,{'method':_0x16b52d(0xb4),'headers':{'Content-Type':_0x16b52d(0xa2)},'body':JSON[_0x16b52d(0xfc)](_0x9e175e),'signal':_0x56e8bc['signal']});return clearTimeout(_0x3f9590),await _0x549072[_0x16b52d(0xa5)]();}catch(_0x3c2df9){return{'success':![],'error':String(_0x3c2df9)};}}function formatTime(_0x1bec4c){const _0x5137a0=a0_0x3d5aee,_0x5656a2=new Date(_0x1bec4c);return String(_0x5656a2[_0x5137a0(0x8c)]())[_0x5137a0(0x95)](0x2,'0')+':'+String(_0x5656a2[_0x5137a0(0xc2)]())[_0x5137a0(0x95)](0x2,'0');}function createMessageElement(_0x4a5554,_0x57a9b3){const _0x4069db=a0_0x3d5aee,_0x509eb6=document['createElement'](_0x4069db(0xea));_0x509eb6[_0x4069db(0xc7)]=_0x4069db(0xf4)+_0x4a5554['role'];const _0x4cba04=document[_0x4069db(0xbc)](_0x4069db(0xea));_0x4cba04[_0x4069db(0xc7)]=_0x4069db(0xde),_0x4cba04[_0x4069db(0x9a)]=_0x4a5554[_0x4069db(0xd4)]['replace'](/\n/g,'<br>');const _0x3c86c8=document[_0x4069db(0xbc)](_0x4069db(0xea));_0x3c86c8[_0x4069db(0xc7)]='delete-btn',_0x3c86c8[_0x4069db(0x9a)]=_0x4069db(0x9b),_0x3c86c8[_0x4069db(0xbb)]=_0x6b898e=>{const _0x3ddca9=_0x4069db;_0x6b898e[_0x3ddca9(0xb3)](),confirmDelete(_0x57a9b3);};let _0x1dfc2c;_0x4cba04[_0x4069db(0xe0)](_0x4069db(0xba),()=>_0x1dfc2c=setTimeout(()=>{const _0x12cec8=_0x4069db;_0x509eb6[_0x12cec8(0xb5)][_0x12cec8(0x9f)](_0x12cec8(0x8d));if(tg?.[_0x12cec8(0xfb)])tg['HapticFeedback'][_0x12cec8(0xc6)](_0x12cec8(0x96));},0x1f4)),_0x4cba04[_0x4069db(0xe0)](_0x4069db(0xe4),()=>clearTimeout(_0x1dfc2c));const _0x292651=document[_0x4069db(0xbc)](_0x4069db(0xea));return _0x292651[_0x4069db(0xc7)]=_0x4069db(0x85),_0x292651['textContent']=formatTime(_0x4a5554[_0x4069db(0xd8)]),_0x509eb6[_0x4069db(0xf5)](_0x3c86c8),_0x509eb6[_0x4069db(0xf5)](_0x4cba04),_0x509eb6[_0x4069db(0xf5)](_0x292651),_0x509eb6;}function createTypingIndicator(){const _0x4b3fff=a0_0x3d5aee,_0x5f10de=document[_0x4b3fff(0xbc)]('div');return _0x5f10de[_0x4b3fff(0xc7)]=_0x4b3fff(0xa7),_0x5f10de['id']=_0x4b3fff(0xfa),_0x5f10de[_0x4b3fff(0x9a)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x5f10de;}function renderMessages(){const _0x10eb86=a0_0x3d5aee;Array['from'](chatArea['children'])[_0x10eb86(0xca)](_0x220e1f=>{const _0x1adffa=_0x10eb86;if(_0x220e1f['id']!==_0x1adffa(0xa9))_0x220e1f[_0x1adffa(0xa6)]();}),messages[_0x10eb86(0x9d)]>0x0?(emptyState['style'][_0x10eb86(0xab)]='none',messages['forEach']((_0xcefed2,_0x26e288)=>chatArea[_0x10eb86(0xf5)](createMessageElement(_0xcefed2,_0x26e288)))):emptyState[_0x10eb86(0xe7)][_0x10eb86(0xab)]=_0x10eb86(0xb1),requestAnimationFrame(()=>chatArea[_0x10eb86(0xbd)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x456a77=a0_0x3d5aee;messageInput[_0x456a77(0xe7)][_0x456a77(0xb9)]=_0x456a77(0xc8),messageInput[_0x456a77(0xe7)][_0x456a77(0xb9)]=Math['min'](messageInput[_0x456a77(0x99)],0x78)+'px';}function updateSendButton(){const _0x53fc57=a0_0x3d5aee,_0x433566=messageInput[_0x53fc57(0xac)][_0x53fc57(0xda)]();sendBtn['disabled']=!_0x433566||isTyping;}async function sendMessage(){const _0x25f29f=a0_0x3d5aee,_0x49d4ea=messageInput['value']['trim']();if(!_0x49d4ea||isTyping)return;if(tg?.[_0x25f29f(0xfb)])tg[_0x25f29f(0xfb)][_0x25f29f(0xc6)](_0x25f29f(0x88));messages[_0x25f29f(0xb8)]({'role':_0x25f29f(0xe3),'content':_0x49d4ea,'timestamp':Date[_0x25f29f(0xae)]()}),localStorage['setItem'](_0x25f29f(0xb7),JSON['stringify'](messages)),renderMessages(),messageInput[_0x25f29f(0xac)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x25f29f(0xf5)](createTypingIndicator()),chatArea[_0x25f29f(0xbd)]=chatArea[_0x25f29f(0x99)];const _0x2c8953=await callBackend(_0x25f29f(0xd7),{'message':_0x49d4ea});isTyping=![];const _0x2fc81e=document[_0x25f29f(0xdf)](_0x25f29f(0xfa));if(_0x2fc81e)_0x2fc81e[_0x25f29f(0xa6)]();let _0x29ad06=_0x25f29f(0xd6);if(_0x2c8953['success']){_0x29ad06=_0x2c8953[_0x25f29f(0xd2)]||_0x25f29f(0x8e);if(tg?.[_0x25f29f(0xfb)])tg[_0x25f29f(0xfb)][_0x25f29f(0x8a)]('success');}else{_0x29ad06=_0x2c8953[_0x25f29f(0xa3)]||_0x25f29f(0xd0);if(tg?.[_0x25f29f(0xfb)])tg[_0x25f29f(0xfb)][_0x25f29f(0x8a)](_0x25f29f(0xa3));}messages[_0x25f29f(0xb8)]({'role':'ai','content':_0x29ad06,'timestamp':Date[_0x25f29f(0xae)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x25f29f(0xfc)](messages)),renderMessages();}function confirmDelete(_0x2ca43d){const _0x51ac41=a0_0x3d5aee;if(mTitle)mTitle[_0x51ac41(0xc9)]=_0x51ac41(0xf8);if(mText)mText[_0x51ac41(0xc9)]=_0x51ac41(0xfd);modalCallback=()=>{const _0x4b004f=_0x51ac41;messages['splice'](_0x2ca43d,0x1),localStorage[_0x4b004f(0xef)](_0x4b004f(0xb7),JSON[_0x4b004f(0xfc)](messages)),renderMessages();},modal[_0x51ac41(0xb5)][_0x51ac41(0x9f)](_0x51ac41(0xe2));}if(clearBtn)clearBtn[a0_0x3d5aee(0xbb)]=()=>{const _0x5a8baf=a0_0x3d5aee;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x5a8baf(0xc5);if(mText)mText['textContent']='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x23cd98=_0x5a8baf;messages=[],localStorage['removeItem'](_0x23cd98(0xb7)),renderMessages(),callBackend(_0x23cd98(0xf7),{});},modal[_0x5a8baf(0xb5)][_0x5a8baf(0x9f)](_0x5a8baf(0xe2));};document['getElementById'](a0_0x3d5aee(0xf1))['onclick']=()=>modal[a0_0x3d5aee(0xb5)][a0_0x3d5aee(0xa6)](a0_0x3d5aee(0xe2)),document[a0_0x3d5aee(0xdf)]('modalConfirm')[a0_0x3d5aee(0xbb)]=()=>{const _0x5d1830=a0_0x3d5aee;if(modalCallback)modalCallback();modal[_0x5d1830(0xb5)]['remove'](_0x5d1830(0xe2));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3d5aee(0xe0)]('keydown',_0x51e682=>{_0x51e682['key']==='Enter'&&!_0x51e682['shiftKey']&&(_0x51e682['preventDefault'](),sendMessage());}),sendBtn[a0_0x3d5aee(0xbb)]=sendMessage,document[a0_0x3d5aee(0xe0)](a0_0x3d5aee(0xfe),_0x63079d=>{const _0xc88a29=a0_0x3d5aee;document[_0xc88a29(0xff)]('.message.show-delete')[_0xc88a29(0xca)](_0x199947=>{const _0x2a6718=_0xc88a29;if(!_0x199947[_0x2a6718(0xeb)](_0x63079d[_0x2a6718(0x89)]))_0x199947[_0x2a6718(0xb5)]['remove']('show-delete');});});function a0_0x4525(_0x54d433,_0x199171){_0x54d433=_0x54d433-0x85;const _0x4da87e=a0_0x52d3();let _0x185e9b=_0x4da87e[_0x54d433];return _0x185e9b;}const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x451688){}updateSendButton();