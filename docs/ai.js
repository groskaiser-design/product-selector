const a0_0x3c6112=a0_0x1d1f;(function(_0x51a886,_0x582438){const _0x43cf11=a0_0x1d1f,_0x28e3a6=_0x51a886();while(!![]){try{const _0x457158=parseInt(_0x43cf11(0x235))/0x1*(parseInt(_0x43cf11(0x22c))/0x2)+-parseInt(_0x43cf11(0x223))/0x3+-parseInt(_0x43cf11(0x226))/0x4*(parseInt(_0x43cf11(0x24a))/0x5)+-parseInt(_0x43cf11(0x1ee))/0x6+parseInt(_0x43cf11(0x248))/0x7*(-parseInt(_0x43cf11(0x213))/0x8)+-parseInt(_0x43cf11(0x257))/0x9+parseInt(_0x43cf11(0x1fe))/0xa;if(_0x457158===_0x582438)break;else _0x28e3a6['push'](_0x28e3a6['shift']());}catch(_0x4922e3){_0x28e3a6['push'](_0x28e3a6['shift']());}}}(a0_0x560f,0x606cb));const tg=window[a0_0x3c6112(0x1ea)]?.[a0_0x3c6112(0x222)],HOME_URL=a0_0x3c6112(0x218);function setupTelegramBackButton(){const _0x3bc0e3=a0_0x3c6112;if(!tg)return;try{tg[_0x3bc0e3(0x246)](),tg[_0x3bc0e3(0x237)](),tg['setHeaderColor']?.(_0x3bc0e3(0x242));if(tg[_0x3bc0e3(0x23e)]?.(_0x3bc0e3(0x233)))tg[_0x3bc0e3(0x224)]?.();const _0x45b1a5=tg['BackButton'];if(_0x45b1a5){_0x45b1a5['show']();if(typeof _0x45b1a5[_0x3bc0e3(0x207)]===_0x3bc0e3(0x1f3))try{_0x45b1a5[_0x3bc0e3(0x207)]();}catch(_0x108d0f){}_0x45b1a5[_0x3bc0e3(0x211)](()=>{const _0xfe3525=_0x3bc0e3;if(tg[_0xfe3525(0x234)])tg['HapticFeedback'][_0xfe3525(0x240)](_0xfe3525(0x25a));location[_0xfe3525(0x214)]=HOME_URL;});}}catch(_0xc59882){console[_0x3bc0e3(0x204)](_0x3bc0e3(0x1f1),_0xc59882);}}(function initStableLayout(){const _0x39c216=a0_0x3c6112,_0x312f0b=(function(){let _0x55fde7=!![];return function(_0x3c5163,_0x1a5546){const _0x208d87=_0x55fde7?function(){const _0x428b92=a0_0x1d1f;if(_0x1a5546){const _0x4504c6=_0x1a5546[_0x428b92(0x1fa)](_0x3c5163,arguments);return _0x1a5546=null,_0x4504c6;}}:function(){};return _0x55fde7=![],_0x208d87;};}()),_0x53d452=document[_0x39c216(0x262)](_0x39c216(0x21b)),_0x5b73c9=document[_0x39c216(0x209)](_0x39c216(0x1fd)),_0x33082c=document[_0x39c216(0x209)](_0x39c216(0x258)),_0x35cd03=document[_0x39c216(0x209)](_0x39c216(0x25c));function _0x1b25af(){const _0x50b006=_0x39c216,_0x5159c5=_0x312f0b(this,function(){const _0x3a25bb=a0_0x1d1f;return _0x5159c5[_0x3a25bb(0x212)]()['search'](_0x3a25bb(0x20f))[_0x3a25bb(0x212)]()[_0x3a25bb(0x251)](_0x5159c5)[_0x3a25bb(0x201)](_0x3a25bb(0x20f));});_0x5159c5();if(!_0x53d452)return;const _0x5791ba=tg&&tg['viewportHeight']?tg[_0x50b006(0x236)]:window[_0x50b006(0x202)];_0x53d452[_0x50b006(0x21c)]['height']=_0x5791ba+'px';if(_0x5b73c9){const _0x19afa6=_0x5b73c9[_0x50b006(0x1ef)];_0x33082c['style'][_0x50b006(0x1fb)]=_0x19afa6+0x28+'px';}}tg?tg[_0x39c216(0x259)](_0x39c216(0x247),({isStateStable:_0x269520})=>{_0x1b25af();if(_0x269520)requestAnimationFrame(()=>{const _0x1ddd3c=a0_0x1d1f;_0x33082c[_0x1ddd3c(0x263)]=_0x33082c[_0x1ddd3c(0x200)];});}):window[_0x39c216(0x230)](_0x39c216(0x24d),_0x1b25af),_0x1b25af(),_0x35cd03&&(_0x35cd03['addEventListener']('input',()=>{requestAnimationFrame(_0x1b25af);}),_0x35cd03['addEventListener'](_0x39c216(0x255),()=>{setTimeout(()=>{const _0x5ec416=a0_0x1d1f;_0x33082c[_0x5ec416(0x263)]=_0x33082c[_0x5ec416(0x200)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3c6112(0x252),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3c6112(0x209)](a0_0x3c6112(0x258)),emptyState=document[a0_0x3c6112(0x209)](a0_0x3c6112(0x22b)),messageInput=document[a0_0x3c6112(0x209)]('messageInput'),sendBtn=document[a0_0x3c6112(0x209)](a0_0x3c6112(0x210)),clearBtn=document[a0_0x3c6112(0x209)](a0_0x3c6112(0x1fc)),modal=document['getElementById'](a0_0x3c6112(0x267)),mTitle=document[a0_0x3c6112(0x209)](a0_0x3c6112(0x23a)),mText=document['getElementById'](a0_0x3c6112(0x269));let modalCallback=null;async function callBackend(_0x1ef948,_0x1251e8){const _0x592446=a0_0x3c6112,_0x3265cb=tg?.[_0x592446(0x22a)]?.[_0x592446(0x26b)]||{},_0x16a995=_0x3265cb['id']||localStorage[_0x592446(0x23b)](_0x592446(0x231))||'d-'+Math[_0x592446(0x250)](Math[_0x592446(0x241)]()*0x3b9aca00);if(!_0x3265cb['id'])localStorage[_0x592446(0x249)](_0x592446(0x231),_0x16a995);const _0x27823d={'action':_0x1ef948,'user_id':_0x16a995,'user_data':{'first_name':_0x3265cb[_0x592446(0x1e8)],'username':_0x3265cb[_0x592446(0x20e)]},'init_data':tg?.['initData']||'',..._0x1251e8},_0x212383=new AbortController(),_0x5275aa=setTimeout(()=>_0x212383[_0x592446(0x20a)](),REQUEST_TIMEOUT_MS);try{const _0xecc1b6=await fetch(BACKEND_URL,{'method':_0x592446(0x1f5),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x592446(0x1eb)](_0x27823d),'signal':_0x212383[_0x592446(0x24c)]});return clearTimeout(_0x5275aa),await _0xecc1b6['json']();}catch(_0x3e9640){return{'success':![],'error':String(_0x3e9640)};}}function formatTime(_0x400b4f){const _0x26b056=a0_0x3c6112,_0x43be01=new Date(_0x400b4f);return String(_0x43be01[_0x26b056(0x23f)]())[_0x26b056(0x203)](0x2,'0')+':'+String(_0x43be01[_0x26b056(0x219)]())['padStart'](0x2,'0');}function a0_0x1d1f(_0x139299,_0x49271d){_0x139299=_0x139299-0x1e7;const _0x2976a5=a0_0x560f();let _0x35905f=_0x2976a5[_0x139299];return _0x35905f;}function createMessageElement(_0x379903,_0x27a3e6){const _0xaeeeb8=a0_0x3c6112,_0x1fece5=document[_0xaeeeb8(0x261)](_0xaeeeb8(0x225));_0x1fece5[_0xaeeeb8(0x254)]=_0xaeeeb8(0x1f2)+_0x379903['role'];const _0x3774ef=document['createElement'](_0xaeeeb8(0x225));_0x3774ef[_0xaeeeb8(0x254)]=_0xaeeeb8(0x1ff),_0x3774ef[_0xaeeeb8(0x215)]=_0x379903[_0xaeeeb8(0x1f6)][_0xaeeeb8(0x1f7)](/\n/g,_0xaeeeb8(0x21d));const _0xb7d89f=document['createElement']('div');_0xb7d89f[_0xaeeeb8(0x254)]=_0xaeeeb8(0x1f9),_0xb7d89f['innerHTML']=_0xaeeeb8(0x229),_0xb7d89f[_0xaeeeb8(0x260)]=_0x556a93=>{const _0xa1400a=_0xaeeeb8;_0x556a93[_0xa1400a(0x217)](),confirmDelete(_0x27a3e6);};let _0x4142f8;_0x3774ef[_0xaeeeb8(0x230)](_0xaeeeb8(0x25e),()=>_0x4142f8=setTimeout(()=>{const _0x3cd602=_0xaeeeb8;_0x1fece5['classList'][_0x3cd602(0x24b)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x3cd602(0x234)]['impactOccurred'](_0x3cd602(0x23c));},0x1f4)),_0x3774ef[_0xaeeeb8(0x230)](_0xaeeeb8(0x243),()=>clearTimeout(_0x4142f8));const _0x329ec5=document['createElement']('div');return _0x329ec5[_0xaeeeb8(0x254)]=_0xaeeeb8(0x20c),_0x329ec5['textContent']=formatTime(_0x379903[_0xaeeeb8(0x25d)]),_0x1fece5[_0xaeeeb8(0x238)](_0xb7d89f),_0x1fece5[_0xaeeeb8(0x238)](_0x3774ef),_0x1fece5[_0xaeeeb8(0x238)](_0x329ec5),_0x1fece5;}function createTypingIndicator(){const _0x2191d1=a0_0x3c6112,_0x1d9997=document[_0x2191d1(0x261)](_0x2191d1(0x225));return _0x1d9997[_0x2191d1(0x254)]='message\x20ai',_0x1d9997['id']=_0x2191d1(0x22e),_0x1d9997['innerHTML']=_0x2191d1(0x208),_0x1d9997;}function renderMessages(){const _0x3c526e=a0_0x3c6112;Array[_0x3c526e(0x1e9)](chatArea[_0x3c526e(0x245)])[_0x3c526e(0x239)](_0x5dac32=>{const _0x5dbe6b=_0x3c526e;if(_0x5dac32['id']!=='emptyState')_0x5dac32[_0x5dbe6b(0x22d)]();}),messages[_0x3c526e(0x24f)]>0x0?(emptyState['style'][_0x3c526e(0x244)]=_0x3c526e(0x26a),messages[_0x3c526e(0x239)]((_0x38702d,_0x3461c7)=>chatArea[_0x3c526e(0x238)](createMessageElement(_0x38702d,_0x3461c7)))):emptyState['style']['display']=_0x3c526e(0x21a),requestAnimationFrame(()=>chatArea[_0x3c526e(0x263)]=chatArea[_0x3c526e(0x200)]);}function autoResizeTextarea(){const _0xa6a53b=a0_0x3c6112;messageInput[_0xa6a53b(0x21c)][_0xa6a53b(0x268)]=_0xa6a53b(0x23d),messageInput[_0xa6a53b(0x21c)][_0xa6a53b(0x268)]=Math[_0xa6a53b(0x205)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x281800=a0_0x3c6112,_0x2f670c=messageInput[_0x281800(0x21e)][_0x281800(0x24e)]();sendBtn[_0x281800(0x221)]=!_0x2f670c||isTyping;}async function sendMessage(){const _0x10f10c=a0_0x3c6112,_0x19c7bc=messageInput[_0x10f10c(0x21e)]['trim']();if(!_0x19c7bc||isTyping)return;if(tg?.[_0x10f10c(0x234)])tg[_0x10f10c(0x234)][_0x10f10c(0x240)](_0x10f10c(0x25a));messages[_0x10f10c(0x220)]({'role':_0x10f10c(0x26b),'content':_0x19c7bc,'timestamp':Date[_0x10f10c(0x1f8)]()}),localStorage[_0x10f10c(0x249)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0x10f10c(0x21e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x10f10c(0x238)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x5b6643=await callBackend('send_message',{'message':_0x19c7bc});isTyping=![];const _0xf7eefe=document[_0x10f10c(0x209)](_0x10f10c(0x22e));if(_0xf7eefe)_0xf7eefe[_0x10f10c(0x22d)]();let _0x1a0f1d=_0x10f10c(0x1ec);if(_0x5b6643[_0x10f10c(0x265)]){_0x1a0f1d=_0x5b6643['text']||_0x10f10c(0x25f);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x10f10c(0x227)](_0x10f10c(0x265));}else{_0x1a0f1d=_0x5b6643['error']||_0x10f10c(0x25b);if(tg?.[_0x10f10c(0x234)])tg[_0x10f10c(0x234)][_0x10f10c(0x227)]('error');}messages['push']({'role':'ai','content':_0x1a0f1d,'timestamp':Date['now']()}),localStorage[_0x10f10c(0x249)](_0x10f10c(0x206),JSON[_0x10f10c(0x1eb)](messages)),renderMessages();}function a0_0x560f(){const _0x5cca80=['getMinutes','flex','.container','style','<br>','value','Enter','push','disabled','WebApp','2190726qeEPfw','disableVerticalSwipes','div','4UdyRNo','notificationOccurred','show-delete','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','initDataUnsafe','emptyState','1662irWsRE','remove','typingIndicator','textContent','addEventListener','debug_uid','clear_history','6.1','HapticFeedback','264zSHtlh','viewportHeight','expand','appendChild','forEach','modalTitle','getItem','medium','auto','isVersionAtLeast','getHours','impactOccurred','random','#050505','touchend','display','children','ready','viewportChanged','111062NXRTag','setItem','643835DBYdet','add','signal','resize','trim','length','floor','constructor','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','preventDefault','className','focus','keydown','2199870qVeVAN','chatArea','onEvent','light','Ошибка\x20сервера','messageInput','timestamp','touchstart','Пустой\x20ответ','onclick','createElement','querySelector','scrollTop','show','success','Начнется\x20новый\x20диалог.','confirmModal','height','modalText','none','user','splice','first_name','from','Telegram','stringify','Ошибка\x20сети','key','1120488DKpHpE','offsetHeight','querySelectorAll','TG\x20setup\x20error:','message\x20','function','classList','POST','content','replace','now','delete-btn','apply','paddingBottom','clearBtn','inputArea','15609540pOQgvC','message-bubble','scrollHeight','search','innerHeight','padStart','warn','min','ai_chat_messages','offClick','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','getElementById','abort','Удалить?','message-time','target','username','(((.+)+)+)+$','sendBtn','onClick','toString','48WhhBpw','href','innerHTML','.message.show-delete','stopPropagation','./router.html'];a0_0x560f=function(){return _0x5cca80;};return a0_0x560f();}function confirmDelete(_0x224883){const _0x5e347e=a0_0x3c6112;if(mTitle)mTitle[_0x5e347e(0x22f)]=_0x5e347e(0x20b);if(mText)mText[_0x5e347e(0x22f)]='Действие\x20необратимо.';modalCallback=()=>{const _0x4f3a9c=_0x5e347e;messages[_0x4f3a9c(0x1e7)](_0x224883,0x1),localStorage[_0x4f3a9c(0x249)](_0x4f3a9c(0x206),JSON['stringify'](messages)),renderMessages();},modal[_0x5e347e(0x1f4)][_0x5e347e(0x24b)]('show');}if(clearBtn)clearBtn[a0_0x3c6112(0x260)]=()=>{const _0x5ab958=a0_0x3c6112;if(!messages['length'])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText['textContent']=_0x5ab958(0x266);modalCallback=async()=>{const _0x15f724=_0x5ab958;messages=[],localStorage['removeItem'](_0x15f724(0x206)),renderMessages(),callBackend(_0x15f724(0x232),{});},modal['classList'][_0x5ab958(0x24b)](_0x5ab958(0x264));};document[a0_0x3c6112(0x209)]('modalCancel')[a0_0x3c6112(0x260)]=()=>modal[a0_0x3c6112(0x1f4)][a0_0x3c6112(0x22d)](a0_0x3c6112(0x264)),document['getElementById']('modalConfirm')[a0_0x3c6112(0x260)]=()=>{const _0x14c5db=a0_0x3c6112;if(modalCallback)modalCallback();modal[_0x14c5db(0x1f4)][_0x14c5db(0x22d)]('show');},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x3c6112(0x256),_0x20e2a2=>{const _0xa97451=a0_0x3c6112;_0x20e2a2[_0xa97451(0x1ed)]===_0xa97451(0x21f)&&!_0x20e2a2['shiftKey']&&(_0x20e2a2[_0xa97451(0x253)](),sendMessage());}),sendBtn[a0_0x3c6112(0x260)]=sendMessage,document[a0_0x3c6112(0x230)]('click',_0x3ad7ca=>{const _0xb17c5=a0_0x3c6112;document[_0xb17c5(0x1f0)](_0xb17c5(0x216))[_0xb17c5(0x239)](_0x4f7e6c=>{const _0x2edc59=_0xb17c5;if(!_0x4f7e6c['contains'](_0x3ad7ca[_0x2edc59(0x20d)]))_0x4f7e6c[_0x2edc59(0x1f4)]['remove'](_0x2edc59(0x228));});});const saved=localStorage[a0_0x3c6112(0x23b)](a0_0x3c6112(0x206));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x2a6b87){}updateSendButton();