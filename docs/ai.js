const a0_0x58ffe4=a0_0x3de3;(function(_0x5ce5b5,_0x1d93e8){const _0x4a96a8=a0_0x3de3,_0x3dd72f=_0x5ce5b5();while(!![]){try{const _0x4033d8=parseInt(_0x4a96a8(0x146))/0x1+parseInt(_0x4a96a8(0x151))/0x2+-parseInt(_0x4a96a8(0x157))/0x3+-parseInt(_0x4a96a8(0x14b))/0x4+-parseInt(_0x4a96a8(0x100))/0x5+-parseInt(_0x4a96a8(0xea))/0x6*(-parseInt(_0x4a96a8(0xf5))/0x7)+-parseInt(_0x4a96a8(0x125))/0x8*(parseInt(_0x4a96a8(0xf3))/0x9);if(_0x4033d8===_0x1d93e8)break;else _0x3dd72f['push'](_0x3dd72f['shift']());}catch(_0x1f29de){_0x3dd72f['push'](_0x3dd72f['shift']());}}}(a0_0x1ba2,0xbaebf));const tg=window[a0_0x58ffe4(0x114)]?.[a0_0x58ffe4(0xee)],HOME_URL=a0_0x58ffe4(0x14f);function setupTelegramBackButton(){const _0x14e426=a0_0x58ffe4;if(!tg)return;try{tg[_0x14e426(0xe4)](),tg[_0x14e426(0x121)](),tg[_0x14e426(0x10e)]?.(_0x14e426(0x149));if(tg[_0x14e426(0x101)]?.(_0x14e426(0x128)))tg[_0x14e426(0x103)]?.();const _0x463095=tg[_0x14e426(0x142)];if(_0x463095){_0x463095[_0x14e426(0x136)]();if(typeof _0x463095[_0x14e426(0xff)]===_0x14e426(0x10b))try{_0x463095['offClick']();}catch(_0x40864f){}_0x463095['onClick'](()=>{const _0x5e3a56=_0x14e426;if(tg['HapticFeedback'])tg['HapticFeedback']['impactOccurred']('light');location[_0x5e3a56(0x107)]=HOME_URL;});}}catch(_0x589c61){console[_0x14e426(0xfd)](_0x14e426(0xf1),_0x589c61);}}(function initStableLayout(){const _0x3ea994=a0_0x58ffe4,_0x54bcf0=(function(){let _0x2b9061=!![];return function(_0x42fa20,_0x5b0039){const _0x13774d=_0x2b9061?function(){const _0x2f3bc7=a0_0x3de3;if(_0x5b0039){const _0x8fa5d0=_0x5b0039[_0x2f3bc7(0xe5)](_0x42fa20,arguments);return _0x5b0039=null,_0x8fa5d0;}}:function(){};return _0x2b9061=![],_0x13774d;};}()),_0x348a32=document[_0x3ea994(0x117)](_0x3ea994(0x104)),_0x35fce5=document[_0x3ea994(0x154)]('inputArea'),_0x21584d=document['getElementById']('chatArea'),_0x315dee=document[_0x3ea994(0x154)](_0x3ea994(0x10f));function _0x1beac7(){const _0x270279=_0x3ea994,_0x31906c=_0x54bcf0(this,function(){const _0x430b63=a0_0x3de3;return _0x31906c[_0x430b63(0x10c)]()[_0x430b63(0xe2)](_0x430b63(0x11c))[_0x430b63(0x10c)]()[_0x430b63(0x11e)](_0x31906c)[_0x430b63(0xe2)](_0x430b63(0x11c));});_0x31906c();if(!_0x348a32)return;const _0xe98cdd=tg&&tg['viewportHeight']?tg[_0x270279(0xdc)]:window[_0x270279(0x12a)];_0x348a32[_0x270279(0x11d)][_0x270279(0x144)]=_0xe98cdd+'px';if(_0x35fce5){const _0x2e92a1=_0x35fce5['offsetHeight'];_0x21584d[_0x270279(0x11d)]['paddingBottom']=_0x2e92a1+0x28+'px';}}tg?tg[_0x3ea994(0x106)](_0x3ea994(0x12b),({isStateStable:_0x13c8d3})=>{_0x1beac7();if(_0x13c8d3)requestAnimationFrame(()=>{const _0x42aebc=a0_0x3de3;_0x21584d[_0x42aebc(0xfe)]=_0x21584d[_0x42aebc(0x122)];});}):window[_0x3ea994(0x15d)](_0x3ea994(0x14a),_0x1beac7),_0x1beac7(),_0x315dee&&(_0x315dee[_0x3ea994(0x15d)]('input',()=>{requestAnimationFrame(_0x1beac7);}),_0x315dee[_0x3ea994(0x15d)](_0x3ea994(0xdb),()=>{setTimeout(()=>{const _0x44cdc1=a0_0x3de3;_0x21584d[_0x44cdc1(0xfe)]=_0x21584d[_0x44cdc1(0x122)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x1ba2(){const _0x1bd858=['trim','createElement','150640ttNJTl','getItem','auto','6.1','message-time','innerHeight','viewportChanged','Удалить?','disabled','.message.show-delete','parse','remove','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','className','show-delete','from','Пустой\x20ответ','show','target','length','typingIndicator','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','clearBtn','click','contains','setItem','stringify','modalCancel','Действие\x20необратимо.','BackButton','HapticFeedback','height','add','1464337dGLCRz','Начнется\x20новый\x20диалог.','ai_chat_messages','#050505','resize','4713352DfnQPF','textContent','push','children','./router.html','modalTitle','1664340BqiyJL','display','impactOccurred','getElementById','message\x20','debug_uid','2093844nyylvP','success','Ошибка\x20сети','sendBtn','notificationOccurred','min','addEventListener','focus','viewportHeight','forEach','medium','signal','<br>','shiftKey','search','stopPropagation','ready','apply','Очистить\x20историю?','splice','random','key','30FMhagB','querySelectorAll','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','value','WebApp','text','preventDefault','TG\x20setup\x20error:','content','45gMSIyq','getHours','1393987WFpsdo','chatArea','initData','classList','timestamp','error','padStart','POST','warn','scrollTop','offClick','2780725TGtvHz','isVersionAtLeast','touchend','disableVerticalSwipes','.container','now','onEvent','href','abort','initDataUnsafe','user','function','toString','replace','setHeaderColor','messageInput','appendChild','removeItem','div','floor','Telegram','emptyState','Ошибка\x20сервера','querySelector','onclick','message-bubble','innerHTML','flex','(((.+)+)+)+$','style','constructor','keydown','clear_history','expand','scrollHeight'];a0_0x1ba2=function(){return _0x1bd858;};return a0_0x1ba2();}function a0_0x3de3(_0x50ca4b,_0x42995d){_0x50ca4b=_0x50ca4b-0xdb;const _0x2f6fc9=a0_0x1ba2();let _0x4fc343=_0x2f6fc9[_0x50ca4b];return _0x4fc343;}const BACKEND_URL=a0_0x58ffe4(0x131),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x58ffe4(0x154)](a0_0x58ffe4(0xf6)),emptyState=document[a0_0x58ffe4(0x154)](a0_0x58ffe4(0x115)),messageInput=document[a0_0x58ffe4(0x154)](a0_0x58ffe4(0x10f)),sendBtn=document[a0_0x58ffe4(0x154)](a0_0x58ffe4(0x15a)),clearBtn=document[a0_0x58ffe4(0x154)](a0_0x58ffe4(0x13b)),modal=document[a0_0x58ffe4(0x154)]('confirmModal'),mTitle=document['getElementById'](a0_0x58ffe4(0x150)),mText=document[a0_0x58ffe4(0x154)]('modalText');let modalCallback=null;async function callBackend(_0x1d9554,_0x3238d4){const _0x174eb2=a0_0x58ffe4,_0x44b98a=tg?.[_0x174eb2(0x109)]?.[_0x174eb2(0x10a)]||{},_0x5b419d=_0x44b98a['id']||localStorage[_0x174eb2(0x126)](_0x174eb2(0x156))||'d-'+Math[_0x174eb2(0x113)](Math[_0x174eb2(0xe8)]()*0x3b9aca00);if(!_0x44b98a['id'])localStorage['setItem'](_0x174eb2(0x156),_0x5b419d);const _0x3f6bac={'action':_0x1d9554,'user_id':_0x5b419d,'user_data':{'first_name':_0x44b98a['first_name'],'username':_0x44b98a['username']},'init_data':tg?.[_0x174eb2(0xf7)]||'',..._0x3238d4},_0x3b6e98=new AbortController(),_0x251c9e=setTimeout(()=>_0x3b6e98[_0x174eb2(0x108)](),REQUEST_TIMEOUT_MS);try{const _0x56c92d=await fetch(BACKEND_URL,{'method':_0x174eb2(0xfc),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x174eb2(0x13f)](_0x3f6bac),'signal':_0x3b6e98[_0x174eb2(0xdf)]});return clearTimeout(_0x251c9e),await _0x56c92d['json']();}catch(_0x29b3c7){return{'success':![],'error':String(_0x29b3c7)};}}function formatTime(_0x461036){const _0x20827e=a0_0x58ffe4,_0x204c64=new Date(_0x461036);return String(_0x204c64[_0x20827e(0xf4)]())[_0x20827e(0xfb)](0x2,'0')+':'+String(_0x204c64['getMinutes']())[_0x20827e(0xfb)](0x2,'0');}function createMessageElement(_0x438bf9,_0x27c42d){const _0x31df8c=a0_0x58ffe4,_0x854028=document[_0x31df8c(0x124)]('div');_0x854028[_0x31df8c(0x132)]=_0x31df8c(0x155)+_0x438bf9['role'];const _0x15dd95=document[_0x31df8c(0x124)](_0x31df8c(0x112));_0x15dd95[_0x31df8c(0x132)]=_0x31df8c(0x119),_0x15dd95['innerHTML']=_0x438bf9[_0x31df8c(0xf2)][_0x31df8c(0x10d)](/\n/g,_0x31df8c(0xe0));const _0x53bc17=document[_0x31df8c(0x124)](_0x31df8c(0x112));_0x53bc17['className']='delete-btn',_0x53bc17[_0x31df8c(0x11a)]=_0x31df8c(0xec),_0x53bc17[_0x31df8c(0x118)]=_0x5aa081=>{const _0x492630=_0x31df8c;_0x5aa081[_0x492630(0xe3)](),confirmDelete(_0x27c42d);};let _0x2b02fc;_0x15dd95[_0x31df8c(0x15d)]('touchstart',()=>_0x2b02fc=setTimeout(()=>{const _0x320626=_0x31df8c;_0x854028['classList'][_0x320626(0x145)](_0x320626(0x133));if(tg?.[_0x320626(0x143)])tg['HapticFeedback'][_0x320626(0x153)](_0x320626(0xde));},0x1f4)),_0x15dd95[_0x31df8c(0x15d)](_0x31df8c(0x102),()=>clearTimeout(_0x2b02fc));const _0x1a25ae=document[_0x31df8c(0x124)](_0x31df8c(0x112));return _0x1a25ae[_0x31df8c(0x132)]=_0x31df8c(0x129),_0x1a25ae[_0x31df8c(0x14c)]=formatTime(_0x438bf9[_0x31df8c(0xf9)]),_0x854028[_0x31df8c(0x110)](_0x53bc17),_0x854028[_0x31df8c(0x110)](_0x15dd95),_0x854028[_0x31df8c(0x110)](_0x1a25ae),_0x854028;}function createTypingIndicator(){const _0x12e5e9=a0_0x58ffe4,_0x1ea425=document[_0x12e5e9(0x124)](_0x12e5e9(0x112));return _0x1ea425[_0x12e5e9(0x132)]='message\x20ai',_0x1ea425['id']=_0x12e5e9(0x139),_0x1ea425['innerHTML']=_0x12e5e9(0x13a),_0x1ea425;}function renderMessages(){const _0xfb9c10=a0_0x58ffe4;Array[_0xfb9c10(0x134)](chatArea[_0xfb9c10(0x14e)])[_0xfb9c10(0xdd)](_0x197287=>{const _0x5d04d0=_0xfb9c10;if(_0x197287['id']!==_0x5d04d0(0x115))_0x197287[_0x5d04d0(0x130)]();}),messages[_0xfb9c10(0x138)]>0x0?(emptyState[_0xfb9c10(0x11d)][_0xfb9c10(0x152)]='none',messages[_0xfb9c10(0xdd)]((_0x4d9386,_0x63e45)=>chatArea[_0xfb9c10(0x110)](createMessageElement(_0x4d9386,_0x63e45)))):emptyState[_0xfb9c10(0x11d)]['display']=_0xfb9c10(0x11b),requestAnimationFrame(()=>chatArea[_0xfb9c10(0xfe)]=chatArea[_0xfb9c10(0x122)]);}function autoResizeTextarea(){const _0x3df681=a0_0x58ffe4;messageInput['style'][_0x3df681(0x144)]=_0x3df681(0x127),messageInput[_0x3df681(0x11d)][_0x3df681(0x144)]=Math[_0x3df681(0x15c)](messageInput[_0x3df681(0x122)],0x78)+'px';}function updateSendButton(){const _0x6bb3e9=a0_0x58ffe4,_0x3ac472=messageInput[_0x6bb3e9(0xed)]['trim']();sendBtn[_0x6bb3e9(0x12d)]=!_0x3ac472||isTyping;}async function sendMessage(){const _0x2a2091=a0_0x58ffe4,_0x243e4c=messageInput[_0x2a2091(0xed)][_0x2a2091(0x123)]();if(!_0x243e4c||isTyping)return;if(tg?.[_0x2a2091(0x143)])tg['HapticFeedback'][_0x2a2091(0x153)]('light');messages[_0x2a2091(0x14d)]({'role':_0x2a2091(0x10a),'content':_0x243e4c,'timestamp':Date[_0x2a2091(0x105)]()}),localStorage['setItem'](_0x2a2091(0x148),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2a2091(0x110)](createTypingIndicator()),chatArea[_0x2a2091(0xfe)]=chatArea[_0x2a2091(0x122)];const _0x2df135=await callBackend('send_message',{'message':_0x243e4c});isTyping=![];const _0x485dc2=document[_0x2a2091(0x154)](_0x2a2091(0x139));if(_0x485dc2)_0x485dc2[_0x2a2091(0x130)]();let _0x346334=_0x2a2091(0x159);if(_0x2df135[_0x2a2091(0x158)]){_0x346334=_0x2df135[_0x2a2091(0xef)]||_0x2a2091(0x135);if(tg?.[_0x2a2091(0x143)])tg[_0x2a2091(0x143)][_0x2a2091(0x15b)](_0x2a2091(0x158));}else{_0x346334=_0x2df135[_0x2a2091(0xfa)]||_0x2a2091(0x116);if(tg?.['HapticFeedback'])tg[_0x2a2091(0x143)][_0x2a2091(0x15b)](_0x2a2091(0xfa));}messages[_0x2a2091(0x14d)]({'role':'ai','content':_0x346334,'timestamp':Date[_0x2a2091(0x105)]()}),localStorage[_0x2a2091(0x13e)](_0x2a2091(0x148),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x4fee1c){const _0x5a1804=a0_0x58ffe4;if(mTitle)mTitle[_0x5a1804(0x14c)]=_0x5a1804(0x12c);if(mText)mText[_0x5a1804(0x14c)]=_0x5a1804(0x141);modalCallback=()=>{const _0xd38974=_0x5a1804;messages[_0xd38974(0xe7)](_0x4fee1c,0x1),localStorage[_0xd38974(0x13e)](_0xd38974(0x148),JSON[_0xd38974(0x13f)](messages)),renderMessages();},modal[_0x5a1804(0xf8)]['add'](_0x5a1804(0x136));}if(clearBtn)clearBtn[a0_0x58ffe4(0x118)]=()=>{const _0x1ceafa=a0_0x58ffe4;if(!messages[_0x1ceafa(0x138)])return;if(mTitle)mTitle['textContent']=_0x1ceafa(0xe6);if(mText)mText[_0x1ceafa(0x14c)]=_0x1ceafa(0x147);modalCallback=async()=>{const _0x2df2ec=_0x1ceafa;messages=[],localStorage[_0x2df2ec(0x111)](_0x2df2ec(0x148)),renderMessages(),callBackend(_0x2df2ec(0x120),{});},modal[_0x1ceafa(0xf8)][_0x1ceafa(0x145)](_0x1ceafa(0x136));};document[a0_0x58ffe4(0x154)](a0_0x58ffe4(0x140))[a0_0x58ffe4(0x118)]=()=>modal['classList']['remove']('show'),document[a0_0x58ffe4(0x154)]('modalConfirm')['onclick']=()=>{const _0x4a943c=a0_0x58ffe4;if(modalCallback)modalCallback();modal[_0x4a943c(0xf8)][_0x4a943c(0x130)](_0x4a943c(0x136));},messageInput[a0_0x58ffe4(0x15d)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x58ffe4(0x11f),_0x2d69d0=>{const _0x143910=a0_0x58ffe4;_0x2d69d0[_0x143910(0xe9)]==='Enter'&&!_0x2d69d0[_0x143910(0xe1)]&&(_0x2d69d0[_0x143910(0xf0)](),sendMessage());}),sendBtn[a0_0x58ffe4(0x118)]=sendMessage,document[a0_0x58ffe4(0x15d)](a0_0x58ffe4(0x13c),_0x5b0cc7=>{const _0x2039ea=a0_0x58ffe4;document[_0x2039ea(0xeb)](_0x2039ea(0x12e))['forEach'](_0x1f2ce4=>{const _0x365c1a=_0x2039ea;if(!_0x1f2ce4[_0x365c1a(0x13d)](_0x5b0cc7[_0x365c1a(0x137)]))_0x1f2ce4[_0x365c1a(0xf8)][_0x365c1a(0x130)]('show-delete');});});const saved=localStorage[a0_0x58ffe4(0x126)](a0_0x58ffe4(0x148));if(saved)try{messages=JSON[a0_0x58ffe4(0x12f)](saved),renderMessages();}catch(a0_0x550287){}updateSendButton();