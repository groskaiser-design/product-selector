const a0_0x188bde=a0_0x33cc;(function(_0x41efb7,_0x9b9f82){const _0xba954a=a0_0x33cc,_0x5e2f1e=_0x41efb7();while(!![]){try{const _0x368bf1=parseInt(_0xba954a(0xe5))/0x1*(-parseInt(_0xba954a(0x146))/0x2)+parseInt(_0xba954a(0xe1))/0x3*(-parseInt(_0xba954a(0x133))/0x4)+-parseInt(_0xba954a(0xe9))/0x5+parseInt(_0xba954a(0x10b))/0x6*(parseInt(_0xba954a(0xdf))/0x7)+-parseInt(_0xba954a(0x13c))/0x8+-parseInt(_0xba954a(0x14b))/0x9*(-parseInt(_0xba954a(0x139))/0xa)+parseInt(_0xba954a(0x140))/0xb;if(_0x368bf1===_0x9b9f82)break;else _0x5e2f1e['push'](_0x5e2f1e['shift']());}catch(_0x545c60){_0x5e2f1e['push'](_0x5e2f1e['shift']());}}}(a0_0x39a9,0x83727));const tg=window[a0_0x188bde(0x115)]?.[a0_0x188bde(0x134)],HOME_URL=a0_0x188bde(0x14f);function setupTelegramBackButton(){const _0x4d8e07=a0_0x188bde,_0x2ab410=(function(){let _0x3a2913=!![];return function(_0x333637,_0x52b079){const _0x2978ec=_0x3a2913?function(){if(_0x52b079){const _0x5722fb=_0x52b079['apply'](_0x333637,arguments);return _0x52b079=null,_0x5722fb;}}:function(){};return _0x3a2913=![],_0x2978ec;};}()),_0x2fd352=_0x2ab410(this,function(){const _0x23e2a7=a0_0x33cc;return _0x2fd352[_0x23e2a7(0x157)]()[_0x23e2a7(0x101)](_0x23e2a7(0x137))['toString']()[_0x23e2a7(0x11b)](_0x2fd352)['search'](_0x23e2a7(0x137));});_0x2fd352();if(!tg)return;try{tg[_0x4d8e07(0x138)](),tg[_0x4d8e07(0x104)](),tg[_0x4d8e07(0x105)]?.(_0x4d8e07(0x153));if(tg[_0x4d8e07(0x13e)]?.(_0x4d8e07(0xe7)))tg[_0x4d8e07(0x11a)]?.();const _0x250b6e=tg[_0x4d8e07(0x131)];if(_0x250b6e){_0x250b6e['show']();if(typeof _0x250b6e[_0x4d8e07(0xf7)]==='function')try{_0x250b6e[_0x4d8e07(0xf7)]();}catch(_0x1f7a54){}_0x250b6e[_0x4d8e07(0x123)](()=>{const _0x3e0ebc=_0x4d8e07;if(tg[_0x3e0ebc(0x120)])tg[_0x3e0ebc(0x120)][_0x3e0ebc(0x12e)](_0x3e0ebc(0x151));location[_0x3e0ebc(0xfe)]=HOME_URL;});}}catch(_0x3c3ed5){console[_0x4d8e07(0xe4)](_0x4d8e07(0xe8),_0x3c3ed5);}}(function initStableLayout(){const _0x4fe8e9=a0_0x188bde,_0x5367f7=document[_0x4fe8e9(0x147)](_0x4fe8e9(0xdd)),_0x12568c=document[_0x4fe8e9(0xf6)](_0x4fe8e9(0xec)),_0x5d80b9=document[_0x4fe8e9(0xf6)](_0x4fe8e9(0xfa)),_0x104e05=document[_0x4fe8e9(0xf6)](_0x4fe8e9(0x110));function _0x4680cf(){const _0x383ac5=_0x4fe8e9;if(!_0x5367f7)return;const _0x2282c=tg&&tg['viewportHeight']?tg[_0x383ac5(0x121)]:window['innerHeight'];_0x5367f7[_0x383ac5(0xff)][_0x383ac5(0x155)]=_0x2282c+'px';if(_0x12568c){const _0x4ac191=_0x12568c[_0x383ac5(0x116)];_0x5d80b9[_0x383ac5(0xff)][_0x383ac5(0xdb)]=_0x4ac191+0x28+'px';}}tg?tg[_0x4fe8e9(0x111)](_0x4fe8e9(0xe2),({isStateStable:_0x2275bc})=>{_0x4680cf();if(_0x2275bc)requestAnimationFrame(()=>{const _0xf7cc3d=a0_0x33cc;_0x5d80b9[_0xf7cc3d(0x152)]=_0x5d80b9['scrollHeight'];});}):window[_0x4fe8e9(0xf8)](_0x4fe8e9(0xfb),_0x4680cf),_0x4680cf(),_0x104e05&&(_0x104e05['addEventListener']('input',()=>{requestAnimationFrame(_0x4680cf);}),_0x104e05[_0x4fe8e9(0xf8)](_0x4fe8e9(0x143),()=>{setTimeout(()=>{const _0x30eadc=a0_0x33cc;_0x5d80b9[_0x30eadc(0x152)]=_0x5d80b9[_0x30eadc(0x12b)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x188bde(0x103),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x33cc(_0x184436,_0x10c47b){_0x184436=_0x184436-0xda;const _0x45e957=a0_0x39a9();let _0x51b0bb=_0x45e957[_0x184436];return _0x51b0bb;}const chatArea=document[a0_0x188bde(0xf6)](a0_0x188bde(0xfa)),emptyState=document[a0_0x188bde(0xf6)](a0_0x188bde(0xed)),messageInput=document[a0_0x188bde(0xf6)](a0_0x188bde(0x110)),sendBtn=document[a0_0x188bde(0xf6)]('sendBtn'),clearBtn=document['getElementById'](a0_0x188bde(0xf2)),modal=document[a0_0x188bde(0xf6)](a0_0x188bde(0x14d)),mTitle=document[a0_0x188bde(0xf6)](a0_0x188bde(0xf9)),mText=document[a0_0x188bde(0xf6)](a0_0x188bde(0x148));let modalCallback=null;async function callBackend(_0x27f01f,_0x2e62f5){const _0x57375e=a0_0x188bde,_0x4bd1e2=tg?.[_0x57375e(0xf0)]?.['user']||{},_0x387371=_0x4bd1e2['id']||localStorage[_0x57375e(0x109)]('debug_uid')||'d-'+Math['floor'](Math[_0x57375e(0x10c)]()*0x3b9aca00);if(!_0x4bd1e2['id'])localStorage[_0x57375e(0x14a)](_0x57375e(0xe0),_0x387371);const _0x52b801={'action':_0x27f01f,'user_id':_0x387371,'user_data':{'first_name':_0x4bd1e2['first_name'],'username':_0x4bd1e2[_0x57375e(0x102)]},'init_data':tg?.['initData']||'',..._0x2e62f5},_0x287545=new AbortController(),_0x16ca72=setTimeout(()=>_0x287545[_0x57375e(0x141)](),REQUEST_TIMEOUT_MS);try{const _0x2c7e35=await fetch(BACKEND_URL,{'method':_0x57375e(0x15b),'headers':{'Content-Type':_0x57375e(0x128)},'body':JSON[_0x57375e(0x154)](_0x52b801),'signal':_0x287545['signal']});return clearTimeout(_0x16ca72),await _0x2c7e35[_0x57375e(0xda)]();}catch(_0x314402){return{'success':![],'error':String(_0x314402)};}}function formatTime(_0x3aa820){const _0xa4ef4b=a0_0x188bde,_0x54a31f=new Date(_0x3aa820);return String(_0x54a31f[_0xa4ef4b(0x124)]())[_0xa4ef4b(0x12d)](0x2,'0')+':'+String(_0x54a31f[_0xa4ef4b(0x13b)]())[_0xa4ef4b(0x12d)](0x2,'0');}function createMessageElement(_0x2a6967,_0x31e9c9){const _0x1f6d46=a0_0x188bde,_0x213176=document[_0x1f6d46(0x119)](_0x1f6d46(0x14c));_0x213176[_0x1f6d46(0xee)]=_0x1f6d46(0x11c)+_0x2a6967[_0x1f6d46(0x135)];const _0x27256e=document[_0x1f6d46(0x119)](_0x1f6d46(0x14c));_0x27256e[_0x1f6d46(0xee)]=_0x1f6d46(0x107),_0x27256e['innerHTML']=_0x2a6967[_0x1f6d46(0x125)][_0x1f6d46(0x12a)](/\n/g,'<br>');const _0x3fc1b2=document[_0x1f6d46(0x119)](_0x1f6d46(0x14c));_0x3fc1b2[_0x1f6d46(0xee)]=_0x1f6d46(0x132),_0x3fc1b2[_0x1f6d46(0xf3)]=_0x1f6d46(0xfc),_0x3fc1b2[_0x1f6d46(0x11e)]=_0x1dad6d=>{const _0x11704e=_0x1f6d46;_0x1dad6d[_0x11704e(0xdc)](),confirmDelete(_0x31e9c9);};let _0x19565b;_0x27256e[_0x1f6d46(0xf8)](_0x1f6d46(0x100),()=>_0x19565b=setTimeout(()=>{const _0x2e9f9e=_0x1f6d46;_0x213176[_0x2e9f9e(0x112)]['add'](_0x2e9f9e(0x129));if(tg?.[_0x2e9f9e(0x120)])tg['HapticFeedback'][_0x2e9f9e(0x12e)](_0x2e9f9e(0xf4));},0x1f4)),_0x27256e[_0x1f6d46(0xf8)](_0x1f6d46(0x10d),()=>clearTimeout(_0x19565b));const _0x68431d=document[_0x1f6d46(0x119)](_0x1f6d46(0x14c));return _0x68431d[_0x1f6d46(0xee)]=_0x1f6d46(0x158),_0x68431d[_0x1f6d46(0x15a)]=formatTime(_0x2a6967[_0x1f6d46(0x142)]),_0x213176[_0x1f6d46(0xfd)](_0x3fc1b2),_0x213176['appendChild'](_0x27256e),_0x213176[_0x1f6d46(0xfd)](_0x68431d),_0x213176;}function createTypingIndicator(){const _0x573134=a0_0x188bde,_0x133457=document[_0x573134(0x119)]('div');return _0x133457['className']='message\x20ai',_0x133457['id']=_0x573134(0x150),_0x133457[_0x573134(0xf3)]=_0x573134(0x149),_0x133457;}function renderMessages(){const _0x69878=a0_0x188bde;Array[_0x69878(0xf1)](chatArea[_0x69878(0x126)])[_0x69878(0x117)](_0x153f88=>{const _0x21fd91=_0x69878;if(_0x153f88['id']!==_0x21fd91(0xed))_0x153f88['remove']();}),messages[_0x69878(0x156)]>0x0?(emptyState[_0x69878(0xff)][_0x69878(0x11f)]='none',messages[_0x69878(0x117)]((_0x308702,_0x36ff77)=>chatArea['appendChild'](createMessageElement(_0x308702,_0x36ff77)))):emptyState['style']['display']=_0x69878(0xe3),requestAnimationFrame(()=>chatArea[_0x69878(0x152)]=chatArea[_0x69878(0x12b)]);}function autoResizeTextarea(){const _0x1b6907=a0_0x188bde;messageInput['style'][_0x1b6907(0x155)]=_0x1b6907(0x127),messageInput[_0x1b6907(0xff)][_0x1b6907(0x155)]=Math[_0x1b6907(0x10e)](messageInput[_0x1b6907(0x12b)],0x78)+'px';}function updateSendButton(){const _0x305172=a0_0x188bde,_0x2051e6=messageInput[_0x305172(0x159)]['trim']();sendBtn[_0x305172(0x14e)]=!_0x2051e6||isTyping;}async function sendMessage(){const _0x556c63=a0_0x188bde,_0x1a0e3b=messageInput[_0x556c63(0x159)]['trim']();if(!_0x1a0e3b||isTyping)return;if(tg?.[_0x556c63(0x120)])tg[_0x556c63(0x120)][_0x556c63(0x12e)]('light');messages[_0x556c63(0x113)]({'role':_0x556c63(0x114),'content':_0x1a0e3b,'timestamp':Date[_0x556c63(0x136)]()}),localStorage[_0x556c63(0x14a)](_0x556c63(0xea),JSON[_0x556c63(0x154)](messages)),renderMessages(),messageInput[_0x556c63(0x159)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x556c63(0xfd)](createTypingIndicator()),chatArea[_0x556c63(0x152)]=chatArea[_0x556c63(0x12b)];const _0x57c39a=await callBackend('send_message',{'message':_0x1a0e3b});isTyping=![];const _0x19d87a=document[_0x556c63(0xf6)](_0x556c63(0x150));if(_0x19d87a)_0x19d87a['remove']();let _0x490c0b=_0x556c63(0x13d);if(_0x57c39a[_0x556c63(0x106)]){_0x490c0b=_0x57c39a[_0x556c63(0x10f)]||_0x556c63(0x144);if(tg?.[_0x556c63(0x120)])tg[_0x556c63(0x120)]['notificationOccurred']('success');}else{_0x490c0b=_0x57c39a[_0x556c63(0x12f)]||'Ошибка\x20сервера';if(tg?.[_0x556c63(0x120)])tg[_0x556c63(0x120)][_0x556c63(0xde)](_0x556c63(0x12f));}messages[_0x556c63(0x113)]({'role':'ai','content':_0x490c0b,'timestamp':Date[_0x556c63(0x136)]()}),localStorage[_0x556c63(0x14a)](_0x556c63(0xea),JSON[_0x556c63(0x154)](messages)),renderMessages();}function confirmDelete(_0x2fb539){const _0x1cd738=a0_0x188bde;if(mTitle)mTitle[_0x1cd738(0x15a)]='Удалить?';if(mText)mText[_0x1cd738(0x15a)]='Действие\x20необратимо.';modalCallback=()=>{const _0x3a9ce7=_0x1cd738;messages[_0x3a9ce7(0x13a)](_0x2fb539,0x1),localStorage[_0x3a9ce7(0x14a)](_0x3a9ce7(0xea),JSON['stringify'](messages)),renderMessages();},modal[_0x1cd738(0x112)][_0x1cd738(0x15c)]('show');}if(clearBtn)clearBtn[a0_0x188bde(0x11e)]=()=>{const _0x3378ce=a0_0x188bde;if(!messages[_0x3378ce(0x156)])return;if(mTitle)mTitle[_0x3378ce(0x15a)]=_0x3378ce(0xf5);if(mText)mText[_0x3378ce(0x15a)]=_0x3378ce(0x118);modalCallback=async()=>{const _0x50daa6=_0x3378ce;messages=[],localStorage[_0x50daa6(0x108)](_0x50daa6(0xea)),renderMessages(),callBackend(_0x50daa6(0xef),{});},modal[_0x3378ce(0x112)][_0x3378ce(0x15c)](_0x3378ce(0x122));};document[a0_0x188bde(0xf6)]('modalCancel')['onclick']=()=>modal[a0_0x188bde(0x112)][a0_0x188bde(0x12c)](a0_0x188bde(0x122)),document[a0_0x188bde(0xf6)]('modalConfirm')[a0_0x188bde(0x11e)]=()=>{const _0x24d799=a0_0x188bde;if(modalCallback)modalCallback();modal['classList'][_0x24d799(0x12c)](_0x24d799(0x122));},messageInput['addEventListener'](a0_0x188bde(0x145),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x188bde(0xf8)](a0_0x188bde(0xe6),_0x301850=>{const _0x34b5cb=a0_0x188bde;_0x301850['key']===_0x34b5cb(0x13f)&&!_0x301850[_0x34b5cb(0x11d)]&&(_0x301850[_0x34b5cb(0x10a)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x188bde(0xf8)]('click',_0x419497=>{const _0x11a12b=a0_0x188bde;document['querySelectorAll'](_0x11a12b(0xeb))[_0x11a12b(0x117)](_0xec7782=>{const _0x12a487=_0x11a12b;if(!_0xec7782['contains'](_0x419497[_0x12a487(0x130)]))_0xec7782[_0x12a487(0x112)][_0x12a487(0x12c)]('show-delete');});});function a0_0x39a9(){const _0x2711d9=['initDataUnsafe','from','clearBtn','innerHTML','medium','Очистить\x20историю?','getElementById','offClick','addEventListener','modalTitle','chatArea','resize','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','appendChild','href','style','touchstart','search','username','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','expand','setHeaderColor','success','message-bubble','removeItem','getItem','preventDefault','5337516CGDmyf','random','touchend','min','text','messageInput','onEvent','classList','push','user','Telegram','offsetHeight','forEach','Начнется\x20новый\x20диалог.','createElement','disableVerticalSwipes','constructor','message\x20','shiftKey','onclick','display','HapticFeedback','viewportHeight','show','onClick','getHours','content','children','auto','text/plain','show-delete','replace','scrollHeight','remove','padStart','impactOccurred','error','target','BackButton','delete-btn','3689636bMTAcY','WebApp','role','now','(((.+)+)+)+$','ready','230170vgjENe','splice','getMinutes','4407928ddcyKi','Ошибка\x20сети','isVersionAtLeast','Enter','20013697oeaPHo','abort','timestamp','focus','Пустой\x20ответ','input','47202sUUQur','querySelector','modalText','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','setItem','243ryhPgG','div','confirmModal','disabled','./router.html','typingIndicator','light','scrollTop','#050505','stringify','height','length','toString','message-time','value','textContent','POST','add','json','paddingBottom','stopPropagation','.container','notificationOccurred','7TWRzJl','debug_uid','3sPllUs','viewportChanged','flex','warn','33uGAxWo','keydown','6.1','TG\x20setup\x20error:','2699160IxFXOH','ai_chat_messages','.message.show-delete','inputArea','emptyState','className','clear_history'];a0_0x39a9=function(){return _0x2711d9;};return a0_0x39a9();}const saved=localStorage[a0_0x188bde(0x109)](a0_0x188bde(0xea));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x2b7fff){}updateSendButton();