const a0_0x45d2fc=a0_0x4764;(function(_0x41c324,_0x49d49a){const _0x530066=a0_0x4764,_0x46bbe6=_0x41c324();while(!![]){try{const _0x3be73a=-parseInt(_0x530066(0x161))/0x1+parseInt(_0x530066(0x15f))/0x2+parseInt(_0x530066(0x184))/0x3+-parseInt(_0x530066(0x1aa))/0x4*(-parseInt(_0x530066(0x170))/0x5)+parseInt(_0x530066(0x172))/0x6*(-parseInt(_0x530066(0x16f))/0x7)+-parseInt(_0x530066(0x1a8))/0x8+-parseInt(_0x530066(0x1cf))/0x9*(parseInt(_0x530066(0x1b6))/0xa);if(_0x3be73a===_0x49d49a)break;else _0x46bbe6['push'](_0x46bbe6['shift']());}catch(_0x5bc7d1){_0x46bbe6['push'](_0x46bbe6['shift']());}}}(a0_0xc190,0x9c48c));const tg=window['Telegram']?.[a0_0x45d2fc(0x169)],HOME_URL=a0_0x45d2fc(0x173);function setupTelegramBackButton(){const _0x2f4175=a0_0x45d2fc;if(!tg)return;try{tg[_0x2f4175(0x16b)](),tg[_0x2f4175(0x187)](),tg[_0x2f4175(0x1be)]?.(_0x2f4175(0x15c));if(tg[_0x2f4175(0x195)]?.(_0x2f4175(0x1c9)))tg['disableVerticalSwipes']?.();const _0x5dc50b=tg[_0x2f4175(0x1b3)];if(_0x5dc50b){_0x5dc50b[_0x2f4175(0x19c)]();if(typeof _0x5dc50b[_0x2f4175(0x192)]===_0x2f4175(0x16a))try{_0x5dc50b[_0x2f4175(0x192)]();}catch(_0x2e52d2){}_0x5dc50b['onClick'](()=>{const _0x5489d1=_0x2f4175;if(tg[_0x5489d1(0x197)])tg[_0x5489d1(0x197)][_0x5489d1(0x1ca)](_0x5489d1(0x15a));location[_0x5489d1(0x174)]=HOME_URL;});}}catch(_0x131eaf){console['warn']('TG\x20setup\x20error:',_0x131eaf);}}(function initStableLayout(){const _0x245311=a0_0x45d2fc,_0x13ca95=(function(){let _0x5244a5=!![];return function(_0x1bdbca,_0x4cbc4){const _0x59534f=_0x5244a5?function(){if(_0x4cbc4){const _0x2234db=_0x4cbc4['apply'](_0x1bdbca,arguments);return _0x4cbc4=null,_0x2234db;}}:function(){};return _0x5244a5=![],_0x59534f;};}()),_0x15c841=document[_0x245311(0x1ab)](_0x245311(0x18b)),_0x4e6aa0=document[_0x245311(0x19e)](_0x245311(0x1a6)),_0x52fc7d=document[_0x245311(0x19e)]('chatArea'),_0x2bfc37=document[_0x245311(0x19e)]('messageInput');function _0x444e18(){const _0x4d3a79=_0x245311,_0x59bc11=_0x13ca95(this,function(){const _0x517566=a0_0x4764;return _0x59bc11[_0x517566(0x194)]()[_0x517566(0x1b8)]('(((.+)+)+)+$')[_0x517566(0x194)]()[_0x517566(0x1ba)](_0x59bc11)[_0x517566(0x1b8)](_0x517566(0x18a));});_0x59bc11();if(!_0x15c841)return;const _0x4514a7=tg&&tg[_0x4d3a79(0x1ac)]?tg[_0x4d3a79(0x1ac)]:window[_0x4d3a79(0x1ad)];_0x15c841[_0x4d3a79(0x199)]['height']=_0x4514a7+'px';if(_0x4e6aa0){const _0x2739c6=_0x4e6aa0[_0x4d3a79(0x177)];_0x52fc7d[_0x4d3a79(0x199)][_0x4d3a79(0x186)]=_0x2739c6+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x22250d})=>{_0x444e18();if(_0x22250d)requestAnimationFrame(()=>{const _0x1659a2=a0_0x4764;_0x52fc7d[_0x1659a2(0x1ae)]=_0x52fc7d['scrollHeight'];});}):window[_0x245311(0x162)](_0x245311(0x182),_0x444e18),_0x444e18(),_0x2bfc37&&(_0x2bfc37[_0x245311(0x162)](_0x245311(0x175),()=>{requestAnimationFrame(_0x444e18);}),_0x2bfc37['addEventListener'](_0x245311(0x158),()=>{setTimeout(()=>{const _0xdd6679=a0_0x4764;_0x52fc7d[_0xdd6679(0x1ae)]=_0x52fc7d[_0xdd6679(0x15e)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;function a0_0xc190(){const _0x243c4a=['flex','user','timestamp','medium','onclick','add','innerHTML','Enter','key','modalText','6.1','impactOccurred','Очистить\x20историю?','debug_uid','trim','sendBtn','113013YZzHli','confirmModal','floor','getHours','POST','content','min','focus','textContent','light','parse','#050505','modalCancel','scrollHeight','1844592qxAful','<br>','919979MCOLWZ','addEventListener','Ошибка\x20сети','emptyState','value','setItem','random','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','WebApp','function','ready','classList','disabled','className','52563dGqamT','355lPZHxO','padStart','66qngfmX','./router.html','href','input','success','offsetHeight','.message.show-delete','getMinutes','click','getItem','push','message\x20ai','touchstart','forEach','querySelectorAll','Действие\x20необратимо.','resize','createElement','2643117GpNSVS','shiftKey','paddingBottom','expand','remove','initData','(((.+)+)+)+$','.container','length','none','clear_history','text/plain','ai_chat_messages','preventDefault','offClick','height','toString','isVersionAtLeast','from','HapticFeedback','appendChild','style','json','touchend','show','message\x20','getElementById','Пустой\x20ответ','keydown','children','stringify','typingIndicator','messageInput','now','inputArea','splice','4497576qVfoZK','abort','53044fhHXVo','querySelector','viewportHeight','innerHeight','scrollTop','message-time','display','clearBtn','error','BackButton','notificationOccurred','signal','430hyZJkv','target','search','div','constructor','Удалить?','username','message-bubble','setHeaderColor'];a0_0xc190=function(){return _0x243c4a;};return a0_0xc190();}let messages=[],isTyping=![];const chatArea=document[a0_0x45d2fc(0x19e)]('chatArea'),emptyState=document[a0_0x45d2fc(0x19e)](a0_0x45d2fc(0x164)),messageInput=document[a0_0x45d2fc(0x19e)](a0_0x45d2fc(0x1a4)),sendBtn=document[a0_0x45d2fc(0x19e)](a0_0x45d2fc(0x1ce)),clearBtn=document['getElementById'](a0_0x45d2fc(0x1b1)),modal=document[a0_0x45d2fc(0x19e)](a0_0x45d2fc(0x1d0)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x45d2fc(0x19e)](a0_0x45d2fc(0x1c8));let modalCallback=null;async function callBackend(_0x3448be,_0x4c9ee5){const _0x45b519=a0_0x45d2fc,_0x1ed73e=tg?.['initDataUnsafe']?.[_0x45b519(0x1c0)]||{},_0x20c766=_0x1ed73e['id']||localStorage[_0x45b519(0x17b)](_0x45b519(0x1cc))||'d-'+Math[_0x45b519(0x1d1)](Math[_0x45b519(0x167)]()*0x3b9aca00);if(!_0x1ed73e['id'])localStorage[_0x45b519(0x166)](_0x45b519(0x1cc),_0x20c766);const _0x47f034={'action':_0x3448be,'user_id':_0x20c766,'user_data':{'first_name':_0x1ed73e['first_name'],'username':_0x1ed73e[_0x45b519(0x1bc)]},'init_data':tg?.[_0x45b519(0x189)]||'',..._0x4c9ee5},_0xa66907=new AbortController(),_0x4d1131=setTimeout(()=>_0xa66907[_0x45b519(0x1a9)](),REQUEST_TIMEOUT_MS);try{const _0x40a8ff=await fetch(BACKEND_URL,{'method':_0x45b519(0x1d3),'headers':{'Content-Type':_0x45b519(0x18f)},'body':JSON['stringify'](_0x47f034),'signal':_0xa66907[_0x45b519(0x1b5)]});return clearTimeout(_0x4d1131),await _0x40a8ff[_0x45b519(0x19a)]();}catch(_0x32af65){return{'success':![],'error':String(_0x32af65)};}}function formatTime(_0x5be8b4){const _0x3a6162=a0_0x45d2fc,_0x2e2fb5=new Date(_0x5be8b4);return String(_0x2e2fb5[_0x3a6162(0x1d2)]())[_0x3a6162(0x171)](0x2,'0')+':'+String(_0x2e2fb5[_0x3a6162(0x179)]())['padStart'](0x2,'0');}function createMessageElement(_0x4c5fe9,_0xbbc9ac){const _0x56b3be=a0_0x45d2fc,_0x14e01a=document[_0x56b3be(0x183)]('div');_0x14e01a[_0x56b3be(0x16e)]=_0x56b3be(0x19d)+_0x4c5fe9['role'];const _0x58bb47=document[_0x56b3be(0x183)](_0x56b3be(0x1b9));_0x58bb47[_0x56b3be(0x16e)]=_0x56b3be(0x1bd),_0x58bb47[_0x56b3be(0x1c5)]=_0x4c5fe9[_0x56b3be(0x1d4)]['replace'](/\n/g,_0x56b3be(0x160));const _0x48c34c=document[_0x56b3be(0x183)](_0x56b3be(0x1b9));_0x48c34c[_0x56b3be(0x16e)]='delete-btn',_0x48c34c[_0x56b3be(0x1c5)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x48c34c[_0x56b3be(0x1c3)]=_0xcdbd01=>{_0xcdbd01['stopPropagation'](),confirmDelete(_0xbbc9ac);};let _0x57a74d;_0x58bb47[_0x56b3be(0x162)](_0x56b3be(0x17e),()=>_0x57a74d=setTimeout(()=>{const _0x2d5c5c=_0x56b3be;_0x14e01a[_0x2d5c5c(0x16c)][_0x2d5c5c(0x1c4)]('show-delete');if(tg?.[_0x2d5c5c(0x197)])tg[_0x2d5c5c(0x197)][_0x2d5c5c(0x1ca)](_0x2d5c5c(0x1c2));},0x1f4)),_0x58bb47[_0x56b3be(0x162)](_0x56b3be(0x19b),()=>clearTimeout(_0x57a74d));const _0x217723=document[_0x56b3be(0x183)](_0x56b3be(0x1b9));return _0x217723[_0x56b3be(0x16e)]=_0x56b3be(0x1af),_0x217723['textContent']=formatTime(_0x4c5fe9[_0x56b3be(0x1c1)]),_0x14e01a[_0x56b3be(0x198)](_0x48c34c),_0x14e01a[_0x56b3be(0x198)](_0x58bb47),_0x14e01a[_0x56b3be(0x198)](_0x217723),_0x14e01a;}function createTypingIndicator(){const _0x340eee=a0_0x45d2fc,_0x273251=document['createElement'](_0x340eee(0x1b9));return _0x273251[_0x340eee(0x16e)]=_0x340eee(0x17d),_0x273251['id']=_0x340eee(0x1a3),_0x273251['innerHTML']=_0x340eee(0x168),_0x273251;}function renderMessages(){const _0x18af28=a0_0x45d2fc;Array[_0x18af28(0x196)](chatArea[_0x18af28(0x1a1)])[_0x18af28(0x17f)](_0x5a5d14=>{const _0x1aea1c=_0x18af28;if(_0x5a5d14['id']!==_0x1aea1c(0x164))_0x5a5d14[_0x1aea1c(0x188)]();}),messages[_0x18af28(0x18c)]>0x0?(emptyState['style'][_0x18af28(0x1b0)]=_0x18af28(0x18d),messages[_0x18af28(0x17f)]((_0x2436ba,_0x4f55ea)=>chatArea[_0x18af28(0x198)](createMessageElement(_0x2436ba,_0x4f55ea)))):emptyState[_0x18af28(0x199)][_0x18af28(0x1b0)]=_0x18af28(0x1bf),requestAnimationFrame(()=>chatArea[_0x18af28(0x1ae)]=chatArea[_0x18af28(0x15e)]);}function a0_0x4764(_0x39e30a,_0x4a84ef){_0x39e30a=_0x39e30a-0x158;const _0x14dc52=a0_0xc190();let _0x504598=_0x14dc52[_0x39e30a];return _0x504598;}function autoResizeTextarea(){const _0x60b8ac=a0_0x45d2fc;messageInput[_0x60b8ac(0x199)][_0x60b8ac(0x193)]='auto',messageInput['style'][_0x60b8ac(0x193)]=Math[_0x60b8ac(0x1d5)](messageInput[_0x60b8ac(0x15e)],0x78)+'px';}function updateSendButton(){const _0x1db158=a0_0x45d2fc,_0x5b70da=messageInput['value'][_0x1db158(0x1cd)]();sendBtn[_0x1db158(0x16d)]=!_0x5b70da||isTyping;}async function sendMessage(){const _0x581233=a0_0x45d2fc,_0x2f0f97=messageInput[_0x581233(0x165)][_0x581233(0x1cd)]();if(!_0x2f0f97||isTyping)return;if(tg?.[_0x581233(0x197)])tg[_0x581233(0x197)][_0x581233(0x1ca)](_0x581233(0x15a));messages['push']({'role':_0x581233(0x1c0),'content':_0x2f0f97,'timestamp':Date['now']()}),localStorage[_0x581233(0x166)](_0x581233(0x190),JSON[_0x581233(0x1a2)](messages)),renderMessages(),messageInput[_0x581233(0x165)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x581233(0x1ae)]=chatArea['scrollHeight'];const _0xf9113c=await callBackend('send_message',{'message':_0x2f0f97});isTyping=![];const _0x2319ba=document[_0x581233(0x19e)](_0x581233(0x1a3));if(_0x2319ba)_0x2319ba[_0x581233(0x188)]();let _0x2023e2=_0x581233(0x163);if(_0xf9113c[_0x581233(0x176)]){_0x2023e2=_0xf9113c['text']||_0x581233(0x19f);if(tg?.[_0x581233(0x197)])tg[_0x581233(0x197)][_0x581233(0x1b4)](_0x581233(0x176));}else{_0x2023e2=_0xf9113c[_0x581233(0x1b2)]||'Ошибка\x20сервера';if(tg?.[_0x581233(0x197)])tg[_0x581233(0x197)]['notificationOccurred'](_0x581233(0x1b2));}messages[_0x581233(0x17c)]({'role':'ai','content':_0x2023e2,'timestamp':Date[_0x581233(0x1a5)]()}),localStorage[_0x581233(0x166)](_0x581233(0x190),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x1e2b2f){const _0x5e5eea=a0_0x45d2fc;if(mTitle)mTitle[_0x5e5eea(0x159)]=_0x5e5eea(0x1bb);if(mText)mText[_0x5e5eea(0x159)]=_0x5e5eea(0x181);modalCallback=()=>{const _0x34fbc3=_0x5e5eea;messages[_0x34fbc3(0x1a7)](_0x1e2b2f,0x1),localStorage['setItem'](_0x34fbc3(0x190),JSON[_0x34fbc3(0x1a2)](messages)),renderMessages();},modal[_0x5e5eea(0x16c)][_0x5e5eea(0x1c4)]('show');}if(clearBtn)clearBtn[a0_0x45d2fc(0x1c3)]=()=>{const _0x5d9f32=a0_0x45d2fc;if(!messages['length'])return;if(mTitle)mTitle[_0x5d9f32(0x159)]=_0x5d9f32(0x1cb);if(mText)mText[_0x5d9f32(0x159)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x5b1dfa=_0x5d9f32;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x5b1dfa(0x18e),{});},modal['classList']['add'](_0x5d9f32(0x19c));};document[a0_0x45d2fc(0x19e)](a0_0x45d2fc(0x15d))['onclick']=()=>modal[a0_0x45d2fc(0x16c)][a0_0x45d2fc(0x188)](a0_0x45d2fc(0x19c)),document[a0_0x45d2fc(0x19e)]('modalConfirm')['onclick']=()=>{const _0x18ac68=a0_0x45d2fc;if(modalCallback)modalCallback();modal[_0x18ac68(0x16c)]['remove'](_0x18ac68(0x19c));},messageInput['addEventListener'](a0_0x45d2fc(0x175),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x45d2fc(0x1a0),_0x391db5=>{const _0x5655ba=a0_0x45d2fc;_0x391db5[_0x5655ba(0x1c7)]===_0x5655ba(0x1c6)&&!_0x391db5[_0x5655ba(0x185)]&&(_0x391db5[_0x5655ba(0x191)](),sendMessage());}),sendBtn[a0_0x45d2fc(0x1c3)]=sendMessage,document['addEventListener'](a0_0x45d2fc(0x17a),_0x189b8a=>{const _0x4aa333=a0_0x45d2fc;document[_0x4aa333(0x180)](_0x4aa333(0x178))[_0x4aa333(0x17f)](_0xf06b8f=>{const _0x463082=_0x4aa333;if(!_0xf06b8f['contains'](_0x189b8a[_0x463082(0x1b7)]))_0xf06b8f[_0x463082(0x16c)][_0x463082(0x188)]('show-delete');});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x45d2fc(0x15b)](saved),renderMessages();}catch(a0_0x3bf488){}updateSendButton();