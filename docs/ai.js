const a0_0x5cbe2b=a0_0x3367;(function(_0x23a74a,_0x11b21a){const _0x1b1be9=a0_0x3367,_0x283251=_0x23a74a();while(!![]){try{const _0x18c9c9=-parseInt(_0x1b1be9(0x1d9))/0x1*(-parseInt(_0x1b1be9(0x1f3))/0x2)+-parseInt(_0x1b1be9(0x1c1))/0x3*(-parseInt(_0x1b1be9(0x1c9))/0x4)+-parseInt(_0x1b1be9(0x1f7))/0x5+-parseInt(_0x1b1be9(0x1bf))/0x6*(-parseInt(_0x1b1be9(0x207))/0x7)+-parseInt(_0x1b1be9(0x213))/0x8+-parseInt(_0x1b1be9(0x1b1))/0x9+-parseInt(_0x1b1be9(0x1d1))/0xa;if(_0x18c9c9===_0x11b21a)break;else _0x283251['push'](_0x283251['shift']());}catch(_0x315279){_0x283251['push'](_0x283251['shift']());}}}(a0_0x27a3,0xae27a));const tg=window['Telegram']?.[a0_0x5cbe2b(0x1d7)],HOME_URL='./router.html';function a0_0x27a3(){const _0x309e25=['Начнется\x20новый\x20диалог.','message-bubble','disabled','getElementById','clearBtn','success','display','none','offClick','getMinutes','style','Удалить?','warn','focus','apply','length','className','.container','viewportChanged','target','message\x20ai','setHeaderColor','(((.+)+)+)+$','6340302YAIkml','click','message-time','onEvent','clear_history','json','onClick','light','Действие\x20необратимо.','initData','scrollTop','emptyState','getItem','disableVerticalSwipes','824400WFnQgP','floor','2045328pziVdT','stringify','role','abort','constructor','confirmModal','user','shiftKey','8yQVzNh','text/plain','from','paddingBottom','Ошибка\x20сервера','impactOccurred','send_message','content','12032370gWffKm','isVersionAtLeast','appendChild','show-delete','ai_chat_messages','typingIndicator','WebApp','modalCancel','4385zeUQzh','innerHTML','querySelector','first_name','modalText','scrollHeight','TG\x20setup\x20error:','resize','removeItem','#050505','Ошибка\x20сети','viewportHeight','now','addEventListener','trim','show','height','setItem','inputArea','sendBtn','BackButton','createElement','Enter','initDataUnsafe','push','forEach','582ZWNJaZ','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','delete-btn','Пустой\x20ответ','1237030kaNtCd','parse','messageInput','children','min','onclick','notificationOccurred','debug_uid','chatArea','.message.show-delete','offsetHeight','innerHeight','padStart','POST','HapticFeedback','classList','42hNqwEg','keydown','textContent','random','touchstart','key','message\x20','contains','auto','getHours','querySelectorAll','stopPropagation','4764224kfOqkL','add','search','div','username','error','<br>','input','href','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','value','remove'];a0_0x27a3=function(){return _0x309e25;};return a0_0x27a3();}function setupTelegramBackButton(){const _0x49df0b=a0_0x5cbe2b;if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x49df0b(0x1af)]?.(_0x49df0b(0x1e2));if(tg[_0x49df0b(0x1d2)]?.('6.1'))tg[_0x49df0b(0x1be)]?.();const _0xa38bdc=tg[_0x49df0b(0x1ed)];if(_0xa38bdc){_0xa38bdc[_0x49df0b(0x1e8)]();if(typeof _0xa38bdc[_0x49df0b(0x1a2)]==='function')try{_0xa38bdc[_0x49df0b(0x1a2)]();}catch(_0x3bf0c1){}_0xa38bdc[_0x49df0b(0x1b7)](()=>{const _0x52b5a2=_0x49df0b;if(tg[_0x52b5a2(0x205)])tg['HapticFeedback']['impactOccurred'](_0x52b5a2(0x1b8));location[_0x52b5a2(0x21b)]=HOME_URL;});}}catch(_0x6a6a69){console[_0x49df0b(0x1a6)](_0x49df0b(0x1df),_0x6a6a69);}}(function initStableLayout(){const _0x1b45fd=a0_0x5cbe2b,_0x1a21eb=(function(){let _0x39691b=!![];return function(_0x3dc5f2,_0x8f19b2){const _0x4c4758=_0x39691b?function(){const _0x267ca9=a0_0x3367;if(_0x8f19b2){const _0x36c7b8=_0x8f19b2[_0x267ca9(0x1a8)](_0x3dc5f2,arguments);return _0x8f19b2=null,_0x36c7b8;}}:function(){};return _0x39691b=![],_0x4c4758;};}()),_0x17b8e2=document[_0x1b45fd(0x1db)](_0x1b45fd(0x1ab)),_0x24ce8e=document['getElementById'](_0x1b45fd(0x1eb)),_0x2028bf=document[_0x1b45fd(0x19d)]('chatArea'),_0x19e3b6=document[_0x1b45fd(0x19d)](_0x1b45fd(0x1f9));function _0x23ffcd(){const _0x5bb3db=_0x1b45fd,_0x173160=_0x1a21eb(this,function(){const _0x3f1d75=a0_0x3367;return _0x173160['toString']()[_0x3f1d75(0x215)](_0x3f1d75(0x1b0))['toString']()[_0x3f1d75(0x1c5)](_0x173160)[_0x3f1d75(0x215)](_0x3f1d75(0x1b0));});_0x173160();if(!_0x17b8e2)return;const _0x36ddbd=tg&&tg[_0x5bb3db(0x1e4)]?tg[_0x5bb3db(0x1e4)]:window[_0x5bb3db(0x202)];_0x17b8e2[_0x5bb3db(0x1a4)]['height']=_0x36ddbd+'px';if(_0x24ce8e){const _0x5c58b9=_0x24ce8e[_0x5bb3db(0x201)];_0x2028bf[_0x5bb3db(0x1a4)][_0x5bb3db(0x1cc)]=_0x5c58b9+0x28+'px';}}tg?tg[_0x1b45fd(0x1b4)](_0x1b45fd(0x1ac),({isStateStable:_0x536cce})=>{_0x23ffcd();if(_0x536cce)requestAnimationFrame(()=>{const _0x682860=a0_0x3367;_0x2028bf[_0x682860(0x1bb)]=_0x2028bf[_0x682860(0x1de)];});}):window[_0x1b45fd(0x1e6)](_0x1b45fd(0x1e0),_0x23ffcd),_0x23ffcd(),_0x19e3b6&&(_0x19e3b6[_0x1b45fd(0x1e6)](_0x1b45fd(0x21a),()=>{requestAnimationFrame(_0x23ffcd);}),_0x19e3b6[_0x1b45fd(0x1e6)](_0x1b45fd(0x1a7),()=>{setTimeout(()=>{const _0x1024a3=a0_0x3367;_0x2028bf[_0x1024a3(0x1bb)]=_0x2028bf[_0x1024a3(0x1de)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5cbe2b(0x21c),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5cbe2b(0x19d)](a0_0x5cbe2b(0x1ff)),emptyState=document[a0_0x5cbe2b(0x19d)](a0_0x5cbe2b(0x1bc)),messageInput=document[a0_0x5cbe2b(0x19d)]('messageInput'),sendBtn=document[a0_0x5cbe2b(0x19d)](a0_0x5cbe2b(0x1ec)),clearBtn=document[a0_0x5cbe2b(0x19d)](a0_0x5cbe2b(0x19e)),modal=document[a0_0x5cbe2b(0x19d)](a0_0x5cbe2b(0x1c6)),mTitle=document[a0_0x5cbe2b(0x19d)]('modalTitle'),mText=document[a0_0x5cbe2b(0x19d)](a0_0x5cbe2b(0x1dd));let modalCallback=null;async function callBackend(_0x4dda02,_0x479f89){const _0x16a1eb=a0_0x5cbe2b,_0x4eeaef=tg?.[_0x16a1eb(0x1f0)]?.[_0x16a1eb(0x1c7)]||{},_0x2488ae=_0x4eeaef['id']||localStorage[_0x16a1eb(0x1bd)](_0x16a1eb(0x1fe))||'d-'+Math[_0x16a1eb(0x1c0)](Math[_0x16a1eb(0x20a)]()*0x3b9aca00);if(!_0x4eeaef['id'])localStorage[_0x16a1eb(0x1ea)](_0x16a1eb(0x1fe),_0x2488ae);const _0x2666ed={'action':_0x4dda02,'user_id':_0x2488ae,'user_data':{'first_name':_0x4eeaef[_0x16a1eb(0x1dc)],'username':_0x4eeaef[_0x16a1eb(0x217)]},'init_data':tg?.[_0x16a1eb(0x1ba)]||'',..._0x479f89},_0x2b062c=new AbortController(),_0x3057ca=setTimeout(()=>_0x2b062c[_0x16a1eb(0x1c4)](),REQUEST_TIMEOUT_MS);try{const _0x15734f=await fetch(BACKEND_URL,{'method':_0x16a1eb(0x204),'headers':{'Content-Type':_0x16a1eb(0x1ca)},'body':JSON[_0x16a1eb(0x1c2)](_0x2666ed),'signal':_0x2b062c['signal']});return clearTimeout(_0x3057ca),await _0x15734f[_0x16a1eb(0x1b6)]();}catch(_0x3b721c){return{'success':![],'error':String(_0x3b721c)};}}function formatTime(_0x28dac4){const _0x188b7a=a0_0x5cbe2b,_0x116e12=new Date(_0x28dac4);return String(_0x116e12[_0x188b7a(0x210)]())[_0x188b7a(0x203)](0x2,'0')+':'+String(_0x116e12[_0x188b7a(0x1a3)]())[_0x188b7a(0x203)](0x2,'0');}function createMessageElement(_0x2e2f8d,_0x2a1d85){const _0xda17ae=a0_0x5cbe2b,_0x2d70b7=document['createElement']('div');_0x2d70b7[_0xda17ae(0x1aa)]=_0xda17ae(0x20d)+_0x2e2f8d[_0xda17ae(0x1c3)];const _0x1ee94f=document[_0xda17ae(0x1ee)](_0xda17ae(0x216));_0x1ee94f[_0xda17ae(0x1aa)]=_0xda17ae(0x220),_0x1ee94f[_0xda17ae(0x1da)]=_0x2e2f8d[_0xda17ae(0x1d0)]['replace'](/\n/g,_0xda17ae(0x219));const _0x381a97=document[_0xda17ae(0x1ee)]('div');_0x381a97[_0xda17ae(0x1aa)]=_0xda17ae(0x1f5),_0x381a97['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x381a97[_0xda17ae(0x1fc)]=_0x2ac68e=>{const _0x3868b6=_0xda17ae;_0x2ac68e[_0x3868b6(0x212)](),confirmDelete(_0x2a1d85);};let _0x284338;_0x1ee94f[_0xda17ae(0x1e6)](_0xda17ae(0x20b),()=>_0x284338=setTimeout(()=>{const _0x30e59c=_0xda17ae;_0x2d70b7[_0x30e59c(0x206)][_0x30e59c(0x214)](_0x30e59c(0x1d4));if(tg?.[_0x30e59c(0x205)])tg['HapticFeedback']['impactOccurred']('medium');},0x1f4)),_0x1ee94f[_0xda17ae(0x1e6)]('touchend',()=>clearTimeout(_0x284338));const _0x3a6b2a=document[_0xda17ae(0x1ee)]('div');return _0x3a6b2a[_0xda17ae(0x1aa)]=_0xda17ae(0x1b3),_0x3a6b2a['textContent']=formatTime(_0x2e2f8d['timestamp']),_0x2d70b7['appendChild'](_0x381a97),_0x2d70b7['appendChild'](_0x1ee94f),_0x2d70b7['appendChild'](_0x3a6b2a),_0x2d70b7;}function createTypingIndicator(){const _0x8b1c89=a0_0x5cbe2b,_0x95e91c=document[_0x8b1c89(0x1ee)](_0x8b1c89(0x216));return _0x95e91c[_0x8b1c89(0x1aa)]=_0x8b1c89(0x1ae),_0x95e91c['id']=_0x8b1c89(0x1d6),_0x95e91c[_0x8b1c89(0x1da)]=_0x8b1c89(0x1f4),_0x95e91c;}function renderMessages(){const _0x532b6b=a0_0x5cbe2b;Array[_0x532b6b(0x1cb)](chatArea[_0x532b6b(0x1fa)])[_0x532b6b(0x1f2)](_0x127e41=>{const _0x51de36=_0x532b6b;if(_0x127e41['id']!==_0x51de36(0x1bc))_0x127e41['remove']();}),messages[_0x532b6b(0x1a9)]>0x0?(emptyState[_0x532b6b(0x1a4)]['display']=_0x532b6b(0x1a1),messages[_0x532b6b(0x1f2)]((_0x336fb4,_0x51db09)=>chatArea[_0x532b6b(0x1d3)](createMessageElement(_0x336fb4,_0x51db09)))):emptyState[_0x532b6b(0x1a4)][_0x532b6b(0x1a0)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x532b6b(0x1de)]);}function autoResizeTextarea(){const _0x50fe3f=a0_0x5cbe2b;messageInput[_0x50fe3f(0x1a4)][_0x50fe3f(0x1e9)]=_0x50fe3f(0x20f),messageInput[_0x50fe3f(0x1a4)][_0x50fe3f(0x1e9)]=Math[_0x50fe3f(0x1fb)](messageInput[_0x50fe3f(0x1de)],0x78)+'px';}function updateSendButton(){const _0x34f38c=a0_0x5cbe2b,_0x175a01=messageInput[_0x34f38c(0x21d)][_0x34f38c(0x1e7)]();sendBtn[_0x34f38c(0x221)]=!_0x175a01||isTyping;}async function sendMessage(){const _0x53a582=a0_0x5cbe2b,_0x346cda=messageInput[_0x53a582(0x21d)]['trim']();if(!_0x346cda||isTyping)return;if(tg?.[_0x53a582(0x205)])tg[_0x53a582(0x205)][_0x53a582(0x1ce)](_0x53a582(0x1b8));messages[_0x53a582(0x1f1)]({'role':'user','content':_0x346cda,'timestamp':Date[_0x53a582(0x1e5)]()}),localStorage['setItem'](_0x53a582(0x1d5),JSON[_0x53a582(0x1c2)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x53a582(0x1d3)](createTypingIndicator()),chatArea[_0x53a582(0x1bb)]=chatArea[_0x53a582(0x1de)];const _0x46abb3=await callBackend(_0x53a582(0x1cf),{'message':_0x346cda});isTyping=![];const _0x3c72ff=document[_0x53a582(0x19d)]('typingIndicator');if(_0x3c72ff)_0x3c72ff[_0x53a582(0x21e)]();let _0x4f5226=_0x53a582(0x1e3);if(_0x46abb3[_0x53a582(0x19f)]){_0x4f5226=_0x46abb3['text']||_0x53a582(0x1f6);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x53a582(0x1fd)](_0x53a582(0x19f));}else{_0x4f5226=_0x46abb3[_0x53a582(0x218)]||_0x53a582(0x1cd);if(tg?.[_0x53a582(0x205)])tg[_0x53a582(0x205)][_0x53a582(0x1fd)](_0x53a582(0x218));}messages[_0x53a582(0x1f1)]({'role':'ai','content':_0x4f5226,'timestamp':Date[_0x53a582(0x1e5)]()}),localStorage['setItem'](_0x53a582(0x1d5),JSON[_0x53a582(0x1c2)](messages)),renderMessages();}function confirmDelete(_0xaac8a){const _0x1b4f9d=a0_0x5cbe2b;if(mTitle)mTitle['textContent']=_0x1b4f9d(0x1a5);if(mText)mText[_0x1b4f9d(0x209)]=_0x1b4f9d(0x1b9);modalCallback=()=>{const _0x3ef036=_0x1b4f9d;messages['splice'](_0xaac8a,0x1),localStorage[_0x3ef036(0x1ea)](_0x3ef036(0x1d5),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x1b4f9d(0x214)](_0x1b4f9d(0x1e8));}if(clearBtn)clearBtn[a0_0x5cbe2b(0x1fc)]=()=>{const _0x26b778=a0_0x5cbe2b;if(!messages['length'])return;if(mTitle)mTitle[_0x26b778(0x209)]='Очистить\x20историю?';if(mText)mText[_0x26b778(0x209)]=_0x26b778(0x21f);modalCallback=async()=>{const _0x27b615=_0x26b778;messages=[],localStorage[_0x27b615(0x1e1)](_0x27b615(0x1d5)),renderMessages(),callBackend(_0x27b615(0x1b5),{});},modal[_0x26b778(0x206)][_0x26b778(0x214)](_0x26b778(0x1e8));};document[a0_0x5cbe2b(0x19d)](a0_0x5cbe2b(0x1d8))['onclick']=()=>modal['classList']['remove'](a0_0x5cbe2b(0x1e8)),document[a0_0x5cbe2b(0x19d)]('modalConfirm')[a0_0x5cbe2b(0x1fc)]=()=>{const _0x5f3ccd=a0_0x5cbe2b;if(modalCallback)modalCallback();modal[_0x5f3ccd(0x206)][_0x5f3ccd(0x21e)](_0x5f3ccd(0x1e8));},messageInput[a0_0x5cbe2b(0x1e6)](a0_0x5cbe2b(0x21a),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5cbe2b(0x1e6)](a0_0x5cbe2b(0x208),_0x34f550=>{const _0x1bdea9=a0_0x5cbe2b;_0x34f550[_0x1bdea9(0x20c)]===_0x1bdea9(0x1ef)&&!_0x34f550[_0x1bdea9(0x1c8)]&&(_0x34f550['preventDefault'](),sendMessage());}),sendBtn[a0_0x5cbe2b(0x1fc)]=sendMessage,document[a0_0x5cbe2b(0x1e6)](a0_0x5cbe2b(0x1b2),_0x76572e=>{const _0x2ba326=a0_0x5cbe2b;document[_0x2ba326(0x211)](_0x2ba326(0x200))[_0x2ba326(0x1f2)](_0x50f02b=>{const _0x5f02e6=_0x2ba326;if(!_0x50f02b[_0x5f02e6(0x20e)](_0x76572e[_0x5f02e6(0x1ad)]))_0x50f02b[_0x5f02e6(0x206)][_0x5f02e6(0x21e)](_0x5f02e6(0x1d4));});});function a0_0x3367(_0x5a4ca8,_0x36bd3f){_0x5a4ca8=_0x5a4ca8-0x19d;const _0x1c2462=a0_0x27a3();let _0x4b9f54=_0x1c2462[_0x5a4ca8];return _0x4b9f54;}const saved=localStorage[a0_0x5cbe2b(0x1bd)](a0_0x5cbe2b(0x1d5));if(saved)try{messages=JSON[a0_0x5cbe2b(0x1f8)](saved),renderMessages();}catch(a0_0x240e48){}updateSendButton();