const a0_0x11a916=a0_0x7671;(function(_0x4d5c26,_0x525899){const _0x2551f3=a0_0x7671,_0x196576=_0x4d5c26();while(!![]){try{const _0x1dc20d=parseInt(_0x2551f3(0x1a2))/0x1*(-parseInt(_0x2551f3(0x13b))/0x2)+-parseInt(_0x2551f3(0x191))/0x3+-parseInt(_0x2551f3(0x152))/0x4+parseInt(_0x2551f3(0x178))/0x5*(-parseInt(_0x2551f3(0x13f))/0x6)+parseInt(_0x2551f3(0x153))/0x7*(parseInt(_0x2551f3(0x168))/0x8)+-parseInt(_0x2551f3(0x137))/0x9*(-parseInt(_0x2551f3(0x13d))/0xa)+parseInt(_0x2551f3(0x15f))/0xb*(parseInt(_0x2551f3(0x19d))/0xc);if(_0x1dc20d===_0x525899)break;else _0x196576['push'](_0x196576['shift']());}catch(_0x137588){_0x196576['push'](_0x196576['shift']());}}}(a0_0x2619,0xae63a));const tg=window['Telegram']?.[a0_0x11a916(0x143)],HOME_URL=a0_0x11a916(0x198);function setupTelegramBackButton(){const _0x4cd250=a0_0x11a916;if(!tg)return;try{tg[_0x4cd250(0x189)](),tg[_0x4cd250(0x1b6)](),tg[_0x4cd250(0x182)]?.(_0x4cd250(0x19f));if(tg['isVersionAtLeast']?.('6.1'))tg[_0x4cd250(0x18a)]?.();const _0x459684=tg['BackButton'];if(_0x459684){_0x459684[_0x4cd250(0x1ae)]();if(typeof _0x459684[_0x4cd250(0x1a6)]===_0x4cd250(0x188))try{_0x459684[_0x4cd250(0x1a6)]();}catch(_0x11a599){}_0x459684[_0x4cd250(0x199)](()=>{const _0x4cf966=_0x4cd250;if(tg[_0x4cf966(0x1b4)])tg[_0x4cf966(0x1b4)][_0x4cf966(0x14f)](_0x4cf966(0x158));location[_0x4cf966(0x16c)]=HOME_URL;});}}catch(_0x144d54){console['warn'](_0x4cd250(0x180),_0x144d54);}}(function initStableLayout(){const _0x1f80e3=a0_0x11a916,_0x300bcf=(function(){let _0x2ff9b1=!![];return function(_0x38077b,_0x2479c7){const _0x20a8e8=_0x2ff9b1?function(){const _0x32889f=a0_0x7671;if(_0x2479c7){const _0x4b8325=_0x2479c7[_0x32889f(0x162)](_0x38077b,arguments);return _0x2479c7=null,_0x4b8325;}}:function(){};return _0x2ff9b1=![],_0x20a8e8;};}()),_0x5ec0fd=document[_0x1f80e3(0x15d)](_0x1f80e3(0x18b)),_0x109228=document['getElementById'](_0x1f80e3(0x1a0)),_0x226668=document[_0x1f80e3(0x161)](_0x1f80e3(0x16f)),_0x1318e6=document['getElementById'](_0x1f80e3(0x173));function _0x346156(){const _0x4d021e=_0x1f80e3,_0x351d4a=_0x300bcf(this,function(){const _0x59352e=a0_0x7671;return _0x351d4a['toString']()['search'](_0x59352e(0x138))[_0x59352e(0x17f)]()[_0x59352e(0x18c)](_0x351d4a)['search'](_0x59352e(0x138));});_0x351d4a();if(!_0x5ec0fd)return;const _0x1af54b=tg&&tg['viewportHeight']?tg['viewportHeight']:window['innerHeight'];_0x5ec0fd['style'][_0x4d021e(0x18f)]=_0x1af54b+'px';if(_0x109228){const _0x46c2d3=_0x109228[_0x4d021e(0x15b)];_0x226668[_0x4d021e(0x1af)][_0x4d021e(0x192)]=_0x46c2d3+0x28+'px';}}tg?tg[_0x1f80e3(0x196)](_0x1f80e3(0x16e),({isStateStable:_0x16cf34})=>{_0x346156();if(_0x16cf34)requestAnimationFrame(()=>{const _0x54162c=a0_0x7671;_0x226668[_0x54162c(0x185)]=_0x226668[_0x54162c(0x181)];});}):window[_0x1f80e3(0x190)]('resize',_0x346156),_0x346156(),_0x1318e6&&(_0x1318e6[_0x1f80e3(0x190)]('input',()=>{requestAnimationFrame(_0x346156);}),_0x1318e6[_0x1f80e3(0x190)](_0x1f80e3(0x19c),()=>{setTimeout(()=>{const _0x1c22ea=a0_0x7671;_0x226668[_0x1c22ea(0x185)]=_0x226668[_0x1c22ea(0x181)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x11a916(0x1ab),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x11a916(0x161)](a0_0x11a916(0x16f)),emptyState=document[a0_0x11a916(0x161)](a0_0x11a916(0x167)),messageInput=document[a0_0x11a916(0x161)](a0_0x11a916(0x173)),sendBtn=document[a0_0x11a916(0x161)](a0_0x11a916(0x1a5)),clearBtn=document['getElementById'](a0_0x11a916(0x183)),modal=document['getElementById'](a0_0x11a916(0x151)),mTitle=document[a0_0x11a916(0x161)](a0_0x11a916(0x146)),mText=document[a0_0x11a916(0x161)](a0_0x11a916(0x197));let modalCallback=null;async function callBackend(_0x212e8d,_0x4f1aab){const _0x49c576=a0_0x11a916,_0xf52a13=tg?.[_0x49c576(0x15c)]?.[_0x49c576(0x147)]||{},_0x2fed3e=_0xf52a13['id']||localStorage[_0x49c576(0x139)](_0x49c576(0x163))||'d-'+Math[_0x49c576(0x171)](Math['random']()*0x3b9aca00);if(!_0xf52a13['id'])localStorage[_0x49c576(0x1a1)]('debug_uid',_0x2fed3e);const _0x104077={'action':_0x212e8d,'user_id':_0x2fed3e,'user_data':{'first_name':_0xf52a13[_0x49c576(0x150)],'username':_0xf52a13['username']},'init_data':tg?.[_0x49c576(0x19a)]||'',..._0x4f1aab},_0x21f40c=new AbortController(),_0x568735=setTimeout(()=>_0x21f40c[_0x49c576(0x165)](),REQUEST_TIMEOUT_MS);try{const _0x2b8edf=await fetch(BACKEND_URL,{'method':_0x49c576(0x17a),'headers':{'Content-Type':_0x49c576(0x179)},'body':JSON[_0x49c576(0x184)](_0x104077),'signal':_0x21f40c[_0x49c576(0x19e)]});return clearTimeout(_0x568735),await _0x2b8edf[_0x49c576(0x17b)]();}catch(_0x18fa9a){return{'success':![],'error':String(_0x18fa9a)};}}function formatTime(_0xba73a9){const _0x40b5da=a0_0x11a916,_0x28b628=new Date(_0xba73a9);return String(_0x28b628[_0x40b5da(0x141)]())[_0x40b5da(0x17e)](0x2,'0')+':'+String(_0x28b628[_0x40b5da(0x169)]())['padStart'](0x2,'0');}function createMessageElement(_0x363f81,_0x1b297a){const _0x49f73c=a0_0x11a916,_0x291623=document['createElement']('div');_0x291623[_0x49f73c(0x164)]=_0x49f73c(0x17c)+_0x363f81['role'];const _0x5c06c7=document['createElement'](_0x49f73c(0x142));_0x5c06c7[_0x49f73c(0x164)]='message-bubble',_0x5c06c7[_0x49f73c(0x13e)]=_0x363f81[_0x49f73c(0x16a)][_0x49f73c(0x170)](/\n/g,'<br>');const _0x1fb281=document['createElement'](_0x49f73c(0x142));_0x1fb281['className']='delete-btn',_0x1fb281[_0x49f73c(0x13e)]=_0x49f73c(0x18d),_0x1fb281[_0x49f73c(0x15e)]=_0x202e1c=>{const _0x5a093b=_0x49f73c;_0x202e1c[_0x5a093b(0x1a7)](),confirmDelete(_0x1b297a);};let _0x24dd61;_0x5c06c7[_0x49f73c(0x190)](_0x49f73c(0x14e),()=>_0x24dd61=setTimeout(()=>{const _0x3739f4=_0x49f73c;_0x291623[_0x3739f4(0x1ad)][_0x3739f4(0x177)](_0x3739f4(0x1b1));if(tg?.[_0x3739f4(0x1b4)])tg['HapticFeedback'][_0x3739f4(0x14f)](_0x3739f4(0x156));},0x1f4)),_0x5c06c7[_0x49f73c(0x190)](_0x49f73c(0x1a9),()=>clearTimeout(_0x24dd61));const _0x22bc3e=document[_0x49f73c(0x1a3)]('div');return _0x22bc3e[_0x49f73c(0x164)]='message-time',_0x22bc3e['textContent']=formatTime(_0x363f81[_0x49f73c(0x157)]),_0x291623[_0x49f73c(0x148)](_0x1fb281),_0x291623['appendChild'](_0x5c06c7),_0x291623['appendChild'](_0x22bc3e),_0x291623;}function createTypingIndicator(){const _0x252cf7=a0_0x11a916,_0x13f53f=document[_0x252cf7(0x1a3)](_0x252cf7(0x142));return _0x13f53f[_0x252cf7(0x164)]=_0x252cf7(0x195),_0x13f53f['id']=_0x252cf7(0x1a8),_0x13f53f[_0x252cf7(0x13e)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x13f53f;}function renderMessages(){const _0x2d6838=a0_0x11a916;Array[_0x2d6838(0x145)](chatArea[_0x2d6838(0x159)])[_0x2d6838(0x16b)](_0x206e17=>{const _0x3f682c=_0x2d6838;if(_0x206e17['id']!==_0x3f682c(0x167))_0x206e17[_0x3f682c(0x1b2)]();}),messages[_0x2d6838(0x13c)]>0x0?(emptyState[_0x2d6838(0x1af)][_0x2d6838(0x13a)]=_0x2d6838(0x176),messages['forEach']((_0x1b2952,_0x3df96c)=>chatArea[_0x2d6838(0x148)](createMessageElement(_0x1b2952,_0x3df96c)))):emptyState[_0x2d6838(0x1af)]['display']=_0x2d6838(0x187),requestAnimationFrame(()=>chatArea[_0x2d6838(0x185)]=chatArea['scrollHeight']);}function a0_0x2619(){const _0x1832e0=['1815961xQZcyH','Начнется\x20новый\x20диалог.','value','medium','timestamp','light','children','textContent','offsetHeight','initDataUnsafe','querySelector','onclick','8488007bFBQVV','Ошибка\x20сервера','getElementById','apply','debug_uid','className','abort','ai_chat_messages','emptyState','32isgFtL','getMinutes','content','forEach','href','modalConfirm','viewportChanged','chatArea','replace','floor','send_message','messageInput','notificationOccurred','querySelectorAll','none','add','284110RzoVbZ','text/plain','POST','json','message\x20','target','padStart','toString','TG\x20setup\x20error:','scrollHeight','setHeaderColor','clearBtn','stringify','scrollTop','splice','flex','function','ready','disableVerticalSwipes','.container','constructor','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','push','height','addEventListener','826689CJVmqt','paddingBottom','Enter','disabled','message\x20ai','onEvent','modalText','./router.html','onClick','initData','trim','focus','24CPNNKg','signal','#050505','inputArea','setItem','4CnMOwP','createElement','Ошибка\x20сети','sendBtn','offClick','stopPropagation','typingIndicator','touchend','Действие\x20необратимо.','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Пустой\x20ответ','classList','show','style','error','show-delete','remove','now','HapticFeedback','min','expand','text','auto','success','549sjbwPi','(((.+)+)+)+$','getItem','display','511298wuabad','length','67030ByXSCl','innerHTML','24YbRAKG','Удалить?','getHours','div','WebApp','.message.show-delete','from','modalTitle','user','appendChild','preventDefault','clear_history','Очистить\x20историю?','contains','key','touchstart','impactOccurred','first_name','confirmModal','3000416DPuvYJ'];a0_0x2619=function(){return _0x1832e0;};return a0_0x2619();}function autoResizeTextarea(){const _0x554122=a0_0x11a916;messageInput[_0x554122(0x1af)][_0x554122(0x18f)]=_0x554122(0x135),messageInput[_0x554122(0x1af)]['height']=Math[_0x554122(0x1b5)](messageInput[_0x554122(0x181)],0x78)+'px';}function updateSendButton(){const _0x4e1cb3=a0_0x11a916,_0x111dda=messageInput[_0x4e1cb3(0x155)]['trim']();sendBtn[_0x4e1cb3(0x194)]=!_0x111dda||isTyping;}function a0_0x7671(_0x2a88ea,_0x36ffca){_0x2a88ea=_0x2a88ea-0x135;const _0x259ce8=a0_0x2619();let _0x4fef4d=_0x259ce8[_0x2a88ea];return _0x4fef4d;}async function sendMessage(){const _0x3d7fee=a0_0x11a916,_0x3c276f=messageInput['value'][_0x3d7fee(0x19b)]();if(!_0x3c276f||isTyping)return;if(tg?.[_0x3d7fee(0x1b4)])tg[_0x3d7fee(0x1b4)][_0x3d7fee(0x14f)](_0x3d7fee(0x158));messages['push']({'role':_0x3d7fee(0x147),'content':_0x3c276f,'timestamp':Date[_0x3d7fee(0x1b3)]()}),localStorage[_0x3d7fee(0x1a1)](_0x3d7fee(0x166),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x3d7fee(0x148)](createTypingIndicator()),chatArea[_0x3d7fee(0x185)]=chatArea[_0x3d7fee(0x181)];const _0x20e1ab=await callBackend(_0x3d7fee(0x172),{'message':_0x3c276f});isTyping=![];const _0x17bb52=document['getElementById'](_0x3d7fee(0x1a8));if(_0x17bb52)_0x17bb52['remove']();let _0x1cef31=_0x3d7fee(0x1a4);if(_0x20e1ab[_0x3d7fee(0x136)]){_0x1cef31=_0x20e1ab[_0x3d7fee(0x1b7)]||_0x3d7fee(0x1ac);if(tg?.[_0x3d7fee(0x1b4)])tg['HapticFeedback'][_0x3d7fee(0x174)]('success');}else{_0x1cef31=_0x20e1ab[_0x3d7fee(0x1b0)]||_0x3d7fee(0x160);if(tg?.[_0x3d7fee(0x1b4)])tg['HapticFeedback'][_0x3d7fee(0x174)](_0x3d7fee(0x1b0));}messages[_0x3d7fee(0x18e)]({'role':'ai','content':_0x1cef31,'timestamp':Date[_0x3d7fee(0x1b3)]()}),localStorage[_0x3d7fee(0x1a1)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x1fbbc1){const _0x40dece=a0_0x11a916;if(mTitle)mTitle[_0x40dece(0x15a)]=_0x40dece(0x140);if(mText)mText[_0x40dece(0x15a)]=_0x40dece(0x1aa);modalCallback=()=>{const _0x2b6f39=_0x40dece;messages[_0x2b6f39(0x186)](_0x1fbbc1,0x1),localStorage[_0x2b6f39(0x1a1)]('ai_chat_messages',JSON[_0x2b6f39(0x184)](messages)),renderMessages();},modal[_0x40dece(0x1ad)][_0x40dece(0x177)](_0x40dece(0x1ae));}if(clearBtn)clearBtn[a0_0x11a916(0x15e)]=()=>{const _0x3c094d=a0_0x11a916;if(!messages['length'])return;if(mTitle)mTitle[_0x3c094d(0x15a)]=_0x3c094d(0x14b);if(mText)mText['textContent']=_0x3c094d(0x154);modalCallback=async()=>{const _0x3a4b4a=_0x3c094d;messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend(_0x3a4b4a(0x14a),{});},modal[_0x3c094d(0x1ad)][_0x3c094d(0x177)]('show');};document[a0_0x11a916(0x161)]('modalCancel')['onclick']=()=>modal[a0_0x11a916(0x1ad)][a0_0x11a916(0x1b2)]('show'),document['getElementById'](a0_0x11a916(0x16d))[a0_0x11a916(0x15e)]=()=>{const _0x33f46b=a0_0x11a916;if(modalCallback)modalCallback();modal['classList']['remove'](_0x33f46b(0x1ae));},messageInput[a0_0x11a916(0x190)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x56249c=>{const _0x34954b=a0_0x11a916;_0x56249c[_0x34954b(0x14d)]===_0x34954b(0x193)&&!_0x56249c['shiftKey']&&(_0x56249c[_0x34954b(0x149)](),sendMessage());}),sendBtn[a0_0x11a916(0x15e)]=sendMessage,document[a0_0x11a916(0x190)]('click',_0x33e598=>{const _0xd50199=a0_0x11a916;document[_0xd50199(0x175)](_0xd50199(0x144))[_0xd50199(0x16b)](_0x3d7cd2=>{const _0x3ccb1b=_0xd50199;if(!_0x3d7cd2[_0x3ccb1b(0x14c)](_0x33e598[_0x3ccb1b(0x17d)]))_0x3d7cd2[_0x3ccb1b(0x1ad)]['remove'](_0x3ccb1b(0x1b1));});});const saved=localStorage[a0_0x11a916(0x139)](a0_0x11a916(0x166));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0xa83f83){}updateSendButton();