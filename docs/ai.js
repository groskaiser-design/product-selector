const a0_0x3af149=a0_0x469c;(function(_0x1b8f57,_0x569dd7){const _0x14701c=a0_0x469c,_0x43528a=_0x1b8f57();while(!![]){try{const _0x3b7de6=parseInt(_0x14701c(0x93))/0x1*(parseInt(_0x14701c(0xb3))/0x2)+parseInt(_0x14701c(0x90))/0x3*(-parseInt(_0x14701c(0xac))/0x4)+-parseInt(_0x14701c(0xd1))/0x5*(parseInt(_0x14701c(0xa9))/0x6)+-parseInt(_0x14701c(0x80))/0x7*(parseInt(_0x14701c(0x8a))/0x8)+-parseInt(_0x14701c(0xc8))/0x9+parseInt(_0x14701c(0x94))/0xa*(-parseInt(_0x14701c(0xab))/0xb)+parseInt(_0x14701c(0xea))/0xc*(parseInt(_0x14701c(0xda))/0xd);if(_0x3b7de6===_0x569dd7)break;else _0x43528a['push'](_0x43528a['shift']());}catch(_0x8f8958){_0x43528a['push'](_0x43528a['shift']());}}}(a0_0x2bbb,0xa7634));const tg=window[a0_0x3af149(0xce)]?.[a0_0x3af149(0xe1)],HOME_URL=a0_0x3af149(0x88);function setupTelegramBackButton(){const _0x56ad26=a0_0x3af149,_0x556ad5=(function(){let _0x4e3eb6=!![];return function(_0x26187e,_0x238f8e){const _0x151ac0=_0x4e3eb6?function(){const _0x49e8ba=a0_0x469c;if(_0x238f8e){const _0x513b39=_0x238f8e[_0x49e8ba(0x8d)](_0x26187e,arguments);return _0x238f8e=null,_0x513b39;}}:function(){};return _0x4e3eb6=![],_0x151ac0;};}()),_0x3ec890=_0x556ad5(this,function(){const _0x568663=a0_0x469c;return _0x3ec890[_0x568663(0xd0)]()[_0x568663(0xd6)]('(((.+)+)+)+$')[_0x568663(0xd0)]()[_0x568663(0xcf)](_0x3ec890)['search'](_0x568663(0x82));});_0x3ec890();if(!tg)return;try{tg[_0x56ad26(0x7b)](),tg['expand'](),tg[_0x56ad26(0xa1)]?.(_0x56ad26(0xb9));if(tg['isVersionAtLeast']?.(_0x56ad26(0xde)))tg['disableVerticalSwipes']?.();const _0xcc4754=tg[_0x56ad26(0x73)];if(_0xcc4754){_0xcc4754[_0x56ad26(0x83)]();if(typeof _0xcc4754[_0x56ad26(0x6b)]===_0x56ad26(0xc0))try{_0xcc4754['offClick']();}catch(_0x4c90d8){}_0xcc4754['onClick'](()=>{const _0x3a0e19=_0x56ad26;if(tg[_0x3a0e19(0x76)])tg['HapticFeedback'][_0x3a0e19(0xa4)](_0x3a0e19(0xd4));location[_0x3a0e19(0xe3)]=HOME_URL;});}}catch(_0x107b1b){console[_0x56ad26(0x6d)]('TG\x20setup\x20error:',_0x107b1b);}}(function initStableLayout(){const _0x2aa51d=a0_0x3af149,_0x4789e9=document['querySelector']('.container'),_0x28faf0=document['getElementById'](_0x2aa51d(0x91)),_0x16dfeb=document[_0x2aa51d(0xc7)](_0x2aa51d(0xd9)),_0x319a77=document[_0x2aa51d(0xc7)]('messageInput');function _0x3a2ed3(){const _0x5c2b75=_0x2aa51d;if(!_0x4789e9)return;const _0x2f9a44=tg&&tg[_0x5c2b75(0xb1)]?tg[_0x5c2b75(0xb1)]:window[_0x5c2b75(0x7f)];_0x4789e9[_0x5c2b75(0x8b)][_0x5c2b75(0xb2)]=_0x2f9a44+'px';if(_0x28faf0){const _0x2d67f9=_0x28faf0[_0x5c2b75(0xa3)];_0x16dfeb[_0x5c2b75(0x8b)][_0x5c2b75(0x99)]=_0x2d67f9+0x28+'px';}}tg?tg['onEvent'](_0x2aa51d(0x98),({isStateStable:_0x29b17a})=>{_0x3a2ed3();if(_0x29b17a)requestAnimationFrame(()=>{const _0x158cfa=a0_0x469c;_0x16dfeb[_0x158cfa(0x79)]=_0x16dfeb[_0x158cfa(0x85)];});}):window[_0x2aa51d(0xc6)](_0x2aa51d(0xb4),_0x3a2ed3),_0x3a2ed3(),_0x319a77&&(_0x319a77['addEventListener'](_0x2aa51d(0xba),()=>{requestAnimationFrame(_0x3a2ed3);}),_0x319a77[_0x2aa51d(0xc6)](_0x2aa51d(0x72),()=>{setTimeout(()=>{const _0x16109e=a0_0x469c;_0x16dfeb['scrollTop']=_0x16dfeb[_0x16109e(0x85)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3af149(0xc7)]('chatArea'),emptyState=document[a0_0x3af149(0xc7)](a0_0x3af149(0xca)),messageInput=document[a0_0x3af149(0xc7)]('messageInput'),sendBtn=document[a0_0x3af149(0xc7)](a0_0x3af149(0xa7)),clearBtn=document[a0_0x3af149(0xc7)](a0_0x3af149(0xa2)),modal=document['getElementById'](a0_0x3af149(0xa0)),mTitle=document[a0_0x3af149(0xc7)](a0_0x3af149(0x96)),mText=document[a0_0x3af149(0xc7)](a0_0x3af149(0x6f));let modalCallback=null;async function callBackend(_0x1e2240,_0x4711f2){const _0x25de6c=a0_0x3af149,_0x107cae=tg?.[_0x25de6c(0x84)]?.[_0x25de6c(0xae)]||{},_0x2699f5=_0x107cae['id']||localStorage['getItem'](_0x25de6c(0xa5))||'d-'+Math[_0x25de6c(0x9a)](Math['random']()*0x3b9aca00);if(!_0x107cae['id'])localStorage[_0x25de6c(0xcc)]('debug_uid',_0x2699f5);const _0x394d22={'action':_0x1e2240,'user_id':_0x2699f5,'user_data':{'first_name':_0x107cae[_0x25de6c(0xd2)],'username':_0x107cae['username']},'init_data':tg?.[_0x25de6c(0x92)]||'',..._0x4711f2},_0x191e8e=new AbortController(),_0x1302f4=setTimeout(()=>_0x191e8e[_0x25de6c(0xb7)](),REQUEST_TIMEOUT_MS);try{const _0x35fca7=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x25de6c(0x7c)},'body':JSON[_0x25de6c(0x8f)](_0x394d22),'signal':_0x191e8e[_0x25de6c(0x78)]});return clearTimeout(_0x1302f4),await _0x35fca7[_0x25de6c(0xd8)]();}catch(_0x119657){return{'success':![],'error':String(_0x119657)};}}function formatTime(_0x126043){const _0x4926c3=a0_0x3af149,_0x5c0276=new Date(_0x126043);return String(_0x5c0276[_0x4926c3(0xed)]())[_0x4926c3(0x6e)](0x2,'0')+':'+String(_0x5c0276[_0x4926c3(0x6a)]())[_0x4926c3(0x6e)](0x2,'0');}function a0_0x469c(_0x39b5fa,_0x219002){_0x39b5fa=_0x39b5fa-0x6a;const _0x30976e=a0_0x2bbb();let _0x2badd9=_0x30976e[_0x39b5fa];return _0x2badd9;}function createMessageElement(_0x27d853,_0x26855c){const _0x2c1ddd=a0_0x3af149,_0x58edb8=document['createElement']('div');_0x58edb8['className']='message\x20'+_0x27d853[_0x2c1ddd(0x9c)];const _0x25056d=document[_0x2c1ddd(0xdb)]('div');_0x25056d[_0x2c1ddd(0xe8)]=_0x2c1ddd(0xe0),_0x25056d[_0x2c1ddd(0xbb)]=_0x27d853[_0x2c1ddd(0xbd)][_0x2c1ddd(0xcd)](/\n/g,_0x2c1ddd(0xb8));const _0x218a7f=document[_0x2c1ddd(0xdb)](_0x2c1ddd(0x7a));_0x218a7f['className']=_0x2c1ddd(0x81),_0x218a7f[_0x2c1ddd(0xbb)]=_0x2c1ddd(0x9b),_0x218a7f['onclick']=_0x16e738=>{_0x16e738['stopPropagation'](),confirmDelete(_0x26855c);};let _0x261b91;_0x25056d[_0x2c1ddd(0xc6)](_0x2c1ddd(0xa6),()=>_0x261b91=setTimeout(()=>{const _0x435289=_0x2c1ddd;_0x58edb8[_0x435289(0x8c)][_0x435289(0x74)](_0x435289(0xbf));if(tg?.[_0x435289(0x76)])tg['HapticFeedback']['impactOccurred'](_0x435289(0xa8));},0x1f4)),_0x25056d[_0x2c1ddd(0xc6)](_0x2c1ddd(0xdd),()=>clearTimeout(_0x261b91));const _0x5b26b8=document['createElement'](_0x2c1ddd(0x7a));return _0x5b26b8['className']=_0x2c1ddd(0xdc),_0x5b26b8[_0x2c1ddd(0xaf)]=formatTime(_0x27d853[_0x2c1ddd(0xe2)]),_0x58edb8['appendChild'](_0x218a7f),_0x58edb8[_0x2c1ddd(0xe9)](_0x25056d),_0x58edb8[_0x2c1ddd(0xe9)](_0x5b26b8),_0x58edb8;}function a0_0x2bbb(){const _0x51076d=['message\x20ai','min','display','ai_chat_messages','className','appendChild','12ynicQk','shiftKey','value','getHours','getMinutes','offClick','Удалить?','warn','padStart','modalText','forEach','Ошибка\x20сервера','focus','BackButton','add','now','HapticFeedback','remove','signal','scrollTop','div','ready','text/plain','text','flex','innerHeight','63ONhaPX','delete-btn','(((.+)+)+)+$','show','initDataUnsafe','scrollHeight','notificationOccurred','contains','./router.html','querySelectorAll','1111784PGFHTl','style','classList','apply','disabled','stringify','13242oyrxsi','inputArea','initData','671983fmlTQt','71190uNKFws','modalCancel','modalTitle','success','viewportChanged','paddingBottom','floor','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','role','click','Начнется\x20новый\x20диалог.','splice','confirmModal','setHeaderColor','clearBtn','offsetHeight','impactOccurred','debug_uid','touchstart','sendBtn','medium','3478998LRwpRm','trim','781nLKDYK','924OdxfgP','length','user','textContent','keydown','viewportHeight','height','2ImdlYJ','resize','onclick','children','abort','<br>','#050505','input','innerHTML','auto','content','preventDefault','show-delete','function','Пустой\x20ответ','from','send_message','none','typingIndicator','addEventListener','getElementById','9961992IIQJGE','modalConfirm','emptyState','.message.show-delete','setItem','replace','Telegram','constructor','toString','10EVBKEg','first_name','error','light','getItem','search','target','json','chatArea','65728403wBIfpe','createElement','message-time','touchend','6.1','key','message-bubble','WebApp','timestamp','href'];a0_0x2bbb=function(){return _0x51076d;};return a0_0x2bbb();}function createTypingIndicator(){const _0x922cdd=a0_0x3af149,_0x5ab266=document[_0x922cdd(0xdb)]('div');return _0x5ab266[_0x922cdd(0xe8)]=_0x922cdd(0xe4),_0x5ab266['id']=_0x922cdd(0xc5),_0x5ab266[_0x922cdd(0xbb)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x5ab266;}function renderMessages(){const _0x3775c1=a0_0x3af149;Array[_0x3775c1(0xc2)](chatArea[_0x3775c1(0xb6)])[_0x3775c1(0x70)](_0x1c9b55=>{const _0x2a5ca9=_0x3775c1;if(_0x1c9b55['id']!==_0x2a5ca9(0xca))_0x1c9b55[_0x2a5ca9(0x77)]();}),messages[_0x3775c1(0xad)]>0x0?(emptyState[_0x3775c1(0x8b)][_0x3775c1(0xe6)]=_0x3775c1(0xc4),messages[_0x3775c1(0x70)]((_0x380e82,_0x1aa993)=>chatArea['appendChild'](createMessageElement(_0x380e82,_0x1aa993)))):emptyState[_0x3775c1(0x8b)][_0x3775c1(0xe6)]=_0x3775c1(0x7e),requestAnimationFrame(()=>chatArea[_0x3775c1(0x79)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x18f66d=a0_0x3af149;messageInput[_0x18f66d(0x8b)]['height']=_0x18f66d(0xbc),messageInput[_0x18f66d(0x8b)]['height']=Math[_0x18f66d(0xe5)](messageInput[_0x18f66d(0x85)],0x78)+'px';}function updateSendButton(){const _0x3120f6=a0_0x3af149,_0xeba990=messageInput[_0x3120f6(0xec)][_0x3120f6(0xaa)]();sendBtn[_0x3120f6(0x8e)]=!_0xeba990||isTyping;}async function sendMessage(){const _0x5cf206=a0_0x3af149,_0x2929aa=messageInput[_0x5cf206(0xec)]['trim']();if(!_0x2929aa||isTyping)return;if(tg?.[_0x5cf206(0x76)])tg[_0x5cf206(0x76)][_0x5cf206(0xa4)](_0x5cf206(0xd4));messages['push']({'role':_0x5cf206(0xae),'content':_0x2929aa,'timestamp':Date[_0x5cf206(0x75)]()}),localStorage[_0x5cf206(0xcc)](_0x5cf206(0xe7),JSON[_0x5cf206(0x8f)](messages)),renderMessages(),messageInput[_0x5cf206(0xec)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x5cf206(0x79)]=chatArea[_0x5cf206(0x85)];const _0x3144aa=await callBackend(_0x5cf206(0xc3),{'message':_0x2929aa});isTyping=![];const _0x53572e=document[_0x5cf206(0xc7)]('typingIndicator');if(_0x53572e)_0x53572e[_0x5cf206(0x77)]();let _0x37a433='Ошибка\x20сети';if(_0x3144aa['success']){_0x37a433=_0x3144aa[_0x5cf206(0x7d)]||_0x5cf206(0xc1);if(tg?.[_0x5cf206(0x76)])tg[_0x5cf206(0x76)][_0x5cf206(0x86)](_0x5cf206(0x97));}else{_0x37a433=_0x3144aa[_0x5cf206(0xd3)]||_0x5cf206(0x71);if(tg?.[_0x5cf206(0x76)])tg[_0x5cf206(0x76)][_0x5cf206(0x86)]('error');}messages['push']({'role':'ai','content':_0x37a433,'timestamp':Date[_0x5cf206(0x75)]()}),localStorage[_0x5cf206(0xcc)](_0x5cf206(0xe7),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x3a9029){const _0x2a66bb=a0_0x3af149;if(mTitle)mTitle[_0x2a66bb(0xaf)]=_0x2a66bb(0x6c);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x4ca13b=_0x2a66bb;messages[_0x4ca13b(0x9f)](_0x3a9029,0x1),localStorage[_0x4ca13b(0xcc)]('ai_chat_messages',JSON[_0x4ca13b(0x8f)](messages)),renderMessages();},modal[_0x2a66bb(0x8c)]['add'](_0x2a66bb(0x83));}if(clearBtn)clearBtn[a0_0x3af149(0xb5)]=()=>{const _0x51edf0=a0_0x3af149;if(!messages[_0x51edf0(0xad)])return;if(mTitle)mTitle[_0x51edf0(0xaf)]='Очистить\x20историю?';if(mText)mText[_0x51edf0(0xaf)]=_0x51edf0(0x9e);modalCallback=async()=>{const _0x396721=_0x51edf0;messages=[],localStorage['removeItem'](_0x396721(0xe7)),renderMessages(),callBackend('clear_history',{});},modal['classList']['add'](_0x51edf0(0x83));};document[a0_0x3af149(0xc7)](a0_0x3af149(0x95))[a0_0x3af149(0xb5)]=()=>modal[a0_0x3af149(0x8c)][a0_0x3af149(0x77)]('show'),document['getElementById'](a0_0x3af149(0xc9))[a0_0x3af149(0xb5)]=()=>{const _0x463237=a0_0x3af149;if(modalCallback)modalCallback();modal[_0x463237(0x8c)]['remove'](_0x463237(0x83));},messageInput['addEventListener'](a0_0x3af149(0xba),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3af149(0xc6)](a0_0x3af149(0xb0),_0x14185b=>{const _0x2acf22=a0_0x3af149;_0x14185b[_0x2acf22(0xdf)]==='Enter'&&!_0x14185b[_0x2acf22(0xeb)]&&(_0x14185b[_0x2acf22(0xbe)](),sendMessage());}),sendBtn[a0_0x3af149(0xb5)]=sendMessage,document['addEventListener'](a0_0x3af149(0x9d),_0x40a1e7=>{const _0x280ebe=a0_0x3af149;document[_0x280ebe(0x89)](_0x280ebe(0xcb))[_0x280ebe(0x70)](_0x551b08=>{const _0x363143=_0x280ebe;if(!_0x551b08[_0x363143(0x87)](_0x40a1e7[_0x363143(0xd7)]))_0x551b08[_0x363143(0x8c)][_0x363143(0x77)]('show-delete');});});const saved=localStorage[a0_0x3af149(0xd5)](a0_0x3af149(0xe7));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x704282){}updateSendButton();