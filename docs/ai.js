const a0_0x3993a6=a0_0x68f5;(function(_0x1cb1e8,_0x553c12){const _0x56d135=a0_0x68f5,_0x172f5a=_0x1cb1e8();while(!![]){try{const _0x34d09e=parseInt(_0x56d135(0x1e8))/0x1*(-parseInt(_0x56d135(0x23b))/0x2)+parseInt(_0x56d135(0x236))/0x3*(-parseInt(_0x56d135(0x217))/0x4)+parseInt(_0x56d135(0x230))/0x5*(parseInt(_0x56d135(0x1d0))/0x6)+parseInt(_0x56d135(0x1fb))/0x7+-parseInt(_0x56d135(0x203))/0x8+-parseInt(_0x56d135(0x1c2))/0x9*(-parseInt(_0x56d135(0x1f5))/0xa)+-parseInt(_0x56d135(0x1c8))/0xb*(-parseInt(_0x56d135(0x1e9))/0xc);if(_0x34d09e===_0x553c12)break;else _0x172f5a['push'](_0x172f5a['shift']());}catch(_0x20b598){_0x172f5a['push'](_0x172f5a['shift']());}}}(a0_0x1a35,0xed0b2));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x3993a6(0x212);function setupTelegramBackButton(){const _0x1125d3=a0_0x3993a6,_0x392fad=(function(){let _0xa60918=!![];return function(_0x32e4d4,_0x7195a){const _0x483f5d=_0xa60918?function(){const _0xde7f3d=a0_0x68f5;if(_0x7195a){const _0x25f24b=_0x7195a[_0xde7f3d(0x1db)](_0x32e4d4,arguments);return _0x7195a=null,_0x25f24b;}}:function(){};return _0xa60918=![],_0x483f5d;};}()),_0x451623=_0x392fad(this,function(){const _0x264478=a0_0x68f5;return _0x451623[_0x264478(0x1ed)]()[_0x264478(0x1c5)]('(((.+)+)+)+$')[_0x264478(0x1ed)]()[_0x264478(0x20b)](_0x451623)[_0x264478(0x1c5)]('(((.+)+)+)+$');});_0x451623();if(!tg)return;try{tg['ready'](),tg[_0x1125d3(0x1ee)](),tg[_0x1125d3(0x1ef)]?.(_0x1125d3(0x1c3));if(tg[_0x1125d3(0x225)]?.('6.1'))tg[_0x1125d3(0x1c0)]?.();const _0x1c66a8=tg[_0x1125d3(0x1d6)];if(_0x1c66a8){_0x1c66a8[_0x1125d3(0x1f7)]();if(typeof _0x1c66a8[_0x1125d3(0x1d1)]===_0x1125d3(0x1cf))try{_0x1c66a8[_0x1125d3(0x1d1)]();}catch(_0x38f207){}_0x1c66a8[_0x1125d3(0x1f8)](()=>{const _0xd37d36=_0x1125d3;if(tg['HapticFeedback'])tg[_0xd37d36(0x21c)][_0xd37d36(0x20f)](_0xd37d36(0x1ea));location[_0xd37d36(0x1f3)]=HOME_URL;});}}catch(_0x56bbd7){console[_0x1125d3(0x1fc)](_0x1125d3(0x22f),_0x56bbd7);}}(function initStableLayout(){const _0x5bb27d=a0_0x3993a6,_0x24cc6a=document[_0x5bb27d(0x211)](_0x5bb27d(0x1e7)),_0x18343b=document[_0x5bb27d(0x23e)](_0x5bb27d(0x1d8)),_0x43afd1=document[_0x5bb27d(0x23e)]('chatArea'),_0xc61911=document[_0x5bb27d(0x23e)]('messageInput');function _0x3188c3(){const _0x29269f=_0x5bb27d;if(!_0x24cc6a)return;const _0x923223=tg&&tg[_0x29269f(0x1d2)]?tg[_0x29269f(0x1d2)]:window[_0x29269f(0x1fe)];_0x24cc6a['style'][_0x29269f(0x1f6)]=_0x923223+'px';if(_0x18343b){const _0xcbbc9b=_0x18343b[_0x29269f(0x1cd)];_0x43afd1['style'][_0x29269f(0x1d9)]=_0xcbbc9b+0x28+'px';}}tg?tg[_0x5bb27d(0x1f4)]('viewportChanged',({isStateStable:_0x3100b7})=>{_0x3188c3();if(_0x3100b7)requestAnimationFrame(()=>{const _0x4f0062=a0_0x68f5;_0x43afd1[_0x4f0062(0x1e6)]=_0x43afd1[_0x4f0062(0x1c9)];});}):window['addEventListener'](_0x5bb27d(0x219),_0x3188c3),_0x3188c3(),_0xc61911&&(_0xc61911[_0x5bb27d(0x22e)]('input',()=>{requestAnimationFrame(_0x3188c3);}),_0xc61911[_0x5bb27d(0x22e)](_0x5bb27d(0x238),()=>{setTimeout(()=>{const _0x50949f=a0_0x68f5;_0x43afd1['scrollTop']=_0x43afd1[_0x50949f(0x1c9)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3993a6(0x23e)](a0_0x3993a6(0x204)),emptyState=document[a0_0x3993a6(0x23e)](a0_0x3993a6(0x218)),messageInput=document[a0_0x3993a6(0x23e)](a0_0x3993a6(0x1cb)),sendBtn=document['getElementById'](a0_0x3993a6(0x20e)),clearBtn=document[a0_0x3993a6(0x23e)](a0_0x3993a6(0x21a)),modal=document['getElementById'](a0_0x3993a6(0x22d)),mTitle=document[a0_0x3993a6(0x23e)](a0_0x3993a6(0x1c7)),mText=document[a0_0x3993a6(0x23e)](a0_0x3993a6(0x22a));let modalCallback=null;async function callBackend(_0x43278c,_0x56868f){const _0xeeb566=a0_0x3993a6,_0x25c558=tg?.[_0xeeb566(0x229)]?.['user']||{},_0x5316c5=_0x25c558['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0xeeb566(0x1e5)](Math['random']()*0x3b9aca00);if(!_0x25c558['id'])localStorage['setItem'](_0xeeb566(0x1ff),_0x5316c5);const _0x5dcbf3={'action':_0x43278c,'user_id':_0x5316c5,'user_data':{'first_name':_0x25c558[_0xeeb566(0x1ce)],'username':_0x25c558['username']},'init_data':tg?.['initData']||'',..._0x56868f},_0x3839e0=new AbortController(),_0x165b40=setTimeout(()=>_0x3839e0[_0xeeb566(0x1f9)](),REQUEST_TIMEOUT_MS);try{const _0x2bc61d=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0xeeb566(0x215)](_0x5dcbf3),'signal':_0x3839e0[_0xeeb566(0x1ca)]});return clearTimeout(_0x165b40),await _0x2bc61d[_0xeeb566(0x216)]();}catch(_0x33c207){return{'success':![],'error':String(_0x33c207)};}}function formatTime(_0x595236){const _0x5468e3=a0_0x3993a6,_0x9f1283=new Date(_0x595236);return String(_0x9f1283[_0x5468e3(0x20d)]())[_0x5468e3(0x1d7)](0x2,'0')+':'+String(_0x9f1283[_0x5468e3(0x1d5)]())[_0x5468e3(0x1d7)](0x2,'0');}function createMessageElement(_0x5b06a7,_0x3c30d8){const _0xbd2a6c=a0_0x3993a6,_0x28a378=document['createElement'](_0xbd2a6c(0x205));_0x28a378[_0xbd2a6c(0x207)]=_0xbd2a6c(0x239)+_0x5b06a7[_0xbd2a6c(0x21f)];const _0x5e8cdc=document[_0xbd2a6c(0x210)](_0xbd2a6c(0x205));_0x5e8cdc[_0xbd2a6c(0x207)]=_0xbd2a6c(0x1fa),_0x5e8cdc[_0xbd2a6c(0x213)]=_0x5b06a7[_0xbd2a6c(0x23c)][_0xbd2a6c(0x208)](/\n/g,_0xbd2a6c(0x1e0));const _0x2a1d5a=document['createElement'](_0xbd2a6c(0x205));_0x2a1d5a[_0xbd2a6c(0x207)]=_0xbd2a6c(0x200),_0x2a1d5a[_0xbd2a6c(0x213)]=_0xbd2a6c(0x222),_0x2a1d5a['onclick']=_0x4b719f=>{const _0x3fd62f=_0xbd2a6c;_0x4b719f[_0x3fd62f(0x1ec)](),confirmDelete(_0x3c30d8);};let _0x13cc1e;_0x5e8cdc[_0xbd2a6c(0x22e)](_0xbd2a6c(0x1dd),()=>_0x13cc1e=setTimeout(()=>{const _0x1a4d67=_0xbd2a6c;_0x28a378['classList']['add'](_0x1a4d67(0x220));if(tg?.['HapticFeedback'])tg[_0x1a4d67(0x21c)][_0x1a4d67(0x20f)]('medium');},0x1f4)),_0x5e8cdc['addEventListener']('touchend',()=>clearTimeout(_0x13cc1e));const _0x8d2c03=document['createElement']('div');return _0x8d2c03[_0xbd2a6c(0x207)]=_0xbd2a6c(0x1df),_0x8d2c03[_0xbd2a6c(0x237)]=formatTime(_0x5b06a7['timestamp']),_0x28a378['appendChild'](_0x2a1d5a),_0x28a378[_0xbd2a6c(0x22b)](_0x5e8cdc),_0x28a378['appendChild'](_0x8d2c03),_0x28a378;}function createTypingIndicator(){const _0x3e6056=a0_0x3993a6,_0x37db35=document[_0x3e6056(0x210)](_0x3e6056(0x205));return _0x37db35[_0x3e6056(0x207)]=_0x3e6056(0x1e3),_0x37db35['id']=_0x3e6056(0x1e1),_0x37db35[_0x3e6056(0x213)]=_0x3e6056(0x23a),_0x37db35;}function renderMessages(){const _0x578f24=a0_0x3993a6;Array['from'](chatArea[_0x578f24(0x202)])[_0x578f24(0x232)](_0x9f0dfe=>{const _0x58601a=_0x578f24;if(_0x9f0dfe['id']!==_0x58601a(0x218))_0x9f0dfe[_0x58601a(0x235)]();}),messages['length']>0x0?(emptyState[_0x578f24(0x1d3)][_0x578f24(0x209)]=_0x578f24(0x20c),messages[_0x578f24(0x232)]((_0x42658f,_0x30b381)=>chatArea[_0x578f24(0x22b)](createMessageElement(_0x42658f,_0x30b381)))):emptyState[_0x578f24(0x1d3)]['display']=_0x578f24(0x1f2),requestAnimationFrame(()=>chatArea[_0x578f24(0x1e6)]=chatArea[_0x578f24(0x1c9)]);}function autoResizeTextarea(){const _0x13a7fe=a0_0x3993a6;messageInput[_0x13a7fe(0x1d3)][_0x13a7fe(0x1f6)]=_0x13a7fe(0x214),messageInput[_0x13a7fe(0x1d3)][_0x13a7fe(0x1f6)]=Math[_0x13a7fe(0x1cc)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x2c3a12=a0_0x3993a6,_0x519edc=messageInput['value']['trim']();sendBtn[_0x2c3a12(0x1f0)]=!_0x519edc||isTyping;}async function sendMessage(){const _0x549231=a0_0x3993a6,_0x5b79f5=messageInput[_0x549231(0x21d)]['trim']();if(!_0x5b79f5||isTyping)return;if(tg?.[_0x549231(0x21c)])tg[_0x549231(0x21c)][_0x549231(0x20f)](_0x549231(0x1ea));messages[_0x549231(0x221)]({'role':_0x549231(0x23f),'content':_0x5b79f5,'timestamp':Date[_0x549231(0x201)]()}),localStorage[_0x549231(0x234)](_0x549231(0x1fd),JSON['stringify'](messages)),renderMessages(),messageInput[_0x549231(0x21d)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x549231(0x1e6)]=chatArea[_0x549231(0x1c9)];const _0x559ad2=await callBackend('send_message',{'message':_0x5b79f5});isTyping=![];const _0x3d8fcf=document[_0x549231(0x23e)]('typingIndicator');if(_0x3d8fcf)_0x3d8fcf['remove']();let _0x45d51a=_0x549231(0x226);if(_0x559ad2[_0x549231(0x223)]){_0x45d51a=_0x559ad2[_0x549231(0x1dc)]||_0x549231(0x1c6);if(tg?.[_0x549231(0x21c)])tg[_0x549231(0x21c)][_0x549231(0x1eb)]('success');}else{_0x45d51a=_0x559ad2[_0x549231(0x1c4)]||_0x549231(0x21e);if(tg?.[_0x549231(0x21c)])tg[_0x549231(0x21c)][_0x549231(0x1eb)](_0x549231(0x1c4));}messages[_0x549231(0x221)]({'role':'ai','content':_0x45d51a,'timestamp':Date[_0x549231(0x201)]()}),localStorage[_0x549231(0x234)](_0x549231(0x1fd),JSON[_0x549231(0x215)](messages)),renderMessages();}function confirmDelete(_0x5ec39c){const _0x4d258f=a0_0x3993a6;if(mTitle)mTitle[_0x4d258f(0x237)]=_0x4d258f(0x231);if(mText)mText[_0x4d258f(0x237)]='Действие\x20необратимо.';modalCallback=()=>{const _0x277292=_0x4d258f;messages['splice'](_0x5ec39c,0x1),localStorage['setItem'](_0x277292(0x1fd),JSON['stringify'](messages)),renderMessages();},modal[_0x4d258f(0x240)][_0x4d258f(0x1bf)](_0x4d258f(0x1f7));}function a0_0x1a35(){const _0x2c3849=['none','getHours','sendBtn','impactOccurred','createElement','querySelector','./router.html','innerHTML','auto','stringify','json','7048vlMcEC','emptyState','resize','clearBtn','length','HapticFeedback','value','Ошибка\x20сервера','role','show-delete','push','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','success','keydown','isVersionAtLeast','Ошибка\x20сети','parse','onclick','initDataUnsafe','modalText','appendChild','removeItem','confirmModal','addEventListener','TG\x20setup\x20error:','8574420rGDJUu','Удалить?','forEach','Enter','setItem','remove','3183zPuyWd','textContent','focus','message\x20','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','7950jfKXdk','content','modalCancel','getElementById','user','classList','add','disableVerticalSwipes','click','519579kwzmac','#050505','error','search','Пустой\x20ответ','modalTitle','13419593UAGdQO','scrollHeight','signal','messageInput','min','offsetHeight','first_name','function','6dMuZdM','offClick','viewportHeight','style','Очистить\x20историю?','getMinutes','BackButton','padStart','inputArea','paddingBottom','preventDefault','apply','text','touchstart','input','message-time','<br>','typingIndicator','Начнется\x20новый\x20диалог.','message\x20ai','target','floor','scrollTop','.container','461mKpnqz','12TscegS','light','notificationOccurred','stopPropagation','toString','expand','setHeaderColor','disabled','shiftKey','flex','href','onEvent','280gFwzRl','height','show','onClick','abort','message-bubble','5460784spUbNX','warn','ai_chat_messages','innerHeight','debug_uid','delete-btn','now','children','5268320LTGHrf','chatArea','div','.message.show-delete','className','replace','display','contains','constructor'];a0_0x1a35=function(){return _0x2c3849;};return a0_0x1a35();}if(clearBtn)clearBtn[a0_0x3993a6(0x228)]=()=>{const _0x55b48a=a0_0x3993a6;if(!messages[_0x55b48a(0x21b)])return;if(mTitle)mTitle[_0x55b48a(0x237)]=_0x55b48a(0x1d4);if(mText)mText[_0x55b48a(0x237)]=_0x55b48a(0x1e2);modalCallback=async()=>{const _0x538cac=_0x55b48a;messages=[],localStorage[_0x538cac(0x22c)](_0x538cac(0x1fd)),renderMessages(),callBackend('clear_history',{});},modal[_0x55b48a(0x240)][_0x55b48a(0x1bf)](_0x55b48a(0x1f7));};document[a0_0x3993a6(0x23e)](a0_0x3993a6(0x23d))[a0_0x3993a6(0x228)]=()=>modal[a0_0x3993a6(0x240)][a0_0x3993a6(0x235)](a0_0x3993a6(0x1f7)),document[a0_0x3993a6(0x23e)]('modalConfirm')[a0_0x3993a6(0x228)]=()=>{const _0x33f794=a0_0x3993a6;if(modalCallback)modalCallback();modal[_0x33f794(0x240)][_0x33f794(0x235)](_0x33f794(0x1f7));},messageInput[a0_0x3993a6(0x22e)](a0_0x3993a6(0x1de),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x3993a6(0x224),_0x8ef10c=>{const _0x242043=a0_0x3993a6;_0x8ef10c['key']===_0x242043(0x233)&&!_0x8ef10c[_0x242043(0x1f1)]&&(_0x8ef10c[_0x242043(0x1da)](),sendMessage());}),sendBtn[a0_0x3993a6(0x228)]=sendMessage,document[a0_0x3993a6(0x22e)](a0_0x3993a6(0x1c1),_0x44b586=>{const _0x800ea3=a0_0x3993a6;document['querySelectorAll'](_0x800ea3(0x206))[_0x800ea3(0x232)](_0x454b0f=>{const _0x1b2869=_0x800ea3;if(!_0x454b0f[_0x1b2869(0x20a)](_0x44b586[_0x1b2869(0x1e4)]))_0x454b0f[_0x1b2869(0x240)][_0x1b2869(0x235)](_0x1b2869(0x220));});});const saved=localStorage['getItem'](a0_0x3993a6(0x1fd));if(saved)try{messages=JSON[a0_0x3993a6(0x227)](saved),renderMessages();}catch(a0_0x43a6c9){}function a0_0x68f5(_0x2f1a8e,_0x1b9665){_0x2f1a8e=_0x2f1a8e-0x1bf;const _0x5d638f=a0_0x1a35();let _0x26c046=_0x5d638f[_0x2f1a8e];return _0x26c046;}updateSendButton();