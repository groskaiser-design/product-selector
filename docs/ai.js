const a0_0x186470=a0_0x6d5f;(function(_0x36021e,_0x13ad8f){const _0x2a8854=a0_0x6d5f,_0x103625=_0x36021e();while(!![]){try{const _0x255fbc=parseInt(_0x2a8854(0x8c))/0x1+parseInt(_0x2a8854(0xda))/0x2+parseInt(_0x2a8854(0xc9))/0x3*(-parseInt(_0x2a8854(0xbd))/0x4)+parseInt(_0x2a8854(0xd9))/0x5*(-parseInt(_0x2a8854(0xe5))/0x6)+-parseInt(_0x2a8854(0xb0))/0x7+parseInt(_0x2a8854(0x8a))/0x8+parseInt(_0x2a8854(0xcf))/0x9;if(_0x255fbc===_0x13ad8f)break;else _0x103625['push'](_0x103625['shift']());}catch(_0x38102b){_0x103625['push'](_0x103625['shift']());}}}(a0_0x51b4,0x9fe12));const tg=window[a0_0x186470(0x91)]?.[a0_0x186470(0x81)],HOME_URL=a0_0x186470(0xba);function setupTelegramBackButton(){const _0x4e87b7=a0_0x186470,_0x423d70=(function(){let _0x1ba2ac=!![];return function(_0x1eb4bb,_0x36846d){const _0x16baa7=_0x1ba2ac?function(){if(_0x36846d){const _0x1d93ff=_0x36846d['apply'](_0x1eb4bb,arguments);return _0x36846d=null,_0x1d93ff;}}:function(){};return _0x1ba2ac=![],_0x16baa7;};}()),_0x330350=_0x423d70(this,function(){const _0x2b0a2a=a0_0x6d5f;return _0x330350['toString']()[_0x2b0a2a(0xde)](_0x2b0a2a(0x9b))[_0x2b0a2a(0x93)]()['constructor'](_0x330350)[_0x2b0a2a(0xde)](_0x2b0a2a(0x9b));});_0x330350();if(!tg)return;try{tg['ready'](),tg[_0x4e87b7(0xdd)](),tg[_0x4e87b7(0xa2)]?.('#050505');if(tg[_0x4e87b7(0xd8)]?.(_0x4e87b7(0xa3)))tg[_0x4e87b7(0xf9)]?.();const _0x54f13f=tg['BackButton'];if(_0x54f13f){_0x54f13f[_0x4e87b7(0xf4)]();if(typeof _0x54f13f[_0x4e87b7(0xbc)]===_0x4e87b7(0xe9))try{_0x54f13f[_0x4e87b7(0xbc)]();}catch(_0x1233c2){}_0x54f13f[_0x4e87b7(0xb5)](()=>{const _0x262bfd=_0x4e87b7;if(tg[_0x262bfd(0xd0)])tg[_0x262bfd(0xd0)][_0x262bfd(0xf2)](_0x262bfd(0xe7));location[_0x262bfd(0xd4)]=HOME_URL;});}}catch(_0x59dd6c){console['warn'](_0x4e87b7(0xab),_0x59dd6c);}}(function initStableLayout(){const _0x4a5706=a0_0x186470,_0x20e038=document[_0x4a5706(0x9e)](_0x4a5706(0xb1)),_0xcba8da=document['getElementById']('inputArea'),_0x3f77f3=document[_0x4a5706(0xee)](_0x4a5706(0x97)),_0x2d123d=document[_0x4a5706(0xee)](_0x4a5706(0xa9));function _0x249acf(){const _0xa63a44=_0x4a5706;if(!_0x20e038)return;const _0x596b48=tg&&tg[_0xa63a44(0xdc)]?tg[_0xa63a44(0xdc)]:window[_0xa63a44(0x87)];_0x20e038['style']['height']=_0x596b48+'px';if(_0xcba8da){const _0x4247c6=_0xcba8da[_0xa63a44(0xe0)];_0x3f77f3[_0xa63a44(0xfa)][_0xa63a44(0xc1)]=_0x4247c6+0x28+'px';}}tg?tg[_0x4a5706(0xc5)](_0x4a5706(0xd1),({isStateStable:_0x2ece30})=>{_0x249acf();if(_0x2ece30)requestAnimationFrame(()=>{const _0x402b04=a0_0x6d5f;_0x3f77f3[_0x402b04(0xcb)]=_0x3f77f3['scrollHeight'];});}):window[_0x4a5706(0xa8)](_0x4a5706(0xf5),_0x249acf),_0x249acf(),_0x2d123d&&(_0x2d123d[_0x4a5706(0xa8)](_0x4a5706(0xec),()=>{requestAnimationFrame(_0x249acf);}),_0x2d123d[_0x4a5706(0xa8)](_0x4a5706(0x85),()=>{setTimeout(()=>{const _0x96d91c=a0_0x6d5f;_0x3f77f3[_0x96d91c(0xcb)]=_0x3f77f3['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x186470(0xe3),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x186470(0xee)]('chatArea'),emptyState=document[a0_0x186470(0xee)]('emptyState'),messageInput=document[a0_0x186470(0xee)](a0_0x186470(0xa9)),sendBtn=document[a0_0x186470(0xee)]('sendBtn'),clearBtn=document[a0_0x186470(0xee)]('clearBtn'),modal=document[a0_0x186470(0xee)](a0_0x186470(0xa7)),mTitle=document[a0_0x186470(0xee)](a0_0x186470(0xb4)),mText=document[a0_0x186470(0xee)](a0_0x186470(0x98));let modalCallback=null;function a0_0x51b4(){const _0x452aa9=['signal','Начнется\x20новый\x20диалог.','from','isVersionAtLeast','693815AfSFOs','2466684DcMbVM','min','viewportHeight','expand','search','Очистить\x20историю?','offsetHeight','timestamp','POST','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','18wiFfeR','flex','light','Enter','function','send_message','random','input','replace','getElementById','appendChild','message-bubble','remove','impactOccurred','json','show','resize','display','Пустой\x20ответ','delete-btn','disableVerticalSwipes','style','touchstart','WebApp','floor','user','value','focus','message\x20','innerHeight','preventDefault','modalCancel','7734992qIYaqB','abort','12569pBPEzS','textContent','createElement','initData','message-time','Telegram','ai_chat_messages','toString','classList','Удалить?','getItem','chatArea','modalText','contains','Ошибка\x20сервера','(((.+)+)+)+$','trim','forEach','querySelector','add','parse','medium','setHeaderColor','6.1','error','message\x20ai','success','confirmModal','addEventListener','messageInput','getHours','TG\x20setup\x20error:','username','stringify','scrollHeight','.message.show-delete','7967414EQoJuq','.container','typingIndicator','className','modalTitle','onClick','first_name','splice','children','setItem','./router.html','length','offClick','32488BAIgMs','initDataUnsafe','text/plain','emptyState','paddingBottom','stopPropagation','div','push','onEvent','keydown','Действие\x20необратимо.','innerHTML','255qShmQN','onclick','scrollTop','shiftKey','touchend','show-delete','6182478uOmKge','HapticFeedback','viewportChanged','notificationOccurred','target','href'];a0_0x51b4=function(){return _0x452aa9;};return a0_0x51b4();}async function callBackend(_0x5ac3f8,_0x337484){const _0x2fc551=a0_0x186470,_0x48358d=tg?.[_0x2fc551(0xbe)]?.[_0x2fc551(0x83)]||{},_0x351a96=_0x48358d['id']||localStorage[_0x2fc551(0x96)]('debug_uid')||'d-'+Math[_0x2fc551(0x82)](Math[_0x2fc551(0xeb)]()*0x3b9aca00);if(!_0x48358d['id'])localStorage[_0x2fc551(0xb9)]('debug_uid',_0x351a96);const _0x15ccea={'action':_0x5ac3f8,'user_id':_0x351a96,'user_data':{'first_name':_0x48358d[_0x2fc551(0xb6)],'username':_0x48358d[_0x2fc551(0xac)]},'init_data':tg?.[_0x2fc551(0x8f)]||'',..._0x337484},_0x11306d=new AbortController(),_0x12725c=setTimeout(()=>_0x11306d[_0x2fc551(0x8b)](),REQUEST_TIMEOUT_MS);try{const _0x1d0b24=await fetch(BACKEND_URL,{'method':_0x2fc551(0xe2),'headers':{'Content-Type':_0x2fc551(0xbf)},'body':JSON[_0x2fc551(0xad)](_0x15ccea),'signal':_0x11306d[_0x2fc551(0xd5)]});return clearTimeout(_0x12725c),await _0x1d0b24[_0x2fc551(0xf3)]();}catch(_0x2d863d){return{'success':![],'error':String(_0x2d863d)};}}function formatTime(_0x2fbab7){const _0x1f5eff=a0_0x186470,_0x592f03=new Date(_0x2fbab7);return String(_0x592f03[_0x1f5eff(0xaa)]())['padStart'](0x2,'0')+':'+String(_0x592f03['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x3b2f86,_0x48b17b){const _0x45419e=a0_0x186470,_0x7d44b9=document['createElement'](_0x45419e(0xc3));_0x7d44b9[_0x45419e(0xb3)]=_0x45419e(0x86)+_0x3b2f86['role'];const _0x8d444c=document[_0x45419e(0x8e)](_0x45419e(0xc3));_0x8d444c[_0x45419e(0xb3)]=_0x45419e(0xf0),_0x8d444c[_0x45419e(0xc8)]=_0x3b2f86['content'][_0x45419e(0xed)](/\n/g,'<br>');const _0x4f5ca5=document[_0x45419e(0x8e)](_0x45419e(0xc3));_0x4f5ca5[_0x45419e(0xb3)]=_0x45419e(0xf8),_0x4f5ca5[_0x45419e(0xc8)]=_0x45419e(0xe4),_0x4f5ca5[_0x45419e(0xca)]=_0xf49ee1=>{const _0x19e8cf=_0x45419e;_0xf49ee1[_0x19e8cf(0xc2)](),confirmDelete(_0x48b17b);};let _0x3108c4;_0x8d444c[_0x45419e(0xa8)](_0x45419e(0xfb),()=>_0x3108c4=setTimeout(()=>{const _0x7240c9=_0x45419e;_0x7d44b9[_0x7240c9(0x94)][_0x7240c9(0x9f)](_0x7240c9(0xce));if(tg?.[_0x7240c9(0xd0)])tg['HapticFeedback']['impactOccurred'](_0x7240c9(0xa1));},0x1f4)),_0x8d444c[_0x45419e(0xa8)](_0x45419e(0xcd),()=>clearTimeout(_0x3108c4));const _0x1db51b=document[_0x45419e(0x8e)](_0x45419e(0xc3));return _0x1db51b['className']=_0x45419e(0x90),_0x1db51b['textContent']=formatTime(_0x3b2f86[_0x45419e(0xe1)]),_0x7d44b9[_0x45419e(0xef)](_0x4f5ca5),_0x7d44b9[_0x45419e(0xef)](_0x8d444c),_0x7d44b9[_0x45419e(0xef)](_0x1db51b),_0x7d44b9;}function createTypingIndicator(){const _0x200a57=a0_0x186470,_0x317b07=document['createElement'](_0x200a57(0xc3));return _0x317b07[_0x200a57(0xb3)]=_0x200a57(0xa5),_0x317b07['id']=_0x200a57(0xb2),_0x317b07[_0x200a57(0xc8)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x317b07;}function renderMessages(){const _0x342e18=a0_0x186470;Array[_0x342e18(0xd7)](chatArea[_0x342e18(0xb8)])[_0x342e18(0x9d)](_0x1d8b0f=>{const _0x16ff1e=_0x342e18;if(_0x1d8b0f['id']!==_0x16ff1e(0xc0))_0x1d8b0f[_0x16ff1e(0xf1)]();}),messages[_0x342e18(0xbb)]>0x0?(emptyState[_0x342e18(0xfa)][_0x342e18(0xf6)]='none',messages['forEach']((_0x515d50,_0x5846ad)=>chatArea[_0x342e18(0xef)](createMessageElement(_0x515d50,_0x5846ad)))):emptyState[_0x342e18(0xfa)][_0x342e18(0xf6)]=_0x342e18(0xe6),requestAnimationFrame(()=>chatArea[_0x342e18(0xcb)]=chatArea[_0x342e18(0xae)]);}function autoResizeTextarea(){const _0x1fc9f8=a0_0x186470;messageInput[_0x1fc9f8(0xfa)]['height']='auto',messageInput[_0x1fc9f8(0xfa)]['height']=Math[_0x1fc9f8(0xdb)](messageInput[_0x1fc9f8(0xae)],0x78)+'px';}function a0_0x6d5f(_0x300f1e,_0x18d4e9){_0x300f1e=_0x300f1e-0x81;const _0x49413f=a0_0x51b4();let _0x3915cf=_0x49413f[_0x300f1e];return _0x3915cf;}function updateSendButton(){const _0x22bead=a0_0x186470,_0x3d5300=messageInput[_0x22bead(0x84)][_0x22bead(0x9c)]();sendBtn['disabled']=!_0x3d5300||isTyping;}async function sendMessage(){const _0x211503=a0_0x186470,_0x3d0088=messageInput[_0x211503(0x84)][_0x211503(0x9c)]();if(!_0x3d0088||isTyping)return;if(tg?.[_0x211503(0xd0)])tg[_0x211503(0xd0)]['impactOccurred']('light');messages[_0x211503(0xc4)]({'role':'user','content':_0x3d0088,'timestamp':Date['now']()}),localStorage[_0x211503(0xb9)](_0x211503(0x92),JSON[_0x211503(0xad)](messages)),renderMessages(),messageInput[_0x211503(0x84)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x211503(0xef)](createTypingIndicator()),chatArea[_0x211503(0xcb)]=chatArea[_0x211503(0xae)];const _0x9b6d35=await callBackend(_0x211503(0xea),{'message':_0x3d0088});isTyping=![];const _0x276963=document['getElementById'](_0x211503(0xb2));if(_0x276963)_0x276963[_0x211503(0xf1)]();let _0x5b057e='Ошибка\x20сети';if(_0x9b6d35[_0x211503(0xa6)]){_0x5b057e=_0x9b6d35['text']||_0x211503(0xf7);if(tg?.[_0x211503(0xd0)])tg[_0x211503(0xd0)][_0x211503(0xd2)](_0x211503(0xa6));}else{_0x5b057e=_0x9b6d35[_0x211503(0xa4)]||_0x211503(0x9a);if(tg?.[_0x211503(0xd0)])tg['HapticFeedback'][_0x211503(0xd2)](_0x211503(0xa4));}messages[_0x211503(0xc4)]({'role':'ai','content':_0x5b057e,'timestamp':Date['now']()}),localStorage[_0x211503(0xb9)](_0x211503(0x92),JSON[_0x211503(0xad)](messages)),renderMessages();}function confirmDelete(_0x5d8122){const _0x834712=a0_0x186470;if(mTitle)mTitle[_0x834712(0x8d)]=_0x834712(0x95);if(mText)mText[_0x834712(0x8d)]=_0x834712(0xc7);modalCallback=()=>{const _0x593415=_0x834712;messages[_0x593415(0xb7)](_0x5d8122,0x1),localStorage[_0x593415(0xb9)](_0x593415(0x92),JSON[_0x593415(0xad)](messages)),renderMessages();},modal[_0x834712(0x94)][_0x834712(0x9f)](_0x834712(0xf4));}if(clearBtn)clearBtn[a0_0x186470(0xca)]=()=>{const _0x54a565=a0_0x186470;if(!messages[_0x54a565(0xbb)])return;if(mTitle)mTitle[_0x54a565(0x8d)]=_0x54a565(0xdf);if(mText)mText[_0x54a565(0x8d)]=_0x54a565(0xd6);modalCallback=async()=>{messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x54a565(0x94)][_0x54a565(0x9f)]('show');};document[a0_0x186470(0xee)](a0_0x186470(0x89))[a0_0x186470(0xca)]=()=>modal['classList']['remove'](a0_0x186470(0xf4)),document['getElementById']('modalConfirm')[a0_0x186470(0xca)]=()=>{const _0xecc025=a0_0x186470;if(modalCallback)modalCallback();modal[_0xecc025(0x94)][_0xecc025(0xf1)](_0xecc025(0xf4));},messageInput[a0_0x186470(0xa8)](a0_0x186470(0xec),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x186470(0xa8)](a0_0x186470(0xc6),_0x12eb76=>{const _0x2013aa=a0_0x186470;_0x12eb76['key']===_0x2013aa(0xe8)&&!_0x12eb76[_0x2013aa(0xcc)]&&(_0x12eb76[_0x2013aa(0x88)](),sendMessage());}),sendBtn[a0_0x186470(0xca)]=sendMessage,document['addEventListener']('click',_0x1f398f=>{const _0x41844f=a0_0x186470;document['querySelectorAll'](_0x41844f(0xaf))['forEach'](_0x1343f9=>{const _0x435609=_0x41844f;if(!_0x1343f9[_0x435609(0x99)](_0x1f398f[_0x435609(0xd3)]))_0x1343f9['classList'][_0x435609(0xf1)](_0x435609(0xce));});});const saved=localStorage[a0_0x186470(0x96)](a0_0x186470(0x92));if(saved)try{messages=JSON[a0_0x186470(0xa0)](saved),renderMessages();}catch(a0_0x3d29f1){}updateSendButton();