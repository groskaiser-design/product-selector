const a0_0x3d46ed=a0_0x17db;(function(_0x8a1e80,_0x4b0276){const _0x5dfb4b=a0_0x17db,_0x22a453=_0x8a1e80();while(!![]){try{const _0x460b0a=parseInt(_0x5dfb4b(0xc2))/0x1*(parseInt(_0x5dfb4b(0x99))/0x2)+parseInt(_0x5dfb4b(0xa8))/0x3*(parseInt(_0x5dfb4b(0xb8))/0x4)+parseInt(_0x5dfb4b(0xa2))/0x5*(-parseInt(_0x5dfb4b(0xb1))/0x6)+parseInt(_0x5dfb4b(0xc1))/0x7+parseInt(_0x5dfb4b(0xb2))/0x8*(-parseInt(_0x5dfb4b(0x7f))/0x9)+-parseInt(_0x5dfb4b(0xcf))/0xa+-parseInt(_0x5dfb4b(0x91))/0xb*(-parseInt(_0x5dfb4b(0xfd))/0xc);if(_0x460b0a===_0x4b0276)break;else _0x22a453['push'](_0x22a453['shift']());}catch(_0xaf9cfa){_0x22a453['push'](_0x22a453['shift']());}}}(a0_0x2bec,0x85828));const tg=window[a0_0x3d46ed(0xce)]?.[a0_0x3d46ed(0xe0)],HOME_URL=a0_0x3d46ed(0xc0);function setupTelegramBackButton(){const _0x2cf07b=a0_0x3d46ed;if(!tg)return;try{tg[_0x2cf07b(0xee)](),tg[_0x2cf07b(0x86)](),tg['setHeaderColor']?.(_0x2cf07b(0xa5));if(tg[_0x2cf07b(0xf1)]?.('6.1'))tg[_0x2cf07b(0xdf)]?.();const _0x253922=tg[_0x2cf07b(0xba)];if(_0x253922){_0x253922['show']();if(typeof _0x253922[_0x2cf07b(0x9b)]===_0x2cf07b(0xa1))try{_0x253922['offClick']();}catch(_0x32c25f){}_0x253922[_0x2cf07b(0xa6)](()=>{const _0x361150=_0x2cf07b;if(tg['HapticFeedback'])tg[_0x361150(0xef)]['impactOccurred'](_0x361150(0xa0));location[_0x361150(0xe6)]=HOME_URL;});}}catch(_0x451b04){console['warn'](_0x2cf07b(0xc8),_0x451b04);}}(function initStableLayout(){const _0x73bb97=a0_0x3d46ed,_0x40dcee=(function(){let _0x4fbca8=!![];return function(_0x24dd4,_0x353d28){const _0x482ce9=_0x4fbca8?function(){if(_0x353d28){const _0x1f7ece=_0x353d28['apply'](_0x24dd4,arguments);return _0x353d28=null,_0x1f7ece;}}:function(){};return _0x4fbca8=![],_0x482ce9;};}()),_0x2e390e=document[_0x73bb97(0xd1)](_0x73bb97(0xd6)),_0x2c889e=document[_0x73bb97(0xe2)](_0x73bb97(0x9a)),_0x360115=document['getElementById'](_0x73bb97(0xb9)),_0x3dfa48=document['getElementById']('messageInput');function _0x1840e7(){const _0x3a4441=_0x73bb97,_0x3e432a=_0x40dcee(this,function(){const _0x355f51=a0_0x17db;return _0x3e432a[_0x355f51(0x96)]()[_0x355f51(0xbd)](_0x355f51(0xaf))['toString']()['constructor'](_0x3e432a)[_0x355f51(0xbd)]('(((.+)+)+)+$');});_0x3e432a();if(!_0x2e390e)return;const _0x2af007=tg&&tg[_0x3a4441(0xe9)]?tg[_0x3a4441(0xe9)]:window[_0x3a4441(0xd8)];_0x2e390e[_0x3a4441(0x83)][_0x3a4441(0xdd)]=_0x2af007+'px';if(_0x2c889e){const _0x30049a=_0x2c889e['offsetHeight'];_0x360115[_0x3a4441(0x83)][_0x3a4441(0xa9)]=_0x30049a+0x28+'px';}}tg?tg[_0x73bb97(0xdc)](_0x73bb97(0x8d),({isStateStable:_0x29f997})=>{_0x1840e7();if(_0x29f997)requestAnimationFrame(()=>{const _0x453320=a0_0x17db;_0x360115['scrollTop']=_0x360115[_0x453320(0xc9)];});}):window[_0x73bb97(0xd7)](_0x73bb97(0xea),_0x1840e7),_0x1840e7(),_0x3dfa48&&(_0x3dfa48[_0x73bb97(0xd7)](_0x73bb97(0xf0),()=>{requestAnimationFrame(_0x1840e7);}),_0x3dfa48['addEventListener'](_0x73bb97(0xd4),()=>{setTimeout(()=>{const _0x7dc4a=a0_0x17db;_0x360115['scrollTop']=_0x360115[_0x7dc4a(0xc9)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3d46ed(0xbc),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x17db(_0x1d4929,_0x3b5c30){_0x1d4929=_0x1d4929-0x7e;const _0x3336c9=a0_0x2bec();let _0x341c06=_0x3336c9[_0x1d4929];return _0x341c06;}const chatArea=document[a0_0x3d46ed(0xe2)]('chatArea'),emptyState=document['getElementById'](a0_0x3d46ed(0xbf)),messageInput=document['getElementById'](a0_0x3d46ed(0xe7)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x3d46ed(0xe2)](a0_0x3d46ed(0xf8)),modal=document[a0_0x3d46ed(0xe2)](a0_0x3d46ed(0xb6)),mTitle=document[a0_0x3d46ed(0xe2)](a0_0x3d46ed(0xac)),mText=document[a0_0x3d46ed(0xe2)](a0_0x3d46ed(0xf6));let modalCallback=null;async function callBackend(_0x4ca657,_0x645bbc){const _0x209381=a0_0x3d46ed,_0x1705c8=tg?.[_0x209381(0xe3)]?.[_0x209381(0xde)]||{},_0x213e2c=_0x1705c8['id']||localStorage[_0x209381(0xeb)](_0x209381(0xe1))||'d-'+Math[_0x209381(0x8b)](Math[_0x209381(0xf9)]()*0x3b9aca00);if(!_0x1705c8['id'])localStorage['setItem'](_0x209381(0xe1),_0x213e2c);const _0x5b5a43={'action':_0x4ca657,'user_id':_0x213e2c,'user_data':{'first_name':_0x1705c8[_0x209381(0x95)],'username':_0x1705c8['username']},'init_data':tg?.['initData']||'',..._0x645bbc},_0x29a1ba=new AbortController(),_0x545526=setTimeout(()=>_0x29a1ba[_0x209381(0x9c)](),REQUEST_TIMEOUT_MS);try{const _0x3f8a19=await fetch(BACKEND_URL,{'method':_0x209381(0xb3),'headers':{'Content-Type':_0x209381(0xbe)},'body':JSON['stringify'](_0x5b5a43),'signal':_0x29a1ba[_0x209381(0x85)]});return clearTimeout(_0x545526),await _0x3f8a19[_0x209381(0xcb)]();}catch(_0x573433){return{'success':![],'error':String(_0x573433)};}}function formatTime(_0x47f6b1){const _0x2cb62c=a0_0x3d46ed,_0x33c93f=new Date(_0x47f6b1);return String(_0x33c93f[_0x2cb62c(0x81)]())[_0x2cb62c(0xaa)](0x2,'0')+':'+String(_0x33c93f[_0x2cb62c(0xd9)]())['padStart'](0x2,'0');}function createMessageElement(_0x5d497d,_0x3d4982){const _0x5daf66=a0_0x3d46ed,_0x2a630b=document[_0x5daf66(0x8c)](_0x5daf66(0x98));_0x2a630b[_0x5daf66(0x9f)]=_0x5daf66(0xc5)+_0x5d497d[_0x5daf66(0xfb)];const _0x3f84e4=document[_0x5daf66(0x8c)](_0x5daf66(0x98));_0x3f84e4['className']='message-bubble',_0x3f84e4[_0x5daf66(0x8e)]=_0x5d497d['content'][_0x5daf66(0x90)](/\n/g,'<br>');const _0x38e43f=document[_0x5daf66(0x8c)]('div');_0x38e43f[_0x5daf66(0x9f)]='delete-btn',_0x38e43f[_0x5daf66(0x8e)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x38e43f['onclick']=_0x5a25a1=>{const _0x6f4916=_0x5daf66;_0x5a25a1[_0x6f4916(0xed)](),confirmDelete(_0x3d4982);};let _0x4b0b40;_0x3f84e4[_0x5daf66(0xd7)](_0x5daf66(0xab),()=>_0x4b0b40=setTimeout(()=>{const _0x20fd37=_0x5daf66;_0x2a630b[_0x20fd37(0xc7)]['add'](_0x20fd37(0xae));if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x20fd37(0xe5)]('medium');},0x1f4)),_0x3f84e4[_0x5daf66(0xd7)](_0x5daf66(0x87),()=>clearTimeout(_0x4b0b40));const _0x378e4b=document[_0x5daf66(0x8c)](_0x5daf66(0x98));return _0x378e4b['className']=_0x5daf66(0xd3),_0x378e4b['textContent']=formatTime(_0x5d497d[_0x5daf66(0xe8)]),_0x2a630b[_0x5daf66(0xb5)](_0x38e43f),_0x2a630b[_0x5daf66(0xb5)](_0x3f84e4),_0x2a630b[_0x5daf66(0xb5)](_0x378e4b),_0x2a630b;}function createTypingIndicator(){const _0x2cbd44=a0_0x3d46ed,_0x3f3062=document[_0x2cbd44(0x8c)](_0x2cbd44(0x98));return _0x3f3062['className']=_0x2cbd44(0xca),_0x3f3062['id']='typingIndicator',_0x3f3062[_0x2cbd44(0x8e)]=_0x2cbd44(0xb7),_0x3f3062;}function renderMessages(){const _0x1373b0=a0_0x3d46ed;Array['from'](chatArea[_0x1373b0(0xf5)])[_0x1373b0(0x8a)](_0x496d2e=>{const _0x183929=_0x1373b0;if(_0x496d2e['id']!==_0x183929(0xbf))_0x496d2e[_0x183929(0xa7)]();}),messages['length']>0x0?(emptyState[_0x1373b0(0x83)]['display']=_0x1373b0(0x9d),messages[_0x1373b0(0x8a)]((_0x3178e3,_0x36a9dc)=>chatArea['appendChild'](createMessageElement(_0x3178e3,_0x36a9dc)))):emptyState[_0x1373b0(0x83)][_0x1373b0(0xa3)]=_0x1373b0(0x88),requestAnimationFrame(()=>chatArea[_0x1373b0(0xc6)]=chatArea[_0x1373b0(0xc9)]);}function autoResizeTextarea(){const _0x308574=a0_0x3d46ed;messageInput[_0x308574(0x83)][_0x308574(0xdd)]=_0x308574(0x80),messageInput['style'][_0x308574(0xdd)]=Math[_0x308574(0xf7)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x143fec=a0_0x3d46ed,_0x3999d6=messageInput[_0x143fec(0x8f)][_0x143fec(0x97)]();sendBtn['disabled']=!_0x3999d6||isTyping;}async function sendMessage(){const _0x27abd2=a0_0x3d46ed,_0xdcb708=messageInput[_0x27abd2(0x8f)]['trim']();if(!_0xdcb708||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x27abd2(0xef)][_0x27abd2(0xe5)](_0x27abd2(0xa0));messages['push']({'role':'user','content':_0xdcb708,'timestamp':Date[_0x27abd2(0xf3)]()}),localStorage[_0x27abd2(0xad)](_0x27abd2(0xb4),JSON[_0x27abd2(0xfe)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x27abd2(0xb5)](createTypingIndicator()),chatArea[_0x27abd2(0xc6)]=chatArea[_0x27abd2(0xc9)];const _0x2aa14e=await callBackend(_0x27abd2(0xd2),{'message':_0xdcb708});isTyping=![];const _0x48b787=document[_0x27abd2(0xe2)](_0x27abd2(0x93));if(_0x48b787)_0x48b787[_0x27abd2(0xa7)]();let _0x390faf='Ошибка\x20сети';if(_0x2aa14e[_0x27abd2(0xd0)]){_0x390faf=_0x2aa14e['text']||_0x27abd2(0x7e);if(tg?.[_0x27abd2(0xef)])tg['HapticFeedback'][_0x27abd2(0xfa)](_0x27abd2(0xd0));}else{_0x390faf=_0x2aa14e[_0x27abd2(0xf4)]||'Ошибка\x20сервера';if(tg?.[_0x27abd2(0xef)])tg['HapticFeedback'][_0x27abd2(0xfa)](_0x27abd2(0xf4));}messages['push']({'role':'ai','content':_0x390faf,'timestamp':Date[_0x27abd2(0xf3)]()}),localStorage[_0x27abd2(0xad)](_0x27abd2(0xb4),JSON[_0x27abd2(0xfe)](messages)),renderMessages();}function confirmDelete(_0x5cbc58){const _0x498fd1=a0_0x3d46ed;if(mTitle)mTitle[_0x498fd1(0x9e)]=_0x498fd1(0xbb);if(mText)mText[_0x498fd1(0x9e)]=_0x498fd1(0x92);modalCallback=()=>{const _0x59f602=_0x498fd1;messages[_0x59f602(0x89)](_0x5cbc58,0x1),localStorage[_0x59f602(0xad)](_0x59f602(0xb4),JSON[_0x59f602(0xfe)](messages)),renderMessages();},modal[_0x498fd1(0xc7)][_0x498fd1(0x82)](_0x498fd1(0xcc));}if(clearBtn)clearBtn['onclick']=()=>{const _0xd2658=a0_0x3d46ed;if(!messages['length'])return;if(mTitle)mTitle[_0xd2658(0x9e)]='Очистить\x20историю?';if(mText)mText[_0xd2658(0x9e)]=_0xd2658(0xdb);modalCallback=async()=>{const _0x17450d=_0xd2658;messages=[],localStorage[_0x17450d(0xda)]('ai_chat_messages'),renderMessages(),callBackend(_0x17450d(0x94),{});},modal[_0xd2658(0xc7)][_0xd2658(0x82)](_0xd2658(0xcc));};document[a0_0x3d46ed(0xe2)](a0_0x3d46ed(0xb0))[a0_0x3d46ed(0xc3)]=()=>modal[a0_0x3d46ed(0xc7)][a0_0x3d46ed(0xa7)]('show'),document[a0_0x3d46ed(0xe2)](a0_0x3d46ed(0xec))[a0_0x3d46ed(0xc3)]=()=>{const _0x1f085c=a0_0x3d46ed;if(modalCallback)modalCallback();modal[_0x1f085c(0xc7)][_0x1f085c(0xa7)](_0x1f085c(0xcc));},messageInput[a0_0x3d46ed(0xd7)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3d46ed(0xd7)]('keydown',_0x5c5cb3=>{const _0x4f8587=a0_0x3d46ed;_0x5c5cb3[_0x4f8587(0xd5)]==='Enter'&&!_0x5c5cb3[_0x4f8587(0x84)]&&(_0x5c5cb3[_0x4f8587(0xe4)](),sendMessage());}),sendBtn[a0_0x3d46ed(0xc3)]=sendMessage,document[a0_0x3d46ed(0xd7)](a0_0x3d46ed(0xcd),_0x50a0d0=>{const _0x1789ca=a0_0x3d46ed;document[_0x1789ca(0xc4)](_0x1789ca(0xf2))['forEach'](_0xa165a4=>{const _0x4c94da=_0x1789ca;if(!_0xa165a4[_0x4c94da(0xa4)](_0x50a0d0['target']))_0xa165a4[_0x4c94da(0xc7)][_0x4c94da(0xa7)](_0x4c94da(0xae));});});function a0_0x2bec(){const _0x566343=['TG\x20setup\x20error:','scrollHeight','message\x20ai','json','show','click','Telegram','6463460Gxfnvi','success','querySelector','send_message','message-time','focus','key','.container','addEventListener','innerHeight','getMinutes','removeItem','Начнется\x20новый\x20диалог.','onEvent','height','user','disableVerticalSwipes','WebApp','debug_uid','getElementById','initDataUnsafe','preventDefault','impactOccurred','href','messageInput','timestamp','viewportHeight','resize','getItem','modalConfirm','stopPropagation','ready','HapticFeedback','input','isVersionAtLeast','.message.show-delete','now','error','children','modalText','min','clearBtn','random','notificationOccurred','role','parse','12fxenwP','stringify','Пустой\x20ответ','8451pjFAax','auto','getHours','add','style','shiftKey','signal','expand','touchend','flex','splice','forEach','floor','createElement','viewportChanged','innerHTML','value','replace','718267EMJtxk','Действие\x20необратимо.','typingIndicator','clear_history','first_name','toString','trim','div','10dDgZYm','inputArea','offClick','abort','none','textContent','className','light','function','4405rSuEKV','display','contains','#050505','onClick','remove','1437918iUyyVs','paddingBottom','padStart','touchstart','modalTitle','setItem','show-delete','(((.+)+)+)+$','modalCancel','3462mFdoVM','4336xAKHds','POST','ai_chat_messages','appendChild','confirmModal','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','8bsWWjW','chatArea','BackButton','Удалить?','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','search','text/plain','emptyState','./router.html','3388196cszgJI','140508jfMWDw','onclick','querySelectorAll','message\x20','scrollTop','classList'];a0_0x2bec=function(){return _0x566343;};return a0_0x2bec();}const saved=localStorage[a0_0x3d46ed(0xeb)](a0_0x3d46ed(0xb4));if(saved)try{messages=JSON[a0_0x3d46ed(0xfc)](saved),renderMessages();}catch(a0_0x14973c){}updateSendButton();