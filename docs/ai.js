const a0_0x1be506=a0_0x15fe;(function(_0x47c4a9,_0x1fbdcf){const _0x3b2560=a0_0x15fe,_0x15eb27=_0x47c4a9();while(!![]){try{const _0x5671b1=-parseInt(_0x3b2560(0xe0))/0x1+-parseInt(_0x3b2560(0xd6))/0x2+-parseInt(_0x3b2560(0xcd))/0x3*(-parseInt(_0x3b2560(0x10a))/0x4)+parseInt(_0x3b2560(0x116))/0x5+-parseInt(_0x3b2560(0x13f))/0x6*(parseInt(_0x3b2560(0x115))/0x7)+-parseInt(_0x3b2560(0x126))/0x8+-parseInt(_0x3b2560(0x12b))/0x9*(-parseInt(_0x3b2560(0x124))/0xa);if(_0x5671b1===_0x1fbdcf)break;else _0x15eb27['push'](_0x15eb27['shift']());}catch(_0x7f4dc5){_0x15eb27['push'](_0x15eb27['shift']());}}}(a0_0x1492,0xcc7d2));const tg=window[a0_0x1be506(0x11b)]?.[a0_0x1be506(0x10b)],HOME_URL=a0_0x1be506(0xf4);function setupTelegramBackButton(){const _0x2a18b7=a0_0x1be506,_0x20670d=(function(){let _0x1d6b8e=!![];return function(_0x5eaa07,_0x2df868){const _0x80fb81=_0x1d6b8e?function(){if(_0x2df868){const _0x453687=_0x2df868['apply'](_0x5eaa07,arguments);return _0x2df868=null,_0x453687;}}:function(){};return _0x1d6b8e=![],_0x80fb81;};}()),_0x21c47e=_0x20670d(this,function(){const _0x183ddf=a0_0x15fe;return _0x21c47e[_0x183ddf(0xe1)]()['search'](_0x183ddf(0x10d))[_0x183ddf(0xe1)]()['constructor'](_0x21c47e)[_0x183ddf(0xe7)](_0x183ddf(0x10d));});_0x21c47e();if(!tg)return;try{tg[_0x2a18b7(0x128)](),tg[_0x2a18b7(0x127)](),tg['setHeaderColor']?.(_0x2a18b7(0xd7));if(tg[_0x2a18b7(0x136)]?.(_0x2a18b7(0x104)))tg[_0x2a18b7(0xd5)]?.();const _0x8878bf=tg[_0x2a18b7(0xda)];if(_0x8878bf){_0x8878bf[_0x2a18b7(0xe8)]();if(typeof _0x8878bf[_0x2a18b7(0x105)]===_0x2a18b7(0x118))try{_0x8878bf[_0x2a18b7(0x105)]();}catch(_0x23bda9){}_0x8878bf[_0x2a18b7(0xeb)](()=>{const _0x51bf25=_0x2a18b7;if(tg[_0x51bf25(0x11e)])tg[_0x51bf25(0x11e)]['impactOccurred'](_0x51bf25(0xd9));location['href']=HOME_URL;});}}catch(_0xb8e3ea){console['warn']('TG\x20setup\x20error:',_0xb8e3ea);}}function a0_0x15fe(_0x5c885e,_0x1c0d92){_0x5c885e=_0x5c885e-0xca;const _0x4d8c9d=a0_0x1492();let _0x3359a6=_0x4d8c9d[_0x5c885e];return _0x3359a6;}(function initStableLayout(){const _0x3b88e2=a0_0x1be506,_0x245d94=document['querySelector']('.container'),_0x14c182=document[_0x3b88e2(0x135)](_0x3b88e2(0x102)),_0x25dae7=document[_0x3b88e2(0x135)]('chatArea'),_0x17ebf3=document[_0x3b88e2(0x135)](_0x3b88e2(0x120));function _0x3ecb9a(){const _0x4635ea=_0x3b88e2;if(!_0x245d94)return;const _0x5c3ad9=tg&&tg[_0x4635ea(0x11f)]?tg[_0x4635ea(0x11f)]:window[_0x4635ea(0xfd)];_0x245d94[_0x4635ea(0xcf)]['height']=_0x5c3ad9+'px';if(_0x14c182){const _0x4fbe9f=_0x14c182['offsetHeight'];_0x25dae7[_0x4635ea(0xcf)][_0x4635ea(0xe9)]=_0x4fbe9f+0x28+'px';}}tg?tg['onEvent'](_0x3b88e2(0x10c),({isStateStable:_0x2fdf83})=>{_0x3ecb9a();if(_0x2fdf83)requestAnimationFrame(()=>{const _0x30d43c=a0_0x15fe;_0x25dae7[_0x30d43c(0x109)]=_0x25dae7[_0x30d43c(0x12c)];});}):window[_0x3b88e2(0x114)](_0x3b88e2(0x113),_0x3ecb9a),_0x3ecb9a(),_0x17ebf3&&(_0x17ebf3[_0x3b88e2(0x114)](_0x3b88e2(0x12d),()=>{requestAnimationFrame(_0x3ecb9a);}),_0x17ebf3[_0x3b88e2(0x114)](_0x3b88e2(0x112),()=>{setTimeout(()=>{const _0x2a6082=a0_0x15fe;_0x25dae7['scrollTop']=_0x25dae7[_0x2a6082(0x12c)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1be506(0x13e),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1be506(0x135)](a0_0x1be506(0x10e)),emptyState=document[a0_0x1be506(0x135)](a0_0x1be506(0xe2)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x1be506(0x135)](a0_0x1be506(0x130)),clearBtn=document['getElementById'](a0_0x1be506(0xea)),modal=document[a0_0x1be506(0x135)](a0_0x1be506(0xf8)),mTitle=document[a0_0x1be506(0x135)](a0_0x1be506(0x138)),mText=document[a0_0x1be506(0x135)](a0_0x1be506(0x142));let modalCallback=null;async function callBackend(_0x21f211,_0x205fad){const _0x47eb45=a0_0x1be506,_0x3570f7=tg?.[_0x47eb45(0x101)]?.[_0x47eb45(0xed)]||{},_0x38174a=_0x3570f7['id']||localStorage[_0x47eb45(0x11d)]('debug_uid')||'d-'+Math[_0x47eb45(0xf7)](Math[_0x47eb45(0x10f)]()*0x3b9aca00);if(!_0x3570f7['id'])localStorage[_0x47eb45(0xca)](_0x47eb45(0xf6),_0x38174a);const _0x49af64={'action':_0x21f211,'user_id':_0x38174a,'user_data':{'first_name':_0x3570f7['first_name'],'username':_0x3570f7['username']},'init_data':tg?.[_0x47eb45(0xe6)]||'',..._0x205fad},_0x3f2aa9=new AbortController(),_0xfdb04f=setTimeout(()=>_0x3f2aa9[_0x47eb45(0xf3)](),REQUEST_TIMEOUT_MS);try{const _0x59a7b3=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x47eb45(0x133)},'body':JSON[_0x47eb45(0x110)](_0x49af64),'signal':_0x3f2aa9[_0x47eb45(0xdc)]});return clearTimeout(_0xfdb04f),await _0x59a7b3[_0x47eb45(0xef)]();}catch(_0x33b24f){return{'success':![],'error':String(_0x33b24f)};}}function formatTime(_0x62b1b8){const _0x289b5c=a0_0x1be506,_0x4bf515=new Date(_0x62b1b8);return String(_0x4bf515[_0x289b5c(0xcc)]())[_0x289b5c(0x123)](0x2,'0')+':'+String(_0x4bf515['getMinutes']())[_0x289b5c(0x123)](0x2,'0');}function a0_0x1492(){const _0x10c856=['success','593224wjQdJd','toString','emptyState','onclick','key','remove','initData','search','show','paddingBottom','clearBtn','onClick','Очистить\x20историю?','user','length','json','message\x20','.message.show-delete','stopPropagation','abort','./router.html','impactOccurred','debug_uid','floor','confirmModal','message\x20ai','touchstart','replace','modalConfirm','innerHeight','notificationOccurred','<br>','medium','initDataUnsafe','inputArea','shiftKey','6.1','offClick','createElement','flex','ai_chat_messages','scrollTop','3066068NImnYR','WebApp','viewportChanged','(((.+)+)+)+$','chatArea','random','stringify','Ошибка\x20сервера','focus','resize','addEventListener','203hJxvqW','6024565sVAzzO','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','function','appendChild','splice','Telegram','now','getItem','HapticFeedback','viewportHeight','messageInput','forEach','Пустой\x20ответ','padStart','10EtmHiF','message-time','6871224YsHwRs','expand','ready','clear_history','div','30058965QlsILi','scrollHeight','input','innerHTML','auto','sendBtn','removeItem','display','text/plain','click','getElementById','isVersionAtLeast','error','modalTitle','content','min','textContent','from','text','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','324342HzCbKH','message-bubble','timestamp','modalText','add','className','push','target','setItem','trim','getHours','3hFSQpY','keydown','style','Enter','parse','show-delete','value','touchend','disableVerticalSwipes','2907898qJBoVu','#050505','none','light','BackButton','height','signal','Начнется\x20новый\x20диалог.','classList'];a0_0x1492=function(){return _0x10c856;};return a0_0x1492();}function createMessageElement(_0x5987f0,_0x208319){const _0x3d22a7=a0_0x1be506,_0x33d11d=document[_0x3d22a7(0x106)](_0x3d22a7(0x12a));_0x33d11d['className']=_0x3d22a7(0xf0)+_0x5987f0['role'];const _0x4d7d8b=document[_0x3d22a7(0x106)](_0x3d22a7(0x12a));_0x4d7d8b['className']=_0x3d22a7(0x140),_0x4d7d8b['innerHTML']=_0x5987f0[_0x3d22a7(0x139)][_0x3d22a7(0xfb)](/\n/g,_0x3d22a7(0xff));const _0x3ac5fd=document[_0x3d22a7(0x106)](_0x3d22a7(0x12a));_0x3ac5fd['className']='delete-btn',_0x3ac5fd[_0x3d22a7(0x12e)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x3ac5fd['onclick']=_0x4faea0=>{const _0x108c95=_0x3d22a7;_0x4faea0[_0x108c95(0xf2)](),confirmDelete(_0x208319);};let _0x1922c9;_0x4d7d8b[_0x3d22a7(0x114)](_0x3d22a7(0xfa),()=>_0x1922c9=setTimeout(()=>{const _0x176381=_0x3d22a7;_0x33d11d['classList']['add'](_0x176381(0xd2));if(tg?.[_0x176381(0x11e)])tg[_0x176381(0x11e)][_0x176381(0xf5)](_0x176381(0x100));},0x1f4)),_0x4d7d8b['addEventListener'](_0x3d22a7(0xd4),()=>clearTimeout(_0x1922c9));const _0x26ab39=document[_0x3d22a7(0x106)](_0x3d22a7(0x12a));return _0x26ab39['className']=_0x3d22a7(0x125),_0x26ab39['textContent']=formatTime(_0x5987f0[_0x3d22a7(0x141)]),_0x33d11d['appendChild'](_0x3ac5fd),_0x33d11d[_0x3d22a7(0x119)](_0x4d7d8b),_0x33d11d[_0x3d22a7(0x119)](_0x26ab39),_0x33d11d;}function createTypingIndicator(){const _0x5daf6f=a0_0x1be506,_0x442b3e=document[_0x5daf6f(0x106)](_0x5daf6f(0x12a));return _0x442b3e[_0x5daf6f(0x144)]=_0x5daf6f(0xf9),_0x442b3e['id']='typingIndicator',_0x442b3e[_0x5daf6f(0x12e)]=_0x5daf6f(0x117),_0x442b3e;}function renderMessages(){const _0x47bb2d=a0_0x1be506;Array[_0x47bb2d(0x13c)](chatArea['children'])[_0x47bb2d(0x121)](_0x48f958=>{const _0x1f1b51=_0x47bb2d;if(_0x48f958['id']!==_0x1f1b51(0xe2))_0x48f958[_0x1f1b51(0xe5)]();}),messages[_0x47bb2d(0xee)]>0x0?(emptyState['style'][_0x47bb2d(0x132)]=_0x47bb2d(0xd8),messages[_0x47bb2d(0x121)]((_0x37e551,_0x2c475b)=>chatArea[_0x47bb2d(0x119)](createMessageElement(_0x37e551,_0x2c475b)))):emptyState[_0x47bb2d(0xcf)][_0x47bb2d(0x132)]=_0x47bb2d(0x107),requestAnimationFrame(()=>chatArea[_0x47bb2d(0x109)]=chatArea[_0x47bb2d(0x12c)]);}function autoResizeTextarea(){const _0x539dbf=a0_0x1be506;messageInput[_0x539dbf(0xcf)]['height']=_0x539dbf(0x12f),messageInput['style'][_0x539dbf(0xdb)]=Math[_0x539dbf(0x13a)](messageInput[_0x539dbf(0x12c)],0x78)+'px';}function updateSendButton(){const _0x20d6b1=a0_0x1be506,_0x1217e9=messageInput['value'][_0x20d6b1(0xcb)]();sendBtn['disabled']=!_0x1217e9||isTyping;}async function sendMessage(){const _0x48e6ef=a0_0x1be506,_0x1be84f=messageInput[_0x48e6ef(0xd3)]['trim']();if(!_0x1be84f||isTyping)return;if(tg?.[_0x48e6ef(0x11e)])tg[_0x48e6ef(0x11e)][_0x48e6ef(0xf5)](_0x48e6ef(0xd9));messages['push']({'role':_0x48e6ef(0xed),'content':_0x1be84f,'timestamp':Date[_0x48e6ef(0x11c)]()}),localStorage[_0x48e6ef(0xca)]('ai_chat_messages',JSON[_0x48e6ef(0x110)](messages)),renderMessages(),messageInput[_0x48e6ef(0xd3)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x48e6ef(0x119)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x48e6ef(0x12c)];const _0x688780=await callBackend('send_message',{'message':_0x1be84f});isTyping=![];const _0x44728c=document[_0x48e6ef(0x135)]('typingIndicator');if(_0x44728c)_0x44728c['remove']();let _0xb473b5='Ошибка\x20сети';if(_0x688780[_0x48e6ef(0xdf)]){_0xb473b5=_0x688780[_0x48e6ef(0x13d)]||_0x48e6ef(0x122);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x48e6ef(0xfe)](_0x48e6ef(0xdf));}else{_0xb473b5=_0x688780[_0x48e6ef(0x137)]||_0x48e6ef(0x111);if(tg?.[_0x48e6ef(0x11e)])tg[_0x48e6ef(0x11e)][_0x48e6ef(0xfe)](_0x48e6ef(0x137));}messages[_0x48e6ef(0x145)]({'role':'ai','content':_0xb473b5,'timestamp':Date[_0x48e6ef(0x11c)]()}),localStorage[_0x48e6ef(0xca)](_0x48e6ef(0x108),JSON[_0x48e6ef(0x110)](messages)),renderMessages();}function confirmDelete(_0x2524a6){const _0x119df4=a0_0x1be506;if(mTitle)mTitle[_0x119df4(0x13b)]='Удалить?';if(mText)mText[_0x119df4(0x13b)]='Действие\x20необратимо.';modalCallback=()=>{const _0x368cde=_0x119df4;messages[_0x368cde(0x11a)](_0x2524a6,0x1),localStorage[_0x368cde(0xca)](_0x368cde(0x108),JSON[_0x368cde(0x110)](messages)),renderMessages();},modal[_0x119df4(0xde)][_0x119df4(0x143)](_0x119df4(0xe8));}if(clearBtn)clearBtn[a0_0x1be506(0xe3)]=()=>{const _0x220be1=a0_0x1be506;if(!messages[_0x220be1(0xee)])return;if(mTitle)mTitle[_0x220be1(0x13b)]=_0x220be1(0xec);if(mText)mText['textContent']=_0x220be1(0xdd);modalCallback=async()=>{const _0x211c10=_0x220be1;messages=[],localStorage[_0x211c10(0x131)]('ai_chat_messages'),renderMessages(),callBackend(_0x211c10(0x129),{});},modal[_0x220be1(0xde)]['add'](_0x220be1(0xe8));};document[a0_0x1be506(0x135)]('modalCancel')[a0_0x1be506(0xe3)]=()=>modal[a0_0x1be506(0xde)]['remove'](a0_0x1be506(0xe8)),document[a0_0x1be506(0x135)](a0_0x1be506(0xfc))['onclick']=()=>{const _0x4b6bca=a0_0x1be506;if(modalCallback)modalCallback();modal[_0x4b6bca(0xde)]['remove'](_0x4b6bca(0xe8));},messageInput['addEventListener'](a0_0x1be506(0x12d),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1be506(0x114)](a0_0x1be506(0xce),_0x2e155e=>{const _0x3d6b93=a0_0x1be506;_0x2e155e[_0x3d6b93(0xe4)]===_0x3d6b93(0xd0)&&!_0x2e155e[_0x3d6b93(0x103)]&&(_0x2e155e['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x1be506(0x114)](a0_0x1be506(0x134),_0x485440=>{const _0x4ab522=a0_0x1be506;document['querySelectorAll'](_0x4ab522(0xf1))[_0x4ab522(0x121)](_0x2744f4=>{const _0x5ea25d=_0x4ab522;if(!_0x2744f4['contains'](_0x485440[_0x5ea25d(0x146)]))_0x2744f4[_0x5ea25d(0xde)]['remove'](_0x5ea25d(0xd2));});});const saved=localStorage[a0_0x1be506(0x11d)](a0_0x1be506(0x108));if(saved)try{messages=JSON[a0_0x1be506(0xd1)](saved),renderMessages();}catch(a0_0x5d2416){}updateSendButton();