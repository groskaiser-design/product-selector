const a0_0xbb6953=a0_0x503b;(function(_0x375478,_0x5810cd){const _0x41436b=a0_0x503b,_0x10f5cf=_0x375478();while(!![]){try{const _0x4bc31c=-parseInt(_0x41436b(0xd8))/0x1*(parseInt(_0x41436b(0x116))/0x2)+parseInt(_0x41436b(0x13a))/0x3*(parseInt(_0x41436b(0x114))/0x4)+parseInt(_0x41436b(0xfb))/0x5+-parseInt(_0x41436b(0x149))/0x6+-parseInt(_0x41436b(0xd0))/0x7+-parseInt(_0x41436b(0x126))/0x8+-parseInt(_0x41436b(0xcc))/0x9*(-parseInt(_0x41436b(0xdd))/0xa);if(_0x4bc31c===_0x5810cd)break;else _0x10f5cf['push'](_0x10f5cf['shift']());}catch(_0x2747fb){_0x10f5cf['push'](_0x10f5cf['shift']());}}}(a0_0x40b8,0xdac8c));const tg=window[a0_0xbb6953(0x104)]?.[a0_0xbb6953(0x121)],HOME_URL=a0_0xbb6953(0xef);function setupTelegramBackButton(){const _0x3ac5f1=a0_0xbb6953;if(!tg)return;try{tg[_0x3ac5f1(0xde)](),tg[_0x3ac5f1(0x143)](),tg[_0x3ac5f1(0x11b)]?.(_0x3ac5f1(0xff));if(tg[_0x3ac5f1(0x132)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x5de03d=tg[_0x3ac5f1(0x105)];if(_0x5de03d){_0x5de03d[_0x3ac5f1(0xfc)]();if(typeof _0x5de03d['offClick']===_0x3ac5f1(0x14a))try{_0x5de03d[_0x3ac5f1(0x101)]();}catch(_0x19d3fa){}_0x5de03d[_0x3ac5f1(0x13b)](()=>{const _0x118b8a=_0x3ac5f1;if(tg[_0x118b8a(0xe5)])tg[_0x118b8a(0xe5)][_0x118b8a(0x118)](_0x118b8a(0xfe));location[_0x118b8a(0xf8)]=HOME_URL;});}}catch(_0x4c12bd){console[_0x3ac5f1(0xed)](_0x3ac5f1(0x130),_0x4c12bd);}}(function initStableLayout(){const _0x24cc83=a0_0xbb6953,_0x1288a0=(function(){let _0x230c3a=!![];return function(_0xa0d778,_0xfe150b){const _0x4df8db=_0x230c3a?function(){if(_0xfe150b){const _0x163dde=_0xfe150b['apply'](_0xa0d778,arguments);return _0xfe150b=null,_0x163dde;}}:function(){};return _0x230c3a=![],_0x4df8db;};}()),_0x8a9b2a=document[_0x24cc83(0x13f)](_0x24cc83(0xdb)),_0x32fe67=document['getElementById']('inputArea'),_0x494d6d=document[_0x24cc83(0x13d)](_0x24cc83(0x12b)),_0x3ed047=document[_0x24cc83(0x13d)]('messageInput');function _0x424035(){const _0x204c13=_0x24cc83,_0x3d5030=_0x1288a0(this,function(){const _0x438fe4=a0_0x503b;return _0x3d5030[_0x438fe4(0x135)]()[_0x438fe4(0x140)](_0x438fe4(0x106))[_0x438fe4(0x135)]()[_0x438fe4(0xcf)](_0x3d5030)['search'](_0x438fe4(0x106));});_0x3d5030();if(!_0x8a9b2a)return;const _0x572433=tg&&tg[_0x204c13(0x10c)]?tg[_0x204c13(0x10c)]:window[_0x204c13(0xf4)];_0x8a9b2a[_0x204c13(0xd5)][_0x204c13(0x100)]=_0x572433+'px';if(_0x32fe67){const _0x511e56=_0x32fe67[_0x204c13(0x145)];_0x494d6d[_0x204c13(0xd5)][_0x204c13(0xf2)]=_0x511e56+0x28+'px';}}tg?tg[_0x24cc83(0xc9)](_0x24cc83(0xc8),({isStateStable:_0x55d28a})=>{_0x424035();if(_0x55d28a)requestAnimationFrame(()=>{const _0x515fea=a0_0x503b;_0x494d6d['scrollTop']=_0x494d6d[_0x515fea(0x109)];});}):window[_0x24cc83(0x127)]('resize',_0x424035),_0x424035(),_0x3ed047&&(_0x3ed047[_0x24cc83(0x127)](_0x24cc83(0xf7),()=>{requestAnimationFrame(_0x424035);}),_0x3ed047[_0x24cc83(0x127)](_0x24cc83(0xea),()=>{setTimeout(()=>{const _0x565cbd=a0_0x503b;_0x494d6d[_0x565cbd(0x117)]=_0x494d6d[_0x565cbd(0x109)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xbb6953(0xdc),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById']('chatArea'),emptyState=document[a0_0xbb6953(0x13d)]('emptyState'),messageInput=document[a0_0xbb6953(0x13d)](a0_0xbb6953(0x146)),sendBtn=document[a0_0xbb6953(0x13d)](a0_0xbb6953(0xe4)),clearBtn=document['getElementById'](a0_0xbb6953(0xf3)),modal=document[a0_0xbb6953(0x13d)](a0_0xbb6953(0x138)),mTitle=document[a0_0xbb6953(0x13d)](a0_0xbb6953(0x11a)),mText=document[a0_0xbb6953(0x13d)]('modalText');let modalCallback=null;async function callBackend(_0x537aa4,_0x196ea9){const _0x59fc66=a0_0xbb6953,_0xa61c9b=tg?.['initDataUnsafe']?.[_0x59fc66(0x144)]||{},_0x183ae5=_0xa61c9b['id']||localStorage[_0x59fc66(0xe9)]('debug_uid')||'d-'+Math[_0x59fc66(0x13e)](Math[_0x59fc66(0xe1)]()*0x3b9aca00);if(!_0xa61c9b['id'])localStorage['setItem'](_0x59fc66(0x131),_0x183ae5);const _0xe1572f={'action':_0x537aa4,'user_id':_0x183ae5,'user_data':{'first_name':_0xa61c9b['first_name'],'username':_0xa61c9b[_0x59fc66(0x137)]},'init_data':tg?.[_0x59fc66(0x12e)]||'',..._0x196ea9},_0x227500=new AbortController(),_0x472db4=setTimeout(()=>_0x227500[_0x59fc66(0x128)](),REQUEST_TIMEOUT_MS);try{const _0xd32e7d=await fetch(BACKEND_URL,{'method':_0x59fc66(0xca),'headers':{'Content-Type':_0x59fc66(0x11c)},'body':JSON['stringify'](_0xe1572f),'signal':_0x227500[_0x59fc66(0x119)]});return clearTimeout(_0x472db4),await _0xd32e7d[_0x59fc66(0xd4)]();}catch(_0x3cb442){return{'success':![],'error':String(_0x3cb442)};}}function formatTime(_0x28aa){const _0x3e0a1b=a0_0xbb6953,_0x52bdf0=new Date(_0x28aa);return String(_0x52bdf0[_0x3e0a1b(0x12d)]())[_0x3e0a1b(0x110)](0x2,'0')+':'+String(_0x52bdf0[_0x3e0a1b(0xd6)]())[_0x3e0a1b(0x110)](0x2,'0');}function createMessageElement(_0x30a199,_0x110ec3){const _0x3dd362=a0_0xbb6953,_0x3c85ba=document[_0x3dd362(0xda)](_0x3dd362(0x134));_0x3c85ba[_0x3dd362(0xe2)]=_0x3dd362(0x124)+_0x30a199[_0x3dd362(0x108)];const _0x36cf77=document[_0x3dd362(0xda)](_0x3dd362(0x134));_0x36cf77[_0x3dd362(0xe2)]=_0x3dd362(0xd7),_0x36cf77[_0x3dd362(0x120)]=_0x30a199['content'][_0x3dd362(0x129)](/\n/g,_0x3dd362(0x147));const _0x58a7de=document[_0x3dd362(0xda)](_0x3dd362(0x134));_0x58a7de[_0x3dd362(0xe2)]=_0x3dd362(0x11f),_0x58a7de[_0x3dd362(0x120)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x58a7de[_0x3dd362(0xeb)]=_0x4ba401=>{const _0x4d3376=_0x3dd362;_0x4ba401[_0x4d3376(0x10d)](),confirmDelete(_0x110ec3);};let _0x2326d2;_0x36cf77['addEventListener'](_0x3dd362(0x13c),()=>_0x2326d2=setTimeout(()=>{const _0x2a07c6=_0x3dd362;_0x3c85ba[_0x2a07c6(0xc7)]['add'](_0x2a07c6(0x148));if(tg?.[_0x2a07c6(0xe5)])tg[_0x2a07c6(0xe5)][_0x2a07c6(0x118)]('medium');},0x1f4)),_0x36cf77[_0x3dd362(0x127)](_0x3dd362(0xcd),()=>clearTimeout(_0x2326d2));const _0x3cb572=document[_0x3dd362(0xda)](_0x3dd362(0x134));return _0x3cb572[_0x3dd362(0xe2)]=_0x3dd362(0xdf),_0x3cb572[_0x3dd362(0x10a)]=formatTime(_0x30a199[_0x3dd362(0xfd)]),_0x3c85ba[_0x3dd362(0x10e)](_0x58a7de),_0x3c85ba[_0x3dd362(0x10e)](_0x36cf77),_0x3c85ba[_0x3dd362(0x10e)](_0x3cb572),_0x3c85ba;}function createTypingIndicator(){const _0x590fe1=a0_0xbb6953,_0x224fe2=document[_0x590fe1(0xda)]('div');return _0x224fe2[_0x590fe1(0xe2)]=_0x590fe1(0xe3),_0x224fe2['id']=_0x590fe1(0x10b),_0x224fe2[_0x590fe1(0x120)]=_0x590fe1(0x103),_0x224fe2;}function renderMessages(){const _0xf3461b=a0_0xbb6953;Array[_0xf3461b(0x136)](chatArea[_0xf3461b(0xd2)])[_0xf3461b(0x112)](_0x1b8b29=>{const _0x2095f1=_0xf3461b;if(_0x1b8b29['id']!==_0x2095f1(0xd1))_0x1b8b29['remove']();}),messages['length']>0x0?(emptyState[_0xf3461b(0xd5)][_0xf3461b(0xfa)]=_0xf3461b(0x12f),messages[_0xf3461b(0x112)]((_0x18dda4,_0x36b6b3)=>chatArea[_0xf3461b(0x10e)](createMessageElement(_0x18dda4,_0x36b6b3)))):emptyState[_0xf3461b(0xd5)]['display']=_0xf3461b(0xe8),requestAnimationFrame(()=>chatArea[_0xf3461b(0x117)]=chatArea[_0xf3461b(0x109)]);}function autoResizeTextarea(){const _0x3c833c=a0_0xbb6953;messageInput['style'][_0x3c833c(0x100)]='auto',messageInput['style']['height']=Math[_0x3c833c(0xcb)](messageInput[_0x3c833c(0x109)],0x78)+'px';}function updateSendButton(){const _0x353139=a0_0xbb6953,_0x5024f6=messageInput[_0x353139(0x12a)]['trim']();sendBtn['disabled']=!_0x5024f6||isTyping;}async function sendMessage(){const _0x22197e=a0_0xbb6953,_0x27970b=messageInput[_0x22197e(0x12a)][_0x22197e(0xee)]();if(!_0x27970b||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x22197e(0xe5)][_0x22197e(0x118)]('light');messages[_0x22197e(0xd3)]({'role':'user','content':_0x27970b,'timestamp':Date[_0x22197e(0xec)]()}),localStorage['setItem'](_0x22197e(0x115),JSON[_0x22197e(0x11e)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x22197e(0x109)];const _0x1cd233=await callBackend(_0x22197e(0x122),{'message':_0x27970b});isTyping=![];const _0x2cc3d2=document[_0x22197e(0x13d)]('typingIndicator');if(_0x2cc3d2)_0x2cc3d2[_0x22197e(0xf1)]();let _0x47d4a1=_0x22197e(0x125);if(_0x1cd233[_0x22197e(0x111)]){_0x47d4a1=_0x1cd233['text']||_0x22197e(0x12c);if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred'](_0x22197e(0x111));}else{_0x47d4a1=_0x1cd233['error']||_0x22197e(0x11d);if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred'](_0x22197e(0x107));}messages[_0x22197e(0xd3)]({'role':'ai','content':_0x47d4a1,'timestamp':Date[_0x22197e(0xec)]()}),localStorage['setItem'](_0x22197e(0x115),JSON[_0x22197e(0x11e)](messages)),renderMessages();}function confirmDelete(_0x33453e){const _0x23776c=a0_0xbb6953;if(mTitle)mTitle[_0x23776c(0x10a)]=_0x23776c(0xe0);if(mText)mText[_0x23776c(0x10a)]='Действие\x20необратимо.';modalCallback=()=>{const _0x3db425=_0x23776c;messages['splice'](_0x33453e,0x1),localStorage[_0x3db425(0xe6)]('ai_chat_messages',JSON[_0x3db425(0x11e)](messages)),renderMessages();},modal['classList'][_0x23776c(0xf0)](_0x23776c(0xfc));}if(clearBtn)clearBtn[a0_0xbb6953(0xeb)]=()=>{const _0x7b0d04=a0_0xbb6953;if(!messages[_0x7b0d04(0xe7)])return;if(mTitle)mTitle[_0x7b0d04(0x10a)]='Очистить\x20историю?';if(mText)mText[_0x7b0d04(0x10a)]=_0x7b0d04(0xf9);modalCallback=async()=>{const _0x4affba=_0x7b0d04;messages=[],localStorage[_0x4affba(0x142)](_0x4affba(0x115)),renderMessages(),callBackend(_0x4affba(0x102),{});},modal[_0x7b0d04(0xc7)][_0x7b0d04(0xf0)](_0x7b0d04(0xfc));};document[a0_0xbb6953(0x13d)](a0_0xbb6953(0xf5))[a0_0xbb6953(0xeb)]=()=>modal[a0_0xbb6953(0xc7)]['remove'](a0_0xbb6953(0xfc)),document['getElementById']('modalConfirm')[a0_0xbb6953(0xeb)]=()=>{const _0xc8e5ae=a0_0xbb6953;if(modalCallback)modalCallback();modal[_0xc8e5ae(0xc7)][_0xc8e5ae(0xf1)]('show');},messageInput[a0_0xbb6953(0x127)](a0_0xbb6953(0xf7),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0xbb6953(0xd9),_0x135565=>{const _0x41f9c7=a0_0xbb6953;_0x135565[_0x41f9c7(0xce)]==='Enter'&&!_0x135565[_0x41f9c7(0x141)]&&(_0x135565[_0x41f9c7(0x133)](),sendMessage());}),sendBtn[a0_0xbb6953(0xeb)]=sendMessage,document[a0_0xbb6953(0x127)](a0_0xbb6953(0x123),_0x3a6b88=>{const _0x14b1da=a0_0xbb6953;document[_0x14b1da(0x139)](_0x14b1da(0x113))[_0x14b1da(0x112)](_0xdd9dba=>{const _0x4b9f60=_0x14b1da;if(!_0xdd9dba[_0x4b9f60(0x14b)](_0x3a6b88[_0x4b9f60(0xf6)]))_0xdd9dba[_0x4b9f60(0xc7)]['remove'](_0x4b9f60(0x148));});});const saved=localStorage[a0_0xbb6953(0xe9)]('ai_chat_messages');function a0_0x503b(_0x167b51,_0x23470d){_0x167b51=_0x167b51-0xc7;const _0x257b81=a0_0x40b8();let _0x57e6a4=_0x257b81[_0x167b51];return _0x57e6a4;}function a0_0x40b8(){const _0x30ab29=['textContent','typingIndicator','viewportHeight','stopPropagation','appendChild','parse','padStart','success','forEach','.message.show-delete','3292VfmiFe','ai_chat_messages','20AVlARQ','scrollTop','impactOccurred','signal','modalTitle','setHeaderColor','text/plain','Ошибка\x20сервера','stringify','delete-btn','innerHTML','WebApp','send_message','click','message\x20','Ошибка\x20сети','4344272QEngxA','addEventListener','abort','replace','value','chatArea','Пустой\x20ответ','getHours','initData','none','TG\x20setup\x20error:','debug_uid','isVersionAtLeast','preventDefault','div','toString','from','username','confirmModal','querySelectorAll','489BJPFcL','onClick','touchstart','getElementById','floor','querySelector','search','shiftKey','removeItem','expand','user','offsetHeight','messageInput','<br>','show-delete','1341840fZHNPG','function','contains','classList','viewportChanged','onEvent','POST','min','1719801BOXipn','touchend','key','constructor','11831099gwuTmH','emptyState','children','push','json','style','getMinutes','message-bubble','127307AluPiS','keydown','createElement','.container','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','220PJAxzF','ready','message-time','Удалить?','random','className','message\x20ai','sendBtn','HapticFeedback','setItem','length','flex','getItem','focus','onclick','now','warn','trim','./router.html','add','remove','paddingBottom','clearBtn','innerHeight','modalCancel','target','input','href','Начнется\x20новый\x20диалог.','display','1439670cYjbnA','show','timestamp','light','#050505','height','offClick','clear_history','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','Telegram','BackButton','(((.+)+)+)+$','error','role','scrollHeight'];a0_0x40b8=function(){return _0x30ab29;};return a0_0x40b8();}if(saved)try{messages=JSON[a0_0xbb6953(0x10f)](saved),renderMessages();}catch(a0_0x4c88cb){}updateSendButton();