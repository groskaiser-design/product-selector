const a0_0x5e7b97=a0_0x412a;(function(_0x44ae0c,_0x3a9f73){const _0x53bf4b=a0_0x412a,_0x1f013d=_0x44ae0c();while(!![]){try{const _0xea7066=-parseInt(_0x53bf4b(0x142))/0x1+parseInt(_0x53bf4b(0x111))/0x2+-parseInt(_0x53bf4b(0xea))/0x3*(parseInt(_0x53bf4b(0x14f))/0x4)+parseInt(_0x53bf4b(0x135))/0x5+parseInt(_0x53bf4b(0x136))/0x6*(parseInt(_0x53bf4b(0x12a))/0x7)+-parseInt(_0x53bf4b(0x102))/0x8*(-parseInt(_0x53bf4b(0x149))/0x9)+-parseInt(_0x53bf4b(0xfe))/0xa*(parseInt(_0x53bf4b(0xd2))/0xb);if(_0xea7066===_0x3a9f73)break;else _0x1f013d['push'](_0x1f013d['shift']());}catch(_0x35624f){_0x1f013d['push'](_0x1f013d['shift']());}}}(a0_0x5031,0x22f76));const tg=window[a0_0x5e7b97(0x14c)]?.['WebApp'],HOME_URL=a0_0x5e7b97(0x104);function setupTelegramBackButton(){const _0x37a6f0=a0_0x5e7b97,_0x1d7a11=(function(){let _0x2002b0=!![];return function(_0x5eb8a4,_0x1c0849){const _0xd2efc7=_0x2002b0?function(){const _0x42ac53=a0_0x412a;if(_0x1c0849){const _0x156c45=_0x1c0849[_0x42ac53(0x10d)](_0x5eb8a4,arguments);return _0x1c0849=null,_0x156c45;}}:function(){};return _0x2002b0=![],_0xd2efc7;};}()),_0x112f55=_0x1d7a11(this,function(){const _0x2cb3fc=a0_0x412a;return _0x112f55[_0x2cb3fc(0xf1)]()[_0x2cb3fc(0xcf)](_0x2cb3fc(0xe0))[_0x2cb3fc(0xf1)]()['constructor'](_0x112f55)[_0x2cb3fc(0xcf)](_0x2cb3fc(0xe0));});_0x112f55();if(!tg)return;try{tg[_0x37a6f0(0xdc)](),tg[_0x37a6f0(0x14d)](),tg[_0x37a6f0(0x140)]?.(_0x37a6f0(0xf5));if(tg[_0x37a6f0(0xf0)]?.(_0x37a6f0(0x124)))tg[_0x37a6f0(0x13b)]?.();const _0x500c2b=tg['BackButton'];if(_0x500c2b){_0x500c2b[_0x37a6f0(0x118)]();if(typeof _0x500c2b['offClick']==='function')try{_0x500c2b[_0x37a6f0(0xf9)]();}catch(_0x315020){}_0x500c2b['onClick'](()=>{const _0x32525e=_0x37a6f0;if(tg['HapticFeedback'])tg[_0x32525e(0xf2)][_0x32525e(0x126)](_0x32525e(0xd8));location[_0x32525e(0xe7)]=HOME_URL;});}}catch(_0x414f55){console[_0x37a6f0(0xff)](_0x37a6f0(0x10e),_0x414f55);}}(function initStableLayout(){const _0x141ced=a0_0x5e7b97,_0x282c1a=document[_0x141ced(0xdb)](_0x141ced(0x134)),_0x3de7e5=document[_0x141ced(0xd4)](_0x141ced(0xd9)),_0x1660ae=document[_0x141ced(0xd4)]('chatArea'),_0x32ad54=document[_0x141ced(0xd4)](_0x141ced(0x132));function _0x476b88(){const _0x1cb3c6=_0x141ced;if(!_0x282c1a)return;const _0x1bb749=tg&&tg[_0x1cb3c6(0xf7)]?tg['viewportHeight']:window['innerHeight'];_0x282c1a[_0x1cb3c6(0x100)][_0x1cb3c6(0x14b)]=_0x1bb749+'px';if(_0x3de7e5){const _0x47de3f=_0x3de7e5[_0x1cb3c6(0x117)];_0x1660ae[_0x1cb3c6(0x100)][_0x1cb3c6(0xfa)]=_0x47de3f+0x28+'px';}}tg?tg['onEvent'](_0x141ced(0x129),({isStateStable:_0x443975})=>{_0x476b88();if(_0x443975)requestAnimationFrame(()=>{const _0x1ae322=a0_0x412a;_0x1660ae[_0x1ae322(0x144)]=_0x1660ae['scrollHeight'];});}):window['addEventListener'](_0x141ced(0x13a),_0x476b88),_0x476b88(),_0x32ad54&&(_0x32ad54[_0x141ced(0x11b)](_0x141ced(0x130),()=>{requestAnimationFrame(_0x476b88);}),_0x32ad54[_0x141ced(0x11b)](_0x141ced(0xda),()=>{setTimeout(()=>{const _0x27c975=a0_0x412a;_0x1660ae[_0x27c975(0x144)]=_0x1660ae[_0x27c975(0x143)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5e7b97(0x14a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5e7b97(0xd4)](a0_0x5e7b97(0xd1)),emptyState=document[a0_0x5e7b97(0xd4)](a0_0x5e7b97(0x10b)),messageInput=document['getElementById'](a0_0x5e7b97(0x132)),sendBtn=document[a0_0x5e7b97(0xd4)](a0_0x5e7b97(0x122)),clearBtn=document[a0_0x5e7b97(0xd4)](a0_0x5e7b97(0x119)),modal=document[a0_0x5e7b97(0xd4)]('confirmModal'),mTitle=document[a0_0x5e7b97(0xd4)](a0_0x5e7b97(0x13e)),mText=document[a0_0x5e7b97(0xd4)](a0_0x5e7b97(0xd0));function a0_0x412a(_0x5847b7,_0x420697){_0x5847b7=_0x5847b7-0xce;const _0x55feca=a0_0x5031();let _0x12d762=_0x55feca[_0x5847b7];return _0x12d762;}let modalCallback=null;async function callBackend(_0xb4de0d,_0x4d87c6){const _0x92135e=a0_0x5e7b97,_0x1b76e5=tg?.['initDataUnsafe']?.[_0x92135e(0x114)]||{},_0x254528=_0x1b76e5['id']||localStorage[_0x92135e(0x116)](_0x92135e(0x131))||'d-'+Math['floor'](Math[_0x92135e(0xd3)]()*0x3b9aca00);if(!_0x1b76e5['id'])localStorage['setItem'](_0x92135e(0x131),_0x254528);const _0x4c0f4b={'action':_0xb4de0d,'user_id':_0x254528,'user_data':{'first_name':_0x1b76e5['first_name'],'username':_0x1b76e5[_0x92135e(0x125)]},'init_data':tg?.[_0x92135e(0xef)]||'',..._0x4d87c6},_0x1d3a74=new AbortController(),_0x4cbe1c=setTimeout(()=>_0x1d3a74['abort'](),REQUEST_TIMEOUT_MS);try{const _0x51c72b=await fetch(BACKEND_URL,{'method':_0x92135e(0x11d),'headers':{'Content-Type':_0x92135e(0xfb)},'body':JSON[_0x92135e(0x141)](_0x4c0f4b),'signal':_0x1d3a74[_0x92135e(0x103)]});return clearTimeout(_0x4cbe1c),await _0x51c72b[_0x92135e(0xe9)]();}catch(_0x449176){return{'success':![],'error':String(_0x449176)};}}function formatTime(_0x237bfb){const _0x42fbd5=a0_0x5e7b97,_0x2d36a0=new Date(_0x237bfb);return String(_0x2d36a0[_0x42fbd5(0xdd)]())[_0x42fbd5(0x107)](0x2,'0')+':'+String(_0x2d36a0[_0x42fbd5(0x120)]())['padStart'](0x2,'0');}function createMessageElement(_0x597040,_0x4bfdf3){const _0x4537e8=a0_0x5e7b97,_0x4dddc2=document[_0x4537e8(0x121)](_0x4537e8(0x148));_0x4dddc2[_0x4537e8(0x123)]=_0x4537e8(0x12c)+_0x597040[_0x4537e8(0x12f)];const _0x5d2929=document[_0x4537e8(0x121)](_0x4537e8(0x148));_0x5d2929[_0x4537e8(0x123)]='message-bubble',_0x5d2929[_0x4537e8(0x145)]=_0x597040[_0x4537e8(0xce)][_0x4537e8(0x110)](/\n/g,'<br>');const _0x47574e=document[_0x4537e8(0x121)]('div');_0x47574e[_0x4537e8(0x123)]=_0x4537e8(0xfd),_0x47574e[_0x4537e8(0x145)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x47574e[_0x4537e8(0xf6)]=_0x4ce049=>{const _0x29f6ab=_0x4537e8;_0x4ce049[_0x29f6ab(0x146)](),confirmDelete(_0x4bfdf3);};let _0x49717e;_0x5d2929[_0x4537e8(0x11b)]('touchstart',()=>_0x49717e=setTimeout(()=>{const _0x216930=_0x4537e8;_0x4dddc2['classList'][_0x216930(0x106)](_0x216930(0x14e));if(tg?.[_0x216930(0xf2)])tg['HapticFeedback'][_0x216930(0x126)](_0x216930(0x101));},0x1f4)),_0x5d2929[_0x4537e8(0x11b)](_0x4537e8(0xfc),()=>clearTimeout(_0x49717e));const _0x5f3dac=document[_0x4537e8(0x121)](_0x4537e8(0x148));return _0x5f3dac[_0x4537e8(0x123)]=_0x4537e8(0xe5),_0x5f3dac['textContent']=formatTime(_0x597040[_0x4537e8(0xe4)]),_0x4dddc2[_0x4537e8(0x112)](_0x47574e),_0x4dddc2[_0x4537e8(0x112)](_0x5d2929),_0x4dddc2[_0x4537e8(0x112)](_0x5f3dac),_0x4dddc2;}function createTypingIndicator(){const _0x5a8e46=a0_0x5e7b97,_0x1f5388=document[_0x5a8e46(0x121)](_0x5a8e46(0x148));return _0x1f5388[_0x5a8e46(0x123)]='message\x20ai',_0x1f5388['id']=_0x5a8e46(0x108),_0x1f5388[_0x5a8e46(0x145)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x1f5388;}function renderMessages(){const _0x37dea4=a0_0x5e7b97;Array[_0x37dea4(0xeb)](chatArea[_0x37dea4(0xe8)])['forEach'](_0x585fe1=>{const _0x3f3327=_0x37dea4;if(_0x585fe1['id']!==_0x3f3327(0x10b))_0x585fe1['remove']();}),messages[_0x37dea4(0x138)]>0x0?(emptyState[_0x37dea4(0x100)][_0x37dea4(0x12d)]=_0x37dea4(0x13f),messages[_0x37dea4(0x113)]((_0x49cbff,_0x440736)=>chatArea[_0x37dea4(0x112)](createMessageElement(_0x49cbff,_0x440736)))):emptyState['style'][_0x37dea4(0x12d)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x37dea4(0x143)]);}function autoResizeTextarea(){const _0x588001=a0_0x5e7b97;messageInput['style'][_0x588001(0x14b)]='auto',messageInput['style'][_0x588001(0x14b)]=Math[_0x588001(0x11a)](messageInput[_0x588001(0x143)],0x78)+'px';}function updateSendButton(){const _0x23e819=a0_0x5e7b97,_0x451b8a=messageInput[_0x23e819(0xf4)]['trim']();sendBtn[_0x23e819(0xee)]=!_0x451b8a||isTyping;}async function sendMessage(){const _0xc6bd6f=a0_0x5e7b97,_0x984a9f=messageInput['value'][_0xc6bd6f(0xec)]();if(!_0x984a9f||isTyping)return;if(tg?.[_0xc6bd6f(0xf2)])tg[_0xc6bd6f(0xf2)][_0xc6bd6f(0x126)](_0xc6bd6f(0xd8));messages[_0xc6bd6f(0x139)]({'role':_0xc6bd6f(0x114),'content':_0x984a9f,'timestamp':Date[_0xc6bd6f(0x115)]()}),localStorage['setItem'](_0xc6bd6f(0x127),JSON[_0xc6bd6f(0x141)](messages)),renderMessages(),messageInput[_0xc6bd6f(0xf4)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xc6bd6f(0x112)](createTypingIndicator()),chatArea[_0xc6bd6f(0x144)]=chatArea[_0xc6bd6f(0x143)];const _0x5da975=await callBackend(_0xc6bd6f(0xf3),{'message':_0x984a9f});isTyping=![];const _0x22eb42=document[_0xc6bd6f(0xd4)](_0xc6bd6f(0x108));if(_0x22eb42)_0x22eb42[_0xc6bd6f(0x105)]();let _0x6e4530='Ошибка\x20сети';if(_0x5da975['success']){_0x6e4530=_0x5da975[_0xc6bd6f(0x147)]||_0xc6bd6f(0x13d);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0xc6bd6f(0x13c)](_0xc6bd6f(0x10c));}else{_0x6e4530=_0x5da975[_0xc6bd6f(0x128)]||_0xc6bd6f(0xe3);if(tg?.[_0xc6bd6f(0xf2)])tg[_0xc6bd6f(0xf2)][_0xc6bd6f(0x13c)](_0xc6bd6f(0x128));}messages[_0xc6bd6f(0x139)]({'role':'ai','content':_0x6e4530,'timestamp':Date[_0xc6bd6f(0x115)]()}),localStorage[_0xc6bd6f(0xe2)](_0xc6bd6f(0x127),JSON[_0xc6bd6f(0x141)](messages)),renderMessages();}function confirmDelete(_0x490276){const _0x34f6da=a0_0x5e7b97;if(mTitle)mTitle[_0x34f6da(0xdf)]=_0x34f6da(0xe6);if(mText)mText[_0x34f6da(0xdf)]=_0x34f6da(0x133);modalCallback=()=>{const _0x502855=_0x34f6da;messages[_0x502855(0x12b)](_0x490276,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x502855(0x141)](messages)),renderMessages();},modal['classList'][_0x34f6da(0x106)]('show');}if(clearBtn)clearBtn[a0_0x5e7b97(0xf6)]=()=>{const _0x37f777=a0_0x5e7b97;if(!messages[_0x37f777(0x138)])return;if(mTitle)mTitle[_0x37f777(0xdf)]=_0x37f777(0x11f);if(mText)mText[_0x37f777(0xdf)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x30eff2=_0x37f777;messages=[],localStorage[_0x30eff2(0xd6)](_0x30eff2(0x127)),renderMessages(),callBackend(_0x30eff2(0xe1),{});},modal['classList'][_0x37f777(0x106)](_0x37f777(0x118));};function a0_0x5031(){const _0x4b04b=['show','clearBtn','min','addEventListener','modalCancel','POST','key','Очистить\x20историю?','getMinutes','createElement','sendBtn','className','6.1','username','impactOccurred','ai_chat_messages','error','viewportChanged','1401694RnVDmw','splice','message\x20','display','modalConfirm','role','input','debug_uid','messageInput','Действие\x20необратимо.','.container','931060wVkVWo','6ubBzfN','parse','length','push','resize','disableVerticalSwipes','notificationOccurred','Пустой\x20ответ','modalTitle','none','setHeaderColor','stringify','207779Qskpwu','scrollHeight','scrollTop','innerHTML','stopPropagation','text','div','369jXfPzU','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','height','Telegram','expand','show-delete','17044PemKCG','content','search','modalText','chatArea','99lARgki','random','getElementById','Enter','removeItem','shiftKey','light','inputArea','focus','querySelector','ready','getHours','classList','textContent','(((.+)+)+)+$','clear_history','setItem','Ошибка\x20сервера','timestamp','message-time','Удалить?','href','children','json','159IwdvQv','from','trim','.message.show-delete','disabled','initData','isVersionAtLeast','toString','HapticFeedback','send_message','value','#050505','onclick','viewportHeight','click','offClick','paddingBottom','text/plain','touchend','delete-btn','610BsnWym','warn','style','medium','2768BUGfiw','signal','./router.html','remove','add','padStart','typingIndicator','target','contains','emptyState','success','apply','TG\x20setup\x20error:','querySelectorAll','replace','353486NoVjwR','appendChild','forEach','user','now','getItem','offsetHeight'];a0_0x5031=function(){return _0x4b04b;};return a0_0x5031();}document[a0_0x5e7b97(0xd4)](a0_0x5e7b97(0x11c))['onclick']=()=>modal[a0_0x5e7b97(0xde)][a0_0x5e7b97(0x105)](a0_0x5e7b97(0x118)),document[a0_0x5e7b97(0xd4)](a0_0x5e7b97(0x12e))[a0_0x5e7b97(0xf6)]=()=>{const _0x50014a=a0_0x5e7b97;if(modalCallback)modalCallback();modal[_0x50014a(0xde)][_0x50014a(0x105)](_0x50014a(0x118));},messageInput[a0_0x5e7b97(0x11b)](a0_0x5e7b97(0x130),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5e7b97(0x11b)]('keydown',_0x34782d=>{const _0x122066=a0_0x5e7b97;_0x34782d[_0x122066(0x11e)]===_0x122066(0xd5)&&!_0x34782d[_0x122066(0xd7)]&&(_0x34782d['preventDefault'](),sendMessage());}),sendBtn[a0_0x5e7b97(0xf6)]=sendMessage,document[a0_0x5e7b97(0x11b)](a0_0x5e7b97(0xf8),_0x4095c1=>{const _0x1cc0e5=a0_0x5e7b97;document[_0x1cc0e5(0x10f)](_0x1cc0e5(0xed))['forEach'](_0x15d5f8=>{const _0x515b3d=_0x1cc0e5;if(!_0x15d5f8[_0x515b3d(0x10a)](_0x4095c1[_0x515b3d(0x109)]))_0x15d5f8[_0x515b3d(0xde)][_0x515b3d(0x105)]('show-delete');});});const saved=localStorage[a0_0x5e7b97(0x116)](a0_0x5e7b97(0x127));if(saved)try{messages=JSON[a0_0x5e7b97(0x137)](saved),renderMessages();}catch(a0_0x219705){}updateSendButton();