const a0_0x1c5430=a0_0x1858;(function(_0x1b5f92,_0x15bdee){const _0x45b5ea=a0_0x1858,_0x333d1d=_0x1b5f92();while(!![]){try{const _0x26abce=parseInt(_0x45b5ea(0x10f))/0x1+parseInt(_0x45b5ea(0x12d))/0x2*(-parseInt(_0x45b5ea(0x11f))/0x3)+-parseInt(_0x45b5ea(0x11c))/0x4+-parseInt(_0x45b5ea(0xfa))/0x5+parseInt(_0x45b5ea(0xd4))/0x6+parseInt(_0x45b5ea(0x10d))/0x7*(-parseInt(_0x45b5ea(0xda))/0x8)+parseInt(_0x45b5ea(0xe8))/0x9;if(_0x26abce===_0x15bdee)break;else _0x333d1d['push'](_0x333d1d['shift']());}catch(_0x20b4c5){_0x333d1d['push'](_0x333d1d['shift']());}}}(a0_0x3c0c,0xeb3d9));function a0_0x3c0c(){const _0x1b6487=['click','createElement','6.1','onclick','constructor','BackButton','keydown','text','warn','clear_history','getItem','modalTitle','103784ZISPvZ','forEach','focus','onClick','querySelector','textContent','error','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','HapticFeedback','notificationOccurred','href','toString','initDataUnsafe','getHours','show-delete','random','ai_chat_messages','chatArea','modalText','getMinutes','username','offsetHeight','disabled','./router.html','setItem','success','style','classList','div','(((.+)+)+)+$','innerHeight','resize','light','Начнется\x20новый\x20диалог.','flex','initData','inputArea','3038790ARZXLg','stopPropagation','viewportHeight','add','content','onEvent','11720kPwdoG','viewportChanged','signal','send_message','expand','Очистить\x20историю?','impactOccurred','querySelectorAll','paddingBottom','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Telegram','POST','clearBtn','key','38211732wICXeV','scrollTop','setHeaderColor','trim','floor','abort','timestamp','TG\x20setup\x20error:','message\x20ai','Действие\x20необратимо.','appendChild','value','push','removeItem','show','confirmModal','className','<br>','9509145NVFbRl','shiftKey','modalCancel','message\x20','isVersionAtLeast','from','replace','modalConfirm','#050505','addEventListener','disableVerticalSwipes','.container','getElementById','input','function','messageInput','user','Ошибка\x20сети','preventDefault','8771TFGsZg','Удалить?','1669998jjCpHk','contains','search','typingIndicator','scrollHeight','offClick','height','auto','min','length','stringify','Enter','remove','2525840jXJdOU','now','innerHTML','63yjNWMv','padStart'];a0_0x3c0c=function(){return _0x1b6487;};return a0_0x3c0c();}const tg=window[a0_0x1c5430(0xe4)]?.['WebApp'],HOME_URL=a0_0x1c5430(0xc6);function setupTelegramBackButton(){const _0x53165d=a0_0x1c5430;if(!tg)return;try{tg['ready'](),tg[_0x53165d(0xde)](),tg[_0x53165d(0xea)]?.(_0x53165d(0x102));if(tg[_0x53165d(0xfe)]?.(_0x53165d(0x123)))tg[_0x53165d(0x104)]?.();const _0x27a3a7=tg[_0x53165d(0x126)];if(_0x27a3a7){_0x27a3a7[_0x53165d(0xf6)]();if(typeof _0x27a3a7[_0x53165d(0x114)]===_0x53165d(0x108))try{_0x27a3a7['offClick']();}catch(_0x5c5c18){}_0x27a3a7[_0x53165d(0x130)](()=>{const _0x1e70ae=_0x53165d;if(tg['HapticFeedback'])tg[_0x1e70ae(0x135)][_0x1e70ae(0xe0)]('light');location[_0x1e70ae(0x137)]=HOME_URL;});}}catch(_0x1422f6){console[_0x53165d(0x129)](_0x53165d(0xef),_0x1422f6);}}(function initStableLayout(){const _0x4ddff7=a0_0x1c5430,_0x4cc7dd=(function(){let _0x35e318=!![];return function(_0x3cb4a8,_0xdc67ee){const _0x2ac194=_0x35e318?function(){if(_0xdc67ee){const _0x302353=_0xdc67ee['apply'](_0x3cb4a8,arguments);return _0xdc67ee=null,_0x302353;}}:function(){};return _0x35e318=![],_0x2ac194;};}()),_0x142424=document[_0x4ddff7(0x131)](_0x4ddff7(0x105)),_0x5eebcf=document[_0x4ddff7(0x106)](_0x4ddff7(0xd3)),_0x4fbf9f=document[_0x4ddff7(0x106)](_0x4ddff7(0xc0)),_0x52b47b=document[_0x4ddff7(0x106)](_0x4ddff7(0x109));function _0x14857a(){const _0xa4f18d=_0x4ddff7,_0x52a9dd=_0x4cc7dd(this,function(){const _0x3c1b6f=a0_0x1858;return _0x52a9dd['toString']()[_0x3c1b6f(0x111)](_0x3c1b6f(0xcc))[_0x3c1b6f(0x138)]()[_0x3c1b6f(0x125)](_0x52a9dd)[_0x3c1b6f(0x111)](_0x3c1b6f(0xcc));});_0x52a9dd();if(!_0x142424)return;const _0x5a0fd6=tg&&tg[_0xa4f18d(0xd6)]?tg[_0xa4f18d(0xd6)]:window[_0xa4f18d(0xcd)];_0x142424['style'][_0xa4f18d(0x115)]=_0x5a0fd6+'px';if(_0x5eebcf){const _0x4eb1bf=_0x5eebcf[_0xa4f18d(0xc4)];_0x4fbf9f[_0xa4f18d(0xc9)][_0xa4f18d(0xe2)]=_0x4eb1bf+0x28+'px';}}tg?tg[_0x4ddff7(0xd9)](_0x4ddff7(0xdb),({isStateStable:_0x1c62d8})=>{_0x14857a();if(_0x1c62d8)requestAnimationFrame(()=>{const _0x49476b=a0_0x1858;_0x4fbf9f[_0x49476b(0xe9)]=_0x4fbf9f[_0x49476b(0x113)];});}):window[_0x4ddff7(0x103)](_0x4ddff7(0xce),_0x14857a),_0x14857a(),_0x52b47b&&(_0x52b47b[_0x4ddff7(0x103)]('input',()=>{requestAnimationFrame(_0x14857a);}),_0x52b47b['addEventListener'](_0x4ddff7(0x12f),()=>{setTimeout(()=>{const _0x4aba77=a0_0x1858;_0x4fbf9f[_0x4aba77(0xe9)]=_0x4fbf9f['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1c5430(0xe3),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1c5430(0x106)](a0_0x1c5430(0xc0)),emptyState=document[a0_0x1c5430(0x106)]('emptyState'),messageInput=document['getElementById'](a0_0x1c5430(0x109)),sendBtn=document[a0_0x1c5430(0x106)]('sendBtn'),clearBtn=document[a0_0x1c5430(0x106)](a0_0x1c5430(0xe6)),modal=document[a0_0x1c5430(0x106)](a0_0x1c5430(0xf7)),mTitle=document[a0_0x1c5430(0x106)](a0_0x1c5430(0x12c)),mText=document[a0_0x1c5430(0x106)](a0_0x1c5430(0xc1));let modalCallback=null;async function callBackend(_0x1b59e6,_0x3ad16c){const _0x275568=a0_0x1c5430,_0x19ba38=tg?.[_0x275568(0x139)]?.['user']||{},_0x3ddecd=_0x19ba38['id']||localStorage[_0x275568(0x12b)]('debug_uid')||'d-'+Math[_0x275568(0xec)](Math[_0x275568(0x13c)]()*0x3b9aca00);if(!_0x19ba38['id'])localStorage['setItem']('debug_uid',_0x3ddecd);const _0x4897f8={'action':_0x1b59e6,'user_id':_0x3ddecd,'user_data':{'first_name':_0x19ba38['first_name'],'username':_0x19ba38[_0x275568(0xc3)]},'init_data':tg?.[_0x275568(0xd2)]||'',..._0x3ad16c},_0x404ea8=new AbortController(),_0x356584=setTimeout(()=>_0x404ea8[_0x275568(0xed)](),REQUEST_TIMEOUT_MS);try{const _0xbc5da0=await fetch(BACKEND_URL,{'method':_0x275568(0xe5),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x275568(0x119)](_0x4897f8),'signal':_0x404ea8[_0x275568(0xdc)]});return clearTimeout(_0x356584),await _0xbc5da0['json']();}catch(_0x113446){return{'success':![],'error':String(_0x113446)};}}function formatTime(_0x1e218a){const _0x19e06f=a0_0x1c5430,_0x5e152f=new Date(_0x1e218a);return String(_0x5e152f[_0x19e06f(0x13a)]())[_0x19e06f(0x120)](0x2,'0')+':'+String(_0x5e152f[_0x19e06f(0xc2)]())[_0x19e06f(0x120)](0x2,'0');}function createMessageElement(_0x28a0e5,_0xaf4bd5){const _0x59c487=a0_0x1c5430,_0x38c9cb=document[_0x59c487(0x122)](_0x59c487(0xcb));_0x38c9cb[_0x59c487(0xf8)]=_0x59c487(0xfd)+_0x28a0e5['role'];const _0x57ece7=document['createElement']('div');_0x57ece7['className']='message-bubble',_0x57ece7['innerHTML']=_0x28a0e5[_0x59c487(0xd8)][_0x59c487(0x100)](/\n/g,_0x59c487(0xf9));const _0x3c9230=document['createElement']('div');_0x3c9230[_0x59c487(0xf8)]='delete-btn',_0x3c9230[_0x59c487(0x11e)]=_0x59c487(0x134),_0x3c9230[_0x59c487(0x124)]=_0x79ca9=>{const _0x439ccd=_0x59c487;_0x79ca9[_0x439ccd(0xd5)](),confirmDelete(_0xaf4bd5);};let _0x10f648;_0x57ece7[_0x59c487(0x103)]('touchstart',()=>_0x10f648=setTimeout(()=>{const _0x59a156=_0x59c487;_0x38c9cb['classList']['add'](_0x59a156(0x13b));if(tg?.[_0x59a156(0x135)])tg[_0x59a156(0x135)][_0x59a156(0xe0)]('medium');},0x1f4)),_0x57ece7[_0x59c487(0x103)]('touchend',()=>clearTimeout(_0x10f648));const _0x20465c=document['createElement'](_0x59c487(0xcb));return _0x20465c['className']='message-time',_0x20465c[_0x59c487(0x132)]=formatTime(_0x28a0e5[_0x59c487(0xee)]),_0x38c9cb[_0x59c487(0xf2)](_0x3c9230),_0x38c9cb[_0x59c487(0xf2)](_0x57ece7),_0x38c9cb['appendChild'](_0x20465c),_0x38c9cb;}function createTypingIndicator(){const _0x3bc187=a0_0x1c5430,_0x855188=document[_0x3bc187(0x122)](_0x3bc187(0xcb));return _0x855188[_0x3bc187(0xf8)]=_0x3bc187(0xf0),_0x855188['id']='typingIndicator',_0x855188[_0x3bc187(0x11e)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x855188;}function renderMessages(){const _0x58ee66=a0_0x1c5430;Array[_0x58ee66(0xff)](chatArea['children'])[_0x58ee66(0x12e)](_0x13859c=>{if(_0x13859c['id']!=='emptyState')_0x13859c['remove']();}),messages[_0x58ee66(0x118)]>0x0?(emptyState[_0x58ee66(0xc9)]['display']='none',messages[_0x58ee66(0x12e)]((_0x2294bb,_0x4f02de)=>chatArea[_0x58ee66(0xf2)](createMessageElement(_0x2294bb,_0x4f02de)))):emptyState[_0x58ee66(0xc9)]['display']=_0x58ee66(0xd1),requestAnimationFrame(()=>chatArea[_0x58ee66(0xe9)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x4b7a0b=a0_0x1c5430;messageInput[_0x4b7a0b(0xc9)]['height']=_0x4b7a0b(0x116),messageInput[_0x4b7a0b(0xc9)][_0x4b7a0b(0x115)]=Math[_0x4b7a0b(0x117)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x25eea7=a0_0x1c5430,_0x369f4b=messageInput['value'][_0x25eea7(0xeb)]();sendBtn[_0x25eea7(0xc5)]=!_0x369f4b||isTyping;}async function sendMessage(){const _0x20c4ff=a0_0x1c5430,_0x367e9a=messageInput[_0x20c4ff(0xf3)][_0x20c4ff(0xeb)]();if(!_0x367e9a||isTyping)return;if(tg?.[_0x20c4ff(0x135)])tg[_0x20c4ff(0x135)][_0x20c4ff(0xe0)](_0x20c4ff(0xcf));messages[_0x20c4ff(0xf4)]({'role':_0x20c4ff(0x10a),'content':_0x367e9a,'timestamp':Date[_0x20c4ff(0x11d)]()}),localStorage[_0x20c4ff(0xc7)]('ai_chat_messages',JSON[_0x20c4ff(0x119)](messages)),renderMessages(),messageInput[_0x20c4ff(0xf3)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x20c4ff(0xf2)](createTypingIndicator()),chatArea[_0x20c4ff(0xe9)]=chatArea[_0x20c4ff(0x113)];const _0x1ab379=await callBackend(_0x20c4ff(0xdd),{'message':_0x367e9a});isTyping=![];const _0x4ef9d6=document[_0x20c4ff(0x106)](_0x20c4ff(0x112));if(_0x4ef9d6)_0x4ef9d6[_0x20c4ff(0x11b)]();let _0x1815ad=_0x20c4ff(0x10b);if(_0x1ab379[_0x20c4ff(0xc8)]){_0x1815ad=_0x1ab379[_0x20c4ff(0x128)]||'Пустой\x20ответ';if(tg?.[_0x20c4ff(0x135)])tg[_0x20c4ff(0x135)][_0x20c4ff(0x136)](_0x20c4ff(0xc8));}else{_0x1815ad=_0x1ab379[_0x20c4ff(0x133)]||'Ошибка\x20сервера';if(tg?.[_0x20c4ff(0x135)])tg[_0x20c4ff(0x135)][_0x20c4ff(0x136)](_0x20c4ff(0x133));}messages['push']({'role':'ai','content':_0x1815ad,'timestamp':Date[_0x20c4ff(0x11d)]()}),localStorage[_0x20c4ff(0xc7)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0xe33cc1){const _0x5a53b4=a0_0x1c5430;if(mTitle)mTitle['textContent']=_0x5a53b4(0x10e);if(mText)mText[_0x5a53b4(0x132)]=_0x5a53b4(0xf1);modalCallback=()=>{const _0x5e2346=_0x5a53b4;messages['splice'](_0xe33cc1,0x1),localStorage[_0x5e2346(0xc7)](_0x5e2346(0xbf),JSON[_0x5e2346(0x119)](messages)),renderMessages();},modal[_0x5a53b4(0xca)][_0x5a53b4(0xd7)](_0x5a53b4(0xf6));}if(clearBtn)clearBtn[a0_0x1c5430(0x124)]=()=>{const _0x4e4c9d=a0_0x1c5430;if(!messages[_0x4e4c9d(0x118)])return;if(mTitle)mTitle[_0x4e4c9d(0x132)]=_0x4e4c9d(0xdf);if(mText)mText['textContent']=_0x4e4c9d(0xd0);modalCallback=async()=>{const _0x2e9e03=_0x4e4c9d;messages=[],localStorage[_0x2e9e03(0xf5)]('ai_chat_messages'),renderMessages(),callBackend(_0x2e9e03(0x12a),{});},modal[_0x4e4c9d(0xca)][_0x4e4c9d(0xd7)](_0x4e4c9d(0xf6));};document[a0_0x1c5430(0x106)](a0_0x1c5430(0xfc))['onclick']=()=>modal['classList'][a0_0x1c5430(0x11b)](a0_0x1c5430(0xf6)),document[a0_0x1c5430(0x106)](a0_0x1c5430(0x101))[a0_0x1c5430(0x124)]=()=>{const _0xd61c65=a0_0x1c5430;if(modalCallback)modalCallback();modal[_0xd61c65(0xca)]['remove'](_0xd61c65(0xf6));},messageInput[a0_0x1c5430(0x103)](a0_0x1c5430(0x107),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1c5430(0x103)](a0_0x1c5430(0x127),_0x379e75=>{const _0xd23a53=a0_0x1c5430;_0x379e75[_0xd23a53(0xe7)]===_0xd23a53(0x11a)&&!_0x379e75[_0xd23a53(0xfb)]&&(_0x379e75[_0xd23a53(0x10c)](),sendMessage());}),sendBtn[a0_0x1c5430(0x124)]=sendMessage,document[a0_0x1c5430(0x103)](a0_0x1c5430(0x121),_0x3dffff=>{const _0x34883b=a0_0x1c5430;document[_0x34883b(0xe1)]('.message.show-delete')[_0x34883b(0x12e)](_0x1d345a=>{const _0x4e694b=_0x34883b;if(!_0x1d345a[_0x4e694b(0x110)](_0x3dffff['target']))_0x1d345a['classList'][_0x4e694b(0x11b)](_0x4e694b(0x13b));});});const saved=localStorage[a0_0x1c5430(0x12b)](a0_0x1c5430(0xbf));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x3085ce){}function a0_0x1858(_0x189979,_0x5d8d92){_0x189979=_0x189979-0xbf;const _0x2e1bad=a0_0x3c0c();let _0x3d2242=_0x2e1bad[_0x189979];return _0x3d2242;}updateSendButton();