function a0_0x1d1b(_0x314ca5,_0x52d766){_0x314ca5=_0x314ca5-0xe1;const _0x28f568=a0_0x3368();let _0x260464=_0x28f568[_0x314ca5];return _0x260464;}const a0_0x1674a9=a0_0x1d1b;(function(_0xb5f8a,_0x24aed4){const _0x2addc5=a0_0x1d1b,_0x2e0ac8=_0xb5f8a();while(!![]){try{const _0x31a688=parseInt(_0x2addc5(0x139))/0x1*(-parseInt(_0x2addc5(0x115))/0x2)+-parseInt(_0x2addc5(0xf6))/0x3*(parseInt(_0x2addc5(0x136))/0x4)+-parseInt(_0x2addc5(0x124))/0x5*(parseInt(_0x2addc5(0x15e))/0x6)+parseInt(_0x2addc5(0x13e))/0x7*(-parseInt(_0x2addc5(0x110))/0x8)+-parseInt(_0x2addc5(0x102))/0x9*(parseInt(_0x2addc5(0xf0))/0xa)+parseInt(_0x2addc5(0x12a))/0xb*(-parseInt(_0x2addc5(0x116))/0xc)+parseInt(_0x2addc5(0x138))/0xd*(parseInt(_0x2addc5(0x103))/0xe);if(_0x31a688===_0x24aed4)break;else _0x2e0ac8['push'](_0x2e0ac8['shift']());}catch(_0x37618e){_0x2e0ac8['push'](_0x2e0ac8['shift']());}}}(a0_0x3368,0xa83d3));const tg=window[a0_0x1674a9(0xe7)]?.['WebApp'],HOME_URL=a0_0x1674a9(0x15f);function setupTelegramBackButton(){const _0x4328d5=a0_0x1674a9;if(!tg)return;try{tg[_0x4328d5(0x145)](),tg[_0x4328d5(0x111)](),tg[_0x4328d5(0x13b)]?.('#050505');if(tg[_0x4328d5(0x10f)]?.('6.1'))tg[_0x4328d5(0x12d)]?.();const _0x29e159=tg[_0x4328d5(0x121)];if(_0x29e159){_0x29e159[_0x4328d5(0xe4)]();if(typeof _0x29e159[_0x4328d5(0x105)]==='function')try{_0x29e159[_0x4328d5(0x105)]();}catch(_0x281c93){}_0x29e159[_0x4328d5(0x119)](()=>{const _0x3bb44e=_0x4328d5;if(tg[_0x3bb44e(0xfc)])tg['HapticFeedback']['impactOccurred']('light');location[_0x3bb44e(0x14a)]=HOME_URL;});}}catch(_0xe5ff5b){console['warn'](_0x4328d5(0x100),_0xe5ff5b);}}(function initStableLayout(){const _0xf3e118=a0_0x1674a9,_0x189d96=(function(){let _0x491476=!![];return function(_0x11d895,_0x16f1cc){const _0xbb357a=_0x491476?function(){if(_0x16f1cc){const _0x4db73f=_0x16f1cc['apply'](_0x11d895,arguments);return _0x16f1cc=null,_0x4db73f;}}:function(){};return _0x491476=![],_0xbb357a;};}()),_0x381441=document[_0xf3e118(0x10b)](_0xf3e118(0x15a)),_0x9d5c16=document[_0xf3e118(0x14d)]('inputArea'),_0x1af45d=document[_0xf3e118(0x14d)](_0xf3e118(0xe1)),_0x4a2870=document[_0xf3e118(0x14d)]('messageInput');function _0x276e35(){const _0x2effa4=_0xf3e118,_0x2abc61=_0x189d96(this,function(){const _0x277d74=a0_0x1d1b;return _0x2abc61['toString']()[_0x277d74(0xef)](_0x277d74(0xe3))['toString']()[_0x277d74(0x153)](_0x2abc61)['search'](_0x277d74(0xe3));});_0x2abc61();if(!_0x381441)return;const _0x5678ef=tg&&tg[_0x2effa4(0xeb)]?tg[_0x2effa4(0xeb)]:window['innerHeight'];_0x381441['style'][_0x2effa4(0x15b)]=_0x5678ef+'px';if(_0x9d5c16){const _0x932e93=_0x9d5c16['offsetHeight'];_0x1af45d[_0x2effa4(0x12f)][_0x2effa4(0x10a)]=_0x932e93+0x28+'px';}}tg?tg[_0xf3e118(0x152)]('viewportChanged',({isStateStable:_0x570a2e})=>{_0x276e35();if(_0x570a2e)requestAnimationFrame(()=>{const _0xa0878c=a0_0x1d1b;_0x1af45d[_0xa0878c(0xee)]=_0x1af45d[_0xa0878c(0x141)];});}):window[_0xf3e118(0xed)](_0xf3e118(0xe8),_0x276e35),_0x276e35(),_0x4a2870&&(_0x4a2870[_0xf3e118(0xed)](_0xf3e118(0x160),()=>{requestAnimationFrame(_0x276e35);}),_0x4a2870[_0xf3e118(0xed)](_0xf3e118(0x10d),()=>{setTimeout(()=>{const _0x2e1227=a0_0x1d1b;_0x1af45d[_0x2e1227(0xee)]=_0x1af45d[_0x2e1227(0x141)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1674a9(0x122),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1674a9(0x14d)](a0_0x1674a9(0xe1)),emptyState=document['getElementById'](a0_0x1674a9(0x11f)),messageInput=document[a0_0x1674a9(0x14d)](a0_0x1674a9(0x140)),sendBtn=document[a0_0x1674a9(0x14d)]('sendBtn'),clearBtn=document[a0_0x1674a9(0x14d)]('clearBtn'),modal=document[a0_0x1674a9(0x14d)](a0_0x1674a9(0x11b)),mTitle=document[a0_0x1674a9(0x14d)](a0_0x1674a9(0x15d)),mText=document[a0_0x1674a9(0x14d)](a0_0x1674a9(0x154));let modalCallback=null;async function callBackend(_0x5bbb87,_0x30a940){const _0x59338b=a0_0x1674a9,_0x50d41f=tg?.[_0x59338b(0x157)]?.['user']||{},_0x33bc3b=_0x50d41f['id']||localStorage[_0x59338b(0x10e)](_0x59338b(0xf7))||'d-'+Math[_0x59338b(0xe2)](Math[_0x59338b(0x132)]()*0x3b9aca00);if(!_0x50d41f['id'])localStorage[_0x59338b(0x14e)]('debug_uid',_0x33bc3b);const _0x2b03af={'action':_0x5bbb87,'user_id':_0x33bc3b,'user_data':{'first_name':_0x50d41f[_0x59338b(0x150)],'username':_0x50d41f['username']},'init_data':tg?.['initData']||'',..._0x30a940},_0x1f2469=new AbortController(),_0x2e9be9=setTimeout(()=>_0x1f2469[_0x59338b(0x13c)](),REQUEST_TIMEOUT_MS);try{const _0x4ec12a=await fetch(BACKEND_URL,{'method':_0x59338b(0x118),'headers':{'Content-Type':_0x59338b(0x133)},'body':JSON['stringify'](_0x2b03af),'signal':_0x1f2469[_0x59338b(0x114)]});return clearTimeout(_0x2e9be9),await _0x4ec12a[_0x59338b(0x117)]();}catch(_0x46ae5b){return{'success':![],'error':String(_0x46ae5b)};}}function formatTime(_0x315272){const _0x178857=a0_0x1674a9,_0x1cea12=new Date(_0x315272);return String(_0x1cea12[_0x178857(0x158)]())[_0x178857(0x11e)](0x2,'0')+':'+String(_0x1cea12[_0x178857(0xfb)]())[_0x178857(0x11e)](0x2,'0');}function a0_0x3368(){const _0x5874b=['702536mJtTqo','expand','push','disabled','signal','2sWTFhN','49548FzQKJl','json','POST','onClick','stopPropagation','confirmModal','target','typingIndicator','padStart','emptyState','Начнется\x20новый\x20диалог.','BackButton','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','now','6138245hWKVzZ','Действие\x20необратимо.','modalCancel','click','removeItem','onclick','3135Yfgdpw','classList','message\x20','disableVerticalSwipes','flex','style','impactOccurred','keydown','random','text/plain','notificationOccurred','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','2216RPYgGA','Enter','247evwRaf','1235977LSjhDb','content','setHeaderColor','abort','contains','91jIpYBz','touchstart','messageInput','scrollHeight','message-bubble','div','children','ready','timestamp','key','forEach','medium','href','innerHTML','length','getElementById','setItem','.message.show-delete','first_name','remove','onEvent','constructor','modalText','success','splice','initDataUnsafe','getHours','Очистить\x20историю?','.container','height','add','modalTitle','6LWPPpk','./router.html','input','chatArea','floor','(((.+)+)+)+$','show','show-delete','parse','Telegram','resize','textContent','createElement','viewportHeight','delete-btn','addEventListener','scrollTop','search','10OuJgTN','Ошибка\x20сети','display','trim','stringify','className','6246KyPfip','debug_uid','shiftKey','from','<br>','getMinutes','HapticFeedback','touchend','min','none','TG\x20setup\x20error:','appendChild','2814426uOVLkg','5111666KpHAvU','light','offClick','error','Пустой\x20ответ','ai_chat_messages','value','paddingBottom','querySelector','role','focus','getItem','isVersionAtLeast'];a0_0x3368=function(){return _0x5874b;};return a0_0x3368();}function createMessageElement(_0x1faa47,_0xcbb2a3){const _0x1338ea=a0_0x1674a9,_0x1ba6c6=document[_0x1338ea(0xea)](_0x1338ea(0x143));_0x1ba6c6[_0x1338ea(0xf5)]=_0x1338ea(0x12c)+_0x1faa47[_0x1338ea(0x10c)];const _0x19b393=document[_0x1338ea(0xea)](_0x1338ea(0x143));_0x19b393[_0x1338ea(0xf5)]=_0x1338ea(0x142),_0x19b393[_0x1338ea(0x14b)]=_0x1faa47[_0x1338ea(0x13a)]['replace'](/\n/g,_0x1338ea(0xfa));const _0x4562e2=document[_0x1338ea(0xea)](_0x1338ea(0x143));_0x4562e2['className']=_0x1338ea(0xec),_0x4562e2[_0x1338ea(0x14b)]=_0x1338ea(0x135),_0x4562e2[_0x1338ea(0x129)]=_0x3fc80f=>{const _0x4d277c=_0x1338ea;_0x3fc80f[_0x4d277c(0x11a)](),confirmDelete(_0xcbb2a3);};let _0x453e6b;_0x19b393[_0x1338ea(0xed)](_0x1338ea(0x13f),()=>_0x453e6b=setTimeout(()=>{const _0x520895=_0x1338ea;_0x1ba6c6[_0x520895(0x12b)]['add'](_0x520895(0xe5));if(tg?.[_0x520895(0xfc)])tg[_0x520895(0xfc)][_0x520895(0x130)](_0x520895(0x149));},0x1f4)),_0x19b393[_0x1338ea(0xed)](_0x1338ea(0xfd),()=>clearTimeout(_0x453e6b));const _0x21884b=document[_0x1338ea(0xea)]('div');return _0x21884b[_0x1338ea(0xf5)]='message-time',_0x21884b['textContent']=formatTime(_0x1faa47[_0x1338ea(0x146)]),_0x1ba6c6['appendChild'](_0x4562e2),_0x1ba6c6[_0x1338ea(0x101)](_0x19b393),_0x1ba6c6[_0x1338ea(0x101)](_0x21884b),_0x1ba6c6;}function createTypingIndicator(){const _0x26f3cf=a0_0x1674a9,_0x40e847=document['createElement'](_0x26f3cf(0x143));return _0x40e847[_0x26f3cf(0xf5)]='message\x20ai',_0x40e847['id']=_0x26f3cf(0x11d),_0x40e847['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x40e847;}function renderMessages(){const _0x437dbc=a0_0x1674a9;Array[_0x437dbc(0xf9)](chatArea[_0x437dbc(0x144)])[_0x437dbc(0x148)](_0x241feb=>{const _0x1e3247=_0x437dbc;if(_0x241feb['id']!==_0x1e3247(0x11f))_0x241feb[_0x1e3247(0x151)]();}),messages[_0x437dbc(0x14c)]>0x0?(emptyState[_0x437dbc(0x12f)]['display']=_0x437dbc(0xff),messages['forEach']((_0x4b6293,_0x3b0112)=>chatArea['appendChild'](createMessageElement(_0x4b6293,_0x3b0112)))):emptyState[_0x437dbc(0x12f)][_0x437dbc(0xf2)]=_0x437dbc(0x12e),requestAnimationFrame(()=>chatArea[_0x437dbc(0xee)]=chatArea[_0x437dbc(0x141)]);}function autoResizeTextarea(){const _0x1da9be=a0_0x1674a9;messageInput[_0x1da9be(0x12f)][_0x1da9be(0x15b)]='auto',messageInput[_0x1da9be(0x12f)][_0x1da9be(0x15b)]=Math[_0x1da9be(0xfe)](messageInput[_0x1da9be(0x141)],0x78)+'px';}function updateSendButton(){const _0x846834=a0_0x1674a9,_0x57088a=messageInput[_0x846834(0x109)][_0x846834(0xf3)]();sendBtn[_0x846834(0x113)]=!_0x57088a||isTyping;}async function sendMessage(){const _0x273d8a=a0_0x1674a9,_0x502a9e=messageInput['value'][_0x273d8a(0xf3)]();if(!_0x502a9e||isTyping)return;if(tg?.[_0x273d8a(0xfc)])tg['HapticFeedback'][_0x273d8a(0x130)](_0x273d8a(0x104));messages[_0x273d8a(0x112)]({'role':'user','content':_0x502a9e,'timestamp':Date[_0x273d8a(0x123)]()}),localStorage[_0x273d8a(0x14e)](_0x273d8a(0x108),JSON[_0x273d8a(0xf4)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x273d8a(0x141)];const _0x39ab91=await callBackend('send_message',{'message':_0x502a9e});isTyping=![];const _0x148632=document[_0x273d8a(0x14d)](_0x273d8a(0x11d));if(_0x148632)_0x148632['remove']();let _0x370e4f=_0x273d8a(0xf1);if(_0x39ab91[_0x273d8a(0x155)]){_0x370e4f=_0x39ab91['text']||_0x273d8a(0x107);if(tg?.[_0x273d8a(0xfc)])tg[_0x273d8a(0xfc)][_0x273d8a(0x134)]('success');}else{_0x370e4f=_0x39ab91[_0x273d8a(0x106)]||'Ошибка\x20сервера';if(tg?.[_0x273d8a(0xfc)])tg[_0x273d8a(0xfc)][_0x273d8a(0x134)](_0x273d8a(0x106));}messages[_0x273d8a(0x112)]({'role':'ai','content':_0x370e4f,'timestamp':Date[_0x273d8a(0x123)]()}),localStorage[_0x273d8a(0x14e)](_0x273d8a(0x108),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x25eb33){const _0x34f7c1=a0_0x1674a9;if(mTitle)mTitle[_0x34f7c1(0xe9)]='Удалить?';if(mText)mText[_0x34f7c1(0xe9)]=_0x34f7c1(0x125);modalCallback=()=>{const _0x39d294=_0x34f7c1;messages[_0x39d294(0x156)](_0x25eb33,0x1),localStorage[_0x39d294(0x14e)](_0x39d294(0x108),JSON['stringify'](messages)),renderMessages();},modal[_0x34f7c1(0x12b)][_0x34f7c1(0x15c)](_0x34f7c1(0xe4));}if(clearBtn)clearBtn[a0_0x1674a9(0x129)]=()=>{const _0x12fe19=a0_0x1674a9;if(!messages['length'])return;if(mTitle)mTitle[_0x12fe19(0xe9)]=_0x12fe19(0x159);if(mText)mText['textContent']=_0x12fe19(0x120);modalCallback=async()=>{const _0x1f16ee=_0x12fe19;messages=[],localStorage[_0x1f16ee(0x128)](_0x1f16ee(0x108)),renderMessages(),callBackend('clear_history',{});},modal[_0x12fe19(0x12b)][_0x12fe19(0x15c)](_0x12fe19(0xe4));};document[a0_0x1674a9(0x14d)](a0_0x1674a9(0x126))[a0_0x1674a9(0x129)]=()=>modal[a0_0x1674a9(0x12b)][a0_0x1674a9(0x151)]('show'),document[a0_0x1674a9(0x14d)]('modalConfirm')[a0_0x1674a9(0x129)]=()=>{const _0x1da445=a0_0x1674a9;if(modalCallback)modalCallback();modal[_0x1da445(0x12b)]['remove']('show');},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1674a9(0xed)](a0_0x1674a9(0x131),_0x3c2db4=>{const _0x37ac8e=a0_0x1674a9;_0x3c2db4[_0x37ac8e(0x147)]===_0x37ac8e(0x137)&&!_0x3c2db4[_0x37ac8e(0xf8)]&&(_0x3c2db4['preventDefault'](),sendMessage());}),sendBtn[a0_0x1674a9(0x129)]=sendMessage,document[a0_0x1674a9(0xed)](a0_0x1674a9(0x127),_0x45e5f3=>{const _0x1ac1d5=a0_0x1674a9;document['querySelectorAll'](_0x1ac1d5(0x14f))[_0x1ac1d5(0x148)](_0x197773=>{const _0x1d0fc7=_0x1ac1d5;if(!_0x197773[_0x1d0fc7(0x13d)](_0x45e5f3[_0x1d0fc7(0x11c)]))_0x197773[_0x1d0fc7(0x12b)]['remove'](_0x1d0fc7(0xe5));});});const saved=localStorage[a0_0x1674a9(0x10e)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x1674a9(0xe6)](saved),renderMessages();}catch(a0_0x425b8b){}updateSendButton();