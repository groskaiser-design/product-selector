const a0_0x560860=a0_0x3f12;(function(_0x17dabd,_0xf6ee31){const _0x169384=a0_0x3f12,_0x16e1eb=_0x17dabd();while(!![]){try{const _0x2a119b=parseInt(_0x169384(0x249))/0x1+parseInt(_0x169384(0x235))/0x2+parseInt(_0x169384(0x260))/0x3*(-parseInt(_0x169384(0x213))/0x4)+parseInt(_0x169384(0x1f0))/0x5*(parseInt(_0x169384(0x23c))/0x6)+parseInt(_0x169384(0x21e))/0x7+-parseInt(_0x169384(0x264))/0x8+-parseInt(_0x169384(0x1ea))/0x9*(parseInt(_0x169384(0x1ff))/0xa);if(_0x2a119b===_0xf6ee31)break;else _0x16e1eb['push'](_0x16e1eb['shift']());}catch(_0xb522b4){_0x16e1eb['push'](_0x16e1eb['shift']());}}}(a0_0x569a,0x30256));const tg=window[a0_0x560860(0x257)]?.['WebApp'],HOME_URL=a0_0x560860(0x1ee);function setupTelegramBackButton(){const _0x54956b=a0_0x560860,_0x15f25a=(function(){let _0x14b374=!![];return function(_0x3233b9,_0x480c70){const _0x279a0e=_0x14b374?function(){const _0x41b9bc=a0_0x3f12;if(_0x480c70){const _0x191188=_0x480c70[_0x41b9bc(0x218)](_0x3233b9,arguments);return _0x480c70=null,_0x191188;}}:function(){};return _0x14b374=![],_0x279a0e;};}()),_0x59aa3e=_0x15f25a(this,function(){const _0x4080ae=a0_0x3f12;return _0x59aa3e['toString']()[_0x4080ae(0x228)](_0x4080ae(0x250))[_0x4080ae(0x211)]()['constructor'](_0x59aa3e)[_0x4080ae(0x228)](_0x4080ae(0x250));});_0x59aa3e();if(!tg)return;try{tg[_0x54956b(0x226)](),tg[_0x54956b(0x244)](),tg['setHeaderColor']?.(_0x54956b(0x222));if(tg[_0x54956b(0x238)]?.(_0x54956b(0x22b)))tg['disableVerticalSwipes']?.();const _0x59ca46=tg[_0x54956b(0x20b)];if(_0x59ca46){_0x59ca46['show']();if(typeof _0x59ca46[_0x54956b(0x229)]===_0x54956b(0x209))try{_0x59ca46['offClick']();}catch(_0x92416a){}_0x59ca46['onClick'](()=>{const _0x54ec3a=_0x54956b;if(tg['HapticFeedback'])tg['HapticFeedback'][_0x54ec3a(0x1ef)]('light');location[_0x54ec3a(0x215)]=HOME_URL;});}}catch(_0x3f9727){console['warn']('TG\x20setup\x20error:',_0x3f9727);}}(function initStableLayout(){const _0x42ba9b=a0_0x560860,_0xcc39f4=document['querySelector'](_0x42ba9b(0x24b)),_0x170b49=document[_0x42ba9b(0x240)](_0x42ba9b(0x25b)),_0x188520=document[_0x42ba9b(0x240)]('chatArea'),_0x7c1670=document[_0x42ba9b(0x240)](_0x42ba9b(0x219));function _0x38acc2(){const _0x5b5aa5=_0x42ba9b;if(!_0xcc39f4)return;const _0x29a5c4=tg&&tg['viewportHeight']?tg[_0x5b5aa5(0x21a)]:window[_0x5b5aa5(0x1fc)];_0xcc39f4[_0x5b5aa5(0x1f1)][_0x5b5aa5(0x239)]=_0x29a5c4+'px';if(_0x170b49){const _0x4562ac=_0x170b49[_0x5b5aa5(0x22a)];_0x188520[_0x5b5aa5(0x1f1)]['paddingBottom']=_0x4562ac+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x14db89})=>{_0x38acc2();if(_0x14db89)requestAnimationFrame(()=>{_0x188520['scrollTop']=_0x188520['scrollHeight'];});}):window['addEventListener'](_0x42ba9b(0x1f8),_0x38acc2),_0x38acc2(),_0x7c1670&&(_0x7c1670[_0x42ba9b(0x21f)](_0x42ba9b(0x205),()=>{requestAnimationFrame(_0x38acc2);}),_0x7c1670[_0x42ba9b(0x21f)]('focus',()=>{setTimeout(()=>{const _0x591135=a0_0x3f12;_0x188520[_0x591135(0x256)]=_0x188520[_0x591135(0x21b)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x3f12(_0x5519ae,_0x327f50){_0x5519ae=_0x5519ae-0x1e8;const _0x3b420d=a0_0x569a();let _0x53fa9b=_0x3b420d[_0x5519ae];return _0x53fa9b;}const BACKEND_URL=a0_0x560860(0x20d),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x569a(){const _0x115eda=['scrollHeight','HapticFeedback','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','1755985MrRVDj','addEventListener','<br>','stringify','#050505','setItem','flex','createElement','ready','modalTitle','search','offClick','offsetHeight','6.1','POST','message-time','children','floor','div','innerHTML','touchstart','modalConfirm','padStart','644840pnNdpy','username','Начнется\x20новый\x20диалог.','isVersionAtLeast','height','user','ai_chat_messages','57180bEKXEv','signal','content','error','getElementById','typingIndicator','Очистить\x20историю?','message\x20ai','expand','getItem','emptyState','modalText','classList','220000mVfcxS','role','.container','chatArea','timestamp','send_message','show-delete','(((.+)+)+)+$','preventDefault','key','removeItem','className','shiftKey','scrollTop','Telegram','min','keydown','touchend','inputArea','abort','Удалить?','length','sendBtn','135FtYVUj','message\x20','initDataUnsafe','appendChild','2525984GmrVah','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','push','clearBtn','from','add','confirmModal','parse','1718109WgMXsr','initData','delete-btn','value','./router.html','impactOccurred','160oNhDDi','style','stopPropagation','text/plain','querySelectorAll','show','now','disabled','resize','Ошибка\x20сети','Enter','success','innerHeight','Пустой\x20ответ','splice','10uxNgyP','light','trim','click','replace','onclick','input','debug_uid','display','contains','function','textContent','BackButton','Действие\x20необратимо.','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','remove','notificationOccurred','getMinutes','toString','first_name','35056zAMitk','medium','href','text','none','apply','messageInput','viewportHeight'];a0_0x569a=function(){return _0x115eda;};return a0_0x569a();}let messages=[],isTyping=![];const chatArea=document[a0_0x560860(0x240)](a0_0x560860(0x24c)),emptyState=document[a0_0x560860(0x240)](a0_0x560860(0x246)),messageInput=document[a0_0x560860(0x240)](a0_0x560860(0x219)),sendBtn=document[a0_0x560860(0x240)](a0_0x560860(0x25f)),clearBtn=document['getElementById'](a0_0x560860(0x267)),modal=document[a0_0x560860(0x240)](a0_0x560860(0x1e8)),mTitle=document[a0_0x560860(0x240)](a0_0x560860(0x227)),mText=document[a0_0x560860(0x240)](a0_0x560860(0x247));let modalCallback=null;async function callBackend(_0x85c3f9,_0x79391b){const _0x59fca1=a0_0x560860,_0x339cfb=tg?.[_0x59fca1(0x262)]?.[_0x59fca1(0x23a)]||{},_0x36b844=_0x339cfb['id']||localStorage[_0x59fca1(0x245)](_0x59fca1(0x206))||'d-'+Math[_0x59fca1(0x22f)](Math['random']()*0x3b9aca00);if(!_0x339cfb['id'])localStorage[_0x59fca1(0x223)](_0x59fca1(0x206),_0x36b844);const _0x2c489d={'action':_0x85c3f9,'user_id':_0x36b844,'user_data':{'first_name':_0x339cfb[_0x59fca1(0x212)],'username':_0x339cfb[_0x59fca1(0x236)]},'init_data':tg?.[_0x59fca1(0x1eb)]||'',..._0x79391b},_0x39b6cd=new AbortController(),_0x4f8ff5=setTimeout(()=>_0x39b6cd[_0x59fca1(0x25c)](),REQUEST_TIMEOUT_MS);try{const _0x20e3e7=await fetch(BACKEND_URL,{'method':_0x59fca1(0x22c),'headers':{'Content-Type':_0x59fca1(0x1f3)},'body':JSON['stringify'](_0x2c489d),'signal':_0x39b6cd[_0x59fca1(0x23d)]});return clearTimeout(_0x4f8ff5),await _0x20e3e7['json']();}catch(_0x5cf83e){return{'success':![],'error':String(_0x5cf83e)};}}function formatTime(_0x3bfa6e){const _0x136f6e=a0_0x560860,_0xf23ba0=new Date(_0x3bfa6e);return String(_0xf23ba0['getHours']())[_0x136f6e(0x234)](0x2,'0')+':'+String(_0xf23ba0[_0x136f6e(0x210)]())['padStart'](0x2,'0');}function createMessageElement(_0x339712,_0x1d6eeb){const _0x4408a6=a0_0x560860,_0xed49b3=document[_0x4408a6(0x225)](_0x4408a6(0x230));_0xed49b3['className']=_0x4408a6(0x261)+_0x339712[_0x4408a6(0x24a)];const _0x65cb5b=document[_0x4408a6(0x225)](_0x4408a6(0x230));_0x65cb5b['className']='message-bubble',_0x65cb5b[_0x4408a6(0x231)]=_0x339712[_0x4408a6(0x23e)][_0x4408a6(0x203)](/\n/g,_0x4408a6(0x220));const _0x316062=document['createElement'](_0x4408a6(0x230));_0x316062[_0x4408a6(0x254)]=_0x4408a6(0x1ec),_0x316062[_0x4408a6(0x231)]=_0x4408a6(0x265),_0x316062[_0x4408a6(0x204)]=_0x9de66c=>{const _0x40f23d=_0x4408a6;_0x9de66c[_0x40f23d(0x1f2)](),confirmDelete(_0x1d6eeb);};let _0x5b50b8;_0x65cb5b['addEventListener'](_0x4408a6(0x232),()=>_0x5b50b8=setTimeout(()=>{const _0x3e3e4e=_0x4408a6;_0xed49b3[_0x3e3e4e(0x248)][_0x3e3e4e(0x269)](_0x3e3e4e(0x24f));if(tg?.[_0x3e3e4e(0x21c)])tg[_0x3e3e4e(0x21c)]['impactOccurred'](_0x3e3e4e(0x214));},0x1f4)),_0x65cb5b[_0x4408a6(0x21f)](_0x4408a6(0x25a),()=>clearTimeout(_0x5b50b8));const _0x1f9b8a=document[_0x4408a6(0x225)](_0x4408a6(0x230));return _0x1f9b8a['className']=_0x4408a6(0x22d),_0x1f9b8a[_0x4408a6(0x20a)]=formatTime(_0x339712[_0x4408a6(0x24d)]),_0xed49b3['appendChild'](_0x316062),_0xed49b3[_0x4408a6(0x263)](_0x65cb5b),_0xed49b3['appendChild'](_0x1f9b8a),_0xed49b3;}function createTypingIndicator(){const _0x29c46c=a0_0x560860,_0x25265e=document['createElement']('div');return _0x25265e['className']=_0x29c46c(0x243),_0x25265e['id']=_0x29c46c(0x241),_0x25265e[_0x29c46c(0x231)]=_0x29c46c(0x21d),_0x25265e;}function renderMessages(){const _0x40e572=a0_0x560860;Array[_0x40e572(0x268)](chatArea[_0x40e572(0x22e)])['forEach'](_0x424ca0=>{const _0x330b5d=_0x40e572;if(_0x424ca0['id']!==_0x330b5d(0x246))_0x424ca0[_0x330b5d(0x20e)]();}),messages['length']>0x0?(emptyState['style'][_0x40e572(0x207)]=_0x40e572(0x217),messages['forEach']((_0x440508,_0x51982d)=>chatArea[_0x40e572(0x263)](createMessageElement(_0x440508,_0x51982d)))):emptyState[_0x40e572(0x1f1)][_0x40e572(0x207)]=_0x40e572(0x224),requestAnimationFrame(()=>chatArea[_0x40e572(0x256)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x254b53=a0_0x560860;messageInput[_0x254b53(0x1f1)][_0x254b53(0x239)]='auto',messageInput[_0x254b53(0x1f1)][_0x254b53(0x239)]=Math[_0x254b53(0x258)](messageInput[_0x254b53(0x21b)],0x78)+'px';}function updateSendButton(){const _0x26cf40=a0_0x560860,_0x444405=messageInput[_0x26cf40(0x1ed)][_0x26cf40(0x201)]();sendBtn[_0x26cf40(0x1f7)]=!_0x444405||isTyping;}async function sendMessage(){const _0x115718=a0_0x560860,_0x55a587=messageInput['value'][_0x115718(0x201)]();if(!_0x55a587||isTyping)return;if(tg?.[_0x115718(0x21c)])tg[_0x115718(0x21c)][_0x115718(0x1ef)](_0x115718(0x200));messages['push']({'role':_0x115718(0x23a),'content':_0x55a587,'timestamp':Date[_0x115718(0x1f6)]()}),localStorage[_0x115718(0x223)](_0x115718(0x23b),JSON[_0x115718(0x221)](messages)),renderMessages(),messageInput[_0x115718(0x1ed)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x115718(0x256)]=chatArea[_0x115718(0x21b)];const _0x47a234=await callBackend(_0x115718(0x24e),{'message':_0x55a587});isTyping=![];const _0x1b8e1b=document[_0x115718(0x240)](_0x115718(0x241));if(_0x1b8e1b)_0x1b8e1b[_0x115718(0x20e)]();let _0xb4044b=_0x115718(0x1f9);if(_0x47a234[_0x115718(0x1fb)]){_0xb4044b=_0x47a234[_0x115718(0x216)]||_0x115718(0x1fd);if(tg?.[_0x115718(0x21c)])tg[_0x115718(0x21c)][_0x115718(0x20f)](_0x115718(0x1fb));}else{_0xb4044b=_0x47a234[_0x115718(0x23f)]||'Ошибка\x20сервера';if(tg?.[_0x115718(0x21c)])tg[_0x115718(0x21c)][_0x115718(0x20f)](_0x115718(0x23f));}messages[_0x115718(0x266)]({'role':'ai','content':_0xb4044b,'timestamp':Date[_0x115718(0x1f6)]()}),localStorage[_0x115718(0x223)](_0x115718(0x23b),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0xe09eb3){const _0x12fab4=a0_0x560860;if(mTitle)mTitle[_0x12fab4(0x20a)]=_0x12fab4(0x25d);if(mText)mText['textContent']=_0x12fab4(0x20c);modalCallback=()=>{const _0x3f03f7=_0x12fab4;messages[_0x3f03f7(0x1fe)](_0xe09eb3,0x1),localStorage['setItem'](_0x3f03f7(0x23b),JSON[_0x3f03f7(0x221)](messages)),renderMessages();},modal[_0x12fab4(0x248)][_0x12fab4(0x269)]('show');}if(clearBtn)clearBtn[a0_0x560860(0x204)]=()=>{const _0x10eefe=a0_0x560860;if(!messages[_0x10eefe(0x25e)])return;if(mTitle)mTitle[_0x10eefe(0x20a)]=_0x10eefe(0x242);if(mText)mText[_0x10eefe(0x20a)]=_0x10eefe(0x237);modalCallback=async()=>{const _0x2964bb=_0x10eefe;messages=[],localStorage[_0x2964bb(0x253)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x10eefe(0x248)][_0x10eefe(0x269)]('show');};document[a0_0x560860(0x240)]('modalCancel')[a0_0x560860(0x204)]=()=>modal[a0_0x560860(0x248)][a0_0x560860(0x20e)](a0_0x560860(0x1f5)),document[a0_0x560860(0x240)](a0_0x560860(0x233))[a0_0x560860(0x204)]=()=>{const _0x5ee4f3=a0_0x560860;if(modalCallback)modalCallback();modal[_0x5ee4f3(0x248)]['remove']('show');},messageInput[a0_0x560860(0x21f)](a0_0x560860(0x205),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x560860(0x21f)](a0_0x560860(0x259),_0x233573=>{const _0x3c984b=a0_0x560860;_0x233573[_0x3c984b(0x252)]===_0x3c984b(0x1fa)&&!_0x233573[_0x3c984b(0x255)]&&(_0x233573[_0x3c984b(0x251)](),sendMessage());}),sendBtn[a0_0x560860(0x204)]=sendMessage,document['addEventListener'](a0_0x560860(0x202),_0x5eafb9=>{const _0x46228a=a0_0x560860;document[_0x46228a(0x1f4)]('.message.show-delete')['forEach'](_0x540074=>{const _0x3b41eb=_0x46228a;if(!_0x540074[_0x3b41eb(0x208)](_0x5eafb9['target']))_0x540074[_0x3b41eb(0x248)][_0x3b41eb(0x20e)](_0x3b41eb(0x24f));});});const saved=localStorage[a0_0x560860(0x245)](a0_0x560860(0x23b));if(saved)try{messages=JSON[a0_0x560860(0x1e9)](saved),renderMessages();}catch(a0_0x1ddb53){}updateSendButton();