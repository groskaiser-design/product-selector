const a0_0x49d4c0=a0_0x4aa3;(function(_0xc22427,_0x4613b2){const _0x44a471=a0_0x4aa3,_0x5774b3=_0xc22427();while(!![]){try{const _0x1fd25c=parseInt(_0x44a471(0x11e))/0x1*(-parseInt(_0x44a471(0xe6))/0x2)+parseInt(_0x44a471(0x110))/0x3*(-parseInt(_0x44a471(0xeb))/0x4)+-parseInt(_0x44a471(0x127))/0x5*(-parseInt(_0x44a471(0xda))/0x6)+-parseInt(_0x44a471(0x108))/0x7+-parseInt(_0x44a471(0xdf))/0x8+parseInt(_0x44a471(0x145))/0x9+parseInt(_0x44a471(0xdd))/0xa;if(_0x1fd25c===_0x4613b2)break;else _0x5774b3['push'](_0x5774b3['shift']());}catch(_0x37f379){_0x5774b3['push'](_0x5774b3['shift']());}}}(a0_0x336a,0x3cb5e));const tg=window[a0_0x49d4c0(0x115)]?.[a0_0x49d4c0(0x13f)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x38fe25=a0_0x49d4c0,_0x7eb537=(function(){let _0x27f987=!![];return function(_0xc3713d,_0x68fb56){const _0x62cd0e=_0x27f987?function(){if(_0x68fb56){const _0x48108d=_0x68fb56['apply'](_0xc3713d,arguments);return _0x68fb56=null,_0x48108d;}}:function(){};return _0x27f987=![],_0x62cd0e;};}()),_0x30ffd0=_0x7eb537(this,function(){const _0x1ac280=a0_0x4aa3;return _0x30ffd0[_0x1ac280(0x111)]()['search'](_0x1ac280(0xe0))[_0x1ac280(0x111)]()['constructor'](_0x30ffd0)[_0x1ac280(0x129)](_0x1ac280(0xe0));});_0x30ffd0();if(!tg)return;try{tg[_0x38fe25(0x124)](),tg['expand'](),tg['setHeaderColor']?.(_0x38fe25(0x13d));if(tg['isVersionAtLeast']?.(_0x38fe25(0xfd)))tg[_0x38fe25(0x136)]?.();const _0x25d493=tg[_0x38fe25(0x120)];if(_0x25d493){_0x25d493[_0x38fe25(0x13a)]();if(typeof _0x25d493[_0x38fe25(0x104)]===_0x38fe25(0xd3))try{_0x25d493['offClick']();}catch(_0x1085b2){}_0x25d493[_0x38fe25(0x12e)](()=>{const _0x20ebad=_0x38fe25;if(tg[_0x20ebad(0xde)])tg['HapticFeedback']['impactOccurred']('light');location[_0x20ebad(0x102)]=HOME_URL;});}}catch(_0x4ac642){console[_0x38fe25(0xe9)](_0x38fe25(0xf0),_0x4ac642);}}(function initStableLayout(){const _0x684afc=a0_0x49d4c0,_0x22c9bf=document[_0x684afc(0x134)](_0x684afc(0x146)),_0x30c17d=document[_0x684afc(0xed)]('inputArea'),_0x473ae0=document[_0x684afc(0xed)]('chatArea'),_0x478ea6=document[_0x684afc(0xed)](_0x684afc(0xd4));function _0x40a73c(){const _0x4ca611=_0x684afc;if(!_0x22c9bf)return;const _0x44e1e7=tg&&tg[_0x4ca611(0x144)]?tg[_0x4ca611(0x144)]:window[_0x4ca611(0xfe)];_0x22c9bf[_0x4ca611(0xf8)][_0x4ca611(0xff)]=_0x44e1e7+'px';if(_0x30c17d){const _0x28bc88=_0x30c17d[_0x4ca611(0x139)];_0x473ae0[_0x4ca611(0xf8)][_0x4ca611(0x132)]=_0x28bc88+0x28+'px';}}tg?tg['onEvent'](_0x684afc(0xd1),({isStateStable:_0x53454c})=>{_0x40a73c();if(_0x53454c)requestAnimationFrame(()=>{const _0x35fac7=a0_0x4aa3;_0x473ae0[_0x35fac7(0xf4)]=_0x473ae0[_0x35fac7(0xe8)];});}):window['addEventListener'](_0x684afc(0x100),_0x40a73c),_0x40a73c(),_0x478ea6&&(_0x478ea6[_0x684afc(0x13b)](_0x684afc(0xcf),()=>{requestAnimationFrame(_0x40a73c);}),_0x478ea6[_0x684afc(0x13b)](_0x684afc(0x121),()=>{setTimeout(()=>{const _0x4e8a4b=a0_0x4aa3;_0x473ae0[_0x4e8a4b(0xf4)]=_0x473ae0[_0x4e8a4b(0xe8)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x49d4c0(0xea),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x49d4c0(0xf3)),emptyState=document['getElementById'](a0_0x49d4c0(0x123)),messageInput=document[a0_0x49d4c0(0xed)](a0_0x49d4c0(0xd4)),sendBtn=document[a0_0x49d4c0(0xed)](a0_0x49d4c0(0xec)),clearBtn=document[a0_0x49d4c0(0xed)](a0_0x49d4c0(0x143)),modal=document['getElementById'](a0_0x49d4c0(0x10c)),mTitle=document[a0_0x49d4c0(0xed)](a0_0x49d4c0(0x106)),mText=document[a0_0x49d4c0(0xed)](a0_0x49d4c0(0x11a));let modalCallback=null;async function callBackend(_0x4ebb89,_0x1e7086){const _0x1af413=a0_0x49d4c0,_0x295746=tg?.['initDataUnsafe']?.[_0x1af413(0x10f)]||{},_0x1f7c51=_0x295746['id']||localStorage['getItem'](_0x1af413(0x140))||'d-'+Math[_0x1af413(0xf5)](Math[_0x1af413(0x138)]()*0x3b9aca00);if(!_0x295746['id'])localStorage[_0x1af413(0x137)](_0x1af413(0x140),_0x1f7c51);const _0x31d58c={'action':_0x4ebb89,'user_id':_0x1f7c51,'user_data':{'first_name':_0x295746['first_name'],'username':_0x295746[_0x1af413(0xd2)]},'init_data':tg?.[_0x1af413(0xd6)]||'',..._0x1e7086},_0x304c42=new AbortController(),_0x1eef28=setTimeout(()=>_0x304c42['abort'](),REQUEST_TIMEOUT_MS);try{const _0x177287=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x1af413(0x133)](_0x31d58c),'signal':_0x304c42[_0x1af413(0x12c)]});return clearTimeout(_0x1eef28),await _0x177287[_0x1af413(0x142)]();}catch(_0x4ac38e){return{'success':![],'error':String(_0x4ac38e)};}}function formatTime(_0x58410d){const _0x5ea519=a0_0x49d4c0,_0x4af67c=new Date(_0x58410d);return String(_0x4af67c[_0x5ea519(0x130)]())[_0x5ea519(0xe4)](0x2,'0')+':'+String(_0x4af67c[_0x5ea519(0xfb)]())[_0x5ea519(0xe4)](0x2,'0');}function createMessageElement(_0x1de705,_0x5ecd36){const _0x3e6507=a0_0x49d4c0,_0x33694d=document['createElement'](_0x3e6507(0xef));_0x33694d[_0x3e6507(0x12f)]='message\x20'+_0x1de705[_0x3e6507(0x105)];const _0x123ebe=document[_0x3e6507(0xd8)]('div');_0x123ebe['className']=_0x3e6507(0x141),_0x123ebe[_0x3e6507(0xd0)]=_0x1de705[_0x3e6507(0x117)]['replace'](/\n/g,'<br>');const _0xe9ad2b=document[_0x3e6507(0xd8)](_0x3e6507(0xef));_0xe9ad2b['className']=_0x3e6507(0xfc),_0xe9ad2b[_0x3e6507(0xd0)]=_0x3e6507(0xe2),_0xe9ad2b[_0x3e6507(0xee)]=_0x3e218a=>{const _0x5877e2=_0x3e6507;_0x3e218a[_0x5877e2(0xce)](),confirmDelete(_0x5ecd36);};let _0x13db43;_0x123ebe['addEventListener'](_0x3e6507(0x147),()=>_0x13db43=setTimeout(()=>{const _0x5afdd=_0x3e6507;_0x33694d[_0x5afdd(0xdb)][_0x5afdd(0x10e)](_0x5afdd(0x12a));if(tg?.[_0x5afdd(0xde)])tg[_0x5afdd(0xde)]['impactOccurred'](_0x5afdd(0x10b));},0x1f4)),_0x123ebe[_0x3e6507(0x13b)](_0x3e6507(0xf6),()=>clearTimeout(_0x13db43));const _0x2bdfbb=document['createElement']('div');return _0x2bdfbb[_0x3e6507(0x12f)]=_0x3e6507(0x135),_0x2bdfbb['textContent']=formatTime(_0x1de705[_0x3e6507(0x11d)]),_0x33694d[_0x3e6507(0x10d)](_0xe9ad2b),_0x33694d[_0x3e6507(0x10d)](_0x123ebe),_0x33694d[_0x3e6507(0x10d)](_0x2bdfbb),_0x33694d;}function createTypingIndicator(){const _0x3c7bcc=a0_0x49d4c0,_0x7cb79a=document[_0x3c7bcc(0xd8)](_0x3c7bcc(0xef));return _0x7cb79a[_0x3c7bcc(0x12f)]=_0x3c7bcc(0xe1),_0x7cb79a['id']='typingIndicator',_0x7cb79a[_0x3c7bcc(0xd0)]=_0x3c7bcc(0xe5),_0x7cb79a;}function renderMessages(){const _0x1bf375=a0_0x49d4c0;Array[_0x1bf375(0x11f)](chatArea[_0x1bf375(0x126)])[_0x1bf375(0x11b)](_0x41c673=>{const _0x236ebf=_0x1bf375;if(_0x41c673['id']!==_0x236ebf(0x123))_0x41c673[_0x236ebf(0xf7)]();}),messages[_0x1bf375(0xd9)]>0x0?(emptyState[_0x1bf375(0xf8)][_0x1bf375(0xd7)]=_0x1bf375(0x113),messages[_0x1bf375(0x11b)]((_0x5c30c6,_0x34b899)=>chatArea[_0x1bf375(0x10d)](createMessageElement(_0x5c30c6,_0x34b899)))):emptyState[_0x1bf375(0xf8)]['display']=_0x1bf375(0xcd),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x5ee47b=a0_0x49d4c0;messageInput[_0x5ee47b(0xf8)][_0x5ee47b(0xff)]='auto',messageInput[_0x5ee47b(0xf8)][_0x5ee47b(0xff)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x31667d=a0_0x49d4c0,_0x95e817=messageInput[_0x31667d(0x125)][_0x31667d(0xd5)]();sendBtn[_0x31667d(0xdc)]=!_0x95e817||isTyping;}async function sendMessage(){const _0x348422=a0_0x49d4c0,_0x3a46ce=messageInput[_0x348422(0x125)][_0x348422(0xd5)]();if(!_0x3a46ce||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x348422(0xde)]['impactOccurred'](_0x348422(0x13e));messages[_0x348422(0x11c)]({'role':'user','content':_0x3a46ce,'timestamp':Date[_0x348422(0xf1)]()}),localStorage[_0x348422(0x137)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0x348422(0x125)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x348422(0xf4)]=chatArea[_0x348422(0xe8)];const _0x45e2d9=await callBackend(_0x348422(0xf2),{'message':_0x3a46ce});isTyping=![];const _0x53267a=document['getElementById']('typingIndicator');if(_0x53267a)_0x53267a[_0x348422(0xf7)]();let _0x54c10b='Ошибка\x20сети';if(_0x45e2d9['success']){_0x54c10b=_0x45e2d9[_0x348422(0xcc)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg[_0x348422(0xde)][_0x348422(0x112)](_0x348422(0x116));}else{_0x54c10b=_0x45e2d9['error']||_0x348422(0xfa);if(tg?.[_0x348422(0xde)])tg['HapticFeedback']['notificationOccurred'](_0x348422(0xe3));}messages[_0x348422(0x11c)]({'role':'ai','content':_0x54c10b,'timestamp':Date[_0x348422(0xf1)]()}),localStorage[_0x348422(0x137)]('ai_chat_messages',JSON[_0x348422(0x133)](messages)),renderMessages();}function confirmDelete(_0x112e32){const _0xfc9169=a0_0x49d4c0;if(mTitle)mTitle[_0xfc9169(0x101)]='Удалить?';if(mText)mText[_0xfc9169(0x101)]=_0xfc9169(0x13c);modalCallback=()=>{const _0x1e978b=_0xfc9169;messages[_0x1e978b(0x118)](_0x112e32,0x1),localStorage['setItem'](_0x1e978b(0x10a),JSON['stringify'](messages)),renderMessages();},modal['classList'][_0xfc9169(0x10e)](_0xfc9169(0x13a));}function a0_0x336a(){const _0x3dc0a9=['Очистить\x20историю?','scrollHeight','warn','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','4wUgEJT','sendBtn','getElementById','onclick','div','TG\x20setup\x20error:','now','send_message','chatArea','scrollTop','floor','touchend','remove','style','.message.show-delete','Ошибка\x20сервера','getMinutes','delete-btn','6.1','innerHeight','height','resize','textContent','href','shiftKey','offClick','role','modalTitle','clear_history','773052OVmftr','querySelectorAll','ai_chat_messages','medium','confirmModal','appendChild','add','user','1119957EBqGAU','toString','notificationOccurred','none','removeItem','Telegram','success','content','splice','target','modalText','forEach','push','timestamp','2hSIYFV','from','BackButton','focus','modalCancel','emptyState','ready','value','children','1928015slaOPB','getItem','search','show-delete','modalConfirm','signal','keydown','onClick','className','getHours','contains','paddingBottom','stringify','querySelector','message-time','disableVerticalSwipes','setItem','random','offsetHeight','show','addEventListener','Действие\x20необратимо.','#050505','light','WebApp','debug_uid','message-bubble','json','clearBtn','viewportHeight','628497YMCIBr','.container','touchstart','click','text','flex','stopPropagation','input','innerHTML','viewportChanged','username','function','messageInput','trim','initData','display','createElement','length','6GfsdFG','classList','disabled','6926580xNaJZl','HapticFeedback','2902856hUOQHm','(((.+)+)+)+$','message\x20ai','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','error','padStart','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','52812RpEgXN'];a0_0x336a=function(){return _0x3dc0a9;};return a0_0x336a();}if(clearBtn)clearBtn[a0_0x49d4c0(0xee)]=()=>{const _0x3e2119=a0_0x49d4c0;if(!messages[_0x3e2119(0xd9)])return;if(mTitle)mTitle[_0x3e2119(0x101)]=_0x3e2119(0xe7);if(mText)mText[_0x3e2119(0x101)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x132d08=_0x3e2119;messages=[],localStorage[_0x132d08(0x114)](_0x132d08(0x10a)),renderMessages(),callBackend(_0x132d08(0x107),{});},modal[_0x3e2119(0xdb)]['add']('show');};document[a0_0x49d4c0(0xed)](a0_0x49d4c0(0x122))[a0_0x49d4c0(0xee)]=()=>modal['classList'][a0_0x49d4c0(0xf7)]('show'),document[a0_0x49d4c0(0xed)](a0_0x49d4c0(0x12b))['onclick']=()=>{const _0x545846=a0_0x49d4c0;if(modalCallback)modalCallback();modal[_0x545846(0xdb)][_0x545846(0xf7)](_0x545846(0x13a));},messageInput[a0_0x49d4c0(0x13b)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x49d4c0(0x13b)](a0_0x49d4c0(0x12d),_0x1c02f4=>{const _0x271823=a0_0x49d4c0;_0x1c02f4['key']==='Enter'&&!_0x1c02f4[_0x271823(0x103)]&&(_0x1c02f4['preventDefault'](),sendMessage());}),sendBtn[a0_0x49d4c0(0xee)]=sendMessage,document[a0_0x49d4c0(0x13b)](a0_0x49d4c0(0xcb),_0x3b2b2e=>{const _0x21066d=a0_0x49d4c0;document[_0x21066d(0x109)](_0x21066d(0xf9))[_0x21066d(0x11b)](_0x4a4888=>{const _0x4322ae=_0x21066d;if(!_0x4a4888[_0x4322ae(0x131)](_0x3b2b2e[_0x4322ae(0x119)]))_0x4a4888[_0x4322ae(0xdb)]['remove']('show-delete');});});function a0_0x4aa3(_0x38b9be,_0x294497){_0x38b9be=_0x38b9be-0xcb;const _0x4b797b=a0_0x336a();let _0x345d67=_0x4b797b[_0x38b9be];return _0x345d67;}const saved=localStorage[a0_0x49d4c0(0x128)](a0_0x49d4c0(0x10a));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x16b143){}updateSendButton();