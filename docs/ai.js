const a0_0x1b1b5b=a0_0x24d4;(function(_0x4d7b5a,_0x51fb17){const _0x11d225=a0_0x24d4,_0x2f9395=_0x4d7b5a();while(!![]){try{const _0x1dcddb=parseInt(_0x11d225(0x208))/0x1*(parseInt(_0x11d225(0x220))/0x2)+parseInt(_0x11d225(0x1cc))/0x3*(-parseInt(_0x11d225(0x222))/0x4)+parseInt(_0x11d225(0x21e))/0x5+parseInt(_0x11d225(0x235))/0x6*(parseInt(_0x11d225(0x209))/0x7)+parseInt(_0x11d225(0x1d6))/0x8*(parseInt(_0x11d225(0x239))/0x9)+parseInt(_0x11d225(0x243))/0xa+-parseInt(_0x11d225(0x23f))/0xb*(parseInt(_0x11d225(0x1f3))/0xc);if(_0x1dcddb===_0x51fb17)break;else _0x2f9395['push'](_0x2f9395['shift']());}catch(_0x23f81a){_0x2f9395['push'](_0x2f9395['shift']());}}}(a0_0x4f2f,0xf2672));const tg=window[a0_0x1b1b5b(0x1e6)]?.[a0_0x1b1b5b(0x22b)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x37464c=a0_0x1b1b5b,_0x1d4910=(function(){let _0xfa3693=!![];return function(_0x29429c,_0x141fcf){const _0x4a372c=_0xfa3693?function(){const _0x8a52d2=a0_0x24d4;if(_0x141fcf){const _0x46cc3b=_0x141fcf[_0x8a52d2(0x221)](_0x29429c,arguments);return _0x141fcf=null,_0x46cc3b;}}:function(){};return _0xfa3693=![],_0x4a372c;};}()),_0x53883a=_0x1d4910(this,function(){const _0x3ebb52=a0_0x24d4;return _0x53883a[_0x3ebb52(0x21d)]()[_0x3ebb52(0x238)]('(((.+)+)+)+$')['toString']()[_0x3ebb52(0x1da)](_0x53883a)[_0x3ebb52(0x238)]('(((.+)+)+)+$');});_0x53883a();if(!tg)return;try{tg[_0x37464c(0x237)](),tg[_0x37464c(0x1d0)](),tg['setHeaderColor']?.('#050505');if(tg['isVersionAtLeast']?.('6.1'))tg[_0x37464c(0x1e4)]?.();const _0x214956=tg[_0x37464c(0x1fb)];if(_0x214956){_0x214956[_0x37464c(0x1e0)]();if(typeof _0x214956[_0x37464c(0x204)]===_0x37464c(0x1f0))try{_0x214956[_0x37464c(0x204)]();}catch(_0x322e90){}_0x214956[_0x37464c(0x23b)](()=>{const _0x38c14e=_0x37464c;if(tg[_0x38c14e(0x1f6)])tg[_0x38c14e(0x1f6)][_0x38c14e(0x223)]('light');location['href']=HOME_URL;});}}catch(_0xc1d8b9){console[_0x37464c(0x1d7)](_0x37464c(0x1cd),_0xc1d8b9);}}(function initStableLayout(){const _0x3e15ef=a0_0x1b1b5b,_0x5b25c9=document['querySelector'](_0x3e15ef(0x20d)),_0x203c1b=document[_0x3e15ef(0x1ed)](_0x3e15ef(0x20a)),_0x5cbefc=document[_0x3e15ef(0x1ed)](_0x3e15ef(0x233)),_0x8772cc=document[_0x3e15ef(0x1ed)](_0x3e15ef(0x229));function _0x2d5e7d(){const _0x52c9bf=_0x3e15ef;if(!_0x5b25c9)return;const _0x491818=tg&&tg['viewportHeight']?tg['viewportHeight']:window['innerHeight'];_0x5b25c9['style'][_0x52c9bf(0x1fe)]=_0x491818+'px';if(_0x203c1b){const _0x57a2f9=_0x203c1b[_0x52c9bf(0x1c9)];_0x5cbefc[_0x52c9bf(0x231)][_0x52c9bf(0x202)]=_0x57a2f9+0x28+'px';}}tg?tg['onEvent'](_0x3e15ef(0x1c7),({isStateStable:_0x142627})=>{_0x2d5e7d();if(_0x142627)requestAnimationFrame(()=>{const _0x2162d2=a0_0x24d4;_0x5cbefc[_0x2162d2(0x226)]=_0x5cbefc[_0x2162d2(0x205)];});}):window[_0x3e15ef(0x1ca)](_0x3e15ef(0x1ea),_0x2d5e7d),_0x2d5e7d(),_0x8772cc&&(_0x8772cc[_0x3e15ef(0x1ca)](_0x3e15ef(0x234),()=>{requestAnimationFrame(_0x2d5e7d);}),_0x8772cc[_0x3e15ef(0x1ca)](_0x3e15ef(0x22f),()=>{setTimeout(()=>{const _0x5dbf5a=a0_0x24d4;_0x5cbefc[_0x5dbf5a(0x226)]=_0x5cbefc[_0x5dbf5a(0x205)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1b1b5b(0x1fd),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1b1b5b(0x1ed)](a0_0x1b1b5b(0x233)),emptyState=document[a0_0x1b1b5b(0x1ed)](a0_0x1b1b5b(0x1d1)),messageInput=document['getElementById'](a0_0x1b1b5b(0x229)),sendBtn=document[a0_0x1b1b5b(0x1ed)](a0_0x1b1b5b(0x1cf)),clearBtn=document[a0_0x1b1b5b(0x1ed)]('clearBtn'),modal=document['getElementById'](a0_0x1b1b5b(0x1cb)),mTitle=document[a0_0x1b1b5b(0x1ed)]('modalTitle'),mText=document[a0_0x1b1b5b(0x1ed)](a0_0x1b1b5b(0x210));function a0_0x24d4(_0x503ab6,_0x57f5c8){_0x503ab6=_0x503ab6-0x1c6;const _0x401c5e=a0_0x4f2f();let _0x2f9d8c=_0x401c5e[_0x503ab6];return _0x2f9d8c;}let modalCallback=null;async function callBackend(_0x113bae,_0x44641b){const _0x26198d=a0_0x1b1b5b,_0x2ee422=tg?.[_0x26198d(0x240)]?.[_0x26198d(0x21c)]||{},_0x1fca67=_0x2ee422['id']||localStorage[_0x26198d(0x21b)](_0x26198d(0x21a))||'d-'+Math[_0x26198d(0x219)](Math['random']()*0x3b9aca00);if(!_0x2ee422['id'])localStorage['setItem']('debug_uid',_0x1fca67);const _0x4319ff={'action':_0x113bae,'user_id':_0x1fca67,'user_data':{'first_name':_0x2ee422[_0x26198d(0x1ef)],'username':_0x2ee422[_0x26198d(0x217)]},'init_data':tg?.[_0x26198d(0x1f4)]||'',..._0x44641b},_0x41be7c=new AbortController(),_0x5962f8=setTimeout(()=>_0x41be7c[_0x26198d(0x22a)](),REQUEST_TIMEOUT_MS);try{const _0x92c863=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x26198d(0x20b)},'body':JSON['stringify'](_0x4319ff),'signal':_0x41be7c[_0x26198d(0x1e5)]});return clearTimeout(_0x5962f8),await _0x92c863[_0x26198d(0x1dc)]();}catch(_0x36cb8a){return{'success':![],'error':String(_0x36cb8a)};}}function formatTime(_0x4f3696){const _0xb995ac=a0_0x1b1b5b,_0x13f50d=new Date(_0x4f3696);return String(_0x13f50d[_0xb995ac(0x218)]())['padStart'](0x2,'0')+':'+String(_0x13f50d[_0xb995ac(0x227)]())[_0xb995ac(0x1e1)](0x2,'0');}function createMessageElement(_0x321505,_0x1fd3e1){const _0x201033=a0_0x1b1b5b,_0x433edb=document[_0x201033(0x22d)](_0x201033(0x1f2));_0x433edb['className']=_0x201033(0x1c6)+_0x321505[_0x201033(0x206)];const _0x3b715a=document['createElement']('div');_0x3b715a['className']=_0x201033(0x1f5),_0x3b715a[_0x201033(0x20f)]=_0x321505['content'][_0x201033(0x1e3)](/\n/g,_0x201033(0x1e2));const _0x3bb90c=document[_0x201033(0x22d)](_0x201033(0x1f2));_0x3bb90c['className']=_0x201033(0x23c),_0x3bb90c[_0x201033(0x20f)]=_0x201033(0x1ec),_0x3bb90c[_0x201033(0x1d8)]=_0x35b0a3=>{const _0x17c26b=_0x201033;_0x35b0a3[_0x17c26b(0x23e)](),confirmDelete(_0x1fd3e1);};let _0x1db726;_0x3b715a[_0x201033(0x1ca)](_0x201033(0x241),()=>_0x1db726=setTimeout(()=>{const _0x59367e=_0x201033;_0x433edb[_0x59367e(0x23a)][_0x59367e(0x1df)]('show-delete');if(tg?.['HapticFeedback'])tg[_0x59367e(0x1f6)][_0x59367e(0x223)](_0x59367e(0x214));},0x1f4)),_0x3b715a['addEventListener'](_0x201033(0x213),()=>clearTimeout(_0x1db726));const _0x1cf7a6=document[_0x201033(0x22d)](_0x201033(0x1f2));return _0x1cf7a6['className']=_0x201033(0x20c),_0x1cf7a6['textContent']=formatTime(_0x321505[_0x201033(0x201)]),_0x433edb[_0x201033(0x23d)](_0x3bb90c),_0x433edb['appendChild'](_0x3b715a),_0x433edb['appendChild'](_0x1cf7a6),_0x433edb;}function createTypingIndicator(){const _0x255e2d=a0_0x1b1b5b,_0x5a95f4=document[_0x255e2d(0x22d)](_0x255e2d(0x1f2));return _0x5a95f4[_0x255e2d(0x1dd)]=_0x255e2d(0x230),_0x5a95f4['id']=_0x255e2d(0x1ff),_0x5a95f4[_0x255e2d(0x20f)]=_0x255e2d(0x1d2),_0x5a95f4;}function renderMessages(){const _0x564d98=a0_0x1b1b5b;Array['from'](chatArea[_0x564d98(0x22c)])['forEach'](_0x3ef2b8=>{const _0x1c2e79=_0x564d98;if(_0x3ef2b8['id']!=='emptyState')_0x3ef2b8[_0x1c2e79(0x207)]();}),messages[_0x564d98(0x225)]>0x0?(emptyState[_0x564d98(0x231)][_0x564d98(0x1de)]='none',messages['forEach']((_0x31283c,_0x366415)=>chatArea[_0x564d98(0x23d)](createMessageElement(_0x31283c,_0x366415)))):emptyState[_0x564d98(0x231)]['display']=_0x564d98(0x1e8),requestAnimationFrame(()=>chatArea[_0x564d98(0x226)]=chatArea[_0x564d98(0x205)]);}function autoResizeTextarea(){const _0x279474=a0_0x1b1b5b;messageInput[_0x279474(0x231)]['height']=_0x279474(0x232),messageInput[_0x279474(0x231)][_0x279474(0x1fe)]=Math['min'](messageInput[_0x279474(0x205)],0x78)+'px';}function updateSendButton(){const _0x4aa58d=a0_0x1b1b5b,_0x4ee493=messageInput[_0x4aa58d(0x228)][_0x4aa58d(0x216)]();sendBtn[_0x4aa58d(0x1d5)]=!_0x4ee493||isTyping;}async function sendMessage(){const _0x581cfb=a0_0x1b1b5b,_0x401dbe=messageInput[_0x581cfb(0x228)][_0x581cfb(0x216)]();if(!_0x401dbe||isTyping)return;if(tg?.[_0x581cfb(0x1f6)])tg['HapticFeedback'][_0x581cfb(0x223)]('light');messages['push']({'role':_0x581cfb(0x21c),'content':_0x401dbe,'timestamp':Date[_0x581cfb(0x203)]()}),localStorage[_0x581cfb(0x1ce)](_0x581cfb(0x211),JSON[_0x581cfb(0x1f8)](messages)),renderMessages(),messageInput[_0x581cfb(0x228)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x163380=await callBackend(_0x581cfb(0x1f9),{'message':_0x401dbe});isTyping=![];const _0x4b7552=document[_0x581cfb(0x1ed)](_0x581cfb(0x1ff));if(_0x4b7552)_0x4b7552[_0x581cfb(0x207)]();let _0x43d19b=_0x581cfb(0x242);if(_0x163380[_0x581cfb(0x1fa)]){_0x43d19b=_0x163380[_0x581cfb(0x22e)]||_0x581cfb(0x1e7);if(tg?.[_0x581cfb(0x1f6)])tg[_0x581cfb(0x1f6)]['notificationOccurred'](_0x581cfb(0x1fa));}else{_0x43d19b=_0x163380['error']||_0x581cfb(0x1db);if(tg?.['HapticFeedback'])tg[_0x581cfb(0x1f6)][_0x581cfb(0x236)](_0x581cfb(0x1eb));}messages['push']({'role':'ai','content':_0x43d19b,'timestamp':Date[_0x581cfb(0x203)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x581cfb(0x1f8)](messages)),renderMessages();}function confirmDelete(_0x43e31c){const _0x2a7d6c=a0_0x1b1b5b;if(mTitle)mTitle['textContent']=_0x2a7d6c(0x1f7);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x12ab01=_0x2a7d6c;messages[_0x12ab01(0x1f1)](_0x43e31c,0x1),localStorage[_0x12ab01(0x1ce)](_0x12ab01(0x211),JSON[_0x12ab01(0x1f8)](messages)),renderMessages();},modal[_0x2a7d6c(0x23a)]['add']('show');}if(clearBtn)clearBtn[a0_0x1b1b5b(0x1d8)]=()=>{const _0x1e7fd4=a0_0x1b1b5b;if(!messages['length'])return;if(mTitle)mTitle[_0x1e7fd4(0x1c8)]='Очистить\x20историю?';if(mText)mText[_0x1e7fd4(0x1c8)]=_0x1e7fd4(0x1fc);modalCallback=async()=>{const _0x16c0a3=_0x1e7fd4;messages=[],localStorage['removeItem'](_0x16c0a3(0x211)),renderMessages(),callBackend(_0x16c0a3(0x1d9),{});},modal[_0x1e7fd4(0x23a)]['add']('show');};document[a0_0x1b1b5b(0x1ed)]('modalCancel')['onclick']=()=>modal['classList'][a0_0x1b1b5b(0x207)](a0_0x1b1b5b(0x1e0)),document[a0_0x1b1b5b(0x1ed)](a0_0x1b1b5b(0x1ee))[a0_0x1b1b5b(0x1d8)]=()=>{const _0x1413c6=a0_0x1b1b5b;if(modalCallback)modalCallback();modal[_0x1413c6(0x23a)][_0x1413c6(0x207)](_0x1413c6(0x1e0));},messageInput[a0_0x1b1b5b(0x1ca)](a0_0x1b1b5b(0x234),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1b1b5b(0x1ca)](a0_0x1b1b5b(0x224),_0x2a2f55=>{const _0x5354c9=a0_0x1b1b5b;_0x2a2f55['key']==='Enter'&&!_0x2a2f55['shiftKey']&&(_0x2a2f55[_0x5354c9(0x1d3)](),sendMessage());}),sendBtn[a0_0x1b1b5b(0x1d8)]=sendMessage,document['addEventListener'](a0_0x1b1b5b(0x1e9),_0x27d970=>{const _0x3b5bd9=a0_0x1b1b5b;document[_0x3b5bd9(0x20e)](_0x3b5bd9(0x1d4))[_0x3b5bd9(0x200)](_0x18d7b0=>{const _0x469c32=_0x3b5bd9;if(!_0x18d7b0[_0x469c32(0x212)](_0x27d970[_0x469c32(0x215)]))_0x18d7b0[_0x469c32(0x23a)][_0x469c32(0x207)]('show-delete');});});const saved=localStorage[a0_0x1b1b5b(0x21b)]('ai_chat_messages');function a0_0x4f2f(){const _0x5406b3=['.container','querySelectorAll','innerHTML','modalText','ai_chat_messages','contains','touchend','medium','target','trim','username','getHours','floor','debug_uid','getItem','user','toString','3321155cYpSFu','parse','32EvBJXM','apply','8OCsmSS','impactOccurred','keydown','length','scrollTop','getMinutes','value','messageInput','abort','WebApp','children','createElement','text','focus','message\x20ai','style','auto','chatArea','input','6XOAsJu','notificationOccurred','ready','search','15272343xgTbHW','classList','onClick','delete-btn','appendChild','stopPropagation','121hJiiPb','initDataUnsafe','touchstart','Ошибка\x20сети','15887510JUuRKH','message\x20','viewportChanged','textContent','offsetHeight','addEventListener','confirmModal','1079868fUMCci','TG\x20setup\x20error:','setItem','sendBtn','expand','emptyState','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','preventDefault','.message.show-delete','disabled','8BemlId','warn','onclick','clear_history','constructor','Ошибка\x20сервера','json','className','display','add','show','padStart','<br>','replace','disableVerticalSwipes','signal','Telegram','Пустой\x20ответ','flex','click','resize','error','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','getElementById','modalConfirm','first_name','function','splice','div','4826472xAczun','initData','message-bubble','HapticFeedback','Удалить?','stringify','send_message','success','BackButton','Начнется\x20новый\x20диалог.','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','height','typingIndicator','forEach','timestamp','paddingBottom','now','offClick','scrollHeight','role','remove','92671gOpbKd','4930905RqzHqc','inputArea','text/plain','message-time'];a0_0x4f2f=function(){return _0x5406b3;};return a0_0x4f2f();}if(saved)try{messages=JSON[a0_0x1b1b5b(0x21f)](saved),renderMessages();}catch(a0_0x337a28){}updateSendButton();