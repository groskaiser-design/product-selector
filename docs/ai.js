const a0_0x335fb8=a0_0x1db7;(function(_0x36be25,_0x44c783){const _0x43590f=a0_0x1db7,_0xc97fb7=_0x36be25();while(!![]){try{const _0x1c383b=-parseInt(_0x43590f(0x123))/0x1*(-parseInt(_0x43590f(0xef))/0x2)+parseInt(_0x43590f(0xe0))/0x3*(parseInt(_0x43590f(0x10a))/0x4)+parseInt(_0x43590f(0x14e))/0x5*(parseInt(_0x43590f(0x112))/0x6)+parseInt(_0x43590f(0x138))/0x7*(-parseInt(_0x43590f(0x151))/0x8)+parseInt(_0x43590f(0x143))/0x9*(parseInt(_0x43590f(0x10f))/0xa)+parseInt(_0x43590f(0x118))/0xb*(-parseInt(_0x43590f(0xed))/0xc)+-parseInt(_0x43590f(0xdd))/0xd;if(_0x1c383b===_0x44c783)break;else _0xc97fb7['push'](_0xc97fb7['shift']());}catch(_0x182006){_0xc97fb7['push'](_0xc97fb7['shift']());}}}(a0_0x83f9,0x64f38));function a0_0x1db7(_0x4c7b6a,_0x38f8b9){_0x4c7b6a=_0x4c7b6a-0xd5;const _0x426e51=a0_0x83f9();let _0x44f597=_0x426e51[_0x4c7b6a];return _0x44f597;}const tg=window[a0_0x335fb8(0x105)]?.[a0_0x335fb8(0x12d)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0xbdc804=a0_0x335fb8,_0x4ae02a=(function(){let _0x7804de=!![];return function(_0x32860b,_0x3c2f02){const _0x5b4dab=_0x7804de?function(){const _0x51555e=a0_0x1db7;if(_0x3c2f02){const _0x5046f4=_0x3c2f02[_0x51555e(0x106)](_0x32860b,arguments);return _0x3c2f02=null,_0x5046f4;}}:function(){};return _0x7804de=![],_0x5b4dab;};}()),_0xb7af2b=_0x4ae02a(this,function(){const _0x129cc6=a0_0x1db7;return _0xb7af2b[_0x129cc6(0x122)]()[_0x129cc6(0x14f)](_0x129cc6(0x134))[_0x129cc6(0x122)]()['constructor'](_0xb7af2b)[_0x129cc6(0x14f)](_0x129cc6(0x134));});_0xb7af2b();if(!tg)return;try{tg[_0xbdc804(0xe2)](),tg[_0xbdc804(0x159)](),tg['setHeaderColor']?.(_0xbdc804(0xe5));if(tg[_0xbdc804(0x142)]?.(_0xbdc804(0x15a)))tg[_0xbdc804(0x157)]?.();const _0x464d62=tg[_0xbdc804(0x10b)];if(_0x464d62){_0x464d62[_0xbdc804(0x127)]();if(typeof _0x464d62['offClick']==='function')try{_0x464d62[_0xbdc804(0xec)]();}catch(_0x424de0){}_0x464d62[_0xbdc804(0x14d)](()=>{const _0x3e9efb=_0xbdc804;if(tg[_0x3e9efb(0x145)])tg[_0x3e9efb(0x145)]['impactOccurred']('light');location[_0x3e9efb(0xd5)]=HOME_URL;});}}catch(_0x4934fd){console[_0xbdc804(0x13f)](_0xbdc804(0x131),_0x4934fd);}}(function initStableLayout(){const _0x54c51f=a0_0x335fb8,_0x42bd5a=document['querySelector'](_0x54c51f(0x110)),_0x502bc2=document[_0x54c51f(0x13e)](_0x54c51f(0xdc)),_0x34455d=document[_0x54c51f(0x13e)](_0x54c51f(0x140)),_0x36a192=document[_0x54c51f(0x13e)](_0x54c51f(0xfa));function _0x26e83d(){const _0x17e6bd=_0x54c51f;if(!_0x42bd5a)return;const _0x218497=tg&&tg['viewportHeight']?tg[_0x17e6bd(0xdb)]:window[_0x17e6bd(0x12b)];_0x42bd5a[_0x17e6bd(0x130)][_0x17e6bd(0xe1)]=_0x218497+'px';if(_0x502bc2){const _0x46ad74=_0x502bc2['offsetHeight'];_0x34455d[_0x17e6bd(0x130)][_0x17e6bd(0x108)]=_0x46ad74+0x28+'px';}}tg?tg[_0x54c51f(0xfe)]('viewportChanged',({isStateStable:_0x4095fa})=>{_0x26e83d();if(_0x4095fa)requestAnimationFrame(()=>{const _0x1e331d=a0_0x1db7;_0x34455d[_0x1e331d(0x13c)]=_0x34455d[_0x1e331d(0x120)];});}):window['addEventListener'](_0x54c51f(0x117),_0x26e83d),_0x26e83d(),_0x36a192&&(_0x36a192['addEventListener'](_0x54c51f(0x10c),()=>{requestAnimationFrame(_0x26e83d);}),_0x36a192[_0x54c51f(0xda)](_0x54c51f(0xf6),()=>{setTimeout(()=>{const _0x15d57c=a0_0x1db7;_0x34455d[_0x15d57c(0x13c)]=_0x34455d[_0x15d57c(0x120)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x335fb8(0x115),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x83f9(){const _0x2ac218=['from','addEventListener','viewportHeight','inputArea','9787349LpJavE','Удалить?','classList','1572zrvVyv','height','ready','<br>','message-bubble','#050505','random','replace','createElement','clearBtn','flex','keydown','offClick','9319836nPUtCh','touchend','4QsbOEd','Enter','modalText','typingIndicator','textContent','send_message','message\x20','focus','message-time','clear_history','onclick','messageInput','modalCancel','div','length','onEvent','getHours','POST','shiftKey','modalTitle','username','initDataUnsafe','Telegram','apply','.message.show-delete','paddingBottom','timestamp','1816AHCjXW','BackButton','input','text','setItem','10930zYkKEA','.container','message\x20ai','3844626nHooeH','debug_uid','trim','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','stringify','resize','11luwTHG','role','now','show-delete','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','modalConfirm','Ошибка\x20сервера','push','scrollHeight','children','toString','308851NyFipS','impactOccurred','click','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','show','contains','className','none','innerHeight','emptyState','WebApp','sendBtn','appendChild','style','TG\x20setup\x20error:','Действие\x20необратимо.','display','(((.+)+)+)+$','target','text/plain','Очистить\x20историю?','189utCBkA','Начнется\x20новый\x20диалог.','error','medium','scrollTop','content','getElementById','warn','chatArea','success','isVersionAtLeast','5247NXuQKf','min','HapticFeedback','delete-btn','getItem','remove','auto','touchstart','innerHTML','padStart','onClick','5olNOli','search','removeItem','56464SRTbvM','ai_chat_messages','confirmModal','parse','querySelectorAll','value','disableVerticalSwipes','forEach','expand','6.1','href','user','signal','first_name'];a0_0x83f9=function(){return _0x2ac218;};return a0_0x83f9();}const chatArea=document['getElementById'](a0_0x335fb8(0x140)),emptyState=document[a0_0x335fb8(0x13e)](a0_0x335fb8(0x12c)),messageInput=document[a0_0x335fb8(0x13e)](a0_0x335fb8(0xfa)),sendBtn=document[a0_0x335fb8(0x13e)](a0_0x335fb8(0x12e)),clearBtn=document['getElementById'](a0_0x335fb8(0xe9)),modal=document[a0_0x335fb8(0x13e)](a0_0x335fb8(0x153)),mTitle=document['getElementById'](a0_0x335fb8(0x102)),mText=document['getElementById'](a0_0x335fb8(0xf1));let modalCallback=null;async function callBackend(_0x234f59,_0x5e5557){const _0x101561=a0_0x335fb8,_0x4983fb=tg?.[_0x101561(0x104)]?.[_0x101561(0xd6)]||{},_0x121b54=_0x4983fb['id']||localStorage[_0x101561(0x147)](_0x101561(0x113))||'d-'+Math['floor'](Math[_0x101561(0xe6)]()*0x3b9aca00);if(!_0x4983fb['id'])localStorage[_0x101561(0x10e)](_0x101561(0x113),_0x121b54);const _0x264d5d={'action':_0x234f59,'user_id':_0x121b54,'user_data':{'first_name':_0x4983fb[_0x101561(0xd8)],'username':_0x4983fb[_0x101561(0x103)]},'init_data':tg?.['initData']||'',..._0x5e5557},_0x1d10cb=new AbortController(),_0x8b631b=setTimeout(()=>_0x1d10cb['abort'](),REQUEST_TIMEOUT_MS);try{const _0x86a262=await fetch(BACKEND_URL,{'method':_0x101561(0x100),'headers':{'Content-Type':_0x101561(0x136)},'body':JSON[_0x101561(0x116)](_0x264d5d),'signal':_0x1d10cb[_0x101561(0xd7)]});return clearTimeout(_0x8b631b),await _0x86a262['json']();}catch(_0x5168c4){return{'success':![],'error':String(_0x5168c4)};}}function formatTime(_0x2a84a3){const _0x2685c9=a0_0x335fb8,_0x36e1ee=new Date(_0x2a84a3);return String(_0x36e1ee[_0x2685c9(0xff)]())[_0x2685c9(0x14c)](0x2,'0')+':'+String(_0x36e1ee['getMinutes']())[_0x2685c9(0x14c)](0x2,'0');}function createMessageElement(_0x44d34a,_0x5d1c2b){const _0x129d0c=a0_0x335fb8,_0x32d2ec=document[_0x129d0c(0xe8)]('div');_0x32d2ec[_0x129d0c(0x129)]=_0x129d0c(0xf5)+_0x44d34a[_0x129d0c(0x119)];const _0xb5378c=document[_0x129d0c(0xe8)]('div');_0xb5378c[_0x129d0c(0x129)]=_0x129d0c(0xe4),_0xb5378c['innerHTML']=_0x44d34a[_0x129d0c(0x13d)][_0x129d0c(0xe7)](/\n/g,_0x129d0c(0xe3));const _0x28f8cb=document['createElement'](_0x129d0c(0xfc));_0x28f8cb['className']=_0x129d0c(0x146),_0x28f8cb['innerHTML']=_0x129d0c(0x11c),_0x28f8cb[_0x129d0c(0xf9)]=_0x2cb5af=>{_0x2cb5af['stopPropagation'](),confirmDelete(_0x5d1c2b);};let _0x2c856b;_0xb5378c['addEventListener'](_0x129d0c(0x14a),()=>_0x2c856b=setTimeout(()=>{const _0x14b387=_0x129d0c;_0x32d2ec[_0x14b387(0xdf)]['add'](_0x14b387(0x11b));if(tg?.[_0x14b387(0x145)])tg[_0x14b387(0x145)][_0x14b387(0x124)](_0x14b387(0x13b));},0x1f4)),_0xb5378c[_0x129d0c(0xda)](_0x129d0c(0xee),()=>clearTimeout(_0x2c856b));const _0x126539=document[_0x129d0c(0xe8)](_0x129d0c(0xfc));return _0x126539[_0x129d0c(0x129)]=_0x129d0c(0xf7),_0x126539[_0x129d0c(0xf3)]=formatTime(_0x44d34a[_0x129d0c(0x109)]),_0x32d2ec[_0x129d0c(0x12f)](_0x28f8cb),_0x32d2ec['appendChild'](_0xb5378c),_0x32d2ec['appendChild'](_0x126539),_0x32d2ec;}function createTypingIndicator(){const _0x45fc74=a0_0x335fb8,_0x8acb13=document[_0x45fc74(0xe8)]('div');return _0x8acb13[_0x45fc74(0x129)]=_0x45fc74(0x111),_0x8acb13['id']=_0x45fc74(0xf2),_0x8acb13[_0x45fc74(0x14b)]=_0x45fc74(0x126),_0x8acb13;}function renderMessages(){const _0x457a4a=a0_0x335fb8;Array[_0x457a4a(0xd9)](chatArea[_0x457a4a(0x121)])['forEach'](_0x18ca0b=>{const _0x2494d6=_0x457a4a;if(_0x18ca0b['id']!==_0x2494d6(0x12c))_0x18ca0b[_0x2494d6(0x148)]();}),messages[_0x457a4a(0xfd)]>0x0?(emptyState[_0x457a4a(0x130)][_0x457a4a(0x133)]=_0x457a4a(0x12a),messages[_0x457a4a(0x158)]((_0x2ce508,_0x72835e)=>chatArea['appendChild'](createMessageElement(_0x2ce508,_0x72835e)))):emptyState['style'][_0x457a4a(0x133)]=_0x457a4a(0xea),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x457a4a(0x120)]);}function autoResizeTextarea(){const _0x51d8e5=a0_0x335fb8;messageInput[_0x51d8e5(0x130)][_0x51d8e5(0xe1)]=_0x51d8e5(0x149),messageInput['style'][_0x51d8e5(0xe1)]=Math[_0x51d8e5(0x144)](messageInput[_0x51d8e5(0x120)],0x78)+'px';}function updateSendButton(){const _0x18af9c=a0_0x335fb8,_0x293b09=messageInput[_0x18af9c(0x156)]['trim']();sendBtn['disabled']=!_0x293b09||isTyping;}async function sendMessage(){const _0x4507a7=a0_0x335fb8,_0x4b7b78=messageInput[_0x4507a7(0x156)][_0x4507a7(0x114)]();if(!_0x4b7b78||isTyping)return;if(tg?.[_0x4507a7(0x145)])tg['HapticFeedback']['impactOccurred']('light');messages[_0x4507a7(0x11f)]({'role':_0x4507a7(0xd6),'content':_0x4b7b78,'timestamp':Date[_0x4507a7(0x11a)]()}),localStorage[_0x4507a7(0x10e)](_0x4507a7(0x152),JSON[_0x4507a7(0x116)](messages)),renderMessages(),messageInput[_0x4507a7(0x156)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4507a7(0x12f)](createTypingIndicator()),chatArea[_0x4507a7(0x13c)]=chatArea['scrollHeight'];const _0x14f87f=await callBackend(_0x4507a7(0xf4),{'message':_0x4b7b78});isTyping=![];const _0x44f0ab=document['getElementById'](_0x4507a7(0xf2));if(_0x44f0ab)_0x44f0ab[_0x4507a7(0x148)]();let _0x18caca='Ошибка\x20сети';if(_0x14f87f['success']){_0x18caca=_0x14f87f[_0x4507a7(0x10d)]||'Пустой\x20ответ';if(tg?.[_0x4507a7(0x145)])tg[_0x4507a7(0x145)]['notificationOccurred'](_0x4507a7(0x141));}else{_0x18caca=_0x14f87f[_0x4507a7(0x13a)]||_0x4507a7(0x11e);if(tg?.[_0x4507a7(0x145)])tg[_0x4507a7(0x145)]['notificationOccurred'](_0x4507a7(0x13a));}messages[_0x4507a7(0x11f)]({'role':'ai','content':_0x18caca,'timestamp':Date[_0x4507a7(0x11a)]()}),localStorage[_0x4507a7(0x10e)](_0x4507a7(0x152),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x4f68f1){const _0x486615=a0_0x335fb8;if(mTitle)mTitle[_0x486615(0xf3)]=_0x486615(0xde);if(mText)mText[_0x486615(0xf3)]=_0x486615(0x132);modalCallback=()=>{messages['splice'](_0x4f68f1,0x1),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x486615(0xdf)]['add']('show');}if(clearBtn)clearBtn[a0_0x335fb8(0xf9)]=()=>{const _0x536835=a0_0x335fb8;if(!messages[_0x536835(0xfd)])return;if(mTitle)mTitle['textContent']=_0x536835(0x137);if(mText)mText[_0x536835(0xf3)]=_0x536835(0x139);modalCallback=async()=>{const _0x1eed32=_0x536835;messages=[],localStorage[_0x1eed32(0x150)](_0x1eed32(0x152)),renderMessages(),callBackend(_0x1eed32(0xf8),{});},modal['classList']['add']('show');};document[a0_0x335fb8(0x13e)](a0_0x335fb8(0xfb))[a0_0x335fb8(0xf9)]=()=>modal[a0_0x335fb8(0xdf)][a0_0x335fb8(0x148)](a0_0x335fb8(0x127)),document[a0_0x335fb8(0x13e)](a0_0x335fb8(0x11d))[a0_0x335fb8(0xf9)]=()=>{const _0x2bfd66=a0_0x335fb8;if(modalCallback)modalCallback();modal[_0x2bfd66(0xdf)][_0x2bfd66(0x148)](_0x2bfd66(0x127));},messageInput[a0_0x335fb8(0xda)](a0_0x335fb8(0x10c),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x335fb8(0xda)](a0_0x335fb8(0xeb),_0x3f6bd8=>{const _0x59dfeb=a0_0x335fb8;_0x3f6bd8['key']===_0x59dfeb(0xf0)&&!_0x3f6bd8[_0x59dfeb(0x101)]&&(_0x3f6bd8['preventDefault'](),sendMessage());}),sendBtn[a0_0x335fb8(0xf9)]=sendMessage,document['addEventListener'](a0_0x335fb8(0x125),_0x162357=>{const _0xcf0154=a0_0x335fb8;document[_0xcf0154(0x155)](_0xcf0154(0x107))['forEach'](_0xdb1a62=>{const _0xac8a8=_0xcf0154;if(!_0xdb1a62[_0xac8a8(0x128)](_0x162357[_0xac8a8(0x135)]))_0xdb1a62[_0xac8a8(0xdf)]['remove']('show-delete');});});const saved=localStorage[a0_0x335fb8(0x147)](a0_0x335fb8(0x152));if(saved)try{messages=JSON[a0_0x335fb8(0x154)](saved),renderMessages();}catch(a0_0x59d865){}updateSendButton();