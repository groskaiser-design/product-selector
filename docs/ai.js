const a0_0x28a1cb=a0_0x345a;(function(_0x4c822d,_0x18a435){const _0x97effa=a0_0x345a,_0x1eb3d7=_0x4c822d();while(!![]){try{const _0x3cb56c=-parseInt(_0x97effa(0x205))/0x1*(parseInt(_0x97effa(0x249))/0x2)+parseInt(_0x97effa(0x242))/0x3+-parseInt(_0x97effa(0x245))/0x4*(-parseInt(_0x97effa(0x25f))/0x5)+parseInt(_0x97effa(0x1fe))/0x6+-parseInt(_0x97effa(0x202))/0x7+-parseInt(_0x97effa(0x250))/0x8*(-parseInt(_0x97effa(0x247))/0x9)+-parseInt(_0x97effa(0x20b))/0xa;if(_0x3cb56c===_0x18a435)break;else _0x1eb3d7['push'](_0x1eb3d7['shift']());}catch(_0x50ea4a){_0x1eb3d7['push'](_0x1eb3d7['shift']());}}}(a0_0x2291,0xccbcd));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x28a1cb(0x25c);function setupTelegramBackButton(){const _0x4ff4d9=a0_0x28a1cb;if(!tg)return;try{tg[_0x4ff4d9(0x232)](),tg[_0x4ff4d9(0x1f4)](),tg['setHeaderColor']?.(_0x4ff4d9(0x22c));if(tg[_0x4ff4d9(0x24e)]?.(_0x4ff4d9(0x230)))tg[_0x4ff4d9(0x20c)]?.();const _0x4a9d0f=tg[_0x4ff4d9(0x220)];if(_0x4a9d0f){_0x4a9d0f[_0x4ff4d9(0x22d)]();if(typeof _0x4a9d0f[_0x4ff4d9(0x241)]===_0x4ff4d9(0x211))try{_0x4a9d0f['offClick']();}catch(_0x46f112){}_0x4a9d0f['onClick'](()=>{const _0x1e26db=_0x4ff4d9;if(tg[_0x1e26db(0x243)])tg[_0x1e26db(0x243)][_0x1e26db(0x1f6)](_0x1e26db(0x1ef));location[_0x1e26db(0x266)]=HOME_URL;});}}catch(_0x34cee5){console[_0x4ff4d9(0x224)](_0x4ff4d9(0x223),_0x34cee5);}}(function initStableLayout(){const _0xea2b50=a0_0x28a1cb,_0x3ac46c=(function(){let _0xa3af45=!![];return function(_0x18cbd7,_0x172dba){const _0x27c661=_0xa3af45?function(){const _0x5095b5=a0_0x345a;if(_0x172dba){const _0x571e9f=_0x172dba[_0x5095b5(0x1fa)](_0x18cbd7,arguments);return _0x172dba=null,_0x571e9f;}}:function(){};return _0xa3af45=![],_0x27c661;};}()),_0x165066=document['querySelector']('.container'),_0x461da9=document[_0xea2b50(0x24b)]('inputArea'),_0x99df04=document['getElementById']('chatArea'),_0x3b3088=document['getElementById'](_0xea2b50(0x20e));function _0x2af698(){const _0x4a7c2b=_0xea2b50,_0x5c3cbf=_0x3ac46c(this,function(){const _0xb219d0=a0_0x345a;return _0x5c3cbf[_0xb219d0(0x258)]()[_0xb219d0(0x23b)]('(((.+)+)+)+$')[_0xb219d0(0x258)]()[_0xb219d0(0x1ff)](_0x5c3cbf)[_0xb219d0(0x23b)](_0xb219d0(0x222));});_0x5c3cbf();if(!_0x165066)return;const _0x2f87b4=tg&&tg[_0x4a7c2b(0x264)]?tg[_0x4a7c2b(0x264)]:window[_0x4a7c2b(0x234)];_0x165066[_0x4a7c2b(0x206)][_0x4a7c2b(0x23e)]=_0x2f87b4+'px';if(_0x461da9){const _0x25766a=_0x461da9[_0x4a7c2b(0x260)];_0x99df04['style'][_0x4a7c2b(0x238)]=_0x25766a+0x28+'px';}}tg?tg[_0xea2b50(0x268)]('viewportChanged',({isStateStable:_0x5bda19})=>{_0x2af698();if(_0x5bda19)requestAnimationFrame(()=>{const _0x187cd9=a0_0x345a;_0x99df04[_0x187cd9(0x221)]=_0x99df04['scrollHeight'];});}):window[_0xea2b50(0x24d)]('resize',_0x2af698),_0x2af698(),_0x3b3088&&(_0x3b3088[_0xea2b50(0x24d)](_0xea2b50(0x217),()=>{requestAnimationFrame(_0x2af698);}),_0x3b3088['addEventListener'](_0xea2b50(0x214),()=>{setTimeout(()=>{const _0x130016=a0_0x345a;_0x99df04[_0x130016(0x221)]=_0x99df04[_0x130016(0x254)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x28a1cb(0x204),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x345a(_0x3b2602,_0x2b73f5){_0x3b2602=_0x3b2602-0x1ef;const _0x1247a2=a0_0x2291();let _0x2a33e6=_0x1247a2[_0x3b2602];return _0x2a33e6;}const chatArea=document[a0_0x28a1cb(0x24b)](a0_0x28a1cb(0x22f)),emptyState=document[a0_0x28a1cb(0x24b)](a0_0x28a1cb(0x252)),messageInput=document[a0_0x28a1cb(0x24b)](a0_0x28a1cb(0x20e)),sendBtn=document[a0_0x28a1cb(0x24b)]('sendBtn'),clearBtn=document['getElementById'](a0_0x28a1cb(0x26c)),modal=document[a0_0x28a1cb(0x24b)]('confirmModal'),mTitle=document[a0_0x28a1cb(0x24b)](a0_0x28a1cb(0x231)),mText=document[a0_0x28a1cb(0x24b)](a0_0x28a1cb(0x246));let modalCallback=null;async function callBackend(_0x2d5c03,_0x272849){const _0x3e29f0=a0_0x28a1cb,_0x18870c=tg?.[_0x3e29f0(0x236)]?.[_0x3e29f0(0x208)]||{},_0x2b4465=_0x18870c['id']||localStorage[_0x3e29f0(0x267)]('debug_uid')||'d-'+Math[_0x3e29f0(0x1f2)](Math[_0x3e29f0(0x1fb)]()*0x3b9aca00);if(!_0x18870c['id'])localStorage[_0x3e29f0(0x215)](_0x3e29f0(0x21f),_0x2b4465);const _0x976c7={'action':_0x2d5c03,'user_id':_0x2b4465,'user_data':{'first_name':_0x18870c[_0x3e29f0(0x244)],'username':_0x18870c['username']},'init_data':tg?.[_0x3e29f0(0x1f9)]||'',..._0x272849},_0x32408e=new AbortController(),_0x41575c=setTimeout(()=>_0x32408e['abort'](),REQUEST_TIMEOUT_MS);try{const _0x208a52=await fetch(BACKEND_URL,{'method':_0x3e29f0(0x1f8),'headers':{'Content-Type':_0x3e29f0(0x248)},'body':JSON[_0x3e29f0(0x23a)](_0x976c7),'signal':_0x32408e[_0x3e29f0(0x226)]});return clearTimeout(_0x41575c),await _0x208a52[_0x3e29f0(0x1fc)]();}catch(_0x320094){return{'success':![],'error':String(_0x320094)};}}function formatTime(_0x464205){const _0x503935=a0_0x28a1cb,_0x4750c1=new Date(_0x464205);return String(_0x4750c1[_0x503935(0x200)]())[_0x503935(0x20f)](0x2,'0')+':'+String(_0x4750c1[_0x503935(0x23c)]())[_0x503935(0x20f)](0x2,'0');}function createMessageElement(_0xdc1108,_0x415d74){const _0x1fe488=a0_0x28a1cb,_0x51f6bc=document[_0x1fe488(0x237)](_0x1fe488(0x22b));_0x51f6bc[_0x1fe488(0x22e)]='message\x20'+_0xdc1108[_0x1fe488(0x25b)];const _0x1a149d=document['createElement']('div');_0x1a149d[_0x1fe488(0x22e)]=_0x1fe488(0x20a),_0x1a149d[_0x1fe488(0x24a)]=_0xdc1108[_0x1fe488(0x22a)][_0x1fe488(0x257)](/\n/g,_0x1fe488(0x235));const _0x5392d1=document[_0x1fe488(0x237)](_0x1fe488(0x22b));_0x5392d1[_0x1fe488(0x22e)]='delete-btn',_0x5392d1[_0x1fe488(0x24a)]=_0x1fe488(0x25d),_0x5392d1[_0x1fe488(0x21c)]=_0x55bcee=>{const _0x85a909=_0x1fe488;_0x55bcee[_0x85a909(0x21b)](),confirmDelete(_0x415d74);};let _0x293621;_0x1a149d[_0x1fe488(0x24d)](_0x1fe488(0x23f),()=>_0x293621=setTimeout(()=>{const _0x378a42=_0x1fe488;_0x51f6bc[_0x378a42(0x203)][_0x378a42(0x269)](_0x378a42(0x21d));if(tg?.[_0x378a42(0x243)])tg[_0x378a42(0x243)][_0x378a42(0x1f6)]('medium');},0x1f4)),_0x1a149d[_0x1fe488(0x24d)](_0x1fe488(0x1f5),()=>clearTimeout(_0x293621));const _0x487b08=document[_0x1fe488(0x237)](_0x1fe488(0x22b));return _0x487b08[_0x1fe488(0x22e)]=_0x1fe488(0x25a),_0x487b08[_0x1fe488(0x228)]=formatTime(_0xdc1108['timestamp']),_0x51f6bc[_0x1fe488(0x1f0)](_0x5392d1),_0x51f6bc[_0x1fe488(0x1f0)](_0x1a149d),_0x51f6bc[_0x1fe488(0x1f0)](_0x487b08),_0x51f6bc;}function createTypingIndicator(){const _0x80b011=a0_0x28a1cb,_0x827a75=document['createElement'](_0x80b011(0x22b));return _0x827a75[_0x80b011(0x22e)]='message\x20ai',_0x827a75['id']='typingIndicator',_0x827a75[_0x80b011(0x24a)]=_0x80b011(0x233),_0x827a75;}function renderMessages(){const _0x4823da=a0_0x28a1cb;Array[_0x4823da(0x1fd)](chatArea[_0x4823da(0x25e)])[_0x4823da(0x26b)](_0x1c9092=>{const _0xcb01d9=_0x4823da;if(_0x1c9092['id']!==_0xcb01d9(0x252))_0x1c9092[_0xcb01d9(0x210)]();}),messages[_0x4823da(0x218)]>0x0?(emptyState[_0x4823da(0x206)][_0x4823da(0x256)]=_0x4823da(0x209),messages[_0x4823da(0x26b)]((_0x404442,_0x4c292d)=>chatArea['appendChild'](createMessageElement(_0x404442,_0x4c292d)))):emptyState[_0x4823da(0x206)][_0x4823da(0x256)]='flex',requestAnimationFrame(()=>chatArea[_0x4823da(0x221)]=chatArea[_0x4823da(0x254)]);}function autoResizeTextarea(){const _0x225e8b=a0_0x28a1cb;messageInput['style'][_0x225e8b(0x23e)]='auto',messageInput[_0x225e8b(0x206)][_0x225e8b(0x23e)]=Math['min'](messageInput[_0x225e8b(0x254)],0x78)+'px';}function a0_0x2291(){const _0x5455bb=['content','div','#050505','show','className','chatArea','6.1','modalTitle','ready','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','innerHeight','<br>','initDataUnsafe','createElement','paddingBottom','Enter','stringify','search','getMinutes','splice','height','touchstart','removeItem','offClick','634374JfGCZY','HapticFeedback','first_name','2239456YozWPB','modalText','513eLmreh','text/plain','26IOjdcO','innerHTML','getElementById','ai_chat_messages','addEventListener','isVersionAtLeast','send_message','109480nuiLJi','keydown','emptyState','modalConfirm','scrollHeight','typingIndicator','display','replace','toString','value','message-time','role','./router.html','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','children','10vWqEWC','offsetHeight','now','contains','trim','viewportHeight','error','href','getItem','onEvent','add','parse','forEach','clearBtn','Ошибка\x20сервера','light','appendChild','Ошибка\x20сети','floor','key','expand','touchend','impactOccurred','success','POST','initData','apply','random','json','from','7371414oaQvLZ','constructor','getHours','Пустой\x20ответ','1691662xKJSSi','classList','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','8951EjISXj','style','preventDefault','user','none','message-bubble','21431660SoYdbV','disableVerticalSwipes','Начнется\x20новый\x20диалог.','messageInput','padStart','remove','function','notificationOccurred','Удалить?','focus','setItem','modalCancel','input','length','Действие\x20необратимо.','querySelectorAll','stopPropagation','onclick','show-delete','Очистить\x20историю?','debug_uid','BackButton','scrollTop','(((.+)+)+)+$','TG\x20setup\x20error:','warn','click','signal','shiftKey','textContent','target'];a0_0x2291=function(){return _0x5455bb;};return a0_0x2291();}function updateSendButton(){const _0x5f0121=a0_0x28a1cb,_0xd2b527=messageInput[_0x5f0121(0x259)][_0x5f0121(0x263)]();sendBtn['disabled']=!_0xd2b527||isTyping;}async function sendMessage(){const _0x5107a0=a0_0x28a1cb,_0x444548=messageInput[_0x5107a0(0x259)]['trim']();if(!_0x444548||isTyping)return;if(tg?.[_0x5107a0(0x243)])tg['HapticFeedback'][_0x5107a0(0x1f6)](_0x5107a0(0x1ef));messages['push']({'role':'user','content':_0x444548,'timestamp':Date[_0x5107a0(0x261)]()}),localStorage['setItem'](_0x5107a0(0x24c),JSON[_0x5107a0(0x23a)](messages)),renderMessages(),messageInput[_0x5107a0(0x259)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5107a0(0x1f0)](createTypingIndicator()),chatArea[_0x5107a0(0x221)]=chatArea['scrollHeight'];const _0x132166=await callBackend(_0x5107a0(0x24f),{'message':_0x444548});isTyping=![];const _0x995f41=document[_0x5107a0(0x24b)](_0x5107a0(0x255));if(_0x995f41)_0x995f41['remove']();let _0x7d3913=_0x5107a0(0x1f1);if(_0x132166[_0x5107a0(0x1f7)]){_0x7d3913=_0x132166['text']||_0x5107a0(0x201);if(tg?.[_0x5107a0(0x243)])tg[_0x5107a0(0x243)]['notificationOccurred'](_0x5107a0(0x1f7));}else{_0x7d3913=_0x132166[_0x5107a0(0x265)]||_0x5107a0(0x26d);if(tg?.[_0x5107a0(0x243)])tg[_0x5107a0(0x243)][_0x5107a0(0x212)](_0x5107a0(0x265));}messages['push']({'role':'ai','content':_0x7d3913,'timestamp':Date[_0x5107a0(0x261)]()}),localStorage[_0x5107a0(0x215)](_0x5107a0(0x24c),JSON[_0x5107a0(0x23a)](messages)),renderMessages();}function confirmDelete(_0x230b85){const _0x377255=a0_0x28a1cb;if(mTitle)mTitle[_0x377255(0x228)]=_0x377255(0x213);if(mText)mText[_0x377255(0x228)]=_0x377255(0x219);modalCallback=()=>{const _0xec915c=_0x377255;messages[_0xec915c(0x23d)](_0x230b85,0x1),localStorage['setItem'](_0xec915c(0x24c),JSON[_0xec915c(0x23a)](messages)),renderMessages();},modal[_0x377255(0x203)][_0x377255(0x269)](_0x377255(0x22d));}if(clearBtn)clearBtn['onclick']=()=>{const _0x511b1a=a0_0x28a1cb;if(!messages[_0x511b1a(0x218)])return;if(mTitle)mTitle['textContent']=_0x511b1a(0x21e);if(mText)mText[_0x511b1a(0x228)]=_0x511b1a(0x20d);modalCallback=async()=>{const _0x3dcfed=_0x511b1a;messages=[],localStorage[_0x3dcfed(0x240)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x511b1a(0x203)]['add'](_0x511b1a(0x22d));};document[a0_0x28a1cb(0x24b)](a0_0x28a1cb(0x216))[a0_0x28a1cb(0x21c)]=()=>modal[a0_0x28a1cb(0x203)][a0_0x28a1cb(0x210)](a0_0x28a1cb(0x22d)),document[a0_0x28a1cb(0x24b)](a0_0x28a1cb(0x253))[a0_0x28a1cb(0x21c)]=()=>{const _0x33b337=a0_0x28a1cb;if(modalCallback)modalCallback();modal['classList'][_0x33b337(0x210)](_0x33b337(0x22d));},messageInput[a0_0x28a1cb(0x24d)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x28a1cb(0x24d)](a0_0x28a1cb(0x251),_0x413126=>{const _0x3ea2aa=a0_0x28a1cb;_0x413126[_0x3ea2aa(0x1f3)]===_0x3ea2aa(0x239)&&!_0x413126[_0x3ea2aa(0x227)]&&(_0x413126[_0x3ea2aa(0x207)](),sendMessage());}),sendBtn[a0_0x28a1cb(0x21c)]=sendMessage,document[a0_0x28a1cb(0x24d)](a0_0x28a1cb(0x225),_0x442fb0=>{const _0xab942e=a0_0x28a1cb;document[_0xab942e(0x21a)]('.message.show-delete')[_0xab942e(0x26b)](_0x2594d4=>{const _0xde3a3a=_0xab942e;if(!_0x2594d4[_0xde3a3a(0x262)](_0x442fb0[_0xde3a3a(0x229)]))_0x2594d4[_0xde3a3a(0x203)]['remove'](_0xde3a3a(0x21d));});});const saved=localStorage[a0_0x28a1cb(0x267)](a0_0x28a1cb(0x24c));if(saved)try{messages=JSON[a0_0x28a1cb(0x26a)](saved),renderMessages();}catch(a0_0x4c0644){}updateSendButton();