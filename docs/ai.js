const a0_0x4b1817=a0_0x1701;(function(_0x1b5bfb,_0x443736){const _0x14e035=a0_0x1701,_0x3535e0=_0x1b5bfb();while(!![]){try{const _0x4703ed=-parseInt(_0x14e035(0x237))/0x1+-parseInt(_0x14e035(0x234))/0x2*(parseInt(_0x14e035(0x1d8))/0x3)+-parseInt(_0x14e035(0x1db))/0x4*(parseInt(_0x14e035(0x1e0))/0x5)+-parseInt(_0x14e035(0x1c9))/0x6*(-parseInt(_0x14e035(0x1de))/0x7)+-parseInt(_0x14e035(0x1e6))/0x8*(parseInt(_0x14e035(0x1d7))/0x9)+-parseInt(_0x14e035(0x1ce))/0xa*(parseInt(_0x14e035(0x23d))/0xb)+parseInt(_0x14e035(0x203))/0xc;if(_0x4703ed===_0x443736)break;else _0x3535e0['push'](_0x3535e0['shift']());}catch(_0x20f2c2){_0x3535e0['push'](_0x3535e0['shift']());}}}(a0_0x5e21,0x3f51d));const tg=window[a0_0x4b1817(0x1dc)]?.[a0_0x4b1817(0x220)],HOME_URL='./router.html';function a0_0x5e21(){const _0x8925c5=['first_name','add','flex','notificationOccurred','removeItem','42beNmMi','#050505','from','key','getHours','1073990SDhbMK','confirmModal','input','Ошибка\x20сервера','BackButton','user','send_message','message-time','Удалить?','2141406hKPAKl','114nQMKZp','expand','trim','4SNhYGG','Telegram','paddingBottom','46991NTvIzB','forEach','1261045AeKHrU','message-bubble','debug_uid','getItem','offClick','length','8rkdFmH','target','modalConfirm','disableVerticalSwipes','setHeaderColor','height','text','text/plain','keydown','touchend','children','modalText','signal','now','(((.+)+)+)+$','modalCancel','function','touchstart','querySelectorAll','addEventListener','username','auto','none','timestamp','setItem','shiftKey','<br>','6.1','appendChild','22296096kawLCF','success','onClick','getElementById','stringify','ai_chat_messages','toString','scrollHeight','typingIndicator','delete-btn','chatArea','className','padStart','isVersionAtLeast','.container','json','emptyState','disabled','innerHTML','.message.show-delete','createElement','role','onEvent','parse','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','warn','Очистить\x20историю?','apply','Ошибка\x20сети','WebApp','Начнется\x20новый\x20диалог.','querySelector','value','div','push','clear_history','Enter','messageInput','onclick','show','stopPropagation','Действие\x20необратимо.','innerHeight','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','inputArea','style','preventDefault','show-delete','initData','26060TDujaQ','viewportChanged','remove','445561BDDZzi','light','textContent','classList','click','getMinutes','22DjAnJt','scrollTop','message\x20','HapticFeedback','viewportHeight','resize','impactOccurred','constructor','TG\x20setup\x20error:','splice'];a0_0x5e21=function(){return _0x8925c5;};return a0_0x5e21();}function setupTelegramBackButton(){const _0x36953d=a0_0x4b1817,_0x48fe53=(function(){let _0x4a882b=!![];return function(_0x249397,_0x4aba19){const _0x27d7b5=_0x4a882b?function(){const _0x27278f=a0_0x1701;if(_0x4aba19){const _0x3f25d6=_0x4aba19[_0x27278f(0x21e)](_0x249397,arguments);return _0x4aba19=null,_0x3f25d6;}}:function(){};return _0x4a882b=![],_0x27d7b5;};}()),_0x54ebdf=_0x48fe53(this,function(){const _0x4c6e78=a0_0x1701;return _0x54ebdf['toString']()['search'](_0x4c6e78(0x1f4))[_0x4c6e78(0x209)]()[_0x4c6e78(0x244)](_0x54ebdf)['search'](_0x4c6e78(0x1f4));});_0x54ebdf();if(!tg)return;try{tg['ready'](),tg[_0x36953d(0x1d9)](),tg[_0x36953d(0x1ea)]?.(_0x36953d(0x1ca));if(tg[_0x36953d(0x210)]?.(_0x36953d(0x201)))tg[_0x36953d(0x1e9)]?.();const _0x51a0ed=tg[_0x36953d(0x1d2)];if(_0x51a0ed){_0x51a0ed[_0x36953d(0x22a)]();if(typeof _0x51a0ed[_0x36953d(0x1e4)]===_0x36953d(0x1f6))try{_0x51a0ed[_0x36953d(0x1e4)]();}catch(_0x12e3bd){}_0x51a0ed[_0x36953d(0x205)](()=>{const _0x2f67c9=_0x36953d;if(tg[_0x2f67c9(0x240)])tg['HapticFeedback']['impactOccurred'](_0x2f67c9(0x238));location['href']=HOME_URL;});}}catch(_0x4da308){console[_0x36953d(0x21c)](_0x36953d(0x245),_0x4da308);}}(function initStableLayout(){const _0x5c787d=a0_0x4b1817,_0x5b4c09=document[_0x5c787d(0x222)](_0x5c787d(0x211)),_0x391232=document[_0x5c787d(0x206)](_0x5c787d(0x22f)),_0x51df3a=document[_0x5c787d(0x206)]('chatArea'),_0x3f0520=document['getElementById'](_0x5c787d(0x228));function _0x42182b(){const _0x1497a4=_0x5c787d;if(!_0x5b4c09)return;const _0x1113b=tg&&tg[_0x1497a4(0x241)]?tg[_0x1497a4(0x241)]:window[_0x1497a4(0x22d)];_0x5b4c09['style'][_0x1497a4(0x1eb)]=_0x1113b+'px';if(_0x391232){const _0x452fb7=_0x391232['offsetHeight'];_0x51df3a['style'][_0x1497a4(0x1dd)]=_0x452fb7+0x28+'px';}}tg?tg[_0x5c787d(0x219)](_0x5c787d(0x235),({isStateStable:_0x5434e7})=>{_0x42182b();if(_0x5434e7)requestAnimationFrame(()=>{const _0x5daa34=a0_0x1701;_0x51df3a['scrollTop']=_0x51df3a[_0x5daa34(0x20a)];});}):window[_0x5c787d(0x1f9)](_0x5c787d(0x242),_0x42182b),_0x42182b(),_0x3f0520&&(_0x3f0520[_0x5c787d(0x1f9)]('input',()=>{requestAnimationFrame(_0x42182b);}),_0x3f0520[_0x5c787d(0x1f9)]('focus',()=>{setTimeout(()=>{const _0x372fb1=a0_0x1701;_0x51df3a['scrollTop']=_0x51df3a[_0x372fb1(0x20a)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4b1817(0x206)](a0_0x4b1817(0x20d)),emptyState=document[a0_0x4b1817(0x206)](a0_0x4b1817(0x213)),messageInput=document['getElementById'](a0_0x4b1817(0x228)),sendBtn=document[a0_0x4b1817(0x206)]('sendBtn'),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0x4b1817(0x206)](a0_0x4b1817(0x1cf)),mTitle=document['getElementById']('modalTitle'),mText=document['getElementById'](a0_0x4b1817(0x1f1));let modalCallback=null;async function callBackend(_0x3adacd,_0x2d4e78){const _0x568d77=a0_0x4b1817,_0x14942c=tg?.['initDataUnsafe']?.[_0x568d77(0x1d3)]||{},_0x7033a5=_0x14942c['id']||localStorage[_0x568d77(0x1e3)](_0x568d77(0x1e2))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x14942c['id'])localStorage['setItem'](_0x568d77(0x1e2),_0x7033a5);const _0x3e40e7={'action':_0x3adacd,'user_id':_0x7033a5,'user_data':{'first_name':_0x14942c[_0x568d77(0x1c4)],'username':_0x14942c[_0x568d77(0x1fa)]},'init_data':tg?.[_0x568d77(0x233)]||'',..._0x2d4e78},_0x1591ec=new AbortController(),_0x5b2934=setTimeout(()=>_0x1591ec['abort'](),REQUEST_TIMEOUT_MS);try{const _0x854d18=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x568d77(0x1ed)},'body':JSON['stringify'](_0x3e40e7),'signal':_0x1591ec[_0x568d77(0x1f2)]});return clearTimeout(_0x5b2934),await _0x854d18[_0x568d77(0x212)]();}catch(_0x180f37){return{'success':![],'error':String(_0x180f37)};}}function formatTime(_0x5cba8c){const _0x237078=a0_0x4b1817,_0x3250b5=new Date(_0x5cba8c);return String(_0x3250b5[_0x237078(0x1cd)]())[_0x237078(0x20f)](0x2,'0')+':'+String(_0x3250b5[_0x237078(0x23c)]())['padStart'](0x2,'0');}function createMessageElement(_0x436bfa,_0x2e76d6){const _0x5a7f0c=a0_0x4b1817,_0x99f5d7=document['createElement'](_0x5a7f0c(0x224));_0x99f5d7[_0x5a7f0c(0x20e)]=_0x5a7f0c(0x23f)+_0x436bfa[_0x5a7f0c(0x218)];const _0x160cff=document[_0x5a7f0c(0x217)](_0x5a7f0c(0x224));_0x160cff[_0x5a7f0c(0x20e)]=_0x5a7f0c(0x1e1),_0x160cff[_0x5a7f0c(0x215)]=_0x436bfa['content']['replace'](/\n/g,_0x5a7f0c(0x200));const _0xb83bb7=document[_0x5a7f0c(0x217)]('div');_0xb83bb7[_0x5a7f0c(0x20e)]=_0x5a7f0c(0x20c),_0xb83bb7[_0x5a7f0c(0x215)]=_0x5a7f0c(0x21b),_0xb83bb7[_0x5a7f0c(0x229)]=_0x3a822d=>{const _0x85271e=_0x5a7f0c;_0x3a822d[_0x85271e(0x22b)](),confirmDelete(_0x2e76d6);};let _0x12acb7;_0x160cff['addEventListener'](_0x5a7f0c(0x1f7),()=>_0x12acb7=setTimeout(()=>{const _0x63704e=_0x5a7f0c;_0x99f5d7[_0x63704e(0x23a)]['add'](_0x63704e(0x232));if(tg?.[_0x63704e(0x240)])tg[_0x63704e(0x240)][_0x63704e(0x243)]('medium');},0x1f4)),_0x160cff[_0x5a7f0c(0x1f9)](_0x5a7f0c(0x1ef),()=>clearTimeout(_0x12acb7));const _0x45819e=document[_0x5a7f0c(0x217)](_0x5a7f0c(0x224));return _0x45819e[_0x5a7f0c(0x20e)]=_0x5a7f0c(0x1d5),_0x45819e[_0x5a7f0c(0x239)]=formatTime(_0x436bfa[_0x5a7f0c(0x1fd)]),_0x99f5d7['appendChild'](_0xb83bb7),_0x99f5d7[_0x5a7f0c(0x202)](_0x160cff),_0x99f5d7[_0x5a7f0c(0x202)](_0x45819e),_0x99f5d7;}function createTypingIndicator(){const _0x17e5d6=a0_0x4b1817,_0x418546=document['createElement'](_0x17e5d6(0x224));return _0x418546[_0x17e5d6(0x20e)]='message\x20ai',_0x418546['id']=_0x17e5d6(0x20b),_0x418546[_0x17e5d6(0x215)]=_0x17e5d6(0x22e),_0x418546;}function renderMessages(){const _0x4e08a2=a0_0x4b1817;Array[_0x4e08a2(0x1cb)](chatArea[_0x4e08a2(0x1f0)])['forEach'](_0x794ac7=>{const _0x4c489b=_0x4e08a2;if(_0x794ac7['id']!==_0x4c489b(0x213))_0x794ac7['remove']();}),messages['length']>0x0?(emptyState[_0x4e08a2(0x230)]['display']=_0x4e08a2(0x1fc),messages[_0x4e08a2(0x1df)]((_0x5dd924,_0x4d67ae)=>chatArea[_0x4e08a2(0x202)](createMessageElement(_0x5dd924,_0x4d67ae)))):emptyState['style']['display']=_0x4e08a2(0x1c6),requestAnimationFrame(()=>chatArea[_0x4e08a2(0x23e)]=chatArea[_0x4e08a2(0x20a)]);}function autoResizeTextarea(){const _0x590a74=a0_0x4b1817;messageInput[_0x590a74(0x230)][_0x590a74(0x1eb)]=_0x590a74(0x1fb),messageInput[_0x590a74(0x230)][_0x590a74(0x1eb)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x2bce85=a0_0x4b1817,_0xd63fae=messageInput[_0x2bce85(0x223)][_0x2bce85(0x1da)]();sendBtn[_0x2bce85(0x214)]=!_0xd63fae||isTyping;}async function sendMessage(){const _0x22600d=a0_0x4b1817,_0x2deabe=messageInput[_0x22600d(0x223)][_0x22600d(0x1da)]();if(!_0x2deabe||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x22600d(0x243)](_0x22600d(0x238));messages['push']({'role':'user','content':_0x2deabe,'timestamp':Date[_0x22600d(0x1f3)]()}),localStorage[_0x22600d(0x1fe)](_0x22600d(0x208),JSON[_0x22600d(0x207)](messages)),renderMessages(),messageInput[_0x22600d(0x223)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x22600d(0x23e)]=chatArea['scrollHeight'];const _0x38751f=await callBackend(_0x22600d(0x1d4),{'message':_0x2deabe});isTyping=![];const _0x572ae0=document[_0x22600d(0x206)](_0x22600d(0x20b));if(_0x572ae0)_0x572ae0[_0x22600d(0x236)]();let _0x4ebd60=_0x22600d(0x21f);if(_0x38751f[_0x22600d(0x204)]){_0x4ebd60=_0x38751f[_0x22600d(0x1ec)]||'Пустой\x20ответ';if(tg?.[_0x22600d(0x240)])tg[_0x22600d(0x240)][_0x22600d(0x1c7)](_0x22600d(0x204));}else{_0x4ebd60=_0x38751f['error']||_0x22600d(0x1d1);if(tg?.[_0x22600d(0x240)])tg[_0x22600d(0x240)][_0x22600d(0x1c7)]('error');}messages[_0x22600d(0x225)]({'role':'ai','content':_0x4ebd60,'timestamp':Date['now']()}),localStorage['setItem'](_0x22600d(0x208),JSON[_0x22600d(0x207)](messages)),renderMessages();}function confirmDelete(_0x170001){const _0x1e7894=a0_0x4b1817;if(mTitle)mTitle[_0x1e7894(0x239)]=_0x1e7894(0x1d6);if(mText)mText[_0x1e7894(0x239)]=_0x1e7894(0x22c);modalCallback=()=>{const _0x5003b0=_0x1e7894;messages[_0x5003b0(0x246)](_0x170001,0x1),localStorage[_0x5003b0(0x1fe)]('ai_chat_messages',JSON[_0x5003b0(0x207)](messages)),renderMessages();},modal[_0x1e7894(0x23a)][_0x1e7894(0x1c5)](_0x1e7894(0x22a));}function a0_0x1701(_0x1229d1,_0x2c5464){_0x1229d1=_0x1229d1-0x1c4;const _0x35bec2=a0_0x5e21();let _0x179f97=_0x35bec2[_0x1229d1];return _0x179f97;}if(clearBtn)clearBtn['onclick']=()=>{const _0xad1698=a0_0x4b1817;if(!messages[_0xad1698(0x1e5)])return;if(mTitle)mTitle[_0xad1698(0x239)]=_0xad1698(0x21d);if(mText)mText[_0xad1698(0x239)]=_0xad1698(0x221);modalCallback=async()=>{const _0x56094f=_0xad1698;messages=[],localStorage[_0x56094f(0x1c8)]('ai_chat_messages'),renderMessages(),callBackend(_0x56094f(0x226),{});},modal[_0xad1698(0x23a)][_0xad1698(0x1c5)]('show');};document[a0_0x4b1817(0x206)](a0_0x4b1817(0x1f5))[a0_0x4b1817(0x229)]=()=>modal[a0_0x4b1817(0x23a)][a0_0x4b1817(0x236)](a0_0x4b1817(0x22a)),document['getElementById'](a0_0x4b1817(0x1e8))['onclick']=()=>{const _0x57d13f=a0_0x4b1817;if(modalCallback)modalCallback();modal['classList']['remove'](_0x57d13f(0x22a));},messageInput[a0_0x4b1817(0x1f9)](a0_0x4b1817(0x1d0),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4b1817(0x1f9)](a0_0x4b1817(0x1ee),_0x4dab0f=>{const _0x5d0058=a0_0x4b1817;_0x4dab0f[_0x5d0058(0x1cc)]===_0x5d0058(0x227)&&!_0x4dab0f[_0x5d0058(0x1ff)]&&(_0x4dab0f[_0x5d0058(0x231)](),sendMessage());}),sendBtn[a0_0x4b1817(0x229)]=sendMessage,document[a0_0x4b1817(0x1f9)](a0_0x4b1817(0x23b),_0x12dac5=>{const _0x22e7ad=a0_0x4b1817;document[_0x22e7ad(0x1f8)](_0x22e7ad(0x216))[_0x22e7ad(0x1df)](_0xd90bf5=>{const _0x2309e6=_0x22e7ad;if(!_0xd90bf5['contains'](_0x12dac5[_0x2309e6(0x1e7)]))_0xd90bf5[_0x2309e6(0x23a)]['remove']('show-delete');});});const saved=localStorage['getItem'](a0_0x4b1817(0x208));if(saved)try{messages=JSON[a0_0x4b1817(0x21a)](saved),renderMessages();}catch(a0_0x56ab38){}updateSendButton();