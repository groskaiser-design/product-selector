const a0_0x36de9f=a0_0x1c43;(function(_0x660555,_0x13d6e1){const _0x2cc8f5=a0_0x1c43,_0x152cf2=_0x660555();while(!![]){try{const _0x3f7f4f=-parseInt(_0x2cc8f5(0x1ba))/0x1+-parseInt(_0x2cc8f5(0x1a1))/0x2*(parseInt(_0x2cc8f5(0x1b9))/0x3)+-parseInt(_0x2cc8f5(0x1c5))/0x4+-parseInt(_0x2cc8f5(0x1b6))/0x5+parseInt(_0x2cc8f5(0x1c0))/0x6+parseInt(_0x2cc8f5(0x1f9))/0x7+-parseInt(_0x2cc8f5(0x1e2))/0x8*(-parseInt(_0x2cc8f5(0x1ee))/0x9);if(_0x3f7f4f===_0x13d6e1)break;else _0x152cf2['push'](_0x152cf2['shift']());}catch(_0x102bf2){_0x152cf2['push'](_0x152cf2['shift']());}}}(a0_0x3ff1,0xe7a81));const tg=window[a0_0x36de9f(0x19d)]?.[a0_0x36de9f(0x1cb)],HOME_URL=a0_0x36de9f(0x191);function setupTelegramBackButton(){const _0x1efb37=a0_0x36de9f;if(!tg)return;try{tg[_0x1efb37(0x1eb)](),tg[_0x1efb37(0x1bb)](),tg[_0x1efb37(0x198)]?.(_0x1efb37(0x1f3));if(tg[_0x1efb37(0x1f4)]?.(_0x1efb37(0x1ca)))tg[_0x1efb37(0x1ac)]?.();const _0x578eb8=tg[_0x1efb37(0x1e7)];if(_0x578eb8){_0x578eb8['show']();if(typeof _0x578eb8['offClick']===_0x1efb37(0x1c7))try{_0x578eb8[_0x1efb37(0x1e5)]();}catch(_0x2aabd4){}_0x578eb8[_0x1efb37(0x1ef)](()=>{const _0x1333da=_0x1efb37;if(tg[_0x1333da(0x1de)])tg[_0x1333da(0x1de)][_0x1333da(0x19c)](_0x1333da(0x1ab));location['href']=HOME_URL;});}}catch(_0x333526){console[_0x1efb37(0x1d8)](_0x1efb37(0x1b3),_0x333526);}}(function initStableLayout(){const _0x1f1707=a0_0x36de9f,_0x251d58=(function(){let _0x40919b=!![];return function(_0xc0e26b,_0xf276d4){const _0xb5014f=_0x40919b?function(){const _0x3e6858=a0_0x1c43;if(_0xf276d4){const _0x195781=_0xf276d4[_0x3e6858(0x19b)](_0xc0e26b,arguments);return _0xf276d4=null,_0x195781;}}:function(){};return _0x40919b=![],_0xb5014f;};}()),_0x48d5b8=document[_0x1f1707(0x1db)](_0x1f1707(0x18d)),_0x37778f=document['getElementById'](_0x1f1707(0x1d1)),_0x17ef04=document[_0x1f1707(0x1a6)]('chatArea'),_0x15869d=document[_0x1f1707(0x1a6)](_0x1f1707(0x1dd));function _0x575d7c(){const _0x3be542=_0x1f1707,_0x33ce8b=_0x251d58(this,function(){const _0x3981d9=a0_0x1c43;return _0x33ce8b[_0x3981d9(0x1d4)]()['search'](_0x3981d9(0x1b2))[_0x3981d9(0x1d4)]()['constructor'](_0x33ce8b)[_0x3981d9(0x1e0)]('(((.+)+)+)+$');});_0x33ce8b();if(!_0x48d5b8)return;const _0x193377=tg&&tg[_0x3be542(0x1a7)]?tg[_0x3be542(0x1a7)]:window[_0x3be542(0x201)];_0x48d5b8[_0x3be542(0x1a2)][_0x3be542(0x183)]=_0x193377+'px';if(_0x37778f){const _0x23b091=_0x37778f['offsetHeight'];_0x17ef04[_0x3be542(0x1a2)]['paddingBottom']=_0x23b091+0x28+'px';}}tg?tg[_0x1f1707(0x1a0)](_0x1f1707(0x185),({isStateStable:_0x3740a5})=>{_0x575d7c();if(_0x3740a5)requestAnimationFrame(()=>{const _0x3fc668=a0_0x1c43;_0x17ef04['scrollTop']=_0x17ef04[_0x3fc668(0x1cf)];});}):window[_0x1f1707(0x1f8)]('resize',_0x575d7c),_0x575d7c(),_0x15869d&&(_0x15869d['addEventListener']('input',()=>{requestAnimationFrame(_0x575d7c);}),_0x15869d['addEventListener'](_0x1f1707(0x1af),()=>{setTimeout(()=>{const _0x3fc342=a0_0x1c43;_0x17ef04[_0x3fc342(0x1fa)]=_0x17ef04[_0x3fc342(0x1cf)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x36de9f(0x1c8),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x36de9f(0x1a6)]('chatArea'),emptyState=document[a0_0x36de9f(0x1a6)](a0_0x36de9f(0x1b5)),messageInput=document[a0_0x36de9f(0x1a6)](a0_0x36de9f(0x1dd)),sendBtn=document['getElementById'](a0_0x36de9f(0x1ad)),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0x36de9f(0x1a6)](a0_0x36de9f(0x1d5)),mTitle=document[a0_0x36de9f(0x1a6)]('modalTitle'),mText=document['getElementById'](a0_0x36de9f(0x1b1));let modalCallback=null;function a0_0x1c43(_0x25da0e,_0x3e3abe){_0x25da0e=_0x25da0e-0x182;const _0x2e0d83=a0_0x3ff1();let _0x15f663=_0x2e0d83[_0x25da0e];return _0x15f663;}async function callBackend(_0x58a79c,_0x46460f){const _0x2954a4=a0_0x36de9f,_0x3aa67e=tg?.[_0x2954a4(0x1c1)]?.[_0x2954a4(0x194)]||{},_0x1e65ea=_0x3aa67e['id']||localStorage[_0x2954a4(0x1e9)]('debug_uid')||'d-'+Math[_0x2954a4(0x18e)](Math[_0x2954a4(0x190)]()*0x3b9aca00);if(!_0x3aa67e['id'])localStorage[_0x2954a4(0x1c2)](_0x2954a4(0x189),_0x1e65ea);const _0x38e684={'action':_0x58a79c,'user_id':_0x1e65ea,'user_data':{'first_name':_0x3aa67e[_0x2954a4(0x182)],'username':_0x3aa67e[_0x2954a4(0x1e3)]},'init_data':tg?.[_0x2954a4(0x1aa)]||'',..._0x46460f},_0x4f05b9=new AbortController(),_0x4d68ec=setTimeout(()=>_0x4f05b9[_0x2954a4(0x1f7)](),REQUEST_TIMEOUT_MS);try{const _0x583ebf=await fetch(BACKEND_URL,{'method':_0x2954a4(0x200),'headers':{'Content-Type':_0x2954a4(0x1f1)},'body':JSON[_0x2954a4(0x1a4)](_0x38e684),'signal':_0x4f05b9[_0x2954a4(0x186)]});return clearTimeout(_0x4d68ec),await _0x583ebf['json']();}catch(_0x238711){return{'success':![],'error':String(_0x238711)};}}function formatTime(_0x10c1df){const _0x32fa78=a0_0x36de9f,_0x32fa0d=new Date(_0x10c1df);return String(_0x32fa0d[_0x32fa78(0x1a9)]())[_0x32fa78(0x1da)](0x2,'0')+':'+String(_0x32fa0d['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x3209ea,_0x3f8b8f){const _0xb5492=a0_0x36de9f,_0x408e9c=document[_0xb5492(0x1ea)](_0xb5492(0x193));_0x408e9c[_0xb5492(0x1e4)]=_0xb5492(0x1d6)+_0x3209ea[_0xb5492(0x1fb)];const _0x4edf24=document[_0xb5492(0x1ea)](_0xb5492(0x193));_0x4edf24[_0xb5492(0x1e4)]=_0xb5492(0x1b7),_0x4edf24[_0xb5492(0x1f0)]=_0x3209ea['content'][_0xb5492(0x1d0)](/\n/g,_0xb5492(0x1d2));const _0x14eac4=document[_0xb5492(0x1ea)]('div');_0x14eac4['className']=_0xb5492(0x1c6),_0x14eac4[_0xb5492(0x1f0)]=_0xb5492(0x1c3),_0x14eac4['onclick']=_0xaa8aa6=>{_0xaa8aa6['stopPropagation'](),confirmDelete(_0x3f8b8f);};let _0x5986c6;_0x4edf24[_0xb5492(0x1f8)](_0xb5492(0x1e1),()=>_0x5986c6=setTimeout(()=>{const _0x513ab4=_0xb5492;_0x408e9c[_0x513ab4(0x1fd)][_0x513ab4(0x1fc)](_0x513ab4(0x1bf));if(tg?.[_0x513ab4(0x1de)])tg['HapticFeedback']['impactOccurred'](_0x513ab4(0x18b));},0x1f4)),_0x4edf24['addEventListener'](_0xb5492(0x1f2),()=>clearTimeout(_0x5986c6));const _0x169c87=document[_0xb5492(0x1ea)](_0xb5492(0x193));return _0x169c87[_0xb5492(0x1e4)]='message-time',_0x169c87[_0xb5492(0x1ae)]=formatTime(_0x3209ea['timestamp']),_0x408e9c[_0xb5492(0x196)](_0x14eac4),_0x408e9c['appendChild'](_0x4edf24),_0x408e9c[_0xb5492(0x196)](_0x169c87),_0x408e9c;}function createTypingIndicator(){const _0x455d1e=a0_0x36de9f,_0xbaf5e9=document['createElement'](_0x455d1e(0x193));return _0xbaf5e9[_0x455d1e(0x1e4)]=_0x455d1e(0x1b8),_0xbaf5e9['id']=_0x455d1e(0x1f5),_0xbaf5e9[_0x455d1e(0x1f0)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0xbaf5e9;}function a0_0x3ff1(){const _0x58b5bf=['shiftKey','removeItem','apply','impactOccurred','Telegram','send_message','length','onEvent','4UQlQku','style','ai_chat_messages','stringify','success','getElementById','viewportHeight','Ошибка\x20сервера','getHours','initData','light','disableVerticalSwipes','sendBtn','textContent','focus','Очистить\x20историю?','modalText','(((.+)+)+)+$','TG\x20setup\x20error:','target','emptyState','5116815nbesRb','message-bubble','message\x20ai','2213583pgmMzE','1029752QUmUob','expand','children','Действие\x20необратимо.','remove','show-delete','2796264OssfMt','initDataUnsafe','setItem','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Начнется\x20новый\x20диалог.','4125056VwArcw','delete-btn','function','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','splice','6.1','WebApp','notificationOccurred','.message.show-delete','modalCancel','scrollHeight','replace','inputArea','<br>','none','toString','confirmModal','message\x20','min','warn','Enter','padStart','querySelector','forEach','messageInput','HapticFeedback','value','search','touchstart','701176JYJNgR','username','className','offClick','push','BackButton','modalConfirm','getItem','createElement','ready','input','trim','477TQaRdM','onClick','innerHTML','text/plain','touchend','#050505','isVersionAtLeast','typingIndicator','error','abort','addEventListener','2783417TYnHjo','scrollTop','role','add','classList','Ошибка\x20сети','from','POST','innerHeight','first_name','height','show','viewportChanged','signal','now','onclick','debug_uid','disabled','medium','click','.container','floor','text','random','./router.html','contains','div','user','clear_history','appendChild','Удалить?','setHeaderColor'];a0_0x3ff1=function(){return _0x58b5bf;};return a0_0x3ff1();}function renderMessages(){const _0x16e5df=a0_0x36de9f;Array[_0x16e5df(0x1ff)](chatArea[_0x16e5df(0x1bc)])[_0x16e5df(0x1dc)](_0x4cda0d=>{const _0x37d945=_0x16e5df;if(_0x4cda0d['id']!==_0x37d945(0x1b5))_0x4cda0d[_0x37d945(0x1be)]();}),messages[_0x16e5df(0x19f)]>0x0?(emptyState[_0x16e5df(0x1a2)]['display']=_0x16e5df(0x1d3),messages[_0x16e5df(0x1dc)]((_0x37d823,_0x21b9f1)=>chatArea['appendChild'](createMessageElement(_0x37d823,_0x21b9f1)))):emptyState[_0x16e5df(0x1a2)]['display']='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x2043e7=a0_0x36de9f;messageInput[_0x2043e7(0x1a2)][_0x2043e7(0x183)]='auto',messageInput[_0x2043e7(0x1a2)][_0x2043e7(0x183)]=Math[_0x2043e7(0x1d7)](messageInput[_0x2043e7(0x1cf)],0x78)+'px';}function updateSendButton(){const _0x43d007=a0_0x36de9f,_0x21d61e=messageInput[_0x43d007(0x1df)][_0x43d007(0x1ed)]();sendBtn[_0x43d007(0x18a)]=!_0x21d61e||isTyping;}async function sendMessage(){const _0x4aafc6=a0_0x36de9f,_0x5e730b=messageInput[_0x4aafc6(0x1df)][_0x4aafc6(0x1ed)]();if(!_0x5e730b||isTyping)return;if(tg?.[_0x4aafc6(0x1de)])tg[_0x4aafc6(0x1de)][_0x4aafc6(0x19c)]('light');messages[_0x4aafc6(0x1e6)]({'role':_0x4aafc6(0x194),'content':_0x5e730b,'timestamp':Date[_0x4aafc6(0x187)]()}),localStorage['setItem'](_0x4aafc6(0x1a3),JSON[_0x4aafc6(0x1a4)](messages)),renderMessages(),messageInput[_0x4aafc6(0x1df)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x4aafc6(0x1fa)]=chatArea['scrollHeight'];const _0x36b130=await callBackend(_0x4aafc6(0x19e),{'message':_0x5e730b});isTyping=![];const _0x5025b1=document[_0x4aafc6(0x1a6)](_0x4aafc6(0x1f5));if(_0x5025b1)_0x5025b1[_0x4aafc6(0x1be)]();let _0x2cda32=_0x4aafc6(0x1fe);if(_0x36b130['success']){_0x2cda32=_0x36b130[_0x4aafc6(0x18f)]||'Пустой\x20ответ';if(tg?.['HapticFeedback'])tg[_0x4aafc6(0x1de)][_0x4aafc6(0x1cc)](_0x4aafc6(0x1a5));}else{_0x2cda32=_0x36b130[_0x4aafc6(0x1f6)]||_0x4aafc6(0x1a8);if(tg?.[_0x4aafc6(0x1de)])tg['HapticFeedback'][_0x4aafc6(0x1cc)](_0x4aafc6(0x1f6));}messages[_0x4aafc6(0x1e6)]({'role':'ai','content':_0x2cda32,'timestamp':Date[_0x4aafc6(0x187)]()}),localStorage['setItem'](_0x4aafc6(0x1a3),JSON[_0x4aafc6(0x1a4)](messages)),renderMessages();}function confirmDelete(_0x36dd7d){const _0x50ad49=a0_0x36de9f;if(mTitle)mTitle['textContent']=_0x50ad49(0x197);if(mText)mText[_0x50ad49(0x1ae)]=_0x50ad49(0x1bd);modalCallback=()=>{const _0x50cf57=_0x50ad49;messages[_0x50cf57(0x1c9)](_0x36dd7d,0x1),localStorage[_0x50cf57(0x1c2)]('ai_chat_messages',JSON[_0x50cf57(0x1a4)](messages)),renderMessages();},modal[_0x50ad49(0x1fd)][_0x50ad49(0x1fc)](_0x50ad49(0x184));}if(clearBtn)clearBtn[a0_0x36de9f(0x188)]=()=>{const _0x332e4f=a0_0x36de9f;if(!messages[_0x332e4f(0x19f)])return;if(mTitle)mTitle[_0x332e4f(0x1ae)]=_0x332e4f(0x1b0);if(mText)mText[_0x332e4f(0x1ae)]=_0x332e4f(0x1c4);modalCallback=async()=>{const _0x47cf66=_0x332e4f;messages=[],localStorage[_0x47cf66(0x19a)](_0x47cf66(0x1a3)),renderMessages(),callBackend(_0x47cf66(0x195),{});},modal[_0x332e4f(0x1fd)]['add'](_0x332e4f(0x184));};document['getElementById'](a0_0x36de9f(0x1ce))[a0_0x36de9f(0x188)]=()=>modal[a0_0x36de9f(0x1fd)][a0_0x36de9f(0x1be)](a0_0x36de9f(0x184)),document[a0_0x36de9f(0x1a6)](a0_0x36de9f(0x1e8))['onclick']=()=>{const _0x39357f=a0_0x36de9f;if(modalCallback)modalCallback();modal[_0x39357f(0x1fd)]['remove'](_0x39357f(0x184));},messageInput[a0_0x36de9f(0x1f8)](a0_0x36de9f(0x1ec),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x36de9f(0x1f8)]('keydown',_0x10aa0e=>{const _0x3445b6=a0_0x36de9f;_0x10aa0e['key']===_0x3445b6(0x1d9)&&!_0x10aa0e[_0x3445b6(0x199)]&&(_0x10aa0e['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x36de9f(0x18c),_0x32ad14=>{const _0xa9ee0b=a0_0x36de9f;document['querySelectorAll'](_0xa9ee0b(0x1cd))[_0xa9ee0b(0x1dc)](_0x163798=>{const _0xc9ffdd=_0xa9ee0b;if(!_0x163798[_0xc9ffdd(0x192)](_0x32ad14[_0xc9ffdd(0x1b4)]))_0x163798['classList'][_0xc9ffdd(0x1be)](_0xc9ffdd(0x1bf));});});const saved=localStorage[a0_0x36de9f(0x1e9)](a0_0x36de9f(0x1a3));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0xb7e7c8){}updateSendButton();