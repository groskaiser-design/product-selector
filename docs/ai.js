const a0_0x1db03e=a0_0x3254;(function(_0x4ba0df,_0x24ca56){const _0x5e85ee=a0_0x3254,_0x173cc2=_0x4ba0df();while(!![]){try{const _0x2a0941=parseInt(_0x5e85ee(0x1c9))/0x1+parseInt(_0x5e85ee(0x165))/0x2*(-parseInt(_0x5e85ee(0x1b4))/0x3)+parseInt(_0x5e85ee(0x196))/0x4+parseInt(_0x5e85ee(0x16d))/0x5*(-parseInt(_0x5e85ee(0x1ad))/0x6)+parseInt(_0x5e85ee(0x1a6))/0x7*(-parseInt(_0x5e85ee(0x1c1))/0x8)+parseInt(_0x5e85ee(0x168))/0x9*(parseInt(_0x5e85ee(0x1a0))/0xa)+-parseInt(_0x5e85ee(0x1a3))/0xb;if(_0x2a0941===_0x24ca56)break;else _0x173cc2['push'](_0x173cc2['shift']());}catch(_0x521b1f){_0x173cc2['push'](_0x173cc2['shift']());}}}(a0_0x30fc,0x80e61));const tg=window[a0_0x1db03e(0x1a2)]?.[a0_0x1db03e(0x1b3)],HOME_URL=a0_0x1db03e(0x158);function setupTelegramBackButton(){const _0x5217cb=a0_0x1db03e;if(!tg)return;try{tg[_0x5217cb(0x1b5)](),tg[_0x5217cb(0x18c)](),tg[_0x5217cb(0x15e)]?.('#050505');if(tg[_0x5217cb(0x185)]?.(_0x5217cb(0x1ba)))tg[_0x5217cb(0x144)]?.();const _0x2a1918=tg[_0x5217cb(0x1c6)];if(_0x2a1918){_0x2a1918['show']();if(typeof _0x2a1918[_0x5217cb(0x186)]===_0x5217cb(0x1a9))try{_0x2a1918[_0x5217cb(0x186)]();}catch(_0xcad623){}_0x2a1918['onClick'](()=>{const _0x1b51b0=_0x5217cb;if(tg[_0x1b51b0(0x189)])tg['HapticFeedback'][_0x1b51b0(0x169)](_0x1b51b0(0x1ca));location['href']=HOME_URL;});}}catch(_0x1a1acc){console[_0x5217cb(0x1a7)](_0x5217cb(0x147),_0x1a1acc);}}(function initStableLayout(){const _0x4110fd=a0_0x1db03e,_0x38d03c=(function(){let _0x41527b=!![];return function(_0x5509ea,_0x4a375a){const _0x54b832=_0x41527b?function(){if(_0x4a375a){const _0x19fe93=_0x4a375a['apply'](_0x5509ea,arguments);return _0x4a375a=null,_0x19fe93;}}:function(){};return _0x41527b=![],_0x54b832;};}()),_0x25b03e=document[_0x4110fd(0x164)](_0x4110fd(0x18d)),_0x5cc5b4=document[_0x4110fd(0x184)](_0x4110fd(0x198)),_0x32a0e0=document[_0x4110fd(0x184)](_0x4110fd(0x181)),_0x38dc0b=document[_0x4110fd(0x184)](_0x4110fd(0x16e));function _0x237c09(){const _0xe28809=_0x4110fd,_0x28261f=_0x38d03c(this,function(){const _0xc493dc=a0_0x3254;return _0x28261f[_0xc493dc(0x176)]()['search'](_0xc493dc(0x152))[_0xc493dc(0x176)]()[_0xc493dc(0x19b)](_0x28261f)[_0xc493dc(0x194)]('(((.+)+)+)+$');});_0x28261f();if(!_0x25b03e)return;const _0x59e2cb=tg&&tg[_0xe28809(0x175)]?tg[_0xe28809(0x175)]:window[_0xe28809(0x193)];_0x25b03e['style'][_0xe28809(0x146)]=_0x59e2cb+'px';if(_0x5cc5b4){const _0x482c11=_0x5cc5b4[_0xe28809(0x15f)];_0x32a0e0[_0xe28809(0x17f)][_0xe28809(0x1be)]=_0x482c11+0x28+'px';}}tg?tg[_0x4110fd(0x1c8)]('viewportChanged',({isStateStable:_0x427a40})=>{_0x237c09();if(_0x427a40)requestAnimationFrame(()=>{const _0x26cbad=a0_0x3254;_0x32a0e0[_0x26cbad(0x14f)]=_0x32a0e0[_0x26cbad(0x16f)];});}):window[_0x4110fd(0x166)](_0x4110fd(0x1a4),_0x237c09),_0x237c09(),_0x38dc0b&&(_0x38dc0b[_0x4110fd(0x166)](_0x4110fd(0x17d),()=>{requestAnimationFrame(_0x237c09);}),_0x38dc0b[_0x4110fd(0x166)](_0x4110fd(0x155),()=>{setTimeout(()=>{const _0x1647e8=a0_0x3254;_0x32a0e0[_0x1647e8(0x14f)]=_0x32a0e0['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1db03e(0x187),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x1db03e(0x181)),emptyState=document[a0_0x1db03e(0x184)](a0_0x1db03e(0x191)),messageInput=document[a0_0x1db03e(0x184)](a0_0x1db03e(0x16e)),sendBtn=document[a0_0x1db03e(0x184)](a0_0x1db03e(0x1c2)),clearBtn=document['getElementById'](a0_0x1db03e(0x151)),modal=document[a0_0x1db03e(0x184)]('confirmModal'),mTitle=document[a0_0x1db03e(0x184)](a0_0x1db03e(0x195)),mText=document[a0_0x1db03e(0x184)](a0_0x1db03e(0x161));let modalCallback=null;async function callBackend(_0x25963d,_0x5f1658){const _0x34b378=a0_0x1db03e,_0x36cba5=tg?.[_0x34b378(0x1aa)]?.[_0x34b378(0x1b7)]||{},_0x2b4a9b=_0x36cba5['id']||localStorage['getItem'](_0x34b378(0x18e))||'d-'+Math[_0x34b378(0x1bf)](Math[_0x34b378(0x149)]()*0x3b9aca00);if(!_0x36cba5['id'])localStorage['setItem'](_0x34b378(0x18e),_0x2b4a9b);const _0x16b52d={'action':_0x25963d,'user_id':_0x2b4a9b,'user_data':{'first_name':_0x36cba5[_0x34b378(0x1cb)],'username':_0x36cba5[_0x34b378(0x1cc)]},'init_data':tg?.[_0x34b378(0x14b)]||'',..._0x5f1658},_0xffb449=new AbortController(),_0x2becf2=setTimeout(()=>_0xffb449['abort'](),REQUEST_TIMEOUT_MS);try{const _0x378042=await fetch(BACKEND_URL,{'method':_0x34b378(0x19d),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x16b52d),'signal':_0xffb449['signal']});return clearTimeout(_0x2becf2),await _0x378042[_0x34b378(0x1b2)]();}catch(_0x56ede8){return{'success':![],'error':String(_0x56ede8)};}}function formatTime(_0x17498b){const _0x24c59d=a0_0x1db03e,_0x1ee483=new Date(_0x17498b);return String(_0x1ee483[_0x24c59d(0x178)]())[_0x24c59d(0x171)](0x2,'0')+':'+String(_0x1ee483[_0x24c59d(0x16a)]())[_0x24c59d(0x171)](0x2,'0');}function a0_0x30fc(){const _0x34df02=['length','355CQUzrm','messageInput','scrollHeight','touchend','padStart','min','onclick','stringify','viewportHeight','toString','keydown','getHours','target','Ошибка\x20сети','stopPropagation','Enter','input','auto','style','notificationOccurred','chatArea','querySelectorAll','content','getElementById','isVersionAtLeast','offClick','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','delete-btn','HapticFeedback','none','Пустой\x20ответ','expand','.container','debug_uid','preventDefault','contains','emptyState','flex','innerHeight','search','modalTitle','2261792jcTDvt','success','inputArea','ai_chat_messages','message-bubble','constructor','removeItem','POST','forEach','appendChild','610cZVdSl','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','Telegram','104434oMQJwV','resize','Удалить?','7ezYiBN','warn','Ошибка\x20сервера','function','initDataUnsafe','modalCancel','key','65298bePYTH','className','parse','getItem','medium','json','WebApp','15654BSVjQz','ready','display','user','touchstart','div','6.1','show','show-delete','add','paddingBottom','floor','textContent','1475304pjHBEn','sendBtn','error','innerHTML','.message.show-delete','BackButton','click','onEvent','646168DzBeJD','light','first_name','username','disableVerticalSwipes','role','height','TG\x20setup\x20error:','timestamp','random','now','initData','text','Начнется\x20новый\x20диалог.','push','scrollTop','setItem','clearBtn','(((.+)+)+)+$','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Очистить\x20историю?','focus','typingIndicator','children','./router.html','disabled','value','createElement','remove','Действие\x20необратимо.','setHeaderColor','offsetHeight','message\x20ai','modalText','splice','replace','querySelector','94vRruSI','addEventListener','trim','77931kWupti','impactOccurred','getMinutes','classList'];a0_0x30fc=function(){return _0x34df02;};return a0_0x30fc();}function createMessageElement(_0x3453b0,_0x4e077c){const _0x4be372=a0_0x1db03e,_0x1d7ccd=document[_0x4be372(0x15b)]('div');_0x1d7ccd['className']='message\x20'+_0x3453b0[_0x4be372(0x145)];const _0x10fffa=document[_0x4be372(0x15b)]('div');_0x10fffa[_0x4be372(0x1ae)]=_0x4be372(0x19a),_0x10fffa[_0x4be372(0x1c4)]=_0x3453b0[_0x4be372(0x183)][_0x4be372(0x163)](/\n/g,'<br>');const _0x921bff=document[_0x4be372(0x15b)](_0x4be372(0x1b9));_0x921bff[_0x4be372(0x1ae)]=_0x4be372(0x188),_0x921bff[_0x4be372(0x1c4)]=_0x4be372(0x153),_0x921bff[_0x4be372(0x173)]=_0x4295c9=>{const _0x1242dc=_0x4be372;_0x4295c9[_0x1242dc(0x17b)](),confirmDelete(_0x4e077c);};let _0x8af9ea;_0x10fffa[_0x4be372(0x166)](_0x4be372(0x1b8),()=>_0x8af9ea=setTimeout(()=>{const _0x34c608=_0x4be372;_0x1d7ccd[_0x34c608(0x16b)][_0x34c608(0x1bd)](_0x34c608(0x1bc));if(tg?.['HapticFeedback'])tg[_0x34c608(0x189)][_0x34c608(0x169)](_0x34c608(0x1b1));},0x1f4)),_0x10fffa[_0x4be372(0x166)](_0x4be372(0x170),()=>clearTimeout(_0x8af9ea));const _0x102586=document[_0x4be372(0x15b)](_0x4be372(0x1b9));return _0x102586[_0x4be372(0x1ae)]='message-time',_0x102586['textContent']=formatTime(_0x3453b0[_0x4be372(0x148)]),_0x1d7ccd[_0x4be372(0x19f)](_0x921bff),_0x1d7ccd[_0x4be372(0x19f)](_0x10fffa),_0x1d7ccd['appendChild'](_0x102586),_0x1d7ccd;}function createTypingIndicator(){const _0x55ab2b=a0_0x1db03e,_0x4e5306=document[_0x55ab2b(0x15b)](_0x55ab2b(0x1b9));return _0x4e5306[_0x55ab2b(0x1ae)]=_0x55ab2b(0x160),_0x4e5306['id']=_0x55ab2b(0x156),_0x4e5306[_0x55ab2b(0x1c4)]=_0x55ab2b(0x1a1),_0x4e5306;}function renderMessages(){const _0x5033ef=a0_0x1db03e;Array['from'](chatArea[_0x5033ef(0x157)])['forEach'](_0x22b3e8=>{const _0x53a6cf=_0x5033ef;if(_0x22b3e8['id']!==_0x53a6cf(0x191))_0x22b3e8['remove']();}),messages['length']>0x0?(emptyState[_0x5033ef(0x17f)]['display']=_0x5033ef(0x18a),messages[_0x5033ef(0x19e)]((_0x5e05ae,_0x5b4132)=>chatArea['appendChild'](createMessageElement(_0x5e05ae,_0x5b4132)))):emptyState[_0x5033ef(0x17f)][_0x5033ef(0x1b6)]=_0x5033ef(0x192),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x5033ef(0x16f)]);}function autoResizeTextarea(){const _0xcef3e1=a0_0x1db03e;messageInput[_0xcef3e1(0x17f)]['height']=_0xcef3e1(0x17e),messageInput[_0xcef3e1(0x17f)]['height']=Math[_0xcef3e1(0x172)](messageInput[_0xcef3e1(0x16f)],0x78)+'px';}function updateSendButton(){const _0x449440=a0_0x1db03e,_0x446bf5=messageInput[_0x449440(0x15a)][_0x449440(0x167)]();sendBtn[_0x449440(0x159)]=!_0x446bf5||isTyping;}async function sendMessage(){const _0x404ca3=a0_0x1db03e,_0x18b7c6=messageInput[_0x404ca3(0x15a)]['trim']();if(!_0x18b7c6||isTyping)return;if(tg?.[_0x404ca3(0x189)])tg[_0x404ca3(0x189)][_0x404ca3(0x169)](_0x404ca3(0x1ca));messages[_0x404ca3(0x14e)]({'role':_0x404ca3(0x1b7),'content':_0x18b7c6,'timestamp':Date[_0x404ca3(0x14a)]()}),localStorage[_0x404ca3(0x150)](_0x404ca3(0x199),JSON[_0x404ca3(0x174)](messages)),renderMessages(),messageInput[_0x404ca3(0x15a)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x404ca3(0x14f)]=chatArea[_0x404ca3(0x16f)];const _0x2f53bb=await callBackend('send_message',{'message':_0x18b7c6});isTyping=![];const _0x4ceebb=document[_0x404ca3(0x184)]('typingIndicator');if(_0x4ceebb)_0x4ceebb['remove']();let _0x57d6f9=_0x404ca3(0x17a);if(_0x2f53bb['success']){_0x57d6f9=_0x2f53bb[_0x404ca3(0x14c)]||_0x404ca3(0x18b);if(tg?.[_0x404ca3(0x189)])tg[_0x404ca3(0x189)]['notificationOccurred'](_0x404ca3(0x197));}else{_0x57d6f9=_0x2f53bb[_0x404ca3(0x1c3)]||_0x404ca3(0x1a8);if(tg?.[_0x404ca3(0x189)])tg['HapticFeedback'][_0x404ca3(0x180)](_0x404ca3(0x1c3));}messages['push']({'role':'ai','content':_0x57d6f9,'timestamp':Date[_0x404ca3(0x14a)]()}),localStorage[_0x404ca3(0x150)](_0x404ca3(0x199),JSON[_0x404ca3(0x174)](messages)),renderMessages();}function confirmDelete(_0x2dcbaf){const _0x355c85=a0_0x1db03e;if(mTitle)mTitle['textContent']=_0x355c85(0x1a5);if(mText)mText['textContent']=_0x355c85(0x15d);modalCallback=()=>{const _0x172ffd=_0x355c85;messages[_0x172ffd(0x162)](_0x2dcbaf,0x1),localStorage[_0x172ffd(0x150)]('ai_chat_messages',JSON[_0x172ffd(0x174)](messages)),renderMessages();},modal[_0x355c85(0x16b)]['add'](_0x355c85(0x1bb));}if(clearBtn)clearBtn[a0_0x1db03e(0x173)]=()=>{const _0x1f6754=a0_0x1db03e;if(!messages[_0x1f6754(0x16c)])return;if(mTitle)mTitle[_0x1f6754(0x1c0)]=_0x1f6754(0x154);if(mText)mText[_0x1f6754(0x1c0)]=_0x1f6754(0x14d);modalCallback=async()=>{const _0x2b853b=_0x1f6754;messages=[],localStorage[_0x2b853b(0x19c)](_0x2b853b(0x199)),renderMessages(),callBackend('clear_history',{});},modal[_0x1f6754(0x16b)]['add'](_0x1f6754(0x1bb));};document[a0_0x1db03e(0x184)](a0_0x1db03e(0x1ab))[a0_0x1db03e(0x173)]=()=>modal[a0_0x1db03e(0x16b)][a0_0x1db03e(0x15c)]('show'),document['getElementById']('modalConfirm')[a0_0x1db03e(0x173)]=()=>{const _0x2d9725=a0_0x1db03e;if(modalCallback)modalCallback();modal[_0x2d9725(0x16b)][_0x2d9725(0x15c)](_0x2d9725(0x1bb));},messageInput[a0_0x1db03e(0x166)](a0_0x1db03e(0x17d),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1db03e(0x166)](a0_0x1db03e(0x177),_0x1b2004=>{const _0x1ff5f7=a0_0x1db03e;_0x1b2004[_0x1ff5f7(0x1ac)]===_0x1ff5f7(0x17c)&&!_0x1b2004['shiftKey']&&(_0x1b2004[_0x1ff5f7(0x18f)](),sendMessage());}),sendBtn[a0_0x1db03e(0x173)]=sendMessage,document[a0_0x1db03e(0x166)](a0_0x1db03e(0x1c7),_0x504efe=>{const _0x22a2d2=a0_0x1db03e;document[_0x22a2d2(0x182)](_0x22a2d2(0x1c5))[_0x22a2d2(0x19e)](_0x5039a6=>{const _0x44d1ad=_0x22a2d2;if(!_0x5039a6[_0x44d1ad(0x190)](_0x504efe[_0x44d1ad(0x179)]))_0x5039a6['classList']['remove'](_0x44d1ad(0x1bc));});});const saved=localStorage[a0_0x1db03e(0x1b0)](a0_0x1db03e(0x199));if(saved)try{messages=JSON[a0_0x1db03e(0x1af)](saved),renderMessages();}catch(a0_0x503627){}function a0_0x3254(_0x476aae,_0x5f3504){_0x476aae=_0x476aae-0x144;const _0x67dc4a=a0_0x30fc();let _0x39c126=_0x67dc4a[_0x476aae];return _0x39c126;}updateSendButton();