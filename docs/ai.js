const a0_0x504691=a0_0x2608;(function(_0xbdc3c7,_0x33f58d){const _0x13159e=a0_0x2608,_0x438378=_0xbdc3c7();while(!![]){try{const _0x192a9c=parseInt(_0x13159e(0x1e8))/0x1*(-parseInt(_0x13159e(0x1f1))/0x2)+-parseInt(_0x13159e(0x1d5))/0x3*(-parseInt(_0x13159e(0x22c))/0x4)+-parseInt(_0x13159e(0x1fb))/0x5+parseInt(_0x13159e(0x219))/0x6*(parseInt(_0x13159e(0x1c9))/0x7)+parseInt(_0x13159e(0x23c))/0x8*(-parseInt(_0x13159e(0x1e6))/0x9)+parseInt(_0x13159e(0x1dd))/0xa*(parseInt(_0x13159e(0x1e1))/0xb)+-parseInt(_0x13159e(0x1dc))/0xc;if(_0x192a9c===_0x33f58d)break;else _0x438378['push'](_0x438378['shift']());}catch(_0x46c842){_0x438378['push'](_0x438378['shift']());}}}(a0_0x429b,0x3bce4));const tg=window[a0_0x504691(0x1d9)]?.[a0_0x504691(0x20b)],HOME_URL=a0_0x504691(0x20f);function setupTelegramBackButton(){const _0x424dd2=a0_0x504691;if(!tg)return;try{tg[_0x424dd2(0x24a)](),tg[_0x424dd2(0x210)](),tg['setHeaderColor']?.(_0x424dd2(0x22e));if(tg[_0x424dd2(0x1ea)]?.(_0x424dd2(0x207)))tg['disableVerticalSwipes']?.();const _0xafeed6=tg[_0x424dd2(0x1f5)];if(_0xafeed6){_0xafeed6[_0x424dd2(0x220)]();if(typeof _0xafeed6[_0x424dd2(0x244)]==='function')try{_0xafeed6[_0x424dd2(0x244)]();}catch(_0x41596a){}_0xafeed6[_0x424dd2(0x1e4)](()=>{const _0xc9b15d=_0x424dd2;if(tg[_0xc9b15d(0x1da)])tg[_0xc9b15d(0x1da)][_0xc9b15d(0x238)](_0xc9b15d(0x1cc));location['href']=HOME_URL;});}}catch(_0x4b8dab){console['warn'](_0x424dd2(0x234),_0x4b8dab);}}function a0_0x429b(){const _0x2d8653=['forEach','153jvjIgD','Пустой\x20ответ','155MXfLSL','add','isVersionAtLeast','constructor','focus','message\x20ai','Ошибка\x20сети','stringify','getElementById','2380HUwfBZ','initData','text','floor','BackButton','getItem','error','createElement','text/plain','className','805655SJMcWQ','disabled','message-time','confirmModal','ai_chat_messages','touchstart','scrollTop','getMinutes','key','initDataUnsafe','length','replace','6.1','click','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','children','WebApp','div','send_message','abort','./router.html','expand','Удалить?','show-delete','emptyState','json','modalConfirm','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','messageInput','input','807006GZbmcu','clear_history','onclick','content','onEvent','scrollHeight','push','show','Очистить\x20историю?','<br>','random','.message.show-delete','parse','value','success','Начнется\x20новый\x20диалог.','search','viewportChanged','paddingBottom','116LXmKJO','message\x20','#050505','username','timestamp','target','modalCancel','Enter','TG\x20setup\x20error:','innerHeight','none','remove','impactOccurred','getHours','typingIndicator','user','56496vZjVrL','first_name','textContent','debug_uid','display','addEventListener','querySelectorAll','signal','offClick','toString','notificationOccurred','message-bubble','keydown','chatArea','ready','innerHTML','style','7ymZEEc','(((.+)+)+)+$','now','light','contains','appendChild','Действие\x20необратимо.','classList','from','setItem','viewportHeight','height','38364usBlXG','.container','modalText','padStart','Telegram','HapticFeedback','POST','509412qwFkAb','2476970uIpJBf','shiftKey','clearBtn','auto','11SVgnWH','apply','sendBtn','onClick'];a0_0x429b=function(){return _0x2d8653;};return a0_0x429b();}(function initStableLayout(){const _0x2b5d6f=a0_0x504691,_0x421b72=(function(){let _0x3b6f5e=!![];return function(_0x37b276,_0x227706){const _0x5c2b0e=_0x3b6f5e?function(){const _0x48e8e6=a0_0x2608;if(_0x227706){const _0x462636=_0x227706[_0x48e8e6(0x1e2)](_0x37b276,arguments);return _0x227706=null,_0x462636;}}:function(){};return _0x3b6f5e=![],_0x5c2b0e;};}()),_0x4bdf65=document['querySelector'](_0x2b5d6f(0x1d6)),_0xa47cee=document[_0x2b5d6f(0x1f0)]('inputArea'),_0x4e7489=document['getElementById']('chatArea'),_0x4da466=document[_0x2b5d6f(0x1f0)](_0x2b5d6f(0x217));function _0x126edb(){const _0xc359fe=_0x2b5d6f,_0x434e7f=_0x421b72(this,function(){const _0x4f7c17=a0_0x2608;return _0x434e7f[_0x4f7c17(0x245)]()['search']('(((.+)+)+)+$')[_0x4f7c17(0x245)]()[_0x4f7c17(0x1eb)](_0x434e7f)[_0x4f7c17(0x229)](_0x4f7c17(0x1ca));});_0x434e7f();if(!_0x4bdf65)return;const _0x2bb25d=tg&&tg[_0xc359fe(0x1d3)]?tg[_0xc359fe(0x1d3)]:window[_0xc359fe(0x235)];_0x4bdf65[_0xc359fe(0x1c8)][_0xc359fe(0x1d4)]=_0x2bb25d+'px';if(_0xa47cee){const _0x22adb0=_0xa47cee['offsetHeight'];_0x4e7489[_0xc359fe(0x1c8)][_0xc359fe(0x22b)]=_0x22adb0+0x28+'px';}}tg?tg[_0x2b5d6f(0x21d)](_0x2b5d6f(0x22a),({isStateStable:_0x61294d})=>{_0x126edb();if(_0x61294d)requestAnimationFrame(()=>{const _0x1b8fdb=a0_0x2608;_0x4e7489[_0x1b8fdb(0x201)]=_0x4e7489[_0x1b8fdb(0x21e)];});}):window[_0x2b5d6f(0x241)]('resize',_0x126edb),_0x126edb(),_0x4da466&&(_0x4da466[_0x2b5d6f(0x241)]('input',()=>{requestAnimationFrame(_0x126edb);}),_0x4da466[_0x2b5d6f(0x241)](_0x2b5d6f(0x1ec),()=>{setTimeout(()=>{const _0x26c0a4=a0_0x2608;_0x4e7489[_0x26c0a4(0x201)]=_0x4e7489['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());function a0_0x2608(_0x2bf065,_0x4878ce){_0x2bf065=_0x2bf065-0x1c7;const _0xc1b8ca=a0_0x429b();let _0x12358b=_0xc1b8ca[_0x2bf065];return _0x12358b;}const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x504691(0x1f0)](a0_0x504691(0x249)),emptyState=document[a0_0x504691(0x1f0)](a0_0x504691(0x213)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x504691(0x1f0)](a0_0x504691(0x1e3)),clearBtn=document[a0_0x504691(0x1f0)](a0_0x504691(0x1df)),modal=document[a0_0x504691(0x1f0)](a0_0x504691(0x1fe)),mTitle=document[a0_0x504691(0x1f0)]('modalTitle'),mText=document[a0_0x504691(0x1f0)](a0_0x504691(0x1d7));let modalCallback=null;async function callBackend(_0x2abb41,_0x531e59){const _0x27fb4f=a0_0x504691,_0x29787d=tg?.[_0x27fb4f(0x204)]?.[_0x27fb4f(0x23b)]||{},_0x3e7cb2=_0x29787d['id']||localStorage[_0x27fb4f(0x1f6)](_0x27fb4f(0x23f))||'d-'+Math[_0x27fb4f(0x1f4)](Math[_0x27fb4f(0x223)]()*0x3b9aca00);if(!_0x29787d['id'])localStorage[_0x27fb4f(0x1d2)](_0x27fb4f(0x23f),_0x3e7cb2);const _0x317e84={'action':_0x2abb41,'user_id':_0x3e7cb2,'user_data':{'first_name':_0x29787d[_0x27fb4f(0x23d)],'username':_0x29787d[_0x27fb4f(0x22f)]},'init_data':tg?.[_0x27fb4f(0x1f2)]||'',..._0x531e59},_0x11bcd9=new AbortController(),_0x85029a=setTimeout(()=>_0x11bcd9[_0x27fb4f(0x20e)](),REQUEST_TIMEOUT_MS);try{const _0x387e62=await fetch(BACKEND_URL,{'method':_0x27fb4f(0x1db),'headers':{'Content-Type':_0x27fb4f(0x1f9)},'body':JSON[_0x27fb4f(0x1ef)](_0x317e84),'signal':_0x11bcd9[_0x27fb4f(0x243)]});return clearTimeout(_0x85029a),await _0x387e62[_0x27fb4f(0x214)]();}catch(_0x55ce93){return{'success':![],'error':String(_0x55ce93)};}}function formatTime(_0x51c975){const _0x37c50a=a0_0x504691,_0x4fad05=new Date(_0x51c975);return String(_0x4fad05[_0x37c50a(0x239)]())[_0x37c50a(0x1d8)](0x2,'0')+':'+String(_0x4fad05[_0x37c50a(0x202)]())[_0x37c50a(0x1d8)](0x2,'0');}function createMessageElement(_0x48450f,_0x5473cd){const _0x376b85=a0_0x504691,_0x339e53=document[_0x376b85(0x1f8)](_0x376b85(0x20c));_0x339e53['className']=_0x376b85(0x22d)+_0x48450f['role'];const _0x4bc4ea=document[_0x376b85(0x1f8)](_0x376b85(0x20c));_0x4bc4ea[_0x376b85(0x1fa)]=_0x376b85(0x247),_0x4bc4ea[_0x376b85(0x1c7)]=_0x48450f[_0x376b85(0x21c)][_0x376b85(0x206)](/\n/g,_0x376b85(0x222));const _0x208c4f=document[_0x376b85(0x1f8)](_0x376b85(0x20c));_0x208c4f[_0x376b85(0x1fa)]='delete-btn',_0x208c4f[_0x376b85(0x1c7)]=_0x376b85(0x209),_0x208c4f[_0x376b85(0x21b)]=_0x5dcee8=>{_0x5dcee8['stopPropagation'](),confirmDelete(_0x5473cd);};let _0x58ca2a;_0x4bc4ea['addEventListener'](_0x376b85(0x200),()=>_0x58ca2a=setTimeout(()=>{const _0x139516=_0x376b85;_0x339e53[_0x139516(0x1d0)][_0x139516(0x1e9)](_0x139516(0x212));if(tg?.[_0x139516(0x1da)])tg['HapticFeedback'][_0x139516(0x238)]('medium');},0x1f4)),_0x4bc4ea[_0x376b85(0x241)]('touchend',()=>clearTimeout(_0x58ca2a));const _0x44217c=document[_0x376b85(0x1f8)](_0x376b85(0x20c));return _0x44217c['className']=_0x376b85(0x1fd),_0x44217c['textContent']=formatTime(_0x48450f[_0x376b85(0x230)]),_0x339e53[_0x376b85(0x1ce)](_0x208c4f),_0x339e53[_0x376b85(0x1ce)](_0x4bc4ea),_0x339e53[_0x376b85(0x1ce)](_0x44217c),_0x339e53;}function createTypingIndicator(){const _0x40c676=a0_0x504691,_0x306216=document[_0x40c676(0x1f8)](_0x40c676(0x20c));return _0x306216[_0x40c676(0x1fa)]=_0x40c676(0x1ed),_0x306216['id']=_0x40c676(0x23a),_0x306216[_0x40c676(0x1c7)]=_0x40c676(0x216),_0x306216;}function renderMessages(){const _0x1c8e44=a0_0x504691;Array[_0x1c8e44(0x1d1)](chatArea[_0x1c8e44(0x20a)])['forEach'](_0x3fda6d=>{const _0x2c99c7=_0x1c8e44;if(_0x3fda6d['id']!==_0x2c99c7(0x213))_0x3fda6d['remove']();}),messages[_0x1c8e44(0x205)]>0x0?(emptyState[_0x1c8e44(0x1c8)][_0x1c8e44(0x240)]=_0x1c8e44(0x236),messages['forEach']((_0x3acf51,_0x44050a)=>chatArea[_0x1c8e44(0x1ce)](createMessageElement(_0x3acf51,_0x44050a)))):emptyState[_0x1c8e44(0x1c8)][_0x1c8e44(0x240)]='flex',requestAnimationFrame(()=>chatArea[_0x1c8e44(0x201)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x456563=a0_0x504691;messageInput[_0x456563(0x1c8)]['height']=_0x456563(0x1e0),messageInput[_0x456563(0x1c8)][_0x456563(0x1d4)]=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x1bdb47=a0_0x504691,_0x55025e=messageInput[_0x1bdb47(0x226)]['trim']();sendBtn[_0x1bdb47(0x1fc)]=!_0x55025e||isTyping;}async function sendMessage(){const _0x2c0bd1=a0_0x504691,_0x1afcec=messageInput['value']['trim']();if(!_0x1afcec||isTyping)return;if(tg?.[_0x2c0bd1(0x1da)])tg[_0x2c0bd1(0x1da)]['impactOccurred']('light');messages[_0x2c0bd1(0x21f)]({'role':_0x2c0bd1(0x23b),'content':_0x1afcec,'timestamp':Date[_0x2c0bd1(0x1cb)]()}),localStorage[_0x2c0bd1(0x1d2)](_0x2c0bd1(0x1ff),JSON[_0x2c0bd1(0x1ef)](messages)),renderMessages(),messageInput[_0x2c0bd1(0x226)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x2c0bd1(0x201)]=chatArea['scrollHeight'];const _0xa85c92=await callBackend(_0x2c0bd1(0x20d),{'message':_0x1afcec});isTyping=![];const _0x52dcee=document[_0x2c0bd1(0x1f0)](_0x2c0bd1(0x23a));if(_0x52dcee)_0x52dcee[_0x2c0bd1(0x237)]();let _0x508fc9=_0x2c0bd1(0x1ee);if(_0xa85c92[_0x2c0bd1(0x227)]){_0x508fc9=_0xa85c92[_0x2c0bd1(0x1f3)]||_0x2c0bd1(0x1e7);if(tg?.[_0x2c0bd1(0x1da)])tg[_0x2c0bd1(0x1da)][_0x2c0bd1(0x246)](_0x2c0bd1(0x227));}else{_0x508fc9=_0xa85c92[_0x2c0bd1(0x1f7)]||'Ошибка\x20сервера';if(tg?.[_0x2c0bd1(0x1da)])tg['HapticFeedback']['notificationOccurred']('error');}messages[_0x2c0bd1(0x21f)]({'role':'ai','content':_0x508fc9,'timestamp':Date[_0x2c0bd1(0x1cb)]()}),localStorage[_0x2c0bd1(0x1d2)](_0x2c0bd1(0x1ff),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x2bd0da){const _0x4b6d7e=a0_0x504691;if(mTitle)mTitle[_0x4b6d7e(0x23e)]=_0x4b6d7e(0x211);if(mText)mText['textContent']=_0x4b6d7e(0x1cf);modalCallback=()=>{const _0xf1a857=_0x4b6d7e;messages['splice'](_0x2bd0da,0x1),localStorage[_0xf1a857(0x1d2)]('ai_chat_messages',JSON[_0xf1a857(0x1ef)](messages)),renderMessages();},modal[_0x4b6d7e(0x1d0)][_0x4b6d7e(0x1e9)](_0x4b6d7e(0x220));}if(clearBtn)clearBtn[a0_0x504691(0x21b)]=()=>{const _0x5aa50c=a0_0x504691;if(!messages[_0x5aa50c(0x205)])return;if(mTitle)mTitle[_0x5aa50c(0x23e)]=_0x5aa50c(0x221);if(mText)mText[_0x5aa50c(0x23e)]=_0x5aa50c(0x228);modalCallback=async()=>{const _0x467c90=_0x5aa50c;messages=[],localStorage['removeItem'](_0x467c90(0x1ff)),renderMessages(),callBackend(_0x467c90(0x21a),{});},modal[_0x5aa50c(0x1d0)][_0x5aa50c(0x1e9)](_0x5aa50c(0x220));};document[a0_0x504691(0x1f0)](a0_0x504691(0x232))['onclick']=()=>modal[a0_0x504691(0x1d0)][a0_0x504691(0x237)](a0_0x504691(0x220)),document[a0_0x504691(0x1f0)](a0_0x504691(0x215))[a0_0x504691(0x21b)]=()=>{const _0x3d6519=a0_0x504691;if(modalCallback)modalCallback();modal[_0x3d6519(0x1d0)][_0x3d6519(0x237)]('show');},messageInput[a0_0x504691(0x241)](a0_0x504691(0x218),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x504691(0x241)](a0_0x504691(0x248),_0x5a53c8=>{const _0x3ef3f9=a0_0x504691;_0x5a53c8[_0x3ef3f9(0x203)]===_0x3ef3f9(0x233)&&!_0x5a53c8[_0x3ef3f9(0x1de)]&&(_0x5a53c8['preventDefault'](),sendMessage());}),sendBtn[a0_0x504691(0x21b)]=sendMessage,document['addEventListener'](a0_0x504691(0x208),_0x6ce430=>{const _0x494896=a0_0x504691;document[_0x494896(0x242)](_0x494896(0x224))[_0x494896(0x1e5)](_0x86096c=>{const _0xbc89b8=_0x494896;if(!_0x86096c[_0xbc89b8(0x1cd)](_0x6ce430[_0xbc89b8(0x231)]))_0x86096c[_0xbc89b8(0x1d0)][_0xbc89b8(0x237)](_0xbc89b8(0x212));});});const saved=localStorage[a0_0x504691(0x1f6)](a0_0x504691(0x1ff));if(saved)try{messages=JSON[a0_0x504691(0x225)](saved),renderMessages();}catch(a0_0x33effb){}updateSendButton();