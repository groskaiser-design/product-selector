const a0_0x410fa1=a0_0x2ecd;(function(_0x3bae5b,_0x396987){const _0x3d88f3=a0_0x2ecd,_0x3843f0=_0x3bae5b();while(!![]){try{const _0x18369f=-parseInt(_0x3d88f3(0xbf))/0x1*(-parseInt(_0x3d88f3(0xbc))/0x2)+parseInt(_0x3d88f3(0x105))/0x3*(-parseInt(_0x3d88f3(0xc0))/0x4)+parseInt(_0x3d88f3(0xb6))/0x5+-parseInt(_0x3d88f3(0xc8))/0x6+-parseInt(_0x3d88f3(0xde))/0x7*(parseInt(_0x3d88f3(0x9a))/0x8)+-parseInt(_0x3d88f3(0xf8))/0x9+parseInt(_0x3d88f3(0xaa))/0xa;if(_0x18369f===_0x396987)break;else _0x3843f0['push'](_0x3843f0['shift']());}catch(_0x2423b2){_0x3843f0['push'](_0x3843f0['shift']());}}}(a0_0x1db5,0x1dcbb));function a0_0x2ecd(_0x1d9497,_0x567b14){_0x1d9497=_0x1d9497-0x86;const _0x2bb32d=a0_0x1db5();let _0x379d52=_0x2bb32d[_0x1d9497];return _0x379d52;}const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x410fa1(0xc9);function setupTelegramBackButton(){const _0x18f3b0=a0_0x410fa1;if(!tg)return;try{tg[_0x18f3b0(0xe0)](),tg[_0x18f3b0(0xb7)](),tg[_0x18f3b0(0xf2)]?.('#050505');if(tg[_0x18f3b0(0xf9)]?.(_0x18f3b0(0x103)))tg[_0x18f3b0(0x8d)]?.();const _0x54df6c=tg[_0x18f3b0(0xb0)];if(_0x54df6c){_0x54df6c['show']();if(typeof _0x54df6c[_0x18f3b0(0xcb)]===_0x18f3b0(0x8f))try{_0x54df6c[_0x18f3b0(0xcb)]();}catch(_0xa573e2){}_0x54df6c['onClick'](()=>{const _0x197bd7=_0x18f3b0;if(tg['HapticFeedback'])tg[_0x197bd7(0xa5)][_0x197bd7(0xbb)](_0x197bd7(0xaf));location[_0x197bd7(0x89)]=HOME_URL;});}}catch(_0x23a4ba){console[_0x18f3b0(0xc4)](_0x18f3b0(0xc7),_0x23a4ba);}}(function initStableLayout(){const _0x4b9fb3=a0_0x410fa1,_0x4da669=(function(){let _0x14d7c4=!![];return function(_0x49ecfc,_0xe8c2e6){const _0x3696f7=_0x14d7c4?function(){const _0x259868=a0_0x2ecd;if(_0xe8c2e6){const _0x19f7af=_0xe8c2e6[_0x259868(0xa1)](_0x49ecfc,arguments);return _0xe8c2e6=null,_0x19f7af;}}:function(){};return _0x14d7c4=![],_0x3696f7;};}()),_0x2926aa=document[_0x4b9fb3(0x9c)]('.container'),_0x18379e=document[_0x4b9fb3(0xb5)](_0x4b9fb3(0x9d)),_0x4bdcfd=document['getElementById'](_0x4b9fb3(0xfb)),_0x3a7f22=document[_0x4b9fb3(0xb5)](_0x4b9fb3(0x90));function _0x3c951d(){const _0x2d6c9e=_0x4b9fb3,_0x54fcec=_0x4da669(this,function(){const _0x372dd5=a0_0x2ecd;return _0x54fcec[_0x372dd5(0x9e)]()[_0x372dd5(0x107)](_0x372dd5(0xca))[_0x372dd5(0x9e)]()[_0x372dd5(0xd5)](_0x54fcec)[_0x372dd5(0x107)](_0x372dd5(0xca));});_0x54fcec();if(!_0x2926aa)return;const _0x2f502c=tg&&tg[_0x2d6c9e(0xd2)]?tg[_0x2d6c9e(0xd2)]:window['innerHeight'];_0x2926aa[_0x2d6c9e(0xb9)]['height']=_0x2f502c+'px';if(_0x18379e){const _0x1c3343=_0x18379e['offsetHeight'];_0x4bdcfd['style'][_0x2d6c9e(0xda)]=_0x1c3343+0x28+'px';}}tg?tg[_0x4b9fb3(0xd6)](_0x4b9fb3(0x8c),({isStateStable:_0x385a1c})=>{_0x3c951d();if(_0x385a1c)requestAnimationFrame(()=>{const _0x340e45=a0_0x2ecd;_0x4bdcfd[_0x340e45(0xf6)]=_0x4bdcfd[_0x340e45(0xcd)];});}):window[_0x4b9fb3(0xf7)](_0x4b9fb3(0xd9),_0x3c951d),_0x3c951d(),_0x3a7f22&&(_0x3a7f22['addEventListener'](_0x4b9fb3(0xea),()=>{requestAnimationFrame(_0x3c951d);}),_0x3a7f22[_0x4b9fb3(0xf7)](_0x4b9fb3(0xe5),()=>{setTimeout(()=>{const _0x3b3794=a0_0x2ecd;_0x4bdcfd['scrollTop']=_0x4bdcfd[_0x3b3794(0xcd)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x410fa1(0xb8),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x1db5(){const _0x4a0a10=['<br>','getItem','abort','viewportHeight','padStart','onclick','constructor','onEvent','typingIndicator','Очистить\x20историю?','resize','paddingBottom','keydown','timestamp','add','556913IPPtEC','initData','ready','trim','text','random','appendChild','focus','medium','sendBtn','target','push','input','preventDefault','.message.show-delete','emptyState','getHours','ai_chat_messages','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','parse','setHeaderColor','div','disabled','stringify','scrollTop','addEventListener','740250guDLgi','isVersionAtLeast','json','chatArea','flex','now','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','clear_history','modalConfirm','className','removeItem','6.1','forEach','66WlPPvJ','Действие\x20необратимо.','search','createElement','click','text/plain','href','clearBtn','setItem','viewportChanged','disableVerticalSwipes','Пустой\x20ответ','function','messageInput','contains','Ошибка\x20сервера','replace','textContent','length','height','initDataUnsafe','innerHTML','content','24hdwWZG','getMinutes','querySelector','inputArea','toString','none','notificationOccurred','apply','message-bubble','user','display','HapticFeedback','message\x20ai','remove','show','value','4879390fvgBOB','shiftKey','children','stopPropagation','min','light','BackButton','success','modalText','splice','classList','getElementById','380425SxOZda','expand','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','style','modalCancel','impactOccurred','4qeKIHY','signal','key','58111svNZam','38132rUwogQ','Удалить?','Начнется\x20новый\x20диалог.','error','warn','show-delete','touchend','TG\x20setup\x20error:','165300xEiTZn','./router.html','(((.+)+)+)+$','offClick','Ошибка\x20сети','scrollHeight','message\x20'];a0_0x1db5=function(){return _0x4a0a10;};return a0_0x1db5();}const chatArea=document[a0_0x410fa1(0xb5)](a0_0x410fa1(0xfb)),emptyState=document[a0_0x410fa1(0xb5)]('emptyState'),messageInput=document[a0_0x410fa1(0xb5)]('messageInput'),sendBtn=document[a0_0x410fa1(0xb5)](a0_0x410fa1(0xe7)),clearBtn=document[a0_0x410fa1(0xb5)](a0_0x410fa1(0x8a)),modal=document[a0_0x410fa1(0xb5)]('confirmModal'),mTitle=document[a0_0x410fa1(0xb5)]('modalTitle'),mText=document[a0_0x410fa1(0xb5)](a0_0x410fa1(0xb2));let modalCallback=null;async function callBackend(_0x3baf7d,_0x6451e2){const _0x4e1529=a0_0x410fa1,_0x310c49=tg?.[_0x4e1529(0x97)]?.[_0x4e1529(0xa3)]||{},_0x2e1849=_0x310c49['id']||localStorage[_0x4e1529(0xd0)]('debug_uid')||'d-'+Math['floor'](Math[_0x4e1529(0xe3)]()*0x3b9aca00);if(!_0x310c49['id'])localStorage[_0x4e1529(0x8b)]('debug_uid',_0x2e1849);const _0x20e108={'action':_0x3baf7d,'user_id':_0x2e1849,'user_data':{'first_name':_0x310c49['first_name'],'username':_0x310c49['username']},'init_data':tg?.[_0x4e1529(0xdf)]||'',..._0x6451e2},_0x182892=new AbortController(),_0x2a6907=setTimeout(()=>_0x182892[_0x4e1529(0xd1)](),REQUEST_TIMEOUT_MS);try{const _0x416f48=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x4e1529(0x88)},'body':JSON[_0x4e1529(0xf5)](_0x20e108),'signal':_0x182892[_0x4e1529(0xbd)]});return clearTimeout(_0x2a6907),await _0x416f48[_0x4e1529(0xfa)]();}catch(_0x3cc7e5){return{'success':![],'error':String(_0x3cc7e5)};}}function formatTime(_0xc6f749){const _0x4029c5=a0_0x410fa1,_0x19b334=new Date(_0xc6f749);return String(_0x19b334[_0x4029c5(0xee)]())[_0x4029c5(0xd3)](0x2,'0')+':'+String(_0x19b334[_0x4029c5(0x9b)]())[_0x4029c5(0xd3)](0x2,'0');}function createMessageElement(_0x18c7ed,_0x57f485){const _0x495789=a0_0x410fa1,_0x5cad91=document[_0x495789(0x86)](_0x495789(0xf3));_0x5cad91[_0x495789(0x101)]=_0x495789(0xce)+_0x18c7ed['role'];const _0x46d015=document[_0x495789(0x86)]('div');_0x46d015[_0x495789(0x101)]=_0x495789(0xa2),_0x46d015[_0x495789(0x98)]=_0x18c7ed[_0x495789(0x99)][_0x495789(0x93)](/\n/g,_0x495789(0xcf));const _0x4d0aba=document[_0x495789(0x86)](_0x495789(0xf3));_0x4d0aba[_0x495789(0x101)]='delete-btn',_0x4d0aba[_0x495789(0x98)]=_0x495789(0xf0),_0x4d0aba['onclick']=_0x1a2e15=>{const _0x5cba93=_0x495789;_0x1a2e15[_0x5cba93(0xad)](),confirmDelete(_0x57f485);};let _0x3fcc50;_0x46d015[_0x495789(0xf7)]('touchstart',()=>_0x3fcc50=setTimeout(()=>{const _0x10b008=_0x495789;_0x5cad91[_0x10b008(0xb4)]['add']('show-delete');if(tg?.[_0x10b008(0xa5)])tg[_0x10b008(0xa5)][_0x10b008(0xbb)](_0x10b008(0xe6));},0x1f4)),_0x46d015['addEventListener'](_0x495789(0xc6),()=>clearTimeout(_0x3fcc50));const _0x4e504e=document['createElement']('div');return _0x4e504e['className']='message-time',_0x4e504e['textContent']=formatTime(_0x18c7ed[_0x495789(0xdc)]),_0x5cad91[_0x495789(0xe4)](_0x4d0aba),_0x5cad91['appendChild'](_0x46d015),_0x5cad91[_0x495789(0xe4)](_0x4e504e),_0x5cad91;}function createTypingIndicator(){const _0x31fc2f=a0_0x410fa1,_0x32d8cd=document[_0x31fc2f(0x86)](_0x31fc2f(0xf3));return _0x32d8cd['className']=_0x31fc2f(0xa6),_0x32d8cd['id']=_0x31fc2f(0xd7),_0x32d8cd[_0x31fc2f(0x98)]=_0x31fc2f(0xfe),_0x32d8cd;}function renderMessages(){const _0x513577=a0_0x410fa1;Array['from'](chatArea[_0x513577(0xac)])[_0x513577(0x104)](_0x5f4f82=>{const _0x363e7d=_0x513577;if(_0x5f4f82['id']!==_0x363e7d(0xed))_0x5f4f82[_0x363e7d(0xa7)]();}),messages[_0x513577(0x95)]>0x0?(emptyState[_0x513577(0xb9)]['display']=_0x513577(0x9f),messages[_0x513577(0x104)]((_0x2a9afe,_0x858340)=>chatArea[_0x513577(0xe4)](createMessageElement(_0x2a9afe,_0x858340)))):emptyState[_0x513577(0xb9)][_0x513577(0xa4)]=_0x513577(0xfc),requestAnimationFrame(()=>chatArea[_0x513577(0xf6)]=chatArea[_0x513577(0xcd)]);}function autoResizeTextarea(){const _0x541e21=a0_0x410fa1;messageInput['style'][_0x541e21(0x96)]='auto',messageInput[_0x541e21(0xb9)][_0x541e21(0x96)]=Math[_0x541e21(0xae)](messageInput[_0x541e21(0xcd)],0x78)+'px';}function updateSendButton(){const _0x579b35=a0_0x410fa1,_0x36e2c6=messageInput[_0x579b35(0xa9)][_0x579b35(0xe1)]();sendBtn[_0x579b35(0xf4)]=!_0x36e2c6||isTyping;}async function sendMessage(){const _0x431fa4=a0_0x410fa1,_0x45c433=messageInput[_0x431fa4(0xa9)]['trim']();if(!_0x45c433||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x431fa4(0xa5)]['impactOccurred']('light');messages[_0x431fa4(0xe9)]({'role':_0x431fa4(0xa3),'content':_0x45c433,'timestamp':Date[_0x431fa4(0xfd)]()}),localStorage[_0x431fa4(0x8b)](_0x431fa4(0xef),JSON[_0x431fa4(0xf5)](messages)),renderMessages(),messageInput[_0x431fa4(0xa9)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x431fa4(0xe4)](createTypingIndicator()),chatArea[_0x431fa4(0xf6)]=chatArea[_0x431fa4(0xcd)];const _0x2fa7d9=await callBackend('send_message',{'message':_0x45c433});isTyping=![];const _0x2829d4=document['getElementById'](_0x431fa4(0xd7));if(_0x2829d4)_0x2829d4[_0x431fa4(0xa7)]();let _0x4648b8=_0x431fa4(0xcc);if(_0x2fa7d9[_0x431fa4(0xb1)]){_0x4648b8=_0x2fa7d9[_0x431fa4(0xe2)]||_0x431fa4(0x8e);if(tg?.[_0x431fa4(0xa5)])tg[_0x431fa4(0xa5)]['notificationOccurred']('success');}else{_0x4648b8=_0x2fa7d9[_0x431fa4(0xc3)]||_0x431fa4(0x92);if(tg?.[_0x431fa4(0xa5)])tg['HapticFeedback'][_0x431fa4(0xa0)]('error');}messages[_0x431fa4(0xe9)]({'role':'ai','content':_0x4648b8,'timestamp':Date[_0x431fa4(0xfd)]()}),localStorage[_0x431fa4(0x8b)](_0x431fa4(0xef),JSON[_0x431fa4(0xf5)](messages)),renderMessages();}function confirmDelete(_0x28816e){const _0x278e53=a0_0x410fa1;if(mTitle)mTitle[_0x278e53(0x94)]=_0x278e53(0xc1);if(mText)mText[_0x278e53(0x94)]=_0x278e53(0x106);modalCallback=()=>{const _0x535f5d=_0x278e53;messages[_0x535f5d(0xb3)](_0x28816e,0x1),localStorage[_0x535f5d(0x8b)](_0x535f5d(0xef),JSON[_0x535f5d(0xf5)](messages)),renderMessages();},modal[_0x278e53(0xb4)][_0x278e53(0xdd)]('show');}if(clearBtn)clearBtn[a0_0x410fa1(0xd4)]=()=>{const _0x564c41=a0_0x410fa1;if(!messages['length'])return;if(mTitle)mTitle[_0x564c41(0x94)]=_0x564c41(0xd8);if(mText)mText['textContent']=_0x564c41(0xc2);modalCallback=async()=>{const _0x24883d=_0x564c41;messages=[],localStorage[_0x24883d(0x102)](_0x24883d(0xef)),renderMessages(),callBackend(_0x24883d(0xff),{});},modal[_0x564c41(0xb4)][_0x564c41(0xdd)](_0x564c41(0xa8));};document[a0_0x410fa1(0xb5)](a0_0x410fa1(0xba))[a0_0x410fa1(0xd4)]=()=>modal[a0_0x410fa1(0xb4)][a0_0x410fa1(0xa7)](a0_0x410fa1(0xa8)),document[a0_0x410fa1(0xb5)](a0_0x410fa1(0x100))[a0_0x410fa1(0xd4)]=()=>{const _0x1c59ae=a0_0x410fa1;if(modalCallback)modalCallback();modal[_0x1c59ae(0xb4)][_0x1c59ae(0xa7)]('show');},messageInput['addEventListener'](a0_0x410fa1(0xea),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x410fa1(0xf7)](a0_0x410fa1(0xdb),_0x2fb536=>{const _0x6b8a7c=a0_0x410fa1;_0x2fb536[_0x6b8a7c(0xbe)]==='Enter'&&!_0x2fb536[_0x6b8a7c(0xab)]&&(_0x2fb536[_0x6b8a7c(0xeb)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x410fa1(0xf7)](a0_0x410fa1(0x87),_0x345df0=>{const _0x988d7f=a0_0x410fa1;document['querySelectorAll'](_0x988d7f(0xec))[_0x988d7f(0x104)](_0x4cab5c=>{const _0x3de20d=_0x988d7f;if(!_0x4cab5c[_0x3de20d(0x91)](_0x345df0[_0x3de20d(0xe8)]))_0x4cab5c[_0x3de20d(0xb4)][_0x3de20d(0xa7)](_0x3de20d(0xc5));});});const saved=localStorage[a0_0x410fa1(0xd0)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x410fa1(0xf1)](saved),renderMessages();}catch(a0_0x2b3a0c){}updateSendButton();