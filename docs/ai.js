const a0_0x1e1187=a0_0x5685;(function(_0x38d5e6,_0x3831f0){const _0x33be2d=a0_0x5685,_0x35ee3a=_0x38d5e6();while(!![]){try{const _0x14525d=parseInt(_0x33be2d(0xca))/0x1*(parseInt(_0x33be2d(0xff))/0x2)+-parseInt(_0x33be2d(0xe4))/0x3+parseInt(_0x33be2d(0xcd))/0x4+-parseInt(_0x33be2d(0xd8))/0x5*(parseInt(_0x33be2d(0xe9))/0x6)+-parseInt(_0x33be2d(0xbd))/0x7+-parseInt(_0x33be2d(0x118))/0x8+parseInt(_0x33be2d(0xdc))/0x9;if(_0x14525d===_0x3831f0)break;else _0x35ee3a['push'](_0x35ee3a['shift']());}catch(_0x5bd92a){_0x35ee3a['push'](_0x35ee3a['shift']());}}}(a0_0x1ce2,0xbc373));const tg=window[a0_0x1e1187(0xe7)]?.[a0_0x1e1187(0xb5)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x54162d=a0_0x1e1187;if(!tg)return;try{tg[_0x54162d(0xc5)](),tg[_0x54162d(0xb8)](),tg[_0x54162d(0x113)]?.('#050505');if(tg[_0x54162d(0xf6)]?.(_0x54162d(0xd7)))tg[_0x54162d(0xd3)]?.();const _0x10bc6c=tg['BackButton'];if(_0x10bc6c){_0x10bc6c['show']();if(typeof _0x10bc6c[_0x54162d(0xda)]===_0x54162d(0xf7))try{_0x10bc6c[_0x54162d(0xda)]();}catch(_0x520bb1){}_0x10bc6c[_0x54162d(0x129)](()=>{const _0x5f24e4=_0x54162d;if(tg[_0x5f24e4(0xfe)])tg[_0x5f24e4(0xfe)]['impactOccurred']('light');location[_0x5f24e4(0x121)]=HOME_URL;});}}catch(_0x5da458){console[_0x54162d(0xc2)](_0x54162d(0xc8),_0x5da458);}}function a0_0x1ce2(){const _0x277265=['Начнется\x20новый\x20диалог.','warn','value','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','ready','onEvent','text/plain','TG\x20setup\x20error:','random','1345347MpknQx','replace','scrollHeight','3864368SCzXmE','click','toString','padStart','user','initDataUnsafe','disableVerticalSwipes','createElement','chatArea','getElementById','6.1','1475IySLeI','paddingBottom','offClick','min','5675346fVWGEJ','modalTitle','keydown','(((.+)+)+)+$','forEach','sendBtn','medium','username','2947779cVcQkf','trim','onclick','Telegram','focus','6162zVySpt','messageInput','viewportHeight','height','.message.show-delete','classList','stopPropagation','flex','display','querySelectorAll','constructor','role','removeItem','isVersionAtLeast','function','Удалить?','message-time','auto','addEventListener','div','touchstart','HapticFeedback','2SogjMH','emptyState','shiftKey','ai_chat_messages','remove','preventDefault','appendChild','add','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','first_name','key','Ошибка\x20сервера','innerHeight','target','send_message','debug_uid','Enter','touchend','now','Пустой\x20ответ','setHeaderColor','contains','modalCancel','scrollTop','offsetHeight','5501232ykOvab','getItem','show-delete','error','className','impactOccurred','.container','splice','stringify','href','POST','content','style','show','textContent','signal','querySelector','onClick','typingIndicator','input','abort','Ошибка\x20сети','timestamp','setItem','WebApp','push','clearBtn','expand','search','clear_history','notificationOccurred','innerHTML','1385230SuTvpC','getHours','success','text'];a0_0x1ce2=function(){return _0x277265;};return a0_0x1ce2();}(function initStableLayout(){const _0x2eda72=a0_0x1e1187,_0x31124e=(function(){let _0x12c1de=!![];return function(_0x320830,_0xeb3c23){const _0x2bc203=_0x12c1de?function(){if(_0xeb3c23){const _0xd0cbd1=_0xeb3c23['apply'](_0x320830,arguments);return _0xeb3c23=null,_0xd0cbd1;}}:function(){};return _0x12c1de=![],_0x2bc203;};}()),_0x3a59e3=document[_0x2eda72(0x128)](_0x2eda72(0x11e)),_0x276e9a=document[_0x2eda72(0xd6)]('inputArea'),_0x1d88fe=document['getElementById'](_0x2eda72(0xd5)),_0x425a91=document[_0x2eda72(0xd6)](_0x2eda72(0xea));function _0x38a7e1(){const _0x31f380=_0x2eda72,_0x2ddbc2=_0x31124e(this,function(){const _0x2ce33c=a0_0x5685;return _0x2ddbc2[_0x2ce33c(0xcf)]()['search'](_0x2ce33c(0xdf))['toString']()[_0x2ce33c(0xf3)](_0x2ddbc2)[_0x2ce33c(0xb9)]('(((.+)+)+)+$');});_0x2ddbc2();if(!_0x3a59e3)return;const _0x40794e=tg&&tg['viewportHeight']?tg[_0x31f380(0xeb)]:window[_0x31f380(0x10b)];_0x3a59e3[_0x31f380(0x124)][_0x31f380(0xec)]=_0x40794e+'px';if(_0x276e9a){const _0x36082a=_0x276e9a[_0x31f380(0x117)];_0x1d88fe[_0x31f380(0x124)][_0x31f380(0xd9)]=_0x36082a+0x28+'px';}}tg?tg[_0x2eda72(0xc6)]('viewportChanged',({isStateStable:_0x5ae03a})=>{_0x38a7e1();if(_0x5ae03a)requestAnimationFrame(()=>{const _0x5e27a5=a0_0x5685;_0x1d88fe[_0x5e27a5(0x116)]=_0x1d88fe[_0x5e27a5(0xcc)];});}):window[_0x2eda72(0xfb)]('resize',_0x38a7e1),_0x38a7e1(),_0x425a91&&(_0x425a91[_0x2eda72(0xfb)](_0x2eda72(0x12b),()=>{requestAnimationFrame(_0x38a7e1);}),_0x425a91[_0x2eda72(0xfb)](_0x2eda72(0xe8),()=>{setTimeout(()=>{const _0x472540=a0_0x5685;_0x1d88fe[_0x472540(0x116)]=_0x1d88fe[_0x472540(0xcc)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1e1187(0xd6)]('chatArea'),emptyState=document[a0_0x1e1187(0xd6)](a0_0x1e1187(0x100)),messageInput=document[a0_0x1e1187(0xd6)](a0_0x1e1187(0xea)),sendBtn=document[a0_0x1e1187(0xd6)](a0_0x1e1187(0xe1)),clearBtn=document[a0_0x1e1187(0xd6)](a0_0x1e1187(0xb7)),modal=document[a0_0x1e1187(0xd6)]('confirmModal'),mTitle=document[a0_0x1e1187(0xd6)](a0_0x1e1187(0xdd)),mText=document[a0_0x1e1187(0xd6)]('modalText');let modalCallback=null;async function callBackend(_0x593789,_0x405982){const _0x3ef8e5=a0_0x1e1187,_0x2d3fd9=tg?.[_0x3ef8e5(0xd2)]?.[_0x3ef8e5(0xd1)]||{},_0x3d2e3c=_0x2d3fd9['id']||localStorage[_0x3ef8e5(0x119)](_0x3ef8e5(0x10e))||'d-'+Math['floor'](Math[_0x3ef8e5(0xc9)]()*0x3b9aca00);if(!_0x2d3fd9['id'])localStorage['setItem'](_0x3ef8e5(0x10e),_0x3d2e3c);const _0x3b52b2={'action':_0x593789,'user_id':_0x3d2e3c,'user_data':{'first_name':_0x2d3fd9[_0x3ef8e5(0x108)],'username':_0x2d3fd9[_0x3ef8e5(0xe3)]},'init_data':tg?.['initData']||'',..._0x405982},_0x16d5b7=new AbortController(),_0xa3088b=setTimeout(()=>_0x16d5b7[_0x3ef8e5(0x12c)](),REQUEST_TIMEOUT_MS);try{const _0x28ec42=await fetch(BACKEND_URL,{'method':_0x3ef8e5(0x122),'headers':{'Content-Type':_0x3ef8e5(0xc7)},'body':JSON['stringify'](_0x3b52b2),'signal':_0x16d5b7[_0x3ef8e5(0x127)]});return clearTimeout(_0xa3088b),await _0x28ec42['json']();}catch(_0x3a6c25){return{'success':![],'error':String(_0x3a6c25)};}}function formatTime(_0x47a841){const _0x4547a5=a0_0x1e1187,_0x5f3374=new Date(_0x47a841);return String(_0x5f3374[_0x4547a5(0xbe)]())['padStart'](0x2,'0')+':'+String(_0x5f3374['getMinutes']())[_0x4547a5(0xd0)](0x2,'0');}function createMessageElement(_0x211509,_0x42bdca){const _0x26b830=a0_0x1e1187,_0x3b7d76=document['createElement'](_0x26b830(0xfc));_0x3b7d76[_0x26b830(0x11c)]='message\x20'+_0x211509[_0x26b830(0xf4)];const _0x2fde24=document[_0x26b830(0xd4)](_0x26b830(0xfc));_0x2fde24[_0x26b830(0x11c)]='message-bubble',_0x2fde24[_0x26b830(0xbc)]=_0x211509[_0x26b830(0x123)][_0x26b830(0xcb)](/\n/g,'<br>');const _0x54b081=document[_0x26b830(0xd4)](_0x26b830(0xfc));_0x54b081[_0x26b830(0x11c)]='delete-btn',_0x54b081[_0x26b830(0xbc)]=_0x26b830(0x107),_0x54b081['onclick']=_0x1b8a89=>{const _0x1ec66b=_0x26b830;_0x1b8a89[_0x1ec66b(0xef)](),confirmDelete(_0x42bdca);};let _0x494cf6;_0x2fde24[_0x26b830(0xfb)](_0x26b830(0xfd),()=>_0x494cf6=setTimeout(()=>{const _0x2f6e34=_0x26b830;_0x3b7d76[_0x2f6e34(0xee)]['add'](_0x2f6e34(0x11a));if(tg?.[_0x2f6e34(0xfe)])tg[_0x2f6e34(0xfe)]['impactOccurred'](_0x2f6e34(0xe2));},0x1f4)),_0x2fde24[_0x26b830(0xfb)](_0x26b830(0x110),()=>clearTimeout(_0x494cf6));const _0x4c7662=document[_0x26b830(0xd4)]('div');return _0x4c7662[_0x26b830(0x11c)]=_0x26b830(0xf9),_0x4c7662[_0x26b830(0x126)]=formatTime(_0x211509[_0x26b830(0xb3)]),_0x3b7d76[_0x26b830(0x105)](_0x54b081),_0x3b7d76[_0x26b830(0x105)](_0x2fde24),_0x3b7d76['appendChild'](_0x4c7662),_0x3b7d76;}function a0_0x5685(_0x4d91d0,_0x5cff57){_0x4d91d0=_0x4d91d0-0xb3;const _0x15fbb9=a0_0x1ce2();let _0x6d032a=_0x15fbb9[_0x4d91d0];return _0x6d032a;}function createTypingIndicator(){const _0x2192eb=a0_0x1e1187,_0x3ae078=document[_0x2192eb(0xd4)]('div');return _0x3ae078[_0x2192eb(0x11c)]='message\x20ai',_0x3ae078['id']=_0x2192eb(0x12a),_0x3ae078[_0x2192eb(0xbc)]=_0x2192eb(0xc4),_0x3ae078;}function renderMessages(){const _0x1ecdb2=a0_0x1e1187;Array['from'](chatArea['children'])['forEach'](_0x40df2e=>{const _0x4f27ff=a0_0x5685;if(_0x40df2e['id']!==_0x4f27ff(0x100))_0x40df2e[_0x4f27ff(0x103)]();}),messages['length']>0x0?(emptyState[_0x1ecdb2(0x124)][_0x1ecdb2(0xf1)]='none',messages[_0x1ecdb2(0xe0)]((_0x552af8,_0x3a1186)=>chatArea[_0x1ecdb2(0x105)](createMessageElement(_0x552af8,_0x3a1186)))):emptyState['style'][_0x1ecdb2(0xf1)]=_0x1ecdb2(0xf0),requestAnimationFrame(()=>chatArea[_0x1ecdb2(0x116)]=chatArea[_0x1ecdb2(0xcc)]);}function autoResizeTextarea(){const _0x4c8e0a=a0_0x1e1187;messageInput[_0x4c8e0a(0x124)][_0x4c8e0a(0xec)]=_0x4c8e0a(0xfa),messageInput[_0x4c8e0a(0x124)][_0x4c8e0a(0xec)]=Math[_0x4c8e0a(0xdb)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x392c94=a0_0x1e1187,_0x2b1aff=messageInput[_0x392c94(0xc3)][_0x392c94(0xe5)]();sendBtn['disabled']=!_0x2b1aff||isTyping;}async function sendMessage(){const _0x2eeb51=a0_0x1e1187,_0x2b4078=messageInput['value'][_0x2eeb51(0xe5)]();if(!_0x2b4078||isTyping)return;if(tg?.[_0x2eeb51(0xfe)])tg[_0x2eeb51(0xfe)][_0x2eeb51(0x11d)]('light');messages[_0x2eeb51(0xb6)]({'role':_0x2eeb51(0xd1),'content':_0x2b4078,'timestamp':Date[_0x2eeb51(0x111)]()}),localStorage[_0x2eeb51(0xb4)](_0x2eeb51(0x102),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2eeb51(0x105)](createTypingIndicator()),chatArea[_0x2eeb51(0x116)]=chatArea[_0x2eeb51(0xcc)];const _0xb66079=await callBackend(_0x2eeb51(0x10d),{'message':_0x2b4078});isTyping=![];const _0x25030b=document[_0x2eeb51(0xd6)](_0x2eeb51(0x12a));if(_0x25030b)_0x25030b[_0x2eeb51(0x103)]();let _0x574f31=_0x2eeb51(0x12d);if(_0xb66079[_0x2eeb51(0xbf)]){_0x574f31=_0xb66079[_0x2eeb51(0xc0)]||_0x2eeb51(0x112);if(tg?.[_0x2eeb51(0xfe)])tg[_0x2eeb51(0xfe)][_0x2eeb51(0xbb)]('success');}else{_0x574f31=_0xb66079['error']||_0x2eeb51(0x10a);if(tg?.[_0x2eeb51(0xfe)])tg[_0x2eeb51(0xfe)][_0x2eeb51(0xbb)](_0x2eeb51(0x11b));}messages[_0x2eeb51(0xb6)]({'role':'ai','content':_0x574f31,'timestamp':Date[_0x2eeb51(0x111)]()}),localStorage[_0x2eeb51(0xb4)](_0x2eeb51(0x102),JSON[_0x2eeb51(0x120)](messages)),renderMessages();}function confirmDelete(_0x12eeb5){const _0x515b64=a0_0x1e1187;if(mTitle)mTitle[_0x515b64(0x126)]=_0x515b64(0xf8);if(mText)mText[_0x515b64(0x126)]='Действие\x20необратимо.';modalCallback=()=>{const _0x46631b=_0x515b64;messages[_0x46631b(0x11f)](_0x12eeb5,0x1),localStorage[_0x46631b(0xb4)](_0x46631b(0x102),JSON['stringify'](messages)),renderMessages();},modal[_0x515b64(0xee)][_0x515b64(0x106)](_0x515b64(0x125));}if(clearBtn)clearBtn['onclick']=()=>{const _0x316096=a0_0x1e1187;if(!messages['length'])return;if(mTitle)mTitle[_0x316096(0x126)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x316096(0xc1);modalCallback=async()=>{const _0x1e0dc7=_0x316096;messages=[],localStorage[_0x1e0dc7(0xf5)](_0x1e0dc7(0x102)),renderMessages(),callBackend(_0x1e0dc7(0xba),{});},modal[_0x316096(0xee)][_0x316096(0x106)](_0x316096(0x125));};document[a0_0x1e1187(0xd6)](a0_0x1e1187(0x115))['onclick']=()=>modal[a0_0x1e1187(0xee)][a0_0x1e1187(0x103)](a0_0x1e1187(0x125)),document['getElementById']('modalConfirm')[a0_0x1e1187(0xe6)]=()=>{const _0x2d984b=a0_0x1e1187;if(modalCallback)modalCallback();modal['classList']['remove'](_0x2d984b(0x125));},messageInput['addEventListener'](a0_0x1e1187(0x12b),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1e1187(0xfb)](a0_0x1e1187(0xde),_0x2f068c=>{const _0x166dcc=a0_0x1e1187;_0x2f068c[_0x166dcc(0x109)]===_0x166dcc(0x10f)&&!_0x2f068c[_0x166dcc(0x101)]&&(_0x2f068c[_0x166dcc(0x104)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x1e1187(0xfb)](a0_0x1e1187(0xce),_0x437dbd=>{const _0x272d34=a0_0x1e1187;document[_0x272d34(0xf2)](_0x272d34(0xed))[_0x272d34(0xe0)](_0x1a7321=>{const _0x548dac=_0x272d34;if(!_0x1a7321[_0x548dac(0x114)](_0x437dbd[_0x548dac(0x10c)]))_0x1a7321[_0x548dac(0xee)][_0x548dac(0x103)]('show-delete');});});const saved=localStorage[a0_0x1e1187(0x119)](a0_0x1e1187(0x102));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x32d2f2){}updateSendButton();