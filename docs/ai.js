const a0_0x122482=a0_0x2a87;(function(_0x53ed49,_0xbcdfee){const _0x271803=a0_0x2a87,_0x4266ab=_0x53ed49();while(!![]){try{const _0x3f7e7a=-parseInt(_0x271803(0x1ef))/0x1*(-parseInt(_0x271803(0x234))/0x2)+parseInt(_0x271803(0x1ea))/0x3*(-parseInt(_0x271803(0x222))/0x4)+parseInt(_0x271803(0x246))/0x5+parseInt(_0x271803(0x1eb))/0x6+parseInt(_0x271803(0x206))/0x7+parseInt(_0x271803(0x1db))/0x8+-parseInt(_0x271803(0x1de))/0x9*(parseInt(_0x271803(0x21e))/0xa);if(_0x3f7e7a===_0xbcdfee)break;else _0x4266ab['push'](_0x4266ab['shift']());}catch(_0x8d8b4d){_0x4266ab['push'](_0x4266ab['shift']());}}}(a0_0x4740,0xdb134));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x122482(0x212);function setupTelegramBackButton(){const _0x2a77d4=a0_0x122482,_0x145eff=(function(){let _0x4c2f1e=!![];return function(_0x3ef01f,_0x29f0cb){const _0x58fee3=_0x4c2f1e?function(){if(_0x29f0cb){const _0x225ddd=_0x29f0cb['apply'](_0x3ef01f,arguments);return _0x29f0cb=null,_0x225ddd;}}:function(){};return _0x4c2f1e=![],_0x58fee3;};}()),_0x4ff06a=_0x145eff(this,function(){const _0x4b3082=a0_0x2a87;return _0x4ff06a['toString']()[_0x4b3082(0x20d)](_0x4b3082(0x251))[_0x4b3082(0x1e9)]()[_0x4b3082(0x208)](_0x4ff06a)[_0x4b3082(0x20d)]('(((.+)+)+)+$');});_0x4ff06a();if(!tg)return;try{tg[_0x2a77d4(0x20a)](),tg[_0x2a77d4(0x1dc)](),tg['setHeaderColor']?.(_0x2a77d4(0x1dd));if(tg['isVersionAtLeast']?.(_0x2a77d4(0x21f)))tg[_0x2a77d4(0x1f3)]?.();const _0x339d79=tg[_0x2a77d4(0x237)];if(_0x339d79){_0x339d79['show']();if(typeof _0x339d79[_0x2a77d4(0x239)]==='function')try{_0x339d79['offClick']();}catch(_0x5a62f9){}_0x339d79[_0x2a77d4(0x247)](()=>{const _0x1ffe4e=_0x2a77d4;if(tg[_0x1ffe4e(0x213)])tg[_0x1ffe4e(0x213)][_0x1ffe4e(0x1e8)](_0x1ffe4e(0x23d));location[_0x1ffe4e(0x217)]=HOME_URL;});}}catch(_0x548845){console[_0x2a77d4(0x253)]('TG\x20setup\x20error:',_0x548845);}}(function initStableLayout(){const _0x47c979=a0_0x122482,_0x1e815f=document[_0x47c979(0x1d8)](_0x47c979(0x236)),_0x180ae8=document[_0x47c979(0x1f4)](_0x47c979(0x210)),_0x2268fc=document[_0x47c979(0x1f4)](_0x47c979(0x226)),_0x57359b=document['getElementById'](_0x47c979(0x225));function _0x2bc4c5(){const _0x557013=_0x47c979;if(!_0x1e815f)return;const _0x58e9b6=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x557013(0x20f)];_0x1e815f[_0x557013(0x1fe)][_0x557013(0x1ed)]=_0x58e9b6+'px';if(_0x180ae8){const _0x515c19=_0x180ae8['offsetHeight'];_0x2268fc[_0x557013(0x1fe)][_0x557013(0x218)]=_0x515c19+0x28+'px';}}tg?tg[_0x47c979(0x23a)](_0x47c979(0x21c),({isStateStable:_0x13508c})=>{_0x2bc4c5();if(_0x13508c)requestAnimationFrame(()=>{const _0x2762e0=a0_0x2a87;_0x2268fc['scrollTop']=_0x2268fc[_0x2762e0(0x1e0)];});}):window['addEventListener'](_0x47c979(0x1ff),_0x2bc4c5),_0x2bc4c5(),_0x57359b&&(_0x57359b[_0x47c979(0x235)]('input',()=>{requestAnimationFrame(_0x2bc4c5);}),_0x57359b[_0x47c979(0x235)](_0x47c979(0x23f),()=>{setTimeout(()=>{_0x2268fc['scrollTop']=_0x2268fc['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x122482(0x205),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x122482(0x1f4)]('chatArea'),emptyState=document['getElementById']('emptyState'),messageInput=document['getElementById'](a0_0x122482(0x225)),sendBtn=document[a0_0x122482(0x1f4)](a0_0x122482(0x211)),clearBtn=document['getElementById'](a0_0x122482(0x1e1)),modal=document[a0_0x122482(0x1f4)](a0_0x122482(0x256)),mTitle=document[a0_0x122482(0x1f4)](a0_0x122482(0x21a)),mText=document[a0_0x122482(0x1f4)](a0_0x122482(0x24d));let modalCallback=null;async function callBackend(_0x167c80,_0x4bea41){const _0x5e3f8a=a0_0x122482,_0xbcd0d3=tg?.['initDataUnsafe']?.[_0x5e3f8a(0x1f2)]||{},_0x1531b5=_0xbcd0d3['id']||localStorage[_0x5e3f8a(0x250)]('debug_uid')||'d-'+Math[_0x5e3f8a(0x24f)](Math[_0x5e3f8a(0x23b)]()*0x3b9aca00);if(!_0xbcd0d3['id'])localStorage[_0x5e3f8a(0x22f)](_0x5e3f8a(0x255),_0x1531b5);const _0x4bd50e={'action':_0x167c80,'user_id':_0x1531b5,'user_data':{'first_name':_0xbcd0d3[_0x5e3f8a(0x21d)],'username':_0xbcd0d3[_0x5e3f8a(0x204)]},'init_data':tg?.[_0x5e3f8a(0x22b)]||'',..._0x4bea41},_0x5b497a=new AbortController(),_0x47fb81=setTimeout(()=>_0x5b497a['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5b8172=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x5e3f8a(0x22e)},'body':JSON[_0x5e3f8a(0x20e)](_0x4bd50e),'signal':_0x5b497a['signal']});return clearTimeout(_0x47fb81),await _0x5b8172[_0x5e3f8a(0x1f5)]();}catch(_0x5e4e42){return{'success':![],'error':String(_0x5e4e42)};}}function formatTime(_0x1e4032){const _0x2e8e4f=a0_0x122482,_0x2bae40=new Date(_0x1e4032);return String(_0x2bae40[_0x2e8e4f(0x1f0)]())[_0x2e8e4f(0x216)](0x2,'0')+':'+String(_0x2bae40[_0x2e8e4f(0x209)]())['padStart'](0x2,'0');}function createMessageElement(_0x538b0a,_0x3101c9){const _0x43f5d3=a0_0x122482,_0x42a9cc=document[_0x43f5d3(0x257)](_0x43f5d3(0x20c));_0x42a9cc[_0x43f5d3(0x21b)]=_0x43f5d3(0x1e2)+_0x538b0a[_0x43f5d3(0x241)];const _0x1c452c=document[_0x43f5d3(0x257)](_0x43f5d3(0x20c));_0x1c452c['className']=_0x43f5d3(0x242),_0x1c452c['innerHTML']=_0x538b0a[_0x43f5d3(0x254)][_0x43f5d3(0x215)](/\n/g,_0x43f5d3(0x231));const _0x102dda=document[_0x43f5d3(0x257)](_0x43f5d3(0x20c));_0x102dda['className']='delete-btn',_0x102dda['innerHTML']=_0x43f5d3(0x1f1),_0x102dda['onclick']=_0x4f44a5=>{const _0x4c27b0=_0x43f5d3;_0x4f44a5[_0x4c27b0(0x1f7)](),confirmDelete(_0x3101c9);};let _0x340b39;_0x1c452c[_0x43f5d3(0x235)](_0x43f5d3(0x1ee),()=>_0x340b39=setTimeout(()=>{const _0x3e821f=_0x43f5d3;_0x42a9cc['classList'][_0x3e821f(0x1e3)](_0x3e821f(0x1f8));if(tg?.[_0x3e821f(0x213)])tg[_0x3e821f(0x213)][_0x3e821f(0x1e8)]('medium');},0x1f4)),_0x1c452c[_0x43f5d3(0x235)](_0x43f5d3(0x224),()=>clearTimeout(_0x340b39));const _0x5905a4=document['createElement'](_0x43f5d3(0x20c));return _0x5905a4['className']='message-time',_0x5905a4['textContent']=formatTime(_0x538b0a[_0x43f5d3(0x201)]),_0x42a9cc['appendChild'](_0x102dda),_0x42a9cc['appendChild'](_0x1c452c),_0x42a9cc[_0x43f5d3(0x24b)](_0x5905a4),_0x42a9cc;}function createTypingIndicator(){const _0xdf0091=a0_0x122482,_0x56ca83=document[_0xdf0091(0x257)]('div');return _0x56ca83['className']=_0xdf0091(0x221),_0x56ca83['id']=_0xdf0091(0x1da),_0x56ca83[_0xdf0091(0x22d)]=_0xdf0091(0x1df),_0x56ca83;}function a0_0x2a87(_0xeb0d8,_0x53f95b){_0xeb0d8=_0xeb0d8-0x1d8;const _0x507f4f=a0_0x4740();let _0x29d137=_0x507f4f[_0xeb0d8];return _0x29d137;}function renderMessages(){const _0x237f46=a0_0x122482;Array[_0x237f46(0x23e)](chatArea[_0x237f46(0x1f6)])['forEach'](_0x2556e2=>{const _0x5a4991=_0x237f46;if(_0x2556e2['id']!==_0x5a4991(0x1e6))_0x2556e2[_0x5a4991(0x219)]();}),messages[_0x237f46(0x214)]>0x0?(emptyState[_0x237f46(0x1fe)]['display']=_0x237f46(0x1fa),messages[_0x237f46(0x227)]((_0x2951ec,_0x17f559)=>chatArea[_0x237f46(0x24b)](createMessageElement(_0x2951ec,_0x17f559)))):emptyState[_0x237f46(0x1fe)][_0x237f46(0x20b)]='flex',requestAnimationFrame(()=>chatArea[_0x237f46(0x24a)]=chatArea[_0x237f46(0x1e0)]);}function autoResizeTextarea(){const _0x5dd185=a0_0x122482;messageInput['style']['height']=_0x5dd185(0x203),messageInput[_0x5dd185(0x1fe)]['height']=Math[_0x5dd185(0x1fb)](messageInput[_0x5dd185(0x1e0)],0x78)+'px';}function updateSendButton(){const _0xbb7738=a0_0x122482,_0x5084e8=messageInput[_0xbb7738(0x24c)][_0xbb7738(0x249)]();sendBtn[_0xbb7738(0x248)]=!_0x5084e8||isTyping;}async function sendMessage(){const _0x521f81=a0_0x122482,_0x4bc99b=messageInput[_0x521f81(0x24c)][_0x521f81(0x249)]();if(!_0x4bc99b||isTyping)return;if(tg?.[_0x521f81(0x213)])tg[_0x521f81(0x213)][_0x521f81(0x1e8)](_0x521f81(0x23d));messages[_0x521f81(0x243)]({'role':_0x521f81(0x1f2),'content':_0x4bc99b,'timestamp':Date[_0x521f81(0x24e)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x521f81(0x20e)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x5c5faa=await callBackend('send_message',{'message':_0x4bc99b});isTyping=![];const _0x3531a1=document[_0x521f81(0x1f4)](_0x521f81(0x1da));if(_0x3531a1)_0x3531a1[_0x521f81(0x219)]();let _0x440127='Ошибка\x20сети';if(_0x5c5faa['success']){_0x440127=_0x5c5faa[_0x521f81(0x1e7)]||_0x521f81(0x238);if(tg?.[_0x521f81(0x213)])tg[_0x521f81(0x213)][_0x521f81(0x229)](_0x521f81(0x22c));}else{_0x440127=_0x5c5faa[_0x521f81(0x244)]||_0x521f81(0x230);if(tg?.[_0x521f81(0x213)])tg[_0x521f81(0x213)][_0x521f81(0x229)](_0x521f81(0x244));}messages[_0x521f81(0x243)]({'role':'ai','content':_0x440127,'timestamp':Date[_0x521f81(0x24e)]()}),localStorage[_0x521f81(0x22f)](_0x521f81(0x1fc),JSON[_0x521f81(0x20e)](messages)),renderMessages();}function a0_0x4740(){const _0x4957cc=['floor','getItem','(((.+)+)+)+$','Начнется\x20новый\x20диалог.','warn','content','debug_uid','confirmModal','createElement','querySelector','splice','typingIndicator','12243400UZEcWv','expand','#050505','27EhjCLv','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','scrollHeight','clearBtn','message\x20','add','classList','clear_history','emptyState','text','impactOccurred','toString','12UyOuOW','5023164iUgBzn','preventDefault','height','touchstart','32119OhDAca','getHours','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','user','disableVerticalSwipes','getElementById','json','children','stopPropagation','show-delete','Очистить\x20историю?','none','min','ai_chat_messages','modalCancel','style','resize','onclick','timestamp','querySelectorAll','auto','username','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','8298227TRBGHm','textContent','constructor','getMinutes','ready','display','div','search','stringify','innerHeight','inputArea','sendBtn','./router.html','HapticFeedback','length','replace','padStart','href','paddingBottom','remove','modalTitle','className','viewportChanged','first_name','10613110YzGABD','6.1','contains','message\x20ai','966988VLdppF','parse','touchend','messageInput','chatArea','forEach','modalConfirm','notificationOccurred','.message.show-delete','initData','success','innerHTML','text/plain','setItem','Ошибка\x20сервера','<br>','key','Удалить?','68uRigeo','addEventListener','.container','BackButton','Пустой\x20ответ','offClick','onEvent','random','show','light','from','focus','Enter','role','message-bubble','push','error','target','2015635ebMkRq','onClick','disabled','trim','scrollTop','appendChild','value','modalText','now'];a0_0x4740=function(){return _0x4957cc;};return a0_0x4740();}function confirmDelete(_0x4f692c){const _0x32c862=a0_0x122482;if(mTitle)mTitle[_0x32c862(0x207)]=_0x32c862(0x233);if(mText)mText[_0x32c862(0x207)]='Действие\x20необратимо.';modalCallback=()=>{const _0x31d6a7=_0x32c862;messages[_0x31d6a7(0x1d9)](_0x4f692c,0x1),localStorage[_0x31d6a7(0x22f)](_0x31d6a7(0x1fc),JSON[_0x31d6a7(0x20e)](messages)),renderMessages();},modal[_0x32c862(0x1e4)][_0x32c862(0x1e3)](_0x32c862(0x23c));}if(clearBtn)clearBtn['onclick']=()=>{const _0x2065b4=a0_0x122482;if(!messages[_0x2065b4(0x214)])return;if(mTitle)mTitle['textContent']=_0x2065b4(0x1f9);if(mText)mText[_0x2065b4(0x207)]=_0x2065b4(0x252);modalCallback=async()=>{const _0x1d6425=_0x2065b4;messages=[],localStorage['removeItem'](_0x1d6425(0x1fc)),renderMessages(),callBackend(_0x1d6425(0x1e5),{});},modal['classList'][_0x2065b4(0x1e3)](_0x2065b4(0x23c));};document[a0_0x122482(0x1f4)](a0_0x122482(0x1fd))[a0_0x122482(0x200)]=()=>modal[a0_0x122482(0x1e4)][a0_0x122482(0x219)](a0_0x122482(0x23c)),document[a0_0x122482(0x1f4)](a0_0x122482(0x228))[a0_0x122482(0x200)]=()=>{const _0x28c424=a0_0x122482;if(modalCallback)modalCallback();modal[_0x28c424(0x1e4)][_0x28c424(0x219)](_0x28c424(0x23c));},messageInput[a0_0x122482(0x235)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x122482(0x235)]('keydown',_0x1d9f20=>{const _0x540eb1=a0_0x122482;_0x1d9f20[_0x540eb1(0x232)]===_0x540eb1(0x240)&&!_0x1d9f20['shiftKey']&&(_0x1d9f20[_0x540eb1(0x1ec)](),sendMessage());}),sendBtn[a0_0x122482(0x200)]=sendMessage,document[a0_0x122482(0x235)]('click',_0x40c27b=>{const _0x488f90=a0_0x122482;document[_0x488f90(0x202)](_0x488f90(0x22a))[_0x488f90(0x227)](_0x753e67=>{const _0x7dd3ab=_0x488f90;if(!_0x753e67[_0x7dd3ab(0x220)](_0x40c27b[_0x7dd3ab(0x245)]))_0x753e67[_0x7dd3ab(0x1e4)][_0x7dd3ab(0x219)](_0x7dd3ab(0x1f8));});});const saved=localStorage[a0_0x122482(0x250)](a0_0x122482(0x1fc));if(saved)try{messages=JSON[a0_0x122482(0x223)](saved),renderMessages();}catch(a0_0x3b0c6c){}updateSendButton();