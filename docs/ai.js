const a0_0x33beeb=a0_0x5c52;(function(_0x59b41e,_0x52c580){const _0xb9518a=a0_0x5c52,_0xb54c38=_0x59b41e();while(!![]){try{const _0x2083da=-parseInt(_0xb9518a(0x172))/0x1*(-parseInt(_0xb9518a(0x197))/0x2)+parseInt(_0xb9518a(0x191))/0x3+parseInt(_0xb9518a(0x12f))/0x4*(-parseInt(_0xb9518a(0x139))/0x5)+parseInt(_0xb9518a(0x16a))/0x6+-parseInt(_0xb9518a(0x17b))/0x7+-parseInt(_0xb9518a(0x14a))/0x8+parseInt(_0xb9518a(0x15b))/0x9;if(_0x2083da===_0x52c580)break;else _0xb54c38['push'](_0xb54c38['shift']());}catch(_0x3ce3d8){_0xb54c38['push'](_0xb54c38['shift']());}}}(a0_0x545e,0xd78e8));const tg=window['Telegram']?.[a0_0x33beeb(0x16e)],HOME_URL=a0_0x33beeb(0x19b);function setupTelegramBackButton(){const _0x5bbe71=a0_0x33beeb,_0x52a035=(function(){let _0x2c554d=!![];return function(_0x521b22,_0x58376b){const _0x3b64ae=_0x2c554d?function(){if(_0x58376b){const _0x5b17fc=_0x58376b['apply'](_0x521b22,arguments);return _0x58376b=null,_0x5b17fc;}}:function(){};return _0x2c554d=![],_0x3b64ae;};}()),_0x2d9a0a=_0x52a035(this,function(){const _0x164402=a0_0x5c52;return _0x2d9a0a[_0x164402(0x155)]()[_0x164402(0x146)](_0x164402(0x131))[_0x164402(0x155)]()['constructor'](_0x2d9a0a)['search'](_0x164402(0x131));});_0x2d9a0a();if(!tg)return;try{tg[_0x5bbe71(0x189)](),tg[_0x5bbe71(0x151)](),tg[_0x5bbe71(0x186)]?.(_0x5bbe71(0x1ac));if(tg[_0x5bbe71(0x16c)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x1a9abf=tg['BackButton'];if(_0x1a9abf){_0x1a9abf[_0x5bbe71(0x19e)]();if(typeof _0x1a9abf['offClick']==='function')try{_0x1a9abf[_0x5bbe71(0x18f)]();}catch(_0x541040){}_0x1a9abf[_0x5bbe71(0x168)](()=>{const _0x2f7490=_0x5bbe71;if(tg[_0x2f7490(0x195)])tg[_0x2f7490(0x195)][_0x2f7490(0x14d)](_0x2f7490(0x162));location[_0x2f7490(0x167)]=HOME_URL;});}}catch(_0xea0c98){console[_0x5bbe71(0x157)](_0x5bbe71(0x166),_0xea0c98);}}(function initStableLayout(){const _0x597803=a0_0x33beeb,_0x1b5eeb=document['querySelector'](_0x597803(0x188)),_0x10d020=document[_0x597803(0x171)]('inputArea'),_0x3c5dd3=document[_0x597803(0x171)](_0x597803(0x173)),_0x24d4b6=document[_0x597803(0x171)](_0x597803(0x141));function _0x54b12c(){const _0x4c700d=_0x597803;if(!_0x1b5eeb)return;const _0x5b5ce6=tg&&tg['viewportHeight']?tg[_0x4c700d(0x176)]:window['innerHeight'];_0x1b5eeb[_0x4c700d(0x17f)][_0x4c700d(0x17a)]=_0x5b5ce6+'px';if(_0x10d020){const _0x534c62=_0x10d020[_0x4c700d(0x14c)];_0x3c5dd3['style'][_0x4c700d(0x156)]=_0x534c62+0x28+'px';}}tg?tg[_0x597803(0x13f)]('viewportChanged',({isStateStable:_0x4e8053})=>{_0x54b12c();if(_0x4e8053)requestAnimationFrame(()=>{const _0x363f93=a0_0x5c52;_0x3c5dd3[_0x363f93(0x153)]=_0x3c5dd3['scrollHeight'];});}):window[_0x597803(0x142)]('resize',_0x54b12c),_0x54b12c(),_0x24d4b6&&(_0x24d4b6[_0x597803(0x142)]('input',()=>{requestAnimationFrame(_0x54b12c);}),_0x24d4b6[_0x597803(0x142)](_0x597803(0x169),()=>{setTimeout(()=>{const _0x36b8c6=a0_0x5c52;_0x3c5dd3[_0x36b8c6(0x153)]=_0x3c5dd3[_0x36b8c6(0x13b)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x33beeb(0x199),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x33beeb(0x171)](a0_0x33beeb(0x173)),emptyState=document[a0_0x33beeb(0x171)]('emptyState'),messageInput=document[a0_0x33beeb(0x171)]('messageInput'),sendBtn=document[a0_0x33beeb(0x171)](a0_0x33beeb(0x175)),clearBtn=document[a0_0x33beeb(0x171)](a0_0x33beeb(0x181)),modal=document[a0_0x33beeb(0x171)](a0_0x33beeb(0x183)),mTitle=document[a0_0x33beeb(0x171)](a0_0x33beeb(0x16f)),mText=document[a0_0x33beeb(0x171)](a0_0x33beeb(0x1a9));let modalCallback=null;async function callBackend(_0x37eb7d,_0x124f1d){const _0x1ca440=a0_0x33beeb,_0x178366=tg?.[_0x1ca440(0x164)]?.['user']||{},_0x594706=_0x178366['id']||localStorage[_0x1ca440(0x178)](_0x1ca440(0x15d))||'d-'+Math[_0x1ca440(0x1a7)](Math[_0x1ca440(0x149)]()*0x3b9aca00);if(!_0x178366['id'])localStorage[_0x1ca440(0x13d)]('debug_uid',_0x594706);const _0x596710={'action':_0x37eb7d,'user_id':_0x594706,'user_data':{'first_name':_0x178366[_0x1ca440(0x15c)],'username':_0x178366[_0x1ca440(0x17d)]},'init_data':tg?.[_0x1ca440(0x14e)]||'',..._0x124f1d},_0x562121=new AbortController(),_0x3f4abb=setTimeout(()=>_0x562121[_0x1ca440(0x136)](),REQUEST_TIMEOUT_MS);try{const _0xc62650=await fetch(BACKEND_URL,{'method':_0x1ca440(0x1a2),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x1ca440(0x140)](_0x596710),'signal':_0x562121['signal']});return clearTimeout(_0x3f4abb),await _0xc62650[_0x1ca440(0x15a)]();}catch(_0x1fd0c6){return{'success':![],'error':String(_0x1fd0c6)};}}function formatTime(_0x354aab){const _0x5d71f8=a0_0x33beeb,_0x1e4e79=new Date(_0x354aab);return String(_0x1e4e79[_0x5d71f8(0x18a)]())[_0x5d71f8(0x192)](0x2,'0')+':'+String(_0x1e4e79['getMinutes']())[_0x5d71f8(0x192)](0x2,'0');}function createMessageElement(_0x28ed49,_0x32164b){const _0x4a218f=a0_0x33beeb,_0x400a69=document[_0x4a218f(0x185)](_0x4a218f(0x19a));_0x400a69[_0x4a218f(0x143)]=_0x4a218f(0x1a5)+_0x28ed49[_0x4a218f(0x134)];const _0x144c35=document[_0x4a218f(0x185)](_0x4a218f(0x19a));_0x144c35[_0x4a218f(0x143)]=_0x4a218f(0x194),_0x144c35[_0x4a218f(0x138)]=_0x28ed49[_0x4a218f(0x145)]['replace'](/\n/g,_0x4a218f(0x13a));const _0xb351e9=document['createElement'](_0x4a218f(0x19a));_0xb351e9[_0x4a218f(0x143)]=_0x4a218f(0x130),_0xb351e9['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0xb351e9['onclick']=_0x1fc291=>{const _0x1f85ae=_0x4a218f;_0x1fc291[_0x1f85ae(0x184)](),confirmDelete(_0x32164b);};let _0x33217f;_0x144c35['addEventListener'](_0x4a218f(0x18e),()=>_0x33217f=setTimeout(()=>{const _0x518ced=_0x4a218f;_0x400a69['classList']['add'](_0x518ced(0x193));if(tg?.[_0x518ced(0x195)])tg['HapticFeedback'][_0x518ced(0x14d)](_0x518ced(0x18b));},0x1f4)),_0x144c35[_0x4a218f(0x142)](_0x4a218f(0x1a3),()=>clearTimeout(_0x33217f));const _0x3fb6b3=document['createElement'](_0x4a218f(0x19a));return _0x3fb6b3[_0x4a218f(0x143)]='message-time',_0x3fb6b3[_0x4a218f(0x160)]=formatTime(_0x28ed49[_0x4a218f(0x177)]),_0x400a69[_0x4a218f(0x150)](_0xb351e9),_0x400a69[_0x4a218f(0x150)](_0x144c35),_0x400a69[_0x4a218f(0x150)](_0x3fb6b3),_0x400a69;}function createTypingIndicator(){const _0x1b5969=a0_0x33beeb,_0x4ea5da=document['createElement'](_0x1b5969(0x19a));return _0x4ea5da['className']=_0x1b5969(0x154),_0x4ea5da['id']=_0x1b5969(0x133),_0x4ea5da[_0x1b5969(0x138)]=_0x1b5969(0x16b),_0x4ea5da;}function renderMessages(){const _0x5557d5=a0_0x33beeb;Array[_0x5557d5(0x147)](chatArea['children'])[_0x5557d5(0x148)](_0x26a16f=>{const _0x43ac72=_0x5557d5;if(_0x26a16f['id']!==_0x43ac72(0x18c))_0x26a16f['remove']();}),messages[_0x5557d5(0x196)]>0x0?(emptyState['style']['display']=_0x5557d5(0x135),messages['forEach']((_0x4df881,_0x235e86)=>chatArea[_0x5557d5(0x150)](createMessageElement(_0x4df881,_0x235e86)))):emptyState[_0x5557d5(0x17f)][_0x5557d5(0x152)]=_0x5557d5(0x19f),requestAnimationFrame(()=>chatArea[_0x5557d5(0x153)]=chatArea[_0x5557d5(0x13b)]);}function autoResizeTextarea(){const _0xd05d6c=a0_0x33beeb;messageInput[_0xd05d6c(0x17f)]['height']=_0xd05d6c(0x1a0),messageInput[_0xd05d6c(0x17f)][_0xd05d6c(0x17a)]=Math[_0xd05d6c(0x174)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x3dc0ef=a0_0x33beeb,_0x4a0756=messageInput[_0x3dc0ef(0x17c)][_0x3dc0ef(0x1aa)]();sendBtn[_0x3dc0ef(0x159)]=!_0x4a0756||isTyping;}function a0_0x545e(){const _0x2187cb=['message\x20','ai_chat_messages','floor','now','modalText','trim','remove','#050505','error','preventDefault','3764SkadJJ','delete-btn','(((.+)+)+)+$','contains','typingIndicator','role','none','abort','shiftKey','innerHTML','9065FTBiRd','<br>','scrollHeight','removeItem','setItem','text','onEvent','stringify','messageInput','addEventListener','className','Ошибка\x20сети','content','search','from','forEach','random','4599784mziIGU','click','offsetHeight','impactOccurred','initData','Enter','appendChild','expand','display','scrollTop','message\x20ai','toString','paddingBottom','warn','send_message','disabled','json','34230708CJSHsd','first_name','debug_uid','key','Пустой\x20ответ','textContent','classList','light','input','initDataUnsafe','modalConfirm','TG\x20setup\x20error:','href','onClick','focus','714594wYIujG','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','isVersionAtLeast','querySelectorAll','WebApp','modalTitle','modalCancel','getElementById','25391JcusFT','chatArea','min','sendBtn','viewportHeight','timestamp','getItem','user','height','11453673juTSrA','value','username','clear_history','style','.message.show-delete','clearBtn','target','confirmModal','stopPropagation','createElement','setHeaderColor','keydown','.container','ready','getHours','medium','emptyState','success','touchstart','offClick','splice','423945VMUJHr','padStart','show-delete','message-bubble','HapticFeedback','length','58GEeiTc','push','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','div','./router.html','Действие\x20необратимо.','Ошибка\x20сервера','show','flex','auto','onclick','POST','touchend','parse'];a0_0x545e=function(){return _0x2187cb;};return a0_0x545e();}async function sendMessage(){const _0x17e266=a0_0x33beeb,_0x173aea=messageInput[_0x17e266(0x17c)][_0x17e266(0x1aa)]();if(!_0x173aea||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback']['impactOccurred']('light');messages[_0x17e266(0x198)]({'role':_0x17e266(0x179),'content':_0x173aea,'timestamp':Date[_0x17e266(0x1a8)]()}),localStorage['setItem'](_0x17e266(0x1a6),JSON[_0x17e266(0x140)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x17e266(0x150)](createTypingIndicator()),chatArea[_0x17e266(0x153)]=chatArea[_0x17e266(0x13b)];const _0x1477dc=await callBackend(_0x17e266(0x158),{'message':_0x173aea});isTyping=![];const _0x5af40f=document[_0x17e266(0x171)](_0x17e266(0x133));if(_0x5af40f)_0x5af40f[_0x17e266(0x1ab)]();let _0x179d95=_0x17e266(0x144);if(_0x1477dc[_0x17e266(0x18d)]){_0x179d95=_0x1477dc[_0x17e266(0x13e)]||_0x17e266(0x15f);if(tg?.[_0x17e266(0x195)])tg[_0x17e266(0x195)]['notificationOccurred'](_0x17e266(0x18d));}else{_0x179d95=_0x1477dc[_0x17e266(0x12d)]||_0x17e266(0x19d);if(tg?.[_0x17e266(0x195)])tg[_0x17e266(0x195)]['notificationOccurred']('error');}messages[_0x17e266(0x198)]({'role':'ai','content':_0x179d95,'timestamp':Date[_0x17e266(0x1a8)]()}),localStorage[_0x17e266(0x13d)](_0x17e266(0x1a6),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x2bf708){const _0x52a6ed=a0_0x33beeb;if(mTitle)mTitle[_0x52a6ed(0x160)]='Удалить?';if(mText)mText[_0x52a6ed(0x160)]=_0x52a6ed(0x19c);modalCallback=()=>{const _0x333946=_0x52a6ed;messages[_0x333946(0x190)](_0x2bf708,0x1),localStorage[_0x333946(0x13d)](_0x333946(0x1a6),JSON[_0x333946(0x140)](messages)),renderMessages();},modal[_0x52a6ed(0x161)]['add']('show');}if(clearBtn)clearBtn[a0_0x33beeb(0x1a1)]=()=>{const _0x317e89=a0_0x33beeb;if(!messages[_0x317e89(0x196)])return;if(mTitle)mTitle['textContent']='Очистить\x20историю?';if(mText)mText[_0x317e89(0x160)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x2c599b=_0x317e89;messages=[],localStorage[_0x2c599b(0x13c)](_0x2c599b(0x1a6)),renderMessages(),callBackend(_0x2c599b(0x17e),{});},modal[_0x317e89(0x161)]['add']('show');};document[a0_0x33beeb(0x171)](a0_0x33beeb(0x170))['onclick']=()=>modal[a0_0x33beeb(0x161)][a0_0x33beeb(0x1ab)]('show'),document[a0_0x33beeb(0x171)](a0_0x33beeb(0x165))[a0_0x33beeb(0x1a1)]=()=>{const _0x56ddfe=a0_0x33beeb;if(modalCallback)modalCallback();modal[_0x56ddfe(0x161)][_0x56ddfe(0x1ab)]('show');},messageInput[a0_0x33beeb(0x142)](a0_0x33beeb(0x163),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x33beeb(0x142)](a0_0x33beeb(0x187),_0x186658=>{const _0x393b0f=a0_0x33beeb;_0x186658[_0x393b0f(0x15e)]===_0x393b0f(0x14f)&&!_0x186658[_0x393b0f(0x137)]&&(_0x186658[_0x393b0f(0x12e)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x33beeb(0x142)](a0_0x33beeb(0x14b),_0x13a43f=>{const _0x4419fb=a0_0x33beeb;document[_0x4419fb(0x16d)](_0x4419fb(0x180))[_0x4419fb(0x148)](_0x1ed5e0=>{const _0x12d560=_0x4419fb;if(!_0x1ed5e0[_0x12d560(0x132)](_0x13a43f[_0x12d560(0x182)]))_0x1ed5e0[_0x12d560(0x161)]['remove'](_0x12d560(0x193));});});function a0_0x5c52(_0xd7ff12,_0x1921a4){_0xd7ff12=_0xd7ff12-0x12d;const _0x4f2b87=a0_0x545e();let _0x4c0dbb=_0x4f2b87[_0xd7ff12];return _0x4c0dbb;}const saved=localStorage['getItem'](a0_0x33beeb(0x1a6));if(saved)try{messages=JSON[a0_0x33beeb(0x1a4)](saved),renderMessages();}catch(a0_0x127244){}updateSendButton();