const a0_0x63ad18=a0_0x1da7;(function(_0x35855c,_0x4d2c3e){const _0x242ef8=a0_0x1da7,_0x395891=_0x35855c();while(!![]){try{const _0x45f2d9=parseInt(_0x242ef8(0x1a5))/0x1+-parseInt(_0x242ef8(0x1e0))/0x2*(parseInt(_0x242ef8(0x166))/0x3)+parseInt(_0x242ef8(0x1b9))/0x4+-parseInt(_0x242ef8(0x1b0))/0x5+parseInt(_0x242ef8(0x1a2))/0x6+parseInt(_0x242ef8(0x169))/0x7*(-parseInt(_0x242ef8(0x1e1))/0x8)+parseInt(_0x242ef8(0x1c6))/0x9*(parseInt(_0x242ef8(0x194))/0xa);if(_0x45f2d9===_0x4d2c3e)break;else _0x395891['push'](_0x395891['shift']());}catch(_0x3d8f7a){_0x395891['push'](_0x395891['shift']());}}}(a0_0x3254,0xced72));const tg=window[a0_0x63ad18(0x16b)]?.[a0_0x63ad18(0x197)],HOME_URL=a0_0x63ad18(0x1b2);function setupTelegramBackButton(){const _0x4cf28a=a0_0x63ad18;if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x4cf28a(0x1bc)]?.(_0x4cf28a(0x1ce));if(tg[_0x4cf28a(0x1d7)]?.(_0x4cf28a(0x1a4)))tg[_0x4cf28a(0x1db)]?.();const _0x27a3db=tg['BackButton'];if(_0x27a3db){_0x27a3db[_0x4cf28a(0x1d2)]();if(typeof _0x27a3db[_0x4cf28a(0x1b7)]===_0x4cf28a(0x16e))try{_0x27a3db[_0x4cf28a(0x1b7)]();}catch(_0x346777){}_0x27a3db[_0x4cf28a(0x1dc)](()=>{const _0x33734f=_0x4cf28a;if(tg['HapticFeedback'])tg[_0x33734f(0x1a1)][_0x33734f(0x1e4)](_0x33734f(0x17e));location[_0x33734f(0x19a)]=HOME_URL;});}}catch(_0x4c2867){console[_0x4cf28a(0x1df)]('TG\x20setup\x20error:',_0x4c2867);}}(function initStableLayout(){const _0xde3fe8=a0_0x63ad18,_0x4203d5=(function(){let _0x24e943=!![];return function(_0x2a5bfc,_0x4bbdd5){const _0x1a5699=_0x24e943?function(){const _0x2a1a85=a0_0x1da7;if(_0x4bbdd5){const _0x21aa50=_0x4bbdd5[_0x2a1a85(0x1ab)](_0x2a5bfc,arguments);return _0x4bbdd5=null,_0x21aa50;}}:function(){};return _0x24e943=![],_0x1a5699;};}()),_0x273018=document[_0xde3fe8(0x1ac)](_0xde3fe8(0x1aa)),_0x1f2c05=document[_0xde3fe8(0x18a)](_0xde3fe8(0x1d8)),_0x43d47b=document[_0xde3fe8(0x18a)](_0xde3fe8(0x1b6)),_0x47db0d=document[_0xde3fe8(0x18a)](_0xde3fe8(0x1c3));function _0x4f3531(){const _0xd8a89f=_0xde3fe8,_0x3f3480=_0x4203d5(this,function(){const _0x5bdbf8=a0_0x1da7;return _0x3f3480[_0x5bdbf8(0x173)]()['search'](_0x5bdbf8(0x18e))[_0x5bdbf8(0x173)]()[_0x5bdbf8(0x187)](_0x3f3480)[_0x5bdbf8(0x195)](_0x5bdbf8(0x18e));});_0x3f3480();if(!_0x273018)return;const _0x34fc31=tg&&tg[_0xd8a89f(0x16f)]?tg[_0xd8a89f(0x16f)]:window[_0xd8a89f(0x180)];_0x273018[_0xd8a89f(0x18b)][_0xd8a89f(0x1bf)]=_0x34fc31+'px';if(_0x1f2c05){const _0x5719d9=_0x1f2c05[_0xd8a89f(0x182)];_0x43d47b[_0xd8a89f(0x18b)]['paddingBottom']=_0x5719d9+0x28+'px';}}tg?tg[_0xde3fe8(0x17f)](_0xde3fe8(0x19e),({isStateStable:_0x4bb46e})=>{_0x4f3531();if(_0x4bb46e)requestAnimationFrame(()=>{const _0x273e37=a0_0x1da7;_0x43d47b[_0x273e37(0x1a0)]=_0x43d47b[_0x273e37(0x1bb)];});}):window['addEventListener'](_0xde3fe8(0x1d3),_0x4f3531),_0x4f3531(),_0x47db0d&&(_0x47db0d[_0xde3fe8(0x19c)]('input',()=>{requestAnimationFrame(_0x4f3531);}),_0x47db0d[_0xde3fe8(0x19c)]('focus',()=>{setTimeout(()=>{const _0x388e75=a0_0x1da7;_0x43d47b['scrollTop']=_0x43d47b[_0x388e75(0x1bb)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x63ad18(0x18c),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x63ad18(0x18a)](a0_0x63ad18(0x1b6)),emptyState=document['getElementById'](a0_0x63ad18(0x1c1)),messageInput=document[a0_0x63ad18(0x18a)](a0_0x63ad18(0x1c3)),sendBtn=document[a0_0x63ad18(0x18a)](a0_0x63ad18(0x1b5)),clearBtn=document[a0_0x63ad18(0x18a)]('clearBtn'),modal=document[a0_0x63ad18(0x18a)](a0_0x63ad18(0x174)),mTitle=document['getElementById'](a0_0x63ad18(0x1d0)),mText=document['getElementById'](a0_0x63ad18(0x16a));let modalCallback=null;async function callBackend(_0x3dba37,_0x26ea8c){const _0x5aa3a6=a0_0x63ad18,_0x4998df=tg?.[_0x5aa3a6(0x1c0)]?.['user']||{},_0x15e58a=_0x4998df['id']||localStorage['getItem'](_0x5aa3a6(0x181))||'d-'+Math[_0x5aa3a6(0x172)](Math['random']()*0x3b9aca00);if(!_0x4998df['id'])localStorage[_0x5aa3a6(0x19d)](_0x5aa3a6(0x181),_0x15e58a);const _0x11293e={'action':_0x3dba37,'user_id':_0x15e58a,'user_data':{'first_name':_0x4998df[_0x5aa3a6(0x199)],'username':_0x4998df['username']},'init_data':tg?.[_0x5aa3a6(0x185)]||'',..._0x26ea8c},_0x1bd8be=new AbortController(),_0x1721b1=setTimeout(()=>_0x1bd8be['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5b7c5d=await fetch(BACKEND_URL,{'method':_0x5aa3a6(0x19b),'headers':{'Content-Type':_0x5aa3a6(0x1a3)},'body':JSON[_0x5aa3a6(0x179)](_0x11293e),'signal':_0x1bd8be[_0x5aa3a6(0x19f)]});return clearTimeout(_0x1721b1),await _0x5b7c5d[_0x5aa3a6(0x1a9)]();}catch(_0x529cce){return{'success':![],'error':String(_0x529cce)};}}function formatTime(_0x4deddf){const _0x138391=a0_0x63ad18,_0x20e67f=new Date(_0x4deddf);return String(_0x20e67f[_0x138391(0x1a7)]())[_0x138391(0x1de)](0x2,'0')+':'+String(_0x20e67f[_0x138391(0x1c7)]())[_0x138391(0x1de)](0x2,'0');}function createMessageElement(_0x5b21dd,_0x5ea61a){const _0x4d19a8=a0_0x63ad18,_0x18c04c=document['createElement'](_0x4d19a8(0x1d1));_0x18c04c['className']=_0x4d19a8(0x193)+_0x5b21dd[_0x4d19a8(0x1da)];const _0x4138d6=document[_0x4d19a8(0x188)](_0x4d19a8(0x1d1));_0x4138d6['className']='message-bubble',_0x4138d6['innerHTML']=_0x5b21dd[_0x4d19a8(0x189)][_0x4d19a8(0x184)](/\n/g,_0x4d19a8(0x1d9));const _0x2d6231=document[_0x4d19a8(0x188)](_0x4d19a8(0x1d1));_0x2d6231[_0x4d19a8(0x1cc)]=_0x4d19a8(0x1b4),_0x2d6231[_0x4d19a8(0x196)]=_0x4d19a8(0x1dd),_0x2d6231[_0x4d19a8(0x177)]=_0x545476=>{const _0x3bbfa4=_0x4d19a8;_0x545476[_0x3bbfa4(0x198)](),confirmDelete(_0x5ea61a);};let _0x3e0486;_0x4138d6[_0x4d19a8(0x19c)]('touchstart',()=>_0x3e0486=setTimeout(()=>{const _0x366e38=_0x4d19a8;_0x18c04c['classList'][_0x366e38(0x170)](_0x366e38(0x1a8));if(tg?.[_0x366e38(0x1a1)])tg['HapticFeedback'][_0x366e38(0x1e4)](_0x366e38(0x1c9));},0x1f4)),_0x4138d6['addEventListener'](_0x4d19a8(0x186),()=>clearTimeout(_0x3e0486));const _0xae68ce=document['createElement'](_0x4d19a8(0x1d1));return _0xae68ce[_0x4d19a8(0x1cc)]=_0x4d19a8(0x16d),_0xae68ce[_0x4d19a8(0x167)]=formatTime(_0x5b21dd[_0x4d19a8(0x175)]),_0x18c04c[_0x4d19a8(0x1c8)](_0x2d6231),_0x18c04c[_0x4d19a8(0x1c8)](_0x4138d6),_0x18c04c['appendChild'](_0xae68ce),_0x18c04c;}function createTypingIndicator(){const _0x3c5f1f=a0_0x63ad18,_0x1dbfe5=document[_0x3c5f1f(0x188)]('div');return _0x1dbfe5[_0x3c5f1f(0x1cc)]=_0x3c5f1f(0x1bd),_0x1dbfe5['id']=_0x3c5f1f(0x191),_0x1dbfe5[_0x3c5f1f(0x196)]=_0x3c5f1f(0x190),_0x1dbfe5;}function renderMessages(){const _0x3e7f57=a0_0x63ad18;Array[_0x3e7f57(0x1c2)](chatArea[_0x3e7f57(0x1c4)])[_0x3e7f57(0x1e3)](_0x5132ac=>{const _0x25a450=_0x3e7f57;if(_0x5132ac['id']!==_0x25a450(0x1c1))_0x5132ac['remove']();}),messages[_0x3e7f57(0x18d)]>0x0?(emptyState[_0x3e7f57(0x18b)][_0x3e7f57(0x178)]='none',messages[_0x3e7f57(0x1e3)]((_0x386b87,_0x5136af)=>chatArea[_0x3e7f57(0x1c8)](createMessageElement(_0x386b87,_0x5136af)))):emptyState[_0x3e7f57(0x18b)][_0x3e7f57(0x178)]=_0x3e7f57(0x16c),requestAnimationFrame(()=>chatArea[_0x3e7f57(0x1a0)]=chatArea[_0x3e7f57(0x1bb)]);}function autoResizeTextarea(){const _0x9619a=a0_0x63ad18;messageInput['style']['height']='auto',messageInput['style'][_0x9619a(0x1bf)]=Math['min'](messageInput[_0x9619a(0x1bb)],0x78)+'px';}function a0_0x3254(){const _0x40f0a0=['getItem','784236wsfFNV','ai_chat_messages','scrollHeight','setHeaderColor','message\x20ai','Начнется\x20новый\x20диалог.','height','initDataUnsafe','emptyState','from','messageInput','children','key','9GquKGQ','getMinutes','appendChild','medium','notificationOccurred','Ошибка\x20сервера','className','error','#050505','text','modalTitle','div','show','resize','push','disabled','contains','isVersionAtLeast','inputArea','<br>','role','disableVerticalSwipes','onClick','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','padStart','warn','1898HrxIuc','2666864AyLYGv','parse','forEach','impactOccurred','trim','classList','1227UEiGRo','textContent','.message.show-delete','28kdNONZ','modalText','Telegram','flex','message-time','function','viewportHeight','add','modalConfirm','floor','toString','confirmModal','timestamp','splice','onclick','display','stringify','Удалить?','success','click','clear_history','light','onEvent','innerHeight','debug_uid','offsetHeight','Ошибка\x20сети','replace','initData','touchend','constructor','createElement','content','getElementById','style','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','length','(((.+)+)+)+$','value','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','typingIndicator','remove','message\x20','21688110fTlkGb','search','innerHTML','WebApp','stopPropagation','first_name','href','POST','addEventListener','setItem','viewportChanged','signal','scrollTop','HapticFeedback','4176258EruPGE','text/plain','6.1','843933vIfcuR','preventDefault','getHours','show-delete','json','.container','apply','querySelector','send_message','target','now','6680275YTiriW','modalCancel','./router.html','shiftKey','delete-btn','sendBtn','chatArea','offClick'];a0_0x3254=function(){return _0x40f0a0;};return a0_0x3254();}function updateSendButton(){const _0x3000f8=a0_0x63ad18,_0x5be5c3=messageInput['value'][_0x3000f8(0x1e5)]();sendBtn[_0x3000f8(0x1d5)]=!_0x5be5c3||isTyping;}async function sendMessage(){const _0x2e3ade=a0_0x63ad18,_0x505d3a=messageInput[_0x2e3ade(0x18f)][_0x2e3ade(0x1e5)]();if(!_0x505d3a||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x2e3ade(0x1e4)]('light');messages[_0x2e3ade(0x1d4)]({'role':'user','content':_0x505d3a,'timestamp':Date[_0x2e3ade(0x1af)]()}),localStorage[_0x2e3ade(0x19d)](_0x2e3ade(0x1ba),JSON['stringify'](messages)),renderMessages(),messageInput[_0x2e3ade(0x18f)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2e3ade(0x1c8)](createTypingIndicator()),chatArea[_0x2e3ade(0x1a0)]=chatArea['scrollHeight'];const _0x458b26=await callBackend(_0x2e3ade(0x1ad),{'message':_0x505d3a});isTyping=![];const _0x2b93bf=document[_0x2e3ade(0x18a)](_0x2e3ade(0x191));if(_0x2b93bf)_0x2b93bf[_0x2e3ade(0x192)]();let _0x48003e=_0x2e3ade(0x183);if(_0x458b26['success']){_0x48003e=_0x458b26[_0x2e3ade(0x1cf)]||'Пустой\x20ответ';if(tg?.[_0x2e3ade(0x1a1)])tg['HapticFeedback'][_0x2e3ade(0x1ca)](_0x2e3ade(0x17b));}else{_0x48003e=_0x458b26[_0x2e3ade(0x1cd)]||_0x2e3ade(0x1cb);if(tg?.['HapticFeedback'])tg[_0x2e3ade(0x1a1)]['notificationOccurred'](_0x2e3ade(0x1cd));}messages[_0x2e3ade(0x1d4)]({'role':'ai','content':_0x48003e,'timestamp':Date[_0x2e3ade(0x1af)]()}),localStorage['setItem'](_0x2e3ade(0x1ba),JSON[_0x2e3ade(0x179)](messages)),renderMessages();}function confirmDelete(_0x5c9d84){const _0x55d7e5=a0_0x63ad18;if(mTitle)mTitle[_0x55d7e5(0x167)]=_0x55d7e5(0x17a);if(mText)mText[_0x55d7e5(0x167)]='Действие\x20необратимо.';modalCallback=()=>{const _0xb93686=_0x55d7e5;messages[_0xb93686(0x176)](_0x5c9d84,0x1),localStorage[_0xb93686(0x19d)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x55d7e5(0x165)]['add'](_0x55d7e5(0x1d2));}if(clearBtn)clearBtn['onclick']=()=>{const _0x371351=a0_0x63ad18;if(!messages['length'])return;if(mTitle)mTitle[_0x371351(0x167)]='Очистить\x20историю?';if(mText)mText[_0x371351(0x167)]=_0x371351(0x1be);modalCallback=async()=>{const _0xf13525=_0x371351;messages=[],localStorage['removeItem'](_0xf13525(0x1ba)),renderMessages(),callBackend(_0xf13525(0x17d),{});},modal[_0x371351(0x165)][_0x371351(0x170)](_0x371351(0x1d2));};document[a0_0x63ad18(0x18a)](a0_0x63ad18(0x1b1))[a0_0x63ad18(0x177)]=()=>modal[a0_0x63ad18(0x165)][a0_0x63ad18(0x192)]('show'),document[a0_0x63ad18(0x18a)](a0_0x63ad18(0x171))[a0_0x63ad18(0x177)]=()=>{const _0x2b6d05=a0_0x63ad18;if(modalCallback)modalCallback();modal[_0x2b6d05(0x165)]['remove']('show');},messageInput[a0_0x63ad18(0x19c)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x63ad18(0x19c)]('keydown',_0x48d5bf=>{const _0x357f30=a0_0x63ad18;_0x48d5bf[_0x357f30(0x1c5)]==='Enter'&&!_0x48d5bf[_0x357f30(0x1b3)]&&(_0x48d5bf[_0x357f30(0x1a6)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x63ad18(0x19c)](a0_0x63ad18(0x17c),_0x3d99ca=>{const _0x1e1ba8=a0_0x63ad18;document['querySelectorAll'](_0x1e1ba8(0x168))[_0x1e1ba8(0x1e3)](_0x535891=>{const _0x3193e2=_0x1e1ba8;if(!_0x535891[_0x3193e2(0x1d6)](_0x3d99ca[_0x3193e2(0x1ae)]))_0x535891['classList'][_0x3193e2(0x192)](_0x3193e2(0x1a8));});});function a0_0x1da7(_0xd7678f,_0x10a645){_0xd7678f=_0xd7678f-0x165;const _0x2686a6=a0_0x3254();let _0x5d29ab=_0x2686a6[_0xd7678f];return _0x5d29ab;}const saved=localStorage[a0_0x63ad18(0x1b8)](a0_0x63ad18(0x1ba));if(saved)try{messages=JSON[a0_0x63ad18(0x1e2)](saved),renderMessages();}catch(a0_0x3b4a2e){}updateSendButton();