const a0_0xa77353=a0_0x5e3e;function a0_0x5e3e(_0x480b7a,_0x59213a){_0x480b7a=_0x480b7a-0x102;const _0x2ef34d=a0_0x5537();let _0x5170f1=_0x2ef34d[_0x480b7a];return _0x5170f1;}(function(_0x94d75,_0x1f4fa9){const _0x4ed444=a0_0x5e3e,_0x134b45=_0x94d75();while(!![]){try{const _0x5be2df=parseInt(_0x4ed444(0x17c))/0x1+parseInt(_0x4ed444(0x180))/0x2*(parseInt(_0x4ed444(0x13f))/0x3)+-parseInt(_0x4ed444(0x13a))/0x4*(parseInt(_0x4ed444(0x162))/0x5)+-parseInt(_0x4ed444(0x146))/0x6*(-parseInt(_0x4ed444(0x10a))/0x7)+parseInt(_0x4ed444(0x13d))/0x8*(parseInt(_0x4ed444(0x12d))/0x9)+-parseInt(_0x4ed444(0x185))/0xa*(-parseInt(_0x4ed444(0x15d))/0xb)+-parseInt(_0x4ed444(0x15c))/0xc*(parseInt(_0x4ed444(0x126))/0xd);if(_0x5be2df===_0x1f4fa9)break;else _0x134b45['push'](_0x134b45['shift']());}catch(_0x48977d){_0x134b45['push'](_0x134b45['shift']());}}}(a0_0x5537,0xd804b));const tg=window[a0_0xa77353(0x134)]?.[a0_0xa77353(0x178)],HOME_URL=a0_0xa77353(0x169);function setupTelegramBackButton(){const _0x20356d=a0_0xa77353;if(!tg)return;try{tg[_0x20356d(0x15a)](),tg[_0x20356d(0x122)](),tg['setHeaderColor']?.('#050505');if(tg[_0x20356d(0x163)]?.(_0x20356d(0x109)))tg[_0x20356d(0x176)]?.();const _0x653f34=tg[_0x20356d(0x184)];if(_0x653f34){_0x653f34[_0x20356d(0x108)]();if(typeof _0x653f34[_0x20356d(0x17d)]===_0x20356d(0x11d))try{_0x653f34['offClick']();}catch(_0x5f17d7){}_0x653f34[_0x20356d(0x14f)](()=>{const _0x524cc3=_0x20356d;if(tg[_0x524cc3(0x14d)])tg[_0x524cc3(0x14d)][_0x524cc3(0x189)](_0x524cc3(0x145));location[_0x524cc3(0x182)]=HOME_URL;});}}catch(_0x791306){console[_0x20356d(0x130)](_0x20356d(0x118),_0x791306);}}(function initStableLayout(){const _0x360442=a0_0xa77353,_0xa415a1=(function(){let _0x4da608=!![];return function(_0x295bd1,_0x2bb370){const _0xbf7862=_0x4da608?function(){const _0x2bafed=a0_0x5e3e;if(_0x2bb370){const _0x5dc108=_0x2bb370[_0x2bafed(0x170)](_0x295bd1,arguments);return _0x2bb370=null,_0x5dc108;}}:function(){};return _0x4da608=![],_0xbf7862;};}()),_0xb2ae2c=document[_0x360442(0x17f)](_0x360442(0x17a)),_0x4e6113=document['getElementById']('inputArea'),_0x7e35cc=document[_0x360442(0x161)](_0x360442(0x18a)),_0x772374=document[_0x360442(0x161)](_0x360442(0x14a));function _0x1898a3(){const _0x3fdcea=_0x360442,_0x363f28=_0xa415a1(this,function(){const _0x2ee54e=a0_0x5e3e;return _0x363f28[_0x2ee54e(0x16f)]()[_0x2ee54e(0x10d)](_0x2ee54e(0x167))[_0x2ee54e(0x16f)]()[_0x2ee54e(0x10e)](_0x363f28)[_0x2ee54e(0x10d)](_0x2ee54e(0x167));});_0x363f28();if(!_0xb2ae2c)return;const _0x48014d=tg&&tg[_0x3fdcea(0x187)]?tg['viewportHeight']:window[_0x3fdcea(0x11f)];_0xb2ae2c['style'][_0x3fdcea(0x129)]=_0x48014d+'px';if(_0x4e6113){const _0x38d1a9=_0x4e6113[_0x3fdcea(0x115)];_0x7e35cc['style'][_0x3fdcea(0x121)]=_0x38d1a9+0x28+'px';}}tg?tg[_0x360442(0x158)](_0x360442(0x114),({isStateStable:_0x5c6fca})=>{_0x1898a3();if(_0x5c6fca)requestAnimationFrame(()=>{const _0x59f62e=a0_0x5e3e;_0x7e35cc['scrollTop']=_0x7e35cc[_0x59f62e(0x140)];});}):window['addEventListener'](_0x360442(0x141),_0x1898a3),_0x1898a3(),_0x772374&&(_0x772374[_0x360442(0x148)]('input',()=>{requestAnimationFrame(_0x1898a3);}),_0x772374[_0x360442(0x148)](_0x360442(0x12a),()=>{setTimeout(()=>{const _0x4b694e=a0_0x5e3e;_0x7e35cc[_0x4b694e(0x155)]=_0x7e35cc[_0x4b694e(0x140)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xa77353(0x174),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xa77353(0x161)](a0_0xa77353(0x18a)),emptyState=document[a0_0xa77353(0x161)](a0_0xa77353(0x11b)),messageInput=document['getElementById'](a0_0xa77353(0x14a)),sendBtn=document[a0_0xa77353(0x161)](a0_0xa77353(0x166)),clearBtn=document['getElementById'](a0_0xa77353(0x12f)),modal=document[a0_0xa77353(0x161)](a0_0xa77353(0x13b)),mTitle=document[a0_0xa77353(0x161)](a0_0xa77353(0x16c)),mText=document[a0_0xa77353(0x161)](a0_0xa77353(0x18b));let modalCallback=null;async function callBackend(_0x11cf4b,_0x17c2a6){const _0x1f2eef=a0_0xa77353,_0x4b7e3d=tg?.['initDataUnsafe']?.[_0x1f2eef(0x15f)]||{},_0x58731f=_0x4b7e3d['id']||localStorage[_0x1f2eef(0x173)](_0x1f2eef(0x137))||'d-'+Math[_0x1f2eef(0x16e)](Math['random']()*0x3b9aca00);if(!_0x4b7e3d['id'])localStorage['setItem'](_0x1f2eef(0x137),_0x58731f);const _0x1553eb={'action':_0x11cf4b,'user_id':_0x58731f,'user_data':{'first_name':_0x4b7e3d[_0x1f2eef(0x14b)],'username':_0x4b7e3d[_0x1f2eef(0x159)]},'init_data':tg?.[_0x1f2eef(0x105)]||'',..._0x17c2a6},_0x4af5f=new AbortController(),_0x579353=setTimeout(()=>_0x4af5f['abort'](),REQUEST_TIMEOUT_MS);try{const _0x5b555c=await fetch(BACKEND_URL,{'method':_0x1f2eef(0x107),'headers':{'Content-Type':_0x1f2eef(0x11e)},'body':JSON[_0x1f2eef(0x156)](_0x1553eb),'signal':_0x4af5f[_0x1f2eef(0x157)]});return clearTimeout(_0x579353),await _0x5b555c[_0x1f2eef(0x13e)]();}catch(_0x3758a9){return{'success':![],'error':String(_0x3758a9)};}}function formatTime(_0x38f895){const _0xc453d1=a0_0xa77353,_0x4ae322=new Date(_0x38f895);return String(_0x4ae322[_0xc453d1(0x15e)]())[_0xc453d1(0x147)](0x2,'0')+':'+String(_0x4ae322[_0xc453d1(0x151)]())['padStart'](0x2,'0');}function createMessageElement(_0x215828,_0x3d6128){const _0x3e0db3=a0_0xa77353,_0x4cbd97=document['createElement'](_0x3e0db3(0x119));_0x4cbd97[_0x3e0db3(0x177)]=_0x3e0db3(0x144)+_0x215828[_0x3e0db3(0x12b)];const _0xea73da=document['createElement'](_0x3e0db3(0x119));_0xea73da[_0x3e0db3(0x177)]=_0x3e0db3(0x135),_0xea73da[_0x3e0db3(0x149)]=_0x215828[_0x3e0db3(0x142)]['replace'](/\n/g,_0x3e0db3(0x104));const _0x1610a8=document[_0x3e0db3(0x11a)](_0x3e0db3(0x119));_0x1610a8[_0x3e0db3(0x177)]=_0x3e0db3(0x103),_0x1610a8[_0x3e0db3(0x149)]=_0x3e0db3(0x136),_0x1610a8[_0x3e0db3(0x172)]=_0x474a48=>{const _0x45df3a=_0x3e0db3;_0x474a48[_0x45df3a(0x165)](),confirmDelete(_0x3d6128);};let _0x5c31b6;_0xea73da[_0x3e0db3(0x148)](_0x3e0db3(0x16b),()=>_0x5c31b6=setTimeout(()=>{const _0x492e45=_0x3e0db3;_0x4cbd97['classList'][_0x492e45(0x14c)]('show-delete');if(tg?.[_0x492e45(0x14d)])tg['HapticFeedback']['impactOccurred']('medium');},0x1f4)),_0xea73da[_0x3e0db3(0x148)]('touchend',()=>clearTimeout(_0x5c31b6));const _0x51e234=document[_0x3e0db3(0x11a)](_0x3e0db3(0x119));return _0x51e234[_0x3e0db3(0x177)]=_0x3e0db3(0x188),_0x51e234['textContent']=formatTime(_0x215828[_0x3e0db3(0x17e)]),_0x4cbd97[_0x3e0db3(0x17b)](_0x1610a8),_0x4cbd97[_0x3e0db3(0x17b)](_0xea73da),_0x4cbd97[_0x3e0db3(0x17b)](_0x51e234),_0x4cbd97;}function createTypingIndicator(){const _0x161a2a=a0_0xa77353,_0x139b5d=document[_0x161a2a(0x11a)](_0x161a2a(0x119));return _0x139b5d[_0x161a2a(0x177)]=_0x161a2a(0x10b),_0x139b5d['id']=_0x161a2a(0x181),_0x139b5d[_0x161a2a(0x149)]=_0x161a2a(0x143),_0x139b5d;}function renderMessages(){const _0x53fb98=a0_0xa77353;Array[_0x53fb98(0x112)](chatArea['children'])[_0x53fb98(0x16d)](_0x91e652=>{const _0x4fa178=_0x53fb98;if(_0x91e652['id']!=='emptyState')_0x91e652[_0x4fa178(0x10f)]();}),messages['length']>0x0?(emptyState[_0x53fb98(0x154)][_0x53fb98(0x160)]='none',messages[_0x53fb98(0x16d)]((_0x42a542,_0x142e05)=>chatArea[_0x53fb98(0x17b)](createMessageElement(_0x42a542,_0x142e05)))):emptyState[_0x53fb98(0x154)][_0x53fb98(0x160)]=_0x53fb98(0x116),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x53fb98(0x140)]);}function autoResizeTextarea(){const _0x1594c9=a0_0xa77353;messageInput[_0x1594c9(0x154)][_0x1594c9(0x129)]=_0x1594c9(0x13c),messageInput[_0x1594c9(0x154)][_0x1594c9(0x129)]=Math['min'](messageInput[_0x1594c9(0x140)],0x78)+'px';}function updateSendButton(){const _0x1ba890=a0_0xa77353,_0x3e8a73=messageInput[_0x1ba890(0x171)][_0x1ba890(0x14e)]();sendBtn['disabled']=!_0x3e8a73||isTyping;}async function sendMessage(){const _0x18be29=a0_0xa77353,_0x4f980d=messageInput[_0x18be29(0x171)][_0x18be29(0x14e)]();if(!_0x4f980d||isTyping)return;if(tg?.[_0x18be29(0x14d)])tg[_0x18be29(0x14d)][_0x18be29(0x189)](_0x18be29(0x145));messages[_0x18be29(0x11c)]({'role':_0x18be29(0x15f),'content':_0x4f980d,'timestamp':Date[_0x18be29(0x124)]()}),localStorage[_0x18be29(0x150)](_0x18be29(0x10c),JSON[_0x18be29(0x156)](messages)),renderMessages(),messageInput[_0x18be29(0x171)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x18be29(0x17b)](createTypingIndicator()),chatArea[_0x18be29(0x155)]=chatArea[_0x18be29(0x140)];const _0x354bd2=await callBackend(_0x18be29(0x183),{'message':_0x4f980d});isTyping=![];const _0x25b46e=document[_0x18be29(0x161)](_0x18be29(0x181));if(_0x25b46e)_0x25b46e[_0x18be29(0x10f)]();let _0x3a03c5=_0x18be29(0x153);if(_0x354bd2[_0x18be29(0x175)]){_0x3a03c5=_0x354bd2[_0x18be29(0x120)]||'Пустой\x20ответ';if(tg?.[_0x18be29(0x14d)])tg[_0x18be29(0x14d)]['notificationOccurred'](_0x18be29(0x175));}else{_0x3a03c5=_0x354bd2[_0x18be29(0x15b)]||_0x18be29(0x132);if(tg?.[_0x18be29(0x14d)])tg['HapticFeedback'][_0x18be29(0x12c)](_0x18be29(0x15b));}messages[_0x18be29(0x11c)]({'role':'ai','content':_0x3a03c5,'timestamp':Date['now']()}),localStorage[_0x18be29(0x150)](_0x18be29(0x10c),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x5e917f){const _0x5959c2=a0_0xa77353;if(mTitle)mTitle[_0x5959c2(0x128)]=_0x5959c2(0x117);if(mText)mText[_0x5959c2(0x128)]=_0x5959c2(0x102);modalCallback=()=>{const _0xf1a310=_0x5959c2;messages['splice'](_0x5e917f,0x1),localStorage[_0xf1a310(0x150)](_0xf1a310(0x10c),JSON['stringify'](messages)),renderMessages();},modal[_0x5959c2(0x127)][_0x5959c2(0x14c)](_0x5959c2(0x108));}function a0_0x5537(){const _0x18d757=['keydown','240Nccmif','confirmModal','auto','8JFCgIB','json','69981LamNyZ','scrollHeight','resize','content','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','message\x20','light','6Gsribk','padStart','addEventListener','innerHTML','messageInput','first_name','add','HapticFeedback','trim','onClick','setItem','getMinutes','preventDefault','Ошибка\x20сети','style','scrollTop','stringify','signal','onEvent','username','ready','error','228xoMGxC','11PmHscT','getHours','user','display','getElementById','139395XXwLvS','isVersionAtLeast','contains','stopPropagation','sendBtn','(((.+)+)+)+$','shiftKey','./router.html','click','touchstart','modalTitle','forEach','floor','toString','apply','value','onclick','getItem','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','success','disableVerticalSwipes','className','WebApp','.message.show-delete','.container','appendChild','674381LEwywI','offClick','timestamp','querySelector','112wpAGXd','typingIndicator','href','send_message','BackButton','11075270fwiBxC','clear_history','viewportHeight','message-time','impactOccurred','chatArea','modalText','Действие\x20необратимо.','delete-btn','<br>','initData','length','POST','show','6.1','10930045edndgK','message\x20ai','ai_chat_messages','search','constructor','remove','Начнется\x20новый\x20диалог.','removeItem','from','modalCancel','viewportChanged','offsetHeight','flex','Удалить?','TG\x20setup\x20error:','div','createElement','emptyState','push','function','text/plain','innerHeight','text','paddingBottom','expand','parse','now','key','1505309FRbnfJ','classList','textContent','height','focus','role','notificationOccurred','971667JKvFZH','target','clearBtn','warn','input','Ошибка\x20сервера','Очистить\x20историю?','Telegram','message-bubble','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','debug_uid','show-delete'];a0_0x5537=function(){return _0x18d757;};return a0_0x5537();}if(clearBtn)clearBtn['onclick']=()=>{const _0x15b89a=a0_0xa77353;if(!messages[_0x15b89a(0x106)])return;if(mTitle)mTitle[_0x15b89a(0x128)]=_0x15b89a(0x133);if(mText)mText[_0x15b89a(0x128)]=_0x15b89a(0x110);modalCallback=async()=>{const _0x4bc656=_0x15b89a;messages=[],localStorage[_0x4bc656(0x111)](_0x4bc656(0x10c)),renderMessages(),callBackend(_0x4bc656(0x186),{});},modal[_0x15b89a(0x127)][_0x15b89a(0x14c)](_0x15b89a(0x108));};document[a0_0xa77353(0x161)](a0_0xa77353(0x113))[a0_0xa77353(0x172)]=()=>modal[a0_0xa77353(0x127)]['remove'](a0_0xa77353(0x108)),document[a0_0xa77353(0x161)]('modalConfirm')['onclick']=()=>{const _0x2a41fb=a0_0xa77353;if(modalCallback)modalCallback();modal[_0x2a41fb(0x127)][_0x2a41fb(0x10f)](_0x2a41fb(0x108));},messageInput[a0_0xa77353(0x148)](a0_0xa77353(0x131),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xa77353(0x148)](a0_0xa77353(0x139),_0x24857e=>{const _0x4bbb19=a0_0xa77353;_0x24857e[_0x4bbb19(0x125)]==='Enter'&&!_0x24857e[_0x4bbb19(0x168)]&&(_0x24857e[_0x4bbb19(0x152)](),sendMessage());}),sendBtn[a0_0xa77353(0x172)]=sendMessage,document[a0_0xa77353(0x148)](a0_0xa77353(0x16a),_0x2ac025=>{const _0x29ce6d=a0_0xa77353;document['querySelectorAll'](_0x29ce6d(0x179))[_0x29ce6d(0x16d)](_0x3e797d=>{const _0x4f8c14=_0x29ce6d;if(!_0x3e797d[_0x4f8c14(0x164)](_0x2ac025[_0x4f8c14(0x12e)]))_0x3e797d[_0x4f8c14(0x127)]['remove'](_0x4f8c14(0x138));});});const saved=localStorage[a0_0xa77353(0x173)](a0_0xa77353(0x10c));if(saved)try{messages=JSON[a0_0xa77353(0x123)](saved),renderMessages();}catch(a0_0x220638){}updateSendButton();