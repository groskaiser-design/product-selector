const a0_0x3c16c4=a0_0x43a0;(function(_0x451f4d,_0x186cb5){const _0x3e16e2=a0_0x43a0,_0x30e95d=_0x451f4d();while(!![]){try{const _0x437f0c=-parseInt(_0x3e16e2(0x75))/0x1*(-parseInt(_0x3e16e2(0xe0))/0x2)+-parseInt(_0x3e16e2(0xdd))/0x3*(parseInt(_0x3e16e2(0x94))/0x4)+parseInt(_0x3e16e2(0xde))/0x5+parseInt(_0x3e16e2(0xc2))/0x6*(-parseInt(_0x3e16e2(0x8b))/0x7)+-parseInt(_0x3e16e2(0x85))/0x8*(parseInt(_0x3e16e2(0x7f))/0x9)+-parseInt(_0x3e16e2(0x87))/0xa+parseInt(_0x3e16e2(0x74))/0xb*(parseInt(_0x3e16e2(0x95))/0xc);if(_0x437f0c===_0x186cb5)break;else _0x30e95d['push'](_0x30e95d['shift']());}catch(_0xeaab65){_0x30e95d['push'](_0x30e95d['shift']());}}}(a0_0x31a3,0xb89cb));const tg=window[a0_0x3c16c4(0xd8)]?.[a0_0x3c16c4(0x72)],HOME_URL=a0_0x3c16c4(0xd9);function setupTelegramBackButton(){const _0x31d9c3=a0_0x3c16c4;if(!tg)return;try{tg[_0x31d9c3(0x71)](),tg[_0x31d9c3(0x6b)](),tg[_0x31d9c3(0x78)]?.(_0x31d9c3(0xbf));if(tg[_0x31d9c3(0x90)]?.('6.1'))tg[_0x31d9c3(0xb2)]?.();const _0x11306a=tg['BackButton'];if(_0x11306a){_0x11306a['show']();if(typeof _0x11306a[_0x31d9c3(0xb6)]===_0x31d9c3(0x7d))try{_0x11306a[_0x31d9c3(0xb6)]();}catch(_0x103968){}_0x11306a['onClick'](()=>{const _0x5a4f1=_0x31d9c3;if(tg[_0x5a4f1(0xbd)])tg[_0x5a4f1(0xbd)]['impactOccurred'](_0x5a4f1(0x65));location['href']=HOME_URL;});}}catch(_0x58473a){console[_0x31d9c3(0x9e)](_0x31d9c3(0xc7),_0x58473a);}}(function initStableLayout(){const _0xda3f69=a0_0x3c16c4,_0x49884a=(function(){let _0x22980f=!![];return function(_0x554c69,_0x26297b){const _0x4d4948=_0x22980f?function(){const _0x18a899=a0_0x43a0;if(_0x26297b){const _0xd873fa=_0x26297b[_0x18a899(0xc1)](_0x554c69,arguments);return _0x26297b=null,_0xd873fa;}}:function(){};return _0x22980f=![],_0x4d4948;};}()),_0x24e6c7=document[_0xda3f69(0xa7)]('.container'),_0x9cf10a=document['getElementById'](_0xda3f69(0x73)),_0xccfec3=document[_0xda3f69(0xd1)]('chatArea'),_0x9de689=document[_0xda3f69(0xd1)](_0xda3f69(0xb9));function _0x5b2c01(){const _0x83b2a4=_0xda3f69,_0x1c0dcb=_0x49884a(this,function(){const _0x573519=a0_0x43a0;return _0x1c0dcb[_0x573519(0x67)]()[_0x573519(0x70)]('(((.+)+)+)+$')[_0x573519(0x67)]()[_0x573519(0x8d)](_0x1c0dcb)['search'](_0x573519(0x66));});_0x1c0dcb();if(!_0x24e6c7)return;const _0x164244=tg&&tg[_0x83b2a4(0xcb)]?tg[_0x83b2a4(0xcb)]:window[_0x83b2a4(0x89)];_0x24e6c7['style'][_0x83b2a4(0xab)]=_0x164244+'px';if(_0x9cf10a){const _0x4a057f=_0x9cf10a[_0x83b2a4(0xa0)];_0xccfec3[_0x83b2a4(0xd4)]['paddingBottom']=_0x4a057f+0x28+'px';}}tg?tg[_0xda3f69(0xc9)](_0xda3f69(0xa9),({isStateStable:_0x477a5f})=>{_0x5b2c01();if(_0x477a5f)requestAnimationFrame(()=>{const _0x57e74b=a0_0x43a0;_0xccfec3['scrollTop']=_0xccfec3[_0x57e74b(0x96)];});}):window[_0xda3f69(0xca)](_0xda3f69(0x83),_0x5b2c01),_0x5b2c01(),_0x9de689&&(_0x9de689[_0xda3f69(0xca)](_0xda3f69(0x79),()=>{requestAnimationFrame(_0x5b2c01);}),_0x9de689[_0xda3f69(0xca)]('focus',()=>{setTimeout(()=>{const _0x34e9ac=a0_0x43a0;_0xccfec3[_0x34e9ac(0x6d)]=_0xccfec3['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x3c16c4(0xd1)](a0_0x3c16c4(0xae)),emptyState=document[a0_0x3c16c4(0xd1)](a0_0x3c16c4(0xc0)),messageInput=document[a0_0x3c16c4(0xd1)](a0_0x3c16c4(0xb9)),sendBtn=document[a0_0x3c16c4(0xd1)]('sendBtn'),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0x3c16c4(0xd1)](a0_0x3c16c4(0x9f)),mTitle=document[a0_0x3c16c4(0xd1)]('modalTitle'),mText=document[a0_0x3c16c4(0xd1)]('modalText');let modalCallback=null;async function callBackend(_0x193f02,_0x5a2c3a){const _0x222908=a0_0x3c16c4,_0x130058=tg?.['initDataUnsafe']?.[_0x222908(0xcd)]||{},_0x5b5b93=_0x130058['id']||localStorage[_0x222908(0x68)](_0x222908(0xb8))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x130058['id'])localStorage[_0x222908(0xba)](_0x222908(0xb8),_0x5b5b93);const _0x4cd27a={'action':_0x193f02,'user_id':_0x5b5b93,'user_data':{'first_name':_0x130058['first_name'],'username':_0x130058[_0x222908(0xd7)]},'init_data':tg?.[_0x222908(0xb0)]||'',..._0x5a2c3a},_0x4cf598=new AbortController(),_0x592364=setTimeout(()=>_0x4cf598[_0x222908(0x8e)](),REQUEST_TIMEOUT_MS);try{const _0x1bee24=await fetch(BACKEND_URL,{'method':_0x222908(0x8f),'headers':{'Content-Type':_0x222908(0xd2)},'body':JSON[_0x222908(0x6c)](_0x4cd27a),'signal':_0x4cf598[_0x222908(0xda)]});return clearTimeout(_0x592364),await _0x1bee24[_0x222908(0xbb)]();}catch(_0x51da25){return{'success':![],'error':String(_0x51da25)};}}function formatTime(_0x294011){const _0x516bce=a0_0x3c16c4,_0x3b54ab=new Date(_0x294011);return String(_0x3b54ab[_0x516bce(0x7c)]())['padStart'](0x2,'0')+':'+String(_0x3b54ab[_0x516bce(0x6f)]())[_0x516bce(0x99)](0x2,'0');}function createMessageElement(_0x3a7096,_0x4f9604){const _0x1e0e47=a0_0x3c16c4,_0x33566b=document['createElement'](_0x1e0e47(0xaa));_0x33566b[_0x1e0e47(0xd3)]=_0x1e0e47(0x9d)+_0x3a7096[_0x1e0e47(0xa5)];const _0x2ab835=document['createElement'](_0x1e0e47(0xaa));_0x2ab835[_0x1e0e47(0xd3)]='message-bubble',_0x2ab835['innerHTML']=_0x3a7096[_0x1e0e47(0xdf)][_0x1e0e47(0x8a)](/\n/g,_0x1e0e47(0x92));const _0x30d261=document[_0x1e0e47(0xd5)]('div');_0x30d261['className']='delete-btn',_0x30d261[_0x1e0e47(0xa3)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x30d261[_0x1e0e47(0xaf)]=_0x307f4d=>{_0x307f4d['stopPropagation'](),confirmDelete(_0x4f9604);};let _0x3036e7;_0x2ab835[_0x1e0e47(0xca)](_0x1e0e47(0xd0),()=>_0x3036e7=setTimeout(()=>{const _0x2fb1fd=_0x1e0e47;_0x33566b['classList'][_0x2fb1fd(0xa1)](_0x2fb1fd(0xbc));if(tg?.[_0x2fb1fd(0xbd)])tg[_0x2fb1fd(0xbd)][_0x2fb1fd(0xac)](_0x2fb1fd(0x9b));},0x1f4)),_0x2ab835[_0x1e0e47(0xca)](_0x1e0e47(0x80),()=>clearTimeout(_0x3036e7));const _0x5c9674=document[_0x1e0e47(0xd5)](_0x1e0e47(0xaa));return _0x5c9674[_0x1e0e47(0xd3)]=_0x1e0e47(0x76),_0x5c9674['textContent']=formatTime(_0x3a7096['timestamp']),_0x33566b[_0x1e0e47(0xa4)](_0x30d261),_0x33566b[_0x1e0e47(0xa4)](_0x2ab835),_0x33566b[_0x1e0e47(0xa4)](_0x5c9674),_0x33566b;}function a0_0x31a3(){const _0x1b9fe0=['min','parse','touchstart','getElementById','text/plain','className','style','createElement','querySelectorAll','username','Telegram','./router.html','signal','length','disabled','3269397niAgJY','690655FDDTpm','content','700714yyOckw','contains','removeItem','light','(((.+)+)+)+$','toString','getItem','from','Начнется\x20новый\x20диалог.','expand','stringify','scrollTop','auto','getMinutes','search','ready','WebApp','inputArea','6677836XSiIsv','3EyGWAW','message-time','Удалить?','setHeaderColor','input','ai_chat_messages','flex','getHours','function','.message.show-delete','801dhTAIV','touchend','notificationOccurred','text','resize','splice','83896ijaock','Действие\x20необратимо.','1560360ZDWBqV','modalConfirm','innerHeight','replace','35903YVVKqP','success','constructor','abort','POST','isVersionAtLeast','typingIndicator','<br>','Очистить\x20историю?','4QtMjfb','48VuoWaB','scrollHeight','now','value','padStart','textContent','medium','remove','message\x20','warn','confirmModal','offsetHeight','add','keydown','innerHTML','appendChild','role','clear_history','querySelector','children','viewportChanged','div','height','impactOccurred','trim','chatArea','onclick','initData','forEach','disableVerticalSwipes','classList','display','show','offClick','shiftKey','debug_uid','messageInput','setItem','json','show-delete','HapticFeedback','click','#050505','emptyState','apply','798jQMMOG','Ошибка\x20сервера','send_message','error','modalCancel','TG\x20setup\x20error:','push','onEvent','addEventListener','viewportHeight','preventDefault','user'];a0_0x31a3=function(){return _0x1b9fe0;};return a0_0x31a3();}function a0_0x43a0(_0x43de74,_0x44f779){_0x43de74=_0x43de74-0x65;const _0x2647f4=a0_0x31a3();let _0x18c859=_0x2647f4[_0x43de74];return _0x18c859;}function createTypingIndicator(){const _0xce85aa=a0_0x3c16c4,_0x5517fb=document['createElement'](_0xce85aa(0xaa));return _0x5517fb[_0xce85aa(0xd3)]='message\x20ai',_0x5517fb['id']='typingIndicator',_0x5517fb[_0xce85aa(0xa3)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x5517fb;}function renderMessages(){const _0x322466=a0_0x3c16c4;Array[_0x322466(0x69)](chatArea[_0x322466(0xa8)])[_0x322466(0xb1)](_0x4fa46d=>{const _0x545c3f=_0x322466;if(_0x4fa46d['id']!=='emptyState')_0x4fa46d[_0x545c3f(0x9c)]();}),messages[_0x322466(0xdb)]>0x0?(emptyState['style'][_0x322466(0xb4)]='none',messages[_0x322466(0xb1)]((_0x487080,_0x27fdf5)=>chatArea[_0x322466(0xa4)](createMessageElement(_0x487080,_0x27fdf5)))):emptyState[_0x322466(0xd4)]['display']=_0x322466(0x7b),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x322466(0x96)]);}function autoResizeTextarea(){const _0x26a3b3=a0_0x3c16c4;messageInput[_0x26a3b3(0xd4)][_0x26a3b3(0xab)]=_0x26a3b3(0x6e),messageInput['style'][_0x26a3b3(0xab)]=Math[_0x26a3b3(0xce)](messageInput[_0x26a3b3(0x96)],0x78)+'px';}function updateSendButton(){const _0x170bca=a0_0x3c16c4,_0x4a8dc1=messageInput['value'][_0x170bca(0xad)]();sendBtn[_0x170bca(0xdc)]=!_0x4a8dc1||isTyping;}async function sendMessage(){const _0x2cd8cb=a0_0x3c16c4,_0x379459=messageInput[_0x2cd8cb(0x98)][_0x2cd8cb(0xad)]();if(!_0x379459||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2cd8cb(0xbd)][_0x2cd8cb(0xac)](_0x2cd8cb(0x65));messages[_0x2cd8cb(0xc8)]({'role':_0x2cd8cb(0xcd),'content':_0x379459,'timestamp':Date[_0x2cd8cb(0x97)]()}),localStorage[_0x2cd8cb(0xba)](_0x2cd8cb(0x7a),JSON[_0x2cd8cb(0x6c)](messages)),renderMessages(),messageInput[_0x2cd8cb(0x98)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x2cd8cb(0x6d)]=chatArea[_0x2cd8cb(0x96)];const _0x4a8921=await callBackend(_0x2cd8cb(0xc4),{'message':_0x379459});isTyping=![];const _0x36724a=document[_0x2cd8cb(0xd1)](_0x2cd8cb(0x91));if(_0x36724a)_0x36724a[_0x2cd8cb(0x9c)]();let _0x1aa233='Ошибка\x20сети';if(_0x4a8921[_0x2cd8cb(0x8c)]){_0x1aa233=_0x4a8921[_0x2cd8cb(0x82)]||'Пустой\x20ответ';if(tg?.[_0x2cd8cb(0xbd)])tg[_0x2cd8cb(0xbd)][_0x2cd8cb(0x81)](_0x2cd8cb(0x8c));}else{_0x1aa233=_0x4a8921[_0x2cd8cb(0xc5)]||_0x2cd8cb(0xc3);if(tg?.[_0x2cd8cb(0xbd)])tg[_0x2cd8cb(0xbd)][_0x2cd8cb(0x81)](_0x2cd8cb(0xc5));}messages['push']({'role':'ai','content':_0x1aa233,'timestamp':Date[_0x2cd8cb(0x97)]()}),localStorage['setItem'](_0x2cd8cb(0x7a),JSON[_0x2cd8cb(0x6c)](messages)),renderMessages();}function confirmDelete(_0x4d2c3d){const _0x9baa1f=a0_0x3c16c4;if(mTitle)mTitle[_0x9baa1f(0x9a)]=_0x9baa1f(0x77);if(mText)mText[_0x9baa1f(0x9a)]=_0x9baa1f(0x86);modalCallback=()=>{const _0x27abec=_0x9baa1f;messages[_0x27abec(0x84)](_0x4d2c3d,0x1),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x9baa1f(0xb3)][_0x9baa1f(0xa1)](_0x9baa1f(0xb5));}if(clearBtn)clearBtn[a0_0x3c16c4(0xaf)]=()=>{const _0x3f7e8e=a0_0x3c16c4;if(!messages[_0x3f7e8e(0xdb)])return;if(mTitle)mTitle[_0x3f7e8e(0x9a)]=_0x3f7e8e(0x93);if(mText)mText[_0x3f7e8e(0x9a)]=_0x3f7e8e(0x6a);modalCallback=async()=>{const _0x5d6a8a=_0x3f7e8e;messages=[],localStorage[_0x5d6a8a(0xe2)](_0x5d6a8a(0x7a)),renderMessages(),callBackend(_0x5d6a8a(0xa6),{});},modal[_0x3f7e8e(0xb3)][_0x3f7e8e(0xa1)]('show');};document[a0_0x3c16c4(0xd1)](a0_0x3c16c4(0xc6))[a0_0x3c16c4(0xaf)]=()=>modal[a0_0x3c16c4(0xb3)]['remove'](a0_0x3c16c4(0xb5)),document[a0_0x3c16c4(0xd1)](a0_0x3c16c4(0x88))['onclick']=()=>{const _0x1ada0e=a0_0x3c16c4;if(modalCallback)modalCallback();modal[_0x1ada0e(0xb3)][_0x1ada0e(0x9c)](_0x1ada0e(0xb5));},messageInput[a0_0x3c16c4(0xca)](a0_0x3c16c4(0x79),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3c16c4(0xca)](a0_0x3c16c4(0xa2),_0xa8b515=>{const _0x5cd3f4=a0_0x3c16c4;_0xa8b515['key']==='Enter'&&!_0xa8b515[_0x5cd3f4(0xb7)]&&(_0xa8b515[_0x5cd3f4(0xcc)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x3c16c4(0xbe),_0xf44acb=>{const _0x22b708=a0_0x3c16c4;document[_0x22b708(0xd6)](_0x22b708(0x7e))['forEach'](_0x2d771d=>{const _0x480d78=_0x22b708;if(!_0x2d771d[_0x480d78(0xe1)](_0xf44acb['target']))_0x2d771d[_0x480d78(0xb3)]['remove'](_0x480d78(0xbc));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x3c16c4(0xcf)](saved),renderMessages();}catch(a0_0xe6e684){}updateSendButton();