const a0_0x4a297c=a0_0x1dcf;(function(_0x786869,_0x4a44c7){const _0x668295=a0_0x1dcf,_0x3a608c=_0x786869();while(!![]){try{const _0x3da0ab=parseInt(_0x668295(0x1b0))/0x1*(parseInt(_0x668295(0x1d6))/0x2)+parseInt(_0x668295(0x20d))/0x3+-parseInt(_0x668295(0x1ca))/0x4*(-parseInt(_0x668295(0x209))/0x5)+-parseInt(_0x668295(0x217))/0x6+parseInt(_0x668295(0x1dd))/0x7+-parseInt(_0x668295(0x21e))/0x8*(-parseInt(_0x668295(0x1e9))/0x9)+-parseInt(_0x668295(0x1c3))/0xa;if(_0x3da0ab===_0x4a44c7)break;else _0x3a608c['push'](_0x3a608c['shift']());}catch(_0x1d9c8d){_0x3a608c['push'](_0x3a608c['shift']());}}}(a0_0x42ea,0x489ee));const tg=window[a0_0x4a297c(0x1fa)]?.[a0_0x4a297c(0x220)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x17e0bf=a0_0x4a297c;if(!tg)return;try{tg[_0x17e0bf(0x1c9)](),tg[_0x17e0bf(0x1cf)](),tg[_0x17e0bf(0x1c8)]?.(_0x17e0bf(0x1b3));if(tg[_0x17e0bf(0x1c7)]?.(_0x17e0bf(0x21f)))tg[_0x17e0bf(0x1e6)]?.();const _0x5d34d1=tg[_0x17e0bf(0x1df)];if(_0x5d34d1){_0x5d34d1[_0x17e0bf(0x1ea)]();if(typeof _0x5d34d1[_0x17e0bf(0x1e5)]===_0x17e0bf(0x20a))try{_0x5d34d1[_0x17e0bf(0x1e5)]();}catch(_0x2d4528){}_0x5d34d1[_0x17e0bf(0x212)](()=>{const _0xfb9535=_0x17e0bf;if(tg[_0xfb9535(0x1f0)])tg['HapticFeedback'][_0xfb9535(0x1a6)](_0xfb9535(0x1e3));location['href']=HOME_URL;});}}catch(_0x2027bd){console['warn'](_0x17e0bf(0x1e0),_0x2027bd);}}(function initStableLayout(){const _0x34483a=a0_0x4a297c,_0x5af5c5=(function(){let _0x4869c7=!![];return function(_0x41ca94,_0x2b9f5b){const _0x20caef=_0x4869c7?function(){const _0x152040=a0_0x1dcf;if(_0x2b9f5b){const _0x1a4fd5=_0x2b9f5b[_0x152040(0x1ef)](_0x41ca94,arguments);return _0x2b9f5b=null,_0x1a4fd5;}}:function(){};return _0x4869c7=![],_0x20caef;};}()),_0x538947=document[_0x34483a(0x1e4)](_0x34483a(0x1ae)),_0x31724b=document[_0x34483a(0x201)](_0x34483a(0x1ee)),_0x2f2ecd=document[_0x34483a(0x201)]('chatArea'),_0x58947c=document[_0x34483a(0x201)]('messageInput');function _0x40251e(){const _0x1edb81=_0x34483a,_0x2168b3=_0x5af5c5(this,function(){const _0x443a74=a0_0x1dcf;return _0x2168b3['toString']()[_0x443a74(0x1ab)](_0x443a74(0x1d3))[_0x443a74(0x1f2)]()[_0x443a74(0x1e8)](_0x2168b3)[_0x443a74(0x1ab)]('(((.+)+)+)+$');});_0x2168b3();if(!_0x538947)return;const _0x338b2b=tg&&tg['viewportHeight']?tg[_0x1edb81(0x1f5)]:window[_0x1edb81(0x1aa)];_0x538947[_0x1edb81(0x1d0)][_0x1edb81(0x1e7)]=_0x338b2b+'px';if(_0x31724b){const _0x39787e=_0x31724b[_0x1edb81(0x1ff)];_0x2f2ecd['style']['paddingBottom']=_0x39787e+0x28+'px';}}tg?tg[_0x34483a(0x21b)](_0x34483a(0x1cc),({isStateStable:_0x2fc8b7})=>{_0x40251e();if(_0x2fc8b7)requestAnimationFrame(()=>{const _0x14ed60=a0_0x1dcf;_0x2f2ecd[_0x14ed60(0x1e2)]=_0x2f2ecd[_0x14ed60(0x1ec)];});}):window[_0x34483a(0x1a7)]('resize',_0x40251e),_0x40251e(),_0x58947c&&(_0x58947c[_0x34483a(0x1a7)]('input',()=>{requestAnimationFrame(_0x40251e);}),_0x58947c[_0x34483a(0x1a7)](_0x34483a(0x1b6),()=>{setTimeout(()=>{const _0x511e83=a0_0x1dcf;_0x2f2ecd['scrollTop']=_0x2f2ecd[_0x511e83(0x1ec)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4a297c(0x1bc),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x4a297c(0x1a8)),emptyState=document[a0_0x4a297c(0x201)]('emptyState'),messageInput=document[a0_0x4a297c(0x201)](a0_0x4a297c(0x1d7)),sendBtn=document[a0_0x4a297c(0x201)](a0_0x4a297c(0x1ba)),clearBtn=document['getElementById'](a0_0x4a297c(0x1de)),modal=document[a0_0x4a297c(0x201)](a0_0x4a297c(0x223)),mTitle=document[a0_0x4a297c(0x201)](a0_0x4a297c(0x1a0)),mText=document[a0_0x4a297c(0x201)](a0_0x4a297c(0x226));let modalCallback=null;async function callBackend(_0x3be075,_0x441034){const _0xbec3b7=a0_0x4a297c,_0x37ddbe=tg?.[_0xbec3b7(0x1a2)]?.[_0xbec3b7(0x1c1)]||{},_0x4ed513=_0x37ddbe['id']||localStorage['getItem'](_0xbec3b7(0x1cd))||'d-'+Math[_0xbec3b7(0x1c4)](Math[_0xbec3b7(0x227)]()*0x3b9aca00);if(!_0x37ddbe['id'])localStorage['setItem'](_0xbec3b7(0x1cd),_0x4ed513);const _0x121e7d={'action':_0x3be075,'user_id':_0x4ed513,'user_data':{'first_name':_0x37ddbe['first_name'],'username':_0x37ddbe[_0xbec3b7(0x211)]},'init_data':tg?.[_0xbec3b7(0x216)]||'',..._0x441034},_0x536808=new AbortController(),_0x3a19cd=setTimeout(()=>_0x536808[_0xbec3b7(0x1b2)](),REQUEST_TIMEOUT_MS);try{const _0xe2e455=await fetch(BACKEND_URL,{'method':_0xbec3b7(0x200),'headers':{'Content-Type':'text/plain'},'body':JSON[_0xbec3b7(0x1bd)](_0x121e7d),'signal':_0x536808[_0xbec3b7(0x1c2)]});return clearTimeout(_0x3a19cd),await _0xe2e455[_0xbec3b7(0x1ce)]();}catch(_0x3e75ad){return{'success':![],'error':String(_0x3e75ad)};}}function a0_0x1dcf(_0x8b5248,_0x201787){_0x8b5248=_0x8b5248-0x1a0;const _0x123006=a0_0x42ea();let _0x3ec9c7=_0x123006[_0x8b5248];return _0x3ec9c7;}function formatTime(_0x3fcfb7){const _0x479417=a0_0x4a297c,_0x37c001=new Date(_0x3fcfb7);return String(_0x37c001[_0x479417(0x218)]())[_0x479417(0x222)](0x2,'0')+':'+String(_0x37c001[_0x479417(0x1f9)]())[_0x479417(0x222)](0x2,'0');}function createMessageElement(_0xb0c8ae,_0x28db2a){const _0x505ec1=a0_0x4a297c,_0x3ee123=document[_0x505ec1(0x1fd)](_0x505ec1(0x203));_0x3ee123[_0x505ec1(0x213)]=_0x505ec1(0x207)+_0xb0c8ae[_0x505ec1(0x1d9)];const _0x5c0cc8=document[_0x505ec1(0x1fd)](_0x505ec1(0x203));_0x5c0cc8[_0x505ec1(0x213)]=_0x505ec1(0x1cb),_0x5c0cc8[_0x505ec1(0x1bf)]=_0xb0c8ae[_0x505ec1(0x1a1)][_0x505ec1(0x1d8)](/\n/g,_0x505ec1(0x1d1));const _0x43df2b=document[_0x505ec1(0x1fd)]('div');_0x43df2b['className']=_0x505ec1(0x1c0),_0x43df2b[_0x505ec1(0x1bf)]=_0x505ec1(0x1c6),_0x43df2b[_0x505ec1(0x1b9)]=_0x9a9751=>{const _0x6addd9=_0x505ec1;_0x9a9751[_0x6addd9(0x1b1)](),confirmDelete(_0x28db2a);};let _0x3e0172;_0x5c0cc8[_0x505ec1(0x1a7)](_0x505ec1(0x1fb),()=>_0x3e0172=setTimeout(()=>{const _0x321c7a=_0x505ec1;_0x3ee123[_0x321c7a(0x202)][_0x321c7a(0x1f7)](_0x321c7a(0x1eb));if(tg?.[_0x321c7a(0x1f0)])tg[_0x321c7a(0x1f0)][_0x321c7a(0x1a6)](_0x321c7a(0x20f));},0x1f4)),_0x5c0cc8['addEventListener'](_0x505ec1(0x215),()=>clearTimeout(_0x3e0172));const _0x4b8421=document[_0x505ec1(0x1fd)]('div');return _0x4b8421[_0x505ec1(0x213)]=_0x505ec1(0x1d2),_0x4b8421[_0x505ec1(0x21d)]=formatTime(_0xb0c8ae[_0x505ec1(0x1fc)]),_0x3ee123[_0x505ec1(0x1f8)](_0x43df2b),_0x3ee123[_0x505ec1(0x1f8)](_0x5c0cc8),_0x3ee123['appendChild'](_0x4b8421),_0x3ee123;}function createTypingIndicator(){const _0x236760=a0_0x4a297c,_0x4090af=document[_0x236760(0x1fd)]('div');return _0x4090af['className']=_0x236760(0x1a4),_0x4090af['id']='typingIndicator',_0x4090af[_0x236760(0x1bf)]=_0x236760(0x1b8),_0x4090af;}function renderMessages(){const _0x427314=a0_0x4a297c;Array[_0x427314(0x1a5)](chatArea['children'])[_0x427314(0x1f1)](_0x361462=>{const _0x288406=_0x427314;if(_0x361462['id']!==_0x288406(0x1db))_0x361462[_0x288406(0x1a9)]();}),messages[_0x427314(0x1f3)]>0x0?(emptyState[_0x427314(0x1d0)][_0x427314(0x206)]='none',messages[_0x427314(0x1f1)]((_0x2317ce,_0x27e7da)=>chatArea[_0x427314(0x1f8)](createMessageElement(_0x2317ce,_0x27e7da)))):emptyState['style']['display']=_0x427314(0x1af),requestAnimationFrame(()=>chatArea[_0x427314(0x1e2)]=chatArea[_0x427314(0x1ec)]);}function autoResizeTextarea(){const _0xdbd9e0=a0_0x4a297c;messageInput[_0xdbd9e0(0x1d0)][_0xdbd9e0(0x1e7)]=_0xdbd9e0(0x214),messageInput[_0xdbd9e0(0x1d0)]['height']=Math[_0xdbd9e0(0x219)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x22d423=a0_0x4a297c,_0x44d5d3=messageInput[_0x22d423(0x1be)][_0x22d423(0x1da)]();sendBtn[_0x22d423(0x1c5)]=!_0x44d5d3||isTyping;}async function sendMessage(){const _0x264027=a0_0x4a297c,_0x4cd971=messageInput['value'][_0x264027(0x1da)]();if(!_0x4cd971||isTyping)return;if(tg?.[_0x264027(0x1f0)])tg[_0x264027(0x1f0)][_0x264027(0x1a6)](_0x264027(0x1e3));messages[_0x264027(0x1f6)]({'role':_0x264027(0x1c1),'content':_0x4cd971,'timestamp':Date[_0x264027(0x1f4)]()}),localStorage[_0x264027(0x1ad)](_0x264027(0x1d4),JSON[_0x264027(0x1bd)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x264027(0x1f8)](createTypingIndicator()),chatArea[_0x264027(0x1e2)]=chatArea[_0x264027(0x1ec)];const _0x4183fb=await callBackend(_0x264027(0x20e),{'message':_0x4cd971});isTyping=![];const _0x558ca2=document[_0x264027(0x201)](_0x264027(0x1dc));if(_0x558ca2)_0x558ca2['remove']();let _0x243cd7=_0x264027(0x1fe);if(_0x4183fb[_0x264027(0x204)]){_0x243cd7=_0x4183fb[_0x264027(0x1b4)]||_0x264027(0x1d5);if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred'](_0x264027(0x204));}else{_0x243cd7=_0x4183fb[_0x264027(0x205)]||_0x264027(0x20b);if(tg?.[_0x264027(0x1f0)])tg[_0x264027(0x1f0)][_0x264027(0x1b5)]('error');}messages[_0x264027(0x1f6)]({'role':'ai','content':_0x243cd7,'timestamp':Date['now']()}),localStorage['setItem'](_0x264027(0x1d4),JSON[_0x264027(0x1bd)](messages)),renderMessages();}function confirmDelete(_0x181409){const _0x4243d1=a0_0x4a297c;if(mTitle)mTitle[_0x4243d1(0x21d)]=_0x4243d1(0x1bb);if(mText)mText[_0x4243d1(0x21d)]='Действие\x20необратимо.';modalCallback=()=>{const _0x14c695=_0x4243d1;messages[_0x14c695(0x1b7)](_0x181409,0x1),localStorage[_0x14c695(0x1ad)](_0x14c695(0x1d4),JSON['stringify'](messages)),renderMessages();},modal[_0x4243d1(0x202)]['add'](_0x4243d1(0x1ea));}if(clearBtn)clearBtn[a0_0x4a297c(0x1b9)]=()=>{const _0x1815b5=a0_0x4a297c;if(!messages['length'])return;if(mTitle)mTitle[_0x1815b5(0x21d)]=_0x1815b5(0x208);if(mText)mText[_0x1815b5(0x21d)]=_0x1815b5(0x221);modalCallback=async()=>{const _0x3c4a75=_0x1815b5;messages=[],localStorage[_0x3c4a75(0x225)](_0x3c4a75(0x1d4)),renderMessages(),callBackend('clear_history',{});},modal[_0x1815b5(0x202)][_0x1815b5(0x1f7)](_0x1815b5(0x1ea));};function a0_0x42ea(){const _0x1074ce=['username','onClick','className','auto','touchend','initData','2374524GTypDa','getHours','min','parse','onEvent','click','textContent','8rVQzHh','6.1','WebApp','Начнется\x20новый\x20диалог.','padStart','confirmModal','getItem','removeItem','modalText','random','modalTitle','content','initDataUnsafe','preventDefault','message\x20ai','from','impactOccurred','addEventListener','chatArea','remove','innerHeight','search','contains','setItem','.container','flex','3YkBsEP','stopPropagation','abort','#050505','text','notificationOccurred','focus','splice','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','onclick','sendBtn','Удалить?','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','stringify','value','innerHTML','delete-btn','user','signal','11694290yivTVA','floor','disabled','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','isVersionAtLeast','setHeaderColor','ready','13448ALAdKj','message-bubble','viewportChanged','debug_uid','json','expand','style','<br>','message-time','(((.+)+)+)+$','ai_chat_messages','Пустой\x20ответ','334042ctsauk','messageInput','replace','role','trim','emptyState','typingIndicator','684236NGmxdQ','clearBtn','BackButton','TG\x20setup\x20error:','querySelectorAll','scrollTop','light','querySelector','offClick','disableVerticalSwipes','height','constructor','4643901ZRjEgN','show','show-delete','scrollHeight','target','inputArea','apply','HapticFeedback','forEach','toString','length','now','viewportHeight','push','add','appendChild','getMinutes','Telegram','touchstart','timestamp','createElement','Ошибка\x20сети','offsetHeight','POST','getElementById','classList','div','success','error','display','message\x20','Очистить\x20историю?','255TCzhvC','function','Ошибка\x20сервера','modalConfirm','1729125hsKUfS','send_message','medium','.message.show-delete'];a0_0x42ea=function(){return _0x1074ce;};return a0_0x42ea();}document[a0_0x4a297c(0x201)]('modalCancel')[a0_0x4a297c(0x1b9)]=()=>modal[a0_0x4a297c(0x202)][a0_0x4a297c(0x1a9)](a0_0x4a297c(0x1ea)),document['getElementById'](a0_0x4a297c(0x20c))[a0_0x4a297c(0x1b9)]=()=>{const _0x44df80=a0_0x4a297c;if(modalCallback)modalCallback();modal[_0x44df80(0x202)][_0x44df80(0x1a9)]('show');},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x143a04=>{const _0x4574aa=a0_0x4a297c;_0x143a04['key']==='Enter'&&!_0x143a04['shiftKey']&&(_0x143a04[_0x4574aa(0x1a3)](),sendMessage());}),sendBtn[a0_0x4a297c(0x1b9)]=sendMessage,document['addEventListener'](a0_0x4a297c(0x21c),_0x5e4e66=>{const _0x4bd1b6=a0_0x4a297c;document[_0x4bd1b6(0x1e1)](_0x4bd1b6(0x210))['forEach'](_0x566f1c=>{const _0x4b05a4=_0x4bd1b6;if(!_0x566f1c[_0x4b05a4(0x1ac)](_0x5e4e66[_0x4b05a4(0x1ed)]))_0x566f1c[_0x4b05a4(0x202)][_0x4b05a4(0x1a9)]('show-delete');});});const saved=localStorage[a0_0x4a297c(0x224)](a0_0x4a297c(0x1d4));if(saved)try{messages=JSON[a0_0x4a297c(0x21a)](saved),renderMessages();}catch(a0_0x5418c3){}updateSendButton();