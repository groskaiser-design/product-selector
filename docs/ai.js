const a0_0x5d2a42=a0_0x3a97;(function(_0x40472d,_0x57a479){const _0x59f326=a0_0x3a97,_0x31fb3f=_0x40472d();while(!![]){try{const _0x4ed227=-parseInt(_0x59f326(0x1b8))/0x1+parseInt(_0x59f326(0x1f2))/0x2+-parseInt(_0x59f326(0x1e3))/0x3+parseInt(_0x59f326(0x1ff))/0x4+-parseInt(_0x59f326(0x1ef))/0x5*(-parseInt(_0x59f326(0x1e2))/0x6)+parseInt(_0x59f326(0x22c))/0x7*(-parseInt(_0x59f326(0x211))/0x8)+parseInt(_0x59f326(0x205))/0x9*(parseInt(_0x59f326(0x228))/0xa);if(_0x4ed227===_0x57a479)break;else _0x31fb3f['push'](_0x31fb3f['shift']());}catch(_0xfa05){_0x31fb3f['push'](_0x31fb3f['shift']());}}}(a0_0x18a6,0x95da8));const tg=window[a0_0x5d2a42(0x1c7)]?.[a0_0x5d2a42(0x1e7)],HOME_URL=a0_0x5d2a42(0x208);function setupTelegramBackButton(){const _0xd7b146=a0_0x5d2a42,_0x388e62=(function(){let _0x413865=!![];return function(_0x5653bd,_0x4e5c99){const _0xdbd85f=_0x413865?function(){const _0x58940d=a0_0x3a97;if(_0x4e5c99){const _0x30f598=_0x4e5c99[_0x58940d(0x20d)](_0x5653bd,arguments);return _0x4e5c99=null,_0x30f598;}}:function(){};return _0x413865=![],_0xdbd85f;};}()),_0x8f88a0=_0x388e62(this,function(){const _0x541300=a0_0x3a97;return _0x8f88a0[_0x541300(0x219)]()[_0x541300(0x1f3)](_0x541300(0x1df))[_0x541300(0x219)]()['constructor'](_0x8f88a0)[_0x541300(0x1f3)](_0x541300(0x1df));});_0x8f88a0();if(!tg)return;try{tg[_0xd7b146(0x1bf)](),tg['expand'](),tg[_0xd7b146(0x1c2)]?.(_0xd7b146(0x1e0));if(tg[_0xd7b146(0x1b4)]?.(_0xd7b146(0x20e)))tg[_0xd7b146(0x22a)]?.();const _0x205de3=tg[_0xd7b146(0x1f6)];if(_0x205de3){_0x205de3['show']();if(typeof _0x205de3[_0xd7b146(0x1f0)]===_0xd7b146(0x20f))try{_0x205de3['offClick']();}catch(_0x3f4042){}_0x205de3[_0xd7b146(0x1cf)](()=>{const _0x15632c=_0xd7b146;if(tg[_0x15632c(0x20c)])tg[_0x15632c(0x20c)][_0x15632c(0x1b5)](_0x15632c(0x229));location[_0x15632c(0x1ee)]=HOME_URL;});}}catch(_0x164541){console[_0xd7b146(0x204)](_0xd7b146(0x215),_0x164541);}}(function initStableLayout(){const _0x421db5=a0_0x5d2a42,_0x2d3837=document['querySelector']('.container'),_0x4bca5b=document[_0x421db5(0x1bb)](_0x421db5(0x1c8)),_0x2bd5e3=document[_0x421db5(0x1bb)]('chatArea'),_0x374da8=document['getElementById'](_0x421db5(0x1c4));function _0x3d3adf(){const _0x42b5d6=_0x421db5;if(!_0x2d3837)return;const _0x329a2b=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x42b5d6(0x1e1)];_0x2d3837[_0x42b5d6(0x21c)]['height']=_0x329a2b+'px';if(_0x4bca5b){const _0x39e09f=_0x4bca5b[_0x42b5d6(0x207)];_0x2bd5e3[_0x42b5d6(0x21c)][_0x42b5d6(0x1f9)]=_0x39e09f+0x28+'px';}}tg?tg[_0x421db5(0x1cd)](_0x421db5(0x217),({isStateStable:_0x4c0f64})=>{_0x3d3adf();if(_0x4c0f64)requestAnimationFrame(()=>{const _0x77bec8=a0_0x3a97;_0x2bd5e3['scrollTop']=_0x2bd5e3[_0x77bec8(0x1ca)];});}):window[_0x421db5(0x1e8)]('resize',_0x3d3adf),_0x3d3adf(),_0x374da8&&(_0x374da8[_0x421db5(0x1e8)]('input',()=>{requestAnimationFrame(_0x3d3adf);}),_0x374da8['addEventListener'](_0x421db5(0x1d0),()=>{setTimeout(()=>{const _0x546154=a0_0x3a97;_0x2bd5e3[_0x546154(0x206)]=_0x2bd5e3[_0x546154(0x1ca)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x5d2a42(0x1ce),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x3a97(_0xd9da27,_0x227372){_0xd9da27=_0xd9da27-0x1b3;const _0x5d7a65=a0_0x18a6();let _0x2ddd63=_0x5d7a65[_0xd9da27];return _0x2ddd63;}let messages=[],isTyping=![];const chatArea=document[a0_0x5d2a42(0x1bb)]('chatArea'),emptyState=document[a0_0x5d2a42(0x1bb)](a0_0x5d2a42(0x1b9)),messageInput=document[a0_0x5d2a42(0x1bb)](a0_0x5d2a42(0x1c4)),sendBtn=document[a0_0x5d2a42(0x1bb)](a0_0x5d2a42(0x1fd)),clearBtn=document[a0_0x5d2a42(0x1bb)](a0_0x5d2a42(0x1e6)),modal=document[a0_0x5d2a42(0x1bb)]('confirmModal'),mTitle=document[a0_0x5d2a42(0x1bb)](a0_0x5d2a42(0x1fb)),mText=document[a0_0x5d2a42(0x1bb)](a0_0x5d2a42(0x1d2));let modalCallback=null;async function callBackend(_0x3881d0,_0x4401fe){const _0x28c3e6=a0_0x5d2a42,_0x80a339=tg?.[_0x28c3e6(0x218)]?.['user']||{},_0x1ba822=_0x80a339['id']||localStorage[_0x28c3e6(0x1b7)](_0x28c3e6(0x1c3))||'d-'+Math[_0x28c3e6(0x1fa)](Math[_0x28c3e6(0x1fc)]()*0x3b9aca00);if(!_0x80a339['id'])localStorage[_0x28c3e6(0x21e)](_0x28c3e6(0x1c3),_0x1ba822);const _0x5e546b={'action':_0x3881d0,'user_id':_0x1ba822,'user_data':{'first_name':_0x80a339['first_name'],'username':_0x80a339[_0x28c3e6(0x200)]},'init_data':tg?.[_0x28c3e6(0x1c0)]||'',..._0x4401fe},_0x4d1780=new AbortController(),_0x16bcdf=setTimeout(()=>_0x4d1780[_0x28c3e6(0x1ba)](),REQUEST_TIMEOUT_MS);try{const _0xfc976=await fetch(BACKEND_URL,{'method':_0x28c3e6(0x1de),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x28c3e6(0x1c9)](_0x5e546b),'signal':_0x4d1780[_0x28c3e6(0x1ed)]});return clearTimeout(_0x16bcdf),await _0xfc976[_0x28c3e6(0x1d4)]();}catch(_0x872e57){return{'success':![],'error':String(_0x872e57)};}}function formatTime(_0x40135e){const _0x1e8108=a0_0x5d2a42,_0x4fc819=new Date(_0x40135e);return String(_0x4fc819[_0x1e8108(0x1cc)]())['padStart'](0x2,'0')+':'+String(_0x4fc819['getMinutes']())[_0x1e8108(0x213)](0x2,'0');}function createMessageElement(_0x58bf48,_0x93d0c0){const _0x2d1f60=a0_0x5d2a42,_0x40d3cc=document[_0x2d1f60(0x227)](_0x2d1f60(0x1d9));_0x40d3cc['className']=_0x2d1f60(0x1ec)+_0x58bf48[_0x2d1f60(0x1d3)];const _0x2dcdec=document['createElement'](_0x2d1f60(0x1d9));_0x2dcdec[_0x2d1f60(0x1b3)]='message-bubble',_0x2dcdec[_0x2d1f60(0x1db)]=_0x58bf48[_0x2d1f60(0x1f4)]['replace'](/\n/g,_0x2d1f60(0x1e9));const _0x80bed0=document['createElement']('div');_0x80bed0[_0x2d1f60(0x1b3)]=_0x2d1f60(0x22f),_0x80bed0[_0x2d1f60(0x1db)]=_0x2d1f60(0x1cb),_0x80bed0['onclick']=_0x4a080d=>{const _0x4822f0=_0x2d1f60;_0x4a080d[_0x4822f0(0x1fe)](),confirmDelete(_0x93d0c0);};let _0x445fc5;_0x2dcdec['addEventListener'](_0x2d1f60(0x216),()=>_0x445fc5=setTimeout(()=>{const _0x53786c=_0x2d1f60;_0x40d3cc[_0x53786c(0x209)]['add'](_0x53786c(0x1d8));if(tg?.[_0x53786c(0x20c)])tg[_0x53786c(0x20c)][_0x53786c(0x1b5)](_0x53786c(0x21a));},0x1f4)),_0x2dcdec[_0x2d1f60(0x1e8)](_0x2d1f60(0x1ea),()=>clearTimeout(_0x445fc5));const _0x1c7bbf=document[_0x2d1f60(0x227)](_0x2d1f60(0x1d9));return _0x1c7bbf['className']='message-time',_0x1c7bbf[_0x2d1f60(0x1bd)]=formatTime(_0x58bf48[_0x2d1f60(0x226)]),_0x40d3cc[_0x2d1f60(0x203)](_0x80bed0),_0x40d3cc[_0x2d1f60(0x203)](_0x2dcdec),_0x40d3cc['appendChild'](_0x1c7bbf),_0x40d3cc;}function createTypingIndicator(){const _0x1cf740=a0_0x5d2a42,_0x5e61c6=document['createElement'](_0x1cf740(0x1d9));return _0x5e61c6['className']='message\x20ai',_0x5e61c6['id']=_0x1cf740(0x1da),_0x5e61c6[_0x1cf740(0x1db)]=_0x1cf740(0x1d6),_0x5e61c6;}function renderMessages(){const _0x45a249=a0_0x5d2a42;Array['from'](chatArea['children'])[_0x45a249(0x212)](_0x12c92a=>{const _0x47b33b=_0x45a249;if(_0x12c92a['id']!==_0x47b33b(0x1b9))_0x12c92a[_0x47b33b(0x220)]();}),messages['length']>0x0?(emptyState[_0x45a249(0x21c)][_0x45a249(0x1d7)]=_0x45a249(0x1f8),messages[_0x45a249(0x212)]((_0x2da705,_0x27d178)=>chatArea[_0x45a249(0x203)](createMessageElement(_0x2da705,_0x27d178)))):emptyState[_0x45a249(0x21c)][_0x45a249(0x1d7)]=_0x45a249(0x1d1),requestAnimationFrame(()=>chatArea[_0x45a249(0x206)]=chatArea[_0x45a249(0x1ca)]);}function autoResizeTextarea(){const _0x435209=a0_0x5d2a42;messageInput[_0x435209(0x21c)][_0x435209(0x1f5)]=_0x435209(0x202),messageInput['style'][_0x435209(0x1f5)]=Math[_0x435209(0x1c1)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x564a92=a0_0x5d2a42,_0x376e68=messageInput[_0x564a92(0x1f7)]['trim']();sendBtn['disabled']=!_0x376e68||isTyping;}function a0_0x18a6(){const _0x2acc01=['content','height','BackButton','value','none','paddingBottom','floor','modalTitle','random','sendBtn','stopPropagation','917548XcDXOu','username','ai_chat_messages','auto','appendChild','warn','351kkYHKo','scrollTop','offsetHeight','./router.html','classList','Начнется\x20новый\x20диалог.','.message.show-delete','HapticFeedback','apply','6.1','function','error','4312RZEKgk','forEach','padStart','show','TG\x20setup\x20error:','touchstart','viewportChanged','initDataUnsafe','toString','medium','send_message','style','target','setItem','now','remove','querySelectorAll','trim','Ошибка\x20сети','user','modalCancel','timestamp','createElement','357330SfzUkF','light','disableVerticalSwipes','Действие\x20необратимо.','28euBPMl','parse','success','delete-btn','className','isVersionAtLeast','impactOccurred','removeItem','getItem','948926mSGbys','emptyState','abort','getElementById','keydown','textContent','add','ready','initData','min','setHeaderColor','debug_uid','messageInput','push','notificationOccurred','Telegram','inputArea','stringify','scrollHeight','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','getHours','onEvent','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','onClick','focus','flex','modalText','role','json','length','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','display','show-delete','div','typingIndicator','innerHTML','onclick','text','POST','(((.+)+)+)+$','#050505','innerHeight','3946386TEBcTl','2587824SXHYVG','contains','Очистить\x20историю?','clearBtn','WebApp','addEventListener','<br>','touchend','Пустой\x20ответ','message\x20','signal','href','5OQMHzB','offClick','Enter','293570skkQVY','search'];a0_0x18a6=function(){return _0x2acc01;};return a0_0x18a6();}async function sendMessage(){const _0x1b0d91=a0_0x5d2a42,_0x29e814=messageInput[_0x1b0d91(0x1f7)][_0x1b0d91(0x222)]();if(!_0x29e814||isTyping)return;if(tg?.[_0x1b0d91(0x20c)])tg['HapticFeedback'][_0x1b0d91(0x1b5)](_0x1b0d91(0x229));messages[_0x1b0d91(0x1c5)]({'role':_0x1b0d91(0x224),'content':_0x29e814,'timestamp':Date['now']()}),localStorage[_0x1b0d91(0x21e)](_0x1b0d91(0x201),JSON[_0x1b0d91(0x1c9)](messages)),renderMessages(),messageInput[_0x1b0d91(0x1f7)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x1b0d91(0x1ca)];const _0x5a80a4=await callBackend(_0x1b0d91(0x21b),{'message':_0x29e814});isTyping=![];const _0x19ab93=document[_0x1b0d91(0x1bb)](_0x1b0d91(0x1da));if(_0x19ab93)_0x19ab93['remove']();let _0x6ddff9=_0x1b0d91(0x223);if(_0x5a80a4['success']){_0x6ddff9=_0x5a80a4[_0x1b0d91(0x1dd)]||_0x1b0d91(0x1eb);if(tg?.[_0x1b0d91(0x20c)])tg[_0x1b0d91(0x20c)][_0x1b0d91(0x1c6)](_0x1b0d91(0x22e));}else{_0x6ddff9=_0x5a80a4[_0x1b0d91(0x210)]||'Ошибка\x20сервера';if(tg?.[_0x1b0d91(0x20c)])tg[_0x1b0d91(0x20c)][_0x1b0d91(0x1c6)](_0x1b0d91(0x210));}messages['push']({'role':'ai','content':_0x6ddff9,'timestamp':Date[_0x1b0d91(0x21f)]()}),localStorage[_0x1b0d91(0x21e)]('ai_chat_messages',JSON[_0x1b0d91(0x1c9)](messages)),renderMessages();}function confirmDelete(_0x3ac37b){const _0x3c9b99=a0_0x5d2a42;if(mTitle)mTitle[_0x3c9b99(0x1bd)]='Удалить?';if(mText)mText['textContent']=_0x3c9b99(0x22b);modalCallback=()=>{const _0x27f26d=_0x3c9b99;messages['splice'](_0x3ac37b,0x1),localStorage['setItem'](_0x27f26d(0x201),JSON['stringify'](messages)),renderMessages();},modal[_0x3c9b99(0x209)][_0x3c9b99(0x1be)](_0x3c9b99(0x214));}if(clearBtn)clearBtn['onclick']=()=>{const _0xf9cde2=a0_0x5d2a42;if(!messages[_0xf9cde2(0x1d5)])return;if(mTitle)mTitle['textContent']=_0xf9cde2(0x1e5);if(mText)mText['textContent']=_0xf9cde2(0x20a);modalCallback=async()=>{const _0x38a10e=_0xf9cde2;messages=[],localStorage[_0x38a10e(0x1b6)](_0x38a10e(0x201)),renderMessages(),callBackend('clear_history',{});},modal[_0xf9cde2(0x209)][_0xf9cde2(0x1be)](_0xf9cde2(0x214));};document['getElementById'](a0_0x5d2a42(0x225))['onclick']=()=>modal[a0_0x5d2a42(0x209)][a0_0x5d2a42(0x220)](a0_0x5d2a42(0x214)),document[a0_0x5d2a42(0x1bb)]('modalConfirm')[a0_0x5d2a42(0x1dc)]=()=>{const _0x233250=a0_0x5d2a42;if(modalCallback)modalCallback();modal[_0x233250(0x209)][_0x233250(0x220)](_0x233250(0x214));},messageInput[a0_0x5d2a42(0x1e8)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5d2a42(0x1e8)](a0_0x5d2a42(0x1bc),_0x380cbd=>{const _0x4fd488=a0_0x5d2a42;_0x380cbd['key']===_0x4fd488(0x1f1)&&!_0x380cbd['shiftKey']&&(_0x380cbd['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x5d2a42(0x1e8)]('click',_0x1bef80=>{const _0x9153b1=a0_0x5d2a42;document[_0x9153b1(0x221)](_0x9153b1(0x20b))['forEach'](_0x3bd1f0=>{const _0x216c60=_0x9153b1;if(!_0x3bd1f0[_0x216c60(0x1e4)](_0x1bef80[_0x216c60(0x21d)]))_0x3bd1f0[_0x216c60(0x209)][_0x216c60(0x220)](_0x216c60(0x1d8));});});const saved=localStorage[a0_0x5d2a42(0x1b7)](a0_0x5d2a42(0x201));if(saved)try{messages=JSON[a0_0x5d2a42(0x22d)](saved),renderMessages();}catch(a0_0x768a8c){}updateSendButton();