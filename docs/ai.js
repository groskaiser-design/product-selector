const a0_0x14e4fb=a0_0x3434;(function(_0x450186,_0x32c099){const _0x20fb3c=a0_0x3434,_0x40981b=_0x450186();while(!![]){try{const _0x2e9c57=parseInt(_0x20fb3c(0x20f))/0x1*(parseInt(_0x20fb3c(0x234))/0x2)+parseInt(_0x20fb3c(0x1f7))/0x3*(-parseInt(_0x20fb3c(0x243))/0x4)+-parseInt(_0x20fb3c(0x1ec))/0x5+parseInt(_0x20fb3c(0x24f))/0x6*(parseInt(_0x20fb3c(0x213))/0x7)+parseInt(_0x20fb3c(0x218))/0x8+parseInt(_0x20fb3c(0x232))/0x9+parseInt(_0x20fb3c(0x1e3))/0xa*(-parseInt(_0x20fb3c(0x207))/0xb);if(_0x2e9c57===_0x32c099)break;else _0x40981b['push'](_0x40981b['shift']());}catch(_0x5e3af0){_0x40981b['push'](_0x40981b['shift']());}}}(a0_0x18b9,0x2e092));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x14e4fb(0x1fb);function setupTelegramBackButton(){const _0x4dd869=a0_0x14e4fb;if(!tg)return;try{tg[_0x4dd869(0x237)](),tg[_0x4dd869(0x214)](),tg['setHeaderColor']?.(_0x4dd869(0x1dd));if(tg[_0x4dd869(0x23e)]?.(_0x4dd869(0x212)))tg['disableVerticalSwipes']?.();const _0x32db0a=tg[_0x4dd869(0x24e)];if(_0x32db0a){_0x32db0a[_0x4dd869(0x21f)]();if(typeof _0x32db0a[_0x4dd869(0x24a)]===_0x4dd869(0x222))try{_0x32db0a[_0x4dd869(0x24a)]();}catch(_0x4466c5){}_0x32db0a[_0x4dd869(0x215)](()=>{const _0x44a774=_0x4dd869;if(tg[_0x44a774(0x1da)])tg[_0x44a774(0x1da)][_0x44a774(0x202)](_0x44a774(0x231));location['href']=HOME_URL;});}}catch(_0x4db1a8){console[_0x4dd869(0x1f3)](_0x4dd869(0x22f),_0x4db1a8);}}(function initStableLayout(){const _0x4ea0a5=a0_0x14e4fb,_0x5000ad=(function(){let _0x5d52d6=!![];return function(_0x27d6e9,_0x49382f){const _0x52c6f6=_0x5d52d6?function(){const _0x46fb2b=a0_0x3434;if(_0x49382f){const _0x303c07=_0x49382f[_0x46fb2b(0x230)](_0x27d6e9,arguments);return _0x49382f=null,_0x303c07;}}:function(){};return _0x5d52d6=![],_0x52c6f6;};}()),_0x2ea393=document[_0x4ea0a5(0x250)]('.container'),_0x25f3da=document['getElementById']('inputArea'),_0x4064db=document[_0x4ea0a5(0x248)]('chatArea'),_0x290b4e=document['getElementById'](_0x4ea0a5(0x210));function _0x4ca93f(){const _0x161bcf=_0x4ea0a5,_0x537531=_0x5000ad(this,function(){const _0x2ba3c4=a0_0x3434;return _0x537531[_0x2ba3c4(0x208)]()[_0x2ba3c4(0x24c)](_0x2ba3c4(0x211))[_0x2ba3c4(0x208)]()[_0x2ba3c4(0x1e8)](_0x537531)[_0x2ba3c4(0x24c)](_0x2ba3c4(0x211));});_0x537531();if(!_0x2ea393)return;const _0x3d1bbe=tg&&tg['viewportHeight']?tg[_0x161bcf(0x20c)]:window[_0x161bcf(0x22e)];_0x2ea393['style'][_0x161bcf(0x224)]=_0x3d1bbe+'px';if(_0x25f3da){const _0x3758e5=_0x25f3da[_0x161bcf(0x20d)];_0x4064db['style']['paddingBottom']=_0x3758e5+0x28+'px';}}tg?tg[_0x4ea0a5(0x22b)](_0x4ea0a5(0x1f8),({isStateStable:_0x1f705})=>{_0x4ca93f();if(_0x1f705)requestAnimationFrame(()=>{const _0x456e29=a0_0x3434;_0x4064db[_0x456e29(0x1e2)]=_0x4064db[_0x456e29(0x245)];});}):window['addEventListener'](_0x4ea0a5(0x219),_0x4ca93f),_0x4ca93f(),_0x290b4e&&(_0x290b4e[_0x4ea0a5(0x1e0)]('input',()=>{requestAnimationFrame(_0x4ca93f);}),_0x290b4e[_0x4ea0a5(0x1e0)](_0x4ea0a5(0x233),()=>{setTimeout(()=>{const _0x4111d2=a0_0x3434;_0x4064db[_0x4111d2(0x1e2)]=_0x4064db[_0x4111d2(0x245)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x14e4fb(0x248)]('chatArea'),emptyState=document[a0_0x14e4fb(0x248)](a0_0x14e4fb(0x216)),messageInput=document[a0_0x14e4fb(0x248)](a0_0x14e4fb(0x210)),sendBtn=document[a0_0x14e4fb(0x248)](a0_0x14e4fb(0x1df)),clearBtn=document[a0_0x14e4fb(0x248)](a0_0x14e4fb(0x1f6)),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0x14e4fb(0x248)](a0_0x14e4fb(0x1e4)),mText=document['getElementById'](a0_0x14e4fb(0x20e));let modalCallback=null;async function callBackend(_0x1dea58,_0x21c47b){const _0x970d93=a0_0x14e4fb,_0xa84095=tg?.[_0x970d93(0x223)]?.['user']||{},_0xf868dc=_0xa84095['id']||localStorage[_0x970d93(0x23c)](_0x970d93(0x1f0))||'d-'+Math['floor'](Math[_0x970d93(0x1f9)]()*0x3b9aca00);if(!_0xa84095['id'])localStorage[_0x970d93(0x1e7)](_0x970d93(0x1f0),_0xf868dc);const _0xd8390f={'action':_0x1dea58,'user_id':_0xf868dc,'user_data':{'first_name':_0xa84095[_0x970d93(0x244)],'username':_0xa84095[_0x970d93(0x240)]},'init_data':tg?.[_0x970d93(0x21b)]||'',..._0x21c47b},_0x26ad48=new AbortController(),_0x4f0629=setTimeout(()=>_0x26ad48['abort'](),REQUEST_TIMEOUT_MS);try{const _0xa9eb3b=await fetch(BACKEND_URL,{'method':_0x970d93(0x21d),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x970d93(0x20a)](_0xd8390f),'signal':_0x26ad48[_0x970d93(0x23a)]});return clearTimeout(_0x4f0629),await _0xa9eb3b[_0x970d93(0x1f4)]();}catch(_0x32e14c){return{'success':![],'error':String(_0x32e14c)};}}function formatTime(_0x5c2289){const _0x1f4efd=a0_0x14e4fb,_0x3b037e=new Date(_0x5c2289);return String(_0x3b037e['getHours']())[_0x1f4efd(0x1e6)](0x2,'0')+':'+String(_0x3b037e[_0x1f4efd(0x249)]())['padStart'](0x2,'0');}function createMessageElement(_0x4a9d91,_0x6e6d68){const _0x41f7c6=a0_0x14e4fb,_0x524a25=document[_0x41f7c6(0x1fc)](_0x41f7c6(0x235));_0x524a25[_0x41f7c6(0x1d9)]=_0x41f7c6(0x21e)+_0x4a9d91['role'];const _0x24dbfe=document[_0x41f7c6(0x1fc)](_0x41f7c6(0x235));_0x24dbfe[_0x41f7c6(0x1d9)]=_0x41f7c6(0x22a),_0x24dbfe[_0x41f7c6(0x225)]=_0x4a9d91['content'][_0x41f7c6(0x217)](/\n/g,'<br>');const _0x119eea=document[_0x41f7c6(0x1fc)]('div');_0x119eea[_0x41f7c6(0x1d9)]='delete-btn',_0x119eea[_0x41f7c6(0x225)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x119eea['onclick']=_0xdf1c4=>{const _0x3d80c2=_0x41f7c6;_0xdf1c4[_0x3d80c2(0x24b)](),confirmDelete(_0x6e6d68);};let _0x5a279c;_0x24dbfe[_0x41f7c6(0x1e0)](_0x41f7c6(0x226),()=>_0x5a279c=setTimeout(()=>{const _0x2d91a0=_0x41f7c6;_0x524a25[_0x2d91a0(0x1eb)][_0x2d91a0(0x1ed)](_0x2d91a0(0x206));if(tg?.[_0x2d91a0(0x1da)])tg[_0x2d91a0(0x1da)][_0x2d91a0(0x202)](_0x2d91a0(0x209));},0x1f4)),_0x24dbfe[_0x41f7c6(0x1e0)](_0x41f7c6(0x228),()=>clearTimeout(_0x5a279c));const _0x327cb1=document[_0x41f7c6(0x1fc)](_0x41f7c6(0x235));return _0x327cb1[_0x41f7c6(0x1d9)]='message-time',_0x327cb1[_0x41f7c6(0x205)]=formatTime(_0x4a9d91[_0x41f7c6(0x203)]),_0x524a25[_0x41f7c6(0x1f2)](_0x119eea),_0x524a25['appendChild'](_0x24dbfe),_0x524a25[_0x41f7c6(0x1f2)](_0x327cb1),_0x524a25;}function a0_0x18b9(){const _0x13be81=['text','user','getElementById','getMinutes','offClick','stopPropagation','search','Ошибка\x20сервера','BackButton','6NeBCPR','querySelector','notificationOccurred','className','HapticFeedback','Удалить?','contains','#050505','Enter','sendBtn','addEventListener','display','scrollTop','1551170byhaXo','modalTitle','querySelectorAll','padStart','setItem','constructor','Пустой\x20ответ','children','classList','350400jJVRHx','add','none','ai_chat_messages','debug_uid','send_message','appendChild','warn','json','parse','clearBtn','120246LtlkdQ','viewportChanged','random','success','./router.html','createElement','splice','Начнется\x20новый\x20диалог.','error','Ошибка\x20сети','style','impactOccurred','timestamp','forEach','textContent','show-delete','44hiSFHK','toString','medium','stringify','now','viewportHeight','offsetHeight','modalText','5277OMvOlV','messageInput','(((.+)+)+)+$','6.1','2222353TWjWAw','expand','onClick','emptyState','replace','561248OxOiut','resize','value','initData','Очистить\x20историю?','POST','message\x20','show','flex','key','function','initDataUnsafe','height','innerHTML','touchstart','modalConfirm','touchend','clear_history','message-bubble','onEvent','length','preventDefault','innerHeight','TG\x20setup\x20error:','apply','light','2409363TDSuJM','focus','100cYqeQy','div','.message.show-delete','ready','trim','auto','signal','shiftKey','getItem','remove','isVersionAtLeast','modalCancel','username','onclick','push','4qIQmUy','first_name','scrollHeight'];a0_0x18b9=function(){return _0x13be81;};return a0_0x18b9();}function a0_0x3434(_0x23cedd,_0x3b5939){_0x23cedd=_0x23cedd-0x1d8;const _0x133621=a0_0x18b9();let _0x5a2f74=_0x133621[_0x23cedd];return _0x5a2f74;}function createTypingIndicator(){const _0x2d8b62=a0_0x14e4fb,_0x2c4d79=document['createElement'](_0x2d8b62(0x235));return _0x2c4d79['className']='message\x20ai',_0x2c4d79['id']='typingIndicator',_0x2c4d79[_0x2d8b62(0x225)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x2c4d79;}function renderMessages(){const _0x345995=a0_0x14e4fb;Array['from'](chatArea[_0x345995(0x1ea)])[_0x345995(0x204)](_0xd8388f=>{if(_0xd8388f['id']!=='emptyState')_0xd8388f['remove']();}),messages[_0x345995(0x22c)]>0x0?(emptyState[_0x345995(0x201)][_0x345995(0x1e1)]=_0x345995(0x1ee),messages[_0x345995(0x204)]((_0x27e30b,_0xa16c21)=>chatArea[_0x345995(0x1f2)](createMessageElement(_0x27e30b,_0xa16c21)))):emptyState[_0x345995(0x201)][_0x345995(0x1e1)]=_0x345995(0x220),requestAnimationFrame(()=>chatArea[_0x345995(0x1e2)]=chatArea[_0x345995(0x245)]);}function autoResizeTextarea(){const _0x333462=a0_0x14e4fb;messageInput['style']['height']=_0x333462(0x239),messageInput[_0x333462(0x201)]['height']=Math['min'](messageInput[_0x333462(0x245)],0x78)+'px';}function updateSendButton(){const _0x22d22b=a0_0x14e4fb,_0x5c947f=messageInput[_0x22d22b(0x21a)][_0x22d22b(0x238)]();sendBtn['disabled']=!_0x5c947f||isTyping;}async function sendMessage(){const _0x2f6617=a0_0x14e4fb,_0x17cac7=messageInput[_0x2f6617(0x21a)]['trim']();if(!_0x17cac7||isTyping)return;if(tg?.[_0x2f6617(0x1da)])tg[_0x2f6617(0x1da)][_0x2f6617(0x202)]('light');messages[_0x2f6617(0x242)]({'role':_0x2f6617(0x247),'content':_0x17cac7,'timestamp':Date[_0x2f6617(0x20b)]()}),localStorage[_0x2f6617(0x1e7)](_0x2f6617(0x1ef),JSON[_0x2f6617(0x20a)](messages)),renderMessages(),messageInput[_0x2f6617(0x21a)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2f6617(0x1f2)](createTypingIndicator()),chatArea[_0x2f6617(0x1e2)]=chatArea[_0x2f6617(0x245)];const _0x3d6268=await callBackend(_0x2f6617(0x1f1),{'message':_0x17cac7});isTyping=![];const _0x2ef7ad=document[_0x2f6617(0x248)]('typingIndicator');if(_0x2ef7ad)_0x2ef7ad[_0x2f6617(0x23d)]();let _0x59b58e=_0x2f6617(0x200);if(_0x3d6268[_0x2f6617(0x1fa)]){_0x59b58e=_0x3d6268[_0x2f6617(0x246)]||_0x2f6617(0x1e9);if(tg?.[_0x2f6617(0x1da)])tg[_0x2f6617(0x1da)][_0x2f6617(0x1d8)](_0x2f6617(0x1fa));}else{_0x59b58e=_0x3d6268[_0x2f6617(0x1ff)]||_0x2f6617(0x24d);if(tg?.[_0x2f6617(0x1da)])tg[_0x2f6617(0x1da)][_0x2f6617(0x1d8)](_0x2f6617(0x1ff));}messages['push']({'role':'ai','content':_0x59b58e,'timestamp':Date[_0x2f6617(0x20b)]()}),localStorage[_0x2f6617(0x1e7)](_0x2f6617(0x1ef),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x299b11){const _0x559f1a=a0_0x14e4fb;if(mTitle)mTitle[_0x559f1a(0x205)]=_0x559f1a(0x1db);if(mText)mText[_0x559f1a(0x205)]='Действие\x20необратимо.';modalCallback=()=>{const _0x544860=_0x559f1a;messages[_0x544860(0x1fd)](_0x299b11,0x1),localStorage[_0x544860(0x1e7)](_0x544860(0x1ef),JSON[_0x544860(0x20a)](messages)),renderMessages();},modal[_0x559f1a(0x1eb)][_0x559f1a(0x1ed)]('show');}if(clearBtn)clearBtn[a0_0x14e4fb(0x241)]=()=>{const _0x991e76=a0_0x14e4fb;if(!messages[_0x991e76(0x22c)])return;if(mTitle)mTitle[_0x991e76(0x205)]=_0x991e76(0x21c);if(mText)mText[_0x991e76(0x205)]=_0x991e76(0x1fe);modalCallback=async()=>{const _0x591140=_0x991e76;messages=[],localStorage['removeItem'](_0x591140(0x1ef)),renderMessages(),callBackend(_0x591140(0x229),{});},modal[_0x991e76(0x1eb)]['add'](_0x991e76(0x21f));};document[a0_0x14e4fb(0x248)](a0_0x14e4fb(0x23f))[a0_0x14e4fb(0x241)]=()=>modal[a0_0x14e4fb(0x1eb)][a0_0x14e4fb(0x23d)]('show'),document['getElementById'](a0_0x14e4fb(0x227))['onclick']=()=>{const _0x111d8e=a0_0x14e4fb;if(modalCallback)modalCallback();modal['classList'][_0x111d8e(0x23d)](_0x111d8e(0x21f));},messageInput[a0_0x14e4fb(0x1e0)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x36194d=>{const _0x3c7bdf=a0_0x14e4fb;_0x36194d[_0x3c7bdf(0x221)]===_0x3c7bdf(0x1de)&&!_0x36194d[_0x3c7bdf(0x23b)]&&(_0x36194d[_0x3c7bdf(0x22d)](),sendMessage());}),sendBtn[a0_0x14e4fb(0x241)]=sendMessage,document[a0_0x14e4fb(0x1e0)]('click',_0x589581=>{const _0x3d5f66=a0_0x14e4fb;document[_0x3d5f66(0x1e5)](_0x3d5f66(0x236))[_0x3d5f66(0x204)](_0x569149=>{const _0x292481=_0x3d5f66;if(!_0x569149[_0x292481(0x1dc)](_0x589581['target']))_0x569149[_0x292481(0x1eb)][_0x292481(0x23d)](_0x292481(0x206));});});const saved=localStorage[a0_0x14e4fb(0x23c)](a0_0x14e4fb(0x1ef));if(saved)try{messages=JSON[a0_0x14e4fb(0x1f5)](saved),renderMessages();}catch(a0_0xed2749){}updateSendButton();