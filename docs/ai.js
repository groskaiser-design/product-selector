const a0_0x5d4518=a0_0x1c47;(function(_0xd79dae,_0x440692){const _0x1c5c6f=a0_0x1c47,_0x4ddea5=_0xd79dae();while(!![]){try{const _0x37b03d=-parseInt(_0x1c5c6f(0x129))/0x1*(-parseInt(_0x1c5c6f(0x159))/0x2)+-parseInt(_0x1c5c6f(0x13d))/0x3+parseInt(_0x1c5c6f(0xef))/0x4*(-parseInt(_0x1c5c6f(0x122))/0x5)+parseInt(_0x1c5c6f(0x119))/0x6+parseInt(_0x1c5c6f(0x100))/0x7*(-parseInt(_0x1c5c6f(0x10b))/0x8)+-parseInt(_0x1c5c6f(0x158))/0x9*(parseInt(_0x1c5c6f(0x144))/0xa)+parseInt(_0x1c5c6f(0x107))/0xb;if(_0x37b03d===_0x440692)break;else _0x4ddea5['push'](_0x4ddea5['shift']());}catch(_0x707475){_0x4ddea5['push'](_0x4ddea5['shift']());}}}(a0_0x5c88,0x6127b));const tg=window[a0_0x5d4518(0x15f)]?.['WebApp'],HOME_URL=a0_0x5d4518(0x161);function setupTelegramBackButton(){const _0x2f5690=a0_0x5d4518;if(!tg)return;try{tg[_0x2f5690(0x117)](),tg[_0x2f5690(0xe3)](),tg['setHeaderColor']?.(_0x2f5690(0x141));if(tg[_0x2f5690(0x162)]?.(_0x2f5690(0x15b)))tg['disableVerticalSwipes']?.();const _0x2a0e7e=tg['BackButton'];if(_0x2a0e7e){_0x2a0e7e[_0x2f5690(0x153)]();if(typeof _0x2a0e7e[_0x2f5690(0x135)]==='function')try{_0x2a0e7e['offClick']();}catch(_0xbd4a7b){}_0x2a0e7e['onClick'](()=>{const _0x30492a=_0x2f5690;if(tg[_0x30492a(0x154)])tg['HapticFeedback']['impactOccurred'](_0x30492a(0x114));location['href']=HOME_URL;});}}catch(_0x46f5c1){console[_0x2f5690(0x108)](_0x2f5690(0x134),_0x46f5c1);}}(function initStableLayout(){const _0x249b53=a0_0x5d4518,_0x3a42b7=(function(){let _0x3467b6=!![];return function(_0x35087a,_0x4721b1){const _0x2a3495=_0x3467b6?function(){const _0xad3135=a0_0x1c47;if(_0x4721b1){const _0x3c1085=_0x4721b1[_0xad3135(0x125)](_0x35087a,arguments);return _0x4721b1=null,_0x3c1085;}}:function(){};return _0x3467b6=![],_0x2a3495;};}()),_0x5329b3=document['querySelector'](_0x249b53(0x14b)),_0x29ade5=document[_0x249b53(0x105)](_0x249b53(0x132)),_0x21abbe=document['getElementById'](_0x249b53(0x102)),_0x424c21=document[_0x249b53(0x105)](_0x249b53(0xee));function _0x1ebaf8(){const _0x1d283b=_0x249b53,_0x329093=_0x3a42b7(this,function(){const _0x5bdb60=a0_0x1c47;return _0x329093[_0x5bdb60(0xe8)]()[_0x5bdb60(0xfe)]('(((.+)+)+)+$')[_0x5bdb60(0xe8)]()[_0x5bdb60(0x10d)](_0x329093)[_0x5bdb60(0xfe)](_0x5bdb60(0x150));});_0x329093();if(!_0x5329b3)return;const _0x4baf73=tg&&tg['viewportHeight']?tg[_0x1d283b(0x11b)]:window[_0x1d283b(0x137)];_0x5329b3[_0x1d283b(0xf6)][_0x1d283b(0x151)]=_0x4baf73+'px';if(_0x29ade5){const _0xf11406=_0x29ade5[_0x1d283b(0x15a)];_0x21abbe[_0x1d283b(0xf6)][_0x1d283b(0x127)]=_0xf11406+0x28+'px';}}tg?tg[_0x249b53(0xf1)](_0x249b53(0x163),({isStateStable:_0x50928e})=>{_0x1ebaf8();if(_0x50928e)requestAnimationFrame(()=>{const _0x5239e6=a0_0x1c47;_0x21abbe[_0x5239e6(0x14e)]=_0x21abbe[_0x5239e6(0x131)];});}):window[_0x249b53(0x128)](_0x249b53(0x155),_0x1ebaf8),_0x1ebaf8(),_0x424c21&&(_0x424c21[_0x249b53(0x128)](_0x249b53(0x11e),()=>{requestAnimationFrame(_0x1ebaf8);}),_0x424c21[_0x249b53(0x128)](_0x249b53(0x133),()=>{setTimeout(()=>{const _0x5db8d9=a0_0x1c47;_0x21abbe[_0x5db8d9(0x14e)]=_0x21abbe[_0x5db8d9(0x131)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;function a0_0x5c88(){const _0x32cdb7=['add','Telegram','getMinutes','./router.html','isVersionAtLeast','viewportChanged','touchend','display','error','expand','classList','ai_chat_messages','text','removeItem','toString','onclick','trim','impactOccurred','message-bubble','Начнется\x20новый\x20диалог.','messageInput','92kptbvj','keydown','onEvent','contains','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','splice','auto','style','<br>','message-time','content','modalText','timestamp','from','username','search','typingIndicator','14hsPKDG','appendChild','chatArea','Enter','className','getElementById','disabled','17226385Gjflvs','warn','modalConfirm','getHours','2378432vIwLDF','value','constructor','getItem','signal','.message.show-delete','none','target','clearBtn','light','floor','div','ready','Удалить?','3946986DbhjJu','innerHTML','viewportHeight','initDataUnsafe','initData','input','Ошибка\x20сети','medium','notificationOccurred','129475jOYBUj','modalCancel','key','apply','emptyState','paddingBottom','addEventListener','269vzDgWR','Очистить\x20историю?','push','stopPropagation','confirmModal','children','delete-btn','length','scrollHeight','inputArea','focus','TG\x20setup\x20error:','offClick','click','innerHeight','querySelectorAll','textContent','abort','random','stringify','901062xjEntY','preventDefault','Пустой\x20ответ','remove','#050505','role','replace','4530lepbLn','forEach','setItem','debug_uid','padStart','show-delete','user','.container','success','message\x20ai','scrollTop','now','(((.+)+)+)+$','height','flex','show','HapticFeedback','resize','first_name','touchstart','7299sojjLw','238azrbXa','offsetHeight','6.1','parse','createElement'];a0_0x5c88=function(){return _0x32cdb7;};return a0_0x5c88();}let messages=[],isTyping=![];const chatArea=document[a0_0x5d4518(0x105)](a0_0x5d4518(0x102)),emptyState=document[a0_0x5d4518(0x105)](a0_0x5d4518(0x126)),messageInput=document['getElementById'](a0_0x5d4518(0xee)),sendBtn=document[a0_0x5d4518(0x105)]('sendBtn'),clearBtn=document['getElementById'](a0_0x5d4518(0x113)),modal=document['getElementById'](a0_0x5d4518(0x12d)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0x5d4518(0x105)](a0_0x5d4518(0xfa));let modalCallback=null;async function callBackend(_0x505dcb,_0x2800c8){const _0x1975e4=a0_0x5d4518,_0x2bd496=tg?.[_0x1975e4(0x11c)]?.['user']||{},_0x13410e=_0x2bd496['id']||localStorage['getItem'](_0x1975e4(0x147))||'d-'+Math[_0x1975e4(0x115)](Math[_0x1975e4(0x13b)]()*0x3b9aca00);if(!_0x2bd496['id'])localStorage[_0x1975e4(0x146)](_0x1975e4(0x147),_0x13410e);const _0x38ac32={'action':_0x505dcb,'user_id':_0x13410e,'user_data':{'first_name':_0x2bd496[_0x1975e4(0x156)],'username':_0x2bd496[_0x1975e4(0xfd)]},'init_data':tg?.[_0x1975e4(0x11d)]||'',..._0x2800c8},_0x35ee79=new AbortController(),_0x5f4316=setTimeout(()=>_0x35ee79[_0x1975e4(0x13a)](),REQUEST_TIMEOUT_MS);try{const _0x2b6b90=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x1975e4(0x13c)](_0x38ac32),'signal':_0x35ee79[_0x1975e4(0x10f)]});return clearTimeout(_0x5f4316),await _0x2b6b90['json']();}catch(_0x124a20){return{'success':![],'error':String(_0x124a20)};}}function formatTime(_0xb2d22b){const _0x113ef0=a0_0x5d4518,_0xa19d6e=new Date(_0xb2d22b);return String(_0xa19d6e[_0x113ef0(0x10a)]())[_0x113ef0(0x148)](0x2,'0')+':'+String(_0xa19d6e[_0x113ef0(0x160)]())[_0x113ef0(0x148)](0x2,'0');}function createMessageElement(_0x464569,_0x16c0f0){const _0x358af3=a0_0x5d4518,_0xaabfe3=document[_0x358af3(0x15d)](_0x358af3(0x116));_0xaabfe3[_0x358af3(0x104)]='message\x20'+_0x464569[_0x358af3(0x142)];const _0x11af3a=document['createElement'](_0x358af3(0x116));_0x11af3a[_0x358af3(0x104)]=_0x358af3(0xec),_0x11af3a[_0x358af3(0x11a)]=_0x464569[_0x358af3(0xf9)][_0x358af3(0x143)](/\n/g,_0x358af3(0xf7));const _0x23acad=document['createElement']('div');_0x23acad['className']=_0x358af3(0x12f),_0x23acad[_0x358af3(0x11a)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x23acad[_0x358af3(0xe9)]=_0x3ca5c8=>{const _0x45c981=_0x358af3;_0x3ca5c8[_0x45c981(0x12c)](),confirmDelete(_0x16c0f0);};let _0x690576;_0x11af3a[_0x358af3(0x128)](_0x358af3(0x157),()=>_0x690576=setTimeout(()=>{const _0xd87d81=_0x358af3;_0xaabfe3[_0xd87d81(0xe4)]['add']('show-delete');if(tg?.[_0xd87d81(0x154)])tg[_0xd87d81(0x154)][_0xd87d81(0xeb)](_0xd87d81(0x120));},0x1f4)),_0x11af3a[_0x358af3(0x128)](_0x358af3(0xe0),()=>clearTimeout(_0x690576));const _0x1f8a04=document[_0x358af3(0x15d)](_0x358af3(0x116));return _0x1f8a04[_0x358af3(0x104)]=_0x358af3(0xf8),_0x1f8a04[_0x358af3(0x139)]=formatTime(_0x464569[_0x358af3(0xfb)]),_0xaabfe3[_0x358af3(0x101)](_0x23acad),_0xaabfe3[_0x358af3(0x101)](_0x11af3a),_0xaabfe3[_0x358af3(0x101)](_0x1f8a04),_0xaabfe3;}function createTypingIndicator(){const _0x12e868=a0_0x5d4518,_0x2c6f73=document[_0x12e868(0x15d)](_0x12e868(0x116));return _0x2c6f73[_0x12e868(0x104)]=_0x12e868(0x14d),_0x2c6f73['id']=_0x12e868(0xff),_0x2c6f73[_0x12e868(0x11a)]=_0x12e868(0xf3),_0x2c6f73;}function renderMessages(){const _0x4aaada=a0_0x5d4518;Array[_0x4aaada(0xfc)](chatArea[_0x4aaada(0x12e)])[_0x4aaada(0x145)](_0x2bf947=>{const _0x378790=_0x4aaada;if(_0x2bf947['id']!==_0x378790(0x126))_0x2bf947['remove']();}),messages[_0x4aaada(0x130)]>0x0?(emptyState[_0x4aaada(0xf6)][_0x4aaada(0xe1)]=_0x4aaada(0x111),messages[_0x4aaada(0x145)]((_0x33ddb3,_0x5997eb)=>chatArea[_0x4aaada(0x101)](createMessageElement(_0x33ddb3,_0x5997eb)))):emptyState[_0x4aaada(0xf6)]['display']=_0x4aaada(0x152),requestAnimationFrame(()=>chatArea[_0x4aaada(0x14e)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x2c4b92=a0_0x5d4518;messageInput[_0x2c4b92(0xf6)][_0x2c4b92(0x151)]=_0x2c4b92(0xf5),messageInput['style']['height']=Math['min'](messageInput[_0x2c4b92(0x131)],0x78)+'px';}function updateSendButton(){const _0x116829=a0_0x5d4518,_0x10d784=messageInput[_0x116829(0x10c)][_0x116829(0xea)]();sendBtn[_0x116829(0x106)]=!_0x10d784||isTyping;}async function sendMessage(){const _0xfee541=a0_0x5d4518,_0x5140fa=messageInput[_0xfee541(0x10c)]['trim']();if(!_0x5140fa||isTyping)return;if(tg?.['HapticFeedback'])tg[_0xfee541(0x154)][_0xfee541(0xeb)](_0xfee541(0x114));messages[_0xfee541(0x12b)]({'role':_0xfee541(0x14a),'content':_0x5140fa,'timestamp':Date[_0xfee541(0x14f)]()}),localStorage[_0xfee541(0x146)](_0xfee541(0xe5),JSON[_0xfee541(0x13c)](messages)),renderMessages(),messageInput[_0xfee541(0x10c)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xfee541(0x101)](createTypingIndicator()),chatArea[_0xfee541(0x14e)]=chatArea[_0xfee541(0x131)];const _0x35f4e7=await callBackend('send_message',{'message':_0x5140fa});isTyping=![];const _0x110149=document['getElementById']('typingIndicator');if(_0x110149)_0x110149[_0xfee541(0x140)]();let _0x24c0cd=_0xfee541(0x11f);if(_0x35f4e7[_0xfee541(0x14c)]){_0x24c0cd=_0x35f4e7[_0xfee541(0xe6)]||_0xfee541(0x13f);if(tg?.[_0xfee541(0x154)])tg[_0xfee541(0x154)]['notificationOccurred']('success');}else{_0x24c0cd=_0x35f4e7[_0xfee541(0xe2)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0xfee541(0x121)]('error');}messages['push']({'role':'ai','content':_0x24c0cd,'timestamp':Date['now']()}),localStorage[_0xfee541(0x146)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0xcffada){const _0xf1d946=a0_0x5d4518;if(mTitle)mTitle[_0xf1d946(0x139)]=_0xf1d946(0x118);if(mText)mText[_0xf1d946(0x139)]='Действие\x20необратимо.';modalCallback=()=>{const _0x43598a=_0xf1d946;messages[_0x43598a(0xf4)](_0xcffada,0x1),localStorage[_0x43598a(0x146)](_0x43598a(0xe5),JSON['stringify'](messages)),renderMessages();},modal[_0xf1d946(0xe4)][_0xf1d946(0x15e)](_0xf1d946(0x153));}function a0_0x1c47(_0x45c529,_0x2cb70b){_0x45c529=_0x45c529-0xe0;const _0x10be8b=a0_0x5c88();let _0x39620c=_0x10be8b[_0x45c529];return _0x39620c;}if(clearBtn)clearBtn[a0_0x5d4518(0xe9)]=()=>{const _0x29350f=a0_0x5d4518;if(!messages[_0x29350f(0x130)])return;if(mTitle)mTitle[_0x29350f(0x139)]=_0x29350f(0x12a);if(mText)mText[_0x29350f(0x139)]=_0x29350f(0xed);modalCallback=async()=>{const _0x22535d=_0x29350f;messages=[],localStorage[_0x22535d(0xe7)](_0x22535d(0xe5)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x29350f(0x15e)](_0x29350f(0x153));};document[a0_0x5d4518(0x105)](a0_0x5d4518(0x123))[a0_0x5d4518(0xe9)]=()=>modal[a0_0x5d4518(0xe4)][a0_0x5d4518(0x140)](a0_0x5d4518(0x153)),document[a0_0x5d4518(0x105)](a0_0x5d4518(0x109))[a0_0x5d4518(0xe9)]=()=>{const _0x27f983=a0_0x5d4518;if(modalCallback)modalCallback();modal[_0x27f983(0xe4)][_0x27f983(0x140)](_0x27f983(0x153));},messageInput[a0_0x5d4518(0x128)](a0_0x5d4518(0x11e),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x5d4518(0xf0),_0x362291=>{const _0x146162=a0_0x5d4518;_0x362291[_0x146162(0x124)]===_0x146162(0x103)&&!_0x362291['shiftKey']&&(_0x362291[_0x146162(0x13e)](),sendMessage());}),sendBtn[a0_0x5d4518(0xe9)]=sendMessage,document['addEventListener'](a0_0x5d4518(0x136),_0x120b33=>{const _0x59265f=a0_0x5d4518;document[_0x59265f(0x138)](_0x59265f(0x110))['forEach'](_0x733994=>{const _0x5ea22f=_0x59265f;if(!_0x733994[_0x5ea22f(0xf2)](_0x120b33[_0x5ea22f(0x112)]))_0x733994['classList'][_0x5ea22f(0x140)](_0x5ea22f(0x149));});});const saved=localStorage[a0_0x5d4518(0x10e)](a0_0x5d4518(0xe5));if(saved)try{messages=JSON[a0_0x5d4518(0x15c)](saved),renderMessages();}catch(a0_0x556182){}updateSendButton();