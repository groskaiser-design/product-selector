const a0_0x29c8bd=a0_0x4ba2;(function(_0x229576,_0x39cee4){const _0x3f6426=a0_0x4ba2,_0x1e325f=_0x229576();while(!![]){try{const _0x48f82f=parseInt(_0x3f6426(0x21b))/0x1*(parseInt(_0x3f6426(0x229))/0x2)+parseInt(_0x3f6426(0x1e2))/0x3*(parseInt(_0x3f6426(0x220))/0x4)+parseInt(_0x3f6426(0x216))/0x5+parseInt(_0x3f6426(0x219))/0x6+parseInt(_0x3f6426(0x1d6))/0x7*(parseInt(_0x3f6426(0x1e8))/0x8)+parseInt(_0x3f6426(0x239))/0x9+parseInt(_0x3f6426(0x1fd))/0xa*(-parseInt(_0x3f6426(0x213))/0xb);if(_0x48f82f===_0x39cee4)break;else _0x1e325f['push'](_0x1e325f['shift']());}catch(_0x3a8454){_0x1e325f['push'](_0x1e325f['shift']());}}}(a0_0x1f2b,0xdf6a0));const tg=window['Telegram']?.[a0_0x29c8bd(0x1d3)],HOME_URL=a0_0x29c8bd(0x205);function setupTelegramBackButton(){const _0x40233a=a0_0x29c8bd,_0x524f84=(function(){let _0x28d4c0=!![];return function(_0x1dbddd,_0x484421){const _0x1031a3=_0x28d4c0?function(){const _0x209c45=a0_0x4ba2;if(_0x484421){const _0xae397=_0x484421[_0x209c45(0x203)](_0x1dbddd,arguments);return _0x484421=null,_0xae397;}}:function(){};return _0x28d4c0=![],_0x1031a3;};}()),_0x46aeac=_0x524f84(this,function(){const _0xb02294=a0_0x4ba2;return _0x46aeac[_0xb02294(0x1e1)]()[_0xb02294(0x207)](_0xb02294(0x20a))[_0xb02294(0x1e1)]()[_0xb02294(0x24e)](_0x46aeac)[_0xb02294(0x207)]('(((.+)+)+)+$');});_0x46aeac();if(!tg)return;try{tg[_0x40233a(0x1f0)](),tg['expand'](),tg[_0x40233a(0x243)]?.(_0x40233a(0x247));if(tg[_0x40233a(0x1fc)]?.(_0x40233a(0x1dd)))tg[_0x40233a(0x204)]?.();const _0x2d7a35=tg[_0x40233a(0x245)];if(_0x2d7a35){_0x2d7a35['show']();if(typeof _0x2d7a35[_0x40233a(0x1ea)]==='function')try{_0x2d7a35[_0x40233a(0x1ea)]();}catch(_0x4d57b6){}_0x2d7a35[_0x40233a(0x21c)](()=>{const _0x1d350d=_0x40233a;if(tg[_0x1d350d(0x20e)])tg[_0x1d350d(0x20e)]['impactOccurred'](_0x1d350d(0x1ec));location[_0x1d350d(0x21f)]=HOME_URL;});}}catch(_0x6f95b3){console[_0x40233a(0x1dc)](_0x40233a(0x23d),_0x6f95b3);}}(function initStableLayout(){const _0x3f581e=a0_0x29c8bd,_0x39a88e=document[_0x3f581e(0x23f)]('.container'),_0x5eb658=document[_0x3f581e(0x222)](_0x3f581e(0x23c)),_0x3b4a28=document[_0x3f581e(0x222)]('chatArea'),_0x3d2882=document[_0x3f581e(0x222)](_0x3f581e(0x1f3));function _0x50f67a(){const _0x1dcb63=_0x3f581e;if(!_0x39a88e)return;const _0x35ed06=tg&&tg[_0x1dcb63(0x240)]?tg[_0x1dcb63(0x240)]:window['innerHeight'];_0x39a88e[_0x1dcb63(0x1f8)][_0x1dcb63(0x250)]=_0x35ed06+'px';if(_0x5eb658){const _0x1ea2c7=_0x5eb658[_0x1dcb63(0x21d)];_0x3b4a28[_0x1dcb63(0x1f8)][_0x1dcb63(0x1da)]=_0x1ea2c7+0x28+'px';}}tg?tg[_0x3f581e(0x202)](_0x3f581e(0x215),({isStateStable:_0x26f6ba})=>{_0x50f67a();if(_0x26f6ba)requestAnimationFrame(()=>{const _0x1fc43f=a0_0x4ba2;_0x3b4a28[_0x1fc43f(0x231)]=_0x3b4a28['scrollHeight'];});}):window[_0x3f581e(0x24c)](_0x3f581e(0x1d7),_0x50f67a),_0x50f67a(),_0x3d2882&&(_0x3d2882['addEventListener'](_0x3f581e(0x22d),()=>{requestAnimationFrame(_0x50f67a);}),_0x3d2882[_0x3f581e(0x24c)](_0x3f581e(0x208),()=>{setTimeout(()=>{const _0x57e25b=a0_0x4ba2;_0x3b4a28['scrollTop']=_0x3b4a28[_0x57e25b(0x22a)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x29c8bd(0x222)]('chatArea'),emptyState=document[a0_0x29c8bd(0x222)](a0_0x29c8bd(0x1e5)),messageInput=document[a0_0x29c8bd(0x222)](a0_0x29c8bd(0x1f3)),sendBtn=document[a0_0x29c8bd(0x222)]('sendBtn'),clearBtn=document['getElementById']('clearBtn'),modal=document[a0_0x29c8bd(0x222)]('confirmModal'),mTitle=document[a0_0x29c8bd(0x222)](a0_0x29c8bd(0x251)),mText=document['getElementById'](a0_0x29c8bd(0x235));function a0_0x4ba2(_0x195f91,_0x3c0d53){_0x195f91=_0x195f91-0x1d2;const _0x5dc3c4=a0_0x1f2b();let _0xcd3b45=_0x5dc3c4[_0x195f91];return _0xcd3b45;}let modalCallback=null;async function callBackend(_0x142f1d,_0x18a68c){const _0x55d849=a0_0x29c8bd,_0x39cba1=tg?.[_0x55d849(0x211)]?.[_0x55d849(0x1de)]||{},_0xee735a=_0x39cba1['id']||localStorage[_0x55d849(0x23a)](_0x55d849(0x237))||'d-'+Math['floor'](Math[_0x55d849(0x242)]()*0x3b9aca00);if(!_0x39cba1['id'])localStorage['setItem'](_0x55d849(0x237),_0xee735a);const _0x22435b={'action':_0x142f1d,'user_id':_0xee735a,'user_data':{'first_name':_0x39cba1[_0x55d849(0x233)],'username':_0x39cba1[_0x55d849(0x1fa)]},'init_data':tg?.[_0x55d849(0x24b)]||'',..._0x18a68c},_0x25856c=new AbortController(),_0x2c5cfa=setTimeout(()=>_0x25856c[_0x55d849(0x1ef)](),REQUEST_TIMEOUT_MS);try{const _0x2dca32=await fetch(BACKEND_URL,{'method':_0x55d849(0x248),'headers':{'Content-Type':_0x55d849(0x234)},'body':JSON[_0x55d849(0x1e6)](_0x22435b),'signal':_0x25856c['signal']});return clearTimeout(_0x2c5cfa),await _0x2dca32['json']();}catch(_0x544e1a){return{'success':![],'error':String(_0x544e1a)};}}function formatTime(_0x52bde9){const _0x1f02f5=a0_0x29c8bd,_0x52c2de=new Date(_0x52bde9);return String(_0x52c2de[_0x1f02f5(0x1d5)]())[_0x1f02f5(0x209)](0x2,'0')+':'+String(_0x52c2de[_0x1f02f5(0x22c)]())['padStart'](0x2,'0');}function createMessageElement(_0x3eefc3,_0x223a6a){const _0x29ec86=a0_0x29c8bd,_0x1b6de4=document[_0x29ec86(0x1f4)]('div');_0x1b6de4['className']=_0x29ec86(0x20f)+_0x3eefc3[_0x29ec86(0x201)];const _0x359658=document[_0x29ec86(0x1f4)](_0x29ec86(0x1fe));_0x359658[_0x29ec86(0x228)]=_0x29ec86(0x224),_0x359658[_0x29ec86(0x24d)]=_0x3eefc3[_0x29ec86(0x23e)]['replace'](/\n/g,_0x29ec86(0x22e));const _0x3a047c=document[_0x29ec86(0x1f4)](_0x29ec86(0x1fe));_0x3a047c['className']=_0x29ec86(0x1f7),_0x3a047c[_0x29ec86(0x24d)]=_0x29ec86(0x1ff),_0x3a047c[_0x29ec86(0x1f1)]=_0x328f0c=>{const _0x27bfbf=_0x29ec86;_0x328f0c[_0x27bfbf(0x232)](),confirmDelete(_0x223a6a);};let _0x2bbae6;_0x359658[_0x29ec86(0x24c)](_0x29ec86(0x217),()=>_0x2bbae6=setTimeout(()=>{const _0x4a2af8=_0x29ec86;_0x1b6de4['classList'][_0x4a2af8(0x1d4)](_0x4a2af8(0x227));if(tg?.[_0x4a2af8(0x20e)])tg[_0x4a2af8(0x20e)][_0x4a2af8(0x236)](_0x4a2af8(0x1ee));},0x1f4)),_0x359658[_0x29ec86(0x24c)](_0x29ec86(0x1e3),()=>clearTimeout(_0x2bbae6));const _0x50e963=document[_0x29ec86(0x1f4)](_0x29ec86(0x1fe));return _0x50e963['className']='message-time',_0x50e963[_0x29ec86(0x1f5)]=formatTime(_0x3eefc3['timestamp']),_0x1b6de4[_0x29ec86(0x1f9)](_0x3a047c),_0x1b6de4[_0x29ec86(0x1f9)](_0x359658),_0x1b6de4[_0x29ec86(0x1f9)](_0x50e963),_0x1b6de4;}function createTypingIndicator(){const _0x281000=a0_0x29c8bd,_0x47fa73=document[_0x281000(0x1f4)]('div');return _0x47fa73[_0x281000(0x228)]=_0x281000(0x246),_0x47fa73['id']=_0x281000(0x249),_0x47fa73[_0x281000(0x24d)]=_0x281000(0x226),_0x47fa73;}function renderMessages(){const _0x195c1d=a0_0x29c8bd;Array['from'](chatArea[_0x195c1d(0x23b)])['forEach'](_0x4f2f30=>{const _0x3668fa=_0x195c1d;if(_0x4f2f30['id']!==_0x3668fa(0x1e5))_0x4f2f30['remove']();}),messages[_0x195c1d(0x230)]>0x0?(emptyState[_0x195c1d(0x1f8)]['display']=_0x195c1d(0x20d),messages[_0x195c1d(0x1e4)]((_0x4feb93,_0x5aa5b8)=>chatArea[_0x195c1d(0x1f9)](createMessageElement(_0x4feb93,_0x5aa5b8)))):emptyState[_0x195c1d(0x1f8)][_0x195c1d(0x1f2)]=_0x195c1d(0x218),requestAnimationFrame(()=>chatArea[_0x195c1d(0x231)]=chatArea[_0x195c1d(0x22a)]);}function autoResizeTextarea(){const _0x3eb8bb=a0_0x29c8bd;messageInput[_0x3eb8bb(0x1f8)][_0x3eb8bb(0x250)]=_0x3eb8bb(0x22b),messageInput[_0x3eb8bb(0x1f8)]['height']=Math[_0x3eb8bb(0x1d9)](messageInput[_0x3eb8bb(0x22a)],0x78)+'px';}function updateSendButton(){const _0x16c209=a0_0x29c8bd,_0x33a6e1=messageInput[_0x16c209(0x238)][_0x16c209(0x212)]();sendBtn[_0x16c209(0x1e9)]=!_0x33a6e1||isTyping;}async function sendMessage(){const _0x134f04=a0_0x29c8bd,_0x2e95df=messageInput['value'][_0x134f04(0x212)]();if(!_0x2e95df||isTyping)return;if(tg?.[_0x134f04(0x20e)])tg[_0x134f04(0x20e)][_0x134f04(0x236)](_0x134f04(0x1ec));messages['push']({'role':_0x134f04(0x1de),'content':_0x2e95df,'timestamp':Date[_0x134f04(0x1e0)]()}),localStorage[_0x134f04(0x21e)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x134f04(0x1f9)](createTypingIndicator()),chatArea[_0x134f04(0x231)]=chatArea[_0x134f04(0x22a)];const _0x5972fc=await callBackend(_0x134f04(0x21a),{'message':_0x2e95df});isTyping=![];const _0x57e04e=document[_0x134f04(0x222)](_0x134f04(0x249));if(_0x57e04e)_0x57e04e[_0x134f04(0x24f)]();let _0x445cba=_0x134f04(0x252);if(_0x5972fc['success']){_0x445cba=_0x5972fc['text']||_0x134f04(0x225);if(tg?.[_0x134f04(0x20e)])tg[_0x134f04(0x20e)][_0x134f04(0x1db)]('success');}else{_0x445cba=_0x5972fc['error']||_0x134f04(0x223);if(tg?.[_0x134f04(0x20e)])tg[_0x134f04(0x20e)][_0x134f04(0x1db)]('error');}messages['push']({'role':'ai','content':_0x445cba,'timestamp':Date[_0x134f04(0x1e0)]()}),localStorage[_0x134f04(0x21e)](_0x134f04(0x1d2),JSON[_0x134f04(0x1e6)](messages)),renderMessages();}function a0_0x1f2b(){const _0x41ac33=['getItem','children','inputArea','TG\x20setup\x20error:','content','querySelector','viewportHeight','modalConfirm','random','setHeaderColor','Очистить\x20историю?','BackButton','message\x20ai','#050505','POST','typingIndicator','show','initData','addEventListener','innerHTML','constructor','remove','height','modalTitle','Ошибка\x20сети','ai_chat_messages','WebApp','add','getHours','195041OMFoFP','resize','parse','min','paddingBottom','notificationOccurred','warn','6.1','user','Enter','now','toString','3GKsCZC','touchend','forEach','emptyState','stringify','modalCancel','216mDgfYO','disabled','offClick','target','light','Действие\x20необратимо.','medium','abort','ready','onclick','display','messageInput','createElement','textContent','key','delete-btn','style','appendChild','username','click','isVersionAtLeast','104350imrKsn','div','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','Удалить?','role','onEvent','apply','disableVerticalSwipes','./router.html','keydown','search','focus','padStart','(((.+)+)+)+$','querySelectorAll','shiftKey','none','HapticFeedback','message\x20','.message.show-delete','initDataUnsafe','trim','4719UdvkxT','classList','viewportChanged','6934975sNMZla','touchstart','flex','1437510QeYAST','send_message','1jBtdDR','onClick','offsetHeight','setItem','href','6260356QcYmaj','splice','getElementById','Ошибка\x20сервера','message-bubble','Пустой\x20ответ','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','show-delete','className','1402032ZsekbN','scrollHeight','auto','getMinutes','input','<br>','contains','length','scrollTop','stopPropagation','first_name','text/plain','modalText','impactOccurred','debug_uid','value','6720597dZQeyg'];a0_0x1f2b=function(){return _0x41ac33;};return a0_0x1f2b();}function confirmDelete(_0x34b412){const _0x10ff85=a0_0x29c8bd;if(mTitle)mTitle['textContent']=_0x10ff85(0x200);if(mText)mText[_0x10ff85(0x1f5)]=_0x10ff85(0x1ed);modalCallback=()=>{const _0x4bc980=_0x10ff85;messages[_0x4bc980(0x221)](_0x34b412,0x1),localStorage[_0x4bc980(0x21e)](_0x4bc980(0x1d2),JSON[_0x4bc980(0x1e6)](messages)),renderMessages();},modal[_0x10ff85(0x214)][_0x10ff85(0x1d4)]('show');}if(clearBtn)clearBtn[a0_0x29c8bd(0x1f1)]=()=>{const _0x1f8131=a0_0x29c8bd;if(!messages[_0x1f8131(0x230)])return;if(mTitle)mTitle['textContent']=_0x1f8131(0x244);if(mText)mText[_0x1f8131(0x1f5)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0xee57c2=_0x1f8131;messages=[],localStorage['removeItem'](_0xee57c2(0x1d2)),renderMessages(),callBackend('clear_history',{});},modal[_0x1f8131(0x214)][_0x1f8131(0x1d4)]('show');};document[a0_0x29c8bd(0x222)](a0_0x29c8bd(0x1e7))[a0_0x29c8bd(0x1f1)]=()=>modal['classList'][a0_0x29c8bd(0x24f)](a0_0x29c8bd(0x24a)),document[a0_0x29c8bd(0x222)](a0_0x29c8bd(0x241))[a0_0x29c8bd(0x1f1)]=()=>{const _0x1855f9=a0_0x29c8bd;if(modalCallback)modalCallback();modal[_0x1855f9(0x214)][_0x1855f9(0x24f)](_0x1855f9(0x24a));},messageInput[a0_0x29c8bd(0x24c)](a0_0x29c8bd(0x22d),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x29c8bd(0x24c)](a0_0x29c8bd(0x206),_0x5f0f6e=>{const _0x541a57=a0_0x29c8bd;_0x5f0f6e[_0x541a57(0x1f6)]===_0x541a57(0x1df)&&!_0x5f0f6e[_0x541a57(0x20c)]&&(_0x5f0f6e['preventDefault'](),sendMessage());}),sendBtn[a0_0x29c8bd(0x1f1)]=sendMessage,document[a0_0x29c8bd(0x24c)](a0_0x29c8bd(0x1fb),_0x4a77cf=>{const _0x53aee0=a0_0x29c8bd;document[_0x53aee0(0x20b)](_0x53aee0(0x210))[_0x53aee0(0x1e4)](_0x2a839b=>{const _0x4858c8=_0x53aee0;if(!_0x2a839b[_0x4858c8(0x22f)](_0x4a77cf[_0x4858c8(0x1eb)]))_0x2a839b[_0x4858c8(0x214)][_0x4858c8(0x24f)]('show-delete');});});const saved=localStorage[a0_0x29c8bd(0x23a)](a0_0x29c8bd(0x1d2));if(saved)try{messages=JSON[a0_0x29c8bd(0x1d8)](saved),renderMessages();}catch(a0_0x372681){}updateSendButton();