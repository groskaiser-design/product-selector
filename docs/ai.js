const a0_0x2ca7d8=a0_0x14f5;(function(_0x3ca218,_0x111b7c){const _0x438cab=a0_0x14f5,_0x401085=_0x3ca218();while(!![]){try{const _0x22ef97=-parseInt(_0x438cab(0x1e5))/0x1*(parseInt(_0x438cab(0x204))/0x2)+-parseInt(_0x438cab(0x1f4))/0x3+-parseInt(_0x438cab(0x211))/0x4+parseInt(_0x438cab(0x1bf))/0x5*(-parseInt(_0x438cab(0x1ef))/0x6)+parseInt(_0x438cab(0x1f6))/0x7+parseInt(_0x438cab(0x1e3))/0x8+parseInt(_0x438cab(0x20b))/0x9*(parseInt(_0x438cab(0x1b3))/0xa);if(_0x22ef97===_0x111b7c)break;else _0x401085['push'](_0x401085['shift']());}catch(_0x1ef528){_0x401085['push'](_0x401085['shift']());}}}(a0_0x5394,0x79e8f));const tg=window[a0_0x2ca7d8(0x1f3)]?.['WebApp'],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x15117e=a0_0x2ca7d8;if(!tg)return;try{tg[_0x15117e(0x1b1)](),tg[_0x15117e(0x210)](),tg['setHeaderColor']?.(_0x15117e(0x21a));if(tg[_0x15117e(0x206)]?.(_0x15117e(0x21b)))tg[_0x15117e(0x201)]?.();const _0x863c58=tg[_0x15117e(0x20c)];if(_0x863c58){_0x863c58['show']();if(typeof _0x863c58['offClick']==='function')try{_0x863c58['offClick']();}catch(_0x3143cd){}_0x863c58[_0x15117e(0x1d6)](()=>{const _0x572567=_0x15117e;if(tg[_0x572567(0x1c8)])tg['HapticFeedback'][_0x572567(0x1ca)](_0x572567(0x21d));location['href']=HOME_URL;});}}catch(_0x56351a){console[_0x15117e(0x1dd)](_0x15117e(0x1ea),_0x56351a);}}(function initStableLayout(){const _0x5c4e79=a0_0x2ca7d8,_0x1ad694=(function(){let _0xf203f4=!![];return function(_0xc15bf8,_0x1f1106){const _0x3abd52=_0xf203f4?function(){if(_0x1f1106){const _0xe0df04=_0x1f1106['apply'](_0xc15bf8,arguments);return _0x1f1106=null,_0xe0df04;}}:function(){};return _0xf203f4=![],_0x3abd52;};}()),_0x5ee64a=document['querySelector'](_0x5c4e79(0x1fd)),_0x51ca42=document[_0x5c4e79(0x1bd)](_0x5c4e79(0x1b2)),_0x4ae0d8=document[_0x5c4e79(0x1bd)](_0x5c4e79(0x224)),_0x792aaa=document[_0x5c4e79(0x1bd)]('messageInput');function _0x3d9276(){const _0xee292f=_0x5c4e79,_0x1da544=_0x1ad694(this,function(){const _0xf3e79b=a0_0x14f5;return _0x1da544[_0xf3e79b(0x202)]()[_0xf3e79b(0x1f7)](_0xf3e79b(0x1c0))[_0xf3e79b(0x202)]()['constructor'](_0x1da544)['search'](_0xf3e79b(0x1c0));});_0x1da544();if(!_0x5ee64a)return;const _0x5a9df9=tg&&tg[_0xee292f(0x1de)]?tg[_0xee292f(0x1de)]:window[_0xee292f(0x1da)];_0x5ee64a[_0xee292f(0x221)][_0xee292f(0x1ae)]=_0x5a9df9+'px';if(_0x51ca42){const _0x1e99df=_0x51ca42['offsetHeight'];_0x4ae0d8[_0xee292f(0x221)]['paddingBottom']=_0x1e99df+0x28+'px';}}tg?tg[_0x5c4e79(0x1e7)](_0x5c4e79(0x1ad),({isStateStable:_0xc092b8})=>{_0x3d9276();if(_0xc092b8)requestAnimationFrame(()=>{const _0x2113af=a0_0x14f5;_0x4ae0d8['scrollTop']=_0x4ae0d8[_0x2113af(0x1ec)];});}):window[_0x5c4e79(0x1e2)](_0x5c4e79(0x222),_0x3d9276),_0x3d9276(),_0x792aaa&&(_0x792aaa['addEventListener'](_0x5c4e79(0x220),()=>{requestAnimationFrame(_0x3d9276);}),_0x792aaa[_0x5c4e79(0x1e2)](_0x5c4e79(0x1c2),()=>{setTimeout(()=>{const _0x2a5232=a0_0x14f5;_0x4ae0d8[_0x2a5232(0x1b4)]=_0x4ae0d8[_0x2a5232(0x1ec)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;function a0_0x14f5(_0x20cd2b,_0x4eb5d8){_0x20cd2b=_0x20cd2b-0x1ad;const _0x10a871=a0_0x5394();let _0x2bb975=_0x10a871[_0x20cd2b];return _0x2bb975;}let messages=[],isTyping=![];const chatArea=document[a0_0x2ca7d8(0x1bd)](a0_0x2ca7d8(0x224)),emptyState=document[a0_0x2ca7d8(0x1bd)](a0_0x2ca7d8(0x215)),messageInput=document[a0_0x2ca7d8(0x1bd)](a0_0x2ca7d8(0x213)),sendBtn=document[a0_0x2ca7d8(0x1bd)](a0_0x2ca7d8(0x1be)),clearBtn=document[a0_0x2ca7d8(0x1bd)]('clearBtn'),modal=document[a0_0x2ca7d8(0x1bd)](a0_0x2ca7d8(0x21e)),mTitle=document['getElementById'](a0_0x2ca7d8(0x1ee)),mText=document[a0_0x2ca7d8(0x1bd)](a0_0x2ca7d8(0x1c4));let modalCallback=null;async function callBackend(_0x5bbac1,_0x89dca4){const _0x52c919=a0_0x2ca7d8,_0x13952c=tg?.[_0x52c919(0x1c5)]?.[_0x52c919(0x1cc)]||{},_0x2eb618=_0x13952c['id']||localStorage[_0x52c919(0x1fa)](_0x52c919(0x218))||'d-'+Math[_0x52c919(0x1df)](Math[_0x52c919(0x216)]()*0x3b9aca00);if(!_0x13952c['id'])localStorage['setItem'](_0x52c919(0x218),_0x2eb618);const _0x3ff154={'action':_0x5bbac1,'user_id':_0x2eb618,'user_data':{'first_name':_0x13952c[_0x52c919(0x1d7)],'username':_0x13952c['username']},'init_data':tg?.[_0x52c919(0x1ba)]||'',..._0x89dca4},_0x3bdeff=new AbortController(),_0x17cfc5=setTimeout(()=>_0x3bdeff[_0x52c919(0x1ce)](),REQUEST_TIMEOUT_MS);try{const _0x314fd2=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x52c919(0x20e)},'body':JSON[_0x52c919(0x223)](_0x3ff154),'signal':_0x3bdeff[_0x52c919(0x1c9)]});return clearTimeout(_0x17cfc5),await _0x314fd2['json']();}catch(_0x4f327e){return{'success':![],'error':String(_0x4f327e)};}}function a0_0x5394(){const _0x52ad1a=['inputArea','160mPGCWS','scrollTop','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','push','classList','onclick','stopPropagation','initData','textContent','trim','getElementById','sendBtn','2443855EkYXtn','(((.+)+)+)+$','message\x20ai','focus','setItem','modalText','initDataUnsafe','<br>','show','HapticFeedback','signal','impactOccurred','click','user','ai_chat_messages','abort','send_message','Ошибка\x20сервера','from','now','target','parse','Пустой\x20ответ','onClick','first_name','keydown','padStart','innerHeight','Очистить\x20историю?','getHours','warn','viewportHeight','floor','div','notificationOccurred','addEventListener','369928VacdUg','key','37lUNthP','value','onEvent','shiftKey','typingIndicator','TG\x20setup\x20error:','display','scrollHeight','createElement','modalTitle','6yrshOU','min','Начнется\x20новый\x20диалог.','className','Telegram','1859553lGGbFV','show-delete','5982095nTZwQC','search','children','forEach','getItem','role','message-bubble','.container','medium','remove','error','disableVerticalSwipes','toString','preventDefault','8916BqjSkw','timestamp','isVersionAtLeast','touchend','modalCancel','innerHTML','text','926883XDCsxK','BackButton','delete-btn','text/plain','Enter','expand','3102828ITnyxW','modalConfirm','messageInput','success','emptyState','random','length','debug_uid','touchstart','#050505','6.1','replace','light','confirmModal','appendChild','input','style','resize','stringify','chatArea','flex','add','viewportChanged','height','splice','clear_history','ready'];a0_0x5394=function(){return _0x52ad1a;};return a0_0x5394();}function formatTime(_0x8db848){const _0x2ba2fc=a0_0x2ca7d8,_0x43ccf4=new Date(_0x8db848);return String(_0x43ccf4[_0x2ba2fc(0x1dc)]())[_0x2ba2fc(0x1d9)](0x2,'0')+':'+String(_0x43ccf4['getMinutes']())[_0x2ba2fc(0x1d9)](0x2,'0');}function createMessageElement(_0x12e628,_0x757e2c){const _0x2d7a7e=a0_0x2ca7d8,_0x3880ba=document[_0x2d7a7e(0x1ed)](_0x2d7a7e(0x1e0));_0x3880ba[_0x2d7a7e(0x1f2)]='message\x20'+_0x12e628[_0x2d7a7e(0x1fb)];const _0x11d76f=document[_0x2d7a7e(0x1ed)]('div');_0x11d76f['className']=_0x2d7a7e(0x1fc),_0x11d76f[_0x2d7a7e(0x209)]=_0x12e628['content'][_0x2d7a7e(0x21c)](/\n/g,_0x2d7a7e(0x1c6));const _0x2bdaf5=document['createElement'](_0x2d7a7e(0x1e0));_0x2bdaf5[_0x2d7a7e(0x1f2)]=_0x2d7a7e(0x20d),_0x2bdaf5[_0x2d7a7e(0x209)]=_0x2d7a7e(0x1b5),_0x2bdaf5['onclick']=_0x6e8e26=>{const _0x3a7607=_0x2d7a7e;_0x6e8e26[_0x3a7607(0x1b9)](),confirmDelete(_0x757e2c);};let _0x512ce8;_0x11d76f[_0x2d7a7e(0x1e2)](_0x2d7a7e(0x219),()=>_0x512ce8=setTimeout(()=>{const _0x554c3c=_0x2d7a7e;_0x3880ba['classList'][_0x554c3c(0x226)](_0x554c3c(0x1f5));if(tg?.[_0x554c3c(0x1c8)])tg['HapticFeedback'][_0x554c3c(0x1ca)](_0x554c3c(0x1fe));},0x1f4)),_0x11d76f[_0x2d7a7e(0x1e2)](_0x2d7a7e(0x207),()=>clearTimeout(_0x512ce8));const _0x23e129=document['createElement']('div');return _0x23e129[_0x2d7a7e(0x1f2)]='message-time',_0x23e129['textContent']=formatTime(_0x12e628[_0x2d7a7e(0x205)]),_0x3880ba[_0x2d7a7e(0x21f)](_0x2bdaf5),_0x3880ba['appendChild'](_0x11d76f),_0x3880ba[_0x2d7a7e(0x21f)](_0x23e129),_0x3880ba;}function createTypingIndicator(){const _0x44ed9a=a0_0x2ca7d8,_0x2e527=document[_0x44ed9a(0x1ed)](_0x44ed9a(0x1e0));return _0x2e527[_0x44ed9a(0x1f2)]=_0x44ed9a(0x1c1),_0x2e527['id']=_0x44ed9a(0x1e9),_0x2e527[_0x44ed9a(0x209)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x2e527;}function renderMessages(){const _0x623bfe=a0_0x2ca7d8;Array[_0x623bfe(0x1d1)](chatArea[_0x623bfe(0x1f8)])[_0x623bfe(0x1f9)](_0x404335=>{const _0x540d57=_0x623bfe;if(_0x404335['id']!=='emptyState')_0x404335[_0x540d57(0x1ff)]();}),messages['length']>0x0?(emptyState[_0x623bfe(0x221)]['display']='none',messages[_0x623bfe(0x1f9)]((_0xd8c4fe,_0x5f2739)=>chatArea[_0x623bfe(0x21f)](createMessageElement(_0xd8c4fe,_0x5f2739)))):emptyState['style'][_0x623bfe(0x1eb)]=_0x623bfe(0x225),requestAnimationFrame(()=>chatArea[_0x623bfe(0x1b4)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x322464=a0_0x2ca7d8;messageInput[_0x322464(0x221)][_0x322464(0x1ae)]='auto',messageInput['style'][_0x322464(0x1ae)]=Math[_0x322464(0x1f0)](messageInput[_0x322464(0x1ec)],0x78)+'px';}function updateSendButton(){const _0x488546=a0_0x2ca7d8,_0xd696cf=messageInput[_0x488546(0x1e6)][_0x488546(0x1bc)]();sendBtn['disabled']=!_0xd696cf||isTyping;}async function sendMessage(){const _0x4fc85f=a0_0x2ca7d8,_0x58dcc2=messageInput['value'][_0x4fc85f(0x1bc)]();if(!_0x58dcc2||isTyping)return;if(tg?.[_0x4fc85f(0x1c8)])tg[_0x4fc85f(0x1c8)]['impactOccurred'](_0x4fc85f(0x21d));messages[_0x4fc85f(0x1b6)]({'role':_0x4fc85f(0x1cc),'content':_0x58dcc2,'timestamp':Date[_0x4fc85f(0x1d2)]()}),localStorage[_0x4fc85f(0x1c3)](_0x4fc85f(0x1cd),JSON[_0x4fc85f(0x223)](messages)),renderMessages(),messageInput[_0x4fc85f(0x1e6)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x4fc85f(0x1ec)];const _0x17899b=await callBackend(_0x4fc85f(0x1cf),{'message':_0x58dcc2});isTyping=![];const _0x179ee5=document[_0x4fc85f(0x1bd)]('typingIndicator');if(_0x179ee5)_0x179ee5[_0x4fc85f(0x1ff)]();let _0x43721d='Ошибка\x20сети';if(_0x17899b[_0x4fc85f(0x214)]){_0x43721d=_0x17899b[_0x4fc85f(0x20a)]||_0x4fc85f(0x1d5);if(tg?.[_0x4fc85f(0x1c8)])tg['HapticFeedback']['notificationOccurred'](_0x4fc85f(0x214));}else{_0x43721d=_0x17899b[_0x4fc85f(0x200)]||_0x4fc85f(0x1d0);if(tg?.[_0x4fc85f(0x1c8)])tg['HapticFeedback'][_0x4fc85f(0x1e1)]('error');}messages[_0x4fc85f(0x1b6)]({'role':'ai','content':_0x43721d,'timestamp':Date[_0x4fc85f(0x1d2)]()}),localStorage['setItem'](_0x4fc85f(0x1cd),JSON[_0x4fc85f(0x223)](messages)),renderMessages();}function confirmDelete(_0x2eab80){const _0x19b046=a0_0x2ca7d8;if(mTitle)mTitle[_0x19b046(0x1bb)]='Удалить?';if(mText)mText[_0x19b046(0x1bb)]='Действие\x20необратимо.';modalCallback=()=>{const _0x2b0dc9=_0x19b046;messages[_0x2b0dc9(0x1af)](_0x2eab80,0x1),localStorage[_0x2b0dc9(0x1c3)](_0x2b0dc9(0x1cd),JSON[_0x2b0dc9(0x223)](messages)),renderMessages();},modal[_0x19b046(0x1b7)]['add'](_0x19b046(0x1c7));}if(clearBtn)clearBtn[a0_0x2ca7d8(0x1b8)]=()=>{const _0x191c8c=a0_0x2ca7d8;if(!messages[_0x191c8c(0x217)])return;if(mTitle)mTitle[_0x191c8c(0x1bb)]=_0x191c8c(0x1db);if(mText)mText[_0x191c8c(0x1bb)]=_0x191c8c(0x1f1);modalCallback=async()=>{const _0x8986be=_0x191c8c;messages=[],localStorage['removeItem'](_0x8986be(0x1cd)),renderMessages(),callBackend(_0x8986be(0x1b0),{});},modal[_0x191c8c(0x1b7)][_0x191c8c(0x226)]('show');};document[a0_0x2ca7d8(0x1bd)](a0_0x2ca7d8(0x208))[a0_0x2ca7d8(0x1b8)]=()=>modal['classList']['remove'](a0_0x2ca7d8(0x1c7)),document[a0_0x2ca7d8(0x1bd)](a0_0x2ca7d8(0x212))[a0_0x2ca7d8(0x1b8)]=()=>{const _0x1db4d7=a0_0x2ca7d8;if(modalCallback)modalCallback();modal['classList'][_0x1db4d7(0x1ff)](_0x1db4d7(0x1c7));},messageInput[a0_0x2ca7d8(0x1e2)](a0_0x2ca7d8(0x220),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2ca7d8(0x1e2)](a0_0x2ca7d8(0x1d8),_0x17085e=>{const _0x2050bb=a0_0x2ca7d8;_0x17085e[_0x2050bb(0x1e4)]===_0x2050bb(0x20f)&&!_0x17085e[_0x2050bb(0x1e8)]&&(_0x17085e[_0x2050bb(0x203)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x2ca7d8(0x1e2)](a0_0x2ca7d8(0x1cb),_0x3e002e=>{const _0x2b8df3=a0_0x2ca7d8;document['querySelectorAll']('.message.show-delete')[_0x2b8df3(0x1f9)](_0x2d4a04=>{const _0x528413=_0x2b8df3;if(!_0x2d4a04['contains'](_0x3e002e[_0x528413(0x1d3)]))_0x2d4a04[_0x528413(0x1b7)][_0x528413(0x1ff)]('show-delete');});});const saved=localStorage[a0_0x2ca7d8(0x1fa)](a0_0x2ca7d8(0x1cd));if(saved)try{messages=JSON[a0_0x2ca7d8(0x1d4)](saved),renderMessages();}catch(a0_0x25e2c4){}updateSendButton();