const a0_0x199483=a0_0x46eb;(function(_0x5da003,_0x497297){const _0x42e1a6=a0_0x46eb,_0x249722=_0x5da003();while(!![]){try{const _0x26ca41=-parseInt(_0x42e1a6(0x121))/0x1+-parseInt(_0x42e1a6(0xfa))/0x2+-parseInt(_0x42e1a6(0x10f))/0x3*(-parseInt(_0x42e1a6(0x126))/0x4)+-parseInt(_0x42e1a6(0x13b))/0x5*(parseInt(_0x42e1a6(0x122))/0x6)+-parseInt(_0x42e1a6(0x146))/0x7*(parseInt(_0x42e1a6(0x132))/0x8)+-parseInt(_0x42e1a6(0x14d))/0x9*(parseInt(_0x42e1a6(0x137))/0xa)+-parseInt(_0x42e1a6(0x15b))/0xb*(-parseInt(_0x42e1a6(0x106))/0xc);if(_0x26ca41===_0x497297)break;else _0x249722['push'](_0x249722['shift']());}catch(_0x53fe18){_0x249722['push'](_0x249722['shift']());}}}(a0_0x1a7e,0xd535b));const tg=window[a0_0x199483(0x11c)]?.[a0_0x199483(0x13c)],HOME_URL=a0_0x199483(0x151);function setupTelegramBackButton(){const _0x56d52d=a0_0x199483;if(!tg)return;try{tg[_0x56d52d(0x14a)](),tg[_0x56d52d(0x128)](),tg['setHeaderColor']?.(_0x56d52d(0x14c));if(tg[_0x56d52d(0xdf)]?.(_0x56d52d(0x15d)))tg[_0x56d52d(0x11e)]?.();const _0x276e14=tg['BackButton'];if(_0x276e14){_0x276e14[_0x56d52d(0x12b)]();if(typeof _0x276e14[_0x56d52d(0x116)]===_0x56d52d(0x156))try{_0x276e14[_0x56d52d(0x116)]();}catch(_0x269ed6){}_0x276e14[_0x56d52d(0x141)](()=>{const _0xd96029=_0x56d52d;if(tg[_0xd96029(0x11d)])tg[_0xd96029(0x11d)][_0xd96029(0x148)](_0xd96029(0xff));location[_0xd96029(0x119)]=HOME_URL;});}}catch(_0x15b80f){console['warn'](_0x56d52d(0x12c),_0x15b80f);}}(function initStableLayout(){const _0x3108d2=a0_0x199483,_0x56dbba=(function(){let _0x2adfac=!![];return function(_0x3c0b14,_0x2c1131){const _0x27cb41=_0x2adfac?function(){const _0x47dd38=a0_0x46eb;if(_0x2c1131){const _0xfbdf9e=_0x2c1131[_0x47dd38(0x123)](_0x3c0b14,arguments);return _0x2c1131=null,_0xfbdf9e;}}:function(){};return _0x2adfac=![],_0x27cb41;};}()),_0x4b503f=document[_0x3108d2(0xfb)](_0x3108d2(0xf4)),_0x150194=document[_0x3108d2(0x152)](_0x3108d2(0xe0)),_0x2537af=document[_0x3108d2(0x152)](_0x3108d2(0x15a)),_0x5c50da=document['getElementById'](_0x3108d2(0x144));function _0x1ca718(){const _0x3ce0e3=_0x3108d2,_0x4a5326=_0x56dbba(this,function(){const _0x262783=a0_0x46eb;return _0x4a5326[_0x262783(0x129)]()[_0x262783(0x143)](_0x262783(0x145))['toString']()[_0x262783(0xeb)](_0x4a5326)[_0x262783(0x143)](_0x262783(0x145));});_0x4a5326();if(!_0x4b503f)return;const _0x2ffb0d=tg&&tg['viewportHeight']?tg[_0x3ce0e3(0xf8)]:window['innerHeight'];_0x4b503f['style'][_0x3ce0e3(0xfd)]=_0x2ffb0d+'px';if(_0x150194){const _0x5f522c=_0x150194[_0x3ce0e3(0x120)];_0x2537af[_0x3ce0e3(0x107)][_0x3ce0e3(0x117)]=_0x5f522c+0x28+'px';}}tg?tg[_0x3108d2(0x147)]('viewportChanged',({isStateStable:_0x57f593})=>{_0x1ca718();if(_0x57f593)requestAnimationFrame(()=>{const _0x58a953=a0_0x46eb;_0x2537af['scrollTop']=_0x2537af[_0x58a953(0x158)];});}):window[_0x3108d2(0x118)]('resize',_0x1ca718),_0x1ca718(),_0x5c50da&&(_0x5c50da[_0x3108d2(0x118)](_0x3108d2(0x10d),()=>{requestAnimationFrame(_0x1ca718);}),_0x5c50da[_0x3108d2(0x118)](_0x3108d2(0x138),()=>{setTimeout(()=>{const _0x153509=a0_0x46eb;_0x2537af[_0x153509(0xde)]=_0x2537af[_0x153509(0x158)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x199483(0x134),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x199483(0x152)](a0_0x199483(0x15a)),emptyState=document[a0_0x199483(0x152)](a0_0x199483(0xdc)),messageInput=document['getElementById'](a0_0x199483(0x144)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x199483(0x152)](a0_0x199483(0x10e)),modal=document[a0_0x199483(0x152)]('confirmModal'),mTitle=document[a0_0x199483(0x152)](a0_0x199483(0xdd)),mText=document[a0_0x199483(0x152)](a0_0x199483(0xd9));let modalCallback=null;async function callBackend(_0x2d84fd,_0x5529a4){const _0x2f5f39=a0_0x199483,_0x2a74a7=tg?.[_0x2f5f39(0x15c)]?.[_0x2f5f39(0xe5)]||{},_0x3d7ecb=_0x2a74a7['id']||localStorage['getItem'](_0x2f5f39(0x12e))||'d-'+Math[_0x2f5f39(0xf0)](Math[_0x2f5f39(0x13a)]()*0x3b9aca00);if(!_0x2a74a7['id'])localStorage[_0x2f5f39(0xfc)](_0x2f5f39(0x12e),_0x3d7ecb);const _0x4caaaf={'action':_0x2d84fd,'user_id':_0x3d7ecb,'user_data':{'first_name':_0x2a74a7[_0x2f5f39(0xea)],'username':_0x2a74a7[_0x2f5f39(0xf5)]},'init_data':tg?.[_0x2f5f39(0x114)]||'',..._0x5529a4},_0x4c50bb=new AbortController(),_0x52cc20=setTimeout(()=>_0x4c50bb['abort'](),REQUEST_TIMEOUT_MS);try{const _0x21041d=await fetch(BACKEND_URL,{'method':_0x2f5f39(0x125),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x2f5f39(0x104)](_0x4caaaf),'signal':_0x4c50bb[_0x2f5f39(0x157)]});return clearTimeout(_0x52cc20),await _0x21041d[_0x2f5f39(0x112)]();}catch(_0x47260f){return{'success':![],'error':String(_0x47260f)};}}function formatTime(_0x559dee){const _0x513e5b=a0_0x199483,_0x5dacea=new Date(_0x559dee);return String(_0x5dacea[_0x513e5b(0x150)]())[_0x513e5b(0x12a)](0x2,'0')+':'+String(_0x5dacea[_0x513e5b(0xe1)]())[_0x513e5b(0x12a)](0x2,'0');}function createMessageElement(_0x123ab7,_0x250fb2){const _0x57106c=a0_0x199483,_0x49452e=document['createElement'](_0x57106c(0xe6));_0x49452e['className']='message\x20'+_0x123ab7['role'];const _0xa6872b=document[_0x57106c(0x11b)](_0x57106c(0xe6));_0xa6872b[_0x57106c(0x14e)]=_0x57106c(0xf1),_0xa6872b[_0x57106c(0x10a)]=_0x123ab7[_0x57106c(0x11a)][_0x57106c(0x131)](/\n/g,'<br>');const _0x5c902c=document[_0x57106c(0x11b)](_0x57106c(0xe6));_0x5c902c['className']=_0x57106c(0xe3),_0x5c902c[_0x57106c(0x10a)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x5c902c[_0x57106c(0x101)]=_0x1b9830=>{const _0x16380a=_0x57106c;_0x1b9830[_0x16380a(0x102)](),confirmDelete(_0x250fb2);};let _0x276e45;_0xa6872b[_0x57106c(0x118)]('touchstart',()=>_0x276e45=setTimeout(()=>{const _0x4c20d4=_0x57106c;_0x49452e['classList'][_0x4c20d4(0xe2)](_0x4c20d4(0x110));if(tg?.[_0x4c20d4(0x11d)])tg[_0x4c20d4(0x11d)][_0x4c20d4(0x148)](_0x4c20d4(0x12f));},0x1f4)),_0xa6872b[_0x57106c(0x118)](_0x57106c(0x155),()=>clearTimeout(_0x276e45));const _0x42f7fe=document['createElement'](_0x57106c(0xe6));return _0x42f7fe[_0x57106c(0x14e)]=_0x57106c(0xe9),_0x42f7fe[_0x57106c(0xda)]=formatTime(_0x123ab7[_0x57106c(0xf2)]),_0x49452e['appendChild'](_0x5c902c),_0x49452e['appendChild'](_0xa6872b),_0x49452e[_0x57106c(0x100)](_0x42f7fe),_0x49452e;}function createTypingIndicator(){const _0x3c7d2a=a0_0x199483,_0x253ec9=document[_0x3c7d2a(0x11b)](_0x3c7d2a(0xe6));return _0x253ec9[_0x3c7d2a(0x14e)]=_0x3c7d2a(0x153),_0x253ec9['id']=_0x3c7d2a(0x13d),_0x253ec9[_0x3c7d2a(0x10a)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x253ec9;}function renderMessages(){const _0x58c7d6=a0_0x199483;Array[_0x58c7d6(0x103)](chatArea[_0x58c7d6(0xf6)])[_0x58c7d6(0x10b)](_0x238bc2=>{const _0x349ee0=_0x58c7d6;if(_0x238bc2['id']!==_0x349ee0(0xdc))_0x238bc2[_0x349ee0(0x142)]();}),messages[_0x58c7d6(0x136)]>0x0?(emptyState[_0x58c7d6(0x107)][_0x58c7d6(0xef)]=_0x58c7d6(0x14f),messages[_0x58c7d6(0x10b)]((_0x37b7cb,_0x5b500c)=>chatArea[_0x58c7d6(0x100)](createMessageElement(_0x37b7cb,_0x5b500c)))):emptyState[_0x58c7d6(0x107)][_0x58c7d6(0xef)]=_0x58c7d6(0x135),requestAnimationFrame(()=>chatArea[_0x58c7d6(0xde)]=chatArea[_0x58c7d6(0x158)]);}function autoResizeTextarea(){const _0xe610e2=a0_0x199483;messageInput[_0xe610e2(0x107)][_0xe610e2(0xfd)]=_0xe610e2(0xe8),messageInput[_0xe610e2(0x107)][_0xe610e2(0xfd)]=Math['min'](messageInput[_0xe610e2(0x158)],0x78)+'px';}function updateSendButton(){const _0xf38adf=a0_0x199483,_0x231a50=messageInput[_0xf38adf(0xed)][_0xf38adf(0x111)]();sendBtn[_0xf38adf(0xdb)]=!_0x231a50||isTyping;}async function sendMessage(){const _0x5204ae=a0_0x199483,_0x4724fd=messageInput[_0x5204ae(0xed)]['trim']();if(!_0x4724fd||isTyping)return;if(tg?.[_0x5204ae(0x11d)])tg['HapticFeedback'][_0x5204ae(0x148)](_0x5204ae(0xff));messages[_0x5204ae(0xec)]({'role':_0x5204ae(0xe5),'content':_0x4724fd,'timestamp':Date[_0x5204ae(0x139)]()}),localStorage[_0x5204ae(0xfc)](_0x5204ae(0xee),JSON[_0x5204ae(0x104)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5204ae(0x100)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x32d786=await callBackend(_0x5204ae(0x13e),{'message':_0x4724fd});isTyping=![];const _0x1886d7=document[_0x5204ae(0x152)](_0x5204ae(0x13d));if(_0x1886d7)_0x1886d7[_0x5204ae(0x142)]();let _0x4e24fe=_0x5204ae(0x149);if(_0x32d786['success']){_0x4e24fe=_0x32d786[_0x5204ae(0xe7)]||_0x5204ae(0xf3);if(tg?.[_0x5204ae(0x11d)])tg[_0x5204ae(0x11d)]['notificationOccurred'](_0x5204ae(0x12d));}else{_0x4e24fe=_0x32d786[_0x5204ae(0x154)]||_0x5204ae(0x14b);if(tg?.['HapticFeedback'])tg[_0x5204ae(0x11d)][_0x5204ae(0x105)](_0x5204ae(0x154));}messages[_0x5204ae(0xec)]({'role':'ai','content':_0x4e24fe,'timestamp':Date['now']()}),localStorage[_0x5204ae(0xfc)](_0x5204ae(0xee),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x477fc1){const _0x425aca=a0_0x199483;if(mTitle)mTitle[_0x425aca(0xda)]='Удалить?';if(mText)mText[_0x425aca(0xda)]=_0x425aca(0xfe);modalCallback=()=>{const _0x146409=_0x425aca;messages[_0x146409(0x124)](_0x477fc1,0x1),localStorage[_0x146409(0xfc)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x425aca(0x159)]['add'](_0x425aca(0x12b));}if(clearBtn)clearBtn[a0_0x199483(0x101)]=()=>{const _0x393cd2=a0_0x199483;if(!messages['length'])return;if(mTitle)mTitle[_0x393cd2(0xda)]=_0x393cd2(0xf9);if(mText)mText[_0x393cd2(0xda)]=_0x393cd2(0x140);modalCallback=async()=>{const _0x38c0c4=_0x393cd2;messages=[],localStorage[_0x38c0c4(0x130)]('ai_chat_messages'),renderMessages(),callBackend(_0x38c0c4(0x133),{});},modal[_0x393cd2(0x159)][_0x393cd2(0xe2)](_0x393cd2(0x12b));};document[a0_0x199483(0x152)]('modalCancel')[a0_0x199483(0x101)]=()=>modal[a0_0x199483(0x159)][a0_0x199483(0x142)](a0_0x199483(0x12b)),document[a0_0x199483(0x152)](a0_0x199483(0xe4))[a0_0x199483(0x101)]=()=>{const _0x4a4f4f=a0_0x199483;if(modalCallback)modalCallback();modal[_0x4a4f4f(0x159)][_0x4a4f4f(0x142)]('show');},messageInput[a0_0x199483(0x118)](a0_0x199483(0x10d),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x199483(0x118)](a0_0x199483(0x113),_0x3aaf67=>{const _0x3337e8=a0_0x199483;_0x3aaf67[_0x3337e8(0x13f)]===_0x3337e8(0x11f)&&!_0x3aaf67[_0x3337e8(0x10c)]&&(_0x3aaf67['preventDefault'](),sendMessage());}),sendBtn[a0_0x199483(0x101)]=sendMessage,document[a0_0x199483(0x118)](a0_0x199483(0xf7),_0x478798=>{const _0x344f73=a0_0x199483;document[_0x344f73(0x108)]('.message.show-delete')[_0x344f73(0x10b)](_0xe640f7=>{const _0x53af63=_0x344f73;if(!_0xe640f7[_0x53af63(0x127)](_0x478798['target']))_0xe640f7['classList'][_0x53af63(0x142)](_0x53af63(0x110));});});function a0_0x1a7e(){const _0x271ece=['random','50QoQFPf','WebApp','typingIndicator','send_message','key','Начнется\x20новый\x20диалог.','onClick','remove','search','messageInput','(((.+)+)+)+$','10181885teXdXk','onEvent','impactOccurred','Ошибка\x20сети','ready','Ошибка\x20сервера','#050505','26307LqelHA','className','none','getHours','./router.html','getElementById','message\x20ai','error','touchend','function','signal','scrollHeight','classList','chatArea','35761sEeQts','initDataUnsafe','6.1','modalText','textContent','disabled','emptyState','modalTitle','scrollTop','isVersionAtLeast','inputArea','getMinutes','add','delete-btn','modalConfirm','user','div','text','auto','message-time','first_name','constructor','push','value','ai_chat_messages','display','floor','message-bubble','timestamp','Пустой\x20ответ','.container','username','children','click','viewportHeight','Очистить\x20историю?','3127768wfksKr','querySelector','setItem','height','Действие\x20необратимо.','light','appendChild','onclick','stopPropagation','from','stringify','notificationOccurred','14160pDYCoM','style','querySelectorAll','parse','innerHTML','forEach','shiftKey','input','clearBtn','141fLRKax','show-delete','trim','json','keydown','initData','getItem','offClick','paddingBottom','addEventListener','href','content','createElement','Telegram','HapticFeedback','disableVerticalSwipes','Enter','offsetHeight','218857efdnbc','267252xBdUMe','apply','splice','POST','73204MkCEHz','contains','expand','toString','padStart','show','TG\x20setup\x20error:','success','debug_uid','medium','removeItem','replace','8BKYjWw','clear_history','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','flex','length','480YgfpVr','focus','now'];a0_0x1a7e=function(){return _0x271ece;};return a0_0x1a7e();}const saved=localStorage[a0_0x199483(0x115)](a0_0x199483(0xee));if(saved)try{messages=JSON[a0_0x199483(0x109)](saved),renderMessages();}catch(a0_0x2cbd90){}function a0_0x46eb(_0x4f67c2,_0x55e390){_0x4f67c2=_0x4f67c2-0xd9;const _0x2db2e7=a0_0x1a7e();let _0x366ae5=_0x2db2e7[_0x4f67c2];return _0x366ae5;}updateSendButton();