const a0_0x2246a6=a0_0x30df;(function(_0xd54fc7,_0x5a43ac){const _0x593b9a=a0_0x30df,_0x4525ff=_0xd54fc7();while(!![]){try{const _0x4cf585=parseInt(_0x593b9a(0x1ea))/0x1*(parseInt(_0x593b9a(0x1a3))/0x2)+parseInt(_0x593b9a(0x1e0))/0x3*(parseInt(_0x593b9a(0x189))/0x4)+-parseInt(_0x593b9a(0x1cb))/0x5+parseInt(_0x593b9a(0x1ed))/0x6*(parseInt(_0x593b9a(0x1d0))/0x7)+-parseInt(_0x593b9a(0x1dc))/0x8+-parseInt(_0x593b9a(0x1b6))/0x9+-parseInt(_0x593b9a(0x186))/0xa*(-parseInt(_0x593b9a(0x17e))/0xb);if(_0x4cf585===_0x5a43ac)break;else _0x4525ff['push'](_0x4525ff['shift']());}catch(_0x4cbaa1){_0x4525ff['push'](_0x4525ff['shift']());}}}(a0_0x4adb,0x3a65c));const tg=window[a0_0x2246a6(0x196)]?.[a0_0x2246a6(0x19f)],HOME_URL=a0_0x2246a6(0x18a);function setupTelegramBackButton(){const _0x3d8642=a0_0x2246a6,_0x333610=(function(){let _0x5b3667=!![];return function(_0x418b0b,_0x35f869){const _0x8ad223=_0x5b3667?function(){const _0x191e98=a0_0x30df;if(_0x35f869){const _0x5e807b=_0x35f869[_0x191e98(0x1e7)](_0x418b0b,arguments);return _0x35f869=null,_0x5e807b;}}:function(){};return _0x5b3667=![],_0x8ad223;};}()),_0x12d73a=_0x333610(this,function(){const _0x311b43=a0_0x30df;return _0x12d73a['toString']()[_0x311b43(0x1ba)]('(((.+)+)+)+$')['toString']()['constructor'](_0x12d73a)[_0x311b43(0x1ba)](_0x311b43(0x1a0));});_0x12d73a();if(!tg)return;try{tg['ready'](),tg[_0x3d8642(0x176)](),tg[_0x3d8642(0x1a1)]?.('#050505');if(tg[_0x3d8642(0x1a9)]?.(_0x3d8642(0x1b5)))tg['disableVerticalSwipes']?.();const _0x16a5a1=tg[_0x3d8642(0x1c7)];if(_0x16a5a1){_0x16a5a1[_0x3d8642(0x1c6)]();if(typeof _0x16a5a1[_0x3d8642(0x1aa)]===_0x3d8642(0x185))try{_0x16a5a1[_0x3d8642(0x1aa)]();}catch(_0x33187a){}_0x16a5a1[_0x3d8642(0x17f)](()=>{const _0x11674b=_0x3d8642;if(tg['HapticFeedback'])tg[_0x11674b(0x188)][_0x11674b(0x17a)](_0x11674b(0x182));location['href']=HOME_URL;});}}catch(_0x415182){console[_0x3d8642(0x1b3)](_0x3d8642(0x191),_0x415182);}}(function initStableLayout(){const _0x2cd21f=a0_0x2246a6,_0x5408fd=document[_0x2cd21f(0x1bd)](_0x2cd21f(0x1be)),_0x59b283=document[_0x2cd21f(0x1f2)](_0x2cd21f(0x1ef)),_0x579adc=document[_0x2cd21f(0x1f2)](_0x2cd21f(0x1bc)),_0x32bc17=document[_0x2cd21f(0x1f2)](_0x2cd21f(0x17d));function _0x1c1703(){const _0x1ff4fd=_0x2cd21f;if(!_0x5408fd)return;const _0x45811c=tg&&tg[_0x1ff4fd(0x1c0)]?tg['viewportHeight']:window[_0x1ff4fd(0x19b)];_0x5408fd[_0x1ff4fd(0x1b0)]['height']=_0x45811c+'px';if(_0x59b283){const _0x1dc6b0=_0x59b283[_0x1ff4fd(0x1eb)];_0x579adc[_0x1ff4fd(0x1b0)][_0x1ff4fd(0x1d6)]=_0x1dc6b0+0x28+'px';}}tg?tg[_0x2cd21f(0x1cd)](_0x2cd21f(0x193),({isStateStable:_0x1ab75a})=>{_0x1c1703();if(_0x1ab75a)requestAnimationFrame(()=>{const _0x36cbae=a0_0x30df;_0x579adc[_0x36cbae(0x1cc)]=_0x579adc[_0x36cbae(0x175)];});}):window[_0x2cd21f(0x18e)](_0x2cd21f(0x1c8),_0x1c1703),_0x1c1703(),_0x32bc17&&(_0x32bc17[_0x2cd21f(0x18e)]('input',()=>{requestAnimationFrame(_0x1c1703);}),_0x32bc17['addEventListener'](_0x2cd21f(0x1bb),()=>{setTimeout(()=>{const _0x43e92f=a0_0x30df;_0x579adc['scrollTop']=_0x579adc[_0x43e92f(0x175)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2246a6(0x1b7),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2246a6(0x1f2)]('chatArea'),emptyState=document['getElementById'](a0_0x2246a6(0x174)),messageInput=document[a0_0x2246a6(0x1f2)](a0_0x2246a6(0x17d)),sendBtn=document[a0_0x2246a6(0x1f2)]('sendBtn'),clearBtn=document[a0_0x2246a6(0x1f2)](a0_0x2246a6(0x1b4)),modal=document['getElementById'](a0_0x2246a6(0x183)),mTitle=document[a0_0x2246a6(0x1f2)](a0_0x2246a6(0x187)),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x232797,_0x4f8e82){const _0x1fc40e=a0_0x2246a6,_0x183b4=tg?.['initDataUnsafe']?.[_0x1fc40e(0x198)]||{},_0x43f1c2=_0x183b4['id']||localStorage[_0x1fc40e(0x197)](_0x1fc40e(0x1dd))||'d-'+Math[_0x1fc40e(0x192)](Math[_0x1fc40e(0x1c1)]()*0x3b9aca00);if(!_0x183b4['id'])localStorage['setItem'](_0x1fc40e(0x1dd),_0x43f1c2);const _0x35e380={'action':_0x232797,'user_id':_0x43f1c2,'user_data':{'first_name':_0x183b4[_0x1fc40e(0x1a2)],'username':_0x183b4[_0x1fc40e(0x1bf)]},'init_data':tg?.['initData']||'',..._0x4f8e82},_0x1bb873=new AbortController(),_0x5596cc=setTimeout(()=>_0x1bb873[_0x1fc40e(0x1c2)](),REQUEST_TIMEOUT_MS);try{const _0x3ebda4=await fetch(BACKEND_URL,{'method':_0x1fc40e(0x18c),'headers':{'Content-Type':_0x1fc40e(0x1da)},'body':JSON['stringify'](_0x35e380),'signal':_0x1bb873[_0x1fc40e(0x1c3)]});return clearTimeout(_0x5596cc),await _0x3ebda4[_0x1fc40e(0x1f0)]();}catch(_0x16a105){return{'success':![],'error':String(_0x16a105)};}}function formatTime(_0x5556c7){const _0x553316=a0_0x2246a6,_0x521bed=new Date(_0x5556c7);return String(_0x521bed[_0x553316(0x1ab)]())[_0x553316(0x199)](0x2,'0')+':'+String(_0x521bed[_0x553316(0x1d8)]())[_0x553316(0x199)](0x2,'0');}function createMessageElement(_0x301e00,_0x1f0ccb){const _0x2b0df1=a0_0x2246a6,_0x929f9b=document['createElement'](_0x2b0df1(0x173));_0x929f9b[_0x2b0df1(0x1e4)]='message\x20'+_0x301e00[_0x2b0df1(0x1e1)];const _0x4580aa=document[_0x2b0df1(0x1d2)](_0x2b0df1(0x173));_0x4580aa[_0x2b0df1(0x1e4)]=_0x2b0df1(0x1f3),_0x4580aa[_0x2b0df1(0x1e9)]=_0x301e00[_0x2b0df1(0x180)][_0x2b0df1(0x1e5)](/\n/g,_0x2b0df1(0x1d5));const _0x21f9fa=document[_0x2b0df1(0x1d2)](_0x2b0df1(0x173));_0x21f9fa[_0x2b0df1(0x1e4)]=_0x2b0df1(0x1ca),_0x21f9fa[_0x2b0df1(0x1e9)]=_0x2b0df1(0x1d4),_0x21f9fa[_0x2b0df1(0x1af)]=_0x472457=>{const _0x52f946=_0x2b0df1;_0x472457[_0x52f946(0x1c9)](),confirmDelete(_0x1f0ccb);};let _0x396e9f;_0x4580aa[_0x2b0df1(0x18e)]('touchstart',()=>_0x396e9f=setTimeout(()=>{const _0x15b506=_0x2b0df1;_0x929f9b[_0x15b506(0x177)][_0x15b506(0x1d9)](_0x15b506(0x1df));if(tg?.[_0x15b506(0x188)])tg['HapticFeedback'][_0x15b506(0x17a)](_0x15b506(0x1b9));},0x1f4)),_0x4580aa[_0x2b0df1(0x18e)](_0x2b0df1(0x184),()=>clearTimeout(_0x396e9f));const _0x5854f5=document['createElement'](_0x2b0df1(0x173));return _0x5854f5[_0x2b0df1(0x1e4)]=_0x2b0df1(0x1a4),_0x5854f5['textContent']=formatTime(_0x301e00[_0x2b0df1(0x1de)]),_0x929f9b[_0x2b0df1(0x1ae)](_0x21f9fa),_0x929f9b[_0x2b0df1(0x1ae)](_0x4580aa),_0x929f9b[_0x2b0df1(0x1ae)](_0x5854f5),_0x929f9b;}function createTypingIndicator(){const _0x10d4c6=a0_0x2246a6,_0x2b9f8a=document[_0x10d4c6(0x1d2)](_0x10d4c6(0x173));return _0x2b9f8a['className']=_0x10d4c6(0x1ac),_0x2b9f8a['id']=_0x10d4c6(0x1ad),_0x2b9f8a[_0x10d4c6(0x1e9)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x2b9f8a;}function renderMessages(){const _0x3ee83c=a0_0x2246a6;Array[_0x3ee83c(0x1e6)](chatArea['children'])[_0x3ee83c(0x1b8)](_0x44dfcc=>{const _0x3ed85d=_0x3ee83c;if(_0x44dfcc['id']!=='emptyState')_0x44dfcc[_0x3ed85d(0x18f)]();}),messages[_0x3ee83c(0x1ee)]>0x0?(emptyState['style'][_0x3ee83c(0x1c4)]=_0x3ee83c(0x1a8),messages[_0x3ee83c(0x1b8)]((_0x5715b6,_0x484e20)=>chatArea['appendChild'](createMessageElement(_0x5715b6,_0x484e20)))):emptyState['style']['display']=_0x3ee83c(0x18b),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x3ee83c(0x175)]);}function autoResizeTextarea(){const _0x16f56a=a0_0x2246a6;messageInput[_0x16f56a(0x1b0)][_0x16f56a(0x1e2)]=_0x16f56a(0x1d1),messageInput[_0x16f56a(0x1b0)][_0x16f56a(0x1e2)]=Math[_0x16f56a(0x1e3)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x6e576f=a0_0x2246a6,_0x110423=messageInput[_0x6e576f(0x194)][_0x6e576f(0x190)]();sendBtn[_0x6e576f(0x17b)]=!_0x110423||isTyping;}async function sendMessage(){const _0xef9617=a0_0x2246a6,_0x2acd33=messageInput['value']['trim']();if(!_0x2acd33||isTyping)return;if(tg?.[_0xef9617(0x188)])tg[_0xef9617(0x188)][_0xef9617(0x17a)](_0xef9617(0x182));messages[_0xef9617(0x178)]({'role':_0xef9617(0x198),'content':_0x2acd33,'timestamp':Date[_0xef9617(0x1db)]()}),localStorage['setItem'](_0xef9617(0x1ce),JSON[_0xef9617(0x181)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xef9617(0x1ae)](createTypingIndicator()),chatArea[_0xef9617(0x1cc)]=chatArea['scrollHeight'];const _0x50857a=await callBackend(_0xef9617(0x1f4),{'message':_0x2acd33});isTyping=![];const _0x22fed0=document[_0xef9617(0x1f2)](_0xef9617(0x1ad));if(_0x22fed0)_0x22fed0[_0xef9617(0x18f)]();let _0x14fbff=_0xef9617(0x179);if(_0x50857a['success']){_0x14fbff=_0x50857a['text']||_0xef9617(0x1a5);if(tg?.[_0xef9617(0x188)])tg['HapticFeedback'][_0xef9617(0x19a)](_0xef9617(0x1a6));}else{_0x14fbff=_0x50857a[_0xef9617(0x1d7)]||'Ошибка\x20сервера';if(tg?.[_0xef9617(0x188)])tg[_0xef9617(0x188)]['notificationOccurred'](_0xef9617(0x1d7));}messages[_0xef9617(0x178)]({'role':'ai','content':_0x14fbff,'timestamp':Date[_0xef9617(0x1db)]()}),localStorage[_0xef9617(0x17c)](_0xef9617(0x1ce),JSON[_0xef9617(0x181)](messages)),renderMessages();}function a0_0x30df(_0x4ca0d4,_0x2d7c95){_0x4ca0d4=_0x4ca0d4-0x173;const _0x4b22a9=a0_0x4adb();let _0x262409=_0x4b22a9[_0x4ca0d4];return _0x262409;}function confirmDelete(_0x392a3a){const _0x334c74=a0_0x2246a6;if(mTitle)mTitle[_0x334c74(0x1a7)]='Удалить?';if(mText)mText[_0x334c74(0x1a7)]='Действие\x20необратимо.';modalCallback=()=>{const _0x51c57c=_0x334c74;messages['splice'](_0x392a3a,0x1),localStorage[_0x51c57c(0x17c)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal['classList'][_0x334c74(0x1d9)]('show');}if(clearBtn)clearBtn[a0_0x2246a6(0x1af)]=()=>{const _0x387329=a0_0x2246a6;if(!messages[_0x387329(0x1ee)])return;if(mTitle)mTitle[_0x387329(0x1a7)]=_0x387329(0x1f1);if(mText)mText[_0x387329(0x1a7)]=_0x387329(0x19c);modalCallback=async()=>{const _0x23b2ae=_0x387329;messages=[],localStorage[_0x23b2ae(0x19d)](_0x23b2ae(0x1ce)),renderMessages(),callBackend('clear_history',{});},modal[_0x387329(0x177)][_0x387329(0x1d9)]('show');};document['getElementById'](a0_0x2246a6(0x1d3))[a0_0x2246a6(0x1af)]=()=>modal[a0_0x2246a6(0x177)][a0_0x2246a6(0x18f)](a0_0x2246a6(0x1c6)),document[a0_0x2246a6(0x1f2)]('modalConfirm')[a0_0x2246a6(0x1af)]=()=>{const _0x2d7f9f=a0_0x2246a6;if(modalCallback)modalCallback();modal[_0x2d7f9f(0x177)][_0x2d7f9f(0x18f)](_0x2d7f9f(0x1c6));},messageInput[a0_0x2246a6(0x18e)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x37bbbf=>{const _0x91b967=a0_0x2246a6;_0x37bbbf[_0x91b967(0x18d)]===_0x91b967(0x1ec)&&!_0x37bbbf[_0x91b967(0x1cf)]&&(_0x37bbbf[_0x91b967(0x195)](),sendMessage());}),sendBtn[a0_0x2246a6(0x1af)]=sendMessage,document[a0_0x2246a6(0x18e)]('click',_0x5c3fca=>{const _0x2c7d63=a0_0x2246a6;document[_0x2c7d63(0x19e)](_0x2c7d63(0x1c5))[_0x2c7d63(0x1b8)](_0x3b0ae3=>{const _0x25d929=_0x2c7d63;if(!_0x3b0ae3[_0x25d929(0x1e8)](_0x5c3fca[_0x25d929(0x1b1)]))_0x3b0ae3['classList'][_0x25d929(0x18f)](_0x25d929(0x1df));});});const saved=localStorage[a0_0x2246a6(0x197)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x2246a6(0x1b2)](saved),renderMessages();}catch(a0_0x571969){}function a0_0x4adb(){const _0x1c50f6=['onEvent','ai_chat_messages','shiftKey','7WqNZtX','auto','createElement','modalCancel','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','<br>','paddingBottom','error','getMinutes','add','text/plain','now','785616EhtWmg','debug_uid','timestamp','show-delete','5292qjDQdG','role','height','min','className','replace','from','apply','contains','innerHTML','23wYSZAJ','offsetHeight','Enter','1030038rTIwjM','length','inputArea','json','Очистить\x20историю?','getElementById','message-bubble','send_message','div','emptyState','scrollHeight','expand','classList','push','Ошибка\x20сети','impactOccurred','disabled','setItem','messageInput','1905728FXqVMX','onClick','content','stringify','light','confirmModal','touchend','function','20ibZVnW','modalTitle','HapticFeedback','64LnrfHg','./router.html','flex','POST','key','addEventListener','remove','trim','TG\x20setup\x20error:','floor','viewportChanged','value','preventDefault','Telegram','getItem','user','padStart','notificationOccurred','innerHeight','Начнется\x20новый\x20диалог.','removeItem','querySelectorAll','WebApp','(((.+)+)+)+$','setHeaderColor','first_name','26466HSlOkQ','message-time','Пустой\x20ответ','success','textContent','none','isVersionAtLeast','offClick','getHours','message\x20ai','typingIndicator','appendChild','onclick','style','target','parse','warn','clearBtn','6.1','612306zsyByV','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','forEach','medium','search','focus','chatArea','querySelector','.container','username','viewportHeight','random','abort','signal','display','.message.show-delete','show','BackButton','resize','stopPropagation','delete-btn','2226600pjrszi','scrollTop'];a0_0x4adb=function(){return _0x1c50f6;};return a0_0x4adb();}updateSendButton();