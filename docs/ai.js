const a0_0xe80c75=a0_0x3261;(function(_0x1d3c73,_0xa27ce6){const _0x3b5a9f=a0_0x3261,_0x2e7117=_0x1d3c73();while(!![]){try{const _0x2e82ed=-parseInt(_0x3b5a9f(0x201))/0x1*(parseInt(_0x3b5a9f(0x1f4))/0x2)+parseInt(_0x3b5a9f(0x1f1))/0x3*(parseInt(_0x3b5a9f(0x245))/0x4)+parseInt(_0x3b5a9f(0x1e1))/0x5*(parseInt(_0x3b5a9f(0x237))/0x6)+parseInt(_0x3b5a9f(0x1f2))/0x7+-parseInt(_0x3b5a9f(0x1f5))/0x8*(parseInt(_0x3b5a9f(0x200))/0x9)+parseInt(_0x3b5a9f(0x20c))/0xa*(-parseInt(_0x3b5a9f(0x224))/0xb)+-parseInt(_0x3b5a9f(0x1fb))/0xc*(parseInt(_0x3b5a9f(0x1ed))/0xd);if(_0x2e82ed===_0xa27ce6)break;else _0x2e7117['push'](_0x2e7117['shift']());}catch(_0x569800){_0x2e7117['push'](_0x2e7117['shift']());}}}(a0_0x448d,0xe10ba));const tg=window[a0_0xe80c75(0x202)]?.['WebApp'],HOME_URL=a0_0xe80c75(0x1f0);function setupTelegramBackButton(){const _0x5d2bde=a0_0xe80c75,_0x4c40a9=(function(){let _0x3cf6c3=!![];return function(_0x1e71c5,_0x5266fe){const _0x25a516=_0x3cf6c3?function(){const _0x135a6d=a0_0x3261;if(_0x5266fe){const _0x5b961c=_0x5266fe[_0x135a6d(0x20f)](_0x1e71c5,arguments);return _0x5266fe=null,_0x5b961c;}}:function(){};return _0x3cf6c3=![],_0x25a516;};}()),_0x228f69=_0x4c40a9(this,function(){const _0x38fff5=a0_0x3261;return _0x228f69['toString']()[_0x38fff5(0x236)](_0x38fff5(0x249))[_0x38fff5(0x1ef)]()['constructor'](_0x228f69)['search'](_0x38fff5(0x249));});_0x228f69();if(!tg)return;try{tg['ready'](),tg[_0x5d2bde(0x232)](),tg[_0x5d2bde(0x1ff)]?.('#050505');if(tg[_0x5d2bde(0x211)]?.(_0x5d2bde(0x25b)))tg[_0x5d2bde(0x223)]?.();const _0x25659e=tg['BackButton'];if(_0x25659e){_0x25659e['show']();if(typeof _0x25659e[_0x5d2bde(0x210)]===_0x5d2bde(0x23b))try{_0x25659e[_0x5d2bde(0x210)]();}catch(_0x36fe06){}_0x25659e['onClick'](()=>{const _0x24ecc8=_0x5d2bde;if(tg[_0x24ecc8(0x208)])tg[_0x24ecc8(0x208)][_0x24ecc8(0x1e7)](_0x24ecc8(0x219));location[_0x24ecc8(0x256)]=HOME_URL;});}}catch(_0xe88bd0){console[_0x5d2bde(0x212)](_0x5d2bde(0x205),_0xe88bd0);}}(function initStableLayout(){const _0x4d61f7=a0_0xe80c75,_0x1e559c=document[_0x4d61f7(0x1e6)]('.container'),_0x29e88b=document[_0x4d61f7(0x1e3)](_0x4d61f7(0x1da)),_0x158ef7=document[_0x4d61f7(0x1e3)]('chatArea'),_0x3d6003=document['getElementById'](_0x4d61f7(0x203));function _0x5e919a(){const _0x2b56c5=_0x4d61f7;if(!_0x1e559c)return;const _0x565445=tg&&tg[_0x2b56c5(0x21d)]?tg['viewportHeight']:window[_0x2b56c5(0x23c)];_0x1e559c[_0x2b56c5(0x23a)][_0x2b56c5(0x20b)]=_0x565445+'px';if(_0x29e88b){const _0x1333ca=_0x29e88b[_0x2b56c5(0x209)];_0x158ef7[_0x2b56c5(0x23a)][_0x2b56c5(0x248)]=_0x1333ca+0x28+'px';}}tg?tg[_0x4d61f7(0x23f)](_0x4d61f7(0x25e),({isStateStable:_0x45a3f5})=>{_0x5e919a();if(_0x45a3f5)requestAnimationFrame(()=>{const _0x2bc1ff=a0_0x3261;_0x158ef7[_0x2bc1ff(0x1e9)]=_0x158ef7['scrollHeight'];});}):window[_0x4d61f7(0x220)](_0x4d61f7(0x1db),_0x5e919a),_0x5e919a(),_0x3d6003&&(_0x3d6003[_0x4d61f7(0x220)](_0x4d61f7(0x21a),()=>{requestAnimationFrame(_0x5e919a);}),_0x3d6003['addEventListener'](_0x4d61f7(0x22d),()=>{setTimeout(()=>{const _0x321d4b=a0_0x3261;_0x158ef7[_0x321d4b(0x1e9)]=_0x158ef7[_0x321d4b(0x1e0)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xe80c75(0x24a),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xe80c75(0x1e3)](a0_0xe80c75(0x1f3)),emptyState=document[a0_0xe80c75(0x1e3)](a0_0xe80c75(0x20e)),messageInput=document['getElementById'](a0_0xe80c75(0x203)),sendBtn=document[a0_0xe80c75(0x1e3)](a0_0xe80c75(0x22e)),clearBtn=document[a0_0xe80c75(0x1e3)](a0_0xe80c75(0x216)),modal=document[a0_0xe80c75(0x1e3)](a0_0xe80c75(0x239)),mTitle=document['getElementById']('modalTitle'),mText=document[a0_0xe80c75(0x1e3)](a0_0xe80c75(0x21f));let modalCallback=null;async function callBackend(_0x28db3a,_0x55b677){const _0x3ebdae=a0_0xe80c75,_0x2197af=tg?.['initDataUnsafe']?.[_0x3ebdae(0x228)]||{},_0x4219e8=_0x2197af['id']||localStorage[_0x3ebdae(0x20d)](_0x3ebdae(0x1df))||'d-'+Math[_0x3ebdae(0x235)](Math[_0x3ebdae(0x1f6)]()*0x3b9aca00);if(!_0x2197af['id'])localStorage[_0x3ebdae(0x225)]('debug_uid',_0x4219e8);const _0x22818d={'action':_0x28db3a,'user_id':_0x4219e8,'user_data':{'first_name':_0x2197af[_0x3ebdae(0x206)],'username':_0x2197af[_0x3ebdae(0x24d)]},'init_data':tg?.[_0x3ebdae(0x1f9)]||'',..._0x55b677},_0x4ce957=new AbortController(),_0x290fd1=setTimeout(()=>_0x4ce957[_0x3ebdae(0x253)](),REQUEST_TIMEOUT_MS);try{const _0x1b2321=await fetch(BACKEND_URL,{'method':_0x3ebdae(0x246),'headers':{'Content-Type':_0x3ebdae(0x240)},'body':JSON[_0x3ebdae(0x24b)](_0x22818d),'signal':_0x4ce957[_0x3ebdae(0x251)]});return clearTimeout(_0x290fd1),await _0x1b2321[_0x3ebdae(0x218)]();}catch(_0x26c4cd){return{'success':![],'error':String(_0x26c4cd)};}}function formatTime(_0x31acc3){const _0x3a40a6=a0_0xe80c75,_0x58f35b=new Date(_0x31acc3);return String(_0x58f35b['getHours']())[_0x3a40a6(0x1dc)](0x2,'0')+':'+String(_0x58f35b[_0x3a40a6(0x227)]())[_0x3a40a6(0x1dc)](0x2,'0');}function a0_0x448d(){const _0x2eba3e=['user','<br>','content','delete-btn','click','focus','sendBtn','text','Очистить\x20историю?','ai_chat_messages','expand','removeItem','Ошибка\x20сети','floor','search','3612558EYyXFZ','now','confirmModal','style','function','innerHeight','createElement','display','onEvent','text/plain','success','trim','className','classList','76shVkKn','POST','innerHTML','paddingBottom','(((.+)+)+)+$','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','stringify','modalConfirm','username','key','replace','clear_history','signal','Пустой\x20ответ','abort','touchstart','textContent','href','children','length','.message.show-delete','stopPropagation','6.1','error','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','viewportChanged','shiftKey','onclick','inputArea','resize','padStart','min','notificationOccurred','debug_uid','scrollHeight','15SLjHdV','medium','getElementById','message-bubble','contains','querySelector','impactOccurred','push','scrollTop','Ошибка\x20сервера','auto','none','1313CTwwkW','add','toString','./router.html','247260OABWik','744695VAOfXl','chatArea','1119342AjxZgX','909888BHaFyX','random','message\x20ai','div','initData','value','44028hTtRYE','Действие\x20необратимо.','remove','keydown','setHeaderColor','99dGzKYz','1Hlocks','Telegram','messageInput','typingIndicator','TG\x20setup\x20error:','first_name','disabled','HapticFeedback','offsetHeight','Enter','height','20aATFTd','getItem','emptyState','apply','offClick','isVersionAtLeast','warn','Удалить?','appendChild','touchend','clearBtn','modalCancel','json','light','input','timestamp','show','viewportHeight','parse','modalText','addEventListener','flex','target','disableVerticalSwipes','2065371KyRRkd','setItem','preventDefault','getMinutes'];a0_0x448d=function(){return _0x2eba3e;};return a0_0x448d();}function a0_0x3261(_0x562627,_0x443644){_0x562627=_0x562627-0x1d8;const _0x577950=a0_0x448d();let _0x27541b=_0x577950[_0x562627];return _0x27541b;}function createMessageElement(_0x169060,_0x63ee43){const _0x14be29=a0_0xe80c75,_0x4e6dc0=document['createElement']('div');_0x4e6dc0[_0x14be29(0x243)]='message\x20'+_0x169060['role'];const _0x484a15=document[_0x14be29(0x23d)](_0x14be29(0x1f8));_0x484a15[_0x14be29(0x243)]=_0x14be29(0x1e4),_0x484a15[_0x14be29(0x247)]=_0x169060[_0x14be29(0x22a)][_0x14be29(0x24f)](/\n/g,_0x14be29(0x229));const _0x4207c8=document[_0x14be29(0x23d)]('div');_0x4207c8[_0x14be29(0x243)]=_0x14be29(0x22b),_0x4207c8[_0x14be29(0x247)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x4207c8[_0x14be29(0x1d9)]=_0x326de4=>{const _0x234c1a=_0x14be29;_0x326de4[_0x234c1a(0x25a)](),confirmDelete(_0x63ee43);};let _0x447428;_0x484a15[_0x14be29(0x220)](_0x14be29(0x254),()=>_0x447428=setTimeout(()=>{const _0x37a68e=_0x14be29;_0x4e6dc0['classList'][_0x37a68e(0x1ee)]('show-delete');if(tg?.[_0x37a68e(0x208)])tg[_0x37a68e(0x208)][_0x37a68e(0x1e7)](_0x37a68e(0x1e2));},0x1f4)),_0x484a15[_0x14be29(0x220)](_0x14be29(0x215),()=>clearTimeout(_0x447428));const _0x4d5478=document[_0x14be29(0x23d)](_0x14be29(0x1f8));return _0x4d5478['className']='message-time',_0x4d5478['textContent']=formatTime(_0x169060[_0x14be29(0x21b)]),_0x4e6dc0['appendChild'](_0x4207c8),_0x4e6dc0[_0x14be29(0x214)](_0x484a15),_0x4e6dc0[_0x14be29(0x214)](_0x4d5478),_0x4e6dc0;}function createTypingIndicator(){const _0x3b4315=a0_0xe80c75,_0x83a179=document['createElement'](_0x3b4315(0x1f8));return _0x83a179[_0x3b4315(0x243)]=_0x3b4315(0x1f7),_0x83a179['id']='typingIndicator',_0x83a179[_0x3b4315(0x247)]=_0x3b4315(0x25d),_0x83a179;}function renderMessages(){const _0x87201b=a0_0xe80c75;Array['from'](chatArea[_0x87201b(0x257)])['forEach'](_0x388090=>{const _0x383fdf=_0x87201b;if(_0x388090['id']!==_0x383fdf(0x20e))_0x388090[_0x383fdf(0x1fd)]();}),messages[_0x87201b(0x258)]>0x0?(emptyState[_0x87201b(0x23a)][_0x87201b(0x23e)]=_0x87201b(0x1ec),messages['forEach']((_0xc6cab2,_0x2fdd1d)=>chatArea['appendChild'](createMessageElement(_0xc6cab2,_0x2fdd1d)))):emptyState[_0x87201b(0x23a)][_0x87201b(0x23e)]=_0x87201b(0x221),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x87201b(0x1e0)]);}function autoResizeTextarea(){const _0x3afab3=a0_0xe80c75;messageInput[_0x3afab3(0x23a)]['height']=_0x3afab3(0x1eb),messageInput[_0x3afab3(0x23a)][_0x3afab3(0x20b)]=Math[_0x3afab3(0x1dd)](messageInput[_0x3afab3(0x1e0)],0x78)+'px';}function updateSendButton(){const _0x240a44=a0_0xe80c75,_0xf2a9ff=messageInput[_0x240a44(0x1fa)][_0x240a44(0x242)]();sendBtn[_0x240a44(0x207)]=!_0xf2a9ff||isTyping;}async function sendMessage(){const _0x26a1c2=a0_0xe80c75,_0x4f38bb=messageInput['value'][_0x26a1c2(0x242)]();if(!_0x4f38bb||isTyping)return;if(tg?.[_0x26a1c2(0x208)])tg[_0x26a1c2(0x208)][_0x26a1c2(0x1e7)](_0x26a1c2(0x219));messages[_0x26a1c2(0x1e8)]({'role':_0x26a1c2(0x228),'content':_0x4f38bb,'timestamp':Date[_0x26a1c2(0x238)]()}),localStorage[_0x26a1c2(0x225)]('ai_chat_messages',JSON[_0x26a1c2(0x24b)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x26a1c2(0x1e9)]=chatArea[_0x26a1c2(0x1e0)];const _0x1a5344=await callBackend('send_message',{'message':_0x4f38bb});isTyping=![];const _0x26b69c=document['getElementById'](_0x26a1c2(0x204));if(_0x26b69c)_0x26b69c[_0x26a1c2(0x1fd)]();let _0x90e91d=_0x26a1c2(0x234);if(_0x1a5344[_0x26a1c2(0x241)]){_0x90e91d=_0x1a5344[_0x26a1c2(0x22f)]||_0x26a1c2(0x252);if(tg?.[_0x26a1c2(0x208)])tg['HapticFeedback'][_0x26a1c2(0x1de)]('success');}else{_0x90e91d=_0x1a5344[_0x26a1c2(0x25c)]||_0x26a1c2(0x1ea);if(tg?.[_0x26a1c2(0x208)])tg['HapticFeedback'][_0x26a1c2(0x1de)](_0x26a1c2(0x25c));}messages[_0x26a1c2(0x1e8)]({'role':'ai','content':_0x90e91d,'timestamp':Date[_0x26a1c2(0x238)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x26a1c2(0x24b)](messages)),renderMessages();}function confirmDelete(_0x51bd4d){const _0x37859e=a0_0xe80c75;if(mTitle)mTitle[_0x37859e(0x255)]=_0x37859e(0x213);if(mText)mText[_0x37859e(0x255)]=_0x37859e(0x1fc);modalCallback=()=>{const _0x5035ca=_0x37859e;messages['splice'](_0x51bd4d,0x1),localStorage[_0x5035ca(0x225)]('ai_chat_messages',JSON[_0x5035ca(0x24b)](messages)),renderMessages();},modal[_0x37859e(0x244)]['add'](_0x37859e(0x21c));}if(clearBtn)clearBtn[a0_0xe80c75(0x1d9)]=()=>{const _0x201e8b=a0_0xe80c75;if(!messages[_0x201e8b(0x258)])return;if(mTitle)mTitle['textContent']=_0x201e8b(0x230);if(mText)mText[_0x201e8b(0x255)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x17d10b=_0x201e8b;messages=[],localStorage[_0x17d10b(0x233)](_0x17d10b(0x231)),renderMessages(),callBackend(_0x17d10b(0x250),{});},modal[_0x201e8b(0x244)][_0x201e8b(0x1ee)](_0x201e8b(0x21c));};document[a0_0xe80c75(0x1e3)](a0_0xe80c75(0x217))['onclick']=()=>modal['classList'][a0_0xe80c75(0x1fd)]('show'),document['getElementById'](a0_0xe80c75(0x24c))[a0_0xe80c75(0x1d9)]=()=>{const _0x5cb49d=a0_0xe80c75;if(modalCallback)modalCallback();modal['classList'][_0x5cb49d(0x1fd)]('show');},messageInput[a0_0xe80c75(0x220)](a0_0xe80c75(0x21a),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xe80c75(0x220)](a0_0xe80c75(0x1fe),_0x1a9674=>{const _0x55a7ee=a0_0xe80c75;_0x1a9674[_0x55a7ee(0x24e)]===_0x55a7ee(0x20a)&&!_0x1a9674[_0x55a7ee(0x1d8)]&&(_0x1a9674[_0x55a7ee(0x226)](),sendMessage());}),sendBtn[a0_0xe80c75(0x1d9)]=sendMessage,document[a0_0xe80c75(0x220)](a0_0xe80c75(0x22c),_0x5a5e03=>{const _0x4282c8=a0_0xe80c75;document['querySelectorAll'](_0x4282c8(0x259))['forEach'](_0x43cdc9=>{const _0x3142b4=_0x4282c8;if(!_0x43cdc9[_0x3142b4(0x1e5)](_0x5a5e03[_0x3142b4(0x222)]))_0x43cdc9[_0x3142b4(0x244)]['remove']('show-delete');});});const saved=localStorage[a0_0xe80c75(0x20d)](a0_0xe80c75(0x231));if(saved)try{messages=JSON[a0_0xe80c75(0x21e)](saved),renderMessages();}catch(a0_0xfbca79){}updateSendButton();