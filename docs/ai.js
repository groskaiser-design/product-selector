const a0_0x41df10=a0_0x2827;(function(_0x174f20,_0x4fcf46){const _0x1ed2c4=a0_0x2827,_0x4c790b=_0x174f20();while(!![]){try{const _0xe88c7=-parseInt(_0x1ed2c4(0x185))/0x1*(-parseInt(_0x1ed2c4(0x1fa))/0x2)+-parseInt(_0x1ed2c4(0x1f9))/0x3+parseInt(_0x1ed2c4(0x1bc))/0x4+-parseInt(_0x1ed2c4(0x200))/0x5*(parseInt(_0x1ed2c4(0x188))/0x6)+parseInt(_0x1ed2c4(0x1ee))/0x7+parseInt(_0x1ed2c4(0x1d6))/0x8*(parseInt(_0x1ed2c4(0x201))/0x9)+-parseInt(_0x1ed2c4(0x1ed))/0xa*(parseInt(_0x1ed2c4(0x1ff))/0xb);if(_0xe88c7===_0x4fcf46)break;else _0x4c790b['push'](_0x4c790b['shift']());}catch(_0x433094){_0x4c790b['push'](_0x4c790b['shift']());}}}(a0_0x24b8,0x9cd3c));function a0_0x2827(_0x1f6a91,_0x3644c9){_0x1f6a91=_0x1f6a91-0x184;const _0x479d3d=a0_0x24b8();let _0x24c528=_0x479d3d[_0x1f6a91];return _0x24c528;}function a0_0x24b8(){const _0x4b342d=['appendChild','initDataUnsafe','4604788OJWGOc','from','padStart','light','forEach','.container','onEvent','offsetHeight','key','Очистить\x20историю?','stringify','ai_chat_messages','touchend','delete-btn','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','POST','confirmModal','getItem','div','value','initData','Telegram','onClick','./router.html','innerHTML','sendBtn','32luuEEv','classList','none','impactOccurred','typingIndicator','display','parse','text/plain','username','TG\x20setup\x20error:','now','keydown','length','success','Пустой\x20ответ','querySelector','stopPropagation','content','show','message\x20','modalCancel','.message.show-delete','role','5614330ucUGFq','3170811gjPTgD','timestamp','height','disabled','(((.+)+)+)+$','click','notificationOccurred','search','Ошибка\x20сервера','min','textContent','1732017hZnSsy','4xUSVAS','scrollHeight','getElementById','add','clearBtn','11oUxEeB','10ITXJMd','835713hxssfk','apply','offClick','onclick','chatArea','send_message','className','413346XGmbGg','<br>','scrollTop','3063462uwaldS','auto','show-delete','warn','viewportChanged','trim','innerHeight','user','resize','href','inputArea','floor','remove','text','message\x20ai','function','flex','json','push','setHeaderColor','6.1','setItem','HapticFeedback','medium','replace','querySelectorAll','addEventListener','messageInput','style','expand','paddingBottom','BackButton','isVersionAtLeast','debug_uid','constructor','message-bubble','emptyState','removeItem','createElement','modalText','contains','touchstart','error','first_name','toString','viewportHeight','random','Начнется\x20новый\x20диалог.','getMinutes','WebApp'];a0_0x24b8=function(){return _0x4b342d;};return a0_0x24b8();}const tg=window[a0_0x41df10(0x1d1)]?.[a0_0x41df10(0x1b9)],HOME_URL=a0_0x41df10(0x1d3);function setupTelegramBackButton(){const _0x4793a4=a0_0x41df10,_0x3e2f6e=(function(){let _0x4d74d9=!![];return function(_0x2dc742,_0x1b2ecb){const _0x44a37c=_0x4d74d9?function(){const _0xe502bb=a0_0x2827;if(_0x1b2ecb){const _0x2c19e8=_0x1b2ecb[_0xe502bb(0x202)](_0x2dc742,arguments);return _0x1b2ecb=null,_0x2c19e8;}}:function(){};return _0x4d74d9=![],_0x44a37c;};}()),_0x1e42a5=_0x3e2f6e(this,function(){const _0xfc49a8=a0_0x2827;return _0x1e42a5[_0xfc49a8(0x1b4)]()[_0xfc49a8(0x1f5)](_0xfc49a8(0x1f2))[_0xfc49a8(0x1b4)]()[_0xfc49a8(0x1aa)](_0x1e42a5)[_0xfc49a8(0x1f5)]('(((.+)+)+)+$');});_0x1e42a5();if(!tg)return;try{tg['ready'](),tg[_0x4793a4(0x1a5)](),tg[_0x4793a4(0x19b)]?.('#050505');if(tg[_0x4793a4(0x1a8)]?.(_0x4793a4(0x19c)))tg['disableVerticalSwipes']?.();const _0x517a69=tg[_0x4793a4(0x1a7)];if(_0x517a69){_0x517a69[_0x4793a4(0x1e8)]();if(typeof _0x517a69[_0x4793a4(0x203)]===_0x4793a4(0x197))try{_0x517a69['offClick']();}catch(_0x41b977){}_0x517a69[_0x4793a4(0x1d2)](()=>{const _0x3407a7=_0x4793a4;if(tg[_0x3407a7(0x19e)])tg['HapticFeedback'][_0x3407a7(0x1d9)](_0x3407a7(0x1bf));location[_0x3407a7(0x191)]=HOME_URL;});}}catch(_0x228961){console[_0x4793a4(0x18b)](_0x4793a4(0x1df),_0x228961);}}(function initStableLayout(){const _0x3fa1f9=a0_0x41df10,_0x2dea39=document[_0x3fa1f9(0x1e5)](_0x3fa1f9(0x1c1)),_0x536164=document[_0x3fa1f9(0x1fc)](_0x3fa1f9(0x192)),_0x280de0=document[_0x3fa1f9(0x1fc)](_0x3fa1f9(0x205)),_0x15d552=document[_0x3fa1f9(0x1fc)](_0x3fa1f9(0x1a3));function _0x3aa93f(){const _0x401bde=_0x3fa1f9;if(!_0x2dea39)return;const _0x578fc9=tg&&tg[_0x401bde(0x1b5)]?tg[_0x401bde(0x1b5)]:window[_0x401bde(0x18e)];_0x2dea39[_0x401bde(0x1a4)][_0x401bde(0x1f0)]=_0x578fc9+'px';if(_0x536164){const _0x3cd628=_0x536164[_0x401bde(0x1c3)];_0x280de0[_0x401bde(0x1a4)][_0x401bde(0x1a6)]=_0x3cd628+0x28+'px';}}tg?tg[_0x3fa1f9(0x1c2)](_0x3fa1f9(0x18c),({isStateStable:_0x465168})=>{_0x3aa93f();if(_0x465168)requestAnimationFrame(()=>{const _0x3dcb72=a0_0x2827;_0x280de0[_0x3dcb72(0x187)]=_0x280de0[_0x3dcb72(0x1fb)];});}):window['addEventListener'](_0x3fa1f9(0x190),_0x3aa93f),_0x3aa93f(),_0x15d552&&(_0x15d552[_0x3fa1f9(0x1a2)]('input',()=>{requestAnimationFrame(_0x3aa93f);}),_0x15d552[_0x3fa1f9(0x1a2)]('focus',()=>{setTimeout(()=>{const _0x8b051e=a0_0x2827;_0x280de0[_0x8b051e(0x187)]=_0x280de0[_0x8b051e(0x1fb)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x41df10(0x1fc)](a0_0x41df10(0x205)),emptyState=document[a0_0x41df10(0x1fc)](a0_0x41df10(0x1ac)),messageInput=document[a0_0x41df10(0x1fc)](a0_0x41df10(0x1a3)),sendBtn=document[a0_0x41df10(0x1fc)](a0_0x41df10(0x1d5)),clearBtn=document['getElementById'](a0_0x41df10(0x1fe)),modal=document[a0_0x41df10(0x1fc)](a0_0x41df10(0x1cc)),mTitle=document[a0_0x41df10(0x1fc)]('modalTitle'),mText=document['getElementById'](a0_0x41df10(0x1af));let modalCallback=null;async function callBackend(_0x376bf0,_0x32a67e){const _0x24e2a5=a0_0x41df10,_0x102989=tg?.[_0x24e2a5(0x1bb)]?.[_0x24e2a5(0x18f)]||{},_0xa811cd=_0x102989['id']||localStorage[_0x24e2a5(0x1cd)](_0x24e2a5(0x1a9))||'d-'+Math[_0x24e2a5(0x193)](Math[_0x24e2a5(0x1b6)]()*0x3b9aca00);if(!_0x102989['id'])localStorage[_0x24e2a5(0x19d)](_0x24e2a5(0x1a9),_0xa811cd);const _0x1befa7={'action':_0x376bf0,'user_id':_0xa811cd,'user_data':{'first_name':_0x102989[_0x24e2a5(0x1b3)],'username':_0x102989[_0x24e2a5(0x1de)]},'init_data':tg?.[_0x24e2a5(0x1d0)]||'',..._0x32a67e},_0x531646=new AbortController(),_0x1b99af=setTimeout(()=>_0x531646['abort'](),REQUEST_TIMEOUT_MS);try{const _0x106cac=await fetch(BACKEND_URL,{'method':_0x24e2a5(0x1cb),'headers':{'Content-Type':_0x24e2a5(0x1dd)},'body':JSON['stringify'](_0x1befa7),'signal':_0x531646['signal']});return clearTimeout(_0x1b99af),await _0x106cac[_0x24e2a5(0x199)]();}catch(_0x4f796b){return{'success':![],'error':String(_0x4f796b)};}}function formatTime(_0x138995){const _0x4c5388=a0_0x41df10,_0x434b05=new Date(_0x138995);return String(_0x434b05['getHours']())[_0x4c5388(0x1be)](0x2,'0')+':'+String(_0x434b05[_0x4c5388(0x1b8)]())[_0x4c5388(0x1be)](0x2,'0');}function createMessageElement(_0x47e6da,_0x289126){const _0x518e1f=a0_0x41df10,_0x43d7ed=document[_0x518e1f(0x1ae)](_0x518e1f(0x1ce));_0x43d7ed[_0x518e1f(0x184)]=_0x518e1f(0x1e9)+_0x47e6da[_0x518e1f(0x1ec)];const _0x3c25b9=document['createElement']('div');_0x3c25b9[_0x518e1f(0x184)]=_0x518e1f(0x1ab),_0x3c25b9['innerHTML']=_0x47e6da[_0x518e1f(0x1e7)][_0x518e1f(0x1a0)](/\n/g,_0x518e1f(0x186));const _0x32766f=document['createElement'](_0x518e1f(0x1ce));_0x32766f[_0x518e1f(0x184)]=_0x518e1f(0x1c9),_0x32766f[_0x518e1f(0x1d4)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x32766f[_0x518e1f(0x204)]=_0x5a86fa=>{const _0x553bd7=_0x518e1f;_0x5a86fa[_0x553bd7(0x1e6)](),confirmDelete(_0x289126);};let _0x4ebfa4;_0x3c25b9[_0x518e1f(0x1a2)](_0x518e1f(0x1b1),()=>_0x4ebfa4=setTimeout(()=>{const _0x23945d=_0x518e1f;_0x43d7ed[_0x23945d(0x1d7)][_0x23945d(0x1fd)](_0x23945d(0x18a));if(tg?.[_0x23945d(0x19e)])tg[_0x23945d(0x19e)][_0x23945d(0x1d9)](_0x23945d(0x19f));},0x1f4)),_0x3c25b9['addEventListener'](_0x518e1f(0x1c8),()=>clearTimeout(_0x4ebfa4));const _0x2fc4d6=document[_0x518e1f(0x1ae)](_0x518e1f(0x1ce));return _0x2fc4d6[_0x518e1f(0x184)]='message-time',_0x2fc4d6[_0x518e1f(0x1f8)]=formatTime(_0x47e6da[_0x518e1f(0x1ef)]),_0x43d7ed[_0x518e1f(0x1ba)](_0x32766f),_0x43d7ed[_0x518e1f(0x1ba)](_0x3c25b9),_0x43d7ed['appendChild'](_0x2fc4d6),_0x43d7ed;}function createTypingIndicator(){const _0x2b0754=a0_0x41df10,_0x4fa083=document['createElement']('div');return _0x4fa083[_0x2b0754(0x184)]=_0x2b0754(0x196),_0x4fa083['id']=_0x2b0754(0x1da),_0x4fa083['innerHTML']=_0x2b0754(0x1ca),_0x4fa083;}function renderMessages(){const _0x1399b9=a0_0x41df10;Array[_0x1399b9(0x1bd)](chatArea['children'])[_0x1399b9(0x1c0)](_0x1189d6=>{const _0x31ae20=_0x1399b9;if(_0x1189d6['id']!==_0x31ae20(0x1ac))_0x1189d6[_0x31ae20(0x194)]();}),messages[_0x1399b9(0x1e2)]>0x0?(emptyState[_0x1399b9(0x1a4)][_0x1399b9(0x1db)]=_0x1399b9(0x1d8),messages[_0x1399b9(0x1c0)]((_0x16ade6,_0x34fc39)=>chatArea[_0x1399b9(0x1ba)](createMessageElement(_0x16ade6,_0x34fc39)))):emptyState[_0x1399b9(0x1a4)][_0x1399b9(0x1db)]=_0x1399b9(0x198),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x1399b9(0x1fb)]);}function autoResizeTextarea(){const _0x11fc0d=a0_0x41df10;messageInput['style'][_0x11fc0d(0x1f0)]=_0x11fc0d(0x189),messageInput[_0x11fc0d(0x1a4)][_0x11fc0d(0x1f0)]=Math[_0x11fc0d(0x1f7)](messageInput[_0x11fc0d(0x1fb)],0x78)+'px';}function updateSendButton(){const _0xaf39a6=a0_0x41df10,_0x1a2833=messageInput[_0xaf39a6(0x1cf)][_0xaf39a6(0x18d)]();sendBtn[_0xaf39a6(0x1f1)]=!_0x1a2833||isTyping;}async function sendMessage(){const _0x490563=a0_0x41df10,_0x311167=messageInput[_0x490563(0x1cf)][_0x490563(0x18d)]();if(!_0x311167||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback']['impactOccurred']('light');messages['push']({'role':_0x490563(0x18f),'content':_0x311167,'timestamp':Date[_0x490563(0x1e0)]()}),localStorage[_0x490563(0x19d)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0x490563(0x1cf)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x490563(0x187)]=chatArea[_0x490563(0x1fb)];const _0xed6d8b=await callBackend(_0x490563(0x206),{'message':_0x311167});isTyping=![];const _0x596647=document[_0x490563(0x1fc)](_0x490563(0x1da));if(_0x596647)_0x596647[_0x490563(0x194)]();let _0x2a67b8='Ошибка\x20сети';if(_0xed6d8b[_0x490563(0x1e3)]){_0x2a67b8=_0xed6d8b[_0x490563(0x195)]||_0x490563(0x1e4);if(tg?.[_0x490563(0x19e)])tg[_0x490563(0x19e)][_0x490563(0x1f4)](_0x490563(0x1e3));}else{_0x2a67b8=_0xed6d8b[_0x490563(0x1b2)]||_0x490563(0x1f6);if(tg?.[_0x490563(0x19e)])tg['HapticFeedback'][_0x490563(0x1f4)](_0x490563(0x1b2));}messages[_0x490563(0x19a)]({'role':'ai','content':_0x2a67b8,'timestamp':Date['now']()}),localStorage[_0x490563(0x19d)](_0x490563(0x1c7),JSON[_0x490563(0x1c6)](messages)),renderMessages();}function confirmDelete(_0x47e888){const _0x13b145=a0_0x41df10;if(mTitle)mTitle[_0x13b145(0x1f8)]='Удалить?';if(mText)mText[_0x13b145(0x1f8)]='Действие\x20необратимо.';modalCallback=()=>{const _0x2ddd9d=_0x13b145;messages['splice'](_0x47e888,0x1),localStorage[_0x2ddd9d(0x19d)](_0x2ddd9d(0x1c7),JSON[_0x2ddd9d(0x1c6)](messages)),renderMessages();},modal['classList'][_0x13b145(0x1fd)](_0x13b145(0x1e8));}if(clearBtn)clearBtn[a0_0x41df10(0x204)]=()=>{const _0x58bcdf=a0_0x41df10;if(!messages[_0x58bcdf(0x1e2)])return;if(mTitle)mTitle[_0x58bcdf(0x1f8)]=_0x58bcdf(0x1c5);if(mText)mText['textContent']=_0x58bcdf(0x1b7);modalCallback=async()=>{const _0x16ee22=_0x58bcdf;messages=[],localStorage[_0x16ee22(0x1ad)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x58bcdf(0x1d7)][_0x58bcdf(0x1fd)](_0x58bcdf(0x1e8));};document['getElementById'](a0_0x41df10(0x1ea))['onclick']=()=>modal[a0_0x41df10(0x1d7)][a0_0x41df10(0x194)](a0_0x41df10(0x1e8)),document[a0_0x41df10(0x1fc)]('modalConfirm')[a0_0x41df10(0x204)]=()=>{const _0x1edd25=a0_0x41df10;if(modalCallback)modalCallback();modal[_0x1edd25(0x1d7)][_0x1edd25(0x194)](_0x1edd25(0x1e8));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x41df10(0x1a2)](a0_0x41df10(0x1e1),_0x5cef9f=>{const _0x21f6fa=a0_0x41df10;_0x5cef9f[_0x21f6fa(0x1c4)]==='Enter'&&!_0x5cef9f['shiftKey']&&(_0x5cef9f['preventDefault'](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x41df10(0x1a2)](a0_0x41df10(0x1f3),_0x4bd4c5=>{const _0xd86c39=a0_0x41df10;document[_0xd86c39(0x1a1)](_0xd86c39(0x1eb))[_0xd86c39(0x1c0)](_0x4f03f7=>{const _0x1ca39c=_0xd86c39;if(!_0x4f03f7[_0x1ca39c(0x1b0)](_0x4bd4c5['target']))_0x4f03f7[_0x1ca39c(0x1d7)]['remove'](_0x1ca39c(0x18a));});});const saved=localStorage[a0_0x41df10(0x1cd)](a0_0x41df10(0x1c7));if(saved)try{messages=JSON[a0_0x41df10(0x1dc)](saved),renderMessages();}catch(a0_0x5c7757){}updateSendButton();