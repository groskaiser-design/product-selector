const a0_0x1db969=a0_0x3d51;(function(_0x3186b6,_0x2b5fcc){const _0x4c22bf=a0_0x3d51,_0x5de383=_0x3186b6();while(!![]){try{const _0x40958d=-parseInt(_0x4c22bf(0xea))/0x1*(-parseInt(_0x4c22bf(0xb9))/0x2)+-parseInt(_0x4c22bf(0xb3))/0x3+parseInt(_0x4c22bf(0xc9))/0x4+parseInt(_0x4c22bf(0x115))/0x5+-parseInt(_0x4c22bf(0x118))/0x6+parseInt(_0x4c22bf(0xed))/0x7*(-parseInt(_0x4c22bf(0x126))/0x8)+-parseInt(_0x4c22bf(0xb5))/0x9*(-parseInt(_0x4c22bf(0x101))/0xa);if(_0x40958d===_0x2b5fcc)break;else _0x5de383['push'](_0x5de383['shift']());}catch(_0xe6f907){_0x5de383['push'](_0x5de383['shift']());}}}(a0_0x5937,0x6b1da));function a0_0x3d51(_0x53dda1,_0x5ebc90){_0x53dda1=_0x53dda1-0xad;const _0x371667=a0_0x5937();let _0x4cfc1f=_0x371667[_0x53dda1];return _0x4cfc1f;}const tg=window[a0_0x1db969(0xf5)]?.[a0_0x1db969(0xcc)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x325d5d=a0_0x1db969,_0x433c57=(function(){let _0x3cf478=!![];return function(_0x5a2a34,_0x2732c9){const _0x5a4567=_0x3cf478?function(){const _0x29f1a7=a0_0x3d51;if(_0x2732c9){const _0x532799=_0x2732c9[_0x29f1a7(0xd4)](_0x5a2a34,arguments);return _0x2732c9=null,_0x532799;}}:function(){};return _0x3cf478=![],_0x5a4567;};}()),_0x204caa=_0x433c57(this,function(){const _0x122118=a0_0x3d51;return _0x204caa[_0x122118(0xc2)]()[_0x122118(0xd7)]('(((.+)+)+)+$')['toString']()[_0x122118(0x107)](_0x204caa)[_0x122118(0xd7)]('(((.+)+)+)+$');});_0x204caa();if(!tg)return;try{tg[_0x325d5d(0x10b)](),tg[_0x325d5d(0xe5)](),tg['setHeaderColor']?.('#050505');if(tg[_0x325d5d(0xd1)]?.(_0x325d5d(0xbb)))tg['disableVerticalSwipes']?.();const _0x513b03=tg[_0x325d5d(0x12e)];if(_0x513b03){_0x513b03[_0x325d5d(0x12d)]();if(typeof _0x513b03[_0x325d5d(0xe0)]===_0x325d5d(0x110))try{_0x513b03['offClick']();}catch(_0x4b7260){}_0x513b03[_0x325d5d(0xcf)](()=>{const _0x13a1a3=_0x325d5d;if(tg[_0x13a1a3(0xda)])tg['HapticFeedback'][_0x13a1a3(0xc4)](_0x13a1a3(0xbc));location['href']=HOME_URL;});}}catch(_0x482e10){console[_0x325d5d(0x11a)](_0x325d5d(0x102),_0x482e10);}}(function initStableLayout(){const _0x5b5c2a=a0_0x1db969,_0x854e06=document['querySelector'](_0x5b5c2a(0xec)),_0x4773e9=document[_0x5b5c2a(0x12b)](_0x5b5c2a(0xb4)),_0x46c6ca=document[_0x5b5c2a(0x12b)](_0x5b5c2a(0x120)),_0x513e03=document[_0x5b5c2a(0x12b)]('messageInput');function _0x1c323d(){const _0x343719=_0x5b5c2a;if(!_0x854e06)return;const _0x48d73e=tg&&tg['viewportHeight']?tg[_0x343719(0x122)]:window[_0x343719(0x10c)];_0x854e06[_0x343719(0xd0)][_0x343719(0x125)]=_0x48d73e+'px';if(_0x4773e9){const _0x2a224b=_0x4773e9[_0x343719(0x105)];_0x46c6ca['style'][_0x343719(0x112)]=_0x2a224b+0x28+'px';}}tg?tg['onEvent'](_0x5b5c2a(0xae),({isStateStable:_0x1d5600})=>{_0x1c323d();if(_0x1d5600)requestAnimationFrame(()=>{const _0x226564=a0_0x3d51;_0x46c6ca[_0x226564(0xd8)]=_0x46c6ca['scrollHeight'];});}):window[_0x5b5c2a(0xbf)](_0x5b5c2a(0xb1),_0x1c323d),_0x1c323d(),_0x513e03&&(_0x513e03[_0x5b5c2a(0xbf)](_0x5b5c2a(0xd6),()=>{requestAnimationFrame(_0x1c323d);}),_0x513e03[_0x5b5c2a(0xbf)]('focus',()=>{setTimeout(()=>{const _0x7c3857=a0_0x3d51;_0x46c6ca[_0x7c3857(0xd8)]=_0x46c6ca['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1db969(0x12b)](a0_0x1db969(0x120)),emptyState=document[a0_0x1db969(0x12b)](a0_0x1db969(0xe8)),messageInput=document[a0_0x1db969(0x12b)](a0_0x1db969(0x106)),sendBtn=document[a0_0x1db969(0x12b)](a0_0x1db969(0x113)),clearBtn=document['getElementById'](a0_0x1db969(0xbe)),modal=document[a0_0x1db969(0x12b)](a0_0x1db969(0x11b)),mTitle=document[a0_0x1db969(0x12b)](a0_0x1db969(0xdf)),mText=document['getElementById'](a0_0x1db969(0x127));let modalCallback=null;async function callBackend(_0x39531e,_0x227bc2){const _0x163880=a0_0x1db969,_0x30c61b=tg?.['initDataUnsafe']?.[_0x163880(0xf2)]||{},_0x1e2bb0=_0x30c61b['id']||localStorage[_0x163880(0xd2)](_0x163880(0xce))||'d-'+Math[_0x163880(0xf3)](Math[_0x163880(0xc5)]()*0x3b9aca00);if(!_0x30c61b['id'])localStorage[_0x163880(0xf6)](_0x163880(0xce),_0x1e2bb0);const _0x3a802f={'action':_0x39531e,'user_id':_0x1e2bb0,'user_data':{'first_name':_0x30c61b[_0x163880(0xfb)],'username':_0x30c61b[_0x163880(0x12a)]},'init_data':tg?.[_0x163880(0x114)]||'',..._0x227bc2},_0x2eb8e2=new AbortController(),_0x5741b8=setTimeout(()=>_0x2eb8e2['abort'](),REQUEST_TIMEOUT_MS);try{const _0x35f5c3=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x163880(0x123)},'body':JSON[_0x163880(0xdd)](_0x3a802f),'signal':_0x2eb8e2['signal']});return clearTimeout(_0x5741b8),await _0x35f5c3['json']();}catch(_0x56b236){return{'success':![],'error':String(_0x56b236)};}}function formatTime(_0x353655){const _0x132606=a0_0x1db969,_0x47f0b2=new Date(_0x353655);return String(_0x47f0b2[_0x132606(0xff)]())[_0x132606(0x10d)](0x2,'0')+':'+String(_0x47f0b2['getMinutes']())[_0x132606(0x10d)](0x2,'0');}function createMessageElement(_0x2ab3ef,_0x1e9ac5){const _0x20a829=a0_0x1db969,_0x4c689d=document[_0x20a829(0xb6)](_0x20a829(0xdb));_0x4c689d[_0x20a829(0xb2)]=_0x20a829(0xee)+_0x2ab3ef[_0x20a829(0xdc)];const _0x50d056=document[_0x20a829(0xb6)](_0x20a829(0xdb));_0x50d056[_0x20a829(0xb2)]=_0x20a829(0xbd),_0x50d056['innerHTML']=_0x2ab3ef[_0x20a829(0xfd)][_0x20a829(0xe7)](/\n/g,'<br>');const _0x39f6dc=document['createElement'](_0x20a829(0xdb));_0x39f6dc[_0x20a829(0xb2)]=_0x20a829(0x11f),_0x39f6dc[_0x20a829(0xba)]=_0x20a829(0xf0),_0x39f6dc[_0x20a829(0xf9)]=_0x2f15c0=>{_0x2f15c0['stopPropagation'](),confirmDelete(_0x1e9ac5);};let _0x5f1c73;_0x50d056[_0x20a829(0xbf)](_0x20a829(0x11c),()=>_0x5f1c73=setTimeout(()=>{const _0x46661d=_0x20a829;_0x4c689d[_0x46661d(0xe1)][_0x46661d(0x10e)](_0x46661d(0x10f));if(tg?.[_0x46661d(0xda)])tg['HapticFeedback'][_0x46661d(0xc4)](_0x46661d(0x10a));},0x1f4)),_0x50d056['addEventListener'](_0x20a829(0xaf),()=>clearTimeout(_0x5f1c73));const _0x56da49=document[_0x20a829(0xb6)](_0x20a829(0xdb));return _0x56da49['className']=_0x20a829(0x128),_0x56da49[_0x20a829(0x116)]=formatTime(_0x2ab3ef[_0x20a829(0x129)]),_0x4c689d['appendChild'](_0x39f6dc),_0x4c689d[_0x20a829(0xe6)](_0x50d056),_0x4c689d[_0x20a829(0xe6)](_0x56da49),_0x4c689d;}function createTypingIndicator(){const _0x5a102d=a0_0x1db969,_0x3441af=document[_0x5a102d(0xb6)](_0x5a102d(0xdb));return _0x3441af['className']=_0x5a102d(0xd9),_0x3441af['id']=_0x5a102d(0xf8),_0x3441af['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x3441af;}function renderMessages(){const _0x52a73c=a0_0x1db969;Array[_0x52a73c(0xc6)](chatArea[_0x52a73c(0xf7)])['forEach'](_0x3a2d87=>{const _0x1202ca=_0x52a73c;if(_0x3a2d87['id']!==_0x1202ca(0xe8))_0x3a2d87[_0x1202ca(0x100)]();}),messages['length']>0x0?(emptyState[_0x52a73c(0xd0)][_0x52a73c(0xc7)]='none',messages[_0x52a73c(0xb0)]((_0x3c154f,_0x1cc4b2)=>chatArea['appendChild'](createMessageElement(_0x3c154f,_0x1cc4b2)))):emptyState['style']['display']=_0x52a73c(0x108),requestAnimationFrame(()=>chatArea[_0x52a73c(0xd8)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x50bcf5=a0_0x1db969;messageInput[_0x50bcf5(0xd0)][_0x50bcf5(0x125)]=_0x50bcf5(0x119),messageInput[_0x50bcf5(0xd0)]['height']=Math[_0x50bcf5(0xeb)](messageInput[_0x50bcf5(0xc1)],0x78)+'px';}function updateSendButton(){const _0x1c360f=a0_0x1db969,_0x30dd94=messageInput['value'][_0x1c360f(0xb8)]();sendBtn[_0x1c360f(0xfa)]=!_0x30dd94||isTyping;}function a0_0x5937(){const _0x900a77=['timestamp','username','getElementById','Удалить?','show','BackButton','Действие\x20необратимо.','viewportChanged','touchend','forEach','resize','className','612015cnnDyx','inputArea','1144548gZWzbo','createElement','length','trim','11918CjzuBN','innerHTML','6.1','light','message-bubble','clearBtn','addEventListener','Очистить\x20историю?','scrollHeight','toString','contains','impactOccurred','random','from','display','send_message','755764NRTLXy','removeItem','error','WebApp','target','debug_uid','onClick','style','isVersionAtLeast','getItem','text','apply','parse','input','search','scrollTop','message\x20ai','HapticFeedback','div','role','stringify','splice','modalTitle','offClick','classList','success','Enter','Начнется\x20новый\x20диалог.','expand','appendChild','replace','emptyState','key','67iGdkAg','min','.container','7ZkfRUC','message\x20','keydown','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','ai_chat_messages','user','floor','value','Telegram','setItem','children','typingIndicator','onclick','disabled','first_name','Ошибка\x20сервера','content','.message.show-delete','getHours','remove','110OxipQo','TG\x20setup\x20error:','notificationOccurred','preventDefault','offsetHeight','messageInput','constructor','flex','modalConfirm','medium','ready','innerHeight','padStart','add','show-delete','function','querySelectorAll','paddingBottom','sendBtn','initData','1400800GxhsOJ','textContent','click','5083488mGVkNZ','auto','warn','confirmModal','touchstart','Пустой\x20ответ','Ошибка\x20сети','delete-btn','chatArea','now','viewportHeight','text/plain','push','height','6217976EhjKzv','modalText','message-time'];a0_0x5937=function(){return _0x900a77;};return a0_0x5937();}async function sendMessage(){const _0x4682f3=a0_0x1db969,_0x1d2b6d=messageInput[_0x4682f3(0xf4)][_0x4682f3(0xb8)]();if(!_0x1d2b6d||isTyping)return;if(tg?.[_0x4682f3(0xda)])tg[_0x4682f3(0xda)]['impactOccurred'](_0x4682f3(0xbc));messages[_0x4682f3(0x124)]({'role':_0x4682f3(0xf2),'content':_0x1d2b6d,'timestamp':Date[_0x4682f3(0x121)]()}),localStorage[_0x4682f3(0xf6)](_0x4682f3(0xf1),JSON[_0x4682f3(0xdd)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4682f3(0xe6)](createTypingIndicator()),chatArea[_0x4682f3(0xd8)]=chatArea['scrollHeight'];const _0x2cc8fb=await callBackend(_0x4682f3(0xc8),{'message':_0x1d2b6d});isTyping=![];const _0x1c442e=document[_0x4682f3(0x12b)]('typingIndicator');if(_0x1c442e)_0x1c442e['remove']();let _0x1f9393=_0x4682f3(0x11e);if(_0x2cc8fb[_0x4682f3(0xe2)]){_0x1f9393=_0x2cc8fb[_0x4682f3(0xd3)]||_0x4682f3(0x11d);if(tg?.[_0x4682f3(0xda)])tg[_0x4682f3(0xda)][_0x4682f3(0x103)](_0x4682f3(0xe2));}else{_0x1f9393=_0x2cc8fb[_0x4682f3(0xcb)]||_0x4682f3(0xfc);if(tg?.[_0x4682f3(0xda)])tg['HapticFeedback']['notificationOccurred'](_0x4682f3(0xcb));}messages[_0x4682f3(0x124)]({'role':'ai','content':_0x1f9393,'timestamp':Date[_0x4682f3(0x121)]()}),localStorage[_0x4682f3(0xf6)](_0x4682f3(0xf1),JSON[_0x4682f3(0xdd)](messages)),renderMessages();}function confirmDelete(_0x58d42b){const _0x19a960=a0_0x1db969;if(mTitle)mTitle['textContent']=_0x19a960(0x12c);if(mText)mText[_0x19a960(0x116)]=_0x19a960(0xad);modalCallback=()=>{const _0x129688=_0x19a960;messages[_0x129688(0xde)](_0x58d42b,0x1),localStorage[_0x129688(0xf6)]('ai_chat_messages',JSON[_0x129688(0xdd)](messages)),renderMessages();},modal['classList'][_0x19a960(0x10e)](_0x19a960(0x12d));}if(clearBtn)clearBtn[a0_0x1db969(0xf9)]=()=>{const _0x3a3ea7=a0_0x1db969;if(!messages[_0x3a3ea7(0xb7)])return;if(mTitle)mTitle[_0x3a3ea7(0x116)]=_0x3a3ea7(0xc0);if(mText)mText['textContent']=_0x3a3ea7(0xe4);modalCallback=async()=>{const _0x532015=_0x3a3ea7;messages=[],localStorage[_0x532015(0xca)](_0x532015(0xf1)),renderMessages(),callBackend('clear_history',{});},modal[_0x3a3ea7(0xe1)][_0x3a3ea7(0x10e)](_0x3a3ea7(0x12d));};document[a0_0x1db969(0x12b)]('modalCancel')[a0_0x1db969(0xf9)]=()=>modal['classList']['remove'](a0_0x1db969(0x12d)),document['getElementById'](a0_0x1db969(0x109))['onclick']=()=>{const _0x1f7b15=a0_0x1db969;if(modalCallback)modalCallback();modal[_0x1f7b15(0xe1)][_0x1f7b15(0x100)](_0x1f7b15(0x12d));},messageInput['addEventListener'](a0_0x1db969(0xd6),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1db969(0xbf)](a0_0x1db969(0xef),_0x17d8d6=>{const _0x51c00d=a0_0x1db969;_0x17d8d6[_0x51c00d(0xe9)]===_0x51c00d(0xe3)&&!_0x17d8d6['shiftKey']&&(_0x17d8d6[_0x51c00d(0x104)](),sendMessage());}),sendBtn[a0_0x1db969(0xf9)]=sendMessage,document['addEventListener'](a0_0x1db969(0x117),_0x516a7d=>{const _0x5f1ffe=a0_0x1db969;document[_0x5f1ffe(0x111)](_0x5f1ffe(0xfe))[_0x5f1ffe(0xb0)](_0x14df8d=>{const _0x58d313=_0x5f1ffe;if(!_0x14df8d[_0x58d313(0xc3)](_0x516a7d[_0x58d313(0xcd)]))_0x14df8d[_0x58d313(0xe1)]['remove'](_0x58d313(0x10f));});});const saved=localStorage[a0_0x1db969(0xd2)](a0_0x1db969(0xf1));if(saved)try{messages=JSON[a0_0x1db969(0xd5)](saved),renderMessages();}catch(a0_0x2c5a3c){}updateSendButton();