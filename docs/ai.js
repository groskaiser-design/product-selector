const a0_0x2655b5=a0_0x4dc4;(function(_0xc94aab,_0x4b1e13){const _0x3b24ab=a0_0x4dc4,_0x2ad989=_0xc94aab();while(!![]){try{const _0x26db25=-parseInt(_0x3b24ab(0x164))/0x1+-parseInt(_0x3b24ab(0x17f))/0x2*(-parseInt(_0x3b24ab(0x163))/0x3)+-parseInt(_0x3b24ab(0x141))/0x4*(-parseInt(_0x3b24ab(0x16a))/0x5)+parseInt(_0x3b24ab(0x13c))/0x6*(-parseInt(_0x3b24ab(0x109))/0x7)+parseInt(_0x3b24ab(0x15d))/0x8*(-parseInt(_0x3b24ab(0x110))/0x9)+-parseInt(_0x3b24ab(0x134))/0xa+parseInt(_0x3b24ab(0x13f))/0xb;if(_0x26db25===_0x4b1e13)break;else _0x2ad989['push'](_0x2ad989['shift']());}catch(_0x292e6a){_0x2ad989['push'](_0x2ad989['shift']());}}}(a0_0x6802,0x270e1));const tg=window[a0_0x2655b5(0x116)]?.[a0_0x2655b5(0x121)],HOME_URL=a0_0x2655b5(0x108);function a0_0x6802(){const _0xacdcf7=['toString','shiftKey','modalCancel','570pOMEeE','216128DFMmJw','clearBtn','innerHTML','key','light','Начнется\x20новый\x20диалог.','8605EbmzKS','error','preventDefault','add','#050505','contains','height','min','function','Пустой\x20ответ','ready','addEventListener','remove','children','send_message','textContent','getMinutes','auto','json','keydown','target','404alAJGm','parse','scrollTop','expand','value','appendChild','removeItem','show','ai_chat_messages','className','modalConfirm','trim','replace','abort','./router.html','427vNiklJ','display','Enter','Действие\x20необратимо.','disabled','signal','innerHeight','2844mKQktV','role','.container','debug_uid','viewportHeight','.message.show-delete','Telegram','constructor','Ошибка\x20сервера','chatArea','notificationOccurred','inputArea','querySelector','timestamp','impactOccurred','viewportChanged','setHeaderColor','WebApp','message\x20ai','emptyState','message-bubble','TG\x20setup\x20error:','modalText','message\x20','push','offClick','onEvent','messageInput','offsetHeight','typingIndicator','now','success','style','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','length','delete-btn','205780ASsjuM','6.1','resize','stopPropagation','HapticFeedback','touchend','getHours','div','30786fREhTE','getItem','focus','6624816MArlTS','onclick','264SUfMWN','POST','floor','getElementById','padStart','clear_history','forEach','Удалить?','onClick','user','<br>','scrollHeight','href','disableVerticalSwipes','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','text','createElement','random','stringify','content','medium','message-time','(((.+)+)+)+$','touchstart','BackButton','none','input','from','1128sEZyIw','setItem','classList'];a0_0x6802=function(){return _0xacdcf7;};return a0_0x6802();}function setupTelegramBackButton(){const _0x57b2ff=a0_0x2655b5,_0x53fbe4=(function(){let _0x1a143e=!![];return function(_0x28d3f0,_0x3ea9b4){const _0x50023f=_0x1a143e?function(){if(_0x3ea9b4){const _0x168b31=_0x3ea9b4['apply'](_0x28d3f0,arguments);return _0x3ea9b4=null,_0x168b31;}}:function(){};return _0x1a143e=![],_0x50023f;};}()),_0x55223a=_0x53fbe4(this,function(){const _0x363e5b=a0_0x4dc4;return _0x55223a['toString']()['search'](_0x363e5b(0x157))[_0x363e5b(0x160)]()[_0x363e5b(0x117)](_0x55223a)['search']('(((.+)+)+)+$');});_0x55223a();if(!tg)return;try{tg[_0x57b2ff(0x174)](),tg[_0x57b2ff(0x182)](),tg[_0x57b2ff(0x120)]?.(_0x57b2ff(0x16e));if(tg['isVersionAtLeast']?.(_0x57b2ff(0x135)))tg[_0x57b2ff(0x14e)]?.();const _0x108af0=tg[_0x57b2ff(0x159)];if(_0x108af0){_0x108af0[_0x57b2ff(0x101)]();if(typeof _0x108af0['offClick']===_0x57b2ff(0x172))try{_0x108af0[_0x57b2ff(0x129)]();}catch(_0x32d619){}_0x108af0[_0x57b2ff(0x149)](()=>{const _0x209761=_0x57b2ff;if(tg[_0x209761(0x138)])tg[_0x209761(0x138)][_0x209761(0x11e)]('light');location[_0x209761(0x14d)]=HOME_URL;});}}catch(_0x2bc6b3){console['warn'](_0x57b2ff(0x125),_0x2bc6b3);}}(function initStableLayout(){const _0x174c56=a0_0x2655b5,_0x51063f=document[_0x174c56(0x11c)](_0x174c56(0x112)),_0x49a51a=document[_0x174c56(0x144)](_0x174c56(0x11b)),_0x797f6e=document[_0x174c56(0x144)](_0x174c56(0x119)),_0x5f0e88=document[_0x174c56(0x144)](_0x174c56(0x12b));function _0x38179b(){const _0x3bc811=_0x174c56;if(!_0x51063f)return;const _0x1aafd2=tg&&tg[_0x3bc811(0x114)]?tg['viewportHeight']:window[_0x3bc811(0x10f)];_0x51063f['style'][_0x3bc811(0x170)]=_0x1aafd2+'px';if(_0x49a51a){const _0x3221d8=_0x49a51a[_0x3bc811(0x12c)];_0x797f6e[_0x3bc811(0x130)]['paddingBottom']=_0x3221d8+0x28+'px';}}tg?tg[_0x174c56(0x12a)](_0x174c56(0x11f),({isStateStable:_0x29f9fb})=>{_0x38179b();if(_0x29f9fb)requestAnimationFrame(()=>{const _0x2b14f8=a0_0x4dc4;_0x797f6e[_0x2b14f8(0x181)]=_0x797f6e['scrollHeight'];});}):window['addEventListener'](_0x174c56(0x136),_0x38179b),_0x38179b(),_0x5f0e88&&(_0x5f0e88['addEventListener'](_0x174c56(0x15b),()=>{requestAnimationFrame(_0x38179b);}),_0x5f0e88[_0x174c56(0x175)](_0x174c56(0x13e),()=>{setTimeout(()=>{const _0x128c73=a0_0x4dc4;_0x797f6e['scrollTop']=_0x797f6e[_0x128c73(0x14c)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2655b5(0x144)](a0_0x2655b5(0x119)),emptyState=document[a0_0x2655b5(0x144)](a0_0x2655b5(0x123)),messageInput=document[a0_0x2655b5(0x144)](a0_0x2655b5(0x12b)),sendBtn=document[a0_0x2655b5(0x144)]('sendBtn'),clearBtn=document['getElementById'](a0_0x2655b5(0x165)),modal=document['getElementById']('confirmModal'),mTitle=document['getElementById']('modalTitle'),mText=document['getElementById'](a0_0x2655b5(0x126));let modalCallback=null;async function callBackend(_0x14077b,_0x3297f4){const _0x3d5849=a0_0x2655b5,_0x4c78de=tg?.['initDataUnsafe']?.[_0x3d5849(0x14a)]||{},_0x335c71=_0x4c78de['id']||localStorage[_0x3d5849(0x13d)](_0x3d5849(0x113))||'d-'+Math[_0x3d5849(0x143)](Math[_0x3d5849(0x152)]()*0x3b9aca00);if(!_0x4c78de['id'])localStorage[_0x3d5849(0x15e)](_0x3d5849(0x113),_0x335c71);const _0xe4e049={'action':_0x14077b,'user_id':_0x335c71,'user_data':{'first_name':_0x4c78de['first_name'],'username':_0x4c78de['username']},'init_data':tg?.['initData']||'',..._0x3297f4},_0xa7f30d=new AbortController(),_0x325123=setTimeout(()=>_0xa7f30d[_0x3d5849(0x107)](),REQUEST_TIMEOUT_MS);try{const _0x2238b7=await fetch(BACKEND_URL,{'method':_0x3d5849(0x142),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x3d5849(0x153)](_0xe4e049),'signal':_0xa7f30d[_0x3d5849(0x10e)]});return clearTimeout(_0x325123),await _0x2238b7[_0x3d5849(0x17c)]();}catch(_0x142446){return{'success':![],'error':String(_0x142446)};}}function a0_0x4dc4(_0x2a1e3a,_0x4ee8b1){_0x2a1e3a=_0x2a1e3a-0xff;const _0x33b9a2=a0_0x6802();let _0x514040=_0x33b9a2[_0x2a1e3a];return _0x514040;}function formatTime(_0x31905b){const _0x376066=a0_0x2655b5,_0x5ec063=new Date(_0x31905b);return String(_0x5ec063[_0x376066(0x13a)]())[_0x376066(0x145)](0x2,'0')+':'+String(_0x5ec063[_0x376066(0x17a)]())['padStart'](0x2,'0');}function createMessageElement(_0x1310be,_0x27f836){const _0x36f5d2=a0_0x2655b5,_0x22fc98=document[_0x36f5d2(0x151)]('div');_0x22fc98['className']=_0x36f5d2(0x127)+_0x1310be[_0x36f5d2(0x111)];const _0x466ad8=document[_0x36f5d2(0x151)](_0x36f5d2(0x13b));_0x466ad8[_0x36f5d2(0x103)]=_0x36f5d2(0x124),_0x466ad8[_0x36f5d2(0x166)]=_0x1310be[_0x36f5d2(0x154)][_0x36f5d2(0x106)](/\n/g,_0x36f5d2(0x14b));const _0x160899=document['createElement']('div');_0x160899[_0x36f5d2(0x103)]=_0x36f5d2(0x133),_0x160899[_0x36f5d2(0x166)]=_0x36f5d2(0x14f),_0x160899[_0x36f5d2(0x140)]=_0x512b19=>{const _0x5ab1d4=_0x36f5d2;_0x512b19[_0x5ab1d4(0x137)](),confirmDelete(_0x27f836);};let _0x459494;_0x466ad8[_0x36f5d2(0x175)](_0x36f5d2(0x158),()=>_0x459494=setTimeout(()=>{const _0x25072e=_0x36f5d2;_0x22fc98['classList'][_0x25072e(0x16d)]('show-delete');if(tg?.[_0x25072e(0x138)])tg['HapticFeedback'][_0x25072e(0x11e)](_0x25072e(0x155));},0x1f4)),_0x466ad8[_0x36f5d2(0x175)](_0x36f5d2(0x139),()=>clearTimeout(_0x459494));const _0x444387=document['createElement'](_0x36f5d2(0x13b));return _0x444387['className']=_0x36f5d2(0x156),_0x444387[_0x36f5d2(0x179)]=formatTime(_0x1310be[_0x36f5d2(0x11d)]),_0x22fc98['appendChild'](_0x160899),_0x22fc98['appendChild'](_0x466ad8),_0x22fc98[_0x36f5d2(0xff)](_0x444387),_0x22fc98;}function createTypingIndicator(){const _0x5ee8f6=a0_0x2655b5,_0x2c3692=document[_0x5ee8f6(0x151)](_0x5ee8f6(0x13b));return _0x2c3692[_0x5ee8f6(0x103)]=_0x5ee8f6(0x122),_0x2c3692['id']=_0x5ee8f6(0x12d),_0x2c3692[_0x5ee8f6(0x166)]=_0x5ee8f6(0x131),_0x2c3692;}function renderMessages(){const _0x144912=a0_0x2655b5;Array[_0x144912(0x15c)](chatArea[_0x144912(0x177)])[_0x144912(0x147)](_0x391162=>{const _0x3e9ec5=_0x144912;if(_0x391162['id']!==_0x3e9ec5(0x123))_0x391162[_0x3e9ec5(0x176)]();}),messages[_0x144912(0x132)]>0x0?(emptyState[_0x144912(0x130)][_0x144912(0x10a)]=_0x144912(0x15a),messages[_0x144912(0x147)]((_0x39fc02,_0x22ff97)=>chatArea['appendChild'](createMessageElement(_0x39fc02,_0x22ff97)))):emptyState['style'][_0x144912(0x10a)]='flex',requestAnimationFrame(()=>chatArea[_0x144912(0x181)]=chatArea[_0x144912(0x14c)]);}function autoResizeTextarea(){const _0x120196=a0_0x2655b5;messageInput['style'][_0x120196(0x170)]=_0x120196(0x17b),messageInput[_0x120196(0x130)][_0x120196(0x170)]=Math[_0x120196(0x171)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x31c439=a0_0x2655b5,_0x2f71f3=messageInput[_0x31c439(0x183)][_0x31c439(0x105)]();sendBtn[_0x31c439(0x10d)]=!_0x2f71f3||isTyping;}async function sendMessage(){const _0x2c5d3a=a0_0x2655b5,_0x4f620a=messageInput['value'][_0x2c5d3a(0x105)]();if(!_0x4f620a||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2c5d3a(0x138)][_0x2c5d3a(0x11e)](_0x2c5d3a(0x168));messages[_0x2c5d3a(0x128)]({'role':_0x2c5d3a(0x14a),'content':_0x4f620a,'timestamp':Date[_0x2c5d3a(0x12e)]()}),localStorage[_0x2c5d3a(0x15e)](_0x2c5d3a(0x102),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2c5d3a(0xff)](createTypingIndicator()),chatArea[_0x2c5d3a(0x181)]=chatArea[_0x2c5d3a(0x14c)];const _0x3143d4=await callBackend(_0x2c5d3a(0x178),{'message':_0x4f620a});isTyping=![];const _0x193f63=document['getElementById']('typingIndicator');if(_0x193f63)_0x193f63['remove']();let _0x43411b='Ошибка\x20сети';if(_0x3143d4[_0x2c5d3a(0x12f)]){_0x43411b=_0x3143d4[_0x2c5d3a(0x150)]||_0x2c5d3a(0x173);if(tg?.[_0x2c5d3a(0x138)])tg[_0x2c5d3a(0x138)][_0x2c5d3a(0x11a)](_0x2c5d3a(0x12f));}else{_0x43411b=_0x3143d4[_0x2c5d3a(0x16b)]||_0x2c5d3a(0x118);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x2c5d3a(0x11a)](_0x2c5d3a(0x16b));}messages[_0x2c5d3a(0x128)]({'role':'ai','content':_0x43411b,'timestamp':Date[_0x2c5d3a(0x12e)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x2c5d3a(0x153)](messages)),renderMessages();}function confirmDelete(_0x6f6ee4){const _0x352d66=a0_0x2655b5;if(mTitle)mTitle[_0x352d66(0x179)]=_0x352d66(0x148);if(mText)mText['textContent']=_0x352d66(0x10c);modalCallback=()=>{const _0x4e23db=_0x352d66;messages['splice'](_0x6f6ee4,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x4e23db(0x153)](messages)),renderMessages();},modal[_0x352d66(0x15f)][_0x352d66(0x16d)]('show');}if(clearBtn)clearBtn[a0_0x2655b5(0x140)]=()=>{const _0x874c96=a0_0x2655b5;if(!messages['length'])return;if(mTitle)mTitle[_0x874c96(0x179)]='Очистить\x20историю?';if(mText)mText[_0x874c96(0x179)]=_0x874c96(0x169);modalCallback=async()=>{const _0x552caa=_0x874c96;messages=[],localStorage[_0x552caa(0x100)](_0x552caa(0x102)),renderMessages(),callBackend(_0x552caa(0x146),{});},modal[_0x874c96(0x15f)][_0x874c96(0x16d)](_0x874c96(0x101));};document['getElementById'](a0_0x2655b5(0x162))[a0_0x2655b5(0x140)]=()=>modal['classList']['remove'](a0_0x2655b5(0x101)),document[a0_0x2655b5(0x144)](a0_0x2655b5(0x104))['onclick']=()=>{const _0xb82c2e=a0_0x2655b5;if(modalCallback)modalCallback();modal['classList'][_0xb82c2e(0x176)]('show');},messageInput[a0_0x2655b5(0x175)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2655b5(0x175)](a0_0x2655b5(0x17d),_0x304613=>{const _0x5a0eaa=a0_0x2655b5;_0x304613[_0x5a0eaa(0x167)]===_0x5a0eaa(0x10b)&&!_0x304613[_0x5a0eaa(0x161)]&&(_0x304613[_0x5a0eaa(0x16c)](),sendMessage());}),sendBtn[a0_0x2655b5(0x140)]=sendMessage,document['addEventListener']('click',_0x4aaaf9=>{const _0x392b6e=a0_0x2655b5;document['querySelectorAll'](_0x392b6e(0x115))[_0x392b6e(0x147)](_0x53a03c=>{const _0xf9ff8f=_0x392b6e;if(!_0x53a03c[_0xf9ff8f(0x16f)](_0x4aaaf9[_0xf9ff8f(0x17e)]))_0x53a03c['classList'][_0xf9ff8f(0x176)]('show-delete');});});const saved=localStorage[a0_0x2655b5(0x13d)](a0_0x2655b5(0x102));if(saved)try{messages=JSON[a0_0x2655b5(0x180)](saved),renderMessages();}catch(a0_0x31e32e){}updateSendButton();