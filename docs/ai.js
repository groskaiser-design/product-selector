const a0_0x28fb44=a0_0x56ca;(function(_0x2a0c70,_0x31c9a0){const _0x5095be=a0_0x56ca,_0x214f0c=_0x2a0c70();while(!![]){try{const _0xcc6434=parseInt(_0x5095be(0x107))/0x1*(parseInt(_0x5095be(0xeb))/0x2)+parseInt(_0x5095be(0xcc))/0x3*(parseInt(_0x5095be(0x11a))/0x4)+parseInt(_0x5095be(0x114))/0x5*(-parseInt(_0x5095be(0xf3))/0x6)+-parseInt(_0x5095be(0x113))/0x7+parseInt(_0x5095be(0x122))/0x8+-parseInt(_0x5095be(0x105))/0x9+-parseInt(_0x5095be(0xb4))/0xa*(-parseInt(_0x5095be(0xdc))/0xb);if(_0xcc6434===_0x31c9a0)break;else _0x214f0c['push'](_0x214f0c['shift']());}catch(_0x2c7b5b){_0x214f0c['push'](_0x214f0c['shift']());}}}(a0_0x2b49,0x60d32));function a0_0x56ca(_0x4d3c44,_0x39a6e1){_0x4d3c44=_0x4d3c44-0xb4;const _0x1dad44=a0_0x2b49();let _0x4bae38=_0x1dad44[_0x4d3c44];return _0x4bae38;}const tg=window['Telegram']?.[a0_0x28fb44(0xe6)],HOME_URL=a0_0x28fb44(0xed);function setupTelegramBackButton(){const _0x2a0bfe=a0_0x28fb44;if(!tg)return;try{tg['ready'](),tg[_0x2a0bfe(0x121)](),tg[_0x2a0bfe(0xe3)]?.(_0x2a0bfe(0xc1));if(tg[_0x2a0bfe(0x10a)]?.('6.1'))tg[_0x2a0bfe(0xe2)]?.();const _0x1edc8f=tg[_0x2a0bfe(0x11e)];if(_0x1edc8f){_0x1edc8f[_0x2a0bfe(0x119)]();if(typeof _0x1edc8f[_0x2a0bfe(0x126)]===_0x2a0bfe(0xf9))try{_0x1edc8f[_0x2a0bfe(0x126)]();}catch(_0xd8022f){}_0x1edc8f[_0x2a0bfe(0x116)](()=>{const _0x46a889=_0x2a0bfe;if(tg[_0x46a889(0xcd)])tg['HapticFeedback'][_0x46a889(0xd1)](_0x46a889(0xf2));location[_0x46a889(0x120)]=HOME_URL;});}}catch(_0x51782d){console['warn'](_0x2a0bfe(0xb6),_0x51782d);}}(function initStableLayout(){const _0x48366d=a0_0x28fb44,_0x5a6eb4=(function(){let _0x521499=!![];return function(_0x499b3b,_0x586889){const _0x31d15c=_0x521499?function(){const _0x584f22=a0_0x56ca;if(_0x586889){const _0x1d5474=_0x586889[_0x584f22(0xd7)](_0x499b3b,arguments);return _0x586889=null,_0x1d5474;}}:function(){};return _0x521499=![],_0x31d15c;};}()),_0x480c4b=document['querySelector']('.container'),_0x561e03=document[_0x48366d(0x12f)](_0x48366d(0xc0)),_0x5f7304=document[_0x48366d(0x12f)](_0x48366d(0x100)),_0x1e9fcd=document['getElementById'](_0x48366d(0xdf));function _0x58154d(){const _0x2a24fc=_0x48366d,_0x3e23c1=_0x5a6eb4(this,function(){const _0x196a31=a0_0x56ca;return _0x3e23c1[_0x196a31(0x12e)]()[_0x196a31(0xfe)](_0x196a31(0xcf))[_0x196a31(0x12e)]()[_0x196a31(0xfc)](_0x3e23c1)['search'](_0x196a31(0xcf));});_0x3e23c1();if(!_0x480c4b)return;const _0x19b7bb=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x2a24fc(0xf8)];_0x480c4b[_0x2a24fc(0xd8)][_0x2a24fc(0x118)]=_0x19b7bb+'px';if(_0x561e03){const _0x3cb024=_0x561e03['offsetHeight'];_0x5f7304[_0x2a24fc(0xd8)][_0x2a24fc(0xc7)]=_0x3cb024+0x28+'px';}}tg?tg['onEvent'](_0x48366d(0x12d),({isStateStable:_0x4737f8})=>{_0x58154d();if(_0x4737f8)requestAnimationFrame(()=>{const _0x27a6d6=a0_0x56ca;_0x5f7304[_0x27a6d6(0xd9)]=_0x5f7304[_0x27a6d6(0xe1)];});}):window[_0x48366d(0xc8)](_0x48366d(0xd4),_0x58154d),_0x58154d(),_0x1e9fcd&&(_0x1e9fcd['addEventListener'](_0x48366d(0xe7),()=>{requestAnimationFrame(_0x58154d);}),_0x1e9fcd['addEventListener'](_0x48366d(0xbe),()=>{setTimeout(()=>{const _0x1722fa=a0_0x56ca;_0x5f7304[_0x1722fa(0xd9)]=_0x5f7304['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x28fb44(0x11b),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x28fb44(0x12f)](a0_0x28fb44(0x100)),emptyState=document[a0_0x28fb44(0x12f)]('emptyState'),messageInput=document[a0_0x28fb44(0x12f)](a0_0x28fb44(0xdf)),sendBtn=document[a0_0x28fb44(0x12f)]('sendBtn'),clearBtn=document[a0_0x28fb44(0x12f)](a0_0x28fb44(0xee)),modal=document[a0_0x28fb44(0x12f)](a0_0x28fb44(0xec)),mTitle=document[a0_0x28fb44(0x12f)](a0_0x28fb44(0xdb)),mText=document[a0_0x28fb44(0x12f)](a0_0x28fb44(0xde));let modalCallback=null;async function callBackend(_0x542921,_0x31cae5){const _0x599676=a0_0x28fb44,_0x222576=tg?.[_0x599676(0xf7)]?.[_0x599676(0xd2)]||{},_0x502c4c=_0x222576['id']||localStorage['getItem'](_0x599676(0xfa))||'d-'+Math['floor'](Math[_0x599676(0x10d)]()*0x3b9aca00);if(!_0x222576['id'])localStorage['setItem'](_0x599676(0xfa),_0x502c4c);const _0x47d546={'action':_0x542921,'user_id':_0x502c4c,'user_data':{'first_name':_0x222576[_0x599676(0x112)],'username':_0x222576[_0x599676(0xea)]},'init_data':tg?.[_0x599676(0x124)]||'',..._0x31cae5},_0x4bbc28=new AbortController(),_0x852bb9=setTimeout(()=>_0x4bbc28['abort'](),REQUEST_TIMEOUT_MS);try{const _0x126510=await fetch(BACKEND_URL,{'method':_0x599676(0xca),'headers':{'Content-Type':_0x599676(0x129)},'body':JSON[_0x599676(0x10b)](_0x47d546),'signal':_0x4bbc28[_0x599676(0xbb)]});return clearTimeout(_0x852bb9),await _0x126510['json']();}catch(_0x2af6e7){return{'success':![],'error':String(_0x2af6e7)};}}function formatTime(_0x34b703){const _0x5e34ca=a0_0x28fb44,_0x5a9382=new Date(_0x34b703);return String(_0x5a9382[_0x5e34ca(0xbd)]())['padStart'](0x2,'0')+':'+String(_0x5a9382[_0x5e34ca(0xfb)]())['padStart'](0x2,'0');}function createMessageElement(_0x312d90,_0x1962ea){const _0xe5737=a0_0x28fb44,_0x4666ff=document[_0xe5737(0xd3)](_0xe5737(0xcb));_0x4666ff['className']=_0xe5737(0xd0)+_0x312d90[_0xe5737(0x11f)];const _0x4974d2=document['createElement']('div');_0x4974d2[_0xe5737(0xd5)]=_0xe5737(0xfd),_0x4974d2[_0xe5737(0xf4)]=_0x312d90[_0xe5737(0x11c)][_0xe5737(0xf0)](/\n/g,_0xe5737(0x111));const _0x462a02=document[_0xe5737(0xd3)]('div');_0x462a02[_0xe5737(0xd5)]=_0xe5737(0xe4),_0x462a02[_0xe5737(0xf4)]=_0xe5737(0xc3),_0x462a02[_0xe5737(0xc6)]=_0x3877d6=>{const _0xf8a3d5=_0xe5737;_0x3877d6[_0xf8a3d5(0x103)](),confirmDelete(_0x1962ea);};let _0xd2965b;_0x4974d2[_0xe5737(0xc8)](_0xe5737(0xf6),()=>_0xd2965b=setTimeout(()=>{const _0xfa9a0e=_0xe5737;_0x4666ff[_0xfa9a0e(0x10e)][_0xfa9a0e(0xc9)](_0xfa9a0e(0x12b));if(tg?.[_0xfa9a0e(0xcd)])tg[_0xfa9a0e(0xcd)][_0xfa9a0e(0xd1)]('medium');},0x1f4)),_0x4974d2[_0xe5737(0xc8)]('touchend',()=>clearTimeout(_0xd2965b));const _0x3d5c41=document[_0xe5737(0xd3)](_0xe5737(0xcb));return _0x3d5c41[_0xe5737(0xd5)]=_0xe5737(0x10f),_0x3d5c41[_0xe5737(0x117)]=formatTime(_0x312d90['timestamp']),_0x4666ff[_0xe5737(0x106)](_0x462a02),_0x4666ff[_0xe5737(0x106)](_0x4974d2),_0x4666ff[_0xe5737(0x106)](_0x3d5c41),_0x4666ff;}function createTypingIndicator(){const _0x560e0c=a0_0x28fb44,_0x5b68a5=document['createElement']('div');return _0x5b68a5[_0x560e0c(0xd5)]=_0x560e0c(0xc5),_0x5b68a5['id']=_0x560e0c(0xff),_0x5b68a5['innerHTML']=_0x560e0c(0xdd),_0x5b68a5;}function renderMessages(){const _0x30d0a6=a0_0x28fb44;Array[_0x30d0a6(0x109)](chatArea[_0x30d0a6(0x132)])['forEach'](_0x4077e1=>{const _0x1859bb=_0x30d0a6;if(_0x4077e1['id']!==_0x1859bb(0xf5))_0x4077e1['remove']();}),messages['length']>0x0?(emptyState[_0x30d0a6(0xd8)]['display']=_0x30d0a6(0x101),messages[_0x30d0a6(0x131)]((_0x196a38,_0x4e31fb)=>chatArea[_0x30d0a6(0x106)](createMessageElement(_0x196a38,_0x4e31fb)))):emptyState['style'][_0x30d0a6(0xb8)]=_0x30d0a6(0xc4),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x30d0a6(0xe1)]);}function autoResizeTextarea(){const _0x191810=a0_0x28fb44;messageInput[_0x191810(0xd8)][_0x191810(0x118)]=_0x191810(0x104),messageInput['style']['height']=Math['min'](messageInput[_0x191810(0xe1)],0x78)+'px';}function updateSendButton(){const _0x99a1c5=a0_0x28fb44,_0x529015=messageInput[_0x99a1c5(0xba)][_0x99a1c5(0xe8)]();sendBtn[_0x99a1c5(0x12a)]=!_0x529015||isTyping;}async function sendMessage(){const _0x2389fa=a0_0x28fb44,_0x5ba173=messageInput['value'][_0x2389fa(0xe8)]();if(!_0x5ba173||isTyping)return;if(tg?.[_0x2389fa(0xcd)])tg['HapticFeedback'][_0x2389fa(0xd1)]('light');messages[_0x2389fa(0x127)]({'role':'user','content':_0x5ba173,'timestamp':Date[_0x2389fa(0xd6)]()}),localStorage[_0x2389fa(0xc2)](_0x2389fa(0xb9),JSON[_0x2389fa(0x10b)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x2389fa(0xd9)]=chatArea[_0x2389fa(0xe1)];const _0x516d1e=await callBackend(_0x2389fa(0x123),{'message':_0x5ba173});isTyping=![];const _0x59a795=document[_0x2389fa(0x12f)]('typingIndicator');if(_0x59a795)_0x59a795[_0x2389fa(0xb5)]();let _0x458c48=_0x2389fa(0xbc);if(_0x516d1e[_0x2389fa(0x10c)]){_0x458c48=_0x516d1e[_0x2389fa(0x128)]||_0x2389fa(0x11d);if(tg?.['HapticFeedback'])tg[_0x2389fa(0xcd)][_0x2389fa(0x102)]('success');}else{_0x458c48=_0x516d1e[_0x2389fa(0x115)]||'Ошибка\x20сервера';if(tg?.[_0x2389fa(0xcd)])tg[_0x2389fa(0xcd)][_0x2389fa(0x102)]('error');}messages[_0x2389fa(0x127)]({'role':'ai','content':_0x458c48,'timestamp':Date[_0x2389fa(0xd6)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x2389fa(0x10b)](messages)),renderMessages();}function confirmDelete(_0x51a491){const _0x2666e1=a0_0x28fb44;if(mTitle)mTitle[_0x2666e1(0x117)]=_0x2666e1(0xda);if(mText)mText[_0x2666e1(0x117)]=_0x2666e1(0x130);modalCallback=()=>{const _0x40b593=_0x2666e1;messages[_0x40b593(0x125)](_0x51a491,0x1),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x2666e1(0x10e)][_0x2666e1(0xc9)](_0x2666e1(0x119));}if(clearBtn)clearBtn[a0_0x28fb44(0xc6)]=()=>{const _0x3f6c7b=a0_0x28fb44;if(!messages['length'])return;if(mTitle)mTitle[_0x3f6c7b(0x117)]='Очистить\x20историю?';if(mText)mText[_0x3f6c7b(0x117)]=_0x3f6c7b(0xbf);modalCallback=async()=>{const _0x5f2f2e=_0x3f6c7b;messages=[],localStorage[_0x5f2f2e(0xe9)]('ai_chat_messages'),renderMessages(),callBackend(_0x5f2f2e(0x108),{});},modal[_0x3f6c7b(0x10e)][_0x3f6c7b(0xc9)](_0x3f6c7b(0x119));};document[a0_0x28fb44(0x12f)](a0_0x28fb44(0xef))[a0_0x28fb44(0xc6)]=()=>modal[a0_0x28fb44(0x10e)][a0_0x28fb44(0xb5)](a0_0x28fb44(0x119)),document[a0_0x28fb44(0x12f)]('modalConfirm')[a0_0x28fb44(0xc6)]=()=>{if(modalCallback)modalCallback();modal['classList']['remove']('show');},messageInput['addEventListener'](a0_0x28fb44(0xe7),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x28fb44(0xc8)](a0_0x28fb44(0xf1),_0x1529ab=>{const _0x3c3fd5=a0_0x28fb44;_0x1529ab[_0x3c3fd5(0x110)]===_0x3c3fd5(0xe0)&&!_0x1529ab[_0x3c3fd5(0x12c)]&&(_0x1529ab['preventDefault'](),sendMessage());}),sendBtn[a0_0x28fb44(0xc6)]=sendMessage,document[a0_0x28fb44(0xc8)](a0_0x28fb44(0xce),_0x54977b=>{const _0x4c4ab8=a0_0x28fb44;document['querySelectorAll']('.message.show-delete')[_0x4c4ab8(0x131)](_0x56b723=>{const _0x572328=_0x4c4ab8;if(!_0x56b723[_0x572328(0xe5)](_0x54977b[_0x572328(0xb7)]))_0x56b723['classList'][_0x572328(0xb5)](_0x572328(0x12b));});});const saved=localStorage['getItem'](a0_0x28fb44(0xb9));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x53bf9b){}updateSendButton();function a0_0x2b49(){const _0x1dd66f=['766362AKsaEe','confirmModal','./router.html','clearBtn','modalCancel','replace','keydown','light','1633332wrFmBu','innerHTML','emptyState','touchstart','initDataUnsafe','innerHeight','function','debug_uid','getMinutes','constructor','message-bubble','search','typingIndicator','chatArea','none','notificationOccurred','stopPropagation','auto','6394005dBTtOb','appendChild','1DFUWIM','clear_history','from','isVersionAtLeast','stringify','success','random','classList','message-time','key','<br>','first_name','4625096CrUegy','10TNbyny','error','onClick','textContent','height','show','20qnrTrJ','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','content','Пустой\x20ответ','BackButton','role','href','expand','714288IYcacy','send_message','initData','splice','offClick','push','text','text/plain','disabled','show-delete','shiftKey','viewportChanged','toString','getElementById','Действие\x20необратимо.','forEach','children','11431490nhrtjf','remove','TG\x20setup\x20error:','target','display','ai_chat_messages','value','signal','Ошибка\x20сети','getHours','focus','Начнется\x20новый\x20диалог.','inputArea','#050505','setItem','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','flex','message\x20ai','onclick','paddingBottom','addEventListener','add','POST','div','417957tGuvTG','HapticFeedback','click','(((.+)+)+)+$','message\x20','impactOccurred','user','createElement','resize','className','now','apply','style','scrollTop','Удалить?','modalTitle','11SsrBZS','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','modalText','messageInput','Enter','scrollHeight','disableVerticalSwipes','setHeaderColor','delete-btn','contains','WebApp','input','trim','removeItem','username'];a0_0x2b49=function(){return _0x1dd66f;};return a0_0x2b49();}