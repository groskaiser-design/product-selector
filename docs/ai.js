const a0_0x389b21=a0_0x5d3e;(function(_0x47f131,_0x57bf90){const _0x78e72=a0_0x5d3e,_0x4161bb=_0x47f131();while(!![]){try{const _0x396d6b=parseInt(_0x78e72(0x1ce))/0x1+-parseInt(_0x78e72(0x1c3))/0x2+parseInt(_0x78e72(0x1c2))/0x3*(parseInt(_0x78e72(0x184))/0x4)+-parseInt(_0x78e72(0x1b2))/0x5+-parseInt(_0x78e72(0x18f))/0x6*(parseInt(_0x78e72(0x180))/0x7)+-parseInt(_0x78e72(0x1bd))/0x8*(parseInt(_0x78e72(0x163))/0x9)+parseInt(_0x78e72(0x182))/0xa;if(_0x396d6b===_0x57bf90)break;else _0x4161bb['push'](_0x4161bb['shift']());}catch(_0x5c7411){_0x4161bb['push'](_0x4161bb['shift']());}}}(a0_0x7af4,0xcf3d8));const tg=window[a0_0x389b21(0x183)]?.[a0_0x389b21(0x197)],HOME_URL=a0_0x389b21(0x1c7);function setupTelegramBackButton(){const _0x23b0a2=a0_0x389b21,_0x285ed2=(function(){let _0x5613d6=!![];return function(_0x5afda5,_0xb0324b){const _0x28bb96=_0x5613d6?function(){if(_0xb0324b){const _0xded1f1=_0xb0324b['apply'](_0x5afda5,arguments);return _0xb0324b=null,_0xded1f1;}}:function(){};return _0x5613d6=![],_0x28bb96;};}()),_0x53350f=_0x285ed2(this,function(){const _0xc0d761=a0_0x5d3e;return _0x53350f[_0xc0d761(0x1ac)]()[_0xc0d761(0x194)](_0xc0d761(0x196))[_0xc0d761(0x1ac)]()[_0xc0d761(0x181)](_0x53350f)[_0xc0d761(0x194)](_0xc0d761(0x196));});_0x53350f();if(!tg)return;try{tg['ready'](),tg[_0x23b0a2(0x15e)](),tg[_0x23b0a2(0x186)]?.(_0x23b0a2(0x192));if(tg[_0x23b0a2(0x1c9)]?.(_0x23b0a2(0x165)))tg[_0x23b0a2(0x17c)]?.();const _0x28fc9a=tg[_0x23b0a2(0x1d2)];if(_0x28fc9a){_0x28fc9a[_0x23b0a2(0x16f)]();if(typeof _0x28fc9a[_0x23b0a2(0x174)]===_0x23b0a2(0x1c4))try{_0x28fc9a['offClick']();}catch(_0x3af67b){}_0x28fc9a[_0x23b0a2(0x17b)](()=>{const _0x1ebe60=_0x23b0a2;if(tg[_0x1ebe60(0x19f)])tg[_0x1ebe60(0x19f)][_0x1ebe60(0x1a2)]('light');location[_0x1ebe60(0x1aa)]=HOME_URL;});}}catch(_0x5b7898){console[_0x23b0a2(0x15f)]('TG\x20setup\x20error:',_0x5b7898);}}(function initStableLayout(){const _0x24b0f1=a0_0x389b21,_0x2b9d83=document[_0x24b0f1(0x1cb)]('.container'),_0x339fc9=document[_0x24b0f1(0x189)](_0x24b0f1(0x1be)),_0x4e2b9f=document[_0x24b0f1(0x189)]('chatArea'),_0x1df750=document['getElementById'](_0x24b0f1(0x1d6));function _0x2850a2(){const _0x29887c=_0x24b0f1;if(!_0x2b9d83)return;const _0x75d730=tg&&tg[_0x29887c(0x1a7)]?tg['viewportHeight']:window[_0x29887c(0x1a4)];_0x2b9d83['style'][_0x29887c(0x15d)]=_0x75d730+'px';if(_0x339fc9){const _0x61fc32=_0x339fc9[_0x29887c(0x176)];_0x4e2b9f[_0x29887c(0x1d8)][_0x29887c(0x1c1)]=_0x61fc32+0x28+'px';}}tg?tg[_0x24b0f1(0x1cf)]('viewportChanged',({isStateStable:_0x583bb1})=>{_0x2850a2();if(_0x583bb1)requestAnimationFrame(()=>{const _0x310ed0=a0_0x5d3e;_0x4e2b9f[_0x310ed0(0x1d7)]=_0x4e2b9f[_0x310ed0(0x1bb)];});}):window[_0x24b0f1(0x156)](_0x24b0f1(0x185),_0x2850a2),_0x2850a2(),_0x1df750&&(_0x1df750[_0x24b0f1(0x156)](_0x24b0f1(0x157),()=>{requestAnimationFrame(_0x2850a2);}),_0x1df750[_0x24b0f1(0x156)](_0x24b0f1(0x1ad),()=>{setTimeout(()=>{_0x4e2b9f['scrollTop']=_0x4e2b9f['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x389b21(0x189)](a0_0x389b21(0x198)),emptyState=document[a0_0x389b21(0x189)](a0_0x389b21(0x173)),messageInput=document['getElementById']('messageInput'),sendBtn=document[a0_0x389b21(0x189)](a0_0x389b21(0x195)),clearBtn=document[a0_0x389b21(0x189)](a0_0x389b21(0x1db)),modal=document['getElementById'](a0_0x389b21(0x1c0)),mTitle=document['getElementById'](a0_0x389b21(0x191)),mText=document[a0_0x389b21(0x189)](a0_0x389b21(0x1cd));let modalCallback=null;async function callBackend(_0x479967,_0x581473){const _0x4a482c=a0_0x389b21,_0x126655=tg?.[_0x4a482c(0x1a9)]?.[_0x4a482c(0x169)]||{},_0x3c8aab=_0x126655['id']||localStorage[_0x4a482c(0x19c)](_0x4a482c(0x159))||'d-'+Math[_0x4a482c(0x162)](Math[_0x4a482c(0x1b4)]()*0x3b9aca00);if(!_0x126655['id'])localStorage['setItem']('debug_uid',_0x3c8aab);const _0x5f391e={'action':_0x479967,'user_id':_0x3c8aab,'user_data':{'first_name':_0x126655[_0x4a482c(0x17d)],'username':_0x126655[_0x4a482c(0x15a)]},'init_data':tg?.[_0x4a482c(0x1ae)]||'',..._0x581473},_0xa3ebe0=new AbortController(),_0x28eb34=setTimeout(()=>_0xa3ebe0[_0x4a482c(0x15b)](),REQUEST_TIMEOUT_MS);try{const _0x415bb5=await fetch(BACKEND_URL,{'method':_0x4a482c(0x1a0),'headers':{'Content-Type':_0x4a482c(0x172)},'body':JSON[_0x4a482c(0x188)](_0x5f391e),'signal':_0xa3ebe0['signal']});return clearTimeout(_0x28eb34),await _0x415bb5[_0x4a482c(0x16a)]();}catch(_0x2eefcc){return{'success':![],'error':String(_0x2eefcc)};}}function formatTime(_0x450569){const _0x128966=a0_0x389b21,_0x63ebf6=new Date(_0x450569);return String(_0x63ebf6['getHours']())[_0x128966(0x1c5)](0x2,'0')+':'+String(_0x63ebf6['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x57b3b1,_0x233f82){const _0x431a7f=a0_0x389b21,_0xe4ed63=document[_0x431a7f(0x16b)](_0x431a7f(0x1b6));_0xe4ed63['className']='message\x20'+_0x57b3b1[_0x431a7f(0x1b0)];const _0x3719aa=document['createElement'](_0x431a7f(0x1b6));_0x3719aa[_0x431a7f(0x1af)]=_0x431a7f(0x1bf),_0x3719aa['innerHTML']=_0x57b3b1[_0x431a7f(0x1c6)][_0x431a7f(0x1ba)](/\n/g,_0x431a7f(0x1d1));const _0x985ad7=document[_0x431a7f(0x16b)]('div');_0x985ad7[_0x431a7f(0x1af)]=_0x431a7f(0x18c),_0x985ad7['innerHTML']=_0x431a7f(0x199),_0x985ad7[_0x431a7f(0x166)]=_0x3a1183=>{const _0x1a540e=_0x431a7f;_0x3a1183[_0x1a540e(0x1a5)](),confirmDelete(_0x233f82);};let _0x37723c;_0x3719aa[_0x431a7f(0x156)]('touchstart',()=>_0x37723c=setTimeout(()=>{const _0x1cad6d=_0x431a7f;_0xe4ed63[_0x1cad6d(0x19a)]['add'](_0x1cad6d(0x161));if(tg?.[_0x1cad6d(0x19f)])tg[_0x1cad6d(0x19f)][_0x1cad6d(0x1a2)](_0x1cad6d(0x18e));},0x1f4)),_0x3719aa['addEventListener'](_0x431a7f(0x1c8),()=>clearTimeout(_0x37723c));const _0x3a0265=document['createElement'](_0x431a7f(0x1b6));return _0x3a0265[_0x431a7f(0x1af)]='message-time',_0x3a0265['textContent']=formatTime(_0x57b3b1['timestamp']),_0xe4ed63[_0x431a7f(0x160)](_0x985ad7),_0xe4ed63['appendChild'](_0x3719aa),_0xe4ed63['appendChild'](_0x3a0265),_0xe4ed63;}function createTypingIndicator(){const _0x1e4888=a0_0x389b21,_0x51b4d3=document['createElement']('div');return _0x51b4d3[_0x1e4888(0x1af)]=_0x1e4888(0x16c),_0x51b4d3['id']=_0x1e4888(0x1d9),_0x51b4d3[_0x1e4888(0x17e)]=_0x1e4888(0x1b1),_0x51b4d3;}function renderMessages(){const _0x589d00=a0_0x389b21;Array[_0x589d00(0x1cc)](chatArea[_0x589d00(0x167)])[_0x589d00(0x1a8)](_0x5fe2fe=>{const _0x4bf1e5=_0x589d00;if(_0x5fe2fe['id']!=='emptyState')_0x5fe2fe[_0x4bf1e5(0x179)]();}),messages[_0x589d00(0x1a3)]>0x0?(emptyState[_0x589d00(0x1d8)][_0x589d00(0x175)]=_0x589d00(0x171),messages[_0x589d00(0x1a8)]((_0x2ca4ef,_0x53a99a)=>chatArea['appendChild'](createMessageElement(_0x2ca4ef,_0x53a99a)))):emptyState[_0x589d00(0x1d8)][_0x589d00(0x175)]=_0x589d00(0x1b9),requestAnimationFrame(()=>chatArea[_0x589d00(0x1d7)]=chatArea[_0x589d00(0x1bb)]);}function a0_0x5d3e(_0x527c0a,_0x1b56d6){_0x527c0a=_0x527c0a-0x155;const _0x32b2e6=a0_0x7af4();let _0x4123dd=_0x32b2e6[_0x527c0a];return _0x4123dd;}function autoResizeTextarea(){const _0x4059ad=a0_0x389b21;messageInput[_0x4059ad(0x1d8)][_0x4059ad(0x15d)]=_0x4059ad(0x1d3),messageInput['style'][_0x4059ad(0x15d)]=Math[_0x4059ad(0x15c)](messageInput[_0x4059ad(0x1bb)],0x78)+'px';}function updateSendButton(){const _0x44e56f=a0_0x389b21,_0x5d513d=messageInput[_0x44e56f(0x1ca)][_0x44e56f(0x168)]();sendBtn[_0x44e56f(0x19e)]=!_0x5d513d||isTyping;}async function sendMessage(){const _0x4d8ddb=a0_0x389b21,_0x432176=messageInput['value']['trim']();if(!_0x432176||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x4d8ddb(0x19f)][_0x4d8ddb(0x1a2)](_0x4d8ddb(0x155));messages[_0x4d8ddb(0x170)]({'role':'user','content':_0x432176,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x4d8ddb(0x188)](messages)),renderMessages(),messageInput[_0x4d8ddb(0x1ca)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4d8ddb(0x160)](createTypingIndicator()),chatArea[_0x4d8ddb(0x1d7)]=chatArea[_0x4d8ddb(0x1bb)];const _0x46e8fb=await callBackend(_0x4d8ddb(0x164),{'message':_0x432176});isTyping=![];const _0x195677=document[_0x4d8ddb(0x189)](_0x4d8ddb(0x1d9));if(_0x195677)_0x195677[_0x4d8ddb(0x179)]();let _0x2256f1='Ошибка\x20сети';if(_0x46e8fb[_0x4d8ddb(0x1d4)]){_0x2256f1=_0x46e8fb[_0x4d8ddb(0x1a1)]||_0x4d8ddb(0x1bc);if(tg?.[_0x4d8ddb(0x19f)])tg[_0x4d8ddb(0x19f)][_0x4d8ddb(0x1ab)](_0x4d8ddb(0x1d4));}else{_0x2256f1=_0x46e8fb[_0x4d8ddb(0x18a)]||_0x4d8ddb(0x16d);if(tg?.[_0x4d8ddb(0x19f)])tg[_0x4d8ddb(0x19f)][_0x4d8ddb(0x1ab)]('error');}messages[_0x4d8ddb(0x170)]({'role':'ai','content':_0x2256f1,'timestamp':Date[_0x4d8ddb(0x1d5)]()}),localStorage[_0x4d8ddb(0x17a)]('ai_chat_messages',JSON[_0x4d8ddb(0x188)](messages)),renderMessages();}function confirmDelete(_0x5a014f){const _0x51ed26=a0_0x389b21;if(mTitle)mTitle[_0x51ed26(0x190)]=_0x51ed26(0x1a6);if(mText)mText[_0x51ed26(0x190)]=_0x51ed26(0x177);modalCallback=()=>{const _0x1ea484=_0x51ed26;messages['splice'](_0x5a014f,0x1),localStorage[_0x1ea484(0x17a)](_0x1ea484(0x1b7),JSON['stringify'](messages)),renderMessages();},modal[_0x51ed26(0x19a)][_0x51ed26(0x158)](_0x51ed26(0x16f));}function a0_0x7af4(){const _0x4e5785=['Удалить?','viewportHeight','forEach','initDataUnsafe','href','notificationOccurred','toString','focus','initData','className','role','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','1709025LhzItO','parse','random','shiftKey','div','ai_chat_messages','contains','flex','replace','scrollHeight','Пустой\x20ответ','9839480UPVkLS','inputArea','message-bubble','confirmModal','paddingBottom','33BdOGBI','2626216eDHRnP','function','padStart','content','./router.html','touchend','isVersionAtLeast','value','querySelector','from','modalText','559520UyNYoI','onEvent','target','<br>','BackButton','auto','success','now','messageInput','scrollTop','style','typingIndicator','Enter','clearBtn','light','addEventListener','input','add','debug_uid','username','abort','min','height','expand','warn','appendChild','show-delete','floor','9EXiMTk','send_message','6.1','onclick','children','trim','user','json','createElement','message\x20ai','Ошибка\x20сервера','modalConfirm','show','push','none','text/plain','emptyState','offClick','display','offsetHeight','Действие\x20необратимо.','Очистить\x20историю?','remove','setItem','onClick','disableVerticalSwipes','first_name','innerHTML','keydown','826133grZJhw','constructor','29608500ukkqgp','Telegram','335072BvcOyL','resize','setHeaderColor','.message.show-delete','stringify','getElementById','error','modalCancel','delete-btn','preventDefault','medium','36mkyesF','textContent','modalTitle','#050505','querySelectorAll','search','sendBtn','(((.+)+)+)+$','WebApp','chatArea','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','classList','key','getItem','click','disabled','HapticFeedback','POST','text','impactOccurred','length','innerHeight','stopPropagation'];a0_0x7af4=function(){return _0x4e5785;};return a0_0x7af4();}if(clearBtn)clearBtn['onclick']=()=>{const _0x6459c6=a0_0x389b21;if(!messages[_0x6459c6(0x1a3)])return;if(mTitle)mTitle[_0x6459c6(0x190)]=_0x6459c6(0x178);if(mText)mText[_0x6459c6(0x190)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x575e83=_0x6459c6;messages=[],localStorage['removeItem'](_0x575e83(0x1b7)),renderMessages(),callBackend('clear_history',{});},modal[_0x6459c6(0x19a)]['add']('show');};document['getElementById'](a0_0x389b21(0x18b))[a0_0x389b21(0x166)]=()=>modal[a0_0x389b21(0x19a)][a0_0x389b21(0x179)]('show'),document[a0_0x389b21(0x189)](a0_0x389b21(0x16e))[a0_0x389b21(0x166)]=()=>{const _0x546020=a0_0x389b21;if(modalCallback)modalCallback();modal[_0x546020(0x19a)][_0x546020(0x179)](_0x546020(0x16f));},messageInput[a0_0x389b21(0x156)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x389b21(0x156)](a0_0x389b21(0x17f),_0x43cba2=>{const _0x19768a=a0_0x389b21;_0x43cba2[_0x19768a(0x19b)]===_0x19768a(0x1da)&&!_0x43cba2[_0x19768a(0x1b5)]&&(_0x43cba2[_0x19768a(0x18d)](),sendMessage());}),sendBtn[a0_0x389b21(0x166)]=sendMessage,document[a0_0x389b21(0x156)](a0_0x389b21(0x19d),_0x863db=>{const _0x1f2fe8=a0_0x389b21;document[_0x1f2fe8(0x193)](_0x1f2fe8(0x187))[_0x1f2fe8(0x1a8)](_0x5e5487=>{const _0x4a1e24=_0x1f2fe8;if(!_0x5e5487[_0x4a1e24(0x1b8)](_0x863db[_0x4a1e24(0x1d0)]))_0x5e5487[_0x4a1e24(0x19a)][_0x4a1e24(0x179)](_0x4a1e24(0x161));});});const saved=localStorage[a0_0x389b21(0x19c)]('ai_chat_messages');if(saved)try{messages=JSON[a0_0x389b21(0x1b3)](saved),renderMessages();}catch(a0_0x397caa){}updateSendButton();