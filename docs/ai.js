const a0_0x175892=a0_0x4139;(function(_0x176418,_0x4bb8df){const _0x612c65=a0_0x4139,_0x39ff92=_0x176418();while(!![]){try{const _0x3dc195=-parseInt(_0x612c65(0x1f6))/0x1+-parseInt(_0x612c65(0x1f3))/0x2+parseInt(_0x612c65(0x1df))/0x3+-parseInt(_0x612c65(0x1b5))/0x4+-parseInt(_0x612c65(0x1d6))/0x5+-parseInt(_0x612c65(0x1c3))/0x6*(parseInt(_0x612c65(0x1b7))/0x7)+-parseInt(_0x612c65(0x1e0))/0x8*(-parseInt(_0x612c65(0x217))/0x9);if(_0x3dc195===_0x4bb8df)break;else _0x39ff92['push'](_0x39ff92['shift']());}catch(_0x57d95a){_0x39ff92['push'](_0x39ff92['shift']());}}}(a0_0x15ff,0x58222));const tg=window[a0_0x175892(0x1e1)]?.[a0_0x175892(0x1af)],HOME_URL=a0_0x175892(0x1ef);function setupTelegramBackButton(){const _0x3777e6=a0_0x175892,_0x538a03=(function(){let _0x4acbcd=!![];return function(_0x41078a,_0x427045){const _0x2a233f=_0x4acbcd?function(){const _0x1cd3f2=a0_0x4139;if(_0x427045){const _0x29afa6=_0x427045[_0x1cd3f2(0x1db)](_0x41078a,arguments);return _0x427045=null,_0x29afa6;}}:function(){};return _0x4acbcd=![],_0x2a233f;};}()),_0x2a90ae=_0x538a03(this,function(){const _0x413c08=a0_0x4139;return _0x2a90ae[_0x413c08(0x1e4)]()[_0x413c08(0x1ca)]('(((.+)+)+)+$')[_0x413c08(0x1e4)]()[_0x413c08(0x1b4)](_0x2a90ae)[_0x413c08(0x1ca)](_0x413c08(0x1ea));});_0x2a90ae();if(!tg)return;try{tg['ready'](),tg[_0x3777e6(0x1c1)](),tg['setHeaderColor']?.('#050505');if(tg[_0x3777e6(0x208)]?.(_0x3777e6(0x1c7)))tg[_0x3777e6(0x1fd)]?.();const _0x271dd1=tg[_0x3777e6(0x1b3)];if(_0x271dd1){_0x271dd1[_0x3777e6(0x209)]();if(typeof _0x271dd1[_0x3777e6(0x206)]===_0x3777e6(0x1c5))try{_0x271dd1[_0x3777e6(0x206)]();}catch(_0x33c835){}_0x271dd1[_0x3777e6(0x1d2)](()=>{const _0x2825f8=_0x3777e6;if(tg[_0x2825f8(0x1aa)])tg[_0x2825f8(0x1aa)][_0x2825f8(0x1ff)](_0x2825f8(0x20b));location['href']=HOME_URL;});}}catch(_0x18d6b8){console[_0x3777e6(0x1d1)](_0x3777e6(0x207),_0x18d6b8);}}(function initStableLayout(){const _0x116c77=a0_0x175892,_0x1eb0e2=document['querySelector'](_0x116c77(0x200)),_0x2be312=document[_0x116c77(0x1bc)](_0x116c77(0x1bb)),_0x4a9f76=document[_0x116c77(0x1bc)](_0x116c77(0x1a5)),_0x4cfce3=document[_0x116c77(0x1bc)](_0x116c77(0x20d));function _0x233d28(){const _0x346375=_0x116c77;if(!_0x1eb0e2)return;const _0x1b843b=tg&&tg[_0x346375(0x201)]?tg[_0x346375(0x201)]:window[_0x346375(0x20a)];_0x1eb0e2[_0x346375(0x1e5)]['height']=_0x1b843b+'px';if(_0x2be312){const _0x176448=_0x2be312[_0x346375(0x1d8)];_0x4a9f76[_0x346375(0x1e5)][_0x346375(0x1da)]=_0x176448+0x28+'px';}}tg?tg[_0x116c77(0x1c8)]('viewportChanged',({isStateStable:_0x10cbb1})=>{_0x233d28();if(_0x10cbb1)requestAnimationFrame(()=>{const _0x1f4f81=a0_0x4139;_0x4a9f76[_0x1f4f81(0x20c)]=_0x4a9f76[_0x1f4f81(0x1be)];});}):window[_0x116c77(0x21c)](_0x116c77(0x1b9),_0x233d28),_0x233d28(),_0x4cfce3&&(_0x4cfce3[_0x116c77(0x21c)]('input',()=>{requestAnimationFrame(_0x233d28);}),_0x4cfce3['addEventListener'](_0x116c77(0x212),()=>{setTimeout(()=>{const _0x53e7fe=a0_0x4139;_0x4a9f76[_0x53e7fe(0x20c)]=_0x4a9f76['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x175892(0x1bc)]('chatArea'),emptyState=document[a0_0x175892(0x1bc)](a0_0x175892(0x1e8)),messageInput=document[a0_0x175892(0x1bc)](a0_0x175892(0x20d)),sendBtn=document[a0_0x175892(0x1bc)](a0_0x175892(0x1fa)),clearBtn=document['getElementById'](a0_0x175892(0x1ad)),modal=document[a0_0x175892(0x1bc)](a0_0x175892(0x221)),mTitle=document[a0_0x175892(0x1bc)](a0_0x175892(0x210)),mText=document[a0_0x175892(0x1bc)](a0_0x175892(0x1c4));let modalCallback=null;function a0_0x4139(_0x332866,_0x4dfc78){_0x332866=_0x332866-0x1a5;const _0x540c28=a0_0x15ff();let _0x1ae328=_0x540c28[_0x332866];return _0x1ae328;}async function callBackend(_0x5ca689,_0x437d07){const _0xc12bb=a0_0x175892,_0x235abf=tg?.[_0xc12bb(0x1e3)]?.[_0xc12bb(0x21e)]||{},_0x45026a=_0x235abf['id']||localStorage[_0xc12bb(0x1cb)]('debug_uid')||'d-'+Math[_0xc12bb(0x213)](Math[_0xc12bb(0x1bd)]()*0x3b9aca00);if(!_0x235abf['id'])localStorage['setItem'](_0xc12bb(0x1a6),_0x45026a);const _0x3a91d8={'action':_0x5ca689,'user_id':_0x45026a,'user_data':{'first_name':_0x235abf['first_name'],'username':_0x235abf[_0xc12bb(0x211)]},'init_data':tg?.[_0xc12bb(0x1de)]||'',..._0x437d07},_0x287a9a=new AbortController(),_0x490ccf=setTimeout(()=>_0x287a9a[_0xc12bb(0x1fc)](),REQUEST_TIMEOUT_MS);try{const _0xc60a29=await fetch(BACKEND_URL,{'method':_0xc12bb(0x205),'headers':{'Content-Type':_0xc12bb(0x1b6)},'body':JSON[_0xc12bb(0x1f4)](_0x3a91d8),'signal':_0x287a9a[_0xc12bb(0x1d0)]});return clearTimeout(_0x490ccf),await _0xc60a29[_0xc12bb(0x1f8)]();}catch(_0x2a9202){return{'success':![],'error':String(_0x2a9202)};}}function formatTime(_0x4117ca){const _0x11f42b=a0_0x175892,_0x3508c3=new Date(_0x4117ca);return String(_0x3508c3['getHours']())[_0x11f42b(0x1dc)](0x2,'0')+':'+String(_0x3508c3[_0x11f42b(0x216)]())[_0x11f42b(0x1dc)](0x2,'0');}function createMessageElement(_0x147997,_0x462ea3){const _0x36e2cc=a0_0x175892,_0x176572=document[_0x36e2cc(0x1f9)]('div');_0x176572[_0x36e2cc(0x1d5)]=_0x36e2cc(0x20e)+_0x147997[_0x36e2cc(0x1eb)];const _0x4a1ce1=document[_0x36e2cc(0x1f9)](_0x36e2cc(0x1ee));_0x4a1ce1['className']='message-bubble',_0x4a1ce1[_0x36e2cc(0x21d)]=_0x147997['content']['replace'](/\n/g,_0x36e2cc(0x1e6));const _0x17550d=document['createElement'](_0x36e2cc(0x1ee));_0x17550d[_0x36e2cc(0x1d5)]=_0x36e2cc(0x214),_0x17550d['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x17550d['onclick']=_0x43f2d5=>{const _0x459150=_0x36e2cc;_0x43f2d5[_0x459150(0x1d4)](),confirmDelete(_0x462ea3);};let _0x39a947;_0x4a1ce1[_0x36e2cc(0x21c)](_0x36e2cc(0x218),()=>_0x39a947=setTimeout(()=>{const _0x1934a8=_0x36e2cc;_0x176572[_0x1934a8(0x1b2)]['add'](_0x1934a8(0x1a9));if(tg?.[_0x1934a8(0x1aa)])tg['HapticFeedback'][_0x1934a8(0x1ff)]('medium');},0x1f4)),_0x4a1ce1[_0x36e2cc(0x21c)](_0x36e2cc(0x1fe),()=>clearTimeout(_0x39a947));const _0x25d361=document[_0x36e2cc(0x1f9)]('div');return _0x25d361[_0x36e2cc(0x1d5)]='message-time',_0x25d361[_0x36e2cc(0x202)]=formatTime(_0x147997[_0x36e2cc(0x21a)]),_0x176572[_0x36e2cc(0x1a7)](_0x17550d),_0x176572[_0x36e2cc(0x1a7)](_0x4a1ce1),_0x176572[_0x36e2cc(0x1a7)](_0x25d361),_0x176572;}function createTypingIndicator(){const _0x355ace=a0_0x175892,_0x518877=document[_0x355ace(0x1f9)]('div');return _0x518877['className']=_0x355ace(0x21f),_0x518877['id']='typingIndicator',_0x518877['innerHTML']=_0x355ace(0x219),_0x518877;}function renderMessages(){const _0x471eef=a0_0x175892;Array['from'](chatArea[_0x471eef(0x204)])['forEach'](_0x17a3cb=>{const _0x1c8183=_0x471eef;if(_0x17a3cb['id']!==_0x1c8183(0x1e8))_0x17a3cb[_0x1c8183(0x1cd)]();}),messages[_0x471eef(0x1d7)]>0x0?(emptyState[_0x471eef(0x1e5)][_0x471eef(0x1c0)]=_0x471eef(0x1a8),messages[_0x471eef(0x1bf)]((_0x35dfcf,_0x5da4cd)=>chatArea['appendChild'](createMessageElement(_0x35dfcf,_0x5da4cd)))):emptyState[_0x471eef(0x1e5)][_0x471eef(0x1c0)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x471eef(0x1be)]);}function autoResizeTextarea(){const _0x1c4e6b=a0_0x175892;messageInput[_0x1c4e6b(0x1e5)][_0x1c4e6b(0x1cf)]=_0x1c4e6b(0x215),messageInput[_0x1c4e6b(0x1e5)][_0x1c4e6b(0x1cf)]=Math[_0x1c4e6b(0x21b)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x2ef5c2=a0_0x175892,_0x2c9c6b=messageInput[_0x2ef5c2(0x1ed)][_0x2ef5c2(0x1f1)]();sendBtn[_0x2ef5c2(0x1b1)]=!_0x2c9c6b||isTyping;}async function sendMessage(){const _0x20279f=a0_0x175892,_0x13fe2d=messageInput[_0x20279f(0x1ed)][_0x20279f(0x1f1)]();if(!_0x13fe2d||isTyping)return;if(tg?.[_0x20279f(0x1aa)])tg[_0x20279f(0x1aa)][_0x20279f(0x1ff)]('light');messages[_0x20279f(0x20f)]({'role':'user','content':_0x13fe2d,'timestamp':Date[_0x20279f(0x1ab)]()}),localStorage[_0x20279f(0x1f2)](_0x20279f(0x1ba),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x20279f(0x20c)]=chatArea[_0x20279f(0x1be)];const _0x421cf5=await callBackend('send_message',{'message':_0x13fe2d});isTyping=![];const _0x1cae6a=document['getElementById'](_0x20279f(0x1d9));if(_0x1cae6a)_0x1cae6a[_0x20279f(0x1cd)]();let _0x1ceb8d=_0x20279f(0x1f5);if(_0x421cf5['success']){_0x1ceb8d=_0x421cf5['text']||_0x20279f(0x1e9);if(tg?.[_0x20279f(0x1aa)])tg[_0x20279f(0x1aa)]['notificationOccurred'](_0x20279f(0x1c6));}else{_0x1ceb8d=_0x421cf5[_0x20279f(0x1c9)]||_0x20279f(0x1ae);if(tg?.[_0x20279f(0x1aa)])tg[_0x20279f(0x1aa)]['notificationOccurred'](_0x20279f(0x1c9));}messages['push']({'role':'ai','content':_0x1ceb8d,'timestamp':Date[_0x20279f(0x1ab)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x20279f(0x1f4)](messages)),renderMessages();}function a0_0x15ff(){const _0x5e499e=['offClick','TG\x20setup\x20error:','isVersionAtLeast','show','innerHeight','light','scrollTop','messageInput','message\x20','push','modalTitle','username','focus','floor','delete-btn','auto','getMinutes','2225871ZfZurW','touchstart','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','timestamp','min','addEventListener','innerHTML','user','message\x20ai','.message.show-delete','confirmModal','chatArea','debug_uid','appendChild','none','show-delete','HapticFeedback','now','input','clearBtn','Ошибка\x20сервера','WebApp','keydown','disabled','classList','BackButton','constructor','72268LbrqPe','text/plain','7GkDMJd','Действие\x20необратимо.','resize','ai_chat_messages','inputArea','getElementById','random','scrollHeight','forEach','display','expand','preventDefault','3965658lCzXIw','modalText','function','success','6.1','onEvent','error','search','getItem','Удалить?','remove','removeItem','height','signal','warn','onClick','clear_history','stopPropagation','className','1865595sBKLVm','length','offsetHeight','typingIndicator','paddingBottom','apply','padStart','onclick','initData','1859733XXMGWw','40heZRAU','Telegram','parse','initDataUnsafe','toString','style','<br>','add','emptyState','Пустой\x20ответ','(((.+)+)+)+$','role','shiftKey','value','div','./router.html','Начнется\x20новый\x20диалог.','trim','setItem','298974DAcQCi','stringify','Ошибка\x20сети','293896QEUSUp','modalCancel','json','createElement','sendBtn','splice','abort','disableVerticalSwipes','touchend','impactOccurred','.container','viewportHeight','textContent','target','children','POST'];a0_0x15ff=function(){return _0x5e499e;};return a0_0x15ff();}function confirmDelete(_0x32af6a){const _0x4e8be8=a0_0x175892;if(mTitle)mTitle[_0x4e8be8(0x202)]=_0x4e8be8(0x1cc);if(mText)mText['textContent']=_0x4e8be8(0x1b8);modalCallback=()=>{const _0x25d579=_0x4e8be8;messages[_0x25d579(0x1fb)](_0x32af6a,0x1),localStorage['setItem'](_0x25d579(0x1ba),JSON[_0x25d579(0x1f4)](messages)),renderMessages();},modal[_0x4e8be8(0x1b2)]['add'](_0x4e8be8(0x209));}if(clearBtn)clearBtn['onclick']=()=>{const _0x558b78=a0_0x175892;if(!messages[_0x558b78(0x1d7)])return;if(mTitle)mTitle[_0x558b78(0x202)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x558b78(0x1f0);modalCallback=async()=>{const _0x4a8a00=_0x558b78;messages=[],localStorage[_0x4a8a00(0x1ce)](_0x4a8a00(0x1ba)),renderMessages(),callBackend(_0x4a8a00(0x1d3),{});},modal[_0x558b78(0x1b2)][_0x558b78(0x1e7)](_0x558b78(0x209));};document[a0_0x175892(0x1bc)](a0_0x175892(0x1f7))[a0_0x175892(0x1dd)]=()=>modal[a0_0x175892(0x1b2)][a0_0x175892(0x1cd)](a0_0x175892(0x209)),document[a0_0x175892(0x1bc)]('modalConfirm')[a0_0x175892(0x1dd)]=()=>{const _0x4f12ef=a0_0x175892;if(modalCallback)modalCallback();modal[_0x4f12ef(0x1b2)][_0x4f12ef(0x1cd)]('show');},messageInput[a0_0x175892(0x21c)](a0_0x175892(0x1ac),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x175892(0x21c)](a0_0x175892(0x1b0),_0x8051b9=>{const _0x2eff72=a0_0x175892;_0x8051b9['key']==='Enter'&&!_0x8051b9[_0x2eff72(0x1ec)]&&(_0x8051b9[_0x2eff72(0x1c2)](),sendMessage());}),sendBtn[a0_0x175892(0x1dd)]=sendMessage,document[a0_0x175892(0x21c)]('click',_0x270733=>{const _0x6814e3=a0_0x175892;document['querySelectorAll'](_0x6814e3(0x220))[_0x6814e3(0x1bf)](_0x28bda7=>{const _0x4de5fa=_0x6814e3;if(!_0x28bda7['contains'](_0x270733[_0x4de5fa(0x203)]))_0x28bda7[_0x4de5fa(0x1b2)][_0x4de5fa(0x1cd)](_0x4de5fa(0x1a9));});});const saved=localStorage[a0_0x175892(0x1cb)](a0_0x175892(0x1ba));if(saved)try{messages=JSON[a0_0x175892(0x1e2)](saved),renderMessages();}catch(a0_0x2f1b41){}updateSendButton();