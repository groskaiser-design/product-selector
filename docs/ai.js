const a0_0x470431=a0_0x5cd3;(function(_0x50cba,_0x13f028){const _0x208c7=a0_0x5cd3,_0x41d3d1=_0x50cba();while(!![]){try{const _0x53dca7=-parseInt(_0x208c7(0x1a7))/0x1+-parseInt(_0x208c7(0x143))/0x2*(parseInt(_0x208c7(0x179))/0x3)+-parseInt(_0x208c7(0x170))/0x4+-parseInt(_0x208c7(0x154))/0x5*(-parseInt(_0x208c7(0x147))/0x6)+-parseInt(_0x208c7(0x15f))/0x7*(-parseInt(_0x208c7(0x1a0))/0x8)+-parseInt(_0x208c7(0x198))/0x9+parseInt(_0x208c7(0x19c))/0xa;if(_0x53dca7===_0x13f028)break;else _0x41d3d1['push'](_0x41d3d1['shift']());}catch(_0x2677e3){_0x41d3d1['push'](_0x41d3d1['shift']());}}}(a0_0x4184,0x87a8d));const tg=window['Telegram']?.['WebApp'],HOME_URL=a0_0x470431(0x185);function setupTelegramBackButton(){const _0x4b79bb=a0_0x470431;if(!tg)return;try{tg[_0x4b79bb(0x132)](),tg[_0x4b79bb(0x18d)](),tg[_0x4b79bb(0x166)]?.('#050505');if(tg['isVersionAtLeast']?.(_0x4b79bb(0x14a)))tg[_0x4b79bb(0x14c)]?.();const _0x1f49e0=tg['BackButton'];if(_0x1f49e0){_0x1f49e0[_0x4b79bb(0x17e)]();if(typeof _0x1f49e0[_0x4b79bb(0x160)]===_0x4b79bb(0x157))try{_0x1f49e0[_0x4b79bb(0x160)]();}catch(_0x4517a9){}_0x1f49e0[_0x4b79bb(0x183)](()=>{const _0x2b6b2a=_0x4b79bb;if(tg['HapticFeedback'])tg['HapticFeedback']['impactOccurred'](_0x2b6b2a(0x167));location[_0x2b6b2a(0x1a4)]=HOME_URL;});}}catch(_0xf3b3d3){console[_0x4b79bb(0x16b)](_0x4b79bb(0x133),_0xf3b3d3);}}(function initStableLayout(){const _0x22ed9f=a0_0x470431,_0x5ce653=(function(){let _0x305ef9=!![];return function(_0x4c52d8,_0x37d100){const _0x586111=_0x305ef9?function(){const _0x40276c=a0_0x5cd3;if(_0x37d100){const _0x40c079=_0x37d100[_0x40276c(0x159)](_0x4c52d8,arguments);return _0x37d100=null,_0x40c079;}}:function(){};return _0x305ef9=![],_0x586111;};}()),_0x1bdc0f=document[_0x22ed9f(0x13f)]('.container'),_0x279c48=document['getElementById'](_0x22ed9f(0x18b)),_0x3c0c67=document[_0x22ed9f(0x18e)]('chatArea'),_0x39af9a=document['getElementById'](_0x22ed9f(0x135));function _0x3b19fb(){const _0x507bd3=_0x22ed9f,_0x155869=_0x5ce653(this,function(){const _0x4d80ab=a0_0x5cd3;return _0x155869['toString']()[_0x4d80ab(0x14b)](_0x4d80ab(0x188))[_0x4d80ab(0x18f)]()[_0x4d80ab(0x16e)](_0x155869)['search']('(((.+)+)+)+$');});_0x155869();if(!_0x1bdc0f)return;const _0x1c7286=tg&&tg['viewportHeight']?tg[_0x507bd3(0x191)]:window[_0x507bd3(0x1ac)];_0x1bdc0f[_0x507bd3(0x161)]['height']=_0x1c7286+'px';if(_0x279c48){const _0x4c1c06=_0x279c48[_0x507bd3(0x187)];_0x3c0c67['style'][_0x507bd3(0x1ad)]=_0x4c1c06+0x28+'px';}}tg?tg[_0x22ed9f(0x196)](_0x22ed9f(0x1a3),({isStateStable:_0x14a42d})=>{_0x3b19fb();if(_0x14a42d)requestAnimationFrame(()=>{_0x3c0c67['scrollTop']=_0x3c0c67['scrollHeight'];});}):window[_0x22ed9f(0x13b)]('resize',_0x3b19fb),_0x3b19fb(),_0x39af9a&&(_0x39af9a[_0x22ed9f(0x13b)]('input',()=>{requestAnimationFrame(_0x3b19fb);}),_0x39af9a['addEventListener'](_0x22ed9f(0x17a),()=>{setTimeout(()=>{const _0x22e1f6=a0_0x5cd3;_0x3c0c67[_0x22e1f6(0x1aa)]=_0x3c0c67[_0x22e1f6(0x148)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x470431(0x18e)](a0_0x470431(0x19a)),emptyState=document[a0_0x470431(0x18e)](a0_0x470431(0x158)),messageInput=document['getElementById'](a0_0x470431(0x135)),sendBtn=document[a0_0x470431(0x18e)](a0_0x470431(0x189)),clearBtn=document[a0_0x470431(0x18e)](a0_0x470431(0x16d)),modal=document['getElementById']('confirmModal'),mTitle=document[a0_0x470431(0x18e)](a0_0x470431(0x13e)),mText=document[a0_0x470431(0x18e)](a0_0x470431(0x15e));let modalCallback=null;function a0_0x5cd3(_0x430e3e,_0x344a2e){_0x430e3e=_0x430e3e-0x12e;const _0x2d3020=a0_0x4184();let _0x41f8fe=_0x2d3020[_0x430e3e];return _0x41f8fe;}async function callBackend(_0x3be5dc,_0x36b011){const _0x4c867c=a0_0x470431,_0x4aaeb8=tg?.['initDataUnsafe']?.[_0x4c867c(0x165)]||{},_0x29816c=_0x4aaeb8['id']||localStorage[_0x4c867c(0x1a8)](_0x4c867c(0x199))||'d-'+Math['floor'](Math[_0x4c867c(0x182)]()*0x3b9aca00);if(!_0x4aaeb8['id'])localStorage[_0x4c867c(0x149)]('debug_uid',_0x29816c);const _0x22e530={'action':_0x3be5dc,'user_id':_0x29816c,'user_data':{'first_name':_0x4aaeb8[_0x4c867c(0x1a2)],'username':_0x4aaeb8[_0x4c867c(0x172)]},'init_data':tg?.['initData']||'',..._0x36b011},_0x2ae324=new AbortController(),_0x5de092=setTimeout(()=>_0x2ae324['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3bed78=await fetch(BACKEND_URL,{'method':_0x4c867c(0x138),'headers':{'Content-Type':_0x4c867c(0x13d)},'body':JSON[_0x4c867c(0x175)](_0x22e530),'signal':_0x2ae324[_0x4c867c(0x1ae)]});return clearTimeout(_0x5de092),await _0x3bed78[_0x4c867c(0x139)]();}catch(_0x413384){return{'success':![],'error':String(_0x413384)};}}function formatTime(_0x4a69e9){const _0x47cd64=a0_0x470431,_0xf4ff0e=new Date(_0x4a69e9);return String(_0xf4ff0e[_0x47cd64(0x163)]())[_0x47cd64(0x18a)](0x2,'0')+':'+String(_0xf4ff0e['getMinutes']())[_0x47cd64(0x18a)](0x2,'0');}function createMessageElement(_0x4aacb3,_0x170746){const _0x55c902=a0_0x470431,_0x243d83=document[_0x55c902(0x142)]('div');_0x243d83[_0x55c902(0x192)]='message\x20'+_0x4aacb3[_0x55c902(0x134)];const _0x47e8bf=document[_0x55c902(0x142)]('div');_0x47e8bf[_0x55c902(0x192)]='message-bubble',_0x47e8bf[_0x55c902(0x190)]=_0x4aacb3[_0x55c902(0x140)][_0x55c902(0x13c)](/\n/g,_0x55c902(0x195));const _0x22a05b=document[_0x55c902(0x142)](_0x55c902(0x176));_0x22a05b[_0x55c902(0x192)]=_0x55c902(0x15c),_0x22a05b[_0x55c902(0x190)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x22a05b['onclick']=_0x2fc7d2=>{const _0x310997=_0x55c902;_0x2fc7d2[_0x310997(0x181)](),confirmDelete(_0x170746);};let _0x4acfcb;_0x47e8bf['addEventListener'](_0x55c902(0x155),()=>_0x4acfcb=setTimeout(()=>{const _0x37f7e3=_0x55c902;_0x243d83['classList'][_0x37f7e3(0x1a5)](_0x37f7e3(0x19d));if(tg?.[_0x37f7e3(0x162)])tg[_0x37f7e3(0x162)][_0x37f7e3(0x136)](_0x37f7e3(0x14f));},0x1f4)),_0x47e8bf[_0x55c902(0x13b)](_0x55c902(0x153),()=>clearTimeout(_0x4acfcb));const _0x40124c=document[_0x55c902(0x142)](_0x55c902(0x176));return _0x40124c[_0x55c902(0x192)]='message-time',_0x40124c[_0x55c902(0x15b)]=formatTime(_0x4aacb3['timestamp']),_0x243d83[_0x55c902(0x177)](_0x22a05b),_0x243d83[_0x55c902(0x177)](_0x47e8bf),_0x243d83[_0x55c902(0x177)](_0x40124c),_0x243d83;}function createTypingIndicator(){const _0x38b1f3=a0_0x470431,_0x4ea7a8=document[_0x38b1f3(0x142)]('div');return _0x4ea7a8['className']=_0x38b1f3(0x146),_0x4ea7a8['id']=_0x38b1f3(0x1a9),_0x4ea7a8[_0x38b1f3(0x190)]=_0x38b1f3(0x164),_0x4ea7a8;}function renderMessages(){const _0x661653=a0_0x470431;Array[_0x661653(0x16f)](chatArea['children'])[_0x661653(0x150)](_0x435131=>{const _0x47c43a=_0x661653;if(_0x435131['id']!==_0x47c43a(0x158))_0x435131[_0x47c43a(0x12f)]();}),messages[_0x661653(0x16c)]>0x0?(emptyState[_0x661653(0x161)][_0x661653(0x169)]=_0x661653(0x15d),messages[_0x661653(0x150)]((_0x332ccd,_0x213472)=>chatArea[_0x661653(0x177)](createMessageElement(_0x332ccd,_0x213472)))):emptyState['style'][_0x661653(0x169)]=_0x661653(0x151),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x661653(0x148)]);}function autoResizeTextarea(){const _0x572da7=a0_0x470431;messageInput[_0x572da7(0x161)]['height']=_0x572da7(0x145),messageInput[_0x572da7(0x161)][_0x572da7(0x17f)]=Math[_0x572da7(0x184)](messageInput[_0x572da7(0x148)],0x78)+'px';}function updateSendButton(){const _0x13cbab=a0_0x470431,_0x474074=messageInput[_0x13cbab(0x17d)][_0x13cbab(0x12e)]();sendBtn['disabled']=!_0x474074||isTyping;}async function sendMessage(){const _0x353119=a0_0x470431,_0x4b561c=messageInput[_0x353119(0x17d)][_0x353119(0x12e)]();if(!_0x4b561c||isTyping)return;if(tg?.[_0x353119(0x162)])tg[_0x353119(0x162)]['impactOccurred'](_0x353119(0x167));messages[_0x353119(0x17c)]({'role':_0x353119(0x165),'content':_0x4b561c,'timestamp':Date[_0x353119(0x1ab)]()}),localStorage[_0x353119(0x149)](_0x353119(0x1a6),JSON[_0x353119(0x175)](messages)),renderMessages(),messageInput[_0x353119(0x17d)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x353119(0x177)](createTypingIndicator()),chatArea[_0x353119(0x1aa)]=chatArea[_0x353119(0x148)];const _0x39c827=await callBackend(_0x353119(0x171),{'message':_0x4b561c});isTyping=![];const _0x11c98d=document['getElementById']('typingIndicator');if(_0x11c98d)_0x11c98d[_0x353119(0x12f)]();let _0x51bba2=_0x353119(0x144);if(_0x39c827[_0x353119(0x13a)]){_0x51bba2=_0x39c827[_0x353119(0x186)]||_0x353119(0x178);if(tg?.['HapticFeedback'])tg[_0x353119(0x162)][_0x353119(0x14e)](_0x353119(0x13a));}else{_0x51bba2=_0x39c827['error']||_0x353119(0x197);if(tg?.[_0x353119(0x162)])tg['HapticFeedback'][_0x353119(0x14e)](_0x353119(0x17b));}messages[_0x353119(0x17c)]({'role':'ai','content':_0x51bba2,'timestamp':Date[_0x353119(0x1ab)]()}),localStorage[_0x353119(0x149)](_0x353119(0x1a6),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x5b8d4f){const _0x4fa83e=a0_0x470431;if(mTitle)mTitle[_0x4fa83e(0x15b)]=_0x4fa83e(0x16a);if(mText)mText['textContent']=_0x4fa83e(0x141);modalCallback=()=>{const _0x4b7912=_0x4fa83e;messages[_0x4b7912(0x173)](_0x5b8d4f,0x1),localStorage[_0x4b7912(0x149)]('ai_chat_messages',JSON[_0x4b7912(0x175)](messages)),renderMessages();},modal[_0x4fa83e(0x168)][_0x4fa83e(0x1a5)](_0x4fa83e(0x17e));}if(clearBtn)clearBtn['onclick']=()=>{const _0x2a290a=a0_0x470431;if(!messages[_0x2a290a(0x16c)])return;if(mTitle)mTitle[_0x2a290a(0x15b)]=_0x2a290a(0x194);if(mText)mText[_0x2a290a(0x15b)]=_0x2a290a(0x180);modalCallback=async()=>{const _0x572189=_0x2a290a;messages=[],localStorage[_0x572189(0x19b)](_0x572189(0x1a6)),renderMessages(),callBackend(_0x572189(0x174),{});},modal[_0x2a290a(0x168)]['add'](_0x2a290a(0x17e));};document[a0_0x470431(0x18e)]('modalCancel')[a0_0x470431(0x1a1)]=()=>modal[a0_0x470431(0x168)][a0_0x470431(0x12f)]('show'),document['getElementById'](a0_0x470431(0x19f))[a0_0x470431(0x1a1)]=()=>{const _0x46a01f=a0_0x470431;if(modalCallback)modalCallback();modal[_0x46a01f(0x168)][_0x46a01f(0x12f)](_0x46a01f(0x17e));},messageInput[a0_0x470431(0x13b)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x470431(0x137),_0x46c73f=>{const _0x32cac9=a0_0x470431;_0x46c73f[_0x32cac9(0x18c)]===_0x32cac9(0x131)&&!_0x46c73f[_0x32cac9(0x156)]&&(_0x46c73f[_0x32cac9(0x193)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x470431(0x13b)](a0_0x470431(0x19e),_0x478b73=>{const _0x11053b=a0_0x470431;document[_0x11053b(0x130)](_0x11053b(0x15a))[_0x11053b(0x150)](_0x29eedf=>{const _0x4ced11=_0x11053b;if(!_0x29eedf['contains'](_0x478b73[_0x4ced11(0x14d)]))_0x29eedf[_0x4ced11(0x168)][_0x4ced11(0x12f)](_0x4ced11(0x19d));});});function a0_0x4184(){const _0x1b748b=['value','show','height','Начнется\x20новый\x20диалог.','stopPropagation','random','onClick','min','./router.html','text','offsetHeight','(((.+)+)+)+$','sendBtn','padStart','inputArea','key','expand','getElementById','toString','innerHTML','viewportHeight','className','preventDefault','Очистить\x20историю?','<br>','onEvent','Ошибка\x20сервера','2886651NAqBXp','debug_uid','chatArea','removeItem','10489050ayPJWH','show-delete','click','modalConfirm','88pFPfXo','onclick','first_name','viewportChanged','href','add','ai_chat_messages','652939fWXRBz','getItem','typingIndicator','scrollTop','now','innerHeight','paddingBottom','signal','trim','remove','querySelectorAll','Enter','ready','TG\x20setup\x20error:','role','messageInput','impactOccurred','keydown','POST','json','success','addEventListener','replace','text/plain','modalTitle','querySelector','content','Действие\x20необратимо.','createElement','60682uvwWMr','Ошибка\x20сети','auto','message\x20ai','6598068obCRID','scrollHeight','setItem','6.1','search','disableVerticalSwipes','target','notificationOccurred','medium','forEach','flex','parse','touchend','5AfAjEs','touchstart','shiftKey','function','emptyState','apply','.message.show-delete','textContent','delete-btn','none','modalText','158998UqIseM','offClick','style','HapticFeedback','getHours','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','user','setHeaderColor','light','classList','display','Удалить?','warn','length','clearBtn','constructor','from','199564vGeQNW','send_message','username','splice','clear_history','stringify','div','appendChild','Пустой\x20ответ','81jBCiTU','focus','error','push'];a0_0x4184=function(){return _0x1b748b;};return a0_0x4184();}const saved=localStorage[a0_0x470431(0x1a8)](a0_0x470431(0x1a6));if(saved)try{messages=JSON[a0_0x470431(0x152)](saved),renderMessages();}catch(a0_0x5dee18){}updateSendButton();