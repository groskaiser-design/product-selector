const a0_0x59edeb=a0_0x261a;(function(_0x5c1b3a,_0x41c902){const _0x3c7e5f=a0_0x261a,_0xa84617=_0x5c1b3a();while(!![]){try{const _0x38e980=-parseInt(_0x3c7e5f(0xf5))/0x1*(parseInt(_0x3c7e5f(0x140))/0x2)+-parseInt(_0x3c7e5f(0xf8))/0x3*(-parseInt(_0x3c7e5f(0xf7))/0x4)+-parseInt(_0x3c7e5f(0xfc))/0x5+parseInt(_0x3c7e5f(0xfa))/0x6+parseInt(_0x3c7e5f(0xd4))/0x7+parseInt(_0x3c7e5f(0x10f))/0x8+-parseInt(_0x3c7e5f(0xff))/0x9;if(_0x38e980===_0x41c902)break;else _0xa84617['push'](_0xa84617['shift']());}catch(_0x5be27e){_0xa84617['push'](_0xa84617['shift']());}}}(a0_0xaeb6,0x2baec));const tg=window[a0_0x59edeb(0x126)]?.['WebApp'],HOME_URL=a0_0x59edeb(0x110);function setupTelegramBackButton(){const _0x28cdb9=a0_0x59edeb,_0x22c210=(function(){let _0x2619cf=!![];return function(_0x40b538,_0x8dcb23){const _0x31d4f9=_0x2619cf?function(){const _0x437ede=a0_0x261a;if(_0x8dcb23){const _0x542890=_0x8dcb23[_0x437ede(0x143)](_0x40b538,arguments);return _0x8dcb23=null,_0x542890;}}:function(){};return _0x2619cf=![],_0x31d4f9;};}()),_0x51d1f9=_0x22c210(this,function(){const _0x5524b7=a0_0x261a;return _0x51d1f9[_0x5524b7(0x131)]()[_0x5524b7(0xe9)]('(((.+)+)+)+$')[_0x5524b7(0x131)]()[_0x5524b7(0x10c)](_0x51d1f9)[_0x5524b7(0xe9)](_0x5524b7(0xe5));});_0x51d1f9();if(!tg)return;try{tg[_0x28cdb9(0x12d)](),tg[_0x28cdb9(0xf9)](),tg[_0x28cdb9(0x103)]?.(_0x28cdb9(0x133));if(tg[_0x28cdb9(0x121)]?.(_0x28cdb9(0xfe)))tg[_0x28cdb9(0xe1)]?.();const _0x1bb178=tg[_0x28cdb9(0xd1)];if(_0x1bb178){_0x1bb178[_0x28cdb9(0x136)]();if(typeof _0x1bb178[_0x28cdb9(0xdd)]===_0x28cdb9(0x132))try{_0x1bb178[_0x28cdb9(0xdd)]();}catch(_0x5b4a35){}_0x1bb178[_0x28cdb9(0x13f)](()=>{const _0x4c6327=_0x28cdb9;if(tg[_0x4c6327(0x120)])tg['HapticFeedback']['impactOccurred'](_0x4c6327(0x104));location['href']=HOME_URL;});}}catch(_0x29f776){console[_0x28cdb9(0xe0)](_0x28cdb9(0x102),_0x29f776);}}(function initStableLayout(){const _0x5bb384=a0_0x59edeb,_0x42238=document[_0x5bb384(0x115)](_0x5bb384(0x105)),_0x31692a=document['getElementById'](_0x5bb384(0x130)),_0x4d2d22=document['getElementById']('chatArea'),_0x5c63fd=document[_0x5bb384(0x123)](_0x5bb384(0xe8));function _0x381f62(){const _0x3564be=_0x5bb384;if(!_0x42238)return;const _0x3be88f=tg&&tg[_0x3564be(0x13e)]?tg[_0x3564be(0x13e)]:window['innerHeight'];_0x42238[_0x3564be(0x11b)][_0x3564be(0xf2)]=_0x3be88f+'px';if(_0x31692a){const _0x43e587=_0x31692a[_0x3564be(0xf1)];_0x4d2d22[_0x3564be(0x11b)][_0x3564be(0x13b)]=_0x43e587+0x28+'px';}}tg?tg['onEvent'](_0x5bb384(0xfd),({isStateStable:_0x19ff93})=>{_0x381f62();if(_0x19ff93)requestAnimationFrame(()=>{const _0x5a46b0=a0_0x261a;_0x4d2d22['scrollTop']=_0x4d2d22[_0x5a46b0(0xea)];});}):window[_0x5bb384(0x141)](_0x5bb384(0x11d),_0x381f62),_0x381f62(),_0x5c63fd&&(_0x5c63fd['addEventListener']('input',()=>{requestAnimationFrame(_0x381f62);}),_0x5c63fd[_0x5bb384(0x141)](_0x5bb384(0x101),()=>{setTimeout(()=>{const _0xdd6861=a0_0x261a;_0x4d2d22[_0xdd6861(0x11a)]=_0x4d2d22[_0xdd6861(0xea)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x59edeb(0x142),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x59edeb(0x123)]('chatArea'),emptyState=document['getElementById'](a0_0x59edeb(0x109)),messageInput=document['getElementById'](a0_0x59edeb(0xe8)),sendBtn=document['getElementById'](a0_0x59edeb(0xf3)),clearBtn=document[a0_0x59edeb(0x123)]('clearBtn'),modal=document[a0_0x59edeb(0x123)](a0_0x59edeb(0x145)),mTitle=document[a0_0x59edeb(0x123)](a0_0x59edeb(0x10a)),mText=document['getElementById'](a0_0x59edeb(0x12b));let modalCallback=null;async function callBackend(_0xc1b52c,_0x130377){const _0x185b01=a0_0x59edeb,_0xa367e7=tg?.[_0x185b01(0xd3)]?.[_0x185b01(0x139)]||{},_0x4364d3=_0xa367e7['id']||localStorage['getItem']('debug_uid')||'d-'+Math[_0x185b01(0x11c)](Math[_0x185b01(0x134)]()*0x3b9aca00);if(!_0xa367e7['id'])localStorage[_0x185b01(0xf6)]('debug_uid',_0x4364d3);const _0x5c5ba4={'action':_0xc1b52c,'user_id':_0x4364d3,'user_data':{'first_name':_0xa367e7[_0x185b01(0xef)],'username':_0xa367e7[_0x185b01(0x116)]},'init_data':tg?.[_0x185b01(0x100)]||'',..._0x130377},_0x5bd5b0=new AbortController(),_0x288d3e=setTimeout(()=>_0x5bd5b0['abort'](),REQUEST_TIMEOUT_MS);try{const _0x4a1ca1=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x185b01(0xcd)},'body':JSON[_0x185b01(0x137)](_0x5c5ba4),'signal':_0x5bd5b0[_0x185b01(0xe7)]});return clearTimeout(_0x288d3e),await _0x4a1ca1[_0x185b01(0x129)]();}catch(_0x4adc36){return{'success':![],'error':String(_0x4adc36)};}}function formatTime(_0x475929){const _0x1e19bc=a0_0x59edeb,_0x39fcb9=new Date(_0x475929);return String(_0x39fcb9[_0x1e19bc(0x148)]())[_0x1e19bc(0x10d)](0x2,'0')+':'+String(_0x39fcb9['getMinutes']())[_0x1e19bc(0x10d)](0x2,'0');}function createMessageElement(_0x2876a0,_0x37de2e){const _0x1633f8=a0_0x59edeb,_0x126506=document[_0x1633f8(0xe4)](_0x1633f8(0x128));_0x126506['className']='message\x20'+_0x2876a0[_0x1633f8(0xdb)];const _0x470c64=document['createElement'](_0x1633f8(0x128));_0x470c64['className']='message-bubble',_0x470c64[_0x1633f8(0xd7)]=_0x2876a0[_0x1633f8(0xec)][_0x1633f8(0x111)](/\n/g,_0x1633f8(0x11f));const _0x5e0650=document['createElement'](_0x1633f8(0x128));_0x5e0650['className']=_0x1633f8(0xdc),_0x5e0650[_0x1633f8(0xd7)]=_0x1633f8(0x127),_0x5e0650[_0x1633f8(0xce)]=_0xe2774d=>{const _0x8d9315=_0x1633f8;_0xe2774d[_0x8d9315(0xd8)](),confirmDelete(_0x37de2e);};let _0x2aa914;_0x470c64[_0x1633f8(0x141)](_0x1633f8(0xd6),()=>_0x2aa914=setTimeout(()=>{const _0x274d4f=_0x1633f8;_0x126506[_0x274d4f(0x12f)]['add'](_0x274d4f(0x108));if(tg?.[_0x274d4f(0x120)])tg[_0x274d4f(0x120)]['impactOccurred'](_0x274d4f(0xf0));},0x1f4)),_0x470c64[_0x1633f8(0x141)](_0x1633f8(0xfb),()=>clearTimeout(_0x2aa914));const _0x5b2afe=document['createElement'](_0x1633f8(0x128));return _0x5b2afe[_0x1633f8(0x147)]=_0x1633f8(0xeb),_0x5b2afe['textContent']=formatTime(_0x2876a0[_0x1633f8(0xf4)]),_0x126506[_0x1633f8(0xe3)](_0x5e0650),_0x126506[_0x1633f8(0xe3)](_0x470c64),_0x126506[_0x1633f8(0xe3)](_0x5b2afe),_0x126506;}function createTypingIndicator(){const _0x256b2f=a0_0x59edeb,_0x7b4295=document[_0x256b2f(0xe4)](_0x256b2f(0x128));return _0x7b4295['className']='message\x20ai',_0x7b4295['id']=_0x256b2f(0x10b),_0x7b4295[_0x256b2f(0xd7)]=_0x256b2f(0xd2),_0x7b4295;}function renderMessages(){const _0x169b02=a0_0x59edeb;Array['from'](chatArea[_0x169b02(0x146)])[_0x169b02(0x12a)](_0x512b13=>{const _0x5537ad=_0x169b02;if(_0x512b13['id']!==_0x5537ad(0x109))_0x512b13[_0x5537ad(0xd0)]();}),messages[_0x169b02(0x125)]>0x0?(emptyState[_0x169b02(0x11b)]['display']=_0x169b02(0xcf),messages[_0x169b02(0x12a)]((_0x4b63cb,_0x9e7eaa)=>chatArea['appendChild'](createMessageElement(_0x4b63cb,_0x9e7eaa)))):emptyState[_0x169b02(0x11b)]['display']=_0x169b02(0x144),requestAnimationFrame(()=>chatArea[_0x169b02(0x11a)]=chatArea[_0x169b02(0xea)]);}function autoResizeTextarea(){const _0x5d4501=a0_0x59edeb;messageInput[_0x5d4501(0x11b)][_0x5d4501(0xf2)]=_0x5d4501(0x12c),messageInput['style'][_0x5d4501(0xf2)]=Math[_0x5d4501(0xe6)](messageInput[_0x5d4501(0xea)],0x78)+'px';}function a0_0x261a(_0x28de1d,_0x13ee0b){_0x28de1d=_0x28de1d-0xcd;const _0x4c8f5f=a0_0xaeb6();let _0x3e2361=_0x4c8f5f[_0x28de1d];return _0x3e2361;}function updateSendButton(){const _0x28b675=a0_0x59edeb,_0x404eec=messageInput[_0x28b675(0x135)]['trim']();sendBtn[_0x28b675(0x119)]=!_0x404eec||isTyping;}async function sendMessage(){const _0x292899=a0_0x59edeb,_0x3f1f7f=messageInput[_0x292899(0x135)]['trim']();if(!_0x3f1f7f||isTyping)return;if(tg?.[_0x292899(0x120)])tg[_0x292899(0x120)]['impactOccurred']('light');messages['push']({'role':'user','content':_0x3f1f7f,'timestamp':Date[_0x292899(0x13c)]()}),localStorage[_0x292899(0xf6)](_0x292899(0x122),JSON[_0x292899(0x137)](messages)),renderMessages(),messageInput[_0x292899(0x135)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x292899(0xe3)](createTypingIndicator()),chatArea[_0x292899(0x11a)]=chatArea[_0x292899(0xea)];const _0x2c6eb9=await callBackend(_0x292899(0x106),{'message':_0x3f1f7f});isTyping=![];const _0x594b99=document[_0x292899(0x123)](_0x292899(0x10b));if(_0x594b99)_0x594b99[_0x292899(0xd0)]();let _0xf7725e=_0x292899(0x12e);if(_0x2c6eb9['success']){_0xf7725e=_0x2c6eb9[_0x292899(0x124)]||_0x292899(0xd5);if(tg?.[_0x292899(0x120)])tg[_0x292899(0x120)][_0x292899(0x114)]('success');}else{_0xf7725e=_0x2c6eb9[_0x292899(0xd9)]||_0x292899(0x113);if(tg?.[_0x292899(0x120)])tg[_0x292899(0x120)][_0x292899(0x114)](_0x292899(0xd9));}messages['push']({'role':'ai','content':_0xf7725e,'timestamp':Date[_0x292899(0x13c)]()}),localStorage['setItem'](_0x292899(0x122),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x149f6d){const _0x129ba0=a0_0x59edeb;if(mTitle)mTitle[_0x129ba0(0x117)]=_0x129ba0(0xdf);if(mText)mText['textContent']=_0x129ba0(0xda);modalCallback=()=>{const _0x5e354c=_0x129ba0;messages['splice'](_0x149f6d,0x1),localStorage['setItem'](_0x5e354c(0x122),JSON[_0x5e354c(0x137)](messages)),renderMessages();},modal[_0x129ba0(0x12f)][_0x129ba0(0x112)](_0x129ba0(0x136));}function a0_0xaeb6(){const _0x2d9e29=['<br>','HapticFeedback','isVersionAtLeast','ai_chat_messages','getElementById','text','length','Telegram','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','div','json','forEach','modalText','auto','ready','Ошибка\x20сети','classList','inputArea','toString','function','#050505','random','value','show','stringify','click','user','removeItem','paddingBottom','now','keydown','viewportHeight','onClick','37938AdjJbW','addEventListener','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','apply','flex','confirmModal','children','className','getHours','text/plain','onclick','none','remove','BackButton','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','initDataUnsafe','1268589uClGYQ','Пустой\x20ответ','touchstart','innerHTML','stopPropagation','error','Действие\x20необратимо.','role','delete-btn','offClick','preventDefault','Удалить?','warn','disableVerticalSwipes','key','appendChild','createElement','(((.+)+)+)+$','min','signal','messageInput','search','scrollHeight','message-time','content','clear_history','Начнется\x20новый\x20диалог.','first_name','medium','offsetHeight','height','sendBtn','timestamp','3dyTVyP','setItem','8vkNLOj','475833nJdJXt','expand','2006424pzXlsZ','touchend','363435ElNCPW','viewportChanged','6.1','6512607DLdibi','initData','focus','TG\x20setup\x20error:','setHeaderColor','light','.container','send_message','Enter','show-delete','emptyState','modalTitle','typingIndicator','constructor','padStart','.message.show-delete','1594304RAZOzG','./router.html','replace','add','Ошибка\x20сервера','notificationOccurred','querySelector','username','textContent','target','disabled','scrollTop','style','floor','resize','Очистить\x20историю?'];a0_0xaeb6=function(){return _0x2d9e29;};return a0_0xaeb6();}if(clearBtn)clearBtn['onclick']=()=>{const _0x5e5498=a0_0x59edeb;if(!messages[_0x5e5498(0x125)])return;if(mTitle)mTitle['textContent']=_0x5e5498(0x11e);if(mText)mText[_0x5e5498(0x117)]=_0x5e5498(0xee);modalCallback=async()=>{const _0x46b9b0=_0x5e5498;messages=[],localStorage[_0x46b9b0(0x13a)](_0x46b9b0(0x122)),renderMessages(),callBackend(_0x46b9b0(0xed),{});},modal[_0x5e5498(0x12f)]['add'](_0x5e5498(0x136));};document[a0_0x59edeb(0x123)]('modalCancel')[a0_0x59edeb(0xce)]=()=>modal[a0_0x59edeb(0x12f)][a0_0x59edeb(0xd0)](a0_0x59edeb(0x136)),document[a0_0x59edeb(0x123)]('modalConfirm')['onclick']=()=>{const _0x34d6b0=a0_0x59edeb;if(modalCallback)modalCallback();modal[_0x34d6b0(0x12f)]['remove'](_0x34d6b0(0x136));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x59edeb(0x141)](a0_0x59edeb(0x13d),_0x130b27=>{const _0x200e81=a0_0x59edeb;_0x130b27[_0x200e81(0xe2)]===_0x200e81(0x107)&&!_0x130b27['shiftKey']&&(_0x130b27[_0x200e81(0xde)](),sendMessage());}),sendBtn[a0_0x59edeb(0xce)]=sendMessage,document['addEventListener'](a0_0x59edeb(0x138),_0x591cc5=>{const _0x5ee67d=a0_0x59edeb;document['querySelectorAll'](_0x5ee67d(0x10e))[_0x5ee67d(0x12a)](_0x2a1890=>{const _0x344d8b=_0x5ee67d;if(!_0x2a1890['contains'](_0x591cc5[_0x344d8b(0x118)]))_0x2a1890['classList'][_0x344d8b(0xd0)](_0x344d8b(0x108));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x1eaca1){}updateSendButton();