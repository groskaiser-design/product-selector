const a0_0x3b8c6e=a0_0x2687;(function(_0x1f062e,_0x10d7cf){const _0x1e66e6=a0_0x2687,_0x21b5a9=_0x1f062e();while(!![]){try{const _0x5b25f4=parseInt(_0x1e66e6(0x10a))/0x1+parseInt(_0x1e66e6(0xed))/0x2+-parseInt(_0x1e66e6(0xbe))/0x3+parseInt(_0x1e66e6(0x110))/0x4+parseInt(_0x1e66e6(0xd0))/0x5+parseInt(_0x1e66e6(0xfc))/0x6*(-parseInt(_0x1e66e6(0xdb))/0x7)+parseInt(_0x1e66e6(0xca))/0x8*(-parseInt(_0x1e66e6(0xcd))/0x9);if(_0x5b25f4===_0x10d7cf)break;else _0x21b5a9['push'](_0x21b5a9['shift']());}catch(_0x373e4d){_0x21b5a9['push'](_0x21b5a9['shift']());}}}(a0_0x243f,0xb6ca3));const tg=window[a0_0x3b8c6e(0xd1)]?.[a0_0x3b8c6e(0x119)],HOME_URL=a0_0x3b8c6e(0xb2);function setupTelegramBackButton(){const _0x2a0079=a0_0x3b8c6e,_0x4baddf=(function(){let _0x137c06=!![];return function(_0x15c85f,_0x19e031){const _0x32df8b=_0x137c06?function(){const _0x3cfc65=a0_0x2687;if(_0x19e031){const _0x59f79f=_0x19e031[_0x3cfc65(0x118)](_0x15c85f,arguments);return _0x19e031=null,_0x59f79f;}}:function(){};return _0x137c06=![],_0x32df8b;};}()),_0x58bf8f=_0x4baddf(this,function(){const _0x2359b1=a0_0x2687;return _0x58bf8f[_0x2359b1(0x102)]()[_0x2359b1(0xb3)](_0x2359b1(0xe3))[_0x2359b1(0x102)]()[_0x2359b1(0xe8)](_0x58bf8f)[_0x2359b1(0xb3)]('(((.+)+)+)+$');});_0x58bf8f();if(!tg)return;try{tg[_0x2a0079(0xbd)](),tg[_0x2a0079(0xf0)](),tg[_0x2a0079(0xcc)]?.(_0x2a0079(0xf9));if(tg['isVersionAtLeast']?.(_0x2a0079(0x107)))tg['disableVerticalSwipes']?.();const _0x1c7824=tg[_0x2a0079(0xa6)];if(_0x1c7824){_0x1c7824[_0x2a0079(0xb6)]();if(typeof _0x1c7824['offClick']===_0x2a0079(0x101))try{_0x1c7824[_0x2a0079(0xdc)]();}catch(_0x2b5ec2){}_0x1c7824[_0x2a0079(0xf4)](()=>{const _0x32b89e=_0x2a0079;if(tg[_0x32b89e(0xc8)])tg['HapticFeedback']['impactOccurred']('light');location[_0x32b89e(0xa5)]=HOME_URL;});}}catch(_0x420757){console[_0x2a0079(0xad)]('TG\x20setup\x20error:',_0x420757);}}(function initStableLayout(){const _0x4b18ab=a0_0x3b8c6e,_0xab8aed=document['querySelector']('.container'),_0x4fd9c1=document['getElementById'](_0x4b18ab(0xe4)),_0x3b9384=document['getElementById'](_0x4b18ab(0xe0)),_0x3b18e5=document['getElementById']('messageInput');function _0x412976(){const _0x2f1008=_0x4b18ab;if(!_0xab8aed)return;const _0x4db2eb=tg&&tg[_0x2f1008(0xce)]?tg[_0x2f1008(0xce)]:window[_0x2f1008(0xeb)];_0xab8aed[_0x2f1008(0xc9)]['height']=_0x4db2eb+'px';if(_0x4fd9c1){const _0x3fa342=_0x4fd9c1[_0x2f1008(0x10b)];_0x3b9384[_0x2f1008(0xc9)][_0x2f1008(0xf8)]=_0x3fa342+0x28+'px';}}tg?tg[_0x4b18ab(0xe2)](_0x4b18ab(0x105),({isStateStable:_0x453c48})=>{_0x412976();if(_0x453c48)requestAnimationFrame(()=>{const _0x84dda6=a0_0x2687;_0x3b9384[_0x84dda6(0xda)]=_0x3b9384[_0x84dda6(0x113)];});}):window[_0x4b18ab(0xfd)]('resize',_0x412976),_0x412976(),_0x3b18e5&&(_0x3b18e5[_0x4b18ab(0xfd)](_0x4b18ab(0xb0),()=>{requestAnimationFrame(_0x412976);}),_0x3b18e5[_0x4b18ab(0xfd)](_0x4b18ab(0x109),()=>{setTimeout(()=>{const _0x43b775=a0_0x2687;_0x3b9384[_0x43b775(0xda)]=_0x3b9384[_0x43b775(0x113)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x3b8c6e(0xa7),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x3b8c6e(0xe0)),emptyState=document[a0_0x3b8c6e(0xc6)]('emptyState'),messageInput=document[a0_0x3b8c6e(0xc6)](a0_0x3b8c6e(0xa3)),sendBtn=document[a0_0x3b8c6e(0xc6)](a0_0x3b8c6e(0xa9)),clearBtn=document[a0_0x3b8c6e(0xc6)]('clearBtn'),modal=document[a0_0x3b8c6e(0xc6)]('confirmModal'),mTitle=document[a0_0x3b8c6e(0xc6)](a0_0x3b8c6e(0xde)),mText=document[a0_0x3b8c6e(0xc6)](a0_0x3b8c6e(0xa8));let modalCallback=null;async function callBackend(_0x437173,_0xa1404e){const _0x58aa59=a0_0x3b8c6e,_0x41c884=tg?.[_0x58aa59(0xfb)]?.[_0x58aa59(0x10e)]||{},_0x20efe5=_0x41c884['id']||localStorage[_0x58aa59(0xbf)](_0x58aa59(0xf2))||'d-'+Math[_0x58aa59(0xa1)](Math['random']()*0x3b9aca00);if(!_0x41c884['id'])localStorage[_0x58aa59(0xf3)]('debug_uid',_0x20efe5);const _0x40510d={'action':_0x437173,'user_id':_0x20efe5,'user_data':{'first_name':_0x41c884['first_name'],'username':_0x41c884[_0x58aa59(0xae)]},'init_data':tg?.[_0x58aa59(0x116)]||'',..._0xa1404e},_0x29b24f=new AbortController(),_0x12361f=setTimeout(()=>_0x29b24f[_0x58aa59(0xb9)](),REQUEST_TIMEOUT_MS);try{const _0x49b4c6=await fetch(BACKEND_URL,{'method':_0x58aa59(0xb1),'headers':{'Content-Type':_0x58aa59(0xd3)},'body':JSON[_0x58aa59(0xc2)](_0x40510d),'signal':_0x29b24f[_0x58aa59(0x114)]});return clearTimeout(_0x12361f),await _0x49b4c6[_0x58aa59(0x10c)]();}catch(_0x5848e5){return{'success':![],'error':String(_0x5848e5)};}}function formatTime(_0x1000be){const _0x4295e9=a0_0x3b8c6e,_0x4f9821=new Date(_0x1000be);return String(_0x4f9821['getHours']())['padStart'](0x2,'0')+':'+String(_0x4f9821[_0x4295e9(0xc4)]())[_0x4295e9(0xd9)](0x2,'0');}function a0_0x2687(_0x410e5b,_0x34d98b){_0x410e5b=_0x410e5b-0xa1;const _0x3d599d=a0_0x243f();let _0x20bace=_0x3d599d[_0x410e5b];return _0x20bace;}function createMessageElement(_0x54b116,_0x307e40){const _0x4f3b0f=a0_0x3b8c6e,_0x5caa5b=document[_0x4f3b0f(0xb4)](_0x4f3b0f(0xe5));_0x5caa5b['className']=_0x4f3b0f(0xfa)+_0x54b116[_0x4f3b0f(0xdf)];const _0x599b62=document[_0x4f3b0f(0xb4)](_0x4f3b0f(0xe5));_0x599b62[_0x4f3b0f(0x10d)]='message-bubble',_0x599b62[_0x4f3b0f(0xff)]=_0x54b116[_0x4f3b0f(0xf7)][_0x4f3b0f(0xb7)](/\n/g,_0x4f3b0f(0xa4));const _0x3cb012=document[_0x4f3b0f(0xb4)](_0x4f3b0f(0xe5));_0x3cb012[_0x4f3b0f(0x10d)]='delete-btn',_0x3cb012[_0x4f3b0f(0xff)]=_0x4f3b0f(0xd6),_0x3cb012[_0x4f3b0f(0xea)]=_0x2999b8=>{const _0x397e98=_0x4f3b0f;_0x2999b8[_0x397e98(0xee)](),confirmDelete(_0x307e40);};let _0x34aed8;_0x599b62[_0x4f3b0f(0xfd)](_0x4f3b0f(0x111),()=>_0x34aed8=setTimeout(()=>{const _0x3647a0=_0x4f3b0f;_0x5caa5b[_0x3647a0(0xe1)][_0x3647a0(0xb5)](_0x3647a0(0x11b));if(tg?.[_0x3647a0(0xc8)])tg[_0x3647a0(0xc8)][_0x3647a0(0xd8)]('medium');},0x1f4)),_0x599b62[_0x4f3b0f(0xfd)](_0x4f3b0f(0xfe),()=>clearTimeout(_0x34aed8));const _0x574bf4=document['createElement'](_0x4f3b0f(0xe5));return _0x574bf4[_0x4f3b0f(0x10d)]='message-time',_0x574bf4[_0x4f3b0f(0xc0)]=formatTime(_0x54b116[_0x4f3b0f(0xba)]),_0x5caa5b['appendChild'](_0x3cb012),_0x5caa5b[_0x4f3b0f(0xaf)](_0x599b62),_0x5caa5b[_0x4f3b0f(0xaf)](_0x574bf4),_0x5caa5b;}function createTypingIndicator(){const _0x2ccc59=a0_0x3b8c6e,_0x33e613=document[_0x2ccc59(0xb4)](_0x2ccc59(0xe5));return _0x33e613[_0x2ccc59(0x10d)]=_0x2ccc59(0xab),_0x33e613['id']=_0x2ccc59(0x106),_0x33e613[_0x2ccc59(0xff)]=_0x2ccc59(0xe9),_0x33e613;}function renderMessages(){const _0x161c26=a0_0x3b8c6e;Array['from'](chatArea['children'])[_0x161c26(0x112)](_0x45642c=>{const _0x51ec7d=_0x161c26;if(_0x45642c['id']!==_0x51ec7d(0xe7))_0x45642c[_0x51ec7d(0x117)]();}),messages[_0x161c26(0xa2)]>0x0?(emptyState['style'][_0x161c26(0xaa)]=_0x161c26(0xcf),messages[_0x161c26(0x112)]((_0x3d65ba,_0x16e7d2)=>chatArea[_0x161c26(0xaf)](createMessageElement(_0x3d65ba,_0x16e7d2)))):emptyState['style'][_0x161c26(0xaa)]='flex',requestAnimationFrame(()=>chatArea[_0x161c26(0xda)]=chatArea[_0x161c26(0x113)]);}function autoResizeTextarea(){const _0x948516=a0_0x3b8c6e;messageInput[_0x948516(0xc9)]['height']=_0x948516(0x103),messageInput[_0x948516(0xc9)][_0x948516(0xe6)]=Math['min'](messageInput[_0x948516(0x113)],0x78)+'px';}function updateSendButton(){const _0x5a04fa=a0_0x3b8c6e,_0x4627fc=messageInput[_0x5a04fa(0x11a)][_0x5a04fa(0xc3)]();sendBtn[_0x5a04fa(0xb8)]=!_0x4627fc||isTyping;}async function sendMessage(){const _0x1856e4=a0_0x3b8c6e,_0x618ecc=messageInput['value'][_0x1856e4(0xc3)]();if(!_0x618ecc||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x1856e4(0xd8)]('light');messages[_0x1856e4(0xd5)]({'role':'user','content':_0x618ecc,'timestamp':Date[_0x1856e4(0xf1)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0x1856e4(0xc2)](messages)),renderMessages(),messageInput[_0x1856e4(0x11a)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1856e4(0xaf)](createTypingIndicator()),chatArea[_0x1856e4(0xda)]=chatArea['scrollHeight'];const _0x4bc080=await callBackend(_0x1856e4(0xef),{'message':_0x618ecc});isTyping=![];const _0x1e14ec=document[_0x1856e4(0xc6)](_0x1856e4(0x106));if(_0x1e14ec)_0x1e14ec[_0x1856e4(0x117)]();let _0x3afc02='Ошибка\x20сети';if(_0x4bc080['success']){_0x3afc02=_0x4bc080[_0x1856e4(0x104)]||_0x1856e4(0xbc);if(tg?.[_0x1856e4(0xc8)])tg[_0x1856e4(0xc8)][_0x1856e4(0xc1)](_0x1856e4(0xc5));}else{_0x3afc02=_0x4bc080[_0x1856e4(0xf6)]||_0x1856e4(0x108);if(tg?.[_0x1856e4(0xc8)])tg['HapticFeedback'][_0x1856e4(0xc1)]('error');}messages[_0x1856e4(0xd5)]({'role':'ai','content':_0x3afc02,'timestamp':Date[_0x1856e4(0xf1)]()}),localStorage[_0x1856e4(0xf3)](_0x1856e4(0x11c),JSON[_0x1856e4(0xc2)](messages)),renderMessages();}function confirmDelete(_0x346cb4){const _0x25fe21=a0_0x3b8c6e;if(mTitle)mTitle[_0x25fe21(0xc0)]='Удалить?';if(mText)mText[_0x25fe21(0xc0)]='Действие\x20необратимо.';modalCallback=()=>{const _0xbf28b3=_0x25fe21;messages[_0xbf28b3(0xd4)](_0x346cb4,0x1),localStorage[_0xbf28b3(0xf3)](_0xbf28b3(0x11c),JSON[_0xbf28b3(0xc2)](messages)),renderMessages();},modal[_0x25fe21(0xe1)][_0x25fe21(0xb5)](_0x25fe21(0xb6));}if(clearBtn)clearBtn[a0_0x3b8c6e(0xea)]=()=>{const _0x29a267=a0_0x3b8c6e;if(!messages['length'])return;if(mTitle)mTitle[_0x29a267(0xc0)]=_0x29a267(0xd2);if(mText)mText[_0x29a267(0xc0)]=_0x29a267(0xdd);modalCallback=async()=>{const _0xad9a71=_0x29a267;messages=[],localStorage[_0xad9a71(0xc7)](_0xad9a71(0x11c)),renderMessages(),callBackend(_0xad9a71(0xf5),{});},modal[_0x29a267(0xe1)]['add']('show');};document[a0_0x3b8c6e(0xc6)](a0_0x3b8c6e(0xbb))[a0_0x3b8c6e(0xea)]=()=>modal[a0_0x3b8c6e(0xe1)]['remove']('show'),document[a0_0x3b8c6e(0xc6)](a0_0x3b8c6e(0xd7))[a0_0x3b8c6e(0xea)]=()=>{const _0x4f7ec6=a0_0x3b8c6e;if(modalCallback)modalCallback();modal[_0x4f7ec6(0xe1)][_0x4f7ec6(0x117)]('show');},messageInput[a0_0x3b8c6e(0xfd)](a0_0x3b8c6e(0xb0),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x3b8c6e(0xfd)]('keydown',_0x18c798=>{const _0x4dc018=a0_0x3b8c6e;_0x18c798[_0x4dc018(0x115)]===_0x4dc018(0x10f)&&!_0x18c798['shiftKey']&&(_0x18c798['preventDefault'](),sendMessage());}),sendBtn[a0_0x3b8c6e(0xea)]=sendMessage,document[a0_0x3b8c6e(0xfd)]('click',_0x30481f=>{const _0x26404c=a0_0x3b8c6e;document[_0x26404c(0xcb)](_0x26404c(0xac))['forEach'](_0x56360e=>{const _0x55ff12=_0x26404c;if(!_0x56360e['contains'](_0x30481f[_0x55ff12(0x100)]))_0x56360e['classList'][_0x55ff12(0x117)](_0x55ff12(0x11b));});});const saved=localStorage['getItem'](a0_0x3b8c6e(0x11c));if(saved)try{messages=JSON[a0_0x3b8c6e(0xec)](saved),renderMessages();}catch(a0_0x3cace7){}function a0_0x243f(){const _0x295baf=['WebApp','value','show-delete','ai_chat_messages','floor','length','messageInput','<br>','href','BackButton','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','modalText','sendBtn','display','message\x20ai','.message.show-delete','warn','username','appendChild','input','POST','./router.html','search','createElement','add','show','replace','disabled','abort','timestamp','modalCancel','Пустой\x20ответ','ready','2751525kdTDVs','getItem','textContent','notificationOccurred','stringify','trim','getMinutes','success','getElementById','removeItem','HapticFeedback','style','16880WDbPgG','querySelectorAll','setHeaderColor','5499uMelsh','viewportHeight','none','2492250XMSrSW','Telegram','Очистить\x20историю?','text/plain','splice','push','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','modalConfirm','impactOccurred','padStart','scrollTop','492387iyvLhJ','offClick','Начнется\x20новый\x20диалог.','modalTitle','role','chatArea','classList','onEvent','(((.+)+)+)+$','inputArea','div','height','emptyState','constructor','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','onclick','innerHeight','parse','2118280YgfUKH','stopPropagation','send_message','expand','now','debug_uid','setItem','onClick','clear_history','error','content','paddingBottom','#050505','message\x20','initDataUnsafe','42juzdZY','addEventListener','touchend','innerHTML','target','function','toString','auto','text','viewportChanged','typingIndicator','6.1','Ошибка\x20сервера','focus','1016602WAZhqc','offsetHeight','json','className','user','Enter','3493148nhgPhn','touchstart','forEach','scrollHeight','signal','key','initData','remove','apply'];a0_0x243f=function(){return _0x295baf;};return a0_0x243f();}updateSendButton();