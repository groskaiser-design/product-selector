const a0_0x2dbcd2=a0_0xe7e7;(function(_0x57c741,_0x104c11){const _0x56362a=a0_0xe7e7,_0x538b6d=_0x57c741();while(!![]){try{const _0x3dd341=parseInt(_0x56362a(0x219))/0x1*(parseInt(_0x56362a(0x213))/0x2)+-parseInt(_0x56362a(0x208))/0x3+-parseInt(_0x56362a(0x1fb))/0x4*(parseInt(_0x56362a(0x1e0))/0x5)+-parseInt(_0x56362a(0x23e))/0x6+parseInt(_0x56362a(0x258))/0x7*(-parseInt(_0x56362a(0x22e))/0x8)+parseInt(_0x56362a(0x230))/0x9*(-parseInt(_0x56362a(0x250))/0xa)+parseInt(_0x56362a(0x24f))/0xb;if(_0x3dd341===_0x104c11)break;else _0x538b6d['push'](_0x538b6d['shift']());}catch(_0x1a731e){_0x538b6d['push'](_0x538b6d['shift']());}}}(a0_0x5388,0x2514a));const tg=window[a0_0x2dbcd2(0x246)]?.[a0_0x2dbcd2(0x204)],HOME_URL=a0_0x2dbcd2(0x1f5);function setupTelegramBackButton(){const _0x401b4c=a0_0x2dbcd2;if(!tg)return;try{tg[_0x401b4c(0x22b)](),tg[_0x401b4c(0x1fc)](),tg['setHeaderColor']?.('#050505');if(tg['isVersionAtLeast']?.(_0x401b4c(0x239)))tg[_0x401b4c(0x224)]?.();const _0x39d181=tg[_0x401b4c(0x248)];if(_0x39d181){_0x39d181['show']();if(typeof _0x39d181['offClick']===_0x401b4c(0x23b))try{_0x39d181[_0x401b4c(0x21f)]();}catch(_0x2e76bd){}_0x39d181[_0x401b4c(0x23d)](()=>{const _0x324664=_0x401b4c;if(tg[_0x324664(0x20b)])tg[_0x324664(0x20b)][_0x324664(0x1e1)]('light');location[_0x324664(0x242)]=HOME_URL;});}}catch(_0x1e3c82){console[_0x401b4c(0x23f)](_0x401b4c(0x24d),_0x1e3c82);}}function a0_0x5388(){const _0x49ba54=['stopPropagation','function','contains','onClick','1137222LrSroY','warn','value','user','href','toString','message-time','disabled','Telegram','typingIndicator','BackButton','onEvent','message\x20ai','<br>','onclick','TG\x20setup\x20error:','className','9998824DSlDpr','4380pYXgBt','role','text/plain','modalConfirm','timestamp','error','paddingBottom','shiftKey','7707TiqkDt','classList','initData','search','getElementById','ai_chat_messages','notificationOccurred','push','viewportChanged','5gdeOcv','impactOccurred','Пустой\x20ответ','height','Ошибка\x20сети','flex','replace','removeItem','Начнется\x20новый\x20диалог.','forEach','scrollTop','message\x20','key','show-delete','clear_history','messageInput','display','json','.message.show-delete','inputArea','getHours','./router.html','POST','Ошибка\x20сервера','target','apply','(((.+)+)+)+$','718076YUutBo','expand','auto','splice','sendBtn','signal','viewportHeight','min','remove','WebApp','addEventListener','input','clearBtn','897696kUvvSC','emptyState','Удалить?','HapticFeedback','send_message','children','setItem','modalText','modalTitle','appendChild','style','318446JRVsMt','getItem','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Enter','show','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','1FvaGnx','offsetHeight','length','keydown','random','resize','offClick','touchstart','Действие\x20необратимо.','light','message-bubble','disableVerticalSwipes','initDataUnsafe','first_name','add','getMinutes','scrollHeight','querySelectorAll','ready','createElement','trim','1048OXBQcx','success','2133LGpwRj','div','floor','stringify','textContent','debug_uid','chatArea','innerHTML','constructor','6.1'];a0_0x5388=function(){return _0x49ba54;};return a0_0x5388();}(function initStableLayout(){const _0x3e9790=a0_0x2dbcd2,_0x5c3cca=(function(){let _0x262f67=!![];return function(_0x32df38,_0x346bf6){const _0x4dffc0=_0x262f67?function(){const _0x3b6d0f=a0_0xe7e7;if(_0x346bf6){const _0x41849c=_0x346bf6[_0x3b6d0f(0x1f9)](_0x32df38,arguments);return _0x346bf6=null,_0x41849c;}}:function(){};return _0x262f67=![],_0x4dffc0;};}()),_0x347782=document['querySelector']('.container'),_0x214482=document[_0x3e9790(0x25c)](_0x3e9790(0x1f3)),_0x432979=document[_0x3e9790(0x25c)]('chatArea'),_0x3ecb9f=document[_0x3e9790(0x25c)](_0x3e9790(0x1ef));function _0x4545b5(){const _0xd166b7=_0x3e9790,_0x40480d=_0x5c3cca(this,function(){const _0x5c844f=a0_0xe7e7;return _0x40480d[_0x5c844f(0x243)]()[_0x5c844f(0x25b)](_0x5c844f(0x1fa))['toString']()[_0x5c844f(0x238)](_0x40480d)[_0x5c844f(0x25b)](_0x5c844f(0x1fa));});_0x40480d();if(!_0x347782)return;const _0xb8b4f9=tg&&tg[_0xd166b7(0x201)]?tg[_0xd166b7(0x201)]:window['innerHeight'];_0x347782[_0xd166b7(0x212)][_0xd166b7(0x1e3)]=_0xb8b4f9+'px';if(_0x214482){const _0x5dd321=_0x214482[_0xd166b7(0x21a)];_0x432979[_0xd166b7(0x212)][_0xd166b7(0x256)]=_0x5dd321+0x28+'px';}}tg?tg[_0x3e9790(0x249)](_0x3e9790(0x1df),({isStateStable:_0x3b343c})=>{_0x4545b5();if(_0x3b343c)requestAnimationFrame(()=>{const _0x22facf=a0_0xe7e7;_0x432979[_0x22facf(0x1ea)]=_0x432979[_0x22facf(0x229)];});}):window[_0x3e9790(0x205)](_0x3e9790(0x21e),_0x4545b5),_0x4545b5(),_0x3ecb9f&&(_0x3ecb9f['addEventListener'](_0x3e9790(0x206),()=>{requestAnimationFrame(_0x4545b5);}),_0x3ecb9f[_0x3e9790(0x205)]('focus',()=>{setTimeout(()=>{const _0x15d590=a0_0xe7e7;_0x432979[_0x15d590(0x1ea)]=_0x432979['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2dbcd2(0x215),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2dbcd2(0x25c)](a0_0x2dbcd2(0x236)),emptyState=document[a0_0x2dbcd2(0x25c)](a0_0x2dbcd2(0x209)),messageInput=document[a0_0x2dbcd2(0x25c)](a0_0x2dbcd2(0x1ef)),sendBtn=document[a0_0x2dbcd2(0x25c)](a0_0x2dbcd2(0x1ff)),clearBtn=document[a0_0x2dbcd2(0x25c)](a0_0x2dbcd2(0x207)),modal=document[a0_0x2dbcd2(0x25c)]('confirmModal'),mTitle=document[a0_0x2dbcd2(0x25c)](a0_0x2dbcd2(0x210)),mText=document[a0_0x2dbcd2(0x25c)](a0_0x2dbcd2(0x20f));function a0_0xe7e7(_0xc0da12,_0x41a0c7){_0xc0da12=_0xc0da12-0x1dd;const _0x246611=a0_0x5388();let _0x1ef50e=_0x246611[_0xc0da12];return _0x1ef50e;}let modalCallback=null;async function callBackend(_0x21d39d,_0x214592){const _0x1c4e3f=a0_0x2dbcd2,_0x1ae33c=tg?.[_0x1c4e3f(0x225)]?.[_0x1c4e3f(0x241)]||{},_0x5e7d69=_0x1ae33c['id']||localStorage[_0x1c4e3f(0x214)]('debug_uid')||'d-'+Math[_0x1c4e3f(0x232)](Math[_0x1c4e3f(0x21d)]()*0x3b9aca00);if(!_0x1ae33c['id'])localStorage[_0x1c4e3f(0x20e)](_0x1c4e3f(0x235),_0x5e7d69);const _0x318363={'action':_0x21d39d,'user_id':_0x5e7d69,'user_data':{'first_name':_0x1ae33c[_0x1c4e3f(0x226)],'username':_0x1ae33c['username']},'init_data':tg?.[_0x1c4e3f(0x25a)]||'',..._0x214592},_0x1f510e=new AbortController(),_0x3aa1d0=setTimeout(()=>_0x1f510e['abort'](),REQUEST_TIMEOUT_MS);try{const _0x347f2f=await fetch(BACKEND_URL,{'method':_0x1c4e3f(0x1f6),'headers':{'Content-Type':_0x1c4e3f(0x252)},'body':JSON[_0x1c4e3f(0x233)](_0x318363),'signal':_0x1f510e[_0x1c4e3f(0x200)]});return clearTimeout(_0x3aa1d0),await _0x347f2f[_0x1c4e3f(0x1f1)]();}catch(_0x3699ed){return{'success':![],'error':String(_0x3699ed)};}}function formatTime(_0x561979){const _0x1c876d=a0_0x2dbcd2,_0xf9c515=new Date(_0x561979);return String(_0xf9c515[_0x1c876d(0x1f4)]())['padStart'](0x2,'0')+':'+String(_0xf9c515[_0x1c876d(0x228)]())['padStart'](0x2,'0');}function createMessageElement(_0x30e33d,_0x1435cd){const _0x59f76e=a0_0x2dbcd2,_0x1e04f4=document[_0x59f76e(0x22c)](_0x59f76e(0x231));_0x1e04f4[_0x59f76e(0x24e)]=_0x59f76e(0x1eb)+_0x30e33d[_0x59f76e(0x251)];const _0x55e8c8=document['createElement'](_0x59f76e(0x231));_0x55e8c8[_0x59f76e(0x24e)]=_0x59f76e(0x223),_0x55e8c8['innerHTML']=_0x30e33d['content'][_0x59f76e(0x1e6)](/\n/g,_0x59f76e(0x24b));const _0x3e456d=document[_0x59f76e(0x22c)](_0x59f76e(0x231));_0x3e456d[_0x59f76e(0x24e)]='delete-btn',_0x3e456d[_0x59f76e(0x237)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x3e456d[_0x59f76e(0x24c)]=_0x2b046f=>{const _0x22b553=_0x59f76e;_0x2b046f[_0x22b553(0x23a)](),confirmDelete(_0x1435cd);};let _0x3b99d5;_0x55e8c8[_0x59f76e(0x205)](_0x59f76e(0x220),()=>_0x3b99d5=setTimeout(()=>{const _0x4786be=_0x59f76e;_0x1e04f4[_0x4786be(0x259)][_0x4786be(0x227)](_0x4786be(0x1ed));if(tg?.[_0x4786be(0x20b)])tg[_0x4786be(0x20b)][_0x4786be(0x1e1)]('medium');},0x1f4)),_0x55e8c8[_0x59f76e(0x205)]('touchend',()=>clearTimeout(_0x3b99d5));const _0x401e29=document[_0x59f76e(0x22c)](_0x59f76e(0x231));return _0x401e29[_0x59f76e(0x24e)]=_0x59f76e(0x244),_0x401e29[_0x59f76e(0x234)]=formatTime(_0x30e33d[_0x59f76e(0x254)]),_0x1e04f4['appendChild'](_0x3e456d),_0x1e04f4['appendChild'](_0x55e8c8),_0x1e04f4['appendChild'](_0x401e29),_0x1e04f4;}function createTypingIndicator(){const _0x2579c8=a0_0x2dbcd2,_0x32045c=document[_0x2579c8(0x22c)](_0x2579c8(0x231));return _0x32045c[_0x2579c8(0x24e)]=_0x2579c8(0x24a),_0x32045c['id']=_0x2579c8(0x247),_0x32045c[_0x2579c8(0x237)]=_0x2579c8(0x218),_0x32045c;}function renderMessages(){const _0x5a6a23=a0_0x2dbcd2;Array['from'](chatArea[_0x5a6a23(0x20d)])[_0x5a6a23(0x1e9)](_0x40e530=>{const _0x5a8538=_0x5a6a23;if(_0x40e530['id']!==_0x5a8538(0x209))_0x40e530[_0x5a8538(0x203)]();}),messages[_0x5a6a23(0x21b)]>0x0?(emptyState['style']['display']='none',messages[_0x5a6a23(0x1e9)]((_0x43e47c,_0x45c428)=>chatArea[_0x5a6a23(0x211)](createMessageElement(_0x43e47c,_0x45c428)))):emptyState[_0x5a6a23(0x212)][_0x5a6a23(0x1f0)]=_0x5a6a23(0x1e5),requestAnimationFrame(()=>chatArea[_0x5a6a23(0x1ea)]=chatArea[_0x5a6a23(0x229)]);}function autoResizeTextarea(){const _0x227145=a0_0x2dbcd2;messageInput[_0x227145(0x212)][_0x227145(0x1e3)]=_0x227145(0x1fd),messageInput['style'][_0x227145(0x1e3)]=Math[_0x227145(0x202)](messageInput[_0x227145(0x229)],0x78)+'px';}function updateSendButton(){const _0x107eba=a0_0x2dbcd2,_0xedd2e5=messageInput['value'][_0x107eba(0x22d)]();sendBtn[_0x107eba(0x245)]=!_0xedd2e5||isTyping;}async function sendMessage(){const _0x2223fa=a0_0x2dbcd2,_0xdf52d6=messageInput[_0x2223fa(0x240)][_0x2223fa(0x22d)]();if(!_0xdf52d6||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2223fa(0x20b)][_0x2223fa(0x1e1)](_0x2223fa(0x222));messages['push']({'role':_0x2223fa(0x241),'content':_0xdf52d6,'timestamp':Date['now']()}),localStorage[_0x2223fa(0x20e)](_0x2223fa(0x25d),JSON[_0x2223fa(0x233)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2223fa(0x211)](createTypingIndicator()),chatArea[_0x2223fa(0x1ea)]=chatArea[_0x2223fa(0x229)];const _0x3b7ba0=await callBackend(_0x2223fa(0x20c),{'message':_0xdf52d6});isTyping=![];const _0x92320=document[_0x2223fa(0x25c)](_0x2223fa(0x247));if(_0x92320)_0x92320['remove']();let _0x1ed9bc=_0x2223fa(0x1e4);if(_0x3b7ba0['success']){_0x1ed9bc=_0x3b7ba0['text']||_0x2223fa(0x1e2);if(tg?.['HapticFeedback'])tg['HapticFeedback']['notificationOccurred'](_0x2223fa(0x22f));}else{_0x1ed9bc=_0x3b7ba0[_0x2223fa(0x255)]||_0x2223fa(0x1f7);if(tg?.[_0x2223fa(0x20b)])tg[_0x2223fa(0x20b)][_0x2223fa(0x1dd)](_0x2223fa(0x255));}messages[_0x2223fa(0x1de)]({'role':'ai','content':_0x1ed9bc,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x2417cc){const _0x8d3677=a0_0x2dbcd2;if(mTitle)mTitle[_0x8d3677(0x234)]=_0x8d3677(0x20a);if(mText)mText[_0x8d3677(0x234)]=_0x8d3677(0x221);modalCallback=()=>{const _0x35fa21=_0x8d3677;messages[_0x35fa21(0x1fe)](_0x2417cc,0x1),localStorage[_0x35fa21(0x20e)](_0x35fa21(0x25d),JSON[_0x35fa21(0x233)](messages)),renderMessages();},modal['classList'][_0x8d3677(0x227)](_0x8d3677(0x217));}if(clearBtn)clearBtn['onclick']=()=>{const _0x5bf8df=a0_0x2dbcd2;if(!messages['length'])return;if(mTitle)mTitle[_0x5bf8df(0x234)]='Очистить\x20историю?';if(mText)mText[_0x5bf8df(0x234)]=_0x5bf8df(0x1e8);modalCallback=async()=>{const _0x28ba81=_0x5bf8df;messages=[],localStorage[_0x28ba81(0x1e7)](_0x28ba81(0x25d)),renderMessages(),callBackend(_0x28ba81(0x1ee),{});},modal[_0x5bf8df(0x259)][_0x5bf8df(0x227)](_0x5bf8df(0x217));};document[a0_0x2dbcd2(0x25c)]('modalCancel')[a0_0x2dbcd2(0x24c)]=()=>modal[a0_0x2dbcd2(0x259)][a0_0x2dbcd2(0x203)](a0_0x2dbcd2(0x217)),document[a0_0x2dbcd2(0x25c)](a0_0x2dbcd2(0x253))[a0_0x2dbcd2(0x24c)]=()=>{const _0x25eefb=a0_0x2dbcd2;if(modalCallback)modalCallback();modal['classList']['remove'](_0x25eefb(0x217));},messageInput['addEventListener'](a0_0x2dbcd2(0x206),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x2dbcd2(0x205)](a0_0x2dbcd2(0x21c),_0x360762=>{const _0x34f7f8=a0_0x2dbcd2;_0x360762[_0x34f7f8(0x1ec)]===_0x34f7f8(0x216)&&!_0x360762[_0x34f7f8(0x257)]&&(_0x360762['preventDefault'](),sendMessage());}),sendBtn[a0_0x2dbcd2(0x24c)]=sendMessage,document[a0_0x2dbcd2(0x205)]('click',_0x2cb4e7=>{const _0x411e91=a0_0x2dbcd2;document[_0x411e91(0x22a)](_0x411e91(0x1f2))[_0x411e91(0x1e9)](_0x45d6bf=>{const _0x3e5ef4=_0x411e91;if(!_0x45d6bf[_0x3e5ef4(0x23c)](_0x2cb4e7[_0x3e5ef4(0x1f8)]))_0x45d6bf[_0x3e5ef4(0x259)]['remove'](_0x3e5ef4(0x1ed));});});const saved=localStorage['getItem'](a0_0x2dbcd2(0x25d));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x10c844){}updateSendButton();