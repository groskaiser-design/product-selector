function a0_0xe59f(_0x43fa9e,_0x1f4260){_0x43fa9e=_0x43fa9e-0xac;const _0x160a7a=a0_0x221f();let _0x4600e3=_0x160a7a[_0x43fa9e];return _0x4600e3;}const a0_0x53045a=a0_0xe59f;(function(_0x2cead9,_0x1de559){const _0xc48a98=a0_0xe59f,_0x31bdfe=_0x2cead9();while(!![]){try{const _0x4945f7=-parseInt(_0xc48a98(0x11e))/0x1+-parseInt(_0xc48a98(0xde))/0x2+parseInt(_0xc48a98(0x102))/0x3*(parseInt(_0xc48a98(0xfd))/0x4)+-parseInt(_0xc48a98(0xe6))/0x5*(parseInt(_0xc48a98(0xe3))/0x6)+parseInt(_0xc48a98(0xf5))/0x7+parseInt(_0xc48a98(0xef))/0x8*(-parseInt(_0xc48a98(0xbc))/0x9)+parseInt(_0xc48a98(0x120))/0xa*(parseInt(_0xc48a98(0x106))/0xb);if(_0x4945f7===_0x1de559)break;else _0x31bdfe['push'](_0x31bdfe['shift']());}catch(_0x3fad55){_0x31bdfe['push'](_0x31bdfe['shift']());}}}(a0_0x221f,0xf14a7));const tg=window[a0_0x53045a(0x10f)]?.['WebApp'],HOME_URL=a0_0x53045a(0x116);function setupTelegramBackButton(){const _0xcdc2ee=a0_0x53045a;if(!tg)return;try{tg[_0xcdc2ee(0xf7)](),tg[_0xcdc2ee(0xc4)](),tg[_0xcdc2ee(0xed)]?.(_0xcdc2ee(0xb7));if(tg[_0xcdc2ee(0xf2)]?.(_0xcdc2ee(0xfe)))tg[_0xcdc2ee(0xc7)]?.();const _0x4bb1c0=tg[_0xcdc2ee(0xc2)];if(_0x4bb1c0){_0x4bb1c0[_0xcdc2ee(0xe1)]();if(typeof _0x4bb1c0[_0xcdc2ee(0x103)]===_0xcdc2ee(0xc9))try{_0x4bb1c0['offClick']();}catch(_0x152b86){}_0x4bb1c0['onClick'](()=>{const _0x515098=_0xcdc2ee;if(tg['HapticFeedback'])tg[_0x515098(0xfb)]['impactOccurred'](_0x515098(0x104));location[_0x515098(0xee)]=HOME_URL;});}}catch(_0x350881){console[_0xcdc2ee(0xdf)]('TG\x20setup\x20error:',_0x350881);}}(function initStableLayout(){const _0x28ad5a=a0_0x53045a,_0x24bd70=(function(){let _0x5b0b45=!![];return function(_0xf4a941,_0x507804){const _0x4e3487=_0x5b0b45?function(){const _0x269447=a0_0xe59f;if(_0x507804){const _0x1ca6a1=_0x507804[_0x269447(0xe0)](_0xf4a941,arguments);return _0x507804=null,_0x1ca6a1;}}:function(){};return _0x5b0b45=![],_0x4e3487;};}()),_0x5a4d1d=document['querySelector']('.container'),_0x56e935=document['getElementById'](_0x28ad5a(0xc5)),_0x50a14d=document[_0x28ad5a(0xbb)]('chatArea'),_0x35a64a=document[_0x28ad5a(0xbb)]('messageInput');function _0x10f24c(){const _0x39508d=_0x28ad5a,_0x2406b4=_0x24bd70(this,function(){const _0x16ab98=a0_0xe59f;return _0x2406b4[_0x16ab98(0xc1)]()[_0x16ab98(0xbe)](_0x16ab98(0x11f))[_0x16ab98(0xc1)]()['constructor'](_0x2406b4)[_0x16ab98(0xbe)](_0x16ab98(0x11f));});_0x2406b4();if(!_0x5a4d1d)return;const _0x4ad062=tg&&tg[_0x39508d(0xe2)]?tg['viewportHeight']:window[_0x39508d(0xc6)];_0x5a4d1d[_0x39508d(0xfc)]['height']=_0x4ad062+'px';if(_0x56e935){const _0x24fb74=_0x56e935[_0x39508d(0xc3)];_0x50a14d[_0x39508d(0xfc)][_0x39508d(0xd4)]=_0x24fb74+0x28+'px';}}tg?tg['onEvent'](_0x28ad5a(0x122),({isStateStable:_0xf6d472})=>{_0x10f24c();if(_0xf6d472)requestAnimationFrame(()=>{const _0x20b3b4=a0_0xe59f;_0x50a14d[_0x20b3b4(0xd3)]=_0x50a14d[_0x20b3b4(0xf0)];});}):window[_0x28ad5a(0xca)](_0x28ad5a(0xe7),_0x10f24c),_0x10f24c(),_0x35a64a&&(_0x35a64a[_0x28ad5a(0xca)](_0x28ad5a(0xff),()=>{requestAnimationFrame(_0x10f24c);}),_0x35a64a['addEventListener'](_0x28ad5a(0x117),()=>{setTimeout(()=>{const _0x58c352=a0_0xe59f;_0x50a14d[_0x58c352(0xd3)]=_0x50a14d['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x53045a(0xcf),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x53045a(0xbb)]('chatArea'),emptyState=document[a0_0x53045a(0xbb)](a0_0x53045a(0xeb)),messageInput=document[a0_0x53045a(0xbb)](a0_0x53045a(0xe5)),sendBtn=document[a0_0x53045a(0xbb)](a0_0x53045a(0xd9)),clearBtn=document[a0_0x53045a(0xbb)](a0_0x53045a(0x10a)),modal=document[a0_0x53045a(0xbb)](a0_0x53045a(0x101)),mTitle=document[a0_0x53045a(0xbb)](a0_0x53045a(0x111)),mText=document[a0_0x53045a(0xbb)]('modalText');let modalCallback=null;async function callBackend(_0x472814,_0x15a479){const _0x53f2ac=a0_0x53045a,_0x25d45=tg?.[_0x53f2ac(0x100)]?.[_0x53f2ac(0xce)]||{},_0x361e29=_0x25d45['id']||localStorage[_0x53f2ac(0xd6)](_0x53f2ac(0xad))||'d-'+Math[_0x53f2ac(0xf6)](Math[_0x53f2ac(0x113)]()*0x3b9aca00);if(!_0x25d45['id'])localStorage[_0x53f2ac(0xb1)](_0x53f2ac(0xad),_0x361e29);const _0x441945={'action':_0x472814,'user_id':_0x361e29,'user_data':{'first_name':_0x25d45['first_name'],'username':_0x25d45['username']},'init_data':tg?.['initData']||'',..._0x15a479},_0xe6a67a=new AbortController(),_0x4e7d84=setTimeout(()=>_0xe6a67a[_0x53f2ac(0xdd)](),REQUEST_TIMEOUT_MS);try{const _0x433c7f=await fetch(BACKEND_URL,{'method':_0x53f2ac(0xb8),'headers':{'Content-Type':_0x53f2ac(0x114)},'body':JSON[_0x53f2ac(0xd7)](_0x441945),'signal':_0xe6a67a[_0x53f2ac(0xc0)]});return clearTimeout(_0x4e7d84),await _0x433c7f[_0x53f2ac(0x10b)]();}catch(_0x141572){return{'success':![],'error':String(_0x141572)};}}function formatTime(_0xa7f787){const _0x4bed71=a0_0x53045a,_0x361812=new Date(_0xa7f787);return String(_0x361812[_0x4bed71(0xdb)]())[_0x4bed71(0x105)](0x2,'0')+':'+String(_0x361812[_0x4bed71(0xf9)]())['padStart'](0x2,'0');}function createMessageElement(_0x30cb05,_0x2766d6){const _0x582adf=a0_0x53045a,_0x12e9df=document['createElement'](_0x582adf(0xe4));_0x12e9df[_0x582adf(0x125)]=_0x582adf(0xea)+_0x30cb05['role'];const _0x26ec58=document[_0x582adf(0xd0)]('div');_0x26ec58[_0x582adf(0x125)]=_0x582adf(0xd5),_0x26ec58[_0x582adf(0x121)]=_0x30cb05['content'][_0x582adf(0xb9)](/\n/g,'<br>');const _0x103f9b=document[_0x582adf(0xd0)](_0x582adf(0xe4));_0x103f9b['className']='delete-btn',_0x103f9b[_0x582adf(0x121)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x103f9b[_0x582adf(0xbf)]=_0x5d5d7b=>{const _0x5b8e80=_0x582adf;_0x5d5d7b[_0x5b8e80(0xb5)](),confirmDelete(_0x2766d6);};let _0xa47591;_0x26ec58['addEventListener']('touchstart',()=>_0xa47591=setTimeout(()=>{const _0x22591c=_0x582adf;_0x12e9df['classList'][_0x22591c(0xbd)](_0x22591c(0x124));if(tg?.[_0x22591c(0xfb)])tg[_0x22591c(0xfb)][_0x22591c(0x109)]('medium');},0x1f4)),_0x26ec58[_0x582adf(0xca)](_0x582adf(0xae),()=>clearTimeout(_0xa47591));const _0x87189e=document[_0x582adf(0xd0)](_0x582adf(0xe4));return _0x87189e[_0x582adf(0x125)]=_0x582adf(0xfa),_0x87189e[_0x582adf(0x110)]=formatTime(_0x30cb05['timestamp']),_0x12e9df['appendChild'](_0x103f9b),_0x12e9df[_0x582adf(0x115)](_0x26ec58),_0x12e9df['appendChild'](_0x87189e),_0x12e9df;}function createTypingIndicator(){const _0x4afcb5=a0_0x53045a,_0x3d4902=document[_0x4afcb5(0xd0)](_0x4afcb5(0xe4));return _0x3d4902[_0x4afcb5(0x125)]='message\x20ai',_0x3d4902['id']='typingIndicator',_0x3d4902[_0x4afcb5(0x121)]=_0x4afcb5(0xf1),_0x3d4902;}function renderMessages(){const _0x1b7d95=a0_0x53045a;Array[_0x1b7d95(0x11b)](chatArea[_0x1b7d95(0xda)])['forEach'](_0x28f0d9=>{const _0x5a2a58=_0x1b7d95;if(_0x28f0d9['id']!==_0x5a2a58(0xeb))_0x28f0d9[_0x5a2a58(0x112)]();}),messages[_0x1b7d95(0x123)]>0x0?(emptyState['style'][_0x1b7d95(0xe9)]=_0x1b7d95(0xe8),messages[_0x1b7d95(0x119)]((_0x19f61c,_0x5a284d)=>chatArea[_0x1b7d95(0x115)](createMessageElement(_0x19f61c,_0x5a284d)))):emptyState[_0x1b7d95(0xfc)][_0x1b7d95(0xe9)]=_0x1b7d95(0xd8),requestAnimationFrame(()=>chatArea[_0x1b7d95(0xd3)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x185d4b=a0_0x53045a;messageInput[_0x185d4b(0xfc)][_0x185d4b(0xd1)]=_0x185d4b(0xcd),messageInput['style']['height']=Math[_0x185d4b(0xcb)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x8aea4c=a0_0x53045a,_0x55f5fd=messageInput[_0x8aea4c(0x11c)][_0x8aea4c(0x11a)]();sendBtn[_0x8aea4c(0xcc)]=!_0x55f5fd||isTyping;}async function sendMessage(){const _0x3589e3=a0_0x53045a,_0x2ae399=messageInput[_0x3589e3(0x11c)][_0x3589e3(0x11a)]();if(!_0x2ae399||isTyping)return;if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x3589e3(0x109)]('light');messages[_0x3589e3(0x107)]({'role':_0x3589e3(0xce),'content':_0x2ae399,'timestamp':Date['now']()}),localStorage[_0x3589e3(0xb1)](_0x3589e3(0xb6),JSON[_0x3589e3(0xd7)](messages)),renderMessages(),messageInput[_0x3589e3(0x11c)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x3589e3(0x115)](createTypingIndicator()),chatArea[_0x3589e3(0xd3)]=chatArea['scrollHeight'];const _0x2f160d=await callBackend(_0x3589e3(0x10d),{'message':_0x2ae399});isTyping=![];const _0x177fdf=document[_0x3589e3(0xbb)](_0x3589e3(0xc8));if(_0x177fdf)_0x177fdf[_0x3589e3(0x112)]();let _0x190e8f='Ошибка\x20сети';if(_0x2f160d['success']){_0x190e8f=_0x2f160d[_0x3589e3(0xf4)]||_0x3589e3(0xba);if(tg?.[_0x3589e3(0xfb)])tg[_0x3589e3(0xfb)][_0x3589e3(0x10e)](_0x3589e3(0xf8));}else{_0x190e8f=_0x2f160d['error']||_0x3589e3(0x118);if(tg?.[_0x3589e3(0xfb)])tg[_0x3589e3(0xfb)][_0x3589e3(0x10e)](_0x3589e3(0xb2));}messages[_0x3589e3(0x107)]({'role':'ai','content':_0x190e8f,'timestamp':Date['now']()}),localStorage[_0x3589e3(0xb1)](_0x3589e3(0xb6),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x5bd480){const _0x50beff=a0_0x53045a;if(mTitle)mTitle[_0x50beff(0x110)]='Удалить?';if(mText)mText[_0x50beff(0x110)]='Действие\x20необратимо.';modalCallback=()=>{const _0x5f462b=_0x50beff;messages[_0x5f462b(0x11d)](_0x5bd480,0x1),localStorage[_0x5f462b(0xb1)](_0x5f462b(0xb6),JSON[_0x5f462b(0xd7)](messages)),renderMessages();},modal[_0x50beff(0xb0)]['add'](_0x50beff(0xe1));}if(clearBtn)clearBtn['onclick']=()=>{const _0x5e538e=a0_0x53045a;if(!messages[_0x5e538e(0x123)])return;if(mTitle)mTitle[_0x5e538e(0x110)]=_0x5e538e(0xd2);if(mText)mText[_0x5e538e(0x110)]=_0x5e538e(0xf3);modalCallback=async()=>{const _0x2ecdbd=_0x5e538e;messages=[],localStorage[_0x2ecdbd(0x108)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x5e538e(0xb0)][_0x5e538e(0xbd)](_0x5e538e(0xe1));};document[a0_0x53045a(0xbb)](a0_0x53045a(0xaf))[a0_0x53045a(0xbf)]=()=>modal[a0_0x53045a(0xb0)][a0_0x53045a(0x112)](a0_0x53045a(0xe1)),document[a0_0x53045a(0xbb)]('modalConfirm')[a0_0x53045a(0xbf)]=()=>{const _0x1d235a=a0_0x53045a;if(modalCallback)modalCallback();modal[_0x1d235a(0xb0)][_0x1d235a(0x112)](_0x1d235a(0xe1));},messageInput[a0_0x53045a(0xca)](a0_0x53045a(0xff),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x53045a(0xca)](a0_0x53045a(0xec),_0x2642a7=>{const _0x20c982=a0_0x53045a;_0x2642a7['key']===_0x20c982(0xac)&&!_0x2642a7['shiftKey']&&(_0x2642a7['preventDefault'](),sendMessage());}),sendBtn[a0_0x53045a(0xbf)]=sendMessage,document[a0_0x53045a(0xca)](a0_0x53045a(0xb3),_0x20275d=>{const _0x2063db=a0_0x53045a;document[_0x2063db(0x10c)](_0x2063db(0xb4))[_0x2063db(0x119)](_0xb38b6b=>{const _0xf22efa=_0x2063db;if(!_0xb38b6b[_0xf22efa(0xdc)](_0x20275d['target']))_0xb38b6b[_0xf22efa(0xb0)]['remove'](_0xf22efa(0x124));});});function a0_0x221f(){const _0x988814=['sendBtn','children','getHours','contains','abort','732348cofySz','warn','apply','show','viewportHeight','324318PJoRgo','div','messageInput','155QKkdnf','resize','none','display','message\x20','emptyState','keydown','setHeaderColor','href','595040OPKQso','scrollHeight','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','isVersionAtLeast','Начнется\x20новый\x20диалог.','text','646527RaHzwL','floor','ready','success','getMinutes','message-time','HapticFeedback','style','12GgeeNy','6.1','input','initDataUnsafe','confirmModal','911046migwiS','offClick','light','padStart','418CmpWkW','push','removeItem','impactOccurred','clearBtn','json','querySelectorAll','send_message','notificationOccurred','Telegram','textContent','modalTitle','remove','random','text/plain','appendChild','./router.html','focus','Ошибка\x20сервера','forEach','trim','from','value','splice','1640359oROBZo','(((.+)+)+)+$','1043320tkXWfY','innerHTML','viewportChanged','length','show-delete','className','Enter','debug_uid','touchend','modalCancel','classList','setItem','error','click','.message.show-delete','stopPropagation','ai_chat_messages','#050505','POST','replace','Пустой\x20ответ','getElementById','36wUtgQG','add','search','onclick','signal','toString','BackButton','offsetHeight','expand','inputArea','innerHeight','disableVerticalSwipes','typingIndicator','function','addEventListener','min','disabled','auto','user','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','createElement','height','Очистить\x20историю?','scrollTop','paddingBottom','message-bubble','getItem','stringify','flex'];a0_0x221f=function(){return _0x988814;};return a0_0x221f();}const saved=localStorage[a0_0x53045a(0xd6)](a0_0x53045a(0xb6));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x35e772){}updateSendButton();