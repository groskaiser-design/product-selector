const a0_0x263331=a0_0x1537;(function(_0x3184b9,_0x3d441c){const _0x167b4e=a0_0x1537,_0x580093=_0x3184b9();while(!![]){try{const _0x16de05=-parseInt(_0x167b4e(0xca))/0x1*(parseInt(_0x167b4e(0x94))/0x2)+-parseInt(_0x167b4e(0x8f))/0x3+parseInt(_0x167b4e(0xa7))/0x4+parseInt(_0x167b4e(0x75))/0x5+-parseInt(_0x167b4e(0x93))/0x6+-parseInt(_0x167b4e(0xd0))/0x7*(parseInt(_0x167b4e(0xa3))/0x8)+-parseInt(_0x167b4e(0x88))/0x9*(-parseInt(_0x167b4e(0x95))/0xa);if(_0x16de05===_0x3d441c)break;else _0x580093['push'](_0x580093['shift']());}catch(_0x48c4b9){_0x580093['push'](_0x580093['shift']());}}}(a0_0x2e92,0xf4105));const tg=window['Telegram']?.[a0_0x263331(0x78)],HOME_URL=a0_0x263331(0x7b);function setupTelegramBackButton(){const _0x235af3=a0_0x263331;if(!tg)return;try{tg[_0x235af3(0xe1)](),tg['expand'](),tg[_0x235af3(0xa1)]?.(_0x235af3(0x7c));if(tg[_0x235af3(0xd4)]?.('6.1'))tg[_0x235af3(0xa6)]?.();const _0x48de88=tg['BackButton'];if(_0x48de88){_0x48de88[_0x235af3(0x85)]();if(typeof _0x48de88['offClick']===_0x235af3(0x71))try{_0x48de88[_0x235af3(0xcc)]();}catch(_0x3110cc){}_0x48de88[_0x235af3(0xd7)](()=>{const _0x5a8d79=_0x235af3;if(tg[_0x5a8d79(0x70)])tg[_0x5a8d79(0x70)]['impactOccurred']('light');location['href']=HOME_URL;});}}catch(_0x26eace){console['warn'](_0x235af3(0xb6),_0x26eace);}}(function initStableLayout(){const _0xa56ed4=a0_0x263331,_0x34485d=(function(){let _0x4051f0=!![];return function(_0x9fa2e1,_0x1c0154){const _0x4c61a1=_0x4051f0?function(){const _0x503deb=a0_0x1537;if(_0x1c0154){const _0x4da7a0=_0x1c0154[_0x503deb(0xbd)](_0x9fa2e1,arguments);return _0x1c0154=null,_0x4da7a0;}}:function(){};return _0x4051f0=![],_0x4c61a1;};}()),_0x10095d=document[_0xa56ed4(0x99)](_0xa56ed4(0x9f)),_0x3d255f=document[_0xa56ed4(0xad)](_0xa56ed4(0xa4)),_0x1ea295=document[_0xa56ed4(0xad)](_0xa56ed4(0xc5)),_0xa05cf8=document[_0xa56ed4(0xad)](_0xa56ed4(0xe9));function _0x3d5824(){const _0x5b2f92=_0xa56ed4,_0x2defa0=_0x34485d(this,function(){const _0x3a2ad0=a0_0x1537;return _0x2defa0[_0x3a2ad0(0xd9)]()[_0x3a2ad0(0xe0)](_0x3a2ad0(0x9b))[_0x3a2ad0(0xd9)]()[_0x3a2ad0(0x9a)](_0x2defa0)[_0x3a2ad0(0xe0)](_0x3a2ad0(0x9b));});_0x2defa0();if(!_0x10095d)return;const _0x120655=tg&&tg['viewportHeight']?tg[_0x5b2f92(0xb5)]:window[_0x5b2f92(0x96)];_0x10095d[_0x5b2f92(0xbb)][_0x5b2f92(0x80)]=_0x120655+'px';if(_0x3d255f){const _0x401a0a=_0x3d255f[_0x5b2f92(0xb2)];_0x1ea295[_0x5b2f92(0xbb)]['paddingBottom']=_0x401a0a+0x28+'px';}}tg?tg['onEvent'](_0xa56ed4(0x79),({isStateStable:_0x420d24})=>{_0x3d5824();if(_0x420d24)requestAnimationFrame(()=>{const _0x2a7755=a0_0x1537;_0x1ea295[_0x2a7755(0xa5)]=_0x1ea295['scrollHeight'];});}):window['addEventListener'](_0xa56ed4(0xba),_0x3d5824),_0x3d5824(),_0xa05cf8&&(_0xa05cf8[_0xa56ed4(0xb9)]('input',()=>{requestAnimationFrame(_0x3d5824);}),_0xa05cf8[_0xa56ed4(0xb9)]('focus',()=>{setTimeout(()=>{const _0x249aa4=a0_0x1537;_0x1ea295[_0x249aa4(0xa5)]=_0x1ea295[_0x249aa4(0x82)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x263331(0xd3),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x263331(0xad)](a0_0x263331(0xc5)),emptyState=document[a0_0x263331(0xad)](a0_0x263331(0xc8)),messageInput=document['getElementById'](a0_0x263331(0xe9)),sendBtn=document[a0_0x263331(0xad)]('sendBtn'),clearBtn=document[a0_0x263331(0xad)]('clearBtn'),modal=document[a0_0x263331(0xad)](a0_0x263331(0x6f)),mTitle=document[a0_0x263331(0xad)](a0_0x263331(0x9e)),mText=document[a0_0x263331(0xad)](a0_0x263331(0xa2));function a0_0x2e92(){const _0xca6065=['now','typingIndicator','3368352PFUpjD','keydown','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','forEach','10368180bBeAeM','562010VbrScN','40uYhNeG','innerHeight','debug_uid','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','querySelector','constructor','(((.+)+)+)+$','json','message\x20','modalTitle','.container','stringify','setHeaderColor','modalText','8vZEnkO','inputArea','scrollTop','disableVerticalSwipes','4532132WiwwNc','clear_history','shiftKey','POST','display','target','getElementById','length','send_message','Ошибка\x20сети','replace','offsetHeight','textContent','contains','viewportHeight','TG\x20setup\x20error:','innerHTML','modalCancel','addEventListener','resize','style','parse','apply','timestamp','preventDefault','text/plain','children','flex','classList','message\x20ai','chatArea','role','show-delete','emptyState','Действие\x20необратимо.','5IrQiYL','add','offClick','getHours','touchend','light','2153851uIBeTR','div','className','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','isVersionAtLeast','signal','error','onClick','min','toString','onclick','splice','Очистить\x20историю?','createElement','push','initData','search','ready','abort','Начнется\x20новый\x20диалог.','Пустой\x20ответ','success','disabled','delete-btn','getItem','messageInput','value','getMinutes','confirmModal','HapticFeedback','function','trim','user','touchstart','9606640OinrOq','appendChild','modalConfirm','WebApp','viewportChanged','remove','./router.html','#050505','removeItem','stopPropagation','username','height','padStart','scrollHeight','key','setItem','show','ai_chat_messages','notificationOccurred','5644926JuepsG','content','impactOccurred','from','auto'];a0_0x2e92=function(){return _0xca6065;};return a0_0x2e92();}let modalCallback=null;async function callBackend(_0x2a2971,_0x36fe14){const _0x443ea1=a0_0x263331,_0xb192b0=tg?.['initDataUnsafe']?.[_0x443ea1(0x73)]||{},_0xf15683=_0xb192b0['id']||localStorage[_0x443ea1(0xe8)](_0x443ea1(0x97))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0xb192b0['id'])localStorage['setItem'](_0x443ea1(0x97),_0xf15683);const _0x13c5d9={'action':_0x2a2971,'user_id':_0xf15683,'user_data':{'first_name':_0xb192b0['first_name'],'username':_0xb192b0[_0x443ea1(0x7f)]},'init_data':tg?.[_0x443ea1(0xdf)]||'',..._0x36fe14},_0x41baa=new AbortController(),_0x2897e0=setTimeout(()=>_0x41baa[_0x443ea1(0xe2)](),REQUEST_TIMEOUT_MS);try{const _0x116a38=await fetch(BACKEND_URL,{'method':_0x443ea1(0xaa),'headers':{'Content-Type':_0x443ea1(0xc0)},'body':JSON[_0x443ea1(0xa0)](_0x13c5d9),'signal':_0x41baa[_0x443ea1(0xd5)]});return clearTimeout(_0x2897e0),await _0x116a38[_0x443ea1(0x9c)]();}catch(_0x4e34cd){return{'success':![],'error':String(_0x4e34cd)};}}function formatTime(_0x171fba){const _0x294815=a0_0x263331,_0x1a4568=new Date(_0x171fba);return String(_0x1a4568[_0x294815(0xcd)]())[_0x294815(0x81)](0x2,'0')+':'+String(_0x1a4568[_0x294815(0x6e)]())[_0x294815(0x81)](0x2,'0');}function createMessageElement(_0x38128c,_0x3f3946){const _0xa76274=a0_0x263331,_0xb1b95f=document[_0xa76274(0xdd)](_0xa76274(0xd1));_0xb1b95f[_0xa76274(0xd2)]=_0xa76274(0x9d)+_0x38128c[_0xa76274(0xc6)];const _0x302907=document[_0xa76274(0xdd)](_0xa76274(0xd1));_0x302907[_0xa76274(0xd2)]='message-bubble',_0x302907['innerHTML']=_0x38128c[_0xa76274(0x89)][_0xa76274(0xb1)](/\n/g,'<br>');const _0x4aedf8=document['createElement'](_0xa76274(0xd1));_0x4aedf8['className']=_0xa76274(0xe7),_0x4aedf8[_0xa76274(0xb7)]=_0xa76274(0x98),_0x4aedf8[_0xa76274(0xda)]=_0x73204a=>{const _0x509c33=_0xa76274;_0x73204a[_0x509c33(0x7e)](),confirmDelete(_0x3f3946);};let _0x5ee182;_0x302907[_0xa76274(0xb9)](_0xa76274(0x74),()=>_0x5ee182=setTimeout(()=>{const _0x3628c1=_0xa76274;_0xb1b95f['classList'][_0x3628c1(0xcb)](_0x3628c1(0xc7));if(tg?.[_0x3628c1(0x70)])tg[_0x3628c1(0x70)][_0x3628c1(0x8a)]('medium');},0x1f4)),_0x302907[_0xa76274(0xb9)](_0xa76274(0xce),()=>clearTimeout(_0x5ee182));const _0x154cb7=document[_0xa76274(0xdd)]('div');return _0x154cb7[_0xa76274(0xd2)]='message-time',_0x154cb7['textContent']=formatTime(_0x38128c[_0xa76274(0xbe)]),_0xb1b95f['appendChild'](_0x4aedf8),_0xb1b95f['appendChild'](_0x302907),_0xb1b95f['appendChild'](_0x154cb7),_0xb1b95f;}function createTypingIndicator(){const _0x326d76=a0_0x263331,_0x266d7e=document[_0x326d76(0xdd)](_0x326d76(0xd1));return _0x266d7e['className']=_0x326d76(0xc4),_0x266d7e['id']='typingIndicator',_0x266d7e[_0x326d76(0xb7)]=_0x326d76(0x91),_0x266d7e;}function a0_0x1537(_0x2acaa2,_0x382ada){_0x2acaa2=_0x2acaa2-0x6d;const _0xde3d37=a0_0x2e92();let _0x2eabf1=_0xde3d37[_0x2acaa2];return _0x2eabf1;}function renderMessages(){const _0x1005a6=a0_0x263331;Array[_0x1005a6(0x8b)](chatArea[_0x1005a6(0xc1)])[_0x1005a6(0x92)](_0x19daa8=>{const _0x12d27a=_0x1005a6;if(_0x19daa8['id']!==_0x12d27a(0xc8))_0x19daa8[_0x12d27a(0x7a)]();}),messages[_0x1005a6(0xae)]>0x0?(emptyState[_0x1005a6(0xbb)][_0x1005a6(0xab)]='none',messages['forEach']((_0x3b2c08,_0xb909ef)=>chatArea[_0x1005a6(0x76)](createMessageElement(_0x3b2c08,_0xb909ef)))):emptyState[_0x1005a6(0xbb)][_0x1005a6(0xab)]=_0x1005a6(0xc2),requestAnimationFrame(()=>chatArea[_0x1005a6(0xa5)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x361538=a0_0x263331;messageInput[_0x361538(0xbb)][_0x361538(0x80)]=_0x361538(0x8c),messageInput[_0x361538(0xbb)][_0x361538(0x80)]=Math[_0x361538(0xd8)](messageInput[_0x361538(0x82)],0x78)+'px';}function updateSendButton(){const _0x5814d9=a0_0x263331,_0x5557dc=messageInput[_0x5814d9(0x6d)][_0x5814d9(0x72)]();sendBtn[_0x5814d9(0xe6)]=!_0x5557dc||isTyping;}async function sendMessage(){const _0x30df9d=a0_0x263331,_0x3e5e05=messageInput[_0x30df9d(0x6d)]['trim']();if(!_0x3e5e05||isTyping)return;if(tg?.[_0x30df9d(0x70)])tg[_0x30df9d(0x70)]['impactOccurred'](_0x30df9d(0xcf));messages[_0x30df9d(0xde)]({'role':'user','content':_0x3e5e05,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x30df9d(0xa0)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x30df9d(0x76)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x4d789f=await callBackend(_0x30df9d(0xaf),{'message':_0x3e5e05});isTyping=![];const _0x25d593=document[_0x30df9d(0xad)](_0x30df9d(0x8e));if(_0x25d593)_0x25d593[_0x30df9d(0x7a)]();let _0x1d3c96=_0x30df9d(0xb0);if(_0x4d789f[_0x30df9d(0xe5)]){_0x1d3c96=_0x4d789f['text']||_0x30df9d(0xe4);if(tg?.[_0x30df9d(0x70)])tg[_0x30df9d(0x70)][_0x30df9d(0x87)](_0x30df9d(0xe5));}else{_0x1d3c96=_0x4d789f[_0x30df9d(0xd6)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg[_0x30df9d(0x70)][_0x30df9d(0x87)](_0x30df9d(0xd6));}messages[_0x30df9d(0xde)]({'role':'ai','content':_0x1d3c96,'timestamp':Date[_0x30df9d(0x8d)]()}),localStorage[_0x30df9d(0x84)](_0x30df9d(0x86),JSON[_0x30df9d(0xa0)](messages)),renderMessages();}function confirmDelete(_0x521903){const _0x3e0cf4=a0_0x263331;if(mTitle)mTitle[_0x3e0cf4(0xb3)]='Удалить?';if(mText)mText['textContent']=_0x3e0cf4(0xc9);modalCallback=()=>{const _0xc9b749=_0x3e0cf4;messages[_0xc9b749(0xdb)](_0x521903,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0xc9b749(0xa0)](messages)),renderMessages();},modal['classList'][_0x3e0cf4(0xcb)]('show');}if(clearBtn)clearBtn[a0_0x263331(0xda)]=()=>{const _0x12371b=a0_0x263331;if(!messages[_0x12371b(0xae)])return;if(mTitle)mTitle[_0x12371b(0xb3)]=_0x12371b(0xdc);if(mText)mText[_0x12371b(0xb3)]=_0x12371b(0xe3);modalCallback=async()=>{const _0x1ac9ac=_0x12371b;messages=[],localStorage[_0x1ac9ac(0x7d)](_0x1ac9ac(0x86)),renderMessages(),callBackend(_0x1ac9ac(0xa8),{});},modal[_0x12371b(0xc3)]['add'](_0x12371b(0x85));};document['getElementById'](a0_0x263331(0xb8))[a0_0x263331(0xda)]=()=>modal['classList'][a0_0x263331(0x7a)](a0_0x263331(0x85)),document[a0_0x263331(0xad)](a0_0x263331(0x77))[a0_0x263331(0xda)]=()=>{const _0x190636=a0_0x263331;if(modalCallback)modalCallback();modal[_0x190636(0xc3)][_0x190636(0x7a)]('show');},messageInput[a0_0x263331(0xb9)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x263331(0xb9)](a0_0x263331(0x90),_0x56b4c0=>{const _0x47cbdd=a0_0x263331;_0x56b4c0[_0x47cbdd(0x83)]==='Enter'&&!_0x56b4c0[_0x47cbdd(0xa9)]&&(_0x56b4c0[_0x47cbdd(0xbf)](),sendMessage());}),sendBtn[a0_0x263331(0xda)]=sendMessage,document[a0_0x263331(0xb9)]('click',_0x2dcc6b=>{document['querySelectorAll']('.message.show-delete')['forEach'](_0x1f73f3=>{const _0x5c826d=a0_0x1537;if(!_0x1f73f3[_0x5c826d(0xb4)](_0x2dcc6b[_0x5c826d(0xac)]))_0x1f73f3[_0x5c826d(0xc3)][_0x5c826d(0x7a)]('show-delete');});});const saved=localStorage[a0_0x263331(0xe8)](a0_0x263331(0x86));if(saved)try{messages=JSON[a0_0x263331(0xbc)](saved),renderMessages();}catch(a0_0x71f521){}updateSendButton();