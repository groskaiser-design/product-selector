const a0_0x3aac3a=a0_0x4e55;(function(_0x5a809f,_0x284c6e){const _0xca524a=a0_0x4e55,_0x42842b=_0x5a809f();while(!![]){try{const _0x4fe082=-parseInt(_0xca524a(0x135))/0x1+parseInt(_0xca524a(0xe3))/0x2+-parseInt(_0xca524a(0x125))/0x3+parseInt(_0xca524a(0xe0))/0x4*(parseInt(_0xca524a(0x131))/0x5)+parseInt(_0xca524a(0xe5))/0x6*(-parseInt(_0xca524a(0xe8))/0x7)+-parseInt(_0xca524a(0x12b))/0x8+parseInt(_0xca524a(0x10c))/0x9;if(_0x4fe082===_0x284c6e)break;else _0x42842b['push'](_0x42842b['shift']());}catch(_0x308e96){_0x42842b['push'](_0x42842b['shift']());}}}(a0_0x506c,0xd86ff));const tg=window['Telegram']?.[a0_0x3aac3a(0xd8)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x3cdb9d=a0_0x3aac3a;if(!tg)return;try{tg['ready'](),tg[_0x3cdb9d(0xeb)](),tg[_0x3cdb9d(0x156)]?.('#050505');if(tg['isVersionAtLeast']?.(_0x3cdb9d(0xfd)))tg[_0x3cdb9d(0x12a)]?.();const _0xf4fb0a=tg[_0x3cdb9d(0x13e)];if(_0xf4fb0a){_0xf4fb0a[_0x3cdb9d(0x129)]();if(typeof _0xf4fb0a[_0x3cdb9d(0x146)]===_0x3cdb9d(0x11a))try{_0xf4fb0a['offClick']();}catch(_0x245453){}_0xf4fb0a[_0x3cdb9d(0x126)](()=>{const _0x2639d1=_0x3cdb9d;if(tg[_0x2639d1(0x154)])tg[_0x2639d1(0x154)][_0x2639d1(0xfe)](_0x2639d1(0xf3));location[_0x2639d1(0x13a)]=HOME_URL;});}}catch(_0x33c920){console[_0x3cdb9d(0xf6)](_0x3cdb9d(0x117),_0x33c920);}}(function initStableLayout(){const _0x599b68=a0_0x3aac3a,_0x13b9cb=(function(){let _0x546e40=!![];return function(_0x458e5f,_0x5be0fe){const _0x1492ee=_0x546e40?function(){if(_0x5be0fe){const _0x5ea500=_0x5be0fe['apply'](_0x458e5f,arguments);return _0x5be0fe=null,_0x5ea500;}}:function(){};return _0x546e40=![],_0x1492ee;};}()),_0x3eb118=document[_0x599b68(0x107)](_0x599b68(0x14b)),_0x77a863=document['getElementById'](_0x599b68(0x10a)),_0x22af22=document[_0x599b68(0xe7)](_0x599b68(0x128)),_0xe890ae=document['getElementById'](_0x599b68(0xe9));function _0x5700b7(){const _0x1d8e18=_0x599b68,_0x447bf1=_0x13b9cb(this,function(){const _0x5d9cc7=a0_0x4e55;return _0x447bf1[_0x5d9cc7(0xd5)]()[_0x5d9cc7(0x115)](_0x5d9cc7(0xdb))[_0x5d9cc7(0xd5)]()[_0x5d9cc7(0x14c)](_0x447bf1)[_0x5d9cc7(0x115)](_0x5d9cc7(0xdb));});_0x447bf1();if(!_0x3eb118)return;const _0x35e865=tg&&tg[_0x1d8e18(0xea)]?tg[_0x1d8e18(0xea)]:window[_0x1d8e18(0x108)];_0x3eb118[_0x1d8e18(0xd4)][_0x1d8e18(0xe4)]=_0x35e865+'px';if(_0x77a863){const _0x4d117e=_0x77a863[_0x1d8e18(0x137)];_0x22af22[_0x1d8e18(0xd4)][_0x1d8e18(0x105)]=_0x4d117e+0x28+'px';}}tg?tg['onEvent'](_0x599b68(0xfa),({isStateStable:_0x1a5caf})=>{_0x5700b7();if(_0x1a5caf)requestAnimationFrame(()=>{const _0x3b80e5=a0_0x4e55;_0x22af22[_0x3b80e5(0x127)]=_0x22af22[_0x3b80e5(0x102)];});}):window[_0x599b68(0x14d)](_0x599b68(0x116),_0x5700b7),_0x5700b7(),_0xe890ae&&(_0xe890ae[_0x599b68(0x14d)](_0x599b68(0x141),()=>{requestAnimationFrame(_0x5700b7);}),_0xe890ae[_0x599b68(0x14d)](_0x599b68(0x13d),()=>{setTimeout(()=>{const _0x21e5bd=a0_0x4e55;_0x22af22[_0x21e5bd(0x127)]=_0x22af22['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x506c(){const _0x1cc8d7=['typingIndicator','createElement','message\x20ai','Удалить?','children','modalTitle','2717667rWjxtx','onClick','scrollTop','chatArea','show','disableVerticalSwipes','1748608ZDjJPk','json','Очистить\x20историю?','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','preventDefault','disabled','66190PZuwCX','display','message-time','target','1696633XZTZYY','Ошибка\x20сети','offsetHeight','remove','show-delete','href','emptyState','push','focus','BackButton','first_name','auto','input','Действие\x20необратимо.','message\x20','querySelectorAll','onclick','offClick','div','setItem','sendBtn','message-bubble','.container','constructor','addEventListener','removeItem','success','initData','replace','medium','parse','HapticFeedback','touchend','setHeaderColor','user','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','style','toString','.message.show-delete','floor','WebApp','textContent','<br>','(((.+)+)+)+$','abort','clear_history','now','click','484llXxrl','stringify','from','1943660FiXLRC','height','6NpyhgP','innerHTML','getElementById','1133594WqcUoZ','messageInput','viewportHeight','expand','forEach','signal','keydown','POST','modalConfirm','length','content','light','stopPropagation','notificationOccurred','warn','classList','text/plain','padStart','viewportChanged','getItem','Пустой\x20ответ','6.1','impactOccurred','splice','debug_uid','role','scrollHeight','trim','none','paddingBottom','touchstart','querySelector','innerHeight','min','inputArea','Enter','11663451yukVSE','add','ai_chat_messages','send_message','contains','username','getHours','error','appendChild','search','resize','TG\x20setup\x20error:','value','clearBtn','function','modalText','modalCancel','random','className'];a0_0x506c=function(){return _0x1cc8d7;};return a0_0x506c();}const chatArea=document[a0_0x3aac3a(0xe7)](a0_0x3aac3a(0x128)),emptyState=document[a0_0x3aac3a(0xe7)]('emptyState'),messageInput=document[a0_0x3aac3a(0xe7)](a0_0x3aac3a(0xe9)),sendBtn=document[a0_0x3aac3a(0xe7)](a0_0x3aac3a(0x149)),clearBtn=document[a0_0x3aac3a(0xe7)](a0_0x3aac3a(0x119)),modal=document[a0_0x3aac3a(0xe7)]('confirmModal'),mTitle=document[a0_0x3aac3a(0xe7)](a0_0x3aac3a(0x124)),mText=document[a0_0x3aac3a(0xe7)](a0_0x3aac3a(0x11b));let modalCallback=null;async function callBackend(_0x331ed8,_0x3e7d52){const _0x19990c=a0_0x3aac3a,_0x1de6ab=tg?.['initDataUnsafe']?.[_0x19990c(0x157)]||{},_0xe6303d=_0x1de6ab['id']||localStorage[_0x19990c(0xfb)]('debug_uid')||'d-'+Math[_0x19990c(0xd7)](Math[_0x19990c(0x11d)]()*0x3b9aca00);if(!_0x1de6ab['id'])localStorage[_0x19990c(0x148)](_0x19990c(0x100),_0xe6303d);const _0x35282b={'action':_0x331ed8,'user_id':_0xe6303d,'user_data':{'first_name':_0x1de6ab[_0x19990c(0x13f)],'username':_0x1de6ab[_0x19990c(0x111)]},'init_data':tg?.[_0x19990c(0x150)]||'',..._0x3e7d52},_0x1273e9=new AbortController(),_0x2883bf=setTimeout(()=>_0x1273e9[_0x19990c(0xdc)](),REQUEST_TIMEOUT_MS);try{const _0x1b92a1=await fetch(BACKEND_URL,{'method':_0x19990c(0xef),'headers':{'Content-Type':_0x19990c(0xf8)},'body':JSON[_0x19990c(0xe1)](_0x35282b),'signal':_0x1273e9[_0x19990c(0xed)]});return clearTimeout(_0x2883bf),await _0x1b92a1[_0x19990c(0x12c)]();}catch(_0x19ba30){return{'success':![],'error':String(_0x19ba30)};}}function formatTime(_0x5610a7){const _0x10d7b8=a0_0x3aac3a,_0x44d4dd=new Date(_0x5610a7);return String(_0x44d4dd[_0x10d7b8(0x112)]())['padStart'](0x2,'0')+':'+String(_0x44d4dd['getMinutes']())[_0x10d7b8(0xf9)](0x2,'0');}function createMessageElement(_0x24d856,_0x91eb43){const _0x22b413=a0_0x3aac3a,_0x27d427=document[_0x22b413(0x120)]('div');_0x27d427[_0x22b413(0x11e)]=_0x22b413(0x143)+_0x24d856[_0x22b413(0x101)];const _0x99366=document[_0x22b413(0x120)](_0x22b413(0x147));_0x99366['className']=_0x22b413(0x14a),_0x99366['innerHTML']=_0x24d856[_0x22b413(0xf2)][_0x22b413(0x151)](/\n/g,_0x22b413(0xda));const _0x8ce09e=document[_0x22b413(0x120)](_0x22b413(0x147));_0x8ce09e[_0x22b413(0x11e)]='delete-btn',_0x8ce09e['innerHTML']=_0x22b413(0x12e),_0x8ce09e[_0x22b413(0x145)]=_0x3f2768=>{const _0x43ffde=_0x22b413;_0x3f2768[_0x43ffde(0xf4)](),confirmDelete(_0x91eb43);};let _0x428c43;_0x99366[_0x22b413(0x14d)](_0x22b413(0x106),()=>_0x428c43=setTimeout(()=>{const _0x3bdb01=_0x22b413;_0x27d427[_0x3bdb01(0xf7)][_0x3bdb01(0x10d)](_0x3bdb01(0x139));if(tg?.['HapticFeedback'])tg['HapticFeedback']['impactOccurred'](_0x3bdb01(0x152));},0x1f4)),_0x99366[_0x22b413(0x14d)](_0x22b413(0x155),()=>clearTimeout(_0x428c43));const _0x33f11f=document[_0x22b413(0x120)](_0x22b413(0x147));return _0x33f11f[_0x22b413(0x11e)]=_0x22b413(0x133),_0x33f11f[_0x22b413(0xd9)]=formatTime(_0x24d856['timestamp']),_0x27d427[_0x22b413(0x114)](_0x8ce09e),_0x27d427[_0x22b413(0x114)](_0x99366),_0x27d427[_0x22b413(0x114)](_0x33f11f),_0x27d427;}function a0_0x4e55(_0x2ab394,_0x3e9677){_0x2ab394=_0x2ab394-0xd3;const _0xe8a5fa=a0_0x506c();let _0x72c2ee=_0xe8a5fa[_0x2ab394];return _0x72c2ee;}function createTypingIndicator(){const _0x169839=a0_0x3aac3a,_0xcb7a6b=document[_0x169839(0x120)](_0x169839(0x147));return _0xcb7a6b['className']=_0x169839(0x121),_0xcb7a6b['id']=_0x169839(0x11f),_0xcb7a6b[_0x169839(0xe6)]=_0x169839(0xd3),_0xcb7a6b;}function renderMessages(){const _0x43df16=a0_0x3aac3a;Array[_0x43df16(0xe2)](chatArea[_0x43df16(0x123)])[_0x43df16(0xec)](_0x14138d=>{const _0x338716=_0x43df16;if(_0x14138d['id']!==_0x338716(0x13b))_0x14138d['remove']();}),messages['length']>0x0?(emptyState['style'][_0x43df16(0x132)]=_0x43df16(0x104),messages[_0x43df16(0xec)]((_0x39e45c,_0x2aed28)=>chatArea[_0x43df16(0x114)](createMessageElement(_0x39e45c,_0x2aed28)))):emptyState['style'][_0x43df16(0x132)]='flex',requestAnimationFrame(()=>chatArea[_0x43df16(0x127)]=chatArea[_0x43df16(0x102)]);}function autoResizeTextarea(){const _0x13f19a=a0_0x3aac3a;messageInput[_0x13f19a(0xd4)][_0x13f19a(0xe4)]=_0x13f19a(0x140),messageInput['style'][_0x13f19a(0xe4)]=Math[_0x13f19a(0x109)](messageInput[_0x13f19a(0x102)],0x78)+'px';}function updateSendButton(){const _0x27a3b8=a0_0x3aac3a,_0x1f372c=messageInput['value'][_0x27a3b8(0x103)]();sendBtn[_0x27a3b8(0x130)]=!_0x1f372c||isTyping;}async function sendMessage(){const _0xbfa5c0=a0_0x3aac3a,_0x21a5f9=messageInput[_0xbfa5c0(0x118)][_0xbfa5c0(0x103)]();if(!_0x21a5f9||isTyping)return;if(tg?.[_0xbfa5c0(0x154)])tg['HapticFeedback'][_0xbfa5c0(0xfe)](_0xbfa5c0(0xf3));messages[_0xbfa5c0(0x13c)]({'role':_0xbfa5c0(0x157),'content':_0x21a5f9,'timestamp':Date[_0xbfa5c0(0xde)]()}),localStorage['setItem']('ai_chat_messages',JSON[_0xbfa5c0(0xe1)](messages)),renderMessages(),messageInput[_0xbfa5c0(0x118)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0xa0ab20=await callBackend(_0xbfa5c0(0x10f),{'message':_0x21a5f9});isTyping=![];const _0x339d1b=document[_0xbfa5c0(0xe7)](_0xbfa5c0(0x11f));if(_0x339d1b)_0x339d1b[_0xbfa5c0(0x138)]();let _0x4f4bc6=_0xbfa5c0(0x136);if(_0xa0ab20[_0xbfa5c0(0x14f)]){_0x4f4bc6=_0xa0ab20['text']||_0xbfa5c0(0xfc);if(tg?.[_0xbfa5c0(0x154)])tg['HapticFeedback'][_0xbfa5c0(0xf5)]('success');}else{_0x4f4bc6=_0xa0ab20[_0xbfa5c0(0x113)]||'Ошибка\x20сервера';if(tg?.['HapticFeedback'])tg[_0xbfa5c0(0x154)]['notificationOccurred'](_0xbfa5c0(0x113));}messages[_0xbfa5c0(0x13c)]({'role':'ai','content':_0x4f4bc6,'timestamp':Date['now']()}),localStorage[_0xbfa5c0(0x148)](_0xbfa5c0(0x10e),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x347e62){const _0x2808a4=a0_0x3aac3a;if(mTitle)mTitle['textContent']=_0x2808a4(0x122);if(mText)mText[_0x2808a4(0xd9)]=_0x2808a4(0x142);modalCallback=()=>{const _0x55c4d9=_0x2808a4;messages[_0x55c4d9(0xff)](_0x347e62,0x1),localStorage[_0x55c4d9(0x148)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x2808a4(0xf7)]['add'](_0x2808a4(0x129));}if(clearBtn)clearBtn[a0_0x3aac3a(0x145)]=()=>{const _0x1820c1=a0_0x3aac3a;if(!messages[_0x1820c1(0xf1)])return;if(mTitle)mTitle[_0x1820c1(0xd9)]=_0x1820c1(0x12d);if(mText)mText[_0x1820c1(0xd9)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x264113=_0x1820c1;messages=[],localStorage[_0x264113(0x14e)]('ai_chat_messages'),renderMessages(),callBackend(_0x264113(0xdd),{});},modal['classList']['add']('show');};document[a0_0x3aac3a(0xe7)](a0_0x3aac3a(0x11c))['onclick']=()=>modal[a0_0x3aac3a(0xf7)][a0_0x3aac3a(0x138)](a0_0x3aac3a(0x129)),document[a0_0x3aac3a(0xe7)](a0_0x3aac3a(0xf0))[a0_0x3aac3a(0x145)]=()=>{const _0x300a4d=a0_0x3aac3a;if(modalCallback)modalCallback();modal[_0x300a4d(0xf7)]['remove'](_0x300a4d(0x129));},messageInput[a0_0x3aac3a(0x14d)](a0_0x3aac3a(0x141),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x3aac3a(0xee),_0x146878=>{const _0x275b47=a0_0x3aac3a;_0x146878['key']===_0x275b47(0x10b)&&!_0x146878['shiftKey']&&(_0x146878[_0x275b47(0x12f)](),sendMessage());}),sendBtn[a0_0x3aac3a(0x145)]=sendMessage,document[a0_0x3aac3a(0x14d)](a0_0x3aac3a(0xdf),_0x1cefe9=>{const _0x4bc0de=a0_0x3aac3a;document[_0x4bc0de(0x144)](_0x4bc0de(0xd6))[_0x4bc0de(0xec)](_0x2fabae=>{const _0x4fcac0=_0x4bc0de;if(!_0x2fabae[_0x4fcac0(0x110)](_0x1cefe9[_0x4fcac0(0x134)]))_0x2fabae[_0x4fcac0(0xf7)]['remove'](_0x4fcac0(0x139));});});const saved=localStorage['getItem'](a0_0x3aac3a(0x10e));if(saved)try{messages=JSON[a0_0x3aac3a(0x153)](saved),renderMessages();}catch(a0_0x31f9eb){}updateSendButton();