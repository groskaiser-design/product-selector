const a0_0x187082=a0_0x2c23;(function(_0x42bc75,_0x3ee020){const _0x2a7709=a0_0x2c23,_0xd753bb=_0x42bc75();while(!![]){try{const _0x4e17f7=parseInt(_0x2a7709(0x1ef))/0x1+-parseInt(_0x2a7709(0x212))/0x2+-parseInt(_0x2a7709(0x1f6))/0x3+parseInt(_0x2a7709(0x228))/0x4+-parseInt(_0x2a7709(0x1c1))/0x5*(-parseInt(_0x2a7709(0x1c7))/0x6)+parseInt(_0x2a7709(0x1da))/0x7+-parseInt(_0x2a7709(0x1cf))/0x8*(parseInt(_0x2a7709(0x1e3))/0x9);if(_0x4e17f7===_0x3ee020)break;else _0xd753bb['push'](_0xd753bb['shift']());}catch(_0x553c9a){_0xd753bb['push'](_0xd753bb['shift']());}}}(a0_0x2686,0x9e69e));const tg=window[a0_0x187082(0x209)]?.[a0_0x187082(0x1d0)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x2e88a1=a0_0x187082;if(!tg)return;try{tg[_0x2e88a1(0x1db)](),tg['expand'](),tg['setHeaderColor']?.(_0x2e88a1(0x1f2));if(tg[_0x2e88a1(0x1eb)]?.(_0x2e88a1(0x1d4)))tg[_0x2e88a1(0x20d)]?.();const _0x56a71c=tg[_0x2e88a1(0x21b)];if(_0x56a71c){_0x56a71c['show']();if(typeof _0x56a71c['offClick']===_0x2e88a1(0x1bc))try{_0x56a71c[_0x2e88a1(0x21a)]();}catch(_0x6e7298){}_0x56a71c[_0x2e88a1(0x23a)](()=>{const _0x3c1a79=_0x2e88a1;if(tg[_0x3c1a79(0x1ea)])tg[_0x3c1a79(0x1ea)]['impactOccurred'](_0x3c1a79(0x22f));location[_0x3c1a79(0x1dd)]=HOME_URL;});}}catch(_0x46834a){console[_0x2e88a1(0x232)](_0x2e88a1(0x217),_0x46834a);}}(function initStableLayout(){const _0x595cef=a0_0x187082,_0x345596=(function(){let _0x2f6591=!![];return function(_0x21e896,_0x5d3053){const _0x5376fd=_0x2f6591?function(){const _0x569089=a0_0x2c23;if(_0x5d3053){const _0x118922=_0x5d3053[_0x569089(0x20b)](_0x21e896,arguments);return _0x5d3053=null,_0x118922;}}:function(){};return _0x2f6591=![],_0x5376fd;};}()),_0x1689f7=document[_0x595cef(0x1bd)](_0x595cef(0x1c8)),_0x6dc507=document[_0x595cef(0x216)](_0x595cef(0x23b)),_0x5d03a9=document[_0x595cef(0x216)](_0x595cef(0x215)),_0x3b8d6e=document[_0x595cef(0x216)](_0x595cef(0x1e9));function _0x39b9e8(){const _0x3c95a4=_0x595cef,_0x4b8e56=_0x345596(this,function(){const _0x2f7e35=a0_0x2c23;return _0x4b8e56['toString']()[_0x2f7e35(0x1c5)](_0x2f7e35(0x205))[_0x2f7e35(0x219)]()[_0x2f7e35(0x21d)](_0x4b8e56)[_0x2f7e35(0x1c5)](_0x2f7e35(0x205));});_0x4b8e56();if(!_0x1689f7)return;const _0x8593a8=tg&&tg['viewportHeight']?tg[_0x3c95a4(0x1e7)]:window['innerHeight'];_0x1689f7[_0x3c95a4(0x23c)][_0x3c95a4(0x206)]=_0x8593a8+'px';if(_0x6dc507){const _0x5219ab=_0x6dc507['offsetHeight'];_0x5d03a9['style'][_0x3c95a4(0x237)]=_0x5219ab+0x28+'px';}}tg?tg[_0x595cef(0x203)](_0x595cef(0x202),({isStateStable:_0x5b8c84})=>{_0x39b9e8();if(_0x5b8c84)requestAnimationFrame(()=>{const _0x57e3df=a0_0x2c23;_0x5d03a9[_0x57e3df(0x1cd)]=_0x5d03a9[_0x57e3df(0x1c3)];});}):window[_0x595cef(0x227)](_0x595cef(0x1cc),_0x39b9e8),_0x39b9e8(),_0x3b8d6e&&(_0x3b8d6e[_0x595cef(0x227)]('input',()=>{requestAnimationFrame(_0x39b9e8);}),_0x3b8d6e[_0x595cef(0x227)](_0x595cef(0x1d9),()=>{setTimeout(()=>{const _0x1de1eb=a0_0x2c23;_0x5d03a9[_0x1de1eb(0x1cd)]=_0x5d03a9[_0x1de1eb(0x1c3)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x187082(0x215)),emptyState=document['getElementById'](a0_0x187082(0x1df)),messageInput=document[a0_0x187082(0x216)](a0_0x187082(0x1e9)),sendBtn=document[a0_0x187082(0x216)](a0_0x187082(0x20c)),clearBtn=document[a0_0x187082(0x216)](a0_0x187082(0x1c4)),modal=document[a0_0x187082(0x216)](a0_0x187082(0x1f9)),mTitle=document[a0_0x187082(0x216)](a0_0x187082(0x229)),mText=document[a0_0x187082(0x216)]('modalText');let modalCallback=null;async function callBackend(_0x3db0cc,_0x403b9e){const _0x4ca0a6=a0_0x187082,_0x2ddd3e=tg?.[_0x4ca0a6(0x235)]?.['user']||{},_0x534dd0=_0x2ddd3e['id']||localStorage['getItem'](_0x4ca0a6(0x1ed))||'d-'+Math[_0x4ca0a6(0x1bb)](Math[_0x4ca0a6(0x1ec)]()*0x3b9aca00);if(!_0x2ddd3e['id'])localStorage[_0x4ca0a6(0x207)](_0x4ca0a6(0x1ed),_0x534dd0);const _0x2b951a={'action':_0x3db0cc,'user_id':_0x534dd0,'user_data':{'first_name':_0x2ddd3e[_0x4ca0a6(0x213)],'username':_0x2ddd3e[_0x4ca0a6(0x22b)]},'init_data':tg?.[_0x4ca0a6(0x1de)]||'',..._0x403b9e},_0x1af53a=new AbortController(),_0x75517c=setTimeout(()=>_0x1af53a[_0x4ca0a6(0x1e6)](),REQUEST_TIMEOUT_MS);try{const _0x1ae2ec=await fetch(BACKEND_URL,{'method':_0x4ca0a6(0x1ba),'headers':{'Content-Type':_0x4ca0a6(0x1ca)},'body':JSON['stringify'](_0x2b951a),'signal':_0x1af53a[_0x4ca0a6(0x1e4)]});return clearTimeout(_0x75517c),await _0x1ae2ec[_0x4ca0a6(0x210)]();}catch(_0x2ec26d){return{'success':![],'error':String(_0x2ec26d)};}}function formatTime(_0x209bcb){const _0x352995=a0_0x187082,_0x19e5db=new Date(_0x209bcb);return String(_0x19e5db[_0x352995(0x22a)]())[_0x352995(0x233)](0x2,'0')+':'+String(_0x19e5db[_0x352995(0x1be)]())[_0x352995(0x233)](0x2,'0');}function a0_0x2c23(_0x5251eb,_0x1fdae7){_0x5251eb=_0x5251eb-0x1ba;const _0xadb1bd=a0_0x2686();let _0x11ec96=_0xadb1bd[_0x5251eb];return _0x11ec96;}function createMessageElement(_0x4c8385,_0xff4715){const _0x6469ff=a0_0x187082,_0x2f24fa=document[_0x6469ff(0x1e0)](_0x6469ff(0x238));_0x2f24fa[_0x6469ff(0x22e)]='message\x20'+_0x4c8385[_0x6469ff(0x1f1)];const _0x1881a8=document[_0x6469ff(0x1e0)](_0x6469ff(0x238));_0x1881a8[_0x6469ff(0x22e)]=_0x6469ff(0x236),_0x1881a8['innerHTML']=_0x4c8385[_0x6469ff(0x1d5)][_0x6469ff(0x1e8)](/\n/g,'<br>');const _0x2b8230=document[_0x6469ff(0x1e0)](_0x6469ff(0x238));_0x2b8230[_0x6469ff(0x22e)]='delete-btn',_0x2b8230[_0x6469ff(0x225)]=_0x6469ff(0x1ce),_0x2b8230['onclick']=_0xf8a006=>{_0xf8a006['stopPropagation'](),confirmDelete(_0xff4715);};let _0x4a93d2;_0x1881a8[_0x6469ff(0x227)](_0x6469ff(0x1fb),()=>_0x4a93d2=setTimeout(()=>{const _0x4a9eb5=_0x6469ff;_0x2f24fa[_0x4a9eb5(0x1dc)][_0x4a9eb5(0x1fd)](_0x4a9eb5(0x218));if(tg?.[_0x4a9eb5(0x1ea)])tg[_0x4a9eb5(0x1ea)][_0x4a9eb5(0x1fa)](_0x4a9eb5(0x1c9));},0x1f4)),_0x1881a8[_0x6469ff(0x227)]('touchend',()=>clearTimeout(_0x4a93d2));const _0x3b8f4d=document[_0x6469ff(0x1e0)](_0x6469ff(0x238));return _0x3b8f4d[_0x6469ff(0x22e)]=_0x6469ff(0x201),_0x3b8f4d[_0x6469ff(0x231)]=formatTime(_0x4c8385[_0x6469ff(0x1f3)]),_0x2f24fa[_0x6469ff(0x208)](_0x2b8230),_0x2f24fa['appendChild'](_0x1881a8),_0x2f24fa[_0x6469ff(0x208)](_0x3b8f4d),_0x2f24fa;}function createTypingIndicator(){const _0x4ba3f1=a0_0x187082,_0x5b4684=document[_0x4ba3f1(0x1e0)](_0x4ba3f1(0x238));return _0x5b4684[_0x4ba3f1(0x22e)]='message\x20ai',_0x5b4684['id']='typingIndicator',_0x5b4684['innerHTML']=_0x4ba3f1(0x22d),_0x5b4684;}function renderMessages(){const _0x3df148=a0_0x187082;Array[_0x3df148(0x1d3)](chatArea[_0x3df148(0x1ff)])[_0x3df148(0x1fc)](_0x3ec059=>{const _0x18c341=_0x3df148;if(_0x3ec059['id']!==_0x18c341(0x1df))_0x3ec059[_0x18c341(0x204)]();}),messages[_0x3df148(0x220)]>0x0?(emptyState[_0x3df148(0x23c)]['display']=_0x3df148(0x1f7),messages[_0x3df148(0x1fc)]((_0x10f34d,_0x26315a)=>chatArea[_0x3df148(0x208)](createMessageElement(_0x10f34d,_0x26315a)))):emptyState[_0x3df148(0x23c)][_0x3df148(0x224)]=_0x3df148(0x21c),requestAnimationFrame(()=>chatArea[_0x3df148(0x1cd)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x20ae6e=a0_0x187082;messageInput[_0x20ae6e(0x23c)][_0x20ae6e(0x206)]=_0x20ae6e(0x1e1),messageInput[_0x20ae6e(0x23c)][_0x20ae6e(0x206)]=Math[_0x20ae6e(0x21f)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x443d78=a0_0x187082,_0x30ec16=messageInput[_0x443d78(0x200)][_0x443d78(0x230)]();sendBtn[_0x443d78(0x1f8)]=!_0x30ec16||isTyping;}async function sendMessage(){const _0x1d062c=a0_0x187082,_0x19e686=messageInput[_0x1d062c(0x200)][_0x1d062c(0x230)]();if(!_0x19e686||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x1d062c(0x1ea)]['impactOccurred'](_0x1d062c(0x22f));messages[_0x1d062c(0x22c)]({'role':_0x1d062c(0x214),'content':_0x19e686,'timestamp':Date[_0x1d062c(0x222)]()}),localStorage[_0x1d062c(0x207)](_0x1d062c(0x21e),JSON[_0x1d062c(0x1c2)](messages)),renderMessages(),messageInput[_0x1d062c(0x200)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x1d062c(0x208)](createTypingIndicator()),chatArea[_0x1d062c(0x1cd)]=chatArea[_0x1d062c(0x1c3)];const _0x2c7943=await callBackend(_0x1d062c(0x1f0),{'message':_0x19e686});isTyping=![];const _0x11056c=document[_0x1d062c(0x216)]('typingIndicator');if(_0x11056c)_0x11056c[_0x1d062c(0x204)]();let _0x17ae29='Ошибка\x20сети';if(_0x2c7943['success']){_0x17ae29=_0x2c7943[_0x1d062c(0x1e2)]||_0x1d062c(0x20e);if(tg?.['HapticFeedback'])tg[_0x1d062c(0x1ea)][_0x1d062c(0x239)](_0x1d062c(0x234));}else{_0x17ae29=_0x2c7943[_0x1d062c(0x221)]||_0x1d062c(0x1ee);if(tg?.[_0x1d062c(0x1ea)])tg[_0x1d062c(0x1ea)][_0x1d062c(0x239)](_0x1d062c(0x221));}messages[_0x1d062c(0x22c)]({'role':'ai','content':_0x17ae29,'timestamp':Date[_0x1d062c(0x222)]()}),localStorage[_0x1d062c(0x207)](_0x1d062c(0x21e),JSON[_0x1d062c(0x1c2)](messages)),renderMessages();}function confirmDelete(_0x3ec13e){const _0x2382ac=a0_0x187082;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText['textContent']=_0x2382ac(0x1d2);modalCallback=()=>{const _0x532c7a=_0x2382ac;messages[_0x532c7a(0x20a)](_0x3ec13e,0x1),localStorage['setItem'](_0x532c7a(0x21e),JSON[_0x532c7a(0x1c2)](messages)),renderMessages();},modal[_0x2382ac(0x1dc)][_0x2382ac(0x1fd)](_0x2382ac(0x1f4));}if(clearBtn)clearBtn[a0_0x187082(0x1cb)]=()=>{const _0x4b2a77=a0_0x187082;if(!messages[_0x4b2a77(0x220)])return;if(mTitle)mTitle[_0x4b2a77(0x231)]=_0x4b2a77(0x226);if(mText)mText[_0x4b2a77(0x231)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x5788e5=_0x4b2a77;messages=[],localStorage[_0x5788e5(0x1c6)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x4b2a77(0x1dc)][_0x4b2a77(0x1fd)](_0x4b2a77(0x1f4));};document[a0_0x187082(0x216)](a0_0x187082(0x1d8))[a0_0x187082(0x1cb)]=()=>modal[a0_0x187082(0x1dc)]['remove'](a0_0x187082(0x1f4)),document[a0_0x187082(0x216)](a0_0x187082(0x1e5))[a0_0x187082(0x1cb)]=()=>{const _0x3d1db0=a0_0x187082;if(modalCallback)modalCallback();modal[_0x3d1db0(0x1dc)][_0x3d1db0(0x204)](_0x3d1db0(0x1f4));},messageInput[a0_0x187082(0x227)](a0_0x187082(0x20f),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x187082(0x1c0),_0xb10819=>{const _0x5c46e0=a0_0x187082;_0xb10819[_0x5c46e0(0x1fe)]===_0x5c46e0(0x1d1)&&!_0xb10819['shiftKey']&&(_0xb10819[_0x5c46e0(0x1f5)](),sendMessage());}),sendBtn[a0_0x187082(0x1cb)]=sendMessage,document[a0_0x187082(0x227)]('click',_0x1f06b4=>{const _0xdbd233=a0_0x187082;document['querySelectorAll'](_0xdbd233(0x223))[_0xdbd233(0x1fc)](_0x5749fa=>{const _0x48c93a=_0xdbd233;if(!_0x5749fa[_0x48c93a(0x1d7)](_0x1f06b4[_0x48c93a(0x211)]))_0x5749fa['classList']['remove'](_0x48c93a(0x218));});});const saved=localStorage[a0_0x187082(0x1d6)](a0_0x187082(0x21e));function a0_0x2686(){const _0xc5aad9=['toString','offClick','BackButton','flex','constructor','ai_chat_messages','min','length','error','now','.message.show-delete','display','innerHTML','Очистить\x20историю?','addEventListener','5046332zSJdPw','modalTitle','getHours','username','push','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','className','light','trim','textContent','warn','padStart','success','initDataUnsafe','message-bubble','paddingBottom','div','notificationOccurred','onClick','inputArea','style','POST','floor','function','querySelector','getMinutes','parse','keydown','700670eKjioK','stringify','scrollHeight','clearBtn','search','removeItem','6XVNeDx','.container','medium','text/plain','onclick','resize','scrollTop','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','88xPnMNG','WebApp','Enter','Действие\x20необратимо.','from','6.1','content','getItem','contains','modalCancel','focus','2657130Gkonka','ready','classList','href','initData','emptyState','createElement','auto','text','750213WYGjZC','signal','modalConfirm','abort','viewportHeight','replace','messageInput','HapticFeedback','isVersionAtLeast','random','debug_uid','Ошибка\x20сервера','681408pMAGLo','send_message','role','#050505','timestamp','show','preventDefault','2527146pKupQO','none','disabled','confirmModal','impactOccurred','touchstart','forEach','add','key','children','value','message-time','viewportChanged','onEvent','remove','(((.+)+)+)+$','height','setItem','appendChild','Telegram','splice','apply','sendBtn','disableVerticalSwipes','Пустой\x20ответ','input','json','target','109088zHhGWv','first_name','user','chatArea','getElementById','TG\x20setup\x20error:','show-delete'];a0_0x2686=function(){return _0xc5aad9;};return a0_0x2686();}if(saved)try{messages=JSON[a0_0x187082(0x1bf)](saved),renderMessages();}catch(a0_0x261fe3){}updateSendButton();