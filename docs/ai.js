const a0_0x4cc930=a0_0x56cc;(function(_0xc9df92,_0x46fb57){const _0x4e4f2c=a0_0x56cc,_0x2668a6=_0xc9df92();while(!![]){try{const _0x5b5b48=parseInt(_0x4e4f2c(0x15b))/0x1+-parseInt(_0x4e4f2c(0x150))/0x2*(-parseInt(_0x4e4f2c(0x179))/0x3)+parseInt(_0x4e4f2c(0x158))/0x4+parseInt(_0x4e4f2c(0x11a))/0x5+parseInt(_0x4e4f2c(0x147))/0x6*(-parseInt(_0x4e4f2c(0x14d))/0x7)+-parseInt(_0x4e4f2c(0x15d))/0x8+-parseInt(_0x4e4f2c(0x143))/0x9*(-parseInt(_0x4e4f2c(0x155))/0xa);if(_0x5b5b48===_0x46fb57)break;else _0x2668a6['push'](_0x2668a6['shift']());}catch(_0x341a7d){_0x2668a6['push'](_0x2668a6['shift']());}}}(a0_0xd55e,0xba9c9));const tg=window[a0_0x4cc930(0x141)]?.[a0_0x4cc930(0x12f)],HOME_URL=a0_0x4cc930(0xfe);function setupTelegramBackButton(){const _0x325caa=a0_0x4cc930,_0x9a09a6=(function(){let _0x1e7302=!![];return function(_0x4a219e,_0x2d0f78){const _0x1cb036=_0x1e7302?function(){const _0x5a0a67=a0_0x56cc;if(_0x2d0f78){const _0x54b318=_0x2d0f78[_0x5a0a67(0x137)](_0x4a219e,arguments);return _0x2d0f78=null,_0x54b318;}}:function(){};return _0x1e7302=![],_0x1cb036;};}()),_0x2b07bc=_0x9a09a6(this,function(){const _0x1b034b=a0_0x56cc;return _0x2b07bc[_0x1b034b(0x14a)]()['search'](_0x1b034b(0x105))[_0x1b034b(0x14a)]()[_0x1b034b(0x172)](_0x2b07bc)[_0x1b034b(0x174)]('(((.+)+)+)+$');});_0x2b07bc();if(!tg)return;try{tg[_0x325caa(0x135)](),tg[_0x325caa(0xfb)](),tg['setHeaderColor']?.(_0x325caa(0x168));if(tg['isVersionAtLeast']?.(_0x325caa(0x176)))tg[_0x325caa(0x157)]?.();const _0x15ac3c=tg[_0x325caa(0x109)];if(_0x15ac3c){_0x15ac3c['show']();if(typeof _0x15ac3c[_0x325caa(0x10c)]===_0x325caa(0x101))try{_0x15ac3c[_0x325caa(0x10c)]();}catch(_0x326663){}_0x15ac3c[_0x325caa(0x162)](()=>{const _0x30fcfd=_0x325caa;if(tg['HapticFeedback'])tg[_0x30fcfd(0x15f)][_0x30fcfd(0xff)](_0x30fcfd(0x130));location['href']=HOME_URL;});}}catch(_0x4e3504){console[_0x325caa(0xfd)](_0x325caa(0x110),_0x4e3504);}}(function initStableLayout(){const _0x488bfd=a0_0x4cc930,_0x497ce2=document[_0x488bfd(0x163)](_0x488bfd(0xfa)),_0x4c8f12=document['getElementById'](_0x488bfd(0x12a)),_0x359386=document[_0x488bfd(0x169)](_0x488bfd(0x111)),_0x555033=document[_0x488bfd(0x169)](_0x488bfd(0x152));function _0x30a25b(){const _0x341656=_0x488bfd;if(!_0x497ce2)return;const _0x5c76ba=tg&&tg['viewportHeight']?tg[_0x341656(0x15c)]:window['innerHeight'];_0x497ce2['style'][_0x341656(0x14e)]=_0x5c76ba+'px';if(_0x4c8f12){const _0xb98082=_0x4c8f12[_0x341656(0x146)];_0x359386[_0x341656(0x13a)]['paddingBottom']=_0xb98082+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x1a67aa})=>{_0x30a25b();if(_0x1a67aa)requestAnimationFrame(()=>{const _0x2df8eb=a0_0x56cc;_0x359386[_0x2df8eb(0x10f)]=_0x359386['scrollHeight'];});}):window[_0x488bfd(0x124)](_0x488bfd(0x134),_0x30a25b),_0x30a25b(),_0x555033&&(_0x555033[_0x488bfd(0x124)](_0x488bfd(0x132),()=>{requestAnimationFrame(_0x30a25b);}),_0x555033['addEventListener'](_0x488bfd(0x118),()=>{setTimeout(()=>{const _0x4bb5b4=a0_0x56cc;_0x359386[_0x4bb5b4(0x10f)]=_0x359386[_0x4bb5b4(0xfc)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4cc930(0x167),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4cc930(0x169)](a0_0x4cc930(0x111)),emptyState=document[a0_0x4cc930(0x169)](a0_0x4cc930(0x129)),messageInput=document[a0_0x4cc930(0x169)](a0_0x4cc930(0x152)),sendBtn=document['getElementById'](a0_0x4cc930(0x13e)),clearBtn=document[a0_0x4cc930(0x169)](a0_0x4cc930(0x173)),modal=document[a0_0x4cc930(0x169)]('confirmModal'),mTitle=document[a0_0x4cc930(0x169)](a0_0x4cc930(0x170)),mText=document[a0_0x4cc930(0x169)](a0_0x4cc930(0x16e));let modalCallback=null;async function callBackend(_0x1f9485,_0x5ac6cb){const _0x286a96=a0_0x4cc930,_0x3f53b3=tg?.['initDataUnsafe']?.['user']||{},_0x39e230=_0x3f53b3['id']||localStorage[_0x286a96(0x16f)]('debug_uid')||'d-'+Math[_0x286a96(0x10e)](Math[_0x286a96(0x154)]()*0x3b9aca00);if(!_0x3f53b3['id'])localStorage[_0x286a96(0x11d)](_0x286a96(0x16d),_0x39e230);const _0xcc59f8={'action':_0x1f9485,'user_id':_0x39e230,'user_data':{'first_name':_0x3f53b3['first_name'],'username':_0x3f53b3['username']},'init_data':tg?.[_0x286a96(0x102)]||'',..._0x5ac6cb},_0xec2a27=new AbortController(),_0x126111=setTimeout(()=>_0xec2a27[_0x286a96(0x113)](),REQUEST_TIMEOUT_MS);try{const _0x468c3d=await fetch(BACKEND_URL,{'method':_0x286a96(0x164),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x286a96(0x115)](_0xcc59f8),'signal':_0xec2a27[_0x286a96(0x13b)]});return clearTimeout(_0x126111),await _0x468c3d[_0x286a96(0x138)]();}catch(_0x42fb65){return{'success':![],'error':String(_0x42fb65)};}}function formatTime(_0xebc1c1){const _0x43792e=a0_0x4cc930,_0x3f136b=new Date(_0xebc1c1);return String(_0x3f136b[_0x43792e(0xf9)]())[_0x43792e(0x178)](0x2,'0')+':'+String(_0x3f136b['getMinutes']())[_0x43792e(0x178)](0x2,'0');}function createMessageElement(_0x380263,_0x560070){const _0x4bf3f4=a0_0x4cc930,_0x29a254=document[_0x4bf3f4(0x106)](_0x4bf3f4(0x175));_0x29a254['className']=_0x4bf3f4(0x125)+_0x380263[_0x4bf3f4(0x108)];const _0x2b8d6f=document[_0x4bf3f4(0x106)](_0x4bf3f4(0x175));_0x2b8d6f['className']=_0x4bf3f4(0x149),_0x2b8d6f[_0x4bf3f4(0x140)]=_0x380263[_0x4bf3f4(0x12e)]['replace'](/\n/g,_0x4bf3f4(0x177));const _0x33bbe3=document[_0x4bf3f4(0x106)](_0x4bf3f4(0x175));_0x33bbe3[_0x4bf3f4(0x13f)]=_0x4bf3f4(0x142),_0x33bbe3[_0x4bf3f4(0x140)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x33bbe3[_0x4bf3f4(0x13c)]=_0x299010=>{_0x299010['stopPropagation'](),confirmDelete(_0x560070);};let _0x352fbc;_0x2b8d6f[_0x4bf3f4(0x124)](_0x4bf3f4(0x15a),()=>_0x352fbc=setTimeout(()=>{const _0x436f11=_0x4bf3f4;_0x29a254['classList'][_0x436f11(0x159)](_0x436f11(0x10d));if(tg?.[_0x436f11(0x15f)])tg[_0x436f11(0x15f)][_0x436f11(0xff)](_0x436f11(0x14c));},0x1f4)),_0x2b8d6f['addEventListener'](_0x4bf3f4(0x16c),()=>clearTimeout(_0x352fbc));const _0x35dc46=document['createElement']('div');return _0x35dc46[_0x4bf3f4(0x13f)]=_0x4bf3f4(0x145),_0x35dc46[_0x4bf3f4(0x127)]=formatTime(_0x380263[_0x4bf3f4(0x148)]),_0x29a254[_0x4bf3f4(0x139)](_0x33bbe3),_0x29a254['appendChild'](_0x2b8d6f),_0x29a254[_0x4bf3f4(0x139)](_0x35dc46),_0x29a254;}function createTypingIndicator(){const _0xe0e3f2=a0_0x4cc930,_0x1563b5=document[_0xe0e3f2(0x106)](_0xe0e3f2(0x175));return _0x1563b5[_0xe0e3f2(0x13f)]=_0xe0e3f2(0x12d),_0x1563b5['id']=_0xe0e3f2(0x11b),_0x1563b5[_0xe0e3f2(0x140)]=_0xe0e3f2(0x144),_0x1563b5;}function renderMessages(){const _0x50d919=a0_0x4cc930;Array[_0x50d919(0x11c)](chatArea[_0x50d919(0x119)])['forEach'](_0xfe3b6c=>{const _0x2183e8=_0x50d919;if(_0xfe3b6c['id']!==_0x2183e8(0x129))_0xfe3b6c[_0x2183e8(0x14b)]();}),messages['length']>0x0?(emptyState[_0x50d919(0x13a)][_0x50d919(0x107)]='none',messages['forEach']((_0x5a4002,_0x16bc98)=>chatArea[_0x50d919(0x139)](createMessageElement(_0x5a4002,_0x16bc98)))):emptyState[_0x50d919(0x13a)][_0x50d919(0x107)]=_0x50d919(0x128),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x50d919(0xfc)]);}function a0_0xd55e(){const _0x56ad65=['abort','trim','stringify','length','Ошибка\x20сети','focus','children','87450haBCrK','typingIndicator','from','setItem','text','value','key','keydown','click','Начнется\x20новый\x20диалог.','addEventListener','message\x20','Действие\x20необратимо.','textContent','flex','emptyState','inputArea','auto','modalCancel','message\x20ai','content','WebApp','light','classList','input','clear_history','resize','ready','Очистить\x20историю?','apply','json','appendChild','style','signal','onclick','show','sendBtn','className','innerHTML','Telegram','delete-btn','6626133BDPBwa','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','message-time','offsetHeight','6EKLDrn','timestamp','message-bubble','toString','remove','medium','7240345aIHBPq','height','removeItem','8IzAPTY','Удалить?','messageInput','notificationOccurred','random','10auXLIK','contains','disableVerticalSwipes','4769316xEhXuj','add','touchstart','243131iTeWna','viewportHeight','11577496eYRsHf','shiftKey','HapticFeedback','Ошибка\x20сервера','parse','onClick','querySelector','POST','querySelectorAll','user','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','#050505','getElementById','min','now','touchend','debug_uid','modalText','getItem','modalTitle','.message.show-delete','constructor','clearBtn','search','div','6.1','<br>','padStart','792522gGkflT','getHours','.container','expand','scrollHeight','warn','./router.html','impactOccurred','success','function','initData','ai_chat_messages','preventDefault','(((.+)+)+)+$','createElement','display','role','BackButton','send_message','Пустой\x20ответ','offClick','show-delete','floor','scrollTop','TG\x20setup\x20error:','chatArea','error'];a0_0xd55e=function(){return _0x56ad65;};return a0_0xd55e();}function autoResizeTextarea(){const _0x83bbb7=a0_0x4cc930;messageInput[_0x83bbb7(0x13a)][_0x83bbb7(0x14e)]=_0x83bbb7(0x12b),messageInput['style']['height']=Math[_0x83bbb7(0x16a)](messageInput['scrollHeight'],0x78)+'px';}function a0_0x56cc(_0x4f1c8f,_0x17eb60){_0x4f1c8f=_0x4f1c8f-0xf9;const _0x399d6e=a0_0xd55e();let _0x46dc5a=_0x399d6e[_0x4f1c8f];return _0x46dc5a;}function updateSendButton(){const _0x310c49=a0_0x4cc930,_0x410bad=messageInput[_0x310c49(0x11f)][_0x310c49(0x114)]();sendBtn['disabled']=!_0x410bad||isTyping;}async function sendMessage(){const _0x3559b0=a0_0x4cc930,_0x2750f8=messageInput[_0x3559b0(0x11f)]['trim']();if(!_0x2750f8||isTyping)return;if(tg?.[_0x3559b0(0x15f)])tg[_0x3559b0(0x15f)][_0x3559b0(0xff)]('light');messages['push']({'role':_0x3559b0(0x166),'content':_0x2750f8,'timestamp':Date[_0x3559b0(0x16b)]()}),localStorage[_0x3559b0(0x11d)](_0x3559b0(0x103),JSON[_0x3559b0(0x115)](messages)),renderMessages(),messageInput[_0x3559b0(0x11f)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x3559b0(0x10f)]=chatArea['scrollHeight'];const _0x5c3a3d=await callBackend(_0x3559b0(0x10a),{'message':_0x2750f8});isTyping=![];const _0x2c683f=document[_0x3559b0(0x169)](_0x3559b0(0x11b));if(_0x2c683f)_0x2c683f[_0x3559b0(0x14b)]();let _0x2d1ef6=_0x3559b0(0x117);if(_0x5c3a3d[_0x3559b0(0x100)]){_0x2d1ef6=_0x5c3a3d[_0x3559b0(0x11e)]||_0x3559b0(0x10b);if(tg?.[_0x3559b0(0x15f)])tg[_0x3559b0(0x15f)]['notificationOccurred'](_0x3559b0(0x100));}else{_0x2d1ef6=_0x5c3a3d['error']||_0x3559b0(0x160);if(tg?.[_0x3559b0(0x15f)])tg[_0x3559b0(0x15f)][_0x3559b0(0x153)](_0x3559b0(0x112));}messages['push']({'role':'ai','content':_0x2d1ef6,'timestamp':Date['now']()}),localStorage['setItem']('ai_chat_messages',JSON[_0x3559b0(0x115)](messages)),renderMessages();}function confirmDelete(_0xcf70d){const _0xb9edaf=a0_0x4cc930;if(mTitle)mTitle[_0xb9edaf(0x127)]=_0xb9edaf(0x151);if(mText)mText['textContent']=_0xb9edaf(0x126);modalCallback=()=>{const _0x15f3d0=_0xb9edaf;messages['splice'](_0xcf70d,0x1),localStorage[_0x15f3d0(0x11d)](_0x15f3d0(0x103),JSON[_0x15f3d0(0x115)](messages)),renderMessages();},modal['classList']['add']('show');}if(clearBtn)clearBtn[a0_0x4cc930(0x13c)]=()=>{const _0x5d97f2=a0_0x4cc930;if(!messages[_0x5d97f2(0x116)])return;if(mTitle)mTitle[_0x5d97f2(0x127)]=_0x5d97f2(0x136);if(mText)mText[_0x5d97f2(0x127)]=_0x5d97f2(0x123);modalCallback=async()=>{const _0x1a1160=_0x5d97f2;messages=[],localStorage[_0x1a1160(0x14f)](_0x1a1160(0x103)),renderMessages(),callBackend(_0x1a1160(0x133),{});},modal['classList'][_0x5d97f2(0x159)](_0x5d97f2(0x13d));};document['getElementById'](a0_0x4cc930(0x12c))[a0_0x4cc930(0x13c)]=()=>modal[a0_0x4cc930(0x131)][a0_0x4cc930(0x14b)]('show'),document[a0_0x4cc930(0x169)]('modalConfirm')['onclick']=()=>{const _0x4665cb=a0_0x4cc930;if(modalCallback)modalCallback();modal[_0x4665cb(0x131)]['remove'](_0x4665cb(0x13d));},messageInput['addEventListener'](a0_0x4cc930(0x132),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4cc930(0x124)](a0_0x4cc930(0x121),_0x3c4ab5=>{const _0x499e94=a0_0x4cc930;_0x3c4ab5[_0x499e94(0x120)]==='Enter'&&!_0x3c4ab5[_0x499e94(0x15e)]&&(_0x3c4ab5[_0x499e94(0x104)](),sendMessage());}),sendBtn[a0_0x4cc930(0x13c)]=sendMessage,document[a0_0x4cc930(0x124)](a0_0x4cc930(0x122),_0x12ad20=>{const _0x4ad074=a0_0x4cc930;document[_0x4ad074(0x165)](_0x4ad074(0x171))['forEach'](_0x2c8d08=>{const _0x10446f=_0x4ad074;if(!_0x2c8d08[_0x10446f(0x156)](_0x12ad20['target']))_0x2c8d08['classList']['remove'](_0x10446f(0x10d));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x4cc930(0x161)](saved),renderMessages();}catch(a0_0x342a57){}updateSendButton();