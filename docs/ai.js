const a0_0xdc2cab=a0_0x19cf;(function(_0x44d59f,_0x38b7cf){const _0x173ec9=a0_0x19cf,_0x254b1e=_0x44d59f();while(!![]){try{const _0x3e6ae6=parseInt(_0x173ec9(0x152))/0x1*(-parseInt(_0x173ec9(0x167))/0x2)+-parseInt(_0x173ec9(0x146))/0x3+parseInt(_0x173ec9(0x172))/0x4+-parseInt(_0x173ec9(0x14a))/0x5*(parseInt(_0x173ec9(0x15d))/0x6)+parseInt(_0x173ec9(0x154))/0x7*(parseInt(_0x173ec9(0x163))/0x8)+parseInt(_0x173ec9(0x170))/0x9*(-parseInt(_0x173ec9(0x192))/0xa)+parseInt(_0x173ec9(0x165))/0xb;if(_0x3e6ae6===_0x38b7cf)break;else _0x254b1e['push'](_0x254b1e['shift']());}catch(_0x416c4e){_0x254b1e['push'](_0x254b1e['shift']());}}}(a0_0x4c35,0xcee0b));const tg=window[a0_0xdc2cab(0x17e)]?.[a0_0xdc2cab(0x15e)],HOME_URL=a0_0xdc2cab(0x181);function setupTelegramBackButton(){const _0xe77794=a0_0xdc2cab;if(!tg)return;try{tg[_0xe77794(0x129)](),tg[_0xe77794(0x19f)](),tg[_0xe77794(0x138)]?.(_0xe77794(0x150));if(tg[_0xe77794(0x12f)]?.(_0xe77794(0x131)))tg['disableVerticalSwipes']?.();const _0x13aea9=tg[_0xe77794(0x173)];if(_0x13aea9){_0x13aea9[_0xe77794(0x148)]();if(typeof _0x13aea9[_0xe77794(0x12c)]===_0xe77794(0x125))try{_0x13aea9[_0xe77794(0x12c)]();}catch(_0x370f4a){}_0x13aea9[_0xe77794(0x158)](()=>{const _0x207ff6=_0xe77794;if(tg[_0x207ff6(0x188)])tg[_0x207ff6(0x188)][_0x207ff6(0x164)](_0x207ff6(0x142));location[_0x207ff6(0x18e)]=HOME_URL;});}}catch(_0x360f27){console['warn']('TG\x20setup\x20error:',_0x360f27);}}(function initStableLayout(){const _0x3325a7=a0_0xdc2cab,_0x50835e=(function(){let _0x302756=!![];return function(_0x465680,_0x2eb06c){const _0x1af285=_0x302756?function(){const _0x532fb3=a0_0x19cf;if(_0x2eb06c){const _0x1c6b7c=_0x2eb06c[_0x532fb3(0x141)](_0x465680,arguments);return _0x2eb06c=null,_0x1c6b7c;}}:function(){};return _0x302756=![],_0x1af285;};}()),_0x4fccf2=document[_0x3325a7(0x13a)](_0x3325a7(0x193)),_0x4d5676=document['getElementById'](_0x3325a7(0x19a)),_0xddc389=document[_0x3325a7(0x17d)]('chatArea'),_0x2ba67b=document['getElementById'](_0x3325a7(0x15f));function _0x3fe6ad(){const _0x16812a=_0x3325a7,_0x428395=_0x50835e(this,function(){const _0x442785=a0_0x19cf;return _0x428395['toString']()['search']('(((.+)+)+)+$')[_0x442785(0x18a)]()[_0x442785(0x13b)](_0x428395)[_0x442785(0x14b)](_0x442785(0x13e));});_0x428395();if(!_0x4fccf2)return;const _0x2d1cab=tg&&tg['viewportHeight']?tg[_0x16812a(0x18c)]:window[_0x16812a(0x15c)];_0x4fccf2[_0x16812a(0x134)][_0x16812a(0x185)]=_0x2d1cab+'px';if(_0x4d5676){const _0x4c02de=_0x4d5676[_0x16812a(0x189)];_0xddc389[_0x16812a(0x134)][_0x16812a(0x16e)]=_0x4c02de+0x28+'px';}}tg?tg[_0x3325a7(0x171)](_0x3325a7(0x14d),({isStateStable:_0x2f328e})=>{_0x3fe6ad();if(_0x2f328e)requestAnimationFrame(()=>{const _0x19fc72=a0_0x19cf;_0xddc389[_0x19fc72(0x130)]=_0xddc389['scrollHeight'];});}):window['addEventListener'](_0x3325a7(0x157),_0x3fe6ad),_0x3fe6ad(),_0x2ba67b&&(_0x2ba67b[_0x3325a7(0x16a)](_0x3325a7(0x123),()=>{requestAnimationFrame(_0x3fe6ad);}),_0x2ba67b['addEventListener'](_0x3325a7(0x159),()=>{setTimeout(()=>{const _0x4917c7=a0_0x19cf;_0xddc389[_0x4917c7(0x130)]=_0xddc389[_0x4917c7(0x11f)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0xdc2cab(0x16b),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0xdc2cab(0x17d)](a0_0xdc2cab(0x180)),emptyState=document[a0_0xdc2cab(0x17d)](a0_0xdc2cab(0x197)),messageInput=document[a0_0xdc2cab(0x17d)](a0_0xdc2cab(0x15f)),sendBtn=document[a0_0xdc2cab(0x17d)](a0_0xdc2cab(0x174)),clearBtn=document['getElementById'](a0_0xdc2cab(0x16f)),modal=document[a0_0xdc2cab(0x17d)]('confirmModal'),mTitle=document[a0_0xdc2cab(0x17d)]('modalTitle'),mText=document['getElementById'](a0_0xdc2cab(0x137));let modalCallback=null;async function callBackend(_0x158824,_0xc99245){const _0x2e5aa5=a0_0xdc2cab,_0x151179=tg?.[_0x2e5aa5(0x147)]?.[_0x2e5aa5(0x166)]||{},_0x215405=_0x151179['id']||localStorage[_0x2e5aa5(0x153)](_0x2e5aa5(0x12e))||'d-'+Math[_0x2e5aa5(0x18d)](Math[_0x2e5aa5(0x14f)]()*0x3b9aca00);if(!_0x151179['id'])localStorage[_0x2e5aa5(0x160)](_0x2e5aa5(0x12e),_0x215405);const _0x38c1ac={'action':_0x158824,'user_id':_0x215405,'user_data':{'first_name':_0x151179[_0x2e5aa5(0x151)],'username':_0x151179['username']},'init_data':tg?.['initData']||'',..._0xc99245},_0xa2c5f=new AbortController(),_0x2baa9b=setTimeout(()=>_0xa2c5f[_0x2e5aa5(0x12a)](),REQUEST_TIMEOUT_MS);try{const _0x43f524=await fetch(BACKEND_URL,{'method':_0x2e5aa5(0x13f),'headers':{'Content-Type':_0x2e5aa5(0x178)},'body':JSON[_0x2e5aa5(0x190)](_0x38c1ac),'signal':_0xa2c5f['signal']});return clearTimeout(_0x2baa9b),await _0x43f524['json']();}catch(_0x562e55){return{'success':![],'error':String(_0x562e55)};}}function formatTime(_0x4c65c5){const _0x512afc=a0_0xdc2cab,_0x4deeb6=new Date(_0x4c65c5);return String(_0x4deeb6[_0x512afc(0x156)]())[_0x512afc(0x14e)](0x2,'0')+':'+String(_0x4deeb6[_0x512afc(0x18b)]())[_0x512afc(0x14e)](0x2,'0');}function a0_0x4c35(){const _0x583176=['<br>','Пустой\x20ответ','appendChild','4440813pmqnxH','initDataUnsafe','show','keydown','39205IdaBCj','search','innerHTML','viewportChanged','padStart','random','#050505','first_name','1557449GdgjbQ','getItem','7deFNwm','splice','getHours','resize','onClick','focus','preventDefault','div','innerHeight','372RqUqjk','WebApp','messageInput','setItem','auto','add','10574504DDWvOa','impactOccurred','31146885aItyrQ','user','2TZpUlr','none','createElement','addEventListener','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','key','className','paddingBottom','clearBtn','234DSFRDL','onEvent','2014812uxoesz','BackButton','sendBtn','disabled','success','value','text/plain','Ошибка\x20сети','parse','modalConfirm','shiftKey','getElementById','Telegram','message-time','chatArea','./router.html','length','now','from','height','message-bubble','remove','HapticFeedback','offsetHeight','toString','getMinutes','viewportHeight','floor','href','touchstart','stringify','message\x20ai','109930KvWdbH','.container','flex','content','touchend','emptyState','push','forEach','inputArea','display','trim','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','Начнется\x20новый\x20диалог.','expand','onclick','show-delete','scrollHeight','medium','text','timestamp','input','replace','function','notificationOccurred','querySelectorAll','textContent','ready','abort','delete-btn','offClick','stopPropagation','debug_uid','isVersionAtLeast','scrollTop','6.1','Действие\x20необратимо.','typingIndicator','style','min','ai_chat_messages','modalText','setHeaderColor','error','querySelector','constructor','target','contains','(((.+)+)+)+$','POST','classList','apply','light'];a0_0x4c35=function(){return _0x583176;};return a0_0x4c35();}function createMessageElement(_0x2af99b,_0x1d9f74){const _0x1d154d=a0_0xdc2cab,_0x2376f2=document[_0x1d154d(0x169)](_0x1d154d(0x15b));_0x2376f2[_0x1d154d(0x16d)]='message\x20'+_0x2af99b['role'];const _0x25b29c=document[_0x1d154d(0x169)]('div');_0x25b29c[_0x1d154d(0x16d)]=_0x1d154d(0x186),_0x25b29c['innerHTML']=_0x2af99b[_0x1d154d(0x195)][_0x1d154d(0x124)](/\n/g,_0x1d154d(0x143));const _0x21bd4f=document[_0x1d154d(0x169)](_0x1d154d(0x15b));_0x21bd4f[_0x1d154d(0x16d)]=_0x1d154d(0x12b),_0x21bd4f[_0x1d154d(0x14c)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x21bd4f[_0x1d154d(0x1a0)]=_0x187199=>{const _0x29dcbb=_0x1d154d;_0x187199[_0x29dcbb(0x12d)](),confirmDelete(_0x1d9f74);};let _0x14df4a;_0x25b29c[_0x1d154d(0x16a)](_0x1d154d(0x18f),()=>_0x14df4a=setTimeout(()=>{const _0x477be3=_0x1d154d;_0x2376f2[_0x477be3(0x140)]['add'](_0x477be3(0x11e));if(tg?.[_0x477be3(0x188)])tg[_0x477be3(0x188)]['impactOccurred'](_0x477be3(0x120));},0x1f4)),_0x25b29c['addEventListener'](_0x1d154d(0x196),()=>clearTimeout(_0x14df4a));const _0x2abfb7=document[_0x1d154d(0x169)](_0x1d154d(0x15b));return _0x2abfb7['className']=_0x1d154d(0x17f),_0x2abfb7[_0x1d154d(0x128)]=formatTime(_0x2af99b[_0x1d154d(0x122)]),_0x2376f2['appendChild'](_0x21bd4f),_0x2376f2[_0x1d154d(0x145)](_0x25b29c),_0x2376f2[_0x1d154d(0x145)](_0x2abfb7),_0x2376f2;}function createTypingIndicator(){const _0x48eefe=a0_0xdc2cab,_0x1d7743=document[_0x48eefe(0x169)](_0x48eefe(0x15b));return _0x1d7743[_0x48eefe(0x16d)]=_0x48eefe(0x191),_0x1d7743['id']=_0x48eefe(0x133),_0x1d7743[_0x48eefe(0x14c)]=_0x48eefe(0x19d),_0x1d7743;}function renderMessages(){const _0x150874=a0_0xdc2cab;Array[_0x150874(0x184)](chatArea['children'])[_0x150874(0x199)](_0x524dce=>{const _0xf1b0fd=_0x150874;if(_0x524dce['id']!==_0xf1b0fd(0x197))_0x524dce[_0xf1b0fd(0x187)]();}),messages[_0x150874(0x182)]>0x0?(emptyState[_0x150874(0x134)][_0x150874(0x19b)]=_0x150874(0x168),messages[_0x150874(0x199)]((_0x2fcef2,_0x101112)=>chatArea['appendChild'](createMessageElement(_0x2fcef2,_0x101112)))):emptyState['style'][_0x150874(0x19b)]=_0x150874(0x194),requestAnimationFrame(()=>chatArea[_0x150874(0x130)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x37be17=a0_0xdc2cab;messageInput[_0x37be17(0x134)][_0x37be17(0x185)]=_0x37be17(0x161),messageInput[_0x37be17(0x134)][_0x37be17(0x185)]=Math[_0x37be17(0x135)](messageInput[_0x37be17(0x11f)],0x78)+'px';}function updateSendButton(){const _0x1c8edc=a0_0xdc2cab,_0x3c838b=messageInput[_0x1c8edc(0x177)]['trim']();sendBtn[_0x1c8edc(0x175)]=!_0x3c838b||isTyping;}async function sendMessage(){const _0x25ed89=a0_0xdc2cab,_0x1fae28=messageInput[_0x25ed89(0x177)][_0x25ed89(0x19c)]();if(!_0x1fae28||isTyping)return;if(tg?.[_0x25ed89(0x188)])tg['HapticFeedback'][_0x25ed89(0x164)](_0x25ed89(0x142));messages[_0x25ed89(0x198)]({'role':_0x25ed89(0x166),'content':_0x1fae28,'timestamp':Date[_0x25ed89(0x183)]()}),localStorage[_0x25ed89(0x160)](_0x25ed89(0x136),JSON[_0x25ed89(0x190)](messages)),renderMessages(),messageInput[_0x25ed89(0x177)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x25ed89(0x145)](createTypingIndicator()),chatArea[_0x25ed89(0x130)]=chatArea[_0x25ed89(0x11f)];const _0x3cd3a4=await callBackend('send_message',{'message':_0x1fae28});isTyping=![];const _0x3e1af4=document[_0x25ed89(0x17d)](_0x25ed89(0x133));if(_0x3e1af4)_0x3e1af4[_0x25ed89(0x187)]();let _0x500b5f=_0x25ed89(0x179);if(_0x3cd3a4[_0x25ed89(0x176)]){_0x500b5f=_0x3cd3a4[_0x25ed89(0x121)]||_0x25ed89(0x144);if(tg?.[_0x25ed89(0x188)])tg[_0x25ed89(0x188)][_0x25ed89(0x126)]('success');}else{_0x500b5f=_0x3cd3a4[_0x25ed89(0x139)]||'Ошибка\x20сервера';if(tg?.[_0x25ed89(0x188)])tg[_0x25ed89(0x188)]['notificationOccurred'](_0x25ed89(0x139));}messages['push']({'role':'ai','content':_0x500b5f,'timestamp':Date['now']()}),localStorage[_0x25ed89(0x160)](_0x25ed89(0x136),JSON[_0x25ed89(0x190)](messages)),renderMessages();}function confirmDelete(_0x5d68ba){const _0x25a1e8=a0_0xdc2cab;if(mTitle)mTitle[_0x25a1e8(0x128)]='Удалить?';if(mText)mText[_0x25a1e8(0x128)]=_0x25a1e8(0x132);modalCallback=()=>{const _0x439812=_0x25a1e8;messages[_0x439812(0x155)](_0x5d68ba,0x1),localStorage['setItem'](_0x439812(0x136),JSON['stringify'](messages)),renderMessages();},modal[_0x25a1e8(0x140)][_0x25a1e8(0x162)](_0x25a1e8(0x148));}if(clearBtn)clearBtn[a0_0xdc2cab(0x1a0)]=()=>{const _0x59f942=a0_0xdc2cab;if(!messages['length'])return;if(mTitle)mTitle[_0x59f942(0x128)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x59f942(0x19e);modalCallback=async()=>{messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x59f942(0x140)][_0x59f942(0x162)](_0x59f942(0x148));};document['getElementById']('modalCancel')[a0_0xdc2cab(0x1a0)]=()=>modal['classList'][a0_0xdc2cab(0x187)]('show'),document[a0_0xdc2cab(0x17d)](a0_0xdc2cab(0x17b))[a0_0xdc2cab(0x1a0)]=()=>{const _0x1668e2=a0_0xdc2cab;if(modalCallback)modalCallback();modal['classList'][_0x1668e2(0x187)](_0x1668e2(0x148));},messageInput[a0_0xdc2cab(0x16a)](a0_0xdc2cab(0x123),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0xdc2cab(0x16a)](a0_0xdc2cab(0x149),_0x35f738=>{const _0x415042=a0_0xdc2cab;_0x35f738[_0x415042(0x16c)]==='Enter'&&!_0x35f738[_0x415042(0x17c)]&&(_0x35f738[_0x415042(0x15a)](),sendMessage());}),sendBtn[a0_0xdc2cab(0x1a0)]=sendMessage,document[a0_0xdc2cab(0x16a)]('click',_0x7824f=>{const _0x187e51=a0_0xdc2cab;document[_0x187e51(0x127)]('.message.show-delete')[_0x187e51(0x199)](_0x7e39c9=>{const _0x41b150=_0x187e51;if(!_0x7e39c9[_0x41b150(0x13d)](_0x7824f[_0x41b150(0x13c)]))_0x7e39c9['classList'][_0x41b150(0x187)](_0x41b150(0x11e));});});function a0_0x19cf(_0x537c49,_0x4b46f8){_0x537c49=_0x537c49-0x11e;const _0x1465e6=a0_0x4c35();let _0x473591=_0x1465e6[_0x537c49];return _0x473591;}const saved=localStorage['getItem'](a0_0xdc2cab(0x136));if(saved)try{messages=JSON[a0_0xdc2cab(0x17a)](saved),renderMessages();}catch(a0_0x4a6002){}updateSendButton();