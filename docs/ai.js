const a0_0x4473f3=a0_0x5a96;(function(_0x2ffe08,_0x564a77){const _0x31c777=a0_0x5a96,_0x2d6ae9=_0x2ffe08();while(!![]){try{const _0x47eed3=parseInt(_0x31c777(0xfe))/0x1+parseInt(_0x31c777(0x118))/0x2*(-parseInt(_0x31c777(0xf6))/0x3)+-parseInt(_0x31c777(0x145))/0x4+parseInt(_0x31c777(0x140))/0x5+-parseInt(_0x31c777(0xfa))/0x6*(parseInt(_0x31c777(0x122))/0x7)+parseInt(_0x31c777(0x113))/0x8*(-parseInt(_0x31c777(0x146))/0x9)+parseInt(_0x31c777(0x104))/0xa;if(_0x47eed3===_0x564a77)break;else _0x2d6ae9['push'](_0x2d6ae9['shift']());}catch(_0x4006e0){_0x2d6ae9['push'](_0x2d6ae9['shift']());}}}(a0_0x3043,0x85f5e));const tg=window['Telegram']?.[a0_0x4473f3(0xf7)],HOME_URL=a0_0x4473f3(0x129);function setupTelegramBackButton(){const _0x370a4a=a0_0x4473f3;if(!tg)return;try{tg['ready'](),tg[_0x370a4a(0x110)](),tg[_0x370a4a(0x142)]?.(_0x370a4a(0xe3));if(tg[_0x370a4a(0x10d)]?.(_0x370a4a(0x12f)))tg['disableVerticalSwipes']?.();const _0x3c7cb8=tg[_0x370a4a(0x138)];if(_0x3c7cb8){_0x3c7cb8[_0x370a4a(0x128)]();if(typeof _0x3c7cb8[_0x370a4a(0xea)]==='function')try{_0x3c7cb8['offClick']();}catch(_0x67bc9b){}_0x3c7cb8[_0x370a4a(0x12d)](()=>{const _0x1c110f=_0x370a4a;if(tg['HapticFeedback'])tg[_0x1c110f(0x11b)][_0x1c110f(0x12a)](_0x1c110f(0x115));location[_0x1c110f(0xdd)]=HOME_URL;});}}catch(_0x551878){console[_0x370a4a(0x100)](_0x370a4a(0xfd),_0x551878);}}(function initStableLayout(){const _0x14fcec=a0_0x4473f3,_0x322feb=(function(){let _0x1c5a9b=!![];return function(_0x11a408,_0x3482db){const _0x1ed1e0=_0x1c5a9b?function(){const _0x12005e=a0_0x5a96;if(_0x3482db){const _0x4dc512=_0x3482db[_0x12005e(0xec)](_0x11a408,arguments);return _0x3482db=null,_0x4dc512;}}:function(){};return _0x1c5a9b=![],_0x1ed1e0;};}()),_0x1fc372=document[_0x14fcec(0x153)](_0x14fcec(0x14a)),_0x13a093=document[_0x14fcec(0xed)]('inputArea'),_0x38b758=document[_0x14fcec(0xed)](_0x14fcec(0x12c)),_0x24da31=document[_0x14fcec(0xed)](_0x14fcec(0x10c));function _0x505232(){const _0x194e1f=_0x14fcec,_0x43830a=_0x322feb(this,function(){const _0x354f53=a0_0x5a96;return _0x43830a[_0x354f53(0x13c)]()[_0x354f53(0xe7)](_0x354f53(0xdf))[_0x354f53(0x13c)]()[_0x354f53(0xf1)](_0x43830a)[_0x354f53(0xe7)]('(((.+)+)+)+$');});_0x43830a();if(!_0x1fc372)return;const _0x3b90b8=tg&&tg[_0x194e1f(0xe0)]?tg[_0x194e1f(0xe0)]:window[_0x194e1f(0xf5)];_0x1fc372['style'][_0x194e1f(0x125)]=_0x3b90b8+'px';if(_0x13a093){const _0x4989c1=_0x13a093[_0x194e1f(0x141)];_0x38b758[_0x194e1f(0x143)]['paddingBottom']=_0x4989c1+0x28+'px';}}tg?tg['onEvent']('viewportChanged',({isStateStable:_0x559c8c})=>{_0x505232();if(_0x559c8c)requestAnimationFrame(()=>{const _0x2538e1=a0_0x5a96;_0x38b758[_0x2538e1(0x13d)]=_0x38b758['scrollHeight'];});}):window['addEventListener'](_0x14fcec(0x13b),_0x505232),_0x505232(),_0x24da31&&(_0x24da31[_0x14fcec(0xdb)](_0x14fcec(0xdc),()=>{requestAnimationFrame(_0x505232);}),_0x24da31['addEventListener'](_0x14fcec(0xeb),()=>{setTimeout(()=>{const _0x113275=a0_0x5a96;_0x38b758[_0x113275(0x13d)]=_0x38b758[_0x113275(0x150)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x4473f3(0xed)](a0_0x4473f3(0x12c)),emptyState=document['getElementById']('emptyState'),messageInput=document[a0_0x4473f3(0xed)]('messageInput'),sendBtn=document[a0_0x4473f3(0xed)](a0_0x4473f3(0x151)),clearBtn=document[a0_0x4473f3(0xed)](a0_0x4473f3(0xe5)),modal=document[a0_0x4473f3(0xed)](a0_0x4473f3(0x13e)),mTitle=document[a0_0x4473f3(0xed)]('modalTitle'),mText=document['getElementById']('modalText');let modalCallback=null;async function callBackend(_0x107b95,_0x4a9fdc){const _0x9f503a=a0_0x4473f3,_0x1a34a7=tg?.[_0x9f503a(0xef)]?.[_0x9f503a(0x14d)]||{},_0x100ca6=_0x1a34a7['id']||localStorage[_0x9f503a(0x11f)](_0x9f503a(0xe9))||'d-'+Math[_0x9f503a(0xe4)](Math['random']()*0x3b9aca00);if(!_0x1a34a7['id'])localStorage['setItem'](_0x9f503a(0xe9),_0x100ca6);const _0x190e33={'action':_0x107b95,'user_id':_0x100ca6,'user_data':{'first_name':_0x1a34a7[_0x9f503a(0xde)],'username':_0x1a34a7[_0x9f503a(0x108)]},'init_data':tg?.[_0x9f503a(0x105)]||'',..._0x4a9fdc},_0x36bd8f=new AbortController(),_0x1b4e4a=setTimeout(()=>_0x36bd8f['abort'](),REQUEST_TIMEOUT_MS);try{const _0x3c5528=await fetch(BACKEND_URL,{'method':_0x9f503a(0x127),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x190e33),'signal':_0x36bd8f[_0x9f503a(0x11d)]});return clearTimeout(_0x1b4e4a),await _0x3c5528[_0x9f503a(0x102)]();}catch(_0x32bb91){return{'success':![],'error':String(_0x32bb91)};}}function formatTime(_0x5d2e23){const _0x1518cd=a0_0x4473f3,_0x359755=new Date(_0x5d2e23);return String(_0x359755[_0x1518cd(0x14b)]())[_0x1518cd(0x116)](0x2,'0')+':'+String(_0x359755['getMinutes']())[_0x1518cd(0x116)](0x2,'0');}function createMessageElement(_0x1f46d0,_0x15064a){const _0x46db8e=a0_0x4473f3,_0x3e3b89=document[_0x46db8e(0x120)](_0x46db8e(0xe2));_0x3e3b89[_0x46db8e(0xff)]='message\x20'+_0x1f46d0[_0x46db8e(0x13f)];const _0x4f1ee1=document[_0x46db8e(0x120)](_0x46db8e(0xe2));_0x4f1ee1[_0x46db8e(0xff)]=_0x46db8e(0x103),_0x4f1ee1['innerHTML']=_0x1f46d0[_0x46db8e(0x106)][_0x46db8e(0x126)](/\n/g,_0x46db8e(0x135));const _0x1508c6=document[_0x46db8e(0x120)](_0x46db8e(0xe2));_0x1508c6['className']=_0x46db8e(0x14f),_0x1508c6[_0x46db8e(0x121)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x1508c6[_0x46db8e(0x11c)]=_0x1493ae=>{const _0x52e1e4=_0x46db8e;_0x1493ae[_0x52e1e4(0x10f)](),confirmDelete(_0x15064a);};let _0x31bcba;_0x4f1ee1[_0x46db8e(0xdb)](_0x46db8e(0x107),()=>_0x31bcba=setTimeout(()=>{const _0x59b9fb=_0x46db8e;_0x3e3b89[_0x59b9fb(0xf8)][_0x59b9fb(0x149)](_0x59b9fb(0x13a));if(tg?.[_0x59b9fb(0x11b)])tg[_0x59b9fb(0x11b)][_0x59b9fb(0x12a)](_0x59b9fb(0x10a));},0x1f4)),_0x4f1ee1[_0x46db8e(0xdb)](_0x46db8e(0xfc),()=>clearTimeout(_0x31bcba));const _0x2ebf9f=document[_0x46db8e(0x120)](_0x46db8e(0xe2));return _0x2ebf9f[_0x46db8e(0xff)]=_0x46db8e(0x119),_0x2ebf9f['textContent']=formatTime(_0x1f46d0['timestamp']),_0x3e3b89[_0x46db8e(0x10b)](_0x1508c6),_0x3e3b89[_0x46db8e(0x10b)](_0x4f1ee1),_0x3e3b89[_0x46db8e(0x10b)](_0x2ebf9f),_0x3e3b89;}function createTypingIndicator(){const _0x298f5b=a0_0x4473f3,_0x1fe219=document['createElement']('div');return _0x1fe219[_0x298f5b(0xff)]=_0x298f5b(0x14c),_0x1fe219['id']=_0x298f5b(0x137),_0x1fe219[_0x298f5b(0x121)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x1fe219;}function renderMessages(){const _0x2d5a2b=a0_0x4473f3;Array[_0x2d5a2b(0x124)](chatArea['children'])[_0x2d5a2b(0x130)](_0x5d0a68=>{const _0x4ee264=_0x2d5a2b;if(_0x5d0a68['id']!==_0x4ee264(0xf9))_0x5d0a68[_0x4ee264(0xf4)]();}),messages[_0x2d5a2b(0x12b)]>0x0?(emptyState[_0x2d5a2b(0x143)]['display']='none',messages[_0x2d5a2b(0x130)]((_0x2407e9,_0x3296ca)=>chatArea[_0x2d5a2b(0x10b)](createMessageElement(_0x2407e9,_0x3296ca)))):emptyState['style'][_0x2d5a2b(0xf0)]=_0x2d5a2b(0xe1),requestAnimationFrame(()=>chatArea[_0x2d5a2b(0x13d)]=chatArea[_0x2d5a2b(0x150)]);}function autoResizeTextarea(){const _0x1e6595=a0_0x4473f3;messageInput['style']['height']='auto',messageInput[_0x1e6595(0x143)][_0x1e6595(0x125)]=Math['min'](messageInput[_0x1e6595(0x150)],0x78)+'px';}function updateSendButton(){const _0x5b7658=a0_0x4473f3,_0x3426fa=messageInput[_0x5b7658(0x117)][_0x5b7658(0xee)]();sendBtn[_0x5b7658(0xe6)]=!_0x3426fa||isTyping;}async function sendMessage(){const _0xfa524b=a0_0x4473f3,_0x16ca3b=messageInput['value']['trim']();if(!_0x16ca3b||isTyping)return;if(tg?.[_0xfa524b(0x11b)])tg[_0xfa524b(0x11b)][_0xfa524b(0x12a)](_0xfa524b(0x115));messages[_0xfa524b(0x152)]({'role':_0xfa524b(0x14d),'content':_0x16ca3b,'timestamp':Date[_0xfa524b(0x101)]()}),localStorage[_0xfa524b(0x12e)](_0xfa524b(0x132),JSON['stringify'](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0xfa524b(0x10b)](createTypingIndicator()),chatArea[_0xfa524b(0x13d)]=chatArea['scrollHeight'];const _0x2adb0f=await callBackend(_0xfa524b(0x136),{'message':_0x16ca3b});isTyping=![];const _0x4f4f44=document[_0xfa524b(0xed)](_0xfa524b(0x137));if(_0x4f4f44)_0x4f4f44[_0xfa524b(0xf4)]();let _0x36265f=_0xfa524b(0x131);if(_0x2adb0f[_0xfa524b(0x147)]){_0x36265f=_0x2adb0f[_0xfa524b(0x11e)]||_0xfa524b(0x123);if(tg?.[_0xfa524b(0x11b)])tg['HapticFeedback'][_0xfa524b(0x114)](_0xfa524b(0x147));}else{_0x36265f=_0x2adb0f[_0xfa524b(0x11a)]||'Ошибка\x20сервера';if(tg?.[_0xfa524b(0x11b)])tg[_0xfa524b(0x11b)][_0xfa524b(0x114)](_0xfa524b(0x11a));}messages[_0xfa524b(0x152)]({'role':'ai','content':_0x36265f,'timestamp':Date[_0xfa524b(0x101)]()}),localStorage[_0xfa524b(0x12e)](_0xfa524b(0x132),JSON[_0xfa524b(0x133)](messages)),renderMessages();}function a0_0x5a96(_0x3463cd,_0x3d61f8){_0x3463cd=_0x3463cd-0xdb;const _0x26bd6a=a0_0x3043();let _0x74eee9=_0x26bd6a[_0x3463cd];return _0x74eee9;}function confirmDelete(_0x3acaf4){const _0x2a2b98=a0_0x4473f3;if(mTitle)mTitle[_0x2a2b98(0x10e)]=_0x2a2b98(0x109);if(mText)mText['textContent']=_0x2a2b98(0xf2);modalCallback=()=>{const _0x2e2de6=_0x2a2b98;messages[_0x2e2de6(0x111)](_0x3acaf4,0x1),localStorage['setItem'](_0x2e2de6(0x132),JSON[_0x2e2de6(0x133)](messages)),renderMessages();},modal[_0x2a2b98(0xf8)][_0x2a2b98(0x149)]('show');}if(clearBtn)clearBtn[a0_0x4473f3(0x11c)]=()=>{const _0x242b74=a0_0x4473f3;if(!messages[_0x242b74(0x12b)])return;if(mTitle)mTitle['textContent']=_0x242b74(0x139);if(mText)mText['textContent']='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x414fcb=_0x242b74;messages=[],localStorage[_0x414fcb(0x134)](_0x414fcb(0x132)),renderMessages(),callBackend(_0x414fcb(0x148),{});},modal['classList'][_0x242b74(0x149)](_0x242b74(0x128));};document[a0_0x4473f3(0xed)](a0_0x4473f3(0x112))[a0_0x4473f3(0x11c)]=()=>modal[a0_0x4473f3(0xf8)][a0_0x4473f3(0xf4)]('show'),document[a0_0x4473f3(0xed)]('modalConfirm')[a0_0x4473f3(0x11c)]=()=>{const _0x5ea3ea=a0_0x4473f3;if(modalCallback)modalCallback();modal[_0x5ea3ea(0xf8)]['remove'](_0x5ea3ea(0x128));},messageInput[a0_0x4473f3(0xdb)](a0_0x4473f3(0xdc),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4473f3(0xdb)]('keydown',_0x4eeb26=>{const _0x228635=a0_0x4473f3;_0x4eeb26[_0x228635(0xe8)]==='Enter'&&!_0x4eeb26['shiftKey']&&(_0x4eeb26[_0x228635(0x14e)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x4473f3(0x144),_0x5bd4e9=>{const _0x577a0f=a0_0x4473f3;document[_0x577a0f(0xfb)]('.message.show-delete')[_0x577a0f(0x130)](_0x546bc7=>{const _0x43a3da=_0x577a0f;if(!_0x546bc7['contains'](_0x5bd4e9['target']))_0x546bc7[_0x43a3da(0xf8)][_0x43a3da(0xf4)](_0x43a3da(0x13a));});});function a0_0x3043(){const _0x4d0ad6=['sendBtn','push','querySelector','addEventListener','input','href','first_name','(((.+)+)+)+$','viewportHeight','flex','div','#050505','floor','clearBtn','disabled','search','key','debug_uid','offClick','focus','apply','getElementById','trim','initDataUnsafe','display','constructor','Действие\x20необратимо.','parse','remove','innerHeight','411OUulva','WebApp','classList','emptyState','1914XOQfqG','querySelectorAll','touchend','TG\x20setup\x20error:','454269YaLCHx','className','warn','now','json','message-bubble','18573480UESnCW','initData','content','touchstart','username','Удалить?','medium','appendChild','messageInput','isVersionAtLeast','textContent','stopPropagation','expand','splice','modalCancel','4944232pcpQUT','notificationOccurred','light','padStart','value','12812mstCmX','message-time','error','HapticFeedback','onclick','signal','text','getItem','createElement','innerHTML','9009AhOBhx','Пустой\x20ответ','from','height','replace','POST','show','./router.html','impactOccurred','length','chatArea','onClick','setItem','6.1','forEach','Ошибка\x20сети','ai_chat_messages','stringify','removeItem','<br>','send_message','typingIndicator','BackButton','Очистить\x20историю?','show-delete','resize','toString','scrollTop','confirmModal','role','2727365IFtrvu','offsetHeight','setHeaderColor','style','click','1608736ddVdhf','9cGIDep','success','clear_history','add','.container','getHours','message\x20ai','user','preventDefault','delete-btn','scrollHeight'];a0_0x3043=function(){return _0x4d0ad6;};return a0_0x3043();}const saved=localStorage['getItem'](a0_0x4473f3(0x132));if(saved)try{messages=JSON[a0_0x4473f3(0xf3)](saved),renderMessages();}catch(a0_0xa20eb5){}updateSendButton();