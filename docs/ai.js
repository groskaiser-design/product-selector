const a0_0x1238f3=a0_0x35c7;(function(_0x44f930,_0x40cd27){const _0x498f6f=a0_0x35c7,_0x2ce9c2=_0x44f930();while(!![]){try{const _0x41ae28=parseInt(_0x498f6f(0x252))/0x1+parseInt(_0x498f6f(0x1f7))/0x2+-parseInt(_0x498f6f(0x1fc))/0x3*(-parseInt(_0x498f6f(0x226))/0x4)+parseInt(_0x498f6f(0x20a))/0x5+-parseInt(_0x498f6f(0x20c))/0x6+parseInt(_0x498f6f(0x208))/0x7*(-parseInt(_0x498f6f(0x260))/0x8)+-parseInt(_0x498f6f(0x1ef))/0x9;if(_0x41ae28===_0x40cd27)break;else _0x2ce9c2['push'](_0x2ce9c2['shift']());}catch(_0x53ac39){_0x2ce9c2['push'](_0x2ce9c2['shift']());}}}(a0_0x5a8c,0x3ced8));const tg=window[a0_0x1238f3(0x20d)]?.['WebApp'],HOME_URL=a0_0x1238f3(0x233);function setupTelegramBackButton(){const _0x274385=a0_0x1238f3;if(!tg)return;try{tg[_0x274385(0x25b)](),tg[_0x274385(0x1ee)](),tg['setHeaderColor']?.('#050505');if(tg[_0x274385(0x254)]?.(_0x274385(0x22f)))tg[_0x274385(0x1f0)]?.();const _0x20f392=tg['BackButton'];if(_0x20f392){_0x20f392['show']();if(typeof _0x20f392[_0x274385(0x263)]===_0x274385(0x234))try{_0x20f392[_0x274385(0x263)]();}catch(_0x2fd354){}_0x20f392['onClick'](()=>{const _0x51bbba=_0x274385;if(tg[_0x51bbba(0x20e)])tg['HapticFeedback'][_0x51bbba(0x221)](_0x51bbba(0x210));location[_0x51bbba(0x224)]=HOME_URL;});}}catch(_0x25edb1){console['warn'](_0x274385(0x258),_0x25edb1);}}function a0_0x35c7(_0x2a1f1e,_0x52feaa){_0x2a1f1e=_0x2a1f1e-0x1ee;const _0x160ead=a0_0x5a8c();let _0x550e72=_0x160ead[_0x2a1f1e];return _0x550e72;}(function initStableLayout(){const _0x5a9905=a0_0x1238f3,_0x3313ec=(function(){let _0x1a0939=!![];return function(_0x559380,_0x6a8b0b){const _0x12b630=_0x1a0939?function(){const _0x162899=a0_0x35c7;if(_0x6a8b0b){const _0x44663c=_0x6a8b0b[_0x162899(0x207)](_0x559380,arguments);return _0x6a8b0b=null,_0x44663c;}}:function(){};return _0x1a0939=![],_0x12b630;};}()),_0xf57aac=document[_0x5a9905(0x200)]('.container'),_0x3a3b5a=document[_0x5a9905(0x223)](_0x5a9905(0x25d)),_0x571658=document[_0x5a9905(0x223)]('chatArea'),_0x583c49=document['getElementById'](_0x5a9905(0x25e));function _0x1030cf(){const _0x4756ef=_0x5a9905,_0x5014bd=_0x3313ec(this,function(){const _0xac10a7=a0_0x35c7;return _0x5014bd[_0xac10a7(0x22d)]()['search']('(((.+)+)+)+$')[_0xac10a7(0x22d)]()[_0xac10a7(0x24d)](_0x5014bd)[_0xac10a7(0x215)](_0xac10a7(0x20b));});_0x5014bd();if(!_0xf57aac)return;const _0x316106=tg&&tg[_0x4756ef(0x22c)]?tg[_0x4756ef(0x22c)]:window['innerHeight'];_0xf57aac[_0x4756ef(0x24e)]['height']=_0x316106+'px';if(_0x3a3b5a){const _0x3d731c=_0x3a3b5a['offsetHeight'];_0x571658['style'][_0x4756ef(0x220)]=_0x3d731c+0x28+'px';}}tg?tg[_0x5a9905(0x206)](_0x5a9905(0x25c),({isStateStable:_0x321c3b})=>{_0x1030cf();if(_0x321c3b)requestAnimationFrame(()=>{_0x571658['scrollTop']=_0x571658['scrollHeight'];});}):window[_0x5a9905(0x25f)](_0x5a9905(0x1fe),_0x1030cf),_0x1030cf(),_0x583c49&&(_0x583c49[_0x5a9905(0x25f)]('input',()=>{requestAnimationFrame(_0x1030cf);}),_0x583c49[_0x5a9905(0x25f)](_0x5a9905(0x222),()=>{setTimeout(()=>{const _0x82c0dd=a0_0x35c7;_0x571658[_0x82c0dd(0x23d)]=_0x571658['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());function a0_0x5a8c(){const _0x63cab0=['modalCancel','sendBtn','paddingBottom','impactOccurred','focus','getElementById','href','Начнется\x20новый\x20диалог.','108QqIGXv','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','initDataUnsafe','message\x20','scrollHeight','shiftKey','viewportHeight','toString','user','6.1','add','input','getMinutes','./router.html','function','disabled','ai_chat_messages','div','display','text','auto','modalConfirm','stopPropagation','scrollTop','Enter','modalText','message-bubble','signal','emptyState','show','forEach','trim','parse','remove','appendChild','success','error','querySelectorAll','height','constructor','style','push','createElement','setItem','308876MWUOcz','touchstart','isVersionAtLeast','onclick','notificationOccurred','debug_uid','TG\x20setup\x20error:','typingIndicator','now','ready','viewportChanged','inputArea','messageInput','addEventListener','753024dqGYqm','min','Очистить\x20историю?','offClick','expand','5985306fqcJuM','disableVerticalSwipes','Ошибка\x20сервера','delete-btn','replace','length','role','floor','923808teBDgo','medium','textContent','show-delete','Ошибка\x20сети','19002GGhdfl','classList','resize','keydown','querySelector','<br>','getHours','className','stringify','.message.show-delete','onEvent','apply','14AIiomz','timestamp','1944040SwhvHd','(((.+)+)+)+$','1366536PVJwaR','Telegram','HapticFeedback','confirmModal','light','first_name','value','clearBtn','padStart','search','content','innerHTML','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','target','flex','random','getItem','modalTitle'];a0_0x5a8c=function(){return _0x63cab0;};return a0_0x5a8c();}const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1238f3(0x223)]('chatArea'),emptyState=document[a0_0x1238f3(0x223)](a0_0x1238f3(0x242)),messageInput=document[a0_0x1238f3(0x223)](a0_0x1238f3(0x25e)),sendBtn=document['getElementById'](a0_0x1238f3(0x21f)),clearBtn=document[a0_0x1238f3(0x223)](a0_0x1238f3(0x213)),modal=document[a0_0x1238f3(0x223)](a0_0x1238f3(0x20f)),mTitle=document[a0_0x1238f3(0x223)](a0_0x1238f3(0x21d)),mText=document[a0_0x1238f3(0x223)](a0_0x1238f3(0x23f));let modalCallback=null;async function callBackend(_0x904822,_0x258ab2){const _0x264e19=a0_0x1238f3,_0xbbb7cb=tg?.[_0x264e19(0x228)]?.[_0x264e19(0x22e)]||{},_0x2d1e16=_0xbbb7cb['id']||localStorage[_0x264e19(0x21c)](_0x264e19(0x257))||'d-'+Math[_0x264e19(0x1f6)](Math[_0x264e19(0x21b)]()*0x3b9aca00);if(!_0xbbb7cb['id'])localStorage[_0x264e19(0x251)](_0x264e19(0x257),_0x2d1e16);const _0x5b46ff={'action':_0x904822,'user_id':_0x2d1e16,'user_data':{'first_name':_0xbbb7cb[_0x264e19(0x211)],'username':_0xbbb7cb['username']},'init_data':tg?.['initData']||'',..._0x258ab2},_0x5b84bc=new AbortController(),_0x1c7a20=setTimeout(()=>_0x5b84bc['abort'](),REQUEST_TIMEOUT_MS);try{const _0x1f6cbd=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x264e19(0x204)](_0x5b46ff),'signal':_0x5b84bc[_0x264e19(0x241)]});return clearTimeout(_0x1c7a20),await _0x1f6cbd['json']();}catch(_0xfd83d5){return{'success':![],'error':String(_0xfd83d5)};}}function formatTime(_0x4bff24){const _0x19ca04=a0_0x1238f3,_0x4fdf29=new Date(_0x4bff24);return String(_0x4fdf29[_0x19ca04(0x202)]())['padStart'](0x2,'0')+':'+String(_0x4fdf29[_0x19ca04(0x232)]())[_0x19ca04(0x214)](0x2,'0');}function createMessageElement(_0x5526df,_0x36aeb4){const _0x54d35f=a0_0x1238f3,_0x308f04=document['createElement'](_0x54d35f(0x237));_0x308f04[_0x54d35f(0x203)]=_0x54d35f(0x229)+_0x5526df[_0x54d35f(0x1f5)];const _0x2f8701=document['createElement']('div');_0x2f8701['className']=_0x54d35f(0x240),_0x2f8701[_0x54d35f(0x217)]=_0x5526df[_0x54d35f(0x216)][_0x54d35f(0x1f3)](/\n/g,_0x54d35f(0x201));const _0x123758=document[_0x54d35f(0x250)](_0x54d35f(0x237));_0x123758[_0x54d35f(0x203)]=_0x54d35f(0x1f2),_0x123758['innerHTML']=_0x54d35f(0x218),_0x123758['onclick']=_0x55da02=>{const _0x2fa66d=_0x54d35f;_0x55da02[_0x2fa66d(0x23c)](),confirmDelete(_0x36aeb4);};let _0x3e87a7;_0x2f8701[_0x54d35f(0x25f)](_0x54d35f(0x253),()=>_0x3e87a7=setTimeout(()=>{const _0x3e0494=_0x54d35f;_0x308f04[_0x3e0494(0x1fd)][_0x3e0494(0x230)](_0x3e0494(0x1fa));if(tg?.[_0x3e0494(0x20e)])tg[_0x3e0494(0x20e)][_0x3e0494(0x221)](_0x3e0494(0x1f8));},0x1f4)),_0x2f8701[_0x54d35f(0x25f)]('touchend',()=>clearTimeout(_0x3e87a7));const _0x5c8f92=document['createElement'](_0x54d35f(0x237));return _0x5c8f92[_0x54d35f(0x203)]='message-time',_0x5c8f92[_0x54d35f(0x1f9)]=formatTime(_0x5526df[_0x54d35f(0x209)]),_0x308f04[_0x54d35f(0x248)](_0x123758),_0x308f04[_0x54d35f(0x248)](_0x2f8701),_0x308f04[_0x54d35f(0x248)](_0x5c8f92),_0x308f04;}function createTypingIndicator(){const _0x242455=a0_0x1238f3,_0x187ec0=document[_0x242455(0x250)](_0x242455(0x237));return _0x187ec0[_0x242455(0x203)]='message\x20ai',_0x187ec0['id']=_0x242455(0x259),_0x187ec0[_0x242455(0x217)]=_0x242455(0x227),_0x187ec0;}function renderMessages(){const _0x3ebcc3=a0_0x1238f3;Array['from'](chatArea['children'])['forEach'](_0x2fa5cd=>{const _0x1c1e29=a0_0x35c7;if(_0x2fa5cd['id']!==_0x1c1e29(0x242))_0x2fa5cd[_0x1c1e29(0x247)]();}),messages[_0x3ebcc3(0x1f4)]>0x0?(emptyState['style'][_0x3ebcc3(0x238)]='none',messages[_0x3ebcc3(0x244)]((_0x142018,_0x491abf)=>chatArea[_0x3ebcc3(0x248)](createMessageElement(_0x142018,_0x491abf)))):emptyState['style']['display']=_0x3ebcc3(0x21a),requestAnimationFrame(()=>chatArea[_0x3ebcc3(0x23d)]=chatArea[_0x3ebcc3(0x22a)]);}function autoResizeTextarea(){const _0x2753b8=a0_0x1238f3;messageInput['style'][_0x2753b8(0x24c)]=_0x2753b8(0x23a),messageInput[_0x2753b8(0x24e)][_0x2753b8(0x24c)]=Math[_0x2753b8(0x261)](messageInput[_0x2753b8(0x22a)],0x78)+'px';}function updateSendButton(){const _0x35e9bd=a0_0x1238f3,_0x2db91f=messageInput[_0x35e9bd(0x212)]['trim']();sendBtn[_0x35e9bd(0x235)]=!_0x2db91f||isTyping;}async function sendMessage(){const _0x30ecb3=a0_0x1238f3,_0x41e631=messageInput[_0x30ecb3(0x212)][_0x30ecb3(0x245)]();if(!_0x41e631||isTyping)return;if(tg?.[_0x30ecb3(0x20e)])tg[_0x30ecb3(0x20e)][_0x30ecb3(0x221)](_0x30ecb3(0x210));messages['push']({'role':_0x30ecb3(0x22e),'content':_0x41e631,'timestamp':Date[_0x30ecb3(0x25a)]()}),localStorage['setItem'](_0x30ecb3(0x236),JSON[_0x30ecb3(0x204)](messages)),renderMessages(),messageInput[_0x30ecb3(0x212)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x30ecb3(0x248)](createTypingIndicator()),chatArea[_0x30ecb3(0x23d)]=chatArea[_0x30ecb3(0x22a)];const _0x131187=await callBackend('send_message',{'message':_0x41e631});isTyping=![];const _0x495967=document[_0x30ecb3(0x223)](_0x30ecb3(0x259));if(_0x495967)_0x495967[_0x30ecb3(0x247)]();let _0x21fec6=_0x30ecb3(0x1fb);if(_0x131187[_0x30ecb3(0x249)]){_0x21fec6=_0x131187[_0x30ecb3(0x239)]||'Пустой\x20ответ';if(tg?.[_0x30ecb3(0x20e)])tg[_0x30ecb3(0x20e)][_0x30ecb3(0x256)](_0x30ecb3(0x249));}else{_0x21fec6=_0x131187[_0x30ecb3(0x24a)]||_0x30ecb3(0x1f1);if(tg?.[_0x30ecb3(0x20e)])tg[_0x30ecb3(0x20e)][_0x30ecb3(0x256)](_0x30ecb3(0x24a));}messages[_0x30ecb3(0x24f)]({'role':'ai','content':_0x21fec6,'timestamp':Date[_0x30ecb3(0x25a)]()}),localStorage[_0x30ecb3(0x251)](_0x30ecb3(0x236),JSON[_0x30ecb3(0x204)](messages)),renderMessages();}function confirmDelete(_0x4ec99d){const _0x12dae2=a0_0x1238f3;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x12dae2(0x1f9)]='Действие\x20необратимо.';modalCallback=()=>{const _0x370355=_0x12dae2;messages['splice'](_0x4ec99d,0x1),localStorage[_0x370355(0x251)](_0x370355(0x236),JSON[_0x370355(0x204)](messages)),renderMessages();},modal[_0x12dae2(0x1fd)][_0x12dae2(0x230)](_0x12dae2(0x243));}if(clearBtn)clearBtn[a0_0x1238f3(0x255)]=()=>{const _0x12c10d=a0_0x1238f3;if(!messages['length'])return;if(mTitle)mTitle[_0x12c10d(0x1f9)]=_0x12c10d(0x262);if(mText)mText[_0x12c10d(0x1f9)]=_0x12c10d(0x225);modalCallback=async()=>{messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x12c10d(0x1fd)][_0x12c10d(0x230)]('show');};document[a0_0x1238f3(0x223)](a0_0x1238f3(0x21e))[a0_0x1238f3(0x255)]=()=>modal[a0_0x1238f3(0x1fd)][a0_0x1238f3(0x247)](a0_0x1238f3(0x243)),document[a0_0x1238f3(0x223)](a0_0x1238f3(0x23b))[a0_0x1238f3(0x255)]=()=>{const _0x3609dd=a0_0x1238f3;if(modalCallback)modalCallback();modal[_0x3609dd(0x1fd)][_0x3609dd(0x247)](_0x3609dd(0x243));},messageInput[a0_0x1238f3(0x25f)](a0_0x1238f3(0x231),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1238f3(0x25f)](a0_0x1238f3(0x1ff),_0xff1fc4=>{const _0x37d3ad=a0_0x1238f3;_0xff1fc4['key']===_0x37d3ad(0x23e)&&!_0xff1fc4[_0x37d3ad(0x22b)]&&(_0xff1fc4['preventDefault'](),sendMessage());}),sendBtn[a0_0x1238f3(0x255)]=sendMessage,document['addEventListener']('click',_0x1d109a=>{const _0x3b425e=a0_0x1238f3;document[_0x3b425e(0x24b)](_0x3b425e(0x205))[_0x3b425e(0x244)](_0x21c38b=>{const _0x171dc3=_0x3b425e;if(!_0x21c38b['contains'](_0x1d109a[_0x171dc3(0x219)]))_0x21c38b[_0x171dc3(0x1fd)][_0x171dc3(0x247)](_0x171dc3(0x1fa));});});const saved=localStorage[a0_0x1238f3(0x21c)](a0_0x1238f3(0x236));if(saved)try{messages=JSON[a0_0x1238f3(0x246)](saved),renderMessages();}catch(a0_0x25b896){}updateSendButton();