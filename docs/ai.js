const a0_0x5a61b0=a0_0x1ef1;(function(_0x1e2ca2,_0x1ae425){const _0x475870=a0_0x1ef1,_0x5f4023=_0x1e2ca2();while(!![]){try{const _0x309a82=-parseInt(_0x475870(0x14f))/0x1*(-parseInt(_0x475870(0x114))/0x2)+-parseInt(_0x475870(0x15d))/0x3*(parseInt(_0x475870(0x115))/0x4)+-parseInt(_0x475870(0x10a))/0x5+-parseInt(_0x475870(0x128))/0x6+-parseInt(_0x475870(0x11a))/0x7*(-parseInt(_0x475870(0x12f))/0x8)+parseInt(_0x475870(0x13d))/0x9*(-parseInt(_0x475870(0x132))/0xa)+parseInt(_0x475870(0x111))/0xb*(parseInt(_0x475870(0x135))/0xc);if(_0x309a82===_0x1ae425)break;else _0x5f4023['push'](_0x5f4023['shift']());}catch(_0x4a412e){_0x5f4023['push'](_0x5f4023['shift']());}}}(a0_0x325c,0x46cd2));const tg=window['Telegram']?.[a0_0x5a61b0(0x110)],HOME_URL=a0_0x5a61b0(0x13b);function setupTelegramBackButton(){const _0x4abbe8=a0_0x5a61b0;if(!tg)return;try{tg['ready'](),tg[_0x4abbe8(0x109)](),tg['setHeaderColor']?.(_0x4abbe8(0x124));if(tg[_0x4abbe8(0x155)]?.(_0x4abbe8(0x120)))tg[_0x4abbe8(0x154)]?.();const _0x49c32e=tg[_0x4abbe8(0x104)];if(_0x49c32e){_0x49c32e[_0x4abbe8(0x157)]();if(typeof _0x49c32e[_0x4abbe8(0xf8)]==='function')try{_0x49c32e['offClick']();}catch(_0x370f53){}_0x49c32e[_0x4abbe8(0xe2)](()=>{const _0x2a98ec=_0x4abbe8;if(tg[_0x2a98ec(0x117)])tg[_0x2a98ec(0x117)][_0x2a98ec(0x107)](_0x2a98ec(0x10e));location[_0x2a98ec(0xf6)]=HOME_URL;});}}catch(_0x2ec787){console['warn'](_0x4abbe8(0x13c),_0x2ec787);}}(function initStableLayout(){const _0x3b473f=a0_0x5a61b0,_0x742f41=(function(){let _0x53013b=!![];return function(_0x2f1766,_0x564f09){const _0x5415ce=_0x53013b?function(){const _0x291aa3=a0_0x1ef1;if(_0x564f09){const _0xbfbb38=_0x564f09[_0x291aa3(0x148)](_0x2f1766,arguments);return _0x564f09=null,_0xbfbb38;}}:function(){};return _0x53013b=![],_0x5415ce;};}()),_0x29a042=document['querySelector'](_0x3b473f(0x149)),_0x1b6e11=document[_0x3b473f(0x159)](_0x3b473f(0xef)),_0x2cab11=document[_0x3b473f(0x159)](_0x3b473f(0xf1)),_0x352953=document[_0x3b473f(0x159)](_0x3b473f(0x160));function _0x41e4b7(){const _0x41a7b2=_0x3b473f,_0x2569a7=_0x742f41(this,function(){const _0x39d077=a0_0x1ef1;return _0x2569a7[_0x39d077(0x142)]()[_0x39d077(0xff)](_0x39d077(0xfe))[_0x39d077(0x142)]()[_0x39d077(0x11b)](_0x2569a7)[_0x39d077(0xff)]('(((.+)+)+)+$');});_0x2569a7();if(!_0x29a042)return;const _0x39449b=tg&&tg[_0x41a7b2(0x118)]?tg[_0x41a7b2(0x118)]:window[_0x41a7b2(0x127)];_0x29a042[_0x41a7b2(0xea)][_0x41a7b2(0x102)]=_0x39449b+'px';if(_0x1b6e11){const _0x90d495=_0x1b6e11[_0x41a7b2(0x15f)];_0x2cab11[_0x41a7b2(0xea)]['paddingBottom']=_0x90d495+0x28+'px';}}tg?tg['onEvent'](_0x3b473f(0x14a),({isStateStable:_0x3f2cb8})=>{_0x41e4b7();if(_0x3f2cb8)requestAnimationFrame(()=>{const _0x3f4a5e=a0_0x1ef1;_0x2cab11[_0x3f4a5e(0x123)]=_0x2cab11[_0x3f4a5e(0xf4)];});}):window[_0x3b473f(0xe1)](_0x3b473f(0x136),_0x41e4b7),_0x41e4b7(),_0x352953&&(_0x352953[_0x3b473f(0xe1)]('input',()=>{requestAnimationFrame(_0x41e4b7);}),_0x352953[_0x3b473f(0xe1)](_0x3b473f(0x134),()=>{setTimeout(()=>{const _0x126d28=a0_0x1ef1;_0x2cab11[_0x126d28(0x123)]=_0x2cab11[_0x126d28(0xf4)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x1ef1(_0x107ddb,_0x5bb19a){_0x107ddb=_0x107ddb-0xe1;const _0x440123=a0_0x325c();let _0x3ede7c=_0x440123[_0x107ddb];return _0x3ede7c;}const BACKEND_URL=a0_0x5a61b0(0x12d),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x5a61b0(0x159)](a0_0x5a61b0(0xf1)),emptyState=document[a0_0x5a61b0(0x159)](a0_0x5a61b0(0x137)),messageInput=document[a0_0x5a61b0(0x159)](a0_0x5a61b0(0x160)),sendBtn=document['getElementById'](a0_0x5a61b0(0x14e)),clearBtn=document[a0_0x5a61b0(0x159)](a0_0x5a61b0(0xec)),modal=document[a0_0x5a61b0(0x159)](a0_0x5a61b0(0x103)),mTitle=document['getElementById'](a0_0x5a61b0(0xe3)),mText=document[a0_0x5a61b0(0x159)](a0_0x5a61b0(0x10b));let modalCallback=null;async function callBackend(_0x38313e,_0x54d7ca){const _0x333e79=a0_0x5a61b0,_0x21ec0b=tg?.[_0x333e79(0x101)]?.[_0x333e79(0x10c)]||{},_0x140f2b=_0x21ec0b['id']||localStorage[_0x333e79(0x15c)](_0x333e79(0xed))||'d-'+Math[_0x333e79(0xe5)](Math[_0x333e79(0x122)]()*0x3b9aca00);if(!_0x21ec0b['id'])localStorage[_0x333e79(0xf0)](_0x333e79(0xed),_0x140f2b);const _0x3dfa22={'action':_0x38313e,'user_id':_0x140f2b,'user_data':{'first_name':_0x21ec0b['first_name'],'username':_0x21ec0b[_0x333e79(0x133)]},'init_data':tg?.[_0x333e79(0x12a)]||'',..._0x54d7ca},_0x54e498=new AbortController(),_0x1b5859=setTimeout(()=>_0x54e498['abort'](),REQUEST_TIMEOUT_MS);try{const _0x2d3b97=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x333e79(0x150)](_0x3dfa22),'signal':_0x54e498[_0x333e79(0x12b)]});return clearTimeout(_0x1b5859),await _0x2d3b97['json']();}catch(_0x27456d){return{'success':![],'error':String(_0x27456d)};}}function formatTime(_0x4e6297){const _0x3e0d32=a0_0x5a61b0,_0x3d1ee7=new Date(_0x4e6297);return String(_0x3d1ee7[_0x3e0d32(0xf2)]())[_0x3e0d32(0xe7)](0x2,'0')+':'+String(_0x3d1ee7[_0x3e0d32(0x15b)]())['padStart'](0x2,'0');}function createMessageElement(_0x2b36fd,_0x5148f7){const _0x5d1470=a0_0x5a61b0,_0x5f07e0=document[_0x5d1470(0x130)]('div');_0x5f07e0[_0x5d1470(0x152)]='message\x20'+_0x2b36fd['role'];const _0x1fc637=document['createElement'](_0x5d1470(0x145));_0x1fc637[_0x5d1470(0x152)]=_0x5d1470(0x10f),_0x1fc637[_0x5d1470(0xf9)]=_0x2b36fd['content'][_0x5d1470(0x15a)](/\n/g,_0x5d1470(0x146));const _0x537034=document[_0x5d1470(0x130)](_0x5d1470(0x145));_0x537034['className']=_0x5d1470(0x129),_0x537034['innerHTML']=_0x5d1470(0xfb),_0x537034[_0x5d1470(0x105)]=_0x5125e4=>{const _0x51a183=_0x5d1470;_0x5125e4[_0x51a183(0x13e)](),confirmDelete(_0x5148f7);};let _0x578d58;_0x1fc637[_0x5d1470(0xe1)](_0x5d1470(0x131),()=>_0x578d58=setTimeout(()=>{const _0x36bf01=_0x5d1470;_0x5f07e0[_0x36bf01(0x112)][_0x36bf01(0xf5)](_0x36bf01(0x147));if(tg?.[_0x36bf01(0x117)])tg[_0x36bf01(0x117)][_0x36bf01(0x107)]('medium');},0x1f4)),_0x1fc637[_0x5d1470(0xe1)]('touchend',()=>clearTimeout(_0x578d58));const _0x3f0657=document[_0x5d1470(0x130)](_0x5d1470(0x145));return _0x3f0657[_0x5d1470(0x152)]=_0x5d1470(0x100),_0x3f0657[_0x5d1470(0x13a)]=formatTime(_0x2b36fd['timestamp']),_0x5f07e0[_0x5d1470(0x119)](_0x537034),_0x5f07e0[_0x5d1470(0x119)](_0x1fc637),_0x5f07e0[_0x5d1470(0x119)](_0x3f0657),_0x5f07e0;}function createTypingIndicator(){const _0x34851b=a0_0x5a61b0,_0x557baa=document[_0x34851b(0x130)]('div');return _0x557baa[_0x34851b(0x152)]=_0x34851b(0x156),_0x557baa['id']='typingIndicator',_0x557baa['innerHTML']=_0x34851b(0x13f),_0x557baa;}function a0_0x325c(){const _0x15a367=['onclick','Начнется\x20новый\x20диалог.','impactOccurred','notificationOccurred','expand','998490xsXoUr','modalText','user','Удалить?','light','message-bubble','WebApp','4722234WlHGbh','classList','error','800354WjJnze','332huTvHZ','disabled','HapticFeedback','viewportHeight','appendChild','7wbxdLa','constructor','min','Очистить\x20историю?','none','ai_chat_messages','6.1','flex','random','scrollTop','#050505','send_message','text','innerHeight','168924ouIxec','delete-btn','initData','signal','preventDefault','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','push','2129224kbgAHw','createElement','touchstart','20bJojJD','username','focus','12GJuiQh','resize','emptyState','success','contains','textContent','./router.html','TG\x20setup\x20error:','2496879gfKYsA','stopPropagation','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','shiftKey','keydown','toString','parse','clear_history','div','<br>','show-delete','apply','.container','viewportChanged','now','display','removeItem','sendBtn','1ltufuy','stringify','splice','className','modalConfirm','disableVerticalSwipes','isVersionAtLeast','message\x20ai','show','trim','getElementById','replace','getMinutes','getItem','828FKtgca','length','offsetHeight','messageInput','addEventListener','onClick','modalTitle','key','floor','Ошибка\x20сети','padStart','.message.show-delete','Действие\x20необратимо.','style','forEach','clearBtn','debug_uid','click','inputArea','setItem','chatArea','getHours','children','scrollHeight','add','href','remove','offClick','innerHTML','target','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','value','Ошибка\x20сервера','(((.+)+)+)+$','search','message-time','initDataUnsafe','height','confirmModal','BackButton'];a0_0x325c=function(){return _0x15a367;};return a0_0x325c();}function renderMessages(){const _0x1100be=a0_0x5a61b0;Array['from'](chatArea[_0x1100be(0xf3)])['forEach'](_0xcf3656=>{const _0x3b77d5=_0x1100be;if(_0xcf3656['id']!==_0x3b77d5(0x137))_0xcf3656[_0x3b77d5(0xf7)]();}),messages[_0x1100be(0x15e)]>0x0?(emptyState[_0x1100be(0xea)][_0x1100be(0x14c)]=_0x1100be(0x11e),messages[_0x1100be(0xeb)]((_0x2aa34,_0x2add4a)=>chatArea[_0x1100be(0x119)](createMessageElement(_0x2aa34,_0x2add4a)))):emptyState[_0x1100be(0xea)][_0x1100be(0x14c)]=_0x1100be(0x121),requestAnimationFrame(()=>chatArea[_0x1100be(0x123)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x4ff975=a0_0x5a61b0;messageInput[_0x4ff975(0xea)][_0x4ff975(0x102)]='auto',messageInput[_0x4ff975(0xea)][_0x4ff975(0x102)]=Math[_0x4ff975(0x11c)](messageInput[_0x4ff975(0xf4)],0x78)+'px';}function updateSendButton(){const _0x26158a=a0_0x5a61b0,_0x2e3ac1=messageInput[_0x26158a(0xfc)]['trim']();sendBtn[_0x26158a(0x116)]=!_0x2e3ac1||isTyping;}async function sendMessage(){const _0x4d7028=a0_0x5a61b0,_0x440c23=messageInput[_0x4d7028(0xfc)][_0x4d7028(0x158)]();if(!_0x440c23||isTyping)return;if(tg?.[_0x4d7028(0x117)])tg[_0x4d7028(0x117)]['impactOccurred'](_0x4d7028(0x10e));messages[_0x4d7028(0x12e)]({'role':_0x4d7028(0x10c),'content':_0x440c23,'timestamp':Date[_0x4d7028(0x14b)]()}),localStorage[_0x4d7028(0xf0)]('ai_chat_messages',JSON[_0x4d7028(0x150)](messages)),renderMessages(),messageInput[_0x4d7028(0xfc)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4d7028(0x119)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x4d7028(0xf4)];const _0x3bf1fe=await callBackend(_0x4d7028(0x125),{'message':_0x440c23});isTyping=![];const _0x38bfd0=document[_0x4d7028(0x159)]('typingIndicator');if(_0x38bfd0)_0x38bfd0[_0x4d7028(0xf7)]();let _0x43fe35=_0x4d7028(0xe6);if(_0x3bf1fe['success']){_0x43fe35=_0x3bf1fe[_0x4d7028(0x126)]||'Пустой\x20ответ';if(tg?.[_0x4d7028(0x117)])tg['HapticFeedback'][_0x4d7028(0x108)](_0x4d7028(0x138));}else{_0x43fe35=_0x3bf1fe[_0x4d7028(0x113)]||_0x4d7028(0xfd);if(tg?.['HapticFeedback'])tg[_0x4d7028(0x117)][_0x4d7028(0x108)](_0x4d7028(0x113));}messages[_0x4d7028(0x12e)]({'role':'ai','content':_0x43fe35,'timestamp':Date[_0x4d7028(0x14b)]()}),localStorage[_0x4d7028(0xf0)]('ai_chat_messages',JSON[_0x4d7028(0x150)](messages)),renderMessages();}function confirmDelete(_0x5b59a3){const _0x3efdaa=a0_0x5a61b0;if(mTitle)mTitle[_0x3efdaa(0x13a)]=_0x3efdaa(0x10d);if(mText)mText['textContent']=_0x3efdaa(0xe9);modalCallback=()=>{const _0x5afc82=_0x3efdaa;messages[_0x5afc82(0x151)](_0x5b59a3,0x1),localStorage[_0x5afc82(0xf0)](_0x5afc82(0x11f),JSON['stringify'](messages)),renderMessages();},modal[_0x3efdaa(0x112)][_0x3efdaa(0xf5)]('show');}if(clearBtn)clearBtn[a0_0x5a61b0(0x105)]=()=>{const _0x1c8188=a0_0x5a61b0;if(!messages[_0x1c8188(0x15e)])return;if(mTitle)mTitle[_0x1c8188(0x13a)]=_0x1c8188(0x11d);if(mText)mText[_0x1c8188(0x13a)]=_0x1c8188(0x106);modalCallback=async()=>{const _0x4370d9=_0x1c8188;messages=[],localStorage[_0x4370d9(0x14d)](_0x4370d9(0x11f)),renderMessages(),callBackend(_0x4370d9(0x144),{});},modal[_0x1c8188(0x112)][_0x1c8188(0xf5)]('show');};document[a0_0x5a61b0(0x159)]('modalCancel')['onclick']=()=>modal[a0_0x5a61b0(0x112)][a0_0x5a61b0(0xf7)](a0_0x5a61b0(0x157)),document[a0_0x5a61b0(0x159)](a0_0x5a61b0(0x153))[a0_0x5a61b0(0x105)]=()=>{const _0xc03c81=a0_0x5a61b0;if(modalCallback)modalCallback();modal[_0xc03c81(0x112)]['remove'](_0xc03c81(0x157));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x5a61b0(0xe1)](a0_0x5a61b0(0x141),_0xcfa9cf=>{const _0x14b4ef=a0_0x5a61b0;_0xcfa9cf[_0x14b4ef(0xe4)]==='Enter'&&!_0xcfa9cf[_0x14b4ef(0x140)]&&(_0xcfa9cf[_0x14b4ef(0x12c)](),sendMessage());}),sendBtn[a0_0x5a61b0(0x105)]=sendMessage,document['addEventListener'](a0_0x5a61b0(0xee),_0x3fac9a=>{const _0x34d32f=a0_0x5a61b0;document['querySelectorAll'](_0x34d32f(0xe8))[_0x34d32f(0xeb)](_0x13d151=>{const _0x54c1ff=_0x34d32f;if(!_0x13d151[_0x54c1ff(0x139)](_0x3fac9a[_0x54c1ff(0xfa)]))_0x13d151[_0x54c1ff(0x112)][_0x54c1ff(0xf7)](_0x54c1ff(0x147));});});const saved=localStorage[a0_0x5a61b0(0x15c)](a0_0x5a61b0(0x11f));if(saved)try{messages=JSON[a0_0x5a61b0(0x143)](saved),renderMessages();}catch(a0_0x168cb4){}updateSendButton();