function a0_0xf765(){const _0x524d8c=['chatArea','user','addEventListener','none','disabled','Очистить\x20историю?','signal','href','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','viewportHeight','delete-btn','height','replace','sendBtn','setItem','onclick','expand','timestamp','function','message\x20','key','createElement','message-bubble','./router.html','POST','scrollTop','offsetHeight','confirmModal','forEach','onClick','isVersionAtLeast','textContent','emptyState','success','target','input','click','push','constructor','1811117ioUNCV','style','stopPropagation','.container','text','ready','modalConfirm','HapticFeedback','BackButton','stringify','Ошибка\x20сервера','parse','add','username','innerHTML','notificationOccurred','querySelectorAll','show','getHours','apply','json','toString','message-time','offClick','impactOccurred','modalText','typingIndicator','clear_history','(((.+)+)+)+$','light','1379199sQHJHx','WebApp','<br>','className','appendChild','getElementById','keydown','getItem','clearBtn','classList','Начнется\x20новый\x20диалог.','#050505','flex','send_message','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','error','search','4149640treSTM','splice','112uCuHUo','viewportChanged','modalTitle','Удалить?','debug_uid','abort','display','preventDefault','4383170IwblWa','children','messageInput','role','medium','getMinutes','9287214CsLzkQ','2907872NuZPhq','padStart','message\x20ai','first_name','onEvent','trim','div','touchend','touchstart','1399873aaEGPP','ai_chat_messages','focus','scrollHeight','remove','contains','value','show-delete','now','length'];a0_0xf765=function(){return _0x524d8c;};return a0_0xf765();}const a0_0x384387=a0_0xbf27;(function(_0x2c39cd,_0x341ac1){const _0x3bb907=a0_0xbf27,_0x132e5b=_0x2c39cd();while(!![]){try{const _0x285119=-parseInt(_0x3bb907(0x158))/0x1+-parseInt(_0x3bb907(0x14f))/0x2+parseInt(_0x3bb907(0x1a7))/0x3+-parseInt(_0x3bb907(0x13e))/0x4+-parseInt(_0x3bb907(0x148))/0x5+parseInt(_0x3bb907(0x14e))/0x6+-parseInt(_0x3bb907(0x189))/0x7*(-parseInt(_0x3bb907(0x140))/0x8);if(_0x285119===_0x341ac1)break;else _0x132e5b['push'](_0x132e5b['shift']());}catch(_0x2f7cab){_0x132e5b['push'](_0x132e5b['shift']());}}}(a0_0xf765,0xd271f));const tg=window['Telegram']?.[a0_0x384387(0x1a8)],HOME_URL=a0_0x384387(0x179);function setupTelegramBackButton(){const _0x3a6632=a0_0x384387,_0x4f4311=(function(){let _0xcca26b=!![];return function(_0xe7d746,_0x43f6d8){const _0x3e3d19=_0xcca26b?function(){const _0x366c87=a0_0xbf27;if(_0x43f6d8){const _0x108e6f=_0x43f6d8[_0x366c87(0x19c)](_0xe7d746,arguments);return _0x43f6d8=null,_0x108e6f;}}:function(){};return _0xcca26b=![],_0x3e3d19;};}()),_0x4d08b6=_0x4f4311(this,function(){const _0x2b5ac8=a0_0xbf27;return _0x4d08b6[_0x2b5ac8(0x19e)]()['search'](_0x2b5ac8(0x1a5))[_0x2b5ac8(0x19e)]()[_0x2b5ac8(0x188)](_0x4d08b6)[_0x2b5ac8(0x13d)]('(((.+)+)+)+$');});_0x4d08b6();if(!tg)return;try{tg[_0x3a6632(0x18e)](),tg[_0x3a6632(0x172)](),tg['setHeaderColor']?.(_0x3a6632(0x1b2));if(tg[_0x3a6632(0x180)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0xd34c8b=tg[_0x3a6632(0x191)];if(_0xd34c8b){_0xd34c8b[_0x3a6632(0x19a)]();if(typeof _0xd34c8b[_0x3a6632(0x1a0)]===_0x3a6632(0x174))try{_0xd34c8b[_0x3a6632(0x1a0)]();}catch(_0x36133e){}_0xd34c8b[_0x3a6632(0x17f)](()=>{const _0x261930=_0x3a6632;if(tg[_0x261930(0x190)])tg[_0x261930(0x190)][_0x261930(0x1a1)](_0x261930(0x1a6));location[_0x261930(0x169)]=HOME_URL;});}}catch(_0x107fb3){console['warn']('TG\x20setup\x20error:',_0x107fb3);}}(function initStableLayout(){const _0x5b7d37=a0_0x384387,_0x3a6679=document['querySelector'](_0x5b7d37(0x18c)),_0x479c9b=document[_0x5b7d37(0x1ac)]('inputArea'),_0x1bf047=document[_0x5b7d37(0x1ac)](_0x5b7d37(0x162)),_0x47b2ed=document[_0x5b7d37(0x1ac)](_0x5b7d37(0x14a));function _0x2e16ed(){const _0x47752f=_0x5b7d37;if(!_0x3a6679)return;const _0x2b3264=tg&&tg[_0x47752f(0x16b)]?tg[_0x47752f(0x16b)]:window['innerHeight'];_0x3a6679[_0x47752f(0x18a)][_0x47752f(0x16d)]=_0x2b3264+'px';if(_0x479c9b){const _0xc378aa=_0x479c9b[_0x47752f(0x17c)];_0x1bf047[_0x47752f(0x18a)]['paddingBottom']=_0xc378aa+0x28+'px';}}tg?tg[_0x5b7d37(0x153)](_0x5b7d37(0x141),({isStateStable:_0x5943e0})=>{_0x2e16ed();if(_0x5943e0)requestAnimationFrame(()=>{const _0x5acc78=a0_0xbf27;_0x1bf047[_0x5acc78(0x17b)]=_0x1bf047['scrollHeight'];});}):window['addEventListener']('resize',_0x2e16ed),_0x2e16ed(),_0x47b2ed&&(_0x47b2ed[_0x5b7d37(0x164)](_0x5b7d37(0x185),()=>{requestAnimationFrame(_0x2e16ed);}),_0x47b2ed[_0x5b7d37(0x164)](_0x5b7d37(0x15a),()=>{setTimeout(()=>{const _0x53562c=a0_0xbf27;_0x1bf047['scrollTop']=_0x1bf047[_0x53562c(0x15b)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x384387(0x1b5),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x384387(0x1ac)](a0_0x384387(0x162)),emptyState=document[a0_0x384387(0x1ac)](a0_0x384387(0x182)),messageInput=document['getElementById'](a0_0x384387(0x14a)),sendBtn=document[a0_0x384387(0x1ac)](a0_0x384387(0x16f)),clearBtn=document['getElementById'](a0_0x384387(0x1af)),modal=document[a0_0x384387(0x1ac)](a0_0x384387(0x17d)),mTitle=document[a0_0x384387(0x1ac)](a0_0x384387(0x142)),mText=document[a0_0x384387(0x1ac)](a0_0x384387(0x1a2));let modalCallback=null;async function callBackend(_0x396f06,_0x57bd5a){const _0x352c40=a0_0x384387,_0x1ef28e=tg?.['initDataUnsafe']?.['user']||{},_0x35ddb4=_0x1ef28e['id']||localStorage[_0x352c40(0x1ae)](_0x352c40(0x144))||'d-'+Math['floor'](Math['random']()*0x3b9aca00);if(!_0x1ef28e['id'])localStorage['setItem'](_0x352c40(0x144),_0x35ddb4);const _0x5d8c2f={'action':_0x396f06,'user_id':_0x35ddb4,'user_data':{'first_name':_0x1ef28e[_0x352c40(0x152)],'username':_0x1ef28e[_0x352c40(0x196)]},'init_data':tg?.['initData']||'',..._0x57bd5a},_0x34eab1=new AbortController(),_0x3b792c=setTimeout(()=>_0x34eab1[_0x352c40(0x145)](),REQUEST_TIMEOUT_MS);try{const _0x441489=await fetch(BACKEND_URL,{'method':_0x352c40(0x17a),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x352c40(0x192)](_0x5d8c2f),'signal':_0x34eab1[_0x352c40(0x168)]});return clearTimeout(_0x3b792c),await _0x441489[_0x352c40(0x19d)]();}catch(_0xc161a3){return{'success':![],'error':String(_0xc161a3)};}}function formatTime(_0xfc252b){const _0x79c6a=a0_0x384387,_0x46c55e=new Date(_0xfc252b);return String(_0x46c55e[_0x79c6a(0x19b)]())[_0x79c6a(0x150)](0x2,'0')+':'+String(_0x46c55e[_0x79c6a(0x14d)]())[_0x79c6a(0x150)](0x2,'0');}function createMessageElement(_0x43216e,_0x538e5e){const _0x55a6b5=a0_0x384387,_0x37fb48=document['createElement']('div');_0x37fb48[_0x55a6b5(0x1aa)]=_0x55a6b5(0x175)+_0x43216e[_0x55a6b5(0x14b)];const _0x37d290=document[_0x55a6b5(0x177)](_0x55a6b5(0x155));_0x37d290[_0x55a6b5(0x1aa)]=_0x55a6b5(0x178),_0x37d290[_0x55a6b5(0x197)]=_0x43216e['content'][_0x55a6b5(0x16e)](/\n/g,_0x55a6b5(0x1a9));const _0xbd0eec=document['createElement']('div');_0xbd0eec[_0x55a6b5(0x1aa)]=_0x55a6b5(0x16c),_0xbd0eec[_0x55a6b5(0x197)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0xbd0eec[_0x55a6b5(0x171)]=_0x2c8224=>{const _0x1971f1=_0x55a6b5;_0x2c8224[_0x1971f1(0x18b)](),confirmDelete(_0x538e5e);};let _0x499259;_0x37d290[_0x55a6b5(0x164)](_0x55a6b5(0x157),()=>_0x499259=setTimeout(()=>{const _0x3a36f5=_0x55a6b5;_0x37fb48['classList'][_0x3a36f5(0x195)](_0x3a36f5(0x15f));if(tg?.[_0x3a36f5(0x190)])tg['HapticFeedback'][_0x3a36f5(0x1a1)](_0x3a36f5(0x14c));},0x1f4)),_0x37d290[_0x55a6b5(0x164)](_0x55a6b5(0x156),()=>clearTimeout(_0x499259));const _0x198680=document[_0x55a6b5(0x177)](_0x55a6b5(0x155));return _0x198680[_0x55a6b5(0x1aa)]=_0x55a6b5(0x19f),_0x198680[_0x55a6b5(0x181)]=formatTime(_0x43216e[_0x55a6b5(0x173)]),_0x37fb48[_0x55a6b5(0x1ab)](_0xbd0eec),_0x37fb48[_0x55a6b5(0x1ab)](_0x37d290),_0x37fb48['appendChild'](_0x198680),_0x37fb48;}function createTypingIndicator(){const _0x3f8b39=a0_0x384387,_0x1ca175=document[_0x3f8b39(0x177)](_0x3f8b39(0x155));return _0x1ca175['className']=_0x3f8b39(0x151),_0x1ca175['id']=_0x3f8b39(0x1a3),_0x1ca175[_0x3f8b39(0x197)]=_0x3f8b39(0x16a),_0x1ca175;}function renderMessages(){const _0x121d60=a0_0x384387;Array['from'](chatArea[_0x121d60(0x149)])[_0x121d60(0x17e)](_0x4d9b3d=>{const _0x2eaa85=_0x121d60;if(_0x4d9b3d['id']!==_0x2eaa85(0x182))_0x4d9b3d[_0x2eaa85(0x15c)]();}),messages[_0x121d60(0x161)]>0x0?(emptyState['style'][_0x121d60(0x146)]=_0x121d60(0x165),messages[_0x121d60(0x17e)]((_0x3d0826,_0x517898)=>chatArea['appendChild'](createMessageElement(_0x3d0826,_0x517898)))):emptyState[_0x121d60(0x18a)][_0x121d60(0x146)]=_0x121d60(0x1b3),requestAnimationFrame(()=>chatArea[_0x121d60(0x17b)]=chatArea[_0x121d60(0x15b)]);}function autoResizeTextarea(){const _0x421ab9=a0_0x384387;messageInput[_0x421ab9(0x18a)][_0x421ab9(0x16d)]='auto',messageInput[_0x421ab9(0x18a)]['height']=Math['min'](messageInput[_0x421ab9(0x15b)],0x78)+'px';}function updateSendButton(){const _0x341478=a0_0x384387,_0xf56b3b=messageInput[_0x341478(0x15e)][_0x341478(0x154)]();sendBtn[_0x341478(0x166)]=!_0xf56b3b||isTyping;}async function sendMessage(){const _0x2f3f44=a0_0x384387,_0x2436c1=messageInput[_0x2f3f44(0x15e)][_0x2f3f44(0x154)]();if(!_0x2436c1||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x2f3f44(0x190)][_0x2f3f44(0x1a1)](_0x2f3f44(0x1a6));messages[_0x2f3f44(0x187)]({'role':_0x2f3f44(0x163),'content':_0x2436c1,'timestamp':Date[_0x2f3f44(0x160)]()}),localStorage['setItem']('ai_chat_messages',JSON['stringify'](messages)),renderMessages(),messageInput[_0x2f3f44(0x15e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x2f3f44(0x1ab)](createTypingIndicator()),chatArea[_0x2f3f44(0x17b)]=chatArea[_0x2f3f44(0x15b)];const _0x2185bf=await callBackend(_0x2f3f44(0x1b4),{'message':_0x2436c1});isTyping=![];const _0x50edb3=document[_0x2f3f44(0x1ac)]('typingIndicator');if(_0x50edb3)_0x50edb3[_0x2f3f44(0x15c)]();let _0x4ba9d8='Ошибка\x20сети';if(_0x2185bf[_0x2f3f44(0x183)]){_0x4ba9d8=_0x2185bf[_0x2f3f44(0x18d)]||'Пустой\x20ответ';if(tg?.[_0x2f3f44(0x190)])tg['HapticFeedback'][_0x2f3f44(0x198)](_0x2f3f44(0x183));}else{_0x4ba9d8=_0x2185bf[_0x2f3f44(0x1b6)]||_0x2f3f44(0x193);if(tg?.['HapticFeedback'])tg[_0x2f3f44(0x190)][_0x2f3f44(0x198)](_0x2f3f44(0x1b6));}messages[_0x2f3f44(0x187)]({'role':'ai','content':_0x4ba9d8,'timestamp':Date['now']()}),localStorage[_0x2f3f44(0x170)](_0x2f3f44(0x159),JSON[_0x2f3f44(0x192)](messages)),renderMessages();}function confirmDelete(_0x41ac7d){const _0x587b65=a0_0x384387;if(mTitle)mTitle['textContent']=_0x587b65(0x143);if(mText)mText['textContent']='Действие\x20необратимо.';modalCallback=()=>{const _0x2cad67=_0x587b65;messages[_0x2cad67(0x13f)](_0x41ac7d,0x1),localStorage['setItem'](_0x2cad67(0x159),JSON[_0x2cad67(0x192)](messages)),renderMessages();},modal[_0x587b65(0x1b0)]['add'](_0x587b65(0x19a));}if(clearBtn)clearBtn['onclick']=()=>{const _0x40f86a=a0_0x384387;if(!messages[_0x40f86a(0x161)])return;if(mTitle)mTitle['textContent']=_0x40f86a(0x167);if(mText)mText[_0x40f86a(0x181)]=_0x40f86a(0x1b1);modalCallback=async()=>{const _0x592cca=_0x40f86a;messages=[],localStorage['removeItem'](_0x592cca(0x159)),renderMessages(),callBackend(_0x592cca(0x1a4),{});},modal['classList']['add']('show');};document[a0_0x384387(0x1ac)]('modalCancel')[a0_0x384387(0x171)]=()=>modal[a0_0x384387(0x1b0)]['remove'](a0_0x384387(0x19a)),document[a0_0x384387(0x1ac)](a0_0x384387(0x18f))['onclick']=()=>{const _0xe960bf=a0_0x384387;if(modalCallback)modalCallback();modal[_0xe960bf(0x1b0)]['remove'](_0xe960bf(0x19a));},messageInput['addEventListener'](a0_0x384387(0x185),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x384387(0x164)](a0_0x384387(0x1ad),_0x237b93=>{const _0x37ccac=a0_0x384387;_0x237b93[_0x37ccac(0x176)]==='Enter'&&!_0x237b93['shiftKey']&&(_0x237b93[_0x37ccac(0x147)](),sendMessage());}),sendBtn[a0_0x384387(0x171)]=sendMessage,document[a0_0x384387(0x164)](a0_0x384387(0x186),_0x256f9a=>{const _0x237c96=a0_0x384387;document[_0x237c96(0x199)]('.message.show-delete')[_0x237c96(0x17e)](_0x39e333=>{const _0x39dae7=_0x237c96;if(!_0x39e333[_0x39dae7(0x15d)](_0x256f9a[_0x39dae7(0x184)]))_0x39e333[_0x39dae7(0x1b0)][_0x39dae7(0x15c)](_0x39dae7(0x15f));});});const saved=localStorage['getItem'](a0_0x384387(0x159));if(saved)try{messages=JSON[a0_0x384387(0x194)](saved),renderMessages();}catch(a0_0x5474d9){}function a0_0xbf27(_0x3351e7,_0xc542f2){_0x3351e7=_0x3351e7-0x13d;const _0x3783b4=a0_0xf765();let _0x4468aa=_0x3783b4[_0x3351e7];return _0x4468aa;}updateSendButton();