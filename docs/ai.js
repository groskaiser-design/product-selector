const a0_0x53dafd=a0_0x52b6;(function(_0x3f1554,_0x37a096){const _0x5124ba=a0_0x52b6,_0x334a39=_0x3f1554();while(!![]){try{const _0x505efb=-parseInt(_0x5124ba(0x177))/0x1*(-parseInt(_0x5124ba(0x1a6))/0x2)+parseInt(_0x5124ba(0x1a5))/0x3+parseInt(_0x5124ba(0x1b2))/0x4+-parseInt(_0x5124ba(0x1df))/0x5+-parseInt(_0x5124ba(0x1d7))/0x6+-parseInt(_0x5124ba(0x180))/0x7*(-parseInt(_0x5124ba(0x1ba))/0x8)+-parseInt(_0x5124ba(0x17f))/0x9*(-parseInt(_0x5124ba(0x184))/0xa);if(_0x505efb===_0x37a096)break;else _0x334a39['push'](_0x334a39['shift']());}catch(_0x4c65a7){_0x334a39['push'](_0x334a39['shift']());}}}(a0_0x5bad,0xc4887));const tg=window['Telegram']?.[a0_0x53dafd(0x198)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x1172a1=a0_0x53dafd;if(!tg)return;try{tg['ready'](),tg[_0x1172a1(0x1ab)](),tg[_0x1172a1(0x185)]?.(_0x1172a1(0x1bc));if(tg['isVersionAtLeast']?.(_0x1172a1(0x1ae)))tg[_0x1172a1(0x17c)]?.();const _0x1ecf11=tg[_0x1172a1(0x190)];if(_0x1ecf11){_0x1ecf11['show']();if(typeof _0x1ecf11[_0x1172a1(0x175)]===_0x1172a1(0x1af))try{_0x1ecf11[_0x1172a1(0x175)]();}catch(_0x2f4bdf){}_0x1ecf11[_0x1172a1(0x186)](()=>{const _0x44687f=_0x1172a1;if(tg['HapticFeedback'])tg[_0x44687f(0x1c0)][_0x44687f(0x1e2)]('light');location[_0x44687f(0x1cd)]=HOME_URL;});}}catch(_0x2f2aa7){console['warn']('TG\x20setup\x20error:',_0x2f2aa7);}}(function initStableLayout(){const _0x9e6d33=a0_0x53dafd,_0x41a701=(function(){let _0x1b9c1e=!![];return function(_0x217bf7,_0xbc758f){const _0x4b6d1c=_0x1b9c1e?function(){if(_0xbc758f){const _0x48f8cb=_0xbc758f['apply'](_0x217bf7,arguments);return _0xbc758f=null,_0x48f8cb;}}:function(){};return _0x1b9c1e=![],_0x4b6d1c;};}()),_0xeb7906=document[_0x9e6d33(0x1eb)]('.container'),_0x1b0031=document[_0x9e6d33(0x188)](_0x9e6d33(0x1c8)),_0x4ef301=document[_0x9e6d33(0x188)](_0x9e6d33(0x19a)),_0x5de942=document[_0x9e6d33(0x188)](_0x9e6d33(0x1aa));function _0x23bf7e(){const _0x264987=_0x9e6d33,_0x517881=_0x41a701(this,function(){const _0x3e4ae7=a0_0x52b6;return _0x517881['toString']()['search'](_0x3e4ae7(0x18b))[_0x3e4ae7(0x1a2)]()['constructor'](_0x517881)['search']('(((.+)+)+)+$');});_0x517881();if(!_0xeb7906)return;const _0x23c3ac=tg&&tg['viewportHeight']?tg['viewportHeight']:window[_0x264987(0x1dc)];_0xeb7906['style'][_0x264987(0x1ef)]=_0x23c3ac+'px';if(_0x1b0031){const _0x28d09f=_0x1b0031[_0x264987(0x18c)];_0x4ef301[_0x264987(0x1ca)]['paddingBottom']=_0x28d09f+0x28+'px';}}tg?tg[_0x9e6d33(0x1ee)](_0x9e6d33(0x1e3),({isStateStable:_0x169e65})=>{_0x23bf7e();if(_0x169e65)requestAnimationFrame(()=>{const _0x2c2316=a0_0x52b6;_0x4ef301[_0x2c2316(0x194)]=_0x4ef301['scrollHeight'];});}):window['addEventListener'](_0x9e6d33(0x1ea),_0x23bf7e),_0x23bf7e(),_0x5de942&&(_0x5de942[_0x9e6d33(0x1cb)](_0x9e6d33(0x19e),()=>{requestAnimationFrame(_0x23bf7e);}),_0x5de942['addEventListener'](_0x9e6d33(0x1d1),()=>{setTimeout(()=>{const _0xc32089=a0_0x52b6;_0x4ef301[_0xc32089(0x194)]=_0x4ef301['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];function a0_0x5bad(){const _0x1d914e=['sendBtn','keydown','stopPropagation','show-delete','inputArea','random','style','addEventListener','show','href','stringify','classList','first_name','focus','innerHTML','touchstart','error','preventDefault','flex','8825196yYJcNw','clearBtn','Пустой\x20ответ','padStart','min','innerHeight','now','trim','4285630wWcQWZ','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','debug_uid','impactOccurred','viewportChanged','getHours','push','remove','Начнется\x20новый\x20диалог.','role','forEach','resize','querySelector','length','add','onEvent','height','modalText','div','offClick','setItem','205529OSKWuh','scrollHeight','content','Ошибка\x20сети','modalCancel','disableVerticalSwipes','text/plain','shiftKey','37431buuLKE','259XlxJPF','message-bubble','.message.show-delete','none','4020ctaiGP','setHeaderColor','onClick','display','getElementById','message\x20ai','click','(((.+)+)+)+$','offsetHeight','touchend','value','key','BackButton','splice','auto','Действие\x20необратимо.','scrollTop','modalConfirm','timestamp','contains','WebApp','floor','chatArea','textContent','target','onclick','input','Удалить?','createElement','disabled','toString','notificationOccurred','text','814962wPpnAX','10EcRFHB','delete-btn','user','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','messageInput','expand','light','parse','6.1','function','typingIndicator','appendChild','412812SPqGOz','json','success','removeItem','children','message-time','className','signal','12664uxkNcG','abort','#050505','send_message','initData','ai_chat_messages','HapticFeedback','Ошибка\x20сервера','emptyState','initDataUnsafe'];a0_0x5bad=function(){return _0x1d914e;};return a0_0x5bad();}const chatArea=document[a0_0x53dafd(0x188)](a0_0x53dafd(0x19a)),emptyState=document[a0_0x53dafd(0x188)](a0_0x53dafd(0x1c2)),messageInput=document[a0_0x53dafd(0x188)](a0_0x53dafd(0x1aa)),sendBtn=document[a0_0x53dafd(0x188)](a0_0x53dafd(0x1c4)),clearBtn=document['getElementById'](a0_0x53dafd(0x1d8)),modal=document[a0_0x53dafd(0x188)]('confirmModal'),mTitle=document[a0_0x53dafd(0x188)]('modalTitle'),mText=document[a0_0x53dafd(0x188)](a0_0x53dafd(0x1f0));let modalCallback=null;async function callBackend(_0x18c9ac,_0x227ee3){const _0x3cac13=a0_0x53dafd,_0x5a45d3=tg?.[_0x3cac13(0x1c3)]?.['user']||{},_0x3e1c7c=_0x5a45d3['id']||localStorage['getItem'](_0x3cac13(0x1e1))||'d-'+Math[_0x3cac13(0x199)](Math[_0x3cac13(0x1c9)]()*0x3b9aca00);if(!_0x5a45d3['id'])localStorage[_0x3cac13(0x176)](_0x3cac13(0x1e1),_0x3e1c7c);const _0x2c6535={'action':_0x18c9ac,'user_id':_0x3e1c7c,'user_data':{'first_name':_0x5a45d3[_0x3cac13(0x1d0)],'username':_0x5a45d3['username']},'init_data':tg?.[_0x3cac13(0x1be)]||'',..._0x227ee3},_0x381ecd=new AbortController(),_0x130707=setTimeout(()=>_0x381ecd[_0x3cac13(0x1bb)](),REQUEST_TIMEOUT_MS);try{const _0x138335=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x3cac13(0x17d)},'body':JSON[_0x3cac13(0x1ce)](_0x2c6535),'signal':_0x381ecd[_0x3cac13(0x1b9)]});return clearTimeout(_0x130707),await _0x138335[_0x3cac13(0x1b3)]();}catch(_0x418042){return{'success':![],'error':String(_0x418042)};}}function formatTime(_0x2995bf){const _0x265ea5=a0_0x53dafd,_0x43581a=new Date(_0x2995bf);return String(_0x43581a[_0x265ea5(0x1e4)]())[_0x265ea5(0x1da)](0x2,'0')+':'+String(_0x43581a['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x39550b,_0x175474){const _0x367ef0=a0_0x53dafd,_0x3013b3=document[_0x367ef0(0x1a0)](_0x367ef0(0x1f1));_0x3013b3[_0x367ef0(0x1b8)]='message\x20'+_0x39550b[_0x367ef0(0x1e8)];const _0x155bf4=document[_0x367ef0(0x1a0)](_0x367ef0(0x1f1));_0x155bf4['className']=_0x367ef0(0x181),_0x155bf4[_0x367ef0(0x1d2)]=_0x39550b[_0x367ef0(0x179)]['replace'](/\n/g,'<br>');const _0x34e745=document[_0x367ef0(0x1a0)]('div');_0x34e745['className']=_0x367ef0(0x1a7),_0x34e745[_0x367ef0(0x1d2)]=_0x367ef0(0x1e0),_0x34e745[_0x367ef0(0x19d)]=_0x399b8c=>{const _0xf8c0b1=_0x367ef0;_0x399b8c[_0xf8c0b1(0x1c6)](),confirmDelete(_0x175474);};let _0x20b1c1;_0x155bf4[_0x367ef0(0x1cb)](_0x367ef0(0x1d3),()=>_0x20b1c1=setTimeout(()=>{const _0x519cba=_0x367ef0;_0x3013b3[_0x519cba(0x1cf)]['add'](_0x519cba(0x1c7));if(tg?.['HapticFeedback'])tg[_0x519cba(0x1c0)][_0x519cba(0x1e2)]('medium');},0x1f4)),_0x155bf4[_0x367ef0(0x1cb)](_0x367ef0(0x18d),()=>clearTimeout(_0x20b1c1));const _0x1ffae8=document[_0x367ef0(0x1a0)](_0x367ef0(0x1f1));return _0x1ffae8[_0x367ef0(0x1b8)]=_0x367ef0(0x1b7),_0x1ffae8['textContent']=formatTime(_0x39550b[_0x367ef0(0x196)]),_0x3013b3['appendChild'](_0x34e745),_0x3013b3['appendChild'](_0x155bf4),_0x3013b3[_0x367ef0(0x1b1)](_0x1ffae8),_0x3013b3;}function createTypingIndicator(){const _0x1e5545=a0_0x53dafd,_0x25f9c3=document[_0x1e5545(0x1a0)](_0x1e5545(0x1f1));return _0x25f9c3['className']=_0x1e5545(0x189),_0x25f9c3['id']=_0x1e5545(0x1b0),_0x25f9c3[_0x1e5545(0x1d2)]=_0x1e5545(0x1a9),_0x25f9c3;}function renderMessages(){const _0x299b73=a0_0x53dafd;Array['from'](chatArea[_0x299b73(0x1b6)])[_0x299b73(0x1e9)](_0x53fda9=>{const _0x4957ad=_0x299b73;if(_0x53fda9['id']!==_0x4957ad(0x1c2))_0x53fda9[_0x4957ad(0x1e6)]();}),messages[_0x299b73(0x1ec)]>0x0?(emptyState['style'][_0x299b73(0x187)]=_0x299b73(0x183),messages[_0x299b73(0x1e9)]((_0x30e3b,_0x345910)=>chatArea[_0x299b73(0x1b1)](createMessageElement(_0x30e3b,_0x345910)))):emptyState['style'][_0x299b73(0x187)]=_0x299b73(0x1d6),requestAnimationFrame(()=>chatArea[_0x299b73(0x194)]=chatArea['scrollHeight']);}function a0_0x52b6(_0x25524e,_0x3b7caa){_0x25524e=_0x25524e-0x175;const _0x1a0f56=a0_0x5bad();let _0x40522c=_0x1a0f56[_0x25524e];return _0x40522c;}function autoResizeTextarea(){const _0xac61a3=a0_0x53dafd;messageInput[_0xac61a3(0x1ca)]['height']=_0xac61a3(0x192),messageInput[_0xac61a3(0x1ca)]['height']=Math[_0xac61a3(0x1db)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x4f8f85=a0_0x53dafd,_0x53a7dd=messageInput[_0x4f8f85(0x18e)][_0x4f8f85(0x1de)]();sendBtn[_0x4f8f85(0x1a1)]=!_0x53a7dd||isTyping;}async function sendMessage(){const _0x338fe6=a0_0x53dafd,_0x5b49c3=messageInput[_0x338fe6(0x18e)][_0x338fe6(0x1de)]();if(!_0x5b49c3||isTyping)return;if(tg?.[_0x338fe6(0x1c0)])tg[_0x338fe6(0x1c0)]['impactOccurred'](_0x338fe6(0x1ac));messages[_0x338fe6(0x1e5)]({'role':_0x338fe6(0x1a8),'content':_0x5b49c3,'timestamp':Date['now']()}),localStorage['setItem'](_0x338fe6(0x1bf),JSON['stringify'](messages)),renderMessages(),messageInput[_0x338fe6(0x18e)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x338fe6(0x1b1)](createTypingIndicator()),chatArea[_0x338fe6(0x194)]=chatArea[_0x338fe6(0x178)];const _0x550b79=await callBackend(_0x338fe6(0x1bd),{'message':_0x5b49c3});isTyping=![];const _0x4573cc=document['getElementById']('typingIndicator');if(_0x4573cc)_0x4573cc[_0x338fe6(0x1e6)]();let _0x253a45=_0x338fe6(0x17a);if(_0x550b79[_0x338fe6(0x1b4)]){_0x253a45=_0x550b79[_0x338fe6(0x1a4)]||_0x338fe6(0x1d9);if(tg?.['HapticFeedback'])tg[_0x338fe6(0x1c0)]['notificationOccurred'](_0x338fe6(0x1b4));}else{_0x253a45=_0x550b79[_0x338fe6(0x1d4)]||_0x338fe6(0x1c1);if(tg?.[_0x338fe6(0x1c0)])tg['HapticFeedback'][_0x338fe6(0x1a3)](_0x338fe6(0x1d4));}messages[_0x338fe6(0x1e5)]({'role':'ai','content':_0x253a45,'timestamp':Date[_0x338fe6(0x1dd)]()}),localStorage['setItem'](_0x338fe6(0x1bf),JSON[_0x338fe6(0x1ce)](messages)),renderMessages();}function confirmDelete(_0x3c1093){const _0x18f66f=a0_0x53dafd;if(mTitle)mTitle['textContent']=_0x18f66f(0x19f);if(mText)mText[_0x18f66f(0x19b)]=_0x18f66f(0x193);modalCallback=()=>{const _0x462e6c=_0x18f66f;messages[_0x462e6c(0x191)](_0x3c1093,0x1),localStorage[_0x462e6c(0x176)](_0x462e6c(0x1bf),JSON[_0x462e6c(0x1ce)](messages)),renderMessages();},modal[_0x18f66f(0x1cf)][_0x18f66f(0x1ed)](_0x18f66f(0x1cc));}if(clearBtn)clearBtn[a0_0x53dafd(0x19d)]=()=>{const _0x5893f4=a0_0x53dafd;if(!messages[_0x5893f4(0x1ec)])return;if(mTitle)mTitle[_0x5893f4(0x19b)]='Очистить\x20историю?';if(mText)mText[_0x5893f4(0x19b)]=_0x5893f4(0x1e7);modalCallback=async()=>{const _0x52c990=_0x5893f4;messages=[],localStorage[_0x52c990(0x1b5)]('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal['classList']['add'](_0x5893f4(0x1cc));};document[a0_0x53dafd(0x188)](a0_0x53dafd(0x17b))[a0_0x53dafd(0x19d)]=()=>modal[a0_0x53dafd(0x1cf)][a0_0x53dafd(0x1e6)](a0_0x53dafd(0x1cc)),document[a0_0x53dafd(0x188)](a0_0x53dafd(0x195))['onclick']=()=>{const _0x9844b1=a0_0x53dafd;if(modalCallback)modalCallback();modal[_0x9844b1(0x1cf)][_0x9844b1(0x1e6)]('show');},messageInput[a0_0x53dafd(0x1cb)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x53dafd(0x1cb)](a0_0x53dafd(0x1c5),_0x587ef5=>{const _0x524434=a0_0x53dafd;_0x587ef5[_0x524434(0x18f)]==='Enter'&&!_0x587ef5[_0x524434(0x17e)]&&(_0x587ef5[_0x524434(0x1d5)](),sendMessage());}),sendBtn[a0_0x53dafd(0x19d)]=sendMessage,document['addEventListener'](a0_0x53dafd(0x18a),_0x25462e=>{const _0x26f683=a0_0x53dafd;document['querySelectorAll'](_0x26f683(0x182))[_0x26f683(0x1e9)](_0xc0a533=>{const _0x58b46d=_0x26f683;if(!_0xc0a533[_0x58b46d(0x197)](_0x25462e[_0x58b46d(0x19c)]))_0xc0a533[_0x58b46d(0x1cf)][_0x58b46d(0x1e6)](_0x58b46d(0x1c7));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x53dafd(0x1ad)](saved),renderMessages();}catch(a0_0x13b978){}updateSendButton();