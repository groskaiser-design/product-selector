const a0_0x497341=a0_0x33f6;(function(_0x407bb9,_0x1e4e8a){const _0x1dde6a=a0_0x33f6,_0x501031=_0x407bb9();while(!![]){try{const _0x3e2abe=parseInt(_0x1dde6a(0x1f3))/0x1*(-parseInt(_0x1dde6a(0x214))/0x2)+-parseInt(_0x1dde6a(0x268))/0x3*(-parseInt(_0x1dde6a(0x211))/0x4)+-parseInt(_0x1dde6a(0x218))/0x5+parseInt(_0x1dde6a(0x232))/0x6+parseInt(_0x1dde6a(0x263))/0x7+parseInt(_0x1dde6a(0x209))/0x8+-parseInt(_0x1dde6a(0x227))/0x9;if(_0x3e2abe===_0x1e4e8a)break;else _0x501031['push'](_0x501031['shift']());}catch(_0x85240d){_0x501031['push'](_0x501031['shift']());}}}(a0_0x1a72,0xd1774));const tg=window[a0_0x497341(0x225)]?.[a0_0x497341(0x222)],HOME_URL='./router.html';function a0_0x1a72(){const _0x9043e0=['push','viewportHeight','POST','success','4701592BLABjn','onEvent','padStart','disableVerticalSwipes','inputArea','3197886cmWdGO','value','username','message-time','content','setHeaderColor','Действие\x20необратимо.','paddingBottom','json','19029xEckzk','ready','message\x20','createElement','show','children','onClick','search','initDataUnsafe','floor','stringify','constructor','Удалить?','error','innerHTML','Начнется\x20новый\x20диалог.','.container','apply','forEach','key','from','textContent','5340344EmWtbo','TG\x20setup\x20error:','getMinutes','div','resize','getItem','classList','none','4kCDJmF','height','notificationOccurred','18nzqDcl','light','ai_chat_messages','toString','1395895PMQNEl','HapticFeedback','replace','setItem','stopPropagation','touchend','disabled','isVersionAtLeast','flex','min','WebApp','contains','messageInput','Telegram','viewportChanged','20311839FdkIbk','delete-btn','impactOccurred','BackButton','Ошибка\x20сервера','remove','modalCancel','message\x20ai','parse','className','timestamp','6960732tTwhZP','initData','trim','target','Пустой\x20ответ','appendChild','clear_history','warn','onclick','querySelector','input','preventDefault','add','emptyState','offClick','chatArea','first_name','scrollTop','expand','send_message','medium','debug_uid','now','random','auto','Enter','scrollHeight','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','<br>','addEventListener','role','Очистить\x20историю?','modalTitle','signal','show-delete','keydown','typingIndicator','offsetHeight','sendBtn','style','clearBtn','text','.message.show-delete','getElementById','Ошибка\x20сети'];a0_0x1a72=function(){return _0x9043e0;};return a0_0x1a72();}function setupTelegramBackButton(){const _0x58db32=a0_0x497341,_0x37cc26=(function(){let _0x2f8f8d=!![];return function(_0x5850db,_0x2607c8){const _0x3d8060=_0x2f8f8d?function(){const _0x80b795=a0_0x33f6;if(_0x2607c8){const _0x11c8f7=_0x2607c8[_0x80b795(0x204)](_0x5850db,arguments);return _0x2607c8=null,_0x11c8f7;}}:function(){};return _0x2f8f8d=![],_0x3d8060;};}()),_0x448bcb=_0x37cc26(this,function(){const _0x15ca65=a0_0x33f6;return _0x448bcb[_0x15ca65(0x217)]()[_0x15ca65(0x1fa)]('(((.+)+)+)+$')[_0x15ca65(0x217)]()[_0x15ca65(0x1fe)](_0x448bcb)[_0x15ca65(0x1fa)]('(((.+)+)+)+$');});_0x448bcb();if(!tg)return;try{tg[_0x58db32(0x1f4)](),tg[_0x58db32(0x244)](),tg[_0x58db32(0x1ef)]?.('#050505');if(tg[_0x58db32(0x21f)]?.('6.1'))tg[_0x58db32(0x266)]?.();const _0x4a7698=tg[_0x58db32(0x22a)];if(_0x4a7698){_0x4a7698[_0x58db32(0x1f7)]();if(typeof _0x4a7698[_0x58db32(0x240)]==='function')try{_0x4a7698[_0x58db32(0x240)]();}catch(_0x34856a){}_0x4a7698[_0x58db32(0x1f9)](()=>{const _0x119ae1=_0x58db32;if(tg[_0x119ae1(0x219)])tg[_0x119ae1(0x219)]['impactOccurred'](_0x119ae1(0x215));location['href']=HOME_URL;});}}catch(_0x191d1e){console[_0x58db32(0x239)](_0x58db32(0x20a),_0x191d1e);}}(function initStableLayout(){const _0x184963=a0_0x497341,_0x307963=document[_0x184963(0x23b)](_0x184963(0x203)),_0x1ab034=document['getElementById'](_0x184963(0x267)),_0x48e786=document[_0x184963(0x25d)](_0x184963(0x241)),_0x2d70a2=document[_0x184963(0x25d)](_0x184963(0x224));function _0x55960a(){const _0x3ae832=_0x184963;if(!_0x307963)return;const _0x5dd0d2=tg&&tg[_0x3ae832(0x260)]?tg[_0x3ae832(0x260)]:window['innerHeight'];_0x307963[_0x3ae832(0x259)][_0x3ae832(0x212)]=_0x5dd0d2+'px';if(_0x1ab034){const _0x25de4d=_0x1ab034[_0x3ae832(0x257)];_0x48e786['style'][_0x3ae832(0x1f1)]=_0x25de4d+0x28+'px';}}tg?tg[_0x184963(0x264)](_0x184963(0x226),({isStateStable:_0x7fda37})=>{_0x55960a();if(_0x7fda37)requestAnimationFrame(()=>{const _0x115084=a0_0x33f6;_0x48e786[_0x115084(0x243)]=_0x48e786['scrollHeight'];});}):window[_0x184963(0x24f)](_0x184963(0x20d),_0x55960a),_0x55960a(),_0x2d70a2&&(_0x2d70a2[_0x184963(0x24f)]('input',()=>{requestAnimationFrame(_0x55960a);}),_0x2d70a2[_0x184963(0x24f)]('focus',()=>{setTimeout(()=>{const _0xfd89dd=a0_0x33f6;_0x48e786['scrollTop']=_0x48e786[_0xfd89dd(0x24c)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x497341(0x24d),REQUEST_TIMEOUT_MS=0xafc8;function a0_0x33f6(_0x3edb82,_0x54862e){_0x3edb82=_0x3edb82-0x1ee;const _0x33ef98=a0_0x1a72();let _0x6d0a8=_0x33ef98[_0x3edb82];return _0x6d0a8;}let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x497341(0x241)),emptyState=document['getElementById'](a0_0x497341(0x23f)),messageInput=document[a0_0x497341(0x25d)](a0_0x497341(0x224)),sendBtn=document[a0_0x497341(0x25d)](a0_0x497341(0x258)),clearBtn=document[a0_0x497341(0x25d)](a0_0x497341(0x25a)),modal=document[a0_0x497341(0x25d)]('confirmModal'),mTitle=document[a0_0x497341(0x25d)](a0_0x497341(0x252)),mText=document[a0_0x497341(0x25d)]('modalText');let modalCallback=null;async function callBackend(_0x57c880,_0x2add44){const _0x22c044=a0_0x497341,_0x3ad2d7=tg?.[_0x22c044(0x1fb)]?.['user']||{},_0xc9c0e3=_0x3ad2d7['id']||localStorage[_0x22c044(0x20e)](_0x22c044(0x247))||'d-'+Math[_0x22c044(0x1fc)](Math[_0x22c044(0x249)]()*0x3b9aca00);if(!_0x3ad2d7['id'])localStorage[_0x22c044(0x21b)](_0x22c044(0x247),_0xc9c0e3);const _0x32099f={'action':_0x57c880,'user_id':_0xc9c0e3,'user_data':{'first_name':_0x3ad2d7[_0x22c044(0x242)],'username':_0x3ad2d7[_0x22c044(0x26a)]},'init_data':tg?.[_0x22c044(0x233)]||'',..._0x2add44},_0x13868c=new AbortController(),_0x1c1daa=setTimeout(()=>_0x13868c['abort'](),REQUEST_TIMEOUT_MS);try{const _0x53591f=await fetch(BACKEND_URL,{'method':_0x22c044(0x261),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x22c044(0x1fd)](_0x32099f),'signal':_0x13868c[_0x22c044(0x253)]});return clearTimeout(_0x1c1daa),await _0x53591f[_0x22c044(0x1f2)]();}catch(_0x4dc8ac){return{'success':![],'error':String(_0x4dc8ac)};}}function formatTime(_0x54fa37){const _0xb5164d=a0_0x497341,_0x517f93=new Date(_0x54fa37);return String(_0x517f93['getHours']())[_0xb5164d(0x265)](0x2,'0')+':'+String(_0x517f93[_0xb5164d(0x20b)]())['padStart'](0x2,'0');}function createMessageElement(_0x1bddce,_0x49eab2){const _0x337cfa=a0_0x497341,_0x233f8e=document[_0x337cfa(0x1f6)](_0x337cfa(0x20c));_0x233f8e[_0x337cfa(0x230)]=_0x337cfa(0x1f5)+_0x1bddce[_0x337cfa(0x250)];const _0x1bd0e2=document[_0x337cfa(0x1f6)](_0x337cfa(0x20c));_0x1bd0e2[_0x337cfa(0x230)]='message-bubble',_0x1bd0e2[_0x337cfa(0x201)]=_0x1bddce[_0x337cfa(0x1ee)][_0x337cfa(0x21a)](/\n/g,_0x337cfa(0x24e));const _0x322a41=document[_0x337cfa(0x1f6)](_0x337cfa(0x20c));_0x322a41[_0x337cfa(0x230)]=_0x337cfa(0x228),_0x322a41['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x322a41[_0x337cfa(0x23a)]=_0x2ebf70=>{const _0x440610=_0x337cfa;_0x2ebf70[_0x440610(0x21c)](),confirmDelete(_0x49eab2);};let _0x4834fb;_0x1bd0e2[_0x337cfa(0x24f)]('touchstart',()=>_0x4834fb=setTimeout(()=>{const _0x1dc5aa=_0x337cfa;_0x233f8e[_0x1dc5aa(0x20f)]['add'](_0x1dc5aa(0x254));if(tg?.['HapticFeedback'])tg[_0x1dc5aa(0x219)][_0x1dc5aa(0x229)](_0x1dc5aa(0x246));},0x1f4)),_0x1bd0e2['addEventListener'](_0x337cfa(0x21d),()=>clearTimeout(_0x4834fb));const _0x2df373=document[_0x337cfa(0x1f6)](_0x337cfa(0x20c));return _0x2df373[_0x337cfa(0x230)]=_0x337cfa(0x26b),_0x2df373[_0x337cfa(0x208)]=formatTime(_0x1bddce[_0x337cfa(0x231)]),_0x233f8e[_0x337cfa(0x237)](_0x322a41),_0x233f8e[_0x337cfa(0x237)](_0x1bd0e2),_0x233f8e[_0x337cfa(0x237)](_0x2df373),_0x233f8e;}function createTypingIndicator(){const _0x5b2b01=a0_0x497341,_0x4417e6=document['createElement'](_0x5b2b01(0x20c));return _0x4417e6[_0x5b2b01(0x230)]=_0x5b2b01(0x22e),_0x4417e6['id']=_0x5b2b01(0x256),_0x4417e6['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x4417e6;}function renderMessages(){const _0x5da567=a0_0x497341;Array[_0x5da567(0x207)](chatArea[_0x5da567(0x1f8)])[_0x5da567(0x205)](_0x51e61f=>{const _0xd40499=_0x5da567;if(_0x51e61f['id']!=='emptyState')_0x51e61f[_0xd40499(0x22c)]();}),messages['length']>0x0?(emptyState[_0x5da567(0x259)]['display']=_0x5da567(0x210),messages[_0x5da567(0x205)]((_0x3dffc6,_0x321fdb)=>chatArea[_0x5da567(0x237)](createMessageElement(_0x3dffc6,_0x321fdb)))):emptyState[_0x5da567(0x259)]['display']=_0x5da567(0x220),requestAnimationFrame(()=>chatArea[_0x5da567(0x243)]=chatArea[_0x5da567(0x24c)]);}function autoResizeTextarea(){const _0x333550=a0_0x497341;messageInput[_0x333550(0x259)]['height']=_0x333550(0x24a),messageInput[_0x333550(0x259)][_0x333550(0x212)]=Math[_0x333550(0x221)](messageInput[_0x333550(0x24c)],0x78)+'px';}function updateSendButton(){const _0xa4bb3e=a0_0x497341,_0x10c281=messageInput[_0xa4bb3e(0x269)][_0xa4bb3e(0x234)]();sendBtn[_0xa4bb3e(0x21e)]=!_0x10c281||isTyping;}async function sendMessage(){const _0x345bda=a0_0x497341,_0x2ca7a5=messageInput[_0x345bda(0x269)][_0x345bda(0x234)]();if(!_0x2ca7a5||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x345bda(0x219)]['impactOccurred'](_0x345bda(0x215));messages[_0x345bda(0x25f)]({'role':'user','content':_0x2ca7a5,'timestamp':Date[_0x345bda(0x248)]()}),localStorage['setItem'](_0x345bda(0x216),JSON[_0x345bda(0x1fd)](messages)),renderMessages(),messageInput[_0x345bda(0x269)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x345bda(0x237)](createTypingIndicator()),chatArea[_0x345bda(0x243)]=chatArea[_0x345bda(0x24c)];const _0x3df0ba=await callBackend(_0x345bda(0x245),{'message':_0x2ca7a5});isTyping=![];const _0x5bfa3e=document[_0x345bda(0x25d)](_0x345bda(0x256));if(_0x5bfa3e)_0x5bfa3e['remove']();let _0x10ddd1=_0x345bda(0x25e);if(_0x3df0ba[_0x345bda(0x262)]){_0x10ddd1=_0x3df0ba[_0x345bda(0x25b)]||_0x345bda(0x236);if(tg?.['HapticFeedback'])tg[_0x345bda(0x219)]['notificationOccurred'](_0x345bda(0x262));}else{_0x10ddd1=_0x3df0ba[_0x345bda(0x200)]||_0x345bda(0x22b);if(tg?.[_0x345bda(0x219)])tg[_0x345bda(0x219)][_0x345bda(0x213)](_0x345bda(0x200));}messages['push']({'role':'ai','content':_0x10ddd1,'timestamp':Date[_0x345bda(0x248)]()}),localStorage[_0x345bda(0x21b)]('ai_chat_messages',JSON[_0x345bda(0x1fd)](messages)),renderMessages();}function confirmDelete(_0xc8546b){const _0x5526e0=a0_0x497341;if(mTitle)mTitle[_0x5526e0(0x208)]=_0x5526e0(0x1ff);if(mText)mText[_0x5526e0(0x208)]=_0x5526e0(0x1f0);modalCallback=()=>{const _0x4100a6=_0x5526e0;messages['splice'](_0xc8546b,0x1),localStorage[_0x4100a6(0x21b)](_0x4100a6(0x216),JSON[_0x4100a6(0x1fd)](messages)),renderMessages();},modal[_0x5526e0(0x20f)][_0x5526e0(0x23e)](_0x5526e0(0x1f7));}if(clearBtn)clearBtn[a0_0x497341(0x23a)]=()=>{const _0x11a42c=a0_0x497341;if(!messages['length'])return;if(mTitle)mTitle['textContent']=_0x11a42c(0x251);if(mText)mText[_0x11a42c(0x208)]=_0x11a42c(0x202);modalCallback=async()=>{const _0x32dbcb=_0x11a42c;messages=[],localStorage['removeItem'](_0x32dbcb(0x216)),renderMessages(),callBackend(_0x32dbcb(0x238),{});},modal['classList']['add']('show');};document['getElementById'](a0_0x497341(0x22d))[a0_0x497341(0x23a)]=()=>modal[a0_0x497341(0x20f)]['remove']('show'),document['getElementById']('modalConfirm')[a0_0x497341(0x23a)]=()=>{const _0x13b2cd=a0_0x497341;if(modalCallback)modalCallback();modal[_0x13b2cd(0x20f)][_0x13b2cd(0x22c)](_0x13b2cd(0x1f7));},messageInput['addEventListener'](a0_0x497341(0x23c),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x497341(0x24f)](a0_0x497341(0x255),_0x3f6c0c=>{const _0x2ea3be=a0_0x497341;_0x3f6c0c[_0x2ea3be(0x206)]===_0x2ea3be(0x24b)&&!_0x3f6c0c['shiftKey']&&(_0x3f6c0c[_0x2ea3be(0x23d)](),sendMessage());}),sendBtn[a0_0x497341(0x23a)]=sendMessage,document[a0_0x497341(0x24f)]('click',_0x1254dd=>{const _0x297691=a0_0x497341;document['querySelectorAll'](_0x297691(0x25c))[_0x297691(0x205)](_0x1ee655=>{const _0x23d2a9=_0x297691;if(!_0x1ee655[_0x23d2a9(0x223)](_0x1254dd[_0x23d2a9(0x235)]))_0x1ee655['classList'][_0x23d2a9(0x22c)](_0x23d2a9(0x254));});});const saved=localStorage['getItem'](a0_0x497341(0x216));if(saved)try{messages=JSON[a0_0x497341(0x22f)](saved),renderMessages();}catch(a0_0x1169d0){}updateSendButton();