const a0_0x41b884=a0_0x37b9;(function(_0xcb2c6a,_0x55a620){const _0x57e97b=a0_0x37b9,_0x12da7c=_0xcb2c6a();while(!![]){try{const _0x1c4dd8=-parseInt(_0x57e97b(0xb4))/0x1+-parseInt(_0x57e97b(0x81))/0x2*(parseInt(_0x57e97b(0xe9))/0x3)+-parseInt(_0x57e97b(0xbc))/0x4*(-parseInt(_0x57e97b(0xeb))/0x5)+-parseInt(_0x57e97b(0xc0))/0x6*(parseInt(_0x57e97b(0x8b))/0x7)+parseInt(_0x57e97b(0xe3))/0x8*(-parseInt(_0x57e97b(0xd0))/0x9)+-parseInt(_0x57e97b(0x7a))/0xa+parseInt(_0x57e97b(0xe4))/0xb;if(_0x1c4dd8===_0x55a620)break;else _0x12da7c['push'](_0x12da7c['shift']());}catch(_0x227a97){_0x12da7c['push'](_0x12da7c['shift']());}}}(a0_0x558d,0x7eee0));const tg=window[a0_0x41b884(0x88)]?.[a0_0x41b884(0x96)],HOME_URL=a0_0x41b884(0x87);function setupTelegramBackButton(){const _0x8871c7=a0_0x41b884,_0x24acea=(function(){let _0x32589a=!![];return function(_0x40a238,_0x5b26a3){const _0x30befa=_0x32589a?function(){const _0x2fb386=a0_0x37b9;if(_0x5b26a3){const _0x4b9f5d=_0x5b26a3[_0x2fb386(0xae)](_0x40a238,arguments);return _0x5b26a3=null,_0x4b9f5d;}}:function(){};return _0x32589a=![],_0x30befa;};}()),_0x34a612=_0x24acea(this,function(){const _0x3c33e2=a0_0x37b9;return _0x34a612['toString']()[_0x3c33e2(0x9f)](_0x3c33e2(0xb1))['toString']()[_0x3c33e2(0xdf)](_0x34a612)[_0x3c33e2(0x9f)](_0x3c33e2(0xb1));});_0x34a612();if(!tg)return;try{tg[_0x8871c7(0x94)](),tg[_0x8871c7(0xee)](),tg[_0x8871c7(0xf0)]?.(_0x8871c7(0xcc));if(tg[_0x8871c7(0xd5)]?.(_0x8871c7(0xa1)))tg[_0x8871c7(0xe6)]?.();const _0x1a159d=tg['BackButton'];if(_0x1a159d){_0x1a159d[_0x8871c7(0xd4)]();if(typeof _0x1a159d[_0x8871c7(0xda)]===_0x8871c7(0xb9))try{_0x1a159d['offClick']();}catch(_0x49d375){}_0x1a159d[_0x8871c7(0xa2)](()=>{const _0x18d75d=_0x8871c7;if(tg[_0x18d75d(0xe1)])tg[_0x18d75d(0xe1)][_0x18d75d(0xec)]('light');location['href']=HOME_URL;});}}catch(_0x569e59){console[_0x8871c7(0xdd)](_0x8871c7(0xb8),_0x569e59);}}function a0_0x558d(){const _0x386208=['getItem','createElement','flex','ready','removeItem','WebApp','remove','first_name','inputArea','splice','json','modalText','className','username','search','chatArea','6.1','onClick','show-delete','success','touchstart','notificationOccurred','ai_chat_messages','children','confirmModal','style','scrollHeight','modalCancel','disabled','apply','onclick','offsetHeight','(((.+)+)+)+$','key','Удалить?','725653quxUjS','viewportHeight','addEventListener','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','TG\x20setup\x20error:','function','now','.container','75008tZfHkW','getMinutes','display','signal','48tXtQmg','floor','Действие\x20необратимо.','scrollTop','contains','modalTitle','content','clearBtn','div','modalConfirm','role','innerHeight','#050505','error','appendChild','value','45xEKUnd','Очистить\x20историю?','messageInput','click','show','isVersionAtLeast','push','stringify','innerHTML','forEach','offClick','textContent','message-bubble','warn','setItem','constructor','padStart','HapticFeedback','height','1095952sPKMUn','31225062gGDxsO','message\x20ai','disableVerticalSwipes','classList','Enter','105yPUekt','light','30aQSDdL','impactOccurred','send_message','expand','initDataUnsafe','setHeaderColor','length','sendBtn','Ошибка\x20сервера','add','from','stopPropagation','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','Ошибка\x20сети','3000580gGByRX','initData','clear_history','getHours','Пустой\x20ответ','onEvent','getElementById','24710kyUycV','auto','text','user','min','debug_uid','./router.html','Telegram','input','trim','252126QSZbAY','preventDefault','emptyState','querySelectorAll','focus','text/plain'];a0_0x558d=function(){return _0x386208;};return a0_0x558d();}(function initStableLayout(){const _0xa4e92f=a0_0x41b884,_0x16066d=document['querySelector'](_0xa4e92f(0xbb)),_0xab7744=document[_0xa4e92f(0x80)](_0xa4e92f(0x99)),_0x477f59=document[_0xa4e92f(0x80)]('chatArea'),_0xa017dd=document['getElementById']('messageInput');function _0x160710(){const _0x2acfa7=_0xa4e92f;if(!_0x16066d)return;const _0x2d0fb3=tg&&tg[_0x2acfa7(0xb5)]?tg['viewportHeight']:window[_0x2acfa7(0xcb)];_0x16066d[_0x2acfa7(0xaa)][_0x2acfa7(0xe2)]=_0x2d0fb3+'px';if(_0xab7744){const _0x31ac47=_0xab7744[_0x2acfa7(0xb0)];_0x477f59['style']['paddingBottom']=_0x31ac47+0x28+'px';}}tg?tg[_0xa4e92f(0x7f)]('viewportChanged',({isStateStable:_0xc76ccf})=>{_0x160710();if(_0xc76ccf)requestAnimationFrame(()=>{const _0x46d9a4=a0_0x37b9;_0x477f59[_0x46d9a4(0xc3)]=_0x477f59[_0x46d9a4(0xab)];});}):window[_0xa4e92f(0xb6)]('resize',_0x160710),_0x160710(),_0xa017dd&&(_0xa017dd[_0xa4e92f(0xb6)](_0xa4e92f(0x89),()=>{requestAnimationFrame(_0x160710);}),_0xa017dd[_0xa4e92f(0xb6)](_0xa4e92f(0x8f),()=>{setTimeout(()=>{const _0x5247b4=a0_0x37b9;_0x477f59[_0x5247b4(0xc3)]=_0x477f59['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x41b884(0xf7),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x41b884(0xa0)),emptyState=document[a0_0x41b884(0x80)](a0_0x41b884(0x8d)),messageInput=document['getElementById'](a0_0x41b884(0xd2)),sendBtn=document['getElementById'](a0_0x41b884(0xf2)),clearBtn=document[a0_0x41b884(0x80)](a0_0x41b884(0xc7)),modal=document['getElementById'](a0_0x41b884(0xa9)),mTitle=document[a0_0x41b884(0x80)](a0_0x41b884(0xc5)),mText=document['getElementById'](a0_0x41b884(0x9c));let modalCallback=null;async function callBackend(_0xefc855,_0x48a786){const _0x540ad2=a0_0x41b884,_0x481a31=tg?.[_0x540ad2(0xef)]?.[_0x540ad2(0x84)]||{},_0x1cd7da=_0x481a31['id']||localStorage[_0x540ad2(0x91)](_0x540ad2(0x86))||'d-'+Math[_0x540ad2(0xc1)](Math['random']()*0x3b9aca00);if(!_0x481a31['id'])localStorage[_0x540ad2(0xde)](_0x540ad2(0x86),_0x1cd7da);const _0x30123f={'action':_0xefc855,'user_id':_0x1cd7da,'user_data':{'first_name':_0x481a31[_0x540ad2(0x98)],'username':_0x481a31[_0x540ad2(0x9e)]},'init_data':tg?.[_0x540ad2(0x7b)]||'',..._0x48a786},_0x45c000=new AbortController(),_0x454328=setTimeout(()=>_0x45c000['abort'](),REQUEST_TIMEOUT_MS);try{const _0x18edec=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x540ad2(0x90)},'body':JSON['stringify'](_0x30123f),'signal':_0x45c000[_0x540ad2(0xbf)]});return clearTimeout(_0x454328),await _0x18edec[_0x540ad2(0x9b)]();}catch(_0x4248be){return{'success':![],'error':String(_0x4248be)};}}function formatTime(_0xd2b71c){const _0x4fbb09=a0_0x41b884,_0x4f00a5=new Date(_0xd2b71c);return String(_0x4f00a5[_0x4fbb09(0x7d)]())[_0x4fbb09(0xe0)](0x2,'0')+':'+String(_0x4f00a5[_0x4fbb09(0xbd)]())[_0x4fbb09(0xe0)](0x2,'0');}function createMessageElement(_0x4974f1,_0x162cd1){const _0x17618e=a0_0x41b884,_0x49a8e2=document[_0x17618e(0x92)](_0x17618e(0xc8));_0x49a8e2[_0x17618e(0x9d)]='message\x20'+_0x4974f1[_0x17618e(0xca)];const _0x50b87f=document['createElement'](_0x17618e(0xc8));_0x50b87f[_0x17618e(0x9d)]=_0x17618e(0xdc),_0x50b87f[_0x17618e(0xd8)]=_0x4974f1[_0x17618e(0xc6)]['replace'](/\n/g,'<br>');const _0xae896f=document[_0x17618e(0x92)](_0x17618e(0xc8));_0xae896f[_0x17618e(0x9d)]='delete-btn',_0xae896f[_0x17618e(0xd8)]=_0x17618e(0xb7),_0xae896f[_0x17618e(0xaf)]=_0x8733e5=>{const _0x174db6=_0x17618e;_0x8733e5[_0x174db6(0xf6)](),confirmDelete(_0x162cd1);};let _0x480c4f;_0x50b87f[_0x17618e(0xb6)](_0x17618e(0xa5),()=>_0x480c4f=setTimeout(()=>{const _0x31831a=_0x17618e;_0x49a8e2[_0x31831a(0xe7)][_0x31831a(0xf4)](_0x31831a(0xa3));if(tg?.[_0x31831a(0xe1)])tg[_0x31831a(0xe1)][_0x31831a(0xec)]('medium');},0x1f4)),_0x50b87f[_0x17618e(0xb6)]('touchend',()=>clearTimeout(_0x480c4f));const _0x127f8e=document['createElement']('div');return _0x127f8e[_0x17618e(0x9d)]='message-time',_0x127f8e[_0x17618e(0xdb)]=formatTime(_0x4974f1['timestamp']),_0x49a8e2[_0x17618e(0xce)](_0xae896f),_0x49a8e2[_0x17618e(0xce)](_0x50b87f),_0x49a8e2[_0x17618e(0xce)](_0x127f8e),_0x49a8e2;}function createTypingIndicator(){const _0x4a5034=a0_0x41b884,_0x2baf2c=document[_0x4a5034(0x92)](_0x4a5034(0xc8));return _0x2baf2c[_0x4a5034(0x9d)]=_0x4a5034(0xe5),_0x2baf2c['id']='typingIndicator',_0x2baf2c[_0x4a5034(0xd8)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x2baf2c;}function renderMessages(){const _0x4059ed=a0_0x41b884;Array[_0x4059ed(0xf5)](chatArea[_0x4059ed(0xa8)])['forEach'](_0x42b3ae=>{const _0x4a23a1=_0x4059ed;if(_0x42b3ae['id']!=='emptyState')_0x42b3ae[_0x4a23a1(0x97)]();}),messages[_0x4059ed(0xf1)]>0x0?(emptyState[_0x4059ed(0xaa)][_0x4059ed(0xbe)]='none',messages['forEach']((_0x177a05,_0x1f9bc3)=>chatArea['appendChild'](createMessageElement(_0x177a05,_0x1f9bc3)))):emptyState[_0x4059ed(0xaa)][_0x4059ed(0xbe)]=_0x4059ed(0x93),requestAnimationFrame(()=>chatArea[_0x4059ed(0xc3)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x4020e6=a0_0x41b884;messageInput[_0x4020e6(0xaa)][_0x4020e6(0xe2)]=_0x4020e6(0x82),messageInput['style']['height']=Math[_0x4020e6(0x85)](messageInput['scrollHeight'],0x78)+'px';}function a0_0x37b9(_0x3493d2,_0x138860){_0x3493d2=_0x3493d2-0x79;const _0x54ec59=a0_0x558d();let _0xdd7548=_0x54ec59[_0x3493d2];return _0xdd7548;}function updateSendButton(){const _0x26c340=a0_0x41b884,_0x39b275=messageInput[_0x26c340(0xcf)]['trim']();sendBtn[_0x26c340(0xad)]=!_0x39b275||isTyping;}async function sendMessage(){const _0x31a68e=a0_0x41b884,_0x522cde=messageInput[_0x31a68e(0xcf)][_0x31a68e(0x8a)]();if(!_0x522cde||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x31a68e(0xe1)][_0x31a68e(0xec)](_0x31a68e(0xea));messages['push']({'role':'user','content':_0x522cde,'timestamp':Date[_0x31a68e(0xba)]()}),localStorage[_0x31a68e(0xde)](_0x31a68e(0xa7),JSON['stringify'](messages)),renderMessages(),messageInput[_0x31a68e(0xcf)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x31a68e(0xc3)]=chatArea[_0x31a68e(0xab)];const _0x4af240=await callBackend(_0x31a68e(0xed),{'message':_0x522cde});isTyping=![];const _0x4cb28f=document['getElementById']('typingIndicator');if(_0x4cb28f)_0x4cb28f['remove']();let _0x272009=_0x31a68e(0x79);if(_0x4af240[_0x31a68e(0xa4)]){_0x272009=_0x4af240[_0x31a68e(0x83)]||_0x31a68e(0x7e);if(tg?.[_0x31a68e(0xe1)])tg[_0x31a68e(0xe1)]['notificationOccurred'](_0x31a68e(0xa4));}else{_0x272009=_0x4af240[_0x31a68e(0xcd)]||_0x31a68e(0xf3);if(tg?.['HapticFeedback'])tg[_0x31a68e(0xe1)][_0x31a68e(0xa6)](_0x31a68e(0xcd));}messages[_0x31a68e(0xd6)]({'role':'ai','content':_0x272009,'timestamp':Date[_0x31a68e(0xba)]()}),localStorage[_0x31a68e(0xde)](_0x31a68e(0xa7),JSON[_0x31a68e(0xd7)](messages)),renderMessages();}function confirmDelete(_0x1d89aa){const _0x27ad1d=a0_0x41b884;if(mTitle)mTitle[_0x27ad1d(0xdb)]=_0x27ad1d(0xb3);if(mText)mText[_0x27ad1d(0xdb)]=_0x27ad1d(0xc2);modalCallback=()=>{const _0x1a4a9d=_0x27ad1d;messages[_0x1a4a9d(0x9a)](_0x1d89aa,0x1),localStorage[_0x1a4a9d(0xde)](_0x1a4a9d(0xa7),JSON[_0x1a4a9d(0xd7)](messages)),renderMessages();},modal['classList'][_0x27ad1d(0xf4)](_0x27ad1d(0xd4));}if(clearBtn)clearBtn[a0_0x41b884(0xaf)]=()=>{const _0x3f97d3=a0_0x41b884;if(!messages[_0x3f97d3(0xf1)])return;if(mTitle)mTitle[_0x3f97d3(0xdb)]=_0x3f97d3(0xd1);if(mText)mText[_0x3f97d3(0xdb)]='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x5cacf1=_0x3f97d3;messages=[],localStorage[_0x5cacf1(0x95)](_0x5cacf1(0xa7)),renderMessages(),callBackend(_0x5cacf1(0x7c),{});},modal['classList'][_0x3f97d3(0xf4)]('show');};document[a0_0x41b884(0x80)](a0_0x41b884(0xac))[a0_0x41b884(0xaf)]=()=>modal['classList'][a0_0x41b884(0x97)](a0_0x41b884(0xd4)),document[a0_0x41b884(0x80)](a0_0x41b884(0xc9))[a0_0x41b884(0xaf)]=()=>{const _0x5b68eb=a0_0x41b884;if(modalCallback)modalCallback();modal['classList'][_0x5b68eb(0x97)](_0x5b68eb(0xd4));},messageInput['addEventListener'](a0_0x41b884(0x89),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x41b884(0xb6)]('keydown',_0x4fb5ed=>{const _0x9c3b33=a0_0x41b884;_0x4fb5ed[_0x9c3b33(0xb2)]===_0x9c3b33(0xe8)&&!_0x4fb5ed['shiftKey']&&(_0x4fb5ed[_0x9c3b33(0x8c)](),sendMessage());}),sendBtn[a0_0x41b884(0xaf)]=sendMessage,document[a0_0x41b884(0xb6)](a0_0x41b884(0xd3),_0x16eb62=>{const _0x4c31ca=a0_0x41b884;document[_0x4c31ca(0x8e)]('.message.show-delete')[_0x4c31ca(0xd9)](_0x5e0da3=>{const _0x4eea5a=_0x4c31ca;if(!_0x5e0da3[_0x4eea5a(0xc4)](_0x16eb62['target']))_0x5e0da3[_0x4eea5a(0xe7)]['remove'](_0x4eea5a(0xa3));});});const saved=localStorage[a0_0x41b884(0x91)](a0_0x41b884(0xa7));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x59d01c){}updateSendButton();