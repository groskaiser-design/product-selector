const a0_0x392552=a0_0x25a2;(function(_0x274c60,_0x28b7d9){const _0x354ead=a0_0x25a2,_0x387e38=_0x274c60();while(!![]){try{const _0x30c100=-parseInt(_0x354ead(0x153))/0x1+parseInt(_0x354ead(0x16a))/0x2*(-parseInt(_0x354ead(0x14f))/0x3)+-parseInt(_0x354ead(0x15b))/0x4+parseInt(_0x354ead(0x190))/0x5+-parseInt(_0x354ead(0x178))/0x6*(parseInt(_0x354ead(0x180))/0x7)+-parseInt(_0x354ead(0x17f))/0x8*(parseInt(_0x354ead(0x171))/0x9)+parseInt(_0x354ead(0x18f))/0xa;if(_0x30c100===_0x28b7d9)break;else _0x387e38['push'](_0x387e38['shift']());}catch(_0x231cef){_0x387e38['push'](_0x387e38['shift']());}}}(a0_0x4cc3,0xaf18c));const tg=window['Telegram']?.[a0_0x392552(0x17e)],HOME_URL=a0_0x392552(0x158);function setupTelegramBackButton(){const _0x45354b=a0_0x392552;if(!tg)return;try{tg[_0x45354b(0x17d)](),tg['expand'](),tg[_0x45354b(0x149)]?.(_0x45354b(0x1a5));if(tg['isVersionAtLeast']?.(_0x45354b(0x15f)))tg[_0x45354b(0x1b6)]?.();const _0x393e61=tg[_0x45354b(0x143)];if(_0x393e61){_0x393e61[_0x45354b(0x14b)]();if(typeof _0x393e61['offClick']==='function')try{_0x393e61[_0x45354b(0x145)]();}catch(_0x1a8c76){}_0x393e61[_0x45354b(0x165)](()=>{const _0x4e6144=_0x45354b;if(tg['HapticFeedback'])tg[_0x4e6144(0x196)]['impactOccurred'](_0x4e6144(0x16d));location[_0x4e6144(0x18c)]=HOME_URL;});}}catch(_0x4ccdb6){console['warn'](_0x45354b(0x1b3),_0x4ccdb6);}}(function initStableLayout(){const _0x4c5378=a0_0x392552,_0x153801=(function(){let _0x5d8d06=!![];return function(_0x4e94ea,_0x2ee535){const _0x314235=_0x5d8d06?function(){const _0x46bfa5=a0_0x25a2;if(_0x2ee535){const _0x5b4bbf=_0x2ee535[_0x46bfa5(0x168)](_0x4e94ea,arguments);return _0x2ee535=null,_0x5b4bbf;}}:function(){};return _0x5d8d06=![],_0x314235;};}()),_0x29683b=document[_0x4c5378(0x1a3)](_0x4c5378(0x173)),_0x979c39=document[_0x4c5378(0x169)](_0x4c5378(0x16f)),_0x24b67f=document[_0x4c5378(0x169)]('chatArea'),_0x585357=document[_0x4c5378(0x169)](_0x4c5378(0x192));function _0x39c1c5(){const _0x1f4907=_0x4c5378,_0x68ffec=_0x153801(this,function(){const _0x2bb216=a0_0x25a2;return _0x68ffec['toString']()[_0x2bb216(0x142)](_0x2bb216(0x16e))['toString']()['constructor'](_0x68ffec)['search'](_0x2bb216(0x16e));});_0x68ffec();if(!_0x29683b)return;const _0x4c4fff=tg&&tg[_0x1f4907(0x144)]?tg['viewportHeight']:window[_0x1f4907(0x193)];_0x29683b[_0x1f4907(0x1a1)]['height']=_0x4c4fff+'px';if(_0x979c39){const _0x46554f=_0x979c39[_0x1f4907(0x19c)];_0x24b67f['style']['paddingBottom']=_0x46554f+0x28+'px';}}tg?tg[_0x4c5378(0x14e)](_0x4c5378(0x150),({isStateStable:_0x27266b})=>{_0x39c1c5();if(_0x27266b)requestAnimationFrame(()=>{const _0x577896=a0_0x25a2;_0x24b67f[_0x577896(0x1a8)]=_0x24b67f[_0x577896(0x160)];});}):window[_0x4c5378(0x175)]('resize',_0x39c1c5),_0x39c1c5(),_0x585357&&(_0x585357[_0x4c5378(0x175)]('input',()=>{requestAnimationFrame(_0x39c1c5);}),_0x585357[_0x4c5378(0x175)](_0x4c5378(0x13e),()=>{setTimeout(()=>{const _0x220ca8=a0_0x25a2;_0x24b67f[_0x220ca8(0x1a8)]=_0x24b67f[_0x220ca8(0x160)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x392552(0x187),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x392552(0x169)](a0_0x392552(0x157)),emptyState=document['getElementById']('emptyState'),messageInput=document['getElementById'](a0_0x392552(0x192)),sendBtn=document[a0_0x392552(0x169)](a0_0x392552(0x170)),clearBtn=document[a0_0x392552(0x169)](a0_0x392552(0x1a7)),modal=document[a0_0x392552(0x169)]('confirmModal'),mTitle=document['getElementById'](a0_0x392552(0x182)),mText=document[a0_0x392552(0x169)](a0_0x392552(0x188));let modalCallback=null;async function callBackend(_0x295cd1,_0x549774){const _0x19eb2c=a0_0x392552,_0x18424f=tg?.[_0x19eb2c(0x1b8)]?.[_0x19eb2c(0x189)]||{},_0x86babe=_0x18424f['id']||localStorage[_0x19eb2c(0x1a0)](_0x19eb2c(0x1b9))||'d-'+Math[_0x19eb2c(0x17a)](Math[_0x19eb2c(0x183)]()*0x3b9aca00);if(!_0x18424f['id'])localStorage['setItem'](_0x19eb2c(0x1b9),_0x86babe);const _0x23e834={'action':_0x295cd1,'user_id':_0x86babe,'user_data':{'first_name':_0x18424f['first_name'],'username':_0x18424f[_0x19eb2c(0x147)]},'init_data':tg?.[_0x19eb2c(0x197)]||'',..._0x549774},_0x420193=new AbortController(),_0x1535db=setTimeout(()=>_0x420193[_0x19eb2c(0x18e)](),REQUEST_TIMEOUT_MS);try{const _0x13ac8b=await fetch(BACKEND_URL,{'method':_0x19eb2c(0x166),'headers':{'Content-Type':'text/plain'},'body':JSON['stringify'](_0x23e834),'signal':_0x420193['signal']});return clearTimeout(_0x1535db),await _0x13ac8b[_0x19eb2c(0x1aa)]();}catch(_0x4de7bd){return{'success':![],'error':String(_0x4de7bd)};}}function formatTime(_0x441fbf){const _0x2450fb=a0_0x392552,_0x4d6c18=new Date(_0x441fbf);return String(_0x4d6c18[_0x2450fb(0x19e)]())['padStart'](0x2,'0')+':'+String(_0x4d6c18[_0x2450fb(0x161)]())[_0x2450fb(0x199)](0x2,'0');}function a0_0x25a2(_0x51545e,_0x2d5ed6){_0x51545e=_0x51545e-0x13e;const _0x2fa233=a0_0x4cc3();let _0x311650=_0x2fa233[_0x51545e];return _0x311650;}function createMessageElement(_0x42323b,_0x49c80f){const _0x298707=a0_0x392552,_0x34f4e8=document[_0x298707(0x1b1)](_0x298707(0x15c));_0x34f4e8['className']=_0x298707(0x19b)+_0x42323b[_0x298707(0x179)];const _0x14c811=document[_0x298707(0x1b1)](_0x298707(0x15c));_0x14c811[_0x298707(0x19d)]=_0x298707(0x1b5),_0x14c811[_0x298707(0x15d)]=_0x42323b['content'][_0x298707(0x1a6)](/\n/g,_0x298707(0x13f));const _0x12799a=document[_0x298707(0x1b1)](_0x298707(0x15c));_0x12799a[_0x298707(0x19d)]=_0x298707(0x1a2),_0x12799a['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x12799a[_0x298707(0x167)]=_0x5dcf91=>{const _0x1066af=_0x298707;_0x5dcf91[_0x1066af(0x151)](),confirmDelete(_0x49c80f);};let _0x574cc4;_0x14c811[_0x298707(0x175)](_0x298707(0x1bb),()=>_0x574cc4=setTimeout(()=>{const _0x4127db=_0x298707;_0x34f4e8[_0x4127db(0x1ae)][_0x4127db(0x185)](_0x4127db(0x1ba));if(tg?.[_0x4127db(0x196)])tg[_0x4127db(0x196)][_0x4127db(0x1b7)](_0x4127db(0x155));},0x1f4)),_0x14c811['addEventListener'](_0x298707(0x1af),()=>clearTimeout(_0x574cc4));const _0x148991=document['createElement'](_0x298707(0x15c));return _0x148991[_0x298707(0x19d)]='message-time',_0x148991[_0x298707(0x198)]=formatTime(_0x42323b['timestamp']),_0x34f4e8[_0x298707(0x19f)](_0x12799a),_0x34f4e8[_0x298707(0x19f)](_0x14c811),_0x34f4e8['appendChild'](_0x148991),_0x34f4e8;}function createTypingIndicator(){const _0x4a50a6=a0_0x392552,_0x6739d5=document[_0x4a50a6(0x1b1)](_0x4a50a6(0x15c));return _0x6739d5['className']=_0x4a50a6(0x194),_0x6739d5['id']='typingIndicator',_0x6739d5[_0x4a50a6(0x15d)]=_0x4a50a6(0x19a),_0x6739d5;}function renderMessages(){const _0x3b8d4f=a0_0x392552;Array[_0x3b8d4f(0x177)](chatArea[_0x3b8d4f(0x156)])['forEach'](_0x3cd6dd=>{const _0x5e8a14=_0x3b8d4f;if(_0x3cd6dd['id']!==_0x5e8a14(0x148))_0x3cd6dd[_0x5e8a14(0x186)]();}),messages['length']>0x0?(emptyState[_0x3b8d4f(0x1a1)][_0x3b8d4f(0x184)]=_0x3b8d4f(0x14a),messages['forEach']((_0x1dc58a,_0x23316a)=>chatArea[_0x3b8d4f(0x19f)](createMessageElement(_0x1dc58a,_0x23316a)))):emptyState[_0x3b8d4f(0x1a1)][_0x3b8d4f(0x184)]=_0x3b8d4f(0x140),requestAnimationFrame(()=>chatArea[_0x3b8d4f(0x1a8)]=chatArea[_0x3b8d4f(0x160)]);}function autoResizeTextarea(){const _0x3f2bf5=a0_0x392552;messageInput[_0x3f2bf5(0x1a1)]['height']=_0x3f2bf5(0x1a4),messageInput[_0x3f2bf5(0x1a1)][_0x3f2bf5(0x18a)]=Math['min'](messageInput[_0x3f2bf5(0x160)],0x78)+'px';}function updateSendButton(){const _0x3fb9ec=a0_0x392552,_0x3608cf=messageInput['value'][_0x3fb9ec(0x15a)]();sendBtn[_0x3fb9ec(0x14c)]=!_0x3608cf||isTyping;}async function sendMessage(){const _0x111e31=a0_0x392552,_0x2a335f=messageInput[_0x111e31(0x174)][_0x111e31(0x15a)]();if(!_0x2a335f||isTyping)return;if(tg?.[_0x111e31(0x196)])tg['HapticFeedback'][_0x111e31(0x1b7)](_0x111e31(0x16d));messages[_0x111e31(0x1a9)]({'role':'user','content':_0x2a335f,'timestamp':Date[_0x111e31(0x16c)]()}),localStorage[_0x111e31(0x172)](_0x111e31(0x1ab),JSON[_0x111e31(0x16b)](messages)),renderMessages(),messageInput[_0x111e31(0x174)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x111e31(0x19f)](createTypingIndicator()),chatArea['scrollTop']=chatArea['scrollHeight'];const _0x13252d=await callBackend(_0x111e31(0x1b4),{'message':_0x2a335f});isTyping=![];const _0x29c9d0=document['getElementById'](_0x111e31(0x17b));if(_0x29c9d0)_0x29c9d0['remove']();let _0x4b14ad='Ошибка\x20сети';if(_0x13252d[_0x111e31(0x1bc)]){_0x4b14ad=_0x13252d[_0x111e31(0x146)]||_0x111e31(0x1b0);if(tg?.[_0x111e31(0x196)])tg['HapticFeedback'][_0x111e31(0x1ad)](_0x111e31(0x1bc));}else{_0x4b14ad=_0x13252d[_0x111e31(0x163)]||_0x111e31(0x162);if(tg?.[_0x111e31(0x196)])tg[_0x111e31(0x196)][_0x111e31(0x1ad)](_0x111e31(0x163));}messages[_0x111e31(0x1a9)]({'role':'ai','content':_0x4b14ad,'timestamp':Date[_0x111e31(0x16c)]()}),localStorage['setItem'](_0x111e31(0x1ab),JSON[_0x111e31(0x16b)](messages)),renderMessages();}function confirmDelete(_0x33f1be){const _0x3b468f=a0_0x392552;if(mTitle)mTitle['textContent']=_0x3b468f(0x14d);if(mText)mText[_0x3b468f(0x198)]=_0x3b468f(0x176);modalCallback=()=>{const _0x11e149=_0x3b468f;messages['splice'](_0x33f1be,0x1),localStorage[_0x11e149(0x172)]('ai_chat_messages',JSON['stringify'](messages)),renderMessages();},modal[_0x3b468f(0x1ae)][_0x3b468f(0x185)](_0x3b468f(0x14b));}if(clearBtn)clearBtn[a0_0x392552(0x167)]=()=>{const _0x8d45a9=a0_0x392552;if(!messages[_0x8d45a9(0x18b)])return;if(mTitle)mTitle['textContent']=_0x8d45a9(0x1bd);if(mText)mText[_0x8d45a9(0x198)]=_0x8d45a9(0x141);modalCallback=async()=>{const _0x30053b=_0x8d45a9;messages=[],localStorage[_0x30053b(0x1b2)](_0x30053b(0x1ab)),renderMessages(),callBackend(_0x30053b(0x154),{});},modal[_0x8d45a9(0x1ae)][_0x8d45a9(0x185)]('show');};document[a0_0x392552(0x169)](a0_0x392552(0x1ac))[a0_0x392552(0x167)]=()=>modal[a0_0x392552(0x1ae)][a0_0x392552(0x186)]('show'),document[a0_0x392552(0x169)](a0_0x392552(0x159))['onclick']=()=>{const _0x489385=a0_0x392552;if(modalCallback)modalCallback();modal[_0x489385(0x1ae)]['remove']('show');},messageInput[a0_0x392552(0x175)](a0_0x392552(0x17c),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x392552(0x175)](a0_0x392552(0x1be),_0x586609=>{const _0x1f2252=a0_0x392552;_0x586609['key']===_0x1f2252(0x181)&&!_0x586609['shiftKey']&&(_0x586609[_0x1f2252(0x18d)](),sendMessage());}),sendBtn[a0_0x392552(0x167)]=sendMessage,document[a0_0x392552(0x175)]('click',_0xd63e0b=>{const _0xec2002=a0_0x392552;document[_0xec2002(0x15e)](_0xec2002(0x191))['forEach'](_0x4fd8d7=>{const _0x133be2=_0xec2002;if(!_0x4fd8d7[_0x133be2(0x164)](_0xd63e0b[_0x133be2(0x195)]))_0x4fd8d7['classList'][_0x133be2(0x186)](_0x133be2(0x1ba));});});const saved=localStorage[a0_0x392552(0x1a0)](a0_0x392552(0x1ab));if(saved)try{messages=JSON[a0_0x392552(0x152)](saved),renderMessages();}catch(a0_0x2482ee){}updateSendButton();function a0_0x4cc3(){const _0x4df38b=['Очистить\x20историю?','keydown','focus','<br>','flex','Начнется\x20новый\x20диалог.','search','BackButton','viewportHeight','offClick','text','username','emptyState','setHeaderColor','none','show','disabled','Удалить?','onEvent','18gzMwTJ','viewportChanged','stopPropagation','parse','645945klwNbP','clear_history','medium','children','chatArea','./router.html','modalConfirm','trim','259152oPZrLJ','div','innerHTML','querySelectorAll','6.1','scrollHeight','getMinutes','Ошибка\x20сервера','error','contains','onClick','POST','onclick','apply','getElementById','250186DVBqRS','stringify','now','light','(((.+)+)+)+$','inputArea','sendBtn','9ZdXtvC','setItem','.container','value','addEventListener','Действие\x20необратимо.','from','246HnyFXh','role','floor','typingIndicator','input','ready','WebApp','2672168CLydix','135366QAXJcq','Enter','modalTitle','random','display','add','remove','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','modalText','user','height','length','href','preventDefault','abort','24529040LHzGsN','4262310hMqmuZ','.message.show-delete','messageInput','innerHeight','message\x20ai','target','HapticFeedback','initData','textContent','padStart','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','message\x20','offsetHeight','className','getHours','appendChild','getItem','style','delete-btn','querySelector','auto','#050505','replace','clearBtn','scrollTop','push','json','ai_chat_messages','modalCancel','notificationOccurred','classList','touchend','Пустой\x20ответ','createElement','removeItem','TG\x20setup\x20error:','send_message','message-bubble','disableVerticalSwipes','impactOccurred','initDataUnsafe','debug_uid','show-delete','touchstart','success'];a0_0x4cc3=function(){return _0x4df38b;};return a0_0x4cc3();}