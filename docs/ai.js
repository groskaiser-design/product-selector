const a0_0x1491db=a0_0x465c;(function(_0x2c91dc,_0x2216df){const _0x316ae1=a0_0x465c,_0x206bcb=_0x2c91dc();while(!![]){try{const _0x52bbb4=-parseInt(_0x316ae1(0xac))/0x1*(parseInt(_0x316ae1(0xce))/0x2)+-parseInt(_0x316ae1(0xa0))/0x3*(-parseInt(_0x316ae1(0xc0))/0x4)+parseInt(_0x316ae1(0xed))/0x5*(parseInt(_0x316ae1(0xd8))/0x6)+-parseInt(_0x316ae1(0x106))/0x7+parseInt(_0x316ae1(0xcb))/0x8+parseInt(_0x316ae1(0xdb))/0x9+-parseInt(_0x316ae1(0xfa))/0xa;if(_0x52bbb4===_0x2216df)break;else _0x206bcb['push'](_0x206bcb['shift']());}catch(_0x65a74c){_0x206bcb['push'](_0x206bcb['shift']());}}}(a0_0x3815,0xd4b2f));function a0_0x3815(){const _0x40ce2b=['Начнется\x20новый\x20диалог.','offClick','splice','none','onClick','viewportChanged','textContent','signal','setItem','parse','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','notificationOccurred','26825530DGVmWZ','floor','delete-btn','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','WebApp','apply','initDataUnsafe','height','user','Ошибка\x20сервера','stopPropagation','preventDefault','2061199KhwlpC','stringify','href','addEventListener','focus','content','onEvent','(((.+)+)+)+$','Enter','#050505','input','push','viewportHeight','onclick','auto','function','querySelectorAll','username','style','abort','show','modalTitle','text/plain','impactOccurred','Telegram','1294431gIgVDd','disabled','forEach','chatArea','querySelector','setHeaderColor','classList','light','modalConfirm','innerHeight','first_name','<br>','4meStOP','messageInput','typingIndicator','TG\x20setup\x20error:','div','timestamp','getElementById','emptyState','resize','now','./router.html','6.1','message-time','replace','min','keydown','scrollHeight','success','constructor','className','12mnMiKg','clearBtn','remove','search','trim','padStart','createElement','BackButton','text','show-delete','appendChild','3464640evsrQz','json','isVersionAtLeast','474618BAvjZd','debug_uid','Очистить\x20историю?','value','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','medium','touchend','innerHTML','length','HapticFeedback','10337694QtZHqj','contains','role','12123009hhefWF','getItem','error','children','Действие\x20необратимо.','touchstart','getMinutes','key','ai_chat_messages','display','modalCancel','Удалить?','offsetHeight','scrollTop','disableVerticalSwipes','from','click','add','5vkobrm'];a0_0x3815=function(){return _0x40ce2b;};return a0_0x3815();}const tg=window[a0_0x1491db(0x9f)]?.[a0_0x1491db(0xfe)],HOME_URL=a0_0x1491db(0xb6);function setupTelegramBackButton(){const _0x133465=a0_0x1491db;if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x133465(0xa5)]?.(_0x133465(0x90));if(tg[_0x133465(0xcd)]?.(_0x133465(0xb7)))tg[_0x133465(0xe9)]?.();const _0x3c4aa0=tg[_0x133465(0xc7)];if(_0x3c4aa0){_0x3c4aa0['show']();if(typeof _0x3c4aa0[_0x133465(0xef)]===_0x133465(0x96))try{_0x3c4aa0[_0x133465(0xef)]();}catch(_0x5dc803){}_0x3c4aa0[_0x133465(0xf2)](()=>{const _0x23e7f7=_0x133465;if(tg[_0x23e7f7(0xd7)])tg['HapticFeedback'][_0x23e7f7(0x9e)](_0x23e7f7(0xa7));location[_0x23e7f7(0x89)]=HOME_URL;});}}catch(_0x40a539){console['warn'](_0x133465(0xaf),_0x40a539);}}function a0_0x465c(_0x5e7bbf,_0xca7190){_0x5e7bbf=_0x5e7bbf-0x88;const _0x219717=a0_0x3815();let _0x2dc89e=_0x219717[_0x5e7bbf];return _0x2dc89e;}(function initStableLayout(){const _0x2664a1=a0_0x1491db,_0x238de2=(function(){let _0x42006f=!![];return function(_0x3beb97,_0x290885){const _0x3f9cbc=_0x42006f?function(){const _0x35da3e=a0_0x465c;if(_0x290885){const _0x2e21f4=_0x290885[_0x35da3e(0xff)](_0x3beb97,arguments);return _0x290885=null,_0x2e21f4;}}:function(){};return _0x42006f=![],_0x3f9cbc;};}()),_0x12d7cf=document[_0x2664a1(0xa4)]('.container'),_0x5c34e6=document['getElementById']('inputArea'),_0xcb921f=document[_0x2664a1(0xb2)]('chatArea'),_0x10bbd2=document[_0x2664a1(0xb2)](_0x2664a1(0xad));function _0x570740(){const _0x11e199=_0x2664a1,_0x582b59=_0x238de2(this,function(){const _0x2b0b5c=a0_0x465c;return _0x582b59['toString']()['search'](_0x2b0b5c(0x8e))['toString']()[_0x2b0b5c(0xbe)](_0x582b59)[_0x2b0b5c(0xc3)](_0x2b0b5c(0x8e));});_0x582b59();if(!_0x12d7cf)return;const _0x5efbee=tg&&tg[_0x11e199(0x93)]?tg[_0x11e199(0x93)]:window[_0x11e199(0xa9)];_0x12d7cf[_0x11e199(0x99)][_0x11e199(0x101)]=_0x5efbee+'px';if(_0x5c34e6){const _0x48d994=_0x5c34e6[_0x11e199(0xe7)];_0xcb921f['style']['paddingBottom']=_0x48d994+0x28+'px';}}tg?tg[_0x2664a1(0x8d)](_0x2664a1(0xf3),({isStateStable:_0x868e5f})=>{_0x570740();if(_0x868e5f)requestAnimationFrame(()=>{const _0x365f19=a0_0x465c;_0xcb921f['scrollTop']=_0xcb921f[_0x365f19(0xbc)];});}):window[_0x2664a1(0x8a)](_0x2664a1(0xb4),_0x570740),_0x570740(),_0x10bbd2&&(_0x10bbd2['addEventListener']('input',()=>{requestAnimationFrame(_0x570740);}),_0x10bbd2[_0x2664a1(0x8a)](_0x2664a1(0x8b),()=>{setTimeout(()=>{const _0x32e7af=a0_0x465c;_0xcb921f[_0x32e7af(0xe8)]=_0xcb921f[_0x32e7af(0xbc)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x1491db(0xf8),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x1491db(0xb2)](a0_0x1491db(0xa3)),emptyState=document[a0_0x1491db(0xb2)]('emptyState'),messageInput=document['getElementById'](a0_0x1491db(0xad)),sendBtn=document[a0_0x1491db(0xb2)]('sendBtn'),clearBtn=document['getElementById'](a0_0x1491db(0xc1)),modal=document[a0_0x1491db(0xb2)]('confirmModal'),mTitle=document[a0_0x1491db(0xb2)](a0_0x1491db(0x9c)),mText=document[a0_0x1491db(0xb2)]('modalText');let modalCallback=null;async function callBackend(_0x2136d2,_0x30fc11){const _0x33331b=a0_0x1491db,_0x23f8a2=tg?.[_0x33331b(0x100)]?.['user']||{},_0x2f46fa=_0x23f8a2['id']||localStorage[_0x33331b(0xdc)](_0x33331b(0xcf))||'d-'+Math[_0x33331b(0xfb)](Math['random']()*0x3b9aca00);if(!_0x23f8a2['id'])localStorage[_0x33331b(0xf6)](_0x33331b(0xcf),_0x2f46fa);const _0x1aa75f={'action':_0x2136d2,'user_id':_0x2f46fa,'user_data':{'first_name':_0x23f8a2[_0x33331b(0xaa)],'username':_0x23f8a2[_0x33331b(0x98)]},'init_data':tg?.['initData']||'',..._0x30fc11},_0x3b6766=new AbortController(),_0x1cc9f9=setTimeout(()=>_0x3b6766[_0x33331b(0x9a)](),REQUEST_TIMEOUT_MS);try{const _0x43b05e=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x33331b(0x9d)},'body':JSON[_0x33331b(0x88)](_0x1aa75f),'signal':_0x3b6766[_0x33331b(0xf5)]});return clearTimeout(_0x1cc9f9),await _0x43b05e[_0x33331b(0xcc)]();}catch(_0x190306){return{'success':![],'error':String(_0x190306)};}}function formatTime(_0x208da6){const _0x10bc41=a0_0x1491db,_0x440f5c=new Date(_0x208da6);return String(_0x440f5c['getHours']())[_0x10bc41(0xc5)](0x2,'0')+':'+String(_0x440f5c[_0x10bc41(0xe1)]())[_0x10bc41(0xc5)](0x2,'0');}function createMessageElement(_0x1c8675,_0x359f07){const _0x3198df=a0_0x1491db,_0x5d2300=document[_0x3198df(0xc6)]('div');_0x5d2300['className']='message\x20'+_0x1c8675[_0x3198df(0xda)];const _0x2a83dc=document['createElement'](_0x3198df(0xb0));_0x2a83dc['className']='message-bubble',_0x2a83dc[_0x3198df(0xd5)]=_0x1c8675[_0x3198df(0x8c)][_0x3198df(0xb9)](/\n/g,_0x3198df(0xab));const _0x58c0e1=document['createElement'](_0x3198df(0xb0));_0x58c0e1[_0x3198df(0xbf)]=_0x3198df(0xfc),_0x58c0e1['innerHTML']=_0x3198df(0xd2),_0x58c0e1[_0x3198df(0x94)]=_0x2360a2=>{const _0x240945=_0x3198df;_0x2360a2[_0x240945(0x104)](),confirmDelete(_0x359f07);};let _0x3f4132;_0x2a83dc['addEventListener'](_0x3198df(0xe0),()=>_0x3f4132=setTimeout(()=>{const _0x546541=_0x3198df;_0x5d2300['classList']['add'](_0x546541(0xc9));if(tg?.['HapticFeedback'])tg[_0x546541(0xd7)][_0x546541(0x9e)](_0x546541(0xd3));},0x1f4)),_0x2a83dc[_0x3198df(0x8a)](_0x3198df(0xd4),()=>clearTimeout(_0x3f4132));const _0xa443f4=document[_0x3198df(0xc6)]('div');return _0xa443f4[_0x3198df(0xbf)]=_0x3198df(0xb8),_0xa443f4[_0x3198df(0xf4)]=formatTime(_0x1c8675[_0x3198df(0xb1)]),_0x5d2300[_0x3198df(0xca)](_0x58c0e1),_0x5d2300[_0x3198df(0xca)](_0x2a83dc),_0x5d2300['appendChild'](_0xa443f4),_0x5d2300;}function createTypingIndicator(){const _0x58436b=a0_0x1491db,_0x1c7c51=document[_0x58436b(0xc6)]('div');return _0x1c7c51[_0x58436b(0xbf)]='message\x20ai',_0x1c7c51['id']=_0x58436b(0xae),_0x1c7c51[_0x58436b(0xd5)]=_0x58436b(0xfd),_0x1c7c51;}function renderMessages(){const _0x1d4fde=a0_0x1491db;Array[_0x1d4fde(0xea)](chatArea[_0x1d4fde(0xde)])[_0x1d4fde(0xa2)](_0x15a656=>{const _0x2dfa69=_0x1d4fde;if(_0x15a656['id']!==_0x2dfa69(0xb3))_0x15a656[_0x2dfa69(0xc2)]();}),messages[_0x1d4fde(0xd6)]>0x0?(emptyState[_0x1d4fde(0x99)][_0x1d4fde(0xe4)]=_0x1d4fde(0xf1),messages[_0x1d4fde(0xa2)]((_0x1959e3,_0x14103b)=>chatArea[_0x1d4fde(0xca)](createMessageElement(_0x1959e3,_0x14103b)))):emptyState[_0x1d4fde(0x99)][_0x1d4fde(0xe4)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x1d4fde(0xbc)]);}function autoResizeTextarea(){const _0x323b1f=a0_0x1491db;messageInput[_0x323b1f(0x99)][_0x323b1f(0x101)]=_0x323b1f(0x95),messageInput[_0x323b1f(0x99)][_0x323b1f(0x101)]=Math[_0x323b1f(0xba)](messageInput[_0x323b1f(0xbc)],0x78)+'px';}function updateSendButton(){const _0x2affb8=a0_0x1491db,_0x107bf6=messageInput[_0x2affb8(0xd1)][_0x2affb8(0xc4)]();sendBtn[_0x2affb8(0xa1)]=!_0x107bf6||isTyping;}async function sendMessage(){const _0x656920=a0_0x1491db,_0x18754f=messageInput[_0x656920(0xd1)][_0x656920(0xc4)]();if(!_0x18754f||isTyping)return;if(tg?.[_0x656920(0xd7)])tg[_0x656920(0xd7)]['impactOccurred']('light');messages[_0x656920(0x92)]({'role':_0x656920(0x102),'content':_0x18754f,'timestamp':Date[_0x656920(0xb5)]()}),localStorage[_0x656920(0xf6)]('ai_chat_messages',JSON[_0x656920(0x88)](messages)),renderMessages(),messageInput[_0x656920(0xd1)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x656920(0xca)](createTypingIndicator()),chatArea[_0x656920(0xe8)]=chatArea[_0x656920(0xbc)];const _0xa2dcdf=await callBackend('send_message',{'message':_0x18754f});isTyping=![];const _0x15a11c=document['getElementById'](_0x656920(0xae));if(_0x15a11c)_0x15a11c[_0x656920(0xc2)]();let _0x503bb1='Ошибка\x20сети';if(_0xa2dcdf[_0x656920(0xbd)]){_0x503bb1=_0xa2dcdf[_0x656920(0xc8)]||'Пустой\x20ответ';if(tg?.[_0x656920(0xd7)])tg[_0x656920(0xd7)][_0x656920(0xf9)](_0x656920(0xbd));}else{_0x503bb1=_0xa2dcdf[_0x656920(0xdd)]||_0x656920(0x103);if(tg?.['HapticFeedback'])tg[_0x656920(0xd7)][_0x656920(0xf9)](_0x656920(0xdd));}messages['push']({'role':'ai','content':_0x503bb1,'timestamp':Date[_0x656920(0xb5)]()}),localStorage[_0x656920(0xf6)](_0x656920(0xe3),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x8319b1){const _0x5dfa92=a0_0x1491db;if(mTitle)mTitle[_0x5dfa92(0xf4)]=_0x5dfa92(0xe6);if(mText)mText[_0x5dfa92(0xf4)]=_0x5dfa92(0xdf);modalCallback=()=>{const _0x35ab41=_0x5dfa92;messages[_0x35ab41(0xf0)](_0x8319b1,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x35ab41(0x88)](messages)),renderMessages();},modal[_0x5dfa92(0xa6)][_0x5dfa92(0xec)](_0x5dfa92(0x9b));}if(clearBtn)clearBtn['onclick']=()=>{const _0x21f5a3=a0_0x1491db;if(!messages['length'])return;if(mTitle)mTitle[_0x21f5a3(0xf4)]=_0x21f5a3(0xd0);if(mText)mText[_0x21f5a3(0xf4)]=_0x21f5a3(0xee);modalCallback=async()=>{messages=[],localStorage['removeItem']('ai_chat_messages'),renderMessages(),callBackend('clear_history',{});},modal[_0x21f5a3(0xa6)][_0x21f5a3(0xec)]('show');};document[a0_0x1491db(0xb2)](a0_0x1491db(0xe5))[a0_0x1491db(0x94)]=()=>modal[a0_0x1491db(0xa6)][a0_0x1491db(0xc2)](a0_0x1491db(0x9b)),document[a0_0x1491db(0xb2)](a0_0x1491db(0xa8))[a0_0x1491db(0x94)]=()=>{const _0x24f7df=a0_0x1491db;if(modalCallback)modalCallback();modal[_0x24f7df(0xa6)][_0x24f7df(0xc2)](_0x24f7df(0x9b));},messageInput[a0_0x1491db(0x8a)](a0_0x1491db(0x91),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x1491db(0x8a)](a0_0x1491db(0xbb),_0x44f070=>{const _0x372aaf=a0_0x1491db;_0x44f070[_0x372aaf(0xe2)]===_0x372aaf(0x8f)&&!_0x44f070['shiftKey']&&(_0x44f070[_0x372aaf(0x105)](),sendMessage());}),sendBtn[a0_0x1491db(0x94)]=sendMessage,document[a0_0x1491db(0x8a)](a0_0x1491db(0xeb),_0x48545c=>{const _0x2d1a3a=a0_0x1491db;document[_0x2d1a3a(0x97)]('.message.show-delete')['forEach'](_0x145a35=>{const _0x12a9b6=_0x2d1a3a;if(!_0x145a35[_0x12a9b6(0xd9)](_0x48545c['target']))_0x145a35[_0x12a9b6(0xa6)][_0x12a9b6(0xc2)]('show-delete');});});const saved=localStorage['getItem'](a0_0x1491db(0xe3));if(saved)try{messages=JSON[a0_0x1491db(0xf7)](saved),renderMessages();}catch(a0_0xa22cd3){}updateSendButton();