const a0_0x4f4e47=a0_0xfae0;(function(_0x3fdf2f,_0x24ddf0){const _0x43e0c7=a0_0xfae0,_0x214d22=_0x3fdf2f();while(!![]){try{const _0x50602a=parseInt(_0x43e0c7(0x1fb))/0x1+-parseInt(_0x43e0c7(0x1dc))/0x2*(-parseInt(_0x43e0c7(0x21f))/0x3)+parseInt(_0x43e0c7(0x1ee))/0x4*(parseInt(_0x43e0c7(0x1be))/0x5)+parseInt(_0x43e0c7(0x206))/0x6+-parseInt(_0x43e0c7(0x1b1))/0x7*(parseInt(_0x43e0c7(0x1e5))/0x8)+parseInt(_0x43e0c7(0x1bc))/0x9*(parseInt(_0x43e0c7(0x1b4))/0xa)+-parseInt(_0x43e0c7(0x1fa))/0xb*(parseInt(_0x43e0c7(0x1b5))/0xc);if(_0x50602a===_0x24ddf0)break;else _0x214d22['push'](_0x214d22['shift']());}catch(_0x4c0bbc){_0x214d22['push'](_0x214d22['shift']());}}}(a0_0xd113,0x8fc69));const tg=window['Telegram']?.[a0_0x4f4e47(0x20d)],HOME_URL=a0_0x4f4e47(0x1cf);function setupTelegramBackButton(){const _0x2dca8f=a0_0x4f4e47,_0x212ab7=(function(){let _0x21ec4f=!![];return function(_0x539ea7,_0x62baa3){const _0x56b9b5=_0x21ec4f?function(){const _0x1af8e3=a0_0xfae0;if(_0x62baa3){const _0x2c05fd=_0x62baa3[_0x1af8e3(0x1e3)](_0x539ea7,arguments);return _0x62baa3=null,_0x2c05fd;}}:function(){};return _0x21ec4f=![],_0x56b9b5;};}()),_0x15dd13=_0x212ab7(this,function(){const _0x5426ec=a0_0xfae0;return _0x15dd13[_0x5426ec(0x1d9)]()['search']('(((.+)+)+)+$')['toString']()[_0x5426ec(0x217)](_0x15dd13)[_0x5426ec(0x1d7)](_0x5426ec(0x1e1));});_0x15dd13();if(!tg)return;try{tg['ready'](),tg['expand'](),tg[_0x2dca8f(0x1b8)]?.(_0x2dca8f(0x21d));if(tg[_0x2dca8f(0x227)]?.('6.1'))tg['disableVerticalSwipes']?.();const _0x2ec361=tg['BackButton'];if(_0x2ec361){_0x2ec361[_0x2dca8f(0x205)]();if(typeof _0x2ec361[_0x2dca8f(0x229)]===_0x2dca8f(0x1c7))try{_0x2ec361['offClick']();}catch(_0x15e143){}_0x2ec361[_0x2dca8f(0x218)](()=>{const _0x5c9912=_0x2dca8f;if(tg[_0x5c9912(0x1bf)])tg[_0x5c9912(0x1bf)][_0x5c9912(0x1cb)](_0x5c9912(0x1af));location[_0x5c9912(0x1d0)]=HOME_URL;});}}catch(_0x28b91b){console['warn'](_0x2dca8f(0x200),_0x28b91b);}}(function initStableLayout(){const _0xccd9=a0_0x4f4e47,_0x74bc11=document['querySelector']('.container'),_0xa99e34=document[_0xccd9(0x203)](_0xccd9(0x21b)),_0xb6abe7=document['getElementById'](_0xccd9(0x207)),_0x190944=document[_0xccd9(0x203)](_0xccd9(0x20c));function _0xfe2cb9(){const _0x2ce899=_0xccd9;if(!_0x74bc11)return;const _0x2f9067=tg&&tg[_0x2ce899(0x1f4)]?tg['viewportHeight']:window[_0x2ce899(0x210)];_0x74bc11[_0x2ce899(0x1db)][_0x2ce899(0x221)]=_0x2f9067+'px';if(_0xa99e34){const _0x28f520=_0xa99e34['offsetHeight'];_0xb6abe7['style']['paddingBottom']=_0x28f520+0x28+'px';}}tg?tg[_0xccd9(0x1c6)]('viewportChanged',({isStateStable:_0x5001e0})=>{_0xfe2cb9();if(_0x5001e0)requestAnimationFrame(()=>{const _0x2e7ab1=a0_0xfae0;_0xb6abe7[_0x2e7ab1(0x1eb)]=_0xb6abe7[_0x2e7ab1(0x213)];});}):window[_0xccd9(0x215)](_0xccd9(0x20b),_0xfe2cb9),_0xfe2cb9(),_0x190944&&(_0x190944[_0xccd9(0x215)](_0xccd9(0x1ba),()=>{requestAnimationFrame(_0xfe2cb9);}),_0x190944[_0xccd9(0x215)]('focus',()=>{setTimeout(()=>{const _0x4d994d=a0_0xfae0;_0xb6abe7[_0x4d994d(0x1eb)]=_0xb6abe7['scrollHeight'];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x4f4e47(0x1c9),REQUEST_TIMEOUT_MS=0xafc8;function a0_0xd113(){const _0x4a0e41=['ai_chat_messages','target','textContent','touchend','(((.+)+)+)+$','push','apply','replace','448HxjHLP','floor','message\x20ai','remove','sendBtn','Ошибка\x20сервера','scrollTop','auto','preventDefault','2320988vYoBru','success','add','value','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','error','viewportHeight','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','classList','show-delete','from','padStart','12792769xDjpLN','325341NxCWUC','disabled','POST','now','removeItem','TG\x20setup\x20error:','createElement','medium','getElementById','confirmModal','show','618528MPhRwr','chatArea','Enter','abort','username','resize','messageInput','WebApp','clearBtn','getHours','innerHeight','parse','text','scrollHeight','modalCancel','addEventListener','user','constructor','onClick','notificationOccurred','<br>','inputArea','Действие\x20необратимо.','#050505','none','1977eKZFos','display','height','onclick','splice','modalConfirm','div','Удалить?','isVersionAtLeast','Пустой\x20ответ','offClick','emptyState','initData','shiftKey','light','clear_history','96523Vdezno','typingIndicator','stringify','16280SuGtxV','12JnsguJ','forEach','modalTitle','setHeaderColor','length','input','className','5769BBNXay','modalText','5mFbChd','HapticFeedback','text/plain','random','json','keydown','key','stopPropagation','onEvent','function','signal','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','click','impactOccurred','trim','Начнется\x20новый\x20диалог.','flex','./router.html','href','.message.show-delete','setItem','appendChild','initDataUnsafe','querySelectorAll','debug_uid','search','message-bubble','toString','innerHTML','style','1432nqLgdO'];a0_0xd113=function(){return _0x4a0e41;};return a0_0xd113();}let messages=[],isTyping=![];const chatArea=document[a0_0x4f4e47(0x203)](a0_0x4f4e47(0x207)),emptyState=document[a0_0x4f4e47(0x203)](a0_0x4f4e47(0x22a)),messageInput=document[a0_0x4f4e47(0x203)](a0_0x4f4e47(0x20c)),sendBtn=document['getElementById'](a0_0x4f4e47(0x1e9)),clearBtn=document[a0_0x4f4e47(0x203)](a0_0x4f4e47(0x20e)),modal=document[a0_0x4f4e47(0x203)](a0_0x4f4e47(0x204)),mTitle=document[a0_0x4f4e47(0x203)](a0_0x4f4e47(0x1b7)),mText=document['getElementById'](a0_0x4f4e47(0x1bd));function a0_0xfae0(_0x59eb36,_0x5d5fa2){_0x59eb36=_0x59eb36-0x1af;const _0x578d73=a0_0xd113();let _0x2edac7=_0x578d73[_0x59eb36];return _0x2edac7;}let modalCallback=null;async function callBackend(_0x152e32,_0x3be3d2){const _0x4e6aa2=a0_0x4f4e47,_0x3ce1d1=tg?.[_0x4e6aa2(0x1d4)]?.[_0x4e6aa2(0x216)]||{},_0x4380db=_0x3ce1d1['id']||localStorage['getItem'](_0x4e6aa2(0x1d6))||'d-'+Math[_0x4e6aa2(0x1e6)](Math[_0x4e6aa2(0x1c1)]()*0x3b9aca00);if(!_0x3ce1d1['id'])localStorage[_0x4e6aa2(0x1d2)](_0x4e6aa2(0x1d6),_0x4380db);const _0x179698={'action':_0x152e32,'user_id':_0x4380db,'user_data':{'first_name':_0x3ce1d1['first_name'],'username':_0x3ce1d1[_0x4e6aa2(0x20a)]},'init_data':tg?.[_0x4e6aa2(0x22b)]||'',..._0x3be3d2},_0x38a7b7=new AbortController(),_0x370f0f=setTimeout(()=>_0x38a7b7[_0x4e6aa2(0x209)](),REQUEST_TIMEOUT_MS);try{const _0x36fe5a=await fetch(BACKEND_URL,{'method':_0x4e6aa2(0x1fd),'headers':{'Content-Type':_0x4e6aa2(0x1c0)},'body':JSON[_0x4e6aa2(0x1b3)](_0x179698),'signal':_0x38a7b7[_0x4e6aa2(0x1c8)]});return clearTimeout(_0x370f0f),await _0x36fe5a[_0x4e6aa2(0x1c2)]();}catch(_0x5e7836){return{'success':![],'error':String(_0x5e7836)};}}function formatTime(_0x58c652){const _0x389171=a0_0x4f4e47,_0x2c985a=new Date(_0x58c652);return String(_0x2c985a[_0x389171(0x20f)]())[_0x389171(0x1f9)](0x2,'0')+':'+String(_0x2c985a['getMinutes']())[_0x389171(0x1f9)](0x2,'0');}function createMessageElement(_0x34a296,_0x4fcf7b){const _0x2ec068=a0_0x4f4e47,_0x149904=document['createElement']('div');_0x149904['className']='message\x20'+_0x34a296['role'];const _0x858ae1=document[_0x2ec068(0x201)](_0x2ec068(0x225));_0x858ae1[_0x2ec068(0x1bb)]=_0x2ec068(0x1d8),_0x858ae1[_0x2ec068(0x1da)]=_0x34a296['content'][_0x2ec068(0x1e4)](/\n/g,_0x2ec068(0x21a));const _0x4cf01a=document[_0x2ec068(0x201)]('div');_0x4cf01a['className']='delete-btn',_0x4cf01a['innerHTML']=_0x2ec068(0x1f5),_0x4cf01a['onclick']=_0x347a66=>{const _0x573861=_0x2ec068;_0x347a66[_0x573861(0x1c5)](),confirmDelete(_0x4fcf7b);};let _0xda8b7c;_0x858ae1['addEventListener']('touchstart',()=>_0xda8b7c=setTimeout(()=>{const _0x376ea4=_0x2ec068;_0x149904['classList'][_0x376ea4(0x1f0)](_0x376ea4(0x1f7));if(tg?.[_0x376ea4(0x1bf)])tg[_0x376ea4(0x1bf)][_0x376ea4(0x1cb)](_0x376ea4(0x202));},0x1f4)),_0x858ae1[_0x2ec068(0x215)](_0x2ec068(0x1e0),()=>clearTimeout(_0xda8b7c));const _0x2ed251=document[_0x2ec068(0x201)](_0x2ec068(0x225));return _0x2ed251['className']='message-time',_0x2ed251[_0x2ec068(0x1df)]=formatTime(_0x34a296['timestamp']),_0x149904[_0x2ec068(0x1d3)](_0x4cf01a),_0x149904[_0x2ec068(0x1d3)](_0x858ae1),_0x149904[_0x2ec068(0x1d3)](_0x2ed251),_0x149904;}function createTypingIndicator(){const _0x2752bd=a0_0x4f4e47,_0x577495=document['createElement'](_0x2752bd(0x225));return _0x577495[_0x2752bd(0x1bb)]=_0x2752bd(0x1e7),_0x577495['id']=_0x2752bd(0x1b2),_0x577495['innerHTML']=_0x2752bd(0x1f2),_0x577495;}function renderMessages(){const _0x20f672=a0_0x4f4e47;Array[_0x20f672(0x1f8)](chatArea['children'])[_0x20f672(0x1b6)](_0x14f899=>{const _0xa11ba2=_0x20f672;if(_0x14f899['id']!==_0xa11ba2(0x22a))_0x14f899['remove']();}),messages[_0x20f672(0x1b9)]>0x0?(emptyState[_0x20f672(0x1db)]['display']=_0x20f672(0x21e),messages[_0x20f672(0x1b6)]((_0x4af45d,_0x330a8b)=>chatArea[_0x20f672(0x1d3)](createMessageElement(_0x4af45d,_0x330a8b)))):emptyState[_0x20f672(0x1db)][_0x20f672(0x220)]=_0x20f672(0x1ce),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x20f672(0x213)]);}function autoResizeTextarea(){const _0x56666d=a0_0x4f4e47;messageInput['style'][_0x56666d(0x221)]=_0x56666d(0x1ec),messageInput[_0x56666d(0x1db)][_0x56666d(0x221)]=Math['min'](messageInput[_0x56666d(0x213)],0x78)+'px';}function updateSendButton(){const _0x2b0491=a0_0x4f4e47,_0x5730df=messageInput[_0x2b0491(0x1f1)][_0x2b0491(0x1cc)]();sendBtn[_0x2b0491(0x1fc)]=!_0x5730df||isTyping;}async function sendMessage(){const _0x4d4d96=a0_0x4f4e47,_0x2ea62a=messageInput[_0x4d4d96(0x1f1)]['trim']();if(!_0x2ea62a||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x4d4d96(0x1bf)]['impactOccurred']('light');messages[_0x4d4d96(0x1e2)]({'role':_0x4d4d96(0x216),'content':_0x2ea62a,'timestamp':Date[_0x4d4d96(0x1fe)]()}),localStorage[_0x4d4d96(0x1d2)](_0x4d4d96(0x1dd),JSON[_0x4d4d96(0x1b3)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x4d4d96(0x1d3)](createTypingIndicator()),chatArea[_0x4d4d96(0x1eb)]=chatArea[_0x4d4d96(0x213)];const _0x5c3536=await callBackend('send_message',{'message':_0x2ea62a});isTyping=![];const _0x566c9d=document[_0x4d4d96(0x203)](_0x4d4d96(0x1b2));if(_0x566c9d)_0x566c9d[_0x4d4d96(0x1e8)]();let _0x57213a='Ошибка\x20сети';if(_0x5c3536[_0x4d4d96(0x1ef)]){_0x57213a=_0x5c3536[_0x4d4d96(0x212)]||_0x4d4d96(0x228);if(tg?.[_0x4d4d96(0x1bf)])tg[_0x4d4d96(0x1bf)][_0x4d4d96(0x219)](_0x4d4d96(0x1ef));}else{_0x57213a=_0x5c3536[_0x4d4d96(0x1f3)]||_0x4d4d96(0x1ea);if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x4d4d96(0x219)](_0x4d4d96(0x1f3));}messages[_0x4d4d96(0x1e2)]({'role':'ai','content':_0x57213a,'timestamp':Date[_0x4d4d96(0x1fe)]()}),localStorage[_0x4d4d96(0x1d2)]('ai_chat_messages',JSON[_0x4d4d96(0x1b3)](messages)),renderMessages();}function confirmDelete(_0x37e14e){const _0x3c18c6=a0_0x4f4e47;if(mTitle)mTitle[_0x3c18c6(0x1df)]=_0x3c18c6(0x226);if(mText)mText[_0x3c18c6(0x1df)]=_0x3c18c6(0x21c);modalCallback=()=>{const _0x44f15c=_0x3c18c6;messages[_0x44f15c(0x223)](_0x37e14e,0x1),localStorage[_0x44f15c(0x1d2)](_0x44f15c(0x1dd),JSON[_0x44f15c(0x1b3)](messages)),renderMessages();},modal[_0x3c18c6(0x1f6)][_0x3c18c6(0x1f0)](_0x3c18c6(0x205));}if(clearBtn)clearBtn[a0_0x4f4e47(0x222)]=()=>{const _0x26aef9=a0_0x4f4e47;if(!messages[_0x26aef9(0x1b9)])return;if(mTitle)mTitle[_0x26aef9(0x1df)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x26aef9(0x1cd);modalCallback=async()=>{const _0x51025c=_0x26aef9;messages=[],localStorage[_0x51025c(0x1ff)](_0x51025c(0x1dd)),renderMessages(),callBackend(_0x51025c(0x1b0),{});},modal[_0x26aef9(0x1f6)]['add'](_0x26aef9(0x205));};document[a0_0x4f4e47(0x203)](a0_0x4f4e47(0x214))['onclick']=()=>modal[a0_0x4f4e47(0x1f6)]['remove'](a0_0x4f4e47(0x205)),document[a0_0x4f4e47(0x203)](a0_0x4f4e47(0x224))[a0_0x4f4e47(0x222)]=()=>{const _0x32e2e3=a0_0x4f4e47;if(modalCallback)modalCallback();modal[_0x32e2e3(0x1f6)][_0x32e2e3(0x1e8)]('show');},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x4f4e47(0x215)](a0_0x4f4e47(0x1c3),_0x52e03d=>{const _0x214f1b=a0_0x4f4e47;_0x52e03d[_0x214f1b(0x1c4)]===_0x214f1b(0x208)&&!_0x52e03d[_0x214f1b(0x22c)]&&(_0x52e03d[_0x214f1b(0x1ed)](),sendMessage());}),sendBtn[a0_0x4f4e47(0x222)]=sendMessage,document[a0_0x4f4e47(0x215)](a0_0x4f4e47(0x1ca),_0x2d1c9e=>{const _0xd75e0f=a0_0x4f4e47;document[_0xd75e0f(0x1d5)](_0xd75e0f(0x1d1))[_0xd75e0f(0x1b6)](_0x45977f=>{const _0x5a47b2=_0xd75e0f;if(!_0x45977f['contains'](_0x2d1c9e[_0x5a47b2(0x1de)]))_0x45977f[_0x5a47b2(0x1f6)][_0x5a47b2(0x1e8)](_0x5a47b2(0x1f7));});});const saved=localStorage['getItem'](a0_0x4f4e47(0x1dd));if(saved)try{messages=JSON[a0_0x4f4e47(0x211)](saved),renderMessages();}catch(a0_0x5e7db0){}updateSendButton();