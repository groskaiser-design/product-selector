const a0_0x10f194=a0_0x37a8;function a0_0x11a0(){const _0x24cfb5=['scrollHeight','first_name','keydown','shiftKey','abort','style','height','disabled','modalText','message\x20','floor','47649UaSTne','push','href','username','notificationOccurred','error','BackButton','padStart','Пустой\x20ответ','text','initDataUnsafe','innerHeight','554UgMWCH','message\x20ai','contains','splice','.message.show-delete','viewportHeight','onclick','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','debug_uid','modalCancel','value','classList','timestamp','6.1','expand','send_message','show-delete','offsetHeight','appendChild','typingIndicator','chatArea','HapticFeedback','display','className','165976BVhlar','Enter','getMinutes','key','emptyState','121046wZpwEu','(((.+)+)+)+$','modalTitle','search','flex','1030986LbmkRE','impactOccurred','div','60zyIeMH','innerHTML','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','getElementById','light','.container','addEventListener','from','<br>','sendBtn','36aerEEK','messageInput','medium','stringify','clearBtn','Очистить\x20историю?','show','target','scrollTop','createElement','clear_history','user','length','POST','initData','isVersionAtLeast','role','Действие\x20необратимо.','ai_chat_messages','click','TG\x20setup\x20error:','Ошибка\x20сети','confirmModal','forEach','paddingBottom','message-time','25660eNKSfi','trim','apply','signal','inputArea','parse','ready','textContent','setItem','viewportChanged','./router.html','getItem','focus','now','text/plain','remove','77vYjVfv','1614WSXryu','json','preventDefault','touchend','modalConfirm','add','resize','59695bcHuTz','Начнется\x20новый\x20диалог.','content','Telegram','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>'];a0_0x11a0=function(){return _0x24cfb5;};return a0_0x11a0();}(function(_0x50dcc6,_0x1aca78){const _0x54947e=a0_0x37a8,_0x453d35=_0x50dcc6();while(!![]){try{const _0x2ab5cc=-parseInt(_0x54947e(0x1f2))/0x1+parseInt(_0x54947e(0x252))/0x2*(parseInt(_0x54947e(0x22f))/0x3)+parseInt(_0x54947e(0x1fa))/0x4*(parseInt(_0x54947e(0x236))/0x5)+-parseInt(_0x54947e(0x1f7))/0x6+parseInt(_0x54947e(0x246))/0x7+-parseInt(_0x54947e(0x1ed))/0x8*(-parseInt(_0x54947e(0x204))/0x9)+-parseInt(_0x54947e(0x21e))/0xa*(parseInt(_0x54947e(0x22e))/0xb);if(_0x2ab5cc===_0x1aca78)break;else _0x453d35['push'](_0x453d35['shift']());}catch(_0x563523){_0x453d35['push'](_0x453d35['shift']());}}}(a0_0x11a0,0x1a23b));function a0_0x37a8(_0x40d694,_0x1bbec3){_0x40d694=_0x40d694-0x1ec;const _0x5ce36d=a0_0x11a0();let _0xf914ef=_0x5ce36d[_0x40d694];return _0xf914ef;}const tg=window[a0_0x10f194(0x239)]?.['WebApp'],HOME_URL=a0_0x10f194(0x228);function setupTelegramBackButton(){const _0x34bb04=a0_0x10f194,_0x4cd2fa=(function(){let _0x232ad4=!![];return function(_0x456864,_0x7fd164){const _0x552df6=_0x232ad4?function(){const _0x13bf3a=a0_0x37a8;if(_0x7fd164){const _0xd24adb=_0x7fd164[_0x13bf3a(0x220)](_0x456864,arguments);return _0x7fd164=null,_0xd24adb;}}:function(){};return _0x232ad4=![],_0x552df6;};}()),_0x30fbe6=_0x4cd2fa(this,function(){const _0x3ac386=a0_0x37a8;return _0x30fbe6['toString']()[_0x3ac386(0x1f5)]('(((.+)+)+)+$')['toString']()['constructor'](_0x30fbe6)['search'](_0x3ac386(0x1f3));});_0x30fbe6();if(!tg)return;try{tg[_0x34bb04(0x224)](),tg[_0x34bb04(0x260)](),tg['setHeaderColor']?.('#050505');if(tg[_0x34bb04(0x213)]?.(_0x34bb04(0x25f)))tg['disableVerticalSwipes']?.();const _0x2009fb=tg[_0x34bb04(0x24c)];if(_0x2009fb){_0x2009fb['show']();if(typeof _0x2009fb['offClick']==='function')try{_0x2009fb['offClick']();}catch(_0xf31005){}_0x2009fb['onClick'](()=>{const _0x2eb552=_0x34bb04;if(tg[_0x2eb552(0x267)])tg['HapticFeedback'][_0x2eb552(0x1f8)](_0x2eb552(0x1fe));location[_0x2eb552(0x248)]=HOME_URL;});}}catch(_0xceaf6a){console['warn'](_0x34bb04(0x218),_0xceaf6a);}}(function initStableLayout(){const _0x1bc32b=a0_0x10f194,_0x1e95f1=document['querySelector'](_0x1bc32b(0x1ff)),_0x4272f8=document[_0x1bc32b(0x1fd)](_0x1bc32b(0x222)),_0x3bd33c=document['getElementById']('chatArea'),_0x9b2f09=document[_0x1bc32b(0x1fd)]('messageInput');function _0x14a2ac(){const _0x335447=_0x1bc32b;if(!_0x1e95f1)return;const _0x44cdd7=tg&&tg['viewportHeight']?tg[_0x335447(0x257)]:window[_0x335447(0x251)];_0x1e95f1[_0x335447(0x240)][_0x335447(0x241)]=_0x44cdd7+'px';if(_0x4272f8){const _0x1ec3da=_0x4272f8[_0x335447(0x263)];_0x3bd33c['style'][_0x335447(0x21c)]=_0x1ec3da+0x28+'px';}}tg?tg['onEvent'](_0x1bc32b(0x227),({isStateStable:_0x3f93c2})=>{_0x14a2ac();if(_0x3f93c2)requestAnimationFrame(()=>{const _0x5a4146=a0_0x37a8;_0x3bd33c['scrollTop']=_0x3bd33c[_0x5a4146(0x23b)];});}):window[_0x1bc32b(0x200)](_0x1bc32b(0x235),_0x14a2ac),_0x14a2ac(),_0x9b2f09&&(_0x9b2f09[_0x1bc32b(0x200)]('input',()=>{requestAnimationFrame(_0x14a2ac);}),_0x9b2f09[_0x1bc32b(0x200)](_0x1bc32b(0x22a),()=>{setTimeout(()=>{const _0x5cc375=a0_0x37a8;_0x3bd33c[_0x5cc375(0x20c)]=_0x3bd33c[_0x5cc375(0x23b)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x10f194(0x1fc),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x10f194(0x1fd)](a0_0x10f194(0x266)),emptyState=document[a0_0x10f194(0x1fd)](a0_0x10f194(0x1f1)),messageInput=document['getElementById'](a0_0x10f194(0x205)),sendBtn=document['getElementById'](a0_0x10f194(0x203)),clearBtn=document[a0_0x10f194(0x1fd)](a0_0x10f194(0x208)),modal=document[a0_0x10f194(0x1fd)](a0_0x10f194(0x21a)),mTitle=document['getElementById'](a0_0x10f194(0x1f4)),mText=document[a0_0x10f194(0x1fd)](a0_0x10f194(0x243));let modalCallback=null;async function callBackend(_0x3ca329,_0x5e5af6){const _0x549186=a0_0x10f194,_0x111759=tg?.[_0x549186(0x250)]?.[_0x549186(0x20f)]||{},_0x4df461=_0x111759['id']||localStorage['getItem'](_0x549186(0x25a))||'d-'+Math[_0x549186(0x245)](Math['random']()*0x3b9aca00);if(!_0x111759['id'])localStorage[_0x549186(0x226)](_0x549186(0x25a),_0x4df461);const _0x582397={'action':_0x3ca329,'user_id':_0x4df461,'user_data':{'first_name':_0x111759[_0x549186(0x23c)],'username':_0x111759[_0x549186(0x249)]},'init_data':tg?.[_0x549186(0x212)]||'',..._0x5e5af6},_0x4cae5f=new AbortController(),_0x4df8bc=setTimeout(()=>_0x4cae5f[_0x549186(0x23f)](),REQUEST_TIMEOUT_MS);try{const _0x233ebf=await fetch(BACKEND_URL,{'method':_0x549186(0x211),'headers':{'Content-Type':_0x549186(0x22c)},'body':JSON[_0x549186(0x207)](_0x582397),'signal':_0x4cae5f[_0x549186(0x221)]});return clearTimeout(_0x4df8bc),await _0x233ebf[_0x549186(0x230)]();}catch(_0x2a627d){return{'success':![],'error':String(_0x2a627d)};}}function formatTime(_0x262b40){const _0x4a215e=a0_0x10f194,_0x4444b4=new Date(_0x262b40);return String(_0x4444b4['getHours']())['padStart'](0x2,'0')+':'+String(_0x4444b4[_0x4a215e(0x1ef)]())[_0x4a215e(0x24d)](0x2,'0');}function createMessageElement(_0x49d0a2,_0x447d57){const _0x1497ee=a0_0x10f194,_0x2f2f53=document[_0x1497ee(0x20d)](_0x1497ee(0x1f9));_0x2f2f53[_0x1497ee(0x1ec)]=_0x1497ee(0x244)+_0x49d0a2[_0x1497ee(0x214)];const _0x478001=document['createElement'](_0x1497ee(0x1f9));_0x478001[_0x1497ee(0x1ec)]='message-bubble',_0x478001[_0x1497ee(0x1fb)]=_0x49d0a2[_0x1497ee(0x238)]['replace'](/\n/g,_0x1497ee(0x202));const _0x39ac84=document[_0x1497ee(0x20d)](_0x1497ee(0x1f9));_0x39ac84['className']='delete-btn',_0x39ac84['innerHTML']=_0x1497ee(0x259),_0x39ac84[_0x1497ee(0x258)]=_0x5783af=>{_0x5783af['stopPropagation'](),confirmDelete(_0x447d57);};let _0x581229;_0x478001[_0x1497ee(0x200)]('touchstart',()=>_0x581229=setTimeout(()=>{const _0x47dbde=_0x1497ee;_0x2f2f53['classList'][_0x47dbde(0x234)](_0x47dbde(0x262));if(tg?.[_0x47dbde(0x267)])tg[_0x47dbde(0x267)][_0x47dbde(0x1f8)](_0x47dbde(0x206));},0x1f4)),_0x478001[_0x1497ee(0x200)](_0x1497ee(0x232),()=>clearTimeout(_0x581229));const _0x49b8f8=document[_0x1497ee(0x20d)]('div');return _0x49b8f8[_0x1497ee(0x1ec)]=_0x1497ee(0x21d),_0x49b8f8[_0x1497ee(0x225)]=formatTime(_0x49d0a2[_0x1497ee(0x25e)]),_0x2f2f53[_0x1497ee(0x264)](_0x39ac84),_0x2f2f53[_0x1497ee(0x264)](_0x478001),_0x2f2f53[_0x1497ee(0x264)](_0x49b8f8),_0x2f2f53;}function createTypingIndicator(){const _0x53e556=a0_0x10f194,_0x189e5f=document['createElement'](_0x53e556(0x1f9));return _0x189e5f[_0x53e556(0x1ec)]=_0x53e556(0x253),_0x189e5f['id']=_0x53e556(0x265),_0x189e5f['innerHTML']=_0x53e556(0x23a),_0x189e5f;}function renderMessages(){const _0xab2671=a0_0x10f194;Array[_0xab2671(0x201)](chatArea['children'])[_0xab2671(0x21b)](_0x5a86cd=>{const _0x379bb5=_0xab2671;if(_0x5a86cd['id']!==_0x379bb5(0x1f1))_0x5a86cd[_0x379bb5(0x22d)]();}),messages['length']>0x0?(emptyState[_0xab2671(0x240)][_0xab2671(0x268)]='none',messages[_0xab2671(0x21b)]((_0x8aeab0,_0x2380b9)=>chatArea[_0xab2671(0x264)](createMessageElement(_0x8aeab0,_0x2380b9)))):emptyState['style'][_0xab2671(0x268)]=_0xab2671(0x1f6),requestAnimationFrame(()=>chatArea[_0xab2671(0x20c)]=chatArea[_0xab2671(0x23b)]);}function autoResizeTextarea(){const _0x15c8ad=a0_0x10f194;messageInput[_0x15c8ad(0x240)]['height']='auto',messageInput[_0x15c8ad(0x240)][_0x15c8ad(0x241)]=Math['min'](messageInput[_0x15c8ad(0x23b)],0x78)+'px';}function updateSendButton(){const _0xa54b2f=a0_0x10f194,_0x43eccd=messageInput[_0xa54b2f(0x25c)][_0xa54b2f(0x21f)]();sendBtn[_0xa54b2f(0x242)]=!_0x43eccd||isTyping;}async function sendMessage(){const _0x5da241=a0_0x10f194,_0x28c8b9=messageInput['value'][_0x5da241(0x21f)]();if(!_0x28c8b9||isTyping)return;if(tg?.[_0x5da241(0x267)])tg['HapticFeedback']['impactOccurred'](_0x5da241(0x1fe));messages[_0x5da241(0x247)]({'role':'user','content':_0x28c8b9,'timestamp':Date[_0x5da241(0x22b)]()}),localStorage[_0x5da241(0x226)]('ai_chat_messages',JSON[_0x5da241(0x207)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5da241(0x264)](createTypingIndicator()),chatArea[_0x5da241(0x20c)]=chatArea['scrollHeight'];const _0x28870e=await callBackend(_0x5da241(0x261),{'message':_0x28c8b9});isTyping=![];const _0x357b7c=document[_0x5da241(0x1fd)](_0x5da241(0x265));if(_0x357b7c)_0x357b7c[_0x5da241(0x22d)]();let _0x107c65=_0x5da241(0x219);if(_0x28870e['success']){_0x107c65=_0x28870e[_0x5da241(0x24f)]||_0x5da241(0x24e);if(tg?.[_0x5da241(0x267)])tg[_0x5da241(0x267)][_0x5da241(0x24a)]('success');}else{_0x107c65=_0x28870e[_0x5da241(0x24b)]||'Ошибка\x20сервера';if(tg?.[_0x5da241(0x267)])tg[_0x5da241(0x267)][_0x5da241(0x24a)](_0x5da241(0x24b));}messages['push']({'role':'ai','content':_0x107c65,'timestamp':Date[_0x5da241(0x22b)]()}),localStorage[_0x5da241(0x226)](_0x5da241(0x216),JSON[_0x5da241(0x207)](messages)),renderMessages();}function confirmDelete(_0x509503){const _0x52b89f=a0_0x10f194;if(mTitle)mTitle[_0x52b89f(0x225)]='Удалить?';if(mText)mText[_0x52b89f(0x225)]=_0x52b89f(0x215);modalCallback=()=>{const _0x383553=_0x52b89f;messages[_0x383553(0x255)](_0x509503,0x1),localStorage['setItem']('ai_chat_messages',JSON[_0x383553(0x207)](messages)),renderMessages();},modal[_0x52b89f(0x25d)][_0x52b89f(0x234)](_0x52b89f(0x20a));}if(clearBtn)clearBtn[a0_0x10f194(0x258)]=()=>{const _0x1f238f=a0_0x10f194;if(!messages[_0x1f238f(0x210)])return;if(mTitle)mTitle['textContent']=_0x1f238f(0x209);if(mText)mText[_0x1f238f(0x225)]=_0x1f238f(0x237);modalCallback=async()=>{const _0x104ae7=_0x1f238f;messages=[],localStorage['removeItem'](_0x104ae7(0x216)),renderMessages(),callBackend(_0x104ae7(0x20e),{});},modal[_0x1f238f(0x25d)][_0x1f238f(0x234)](_0x1f238f(0x20a));};document['getElementById'](a0_0x10f194(0x25b))[a0_0x10f194(0x258)]=()=>modal[a0_0x10f194(0x25d)]['remove'](a0_0x10f194(0x20a)),document[a0_0x10f194(0x1fd)](a0_0x10f194(0x233))[a0_0x10f194(0x258)]=()=>{const _0x32cbff=a0_0x10f194;if(modalCallback)modalCallback();modal[_0x32cbff(0x25d)]['remove'](_0x32cbff(0x20a));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x10f194(0x200)](a0_0x10f194(0x23d),_0x36000f=>{const _0x1c657e=a0_0x10f194;_0x36000f[_0x1c657e(0x1f0)]===_0x1c657e(0x1ee)&&!_0x36000f[_0x1c657e(0x23e)]&&(_0x36000f[_0x1c657e(0x231)](),sendMessage());}),sendBtn[a0_0x10f194(0x258)]=sendMessage,document[a0_0x10f194(0x200)](a0_0x10f194(0x217),_0x3455a5=>{const _0x55603a=a0_0x10f194;document['querySelectorAll'](_0x55603a(0x256))[_0x55603a(0x21b)](_0x32791b=>{const _0x23bf15=_0x55603a;if(!_0x32791b[_0x23bf15(0x254)](_0x3455a5[_0x23bf15(0x20b)]))_0x32791b[_0x23bf15(0x25d)]['remove']('show-delete');});});const saved=localStorage[a0_0x10f194(0x229)](a0_0x10f194(0x216));if(saved)try{messages=JSON[a0_0x10f194(0x223)](saved),renderMessages();}catch(a0_0xc27685){}updateSendButton();