const a0_0x211b47=a0_0x4deb;(function(_0x113757,_0x53a8f0){const _0xbbfa=a0_0x4deb,_0x4a5200=_0x113757();while(!![]){try{const _0x5ccdbe=-parseInt(_0xbbfa(0x20a))/0x1*(parseInt(_0xbbfa(0x1f7))/0x2)+-parseInt(_0xbbfa(0x1d8))/0x3*(-parseInt(_0xbbfa(0x210))/0x4)+parseInt(_0xbbfa(0x1f6))/0x5+parseInt(_0xbbfa(0x1ff))/0x6*(-parseInt(_0xbbfa(0x1d6))/0x7)+parseInt(_0xbbfa(0x231))/0x8*(parseInt(_0xbbfa(0x1e4))/0x9)+parseInt(_0xbbfa(0x1ec))/0xa*(parseInt(_0xbbfa(0x1d1))/0xb)+-parseInt(_0xbbfa(0x23b))/0xc*(-parseInt(_0xbbfa(0x1ef))/0xd);if(_0x5ccdbe===_0x53a8f0)break;else _0x4a5200['push'](_0x4a5200['shift']());}catch(_0x24e7f3){_0x4a5200['push'](_0x4a5200['shift']());}}}(a0_0x5a99,0x24172));const tg=window[a0_0x211b47(0x1fc)]?.[a0_0x211b47(0x1da)],HOME_URL=a0_0x211b47(0x208);function setupTelegramBackButton(){const _0x53cf1a=a0_0x211b47,_0x8a8f24=(function(){let _0x9500cf=!![];return function(_0x4fee50,_0x541e23){const _0x452a0e=_0x9500cf?function(){if(_0x541e23){const _0x2e471e=_0x541e23['apply'](_0x4fee50,arguments);return _0x541e23=null,_0x2e471e;}}:function(){};return _0x9500cf=![],_0x452a0e;};}()),_0x28bf1d=_0x8a8f24(this,function(){const _0x377f51=a0_0x4deb;return _0x28bf1d[_0x377f51(0x20b)]()[_0x377f51(0x1fa)]('(((.+)+)+)+$')[_0x377f51(0x20b)]()[_0x377f51(0x1d4)](_0x28bf1d)[_0x377f51(0x1fa)](_0x377f51(0x1f3));});_0x28bf1d();if(!tg)return;try{tg[_0x53cf1a(0x1e9)](),tg[_0x53cf1a(0x243)](),tg[_0x53cf1a(0x234)]?.(_0x53cf1a(0x22d));if(tg[_0x53cf1a(0x223)]?.(_0x53cf1a(0x1d0)))tg[_0x53cf1a(0x207)]?.();const _0x513e33=tg[_0x53cf1a(0x22c)];if(_0x513e33){_0x513e33['show']();if(typeof _0x513e33['offClick']===_0x53cf1a(0x202))try{_0x513e33['offClick']();}catch(_0x470d98){}_0x513e33['onClick'](()=>{const _0x2eef9b=_0x53cf1a;if(tg[_0x2eef9b(0x22f)])tg[_0x2eef9b(0x22f)][_0x2eef9b(0x22b)](_0x2eef9b(0x1f1));location[_0x2eef9b(0x21d)]=HOME_URL;});}}catch(_0x24155e){console[_0x53cf1a(0x221)](_0x53cf1a(0x204),_0x24155e);}}(function initStableLayout(){const _0x43934a=a0_0x211b47,_0x4130fe=document[_0x43934a(0x24b)](_0x43934a(0x1d7)),_0x44e099=document[_0x43934a(0x224)](_0x43934a(0x1fb)),_0x22b99e=document[_0x43934a(0x224)](_0x43934a(0x20d)),_0x31e7e4=document['getElementById'](_0x43934a(0x239));function _0x39eba6(){const _0x3e5235=_0x43934a;if(!_0x4130fe)return;const _0x2e7822=tg&&tg[_0x3e5235(0x216)]?tg[_0x3e5235(0x216)]:window[_0x3e5235(0x242)];_0x4130fe['style'][_0x3e5235(0x23c)]=_0x2e7822+'px';if(_0x44e099){const _0x1e6045=_0x44e099[_0x3e5235(0x1fe)];_0x22b99e[_0x3e5235(0x21e)][_0x3e5235(0x248)]=_0x1e6045+0x28+'px';}}tg?tg[_0x43934a(0x23e)](_0x43934a(0x241),({isStateStable:_0x310280})=>{_0x39eba6();if(_0x310280)requestAnimationFrame(()=>{const _0x34068e=a0_0x4deb;_0x22b99e[_0x34068e(0x1e5)]=_0x22b99e[_0x34068e(0x211)];});}):window['addEventListener']('resize',_0x39eba6),_0x39eba6(),_0x31e7e4&&(_0x31e7e4['addEventListener']('input',()=>{requestAnimationFrame(_0x39eba6);}),_0x31e7e4[_0x43934a(0x247)](_0x43934a(0x240),()=>{setTimeout(()=>{const _0x2cca2b=a0_0x4deb;_0x22b99e[_0x2cca2b(0x1e5)]=_0x22b99e[_0x2cca2b(0x211)];},0x12c);}));}(),setupTelegramBackButton());function a0_0x5a99(){const _0xa953e4=['getElementById','Enter','trim','Пустой\x20ответ','contains','length','splice','impactOccurred','BackButton','#050505','input','HapticFeedback','createElement','8CjPIkt','message-bubble','div','setHeaderColor','auto','preventDefault','confirmModal','now','messageInput','setItem','67764cJXYnc','height','<br>','onEvent','modalText','focus','viewportChanged','innerHeight','expand','signal','show','.message.show-delete','addEventListener','paddingBottom','sendBtn','classList','querySelector','message\x20ai','text/plain','Действие\x20необратимо.','initData','className','display','forEach','getMinutes','6.1','9614SmEsdP','floor','stringify','constructor','clearBtn','5691SsXXyo','.container','463179URPqjt','removeItem','WebApp','role','typingIndicator','modalConfirm','children','Очистить\x20историю?','initDataUnsafe','success','querySelectorAll','json','1403847iXpxYT','scrollTop','Ошибка\x20сети','content','Начнется\x20новый\x20диалог.','ready','onclick','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','490vFdyiN','abort','message-time','26PhEOYG','padStart','light','add','(((.+)+)+)+$','textContent','ai_chat_messages','582960ETtNXX','173846PquCMv','target','message\x20','search','inputArea','Telegram','text','offsetHeight','1818HEEuTL','innerHTML','getItem','function','clear_history','TG\x20setup\x20error:','parse','notificationOccurred','disableVerticalSwipes','./router.html','send_message','1KpiaVa','toString','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','chatArea','disabled','key','4ZirAoF','scrollHeight','appendChild','delete-btn','remove','shiftKey','viewportHeight','emptyState','show-delete','user','value','medium','random','href','style','debug_uid','modalTitle','warn','error','isVersionAtLeast'];a0_0x5a99=function(){return _0xa953e4;};return a0_0x5a99();}const BACKEND_URL=a0_0x211b47(0x1eb),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x211b47(0x224)](a0_0x211b47(0x20d)),emptyState=document[a0_0x211b47(0x224)](a0_0x211b47(0x217)),messageInput=document[a0_0x211b47(0x224)](a0_0x211b47(0x239)),sendBtn=document['getElementById'](a0_0x211b47(0x249)),clearBtn=document['getElementById'](a0_0x211b47(0x1d5)),modal=document['getElementById'](a0_0x211b47(0x237)),mTitle=document[a0_0x211b47(0x224)](a0_0x211b47(0x220)),mText=document[a0_0x211b47(0x224)](a0_0x211b47(0x23f));let modalCallback=null;async function callBackend(_0x9ee519,_0x39fe00){const _0x17535d=a0_0x211b47,_0xd195=tg?.[_0x17535d(0x1e0)]?.[_0x17535d(0x219)]||{},_0x6d6454=_0xd195['id']||localStorage[_0x17535d(0x201)]('debug_uid')||'d-'+Math[_0x17535d(0x1d2)](Math[_0x17535d(0x21c)]()*0x3b9aca00);if(!_0xd195['id'])localStorage['setItem'](_0x17535d(0x21f),_0x6d6454);const _0x56dfe2={'action':_0x9ee519,'user_id':_0x6d6454,'user_data':{'first_name':_0xd195['first_name'],'username':_0xd195['username']},'init_data':tg?.[_0x17535d(0x24f)]||'',..._0x39fe00},_0x4b9bf6=new AbortController(),_0x2c6c40=setTimeout(()=>_0x4b9bf6[_0x17535d(0x1ed)](),REQUEST_TIMEOUT_MS);try{const _0x203a8c=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':_0x17535d(0x24d)},'body':JSON[_0x17535d(0x1d3)](_0x56dfe2),'signal':_0x4b9bf6[_0x17535d(0x244)]});return clearTimeout(_0x2c6c40),await _0x203a8c[_0x17535d(0x1e3)]();}catch(_0x74880f){return{'success':![],'error':String(_0x74880f)};}}function formatTime(_0x1550fd){const _0x3dd88c=a0_0x211b47,_0x30ab9b=new Date(_0x1550fd);return String(_0x30ab9b['getHours']())[_0x3dd88c(0x1f0)](0x2,'0')+':'+String(_0x30ab9b[_0x3dd88c(0x1cf)]())[_0x3dd88c(0x1f0)](0x2,'0');}function createMessageElement(_0x384b36,_0x3b133c){const _0x154693=a0_0x211b47,_0x35d5de=document['createElement']('div');_0x35d5de[_0x154693(0x250)]=_0x154693(0x1f9)+_0x384b36[_0x154693(0x1db)];const _0x53daca=document[_0x154693(0x230)](_0x154693(0x233));_0x53daca['className']=_0x154693(0x232),_0x53daca[_0x154693(0x200)]=_0x384b36[_0x154693(0x1e7)]['replace'](/\n/g,_0x154693(0x23d));const _0x4fc9f0=document['createElement'](_0x154693(0x233));_0x4fc9f0[_0x154693(0x250)]=_0x154693(0x213),_0x4fc9f0[_0x154693(0x200)]=_0x154693(0x20c),_0x4fc9f0[_0x154693(0x1ea)]=_0x1d86b0=>{_0x1d86b0['stopPropagation'](),confirmDelete(_0x3b133c);};let _0x1eec9a;_0x53daca[_0x154693(0x247)]('touchstart',()=>_0x1eec9a=setTimeout(()=>{const _0x512b61=_0x154693;_0x35d5de[_0x512b61(0x24a)][_0x512b61(0x1f2)](_0x512b61(0x218));if(tg?.[_0x512b61(0x22f)])tg[_0x512b61(0x22f)][_0x512b61(0x22b)](_0x512b61(0x21b));},0x1f4)),_0x53daca['addEventListener']('touchend',()=>clearTimeout(_0x1eec9a));const _0x42a95f=document['createElement'](_0x154693(0x233));return _0x42a95f[_0x154693(0x250)]=_0x154693(0x1ee),_0x42a95f[_0x154693(0x1f4)]=formatTime(_0x384b36['timestamp']),_0x35d5de['appendChild'](_0x4fc9f0),_0x35d5de[_0x154693(0x212)](_0x53daca),_0x35d5de['appendChild'](_0x42a95f),_0x35d5de;}function createTypingIndicator(){const _0x31cf0d=a0_0x211b47,_0x1b08ea=document[_0x31cf0d(0x230)]('div');return _0x1b08ea[_0x31cf0d(0x250)]=_0x31cf0d(0x24c),_0x1b08ea['id']=_0x31cf0d(0x1dc),_0x1b08ea['innerHTML']='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0x1b08ea;}function a0_0x4deb(_0x4fa834,_0x5dd908){_0x4fa834=_0x4fa834-0x1cd;const _0x493d79=a0_0x5a99();let _0x41d01a=_0x493d79[_0x4fa834];return _0x41d01a;}function renderMessages(){const _0x9fc5ce=a0_0x211b47;Array['from'](chatArea[_0x9fc5ce(0x1de)])[_0x9fc5ce(0x1ce)](_0x9b1413=>{const _0x284ba5=_0x9fc5ce;if(_0x9b1413['id']!==_0x284ba5(0x217))_0x9b1413['remove']();}),messages[_0x9fc5ce(0x229)]>0x0?(emptyState['style'][_0x9fc5ce(0x1cd)]='none',messages[_0x9fc5ce(0x1ce)]((_0x2edfdc,_0xc7e426)=>chatArea['appendChild'](createMessageElement(_0x2edfdc,_0xc7e426)))):emptyState[_0x9fc5ce(0x21e)][_0x9fc5ce(0x1cd)]='flex',requestAnimationFrame(()=>chatArea[_0x9fc5ce(0x1e5)]=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x3ebeb4=a0_0x211b47;messageInput[_0x3ebeb4(0x21e)]['height']=_0x3ebeb4(0x235),messageInput[_0x3ebeb4(0x21e)]['height']=Math['min'](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x17ee43=a0_0x211b47,_0x2234cb=messageInput[_0x17ee43(0x21a)][_0x17ee43(0x226)]();sendBtn[_0x17ee43(0x20e)]=!_0x2234cb||isTyping;}async function sendMessage(){const _0x11fd33=a0_0x211b47,_0x2ef146=messageInput[_0x11fd33(0x21a)]['trim']();if(!_0x2ef146||isTyping)return;if(tg?.[_0x11fd33(0x22f)])tg[_0x11fd33(0x22f)][_0x11fd33(0x22b)]('light');messages['push']({'role':_0x11fd33(0x219),'content':_0x2ef146,'timestamp':Date['now']()}),localStorage[_0x11fd33(0x23a)](_0x11fd33(0x1f5),JSON[_0x11fd33(0x1d3)](messages)),renderMessages(),messageInput[_0x11fd33(0x21a)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x11fd33(0x212)](createTypingIndicator()),chatArea[_0x11fd33(0x1e5)]=chatArea[_0x11fd33(0x211)];const _0x658394=await callBackend(_0x11fd33(0x209),{'message':_0x2ef146});isTyping=![];const _0x3ab95e=document[_0x11fd33(0x224)](_0x11fd33(0x1dc));if(_0x3ab95e)_0x3ab95e[_0x11fd33(0x214)]();let _0x133342=_0x11fd33(0x1e6);if(_0x658394[_0x11fd33(0x1e1)]){_0x133342=_0x658394[_0x11fd33(0x1fd)]||_0x11fd33(0x227);if(tg?.['HapticFeedback'])tg[_0x11fd33(0x22f)][_0x11fd33(0x206)](_0x11fd33(0x1e1));}else{_0x133342=_0x658394['error']||'Ошибка\x20сервера';if(tg?.[_0x11fd33(0x22f)])tg[_0x11fd33(0x22f)][_0x11fd33(0x206)](_0x11fd33(0x222));}messages['push']({'role':'ai','content':_0x133342,'timestamp':Date[_0x11fd33(0x238)]()}),localStorage['setItem'](_0x11fd33(0x1f5),JSON[_0x11fd33(0x1d3)](messages)),renderMessages();}function confirmDelete(_0x256441){const _0x35435d=a0_0x211b47;if(mTitle)mTitle['textContent']='Удалить?';if(mText)mText[_0x35435d(0x1f4)]=_0x35435d(0x24e);modalCallback=()=>{const _0x3f1a6b=_0x35435d;messages[_0x3f1a6b(0x22a)](_0x256441,0x1),localStorage[_0x3f1a6b(0x23a)]('ai_chat_messages',JSON[_0x3f1a6b(0x1d3)](messages)),renderMessages();},modal[_0x35435d(0x24a)][_0x35435d(0x1f2)](_0x35435d(0x245));}if(clearBtn)clearBtn[a0_0x211b47(0x1ea)]=()=>{const _0x3c3ad4=a0_0x211b47;if(!messages['length'])return;if(mTitle)mTitle[_0x3c3ad4(0x1f4)]=_0x3c3ad4(0x1df);if(mText)mText[_0x3c3ad4(0x1f4)]=_0x3c3ad4(0x1e8);modalCallback=async()=>{const _0x2d7fa2=_0x3c3ad4;messages=[],localStorage[_0x2d7fa2(0x1d9)](_0x2d7fa2(0x1f5)),renderMessages(),callBackend(_0x2d7fa2(0x203),{});},modal[_0x3c3ad4(0x24a)][_0x3c3ad4(0x1f2)]('show');};document[a0_0x211b47(0x224)]('modalCancel')[a0_0x211b47(0x1ea)]=()=>modal['classList'][a0_0x211b47(0x214)](a0_0x211b47(0x245)),document[a0_0x211b47(0x224)](a0_0x211b47(0x1dd))[a0_0x211b47(0x1ea)]=()=>{const _0x3894f2=a0_0x211b47;if(modalCallback)modalCallback();modal[_0x3894f2(0x24a)]['remove']('show');},messageInput[a0_0x211b47(0x247)](a0_0x211b47(0x22e),()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x211b47(0x247)]('keydown',_0x2bee86=>{const _0x4b71a9=a0_0x211b47;_0x2bee86[_0x4b71a9(0x20f)]===_0x4b71a9(0x225)&&!_0x2bee86[_0x4b71a9(0x215)]&&(_0x2bee86[_0x4b71a9(0x236)](),sendMessage());}),sendBtn[a0_0x211b47(0x1ea)]=sendMessage,document[a0_0x211b47(0x247)]('click',_0xb50ab2=>{const _0x5ab540=a0_0x211b47;document[_0x5ab540(0x1e2)](_0x5ab540(0x246))[_0x5ab540(0x1ce)](_0x946364=>{const _0x2b8960=_0x5ab540;if(!_0x946364[_0x2b8960(0x228)](_0xb50ab2[_0x2b8960(0x1f8)]))_0x946364[_0x2b8960(0x24a)]['remove'](_0x2b8960(0x218));});});const saved=localStorage['getItem'](a0_0x211b47(0x1f5));if(saved)try{messages=JSON[a0_0x211b47(0x205)](saved),renderMessages();}catch(a0_0x4844db){}updateSendButton();