const a0_0x34e064=a0_0x40a1;function a0_0x1fd6(){const _0x42d811=['./router.html','error','user','json','show','createElement','message\x20ai','offsetHeight','19372990ecpLUS','clearBtn','scrollHeight','getItem','text','div','auto','getHours','message-bubble','padStart','messageInput','forEach','scrollTop','target','5008624jBlKAa','input','href','length','trim','confirmModal','querySelector','setHeaderColor','viewportChanged','122CplfCw','notificationOccurred','now','appendChild','ai_chat_messages','contains','innerHTML','role','height','username','removeItem','BackButton','#050505','flex','textContent','focus','setItem','click','from','shiftKey','1948145FCahin','1163281rZhEck','Telegram','TG\x20setup\x20error:','className','touchstart','light','content','Пустой\x20ответ','WebApp','classList','initDataUnsafe','show-delete','4060548KKHCFN','Удалить?','parse','style','medium','1921695TnhGZE','random','message-time','Действие\x20необратимо.','modalCancel','Ошибка\x20сервера','impactOccurred','initData','getElementById','stopPropagation','none','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','search','inputArea','innerHeight','onEvent','3716heSRpx','key','onclick','viewportHeight','POST','typingIndicator','modalConfirm','paddingBottom','.message.show-delete','send_message','warn','6.1','message\x20','Начнется\x20новый\x20диалог.','offClick','preventDefault','addEventListener','emptyState','keydown','add','(((.+)+)+)+$','success','splice','debug_uid','toString','getMinutes','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','stringify','abort','value','isVersionAtLeast','timestamp','HapticFeedback','modalText','expand','Ошибка\x20сети','6aSVNUp','apply','first_name','resize','push','disableVerticalSwipes','function','constructor','4bGzcPP','ready','Enter'];a0_0x1fd6=function(){return _0x42d811;};return a0_0x1fd6();}(function(_0x14f147,_0x51c771){const _0x258c83=a0_0x40a1,_0x1084e6=_0x14f147();while(!![]){try{const _0x583c97=-parseInt(_0x258c83(0x1a9))/0x1*(parseInt(_0x258c83(0x1f7))/0x2)+-parseInt(_0x258c83(0x21d))/0x3+-parseInt(_0x258c83(0x1d5))/0x4*(parseInt(_0x258c83(0x20b))/0x5)+parseInt(_0x258c83(0x1cd))/0x6*(-parseInt(_0x258c83(0x20c))/0x7)+-parseInt(_0x258c83(0x1ee))/0x8+parseInt(_0x258c83(0x218))/0x9+parseInt(_0x258c83(0x1e0))/0xa;if(_0x583c97===_0x51c771)break;else _0x1084e6['push'](_0x1084e6['shift']());}catch(_0x56f82e){_0x1084e6['push'](_0x1084e6['shift']());}}}(a0_0x1fd6,0x52d8c));function a0_0x40a1(_0x3b3c2c,_0x3bb96a){_0x3b3c2c=_0x3b3c2c-0x1a8;const _0x52cf88=a0_0x1fd6();let _0x1637f0=_0x52cf88[_0x3b3c2c];return _0x1637f0;}const tg=window[a0_0x34e064(0x20d)]?.[a0_0x34e064(0x214)],HOME_URL=a0_0x34e064(0x1d8);function setupTelegramBackButton(){const _0x35131b=a0_0x34e064,_0x4d087a=(function(){let _0x50e5d6=!![];return function(_0x21c72c,_0x164d21){const _0x54e97e=_0x50e5d6?function(){const _0x5585e7=a0_0x40a1;if(_0x164d21){const _0x34160a=_0x164d21[_0x5585e7(0x1ce)](_0x21c72c,arguments);return _0x164d21=null,_0x34160a;}}:function(){};return _0x50e5d6=![],_0x54e97e;};}()),_0x1aad73=_0x4d087a(this,function(){const _0x3d11de=a0_0x40a1;return _0x1aad73[_0x3d11de(0x1c1)]()[_0x3d11de(0x229)](_0x3d11de(0x1bd))[_0x3d11de(0x1c1)]()[_0x3d11de(0x1d4)](_0x1aad73)[_0x3d11de(0x229)]('(((.+)+)+)+$');});_0x1aad73();if(!tg)return;try{tg[_0x35131b(0x1d6)](),tg[_0x35131b(0x1cb)](),tg[_0x35131b(0x1f5)]?.(_0x35131b(0x203));if(tg[_0x35131b(0x1c7)]?.(_0x35131b(0x1b4)))tg[_0x35131b(0x1d2)]?.();const _0x4be1ec=tg[_0x35131b(0x202)];if(_0x4be1ec){_0x4be1ec['show']();if(typeof _0x4be1ec[_0x35131b(0x1b7)]===_0x35131b(0x1d3))try{_0x4be1ec['offClick']();}catch(_0x467ac2){}_0x4be1ec['onClick'](()=>{const _0x401112=_0x35131b;if(tg['HapticFeedback'])tg['HapticFeedback'][_0x401112(0x223)](_0x401112(0x211));location[_0x401112(0x1f0)]=HOME_URL;});}}catch(_0x27cd2d){console[_0x35131b(0x1b3)](_0x35131b(0x20e),_0x27cd2d);}}(function initStableLayout(){const _0x2d5ec4=a0_0x34e064,_0x3f2537=document[_0x2d5ec4(0x1f4)]('.container'),_0x41c2c6=document[_0x2d5ec4(0x225)](_0x2d5ec4(0x22a)),_0xc4f806=document[_0x2d5ec4(0x225)]('chatArea'),_0x5c00f2=document['getElementById'](_0x2d5ec4(0x1ea));function _0x530624(){const _0x9ec27=_0x2d5ec4;if(!_0x3f2537)return;const _0xc51fd5=tg&&tg[_0x9ec27(0x1ac)]?tg['viewportHeight']:window[_0x9ec27(0x22b)];_0x3f2537[_0x9ec27(0x21b)]['height']=_0xc51fd5+'px';if(_0x41c2c6){const _0x621970=_0x41c2c6[_0x9ec27(0x1df)];_0xc4f806[_0x9ec27(0x21b)][_0x9ec27(0x1b0)]=_0x621970+0x28+'px';}}tg?tg[_0x2d5ec4(0x1a8)](_0x2d5ec4(0x1f6),({isStateStable:_0x10bbf5})=>{_0x530624();if(_0x10bbf5)requestAnimationFrame(()=>{const _0x3abac0=a0_0x40a1;_0xc4f806['scrollTop']=_0xc4f806[_0x3abac0(0x1e2)];});}):window[_0x2d5ec4(0x1b9)](_0x2d5ec4(0x1d0),_0x530624),_0x530624(),_0x5c00f2&&(_0x5c00f2['addEventListener'](_0x2d5ec4(0x1ef),()=>{requestAnimationFrame(_0x530624);}),_0x5c00f2[_0x2d5ec4(0x1b9)](_0x2d5ec4(0x206),()=>{setTimeout(()=>{const _0x12b08c=a0_0x40a1;_0xc4f806[_0x12b08c(0x1ec)]=_0xc4f806[_0x12b08c(0x1e2)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL='https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec',REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x34e064(0x225)]('chatArea'),emptyState=document['getElementById'](a0_0x34e064(0x1ba)),messageInput=document[a0_0x34e064(0x225)](a0_0x34e064(0x1ea)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x34e064(0x225)](a0_0x34e064(0x1e1)),modal=document[a0_0x34e064(0x225)](a0_0x34e064(0x1f3)),mTitle=document[a0_0x34e064(0x225)]('modalTitle'),mText=document[a0_0x34e064(0x225)](a0_0x34e064(0x1ca));let modalCallback=null;async function callBackend(_0x2bc8bf,_0x4879aa){const _0x4cea7a=a0_0x34e064,_0x13aeaf=tg?.[_0x4cea7a(0x216)]?.[_0x4cea7a(0x1da)]||{},_0x48698d=_0x13aeaf['id']||localStorage[_0x4cea7a(0x1e3)]('debug_uid')||'d-'+Math['floor'](Math[_0x4cea7a(0x21e)]()*0x3b9aca00);if(!_0x13aeaf['id'])localStorage[_0x4cea7a(0x207)](_0x4cea7a(0x1c0),_0x48698d);const _0x2a9f28={'action':_0x2bc8bf,'user_id':_0x48698d,'user_data':{'first_name':_0x13aeaf[_0x4cea7a(0x1cf)],'username':_0x13aeaf[_0x4cea7a(0x200)]},'init_data':tg?.[_0x4cea7a(0x224)]||'',..._0x4879aa},_0x204ab2=new AbortController(),_0x4a4559=setTimeout(()=>_0x204ab2[_0x4cea7a(0x1c5)](),REQUEST_TIMEOUT_MS);try{const _0x2f795c=await fetch(BACKEND_URL,{'method':_0x4cea7a(0x1ad),'headers':{'Content-Type':'text/plain'},'body':JSON[_0x4cea7a(0x1c4)](_0x2a9f28),'signal':_0x204ab2['signal']});return clearTimeout(_0x4a4559),await _0x2f795c[_0x4cea7a(0x1db)]();}catch(_0x1386a1){return{'success':![],'error':String(_0x1386a1)};}}function formatTime(_0x235573){const _0x13f709=a0_0x34e064,_0x4773f9=new Date(_0x235573);return String(_0x4773f9[_0x13f709(0x1e7)]())[_0x13f709(0x1e9)](0x2,'0')+':'+String(_0x4773f9[_0x13f709(0x1c2)]())['padStart'](0x2,'0');}function createMessageElement(_0x11bd3b,_0x1798e1){const _0x413035=a0_0x34e064,_0x3f8f13=document[_0x413035(0x1dd)](_0x413035(0x1e5));_0x3f8f13[_0x413035(0x20f)]=_0x413035(0x1b5)+_0x11bd3b[_0x413035(0x1fe)];const _0x228889=document[_0x413035(0x1dd)](_0x413035(0x1e5));_0x228889[_0x413035(0x20f)]=_0x413035(0x1e8),_0x228889[_0x413035(0x1fd)]=_0x11bd3b[_0x413035(0x212)]['replace'](/\n/g,'<br>');const _0x64b2aa=document[_0x413035(0x1dd)](_0x413035(0x1e5));_0x64b2aa[_0x413035(0x20f)]='delete-btn',_0x64b2aa['innerHTML']=_0x413035(0x228),_0x64b2aa['onclick']=_0x14de6f=>{const _0x31ffa3=_0x413035;_0x14de6f[_0x31ffa3(0x226)](),confirmDelete(_0x1798e1);};let _0x46f306;_0x228889[_0x413035(0x1b9)](_0x413035(0x210),()=>_0x46f306=setTimeout(()=>{const _0x384340=_0x413035;_0x3f8f13[_0x384340(0x215)]['add'](_0x384340(0x217));if(tg?.['HapticFeedback'])tg['HapticFeedback'][_0x384340(0x223)](_0x384340(0x21c));},0x1f4)),_0x228889['addEventListener']('touchend',()=>clearTimeout(_0x46f306));const _0x48cf67=document[_0x413035(0x1dd)](_0x413035(0x1e5));return _0x48cf67[_0x413035(0x20f)]=_0x413035(0x21f),_0x48cf67[_0x413035(0x205)]=formatTime(_0x11bd3b[_0x413035(0x1c8)]),_0x3f8f13[_0x413035(0x1fa)](_0x64b2aa),_0x3f8f13[_0x413035(0x1fa)](_0x228889),_0x3f8f13[_0x413035(0x1fa)](_0x48cf67),_0x3f8f13;}function createTypingIndicator(){const _0x17e884=a0_0x34e064,_0xf9f292=document[_0x17e884(0x1dd)](_0x17e884(0x1e5));return _0xf9f292['className']=_0x17e884(0x1de),_0xf9f292['id']=_0x17e884(0x1ae),_0xf9f292[_0x17e884(0x1fd)]=_0x17e884(0x1c3),_0xf9f292;}function renderMessages(){const _0x21ed54=a0_0x34e064;Array[_0x21ed54(0x209)](chatArea['children'])['forEach'](_0x464f78=>{const _0x38b3e0=_0x21ed54;if(_0x464f78['id']!==_0x38b3e0(0x1ba))_0x464f78['remove']();}),messages['length']>0x0?(emptyState[_0x21ed54(0x21b)]['display']=_0x21ed54(0x227),messages['forEach']((_0x47438a,_0x105f1f)=>chatArea[_0x21ed54(0x1fa)](createMessageElement(_0x47438a,_0x105f1f)))):emptyState[_0x21ed54(0x21b)]['display']=_0x21ed54(0x204),requestAnimationFrame(()=>chatArea[_0x21ed54(0x1ec)]=chatArea[_0x21ed54(0x1e2)]);}function autoResizeTextarea(){const _0x3397a2=a0_0x34e064;messageInput[_0x3397a2(0x21b)][_0x3397a2(0x1ff)]=_0x3397a2(0x1e6),messageInput[_0x3397a2(0x21b)][_0x3397a2(0x1ff)]=Math['min'](messageInput[_0x3397a2(0x1e2)],0x78)+'px';}function updateSendButton(){const _0x413180=a0_0x34e064,_0x23456c=messageInput['value'][_0x413180(0x1f2)]();sendBtn['disabled']=!_0x23456c||isTyping;}async function sendMessage(){const _0x32e91b=a0_0x34e064,_0x26d173=messageInput[_0x32e91b(0x1c6)][_0x32e91b(0x1f2)]();if(!_0x26d173||isTyping)return;if(tg?.[_0x32e91b(0x1c9)])tg[_0x32e91b(0x1c9)][_0x32e91b(0x223)](_0x32e91b(0x211));messages['push']({'role':'user','content':_0x26d173,'timestamp':Date[_0x32e91b(0x1f9)]()}),localStorage['setItem'](_0x32e91b(0x1fb),JSON[_0x32e91b(0x1c4)](messages)),renderMessages(),messageInput[_0x32e91b(0x1c6)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x32e91b(0x1fa)](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x32e91b(0x1e2)];const _0x850187=await callBackend(_0x32e91b(0x1b2),{'message':_0x26d173});isTyping=![];const _0x3c92ea=document['getElementById']('typingIndicator');if(_0x3c92ea)_0x3c92ea['remove']();let _0x413082=_0x32e91b(0x1cc);if(_0x850187[_0x32e91b(0x1be)]){_0x413082=_0x850187[_0x32e91b(0x1e4)]||_0x32e91b(0x213);if(tg?.[_0x32e91b(0x1c9)])tg[_0x32e91b(0x1c9)][_0x32e91b(0x1f8)]('success');}else{_0x413082=_0x850187[_0x32e91b(0x1d9)]||_0x32e91b(0x222);if(tg?.[_0x32e91b(0x1c9)])tg[_0x32e91b(0x1c9)][_0x32e91b(0x1f8)](_0x32e91b(0x1d9));}messages[_0x32e91b(0x1d1)]({'role':'ai','content':_0x413082,'timestamp':Date[_0x32e91b(0x1f9)]()}),localStorage['setItem'](_0x32e91b(0x1fb),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x27672b){const _0x47136f=a0_0x34e064;if(mTitle)mTitle['textContent']=_0x47136f(0x219);if(mText)mText[_0x47136f(0x205)]=_0x47136f(0x220);modalCallback=()=>{const _0x51906b=_0x47136f;messages[_0x51906b(0x1bf)](_0x27672b,0x1),localStorage['setItem'](_0x51906b(0x1fb),JSON[_0x51906b(0x1c4)](messages)),renderMessages();},modal[_0x47136f(0x215)][_0x47136f(0x1bc)](_0x47136f(0x1dc));}if(clearBtn)clearBtn['onclick']=()=>{const _0x376891=a0_0x34e064;if(!messages[_0x376891(0x1f1)])return;if(mTitle)mTitle[_0x376891(0x205)]='Очистить\x20историю?';if(mText)mText['textContent']=_0x376891(0x1b6);modalCallback=async()=>{const _0xf5c1ed=_0x376891;messages=[],localStorage[_0xf5c1ed(0x201)](_0xf5c1ed(0x1fb)),renderMessages(),callBackend('clear_history',{});},modal['classList'][_0x376891(0x1bc)](_0x376891(0x1dc));};document['getElementById'](a0_0x34e064(0x221))[a0_0x34e064(0x1ab)]=()=>modal['classList']['remove'](a0_0x34e064(0x1dc)),document[a0_0x34e064(0x225)](a0_0x34e064(0x1af))[a0_0x34e064(0x1ab)]=()=>{const _0x55e641=a0_0x34e064;if(modalCallback)modalCallback();modal[_0x55e641(0x215)]['remove'](_0x55e641(0x1dc));},messageInput['addEventListener']('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x34e064(0x1b9)](a0_0x34e064(0x1bb),_0x17f2fe=>{const _0x3f7a87=a0_0x34e064;_0x17f2fe[_0x3f7a87(0x1aa)]===_0x3f7a87(0x1d7)&&!_0x17f2fe[_0x3f7a87(0x20a)]&&(_0x17f2fe[_0x3f7a87(0x1b8)](),sendMessage());}),sendBtn['onclick']=sendMessage,document['addEventListener'](a0_0x34e064(0x208),_0x544bc5=>{const _0x9b009d=a0_0x34e064;document['querySelectorAll'](_0x9b009d(0x1b1))[_0x9b009d(0x1eb)](_0xc4bb31=>{const _0x998861=_0x9b009d;if(!_0xc4bb31[_0x998861(0x1fc)](_0x544bc5[_0x998861(0x1ed)]))_0xc4bb31['classList']['remove'](_0x998861(0x217));});});const saved=localStorage['getItem'](a0_0x34e064(0x1fb));if(saved)try{messages=JSON[a0_0x34e064(0x21a)](saved),renderMessages();}catch(a0_0x3c55c8){}updateSendButton();