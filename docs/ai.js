function a0_0x3862(_0x5502ac,_0x3f8e6d){_0x5502ac=_0x5502ac-0x159;const _0x31a583=a0_0x4fc4();let _0x515dce=_0x31a583[_0x5502ac];return _0x515dce;}const a0_0x2bc653=a0_0x3862;(function(_0x22f514,_0x464a56){const _0x309c5a=a0_0x3862,_0x2fe8cf=_0x22f514();while(!![]){try{const _0x2f085e=-parseInt(_0x309c5a(0x1b6))/0x1+-parseInt(_0x309c5a(0x18a))/0x2+parseInt(_0x309c5a(0x1a2))/0x3+-parseInt(_0x309c5a(0x19b))/0x4+-parseInt(_0x309c5a(0x1d3))/0x5*(parseInt(_0x309c5a(0x1af))/0x6)+-parseInt(_0x309c5a(0x171))/0x7*(-parseInt(_0x309c5a(0x182))/0x8)+-parseInt(_0x309c5a(0x19e))/0x9*(-parseInt(_0x309c5a(0x1bb))/0xa);if(_0x2f085e===_0x464a56)break;else _0x2fe8cf['push'](_0x2fe8cf['shift']());}catch(_0x2a5618){_0x2fe8cf['push'](_0x2fe8cf['shift']());}}}(a0_0x4fc4,0x664e9));const tg=window[a0_0x2bc653(0x191)]?.[a0_0x2bc653(0x1b5)],HOME_URL=a0_0x2bc653(0x169);function setupTelegramBackButton(){const _0x2cd95d=a0_0x2bc653,_0x2df459=(function(){let _0x187a49=!![];return function(_0x21cc8c,_0x27d886){const _0x8ea649=_0x187a49?function(){const _0x4787ce=a0_0x3862;if(_0x27d886){const _0x5f4870=_0x27d886[_0x4787ce(0x1a8)](_0x21cc8c,arguments);return _0x27d886=null,_0x5f4870;}}:function(){};return _0x187a49=![],_0x8ea649;};}()),_0x2bd758=_0x2df459(this,function(){const _0x52d25c=a0_0x3862;return _0x2bd758[_0x52d25c(0x1c1)]()[_0x52d25c(0x18f)](_0x52d25c(0x15e))[_0x52d25c(0x1c1)]()[_0x52d25c(0x190)](_0x2bd758)[_0x52d25c(0x18f)](_0x52d25c(0x15e));});_0x2bd758();if(!tg)return;try{tg[_0x2cd95d(0x1c4)](),tg[_0x2cd95d(0x19f)](),tg['setHeaderColor']?.(_0x2cd95d(0x1bf));if(tg[_0x2cd95d(0x186)]?.(_0x2cd95d(0x179)))tg[_0x2cd95d(0x1b9)]?.();const _0x32605d=tg['BackButton'];if(_0x32605d){_0x32605d[_0x2cd95d(0x198)]();if(typeof _0x32605d['offClick']===_0x2cd95d(0x199))try{_0x32605d[_0x2cd95d(0x15b)]();}catch(_0x1e714f){}_0x32605d[_0x2cd95d(0x17d)](()=>{const _0x2aa346=_0x2cd95d;if(tg[_0x2aa346(0x1ab)])tg[_0x2aa346(0x1ab)][_0x2aa346(0x163)](_0x2aa346(0x1be));location[_0x2aa346(0x17c)]=HOME_URL;});}}catch(_0x2b3bd7){console[_0x2cd95d(0x1cb)](_0x2cd95d(0x1ad),_0x2b3bd7);}}(function initStableLayout(){const _0x2861ef=a0_0x2bc653,_0x5bf214=document[_0x2861ef(0x1c9)](_0x2861ef(0x1d1)),_0xe787a1=document[_0x2861ef(0x1ac)]('inputArea'),_0x561717=document[_0x2861ef(0x1ac)](_0x2861ef(0x1c2)),_0x1337e4=document['getElementById'](_0x2861ef(0x189));function _0x43c2f4(){const _0x4dfff0=_0x2861ef;if(!_0x5bf214)return;const _0x1698cd=tg&&tg[_0x4dfff0(0x16e)]?tg[_0x4dfff0(0x16e)]:window['innerHeight'];_0x5bf214[_0x4dfff0(0x1ca)][_0x4dfff0(0x16d)]=_0x1698cd+'px';if(_0xe787a1){const _0x237cf0=_0xe787a1[_0x4dfff0(0x181)];_0x561717[_0x4dfff0(0x1ca)]['paddingBottom']=_0x237cf0+0x28+'px';}}tg?tg['onEvent'](_0x2861ef(0x1a1),({isStateStable:_0xa3e82c})=>{_0x43c2f4();if(_0xa3e82c)requestAnimationFrame(()=>{const _0x3924f2=a0_0x3862;_0x561717['scrollTop']=_0x561717[_0x3924f2(0x159)];});}):window['addEventListener']('resize',_0x43c2f4),_0x43c2f4(),_0x1337e4&&(_0x1337e4[_0x2861ef(0x15f)]('input',()=>{requestAnimationFrame(_0x43c2f4);}),_0x1337e4[_0x2861ef(0x15f)]('focus',()=>{setTimeout(()=>{const _0x32e1ba=a0_0x3862;_0x561717['scrollTop']=_0x561717[_0x32e1ba(0x159)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2bc653(0x174),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2bc653(0x1ac)](a0_0x2bc653(0x1c2)),emptyState=document[a0_0x2bc653(0x1ac)]('emptyState'),messageInput=document[a0_0x2bc653(0x1ac)](a0_0x2bc653(0x189)),sendBtn=document[a0_0x2bc653(0x1ac)]('sendBtn'),clearBtn=document['getElementById'](a0_0x2bc653(0x164)),modal=document[a0_0x2bc653(0x1ac)](a0_0x2bc653(0x1cd)),mTitle=document[a0_0x2bc653(0x1ac)](a0_0x2bc653(0x196)),mText=document[a0_0x2bc653(0x1ac)](a0_0x2bc653(0x167));let modalCallback=null;async function callBackend(_0x38d7ff,_0x3e8f9c){const _0x5f4e47=a0_0x2bc653,_0x182674=tg?.['initDataUnsafe']?.['user']||{},_0x84d04d=_0x182674['id']||localStorage[_0x5f4e47(0x170)](_0x5f4e47(0x1b8))||'d-'+Math[_0x5f4e47(0x1b7)](Math[_0x5f4e47(0x172)]()*0x3b9aca00);if(!_0x182674['id'])localStorage[_0x5f4e47(0x1c0)](_0x5f4e47(0x1b8),_0x84d04d);const _0x3cf484={'action':_0x38d7ff,'user_id':_0x84d04d,'user_data':{'first_name':_0x182674[_0x5f4e47(0x18e)],'username':_0x182674[_0x5f4e47(0x1a3)]},'init_data':tg?.[_0x5f4e47(0x193)]||'',..._0x3e8f9c},_0x47122f=new AbortController(),_0xfafe7=setTimeout(()=>_0x47122f[_0x5f4e47(0x185)](),REQUEST_TIMEOUT_MS);try{const _0x122993=await fetch(BACKEND_URL,{'method':_0x5f4e47(0x19c),'headers':{'Content-Type':_0x5f4e47(0x166)},'body':JSON[_0x5f4e47(0x15a)](_0x3cf484),'signal':_0x47122f[_0x5f4e47(0x15c)]});return clearTimeout(_0xfafe7),await _0x122993['json']();}catch(_0xd2f6e9){return{'success':![],'error':String(_0xd2f6e9)};}}function formatTime(_0x3dfc34){const _0x4886dd=a0_0x2bc653,_0x5cc775=new Date(_0x3dfc34);return String(_0x5cc775[_0x4886dd(0x1a9)]())[_0x4886dd(0x1c6)](0x2,'0')+':'+String(_0x5cc775['getMinutes']())['padStart'](0x2,'0');}function createMessageElement(_0x211275,_0x1d45a3){const _0x3a1f43=a0_0x2bc653,_0x39611e=document[_0x3a1f43(0x1a5)](_0x3a1f43(0x1ae));_0x39611e[_0x3a1f43(0x16b)]=_0x3a1f43(0x162)+_0x211275[_0x3a1f43(0x16f)];const _0x28d511=document[_0x3a1f43(0x1a5)](_0x3a1f43(0x1ae));_0x28d511[_0x3a1f43(0x16b)]=_0x3a1f43(0x173),_0x28d511[_0x3a1f43(0x1c8)]=_0x211275[_0x3a1f43(0x17a)]['replace'](/\n/g,'<br>');const _0x4444d9=document[_0x3a1f43(0x1a5)](_0x3a1f43(0x1ae));_0x4444d9[_0x3a1f43(0x16b)]=_0x3a1f43(0x1bd),_0x4444d9['innerHTML']='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x4444d9[_0x3a1f43(0x18c)]=_0x16cb59=>{_0x16cb59['stopPropagation'](),confirmDelete(_0x1d45a3);};let _0x2f80d5;_0x28d511['addEventListener'](_0x3a1f43(0x187),()=>_0x2f80d5=setTimeout(()=>{const _0x50de7f=_0x3a1f43;_0x39611e[_0x50de7f(0x1ce)]['add'](_0x50de7f(0x192));if(tg?.[_0x50de7f(0x1ab)])tg['HapticFeedback'][_0x50de7f(0x163)](_0x50de7f(0x1a6));},0x1f4)),_0x28d511[_0x3a1f43(0x15f)](_0x3a1f43(0x1b3),()=>clearTimeout(_0x2f80d5));const _0x22761e=document[_0x3a1f43(0x1a5)](_0x3a1f43(0x1ae));return _0x22761e[_0x3a1f43(0x16b)]=_0x3a1f43(0x1b4),_0x22761e['textContent']=formatTime(_0x211275['timestamp']),_0x39611e['appendChild'](_0x4444d9),_0x39611e['appendChild'](_0x28d511),_0x39611e['appendChild'](_0x22761e),_0x39611e;}function a0_0x4fc4(){const _0x48aafc=['toString','chatArea','Ошибка\x20сервера','ready','message\x20ai','padStart','preventDefault','innerHTML','querySelector','style','warn','none','confirmModal','classList','typingIndicator','Пустой\x20ответ','.container','removeItem','77780OFxlpz','scrollHeight','stringify','offClick','signal','min','(((.+)+)+)+$','addEventListener','value','notificationOccurred','message\x20','impactOccurred','clearBtn','appendChild','text/plain','modalText','contains','./router.html','trim','className','disabled','height','viewportHeight','role','getItem','518ovtxtR','random','message-bubble','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','scrollTop','user','flex','forEach','6.1','content','target','href','onClick','parse','Действие\x20необратимо.','textContent','offsetHeight','51112YsdqgQ','display','.message.show-delete','abort','isVersionAtLeast','touchstart','push','messageInput','1413296GJDOgq','add','onclick','from','first_name','search','constructor','Telegram','show-delete','initData','querySelectorAll','click','modalTitle','auto','show','function','success','1323372eGQejM','POST','children','9JxbhLJ','expand','send_message','viewportChanged','1926765qxpQfg','username','remove','createElement','medium','Enter','apply','getHours','error','HapticFeedback','getElementById','TG\x20setup\x20error:','div','48HQKolF','Начнется\x20новый\x20диалог.','ai_chat_messages','Ошибка\x20сети','touchend','message-time','WebApp','578050plRFmg','floor','debug_uid','disableVerticalSwipes','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','10439970WrfknN','Удалить?','delete-btn','light','#050505','setItem'];a0_0x4fc4=function(){return _0x48aafc;};return a0_0x4fc4();}function createTypingIndicator(){const _0x2a2bb5=a0_0x2bc653,_0x5b2a06=document['createElement'](_0x2a2bb5(0x1ae));return _0x5b2a06['className']=_0x2a2bb5(0x1c5),_0x5b2a06['id']='typingIndicator',_0x5b2a06[_0x2a2bb5(0x1c8)]=_0x2a2bb5(0x1ba),_0x5b2a06;}function renderMessages(){const _0x15590b=a0_0x2bc653;Array[_0x15590b(0x18d)](chatArea[_0x15590b(0x19d)])[_0x15590b(0x178)](_0xa08b68=>{const _0x10e250=_0x15590b;if(_0xa08b68['id']!=='emptyState')_0xa08b68[_0x10e250(0x1a4)]();}),messages['length']>0x0?(emptyState['style'][_0x15590b(0x183)]=_0x15590b(0x1cc),messages[_0x15590b(0x178)]((_0x3e5116,_0x1341b9)=>chatArea[_0x15590b(0x165)](createMessageElement(_0x3e5116,_0x1341b9)))):emptyState[_0x15590b(0x1ca)]['display']=_0x15590b(0x177),requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x15590b(0x159)]);}function autoResizeTextarea(){const _0x550295=a0_0x2bc653;messageInput[_0x550295(0x1ca)]['height']=_0x550295(0x197),messageInput[_0x550295(0x1ca)][_0x550295(0x16d)]=Math[_0x550295(0x15d)](messageInput['scrollHeight'],0x78)+'px';}function updateSendButton(){const _0x2ce56f=a0_0x2bc653,_0x10e4f6=messageInput['value'][_0x2ce56f(0x16a)]();sendBtn[_0x2ce56f(0x16c)]=!_0x10e4f6||isTyping;}async function sendMessage(){const _0x5be034=a0_0x2bc653,_0xc25dbb=messageInput[_0x5be034(0x160)][_0x5be034(0x16a)]();if(!_0xc25dbb||isTyping)return;if(tg?.[_0x5be034(0x1ab)])tg[_0x5be034(0x1ab)][_0x5be034(0x163)]('light');messages[_0x5be034(0x188)]({'role':_0x5be034(0x176),'content':_0xc25dbb,'timestamp':Date['now']()}),localStorage['setItem'](_0x5be034(0x1b1),JSON[_0x5be034(0x15a)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x5be034(0x165)](createTypingIndicator()),chatArea[_0x5be034(0x175)]=chatArea['scrollHeight'];const _0x5e3396=await callBackend(_0x5be034(0x1a0),{'message':_0xc25dbb});isTyping=![];const _0x4fb7d7=document[_0x5be034(0x1ac)](_0x5be034(0x1cf));if(_0x4fb7d7)_0x4fb7d7[_0x5be034(0x1a4)]();let _0x54740f=_0x5be034(0x1b2);if(_0x5e3396['success']){_0x54740f=_0x5e3396['text']||_0x5be034(0x1d0);if(tg?.['HapticFeedback'])tg[_0x5be034(0x1ab)][_0x5be034(0x161)](_0x5be034(0x19a));}else{_0x54740f=_0x5e3396[_0x5be034(0x1aa)]||_0x5be034(0x1c3);if(tg?.[_0x5be034(0x1ab)])tg[_0x5be034(0x1ab)][_0x5be034(0x161)](_0x5be034(0x1aa));}messages['push']({'role':'ai','content':_0x54740f,'timestamp':Date['now']()}),localStorage[_0x5be034(0x1c0)](_0x5be034(0x1b1),JSON['stringify'](messages)),renderMessages();}function confirmDelete(_0x2a025a){const _0x3998e7=a0_0x2bc653;if(mTitle)mTitle[_0x3998e7(0x180)]=_0x3998e7(0x1bc);if(mText)mText[_0x3998e7(0x180)]=_0x3998e7(0x17f);modalCallback=()=>{const _0x41652c=_0x3998e7;messages['splice'](_0x2a025a,0x1),localStorage[_0x41652c(0x1c0)](_0x41652c(0x1b1),JSON[_0x41652c(0x15a)](messages)),renderMessages();},modal[_0x3998e7(0x1ce)][_0x3998e7(0x18b)](_0x3998e7(0x198));}if(clearBtn)clearBtn[a0_0x2bc653(0x18c)]=()=>{const _0x3894d9=a0_0x2bc653;if(!messages['length'])return;if(mTitle)mTitle[_0x3894d9(0x180)]='Очистить\x20историю?';if(mText)mText[_0x3894d9(0x180)]=_0x3894d9(0x1b0);modalCallback=async()=>{const _0x527cfc=_0x3894d9;messages=[],localStorage[_0x527cfc(0x1d2)](_0x527cfc(0x1b1)),renderMessages(),callBackend('clear_history',{});},modal[_0x3894d9(0x1ce)]['add'](_0x3894d9(0x198));};document['getElementById']('modalCancel')['onclick']=()=>modal['classList']['remove'](a0_0x2bc653(0x198)),document[a0_0x2bc653(0x1ac)]('modalConfirm')[a0_0x2bc653(0x18c)]=()=>{const _0x11d5a6=a0_0x2bc653;if(modalCallback)modalCallback();modal['classList'][_0x11d5a6(0x1a4)]('show');},messageInput[a0_0x2bc653(0x15f)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x21cd2b=>{const _0x22ee3b=a0_0x2bc653;_0x21cd2b['key']===_0x22ee3b(0x1a7)&&!_0x21cd2b['shiftKey']&&(_0x21cd2b[_0x22ee3b(0x1c7)](),sendMessage());}),sendBtn[a0_0x2bc653(0x18c)]=sendMessage,document[a0_0x2bc653(0x15f)](a0_0x2bc653(0x195),_0x5a618b=>{const _0x2718b9=a0_0x2bc653;document[_0x2718b9(0x194)](_0x2718b9(0x184))[_0x2718b9(0x178)](_0x41cfda=>{const _0x270e74=_0x2718b9;if(!_0x41cfda[_0x270e74(0x168)](_0x5a618b[_0x270e74(0x17b)]))_0x41cfda[_0x270e74(0x1ce)]['remove'](_0x270e74(0x192));});});const saved=localStorage[a0_0x2bc653(0x170)](a0_0x2bc653(0x1b1));if(saved)try{messages=JSON[a0_0x2bc653(0x17e)](saved),renderMessages();}catch(a0_0x2601ce){}updateSendButton();