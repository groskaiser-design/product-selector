const a0_0x2d98a4=a0_0x3e69;(function(_0x352cd5,_0xbc2d6e){const _0x3db86c=a0_0x3e69,_0x3f4b21=_0x352cd5();while(!![]){try{const _0x33d4f0=-parseInt(_0x3db86c(0x11c))/0x1*(parseInt(_0x3db86c(0x116))/0x2)+-parseInt(_0x3db86c(0x128))/0x3+parseInt(_0x3db86c(0x115))/0x4+parseInt(_0x3db86c(0x12c))/0x5*(parseInt(_0x3db86c(0x14c))/0x6)+parseInt(_0x3db86c(0xf9))/0x7+parseInt(_0x3db86c(0x136))/0x8*(parseInt(_0x3db86c(0x112))/0x9)+parseInt(_0x3db86c(0x142))/0xa;if(_0x33d4f0===_0xbc2d6e)break;else _0x3f4b21['push'](_0x3f4b21['shift']());}catch(_0x24f9cb){_0x3f4b21['push'](_0x3f4b21['shift']());}}}(a0_0x745a,0x65a31));const tg=window['Telegram']?.[a0_0x2d98a4(0x121)],HOME_URL=a0_0x2d98a4(0xe1);function setupTelegramBackButton(){const _0x3a9482=a0_0x2d98a4;if(!tg)return;try{tg[_0x3a9482(0x133)](),tg[_0x3a9482(0x132)](),tg['setHeaderColor']?.('#050505');if(tg['isVersionAtLeast']?.(_0x3a9482(0x13f)))tg['disableVerticalSwipes']?.();const _0x52e506=tg[_0x3a9482(0xe6)];if(_0x52e506){_0x52e506[_0x3a9482(0x10a)]();if(typeof _0x52e506[_0x3a9482(0xeb)]==='function')try{_0x52e506[_0x3a9482(0xeb)]();}catch(_0x137f56){}_0x52e506[_0x3a9482(0xf2)](()=>{const _0x4bc487=_0x3a9482;if(tg[_0x4bc487(0x105)])tg[_0x4bc487(0x105)][_0x4bc487(0x125)]('light');location[_0x4bc487(0xf5)]=HOME_URL;});}}catch(_0x35ae8e){console[_0x3a9482(0xf4)](_0x3a9482(0x130),_0x35ae8e);}}(function initStableLayout(){const _0x10da05=a0_0x2d98a4,_0x1d1de=(function(){let _0x4d2d98=!![];return function(_0x27c74a,_0x20dd00){const _0x1ed37f=_0x4d2d98?function(){if(_0x20dd00){const _0x3a747d=_0x20dd00['apply'](_0x27c74a,arguments);return _0x20dd00=null,_0x3a747d;}}:function(){};return _0x4d2d98=![],_0x1ed37f;};}()),_0x15de82=document['querySelector'](_0x10da05(0xdf)),_0x54e483=document[_0x10da05(0x10b)](_0x10da05(0x10c)),_0x347107=document[_0x10da05(0x10b)](_0x10da05(0x114)),_0xbf2a85=document[_0x10da05(0x10b)](_0x10da05(0x11b));function _0x3e394a(){const _0x357aa7=_0x10da05,_0x387172=_0x1d1de(this,function(){const _0x4caa56=a0_0x3e69;return _0x387172['toString']()['search'](_0x4caa56(0x149))[_0x4caa56(0x120)]()['constructor'](_0x387172)['search']('(((.+)+)+)+$');});_0x387172();if(!_0x15de82)return;const _0x3afacb=tg&&tg[_0x357aa7(0x110)]?tg[_0x357aa7(0x110)]:window['innerHeight'];_0x15de82[_0x357aa7(0xee)][_0x357aa7(0x111)]=_0x3afacb+'px';if(_0x54e483){const _0x5c1d53=_0x54e483[_0x357aa7(0x14a)];_0x347107[_0x357aa7(0xee)][_0x357aa7(0xdd)]=_0x5c1d53+0x28+'px';}}tg?tg[_0x10da05(0xfe)]('viewportChanged',({isStateStable:_0x32ecc5})=>{_0x3e394a();if(_0x32ecc5)requestAnimationFrame(()=>{const _0x203e1f=a0_0x3e69;_0x347107[_0x203e1f(0x102)]=_0x347107[_0x203e1f(0x12e)];});}):window[_0x10da05(0x127)](_0x10da05(0xea),_0x3e394a),_0x3e394a(),_0xbf2a85&&(_0xbf2a85['addEventListener'](_0x10da05(0x131),()=>{requestAnimationFrame(_0x3e394a);}),_0xbf2a85[_0x10da05(0x127)](_0x10da05(0x13e),()=>{setTimeout(()=>{const _0x5c613c=a0_0x3e69;_0x347107[_0x5c613c(0x102)]=_0x347107[_0x5c613c(0x12e)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x2d98a4(0x10f),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x2d98a4(0x10b)](a0_0x2d98a4(0x114)),emptyState=document['getElementById'](a0_0x2d98a4(0xf3)),messageInput=document[a0_0x2d98a4(0x10b)](a0_0x2d98a4(0x11b)),sendBtn=document['getElementById'](a0_0x2d98a4(0x13a)),clearBtn=document[a0_0x2d98a4(0x10b)](a0_0x2d98a4(0xf8)),modal=document[a0_0x2d98a4(0x10b)](a0_0x2d98a4(0x137)),mTitle=document[a0_0x2d98a4(0x10b)](a0_0x2d98a4(0x141)),mText=document[a0_0x2d98a4(0x10b)](a0_0x2d98a4(0xf7));let modalCallback=null;async function callBackend(_0xabe558,_0x53e5b7){const _0x40f4d5=a0_0x2d98a4,_0x148d9d=tg?.['initDataUnsafe']?.[_0x40f4d5(0xf0)]||{},_0x4c7623=_0x148d9d['id']||localStorage[_0x40f4d5(0x104)](_0x40f4d5(0x13c))||'d-'+Math['floor'](Math[_0x40f4d5(0x147)]()*0x3b9aca00);if(!_0x148d9d['id'])localStorage['setItem'](_0x40f4d5(0x13c),_0x4c7623);const _0x3270be={'action':_0xabe558,'user_id':_0x4c7623,'user_data':{'first_name':_0x148d9d['first_name'],'username':_0x148d9d[_0x40f4d5(0xe4)]},'init_data':tg?.[_0x40f4d5(0x13d)]||'',..._0x53e5b7},_0x4b25ee=new AbortController(),_0xfda48b=setTimeout(()=>_0x4b25ee['abort'](),REQUEST_TIMEOUT_MS);try{const _0x29762c=await fetch(BACKEND_URL,{'method':'POST','headers':{'Content-Type':'text/plain'},'body':JSON[_0x40f4d5(0x144)](_0x3270be),'signal':_0x4b25ee[_0x40f4d5(0x117)]});return clearTimeout(_0xfda48b),await _0x29762c[_0x40f4d5(0xf1)]();}catch(_0x4c4605){return{'success':![],'error':String(_0x4c4605)};}}function formatTime(_0x2d04b1){const _0x23dd40=a0_0x2d98a4,_0x225cdc=new Date(_0x2d04b1);return String(_0x225cdc[_0x23dd40(0xfd)]())[_0x23dd40(0xef)](0x2,'0')+':'+String(_0x225cdc[_0x23dd40(0xe7)]())[_0x23dd40(0xef)](0x2,'0');}function a0_0x3e69(_0xd9cc96,_0x2d0446){_0xd9cc96=_0xd9cc96-0xdb;const _0x24527f=a0_0x745a();let _0x98af44=_0x24527f[_0xd9cc96];return _0x98af44;}function createMessageElement(_0x97b0e9,_0x506cee){const _0x5ac06c=a0_0x2d98a4,_0x3c3ba0=document[_0x5ac06c(0x140)](_0x5ac06c(0x12d));_0x3c3ba0[_0x5ac06c(0x148)]='message\x20'+_0x97b0e9[_0x5ac06c(0xe3)];const _0x2f46f3=document[_0x5ac06c(0x140)]('div');_0x2f46f3[_0x5ac06c(0x148)]=_0x5ac06c(0x146),_0x2f46f3[_0x5ac06c(0x113)]=_0x97b0e9['content'][_0x5ac06c(0x11a)](/\n/g,_0x5ac06c(0x12f));const _0x5018da=document[_0x5ac06c(0x140)](_0x5ac06c(0x12d));_0x5018da[_0x5ac06c(0x148)]=_0x5ac06c(0x143),_0x5018da['innerHTML']=_0x5ac06c(0xfa),_0x5018da[_0x5ac06c(0x14b)]=_0x3082e4=>{const _0x36e0b9=_0x5ac06c;_0x3082e4[_0x36e0b9(0x106)](),confirmDelete(_0x506cee);};let _0x4ead2d;_0x2f46f3['addEventListener'](_0x5ac06c(0x13b),()=>_0x4ead2d=setTimeout(()=>{const _0x2c826b=_0x5ac06c;_0x3c3ba0[_0x2c826b(0xf6)][_0x2c826b(0x100)](_0x2c826b(0x118));if(tg?.[_0x2c826b(0x105)])tg[_0x2c826b(0x105)][_0x2c826b(0x125)]('medium');},0x1f4)),_0x2f46f3[_0x5ac06c(0x127)](_0x5ac06c(0xff),()=>clearTimeout(_0x4ead2d));const _0x24ce66=document[_0x5ac06c(0x140)](_0x5ac06c(0x12d));return _0x24ce66[_0x5ac06c(0x148)]='message-time',_0x24ce66[_0x5ac06c(0xfb)]=formatTime(_0x97b0e9['timestamp']),_0x3c3ba0[_0x5ac06c(0x135)](_0x5018da),_0x3c3ba0[_0x5ac06c(0x135)](_0x2f46f3),_0x3c3ba0['appendChild'](_0x24ce66),_0x3c3ba0;}function createTypingIndicator(){const _0x1e2f7a=a0_0x2d98a4,_0xaf1133=document['createElement'](_0x1e2f7a(0x12d));return _0xaf1133['className']=_0x1e2f7a(0x145),_0xaf1133['id']=_0x1e2f7a(0xe5),_0xaf1133[_0x1e2f7a(0x113)]='<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>',_0xaf1133;}function renderMessages(){const _0x488271=a0_0x2d98a4;Array[_0x488271(0x124)](chatArea[_0x488271(0x126)])[_0x488271(0xe0)](_0x575827=>{const _0x35f80f=_0x488271;if(_0x575827['id']!=='emptyState')_0x575827[_0x35f80f(0x119)]();}),messages['length']>0x0?(emptyState[_0x488271(0xee)]['display']=_0x488271(0x14d),messages[_0x488271(0xe0)]((_0x1c61ff,_0x3f2d0e)=>chatArea['appendChild'](createMessageElement(_0x1c61ff,_0x3f2d0e)))):emptyState['style']['display']='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x488271(0x12e)]);}function autoResizeTextarea(){const _0x424c00=a0_0x2d98a4;messageInput[_0x424c00(0xee)][_0x424c00(0x111)]=_0x424c00(0x10e),messageInput[_0x424c00(0xee)]['height']=Math[_0x424c00(0x129)](messageInput[_0x424c00(0x12e)],0x78)+'px';}function updateSendButton(){const _0x3d8781=a0_0x2d98a4,_0x3a2a0d=messageInput[_0x3d8781(0x14e)][_0x3d8781(0xed)]();sendBtn[_0x3d8781(0xfc)]=!_0x3a2a0d||isTyping;}async function sendMessage(){const _0x59f22b=a0_0x2d98a4,_0x327dd2=messageInput['value'][_0x59f22b(0xed)]();if(!_0x327dd2||isTyping)return;if(tg?.[_0x59f22b(0x105)])tg['HapticFeedback'][_0x59f22b(0x125)](_0x59f22b(0xe2));messages[_0x59f22b(0x107)]({'role':_0x59f22b(0xf0),'content':_0x327dd2,'timestamp':Date[_0x59f22b(0x12b)]()}),localStorage[_0x59f22b(0x11e)](_0x59f22b(0x11f),JSON[_0x59f22b(0x144)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea['scrollTop']=chatArea[_0x59f22b(0x12e)];const _0x4eb90e=await callBackend(_0x59f22b(0xe8),{'message':_0x327dd2});isTyping=![];const _0x5615fb=document[_0x59f22b(0x10b)](_0x59f22b(0xe5));if(_0x5615fb)_0x5615fb[_0x59f22b(0x119)]();let _0x5647ee='Ошибка\x20сети';if(_0x4eb90e[_0x59f22b(0x122)]){_0x5647ee=_0x4eb90e['text']||'Пустой\x20ответ';if(tg?.[_0x59f22b(0x105)])tg['HapticFeedback'][_0x59f22b(0xec)](_0x59f22b(0x122));}else{_0x5647ee=_0x4eb90e[_0x59f22b(0x101)]||_0x59f22b(0xdb);if(tg?.[_0x59f22b(0x105)])tg[_0x59f22b(0x105)][_0x59f22b(0xec)](_0x59f22b(0x101));}messages[_0x59f22b(0x107)]({'role':'ai','content':_0x5647ee,'timestamp':Date[_0x59f22b(0x12b)]()}),localStorage[_0x59f22b(0x11e)](_0x59f22b(0x11f),JSON['stringify'](messages)),renderMessages();}function a0_0x745a(){const _0x3a812c=['11842YweYLi','signal','show-delete','remove','replace','messageInput','127CEoskv','preventDefault','setItem','ai_chat_messages','toString','WebApp','success','length','from','impactOccurred','children','addEventListener','2293830AYwOYn','min','Удалить?','now','136915PBwcxc','div','scrollHeight','<br>','TG\x20setup\x20error:','input','expand','ready','shiftKey','appendChild','1048siiYNX','confirmModal','Enter','modalConfirm','sendBtn','touchstart','debug_uid','initData','focus','6.1','createElement','modalTitle','2902290ugdquL','delete-btn','stringify','message\x20ai','message-bubble','random','className','(((.+)+)+)+$','offsetHeight','onclick','150zDqahC','none','value','splice','Ошибка\x20сервера','modalCancel','paddingBottom','removeItem','.container','forEach','./router.html','light','role','username','typingIndicator','BackButton','getMinutes','send_message','parse','resize','offClick','notificationOccurred','trim','style','padStart','user','json','onClick','emptyState','warn','href','classList','modalText','clearBtn','1382906mJkpkU','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','textContent','disabled','getHours','onEvent','touchend','add','error','scrollTop','keydown','getItem','HapticFeedback','stopPropagation','push','Действие\x20необратимо.','key','show','getElementById','inputArea','clear_history','auto','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','viewportHeight','height','19971GBPbJy','innerHTML','chatArea','1879324KlhPFy'];a0_0x745a=function(){return _0x3a812c;};return a0_0x745a();}function confirmDelete(_0x1b5e5c){const _0x4d1844=a0_0x2d98a4;if(mTitle)mTitle[_0x4d1844(0xfb)]=_0x4d1844(0x12a);if(mText)mText[_0x4d1844(0xfb)]=_0x4d1844(0x108);modalCallback=()=>{const _0x5ce931=_0x4d1844;messages[_0x5ce931(0x14f)](_0x1b5e5c,0x1),localStorage[_0x5ce931(0x11e)]('ai_chat_messages',JSON[_0x5ce931(0x144)](messages)),renderMessages();},modal[_0x4d1844(0xf6)][_0x4d1844(0x100)](_0x4d1844(0x10a));}if(clearBtn)clearBtn['onclick']=()=>{const _0x2e5993=a0_0x2d98a4;if(!messages[_0x2e5993(0x123)])return;if(mTitle)mTitle[_0x2e5993(0xfb)]='Очистить\x20историю?';if(mText)mText['textContent']='Начнется\x20новый\x20диалог.';modalCallback=async()=>{const _0x152c59=_0x2e5993;messages=[],localStorage[_0x152c59(0xde)](_0x152c59(0x11f)),renderMessages(),callBackend(_0x152c59(0x10d),{});},modal[_0x2e5993(0xf6)][_0x2e5993(0x100)]('show');};document[a0_0x2d98a4(0x10b)](a0_0x2d98a4(0xdc))[a0_0x2d98a4(0x14b)]=()=>modal['classList'][a0_0x2d98a4(0x119)](a0_0x2d98a4(0x10a)),document['getElementById'](a0_0x2d98a4(0x139))[a0_0x2d98a4(0x14b)]=()=>{const _0xf42255=a0_0x2d98a4;if(modalCallback)modalCallback();modal[_0xf42255(0xf6)][_0xf42255(0x119)](_0xf42255(0x10a));},messageInput[a0_0x2d98a4(0x127)](a0_0x2d98a4(0x131),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener'](a0_0x2d98a4(0x103),_0x309bb3=>{const _0x4fb8bb=a0_0x2d98a4;_0x309bb3[_0x4fb8bb(0x109)]===_0x4fb8bb(0x138)&&!_0x309bb3[_0x4fb8bb(0x134)]&&(_0x309bb3[_0x4fb8bb(0x11d)](),sendMessage());}),sendBtn['onclick']=sendMessage,document[a0_0x2d98a4(0x127)]('click',_0x43ae1c=>{const _0x35f79f=a0_0x2d98a4;document['querySelectorAll']('.message.show-delete')[_0x35f79f(0xe0)](_0x31c75d=>{const _0x36e8cf=_0x35f79f;if(!_0x31c75d['contains'](_0x43ae1c['target']))_0x31c75d[_0x36e8cf(0xf6)]['remove'](_0x36e8cf(0x118));});});const saved=localStorage['getItem']('ai_chat_messages');if(saved)try{messages=JSON[a0_0x2d98a4(0xe9)](saved),renderMessages();}catch(a0_0x526cb2){}updateSendButton();