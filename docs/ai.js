const a0_0x581b84=a0_0x1600;(function(_0x33583f,_0x51d325){const _0x3c6010=a0_0x1600,_0x1a25a3=_0x33583f();while(!![]){try{const _0x48e70d=parseInt(_0x3c6010(0x1c3))/0x1+parseInt(_0x3c6010(0x174))/0x2*(parseInt(_0x3c6010(0x172))/0x3)+-parseInt(_0x3c6010(0x1bf))/0x4*(-parseInt(_0x3c6010(0x1ab))/0x5)+-parseInt(_0x3c6010(0x186))/0x6+-parseInt(_0x3c6010(0x197))/0x7*(-parseInt(_0x3c6010(0x196))/0x8)+parseInt(_0x3c6010(0x1e7))/0x9+-parseInt(_0x3c6010(0x1ba))/0xa;if(_0x48e70d===_0x51d325)break;else _0x1a25a3['push'](_0x1a25a3['shift']());}catch(_0x3a7aab){_0x1a25a3['push'](_0x1a25a3['shift']());}}}(a0_0x3d86,0xb88cb));const tg=window[a0_0x581b84(0x1e5)]?.['WebApp'],HOME_URL='./router.html';function a0_0x3d86(){const _0x44cc7c=['touchend','messageInput','typingIndicator','Удалить?','from','viewportChanged','Очистить\x20историю?','BackButton','style','push','text/plain','inputArea','initData','Ошибка\x20сервера','Telegram','ready','4838166COwjKQ','getMinutes','random','HapticFeedback','stringify','(((.+)+)+)+$','5766eAMaXg','timestamp','794kiMSuj','viewportHeight','message-bubble','error','scrollTop','querySelectorAll','focus','setItem','modalConfirm','apply','trim','length','search','user','scrollHeight','now','classList','warn','6048132phxsTl','createElement','add','getItem','touchstart','Пустой\x20ответ','content','display','emptyState','div','debug_uid','modalTitle','padStart','appendChild','min','Действие\x20необратимо.','346480jNGSFt','175fAqcKk','onClick','light','offClick','removeItem','signal','remove','querySelector','offsetHeight','initDataUnsafe','onEvent','show-delete','show','shiftKey','message-time','stopPropagation','keydown','constructor','contains','floor','5AQGcsa','click','TG\x20setup\x20error:','modalText','ai_chat_messages','input','<br>','Ошибка\x20сети','#050505','clearBtn','text','POST','confirmModal','auto','onclick','27172590Ghknsq','message\x20','innerHeight','toString','modalCancel','2595928IyVfUF','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','textContent','success','1448856WdFUhL','className','forEach','Enter','resize','chatArea','impactOccurred','first_name','message\x20ai','Начнется\x20новый\x20диалог.','medium','innerHTML','setHeaderColor','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','value','function','getElementById','height','addEventListener','target'];a0_0x3d86=function(){return _0x44cc7c;};return a0_0x3d86();}function setupTelegramBackButton(){const _0x4a1dff=a0_0x581b84;if(!tg)return;try{tg[_0x4a1dff(0x1e6)](),tg['expand'](),tg[_0x4a1dff(0x1cf)]?.(_0x4a1dff(0x1b3));if(tg['isVersionAtLeast']?.('6.1'))tg['disableVerticalSwipes']?.();const _0xb2db1=tg[_0x4a1dff(0x1de)];if(_0xb2db1){_0xb2db1[_0x4a1dff(0x1a3)]();if(typeof _0xb2db1[_0x4a1dff(0x19a)]===_0x4a1dff(0x1d2))try{_0xb2db1[_0x4a1dff(0x19a)]();}catch(_0x3865e0){}_0xb2db1[_0x4a1dff(0x198)](()=>{const _0x5b761a=_0x4a1dff;if(tg[_0x5b761a(0x1ea)])tg['HapticFeedback']['impactOccurred'](_0x5b761a(0x199));location['href']=HOME_URL;});}}catch(_0x255527){console[_0x4a1dff(0x185)](_0x4a1dff(0x1ad),_0x255527);}}(function initStableLayout(){const _0x165873=a0_0x581b84,_0x1e416d=(function(){let _0x328721=!![];return function(_0x114930,_0x409fb1){const _0xd8a9a8=_0x328721?function(){const _0x1117f5=a0_0x1600;if(_0x409fb1){const _0x35ddf7=_0x409fb1[_0x1117f5(0x17d)](_0x114930,arguments);return _0x409fb1=null,_0x35ddf7;}}:function(){};return _0x328721=![],_0xd8a9a8;};}()),_0x2293d8=document[_0x165873(0x19e)]('.container'),_0x34e3e9=document[_0x165873(0x1d3)](_0x165873(0x1e2)),_0x4ddf6a=document['getElementById'](_0x165873(0x1c8)),_0x302d98=document[_0x165873(0x1d3)](_0x165873(0x1d8));function _0x137a9f(){const _0x428613=_0x165873,_0x4583f8=_0x1e416d(this,function(){const _0x2e9df0=a0_0x1600;return _0x4583f8[_0x2e9df0(0x1bd)]()[_0x2e9df0(0x180)](_0x2e9df0(0x171))[_0x2e9df0(0x1bd)]()[_0x2e9df0(0x1a8)](_0x4583f8)[_0x2e9df0(0x180)](_0x2e9df0(0x171));});_0x4583f8();if(!_0x2293d8)return;const _0xa7f481=tg&&tg[_0x428613(0x175)]?tg[_0x428613(0x175)]:window[_0x428613(0x1bc)];_0x2293d8['style'][_0x428613(0x1d4)]=_0xa7f481+'px';if(_0x34e3e9){const _0x487a01=_0x34e3e9[_0x428613(0x19f)];_0x4ddf6a['style']['paddingBottom']=_0x487a01+0x28+'px';}}tg?tg[_0x165873(0x1a1)](_0x165873(0x1dc),({isStateStable:_0x23c0c1})=>{_0x137a9f();if(_0x23c0c1)requestAnimationFrame(()=>{const _0x432559=a0_0x1600;_0x4ddf6a[_0x432559(0x178)]=_0x4ddf6a[_0x432559(0x182)];});}):window[_0x165873(0x1d5)](_0x165873(0x1c7),_0x137a9f),_0x137a9f(),_0x302d98&&(_0x302d98[_0x165873(0x1d5)](_0x165873(0x1b0),()=>{requestAnimationFrame(_0x137a9f);}),_0x302d98[_0x165873(0x1d5)](_0x165873(0x17a),()=>{setTimeout(()=>{const _0x53292b=a0_0x1600;_0x4ddf6a[_0x53292b(0x178)]=_0x4ddf6a[_0x53292b(0x182)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x581b84(0x1c0),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document[a0_0x581b84(0x1d3)]('chatArea'),emptyState=document[a0_0x581b84(0x1d3)](a0_0x581b84(0x18e)),messageInput=document[a0_0x581b84(0x1d3)](a0_0x581b84(0x1d8)),sendBtn=document['getElementById']('sendBtn'),clearBtn=document[a0_0x581b84(0x1d3)](a0_0x581b84(0x1b4)),modal=document[a0_0x581b84(0x1d3)](a0_0x581b84(0x1b7)),mTitle=document[a0_0x581b84(0x1d3)](a0_0x581b84(0x191)),mText=document[a0_0x581b84(0x1d3)](a0_0x581b84(0x1ae));let modalCallback=null;async function callBackend(_0x47082b,_0x4814b1){const _0x19bd0d=a0_0x581b84,_0x3b3091=tg?.[_0x19bd0d(0x1a0)]?.[_0x19bd0d(0x181)]||{},_0x1366ba=_0x3b3091['id']||localStorage[_0x19bd0d(0x189)](_0x19bd0d(0x190))||'d-'+Math[_0x19bd0d(0x1aa)](Math[_0x19bd0d(0x1e9)]()*0x3b9aca00);if(!_0x3b3091['id'])localStorage[_0x19bd0d(0x17b)]('debug_uid',_0x1366ba);const _0x6ace1={'action':_0x47082b,'user_id':_0x1366ba,'user_data':{'first_name':_0x3b3091[_0x19bd0d(0x1ca)],'username':_0x3b3091['username']},'init_data':tg?.[_0x19bd0d(0x1e3)]||'',..._0x4814b1},_0x775f61=new AbortController(),_0x5b687c=setTimeout(()=>_0x775f61['abort'](),REQUEST_TIMEOUT_MS);try{const _0x32bfae=await fetch(BACKEND_URL,{'method':_0x19bd0d(0x1b6),'headers':{'Content-Type':_0x19bd0d(0x1e1)},'body':JSON['stringify'](_0x6ace1),'signal':_0x775f61[_0x19bd0d(0x19c)]});return clearTimeout(_0x5b687c),await _0x32bfae['json']();}catch(_0x2dd24d){return{'success':![],'error':String(_0x2dd24d)};}}function formatTime(_0x511403){const _0x4edec1=a0_0x581b84,_0x3dee1f=new Date(_0x511403);return String(_0x3dee1f['getHours']())[_0x4edec1(0x192)](0x2,'0')+':'+String(_0x3dee1f[_0x4edec1(0x1e8)]())[_0x4edec1(0x192)](0x2,'0');}function createMessageElement(_0x229846,_0x31bf36){const _0xd36d8f=a0_0x581b84,_0x4c8723=document['createElement'](_0xd36d8f(0x18f));_0x4c8723[_0xd36d8f(0x1c4)]=_0xd36d8f(0x1bb)+_0x229846['role'];const _0x358bff=document[_0xd36d8f(0x187)]('div');_0x358bff[_0xd36d8f(0x1c4)]=_0xd36d8f(0x176),_0x358bff[_0xd36d8f(0x1ce)]=_0x229846[_0xd36d8f(0x18c)]['replace'](/\n/g,_0xd36d8f(0x1b1));const _0x31e3de=document[_0xd36d8f(0x187)](_0xd36d8f(0x18f));_0x31e3de['className']='delete-btn',_0x31e3de[_0xd36d8f(0x1ce)]='<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>',_0x31e3de[_0xd36d8f(0x1b9)]=_0x2cf66d=>{const _0xd523fa=_0xd36d8f;_0x2cf66d[_0xd523fa(0x1a6)](),confirmDelete(_0x31bf36);};let _0xba2296;_0x358bff[_0xd36d8f(0x1d5)](_0xd36d8f(0x18a),()=>_0xba2296=setTimeout(()=>{const _0x4246a9=_0xd36d8f;_0x4c8723[_0x4246a9(0x184)][_0x4246a9(0x188)](_0x4246a9(0x1a2));if(tg?.[_0x4246a9(0x1ea)])tg['HapticFeedback'][_0x4246a9(0x1c9)](_0x4246a9(0x1cd));},0x1f4)),_0x358bff[_0xd36d8f(0x1d5)](_0xd36d8f(0x1d7),()=>clearTimeout(_0xba2296));const _0x4a8f65=document['createElement'](_0xd36d8f(0x18f));return _0x4a8f65[_0xd36d8f(0x1c4)]=_0xd36d8f(0x1a5),_0x4a8f65[_0xd36d8f(0x1c1)]=formatTime(_0x229846[_0xd36d8f(0x173)]),_0x4c8723[_0xd36d8f(0x193)](_0x31e3de),_0x4c8723[_0xd36d8f(0x193)](_0x358bff),_0x4c8723[_0xd36d8f(0x193)](_0x4a8f65),_0x4c8723;}function createTypingIndicator(){const _0x395cfe=a0_0x581b84,_0x243190=document[_0x395cfe(0x187)](_0x395cfe(0x18f));return _0x243190['className']=_0x395cfe(0x1cb),_0x243190['id']=_0x395cfe(0x1d9),_0x243190[_0x395cfe(0x1ce)]=_0x395cfe(0x1d0),_0x243190;}function a0_0x1600(_0x578e58,_0x3e903e){_0x578e58=_0x578e58-0x170;const _0x21ef5f=a0_0x3d86();let _0x494d09=_0x21ef5f[_0x578e58];return _0x494d09;}function renderMessages(){const _0x588c53=a0_0x581b84;Array[_0x588c53(0x1db)](chatArea['children'])['forEach'](_0x34315a=>{const _0x2ec56c=_0x588c53;if(_0x34315a['id']!==_0x2ec56c(0x18e))_0x34315a[_0x2ec56c(0x19d)]();}),messages['length']>0x0?(emptyState[_0x588c53(0x1df)]['display']='none',messages[_0x588c53(0x1c5)]((_0x48c8e8,_0x1586d2)=>chatArea[_0x588c53(0x193)](createMessageElement(_0x48c8e8,_0x1586d2)))):emptyState[_0x588c53(0x1df)][_0x588c53(0x18d)]='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea[_0x588c53(0x182)]);}function autoResizeTextarea(){const _0xb688f1=a0_0x581b84;messageInput['style'][_0xb688f1(0x1d4)]=_0xb688f1(0x1b8),messageInput[_0xb688f1(0x1df)]['height']=Math[_0xb688f1(0x194)](messageInput[_0xb688f1(0x182)],0x78)+'px';}function updateSendButton(){const _0xc60a09=a0_0x581b84,_0x590bc0=messageInput[_0xc60a09(0x1d1)][_0xc60a09(0x17e)]();sendBtn['disabled']=!_0x590bc0||isTyping;}async function sendMessage(){const _0x4d3491=a0_0x581b84,_0x26cbd5=messageInput[_0x4d3491(0x1d1)][_0x4d3491(0x17e)]();if(!_0x26cbd5||isTyping)return;if(tg?.[_0x4d3491(0x1ea)])tg[_0x4d3491(0x1ea)]['impactOccurred'](_0x4d3491(0x199));messages[_0x4d3491(0x1e0)]({'role':_0x4d3491(0x181),'content':_0x26cbd5,'timestamp':Date[_0x4d3491(0x183)]()}),localStorage['setItem'](_0x4d3491(0x1af),JSON[_0x4d3491(0x170)](messages)),renderMessages(),messageInput[_0x4d3491(0x1d1)]='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea['appendChild'](createTypingIndicator()),chatArea[_0x4d3491(0x178)]=chatArea['scrollHeight'];const _0x3f5216=await callBackend('send_message',{'message':_0x26cbd5});isTyping=![];const _0x354f5d=document[_0x4d3491(0x1d3)](_0x4d3491(0x1d9));if(_0x354f5d)_0x354f5d[_0x4d3491(0x19d)]();let _0x598625=_0x4d3491(0x1b2);if(_0x3f5216['success']){_0x598625=_0x3f5216[_0x4d3491(0x1b5)]||_0x4d3491(0x18b);if(tg?.[_0x4d3491(0x1ea)])tg[_0x4d3491(0x1ea)]['notificationOccurred'](_0x4d3491(0x1c2));}else{_0x598625=_0x3f5216['error']||_0x4d3491(0x1e4);if(tg?.[_0x4d3491(0x1ea)])tg[_0x4d3491(0x1ea)]['notificationOccurred'](_0x4d3491(0x177));}messages[_0x4d3491(0x1e0)]({'role':'ai','content':_0x598625,'timestamp':Date[_0x4d3491(0x183)]()}),localStorage[_0x4d3491(0x17b)](_0x4d3491(0x1af),JSON[_0x4d3491(0x170)](messages)),renderMessages();}function confirmDelete(_0x3682f1){const _0x4294c6=a0_0x581b84;if(mTitle)mTitle[_0x4294c6(0x1c1)]=_0x4294c6(0x1da);if(mText)mText['textContent']=_0x4294c6(0x195);modalCallback=()=>{const _0x383173=_0x4294c6;messages['splice'](_0x3682f1,0x1),localStorage[_0x383173(0x17b)](_0x383173(0x1af),JSON[_0x383173(0x170)](messages)),renderMessages();},modal[_0x4294c6(0x184)]['add'](_0x4294c6(0x1a3));}if(clearBtn)clearBtn['onclick']=()=>{const _0x4364e9=a0_0x581b84;if(!messages[_0x4364e9(0x17f)])return;if(mTitle)mTitle[_0x4364e9(0x1c1)]=_0x4364e9(0x1dd);if(mText)mText[_0x4364e9(0x1c1)]=_0x4364e9(0x1cc);modalCallback=async()=>{const _0x425bb3=_0x4364e9;messages=[],localStorage[_0x425bb3(0x19b)](_0x425bb3(0x1af)),renderMessages(),callBackend('clear_history',{});},modal[_0x4364e9(0x184)]['add']('show');};document[a0_0x581b84(0x1d3)](a0_0x581b84(0x1be))[a0_0x581b84(0x1b9)]=()=>modal[a0_0x581b84(0x184)][a0_0x581b84(0x19d)](a0_0x581b84(0x1a3)),document[a0_0x581b84(0x1d3)](a0_0x581b84(0x17c))[a0_0x581b84(0x1b9)]=()=>{const _0x5a3457=a0_0x581b84;if(modalCallback)modalCallback();modal['classList'][_0x5a3457(0x19d)](_0x5a3457(0x1a3));},messageInput[a0_0x581b84(0x1d5)]('input',()=>{updateSendButton(),autoResizeTextarea();}),messageInput[a0_0x581b84(0x1d5)](a0_0x581b84(0x1a7),_0x6ecffd=>{const _0x348be5=a0_0x581b84;_0x6ecffd['key']===_0x348be5(0x1c6)&&!_0x6ecffd[_0x348be5(0x1a4)]&&(_0x6ecffd['preventDefault'](),sendMessage());}),sendBtn[a0_0x581b84(0x1b9)]=sendMessage,document['addEventListener'](a0_0x581b84(0x1ac),_0x226dd7=>{const _0x32d906=a0_0x581b84;document[_0x32d906(0x179)]('.message.show-delete')[_0x32d906(0x1c5)](_0x4f6aeb=>{const _0x443854=_0x32d906;if(!_0x4f6aeb[_0x443854(0x1a9)](_0x226dd7[_0x443854(0x1d6)]))_0x4f6aeb[_0x443854(0x184)][_0x443854(0x19d)]('show-delete');});});const saved=localStorage[a0_0x581b84(0x189)](a0_0x581b84(0x1af));if(saved)try{messages=JSON['parse'](saved),renderMessages();}catch(a0_0x48061c){}updateSendButton();