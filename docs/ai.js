const a0_0x476192=a0_0x47e8;(function(_0x5990ba,_0x57222e){const _0x482e07=a0_0x47e8,_0x52e7e7=_0x5990ba();while(!![]){try{const _0x7e18fb=parseInt(_0x482e07(0x1df))/0x1+-parseInt(_0x482e07(0x249))/0x2+-parseInt(_0x482e07(0x241))/0x3+-parseInt(_0x482e07(0x1e9))/0x4+-parseInt(_0x482e07(0x1de))/0x5*(parseInt(_0x482e07(0x1fe))/0x6)+-parseInt(_0x482e07(0x21f))/0x7+parseInt(_0x482e07(0x220))/0x8;if(_0x7e18fb===_0x57222e)break;else _0x52e7e7['push'](_0x52e7e7['shift']());}catch(_0x55b350){_0x52e7e7['push'](_0x52e7e7['shift']());}}}(a0_0x275d,0x25d7e));const tg=window[a0_0x476192(0x227)]?.[a0_0x476192(0x247)],HOME_URL='./router.html';function setupTelegramBackButton(){const _0x26ed2b=a0_0x476192;if(!tg)return;try{tg[_0x26ed2b(0x24f)](),tg[_0x26ed2b(0x1fc)](),tg[_0x26ed2b(0x23e)]?.(_0x26ed2b(0x205));if(tg[_0x26ed2b(0x21a)]?.(_0x26ed2b(0x211)))tg[_0x26ed2b(0x231)]?.();const _0x3ee986=tg['BackButton'];if(_0x3ee986){_0x3ee986[_0x26ed2b(0x1ef)]();if(typeof _0x3ee986[_0x26ed2b(0x243)]==='function')try{_0x3ee986[_0x26ed2b(0x243)]();}catch(_0x4b5c1f){}_0x3ee986[_0x26ed2b(0x1f1)](()=>{const _0x44bd58=_0x26ed2b;if(tg['HapticFeedback'])tg[_0x44bd58(0x208)][_0x44bd58(0x242)]('light');location[_0x44bd58(0x20a)]=HOME_URL;});}}catch(_0x192b23){console[_0x26ed2b(0x259)](_0x26ed2b(0x217),_0x192b23);}}(function initStableLayout(){const _0x253c52=a0_0x476192,_0x4ad872=(function(){let _0x1fe73a=!![];return function(_0x34a876,_0x28d14a){const _0x43d524=_0x1fe73a?function(){const _0x506242=a0_0x47e8;if(_0x28d14a){const _0x22cfb0=_0x28d14a[_0x506242(0x251)](_0x34a876,arguments);return _0x28d14a=null,_0x22cfb0;}}:function(){};return _0x1fe73a=![],_0x43d524;};}()),_0x216789=document[_0x253c52(0x22d)]('.container'),_0x3bad59=document[_0x253c52(0x24c)](_0x253c52(0x254)),_0x42e114=document[_0x253c52(0x24c)](_0x253c52(0x258)),_0x54d491=document[_0x253c52(0x24c)]('messageInput');function _0x39db3b(){const _0x2a514a=_0x253c52,_0x2787b3=_0x4ad872(this,function(){const _0x5306db=a0_0x47e8;return _0x2787b3['toString']()[_0x5306db(0x23d)](_0x5306db(0x1e0))['toString']()[_0x5306db(0x1ea)](_0x2787b3)['search']('(((.+)+)+)+$');});_0x2787b3();if(!_0x216789)return;const _0x261d59=tg&&tg[_0x2a514a(0x238)]?tg[_0x2a514a(0x238)]:window[_0x2a514a(0x22b)];_0x216789[_0x2a514a(0x22f)]['height']=_0x261d59+'px';if(_0x3bad59){const _0x239129=_0x3bad59[_0x2a514a(0x250)];_0x42e114[_0x2a514a(0x22f)][_0x2a514a(0x1e3)]=_0x239129+0x28+'px';}}tg?tg[_0x253c52(0x21c)](_0x253c52(0x235),({isStateStable:_0x15249c})=>{_0x39db3b();if(_0x15249c)requestAnimationFrame(()=>{const _0x28b220=a0_0x47e8;_0x42e114[_0x28b220(0x228)]=_0x42e114[_0x28b220(0x212)];});}):window[_0x253c52(0x1f9)](_0x253c52(0x1fb),_0x39db3b),_0x39db3b(),_0x54d491&&(_0x54d491[_0x253c52(0x1f9)](_0x253c52(0x210),()=>{requestAnimationFrame(_0x39db3b);}),_0x54d491[_0x253c52(0x1f9)](_0x253c52(0x1e1),()=>{setTimeout(()=>{const _0x5e29fe=a0_0x47e8;_0x42e114['scrollTop']=_0x42e114[_0x5e29fe(0x212)];},0x12c);}));}(),setupTelegramBackButton());const BACKEND_URL=a0_0x476192(0x236),REQUEST_TIMEOUT_MS=0xafc8;let messages=[],isTyping=![];const chatArea=document['getElementById'](a0_0x476192(0x258)),emptyState=document[a0_0x476192(0x24c)](a0_0x476192(0x1e7)),messageInput=document[a0_0x476192(0x24c)](a0_0x476192(0x24e)),sendBtn=document[a0_0x476192(0x24c)]('sendBtn'),clearBtn=document[a0_0x476192(0x24c)]('clearBtn'),modal=document[a0_0x476192(0x24c)](a0_0x476192(0x255)),mTitle=document[a0_0x476192(0x24c)](a0_0x476192(0x1f3)),mText=document[a0_0x476192(0x24c)]('modalText');let modalCallback=null;async function callBackend(_0x52f884,_0x35fc1c){const _0x50b899=a0_0x476192,_0x88e1bc=tg?.['initDataUnsafe']?.[_0x50b899(0x20d)]||{},_0x4f5ad8=_0x88e1bc['id']||localStorage[_0x50b899(0x203)](_0x50b899(0x1e2))||'d-'+Math[_0x50b899(0x20b)](Math[_0x50b899(0x20c)]()*0x3b9aca00);if(!_0x88e1bc['id'])localStorage[_0x50b899(0x221)]('debug_uid',_0x4f5ad8);const _0x317f04={'action':_0x52f884,'user_id':_0x4f5ad8,'user_data':{'first_name':_0x88e1bc[_0x50b899(0x244)],'username':_0x88e1bc[_0x50b899(0x229)]},'init_data':tg?.[_0x50b899(0x22c)]||'',..._0x35fc1c},_0x439c18=new AbortController(),_0x324430=setTimeout(()=>_0x439c18['abort'](),REQUEST_TIMEOUT_MS);try{const _0xb8db94=await fetch(BACKEND_URL,{'method':_0x50b899(0x226),'headers':{'Content-Type':_0x50b899(0x1ee)},'body':JSON[_0x50b899(0x237)](_0x317f04),'signal':_0x439c18[_0x50b899(0x1eb)]});return clearTimeout(_0x324430),await _0xb8db94[_0x50b899(0x202)]();}catch(_0x3c9d7b){return{'success':![],'error':String(_0x3c9d7b)};}}function formatTime(_0x5aa3c9){const _0x50ab09=a0_0x476192,_0x454528=new Date(_0x5aa3c9);return String(_0x454528[_0x50ab09(0x1dc)]())[_0x50ab09(0x1fd)](0x2,'0')+':'+String(_0x454528['getMinutes']())[_0x50ab09(0x1fd)](0x2,'0');}function createMessageElement(_0x26b104,_0x5b0126){const _0x11bf8b=a0_0x476192,_0x21d951=document[_0x11bf8b(0x232)]('div');_0x21d951[_0x11bf8b(0x1e5)]=_0x11bf8b(0x1e6)+_0x26b104[_0x11bf8b(0x23a)];const _0x55153d=document['createElement'](_0x11bf8b(0x207));_0x55153d[_0x11bf8b(0x1e5)]=_0x11bf8b(0x230),_0x55153d[_0x11bf8b(0x1f7)]=_0x26b104[_0x11bf8b(0x1f4)][_0x11bf8b(0x256)](/\n/g,_0x11bf8b(0x21b));const _0x1b88d6=document[_0x11bf8b(0x232)](_0x11bf8b(0x207));_0x1b88d6[_0x11bf8b(0x1e5)]='delete-btn',_0x1b88d6['innerHTML']=_0x11bf8b(0x224),_0x1b88d6[_0x11bf8b(0x1f8)]=_0x475434=>{_0x475434['stopPropagation'](),confirmDelete(_0x5b0126);};let _0x23353c;_0x55153d[_0x11bf8b(0x1f9)]('touchstart',()=>_0x23353c=setTimeout(()=>{const _0x20f62b=_0x11bf8b;_0x21d951[_0x20f62b(0x222)][_0x20f62b(0x234)](_0x20f62b(0x1e8));if(tg?.[_0x20f62b(0x208)])tg[_0x20f62b(0x208)]['impactOccurred'](_0x20f62b(0x225));},0x1f4)),_0x55153d[_0x11bf8b(0x1f9)](_0x11bf8b(0x20e),()=>clearTimeout(_0x23353c));const _0x4d1044=document['createElement'](_0x11bf8b(0x207));return _0x4d1044[_0x11bf8b(0x1e5)]='message-time',_0x4d1044['textContent']=formatTime(_0x26b104[_0x11bf8b(0x1fa)]),_0x21d951[_0x11bf8b(0x24d)](_0x1b88d6),_0x21d951[_0x11bf8b(0x24d)](_0x55153d),_0x21d951[_0x11bf8b(0x24d)](_0x4d1044),_0x21d951;}function createTypingIndicator(){const _0xeb05cc=a0_0x476192,_0x1b98f1=document[_0xeb05cc(0x232)](_0xeb05cc(0x207));return _0x1b98f1[_0xeb05cc(0x1e5)]=_0xeb05cc(0x206),_0x1b98f1['id']=_0xeb05cc(0x245),_0x1b98f1[_0xeb05cc(0x1f7)]=_0xeb05cc(0x1ed),_0x1b98f1;}function renderMessages(){const _0x2afa42=a0_0x476192;Array[_0x2afa42(0x25a)](chatArea['children'])['forEach'](_0x501704=>{const _0x14d338=_0x2afa42;if(_0x501704['id']!=='emptyState')_0x501704[_0x14d338(0x21e)]();}),messages['length']>0x0?(emptyState[_0x2afa42(0x22f)][_0x2afa42(0x214)]=_0x2afa42(0x24b),messages['forEach']((_0x16a6d5,_0x458c68)=>chatArea[_0x2afa42(0x24d)](createMessageElement(_0x16a6d5,_0x458c68)))):emptyState['style']['display']='flex',requestAnimationFrame(()=>chatArea['scrollTop']=chatArea['scrollHeight']);}function autoResizeTextarea(){const _0x21b8b9=a0_0x476192;messageInput[_0x21b8b9(0x22f)]['height']='auto',messageInput[_0x21b8b9(0x22f)]['height']=Math[_0x21b8b9(0x1f5)](messageInput[_0x21b8b9(0x212)],0x78)+'px';}function updateSendButton(){const _0x467470=a0_0x476192,_0x4befd7=messageInput[_0x467470(0x24a)][_0x467470(0x223)]();sendBtn['disabled']=!_0x4befd7||isTyping;}function a0_0x47e8(_0x336b12,_0x46c608){_0x336b12=_0x336b12-0x1dc;const _0x241d86=a0_0x275d();let _0x13067e=_0x241d86[_0x336b12];return _0x13067e;}async function sendMessage(){const _0x18dd76=a0_0x476192,_0x3b6263=messageInput[_0x18dd76(0x24a)][_0x18dd76(0x223)]();if(!_0x3b6263||isTyping)return;if(tg?.['HapticFeedback'])tg[_0x18dd76(0x208)]['impactOccurred']('light');messages['push']({'role':_0x18dd76(0x20d),'content':_0x3b6263,'timestamp':Date[_0x18dd76(0x1f2)]()}),localStorage[_0x18dd76(0x221)](_0x18dd76(0x1ff),JSON[_0x18dd76(0x237)](messages)),renderMessages(),messageInput['value']='',autoResizeTextarea(),updateSendButton(),isTyping=!![],chatArea[_0x18dd76(0x24d)](createTypingIndicator()),chatArea[_0x18dd76(0x228)]=chatArea[_0x18dd76(0x212)];const _0x53c6f4=await callBackend(_0x18dd76(0x257),{'message':_0x3b6263});isTyping=![];const _0x55262b=document['getElementById'](_0x18dd76(0x245));if(_0x55262b)_0x55262b[_0x18dd76(0x21e)]();let _0x27cf32=_0x18dd76(0x1f0);if(_0x53c6f4[_0x18dd76(0x233)]){_0x27cf32=_0x53c6f4[_0x18dd76(0x246)]||_0x18dd76(0x253);if(tg?.[_0x18dd76(0x208)])tg[_0x18dd76(0x208)][_0x18dd76(0x21d)](_0x18dd76(0x233));}else{_0x27cf32=_0x53c6f4[_0x18dd76(0x22e)]||_0x18dd76(0x216);if(tg?.[_0x18dd76(0x208)])tg['HapticFeedback']['notificationOccurred'](_0x18dd76(0x22e));}messages[_0x18dd76(0x20f)]({'role':'ai','content':_0x27cf32,'timestamp':Date[_0x18dd76(0x1f2)]()}),localStorage[_0x18dd76(0x221)](_0x18dd76(0x1ff),JSON[_0x18dd76(0x237)](messages)),renderMessages();}function confirmDelete(_0x2193ea){const _0x1f7db0=a0_0x476192;if(mTitle)mTitle[_0x1f7db0(0x23b)]=_0x1f7db0(0x23c);if(mText)mText[_0x1f7db0(0x23b)]=_0x1f7db0(0x1ec);modalCallback=()=>{const _0x4a6ee9=_0x1f7db0;messages[_0x4a6ee9(0x215)](_0x2193ea,0x1),localStorage[_0x4a6ee9(0x221)](_0x4a6ee9(0x1ff),JSON[_0x4a6ee9(0x237)](messages)),renderMessages();},modal[_0x1f7db0(0x222)][_0x1f7db0(0x234)](_0x1f7db0(0x1ef));}if(clearBtn)clearBtn[a0_0x476192(0x1f8)]=()=>{const _0x4d74f9=a0_0x476192;if(!messages[_0x4d74f9(0x213)])return;if(mTitle)mTitle['textContent']=_0x4d74f9(0x204);if(mText)mText[_0x4d74f9(0x23b)]=_0x4d74f9(0x1f6);modalCallback=async()=>{const _0x356c53=_0x4d74f9;messages=[],localStorage[_0x356c53(0x23f)](_0x356c53(0x1ff)),renderMessages(),callBackend('clear_history',{});},modal[_0x4d74f9(0x222)][_0x4d74f9(0x234)](_0x4d74f9(0x1ef));};document[a0_0x476192(0x24c)](a0_0x476192(0x209))[a0_0x476192(0x1f8)]=()=>modal['classList']['remove'](a0_0x476192(0x1ef)),document[a0_0x476192(0x24c)](a0_0x476192(0x240))[a0_0x476192(0x1f8)]=()=>{const _0x695eaa=a0_0x476192;if(modalCallback)modalCallback();modal[_0x695eaa(0x222)][_0x695eaa(0x21e)](_0x695eaa(0x1ef));},messageInput[a0_0x476192(0x1f9)](a0_0x476192(0x210),()=>{updateSendButton(),autoResizeTextarea();}),messageInput['addEventListener']('keydown',_0x395b77=>{const _0x159687=a0_0x476192;_0x395b77[_0x159687(0x239)]===_0x159687(0x1e4)&&!_0x395b77[_0x159687(0x22a)]&&(_0x395b77[_0x159687(0x219)](),sendMessage());}),sendBtn[a0_0x476192(0x1f8)]=sendMessage,document[a0_0x476192(0x1f9)](a0_0x476192(0x218),_0x1f59bd=>{const _0x5e76c7=a0_0x476192;document[_0x5e76c7(0x200)]('.message.show-delete')[_0x5e76c7(0x248)](_0x37aec5=>{const _0x5e2615=_0x5e76c7;if(!_0x37aec5[_0x5e2615(0x252)](_0x1f59bd[_0x5e2615(0x201)]))_0x37aec5[_0x5e2615(0x222)][_0x5e2615(0x21e)]('show-delete');});});function a0_0x275d(){const _0x39175f=['querySelector','error','style','message-bubble','disableVerticalSwipes','createElement','success','add','viewportChanged','https://script.google.com/macros/s/AKfycbzvlDKUH6qsON-A6iSHYvMU_6XWtReZc5oXnnZOMTgETfvZqMMh2zUbdQJF-iOanMBc/exec','stringify','viewportHeight','key','role','textContent','Удалить?','search','setHeaderColor','removeItem','modalConfirm','206709htlkDR','impactOccurred','offClick','first_name','typingIndicator','text','WebApp','forEach','416562AaSbrS','value','none','getElementById','appendChild','messageInput','ready','offsetHeight','apply','contains','Пустой\x20ответ','inputArea','confirmModal','replace','send_message','chatArea','warn','from','getHours','parse','11870PjrDgn','65116YhKUXH','(((.+)+)+)+$','focus','debug_uid','paddingBottom','Enter','className','message\x20','emptyState','show-delete','112300aQmzsw','constructor','signal','Действие\x20необратимо.','<div\x20class=\x22message-bubble\x22><div\x20class=\x22typing-indicator\x22><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div><div\x20class=\x22typing-dot\x22></div></div></div>','text/plain','show','Ошибка\x20сети','onClick','now','modalTitle','content','min','Начнется\x20новый\x20диалог.','innerHTML','onclick','addEventListener','timestamp','resize','expand','padStart','180sAtqZa','ai_chat_messages','querySelectorAll','target','json','getItem','Очистить\x20историю?','#050505','message\x20ai','div','HapticFeedback','modalCancel','href','floor','random','user','touchend','push','input','6.1','scrollHeight','length','display','splice','Ошибка\x20сервера','TG\x20setup\x20error:','click','preventDefault','isVersionAtLeast','<br>','onEvent','notificationOccurred','remove','849933GRuAIx','4702304UgqXNL','setItem','classList','trim','<svg\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22\x20width=\x2216\x22\x20height=\x2216\x22><path\x20d=\x22M3\x206h18M19\x206v14a2\x202\x200\x2001-2\x202H7a2\x202\x200\x2001-2-2V6m3\x200V4a2\x202\x200\x20012-2h4a2\x202\x200\x20012\x202v2M10\x2011v6M14\x2011v6\x22/></svg>','medium','POST','Telegram','scrollTop','username','shiftKey','innerHeight','initData'];a0_0x275d=function(){return _0x39175f;};return a0_0x275d();}const saved=localStorage[a0_0x476192(0x203)](a0_0x476192(0x1ff));if(saved)try{messages=JSON[a0_0x476192(0x1dd)](saved),renderMessages();}catch(a0_0x4a1705){}updateSendButton();