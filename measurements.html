<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Замеры — анкета (прототип)</title>
<style>
  :root{
    --bg-grad: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    --card: rgba(255,255,255,.16);
    --card-border: rgba(255,255,255,.28);
    --card-shadow: 0 8px 30px rgba(0,0,0,.18);
    --accent:#6366f1;
    --text:#111;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    min-height:100svh;
    background:var(--bg-grad);
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
    color:var(--text);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  .page{max-width:560px;margin:0 auto;padding:18px 14px 24px}

  /* ===== Секция (единый фон — ничего не «режется») ===== */
  .section{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:18px;
    box-shadow:var(--card-shadow);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    overflow:hidden;
  }
  .section + .section{margin-top:14px}
  .section-h{
    display:flex;align-items:center;gap:10px;
    padding:14px 16px; cursor:pointer; user-select:none;
  }
  .section-h h2{font-size:16px;font-weight:800;color:#fff;flex:1}
  .chev{
    width:20px;height:20px;display:inline-flex;align-items:center;justify-content:center;
    transition:transform .22s ease, opacity .2s ease; opacity:.95;
  }
  .chev svg{display:block}
  /* свёрнуто — стрела вверх; развёрнуто — вниз */
  .section:not(.open) .chev{ transform:rotate(180deg); }
  .section.open .chev{ transform:rotate(0deg); }

  .section-b{
    /* фон у тела теперь прозрачный, чтобы не было «двойного слоя» */
    max-height:0; overflow:hidden; transition:max-height .25s ease;
    border-top:1px solid rgba(255,255,255,.22);
  }
  .section.open .section-b{ max-height:72svh; }

  .section-content{
    padding:12px 12px 16px;
    overflow:auto; -webkit-overflow-scrolling:touch;
    scrollbar-gutter: stable both-edges;
  }
  .section-content::-webkit-scrollbar{width:8px}
  .section-content::-webkit-scrollbar-thumb{background:#c5c9d2;border-radius:8px}
  .section-content{scrollbar-width:thin; scrollbar-color:#c5c9d2 transparent}

  /* ===== Поля ===== */
  .field{
    background:rgba(255,255,255,.14);
    border:1px solid rgba(255,255,255,.28);
    border-radius:14px;
    padding:12px 10px 12px;
    color:#fff;
  }
  .field + .field{margin-top:10px}
  .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .label{font-size:12px;font-weight:700;opacity:.95}

  /* Центрированная ручная правка числа */
  .manual{
    display:flex; align-items:center; justify-content:center; gap:8px; margin:8px 0 4px;
  }
  .step-btn{
    width:36px;height:36px;border-radius:12px;border:1px solid rgba(255,255,255,.35);
    background:rgba(255,255,255,.1); color:#fff; font-weight:900; font-size:18px; line-height:1;
    display:flex; align-items:center; justify-content:center; cursor:pointer;
    box-shadow:0 6px 16px rgba(0,0,0,.12);
  }
  .num-input{
    width:140px; text-align:center; padding:8px 10px; border-radius:12px; border:1px solid rgba(255,255,255,.5);
    background:rgba(255,255,255,.9); color:#111; font-weight:800; font-size:20px; outline:none;
    font-variant-numeric: tabular-nums;
  }
  .unit{margin-left:6px; font-size:12px; opacity:.85}

  /* ===== Горизонтальное колесо (range) ===== */
  .wheel{
    margin-top:6px; position:relative; padding:20px 8px 8px;
    --track:#e5e7eb; --thumb:#fff; --tick:#cbd5e1;
  }
  .wheel .center-mark{
    position:absolute; left:50%; top:6px; bottom:14px; width:2px;
    transform:translateX(-50%);
    background:linear-gradient(180deg,transparent,rgba(99,102,241,.95),transparent);
    border-radius:2px; pointer-events:none;
  }
  .wheel input[type=range]{
    -webkit-appearance:none; appearance:none; width:100%;
    background:transparent; margin:0; padding:0;
  }
  .wheel input[type=range]::-webkit-slider-runnable-track{
    height:4px; background:var(--track); border-radius:999px;
  }
  .wheel input[type=range]::-moz-range-track{
    height:4px; background:var(--track); border-radius:999px;
  }
  .wheel input[type=range]::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; margin-top:-10px;
    width:24px;height:24px;border-radius:50%;
    background:var(--thumb);
    border:3px solid var(--accent);
    box-shadow:0 6px 18px rgba(0,0,0,.22);
  }
  .wheel input[type=range]::-moz-range-thumb{
    width:24px;height:24px;border-radius:50%;
    background:var(--thumb); border:3px solid var(--accent);
    box-shadow:0 6px 18px rgba(0,0,0,.22);
  }

  /* «Редкие» деления без подписей (ничего не прыгает) */
  .ticks{
    position:relative; height:18px; margin-top:8px;
    mask-image: linear-gradient(90deg, transparent, #000 12%, #000 88%, transparent);
    -webkit-mask-image: linear-gradient(90deg, transparent, #000 12%, #000 88%, transparent);
  }
  .tick{
    position:absolute; bottom:0; width:1px; height:10px; background:var(--tick);
    transform:translateX(-50%); opacity:.9;
  }
  .tick.major{height:14px; opacity:1}

  /* Кнопка «Сохранить» — как на продуктовой */
  .savebar{
    position:sticky; bottom:0; margin-top:14px; padding-top:10px;
    /* лёгкий затемняющий градиент поверх ЕДИНОГО фона секции — не разделяет фон */
    background:linear-gradient(180deg,rgba(0,0,0,0),rgba(0,0,0,.10));
    display:flex; justify-content:flex-end;
  }
  .btn{
    display:inline-flex; align-items:center; justify-content:center;
    gap:8px; min-width:160px;
    background:linear-gradient(135deg,#34d399,#10b981);
    color:#fff; border:0; border-radius:14px;
    padding:12px 16px; font-weight:900; cursor:pointer;
    box-shadow:0 12px 26px rgba(16,185,129,.35), inset 0 1px 0 rgba(255,255,255,.4);
    transition:transform .08s ease;
  }
  .btn:active{ transform:translateY(1px) scale(.99); }
</style>
</head>
<body>
  <div class="page">
    <!-- Анкета (свернута по умолчанию) -->
    <section class="section" id="s-form">
      <header class="section-h" data-toggle="#s-form">
        <h2>Анкета замеров</h2>
        <span class="chev" aria-hidden="true">
          <!-- иконка-стрелка (белая) -->
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M6 9l6 6 6-6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
      </header>
      <div class="section-b">
        <div class="section-content">
          <!-- === Рост (см) === -->
          <div class="field" data-field="height">
            <div class="row">
              <div class="label">Рост</div>
              <div class="unit">см</div>
            </div>

            <!-- ручная правка по центру -->
            <div class="manual" data-key="height">
              <button class="step-btn" data-delta="-0.1">−</button>
              <input class="num-input" id="input-height" type="number" step="0.1" min="50" max="250" value="178.0" inputmode="decimal" />
              <button class="step-btn" data-delta="0.1">+</button>
            </div>

            <div class="wheel" data-min="50.0" data-max="250.0" data-step="0.1" data-key="height">
              <div class="center-mark" aria-hidden="true"></div>
              <input type="range" min="50.0" max="250.0" step="0.1" value="178.0" aria-label="Рост, см" />
              <div class="ticks" aria-hidden="true"></div>
            </div>
          </div>

          <!-- === Вес (кг) === -->
          <div class="field" data-field="weight">
            <div class="row">
              <div class="label">Вес</div>
              <div class="unit">кг</div>
            </div>

            <div class="manual" data-key="weight">
              <button class="step-btn" data-delta="-0.1">−</button>
              <input class="num-input" id="input-weight" type="number" step="0.1" min="20" max="250" value="72.4" inputmode="decimal" />
              <button class="step-btn" data-delta="0.1">+</button>
            </div>

            <div class="wheel" data-min="20.0" data-max="250.0" data-step="0.1" data-key="weight">
              <div class="center-mark" aria-hidden="true"></div>
              <input type="range" min="20.0" max="250.0" step="0.1" value="72.4" aria-label="Вес, кг" />
              <div class="ticks" aria-hidden="true"></div>
            </div>
          </div>

          <div class="savebar">
            <button class="btn" id="save">Сохранить</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Аналитика (раскрыта) -->
    <section class="section open" id="s-analytics">
      <header class="section-h" data-toggle="#s-analytics"><h2>Аналитика</h2><span class="chev"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></header>
      <div class="section-b" style="max-height:60svh">
        <div class="section-content" style="height:100%">
          <div style="height:220px;display:flex;align-items:center;justify-content:center;color:#fff;opacity:.8">[тут будет график]</div>
        </div>
      </div>
    </section>

    <!-- Выводы (раскрыты) -->
    <section class="section open" id="s-ai">
      <header class="section-h" data-toggle="#s-ai"><h2>Выводы</h2><span class="chev"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></header>
      <div class="section-b" style="max-height:40svh">
        <div class="section-content">
          <div class="field" style="color:#111;background:#fff;border-color:#fff">
            <div style="font-size:14px;line-height:1.6">
              Здесь аккуратно вставим текст от ИИ из ячейки — с базовой типографикой.
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

<script>
  /* ===== аккордеоны с плавной белой стрелкой ===== */
  document.querySelectorAll('[data-toggle]').forEach(h=>{
    h.addEventListener('click', ()=>{
      const sec = document.querySelector(h.getAttribute('data-toggle'));
      sec.classList.toggle('open');
    });
  });

  /* ===== утилиты ===== */
  const clamp = (v, a, b)=>Math.min(b, Math.max(a, v));
  const fmt = v => (Math.round(v*10)/10).toFixed(1);

  /* ===== деления «редкие» без подписей ===== */
  function renderSparseTicks(wheel){
    const ticks = wheel.querySelector('.ticks');
    const input = wheel.querySelector('input[type=range]');
    const min = parseFloat(input.min), max = parseFloat(input.max);
    const width = ticks.clientWidth;
    ticks.innerHTML = '';

    // Рисуем шаг 1.0, каждые 5 — major
    const start = Math.ceil(min);
    const end   = Math.floor(max);
    for(let x=start; x<=end; x++){
      const pct = (x - min) / (max - min);
      const left = pct * width;
      const t = document.createElement('div');
      t.className = 'tick' + (x%5===0 ? ' major':'');
      t.style.left = left + 'px';
      ticks.appendChild(t);
    }
  }

  /* ===== адаптивная точность движения =====
     - обычное медленное движение: чувствительность 0.1 на «единицу» перемещения thumb (дефолт)
     - быстрое/дальнее перемещение (dx/время выше порога): временно увеличиваем коэффициент (крупный шаг)
     Реализация: измеряем скорость по событиям pointermove на самом input.
  */
  function bindWheel(wrap){
    const input = wrap.querySelector('input[type=range]');
    const key = wrap.dataset.key;
    const min = parseFloat(input.min), max = parseFloat(input.max);
    const baseStep = parseFloat(wrap.dataset.step)||0.1;

    // синхронизация с ручным вводом
    const num = document.getElementById('input-'+key);

    function setValue(v){
      const val = clamp(+v, min, max);
      input.value = fmt(val);
      num.value = fmt(val);
    }

    // init
    setValue(num.value || input.value || 0);
    renderSparseTicks(wrap);
    window.addEventListener('resize', ()=>renderSparseTicks(wrap));

    // ручной ввод
    num.addEventListener('input', ()=>{
      let v = parseFloat(num.value.replace(',', '.'));
      if (isNaN(v)) return;
      setValue(v);
    });
    num.addEventListener('blur', ()=>{
      setValue(num.value || input.value);
    });

    // кнопки ± с ускорением (удержание -> шаг 1.0)
    const manual = wrap.parentElement.querySelector('.manual[data-key="'+key+'"]');
    manual.querySelectorAll('.step-btn').forEach(btn=>{
      let holdTimer=null, fast=false, interval=null;
      function applyStep(){
        const delta = parseFloat(btn.dataset.delta) * (fast?10:1); // 0.1 или 1.0
        setValue(parseFloat(input.value)+delta);
      }
      btn.addEventListener('touchstart', start, {passive:true});
      btn.addEventListener('mousedown', start);
      function start(e){
        e.preventDefault();
        fast=false; applyStep();
        holdTimer=setTimeout(()=>{ fast=true; interval=setInterval(applyStep, 80); }, 400);
      }
      ['touchend','touchcancel','mouseup','mouseleave'].forEach(ev=>{
        btn.addEventListener(ev, ()=>{
          clearTimeout(holdTimer); holdTimer=null;
          clearInterval(interval); interval=null; fast=false;
        }, {passive:true});
      });
    });

    // слайдер + адаптивная точность по скорости
    let lastX=null, lastT=0, boostUntil=0;
    const BOOST_MS = 400;        // длительность «крупного шага» после быстрого движения
    const SPEED_PX_PER_MS = 0.6; // порог скорости
    const STEP_WHEN_BOOST = 1.0; // «крупный» шаг

    input.addEventListener('pointerdown', e=>{
      lastX = e.clientX; lastT = performance.now();
    });
    input.addEventListener('pointermove', e=>{
      if(lastX==null) return;
      const now = performance.now();
      const dx = Math.abs(e.clientX - lastX);
      const dt = now - lastT || 1;
      const speed = dx/dt;
      if (speed > SPEED_PX_PER_MS){
        boostUntil = now + BOOST_MS;
      }
      lastX = e.clientX; lastT = now;
    });
    ['pointerup','pointercancel','lostpointercapture','touchend','mouseup','mouseleave'].forEach(ev=>{
      input.addEventListener(ev,()=>{ lastX=null; }, {passive:true});
    });

    input.addEventListener('input', ()=>{
      // если активирован «boost», округляем к 1.0; иначе — к 0.1
      const now = performance.now();
      const raw = parseFloat(input.value);
      const step = (now < boostUntil) ? STEP_WHEN_BOOST : baseStep;
      const rounded = step===1.0 ? Math.round(raw) : Math.round(raw*10)/10;
      setValue(rounded);
    });
  }

  document.querySelectorAll('.wheel').forEach(bindWheel);

  /* ===== Сохранить (заглушка) ===== */
  document.getElementById('save').addEventListener('click', ()=>{
    alert('Сохранили черновик замеров (демо)');
  });
</script>
</body>
</html>
