<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Замеры — анкета (прототип)</title>
<style>
  :root{
    --bg-grad: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    --card: rgba(255,255,255,.16);
    --card-border: rgba(255,255,255,.28);
    --card-shadow: 0 8px 30px rgba(0,0,0,.18);
    --accent:#6366f1;
    --text:#111;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    min-height:100svh; /* iOS-safe viewport */
    background:var(--bg-grad);
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
    color:var(--text);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  .page{max-width:560px;margin:0 auto;padding:18px 14px 24px}

  /* ===== Секция-аккордеон (фон не делится) ===== */
  .section{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:18px;
    box-shadow:var(--card-shadow);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    overflow:hidden;
  }
  .section + .section{margin-top:14px}
  .section-h{
    display:flex;align-items:center;gap:10px;
    padding:14px 16px; cursor:pointer; user-select:none;
  }
  .section-h h2{font-size:16px;font-weight:800;color:#fff;flex:1}
  .chev{width:18px;height:18px;display:inline-block;transform:rotate(-90deg);transition:transform .2s}
  .open .chev{transform:rotate(0deg)}
  .section-b{
    border-top:1px solid rgba(255,255,255,.22);
    background:rgba(255,255,255,.08); /* единый слой – никакого «разреза» */
    max-height:0; overflow:hidden; transition:max-height .25s ease;
  }
  .open .section-b{
    /* ограничиваем высоту и даём внутренний скролл (iOS инерция включена) */
    max-height:70svh;
  }
  .section-content{
    padding:12px 12px 16px;
    overflow:auto; -webkit-overflow-scrolling:touch;
    scrollbar-gutter: stable both-edges;
  }
  /* iOS видимый скролл */
  .section-content::-webkit-scrollbar{width:8px}
  .section-content::-webkit-scrollbar-thumb{background:#c5c9d2;border-radius:8px}
  .section-content{scrollbar-width:thin; scrollbar-color:#c5c9d2 transparent}

  /* ===== Поле/группа ===== */
  .field{
    background:rgba(255,255,255,.14);
    border:1px solid rgba(255,255,255,.28);
    border-radius:14px;
    padding:10px 10px 12px;
    color:#fff;
  }
  .field + .field{margin-top:10px}
  .row{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .label{font-size:12px;font-weight:700;opacity:.95}
  .value{min-width:84px;text-align:right;font-variant-tabular-nums:tabular-nums}
  .value .num{font-weight:800;font-size:18px}
  .value .unit{font-size:12px;opacity:.85;margin-left:4px}

  /* ===== Горизонтальное колесо на базе range (легкое, управляемое, с метками) ===== */
  .wheel{
    margin-top:8px; position:relative; padding:20px 10px 16px;
    --track:#e5e7eb; --thumb:#fff; --tick:#cbd5e1; --label:#111;
  }
  .wheel .center-mark{
    position:absolute; left:50%; top:8px; bottom:8px; width:2px;
    transform:translateX(-50%);
    background:linear-gradient(180deg,transparent,rgba(99,102,241,.9),transparent);
    border-radius:2px; pointer-events:none;
  }
  .wheel input[type=range]{
    -webkit-appearance:none; appearance:none; width:100%;
    background:transparent; margin:0; padding:0;
  }
  .wheel input[type=range]::-webkit-slider-runnable-track{
    height:4px; background:var(--track); border-radius:999px;
  }
  .wheel input[type=range]::-moz-range-track{
    height:4px; background:var(--track); border-radius:999px;
  }
  .wheel input[type=range]::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; margin-top:-10px;
    width:24px;height:24px;border-radius:50%;
    background:var(--thumb);
    border:3px solid var(--accent);
    box-shadow:0 6px 18px rgba(0,0,0,.22);
  }
  .wheel input[type=range]::-moz-range-thumb{
    width:24px;height:24px;border-radius:50%;
    background:var(--thumb); border:3px solid var(--accent);
    box-shadow:0 6px 18px rgba(0,0,0,.22);
  }

  /* Метки +/-10 вокруг центра */
  .ticks{
    position:relative; height:34px; margin-top:10px;
    mask-image: linear-gradient(90deg, transparent, #000 12%, #000 88%, transparent);
    -webkit-mask-image: linear-gradient(90deg, transparent, #000 12%, #000 88%, transparent);
  }
  .tick{
    position:absolute; bottom:16px; width:1px; height:10px; background:var(--tick);
    transform:translateX(-50%);
  }
  .tick.major{height:14px}
  .tick-label{
    position:absolute; bottom:0; transform:translateX(-50%);
    font-size:11px; color:#111; font-weight:700; background:rgba(255,255,255,.85);
    padding:2px 6px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.08);
    white-space:nowrap;
  }

  /* Переключатель режима меток (скрыть/редкие/±10) */
  .labels-mode{
    display:flex; gap:6px; margin-top:8px; flex-wrap:wrap
  }
  .labels-mode button{
    font-size:11px; font-weight:700; padding:6px 8px; border-radius:999px;
    border:1px solid rgba(255,255,255,.35); color:#fff; background:rgba(255,255,255,.12);
    cursor:pointer;
  }
  .labels-mode button.active{background:#6366f1; border-color:#6366f1}

  /* Кнопка «Сохранить» */
  .savebar{
    position:sticky; bottom:0; margin-top:14px; padding-top:10px;
    background:linear-gradient(180deg,rgba(0,0,0,0),rgba(0,0,0,.08));
    display:flex; justify-content:flex-end;
  }
  .btn{
    background:#10b981; color:#fff; border:0; border-radius:12px;
    padding:12px 16px; font-weight:800; cursor:pointer;
    box-shadow:0 8px 20px rgba(16,185,129,.35);
  }
</style>
</head>
<body>
  <div class="page">
    <!-- Секция: Анкета (свернута по умолчанию – как договорились) -->
    <section class="section" id="s-form">
      <header class="section-h" data-toggle="#s-form">
        <h2>Анкета замеров</h2>
        <span class="chev">❯</span>
      </header>
      <div class="section-b">
        <div class="section-content">
          <!-- === Рост (см) === -->
          <div class="field" data-field="height">
            <div class="row">
              <div class="label">Рост</div>
              <div class="value"><span class="num" id="val-height">178.0</span><span class="unit">см</span></div>
            </div>
            <div class="wheel" data-min="50.0" data-max="250.0" data-step="0.1" data-key="height" data-unit="см">
              <div class="center-mark" aria-hidden="true"></div>
              <input type="range" min="50.0" max="250.0" step="0.1" value="178.0" aria-label="Рост, см" />
              <div class="ticks" aria-hidden="true"></div>
              <div class="labels-mode" role="group" aria-label="Режим меток">
                <button data-mode="none">без меток</button>
                <button data-mode="sparse">редкие</button>
                <button data-mode="window" class="active">±10</button>
              </div>
            </div>
          </div>

          <!-- === Вес (кг) — шаг 0.1 (100 г) === -->
          <div class="field" data-field="weight">
            <div class="row">
              <div class="label">Вес</div>
              <div class="value"><span class="num" id="val-weight">72.4</span><span class="unit">кг</span></div>
            </div>
            <div class="wheel" data-min="20.0" data-max="250.0" data-step="0.1" data-key="weight" data-unit="кг">
              <div class="center-mark" aria-hidden="true"></div>
              <input type="range" min="20.0" max="250.0" step="0.1" value="72.4" aria-label="Вес, кг" />
              <div class="ticks" aria-hidden="true"></div>
              <div class="labels-mode" role="group" aria-label="Режим меток">
                <button data-mode="none">без меток</button>
                <button data-mode="sparse" class="active">редкие</button>
                <button data-mode="window">±10</button>
              </div>
            </div>
          </div>

          <!-- здесь дальше добавим остальные поля (шея/плечи/грудь/...),
               сейчас важна идеальная UX-модель на примерах -->

          <div class="savebar">
            <button class="btn" id="save">Сохранить</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Заглушки секций «Аналитика» и «Выводы» (раскрыты по умолчанию, сворачиваемые) -->
    <section class="section open" id="s-analytics">
      <header class="section-h" data-toggle="#s-analytics"><h2>Аналитика</h2><span class="chev">❯</span></header>
      <div class="section-b" style="max-height:60svh">
        <div class="section-content" style="height:100%">
          <div style="height:220px;display:flex;align-items:center;justify-content:center;color:#fff;opacity:.8">[тут будет график]</div>
        </div>
      </div>
    </section>

    <section class="section open" id="s-ai">
      <header class="section-h" data-toggle="#s-ai"><h2>Выводы</h2><span class="chev">❯</span></header>
      <div class="section-b" style="max-height:40svh">
        <div class="section-content">
          <div class="field" style="color:#111;background:#fff;border-color:#fff">
            <div style="font-size:14px;line-height:1.6">
              Здесь аккуратно вставим текст от ИИ из ячейки — с базовой типографикой.
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

<script>
  // ===== Аккордеоны (фон не «режется» и всё скроллится внутри)
  document.querySelectorAll('[data-toggle]').forEach(h=>{
    h.addEventListener('click', ()=>{
      const sec = document.querySelector(h.getAttribute('data-toggle'));
      sec.classList.toggle('open');
    });
  });

  // ===== Колесо: логику делаем лёгкой (range + отрисовка меток в окне)
  function format(v){ return (Math.round(v*10)/10).toFixed(1); }

  function renderTicks(wheel, mode){
    const ticks = wheel.querySelector('.ticks');
    const input = wheel.querySelector('input[type=range]');
    const min = parseFloat(input.min), max = parseFloat(input.max), step = parseFloat(input.step)||0.1;
    const val = parseFloat(input.value);
    const unit = wheel.dataset.unit || '';

    ticks.innerHTML = '';

    if(mode==='none') return;

    // Геометрия контейнера
    const width = ticks.clientWidth;
    const centerX = width/2;

    // Функции для разных режимов
    let values = [];
    if(mode==='window'){
      // ±10 значений вокруг текущего (с шагом input.step)
      const count = 10;
      for(let i=-count;i<=count;i++){
        const v = Math.min(max, Math.max(min, val + i*step));
        values.push({v, isMajor:(i%5===0)});
      }
    } else if(mode==='sparse'){
      // «редкие»: кратные 1.0 в пределах ±10 единиц
      const span = 10;
      const start = Math.floor(val - span);
      const end   = Math.ceil (val + span);
      for(let x=start; x<=end; x++){
        if(x<min || x>max) continue;
        const v = x;
        values.push({v, isMajor:(x%5===0)});
      }
    }

    // Раскладка: равномерно вокруг центра (только визуальные подсказки)
    const n = values.length;
    const usable = Math.min(width*0.76, 320); // компоновка, чтобы не залипало к краям
    const stepPx = (n>1) ? (usable/(n-1)) : 0;
    const left0 = centerX - usable/2;

    values.forEach((o, i)=>{
      const x = left0 + i*stepPx;
      const t = document.createElement('div');
      t.className = 'tick' + (o.isMajor?' major':'');
      t.style.left = x+'px';
      ticks.appendChild(t);

      // Подписываем только основные (или крайние) – не захламляем
      if(o.isMajor || i===0 || i===n-1){
        const lab = document.createElement('div');
        lab.className = 'tick-label';
        lab.style.left = x+'px';
        lab.textContent = format(o.v);
        ticks.appendChild(lab);
      }
    });
  }

  function bindWheel(wheel){
    const input = wheel.querySelector('input[type=range]');
    const key = wheel.dataset.key;
    const unit = wheel.dataset.unit || '';
    const outEl = document.getElementById('val-'+key);
    const modeBtns = wheel.querySelectorAll('.labels-mode button');

    let mode = 'window';
    modeBtns.forEach(b=>{
      b.addEventListener('click', ()=>{
        modeBtns.forEach(x=>x.classList.toggle('active', x===b));
        mode = b.dataset.mode;
        renderTicks(wheel, mode);
      });
    });

    function update(){
      const v = parseFloat(input.value||0);
      outEl.textContent = format(v);
      renderTicks(wheel, mode);
    }
    input.addEventListener('input', update);
    window.addEventListener('resize', ()=>renderTicks(wheel, mode));
    update();
  }

  document.querySelectorAll('.wheel').forEach(bindWheel);

  // «Сохранить» (пока только заглушка UX)
  document.getElementById('save').addEventListener('click', ()=>{
    // тут позже добавим отправку
    alert('Сохранили черновик замеров (демо)');
  });

  // По умолчанию анкета свёрнута (как просили)
  // Если хочешь при первом заходе её показывать — добавь .open на #s-form
</script>
</body>
</html>
