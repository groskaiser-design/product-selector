<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Замеры — двойные колёса</title>
<style>
  :root{
    --bg: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    --cardA: rgba(255,255,255,.18);
    --cardB: rgba(255,255,255,.16);
    --border: rgba(255,255,255,.28);
    --shadow: 0 8px 28px rgba(0,0,0,.18);
    --accent:#6366f1;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{min-height:100svh;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;color:#111}
  .page{max-width:560px;margin:0 auto;padding:18px 14px 24px}

  .section{
    background:linear-gradient(180deg,var(--cardA),var(--cardB));
    border:1px solid var(--border); border-radius:18px;
    box-shadow:var(--shadow);
    backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    overflow:hidden; color:#fff;
  }
  .section + .section{margin-top:14px}
  .section-h{display:flex;align-items:center;gap:10px;padding:14px 16px}
  .section-h h2{font-size:16px;font-weight:800;flex:1}

  .field{padding:12px}
  .field + .field{border-top:1px solid rgba(255,255,255,.14)}
  .row{display:flex;align-items:center;justify-content:space-between}
  .label{font-size:12px;font-weight:700}
  .unit{font-size:12px;opacity:.9}

  /* центральный ввод */
  .manual{display:flex;justify-content:center;margin:8px 0}
  .num{
    width:180px;text-align:center;padding:8px 10px;border-radius:12px;
    background:#fff;color:#111;border:1px solid rgba(0,0,0,.08);
    font-weight:900;font-size:20px;font-variant-numeric:tabular-nums;
  }

  /* ===== duo-wheel ===== */
  .duo{
    position:relative; display:flex; gap:12px; padding:12px;
    border-radius:14px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.24);
  }
  .duo::after{ /* центральная подсветка строки */
    content:""; position:absolute; left:10px; right:10px; top:50%;
    height:36px; transform:translateY(-50%);
    background:rgba(255,255,255,.14); border:1px solid rgba(255,255,255,.35);
    border-radius:10px; pointer-events:none;
  }
  .col{
    flex:1; height:180px; overflow:auto; -webkit-overflow-scrolling:touch;
    scrollbar-width:none;  /* Firefox */
    scroll-snap-type: y mandatory;
    mask-image: linear-gradient(180deg, transparent, #000 18%, #000 82%, transparent);
    -webkit-mask-image: linear-gradient(180deg, transparent, #000 18%, #000 82%, transparent);
  }
  .col::-webkit-scrollbar{display:none}
  .option{
    height:36px; display:flex; align-items:center; justify-content:center;
    font-weight:800; font-size:18px; color:#eef2ff; opacity:.55;
    scroll-snap-align:center;
  }
  .option.active{ color:#fff; opacity:1; text-shadow:0 1px 0 rgba(0,0,0,.2); }

  .sep{display:flex;align-items:center;justify-content:center;width:22px;color:#e5e7eb;font-weight:800}
  .hint{margin-top:6px;text-align:center;font-size:12px;opacity:.85}

  .savebar{display:flex;justify-content:flex-end;padding:12px}
  .btn{
    min-width:160px;padding:12px 16px;border:0;border-radius:14px;
    background:linear-gradient(135deg,#34d399,#10b981); color:#fff;font-weight:900;
    box-shadow:0 12px 26px rgba(16,185,129,.35), inset 0 1px 0 rgba(255,255,255,.4);
  }
</style>
</head>
<body>
  <div class="page">

    <section class="section">
      <div class="section-h"><h2>Анкета замеров</h2></div>

      <!-- Рост -->
      <div class="field" data-key="height" data-min="0" data-max="250" data-decimals="1" data-unit="см">
        <div class="row">
          <div class="label">Рост</div>
          <div class="unit">см</div>
        </div>

        <div class="manual"><input id="height-num" class="num" type="number" step="0.1" inputmode="decimal" /></div>

        <div class="duo">
          <div class="col col-int"></div>
          <div class="sep">,</div>
          <div class="col col-frac"></div>
        </div>
        <div class="hint">крутите целые и миллиметры</div>
      </div>

      <!-- Вес (тот же компонент) -->
      <div class="field" data-key="weight" data-min="20" data-max="250" data-decimals="1" data-unit="кг">
        <div class="row">
          <div class="label">Вес</div>
          <div class="unit">кг</div>
        </div>

        <div class="manual"><input id="weight-num" class="num" type="number" step="0.1" inputmode="decimal" /></div>

        <div class="duo">
          <div class="col col-int"></div>
          <div class="sep">,</div>
          <div class="col col-frac"></div>
        </div>
        <div class="hint">кг и десятые доли</div>
      </div>

      <div class="savebar"><button class="btn">Сохранить</button></div>
    </section>

  </div>

<script>
  // утилиты
  const clamp=(v,a,b)=>Math.min(b,Math.max(a,v));
  const fmt1=v=>(Math.round(v*10)/10).toFixed(1);

  function buildWheel(fieldEl, initial){
    const min = +fieldEl.dataset.min;
    const max = +fieldEl.dataset.max;
    const key = fieldEl.dataset.key;
    const decimals = +fieldEl.dataset.decimals || 1;

    const intCol = fieldEl.querySelector('.col-int');
    const fracCol = fieldEl.querySelector('.col-frac');
    const numInput = document.getElementById(`${key}-num`);

    // наполнить колонны + паддинги сверху/снизу для центрирования
    function fillCol(col, from, to, pad=4){
      const frag=document.createDocumentFragment();
      for(let i=0;i<pad;i++){ const p=document.createElement('div'); p.className='option'; p.textContent=''; frag.appendChild(p); }
      for(let i=from;i<=to;i++){ const d=document.createElement('div'); d.className='option'; d.textContent=i; frag.appendChild(d); }
      for(let i=0;i<pad;i++){ const p=document.createElement('div'); p.className='option'; p.textContent=''; frag.appendChild(p); }
      col.innerHTML=''; col.appendChild(frag);
    }

    fillCol(intCol, Math.floor(min), Math.floor(max));
    fillCol(fracCol, 0, (decimals===1?9:99));

    // позиционирование к значению
    const rowH = 36, pad = 4; // см. fillCol
    function scrollToIndex(col, idx, instant=false){
      const top = (idx + pad) * rowH - (col.clientHeight-rowH)/2;
      col.scrollTo({top, behavior: instant ? 'auto' : 'smooth'});
    }
    function nearestIndex(col){
      const y = col.scrollTop + (col.clientHeight-rowH)/2;
      return Math.round(y/rowH) - pad;
    }
    function markActive(col){
      const idx = nearestIndex(col);
      Array.from(col.children).forEach((el,i)=>el.classList.toggle('active', i===idx+pad));
    }

    // актуализация числа и ограничение долей при int=max
    function applyFromCols(){
      let i = clamp(nearestIndex(intCol), Math.floor(min), Math.floor(max));
      let f = clamp(nearestIndex(fracCol), 0, 9);
      if(i===Math.floor(max)){ f = 0; scrollToIndex(fracCol, 0, true); } // не выходим за предел
      const val = i + f/10;
      numInput.value = fmt1(val);
      markActive(intCol); markActive(fracCol);
    }

    let snapTimer=null;
    function onScrollEnd(){
      clearTimeout(snapTimer);
      snapTimer = setTimeout(()=>{
        // снап к ближайшим индекcам
        scrollToIndex(intCol, clamp(nearestIndex(intCol), Math.floor(min), Math.floor(max)), true);
        scrollToIndex(fracCol, clamp(nearestIndex(fracCol), 0, 9), true);
        applyFromCols();
      }, 80);
    }

    [intCol, fracCol].forEach(col=>{
      col.addEventListener('scroll', ()=>{ markActive(col); onScrollEnd(); }, {passive:true});
      // начальная активность
      markActive(col);
    });

    // из input -> колёса
    function setValue(v, instant=false){
      const val = clamp(+v, min, max);
      const i = Math.trunc(val);
      let f = Math.round((val - i) * 10);
      if (i===Math.floor(max)) f = 0;
      scrollToIndex(intCol, i, instant);
      scrollToIndex(fracCol, f, instant);
      numInput.value = fmt1(i + f/10);
      markActive(intCol); markActive(fracCol);
    }

    // начальное значение
    setValue(initial ?? (min + (max-min)/2), true);

    numInput.addEventListener('input', ()=>{
      const v = parseFloat(String(numInput.value).replace(',','.'));
      if(!isNaN(v)) setValue(v);
    });

    return { setValue, get value(){ return parseFloat(numInput.value); } };
  }

  // инициализация двух полей
  const heightWheel = buildWheel(document.querySelector('[data-key="height"]'), 178.0);
  const weightWheel = buildWheel(document.querySelector('[data-key="weight"]'), 72.4);

  document.querySelector('.btn').addEventListener('click', ()=>{
    alert(`Сохраняем:\nРост: ${heightWheel.value} см\nВес: ${weightWheel.value} кг`);
  });
</script>
</body>
</html>
