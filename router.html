<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Ultima Dashboard Dynamic</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root {
    /* --- COLOR PALETTE (Deep Space) --- */
    --bg-core: #050505;
    --accent-primary: #6c5ce7;
    --accent-secondary: #00cec9;
    --text-main: #ffffff;
    --text-muted: rgba(255, 255, 255, 0.55);
    
    /* --- SURFACES --- */
    --surface-glass: rgba(255, 255, 255, 0.08);
    --surface-border: rgba(255, 255, 255, 0.12);
    --surface-border-light: rgba(255, 255, 255, 0.25);
    
    /* --- METRICS --- */
    --radius-xl: 28px;
    --radius-l: 22px;
    --pad: 16px;
    --gap: 12px;
  }

  /* === RESET & BASE === */
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body {
    background-color: var(--bg-core);
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;
    color: var(--text-main);
    min-height: 100vh;
    overflow-x: hidden;
    overscroll-behavior-y: none;
    -webkit-font-smoothing: antialiased;
  }

  /* === BACKGROUND FX (OPTIMIZED) === */
  .fx-layer {
    position: fixed; inset: 0; z-index: -1; overflow: hidden; pointer-events: none;
    transform: translate3d(0,0,0); contain: strict; 
  }
  .orb {
    position: absolute; border-radius: 50%; opacity: 0.5;
    will-change: transform; animation: float 25s infinite linear; 
  }
  .orb-1 { 
    width: 500px; height: 500px; top: -15%; left: -25%;
    background: radial-gradient(circle, var(--accent-primary) 0%, transparent 70%);
  }
  .orb-2 { 
    width: 450px; height: 450px; bottom: 5%; right: -25%; 
    background: radial-gradient(circle, var(--accent-secondary) 0%, transparent 70%);
    animation-direction: reverse; 
  }
  @keyframes float {
    0% { transform: translate3d(0,0,0) rotate(0deg); }
    50% { transform: translate3d(20px, 40px, 0) rotate(180deg); }
    100% { transform: translate3d(0,0,0) rotate(360deg); }
  }
  .noise {
    position: fixed; inset: 0; z-index: -1; opacity: 0.03;
    background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    pointer-events: none;
  }

  /* === LAYOUT === */
  .app-shell {
    max-width: 480px; margin: 0 auto;
    padding: var(--pad);
    padding-top: calc(var(--pad) + env(safe-area-inset-top));
    padding-bottom: calc(40px + env(safe-area-inset-bottom));
    display: flex; flex-direction: column; gap: 28px;
  }

  /* === HEADER === */
  .header { display: flex; justify-content: space-between; align-items: center; padding: 4px 0; }
  .profile-lockup { display: flex; align-items: center; gap: 12px; }
  .avatar-box {
    width: 44px; height: 44px; border-radius: 50%;
    box-shadow: 0 0 0 2px rgba(255,255,255,0.1), 0 0 0 4px rgba(0,0,0,0.2);
    background: #222; overflow: hidden; position: relative;
  }
  .avatar-img { width: 100%; height: 100%; object-fit: cover; }
  .user-text h1 { font-size: 20px; font-weight: 800; margin: 0; }
  .user-text p { font-size: 12px; color: var(--text-muted); margin: 0; text-transform: uppercase; letter-spacing: 0.5px; }
  .icon-btn {
    width: 40px; height: 40px; border-radius: 50%;
    background: var(--surface-glass); border: 1px solid var(--surface-border);
    display: flex; align-items: center; justify-content: center;
  }

  /* === WIDGETS (Carousel) === */
  .widgets-container { margin: 0 calc(var(--pad) * -1); }
  .carousel {
    display: flex; gap: 12px; overflow-x: auto; scroll-snap-type: x mandatory;
    padding: 0 var(--pad) 20px var(--pad);
    scrollbar-width: none; -webkit-overflow-scrolling: touch;
  }
  .carousel::-webkit-scrollbar { display: none; }
  
  .widget {
    flex: 0 0 calc(100% - 24px); scroll-snap-align: center;
    height: 170px; border-radius: var(--radius-xl);
    background: linear-gradient(165deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.02) 100%);
    border: 1px solid var(--surface-border); border-top: 1px solid var(--surface-border-light);
    backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    position: relative; overflow: hidden; display: flex; align-items: center; justify-content: space-between; padding: 22px;
  }
  /* –í–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤–∏–¥–∂–µ—Ç–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞) */
  .w-info { z-index: 2; display: flex; flex-direction: column; justify-content: center; gap: 4px; }
  .w-label { font-size: 12px; font-weight: 700; text-transform: uppercase; color: var(--text-muted); }
  .w-val { font-size: 34px; font-weight: 800; }
  .w-sub { font-size: 14px; color: var(--text-muted); }
  .ring-svg { width: 100px; height: 100px; transform: rotate(-90deg); }
  .ring-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 8; }
  .ring-val { fill: none; stroke: url(#g1); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 251; stroke-dashoffset: 80; }

  /* === DYNAMIC SECTIONS === */
  .section { display: flex; flex-direction: column; gap: 12px; }
  .section-title { font-size: 17px; font-weight: 700; margin-left: 4px; opacity: 0.9; }
  
  .grid {
    display: grid;
    grid-template-columns: 1fr 1fr; /* 2 –∫–æ–ª–æ–Ω–∫–∏ –±–∞–∑–∞ */
    gap: var(--gap);
    grid-auto-flow: dense;
  }

  /* –¢–∏–ø—ã –ø–ª–∏—Ç–æ–∫ */
  .tile {
    background: var(--surface-glass);
    border: 1px solid var(--surface-border);
    border-radius: var(--radius-l);
    padding: 16px; position: relative; overflow: hidden;
    display: flex; flex-direction: column; justify-content: space-between;
    cursor: pointer; transition: transform 0.1s, background 0.2s;
    min-height: 100px;
  }
  .tile:active { transform: scale(0.97); background: rgba(255,255,255,0.12); }

  /* –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ª—ç–π–∞—É—Ç–∞ */
  .tile.wide { grid-column: span 2; flex-direction: row; align-items: center; justify-content: flex-start; gap: 16px; height: 84px; }
  .tile.tall { grid-row: span 2; background: linear-gradient(145deg, #48bfe3 0%, #5e60ce 100%); border: none; height: auto; }
  .tile.std  { aspect-ratio: 1; }

  /* –ö–æ–Ω—Ç–µ–Ω—Ç –ø–ª–∏—Ç–∫–∏ */
  .t-icon-box {
    width: 38px; height: 38px; border-radius: 12px;
    background: rgba(255,255,255,0.1);
    display: flex; align-items: center; justify-content: center;
    margin-bottom: auto; /* –ü—Ä–∏–∂–∞—Ç—å –≤–≤–µ—Ä—Ö –≤ Tall/Std */
  }
  .wide .t-icon-box { margin-bottom: 0; } /* –ü–æ —Ü–µ–Ω—Ç—Ä—É –≤ Wide */
  .t-icon-img { width: 22px; height: 22px; object-fit: contain; }
  
  .t-content { margin-top: 8px; }
  .wide .t-content { margin-top: 0; }
  
  .t-title { font-size: 15px; font-weight: 700; line-height: 1.1; }
  .t-sub { font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 3px; font-weight: 500; }
  
  /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∞–∫—Ü–µ–Ω—Ç–Ω–æ–π –ø–ª–∏—Ç–∫–µ */
  .tall .t-title, .tall .t-sub { color: #fff; opacity: 1; }

</style>
</head>
<body>

<div class="fx-layer">
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="noise"></div>
</div>

<div class="app-shell">
  
  <div class="header">
    <div class="profile-lockup">
      <div class="avatar-box"><img src="" id="ava" class="avatar-img" style="display:none"></div>
      <div class="user-text"><p>–ü—Ä–∏–≤–µ—Ç,</p><h1 id="username">–ì–æ—Å—Ç—å</h1></div>
    </div>
    <div class="icon-btn"><svg width="20" height="20" viewBox="0 0 24 24" stroke="white" stroke-width="2" fill="none"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg></div>
  </div>

  <div>
    <div class="widgets-container">
      <div class="carousel">
        <div class="widget" onclick="nav('kbju.html')">
          <div class="w-info">
            <div class="w-label">–°–µ–≥–æ–¥–Ω—è</div>
            <div class="w-val">1,250</div>
            <div class="w-sub">–∫–∫–∞–ª –∏–∑ 2,100</div>
          </div>
          <div style="position:relative; width:100px; height:100px">
            <svg class="ring-svg" viewBox="0 0 100 100">
              <defs><linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#48bfe3"/><stop offset="100%" stop-color="#5e60ce"/></linearGradient></defs>
              <circle class="ring-bg" cx="50" cy="50" r="40"/><circle class="ring-val" cx="50" cy="50" r="40"/>
            </svg>
            <div style="position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:28px">üî•</div>
          </div>
        </div>
        <div class="widget" style="border-top-color:#fdcb6e">
          <div class="w-info">
            <div class="w-label" style="color:#fdcb6e">–°–æ–≤–µ—Ç –¥–Ω—è</div>
            <div class="w-val" style="font-size:20px; line-height:1.3">–ü–µ–π—Ç–µ –≤–æ–¥—É<br>–ø–µ—Ä–µ–¥ –µ–¥–æ–π</div>
          </div>
          <div style="font-size:40px">üíß</div>
        </div>
      </div>
    </div>
  </div>

  <div id="dynamicSections"></div>

</div>

<script>
  /* ============================================================
     DATA MOCK (–ö–∞–∫ —ç—Ç–æ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∏–∑ Google Sheet)
     ============================================================ */
  const SERVER_DATA = [
    {
      sectionTitle: "–î–Ω–µ–≤–Ω–∏–∫",
      items: [
        { title: "–°–∫–∞–Ω–µ—Ä –µ–¥—ã", sub: "–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–µ–º", icon: "diary.svg", link: "scanner.html", type: "tall" }, // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ TALL
        { title: "–ö–ë–ñ–£", sub: "–ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è", icon: "clipboard.svg", link: "kbju.html" }, // AUTO
        { title: "–ü—Ä–æ–¥—É–∫—Ç—ã", sub: "–ë–∞–∑–∞", icon: "apple.svg", link: "#" }, // AUTO
        { title: "–†–∞—Ü–∏–æ–Ω", sub: "–ú–µ–Ω—é –¥–Ω—è", icon: "menu.svg", link: "#" } // AUTO
      ]
    },
    {
      sectionTitle: "–¢–µ–ª–æ",
      items: [
        { title: "–ó–∞–º–µ—Ä—ã", sub: "–í–µ—Å –∏ –æ–±—ä–µ–º—ã", icon: "scales.svg", link: "measurements.html", type: "wide" }, // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ WIDE
        { title: "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞", sub: "–ü—Ä–æ–≥—Ä–µ—Å—Å", icon: "analytics.svg", link: "2.html" },
        { title: "AI –ö–æ—É—á", sub: "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç", icon: "ai.svg", link: "ai.html" }
      ]
    },
    {
      sectionTitle: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
      items: [
        { title: "–ü—Ä–æ—Ñ–∏–ª—å", icon: "profile.svg", link: "#", type: "wide" },
        { title: "–ü–æ–¥–ø–∏—Å–∫–∞", icon: "rub.svg", link: "#", type: "wide" }
      ]
    }
  ];

  const CONFIG = { iconBase: 'https://groskaiser-design.github.io/icons/' };

  /* ============================================================
     RENDER LOGIC
     ============================================================ */
  
  function renderApp() {
    const container = document.getElementById('dynamicSections');
    container.innerHTML = '';

    SERVER_DATA.forEach(section => {
      // 1. –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞
      const secDiv = document.createElement('div');
      secDiv.className = 'section';
      
      if (section.sectionTitle) {
        const title = document.createElement('div');
        title.className = 'section-title';
        title.textContent = section.sectionTitle;
        secDiv.appendChild(title);
      }

      // 2. –°–µ—Ç–∫–∞
      const grid = document.createElement('div');
      grid.className = 'grid';

      // 3. –†–µ–Ω–¥–µ—Ä –∫–Ω–æ–ø–æ–∫ —Å –∞–≤—Ç–æ-–ª—ç–π–∞—É—Ç–æ–º
      section.items.forEach((item, index) => {
        const tile = document.createElement('div');
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å (type –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –ò–õ–ò –∞–≤—Ç–æ-—Ä–∞—Å—á–µ—Ç)
        let layoutClass = item.type || 'std';
        
        // –ü—Ä–∏–º–µ—Ä –∞–≤—Ç–æ-–ª–æ–≥–∏–∫–∏ (–µ—Å–ª–∏ type –Ω–µ –∑–∞–¥–∞–Ω):
        if (!item.type) {
           // –ï—Å–ª–∏ –≤—Å–µ–≥–æ 3 —ç–ª–µ–º–µ–Ω—Ç–∞ –∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π -> —Å–¥–µ–ª–∞–π –µ–≥–æ —à–∏—Ä–æ–∫–∏–º
           if (section.items.length === 3 && index === 0) layoutClass = 'wide';
        }

        tile.className = `tile ${layoutClass}`;
        tile.onclick = () => nav(item.link);

        const iconUrl = CONFIG.iconBase + (item.icon || 'star.svg');

        // HTML –∫–æ–Ω—Ç–µ–Ω—Ç –∫–Ω–æ–ø–∫–∏
        let html = `
          <div class="t-icon-box"><img src="${iconUrl}" class="t-icon-img"></div>
          <div class="t-content">
            <div class="t-title">${item.title}</div>
            ${item.sub ? `<div class="t-sub">${item.sub}</div>` : ''}
          </div>
        `;
        
        tile.innerHTML = html;
        grid.appendChild(tile);
      });

      secDiv.appendChild(grid);
      container.appendChild(secDiv);
    });
  }

  // --- UTILS ---
  const tg = window.Telegram?.WebApp;
  if(tg){ tg.ready(); tg.expand(); tg.setHeaderColor('#050505'); tg.setBackgroundColor('#050505'); tg.BackButton?.hide(); }

  function nav(url) {
    if(tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
    if(url && url !== '#') setTimeout(()=>window.location.href=url, 80);
  }

  function loadUser() {
    const u = tg?.initDataUnsafe?.user || { first_name: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä' };
    document.getElementById('username').textContent = u.first_name;
    if(u.photo_url){ 
      const img = document.getElementById('ava'); 
      img.src=u.photo_url; img.style.display='block'; 
    }
  }

  // BOOT
  document.addEventListener('DOMContentLoaded', () => {
    loadUser();
    renderApp();
  });

</script>
</body>
</html>
