<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Router</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --sbi: env(safe-area-inset-bottom,0px);
    --tile: 64px;
    --tile-gap: 16px;
    --tile-radius: 18px;
    --tile-bg: calc(var(--tile) + 4px);
    --tile-bg-radius: calc(var(--tile-radius) + 4px);
    --spawn-distance: 128px;
    --ripple-scale: 20;
  }

  *{margin:0;padding:0;box-sizing:border-box}
  html,body{height:100%;scrollbar-gutter:stable both-edges}
  /* убираем серую вспышку на Android/WebKit */
  html, body, button, .tile, .icon { -webkit-tap-highlight-color: transparent; }
  button { background: transparent; border: 0; }

  body{
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
    min-height:100vh;
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    padding:20px 16px calc(24px + var(--sbi)) 16px;
    color:#111;
    user-select:none;
  }
  .container{max-width:520px;margin:0 auto}

  /* ===== Профиль ===== */
  .profile-card{
    background:rgba(255,255,255,.15);
    backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
    border-radius:24px;padding:20px 22px;margin-bottom:20px;
    border:1px solid rgba(255,255,255,.22);
    box-shadow:0 8px 32px rgba(0,0,0,.12),inset 0 1px 0 rgba(255,255,255,.35)
  }
  .profile-header{display:flex;gap:14px;align-items:center}
  .profile-photo{
    width:88px;height:88px;border-radius:50%;overflow:hidden;position:relative;flex:0 0 88px;
    display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:28px;
    background:linear-gradient(135deg,rgba(255,255,255,.35),rgba(255,255,255,.15));
    border:2px solid rgba(255,255,255,.28);
    box-shadow:0 10px 24px rgba(0,0,0,.22), inset 0 2px 6px rgba(255,255,255,.25)
  }
  .profile-photo::before{
    content:"";position:absolute;inset:0;border-radius:50%;
    background:radial-gradient(120% 120% at 50% -10%,rgba(255,255,255,.35),transparent 60%)
  }
  .avatar-img{width:100%;height:100%;display:block;border-radius:50%;object-fit:cover;object-position:50% 35%}
  .profile-name{color:#fff;font-weight:800;font-size:20px;line-height:1.15}
  .profile-id{margin-top:6px;font-size:12px;display:inline-block;color:rgba(255,255,255,.9);
    background:rgba(255,255,255,.14);padding:4px 8px;border-radius:8px}

  /* ===== Сетка плиток ===== */
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--tile-gap);position:relative}
  .tile{position:relative;text-align:center;cursor:pointer;overflow:visible;
    transition:transform .18s ease, filter .22s ease, opacity .22s ease}
  .icon-wrap{width:var(--tile);height:var(--tile);margin:0 auto 8px;position:relative}
  .icon-bg{
    position:absolute;left:-2px;top:-2px;width:var(--tile-bg);height:var(--tile-bg);border-radius:var(--tile-bg-radius);
    background:linear-gradient(135deg,rgba(255,255,255,.4),rgba(255,255,255,.1));opacity:.6;transition:opacity .2s,transform .2s
  }
  .icon{
    position:absolute;inset:0;margin:auto;width:var(--tile);height:var(--tile);border-radius:var(--tile-radius);
    background:rgba(255,255,255,.22);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
    border:1.5px solid rgba(255,255,255,.45);display:flex;align-items:center;justify-content:center;
    box-shadow:0 8px 24px rgba(0,0,0,.12),inset 0 1px 0 rgba(255,255,255,.55);
    transition:transform .18s ease,box-shadow .18s ease
  }
  .icon-img{width:34px;height:34px;display:block}
  .label{font-size:12px;font-weight:700;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.25)}
  .tile:active .icon{transform:scale(.92)}

  /* Hover (десктоп) — только наведённая плитка */
  .grid .tile:hover > .icon-wrap > .icon{
    transform:translateY(-6px) scale(1.04);
    box-shadow:0 14px 28px rgba(0,0,0,.18),inset 0 1px 0 rgba(255,255,255,.6),0 0 22px rgba(102,126,234,.35)
  }
  .grid .tile:hover > .icon-wrap > .icon-bg{opacity:1;transform:scale(1.05)}

  /* Ripple */
  .r{
    position:absolute;width:12px;height:12px;border-radius:999px;background:rgba(255,255,255,.35);
    left:0;top:0;transform:translate(-50%,-50%) scale(0);pointer-events:none;filter:blur(1px);
    animation:rr .6s ease-out forwards;will-change:transform,opacity
  }
  @keyframes rr{to{transform:translate(-50%,-50%) scale(var(--ripple-scale));opacity:0}}

  /* ==== Arc Menu для «Старт» ==== */
  #startB{z-index:3}
  .spawn{
    position:absolute;left:50%;top:50%;width:90px;height:104px;
    transform:translate(-50%,-50%);
    opacity:0;pointer-events:none;background:transparent;padding:0;appearance:none;-webkit-appearance:none
  }
  .spawn .icon-wrap{width:var(--tile);height:var(--tile)}
  .spawn .label{margin-top:2px}

  .open-b .spawn{pointer-events:auto}
  .open-b .spawn.s1{opacity:1;transform:translate(-50%,-50%) rotate(-24deg) translate(var(--spawn-distance)) rotate(24deg)}
  .open-b .spawn.s2{opacity:1;transform:translate(-50%,-50%) rotate(24deg) translate(var(--spawn-distance)) rotate(-24deg)}
  .open-b #startB > .icon-wrap > .icon{transform:scale(.9)}

  /* Блюр всего, кроме стартовой плитки */
  .grid.focus .tile{filter:blur(2px) saturate(.85);opacity:.18;transform:translateY(8px)}
  .grid.focus #startB{filter:none;opacity:1;transform:none}

  /* Невидимый backdrop для закрытия по тапу вне */
  .backdrop{position:fixed;inset:0;display:none}
  .backdrop.show{display:block}
</style>
</head>
<body>
  <div class="container">
    <!-- Профиль -->
    <div class="profile-card">
      <div class="profile-header">
        <div class="profile-photo" id="userPhoto">A</div>
        <div class="profile-main">
          <div class="profile-name" id="userName">Загрузка...</div>
          <div class="profile-id" id="userId">ID: ---</div>
        </div>
      </div>
    </div>

    <!-- Сетка -->
    <div class="grid" id="gridB">
      <!-- Инструкция -->
      <div class="tile" data-module="manual">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><img class="icon-img" id="ico-manual" alt="Инструкция"></div>
        </div>
        <div class="label">Инструкция</div>
      </div>

      <!-- Старт -->
      <div class="tile" id="startB">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><img class="icon-img" id="ico-start" alt="Старт"></div>
        </div>
        <div class="label">Старт</div>

        <!-- Разворот -->
        <button class="spawn s1" id="btnProducts" aria-label="Выбор продуктов">
          <div class="icon-wrap"><div class="icon-bg"></div>
            <div class="icon"><img class="icon-img" id="ico-products" alt="Выбор продуктов"></div>
          </div>
          <div class="label">Выбор продуктов</div>
        </button>

        <button class="spawn s2" id="btnKbju" aria-label="Анкета КБЖУ">
          <div class="icon-wrap"><div class="icon-bg"></div>
            <div class="icon"><img class="icon-img" id="ico-kbju" alt="Анкета КБЖУ"></div>
          </div>
          <div class="label">Анкета КБЖУ</div>
        </button>
      </div>

      <div class="tile" data-module="measurements">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><img class="icon-img" id="ico-measurements" alt="Замеры"></div>
        </div>
        <div class="label">Замеры</div>
      </div>

      <div class="tile" data-module="menu">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><img class="icon-img" id="ico-menu" alt="Рацион"></div>
        </div>
        <div class="label">Рацион</div>
      </div>

      <div class="tile" data-module="diary">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><img class="icon-img" id="ico-diary" alt="Отчёт"></div>
        </div>
        <div class="label">Отчёт</div>
      </div>

      <div class="tile" data-module="ai">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><img class="icon-img" id="ico-ai" alt="AI-Коуч"></div>
        </div>
        <div class="label">AI-Коуч</div>
      </div>

      <div class="tile" data-module="analytics">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><img class="icon-img" id="ico-analytics" alt="Аналитика"></div>
        </div>
        <div class="label">Аналитика</div>
      </div>

      <div class="tile" data-module="profile">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><img class="icon-img" id="ico-profile" alt="Профиль"></div>
        </div>
        <div class="label">Профиль</div>
      </div>

      <div class="tile" data-module="subscription">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><img class="icon-img" id="ico-subscription" alt="Подписка"></div>
        </div>
        <div class="label">Подписка</div>
      </div>
    </div>
  </div>

  <div class="backdrop" id="backdrop"></div>
  <div id="toast" style="position:fixed;left:50%;bottom:86px;transform:translateX(-50%);background:rgba(0,0,0,.82);color:#fff;padding:10px 14px;border-radius:10px;font-weight:700;z-index:1000;opacity:0;transition:opacity .2s"></div>

<script>
  /* === БАЗА ДЛЯ ИКОНОК (GitHub Pages) === */
  const ICON_BASE = 'https://groskaiser-design.github.io/icons/'; // ← при необходимости поменяй

  const ICONS = {
    manual:       'question.svg',
    start:        'play.svg',
    products:     'cart.svg',
    kbju:         'clipboard.svg',
    measurements: 'scales.svg',
    menu:         'menu.svg',
    diary:        'diary.svg',
    ai:           'ai.svg',
    analytics:    'analytics.svg',
    profile:      'profile.svg',
    subscription: 'rub.svg'
  };

  /* Телеграм окружение */
  var tg=(window.Telegram&&window.Telegram.WebApp)?window.Telegram.WebApp:{
    initData:'',initDataUnsafe:{},ready:function(){},expand:function(){},
    BackButton:{show:function(){},hide:function(){},onClick:function(){}},
    HapticFeedback:{impactOccurred:function(){}},showAlert:function(m){alert(m)}
  };
  try{tg.ready();tg.expand();}catch(e){}

  /* Проставляем src для иконок */
  (function attachIcons(){
    const map = [
      ['ico-manual',       ICONS.manual],
      ['ico-start',        ICONS.start],
      ['ico-products',     ICONS.products],
      ['ico-kbju',         ICONS.kbju],
      ['ico-measurements', ICONS.measurements],
      ['ico-menu',         ICONS.menu],
      ['ico-diary',        ICONS.diary],
      ['ico-ai',           ICONS.ai],
      ['ico-analytics',    ICONS.analytics],
      ['ico-profile',      ICONS.profile],
      ['ico-subscription', ICONS.subscription],
    ];
    map.forEach(([id, file])=>{
      const el = document.getElementById(id);
      if(el){ el.src = ICON_BASE + file; el.decoding='async'; el.loading='eager'; }
    });
  })();

  // Пользователь + аватар
  (function(){
    try{
      var u=(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user)?tg.initDataUnsafe.user:null;
      var nameEl=document.getElementById('userName');
      var idEl=document.getElementById('userId');
      var photoEl=document.getElementById('userPhoto');
      if(u){
        var full=((u.first_name||'')+' '+(u.last_name||'')).trim()||'Пользователь';
        nameEl.textContent=full; idEl.textContent='ID: '+(u.id||'---');
        if(u.photo_url){
          var img=new Image(); img.src=u.photo_url; img.alt=full; img.className='avatar-img';
          photoEl.textContent=''; photoEl.appendChild(img);
        } else {
          photoEl.textContent=(full.charAt(0)||'A').toUpperCase();
        }
      } else {
        nameEl.textContent='Александр Петров'; idEl.textContent='ID: 123456789'; photoEl.textContent='А';
      }
    }catch(e){}
  })();

  function toast(msg){var t=document.getElementById('toast');t.textContent=msg;t.style.opacity='1';setTimeout(function(){t.style.opacity='0';},1400);}

  // Универсальный ripple — всегда в .icon, одинаковый для всех
  function rippleIn(target, e){
    try{
      var host = (target.closest && target.closest('.icon')) || (target.querySelector && target.querySelector('.icon')) || null;
      if(!host){ return; }
      var r=document.createElement('span'); r.className='r';
      var b=host.getBoundingClientRect();
      var pt = (e.touches && e.touches[0]) ? e.touches[0] : e;
      r.style.left=(pt.clientX-b.left)+'px'; r.style.top=(pt.clientY-b.top)+'px';
      host.appendChild(r);
      r.addEventListener('animationend',function(){ if(r&&r.parentNode){ r.parentNode.removeChild(r);} },false);
    }catch(_){}
  }

  (function(){
    var grid=document.getElementById('gridB');
    var start=document.getElementById('startB');
    var btnProducts=document.getElementById('btnProducts');
    var btnKbju=document.getElementById('btnKbju');
    var backdrop=document.getElementById('backdrop');
    var opened=false, backHandler=null;

    function openMenu(){ if(opened) return; opened=true;
      start.classList.add('open-b'); grid.classList.add('focus'); backdrop.classList.add('show');
      try{ tg.BackButton.show(); if(tg.BackButton.onClick){ backHandler=function(){ closeMenu(); }; tg.BackButton.onClick(backHandler);} }catch(_){}
    }
    function closeMenu(){ if(!opened) return; opened=false;
      start.classList.remove('open-b'); grid.classList.remove('focus'); backdrop.classList.remove('show');
      try{ tg.BackButton.hide(); if(backHandler){ tg.BackButton.onClick(function(){}); backHandler=null; } }catch(_){}
    }

    // «Старт» — сначала ripple, затем (через 90мс) открыть/закрыть
    function onStartTap(e){
      rippleIn(e.target, e);
      setTimeout(function(){ opened?closeMenu():openMenu(); }, 90);
    }
    start.addEventListener('touchstart', onStartTap, {passive:true});
    start.addEventListener('click', onStartTap);

    // Кнопки разворота — ripple и переход через 90мс
    function goAfterRipple(url, e){
      e.stopPropagation();
      rippleIn(e.target, e);
      setTimeout(function(){ window.location.href=url; }, 90);
    }
    btnProducts.addEventListener('touchstart', function(e){ goAfterRipple('products.html', e); }, {passive:true});
    btnProducts.addEventListener('click', function(e){ goAfterRipple('products.html', e); });

    btnKbju.addEventListener('touchstart', function(e){ goAfterRipple('kbju.html', e); }, {passive:true});
    btnKbju.addEventListener('click', function(e){ goAfterRipple('kbju.html', e); });

    // Закрытие по тапу вне
    backdrop.addEventListener('click',function(){ closeMenu(); });
    document.addEventListener('keydown',function(e){ if(e.key==='Escape'){ closeMenu(); } });

    // Остальные плитки — ripple + заглушка
    var tiles=document.querySelectorAll('.tile[data-module]');
    tiles.forEach(function(t){
      t.addEventListener('touchstart',function(ev){ rippleIn(ev.target, ev); },{passive:true});
      t.addEventListener('click',function(ev){ rippleIn(ev.target, ev); toast('Раздел в разработке'); });
    });
  })();
</script>
</body>
</html>
