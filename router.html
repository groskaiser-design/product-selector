<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Router — Variant B (Full Grid, Blur Others)</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  html,body{height:100%;scrollbar-gutter:stable both-edges}
  :root{--sbi:env(safe-area-inset-bottom,0px)}
  body{
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
    min-height:100vh;
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    padding:20px 16px calc(24px + var(--sbi)) 16px;
    color:#111
  }
  .container{max-width:520px;margin:0 auto}

  /* ===== Профиль (обновлено) ===== */
  .profile-card{
    background:rgba(255,255,255,.15);
    backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
    border-radius:24px;padding:20px 22px;margin-bottom:24px;
    border:1px solid rgba(255,255,255,.22);
    box-shadow:0 8px 32px rgba(0,0,0,.12),inset 0 1px 0 rgba(255,255,255,.35);
    transition:filter .22s ease, opacity .22s ease
  }
  .profile-header{display:flex;gap:14px;align-items:center}
  .profile-photo{
    width:88px;height:88px;border-radius:50%;overflow:hidden;position:relative;flex:0 0 88px;
    display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:28px;
    background:linear-gradient(135deg,rgba(255,255,255,.35),rgba(255,255,255,.15));
    border:2px solid rgba(255,255,255,.28);
    box-shadow:
      0 10px 24px rgba(0,0,0,.22),
      inset 0 2px 6px rgba(255,255,255,.25);
  }
  /* световой отблеск */
  .profile-photo::before{
    content:"";position:absolute;inset:0;border-radius:50%;
    background:radial-gradient(120% 120% at 50% -10%,rgba(255,255,255,.35),transparent 60%);
    pointer-events:none
  }
  /* сами пиксели фото — «умное» кадрирование */
  .avatar-img{
    width:100%;height:100%;display:block;border-radius:50%;
    object-fit:cover;
    /* смещение вверх, чтобы чаще помещалось всё лицо */
    object-position:50% 35%;
    /* лёгкое «анти-зум»: если аватар слишком крупный, можно ещё поднять позицию на 30–40% */
  }

  .profile-main{min-width:0}
  .profile-name{color:#fff;font-weight:800;font-size:20px;line-height:1.15}
  .profile-id{margin-top:6px;font-size:12px;display:inline-block;color:rgba(255,255,255,.9);
    background:rgba(255,255,255,.14);padding:4px 8px;border-radius:8px}

  .dim-header .profile-card{filter:blur(1px);opacity:.7}

  /* ===== Сетка плиток ===== */
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;position:relative}
  .tile{position:relative;text-align:center;cursor:pointer;user-select:none;overflow:visible;
    transition:transform .18s ease, filter .22s ease, opacity .22s ease}
  .icon-wrap{width:72px;height:72px;margin:0 auto 10px;position:relative}
  .icon-bg{
    position:absolute;left:-2px;top:-2px;width:76px;height:76px;border-radius:22px;
    background:linear-gradient(135deg,rgba(255,255,255,.4),rgba(255,255,255,.1));
    opacity:.6;transition:opacity .2s,transform .2s
  }
  .icon{
    position:absolute;inset:0;margin:auto;width:72px;height:72px;border-radius:20px;
    background:rgba(255,255,255,.22);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
    border:1.5px solid rgba(255,255,255,.45);display:flex;align-items:center;justify-content:center;
    box-shadow:0 8px 24px rgba(0,0,0,.12),inset 0 1px 0 rgba(255,255,255,.55);
    transition:transform .18s ease,box-shadow .18s ease
  }
  .icon svg{width:36px;height:36px;stroke:#fff;fill:none;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round}
  .label{font-size:12px;font-weight:700;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.25)}
  .tile:active .icon{transform:scale(.92)}

  /* Hover — только для конкретной плитки (десктоп) */
  .grid .tile:hover > .icon-wrap > .icon{
    transform:translateY(-6px) scale(1.04);
    box-shadow:0 14px 28px rgba(0,0,0,.18),inset 0 1px 0 rgba(255,255,255,.6),0 0 24px rgba(102,126,234,.35)
  }
  .grid .tile:hover > .icon-wrap > .icon-bg{opacity:1;transform:scale(1.05)}
  .spawn:hover .icon{transform:translateY(-4px) scale(1.03)}
  .spawn:hover .icon-bg{opacity:1;transform:scale(1.05)}

  /* Ripple — фиксированный радиус */
  .tile .r{
    position:absolute;width:12px;height:12px;border-radius:999px;background:rgba(255,255,255,.35);
    left:0;top:0;transform:translate(-50%,-50%) scale(0);pointer-events:none;filter:blur(1px);
    animation:rr .6s ease-out forwards;will-change:transform,opacity
  }
  @keyframes rr{to{transform:translate(-50%,-50%) scale(22);opacity:0}}

  /* ==== Variant B: Arc Menu (glass) ==== */
  #startB{z-index:3}
  .spawn{
    position:absolute;left:50%;top:50%;width:90px;height:106px;
    transform:translate(-50%,-50%) rotate(0) translate(0) rotate(0);
    opacity:0;pointer-events:none;background:transparent;border:0;padding:0;appearance:none;-webkit-appearance:none
  }
  .spawn:focus{outline:none}
  .spawn .icon-wrap{width:72px;height:72px}
  .spawn .icon-bg{width:76px;height:76px;left:-2px;top:-2px;border-radius:22px}
  .spawn .label{margin-top:2px}

  .open-b .spawn{pointer-events:auto}
  .open-b .spawn.s1{opacity:1;transform:translate(-50%,-50%) rotate(-24deg) translate(148px) rotate(24deg)}
  .open-b .spawn.s2{opacity:1;transform:translate(-50%,-50%) rotate(24deg) translate(148px) rotate(-24deg)}
  .open-b #startB > .icon-wrap > .icon{transform:scale(.9)} /* уменьшаем только «Старт» */

  /* Блюрим всё, кроме стартовой плитки */
  .grid.focus .tile{filter:blur(2px) saturate(.85);opacity:.18;transform:translateY(8px)}
  .grid.focus #startB{filter:none;opacity:1;transform:none}

  /* Невидимый backdrop для закрытия по тапу вне */
  .backdrop{position:fixed;inset:0;display:none}
  .backdrop.show{display:block}
</style>
</head>
<body>
  <div class="container">
    <!-- Профиль -->
    <div class="profile-card">
      <div class="profile-header">
        <div class="profile-photo" id="userPhoto">A</div>
        <div class="profile-main">
          <div class="profile-name" id="userName">Загрузка...</div>
          <div class="profile-id" id="userId">ID: ---</div>
        </div>
      </div>
    </div>

    <!-- Сетка -->
    <div class="grid" id="gridB">
      <div class="tile" data-module="manual">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><svg viewBox="0 0 24 24">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
            <line x1="10" y1="8" x2="16" y2="8"/><line x1="10" y1="12" x2="16" y2="12"/>
          </svg></div></div>
        <div class="label">Инструкция</div>
      </div>

      <div class="tile" id="startB">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><svg viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg></div>
        </div>
        <div class="label">Старт</div>

        <!-- Разворот -->
        <button class="spawn s1" id="btnProducts" aria-label="Выбор продуктов">
          <div class="icon-wrap"><div class="icon-bg"></div>
            <div class="icon">
              <svg viewBox="0 0 24 24">
                <circle cx="9" cy="21" r="1.5"/><circle cx="17" cy="21" r="1.5"/>
                <path d="M3 3h2l2.2 10.4a2 2 0 0 0 2 1.6h7.6a2 2 0 0 0 2-1.5l1.2-5.5H6.1"/>
              </svg>
            </div>
          </div>
          <div class="label">Выбор продуктов</div>
        </button>

        <button class="spawn s2" id="btnKbju" aria-label="Анкета для КБЖУ">
          <div class="icon-wrap"><div class="icon-bg"></div>
            <div class="icon">
              <svg viewBox="0 0 24 24">
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                <polyline points="14 2 14 8 20 8"/>
              </svg>
            </div>
          </div>
          <div class="label">Анкета КБЖУ</div>
        </button>
      </div>

      <div class="tile" data-module="measurements">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><svg viewBox="0 0 24 24">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg></div></div>
        <div class="label">Замеры</div>
      </div>

      <div class="tile" data-module="menu">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><svg viewBox="0 0 24 24">
            <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/>
            <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3z"/><path d="M19 22v-7"/>
          </svg></div></div>
        <div class="label">Рацион</div>
      </div>

      <div class="tile" data-module="diary">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><svg viewBox="0 0 24 24">
            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/>
            <line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/>
          </svg></div></div>
        <div class="label">Отчёт</div>
      </div>

      <div class="tile" data-module="ai">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><svg viewBox="0 0 24 24">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg></div></div>
        <div class="label">AI-Коуч</div>
      </div>

      <div class="tile" data-module="analytics">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><svg viewBox="0 0 24 24">
            <line x1="12" y1="20" x2="12" y2="10"/>
            <line x1="18" y1="20" x2="18" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="16"/>
          </svg></div></div>
        <div class="label">Аналитика</div>
      </div>

      <div class="tile" data-module="profile">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><svg viewBox="0 0 24 24">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg></div></div>
        <div class="label">Профиль</div>
      </div>

      <div class="tile" data-module="subscription">
        <div class="icon-wrap"><div class="icon-bg"></div>
          <div class="icon"><svg viewBox="0 0 24 24">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg></div></div>
        <div class="label">Подписка</div>
      </div>
    </div>
  </div>

  <div class="backdrop" id="backdrop"></div>
  <div id="toast" style="position:fixed;left:50%;bottom:86px;transform:translateX(-50%);background:rgba(0,0,0,.82);color:#fff;padding:10px 14px;border-radius:10px;font-weight:700;z-index:1000;opacity:0;transition:opacity .2s"></div>

<script>
  var BLUR_HEADER=false, DEMO_PREVIEW=false;

  var tg=(window.Telegram&&window.Telegram.WebApp)?window.Telegram.WebApp:{
    initData:'',initDataUnsafe:{},ready:function(){},expand:function(){},
    BackButton:{show:function(){},hide:function(){},onClick:function(){}},
    HapticFeedback:{impactOccurred:function(){}},showAlert:function(m){alert(m)}
  };
  try{tg.ready();tg.expand();}catch(e){}

  // Пользователь + аватар
  (function(){
    try{
      var u=(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user)?tg.initDataUnsafe.user:null;
      var nameEl=document.getElementById('userName');
      var idEl=document.getElementById('userId');
      var photoEl=document.getElementById('userPhoto');
      if(u){
        var full=((u.first_name||'')+' '+(u.last_name||'')).trim()||'Пользователь';
        nameEl.textContent=full; idEl.textContent='ID: '+(u.id||'---');
        if(u.photo_url){
          var img=new Image();
          img.src=u.photo_url; img.alt=full; img.className='avatar-img';
          photoEl.textContent=''; photoEl.appendChild(img);
        } else {
          photoEl.textContent=(full.charAt(0)||'A').toUpperCase();
        }
      } else {
        nameEl.textContent='Александр Петров'; idEl.textContent='ID: 123456789'; photoEl.textContent='А';
      }
    }catch(e){}
  })();

  function ripple(el,e){
    try{
      var r=document.createElement('span'); r.className='r';
      var b=el.getBoundingClientRect();
      r.style.left=(e.clientX-b.left)+'px'; r.style.top=(e.clientY-b.top)+'px';
      el.appendChild(r);
      r.addEventListener('animationend',function(){ if(r&&r.parentNode){ r.parentNode.removeChild(r);} },false);
    }catch(_){}
  }
  function toast(msg){var t=document.getElementById('toast');t.textContent=msg;t.style.opacity='1';setTimeout(function(){t.style.opacity='0';},1600);}
  function go(url){try{tg.HapticFeedback&&tg.HapticFeedback.impactOccurred&&tg.HapticFeedback.impactOccurred('medium');}catch(_){}
    if(DEMO_PREVIEW){toast('Откроется '+url);return;} window.location.href=url;}

  (function(){
    var grid=document.getElementById('gridB');
    var start=document.getElementById('startB');
    var btnProducts=document.getElementById('btnProducts');
    var btnKbju=document.getElementById('btnKbju');
    var backdrop=document.getElementById('backdrop');
    var opened=false, backHandler=null;

    function openMenu(){ if(opened) return; opened=true;
      start.classList.add('open-b'); grid.classList.add('focus'); backdrop.classList.add('show');
      if(BLUR_HEADER){ document.body.classList.add('dim-header'); }
      try{ tg.BackButton.show(); if(tg.BackButton.onClick){ backHandler=function(){ closeMenu(); }; tg.BackButton.onClick(backHandler);} }catch(_){}
    }
    function closeMenu(){ if(!opened) return; opened=false;
      start.classList.remove('open-b'); grid.classList.remove('focus'); backdrop.classList.remove('show');
      document.body.classList.remove('dim-header');
      try{ tg.BackButton.hide(); if(backHandler){ tg.BackButton.onClick(function(){}); backHandler=null; } }catch(_){}
    }

    start.addEventListener('click',function(e){ ripple(start,e); opened?closeMenu():openMenu(); });
    btnProducts.addEventListener('click',function(e){ e.stopPropagation(); go('products.html'); });
    btnKbju.addEventListener('click',function(e){ e.stopPropagation(); go('kbju.html'); });
    backdrop.addEventListener('click',function(){ closeMenu(); });
    document.addEventListener('keydown',function(e){ if(e.key==='Escape'){ closeMenu(); } });
  })();

  (function(){
    var tiles=document.querySelectorAll('.tile[data-module]');
    for(var i=0;i<tiles.length;i++){ tiles[i].addEventListener('click',function(){ toast('Раздел в разработке'); }); }
  })();
</script>
</body>
</html>
