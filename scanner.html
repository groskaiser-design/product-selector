
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Smart Diary</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  /* === CORE SETUP === */
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
  *::-webkit-scrollbar { display: none; }
  
  :root {
    --bg-core: #050505;
    --text-main: #ffffff;
    --text-muted: rgba(255, 255, 255, 0.55);
    
    --surface-glass: rgba(255, 255, 255, 0.08);
    --surface-border: rgba(255, 255, 255, 0.12);
    
    --acc-orange: #ff9f0a;
    --acc-green: #30d158;
    --acc-blue: #0a84ff;
    --acc-red: #ff453a;
    
    --radius-xl: 24px;
    --radius-l: 18px;
    --radius-m: 14px;
    
    --safe-bottom: calc(10px + env(safe-area-inset-bottom));
  }

  body {
    margin: 0; padding: 0;
    background: var(--bg-core);
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', Roboto, sans-serif;
    color: var(--text-main);
    height: 100vh;
    display: flex; flex-direction: column;
    overflow: hidden; /* Scroll is inside .scroll-container */
  }

  /* === FX LAYER === */
  .fx-layer { position: fixed; inset: 0; z-index: -1; pointer-events: none; }
  .orb { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.35; animation: float 20s infinite linear; }
  .orb-1 { width: 300px; height: 300px; background: #5e60ce; top: -10%; left: -20%; }
  .orb-2 { width: 250px; height: 250px; background: #0a84ff; bottom: 10%; right: -10%; animation-direction: reverse; }
  @keyframes float { 0%{transform:rotate(0deg)} 50%{transform:rotate(180deg)} 100%{transform:rotate(360deg)} }
  .noise { position: fixed; inset: 0; opacity: 0.04; background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E"); }

  /* === SCROLL CONTAINER === */
  .scroll-container {
    flex: 1;
    overflow-y: auto;
    padding-bottom: 100px; /* Space for input bar */
    -webkit-overflow-scrolling: touch;
  }

  /* === 1. STICKY CALENDAR === */
  .calendar-sticky {
    position: sticky; top: 0; z-index: 50;
    background: rgba(5, 5, 5, 0.85);
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--surface-border);
    padding-top: calc(4px + env(safe-area-inset-top));
    padding-bottom: 12px;
  }
  .calendar-strip {
    display: flex; gap: 6px; padding: 0 12px;
    overflow-x: auto; scroll-snap-type: x mandatory;
  }
  .day-cap {
    flex: 0 0 48px; height: 60px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    border-radius: 14px;
    background: transparent;
    border: 1px solid transparent;
    transition: 0.2s;
    scroll-snap-align: center;
    cursor: pointer;
  }
  .day-cap.active {
    background: var(--surface-glass);
    border-color: rgba(255,255,255,0.3);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  .day-name { font-size: 10px; font-weight: 600; text-transform: uppercase; color: var(--text-muted); margin-bottom: 2px; }
  .day-num { font-size: 17px; font-weight: 700; color: #fff; }
  .day-cap.active .day-num { color: var(--acc-blue); }

  /* === 2. WIDGET CAROUSEL (ROUTER STYLE) === */
  .carousel-wrap { padding: 16px 0; overflow: hidden; }
  .carousel-track { 
    display: flex; gap: 12px; padding: 0 16px; 
    overflow-x: auto; scroll-snap-type: x mandatory; 
  }
  
  .widget {
    flex: 0 0 calc(100% - 32px); scroll-snap-align: center;
    height: 150px;
    background: linear-gradient(165deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.03) 100%);
    border: 1px solid var(--surface-border); border-top: 1px solid rgba(255,255,255,0.2);
    border-radius: var(--radius-xl);
    backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 24px;
    position: relative; overflow: hidden;
    transition: transform 0.1s;
  }
  .widget:active { transform: scale(0.98); }

  /* Widget Content */
  .w-left { z-index: 2; display: flex; flex-direction: column; gap: 6px; }
  .w-title { font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--text-muted); letter-spacing: 1px; }
  .w-main { font-size: 32px; font-weight: 800; line-height: 1; letter-spacing: -0.5px; }
  .w-main span { font-size: 16px; font-weight: 500; color: var(--text-muted); margin-left: 2px; }
  .w-sub { font-size: 13px; color: var(--text-muted); }

  /* Donut Visual */
  .w-right { width: 90px; height: 90px; position: relative; display: flex; align-items: center; justify-content: center; z-index: 2; }
  .donut-svg { width: 100%; height: 100%; transform: rotate(-90deg); }
  .d-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 8; }
  .d-val { fill: none; stroke: url(#grad-fire); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 251; stroke-dashoffset: 60; transition: 1s; }
  .d-icon { position: absolute; font-size: 24px; }

  /* Water Visual */
  .wave-box { width: 80px; height: 80px; border-radius: 50%; background: rgba(255,255,255,0.1); overflow: hidden; position: relative; border: 2px solid rgba(255,255,255,0.2); }
  .wave { position: absolute; bottom: 0; left: 0; width: 200%; height: 200%; background: var(--acc-blue); opacity: 0.8; border-radius: 40%; animation: wave 6s infinite linear; margin-left: -50%; margin-bottom: -130%; transition: margin-bottom 0.5s ease; }
  @keyframes wave { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

  /* Dots */
  .dots { display: flex; justify-content: center; gap: 6px; margin-top: 12px; }
  .dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(255,255,255,0.2); transition: 0.3s; }
  .dot.active { width: 18px; border-radius: 4px; background: #fff; }

  /* === 3. MEAL TIMELINE (INFORMATIVE) === */
  .timeline { padding: 16px 16px 40px 16px; display: flex; flex-direction: column; gap: 16px; }
  
  .meal-card {
    background: var(--surface-glass);
    border-radius: var(--radius-l);
    padding: 16px;
    border: 1px solid transparent;
  }
  
  .meal-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 12px; padding-bottom: 12px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
  }
  .meal-time { font-size: 15px; font-weight: 700; color: #fff; display: flex; align-items: center; gap: 8px; }
  .meal-time::before { content:''; width: 4px; height: 4px; background: var(--acc-green); border-radius: 50%; }
  .meal-total { font-size: 14px; font-weight: 600; color: var(--text-muted); background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 8px; }

  .product-list { display: flex; flex-direction: column; gap: 8px; }
  .prod-row { display: flex; justify-content: space-between; align-items: baseline; font-size: 14px; }
  .prod-name { color: rgba(255,255,255,0.9); flex: 1; }
  .prod-weight { color: var(--text-muted); margin-right: 12px; font-feature-settings: "tnum"; }
  .prod-cal { font-weight: 600; color: #fff; min-width: 40px; text-align: right; font-feature-settings: "tnum"; }

  /* === 4. OMNI-BAR (TELEGRAM STYLE) === */
  .omni-bar {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: rgba(10, 10, 10, 0.92);
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255,255,255,0.1);
    padding: 8px 12px var(--safe-bottom) 12px;
    z-index: 100;
    display: flex; align-items: flex-end; gap: 8px;
  }

  /* Clip Button */
  .icon-btn {
    width: 40px; height: 40px; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    color: #fff; border-radius: 50%;
    transition: background 0.2s; cursor: pointer;
    margin-bottom: 2px; /* Align with bottom of textarea */
  }
  .icon-btn:active { background: rgba(255,255,255,0.15); }
  .icon-btn svg { width: 24px; height: 24px; opacity: 0.8; }

  /* Input Bubble */
  .input-bubble {
    flex: 1;
    background: rgba(255,255,255,0.08);
    border-radius: 20px;
    min-height: 44px;
    display: flex; align-items: center;
    padding: 4px 16px;
    border: 1px solid transparent;
    transition: border 0.2s;
  }
  .input-bubble:focus-within { border-color: rgba(255,255,255,0.2); background: rgba(255,255,255,0.12); }
  
  textarea {
    width: 100%;
    background: transparent; border: none;
    color: #fff; font-size: 16px; line-height: 1.4;
    padding: 8px 0; margin: 0;
    resize: none;
    max-height: 120px; /* Grow limit */
    font-family: inherit;
  }
  textarea::placeholder { color: rgba(255,255,255,0.35); }

  /* Action Button (Cam / Mic / Send) */
  .action-btn {
    width: 40px; height: 40px; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    border-radius: 50%;
    background: transparent;
    transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    margin-bottom: 2px;
    cursor: pointer;
  }
  
  /* State: Camera (Default) */
  .action-btn.mode-cam { color: #fff; }
  .action-btn.mode-cam:active { opacity: 0.7; transform: scale(0.95); }
  
  /* State: Send (Active) */
  .action-btn.mode-send { background: var(--acc-blue); color: #fff; transform: scale(1); }
  .action-btn.mode-send:active { transform: scale(0.92); }

  /* === TOAST (UNDO) === */
  .toast {
    position: fixed; top: 120px; left: 50%; transform: translateX(-50%) translateY(-20px);
    background: rgba(30,30,30,0.9); border: 1px solid rgba(255,255,255,0.15);
    padding: 12px 20px; border-radius: 30px;
    display: flex; align-items: center; gap: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    opacity: 0; pointer-events: none; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    z-index: 200;
  }
  .toast.visible { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: auto; }
  .toast-txt { font-size: 14px; font-weight: 600; }
  .toast-undo { color: var(--acc-blue); font-size: 14px; font-weight: 700; cursor: pointer; }

  /* === FATSECRET MENU (Minimal) === */
  .sheet-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 200;
    opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(4px);
  }
  .sheet-overlay.visible { opacity: 1; pointer-events: auto; }
  .sheet {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: #151517; border-radius: 24px 24px 0 0;
    padding: 24px 16px calc(30px + env(safe-area-inset-bottom)) 16px;
    transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.1, 0.7, 0.1, 1);
    border-top: 1px solid rgba(255,255,255,0.15);
  }
  .sheet-overlay.visible .sheet { transform: translateY(0); }
  
  .sheet-item {
    background: rgba(255,255,255,0.06); border-radius: 16px; padding: 16px;
    display: flex; align-items: center; gap: 16px; cursor: pointer;
    margin-bottom: 8px;
  }
  .sheet-item:active { background: rgba(255,255,255,0.12); }
  .sheet-icon { font-size: 24px; }
  .sheet-lbl { font-size: 16px; font-weight: 600; color: #fff; }

</style>
</head>
<body>

<svg width="0" height="0" style="position:absolute">
  <defs>
    <linearGradient id="grad-fire" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#ff9f0a"/><stop offset="100%" stop-color="#ff453a"/></linearGradient>
  </defs>
</svg>

<div class="fx-layer"><div class="orb orb-1"></div><div class="orb orb-2"></div><div class="noise"></div></div>

<div class="calendar-sticky">
  <div class="calendar-strip" id="calStrip"></div>
</div>

<div class="scroll-container">
  
  <div class="carousel-wrap">
    <div class="carousel-track" id="track">
      
      <div class="widget">
        <div class="w-left">
          <div class="w-title">–ü–∏—Ç–∞–Ω–∏–µ</div>
          <div class="w-main">1450<span>–∫–∫–∞–ª</span></div>
          <div class="w-sub">–¶–µ–ª—å: 2100</div>
        </div>
        <div class="w-right">
          <svg class="donut-svg" viewBox="0 0 100 100">
            <circle class="d-bg" cx="50" cy="50" r="40"/>
            <circle class="d-val" cx="50" cy="50" r="40"/>
          </svg>
          <div class="d-icon">üî•</div>
        </div>
      </div>

      <div class="widget" id="waterWidget" onclick="addWater()">
        <div class="w-left">
          <div class="w-title" style="color: var(--acc-blue)">–í–æ–¥–∞</div>
          <div class="w-main" id="waterTxt">1.2<span>–ª</span></div>
          <div class="w-sub">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</div>
        </div>
        <div class="w-right">
          <div class="wave-box"><div class="wave" id="waveAnim" style="margin-bottom: -130%"></div></div>
        </div>
      </div>

    </div>
    <div class="dots"><div class="dot active"></div><div class="dot"></div></div>
  </div>

  <div class="timeline">
    <div class="meal-card">
      <div class="meal-header">
        <div class="meal-time">09:00 <span>–ó–∞–≤—Ç—Ä–∞–∫</span></div>
        <div class="meal-total">420 –∫–∫–∞–ª</div>
      </div>
      <div class="product-list">
        <div class="prod-row">
          <div class="prod-name">–û–≤—Å—è–Ω–∞—è –∫–∞—à–∞ –Ω–∞ –≤–æ–¥–µ</div>
          <div class="prod-weight">200 –≥</div>
          <div class="prod-cal">180</div>
        </div>
        <div class="prod-row">
          <div class="prod-name">–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ</div>
          <div class="prod-weight">10 –≥</div>
          <div class="prod-cal">75</div>
        </div>
        <div class="prod-row">
          <div class="prod-name">–ö–æ—Ñ–µ —Å –º–æ–ª–æ–∫–æ–º</div>
          <div class="prod-weight">250 –º–ª</div>
          <div class="prod-cal">165</div>
        </div>
      </div>
    </div>

    <div class="meal-card">
      <div class="meal-header">
        <div class="meal-time">13:30 <span>–û–±–µ–¥</span></div>
        <div class="meal-total">650 –∫–∫–∞–ª</div>
      </div>
      <div class="product-list">
        <div class="prod-row">
          <div class="prod-name">–ë–æ—Ä—â —Å –≥–æ–≤—è–¥–∏–Ω–æ–π</div>
          <div class="prod-weight">300 –≥</div>
          <div class="prod-cal">240</div>
        </div>
        <div class="prod-row">
          <div class="prod-name">–°–º–µ—Ç–∞–Ω–∞ 15%</div>
          <div class="prod-weight">30 –≥</div>
          <div class="prod-cal">48</div>
        </div>
        <div class="prod-row">
          <div class="prod-name">–ü—é—Ä–µ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å–Ω–æ–µ</div>
          <div class="prod-weight">150 –≥</div>
          <div class="prod-cal">160</div>
        </div>
        <div class="prod-row">
          <div class="prod-name">–ö–æ—Ç–ª–µ—Ç–∞ –ø–∞—Ä–æ–≤–∞—è</div>
          <div class="prod-weight">100 –≥</div>
          <div class="prod-cal">202</div>
        </div>
      </div>
    </div>
  </div>

</div>

<div class="toast" id="toast">
  <div class="toast-txt">–î–æ–±–∞–≤–ª–µ–Ω–æ 250 –º–ª</div>
  <div class="toast-undo" onclick="undoWater()">–û–¢–ú–ï–ù–ê</div>
</div>

<div class="omni-bar">
  <div class="icon-btn" onclick="toggleSheet()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
  </div>
  
  <div class="input-bubble">
    <textarea id="msgInput" rows="1" placeholder="–Ø–±–ª–æ–∫–æ 200–≥, –∫–æ—Ñ–µ..."></textarea>
  </div>
  
  <div class="action-btn mode-cam" id="actionBtn" onclick="handleAction()">
    <svg id="iconCam" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
    <svg id="iconSend" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="display:none"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
  </div>
</div>

<div class="sheet-overlay" id="sheet" onclick="toggleSheet()">
  <div class="sheet" onclick="event.stopPropagation()">
    <div class="sheet-item" onclick="alert('–õ–æ–≥–∏–∫–∞ FatSecret PDF')">
      <div class="sheet-icon" style="color: #30d158">ü•ó</div>
      <div class="sheet-lbl">FatSecret (PDF)</div>
    </div>
    <div class="sheet-item">
      <div class="sheet-icon" style="color: #0a84ff">üîó</div>
      <div class="sheet-lbl">–í—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</div>
    </div>
  </div>
</div>

<script>
  const tg = window.Telegram?.WebApp;
  if(tg) { tg.ready(); tg.expand(); tg.setHeaderColor('#050505'); }

  // === CALENDAR ===
  function initCalendar() {
    const strip = document.getElementById('calStrip');
    const week = ['–í—Å','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'];
    const today = new Date();
    
    for(let i=-2; i<=4; i++) {
      const d = new Date(); d.setDate(today.getDate() + i);
      const isToday = i === 0;
      const el = document.createElement('div');
      el.className = `day-cap ${isToday ? 'active' : ''}`;
      el.innerHTML = `<div class="day-name">${week[d.getDay()]}</div><div class="day-num">${d.getDate()}</div>`;
      el.onclick = () => {
        document.querySelectorAll('.day-cap').forEach(c=>c.classList.remove('active'));
        el.classList.add('active');
        haptic('selection');
      };
      strip.appendChild(el);
    }
  }

  // === INPUT AUTOGROW & ACTION SWITCH ===
  const txt = document.getElementById('msgInput');
  const btn = document.getElementById('actionBtn');
  const iconCam = document.getElementById('iconCam');
  const iconSend = document.getElementById('iconSend');

  txt.addEventListener('input', () => {
    // Auto grow
    txt.style.height = 'auto';
    txt.style.height = Math.min(txt.scrollHeight, 120) + 'px';
    
    // Switch icon
    const hasText = txt.value.trim().length > 0;
    if(hasText) {
      btn.classList.remove('mode-cam');
      btn.classList.add('mode-send');
      iconCam.style.display = 'none';
      iconSend.style.display = 'block';
    } else {
      btn.classList.add('mode-cam');
      btn.classList.remove('mode-send');
      iconCam.style.display = 'block';
      iconSend.style.display = 'none';
    }
  });

  function handleAction() {
    const hasText = txt.value.trim().length > 0;
    haptic('light');
    
    if(hasText) {
      // SEND TEXT LOGIC
      console.log("Send:", txt.value);
      txt.value = '';
      txt.style.height = 'auto';
      txt.blur();
      // Reset button
      btn.classList.add('mode-cam'); btn.classList.remove('mode-send');
      iconCam.style.display = 'block'; iconSend.style.display = 'none';
      haptic('success');
    } else {
      // OPEN CAMERA LOGIC
      setTimeout(() => window.location.href = 'cam.html', 50);
    }
  }

  // === WATER WIDGET LOGIC (ADD + UNDO) ===
  let waterVol = 1.2;
  let toastTimer;
  
  function addWater() {
    haptic('medium');
    waterVol += 0.25;
    updateWaterUI();
    showToast();
  }
  
  function undoWater() {
    haptic('warning');
    waterVol -= 0.25;
    updateWaterUI();
    hideToast();
  }
  
  function updateWaterUI() {
    document.getElementById('waterTxt').innerHTML = `${waterVol.toFixed(2)}<span>–ª</span>`;
    // Animate wave height based on progress (simple logic)
    const pct = Math.min(100, (waterVol / 2.5) * 100);
    const bottom = -150 + pct; // rough mapping
    document.getElementById('waveAnim').style.marginBottom = `${bottom}%`;
  }

  function showToast() {
    const t = document.getElementById('toast');
    t.classList.add('visible');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(hideToast, 3000);
  }
  
  function hideToast() {
    document.getElementById('toast').classList.remove('visible');
  }

  // === MENU SHEET ===
  function toggleSheet() {
    haptic('light');
    document.getElementById('sheet').classList.toggle('visible');
  }

  function haptic(type) {
    if(tg?.HapticFeedback) tg.HapticFeedback.impactOccurred(type);
  }

  // === INIT CAROUSEL SCROLL SNAPPING ===
  const track = document.getElementById('track');
  const dots = document.querySelectorAll('.dot');
  track.addEventListener('scroll', () => {
    const w = track.clientWidth;
    const scroll = track.scrollLeft;
    const idx = Math.round(scroll / w);
    dots.forEach((d, i) => d.classList.toggle('active', i === idx));
  });

  initCalendar();

</script>
</body>
</html>
