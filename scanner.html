<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Food AI</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    /* === –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï (–∏–∑ measurements.html) === */
    :root {
      --bg: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      --text-primary: #fff;
      --card-bg: rgba(255,255,255,0.12);
      --card-border: rgba(255,255,255,0.2);
      --ok-color: #22c55e;
      --accent-grad: linear-gradient(135deg, #fbbf24, #f59e0b);
      --shadow: 0 8px 28px rgba(0,0,0,0.18);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    body {
      background: var(--bg); color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh; overflow-x: hidden;
    }

    .page { max-width: 560px; margin: 0 auto; padding: 12px; }

    /* === –ê–ö–ö–û–†–î–ï–û–ù (–°—Ç–∏–ª—å measurements.html) === */
    .section {
      background: linear-gradient(180deg, rgba(255,255,255,0.18), rgba(255,255,255,0.12));
      border: 1px solid var(--card-border);
      border-radius: 20px; margin-bottom: 12px;
      overflow: hidden; backdrop-filter: blur(12px);
      box-shadow: var(--shadow); transition: all 0.3s ease;
    }
    .section-h {
      padding: 16px 20px; display: flex; align-items: center; justify-content: space-between;
      cursor: pointer; user-select: none;
    }
    .section-h h2 { font-size: 18px; font-weight: 800; margin: 0; }
    .toggle-icon { transition: transform 0.3s; font-size: 14px; opacity: 0.7; }
    .section.collapsed .section-content { display: none; }
    .section:not(.collapsed) .toggle-icon { transform: rotate(180deg); }
    .section-content { padding: 0; /* Padding –≤–Ω—É—Ç—Ä–∏ —á–∞—Ç–∞ —Å–≤–æ–π */ }

    /* === –ß–ê–¢ –§–ò–î (–°—Ç–∏–ª—å ai.html –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) === */
    .chat-container {
      height: 450px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ */
      display: flex; flex-direction: column;
      background: rgba(0,0,0,0.1);
    }
    .chat-messages {
      flex: 1; overflow-y: auto; padding: 16px;
      display: flex; flex-direction: column; gap: 12px;
      scroll-behavior: smooth;
    }
    
    /* –°–æ–æ–±—â–µ–Ω–∏—è */
    .msg { max-width: 85%; animation: slideIn 0.3s ease; }
    .msg.user { align-self: flex-end; }
    .msg.ai { align-self: flex-start; width: 100%; /* –í–∏–¥–∂–µ—Ç—ã –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */ }
    
    @keyframes slideIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

    .bubble {
      padding: 10px 14px; border-radius: 16px; font-size: 15px; line-height: 1.4; position: relative;
    }
    .msg.user .bubble {
      background: rgba(251,191,36,0.25); border: 1px solid rgba(251,191,36,0.4);
      border-bottom-right-radius: 4px;
    }
    /* –§–æ—Ç–æ –≤ —á–∞—Ç–µ */
    .msg-photo {
      border-radius: 12px; margin-bottom: 6px; overflow: hidden; border: 1px solid rgba(255,255,255,0.2);
    }
    .msg-photo img { display: block; width: 100%; height: auto; }

    /* === –í–ò–î–ñ–ï–¢-–ß–ï–ö (–°–µ—Ä–¥—Ü–µ –º–æ–¥—É–ª—è) === */
    .food-widget {
      background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
      border-radius: 16px; border-bottom-left-radius: 4px; overflow: hidden;
    }
    .fw-head {
      background: rgba(255,255,255,0.05); padding: 8px 12px;
      font-size: 12px; font-weight: 700; opacity: 0.8; letter-spacing: 0.5px; text-transform: uppercase;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .fw-body { padding: 12px; }
    .fw-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 14px; }
    .fw-row span:first-child { margin-right: 10px; }
    .fw-row span:last-child { font-weight: 700; white-space: nowrap; }
    
    .fw-total {
      margin-top: 12px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.15);
      display: flex; justify-content: space-between; font-size: 16px; font-weight: 900; color: #fbbf24;
    }
    
    .fw-actions { padding: 12px; padding-top: 0; display: flex; gap: 8px; }
    .btn-action {
      flex: 1; padding: 12px; border-radius: 12px; border: none; font-weight: 700; font-size: 14px;
      cursor: pointer; transition: transform 0.1s, filter 0.2s;
      display: flex; align-items: center; justify-content: center; gap: 6px;
    }
    .btn-action:active { transform: scale(0.97); }
    
    .btn-save { background: var(--accent-grad); color: #fff; box-shadow: 0 4px 12px rgba(251,191,36,0.3); }
    .btn-edit { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
    
    /* –°–æ—Å—Ç–æ—è–Ω–∏–µ "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ" */
    .btn-save.done { background: var(--ok-color); pointer-events: none; box-shadow: none; }

    /* === –ü–ê–ù–ï–õ–¨ –í–í–û–î–ê === */
    .input-area {
      padding: 10px; background: rgba(0,0,0,0.2); backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex; align-items: flex-end; gap: 8px;
    }
    .inp-btn {
      width: 44px; height: 44px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.08); color: #fff; display: flex; justify-content: center; align-items: center;
      font-size: 20px; flex-shrink: 0; cursor: pointer;
    }
    .inp-field {
      flex: 1; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2);
      border-radius: 12px; padding: 12px; color: #fff; font-size: 16px;
      max-height: 100px; overflow-y: auto; resize: none; font-family: inherit;
    }
    .inp-field::placeholder { color: rgba(255,255,255,0.5); }

    /* === –ö–ê–ú–ï–†–ê –û–í–ï–†–õ–ï–ô (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è cam.html) === */
    #cam-overlay {
      position: fixed; inset: 0; z-index: 9999; background: #000;
      display: none; opacity: 0; transition: opacity 0.3s;
    }
    #cam-overlay.visible { display: block; opacity: 1; }
    
    .cam-view { position: relative; width: 100%; height: 100%; }
    .cam-video { width: 100%; height: 100%; object-fit: cover; }
    
    /* UI –ö–∞–º–µ—Ä—ã */
    .cam-ui-top {
      position: absolute; top: 16px; left: 0; right: 0; 
      display: flex; justify-content: space-between; padding: 0 20px; z-index: 10;
    }
    .cam-btn-round {
      width: 40px; height: 40px; border-radius: 50%; background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.3); color: #fff; display: flex; justify-content: center; align-items: center;
      backdrop-filter: blur(4px); cursor: pointer;
    }
    
    .cam-ui-bottom {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
      padding: 20px 20px 40px; display: flex; flex-direction: column; gap: 16px; align-items: center;
    }
    
    /* –ü–æ–ª–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –ø—Ä—è–º–æ –≤ –∫–∞–º–µ—Ä–µ */
    .cam-input-wrap { width: 100%; position: relative; }
    .cam-input {
      width: 100%; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3);
      border-radius: 12px; padding: 10px 12px; color: #fff; font-size: 14px;
      backdrop-filter: blur(4px);
    }
    .cam-input::placeholder { color: rgba(255,255,255,0.7); }

    .shutter-btn {
      width: 72px; height: 72px; border-radius: 50%; background: #fff;
      border: 4px solid rgba(255,255,255,0.5); box-shadow: 0 0 20px rgba(0,0,0,0.5);
      cursor: pointer; transition: transform 0.1s;
    }
    .shutter-btn:active { transform: scale(0.9); }

    /* –£—Ä–æ–≤–µ–Ω—å (–ì–∏—Ä–æ—Å–∫–æ–ø) */
    .level-target {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 60px; height: 60px; border-radius: 50%;
      border: 2px dashed rgba(255,255,255,0.4); pointer-events: none;
    }
    .level-bubble {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 16px; height: 16px; border-radius: 50%; background: #fbbf24;
      box-shadow: 0 0 8px rgba(251,191,36,0.6); transition: background 0.2s, transform 0.1s linear;
    }
    .level-bubble.green { background: #22c55e; box-shadow: 0 0 8px rgba(34,197,94,0.6); }

  </style>
</head>
<body>

<div class="page">

  <section class="section" id="sec-food">
    <div class="section-h" onclick="toggleAccordion('sec-food')">
      <h2>–î–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è</h2>
      <div class="toggle-icon">‚ñº</div>
    </div>
    
    <div class="section-content">
      <div class="chat-container">
        
        <div class="chat-messages" id="chatFeed">
          <div class="msg ai">
            <div class="bubble" style="background: rgba(255,255,255,0.08);">
              –ü—Ä–∏–≤–µ—Ç! üëã <br>
              –Ø –≥–æ—Ç–æ–≤ –∑–∞–ø–∏—Å–∞—Ç—å –µ–¥—É. –ù–∞–∂–º–∏ üì∑, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ —Å —É—Ä–æ–≤–Ω–µ–º —Ç–æ—á–Ω–æ—Å—Ç–∏, –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏, —á—Ç–æ —Å—ä–µ–ª.
            </div>
          </div>
        </div>

        <div class="input-area">
          <button class="inp-btn" onclick="openCameraFlow()">üì∑</button>
          <textarea id="mainInput" class="inp-field" rows="1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–æ—Ä—â –∏ —Å–º–µ—Ç–∞–Ω–∞..."></textarea>
          <button class="inp-btn" style="background: var(--accent-grad); border:none;" onclick="handleTextSend()">‚û§</button>
        </div>

      </div>
    </div>
  </section>

</div>

<div id="cam-overlay">
  <div class="cam-view">
    <video id="camVideo" autoplay muted playsinline></video>
    
    <div class="cam-ui-top">
      <div class="cam-btn-round" onclick="closeCameraFlow()">‚úï</div>
      <div class="cam-btn-round" style="width:auto; padding:0 12px; font-size:13px; font-weight:600" id="camStatus">
        –î–µ—Ä–∂–∏—Ç–µ —Ä–æ–≤–Ω–æ
      </div>
    </div>

    <div class="level-target">
      <div id="levelBubble" class="level-bubble"></div>
    </div>

    <div class="cam-ui-bottom">
      <div class="cam-input-wrap">
        <input type="text" id="camComment" class="cam-input" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)..." autocomplete="off">
      </div>
      <button class="shutter-btn" onclick="capturePhoto()"></button>
    </div>
  </div>
  
  <canvas id="camCanvas" style="display:none;"></canvas>
</div>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
const tg = window.Telegram?.WebApp;
if(tg) { tg.ready(); tg.expand(); }

/* ==========================================
   –õ–û–ì–ò–ö–ê –ê–ö–ö–û–†–î–ï–û–ù–ê
   ========================================== */
function toggleAccordion(id) {
  const el = document.getElementById(id);
  el.classList.toggle('collapsed');
}

/* ==========================================
   –õ–û–ì–ò–ö–ê –ß–ê–¢–ê –ò –í–ò–î–ñ–ï–¢–û–í
   ========================================== */
const chatFeed = document.getElementById('chatFeed');
const mainInput = document.getElementById('mainInput');

// 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function appendUserMessage(text, photoBlob = null) {
  const msgDiv = document.createElement('div');
  msgDiv.className = 'msg user';
  
  let contentHtml = '';
  
  if (photoBlob) {
    const url = URL.createObjectURL(photoBlob);
    contentHtml += `<div class="msg-photo"><img src="${url}"></div>`;
  }
  
  if (text) {
    contentHtml += `<div class="bubble">${text}</div>`;
  }
  
  msgDiv.innerHTML = contentHtml;
  chatFeed.appendChild(msgDiv);
  scrollToBottom();
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–º–∏—Ç–∞—Ü–∏—é –∞–Ω–∞–ª–∏–∑–∞ (–∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –±—ç–∫—É)
  simulateAIAnalysis();
}

// 2. –°–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
function scrollToBottom() {
  chatFeed.parentElement.scrollTop = chatFeed.parentElement.scrollHeight;
}

// 3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞
function handleTextSend() {
  const text = mainInput.value.trim();
  if(!text) return;
  
  appendUserMessage(text);
  mainInput.value = '';
}

/* ==========================================
   –õ–û–ì–ò–ö–ê AI –ò –í–ò–î–ñ–ï–¢–ê (MOCKUP)
   ========================================== */
function simulateAIAnalysis() {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º "–ü–µ—á–∞—Ç–∞–µ—Ç..."
  const loadingId = 'loading_' + Date.now();
  const loadingDiv = document.createElement('div');
  loadingDiv.className = 'msg ai';
  loadingDiv.id = loadingId;
  loadingDiv.innerHTML = `<div class="bubble" style="opacity:0.7"><i>–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...</i></div>`;
  chatFeed.appendChild(loadingDiv);
  scrollToBottom();

  // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏ 1.5 —Å–µ–∫
  setTimeout(() => {
    document.getElementById(loadingId).remove();
    
    // –î–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ç–≤–æ–π –±—ç–∫–µ–Ω–¥
    const mockData = {
      total_kcal: 450,
      items: [
        { name: "–ë–æ—Ä—â —Å –≥–æ–≤—è–¥–∏–Ω–æ–π", weight: "300–≥", kcal: 280 },
        { name: "–°–º–µ—Ç–∞–Ω–∞ 20%", weight: "30–≥", kcal: 60 },
        { name: "–•–ª–µ–± –±–æ—Ä–æ–¥–∏–Ω—Å–∫–∏–π", weight: "1 –∫—É—Å.", kcal: 110 }
      ]
    };
    
    renderFoodWidget(mockData);
  }, 1500);
}

// 4. –†–µ–Ω–¥–µ—Ä –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –í–∏–¥–∂–µ—Ç–∞
function renderFoodWidget(data) {
  const widgetId = 'widget_' + Date.now();
  const msgDiv = document.createElement('div');
  msgDiv.className = 'msg ai';
  
  let rowsHtml = '';
  data.items.forEach(item => {
    rowsHtml += `
      <div class="fw-row">
        <span>${item.name} <span style="opacity:0.5">(${item.weight})</span></span>
        <span>${item.kcal}</span>
      </div>
    `;
  });

  msgDiv.innerHTML = `
    <div class="food-widget" id="${widgetId}">
      <div class="fw-head">–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞</div>
      <div class="fw-body">
        ${rowsHtml}
        <div class="fw-total">
          <span>–ò–¢–û–ì–û:</span>
          <span>${data.total_kcal} –∫–∫–∞–ª</span>
        </div>
      </div>
      <div class="fw-actions">
        <button class="btn-action btn-edit" onclick="editEntry('${widgetId}')">
          ‚úèÔ∏è –ò–∑–º.
        </button>
        <button class="btn-action btn-save" onclick="confirmEntry(this, '${widgetId}')">
          ‚úÖ –ó–∞–ø–∏—Å–∞—Ç—å
        </button>
      </div>
    </div>
  `;
  
  chatFeed.appendChild(msgDiv);
  scrollToBottom();
  
  // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫ "–£—Å–ø–µ—Ö" (Telegram)
  if(tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
}

// 5. –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ó–∞–ø–∏—Å–∞—Ç—å"
function confirmEntry(btn, widgetId) {
  // –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è
  btn.innerHTML = '–ó–∞–ø–∏—Å–∞–Ω–æ ‚úì';
  btn.classList.add('done');
  
  // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä—è–¥–æ–º
  const parent = btn.parentElement;
  const editBtn = parent.querySelector('.btn-edit');
  if(editBtn) editBtn.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º edit –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

  // –í–∏–±—Ä–æ
  if(tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
  
  // TODO: –ó–¥–µ—Å—å –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω—É—é –ë–î (Google Script)
  console.log('Saving to DB:', widgetId);
}

function editEntry(widgetId) {
  alert('–¢—É—Ç –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤');
}

/* ==========================================
   –õ–û–ì–ò–ö–ê –ö–ê–ú–ï–†–´ (–ò–ó cam.html)
   ========================================== */
const camOverlay = document.getElementById('cam-overlay');
const video = document.getElementById('camVideo');
const canvas = document.getElementById('camCanvas');
const camComment = document.getElementById('camComment');
const levelBubble = document.getElementById('levelBubble');
let stream = null;

async function openCameraFlow() {
  camOverlay.classList.add('visible');
  camComment.value = ''; // –°–±—Ä–æ—Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
  
  try {
    // –ó–∞–ø—Ä–æ—Å –ø–æ—Ç–æ–∫–∞ (environment = –∑–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞)
    stream = await navigator.mediaDevices.getUserMedia({ 
      video: { facingMode: 'environment' } 
    });
    video.srcObject = stream;
    video.play();
    
    // –°—Ç–∞—Ä—Ç –≥–∏—Ä–æ—Å–∫–æ–ø–∞
    startLevelSensor();
  } catch(e) {
    alert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ: ' + e.message);
    closeCameraFlow();
  }
}

function closeCameraFlow() {
  camOverlay.classList.remove('visible');
  if(stream) {
    stream.getTracks().forEach(t => t.stop());
    stream = null;
  }
  stopLevelSensor();
}

function capturePhoto() {
  if(!stream) return;
  
  // 1. –ó–∞—Ö–≤–∞—Ç –∫–∞–¥—Ä–∞
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video, 0, 0);
  
  // 2. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ Blob
  canvas.toBlob(blob => {
    const text = camComment.value.trim();
    
    // 3. –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–º–µ—Ä—É
    closeCameraFlow();
    
    // 4. –î–æ–±–∞–≤–ª—è–µ–º –≤ —á–∞—Ç
    appendUserMessage(text, blob);
  }, 'image/jpeg', 0.8);
}

/* ==========================================
   –õ–û–ì–ò–ö–ê –£–†–û–í–ù–Ø (–ì–ò–†–û–°–ö–û–ü)
   ========================================== */
function handleOrientation(event) {
  // gamma: –Ω–∞–∫–ª–æ–Ω –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ (-90...90)
  // beta: –Ω–∞–∫–ª–æ–Ω –≤–ø–µ—Ä–µ–¥-–Ω–∞–∑–∞–¥ (-180...180)
  
  let x = event.gamma || 0; 
  let y = event.beta || 0;
  
  // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞: –Ω–∞–º –Ω—É–∂–Ω–æ —á—Ç–æ–±—ã —Ç–µ–ª–µ—Ñ–æ–Ω –ª–µ–∂–∞–ª –ø–ª–æ—Å–∫–æ (beta ~0, gamma ~0)
  // –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–Ω–æ–∂–∏—Ç–µ–ª—å —Å–º–µ—â–µ–Ω–∏—è)
  const sens = 2; 
  
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø—É–∑—ã—Ä—å–∫–∞ –≤–Ω—É—Ç—Ä–∏ –∫—Ä—É–≥–∞
  let moveX = x * sens;
  let moveY = y * sens;
  
  const maxDist = 25; // –†–∞–¥–∏—É—Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
  if(moveX > maxDist) moveX = maxDist; if(moveX < -maxDist) moveX = -maxDist;
  if(moveY > maxDist) moveY = maxDist; if(moveY < -maxDist) moveY = -maxDist;
  
  levelBubble.style.transform = `translate(calc(-50% + ${moveX}px), calc(-50% + ${moveY}px))`;
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ "–†–æ–≤–Ω–æ –ª–∏?"
  if(Math.abs(x) < 3 && Math.abs(y) < 3) {
    levelBubble.classList.add('green');
    document.getElementById('camStatus').innerText = "–û—Ç–ª–∏—á–Ω–æ! –°–Ω–∏–º–∞–π—Ç–µ";
    document.getElementById('camStatus').style.color = "#22c55e";
  } else {
    levelBubble.classList.remove('green');
    document.getElementById('camStatus').innerText = "–î–µ—Ä–∂–∏—Ç–µ —Ä–æ–≤–Ω–æ";
    document.getElementById('camStatus').style.color = "#fff";
  }
}

function startLevelSensor() {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
  if (window.DeviceOrientationEvent) {
    // –î–ª—è iOS 13+ –Ω—É–∂–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ (–∑–¥–µ—Å—å —É–ø—Ä–æ—â–µ–Ω–æ, –Ω–æ –≤ cam.html —É —Ç–µ–±—è –µ—Å—Ç—å –ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞)
    window.addEventListener('deviceorientation', handleOrientation);
  }
}

function stopLevelSensor() {
  window.removeEventListener('deviceorientation', handleOrientation);
}

</script>
</body>
</html>
